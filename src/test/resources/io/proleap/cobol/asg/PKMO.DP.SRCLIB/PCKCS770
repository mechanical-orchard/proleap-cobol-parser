000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    PCKCS770.                                         00020000
000300 AUTHOR.        GERMAN BANDA.                                     00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  APRIL 2004.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800******************************************************************00080000
000900*    TRANSACTION - E770   COMMAREA - RCWS289 COPYBOOK            *00090000
001000*    NOTE:  THERE IS A TRAN ID FOR EACH DC FOR THIS PROGRAM.     *00100000
001100*           CHECK PARM AVNPBT FOR VALUES FOR EACH DC.            *00110000
001200**                                                               *00120000
001300*    STARTED BY PCKCS200.                                        *00130000
001400*                                                                *00140000
001500*  PCKCS770 THIS IS A NON-TERMINALLY ATTACHED PROGRAM THAT       *00150000
001600*  POSTS THE DISTRIBUTION SUMMARY DATA FROM THE TRANSACTION      *00160000
001700*  DETAIL TABLE TO THE RECEIPT ITEM DISTRIBUTION TABLE.          *00170000
001800*  IT SETS THE RECEIPT ITEM TO A VERIFIED STATUS AND IF INDICATED*00180000
001900*  SETS THE RECEIVER TO A VERIFIED STATUS.                       *00190000
002000*                                                                *00200000
002100*  THIS PROGRAM PROCESSES ALL NON PACK-BY-STORE RECEIVERS.       *00210000
002200*                                                                *00220000
002300* OUTPUT FILES:                                                  *00230000
002400*                                                                *00240000
002500* TABLES:  TDISTHD  -  TRANSACTION HEADER TABLE                  *00250000
002600*          TDISTDT  -  TRANSACTION STORE DETAIL                  *00260000
002700*          TRECDIS  -  RECEIPT ITEM DISTRIBUTION TABLE           *00270000
002800*          TRECITM  -  RECEIPT ITEM TABLE                        *00280000
002900*          TRECEIV  -  RECEIVER TABLE                            *00290000
003000*          TPURCHS  -  PURCHASE ORDER TABLE                      *00300000
003100*          TPURITM  -  PURCHASE ORDER ITEM TABLE                 *00310000
003200*         RCT00009  -  ODD UNIT TABLE                            *00320000
003300*         POT00006  -  POT_RMS_RLOUT_CTL                         *00330000
003400*                                                                *00340000
003500******************************************************************00350000
003600*                                                                 00360000
003700 ENVIRONMENT DIVISION.                                            00370000
003800*                                                                 00380000
003900 CONFIGURATION SECTION.                                           00390000
004000*                                                                 00400000
004100 SOURCE-COMPUTER.        IBM-3090.                                00410000
004200 OBJECT-COMPUTER.        IBM-3090.                                00420000
004300*                                                                 00430000
004400******************************************************************00440000
004500 DATA DIVISION.                                                   00450000
004600******************************************************************00460000
004700*                                                                 00470000
004800******************************************************************00480000
004900 WORKING-STORAGE SECTION.                                         00490000
005000******************************************************************00500000
005100                                                                  00510000
005200 01  DK-DB2-KEYS.                                                 00520000
005300     05  DK-ORD-NBR              PIC S9(9) VALUE ZERO COMP SYNC.  00530000
005400     05  DK-REC-SEQ-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00540000
005500     05  DK-ORD-LNE-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00550000
005600     05  DK-PREPK-PO-NBR         PIC S9(9) VALUE ZERO COMP SYNC.  00560000
005700     05  DK-PREPK-REC-SEQ-NBR    PIC S9(9) VALUE ZERO COMP SYNC.  00570000
005800     05  DK-PREPK-LINE-NBR       PIC S9(9) VALUE ZERO COMP SYNC.  00580000
005900     05  DK-PREPK-LINE-NBR-2     PIC S9(9) VALUE ZERO COMP SYNC.  00590000
006000     05  DK-PREPK-ID             PIC S9(4) VALUE ZERO COMP SYNC.  00600000
006100     05  DK-PREPK-ID-HOLD        PIC S9(4) VALUE ZERO COMP SYNC.  00610000
006200                                                                  00620000
006300******************************************************************00630000
006400* PS PROGRAM SWITCHES                                            *00640000
006500******************************************************************00650000
006600 01  PS-PROGRAM-SWITCHES.                                         00660000
006700     05  PS-PROCESSING-CURSOR-SW        PIC  X(01)  VALUE 'N'.    00670000
006800         88  PS-PROCESSING-CURSOR                   VALUE 'Y'.    00680000
006900         88  PS-NOT-PROCESSING-CURSOR               VALUE 'N'.    00690000
007000     05  PS-AUTO-VE-SW                  PIC  X(01)  VALUE 'Y'.    00700000
007100         88  PS-AUTO-VE-YES                         VALUE 'Y'.    00710000
007200         88  PS-AUTO-VE-NO                          VALUE 'N'.    00720000
007300     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00730000
007400         88  PS-NO-ERROR                            VALUE 'Y'.    00740000
007500         88  PS-ERROR                               VALUE 'N'.    00750000
007600     05  PS-DATA-OK-SW                  PIC  X(01)  VALUE 'Y'.    00760000
007700         88  PS-DATA-OK                             VALUE 'Y'.    00770000
007800         88  PS-DATA-NOT-OK                         VALUE 'N'.    00780000
007900     05  PS-ODD-UNIT-SW                 PIC  X(01)  VALUE 'Y'.    00790000
008000         88  PS-ODD-UNIT-FOUND                      VALUE 'Y'.    00800000
008100         88  PS-ODD-UNIT-NOT-FOUND                  VALUE 'N'.    00810000
008200     05  PS-POT00006-SW                 PIC  X(01)  VALUE 'Y'.    00820000
008300         88  PS-POT00006-FOUND                      VALUE 'Y'.    00830000
008400         88  PS-POT00006-NOT-FOUND                  VALUE 'N'.    00840000
008500     05  PS-UPDATE-SW                   PIC  X(01)   VALUE 'N'.   00850000
008600         88  PS-NO-UPDATES-DONE                      VALUE 'N'.   00860000
008700         88  PS-UPDATES-DONE                         VALUE 'Y'.   00870000
008800     05  PS-DATA-ON-TDISTDT-SW           PIC X(01)   VALUE 'Y'.   00880000
008900         88  PS-DATA-LEFT-ON-TDISTDT                 VALUE 'Y'.   00890000
009000         88  PS-NO-DATA-LEFT-ON-TDISTDT              VALUE 'N'.   00900000
009100     05  PS-DATA-ON-TDISTHD-SW           PIC X(01)   VALUE 'Y'.   00910000
009200         88  PS-DATA-LEFT-ON-TDISTHD                 VALUE 'Y'.   00920000
009300         88  PS-NO-DATA-LEFT-ON-TDISTHD              VALUE 'N'.   00930000
009400     05  PS-DATA-LEFT-TO-PROCESS-IND     PIC X(01)   VALUE 'Y'.   00940000
009500         88  PS-DATA-LEFT-TO-PROCESS                 VALUE 'Y'.   00950000
009600         88  PS-NO-DATA-LEFT-TO-PROCESS              VALUE 'N'.   00960000
009700     05  PS-TRANSACTION-HEADER-SWITCH    PIC X(01)   VALUE 'Y'.   00970000
009800         88  PS-NO-R-RECORD                          VALUE 'N'.   00980000
009900         88  PS-HEADER-RECORD-OK                     VALUE 'Y'.   00990000
010000     05  PS-PREPK-LINES-LEFT-SW          PIC  X(01)  VALUE 'N'.   01000000
010100         88  PS-PREPK-LINES-LEFT                     VALUE 'N'.   01010000
010200         88  PS-NO-PREPK-LINES-LEFT                  VALUE 'Y'.   01020000
010300     05  PS-PROCESS-QTY-GRTR-ZERO-SW     PIC  X(01)  VALUE 'N'.   01030000
010400         88  PS-PROCESS-QTY-GRTR-ZERO                VALUE 'Y'.   01040000
010500******************************************************************01050000
010600* COMMAREA PASSED TO THE PROGRAM FROM PCKS107 AND RCKCS291       *01060000
010700******************************************************************01070000
010800                                                                  01080000
010900     COPY RCWS289.                                                01090000
011000                                                                  01100000
011100***************************************************************** 01110000
011200*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 01120000
011300*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 01130000
011400***************************************************************** 01140000
011500     COPY RCWS040.                                                01150000
011600                                                                  01160000
011700***************************************************************** 01170000
011800*   RCWS074 - COPYBOOK IS USED FOR THE MODULE TO CALCULATE UNIT * 01180000
011900*             QUANTITIES AND CARTON COUNTS (RCKUT128)          .* 01190000
012000***************************************************************** 01200000
012100     COPY RCWS074.                                                01210000
012200                                                                  01220000
012300***************************************************************** 01230000
012400*   RCWS071 - COPYBOOK IS USED FOR THE MODULE TO TRACK DC ASSOC * 01240000
012500*             FUNCTIONS                                        .* 01250000
012600***************************************************************** 01260000
012700     COPY RCWS071.                                                01270000
012800                                                                  01280000
012900*---------------------------------------------------------------* 01290000
013000*  RECORD LAYOUTS FOR THE FREE ASTRAY HANDLER MODULE              01300000
013100*---------------------------------------------------------------* 01310000
013200     COPY SUWS044.                                                01320000
013300                                                                  01330000
013400******************************************************************01340000
013500* PV PROGRAM VARIABLES                                           *01350000
013600******************************************************************01360000
013700 01  PV-PROGRAM-VARIABLES.                                        01370000
013800     05  PV-RETRY-COUNTER                PIC S9(4) VALUE ZERO     01380000
013900                                                    COMP SYNC.    01390000
014000     05  PV-AUDIT-RTN-LENGTH             PIC S9(04) VALUE ZERO    01400000
014100                                                    COMP SYNC.    01410000
014200     05  PV-PRT-LST-TRANID               PIC  X(04)  VALUE '    '.01420000
014300     05  PV-PRT-ERROR-TRANID             PIC  X(04)  VALUE '    '.01430000
014400     05  PV-CURRENT-TMST                 PIC X(26).               01440000
014500     05  PV-CURR-DATE                    PIC  X(10)  VALUE ZEROS. 01450000
014600     05  PV-CURRENT-DATE                 PIC  X(10)  VALUE ZEROS. 01460000
014700     05  FILLER   REDEFINES PV-CURRENT-DATE.                      01470000
014800         10  PV-CURRENT-CC               PIC  X(02).              01480000
014900         10  PV-CURRENT-YY               PIC  X(02).              01490000
015000         10  FILLER                      PIC  X(01).              01500000
015100         10  PV-CURRENT-MM               PIC  X(02).              01510000
015200         10  FILLER                      PIC  X(01).              01520000
015300         10  PV-CURRENT-DD               PIC  X(02).              01530000
015400     05  PV-HOLD-CURR-DATE.                                       01540000
015500         10  PV-HOLD-CURR-CC             PIC  9(02).              01550000
015600         10  PV-HOLD-CURR-YY             PIC  9(02).              01560000
015700         10  PV-HOLD-CURR-MM             PIC  9(02).              01570000
015800         10  PV-HOLD-CURR-DD             PIC  9(02).              01580000
015900     05  PV-HOLD-CUTOFF-DATE.                                     01590000
016000         10  PV-HOLD-CUTOFF-CC           PIC  9(02).              01600000
016100         10  PV-HOLD-CUTOFF-YY           PIC  9(02).              01610000
016200         10  PV-HOLD-CUTOFF-MM           PIC  9(02).              01620000
016300         10  PV-HOLD-CUTOFF-DD           PIC  9(02).              01630000
016400     05  PV-WORK-DATE                    PIC  X(10)  VALUE ZEROS. 01640000
016500     05  FILLER    REDEFINES PV-WORK-DATE.                        01650000
016600         10  PV-WORK-CC                  PIC  X(02).              01660000
016700         10  PV-WORK-YY                  PIC  X(02).              01670000
016800         10  FILLER                      PIC  X(01).              01680000
016900         10  PV-WORK-MM                  PIC  X(02).              01690000
017000         10  FILLER                      PIC  X(01).              01700000
017100         10  PV-WORK-DD                  PIC  X(02).              01710000
017200     05  PV-HOLD-WORK-DATE.                                       01720000
017300         10  PV-HOLD-WORK-CC             PIC  9(02).              01730000
017400         10  PV-HOLD-WORK-YY             PIC  9(02).              01740000
017500         10  PV-HOLD-WORK-MM             PIC  9(02).              01750000
017600         10  PV-HOLD-WORK-DD             PIC  9(02).              01760000
017700     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01770000
017800                                                     COMP SYNC.   01780000
017900     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +12    01790000
018000                                                     COMP SYNC.   01800000
018100     05  PV-WRK-ORD-SEQ-NBR              PIC  S9(4)  COMP         01810000
018200                                                     VALUE ZEROS. 01820000
018300     05  PV-FCLTY-ID                     PIC  S9(4)  COMP         01830000
018400                                                     VALUE +1.    01840000
018500     05  PV-CLENG                        PIC   9(4)  COMP         01850000
018600                                                     VALUE ZEROS. 01860000
018700     05  PV-TOTAL-ALLOC-QTY              PIC  S9(9)  COMP         01870000
018800                                                     VALUE ZEROS. 01880000
018900     05  PV-FCSE-ACTL-ALLOC-QTY          PIC  S9(9)  COMP         01890000
019000                                                     VALUE ZEROS. 01900000
019100     05  PV-TOTAL-ALLOC-QTY-ALL          PIC  S9(9)  COMP         01910000
019200                                                     VALUE ZEROS. 01920000
019300     05  PV-TASK-X.                                               01930000
019400         10  PV-TASK                     PIC   9(7)  VALUE ZERO.  01940000
019500     05  PV-TRANID-X.                                             01950000
019600         10  PV-TRANID                   PIC   9(7)  VALUE ZERO.  01960000
019700     05  PV-STATUS-CDE                   PIC   X(02)              01970000
019800                                                     VALUE SPACES.01980000
019900     05  PV-AUDIT-STATUS-CDE             PIC   X(02)              01990000
020000                                                     VALUE SPACES.02000000
020100     05  PV-COUNT-STATUS-CDE             PIC   X(02)              02010000
020200                                                     VALUE SPACES.02020000
020300     05  PV-RCPT-DISTR-UPD-CDE           PIC   X(01)              02030000
020400                                                     VALUE SPACES.02040000
020500     05  PV-VRFD-USR-ID                  PIC   X(08)              02050000
020600                                                     VALUE SPACES.02060000
020700     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACES.02070000
020800     05  PV-CICS-MSG-AREA                PIC  X(95)  VALUE SPACE. 02080000
020900                                                                  02090000
021000     05  PV-ODD-UNT-QTY-DISPLAY          PIC  9(08)  VALUE ZEROES.02100000
021100     05  PV-ORD-NBR-DISPLAY              PIC  9(08)  VALUE ZEROES.02110000
021200     05  PV-REC-SEQ-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.02120000
021300     05  PV-ORD-LNE-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.02130000
021400     05  PV-OPER-UNT-ID-DISPLAY          PIC  9(04)  VALUE ZEROES.02140000
021500     05  PV-STORE-NBR-DISPLAY            PIC  9(04)  VALUE ZEROES.02150000
021600     05  PV-FCLTY-ID-DISPLAY             PIC  9(04)  VALUE ZEROES.02160000
021700     05  PV-ID-NBR-DISPLAY               PIC  X(04)  VALUE SPACES.02170000
021800     05  PV-RECITM-PREPK-DISPLAY         PIC  9(04)  VALUE ZEROES.02180000
021900     05  PV-DEPT-NBR-PIC9                PIC  9(03)  VALUE ZEROES.02190000
022000                                                                  02200000
022100     05  PV-NULL-IND                     PIC S9(04)  VALUE +0     02210000
022200                                                     COMP SYNC.   02220000
022300     05  PV-ERROR-ORD-NBR                PIC  9(08)  VALUE ZEROS. 02230000
022400     05  PV-ERROR-RCVR-SEQ-NBR           PIC  9(04)  VALUE ZEROS. 02240000
022500     05  PV-ERROR-ORD-LNE-NBR            PIC  9(04)  VALUE ZEROS. 02250000
022600     05  PV-ERROR-STR-NBR                PIC  9(04)  VALUE ZEROS. 02260000
022700     05  PV-ERROR-OPER-UNT-ID            PIC  9(04)  VALUE ZEROS. 02270000
022800     05  PV-ERROR-STATUS                 PIC  X(01)  VALUE SPACE. 02280000
022900     05  PV-ERROR-SOURCE                 PIC  X(02)  VALUE SPACE. 02290000
023000                                                                  02300000
023100     05  PV-PREPK-DRV-LNE-CDE            PIC X.                   02310000
023200     05  PV-PRPK-REC-ORD-LNE-NBR         PIC S9(9)   COMP.        02320000
023300     05  PV-PRPK-REC-PREPK-RATO-QTY      PIC S9(4)   COMP.        02330000
023400     05  PV-PRPK-ACTL-ALLOC-QTY-SNGL     PIC  9(06)  VALUE ZEROS. 02340000
023500     05  PV-PRPK-ACTL-ALLOC-QTY-RATO     PIC S9(09)  VALUE ZEROS. 02350000
023600     05  PV-PRPK-ACTL-ALLOC-QTY-REM      PIC S9(09)  VALUE ZEROS. 02360000
023700     05  PV-DEPT-NBR-COMP-3            PIC S9(03) VALUE 0 COMP-3. 02370000
023800                                                                  02380000
023900 01  PV-DRVR-LNE-VARIABLES.                                       02390000
024000     05  PV-DL-WRKD-TMST                PIC  X(26).               02400000
024100     05  PV-DL-WRKD-OPER-UNT-ID         PIC S9(04)    COMP.       02410000
024200     05  PV-DL-PO-NBR                   PIC S9(9)     COMP.       02420000
024300     05  PV-DL-RCVR-SEQ-NBR             PIC S9(9)     COMP.       02430000
024400     05  PV-DL-PO-LNE-NBR               PIC S9(9)     COMP.       02440000
024500     05  PV-DL-WRKD-UNT-QTY             PIC S9(9)     COMP.       02450000
024600     05  PV-DL-WRKD-CART-QTY            PIC S9(9)     COMP.       02460000
024700     05  PV-DL-UNT-RETAIL-PRC           PIC S9(7)V99  COMP.       02470000
024800     05  PV-DL-PRCG-AREA-CDE            PIC  X(6).                02480000
024900     05  PV-DL-TRANS-TYPE-CDE           PIC  X(1).                02490000
025000     05  PV-DL-VERIFY-TYPE-CDE          PIC  X(1).                02500000
025100                                                                  02510000
025200 01  ST-SYSTEM-TIME-AREA.                                         02520000
025300     05  ST-ABSTIME                      PIC S9(16)  VALUE +0     02530000
025400                                                     COMP SYNC.   02540000
025500     05  ST-TIME-EDIT.                                            02550000
025600         10  ST-TIME-HHMM                PIC  X(05)  VALUE SPACE. 02560000
025700         10  FILLER                      PIC  X(03)  VALUE SPACE. 02570000
025800                                                                  02580000
025900******************************************************************02590000
026000* PC PROGRAM CONSTANTS                                           *02600000
026100******************************************************************02610000
026200 01  PC-PROGRAM-CONSTANTS.                                        02620000
026300     05  PC-FA-HANDLER-PGM          PIC  X(08)  VALUE 'SUKUT705'. 02630000
026400     05  PC-ZERO                      PIC S9(09) VALUE ZERO       02640000
026500                                                    COMP.         02650000
026600     05  PV-DB2-COUNT                 PIC S9(9)  VALUE +0         02660000
026700                                                    COMP-3.       02670000
026800     05  PV-COUNT-DISPLAY             PIC  9(9)  VALUE ZERO.      02680000
026900     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +1        02690000
027000                                                    COMP.         02700000
027100     05  PC-ROW-ALREADY-PRESENT       PIC S9(04) VALUE -803       02710000
027200                                                    COMP SYNC.    02720000
027300     05  PC-SQL-904                   PIC S9(04) VALUE -904       02730000
027400                                                    COMP SYNC.    02740000
027500     05  PC-AP                        PIC  X(02) VALUE 'AP'.      02750000
027600     05  PC-IP                        PIC  X(02) VALUE 'IP'.      02760000
027700     05  PC-VE                        PIC  X(02) VALUE 'VE'.      02770000
027800     05  PC-CM                        PIC  X(02) VALUE 'CM'.      02780000
027900     05  PC-CB                        PIC  X(02) VALUE 'CB'.      02790000
028000     05  PC-P2L                       PIC  X(03) VALUE 'P2L'.     02800000
028100     05  PC-CASE                      PIC  X(04) VALUE 'CASE'.    02810000
028200     05  PC-CONFIRM                   PIC  X(08) VALUE            02820000
028300                                            'MAN CNFM'.           02830000
028400     05  PC-P2L-CASE                  PIC  X(08) VALUE            02840000
028500                                            'P2L/CASE'.           02850000
028600     05  PC-CHECK-IN                  PIC  X(08) VALUE            02860000
028700                                            'CHECK IN'.           02870000
028800     05  PC-TRLRUNLD                  PIC  X(08) VALUE            02880000
028900                                            'TRLRUNLD'.           02890000
029000     05  PC-WO-HOTCM                  PIC  X(08) VALUE            02900000
029100                                            'WO HOTCM'.           02910000
029200     05  PC-SWEEPER                   PIC  X(08) VALUE            02920000
029300                                            'SWEEPER '.           02930000
029400     05  PC-I                         PIC  X(01) VALUE 'I'.       02940000
029500     05  PC-CA                        PIC  X(02) VALUE 'CA'.      02950000
029600     05  PC-AC                        PIC  X(02) VALUE 'AC'.      02960000
029700     05  PC-P2                        PIC  X(02) VALUE 'P2'.      02970000
029800     05  PC-CP                        PIC  X(02) VALUE 'CP'.      02980000
029900     05  PC-A                         PIC  X     VALUE 'A'.       02990000
030000     05  PC-V                         PIC  X(01) VALUE 'V'.       03000000
030100     05  PC-W                         PIC  X(01) VALUE 'W'.       03010000
030200     05  PC-ERROR-STATUS              PIC  X(01) VALUE 'E'.       03020000
030300     05  PC-NO-PRO-STATUS             PIC  X(01) VALUE 'F'.       03030000
030400     05  PC-READY-TO-VERIFY           PIC  X(01) VALUE 'R'.       03040000
030500     05  PC-POSTED-STATUS             PIC  X(01) VALUE 'P'.       03050000
030600     05  PC-DPKUT038                  PIC  X(08) VALUE            03060000
030700         'DPKUT038'.                                              03070000
030800     05  PC-AUDIT-RTN                 PIC  X(08) VALUE 'RCKCS290'.03080000
030900     05  PC-CURRENT-JOB-NAME          PIC  X(04) VALUE            03090000
031000         'CICS'.                                                  03100000
031100     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE 'PCKCS770'.03110000
031200     05  PC-UNTS-WRKD-PGRM-NAME       PIC  X(08) VALUE 'PCKCS756'.03120000
031300     05  PC-UNAVAILABLE-RESOURCES     PIC S9(04)  VALUE -904.     03130000
031400     05  PC-DEADLOCK                  PIC S9(04)  VALUE -913.     03140000
031500     05  PC-ROW-NOT-FOUND             PIC S9(04)  VALUE +100.     03150000
031600     05  PC-CURRENT-OPERATING-COMPANY PIC  X(02)  VALUE '03'.     03160000
031700     05  PC-SYSTEM-CODE               PIC  X(02)  VALUE 'PC'.     03170000
031800     05  PC-DISPLAY-PO                PIC  9(8)   VALUE ZEROS.    03180000
031900     05  PC-DISPLAY-RCVR              PIC  9(8)   VALUE ZEROS.    03190000
032000     05  PC-DISPLAY-LINE              PIC  9(8)   VALUE ZEROS.    03200000
032100     05  PC-DISPLAY-OPER              PIC  9(4)   VALUE ZEROS.    03210000
032200     05  PC-DISPLAY-SQL-CODE          PIC  9999-  VALUE ZEROS.    03220000
032300     05  PC-DISPLAY-CICS-RESP         PIC  999999999-             03230000
032400                                                  VALUE ZEROS.    03240000
032500*                                                                 03250000
032600*  LAYOUT FOR THE DATE ROUTINE DPKUT500                           03260000
032700*                                                                 03270000
032800     COPY DPWS500.                                                03280000
032900     EJECT                                                        03290000
033000*                                                                 03300000
033100*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       03310000
033200     COPY DPWS013.                                                03320000
033300     EJECT                                                        03330000
033400*                                                                 03340000
033500*  AUDIT MODULE LAYOUT                                            03350000
033600     COPY RCWS031.                                                03360000
033700                                                                  03370000
033800* COPY BOOK FOR CALLED MODULE PCKCS756                            03380000
033900     COPY PCWS238.                                                03390000
034000/                                                                 03400000
034100     EXEC SQL                                                     03410000
034200          INCLUDE TKRPRPM                                         03420000
034300     END-EXEC.                                                    03430000
034400                                                                  03440000
034500*---------------------------------------------------------------* 03450000
034600*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 03460000
034700*---------------------------------------------------------------* 03470000
034800     EXEC SQL                                                     03480000
034900          INCLUDE TRECEIV                                         03490000
035000     END-EXEC.                                                    03500000
035100     EJECT                                                        03510000
035200*---------------------------------------------------------------* 03520000
035300*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 03530000
035400*---------------------------------------------------------------* 03540000
035500     EXEC SQL                                                     03550000
035600          INCLUDE TRECITM                                         03560000
035700     END-EXEC.                                                    03570000
035800     EJECT                                                        03580000
035900*---------------------------------------------------------------* 03590000
036000*    DB2 AREA FOR RECEIPT DISTRIBUTION TABLE                    * 03600000
036100*---------------------------------------------------------------* 03610000
036200     EXEC SQL                                                     03620000
036300          INCLUDE TRECDIS                                         03630000
036400     END-EXEC.                                                    03640000
036500     EJECT                                                        03650000
036600*---------------------------------------------------------------* 03660000
036700*    DB2 AREA FOR RECEIPT VERIFICATION SOURCE TABLE             * 03670000
036800*---------------------------------------------------------------* 03680000
036900     EXEC SQL                                                     03690000
037000          INCLUDE TRECDVS                                         03700000
037100     END-EXEC.                                                    03710000
037200     EJECT                                                        03720000
037300*---------------------------------------------------------------* 03730000
037400*    DB2 AREA FOR THE TRANSACTION HEADER TABLE                  * 03740000
037500*---------------------------------------------------------------* 03750000
037600      EXEC SQL                                                    03760000
037700          INCLUDE TDISTHD                                         03770000
037800      END-EXEC.                                                   03780000
037900 EJECT                                                            03790000
038000*                                                                 03800000
038100*---------------------------------------------------------------* 03810000
038200*    DB2 AREA FOR THE TRANSACTION DETAIL TABLE                  * 03820000
038300*---------------------------------------------------------------* 03830000
038400      EXEC SQL                                                    03840000
038500          INCLUDE TDISTDT                                         03850000
038600      END-EXEC.                                                   03860000
038700     EJECT                                                        03870000
038800*---------------------------------------------------------------* 03880000
038900*    DB2 AREA FOR THE PURCHASE ORDER HEADER TABLE               * 03890000
039000*---------------------------------------------------------------* 03900000
039100     EXEC SQL                                                     03910000
039200          INCLUDE TPURCHS                                         03920000
039300     END-EXEC.                                                    03930000
039400                                                                  03940000
039500 EJECT                                                            03950000
039600*---------------------------------------------------------------* 03960000
039700*    DB2 AREA FOR THE PURCHASE ORDER LINE TABLE                 * 03970000
039800*---------------------------------------------------------------* 03980000
039900     EXEC SQL                                                     03990000
040000          INCLUDE TPURITM                                         04000000
040100     END-EXEC.                                                    04010000
040200                                                                  04020000
040300 EJECT                                                            04030000
040400*---------------------------------------------------------------* 04040000
040500*    DB2 AREA FOR THE ODD UNIT TABLE                            * 04050000
040600*---------------------------------------------------------------* 04060000
040700     EXEC SQL                                                     04070000
040800          INCLUDE RCT00009                                        04080000
040900     END-EXEC.                                                    04090000
041000                                                                  04100000
041100*---------------------------------------------------------------* 04110000
041200*    DB2 AREA FOR THE POT_RMS_RLOUT_CTL                         * 04120000
041300*---------------------------------------------------------------* 04130000
041400     EXEC SQL                                                     04140000
041500          INCLUDE POT00006                                        04150000
041600     END-EXEC.                                                    04160000
041700                                                                  04170000
041800*                                                                 04180000
041900*   DB2 COMMUNICATIONS AREA                                       04190000
042000*                                                                 04200000
042100      EXEC SQL                                                    04210000
042200          INCLUDE SQLCA                                           04220000
042300      END-EXEC.                                                   04230000
042400*                                                                 04240000
042500*   DB2 COMMUNICATIONS AREA2                                      04250000
042600*                                                                 04260000
042700     COPY SQLCA2.                                                 04270000
042800 EJECT                                                            04280000
042900                                                                  04290000
043000***************************************************************** 04300000
043100*    TRANSACTION DETAIL CURSOR                                    04310000
043200***************************************************************** 04320000
043300     EXEC SQL                                                     04330000
043400          DECLARE DISTDT-CURSOR CURSOR WITH HOLD FOR              04340000
043500           SELECT                                                 04350000
043600                 ORD_NBR                                          04360000
043700                ,RCVR_SEQ_NBR                                     04370000
043800                ,ORD_LNE_NBR                                      04380000
043900                ,WRK_ORD_SEQ_NBR                                  04390000
044000                ,STR_NBR                                          04400000
044100                ,EXPTED_ALLOC_QTY                                 04410000
044200                ,ACTL_ALLOC_QTY                                   04420000
044300                ,RCVG_PSTD_STAT_CDE                               04430000
044400                ,FCSE_ACTL_UNT_QTY                                04440000
044500                ,P2L_SPLT_UNT_QTY                                 04450000
044600                ,FCSE_SPLT_UNT_QTY                                04460000
044700                ,INPK_SPLT_UNT_QTY                                04470000
044800                ,PREPK_ODD_UNT_QTY                                04480000
044900             FROM                                                 04490000
045000                  TDISTDT                                         04500000
045100             WHERE                                                04510000
045200                   ORD_NBR       = :DK-ORD-NBR                    04520000
045300             AND RCVR_SEQ_NBR    = :DK-REC-SEQ-NBR                04530000
045400             AND ORD_LNE_NBR     = :DK-ORD-LNE-NBR                04540000
045500             AND WRK_ORD_SEQ_NBR = :PV-WRK-ORD-SEQ-NBR            04550000
045600             AND RCVG_PSTD_STAT_CDE  ^= :PC-POSTED-STATUS         04560000
045700     END-EXEC.                                                    04570000
045800                                                                  04580000
045900*---------------------------------------------------------------* 04590000
046000* PREPACK CURSOR FOR LINES FOR A SPECIFIC PULL THAT WERE NOT    * 04600000
046100* USED AS THE DRIVER/PROCESS LINE                               * 04610000
046200*---------------------------------------------------------------* 04620000
046300     EXEC SQL                                                     04630000
046400          DECLARE PRE_PACK_LNE_CSR CURSOR WITH HOLD FOR           04640001
046500              SELECT ORD_LNE_NBR                                  04650000
046600                    ,PREPK_RATO_QTY                               04660000
046700                    ,CASE PREPK_DRV_LNE_CDE                       04670000
046800                          WHEN 'A'  THEN 'A'                      04680000
046900                          ELSE  ' '                               04690000
047000                     END                                          04700000
047100                    ,STATUS_CDE                                   04710000
047200                    ,VERFYD_TMST                                  04720000
047300                    ,VRFD_USR_ID                                  04730000
047400                FROM TRECITM                                      04740000
047500               WHERE ORD_NBR           = :DK-PREPK-PO-NBR         04750000
047600                 AND REC_SEQ_NBR       = :DK-PREPK-REC-SEQ-NBR    04760000
047700                 AND PREPK_ID          = :DK-PREPK-ID             04770000
047800                 AND ORD_LNE_NBR      <> :DK-PREPK-LINE-NBR       04780000
047900                 AND VER_STATUS_CDE    = 'A'                      04790000
048000          FOR UPDATE OF                                           04800000
048100                     STATUS_CDE                                   04810000
048200                    ,VERFYD_TMST                                  04820000
048300                    ,VRFD_USR_ID                                  04830000
048400     END-EXEC.                                                    04840000
048500                                                                  04850000
048600                                                                  04860000
048700 EJECT                                                            04870000
048800 LINKAGE SECTION.                                                 04880000
048900                                                                  04890000
049000     EJECT                                                        04900000
049100                                                                  04910000
049200******************************************************************04920000
049300 PROCEDURE DIVISION.                                              04930000
049400******************************************************************04940000
049500*                                                                 04950000
049600******************************************************************04960000
049700* A100-MAIN-MODULE  - HIGHEST LEVEL CONTROL ROUTINE.             *04970000
049800******************************************************************04980000
049900 A100-MAIN-MODULE.                                                04990000
050000                                                                  05000000
050100     EXEC SQL                                                     05010000
050200         SET :PV-CURR-DATE = CURRENT_DATE                         05020000
050300     END-EXEC.                                                    05030000
050400                                                                  05040000
050500     EXEC SQL                                                     05050000
050600         SET :PV-CURRENT-TMST =  CURRENT_TIMESTAMP                05060000
050700     END-EXEC.                                                    05070000
050800                                                                  05080000
050900     MOVE PV-CURR-DATE     TO PV-CURRENT-DATE.                    05090000
051000     MOVE PV-CURRENT-CC    TO PV-HOLD-CURR-CC.                    05100000
051100     MOVE PV-CURRENT-YY    TO PV-HOLD-CURR-YY.                    05110000
051200     MOVE PV-CURRENT-MM    TO PV-HOLD-CURR-MM.                    05120000
051300     MOVE PV-CURRENT-DD    TO PV-HOLD-CURR-DD.                    05130000
051400                                                                  05140000
051500                                                                  05150000
051600                                                                  05160000
051700     MOVE LENGTH RC289-COMMAREA-FOR-E200 TO                       05170000
051800                                     PV-COMMAREA-LENGTH.          05180000
051900                                                                  05190000
052000     EXEC CICS                                                    05200000
052100         RETRIEVE                                                 05210000
052200         INTO(RC289-COMMAREA-FOR-E200)                            05220000
052300         LENGTH(PV-COMMAREA-LENGTH)                               05230000
052400         RESP(PV-CICS-RESPONSE)                                   05240000
052500     END-EXEC.                                                    05250000
052600                                                                  05260000
052700     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        05270000
052800         MOVE RC289-ORD-NBR        TO DK-ORD-NBR                  05280000
052900                                      PC238-PO-NBR                05290000
053000                                      PV-ORD-NBR-DISPLAY          05300000
053100         MOVE RC289-RCVR-SEQ-NBR   TO DK-REC-SEQ-NBR              05310000
053200                                      PC238-RCVR-SEQ-NBR          05320000
053300                                      PV-REC-SEQ-NBR-DISPLAY      05330000
053400         MOVE RC289-ORD-LNE-NBR    TO DK-ORD-LNE-NBR              05340000
053500                                      PC238-PO-LNE-NBR            05350000
053600                                      PV-ORD-LNE-NBR-DISPLAY      05360000
053700         MOVE EIBTASKN               TO PV-TASK                   05370000
053800         PERFORM 9300-CHECK-LOGGING                               05380000
053900         STRING ' PCKCS770 STARTED - TASK = ' PV-TASK-X           05390000
054000                'PO-REVC-LNE = '                                  05400000
054100                PV-ORD-NBR-DISPLAY                                05410000
054200                ' - '                                             05420000
054300                PV-REC-SEQ-NBR-DISPLAY                            05430000
054400                ' - '                                             05440000
054500                PV-ORD-LNE-NBR-DISPLAY                            05450000
054600                ' - '                                             05460000
054700                PV-CURRENT-TMST                                   05470000
054800             DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              05480000
054900         PERFORM 9995-WRITE-CICS-FOR-DEBUG                        05490000
055000         PERFORM 9990-WRITE-CICS                                  05500000
055100                                                                  05510000
055200         PERFORM B400-SELECT-DISTHD                               05520000
055210         IF  DISTHD-PREPK-LNE-PRC-CDE   = 'P'                     05521000
055211           MOVE DISTHD-OPER-UNT-ID                                05521100
055212                               TO PV-OPER-UNT-ID-DISPLAY          05521200
055213           SET PS-DATA-NOT-OK   TO TRUE                           05521300
055220           STRING ' PCKCS770 DISTHD PRC-CDE = P '                 05521400
055240                  PV-OPER-UNT-ID-DISPLAY                          05521500
055250                  '-'                                             05521600
055260                  PV-ORD-NBR-DISPLAY                              05521700
055270                  '-'                                             05521800
055280                  PV-REC-SEQ-NBR-DISPLAY                          05521900
055290                  '-'                                             05522000
055291                  PV-ORD-LNE-NBR-DISPLAY                          05523000
055292                  '-'                                             05524000
055293                  RC289-CALLING-PROGRAM                           05525000
055294                  '-'                                             05526000
055295                  RC289-PACKAGE-TYPE-CDE                          05527000
055296                  '-'                                             05528000
055297                  RC289-DISTHD-PROC-TYPE                          05529000
055298                  '-'                                             05529100
055299                  RC289-DC-FUNCTION-CODE                          05529200
055300                                      DELIMITED BY SIZE           05529300
055301                         INTO PV-CICS-MSG-AREA                    05529400
055302           PERFORM 9990-WRITE-CICS                                05529500
055303         ELSE                                                     05529600
055310           PERFORM E100-SELECT-TRECITM                            05529700
055400           IF PS-HEADER-RECORD-OK                                 05529800
055500               PERFORM B450-GET-TRECEIV-OPER-UNT-ID               05529900
055600               IF PS-DATA-OK                                      05530000
055700                   PERFORM B475-CHECK-AUTOVRFD                    05540000
055800                   PERFORM B500-OPEN-CURSOR-TDISTDT               05550000
055900                   PERFORM B600-PROCESS-TDISTDT-RECORDS           05560000
056000                       UNTIL ((PS-NO-DATA-LEFT-ON-TDISTDT) OR     05570000
056100                              (PS-DATA-NOT-OK))                   05580000
056200                   PERFORM B550-CLOSE-CURSOR-TDISTDT              05590000
056300                   MOVE RECEIV-CURR-OPER-UNT-ID TO                05600000
056400                                           PC238-WRKD-OPER-UNT-ID 05610000
056500                   MOVE PV-TOTAL-ALLOC-QTY-ALL TO                 05620000
056600                                           PC238-WRKD-UNT-QTY     05630000
056700                   MOVE PC-V TO PC238-TRANS-TYPE-CDE              05640000
056800                   INITIALIZE PV-TOTAL-ALLOC-QTY-ALL              05650000
056900                   EXEC SQL                                       05660000
057000                       SELECT                                     05670000
057100                             P2L_CART_CNT                         05680000
057200                            ,FCSE_FCLTY_AREA_ID                   05690000
057300                       INTO                                       05700000
057400                            :DISTHD-P2L-CART-CNT                  05710000
057500                           ,:DISTHD-FCSE-FCLTY-AREA-ID            05720000
057600                       FROM  TDISTHD                              05730000
057700                      WHERE ORD_NBR         = :DK-ORD-NBR         05740000
057800                        AND RCVR_SEQ_NBR    = :DK-REC-SEQ-NBR     05750000
057900                        AND ORD_LNE_NBR     = :DK-ORD-LNE-NBR     05760000
058000                   END-EXEC                                       05770000
058100                   EVALUATE TRUE                                  05780000
058200                       WHEN SQLCODE = ZERO                        05790000
058300                           IF DISTHD-P2L-CART-CNT = ZERO          05800000
058400                              MOVE DISTHD-FCSE-FCLTY-AREA-ID TO   05810000
058500                                              PC238-PRCG-AREA-CDE 05820000
058600                           ELSE                                   05830000
058700                              MOVE SPACES  TO PC238-PRCG-AREA-CDE 05840000
058800                           END-IF                                 05850000
058900                       WHEN OTHER                                 05860000
059000                           MOVE SPACES  TO  PC238-PRCG-AREA-CDE   05870000
059100                   END-EVALUATE                                   05880000
059210                   IF  DISTHD-PREPK-LNE-PRC-CDE   = 'D'           05890000
059300                       PERFORM G450-KEEP-DRVR-LINE-INFO           05900000
059400                   ELSE                                           05910000
059500                       PERFORM G400-UPDATE-UNITS-WRKD             05920000
059600                   END-IF                                         05930000
059700               END-IF                                             05940000
059800               IF PS-DATA-OK                                      05950000
059900                   PERFORM B850-COUNT-TDISTDT-ROWS                05960000
060000                   IF PV-DB2-COUNT = 0                            05970000
060100                       PERFORM B900-UPDATE-DISTHD                 05980000
060200                   PERFORM B700-PROCESS-RECITM                    05990000
060300                   PERFORM B800-COUNT-TRECITM                     06000000
060400                   END-IF                                         06010000
060500               END-IF                                             06020000
060600               MOVE DK-ORD-NBR     TO PV-ORD-NBR-DISPLAY          06030000
060700               MOVE DK-REC-SEQ-NBR TO PV-REC-SEQ-NBR-DISPLAY      06040000
060800               MOVE DK-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY      06050000
060900               MOVE DISTHD-OPER-UNT-ID                            06060000
061000                                   TO PV-OPER-UNT-ID-DISPLAY      06070000
061100               MOVE PV-FCLTY-ID    TO PV-FCLTY-ID-DISPLAY         06080000
061200               MOVE EIBTRNID       TO PV-ID-NBR-DISPLAY           06090000
061300               IF PS-DATA-OK                                      06100000
061400                   STRING ' PCKCS770'                             06110000
061500                          '  '                                    06120000
061600                          PV-OPER-UNT-ID-DISPLAY                  06130000
061700                          '-'                                     06140000
061800                          PV-ORD-NBR-DISPLAY                      06150000
061900                          '-'                                     06160000
062000                          PV-REC-SEQ-NBR-DISPLAY                  06170000
062100                          '-'                                     06180000
062200                          PV-ORD-LNE-NBR-DISPLAY                  06190000
062300                          '  SUCCESSFUL VERIFICATION'             06200000
062400                                              DELIMITED BY SIZE   06210000
062500                                 INTO PV-CICS-MSG-AREA            06220000
062600                   PERFORM 9995-WRITE-CICS-FOR-DEBUG              06230000
062700                   PERFORM 9990-WRITE-CICS                        06240000
062800                   IF  DISTHD-PREPK-LNE-PRC-CDE   = 'D'           06250000
062900                       PERFORM A760-PROCESS-PREPK                 06260000
063000                         UNTIL PS-NO-PREPK-LINES-LEFT             06270000
063100                            OR PS-NO-R-RECORD                     06280000
063200                            OR PS-DATA-NOT-OK                     06290000
063300                   END-IF                                         06300000
063400                   IF PS-DATA-OK                                  06310000
063500                      PERFORM G600-CALL-PO-RCVR-TRKING-MOD        06320000
063600                   END-IF                                         06330000
063700               ELSE                                               06340000
063800                   PERFORM Z901-BACKUP                            06350000
063900                   MOVE PC-ERROR-STATUS   TO PV-ERROR-STATUS      06360000
064000                   PERFORM C850-UPDATE-TDISTHD-ERR-STAT           06370000
064100                   IF  DISTHD-PREPK-LNE-PRC-CDE   = 'D'           06380000
064200                       PERFORM C860-PROCESS-PREPK-ERROR           06390000
064300                         UNTIL PS-NO-PREPK-LINES-LEFT             06400000
064400                   END-IF                                         06410000
064500                   STRING ' PCKCS770'                             06420000
064600                          '  '                                    06430000
064700                          PV-OPER-UNT-ID-DISPLAY                  06440000
064800                          '-'                                     06450000
064900                          PV-ORD-NBR-DISPLAY                      06460000
065000                          '-'                                     06470000
065100                          PV-REC-SEQ-NBR-DISPLAY                  06480000
065200                          '-'                                     06490000
065300                          PV-ORD-LNE-NBR-DISPLAY                  06500000
065400                          '  UNSUCCESSFUL VERIFICATION - '        06510000
065500                          PV-ERROR-STATUS                         06520000
065600                                              DELIMITED BY SIZE   06530000
065700                                 INTO PV-CICS-MSG-AREA            06540000
065800                   PERFORM 9995-WRITE-CICS-FOR-DEBUG              06550000
065900                   PERFORM 9990-WRITE-CICS                        06560000
066000               END-IF                                             06570000
066100           END-IF                                                 06580000
066110         END-IF                                                   06590000
066200     END-IF.                                                      06600000
066300                                                                  06610000
066400     STRING ' PCKCS770 ENDED - TASK = ' PV-TASK-X                 06620000
066500            'PO-REVC-LNE = '                                      06630000
066600            PV-ORD-NBR-DISPLAY                                    06640000
066700            ' - '                                                 06650000
066800            PV-REC-SEQ-NBR-DISPLAY                                06660000
066900            ' - '                                                 06670000
067000            PV-ORD-LNE-NBR-DISPLAY                                06680000
067100            ' - '                                                 06690000
067200            PV-CURRENT-TMST                                       06700000
067300         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 06710000
067400     PERFORM 9995-WRITE-CICS-FOR-DEBUG.                           06720000
067500                                                                  06730000
067600     EXEC CICS                                                    06740000
067700         RETURN                                                   06750000
067800     END-EXEC.                                                    06760000
067900                                                                  06770000
068000     GOBACK.                                                      06780000
068100     EJECT                                                        06790000
068200*                                                                 06800000
068300*----------------------------------------------------------------*06810000
068400* IF LINE BELONGS TO A PREPACK PROCESS REST OF LINES IN THE PREPK*06820000
068500*----------------------------------------------------------------*06830000
068600 A760-PROCESS-PREPK.                                              06840000
068700     SET  PS-PREPK-LINES-LEFT     TO TRUE.                        06850000
068800                                                                  06860000
068900     MOVE DK-ORD-NBR              TO  DK-PREPK-PO-NBR.            06870000
069000     MOVE DK-REC-SEQ-NBR          TO  DK-PREPK-REC-SEQ-NBR.       06880000
069100     MOVE DK-ORD-LNE-NBR          TO  DK-PREPK-LINE-NBR.          06890000
069200     MOVE RECITM-PREPK-ID         TO  DK-PREPK-ID                 06900000
069300                                      DK-PREPK-ID-HOLD.           06910000
069400                                                                  06920000
069500     SET PS-PROCESSING-CURSOR TO TRUE.                            06930000
069600                                                                  06940000
069700     PERFORM A410-OPEN-PREPK-CSR.                                 06950000
069800     PERFORM A420-FETCH-PREPK-CSR                                 06960000
069900       UNTIL PS-NO-PREPK-LINES-LEFT.                              06970000
070000     PERFORM A430-CLOSE-PREPK-CSR.                                06980000
070100                                                                  06990000
070200     PERFORM G460-LOAD-DRVR-LINE-INFO.                            07000000
070300     PERFORM G400-UPDATE-UNITS-WRKD.                              07010000
070400                                                                  07020000
070500     SET PS-NOT-PROCESSING-CURSOR  TO TRUE.                       07030000
070600                                                                  07040000
070700*----------------------------------------------------------------*07050000
070800* OPEN PREPK LINE CURSOR                                         *07060000
070900*----------------------------------------------------------------*07070000
071000 A410-OPEN-PREPK-CSR.                                             07080000
071100                                                                  07090000
071200         EXEC SQL                                                 07100000
071300              OPEN PRE_PACK_LNE_CSR                               07110000
071400         END-EXEC                                                 07120000
071500                                                                  07130000
071600         EVALUATE TRUE                                            07140000
071700             WHEN SQLCODE NOT EQUAL ZERO                          07150000
071800                  MOVE 'A410-OPEN-PREPK-CSR'                      07160000
071900                                   TO  DP013-PARAGRAPH            07170000
072000                  MOVE 'OPEN PREPK-CURSOR'                        07180000
072100                                   TO  DP013-MESSAGE-TEXT (1)     07190000
072200                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          07200000
072300                  MOVE DK-REC-SEQ-NBR                             07210000
072400                                   TO  PV-ERROR-RCVR-SEQ-NBR      07220000
072500                  MOVE DK-ORD-LNE-NBR                             07230000
072600                                   TO  PV-ERROR-ORD-LNE-NBR       07240000
072700                  STRING ' RCVR: '            DELIMITED BY SIZE   07250000
072800                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   07260000
072900                       '-'                    DELIMITED BY SIZE   07270000
073000                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   07280000
073100                       '  LINE: '             DELIMITED BY SIZE   07290000
073200                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   07300000
073300                                 INTO DP013-MESSAGE-TEXT (2)      07310000
073400                  MOVE 'TDISTDT '  TO DP013-DB2-TABLE-NAME (1)    07320000
073500                  MOVE SQLCA       TO  DP013-SQLCA                07330000
073600                  SET DP013-DB2-ABEND                             07340000
073700                                   TO  TRUE                       07350000
073800                  PERFORM Z999-ABEND                              07360000
073900         END-EVALUATE.                                            07370000
074000                                                                  07380000
074100*----------------------------------------------------------------*07390000
074200* FETCH PREPK LINE CURSOR                                        *07400000
074300*----------------------------------------------------------------*07410000
074400 A420-FETCH-PREPK-CSR.                                            07420000
074500                                                                  07430000
074600     EXEC SQL                                                     07440000
074700          FETCH PRE_PACK_LNE_CSR                                  07450000
074800           INTO :PV-PRPK-REC-ORD-LNE-NBR                          07460000
074900               ,:PV-PRPK-REC-PREPK-RATO-QTY                       07470000
075000               ,:PV-PREPK-DRV-LNE-CDE                             07480000
075100               ,:RECITM-STATUS-CDE                                07490000
075200               ,:RECITM-VERFYD-TMST                               07500000
075300               ,:RECITM-VRFD-USR-ID                               07510000
075400     END-EXEC                                                     07520000
075500                                                                  07530000
075600     EVALUATE TRUE                                                07540000
075700         WHEN SQLCODE = ZERO                                      07550000
075800                                                                  07560000
075900              MOVE RC289-ORD-NBR           TO DK-ORD-NBR          07570000
076000              MOVE RC289-RCVR-SEQ-NBR      TO DK-REC-SEQ-NBR      07580000
076100              MOVE PV-PRPK-REC-ORD-LNE-NBR TO DK-ORD-LNE-NBR      07590000
076200              PERFORM A500-PROCESS-PREPK                          07600000
076300                                                                  07610000
076400         WHEN SQLCODE = PC-ROW-NOT-FOUND                          07620000
076500              SET PS-NO-PREPK-LINES-LEFT                          07630000
076600                               TO  TRUE                           07640000
076700                                                                  07650000
076800         WHEN SQLWARN0 NOT EQUAL SPACE                            07660000
076900         WHEN SQLCODE NOT EQUAL ZERO                              07670000
077000              MOVE 'A420-FETCH-PREPK-CSR'                         07680000
077100                               TO  DP013-PARAGRAPH                07690000
077200              MOVE 'FETCH PREPK CURSOR  '                         07700000
077300                               TO  DP013-MESSAGE-TEXT (1)         07710000
077400              MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR                 07720000
077500              MOVE DK-REC-SEQ-NBR                                 07730000
077600                               TO PV-ERROR-RCVR-SEQ-NBR           07740000
077700              MOVE DK-ORD-LNE-NBR                                 07750000
077800                               TO PV-ERROR-ORD-LNE-NBR            07760000
077900              STRING ' RCVR: '            DELIMITED BY SIZE       07770000
078000                   PV-ERROR-ORD-NBR       DELIMITED BY SIZE       07780000
078100                   '-'                    DELIMITED BY SIZE       07790000
078200                   PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE       07800000
078300                   '  LINE: '             DELIMITED BY SIZE       07810000
078400                   PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE       07820000
078500                             INTO DP013-MESSAGE-TEXT (2)          07830000
078600              MOVE 'TDISTDT'   TO  DP013-DB2-TABLE-NAME (1)       07840000
078700              MOVE SQLCA       TO  DP013-SQLCA                    07850000
078800              SET DP013-DB2-ABEND                                 07860000
078900                               TO  TRUE                           07870000
079000              PERFORM Z999-ABEND                                  07880000
079100     END-EVALUATE.                                                07890000
079200                                                                  07900000
079300                                                                  07910000
079400                                                                  07920000
079500                                                                  07930000
079600*----------------------------------------------------------------*07940000
079700* CLOSE PREPK LINE CURSOR                                        *07950000
079800*----------------------------------------------------------------*07960000
079900 A430-CLOSE-PREPK-CSR.                                            07970000
080000                                                                  07980000
080100     EXEC SQL                                                     07990000
080200          CLOSE PRE_PACK_LNE_CSR                                  08000000
080300     END-EXEC.                                                    08010000
080400                                                                  08020000
080500     EVALUATE TRUE                                                08030000
080600         WHEN SQLWARN0 NOT EQUAL SPACE                            08040000
080700         WHEN SQLCODE NOT EQUAL ZERO                              08050000
080800              MOVE 'A430-CLOSE-PREPK-CSR '                        08060000
080900                               TO  DP013-PARAGRAPH                08070000
081000              MOVE 'CLOSE PREPK CURSOR  '                         08080000
081100                               TO  DP013-MESSAGE-TEXT (1)         08090000
081200              MOVE 'TDISTDT '  TO DP013-DB2-TABLE-NAME (1)        08100000
081300              MOVE SQLCA       TO  DP013-SQLCA                    08110000
081400              SET DP013-DB2-ABEND                                 08120000
081500                               TO  TRUE                           08130000
081600              PERFORM Z999-ABEND                                  08140000
081700     END-EVALUATE.                                                08150000
081800                                                                  08160000
081900                                                                  08170000
082000*----------------------------------------------------------------*08180000
082100*                                                                *08190000
082200*----------------------------------------------------------------*08200000
082300 A500-PROCESS-PREPK.                                              08210000
082400     SET  PS-DATA-LEFT-ON-TDISTDT                                 08220000
082500          PS-DATA-OK                                              08230000
082600          PS-HEADER-RECORD-OK      TO  TRUE.                      08240000
082700                                                                  08250000
082800           PERFORM B400-SELECT-DISTHD                             08260000
082900           IF PS-HEADER-RECORD-OK                                 08270000
083000               PERFORM B450-GET-TRECEIV-OPER-UNT-ID               08280000
083100               IF PS-DATA-OK                                      08290000
083200                   PERFORM B500-OPEN-CURSOR-TDISTDT               08300000
083300                   PERFORM B600-PROCESS-TDISTDT-RECORDS           08310000
083400                       UNTIL ((PS-NO-DATA-LEFT-ON-TDISTDT) OR     08320000
083500                              (PS-DATA-NOT-OK))                   08330000
083600                   PERFORM B550-CLOSE-CURSOR-TDISTDT              08340000
083700                   MOVE DISTHD-ORD-NBR      TO PC238-PO-NBR       08350000
083800                   MOVE DISTHD-RCVR-SEQ-NBR TO PC238-RCVR-SEQ-NBR 08360000
083900                   MOVE DISTHD-ORD-LNE-NBR  TO PC238-PO-LNE-NBR   08370000
084000                   MOVE RECEIV-CURR-OPER-UNT-ID TO                08380000
084100                                           PC238-WRKD-OPER-UNT-ID 08390000
084200                   MOVE PV-TOTAL-ALLOC-QTY-ALL TO                 08400000
084300                                           PC238-WRKD-UNT-QTY     08410000
084400                   MOVE PC-V TO PC238-TRANS-TYPE-CDE              08420000
084500                   INITIALIZE PV-TOTAL-ALLOC-QTY-ALL              08430000
084600                   EXEC SQL                                       08440000
084700                       SELECT                                     08450000
084800                             P2L_CART_CNT                         08460000
084900                            ,FCSE_FCLTY_AREA_ID                   08470000
085000                       INTO                                       08480000
085100                            :DISTHD-P2L-CART-CNT                  08490000
085200                           ,:DISTHD-FCSE-FCLTY-AREA-ID            08500000
085300                       FROM  TDISTHD                              08510000
085400                      WHERE ORD_NBR         = :DK-ORD-NBR         08520000
085500                        AND RCVR_SEQ_NBR    = :DK-REC-SEQ-NBR     08530000
085600                        AND ORD_LNE_NBR     = :DK-ORD-LNE-NBR     08540000
085700                   END-EXEC                                       08550000
085800                   EVALUATE TRUE                                  08560000
085900                       WHEN SQLCODE = ZERO                        08570000
086000                           IF DISTHD-P2L-CART-CNT = ZERO          08580000
086100                              MOVE DISTHD-FCSE-FCLTY-AREA-ID TO   08590000
086200                                              PC238-PRCG-AREA-CDE 08600000
086300                           ELSE                                   08610000
086400                              MOVE SPACES  TO PC238-PRCG-AREA-CDE 08620000
086500                           END-IF                                 08630000
086600                       WHEN OTHER                                 08640000
086700                           MOVE SPACES  TO  PC238-PRCG-AREA-CDE   08650000
086800                   END-EVALUATE                                   08660000
086910                   IF  DISTHD-PREPK-LNE-PRC-CDE   = 'D'           08670000
087000                       PERFORM G450-KEEP-DRVR-LINE-INFO           08680000
087100                   ELSE                                           08690000
087200                       PERFORM G400-UPDATE-UNITS-WRKD             08700000
087300                   END-IF                                         08710000
087400               END-IF                                             08720000
087500               IF PS-DATA-OK                                      08730000
087600                   PERFORM B850-COUNT-TDISTDT-ROWS                08740000
087700                   IF PV-DB2-COUNT = 0                            08750000
087800                       PERFORM B900-UPDATE-DISTHD                 08760000
087900                   PERFORM B700-PROCESS-RECITM                    08770000
088000                   PERFORM B800-COUNT-TRECITM                     08780000
088100                   END-IF                                         08790000
088200               END-IF                                             08800000
088300               MOVE DK-ORD-NBR     TO PV-ORD-NBR-DISPLAY          08810000
088400               MOVE DK-REC-SEQ-NBR TO PV-REC-SEQ-NBR-DISPLAY      08820000
088500               MOVE DK-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY      08830000
088600               MOVE DISTHD-OPER-UNT-ID                            08840000
088700                                   TO PV-OPER-UNT-ID-DISPLAY      08850000
088800               MOVE PV-FCLTY-ID    TO PV-FCLTY-ID-DISPLAY         08860000
088900               MOVE EIBTRNID       TO PV-ID-NBR-DISPLAY           08870000
089000               IF PS-DATA-OK                                      08880000
089100                   STRING ' PCKCS770'         DELIMITED BY SIZE   08890000
089200                          ' RCVR: '           DELIMITED BY SIZE   08900000
089300                          PV-ORD-NBR-DISPLAY  DELIMITED BY SIZE   08910000
089400                          '-'                 DELIMITED BY SIZE   08920000
089500                          PV-REC-SEQ-NBR-DISPLAY                  08930000
089600                                              DELIMITED BY SIZE   08940000
089700                          '  LINE: '          DELIMITED BY SIZE   08950000
089800                          PV-ORD-LNE-NBR-DISPLAY                  08960000
089900                                              DELIMITED BY SIZE   08970000
090000                          '  FCLTY: '         DELIMITED BY SIZE   08980000
090100                          PV-OPER-UNT-ID-DISPLAY                  08990000
090200                                              DELIMITED BY SIZE   09000000
090300                          '-'                 DELIMITED BY SIZE   09010000
090400                          PV-FCLTY-ID-DISPLAY DELIMITED BY SIZE   09020000
090500                          '  SUCCESSFUL VERIFICATION'             09030000
090600                                              DELIMITED BY SIZE   09040000
090700                                 INTO PV-CICS-MSG-AREA            09050000
090800                   PERFORM 9995-WRITE-CICS-FOR-DEBUG              09060000
090900               ELSE                                               09070000
091000                   PERFORM Z901-BACKUP                            09080000
091100                   MOVE PC-ERROR-STATUS   TO PV-ERROR-STATUS      09090000
091200                   PERFORM C850-UPDATE-TDISTHD-ERR-STAT           09100000
091300                   STRING ' PCKCS770'         DELIMITED BY SIZE   09110000
091400                          ' RCVR: '           DELIMITED BY SIZE   09120000
091500                          PV-ORD-NBR-DISPLAY  DELIMITED BY SIZE   09130000
091600                          '-'                 DELIMITED BY SIZE   09140000
091700                          PV-REC-SEQ-NBR-DISPLAY                  09150000
091800                                              DELIMITED BY SIZE   09160000
091900                          '  LINE: '          DELIMITED BY SIZE   09170000
092000                          PV-ORD-LNE-NBR-DISPLAY                  09180000
092100                                              DELIMITED BY SIZE   09190000
092200                          '  FCLTY: '         DELIMITED BY SIZE   09200000
092300                          PV-OPER-UNT-ID-DISPLAY                  09210000
092400                                              DELIMITED BY SIZE   09220000
092500                          '-'                 DELIMITED BY SIZE   09230000
092600                          PV-FCLTY-ID-DISPLAY DELIMITED BY SIZE   09240000
092700                          '  UNSUCCESSFUL VERIFICATION - '        09250000
092800                          PV-ERROR-STATUS                         09260000
092900                                              DELIMITED BY SIZE   09270000
093000                                 INTO PV-CICS-MSG-AREA            09280000
093100                   PERFORM 9995-WRITE-CICS-FOR-DEBUG              09290000
093200               END-IF                                             09300000
093300           END-IF.                                                09310000
093400                                                                  09320000
093500                                                                  09330000
093600*----------------------------------------------------------------*09340000
093700*    SELECT FROM THE TRANSACTION HEADER WHEN A ORDER NUMBER/     *09350000
093800*    RECEIVER AND LINE NUMBER ARE PASSED FROM PCKCS107.           09360000
093900*----------------------------------------------------------------*09370000
094000 B400-SELECT-DISTHD.                                              09380000
094100     INITIALIZE DCLTDISTHD.                                       09390000
094200*                                                                 09400000
094300         EXEC SQL                                                 09410000
094400             SELECT                                               09420000
094500                   A.ORD_NBR                                      09430000
094600                  ,A.RCVR_SEQ_NBR                                 09440000
094700                  ,A.ORD_LNE_NBR                                  09450000
094800                  ,A.WRK_ORD_SEQ_NBR                              09460000
094900                  ,A.OPER_UNT_ID                                  09470000
095000                  ,A.DISTRB_PRC_AREA_ID                           09480000
095100                  ,A.PRCG_STAT_CDE                                09490000
095200                  ,A.CRE_TMST                                     09500000
095300                  ,A.RSLTS_RCVD_TMST                              09510000
095400                  ,A.VRFD_TMST                                    09520000
095500                  ,A.PREPK_LNE_PRC_CDE                            09530000
095600                  ,B.PREPK_DRV_LNE_CDE                            09540000
095700             INTO                                                 09550000
095800                  :DISTHD-ORD-NBR                                 09560000
095900                 ,:DISTHD-RCVR-SEQ-NBR                            09570000
096000                 ,:DISTHD-ORD-LNE-NBR                             09580000
096100                 ,:DISTHD-WRK-ORD-SEQ-NBR                         09590000
096200                 ,:DISTHD-OPER-UNT-ID                             09600000
096300                 ,:DISTHD-DISTRB-PRC-AREA-ID                      09610000
096400                 ,:DISTHD-PRCG-STAT-CDE                           09620000
096500                 ,:DISTHD-CRE-TMST                                09630000
096600                 ,:DISTHD-RSLTS-RCVD-TMST                         09640000
096700                 ,:DISTHD-VRFD-TMST                               09650000
096800                 ,:DISTHD-PREPK-LNE-PRC-CDE                       09660000
096900                 ,:RECITM-PREPK-DRV-LNE-CDE                       09670000
097000              FROM                                                09680000
097100                  TDISTHD A                                       09690000
097200                , TRECITM B                                       09700000
097300             WHERE                                                09710000
097400                     A.ORD_NBR       = :DK-ORD-NBR                09720000
097500                 AND A.ORD_NBR       =  B.ORD_NBR                 09730000
097600                 AND A.RCVR_SEQ_NBR  = :DK-REC-SEQ-NBR            09740000
097700                 AND A.RCVR_SEQ_NBR  = B.REC_SEQ_NBR              09750000
097800                 AND A.ORD_LNE_NBR   = :DK-ORD-LNE-NBR            09760000
097900                 AND A.ORD_LNE_NBR   = B.ORD_LNE_NBR              09770000
098000                 AND PRCG_STAT_CDE   = :PC-READY-TO-VERIFY        09780000
098100         END-EXEC                                                 09790000
098200                                                                  09800000
098300         EVALUATE TRUE                                            09810000
098400             WHEN SQLCODE = ZERO                                  09820000
098500                  MOVE DISTHD-WRK-ORD-SEQ-NBR TO                  09830000
098600                             PV-WRK-ORD-SEQ-NBR                   09840000
098700             WHEN SQLCODE = +100                                  09850000
098800                  SET PS-NO-R-RECORD    TO  TRUE                  09860000
098900             WHEN SQLWARN0 NOT = SPACE                            09870000
099000             WHEN SQLCODE NOT = ZERO                              09880000
099100                  MOVE 'B400-SELECT-DISTHD'                       09890000
099200                                   TO DP013-PARAGRAPH             09900000
099300                  MOVE 'SELECT TDISTHD'                           09910000
099400                                   TO DP013-MESSAGE-TEXT (1)      09920000
099500                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          09930000
099600                  MOVE DK-REC-SEQ-NBR                             09940000
099700                                   TO PV-ERROR-RCVR-SEQ-NBR       09950000
099800                  MOVE DK-ORD-LNE-NBR                             09960000
099900                                   TO PV-ERROR-ORD-LNE-NBR        09970000
100000                  STRING ' RCVR: '            DELIMITED BY SIZE   09980000
100100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   09990000
100200                       '-'                    DELIMITED BY SIZE   10000000
100300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   10010000
100400                       '  LINE: '             DELIMITED BY SIZE   10020000
100500                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   10030000
100600*                               INTO DP013-MESSAGE-TEXT (2)       10040000
100700                                INTO PV-CICS-MSG-AREA             10050000
100800                  PERFORM 9990-WRITE-CICS                         10060000
100900                  MOVE 'TDISTHD '  TO DP013-DB2-TABLE-NAME (1)    10070000
101000                  MOVE SQLCA       TO DP013-SQLCA                 10080000
101100                  SET DP013-DB2-ABEND                             10090000
101200                                   TO TRUE                        10100000
101300                  PERFORM Z999-ABEND                              10110000
101400         END-EVALUATE.                                            10120000
101500                                                                  10130000
101600                                                                  10140000
101700                                                                  10150000
101800  EJECT                                                           10160000
101900*                                                                 10170000
102000*----------------------------------------------------------------*10180000
102100*    FETCH THE OPERATING UNIT ID THAT IS ASSOCIATED WITH THE     *10190000
102200*    RECEIVER AND LINE NUMBER THAT WE ARE ATTEMPTING TO VERIFY.  *10200000
102300*----------------------------------------------------------------*10210000
102400 B450-GET-TRECEIV-OPER-UNT-ID.                                    10220000
102500     INITIALIZE DCLTRECEIV.                                       10230000
102600                                                                  10240000
102700         EXEC SQL                                                 10250000
102800              SELECT                                              10260000
102900                 OPER_UNT_ID                                      10270000
103000                ,CURR_OPER_UNT_ID                                 10280000
103100                ,PACK_BY_ST_IND                                   10290000
103200                ,PKGNG_CDE                                        10300000
103300            INTO                                                  10310000
103400                 :RECEIV-OPER-UNT-ID                              10320000
103500                ,:RECEIV-CURR-OPER-UNT-ID                         10330000
103600                ,:RECEIV-PACK-BY-ST-IND                           10340000
103700                ,:RECEIV-PKGNG-CDE                                10350000
103800              FROM  TRECEIV                                       10360000
103900              WHERE                                               10370000
104000                     ORD_NBR          =  :DK-ORD-NBR              10380000
104100              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          10390000
104200              AND    VER_STATUS_CDE   =  :PC-A                    10400000
104300              WITH UR                                             10410000
104400         END-EXEC                                                 10420000
104500                                                                  10430000
104600         EVALUATE TRUE                                            10440000
104700             WHEN SQLCODE = ZERO                                  10450000
104800                  SET PS-DATA-OK    TO  TRUE                      10460000
104900             WHEN SQLCODE = +100                                  10470000
105000                  SET PS-DATA-NOT-OK  TO  TRUE                    10480000
105100             WHEN SQLWARN0 NOT = SPACE                            10490000
105200             WHEN SQLCODE NOT = ZERO                              10500000
105300                  MOVE 'B450-GET-TRECEIV-OPER-UNT-ID'             10510000
105400                                   TO DP013-PARAGRAPH             10520000
105500                  MOVE 'SELECT TRECEIV'                           10530000
105600                                   TO DP013-MESSAGE-TEXT (1)      10540000
105700                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          10550000
105800                  MOVE DK-REC-SEQ-NBR                             10560000
105900                                   TO PV-ERROR-RCVR-SEQ-NBR       10570000
106000                  STRING ' RCVR: '            DELIMITED BY SIZE   10580000
106100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   10590000
106200                       '-'                    DELIMITED BY SIZE   10600000
106300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   10610000
106400                                 INTO DP013-MESSAGE-TEXT (2)      10620000
106500                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    10630000
106600                  MOVE SQLCA       TO DP013-SQLCA                 10640000
106700                  SET DP013-DB2-ABEND                             10650000
106800                                   TO TRUE                        10660000
106900                  PERFORM Z999-ABEND                              10670000
107000         END-EVALUATE.                                            10680000
107100/                                                                 10690000
107200 B475-CHECK-AUTOVRFD.                                             10700000
107300                                                                  10710000
107400     INITIALIZE RC040-FIELDS.                                     10720000
107500     MOVE RECEIV-OPER-UNT-ID  TO RC040-SIGNON-LOCATION.           10730000
107600     MOVE DK-ORD-NBR          TO RC040-PO-NBR.                    10740000
107700     MOVE DK-REC-SEQ-NBR      TO RC040-PO-RCVR.                   10750000
107800     MOVE SPACES              TO RC040-USER-ID.                   10760000
107900     MOVE 'PCKCS770'          TO RC040-CALLING-PROGRAM.           10770000
108000                                                                  10780000
108100     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  10790000
108200                                        RC040-COMMAREA            10800000
108300                                        RC040-FIELDS.             10810000
108400                                                                  10820000
108500     EVALUATE TRUE                                                10830000
108600         WHEN RC040-SUCCESSFUL                                    10840000
108700                 MOVE RC040-AUTO-VE-SW TO PS-AUTO-VE-SW           10850000
108800         WHEN OTHER                                               10860000
108900             MOVE 'B475-CHECK-AUTOVRFD'                           10870000
109000                                     TO DP013-PARAGRAPH           10880000
109100             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          10890000
109200             MOVE DK-REC-SEQ-NBR     TO PV-ERROR-RCVR-SEQ-NBR     10900000
109300             MOVE RECEIV-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      10910000
109400             STRING ' OPER: '            DELIMITED BY SIZE        10920000
109500                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        10930000
109600                    ' RCVR: '            DELIMITED BY SIZE        10940000
109700                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        10950000
109800                  '-'                    DELIMITED BY SIZE        10960000
109900                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        10970000
110000                  ' IND: '               DELIMITED BY SIZE        10980000
110100                  RC040-SUCCESS-IND      DELIMITED BY SIZE        10990000
110200                                   INTO DP013-MESSAGE-TEXT (1)    11000000
110300             SET DP013-XCTL-DISPLAY-RESTART                       11010000
110400                 DP013-DB2-ABEND     TO TRUE                      11020000
110500                                                                  11030000
110600             PERFORM Z999-ABEND                                   11040000
110700     END-EVALUATE.                                                11050000
110800                                                                  11060000
110900/                                                                 11070000
111000 B480-CALL-RCKUT128.                                              11080000
111100     INITIALIZE RC074-FIELDS.                                     11090000
111200     MOVE DISTHD-OPER-UNT-ID  TO RC074-OPER-UNT-ID.               11100000
111300     MOVE PV-FCLTY-ID         TO RC074-FCLTY-ID.                  11110000
111400     MOVE DISTDT-ORD-NBR      TO RC074-PO-NBR.                    11120000
111500     MOVE DISTDT-RCVR-SEQ-NBR TO RC074-RCVR-SEQ-NBR.              11130000
111600     MOVE DISTDT-ORD-LNE-NBR  TO RC074-LINE-NBR.                  11140000
111700     MOVE DISTDT-STR-NBR      TO RC074-STR-NBR.                   11150000
111800     IF RC289-PREPK-M-OR-I                                        11160000
111900         SET RC074-PACK-QTY-YES   TO TRUE                         11170000
112000         MOVE RECITM-PREPK-ID TO RC074-PACK-ID                    11180000
112100     ELSE                                                         11190000
112200         SET RC074-UNIT-QTY-YES   TO TRUE                         11200000
112300     END-IF.                                                      11210000
112400                                                                  11220000
112500                                                                  11230000
112600     CALL RC074-UNIT-CRTN-CNT-PGM USING  DFHEIBLK                 11240000
112700                                         RC074-COMMAREA           11250000
112800                                         RC074-FIELDS.            11260000
112900                                                                  11270000
113000     EVALUATE TRUE                                                11280000
113100         WHEN RC074-SUCCESSFUL                                    11290000
113200             CONTINUE                                             11300000
113300         WHEN OTHER                                               11310000
113400             MOVE 'B480-CALL-RCKUT128 '                           11320000
113500                                     TO DP013-PARAGRAPH           11330000
113600             MOVE DISTDT-ORD-NBR     TO PV-ERROR-ORD-NBR          11340000
113700             MOVE DISTDT-RCVR-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR    11350000
113800             MOVE DISTHD-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      11360000
113900             MOVE DISTDT-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY    11370000
114000             MOVE DISTHD-OPER-UNT-ID TO PV-OPER-UNT-ID-DISPLAY    11380000
114100             STRING ' PCKCS770-RC128'   DELIMITED BY SIZE         11390000
114200                    ' RCVR: '           DELIMITED BY SIZE         11400000
114300                    PV-ERROR-ORD-NBR    DELIMITED BY SIZE         11410000
114400                    '-'                 DELIMITED BY SIZE         11420000
114500                    PV-ERROR-RCVR-SEQ-NBR                         11430000
114600                                        DELIMITED BY SIZE         11440000
114700                    '  LINE: '          DELIMITED BY SIZE         11450000
114800                    PV-ORD-LNE-NBR-DISPLAY                        11460000
114900                                        DELIMITED BY SIZE         11470000
115000                    '  FCLTY: '         DELIMITED BY SIZE         11480000
115100                    PV-OPER-UNT-ID-DISPLAY                        11490000
115200                                        DELIMITED BY SIZE         11500000
115300                           INTO PV-CICS-MSG-AREA                  11510000
115400             PERFORM 9990-WRITE-CICS                              11520000
115500             STRING ' OPER: '            DELIMITED BY SIZE        11530000
115600                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        11540000
115700                    ' RCVR: '            DELIMITED BY SIZE        11550000
115800                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        11560000
115900                  '-'                    DELIMITED BY SIZE        11570000
116000                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        11580000
116100                  ' IND: '               DELIMITED BY SIZE        11590000
116200                  RC074-SUCCESS-IND      DELIMITED BY SIZE        11600000
116300                                   INTO DP013-MESSAGE-TEXT (1)    11610000
116400             SET DP013-XCTL-DISPLAY-RESTART                       11620000
116500                 DP013-DB2-ABEND     TO TRUE                      11630000
116600                                                                  11640000
116700             PERFORM Z999-ABEND                                   11650000
116800     END-EVALUATE.                                                11660000
116900                                                                  11670000
117000******************************************************************11680000
117100* B500-OPEN-CURSOR.                                              *11690000
117200*    OPEN THE DETAIL TRANSACTION CURSOR                          *11700000
117300******************************************************************11710000
117400 B500-OPEN-CURSOR-TDISTDT.                                        11720000
117500                                                                  11730000
117600         EXEC SQL                                                 11740000
117700              OPEN DISTDT-CURSOR                                  11750000
117800         END-EXEC                                                 11760000
117900                                                                  11770000
118000         EVALUATE TRUE                                            11780000
118100             WHEN SQLCODE NOT EQUAL ZERO                          11790000
118200                  MOVE 'B500-OPEN-CURSOR-TDISTDT'                 11800000
118300                                   TO  DP013-PARAGRAPH            11810000
118400                  MOVE 'OPEN DISTDT-CURSOR'                       11820000
118500                                   TO  DP013-MESSAGE-TEXT (1)     11830000
118600                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          11840000
118700                  MOVE DK-REC-SEQ-NBR                             11850000
118800                                   TO  PV-ERROR-RCVR-SEQ-NBR      11860000
118900                  MOVE DK-ORD-LNE-NBR                             11870000
119000                                   TO  PV-ERROR-ORD-LNE-NBR       11880000
119100                  STRING ' RCVR: '            DELIMITED BY SIZE   11890000
119200                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   11900000
119300                       '-'                    DELIMITED BY SIZE   11910000
119400                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   11920000
119500                       '  LINE: '             DELIMITED BY SIZE   11930000
119600                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   11940000
119700                                 INTO DP013-MESSAGE-TEXT (2)      11950000
119800                  MOVE 'TDISTDT '  TO DP013-DB2-TABLE-NAME (1)    11960000
119900                  MOVE SQLCA       TO  DP013-SQLCA                11970000
120000                  SET DP013-DB2-ABEND                             11980000
120100                                   TO  TRUE                       11990000
120200                  PERFORM Z999-ABEND                              12000000
120300         END-EVALUATE.                                            12010000
120400                                                                  12020000
120500******************************************************************12030000
120600* B550-CLOSE-CURSOR-TDISTDT                                      *12040000
120700******************************************************************12050000
120800 B550-CLOSE-CURSOR-TDISTDT.                                       12060000
120900                                                                  12070000
121000     EXEC SQL                                                     12080000
121100         CLOSE DISTDT-CURSOR                                      12090000
121200     END-EXEC.                                                    12100000
121300                                                                  12110000
121400     EVALUATE TRUE                                                12120000
121500         WHEN SQLWARN0 NOT EQUAL SPACE                            12130000
121600         WHEN SQLCODE NOT EQUAL ZERO                              12140000
121700              MOVE 'B550-CLOSE-CURSOR-TDISTDT'                    12150000
121800                               TO  DP013-PARAGRAPH                12160000
121900              MOVE 'CLOSE TDISTDT CURSOR'                         12170000
122000                               TO  DP013-MESSAGE-TEXT (1)         12180000
122100              MOVE 'TDISTDT '  TO DP013-DB2-TABLE-NAME (1)        12190000
122200              MOVE SQLCA       TO  DP013-SQLCA                    12200000
122300              SET DP013-DB2-ABEND                                 12210000
122400                               TO  TRUE                           12220000
122500              PERFORM Z999-ABEND                                  12230000
122600     END-EVALUATE.                                                12240000
122700                                                                  12250000
122800                                                                  12260000
122900******************************************************************12270000
123000* B600-PROCESS-TDISTDT-RECORDS.                                   12280000
123100*    DOES A FETCH ON THE TDISTDT AND UPDATES                      12290000
123200*    MATCHING ROWS ON THE RECDIS TABLE.                           12300000
123300******************************************************************12310000
123400 B600-PROCESS-TDISTDT-RECORDS.                                    12320000
123500      PERFORM C600-FETCH-DISTDT-CURSOR.                           12330000
123600      IF PS-DATA-LEFT-ON-TDISTDT                                  12340000
123700           PERFORM C700-SELECT-RECDIS                             12350000
123800           IF PS-DATA-OK                                          12360000
123900              INITIALIZE PV-TOTAL-ALLOC-QTY                       12370000
124000                         PV-FCSE-ACTL-ALLOC-QTY                   12380000
124100              IF PS-AUTO-VE-YES                                   12390000
124200                 PERFORM B480-CALL-RCKUT128                       12400000
124300                 MOVE RC074-TOTAL-ACTL-ITM-QTY TO                 12410000
124400                                        PV-TOTAL-ALLOC-QTY        12420000
124500                 MOVE RC074-FCSE-ACTL-ITM-QTY TO                  12430000
124600                                  PV-FCSE-ACTL-ALLOC-QTY          12440000
124700                 IF RC074-ACTUAL-ODD-QTY > 0                      12450000
124800                     MOVE RC074-ACTUAL-ODD-QTY TO                 12460000
124900                             DISTDT-PREPK-ODD-UNT-QTY             12470000
125000                     COMPUTE PV-FCSE-ACTL-ALLOC-QTY =             12480000
125100                            (PV-FCSE-ACTL-ALLOC-QTY -             12490000
125200                             RC074-ACTUAL-ODD-QTY)                12500000
125300                 ELSE                                             12510000
125400                     MOVE 0    TO DISTDT-PREPK-ODD-UNT-QTY        12520000
125500                 END-IF                                           12530000
125600                 PERFORM C905-UPDATE-DISTDT-FCSE-ACTL             12540000
125700                                                                  12550000
125800              ELSE                                                12560000
125900                 COMPUTE PV-TOTAL-ALLOC-QTY =                     12570000
126000                         (DISTDT-ACTL-ALLOC-QTY +                 12580000
126100                          DISTDT-FCSE-ACTL-UNT-QTY +              12590000
126200                          DISTDT-PREPK-ODD-UNT-QTY)               12600000
126300              END-IF                                              12610000
126400              COMPUTE PV-TOTAL-ALLOC-QTY-ALL =                    12620000
126500                      PV-TOTAL-ALLOC-QTY-ALL +                    12630000
126600                      PV-TOTAL-ALLOC-QTY                          12640000
126700              IF PV-TOTAL-ALLOC-QTY-ALL > 0                       12650000
126800                 SET PS-PROCESS-QTY-GRTR-ZERO TO TRUE             12660000
126900              END-IF                                              12670000
127000              IF PV-TOTAL-ALLOC-QTY = RECDIS-VERIFY-ITM-QTY       12680000
127100                  PERFORM C500-CHECK-ODD-UNIT                     12690000
127200                  PERFORM C800-UPDATE-TRECDIS                     12700000
127300                  PERFORM C900-UPDATE-DISTDT                      12710000
127400                  IF DISTDT-PREPK-ODD-UNT-QTY > 0                 12720000
127500                      PERFORM C920-PROCESS-ODD-UNIT               12730000
127600                  END-IF                                          12740000
127700                  IF  RC289-P2L-CASE-PROCESS                      12750000
127800                      PERFORM D700-LOG-VERIFY-SOURCE              12760000
127900                  END-IF                                          12770000
128000              ELSE                                                12780000
128100                  PERFORM C500-CHECK-ODD-UNIT                     12790000
128200                  PERFORM C910-ADD-TO-RECD-AUDIT                  12800000
128300                  PERFORM C800-UPDATE-TRECDIS                     12810000
128400                  PERFORM C900-UPDATE-DISTDT                      12820000
128500                  IF DISTDT-PREPK-ODD-UNT-QTY > 0                 12830000
128600                      PERFORM C920-PROCESS-ODD-UNIT               12840000
128700                  END-IF                                          12850000
128800                  IF  RC289-P2L-CASE-PROCESS                      12860000
128900                      PERFORM D700-LOG-VERIFY-SOURCE              12870000
129000                  END-IF                                          12880000
129100              END-IF                                              12890000
129200           END-IF                                                 12900000
129300      END-IF.                                                     12910000
129400                                                                  12920000
129500                                                                  12930000
129600******************************************************************12940000
129700* B700-PROCESS-RECITM.                                            12950000
129800*    UPDATE THE RECITM STATUS IF ALL OF THE TDISTHD ROWS FOR THAT 12960000
129900*    HAVE BEEN PROCESSED.                                         12970000
130000******************************************************************12980000
130100 B700-PROCESS-RECITM.                                             12990000
130200                                                                  13000000
130300     PERFORM B875-COUNT-TDISTHD-ROWS                              13010000
130400                                                                  13020000
130500     IF PV-DB2-COUNT = 0                                          13030000
130600         MOVE PC-VE  TO  PV-STATUS-CDE                            13040000
130700         PERFORM D760-UPDATE-TRECITM                              13050000
130800         PERFORM D300-CHECK-POLINE-FOR-UPDATE                     13060000
130900     ELSE                                                         13070000
131000         CONTINUE                                                 13080000
131100     END-IF.                                                      13090000
131200                                                                  13100000
131300 B800-COUNT-TRECITM.                                              13110000
131400                                                                  13120000
131500     MOVE PC-VE TO PV-COUNT-STATUS-CDE.                           13130000
131600     PERFORM C760-COUNT-TRECITM-ROWS.                             13140000
131700     IF  PV-DB2-COUNT EQUAL ZERO                                  13150000
131800         PERFORM C300-GET-TRECEIV-STATUS                          13160000
131900             IF (RECEIV-STATUS-CDE EQUAL PC-CM)                   13170000
132000             OR (RECEIV-STATUS-CDE EQUAL PC-IP)                   13180000
132100                 PERFORM C400-UPDATE-TRECEIV-STATUS               13190000
132200             END-IF                                               13200000
132300     END-IF.                                                      13210000
132400                                                                  13220000
132500 B850-COUNT-TDISTDT-ROWS.                                         13230000
132600                                                                  13240000
132700     MOVE ZERO            TO  PV-DB2-COUNT.                       13250000
132800         MOVE ZEROES          TO  PV-DB2-COUNT                    13260000
132900         EXEC SQL                                                 13270000
133000              SELECT                                              13280000
133100                    COUNT(*)                                      13290000
133200              INTO                                                13300000
133300                    :PV-DB2-COUNT :PV-NULL-IND                    13310000
133400              FROM                                                13320000
133500                    TDISTDT                                       13330000
133600              WHERE                                               13340000
133700                    ORD_NBR              =  :DK-ORD-NBR           13350000
133800              AND   ORD_LNE_NBR          =  :DK-ORD-LNE-NBR       13360000
133900              AND   RCVR_SEQ_NBR         =  :DK-REC-SEQ-NBR       13370000
134000              AND   RCVG_PSTD_STAT_CDE  ^=  :PC-POSTED-STATUS     13380000
134100         END-EXEC                                                 13390000
134200                                                                  13400000
134300         EVALUATE TRUE                                            13410000
134400             WHEN SQLCODE = ZERO                                  13420000
134500             WHEN SQLCODE = +100                                  13430000
134600                  CONTINUE                                        13440000
134700             WHEN SQLWARN0 NOT = SPACE                            13450000
134800             WHEN SQLCODE NOT = ZERO                              13460000
134900                  MOVE 'B850-COUNT-TDISTDT-ROWS'                  13470000
135000                                   TO DP013-PARAGRAPH             13480000
135100                  MOVE 'CHECK IF ANY TDISTDT ROWS EXIST'          13490000
135200                                   TO DP013-MESSAGE-TEXT (1)      13500000
135300                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          13510000
135400                  MOVE DK-REC-SEQ-NBR                             13520000
135500                                   TO PV-ERROR-RCVR-SEQ-NBR       13530000
135600                  MOVE DK-ORD-LNE-NBR                             13540000
135700                                   TO PV-ERROR-ORD-LNE-NBR        13550000
135800                  STRING ' RCVR: '            DELIMITED BY SIZE   13560000
135900                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   13570000
136000                       '-'                    DELIMITED BY SIZE   13580000
136100                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   13590000
136200                       '  LINE: '             DELIMITED BY SIZE   13600000
136300                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   13610000
136400                                 INTO DP013-MESSAGE-TEXT (2)      13620000
136500                  MOVE 'TDISTDT '  TO DP013-DB2-TABLE-NAME (1)    13630000
136600                  MOVE SQLCA       TO DP013-SQLCA                 13640000
136700                  SET DP013-DB2-ABEND                             13650000
136800                                   TO TRUE                        13660000
136900                  PERFORM Z999-ABEND                              13670000
137000         END-EVALUATE.                                            13680000
137100                                                                  13690000
137200 B875-COUNT-TDISTHD-ROWS.                                         13700000
137300                                                                  13710000
137400     MOVE ZERO            TO  PV-DB2-COUNT.                       13720000
137500         EXEC SQL                                                 13730000
137600              SELECT                                              13740000
137700                    COUNT(*)                                      13750000
137800              INTO                                                13760000
137900                    :PV-DB2-COUNT :PV-NULL-IND                    13770000
138000              FROM                                                13780000
138100                    TDISTHD                                       13790000
138200              WHERE                                               13800000
138300                    ORD_NBR              =  :DK-ORD-NBR           13810000
138400              AND   ORD_LNE_NBR          =  :DK-ORD-LNE-NBR       13820000
138500              AND   RCVR_SEQ_NBR         =  :DK-REC-SEQ-NBR       13830000
138600              AND   PRCG_STAT_CDE       ^=  :PC-V                 13840000
138700         END-EXEC                                                 13850000
138800                                                                  13860000
138900         EVALUATE TRUE                                            13870000
139000             WHEN SQLCODE = ZERO                                  13880000
139100             WHEN SQLCODE = +100                                  13890000
139200                  CONTINUE                                        13900000
139300             WHEN SQLWARN0 NOT = SPACE                            13910000
139400             WHEN SQLCODE NOT = ZERO                              13920000
139500                  MOVE 'B875-COUNT-TDISTHD-ROWS'                  13930000
139600                                   TO DP013-PARAGRAPH             13940000
139700                  MOVE 'CHECK IF ANY TDISTHD ROWS EXIST'          13950000
139800                                   TO DP013-MESSAGE-TEXT (1)      13960000
139900                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          13970000
140000                  MOVE DK-REC-SEQ-NBR                             13980000
140100                                   TO PV-ERROR-RCVR-SEQ-NBR       13990000
140200                  MOVE DK-ORD-LNE-NBR                             14000000
140300                                   TO PV-ERROR-ORD-LNE-NBR        14010000
140400                  STRING ' RCVR: '            DELIMITED BY SIZE   14020000
140500                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   14030000
140600                       '-'                    DELIMITED BY SIZE   14040000
140700                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   14050000
140800                       '  LINE: '             DELIMITED BY SIZE   14060000
140900                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   14070000
141000                                 INTO DP013-MESSAGE-TEXT (2)      14080000
141100                  MOVE 'TDISTHD '  TO DP013-DB2-TABLE-NAME (1)    14090000
141200                  MOVE SQLCA       TO DP013-SQLCA                 14100000
141300                  SET DP013-DB2-ABEND                             14110000
141400                                   TO TRUE                        14120000
141500                  PERFORM Z999-ABEND                              14130000
141600         END-EVALUATE.                                            14140000
141700                                                                  14150000
141800 B900-UPDATE-DISTHD.                                              14160000
141900                                                                  14170000
142000         EXEC SQL                                                 14180000
142100              UPDATE TDISTHD                                      14190000
142200              SET    PRCG_STAT_CDE  =  :PC-V                      14200000
142300                    ,VRFD_TMST      =   CURRENT TIMESTAMP         14210000
142400              WHERE                                               14220000
142500                     ORD_NBR          =  :DK-ORD-NBR              14230000
142600              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          14240000
142700              AND    RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR          14250000
142800         END-EXEC                                                 14260000
142900                                                                  14270000
143000         EVALUATE TRUE                                            14280000
143100             WHEN SQLCODE = ZERO                                  14290000
143200                  CONTINUE                                        14300000
143300             WHEN SQLCODE = +100                                  14310000
143400                  CONTINUE                                        14320000
143500             WHEN SQLWARN0 NOT = SPACE                            14330000
143600             WHEN SQLCODE NOT = ZERO                              14340000
143700                  MOVE 'B900-UPDATE-DISTHD'                       14350000
143800                                   TO DP013-PARAGRAPH             14360000
143900                  MOVE 'UPDATE TRANSACTION HEADER TABLE'          14370000
144000                                   TO DP013-MESSAGE-TEXT (1)      14380000
144100                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          14390000
144200                  MOVE DK-REC-SEQ-NBR                             14400000
144300                                   TO PV-ERROR-RCVR-SEQ-NBR       14410000
144400                  MOVE DK-ORD-LNE-NBR                             14420000
144500                                   TO PV-ERROR-ORD-LNE-NBR        14430000
144600                  STRING ' RCVR: '            DELIMITED BY SIZE   14440000
144700                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   14450000
144800                       '-'                    DELIMITED BY SIZE   14460000
144900                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   14470000
145000                       '  LINE: '             DELIMITED BY SIZE   14480000
145100                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   14490000
145200                                 INTO DP013-MESSAGE-TEXT (2)      14500000
145300                  MOVE 'TDISTHD '  TO DP013-DB2-TABLE-NAME (1)    14510000
145400                  MOVE SQLCA       TO DP013-SQLCA                 14520000
145500                  SET DP013-DB2-ABEND                             14530000
145600                                   TO TRUE                        14540000
145700                  PERFORM Z999-ABEND                              14550000
145800         END-EVALUATE.                                            14560000
145900                                                                  14570000
146000*----------------------------------------------------------------*14580000
146100*    FIRST, SEE IF THERE ARE ANY ROWS LEFT THAT ARE NOT          *14590000
146200*    'VE' STATUS CODE.                                           *14600000
146300*    IF THERE ARE NONE, CHECK THE RECEIVER STATUS.  IF IT        *14610000
146400*    IS 'CM', UPDATE IT TO 'VE'.                                 *14620000
146500*----------------------------------------------------------------*14630000
146600 C760-COUNT-TRECITM-ROWS.                                         14640000
146700                                                                  14650000
146800     MOVE ZERO            TO  PV-DB2-COUNT.                       14660000
146900         EXEC SQL                                                 14670000
147000              SELECT                                              14680000
147100                    COUNT(*)                                      14690000
147200              INTO                                                14700000
147300                    :PV-DB2-COUNT :PV-NULL-IND                    14710000
147400              FROM                                                14720000
147500                    TRECITM                                       14730000
147600              WHERE                                               14740000
147700                    ORD_NBR            =  :DK-ORD-NBR             14750000
147800              AND   STATUS_CDE        ^=  :PV-COUNT-STATUS-CDE    14760000
147900              AND   REC_SEQ_NBR        =  :DK-REC-SEQ-NBR         14770000
148000              AND   VER_STATUS_CDE     =  :PC-A                   14780000
148100         END-EXEC                                                 14790000
148200                                                                  14800000
148300         EVALUATE TRUE                                            14810000
148400             WHEN SQLCODE = ZERO                                  14820000
148500             WHEN SQLCODE = +100                                  14830000
148600                  CONTINUE                                        14840000
148700             WHEN SQLWARN0 NOT = SPACE                            14850000
148800             WHEN SQLCODE NOT = ZERO                              14860000
148900                  MOVE 'C760-COUNT-TRECITM-ROWS'                  14870000
149000                                   TO DP013-PARAGRAPH             14880000
149100                  MOVE 'COUNT NUMBER OF "VE" STATUS RECITM ROWS'  14890000
149200                                   TO DP013-MESSAGE-TEXT (1)      14900000
149300                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          14910000
149400                  MOVE DK-REC-SEQ-NBR                             14920000
149500                                   TO PV-ERROR-RCVR-SEQ-NBR       14930000
149600                  STRING ' RCVR: '            DELIMITED BY SIZE   14940000
149700                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   14950000
149800                       '-'                    DELIMITED BY SIZE   14960000
149900                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   14970000
150000                                 INTO DP013-MESSAGE-TEXT (2)      14980000
150100                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    14990000
150200                  MOVE SQLCA       TO DP013-SQLCA                 15000000
150300                  SET DP013-DB2-ABEND                             15010000
150400                                   TO TRUE                        15020000
150500                  PERFORM Z999-ABEND                              15030000
150600         END-EVALUATE.                                            15040000
150700/                                                                 15050000
150800 C300-GET-TRECEIV-STATUS.                                         15060000
150900     INITIALIZE DCLTRECEIV.                                       15070000
151000                                                                  15080000
151100         EXEC SQL                                                 15090000
151200              SELECT                                              15100000
151300                 STATUS_CDE                                       15110000
151400            INTO                                                  15120000
151500                 :RECEIV-STATUS-CDE                               15130000
151600              FROM  TRECEIV                                       15140000
151700              WHERE                                               15150000
151800                     ORD_NBR          =  :DK-ORD-NBR              15160000
151900              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          15170000
152000              AND    VER_STATUS_CDE   =  :PC-A                    15180000
152100         END-EXEC                                                 15190000
152200                                                                  15200000
152300         EVALUATE TRUE                                            15210000
152400             WHEN SQLCODE = ZERO                                  15220000
152500                  SET PS-DATA-OK    TO  TRUE                      15230000
152600             WHEN SQLCODE = +100                                  15240000
152700                  SET PS-DATA-NOT-OK    TO  TRUE                  15250000
152800                                                                  15260000
152900             WHEN SQLWARN0 NOT = SPACE                            15270000
153000             WHEN SQLCODE NOT = ZERO                              15280000
153100                  MOVE 'C300-GET-TRECEIV-STATUS'                  15290000
153200                                   TO DP013-PARAGRAPH             15300000
153300                  MOVE 'SELECT TRECEIV'                           15310000
153400                                   TO DP013-MESSAGE-TEXT (1)      15320000
153500                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             15330000
153600                  MOVE DK-REC-SEQ-NBR                             15340000
153700                                   TO PV-ERROR-RCVR-SEQ-NBR       15350000
153800                  STRING ' RCVR: '            DELIMITED BY SIZE   15360000
153900                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   15370000
154000                       '-'                    DELIMITED BY SIZE   15380000
154100                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   15390000
154200                                 INTO DP013-MESSAGE-TEXT (2)      15400000
154300                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    15410000
154400                  MOVE SQLCA       TO DP013-SQLCA                 15420000
154500                  SET DP013-DB2-ABEND                             15430000
154600                                   TO TRUE                        15440000
154700                  PERFORM Z999-ABEND                              15450000
154800         END-EVALUATE.                                            15460000
154900/                                                                 15470000
155000*----------------------------------------------------------------*15480000
155100*    GET THE DATA.                                               *15490000
155200*     INSERT THE BEFORE ROW OF THE TRECEIV TABLE INTO THE        *15500000
155300*     RECEIV AUDIT TABLE.                                        *15510000
155400*     UPDATE THE CURRENT ROW                                     *15520000
155500*----------------------------------------------------------------*15530000
155600                                                                  15540000
155700 C400-UPDATE-TRECEIV-STATUS.                                      15550000
155800                                                                  15560000
155900     IF PS-DATA-OK                                                15570000
156000         MOVE DK-ORD-NBR     TO RC031-PO-NBR                      15580000
156100         MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR                 15590000
156200         MOVE RECDIS-OPER-UNT-ID                                  15600000
156300                             TO RC031-OPER-UNT-ID                 15610000
156400         MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID                    15620000
156500         MOVE PC-CURRENT-PROGRAM-NAME                             15630000
156600                             TO RC031-UPD-PGM-ID                  15640000
156700                                RC031-UPD-UID                     15650000
156800         MOVE PV-CURRENT-TIMESTAMP                                15660000
156900                             TO RC031-UPD-TMST                    15670000
157000         MOVE LENGTH OF RC031-FIELDS                              15680000
157100                             TO PV-AUDIT-RTN-LENGTH               15690000
157200*                                                                 15700000
157300         SET  RC031-AUDIT-TRECEIV                                 15710000
157400              RC031-BEFORE                                        15720000
157500              RC031-UPDATE   TO TRUE                              15730000
157600*                                                                 15740000
157700         EXEC CICS                                                15750000
157800              LINK PROGRAM  (PC-AUDIT-RTN)                        15760000
157900              COMMAREA      (RC031-FIELDS)                        15770000
158000              LENGTH        (PV-AUDIT-RTN-LENGTH)                 15780000
158100         END-EXEC                                                 15790000
158200*                                                                 15800000
158300         IF  RC031-CALL-SUCCESSFUL                                15810000
158400             CONTINUE                                             15820000
158500         ELSE                                                     15830000
158600             MOVE 'C400-UPDATE-TRECEIV-STATUS'                    15840000
158700                                     TO DP013-PARAGRAPH           15850000
158800             MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECEIV'    15860000
158900                                     TO DP013-MESSAGE-TEXT (1)    15870000
159000             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          15880000
159100             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         15890000
159200             STRING ' RCVR: '            DELIMITED BY SIZE        15900000
159300                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        15910000
159400                  '-'                    DELIMITED BY SIZE        15920000
159500                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        15930000
159600                                   INTO DP013-MESSAGE-TEXT (2)    15940000
159700             STRING RC031-RETURN-CODE    DELIMITED BY SIZE        15950000
159800                  '-'                    DELIMITED BY SIZE        15960000
159900                  RC031-RETURN-DESC      DELIMITED BY SIZE        15970000
160000                  '  SQL CODE: '         DELIMITED BY SIZE        15980000
160100                  RC031-SQLCODE          DELIMITED BY SIZE        15990000
160200                                   INTO DP013-MESSAGE-TEXT (3)    16000000
160300             MOVE RC031-SQLCA        TO DP013-SQLCA               16010000
160400             MOVE 'TAURECV '         TO DP013-DB2-TABLE-NAME (1)  16020000
160500             SET DP013-DB2-ABEND     TO TRUE                      16030000
160600                                                                  16040000
160700             PERFORM Z999-ABEND                                   16050000
160800         END-IF                                                   16060000
160900     END-IF.                                                      16070000
161000                                                                  16080000
161100     IF PS-DATA-OK                                                16090000
161200         MOVE PC-VE TO PV-STATUS-CDE                              16100000
161300         EVALUATE TRUE                                            16110000
161400           WHEN RC289-VERIF-CHECK-IN                              16120000
161500                MOVE PC-CHECK-IN  TO PV-VRFD-USR-ID               16130000
161600           WHEN RC289-VERIF-TRLR-UNLOAD                           16140000
161700           WHEN RC289-VERIF-TRLR-UNLOAD-AT-0                      16150000
161800                MOVE PC-TRLRUNLD  TO PV-VRFD-USR-ID               16160000
161900           WHEN RC289-VERIF-HOT-COMPLETE                          16170000
162000           WHEN RC289-VERIF-HOT-COMPLETE-0                        16180000
162100                MOVE PC-WO-HOTCM  TO PV-VRFD-USR-ID               16190000
162200           WHEN RC289-VERIF-SWEEPER                               16200000
162300                MOVE PC-SWEEPER   TO PV-VRFD-USR-ID               16210000
162400           WHEN RC289-VERIF-P2L                                   16220000
162500                MOVE PC-P2L       TO PV-VRFD-USR-ID               16230000
162600           WHEN RC289-CONFIRMATION                                16240000
162700                MOVE PC-CONFIRM    TO PV-VRFD-USR-ID              16250000
162800           WHEN OTHER                                             16260000
162900                MOVE RC289-USER-ID TO PV-VRFD-USR-ID              16270000
163000         END-EVALUATE                                             16280000
163100*        IF  RC289-CASE-PROCESS                                   16290000
163200*            MOVE PC-CASE               TO                        16300000
163300*                                  PV-VRFD-USR-ID                 16310000
163400*        ELSE                                                     16320000
163500*            IF  RC289-P2L-CASE-PROCESS                           16330000
163600*                MOVE PC-P2L-CASE       TO                        16340000
163700*                                  PV-VRFD-USR-ID                 16350000
163800*            ELSE                                                 16360000
163900*                MOVE PC-P2L            TO                        16370000
164000*                                  PV-VRFD-USR-ID                 16380000
164100*            END-IF                                               16390000
164200*        END-IF                                                   16400000
164300         PERFORM D600-UPDATE-TRECEIV                              16410000
164400         PERFORM B450-GET-TRECEIV-OPER-UNT-ID                     16420000
164500         IF PS-AUTO-VE-YES                                        16430000
164600             PERFORM C450-LINK-TO-FRASTY-HANDLER                  16440000
164700         END-IF                                                   16450000
164800         MOVE DK-ORD-NBR              TO PC238-PO-NBR             16460000
164900         MOVE DK-REC-SEQ-NBR          TO PC238-RCVR-SEQ-NBR       16470000
165000         MOVE RECEIV-CURR-OPER-UNT-ID TO PC238-WRKD-OPER-UNT-ID   16480000
165100         MOVE ZEROES                  TO PC238-PO-LNE-NBR         16490000
165200                                         PC238-WRKD-UNT-QTY       16500000
165300         MOVE PC-W TO PC238-TRANS-TYPE-CDE                        16510000
165400         PERFORM G400-UPDATE-UNITS-WRKD                           16520000
165500     END-IF.                                                      16530000
165600                                                                  16540000
165700 C450-LINK-TO-FRASTY-HANDLER.                                     16550000
165800                                                                  16560000
165900     INITIALIZE SU044-COMM-AREA.                                  16570000
166000     MOVE DK-ORD-NBR               TO SU044-PO.                   16580000
166100     MOVE DK-REC-SEQ-NBR           TO SU044-ORIG-REC-SEQ-NBR.     16590000
166200     MOVE RECEIV-CURR-OPER-UNT-ID  TO SU044-OPER-UNT-ID.          16600000
166300     MOVE 1                        TO SU044-FCLTY-ID.             16610000
166400     MOVE PC-CURRENT-PROGRAM-NAME  TO SU044-PROGRAM-NAME.         16620000
166500     SET  SU044-SRC-VERIFICATION   TO TRUE.                       16630000
166600     IF RECEIV-PACK-BY-ST-IND = 'Y'                               16640000
166700        SET SU044-RCVR-PBS         TO TRUE                        16650000
166800     ELSE                                                         16660000
166900        MOVE ZEROES                TO SU044-DEST-STR-NBR          16670000
167000        IF RECEIV-PKGNG-CDE = 'M' OR 'I'                          16680000
167100           SET SU044-RCVR-PREPK    TO TRUE                        16690000
167200        ELSE                                                      16700000
167300           SET SU044-RCVR-BULK     TO TRUE                        16710000
167400        END-IF                                                    16720000
167500     END-IF.                                                      16730000
167600                                                                  16740000
167700     MOVE LENGTH OF SU044-COMM-AREA TO  PV-COMMAREA-LENGTH.       16750000
167800                                                                  16760000
167900     EXEC CICS                                                    16770000
168000         LINK PROGRAM  (PC-FA-HANDLER-PGM)                        16780000
168100              COMMAREA (SU044-COMM-AREA)                          16790000
168200              LENGTH   (PV-COMMAREA-LENGTH)                       16800000
168300     END-EXEC.                                                    16810000
168400                                                                  16820000
168500                                                                  16830000
168600     EVALUATE TRUE                                                16840000
168700         WHEN SU044-SUCCESSFUL                                    16850000
168800              CONTINUE                                            16860000
168900                                                                  16870000
169000         WHEN OTHER                                               16880000
169100             MOVE 'C450-LINK-TO-FRASTY-HANDLER'                   16890000
169200                                  TO DP013-PARAGRAPH              16900000
169300             STRING ' SUCCESS IND = '                             16910000
169400                    SU044-SUCCESS-IND                             16920000
169500                         DELIMITED BY SIZE                        16930000
169600                                INTO DP013-MESSAGE-TEXT (1)       16940000
169700             MOVE SQLCA           TO DP013-SQLCA                  16950000
169800             SET DP013-DB2-ABEND     TO TRUE                      16960000
169900                                                                  16970000
170000             PERFORM Z999-ABEND                                   16980000
170100     END-EVALUATE.                                                16990000
170200                                                                  17000000
170300                                                                  17010000
170400******************************************************************17020000
170500* C500-CHECK-ODD-UNIT.                                           *17030000
170600*   THIS PARAGRAPH WILL CHECK FOR THE EXISTANCE OF ODD UNIT      *17040000
170700*   ENTRIES ON THE RCT_VRFD_ODD_UNT TABLE WITH A QUANTITY        *17050000
170800*   GREATER THAN 0.  IF THIS EXISTS, THEN SOMEONE KEYED ODD      *17060000
170900*   THROUGH THE VERIFY SCREENS BEFORE THE CONFIRMATION HAD       *17070000
171000*   BEEN DONE.  THIS PARAGRAPH WILL ZERO THAT DATA OUT SO THAT   *17080000
171100*   THE DATA ASSOCIATED WITH THE CONFIRMATION CAN BE APPLIED.    *17090000
171200******************************************************************17100000
171300 C500-CHECK-ODD-UNIT.                                             17110000
171400                                                                  17120000
171500     IF  DISTHD-PREPK-LNE-PRC-CDE = 'D'                           17130000
171600     OR  DISTHD-PREPK-LNE-PRC-CDE = 'P'                           17140000
171700         PERFORM C550-UPDATE-ODD-UNIT                             17150000
171800     END-IF.                                                      17160000
171900                                                                  17170000
172000******************************************************************17180000
172100* C550-UPDATE-ODD-UNIT.                                          *17190000
172200*   THIS PARAGRAPH WILL ATTEMPT TO UPDATE ANY ODD UNIT ROWS FOR  *17200000
172300*   PO/RECEIVER/LINE/STORE THAT EXISTS ON THE ODD UNIT TABLE TO  *17210000
172400*   A QUANTITY VALUE OF ZERO.                                    *17220000
172500******************************************************************17230000
172600 C550-UPDATE-ODD-UNIT.                                            17240000
172700         EXEC SQL                                                 17250000
172800              UPDATE RCT_VRFD_ODD_UNT                             17260000
172900              SET    DC_VRFY_ODU_QTY     =  0                     17270000
173000                    ,AP_VRFY_ODU_QTY     =  0                     17280000
173100              WHERE                                               17290000
173200                     PO_NBR           =  :DK-ORD-NBR              17300000
173300              AND    PO_LNE_NBR       =  :DK-ORD-LNE-NBR          17310000
173400              AND    RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR          17320000
173500              AND    STR_NBR          =  :DISTDT-STR-NBR          17330000
173600         END-EXEC                                                 17340000
173700                                                                  17350000
173800         EVALUATE TRUE                                            17360000
173900             WHEN SQLCODE = ZERO                                  17370000
174000             WHEN SQLCODE = +100                                  17380000
174100                  CONTINUE                                        17390000
174200             WHEN SQLWARN0 NOT = SPACE                            17400000
174300             WHEN SQLCODE NOT = ZERO                              17410000
174400                  MOVE 'C550-UPDATE-ODD-UNIT'                     17420000
174500                                   TO DP013-PARAGRAPH             17430000
174600                  MOVE 'UPDATE VERIFIED RECEIPT ODD UNIT TABLE'   17440000
174700                                   TO DP013-MESSAGE-TEXT (1)      17450000
174800                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             17460000
174900                  MOVE DK-REC-SEQ-NBR                             17470000
175000                                   TO PV-ERROR-RCVR-SEQ-NBR       17480000
175100                  MOVE DK-ORD-LNE-NBR                             17490000
175200                                   TO PV-ERROR-ORD-LNE-NBR        17500000
175300                  MOVE DISTDT-STR-NBR                             17510000
175400                                   TO PV-ERROR-STR-NBR            17520000
175500                  STRING ' RCVR: '            DELIMITED BY SIZE   17530000
175600                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   17540000
175700                       '-'                    DELIMITED BY SIZE   17550000
175800                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   17560000
175900                       '  LINE: '             DELIMITED BY SIZE   17570000
176000                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   17580000
176100                       '  STORE: '            DELIMITED BY SIZE   17590000
176200                       PV-ERROR-STR-NBR       DELIMITED BY SIZE   17600000
176300                                 INTO DP013-MESSAGE-TEXT (2)      17610000
176400                  MOVE 'RCT_VRFD_ODD_UNT'                         17620000
176500                                   TO DP013-DB2-TABLE-NAME (1)    17630000
176600                  MOVE SQLCA       TO DP013-SQLCA                 17640000
176700                  SET DP013-DB2-ABEND                             17650000
176800                                   TO TRUE                        17660000
176900                  PERFORM Z999-ABEND                              17670000
177000         END-EVALUATE.                                            17680000
177100                                                                  17690000
177200******************************************************************17700000
177300* C600-FETCH-DISTDT-CURSOR.                                       17710000
177400*                                                                *17720000
177500******************************************************************17730000
177600 C600-FETCH-DISTDT-CURSOR.                                        17740000
177700                                                                  17750000
177800     INITIALIZE DCLTDISTDT.                                       17760000
177900                                                                  17770000
178000     EXEC SQL                                                     17780000
178100          FETCH DISTDT-CURSOR                                     17790000
178200                                                                  17800000
178300          INTO                                                    17810000
178400               :DISTDT-ORD-NBR                                    17820000
178500             , :DISTDT-RCVR-SEQ-NBR                               17830000
178600             , :DISTDT-ORD-LNE-NBR                                17840000
178700             , :DISTDT-WRK-ORD-SEQ-NBR                            17850000
178800             , :DISTDT-STR-NBR                                    17860000
178900             , :DISTDT-EXPTED-ALLOC-QTY                           17870000
179000             , :DISTDT-ACTL-ALLOC-QTY                             17880000
179100             , :DISTDT-RCVG-PSTD-STAT-CDE                         17890000
179200             , :DISTDT-FCSE-ACTL-UNT-QTY                          17900000
179300             , :DISTDT-P2L-SPLT-UNT-QTY                           17910000
179400             , :DISTDT-FCSE-SPLT-UNT-QTY                          17920000
179500             , :DISTDT-INPK-SPLT-UNT-QTY                          17930000
179600             , :DISTDT-PREPK-ODD-UNT-QTY                          17940000
179700     END-EXEC.                                                    17950000
179800                                                                  17960000
179900     EVALUATE TRUE                                                17970000
180000         WHEN SQLCODE = ZERO                                      17980000
180100              CONTINUE                                            17990000
180200                                                                  18000000
180300         WHEN SQLCODE = PC-ROW-NOT-FOUND                          18010000
180400              SET PS-NO-DATA-LEFT-ON-TDISTDT                      18020000
180500                               TO  TRUE                           18030000
180600                                                                  18040000
180700         WHEN SQLWARN0 NOT EQUAL SPACE                            18050000
180800         WHEN SQLCODE NOT EQUAL ZERO                              18060000
180900              MOVE 'C600-FETCH-DISTDT-CURSOR'                     18070000
181000                               TO  DP013-PARAGRAPH                18080000
181100              MOVE 'FETCH TDISTDT CURSOR'                         18090000
181200                               TO  DP013-MESSAGE-TEXT (1)         18100000
181300              MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR                 18110000
181400              MOVE DK-REC-SEQ-NBR                                 18120000
181500                               TO PV-ERROR-RCVR-SEQ-NBR           18130000
181600              MOVE DK-ORD-LNE-NBR                                 18140000
181700                               TO PV-ERROR-ORD-LNE-NBR            18150000
181800              STRING ' RCVR: '            DELIMITED BY SIZE       18160000
181900                   PV-ERROR-ORD-NBR       DELIMITED BY SIZE       18170000
182000                   '-'                    DELIMITED BY SIZE       18180000
182100                   PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE       18190000
182200                   '  LINE: '             DELIMITED BY SIZE       18200000
182300                   PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE       18210000
182400                             INTO DP013-MESSAGE-TEXT (2)          18220000
182500              MOVE 'TDISTDT'   TO  DP013-DB2-TABLE-NAME (1)       18230000
182600              MOVE SQLCA       TO  DP013-SQLCA                    18240000
182700              SET DP013-DB2-ABEND                                 18250000
182800                               TO  TRUE                           18260000
182900              PERFORM Z999-ABEND                                  18270000
183000     END-EVALUATE.                                                18280000
183100/                                                                 18290000
183200 C700-SELECT-RECDIS.                                              18300000
183300                                                                  18310000
183400                                                                  18320000
183500     INITIALIZE DCLTRECDIS.                                       18330000
183600                                                                  18340000
183700         EXEC SQL                                                 18350000
183800             SELECT ORD_LNE_NBR,                                  18360000
183900                    OPER_UNT_ID,                                  18370000
184000                    VERIFY_ITM_QTY,                               18380000
184100                    STR_NBR,                                      18390000
184200                    CURRENT TIMESTAMP                             18400000
184300              INTO  :RECDIS-ORD-LNE-NBR,                          18410000
184400                    :RECDIS-OPER-UNT-ID,                          18420000
184500                    :RECDIS-VERIFY-ITM-QTY,                       18430000
184600                    :RECDIS-STR-NBR,                              18440000
184700                    :PV-CURRENT-TIMESTAMP                         18450000
184800               FROM TRECDIS                                       18460000
184900             WHERE   ORD_NBR             =  :DK-ORD-NBR           18470000
185000              AND    ORD_LNE_NBR         =  :DK-ORD-LNE-NBR       18480000
185100              AND    REC_SEQ_NBR         =  :DK-REC-SEQ-NBR       18490000
185300              AND    STR_NBR             =  :DISTDT-STR-NBR       18510000
185400         END-EXEC                                                 18520000
185500                                                                  18530000
185600         EVALUATE TRUE                                            18540000
185700             WHEN SQLCODE = ZERO                                  18550000
185800                 SET PS-DATA-OK     TO TRUE                       18560000
185900             WHEN SQLCODE = +100                                  18570000
186000                 SET PS-DATA-NOT-OK TO TRUE                       18580000
186100             WHEN SQLWARN0 NOT = SPACES                           18590000
186200             WHEN SQLCODE      NOT = ZERO                         18600000
186300                  MOVE 'C700-SELECT-RECDIS'                       18610000
186400                                 TO DP013-PARAGRAPH               18620000
186500                  MOVE 'UNSUCCESSFUL SELECT OF TRECDIS'           18630000
186600                                 TO DP013-MESSAGE-TEXT (1)        18640000
186700                  MOVE DK-ORD-NBR                                 18650000
186800                                 TO PV-ERROR-ORD-NBR              18660000
186900                  MOVE DK-REC-SEQ-NBR                             18670000
187000                                 TO PV-ERROR-RCVR-SEQ-NBR         18680000
187100                  MOVE DK-ORD-LNE-NBR                             18690000
187200                                 TO PV-ERROR-ORD-LNE-NBR          18700000
187300                  MOVE DISTDT-STR-NBR                             18710000
187400                                 TO PV-ERROR-STR-NBR              18720000
187500                  STRING ' RCVR: '            DELIMITED BY SIZE   18730000
187600                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   18740000
187700                       '-'                    DELIMITED BY SIZE   18750000
187800                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   18760000
187900                       '  LINE: '             DELIMITED BY SIZE   18770000
188000                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   18780000
188100                       '  STORE: '            DELIMITED BY SIZE   18790000
188200                       PV-ERROR-STR-NBR       DELIMITED BY SIZE   18800000
188300                                 INTO DP013-MESSAGE-TEXT (2)      18810000
188400                  MOVE SQLCA         TO DP013-SQLCA               18820000
188500                  MOVE 'TRECDIS' TO DP013-DB2-TABLE-NAME (1)      18830000
188600                  SET DP013-DB2-ABEND                             18840000
188700                      DP013-XCTL-DISPLAY-RESTART                  18850000
188800                                 TO TRUE                          18860000
188900                  PERFORM Z999-ABEND                              18870000
189000         END-EVALUATE.                                            18880000
189100                                                                  18890000
189200 C800-UPDATE-TRECDIS.                                             18900000
189300         EXEC SQL                                                 18910000
189400              UPDATE TRECDIS                                      18920000
189500              SET    AP_VERIFY_ITM_QTY   =  :PV-TOTAL-ALLOC-QTY   18930000
189600                    ,VERIFY_ITM_QTY      =  :PV-TOTAL-ALLOC-QTY   18940000
189700              WHERE                                               18950000
189800                     ORD_NBR          =  :DK-ORD-NBR              18960000
189900              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          18970000
190000              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          18980000
190200              AND    STR_NBR          =  :DISTDT-STR-NBR          19000000
190300         END-EXEC                                                 19010000
190400                                                                  19020000
190500         EVALUATE TRUE                                            19030000
190600             WHEN SQLCODE = ZERO                                  19040000
190700                  CONTINUE                                        19050000
190800             WHEN SQLWARN0 NOT = SPACE                            19060000
190900             WHEN SQLCODE NOT = ZERO                              19070000
191000                  MOVE 'C800-UPDATE-TRECDIS'                      19080000
191100                                   TO DP013-PARAGRAPH             19090000
191200                  MOVE 'UPDATE RECEIPT DISTRIBUTION TABLE'        19100000
191300                                   TO DP013-MESSAGE-TEXT (1)      19110000
191400                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             19120000
191500                  MOVE DK-REC-SEQ-NBR                             19130000
191600                                   TO PV-ERROR-RCVR-SEQ-NBR       19140000
191700                  MOVE DK-ORD-LNE-NBR                             19150000
191800                                   TO PV-ERROR-ORD-LNE-NBR        19160000
191900                  MOVE DISTDT-STR-NBR                             19170000
192000                                   TO PV-ERROR-STR-NBR            19180000
192100                  STRING ' RCVR: '            DELIMITED BY SIZE   19190000
192200                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   19200000
192300                       '-'                    DELIMITED BY SIZE   19210000
192400                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   19220000
192500                       '  LINE: '             DELIMITED BY SIZE   19230000
192600                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   19240000
192700                       '  STORE: '            DELIMITED BY SIZE   19250000
192800                       PV-ERROR-STR-NBR       DELIMITED BY SIZE   19260000
192900                                 INTO DP013-MESSAGE-TEXT (2)      19270000
193000                  MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (1)    19280000
193100                  MOVE SQLCA       TO DP013-SQLCA                 19290000
193200                  SET DP013-DB2-ABEND                             19300000
193300                                   TO TRUE                        19310000
193400                  PERFORM Z999-ABEND                              19320000
193500         END-EVALUATE.                                            19330000
193600                                                                  19340000
193700******************************************************************19350000
193800* C850-UPDATE-TDISTHD-ERR-STAT.                                  *19360000
193900*                                                                *19370000
194000* UPDATE THE STATUS ON THE TDISTHD ROW FOR THE SPECIFIED RECEIPT *19380000
194100* LINE ITEM TO AN ERROR STATUS ("E").                            *19390000
194200* IF ERROR IS BECAUSE OF INVENTORY CYCLE IN PROGRESS THE ERROR   *19400000
194300* STATUS WILL BE SET TO INVENTORY ERROR STATUS ("I")             *19410000
194400******************************************************************19420000
194500 C850-UPDATE-TDISTHD-ERR-STAT.                                    19430000
194600         EXEC SQL                                                 19440000
194700              UPDATE TDISTHD                                      19450000
194800              SET    PRCG_STAT_CDE    =  :PV-ERROR-STATUS         19460000
194900              WHERE                                               19470000
195000                     ORD_NBR          =  :DK-ORD-NBR              19480000
195100              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          19490000
195200              AND    RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR          19500000
195300         END-EXEC                                                 19510000
195400                                                                  19520000
195500         EVALUATE TRUE                                            19530000
195600             WHEN SQLCODE = ZERO                                  19540000
195700             WHEN SQLCODE = +100                                  19550000
195800                  CONTINUE                                        19560000
195900             WHEN SQLWARN0 NOT = SPACE                            19570000
196000             WHEN SQLCODE NOT = ZERO                              19580000
196100                  MOVE 'C850-UPDATE-TDISTHD-ERR-STAT'             19590000
196200                                   TO DP013-PARAGRAPH             19600000
196300                  MOVE 'UPDATE TRANSACTION HEADER TABLE'          19610000
196400                                   TO DP013-MESSAGE-TEXT (1)      19620000
196500                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             19630000
196600                  MOVE DK-REC-SEQ-NBR                             19640000
196700                                   TO PV-ERROR-RCVR-SEQ-NBR       19650000
196800                  MOVE DK-ORD-LNE-NBR                             19660000
196900                                   TO PV-ERROR-ORD-LNE-NBR        19670000
197000                  STRING ' RCVR: '            DELIMITED BY SIZE   19680000
197100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   19690000
197200                       '-'                    DELIMITED BY SIZE   19700000
197300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   19710000
197400                       '  LINE: '             DELIMITED BY SIZE   19720000
197500                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   19730000
197600                                 INTO DP013-MESSAGE-TEXT (2)      19740000
197700                  MOVE 'TDISTHD '  TO DP013-DB2-TABLE-NAME (1)    19750000
197800                  MOVE SQLCA       TO DP013-SQLCA                 19760000
197900                  SET DP013-DB2-ABEND                             19770000
198000                                   TO TRUE                        19780000
198100                  PERFORM Z999-ABEND                              19790000
198200         END-EVALUATE.                                            19800000
198300                                                                  19810000
198400                                                                  19820000
198500*----------------------------------------------------------------*19830000
198600* IF LINE BELONGS TO A PREPACK PROCESS REST OF LINES IN THE PREPK*19840000
198700*----------------------------------------------------------------*19850000
198800 C860-PROCESS-PREPK-ERROR.                                        19860000
198900     SET  PS-PREPK-LINES-LEFT     TO TRUE.                        19870000
199000                                                                  19880000
199100     MOVE DK-ORD-NBR              TO  DK-PREPK-PO-NBR.            19890000
199200     MOVE DK-REC-SEQ-NBR          TO  DK-PREPK-REC-SEQ-NBR.       19900000
199300     MOVE DK-ORD-LNE-NBR          TO  DK-PREPK-LINE-NBR.          19910000
199400                                                                  19920000
199500     PERFORM C890-SELECT-TRECITM.                                 19930000
199600                                                                  19940000
199700     MOVE RECITM-PREPK-ID         TO  DK-PREPK-ID.                19950000
199800                                                                  19960000
199900     PERFORM A410-OPEN-PREPK-CSR.                                 19970000
200000     PERFORM C870-FETCH-PREPK-CSR                                 19980000
200100       UNTIL PS-NO-PREPK-LINES-LEFT.                              19990000
200200     PERFORM A430-CLOSE-PREPK-CSR.                                20000000
200300                                                                  20010000
200400                                                                  20020000
200500*----------------------------------------------------------------*20030000
200600* FETCH PREPK LINE CURSOR                                        *20040000
200700*----------------------------------------------------------------*20050000
200800 C870-FETCH-PREPK-CSR.                                            20060000
200900                                                                  20070000
201000     EXEC SQL                                                     20080000
201100          FETCH PRE_PACK_LNE_CSR                                  20090000
201200           INTO :PV-PRPK-REC-ORD-LNE-NBR                          20100000
201300               ,:PV-PRPK-REC-PREPK-RATO-QTY                       20110000
201400     END-EXEC                                                     20120000
201500                                                                  20130000
201600     EVALUATE TRUE                                                20140000
201700         WHEN SQLCODE = ZERO                                      20150000
201800                                                                  20160000
201900              MOVE RC289-ORD-NBR           TO DK-PREPK-PO-NBR     20170000
202000              MOVE RC289-RCVR-SEQ-NBR      TO DK-PREPK-REC-SEQ-NBR20180000
202100              MOVE PV-PRPK-REC-ORD-LNE-NBR TO DK-PREPK-LINE-NBR   20190000
202200              PERFORM C880-UPDATE-TDISTHD-ERR-STAT                20200000
202300                                                                  20210000
202400                                                                  20220000
202500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          20230000
202600              SET PS-NO-PREPK-LINES-LEFT                          20240000
202700                               TO  TRUE                           20250000
202800                                                                  20260000
202900         WHEN SQLWARN0 NOT EQUAL SPACE                            20270000
203000         WHEN SQLCODE NOT EQUAL ZERO                              20280000
203100              MOVE 'A870-FETCH-PREPK-CSR'                         20290000
203200                               TO  DP013-PARAGRAPH                20300000
203300              MOVE 'FETCH PREPK CURSOR  '                         20310000
203400                               TO  DP013-MESSAGE-TEXT (1)         20320000
203500              MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR                 20330000
203600              MOVE DK-REC-SEQ-NBR                                 20340000
203700                               TO PV-ERROR-RCVR-SEQ-NBR           20350000
203800              MOVE DK-ORD-LNE-NBR                                 20360000
203900                               TO PV-ERROR-ORD-LNE-NBR            20370000
204000              STRING ' RCVR: '            DELIMITED BY SIZE       20380000
204100                   PV-ERROR-ORD-NBR       DELIMITED BY SIZE       20390000
204200                   '-'                    DELIMITED BY SIZE       20400000
204300                   PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE       20410000
204400                   '  LINE: '             DELIMITED BY SIZE       20420000
204500                   PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE       20430000
204600                             INTO DP013-MESSAGE-TEXT (2)          20440000
204700              MOVE 'TDISTDT'   TO  DP013-DB2-TABLE-NAME (1)       20450000
204800              MOVE SQLCA       TO  DP013-SQLCA                    20460000
204900              SET DP013-DB2-ABEND                                 20470000
205000                               TO  TRUE                           20480000
205100              PERFORM Z999-ABEND                                  20490000
205200     END-EVALUATE.                                                20500000
205300                                                                  20510000
205400                                                                  20520000
205500 C880-UPDATE-TDISTHD-ERR-STAT.                                    20530000
205600         EXEC SQL                                                 20540000
205700              UPDATE TDISTHD                                      20550000
205800              SET    PRCG_STAT_CDE    =  :PV-ERROR-STATUS         20560000
205900              WHERE                                               20570000
206000                     ORD_NBR          =  :DK-PREPK-PO-NBR         20580000
206100              AND    ORD_LNE_NBR      =  :DK-PREPK-LINE-NBR       20590000
206200              AND    RCVR_SEQ_NBR     =  :DK-PREPK-REC-SEQ-NBR    20600000
206300         END-EXEC                                                 20610000
206400                                                                  20620000
206500         EVALUATE TRUE                                            20630000
206600             WHEN SQLCODE = ZERO                                  20640000
206700             WHEN SQLCODE = +100                                  20650000
206800                  CONTINUE                                        20660000
206900             WHEN SQLWARN0 NOT = SPACE                            20670000
207000             WHEN SQLCODE NOT = ZERO                              20680000
207100                  MOVE 'C880-UPDATE-TDISTHD-ERR-STAT'             20690000
207200                                   TO DP013-PARAGRAPH             20700000
207300                  MOVE 'UPDATE TRANSACTION HEADER TABLE'          20710000
207400                                   TO DP013-MESSAGE-TEXT (1)      20720000
207500                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             20730000
207600                  MOVE DK-REC-SEQ-NBR                             20740000
207700                                   TO PV-ERROR-RCVR-SEQ-NBR       20750000
207800                  MOVE DK-ORD-LNE-NBR                             20760000
207900                                   TO PV-ERROR-ORD-LNE-NBR        20770000
208000                  STRING ' RCVR: '            DELIMITED BY SIZE   20780000
208100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   20790000
208200                       '-'                    DELIMITED BY SIZE   20800000
208300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   20810000
208400                       '  LINE: '             DELIMITED BY SIZE   20820000
208500                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   20830000
208600                                 INTO DP013-MESSAGE-TEXT (2)      20840000
208700                  MOVE 'TDISTHD '  TO DP013-DB2-TABLE-NAME (1)    20850000
208800                  MOVE SQLCA       TO DP013-SQLCA                 20860000
208900                  SET DP013-DB2-ABEND                             20870000
209000                                   TO TRUE                        20880000
209100                  PERFORM Z999-ABEND                              20890000
209200         END-EVALUATE.                                            20900000
209300                                                                  20910000
209400                                                                  20920000
209500*----------------------------------------------------------------*20930000
209600*    GET THE PREPK ID FOR ERROR                                  *20940000
209700*----------------------------------------------------------------*20950000
209800 C890-SELECT-TRECITM.                                             20960000
209900                                                                  20970000
210000         EXEC SQL                                                 20980000
210100              SELECT                                              20990000
210200                    PREPK_ID                                      21000000
210300              INTO                                                21010000
210400                    :RECITM-PREPK-ID                              21020000
210500              FROM                                                21030000
210600                    TRECITM                                       21040000
210700              WHERE                                               21050000
210800                     ORD_NBR          =  :DK-ORD-NBR              21060000
210900              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          21070000
211000              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          21080000
211100              AND    VER_STATUS_CDE   =  :PC-A                    21090000
211200         END-EXEC                                                 21100000
211300                                                                  21110000
211400         EVALUATE TRUE                                            21120000
211500             WHEN SQLCODE = ZERO                                  21130000
211600                  CONTINUE                                        21140000
211700             WHEN SQLCODE = +100                                  21150000
211800                  SET PS-DATA-NOT-OK    TO  TRUE                  21160000
211900             WHEN SQLWARN0 NOT = SPACE                            21170000
212000             WHEN SQLCODE NOT = ZERO                              21180000
212100                  MOVE 'C890-SELECT-TRECITM'                      21190000
212200                                   TO DP013-PARAGRAPH             21200000
212300                  MOVE 'SELECT TRECITM'                           21210000
212400                                   TO DP013-MESSAGE-TEXT (1)      21220000
212500                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             21230000
212600                  MOVE DK-REC-SEQ-NBR                             21240000
212700                                   TO PV-ERROR-RCVR-SEQ-NBR       21250000
212800                  MOVE DK-ORD-LNE-NBR                             21260000
212900                                   TO PV-ERROR-ORD-LNE-NBR        21270000
213000                  STRING ' RCVR: '            DELIMITED BY SIZE   21280000
213100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   21290000
213200                       '-'                    DELIMITED BY SIZE   21300000
213300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   21310000
213400                       '  LINE: '             DELIMITED BY SIZE   21320000
213500                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   21330000
213600                                 INTO DP013-MESSAGE-TEXT (2)      21340000
213700                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    21350000
213800                  MOVE SQLCA       TO DP013-SQLCA                 21360000
213900                  SET DP013-DB2-ABEND                             21370000
214000                                   TO TRUE                        21380000
214100                  PERFORM Z999-ABEND                              21390000
214200         END-EVALUATE.                                            21400000
214300/                                                                 21410000
214400                                                                  21420000
214500                                                                  21430000
214600******************************************************************21440000
214700 C900-UPDATE-DISTDT.                                              21450000
214800         EXEC SQL                                                 21460000
214900              UPDATE TDISTDT                                      21470000
215000              SET    RCVG_PSTD_STAT_CDE  = :PC-POSTED-STATUS      21480000
215100              WHERE                                               21490000
215200                     ORD_NBR          =  :DK-ORD-NBR              21500000
215300              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          21510000
215400              AND    RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR          21520000
215500              AND    STR_NBR          =  :RECDIS-STR-NBR          21530000
215600         END-EXEC                                                 21540000
215700                                                                  21550000
215800         EVALUATE TRUE                                            21560000
215900             WHEN SQLCODE = ZERO                                  21570000
216000                  CONTINUE                                        21580000
216100             WHEN SQLCODE = +100                                  21590000
216200                  CONTINUE                                        21600000
216300             WHEN SQLWARN0 NOT = SPACE                            21610000
216400             WHEN SQLCODE NOT = ZERO                              21620000
216500                  MOVE 'C900-UPDATE-DISTDT'                       21630000
216600                                   TO DP013-PARAGRAPH             21640000
216700                  MOVE 'UPDATE TDISTDT'                           21650000
216800                                   TO DP013-MESSAGE-TEXT (1)      21660000
216900                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             21670000
217000                  MOVE DK-REC-SEQ-NBR                             21680000
217100                                   TO PV-ERROR-RCVR-SEQ-NBR       21690000
217200                  MOVE DK-ORD-LNE-NBR                             21700000
217300                                   TO PV-ERROR-ORD-LNE-NBR        21710000
217400                  MOVE RECDIS-STR-NBR                             21720000
217500                                   TO PV-ERROR-STR-NBR            21730000
217600                  STRING ' RCVR: '            DELIMITED BY SIZE   21740000
217700                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   21750000
217800                       '-'                    DELIMITED BY SIZE   21760000
217900                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   21770000
218000                       '  LINE: '             DELIMITED BY SIZE   21780000
218100                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   21790000
218200                       '  STORE: '            DELIMITED BY SIZE   21800000
218300                       PV-ERROR-STR-NBR       DELIMITED BY SIZE   21810000
218400                                 INTO DP013-MESSAGE-TEXT (2)      21820000
218500                  MOVE 'TDISTDT '  TO DP013-DB2-TABLE-NAME (1)    21830000
218600                  MOVE SQLCA       TO DP013-SQLCA                 21840000
218700                  SET DP013-DB2-ABEND                             21850000
218800                                   TO TRUE                        21860000
218900                  PERFORM Z999-ABEND                              21870000
219000         END-EVALUATE.                                            21880000
219100******************************************************************21890000
219200 C905-UPDATE-DISTDT-FCSE-ACTL.                                    21900000
219300         EXEC SQL                                                 21910000
219400              UPDATE TDISTDT                                      21920000
219500              SET    FCSE_ACTL_UNT_QTY = :PV-FCSE-ACTL-ALLOC-QTY  21930000
219600                 ,   PREPK_ODD_UNT_QTY = :DISTDT-PREPK-ODD-UNT-QTY21940000
219700              WHERE                                               21950000
219800                     ORD_NBR          =  :DK-ORD-NBR              21960000
219900              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          21970000
220000              AND    RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR          21980000
220100              AND    STR_NBR          =  :RECDIS-STR-NBR          21990000
220200         END-EXEC                                                 22000000
220300                                                                  22010000
220400         EVALUATE TRUE                                            22020000
220500             WHEN SQLCODE = ZERO                                  22030000
220600                  CONTINUE                                        22040000
220700             WHEN SQLCODE = +100                                  22050000
220800                  CONTINUE                                        22060000
220900             WHEN SQLWARN0 NOT = SPACE                            22070000
221000             WHEN SQLCODE NOT = ZERO                              22080000
221100                  MOVE 'C905-UPDATE-DISTDT-FCSE-ACTL'             22090000
221200                                   TO DP013-PARAGRAPH             22100000
221300                  MOVE 'UPDATE TDISTDT'                           22110000
221400                                   TO DP013-MESSAGE-TEXT (1)      22120000
221500                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             22130000
221600                  MOVE DK-REC-SEQ-NBR                             22140000
221700                                   TO PV-ERROR-RCVR-SEQ-NBR       22150000
221800                  MOVE DK-ORD-LNE-NBR                             22160000
221900                                   TO PV-ERROR-ORD-LNE-NBR        22170000
222000                  MOVE RECDIS-STR-NBR                             22180000
222100                                   TO PV-ERROR-STR-NBR            22190000
222200                  STRING ' RCVR: '            DELIMITED BY SIZE   22200000
222300                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   22210000
222400                       '-'                    DELIMITED BY SIZE   22220000
222500                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   22230000
222600                       '  LINE: '             DELIMITED BY SIZE   22240000
222700                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   22250000
222800                       '  STORE: '            DELIMITED BY SIZE   22260000
222900                       PV-ERROR-STR-NBR       DELIMITED BY SIZE   22270000
223000                                 INTO DP013-MESSAGE-TEXT (2)      22280000
223100                  MOVE 'TDISTDT '  TO DP013-DB2-TABLE-NAME (1)    22290000
223200                  MOVE SQLCA       TO DP013-SQLCA                 22300000
223300                  SET DP013-DB2-ABEND                             22310000
223400                                   TO TRUE                        22320000
223500                  PERFORM Z999-ABEND                              22330000
223600         END-EVALUATE.                                            22340000
223700                                                                  22350000
223800 C910-ADD-TO-RECD-AUDIT.                                          22360000
223900     MOVE DK-ORD-NBR     TO RC031-PO-NBR.                         22370000
224000     MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR.                    22380000
224100     MOVE DK-ORD-LNE-NBR TO RC031-PO-LNE-NBR.                     22390000
224200     MOVE RECEIV-OPER-UNT-ID                                      22400000
224300                         TO RC031-OPER-UNT-ID.                    22410000
224400     MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID.                       22420000
224500     MOVE DISTDT-STR-NBR TO RC031-STR-NBR.                        22430000
224600     MOVE PC-CURRENT-PROGRAM-NAME                                 22440000
224700                         TO RC031-UPD-PGM-ID                      22450000
224800                            RC031-UPD-UID.                        22460000
224900     MOVE PV-CURRENT-TIMESTAMP                                    22470000
225000                         TO RC031-UPD-TMST.                       22480000
225100     MOVE LENGTH OF RC031-FIELDS                                  22490000
225200                         TO PV-AUDIT-RTN-LENGTH.                  22500000
225300*                                                                 22510000
225400     SET  RC031-AUDIT-TRECDIS                                     22520000
225500          RC031-BEFORE                                            22530000
225600          RC031-UPDATE   TO TRUE.                                 22540000
225700*                                                                 22550000
225800     EXEC CICS                                                    22560000
225900          LINK PROGRAM  (PC-AUDIT-RTN)                            22570000
226000          COMMAREA      (RC031-FIELDS)                            22580000
226100          LENGTH        (PV-AUDIT-RTN-LENGTH)                     22590000
226200     END-EXEC.                                                    22600000
226300*                                                                 22610000
226400     IF  RC031-CALL-SUCCESSFUL                                    22620000
226500         CONTINUE                                                 22630000
226600     ELSE                                                         22640000
226700         MOVE 'C910-ADD-TO-RECD-AUDIT'                            22650000
226800                                 TO DP013-PARAGRAPH               22660000
226900         MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECDIS'        22670000
227000                                 TO DP013-MESSAGE-TEXT (1)        22680000
227100         MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR              22690000
227200         MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR             22700000
227300         MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR          22710000
227400         MOVE RECDIS-STR-NBR     TO PV-ERROR-STR-NBR              22720000
227500         STRING ' RCVR: '            DELIMITED BY SIZE            22730000
227600              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            22740000
227700              '-'                    DELIMITED BY SIZE            22750000
227800              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            22760000
227900              '  LINE: '             DELIMITED BY SIZE            22770000
228000              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            22780000
228100              '  STORE: '            DELIMITED BY SIZE            22790000
228200              PV-ERROR-STR-NBR       DELIMITED BY SIZE            22800000
228300                               INTO DP013-MESSAGE-TEXT (2)        22810000
228400         STRING RC031-RETURN-CODE    DELIMITED BY SIZE            22820000
228500              '-'                    DELIMITED BY SIZE            22830000
228600              RC031-RETURN-DESC      DELIMITED BY SIZE            22840000
228700              '  SQL CODE: '         DELIMITED BY SIZE            22850000
228800              RC031-SQLCODE          DELIMITED BY SIZE            22860000
228900                               INTO DP013-MESSAGE-TEXT (3)        22870000
229000         MOVE RC031-SQLCA        TO DP013-SQLCA                   22880000
229100         MOVE 'TAURECD '         TO DP013-DB2-TABLE-NAME (1)      22890000
229200         SET DP013-DB2-ABEND     TO TRUE                          22900000
229300                                                                  22910000
229400         PERFORM Z999-ABEND                                       22920000
229500     END-IF.                                                      22930000
229600                                                                  22940000
229700 C920-PROCESS-ODD-UNIT.                                           22950000
229800        PERFORM C924-INSERT-ODD-UNIT.                             22960000
229900                                                                  22970000
230000                                                                  22980000
230100                                                                  22990000
230200 C924-INSERT-ODD-UNIT.                                            23000000
230300                                                                  23010000
230400                                                                  23020000
230500         EXEC SQL                                                 23030000
230600             INSERT  INTO RCT_VRFD_ODD_UNT                        23040000
230700                    (PO_NBR                                       23050000
230800                    ,PO_LNE_NBR                                   23060000
230900                    ,RCVR_SEQ_NBR                                 23070000
231000                    ,STR_NBR                                      23080000
231100                    ,DC_VRFY_ODU_QTY                              23090000
231200                    ,AP_VRFY_ODU_QTY)                             23100000
231300             VALUES                                               23110000
231400                    (:DK-ORD-NBR                                  23120000
231500                    ,:DK-ORD-LNE-NBR                              23130000
231600                    ,:DK-REC-SEQ-NBR                              23140000
231700                    ,:DISTDT-STR-NBR                              23150000
231800                    ,:DISTDT-PREPK-ODD-UNT-QTY                    23160000
231900                    ,:DISTDT-PREPK-ODD-UNT-QTY                    23170000
232000                                              )                   23180000
232100                                                                  23190000
232200         END-EXEC                                                 23200000
232300                                                                  23210000
232400         EVALUATE TRUE                                            23220000
232500             WHEN SQLCODE = ZERO                                  23230000
232600                  CONTINUE                                        23240000
232700             WHEN SQLCODE = -803                                  23250000
232800                MOVE DISTDT-PREPK-ODD-UNT-QTY TO                  23260000
232900                                         RCT00009-DC-VRFY-ODU-QTY 23270000
233000                                         RCT00009-AP-VRFY-ODU-QTY 23280000
233100                                                                  23290000
233200                PERFORM C926-UPDATE-ODD-UNIT                      23300000
233300                                                                  23310000
233400             WHEN SQLWARN0 NOT = SPACES                           23320000
233500             WHEN SQLCODE  NOT = ZERO                             23330000
233600                  MOVE 'C924-INSERT-ODD-UNIT'                     23340000
233700                                 TO DP013-PARAGRAPH               23350000
233800                  MOVE 'UNSUCCESSFUL INSERT OF RCT_VRFD_ODD_UNT'  23360000
233900                                 TO DP013-MESSAGE-TEXT (1)        23370000
234000                  PERFORM C928-FORMAT-COMMON-ABEND-MSG            23380000
234100         END-EVALUATE.                                            23390000
234200                                                                  23400000
234300                                                                  23410000
234400 C926-UPDATE-ODD-UNIT.                                            23420000
234500         EXEC SQL                                                 23430000
234600             UPDATE  RCT_VRFD_ODD_UNT                             23440000
234700                SET  DC_VRFY_ODU_QTY =                            23450000
234800                    :RCT00009-DC-VRFY-ODU-QTY                     23460000
234900                   , AP_VRFY_ODU_QTY =                            23470000
235000                    :RCT00009-AP-VRFY-ODU-QTY                     23480000
235100                                                                  23490000
235200                WHERE PO_NBR         = :DK-ORD-NBR                23500000
235300                  AND PO_LNE_NBR     = :DK-ORD-LNE-NBR            23510000
235400                  AND RCVR_SEQ_NBR   = :DK-REC-SEQ-NBR            23520000
235500                  AND STR_NBR        = :DISTDT-STR-NBR            23530000
235600         END-EXEC                                                 23540000
235700                                                                  23550000
235800         EVALUATE TRUE                                            23560000
235900             WHEN SQLCODE = ZERO                                  23570000
236000                  CONTINUE                                        23580000
236100             WHEN SQLWARN0 NOT = SPACES                           23590000
236200             WHEN SQLCODE  NOT = ZERO                             23600000
236300                  MOVE 'C926-UPDATE-ODD-UNIT'                     23610000
236400                                 TO DP013-PARAGRAPH               23620000
236500                  MOVE 'UNSUCCESSFUL UPDATE OF RCT_VRFD_ODD_UNT'  23630000
236600                                 TO DP013-MESSAGE-TEXT (1)        23640000
236700                  PERFORM C928-FORMAT-COMMON-ABEND-MSG            23650000
236800         END-EVALUATE.                                            23660000
236900                                                                  23670000
237000                                                                  23680000
237100 C928-FORMAT-COMMON-ABEND-MSG.                                    23690000
237200                                                                  23700000
237300     MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR.                 23710000
237400     MOVE DK-REC-SEQ-NBR     TO PV-ERROR-RCVR-SEQ-NBR.            23720000
237500     MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR.             23730000
237600                                                                  23740000
237700     STRING ' RCVR: '                                             23750000
237800          PV-ERROR-ORD-NBR                                        23760000
237900          '-'                                                     23770000
238000          PV-ERROR-RCVR-SEQ-NBR                                   23780000
238100          '  LINE: '                                              23790000
238200          PV-ERROR-ORD-LNE-NBR                                    23800000
238300          '  STORE: '                                             23810000
238400          PV-ERROR-STR-NBR       DELIMITED BY SIZE                23820000
238500                           INTO DP013-MESSAGE-TEXT (2).           23830000
238600                                                                  23840000
238700     MOVE SQLCA     TO DP013-SQLCA.                               23850000
238800     MOVE 'RCT00009' TO DP013-DB2-TABLE-NAME (1).                 23860000
238900     SET DP013-DB2-ABEND                                          23870000
239000         DP013-XCTL-DISPLAY-RESTART                               23880000
239100                    TO TRUE.                                      23890000
239200     PERFORM Z999-ABEND.                                          23900000
239300                                                                  23910000
239400                                                                  23920000
239500*----------------------------------------------------------------*23930000
239600*    TO UPDATE A ROW, THE CURRENT ROW IS ADDED TO THE            *23940000
239700*    AUDIT FILE AS THE 'BEFORE' ROW.  THE ROW IS THEN UPDATED    *23950000
239800*    ON RECITM AND THIS ROW AS ADDED TO THE AUDIT TABLE AS       *23960000
239900*    THE AFTER ROW.                                              *23970000
240000*----------------------------------------------------------------*23980000
240100 D760-UPDATE-TRECITM.                                             23990000
240200                                                                  24000000
240300     SET PS-DATA-OK          TO  TRUE                             24010000
240400     PERFORM E100-SELECT-TRECITM.                                 24020000
240500*                                                                 24030000
240600     IF  PS-DATA-OK                                               24040000
240700         MOVE DK-ORD-NBR     TO RC031-PO-NBR                      24050000
240800         MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR                 24060000
240900         MOVE DK-ORD-LNE-NBR TO RC031-PO-LNE-NBR                  24070000
241000         MOVE RECDIS-OPER-UNT-ID                                  24080000
241100                             TO RC031-OPER-UNT-ID                 24090000
241200         MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID                    24100000
241300         MOVE PC-CURRENT-PROGRAM-NAME                             24110000
241400                             TO RC031-UPD-PGM-ID                  24120000
241500                                RC031-UPD-UID                     24130000
241600         MOVE PV-CURRENT-TIMESTAMP                                24140000
241700                             TO RC031-UPD-TMST                    24150000
241800         MOVE LENGTH OF RC031-FIELDS                              24160000
241900                             TO PV-AUDIT-RTN-LENGTH               24170000
242000*                                                                 24180000
242100         SET  RC031-AUDIT-TRECITM                                 24190000
242200              RC031-BEFORE                                        24200000
242300              RC031-UPDATE   TO TRUE                              24210000
242400*                                                                 24220000
242500         EXEC CICS                                                24230000
242600              LINK PROGRAM  (PC-AUDIT-RTN)                        24240000
242700              COMMAREA      (RC031-FIELDS)                        24250000
242800              LENGTH        (PV-AUDIT-RTN-LENGTH)                 24260000
242900         END-EXEC                                                 24270000
243000*                                                                 24280000
243100         IF  RC031-CALL-SUCCESSFUL                                24290000
243200             CONTINUE                                             24300000
243300         ELSE                                                     24310000
243400             MOVE 'D760-UPDATE-TRECITM'                           24320000
243500                                     TO DP013-PARAGRAPH           24330000
243600             MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECITM'    24340000
243700                                     TO DP013-MESSAGE-TEXT (1)    24350000
243800             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          24360000
243900             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         24370000
244000             MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR      24380000
244100             STRING ' RCVR: '            DELIMITED BY SIZE        24390000
244200                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        24400000
244300                  '-'                    DELIMITED BY SIZE        24410000
244400                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        24420000
244500                  '  LINE: '             DELIMITED BY SIZE        24430000
244600                  PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE        24440000
244700                                   INTO DP013-MESSAGE-TEXT (2)    24450000
244800             STRING RC031-RETURN-CODE    DELIMITED BY SIZE        24460000
244900                  '-'                    DELIMITED BY SIZE        24470000
245000                  RC031-RETURN-DESC      DELIMITED BY SIZE        24480000
245100                  '  SQL CODE: '         DELIMITED BY SIZE        24490000
245200                  RC031-SQLCODE          DELIMITED BY SIZE        24500000
245300                                   INTO DP013-MESSAGE-TEXT (3)    24510000
245400             MOVE RC031-SQLCA        TO DP013-SQLCA               24520000
245500             MOVE 'TAURECI '         TO DP013-DB2-TABLE-NAME (1)  24530000
245600             SET DP013-DB2-ABEND     TO TRUE                      24540000
245700                                                                  24550000
245800             PERFORM Z999-ABEND                                   24560000
245900         END-IF                                                   24570000
246000     END-IF.                                                      24580000
246100                                                                  24590000
246200     IF  PS-DATA-OK                                               24600000
246300         EVALUATE TRUE                                            24610000
246400           WHEN RC289-VERIF-CHECK-IN                              24620000
246500                MOVE PC-CHECK-IN  TO PV-VRFD-USR-ID               24630000
246600           WHEN RC289-VERIF-TRLR-UNLOAD                           24640000
246700           WHEN RC289-VERIF-TRLR-UNLOAD-AT-0                      24650000
246800                MOVE PC-TRLRUNLD  TO PV-VRFD-USR-ID               24660000
246900           WHEN RC289-VERIF-HOT-COMPLETE                          24670000
247000           WHEN RC289-VERIF-HOT-COMPLETE-0                        24680000
247100                MOVE PC-WO-HOTCM  TO PV-VRFD-USR-ID               24690000
247200           WHEN RC289-VERIF-SWEEPER                               24700000
247300                MOVE PC-SWEEPER   TO PV-VRFD-USR-ID               24710000
247400           WHEN RC289-VERIF-P2L                                   24720000
247500                MOVE PC-P2L       TO PV-VRFD-USR-ID               24730000
247600           WHEN RC289-CONFIRMATION                                24740000
247700                MOVE PC-CONFIRM    TO PV-VRFD-USR-ID              24750000
247800           WHEN OTHER                                             24760000
247900                MOVE RC289-USER-ID TO PV-VRFD-USR-ID              24770000
248000         END-EVALUATE                                             24780000
248100*            IF  RC289-CASE-PROCESS                               24790000
248200*                MOVE PC-CASE               TO                    24800000
248300*                                      PV-VRFD-USR-ID             24810000
248400*            ELSE                                                 24820000
248500*                IF  RC289-P2L-CASE-PROCESS                       24830000
248600*                    MOVE PC-P2L-CASE       TO                    24840000
248700*                                      PV-VRFD-USR-ID             24850000
248800*                ELSE                                             24860000
248900*                    MOVE PC-P2L            TO                    24870000
249000*                                      PV-VRFD-USR-ID             24880000
249100*                END-IF                                           24890000
249200*            END-IF                                               24900000
249300         IF PS-PROCESSING-CURSOR                                  24910000
249400             PERFORM E750-UPDATE-TRECITM-CURRENT                  24920000
249500         ELSE                                                     24930000
249600             PERFORM E700-UPDATE-TRECITM-ACTUAL                   24940000
249700         END-IF                                                   24950000
249800     END-IF.                                                      24960000
249900/                                                                 24970000
250000*----------------------------------------------------------------*24980000
250100*    UPDATE THE STATUS ON THE PURITM ROW.                        *24990000
250200*----------------------------------------------------------------*25000000
250300                                                                  25010000
250400 D300-CHECK-POLINE-FOR-UPDATE.                                    25020000
250500                                                                  25030000
250600     MOVE ZERO                  TO  PURITM-UNT-QTY.               25040000
250700     PERFORM E300-GET-PO-UNT-QTY.                                 25050000
250800     IF  PURITM-UNT-QTY GREATER THAN ZERO                         25060000
250900         MOVE ZERO              TO  RECDIS-AP-VERIFY-ITM-QTY      25070000
251000         PERFORM E400-GET-RECDIS-QTY                              25080000
251100         IF  PURITM-UNT-QTY NOT GREATER RECDIS-AP-VERIFY-ITM-QTY  25090000
251200             PERFORM E500-UPDATE-PURITM-PROCESS                   25100000
251300***          PERFORM E600-CHECK-PURCHS-FOR-UPDATE                 25110000
251400     END-IF.                                                      25120000
251500/                                                                 25130000
251600 D600-UPDATE-TRECEIV.                                             25140000
251700                                                                  25150000
251800         EXEC SQL                                                 25160000
251900              UPDATE                                              25170000
252000                    TRECEIV                                       25180000
252100              SET   STATUS_CDE    =  :PV-STATUS-CDE               25190000
252200                   ,VERFYD_TMST   =   CURRENT TIMESTAMP           25200000
252300                   ,UPD_TMST      =   CURRENT TIMESTAMP           25210000
252400                   ,UPD_PGM_ID    =  :PC-CURRENT-PROGRAM-NAME     25220000
252500                   ,VRFD_USR_ID   =  :PV-VRFD-USR-ID              25230000
252600              WHERE                                               25240000
252700                     ORD_NBR      =  :DK-ORD-NBR                  25250000
252800              AND    REC_SEQ_NBR  =  :DK-REC-SEQ-NBR              25260000
252900              AND    VER_STATUS_CDE   =  :PC-A                    25270000
253000         END-EXEC                                                 25280000
253100                                                                  25290000
253200         EVALUATE TRUE                                            25300000
253300             WHEN SQLCODE = ZERO                                  25310000
253400                  CONTINUE                                        25320000
253500             WHEN SQLCODE NOT = ZERO                              25330000
253600                  MOVE 'D600-UPDATE-TRECEIV'                      25340000
253700                                   TO DP013-PARAGRAPH             25350000
253800                  MOVE 'UPDATE TRECEIV STATUS CODE'               25360000
253900                                   TO DP013-MESSAGE-TEXT (1)      25370000
254000                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             25380000
254100                  MOVE DK-REC-SEQ-NBR                             25390000
254200                                   TO PV-ERROR-RCVR-SEQ-NBR       25400000
254300                  STRING ' RCVR: '            DELIMITED BY SIZE   25410000
254400                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   25420000
254500                       '-'                    DELIMITED BY SIZE   25430000
254600                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   25440000
254700                                 INTO DP013-MESSAGE-TEXT (2)      25450000
254800                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    25460000
254900                  MOVE SQLCA       TO DP013-SQLCA                 25470000
255000                  SET DP013-DB2-ABEND                             25480000
255100                                   TO TRUE                        25490000
255200                  PERFORM Z999-ABEND                              25500000
255300         END-EVALUATE.                                            25510000
255400                                                                  25520000
255500*----------------------------------------------------------------*25530000
255600*    THIS PARAGRAPH WILL FORMAT THE DATA TO BE INSERTED INTO     *25540000
255700*    THE RECEIPT VERIFICATION SOURCE DATA AND THEN CALL THE      *25550000
255800*    PARAGRAPH TO PERFORM THE INSERT.                            *25560000
255900*----------------------------------------------------------------*25570000
256000 D700-LOG-VERIFY-SOURCE.                                          25580000
256100                                                                  25590000
256200     INITIALIZE DCLTRECDVS.                                       25600000
256300                                                                  25610000
256400     IF  DISTDT-P2L-SPLT-UNT-QTY = ZERO                           25620000
256500     AND DISTDT-ACTL-ALLOC-QTY = ZERO                             25630000
256600         CONTINUE                                                 25640000
256700     ELSE                                                         25650000
256800         MOVE DISTDT-ORD-NBR           TO RECDVS-ORD-NBR          25660000
256900         MOVE DISTDT-RCVR-SEQ-NBR      TO RECDVS-REC-SEQ-NBR      25670000
257000         MOVE DISTDT-ORD-LNE-NBR       TO RECDVS-ORD-LNE-NBR      25680000
257100         MOVE DISTDT-STR-NBR           TO RECDVS-STR-NBR          25690000
257200         MOVE PC-P2                    TO RECDVS-VRFY-SRC-CDE     25700000
257300         MOVE DISTDT-P2L-SPLT-UNT-QTY  TO RECDVS-EXPTED-ITM-QTY   25710000
257400         MOVE DISTDT-ACTL-ALLOC-QTY    TO RECDVS-VRFY-ITM-QTY     25720000
257500         MOVE PC-A                     TO RECDVS-VER-STAT-CDE     25730000
257600         PERFORM D710-INSERT-TRECDVS                              25740000
257700         IF  SQLCODE = PC-ROW-ALREADY-PRESENT                     25750000
257800             IF PS-AUTO-VE-YES                                    25760000
257900                MOVE RC074-EXPTED-ITM-QTY TO RECDVS-EXPTED-ITM-QTY25770000
258000                MOVE RC074-VERIFY-ITM-QTY TO RECDVS-VRFY-ITM-QTY  25780000
258100             END-IF                                               25790000
258200             PERFORM D720-UPDATE-TRECDVS                          25800000
258300         END-IF                                                   25810000
258400     END-IF.                                                      25820000
258500                                                                  25830000
258600     IF  DISTDT-FCSE-SPLT-UNT-QTY = ZERO                          25840000
258700     AND DISTDT-INPK-SPLT-UNT-QTY = ZERO                          25850000
258800     AND DISTDT-FCSE-ACTL-UNT-QTY = ZERO                          25860000
258900         CONTINUE                                                 25870000
259000     ELSE                                                         25880000
259100         MOVE DISTDT-ORD-NBR           TO RECDVS-ORD-NBR          25890000
259200         MOVE DISTDT-RCVR-SEQ-NBR      TO RECDVS-REC-SEQ-NBR      25900000
259300         MOVE DISTDT-ORD-LNE-NBR       TO RECDVS-ORD-LNE-NBR      25910000
259400         MOVE DISTDT-STR-NBR           TO RECDVS-STR-NBR          25920000
259500         MOVE PC-A                     TO RECDVS-VER-STAT-CDE     25930000
259600         COMPUTE RECDVS-EXPTED-ITM-QTY =                          25940000
259700                 (DISTDT-FCSE-SPLT-UNT-QTY +                      25950000
259800                  DISTDT-INPK-SPLT-UNT-QTY)                       25960000
259900         COMPUTE RECDVS-VRFY-ITM-QTY =                            25970000
260000                 (DISTDT-FCSE-ACTL-UNT-QTY +                      25980000
260100                  DISTDT-PREPK-ODD-UNT-QTY)                       25990000
260200*        MOVE DISTDT-FCSE-ACTL-UNT-QTY TO RECDVS-VRFY-ITM-QTY     26000000
260300         MOVE PC-CP                    TO RECDVS-VRFY-SRC-CDE     26010000
260400         PERFORM D710-INSERT-TRECDVS                              26020000
260500         IF  SQLCODE = PC-ROW-ALREADY-PRESENT                     26030000
260600             IF PS-AUTO-VE-YES                                    26040000
260700                MOVE RC074-EXPTED-ITM-QTY TO RECDVS-EXPTED-ITM-QTY26050000
260800                MOVE RC074-VERIFY-ITM-QTY TO RECDVS-VRFY-ITM-QTY  26060000
260900             END-IF                                               26070000
261000             PERFORM D720-UPDATE-TRECDVS                          26080000
261100         END-IF                                                   26090000
261200     END-IF.                                                      26100000
261300                                                                  26110000
261400*----------------------------------------------------------------*26120000
261500*    INSERT THE ROW INTO THE RECEIPT VERIFICATION SOURCE TABLE   *26130000
261600*----------------------------------------------------------------*26140000
261700                                                                  26150000
261800 D710-INSERT-TRECDVS.                                             26160000
261900                                                                  26170000
262000                                                                  26180000
262100         EXEC SQL                                                 26190000
262200              INSERT                                              26200000
262300              INTO  TRECDVS                                       26210000
262400                 (ORD_NBR                                         26220000
262500                 ,ORD_LNE_NBR                                     26230000
262600                 ,REC_SEQ_NBR                                     26240000
262700                 ,STR_NBR                                         26250000
262800                 ,VRFY_SRC_CDE                                    26260000
262900                 ,EXPTED_ITM_QTY                                  26270000
263000                 ,VRFY_ITM_QTY                                    26280000
263100                 ,VER_STAT_CDE)                                   26290000
263200            VALUES                                                26300000
263300                  (:RECDVS-ORD-NBR                                26310000
263400                  ,:RECDVS-ORD-LNE-NBR                            26320000
263500                  ,:RECDVS-REC-SEQ-NBR                            26330000
263600                  ,:RECDVS-STR-NBR                                26340000
263700                  ,:RECDVS-VRFY-SRC-CDE                           26350000
263800                  ,:RECDVS-EXPTED-ITM-QTY                         26360000
263900                  ,:RECDVS-VRFY-ITM-QTY                           26370000
264000                  ,:RECDVS-VER-STAT-CDE)                          26380000
264100         END-EXEC                                                 26390000
264200                                                                  26400000
264300         EVALUATE TRUE                                            26410000
264400             WHEN SQLCODE = ZERO                                  26420000
264500             WHEN SQLCODE = -803                                  26430000
264600                  CONTINUE                                        26440000
264700             WHEN SQLWARN0 NOT = SPACES                           26450000
264800             WHEN SQLCODE NOT EQUAL ZERO                          26460000
264900                 MOVE 'D710-INSERT-TRECDVS'                       26470000
265000                                   TO DP013-PARAGRAPH             26480000
265100                 MOVE 'INSERT RECEIPT VERIFY SOURCE ROW'          26490000
265200                                   TO DP013-MESSAGE-TEXT (1)      26500000
265300                 MOVE RECDVS-ORD-NBR                              26510000
265400                                   TO PV-ERROR-ORD-NBR            26520000
265500                 MOVE RECDVS-REC-SEQ-NBR                          26530000
265600                                   TO PV-ERROR-RCVR-SEQ-NBR       26540000
265700                 MOVE RECDVS-ORD-LNE-NBR                          26550000
265800                                   TO PV-ERROR-ORD-LNE-NBR        26560000
265900                 MOVE RECDVS-STR-NBR                              26570000
266000                                   TO PV-ERROR-STR-NBR            26580000
266100                 MOVE RECDVS-VRFY-SRC-CDE                         26590000
266200                                   TO PV-ERROR-SOURCE             26600000
266300                 STRING ' RCVR: '            DELIMITED BY SIZE    26610000
266400                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    26620000
266500                      '-'                    DELIMITED BY SIZE    26630000
266600                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    26640000
266700                      '  LINE: '             DELIMITED BY SIZE    26650000
266800                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    26660000
266900                      '  STORE: '            DELIMITED BY SIZE    26670000
267000                      PV-ERROR-STR-NBR       DELIMITED BY SIZE    26680000
267100                      ' SOURCE: '            DELIMITED BY SIZE    26690000
267200                      PV-ERROR-SOURCE        DELIMITED BY SIZE    26700000
267300                                 INTO DP013-MESSAGE-TEXT (2)      26710000
267400                  MOVE SQLCA       TO DP013-SQLCA                 26720000
267500                  MOVE 'TRECDVS'   TO DP013-DB2-TABLE-NAME (1)    26730000
267600                  SET DP013-DB2-ABEND                             26740000
267700                      DP013-ROLLBACK                              26750000
267800                                   TO TRUE                        26760000
267900                  PERFORM 9990-WRITE-CICS                         26770000
268000         END-EVALUATE.                                            26780000
268100*                                                                 26790000
268200*                                                                 26800000
268300 EJECT                                                            26810000
268400 D720-UPDATE-TRECDVS.                                             26820000
268500                                                                  26830000
268600                                                                  26840000
268700         EXEC SQL                                                 26850000
268800              UPDATE TRECDVS                                      26860000
268900                  SET VER_STAT_CDE    = :RECDVS-VER-STAT-CDE      26870000
269000                    , EXPTED_ITM_QTY  = :RECDVS-EXPTED-ITM-QTY    26880000
269100                    , VRFY_ITM_QTY    = :RECDVS-VRFY-ITM-QTY      26890000
269200              WHERE                                               26900000
269300                      ORD_NBR         = :RECDVS-ORD-NBR           26910000
269400                AND   ORD_LNE_NBR     = :RECDVS-ORD-LNE-NBR       26920000
269500                AND   REC_SEQ_NBR     = :RECDVS-REC-SEQ-NBR       26930000
269600                AND   STR_NBR         = :RECDVS-STR-NBR           26940000
269700                AND   VRFY_SRC_CDE    = :RECDVS-VRFY-SRC-CDE      26950000
269800         END-EXEC                                                 26960000
269900                                                                  26970000
270000         EVALUATE TRUE                                            26980000
270100             WHEN SQLCODE = ZERO                                  26990000
270200                  CONTINUE                                        27000000
270300             WHEN SQLWARN0 NOT = SPACES                           27010000
270400             WHEN SQLCODE NOT EQUAL ZERO                          27020000
270500                 MOVE 'D720-UPDATE-TRECDVS'                       27030000
270600                                   TO DP013-PARAGRAPH             27040000
270700                 MOVE 'UPDATE RECEIPT VERIFY SOURCE ROW'          27050000
270800                                   TO DP013-MESSAGE-TEXT (1)      27060000
270900                 MOVE RECDVS-ORD-NBR                              27070000
271000                                   TO PV-ERROR-ORD-NBR            27080000
271100                 MOVE RECDVS-REC-SEQ-NBR                          27090000
271200                                   TO PV-ERROR-RCVR-SEQ-NBR       27100000
271300                 MOVE RECDVS-ORD-LNE-NBR                          27110000
271400                                   TO PV-ERROR-ORD-LNE-NBR        27120000
271500                 MOVE RECDVS-STR-NBR                              27130000
271600                                   TO PV-ERROR-STR-NBR            27140000
271700                 MOVE RECDVS-VRFY-SRC-CDE                         27150000
271800                                   TO PV-ERROR-SOURCE             27160000
271900                 STRING ' RCVR: '            DELIMITED BY SIZE    27170000
272000                      PV-ERROR-ORD-NBR       DELIMITED BY SIZE    27180000
272100                      '-'                    DELIMITED BY SIZE    27190000
272200                      PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE    27200000
272300                      '  LINE: '             DELIMITED BY SIZE    27210000
272400                      PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE    27220000
272500                      '  STORE: '            DELIMITED BY SIZE    27230000
272600                      PV-ERROR-STR-NBR       DELIMITED BY SIZE    27240000
272700                      ' SOURCE: '            DELIMITED BY SIZE    27250000
272800                      PV-ERROR-SOURCE        DELIMITED BY SIZE    27260000
272900                                 INTO DP013-MESSAGE-TEXT (2)      27270000
273000                  MOVE SQLCA       TO DP013-SQLCA                 27280000
273100                  MOVE 'TRECDVS'   TO DP013-DB2-TABLE-NAME (1)    27290000
273200                  SET DP013-DB2-ABEND                             27300000
273300                      DP013-ROLLBACK                              27310000
273400                                   TO TRUE                        27320000
273500                  PERFORM 9990-WRITE-CICS                         27330000
273600         END-EVALUATE.                                            27340000
273700*                                                                 27350000
273800*                                                                 27360000
273900 EJECT                                                            27370000
274000*----------------------------------------------------------------*27380000
274100*    GET THE CURRENT ROW FOR PROCESSING.                         *27390000
274200*----------------------------------------------------------------*27400000
274300                                                                  27410000
274400 E100-SELECT-TRECITM.                                             27420000
274500                                                                  27430000
274600     INITIALIZE RECITM-PREPK-ID.                                  27440000
274700                                                                  27450000
274800         EXEC SQL                                                 27460000
274900              SELECT                                              27470000
275000                   PREPK_ID                                       27480000
275100              INTO                                                27490000
275200                   :RECITM-PREPK-ID                               27500000
275300              FROM                                                27510000
275400                    TRECITM                                       27520000
275500              WHERE                                               27530000
275600                     ORD_NBR          =  :DK-ORD-NBR              27540000
275700              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          27550000
275800              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          27560000
275900              AND    VER_STATUS_CDE   =  :PC-A                    27570000
276000         END-EXEC                                                 27580000
276100                                                                  27590000
276200         EVALUATE TRUE                                            27600000
276300             WHEN SQLCODE = ZERO                                  27610000
276400                  MOVE RECITM-PREPK-ID  TO  DK-PREPK-ID-HOLD      27620000
276500             WHEN SQLCODE = +100                                  27630000
276600                  SET PS-DATA-NOT-OK    TO  TRUE                  27640000
276700             WHEN SQLWARN0 NOT = SPACE                            27650000
276800             WHEN SQLCODE NOT = ZERO                              27660000
276900                  MOVE 'E100-SELECT-TRECITM'                      27670000
277000                                   TO DP013-PARAGRAPH             27680000
277100                  MOVE 'SELECT TRECITM'                           27690000
277200                                   TO DP013-MESSAGE-TEXT (1)      27700000
277300                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             27710000
277400                  MOVE DK-REC-SEQ-NBR                             27720000
277500                                   TO PV-ERROR-RCVR-SEQ-NBR       27730000
277600                  MOVE DK-ORD-LNE-NBR                             27740000
277700                                   TO PV-ERROR-ORD-LNE-NBR        27750000
277800                  STRING ' RCVR: '            DELIMITED BY SIZE   27760000
277900                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   27770000
278000                       '-'                    DELIMITED BY SIZE   27780000
278100                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   27790000
278200                       '  LINE: '             DELIMITED BY SIZE   27800000
278300                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   27810000
278400                                 INTO DP013-MESSAGE-TEXT (2)      27820000
278500                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    27830000
278600                  MOVE SQLCA       TO DP013-SQLCA                 27840000
278700                  SET DP013-DB2-ABEND                             27850000
278800                                   TO TRUE                        27860000
278900                  PERFORM Z999-ABEND                              27870000
279000         END-EVALUATE.                                            27880000
279100/                                                                 27890000
279200 E300-GET-PO-UNT-QTY.                                             27900000
279300                                                                  27910000
279400         EXEC SQL                                                 27920000
279500              SELECT                                              27930000
279600                     B.UNT_QTY                                    27940000
279700               INTO                                               27950000
279800                     :PURITM-UNT-QTY                              27960000
279900               FROM                                               27970000
280000                     TPURCHS A                                    27980000
280100                   , TPURITM B                                    27990000
280200              WHERE                                               28000000
280300                     A.PO_NBR            =  :DK-ORD-NBR           28010000
280400               AND   A.PO_NBR            =  B.PO_NBR              28020000
280500               AND   B.APP_PO_LNE_NBR    =  :DK-ORD-LNE-NBR       28030000
280600               AND   A.VER_STATUS_CDE    =  :PC-A                 28040000
280700               AND   B.VER_STATUS_CDE    =  :PC-A                 28050000
280800         END-EXEC                                                 28060000
280900                                                                  28070000
281000         EVALUATE TRUE                                            28080000
281100             WHEN SQLCODE = ZERO                                  28090000
281200             WHEN SQLCODE = +100                                  28100000
281300                  CONTINUE                                        28110000
281400             WHEN SQLWARN0 NOT = SPACE                            28120000
281500             WHEN SQLCODE NOT = ZERO                              28130000
281600                  MOVE 'E300-GET-PO-UNT-QTY'                      28140000
281700                                   TO DP013-PARAGRAPH             28150000
281800                  MOVE 'GET PO LINE UNIT QUANTITY'                28160000
281900                                   TO DP013-MESSAGE-TEXT (1)      28170000
282000                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             28180000
282100                  MOVE DK-ORD-LNE-NBR                             28190000
282200                                   TO PV-ERROR-ORD-LNE-NBR        28200000
282300                  STRING ' PO: '              DELIMITED BY SIZE   28210000
282400                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   28220000
282500                       '  LINE: '             DELIMITED BY SIZE   28230000
282600                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   28240000
282700                                 INTO DP013-MESSAGE-TEXT (2)      28250000
282800                  MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)    28260000
282900                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (2)    28270000
283000                  MOVE SQLCA       TO DP013-SQLCA                 28280000
283100                  SET DP013-DB2-ABEND                             28290000
283200                                   TO TRUE                        28300000
283300                  PERFORM Z999-ABEND                              28310000
283400         END-EVALUATE.                                            28320000
283500/                                                                 28330000
283600 E400-GET-RECDIS-QTY.                                             28340000
283700                                                                  28350000
283800         EXEC SQL                                                 28360000
283900              SELECT                                              28370000
284000                     SUM(C.AP_VERIFY_ITM_QTY)                     28380000
284100               INTO                                               28390000
284200                     :RECDIS-AP-VERIFY-ITM-QTY :PV-NULL-IND       28400000
284300               FROM                                               28410000
284400                     TRECEIV A                                    28420000
284500                   , TRECITM B                                    28430000
284600                   , TRECDIS C                                    28440000
284700               WHERE                                              28450000
284800                     A.ORD_NBR         =  :DK-ORD-NBR             28460000
284900                AND  A.ORD_NBR         =  B.ORD_NBR               28470000
285000                AND  A.ORD_NBR         =  C.ORD_NBR               28480000
285100                AND  B.ORD_LNE_NBR     =  :DK-ORD-LNE-NBR         28490000
285200                AND  B.ORD_LNE_NBR     =  C.ORD_LNE_NBR           28500000
285300                AND  A.VER_STATUS_CDE  =  :PC-A                   28510000
285400                AND  B.VER_STATUS_CDE  =  :PC-A                   28520000
285600                AND  B.STATUS_CDE      =  :PC-VE                  28540000
285700                AND  A.REC_SEQ_NBR     =  B.REC_SEQ_NBR           28550000
285800                AND  A.REC_SEQ_NBR     =  C.REC_SEQ_NBR           28560000
285900         END-EXEC                                                 28570000
286000                                                                  28580000
286100         EVALUATE TRUE                                            28590000
286200             WHEN SQLCODE = ZERO                                  28600000
286300             WHEN SQLCODE = +100                                  28610000
286400                  CONTINUE                                        28620000
286500             WHEN SQLWARN0 NOT = SPACE                            28630000
286600             WHEN SQLCODE NOT = ZERO                              28640000
286700                  MOVE 'E400-GET-RECDIS-QTY'                      28650000
286800                                   TO DP013-PARAGRAPH             28660000
286900                  MOVE 'SUM RECDIS VERIFY QUANTITY'               28670000
287000                                   TO DP013-MESSAGE-TEXT (1)      28680000
287100                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             28690000
287200                  MOVE DK-ORD-LNE-NBR                             28700000
287300                                   TO PV-ERROR-ORD-LNE-NBR        28710000
287400                  STRING ' PO: '              DELIMITED BY SIZE   28720000
287500                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   28730000
287600                       '  LINE: '             DELIMITED BY SIZE   28740000
287700                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   28750000
287800                                 INTO DP013-MESSAGE-TEXT (2)      28760000
287900                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    28770000
288000                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (2)    28780000
288100                  MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (3)    28790000
288200                  MOVE SQLCA       TO DP013-SQLCA                 28800000
288300                  SET DP013-DB2-ABEND                             28810000
288400                                   TO TRUE                        28820000
288500                  PERFORM Z999-ABEND                              28830000
288600         END-EVALUATE.                                            28840000
288700/                                                                 28850000
288800*----------------------------------------------------------------*28860000
288900*    UPDATE THE STATUS ON THE PURCHASE ITEM ROW                  *28870000
289000*----------------------------------------------------------------*28880000
289100                                                                  28890000
289200 E500-UPDATE-PURITM-PROCESS.                                      28900000
289300                                                                  28910000
289400     PERFORM F100-GET-PURITM.                                     28920000
289500     IF  SQLCODE EQUAL ZERO                                       28930000
289600             IF PURITM-STATUS-CDE = PC-AC OR PC-AP                28940000
289700                 PERFORM F760-UPDATE-PURITM-VERIFY                28950000
289800             END-IF                                               28960000
289900     END-IF.                                                      28970000
290000                                                                  28980000
290100*----------------------------------------------------------------*28990000
290200*    HERE, WE CHECK IF ALL PURCHASE ITEM LINES ARE EQUAL TO      *29000000
290300*    'CM' 'CB' OR 'CA' AND THE PURCHASE ORDER HEADER IS EQUAL    *29010000
290400*    TO 'AP' OR 'AC'.  IF SO, UPDATE THE PURCHASE ORDER HEADER   *29020000
290500*    TO A STATUS OF 'CM'.                                        *29030000
290600*----------------------------------------------------------------*29040000
290700                                                                  29050000
290800 E600-CHECK-PURCHS-FOR-UPDATE.                                    29060000
290900                                                                  29070000
291000     PERFORM F300-COUNT-PO-LINE-ROWS.                             29080000
291100     IF  PV-DB2-COUNT EQUAL ZERO                                  29090000
291200         PERFORM F400-GET-TPURCHS-STATUS                          29100000
291300         MOVE PV-DEPT-NBR-PIC9 TO PV-DEPT-NBR-COMP-3              29110000
291400         PERFORM F450-GET-POT00006-DEPT                           29120000
291500         IF (PURCHS-STATUS-CDE = PC-AP OR                         29130000
291600             PURCHS-STATUS-CDE = PC-AC) AND                       29140000
291700             PS-POT00006-NOT-FOUND                                29150000
291800             PERFORM F500-UPDATE-PURCHS-STATUS-VER                29160000
291900         END-IF                                                   29170000
292000     END-IF.                                                      29180000
292100                                                                  29190000
292200 E700-UPDATE-TRECITM-ACTUAL.                                      29200000
292300                                                                  29210000
292400         EXEC SQL                                                 29220000
292500              UPDATE                                              29230000
292600                    TRECITM                                       29240000
292700              SET   STATUS_CDE        =  :PV-STATUS-CDE           29250000
292800                   ,VERFYD_TMST       =   CURRENT TIMESTAMP       29260000
292900                   ,VRFD_USR_ID        = :PV-VRFD-USR-ID          29270000
293000              WHERE                                               29280000
293100                     ORD_NBR          =  :DK-ORD-NBR              29290000
293200              AND    ORD_LNE_NBR      =  :DK-ORD-LNE-NBR          29300000
293300              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          29310000
293400              AND    VER_STATUS_CDE   =  :PC-A                    29320000
293500         END-EXEC                                                 29330000
293600                                                                  29340000
293700         EVALUATE TRUE                                            29350000
293800             WHEN SQLCODE = ZERO                                  29360000
293900                  CONTINUE                                        29370000
294000             WHEN SQLWARN0 NOT = SPACE                            29380000
294100             WHEN SQLCODE NOT = ZERO                              29390000
294200                  MOVE 'E700-UPDATE-TRECITM-ACTUAL'               29400000
294300                                   TO DP013-PARAGRAPH             29410000
294400                  MOVE 'UPDATE TRECITM STATUS CODE'               29420000
294500                                   TO DP013-MESSAGE-TEXT (1)      29430000
294600                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             29440000
294700                  MOVE DK-REC-SEQ-NBR                             29450000
294800                                   TO PV-ERROR-RCVR-SEQ-NBR       29460000
294900                  MOVE DK-ORD-LNE-NBR                             29470000
295000                                   TO PV-ERROR-ORD-LNE-NBR        29480000
295100                  STRING ' RCVR: '            DELIMITED BY SIZE   29490000
295200                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   29500000
295300                       '-'                    DELIMITED BY SIZE   29510000
295400                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   29520000
295500                       '  LINE: '             DELIMITED BY SIZE   29530000
295600                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   29540000
295700                                 INTO DP013-MESSAGE-TEXT (2)      29550000
295800                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    29560000
295900                  MOVE SQLCA       TO DP013-SQLCA                 29570000
296000                  SET DP013-DB2-ABEND                             29580000
296100                                   TO TRUE                        29590000
296200                  PERFORM Z999-ABEND                              29600000
296300         END-EVALUATE.                                            29610000
296400                                                                  29620000
296500 E750-UPDATE-TRECITM-CURRENT.                                     29630000
296600                                                                  29640000
296700         EXEC SQL                                                 29650000
296800              UPDATE                                              29660000
296900                    TRECITM                                       29670000
297000              SET   STATUS_CDE        =  :PV-STATUS-CDE           29680000
297100                   ,VERFYD_TMST       =   CURRENT TIMESTAMP       29690000
297200                   ,VRFD_USR_ID        = :PV-VRFD-USR-ID          29700000
297300              WHERE CURRENT OF PRE_PACK_LNE_CSR                   29710000
297400         END-EXEC                                                 29720000
297500                                                                  29730000
297600         EVALUATE TRUE                                            29740000
297700             WHEN SQLCODE = ZERO                                  29750000
297800                  CONTINUE                                        29760000
297900             WHEN SQLWARN0 NOT = SPACE                            29770000
298000             WHEN SQLCODE NOT = ZERO                              29780000
298100                  MOVE 'E750-UPDATE-TRECITM-CURRENT'              29790000
298200                                   TO DP013-PARAGRAPH             29800000
298300                  MOVE 'UPDATE TRECITM STATUS CODE'               29810000
298400                                   TO DP013-MESSAGE-TEXT (1)      29820000
298500                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             29830000
298600                  MOVE DK-REC-SEQ-NBR                             29840000
298700                                   TO PV-ERROR-RCVR-SEQ-NBR       29850000
298800                  MOVE DK-ORD-LNE-NBR                             29860000
298900                                   TO PV-ERROR-ORD-LNE-NBR        29870000
299000                  STRING ' RCVR: '            DELIMITED BY SIZE   29880000
299100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   29890000
299200                       '-'                    DELIMITED BY SIZE   29900000
299300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   29910000
299400                       '  LINE: '             DELIMITED BY SIZE   29920000
299500                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   29930000
299600                                 INTO DP013-MESSAGE-TEXT (2)      29940000
299700                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    29950000
299800                  MOVE SQLCA       TO DP013-SQLCA                 29960000
299900                  SET DP013-DB2-ABEND                             29970000
300000                                   TO TRUE                        29980000
300100                  PERFORM Z999-ABEND                              29990000
300200         END-EVALUATE.                                            30000000
300300                                                                  30010000
300400 F100-GET-PURITM.                                                 30020000
300500                                                                  30030000
300600     INITIALIZE DCLTPURITM.                                       30040000
300700                                                                  30050000
300800         EXEC SQL                                                 30060000
300900              SELECT                                              30070000
301000                      STATUS_CDE                                  30080000
301100               INTO                                               30090000
301200                      :PURITM-STATUS-CDE                          30100000
301300               FROM                                               30110000
301400                      TPURITM                                     30120000
301500              WHERE                                               30130000
301600                      PO_NBR             =  :DK-ORD-NBR           30140000
301700               AND    APP_PO_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   30150000
301800               AND    VER_STATUS_CDE     =  :PC-A                 30160000
301900         END-EXEC                                                 30170000
302000                                                                  30180000
302100         EVALUATE TRUE                                            30190000
302200             WHEN SQLCODE = ZERO                                  30200000
302300             WHEN SQLCODE = +100                                  30210000
302400                  CONTINUE                                        30220000
302500             WHEN SQLWARN0 NOT = SPACE                            30230000
302600             WHEN SQLCODE NOT = ZERO                              30240000
302700                  MOVE 'F100-GET-PURITM'                          30250000
302800                                   TO DP013-PARAGRAPH             30260000
302900                  MOVE 'SELECT TPURITM            '               30270000
303000                                   TO DP013-MESSAGE-TEXT (1)      30280000
303100                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             30290000
303200                  MOVE RECDIS-ORD-LNE-NBR                         30300000
303300                                   TO PV-ERROR-ORD-LNE-NBR        30310000
303400                  STRING ' PO: '              DELIMITED BY SIZE   30320000
303500                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   30330000
303600                       '  LINE: '             DELIMITED BY SIZE   30340000
303700                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   30350000
303800                                 INTO DP013-MESSAGE-TEXT (2)      30360000
303900                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    30370000
304000                  MOVE SQLCA       TO DP013-SQLCA                 30380000
304100                  SET DP013-DB2-ABEND                             30390000
304200                                   TO TRUE                        30400000
304300                  PERFORM Z999-ABEND                              30410000
304400         END-EVALUATE.                                            30420000
304500/                                                                 30430000
304600 F760-UPDATE-PURITM-VERIFY.                                       30440000
304700                                                                  30450000
304800         EXEC SQL                                                 30460000
304900              UPDATE                                              30470000
305000                     TPURITM                                      30480000
305100              SET    STATUS_CDE   =  :PC-CM                       30490000
305200                   , STAT_TMST    =  CURRENT TIMESTAMP            30500000
305300              WHERE                                               30510000
305400                     PO_NBR           =  :DK-ORD-NBR              30520000
305500              AND    APP_PO_LNE_NBR   =  :RECDIS-ORD-LNE-NBR      30530000
305600              AND    VER_STATUS_CDE   =  :PC-A                    30540000
305700         END-EXEC                                                 30550000
305800                                                                  30560000
305900         EVALUATE TRUE                                            30570000
306000             WHEN SQLCODE = ZERO                                  30580000
306100                  CONTINUE                                        30590000
306200             WHEN SQLWARN0 NOT = SPACE                            30600000
306300             WHEN SQLCODE NOT = ZERO                              30610000
306400                  MOVE 'F760-UPDATE-PURITM-VERIFY'                30620000
306500                                   TO DP013-PARAGRAPH             30630000
306600                  MOVE 'SET STATUS TO "CM" COMPLETE'              30640000
306700                                   TO DP013-MESSAGE-TEXT (1)      30650000
306800                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             30660000
306900                  MOVE RECDIS-ORD-LNE-NBR                         30670000
307000                                   TO PV-ERROR-ORD-LNE-NBR        30680000
307100                  STRING ' PO: '              DELIMITED BY SIZE   30690000
307200                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   30700000
307300                       '  LINE: '             DELIMITED BY SIZE   30710000
307400                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   30720000
307500                                 INTO DP013-MESSAGE-TEXT (2)      30730000
307600                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    30740000
307700                  MOVE SQLCA       TO DP013-SQLCA                 30750000
307800                  SET DP013-DB2-ABEND                             30760000
307900                                   TO TRUE                        30770000
308000                  PERFORM Z999-ABEND                              30780000
308100         END-EVALUATE.                                            30790000
308200/                                                                 30800000
308300 F300-COUNT-PO-LINE-ROWS.                                         30810000
308400                                                                  30820000
308500     MOVE ZERO            TO  PV-DB2-COUNT.                       30830000
308600         EXEC SQL                                                 30840000
308700              SELECT                                              30850000
308800                    COUNT(*)                                      30860000
308900              INTO                                                30870000
309000                    :PV-DB2-COUNT :PV-NULL-IND                    30880000
309100              FROM                                                30890000
309200                    TPURITM                                       30900000
309300              WHERE                                               30910000
309400                    PO_NBR             =  :DK-ORD-NBR             30920000
309500              AND   VER_STATUS_CDE     =  :PC-A                   30930000
309600              AND  (STATUS_CDE        ^=  :PC-CM                  30940000
309700               AND  STATUS_CDE        ^=  :PC-CB                  30950000
309800               AND  STATUS_CDE        ^=  :PC-CA)                 30960000
309900         END-EXEC                                                 30970000
310000                                                                  30980000
310100         EVALUATE TRUE                                            30990000
310200             WHEN SQLCODE = ZERO                                  31000000
310300             WHEN SQLCODE = +100                                  31010000
310400                  CONTINUE                                        31020000
310500             WHEN SQLWARN0 NOT = SPACE                            31030000
310600             WHEN SQLCODE NOT = ZERO                              31040000
310700                  MOVE 'F300-COUNT-PO-LINE-ROWS'                  31050000
310800                                   TO DP013-PARAGRAPH             31060000
310900                  MOVE                                            31070000
311000                 'COUNT NUMBER OF "CM", "CB", "CA" STATUS ROWS'   31080000
311100                                   TO DP013-MESSAGE-TEXT (1)      31090000
311200                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             31100000
311300                  STRING ' PO: '              DELIMITED BY SIZE   31110000
311400                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   31120000
311500                                 INTO DP013-MESSAGE-TEXT (2)      31130000
311600                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    31140000
311700                  MOVE SQLCA       TO DP013-SQLCA                 31150000
311800                  SET DP013-DB2-ABEND                             31160000
311900                                   TO TRUE                        31170000
312000                  PERFORM Z999-ABEND                              31180000
312100         END-EVALUATE.                                            31190000
312200/                                                                 31200000
312300                                                                  31210000
312400*----------------------------------------------------------------*31220000
312500*    GET THE STATUS CODE OF THE CURRENT P.O.                     *31230000
312600*----------------------------------------------------------------*31240000
312700 F400-GET-TPURCHS-STATUS.                                         31250000
312800     INITIALIZE DCLTPURCHS.                                       31260000
312900                                                                  31270000
313000         EXEC SQL                                                 31280000
313100              SELECT                                              31290000
313200                      STATUS_CDE                                  31300000
313300                     ,DEPT_NBR                                    31310000
313400               INTO                                               31320000
313500                     :PURCHS-STATUS-CDE                           31330000
313600                    ,:PURCHS-DEPT-NBR                             31340000
313700              FROM                                                31350000
313800                     TPURCHS                                      31360000
313900              WHERE                                               31370000
314000                    PO_NBR             =  :DK-ORD-NBR             31380000
314100              AND   VER_STATUS_CDE     =  :PC-A                   31390000
314200         END-EXEC                                                 31400000
314300                                                                  31410000
314400         EVALUATE TRUE                                            31420000
314500             WHEN SQLCODE = ZERO                                  31430000
314600                  MOVE PURCHS-DEPT-NBR TO PV-DEPT-NBR-PIC9        31440000
314700             WHEN SQLCODE = +100                                  31450000
314800                  MOVE 0 TO PV-DEPT-NBR-PIC9                      31460000
314900             WHEN SQLWARN0 NOT = SPACE                            31470000
315000             WHEN SQLCODE NOT = ZERO                              31480000
315100                  MOVE 'F400-GET-TPURCHS-STATUS'                  31490000
315200                                   TO DP013-PARAGRAPH             31500000
315300                  MOVE 'GET THE PURCHASE HEADER'                  31510000
315400                                   TO DP013-MESSAGE-TEXT (1)      31520000
315500                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             31530000
315600                  STRING ' PO: '              DELIMITED BY SIZE   31540000
315700                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   31550000
315800                                 INTO DP013-MESSAGE-TEXT (2)      31560000
315900                  MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)    31570000
316000                  MOVE SQLCA       TO DP013-SQLCA                 31580000
316100                  SET DP013-DB2-ABEND                             31590000
316200                                   TO TRUE                        31600000
316300                  PERFORM Z999-ABEND                              31610000
316400         END-EVALUATE.                                            31620000
316500/                                                                 31630000
316600                                                                  31640000
316700*----------------------------------------------------------------*31650000
316800*    VALIDATE THE DEPARTMENT NUMBER AGAINST POT_RMS_RLOUT_CTL    *31660000
316900*----------------------------------------------------------------*31670000
317000 F450-GET-POT00006-DEPT.                                          31680000
317100     INITIALIZE DCLPOT00006.                                      31690000
317200                                                                  31700000
317300         EXEC SQL                                                 31710000
317400              SELECT                                              31720000
317500                      DEPT_NBR                                    31730000
317600                     ,PO_ENTR_IN_RMS_DTE                          31740000
317700               INTO                                               31750000
317800                     :POT00006-DEPT-NBR                           31760000
317900                    ,:POT00006-PO-ENTR-IN-RMS-DTE                 31770000
318000              FROM                                                31780000
318100                     POT_RMS_RLOUT_CTL                            31790000
318200              WHERE                                               31800000
318300                    DEPT_NBR            = :PV-DEPT-NBR-COMP-3     31810000
318400*             AND   PO_ENTR_IN_RMS_DTE  >  :PV-CURRENT-DATE       31820000
318500              AND   PO_ENTR_IN_RMS_DTE  <= :PV-CURRENT-DATE       31830000
318600         END-EXEC                                                 31840000
318700                                                                  31850000
318800         EVALUATE TRUE                                            31860000
318900             WHEN SQLCODE = ZERO                                  31870000
319000                  SET PS-POT00006-FOUND TO TRUE                   31880000
319100             WHEN SQLCODE = +100                                  31890000
319200                  SET PS-POT00006-NOT-FOUND TO TRUE               31900000
319300             WHEN SQLWARN0 NOT = SPACE                            31910000
319400             WHEN SQLCODE NOT = ZERO                              31920000
319500                  MOVE 'F450-GET-POT00006-DEPT'                   31930000
319600                                   TO DP013-PARAGRAPH             31940000
319700                  MOVE 'GET THE POT_RMS_RLOUT_CTL'                31950000
319800                                   TO DP013-MESSAGE-TEXT (1)      31960000
319900                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             31970000
320000                  STRING ' PO: '              DELIMITED BY SIZE   31980000
320100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   31990000
320200                                 INTO DP013-MESSAGE-TEXT (2)      32000000
320300                  MOVE 'POT00006'  TO DP013-DB2-TABLE-NAME (1)    32010000
320400                  MOVE SQLCA       TO DP013-SQLCA                 32020000
320500                  SET DP013-DB2-ABEND                             32030000
320600                                   TO TRUE                        32040000
320700                  PERFORM Z999-ABEND                              32050000
320800         END-EVALUATE.                                            32060000
320900/                                                                 32070000
321000 F500-UPDATE-PURCHS-STATUS-VER.                                   32080000
321100                                                                  32090000
321200         EXEC SQL                                                 32100000
321300              UPDATE                                              32110000
321400                    TPURCHS                                       32120000
321500               SET                                                32130000
321600                    STATUS_CDE         =  :PC-CM                  32140000
321700                  , STATUS_TMST        =   CURRENT TIMESTAMP      32150000
321800              WHERE                                               32160000
321900                    PO_NBR             =  :DK-ORD-NBR             32170000
322000              AND   VER_STATUS_CDE     =  :PC-A                   32180000
322100         END-EXEC                                                 32190000
322200                                                                  32200000
322300         EVALUATE TRUE                                            32210000
322400             WHEN SQLCODE = ZERO                                  32220000
322500             WHEN SQLCODE = +100                                  32230000
322600                  CONTINUE                                        32240000
322700             WHEN SQLWARN0 NOT = SPACE                            32250000
322800             WHEN SQLCODE NOT = ZERO                              32260000
322900                  MOVE 'F500-UPDATE-PURCHS-STATUS-VER'            32270000
323000                                   TO DP013-PARAGRAPH             32280000
323100                  MOVE 'UPDATE THE PURCHASE HEADER'               32290000
323200                                   TO DP013-MESSAGE-TEXT (1)      32300000
323300                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             32310000
323400                  STRING ' PO: '              DELIMITED BY SIZE   32320000
323500                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   32330000
323600                                 INTO DP013-MESSAGE-TEXT (2)      32340000
323700                  MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)    32350000
323800                  MOVE SQLCA       TO DP013-SQLCA                 32360000
323900                  SET DP013-DB2-ABEND                             32370000
324000                                   TO TRUE                        32380000
324100                  PERFORM Z999-ABEND                              32390000
324200         END-EVALUATE.                                            32400000
324300/                                                                 32410000
324400 G400-UPDATE-UNITS-WRKD.                                          32420000
324500* THIS WILL CALL PCKCS756 WHICH WILL UPDATE THE TABLES FOR UNITS  32430000
324600* WORKED OR VERIFIED                                              32440000
324700     EXEC SQL                                                     32450000
324800         SET :PV-CURRENT-TMST =  CURRENT_TIMESTAMP                32460000
324900     END-EXEC.                                                    32470000
325000                                                                  32480000
325100     MOVE PV-CURRENT-TMST             TO PC238-WRKD-TMST.         32490000
325200     MOVE PC-A                        TO PC238-VERIFY-TYPE-CDE.   32500000
325300     MOVE LENGTH OF PC238-COMM-AREA   TO PV-COMMAREA-LENGTH.      32510000
325400                                                                  32520000
325500     EXEC CICS                                                    32530000
325600         LINK                                                     32540000
325700             PROGRAM   (PC-UNTS-WRKD-PGRM-NAME)                   32550000
325800             COMMAREA  (PC238-COMM-AREA)                          32560000
325900             LENGTH    (PV-COMMAREA-LENGTH)                       32570000
326000             RESP      (PV-CICS-RESPONSE)                         32580000
326100     END-EXEC.                                                    32590000
326200                                                                  32600000
326300     EVALUATE TRUE                                                32610000
326400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 32620000
326500              EVALUATE TRUE                                       32630000
326600                  WHEN PC238-MOD-SUCCESSFUL                       32640000
326700                       CONTINUE                                   32650000
326800                 WHEN PC238-MOD-UNSUCCESSFUL                      32660000
326900                     PERFORM G500-MOD-UNSUCCESSFUL                32670000
327000             END-EVALUATE                                         32680000
327100                                                                  32690000
327200         WHEN OTHER                                               32700000
327300             STRING ' PCKCS770 - '      DELIMITED BY SIZE         32710000
327400                    ' G400-UPDATE-UNITS-WRKD '                    32720000
327500                                        DELIMITED BY SIZE         32730000
327600                    ' KEY INFO - '      DELIMITED BY SIZE         32740000
327700                    PC-DISPLAY-PO       DELIMITED BY SIZE         32750000
327800                    ' - '               DELIMITED BY SIZE         32760000
327900                    PC-DISPLAY-RCVR     DELIMITED BY SIZE         32770000
328000                    ' - '               DELIMITED BY SIZE         32780000
328100                    PC-DISPLAY-LINE     DELIMITED BY SIZE         32790000
328200                                  INTO PV-CICS-MSG-AREA           32800000
328300             MOVE LENGTH OF PV-CICS-MSG-AREA                      32810000
328400                                   TO PV-COMMAREA-LENGTH          32820000
328500             PERFORM 9990-WRITE-CICS                              32830000
328600             PERFORM Z900-SOFT-ABORT                              32840000
328700     END-EVALUATE.                                                32850000
328800/                                                                 32860000
328900******************************************************************32870000
329000*  PARAGRAPH MOVES THE DATA FOR THE CALL TO UNITS WORKED FOR THE *32880000
329100*  DRIVER LINE TO WORKING STORAGE FIELDS.  THIS IS DONE TO MAKE  *32890000
329200*  THE CALL AFTER ALL OTHER LINES FOR THE PRE-PACK HAVE BEEN     *32900000
329300*  PROCESSED.                                                    *32910000
329400*  RESOLVED ISSUE FOR INTERFACING ODD UNITS TO RMS PO.           *32920000
329500******************************************************************32930000
329600 G450-KEEP-DRVR-LINE-INFO.                                        32940000
329700                                                                  32950000
329800     MOVE PC238-WRKD-TMST        TO PV-DL-WRKD-TMST.              32960000
329900     MOVE PC238-WRKD-OPER-UNT-ID TO PV-DL-WRKD-OPER-UNT-ID.       32970000
330000     MOVE PC238-PO-NBR           TO PV-DL-PO-NBR.                 32980000
330100     MOVE PC238-RCVR-SEQ-NBR     TO PV-DL-RCVR-SEQ-NBR.           32990000
330200     MOVE PC238-PO-LNE-NBR       TO PV-DL-PO-LNE-NBR.             33000000
330300     MOVE PC238-WRKD-UNT-QTY     TO PV-DL-WRKD-UNT-QTY.           33010000
330400     MOVE PC238-WRKD-CART-QTY    TO PV-DL-WRKD-CART-QTY.          33020000
330500     MOVE PC238-UNT-RETAIL-PRC   TO PV-DL-UNT-RETAIL-PRC.         33030000
330600     MOVE PC238-PRCG-AREA-CDE    TO PV-DL-PRCG-AREA-CDE.          33040000
330700     MOVE PC238-TRANS-TYPE-CDE   TO PV-DL-TRANS-TYPE-CDE.         33050000
330800     MOVE PC238-VERIFY-TYPE-CDE  TO PV-DL-VERIFY-TYPE-CDE.        33060000
330900/                                                                 33070000
331000 G460-LOAD-DRVR-LINE-INFO.                                        33080000
331100                                                                  33090000
331200     MOVE PV-DL-WRKD-TMST        TO PC238-WRKD-TMST.              33100000
331300     MOVE PV-DL-WRKD-OPER-UNT-ID TO PC238-WRKD-OPER-UNT-ID.       33110000
331400     MOVE PV-DL-PO-NBR           TO PC238-PO-NBR.                 33120000
331500     MOVE PV-DL-RCVR-SEQ-NBR     TO PC238-RCVR-SEQ-NBR.           33130000
331600     MOVE PV-DL-PO-LNE-NBR       TO PC238-PO-LNE-NBR.             33140000
331700     MOVE PV-DL-WRKD-UNT-QTY     TO PC238-WRKD-UNT-QTY.           33150000
331800     MOVE PV-DL-WRKD-CART-QTY    TO PC238-WRKD-CART-QTY.          33160000
331900     MOVE PV-DL-UNT-RETAIL-PRC   TO PC238-UNT-RETAIL-PRC.         33170000
332000     MOVE PV-DL-PRCG-AREA-CDE    TO PC238-PRCG-AREA-CDE.          33180000
332100     MOVE PV-DL-TRANS-TYPE-CDE   TO PC238-TRANS-TYPE-CDE.         33190000
332200     MOVE PV-DL-VERIFY-TYPE-CDE  TO PC238-VERIFY-TYPE-CDE.        33200000
332300/                                                                 33210000
332400 G500-MOD-UNSUCCESSFUL.                                           33220000
332500                                                                  33230000
332600     MOVE PC238-PO-NBR              TO PC-DISPLAY-PO.             33240000
332700     MOVE PC238-RCVR-SEQ-NBR        TO PC-DISPLAY-RCVR.           33250000
332800     MOVE PC238-PO-LNE-NBR          TO PC-DISPLAY-LINE.           33260000
332900     MOVE PC238-WRKD-OPER-UNT-ID    TO PC-DISPLAY-OPER.           33270000
333000     MOVE PC238-BAD-SQL-CDE         TO PC-DISPLAY-SQL-CODE        33280000
333100                                       SQLCODE.                   33290000
333200      SET PS-UPDATES-DONE           TO TRUE.                      33300000
333300                                                                  33310000
333400     IF  PC238-MOD-BAD-TMST                                       33320000
333500         STRING ' PCKCS770 - '      DELIMITED BY SIZE             33330000
333600                ' G400-UPDATE-UNITS-WRKD '                        33340000
333700                                    DELIMITED BY SIZE             33350000
333800                ' BAD TIMESTAMP '   DELIMITED BY SIZE             33360000
333900                PC238-WRKD-TMST     DELIMITED BY SIZE             33370000
334000                             INTO PV-CICS-MSG-AREA                33380000
334100         MOVE LENGTH OF PV-CICS-MSG-AREA                          33390000
334200                               TO PV-COMMAREA-LENGTH              33400000
334300         PERFORM 9990-WRITE-CICS                                  33410000
334400         STRING ' PCKCS770 - '      DELIMITED BY SIZE             33420000
334500                ' G400-UPDATE-UNITS-WRKD '                        33430000
334600                                    DELIMITED BY SIZE             33440000
334700                ' KEY INFO - '      DELIMITED BY SIZE             33450000
334800                PC-DISPLAY-PO       DELIMITED BY SIZE             33460000
334900                ' - '               DELIMITED BY SIZE             33470000
335000                PC-DISPLAY-RCVR     DELIMITED BY SIZE             33480000
335100                ' - '               DELIMITED BY SIZE             33490000
335200                PC-DISPLAY-LINE     DELIMITED BY SIZE             33500000
335300                             INTO PV-CICS-MSG-AREA                33510000
335400         MOVE LENGTH OF PV-CICS-MSG-AREA                          33520000
335500                               TO PV-COMMAREA-LENGTH              33530000
335600         PERFORM 9990-WRITE-CICS                                  33540000
335700         PERFORM Z900-SOFT-ABORT                                  33550000
335800     ELSE                                                         33560000
335900     IF  PC238-MOD-BAD-OPER                                       33570000
336000         STRING ' PCKCS770 - '      DELIMITED BY SIZE             33580000
336100                ' G400-UPDATE-UNITS-WRKD '                        33590000
336200                                    DELIMITED BY SIZE             33600000
336300                ' BAD OPER UNIT '   DELIMITED BY SIZE             33610000
336400                PC-DISPLAY-OPER     DELIMITED BY SIZE             33620000
336500                             INTO PV-CICS-MSG-AREA                33630000
336600         MOVE LENGTH OF PV-CICS-MSG-AREA                          33640000
336700                               TO PV-COMMAREA-LENGTH              33650000
336800         PERFORM 9990-WRITE-CICS                                  33660000
336900         STRING ' PCKCS770 - '      DELIMITED BY SIZE             33670000
337000                ' G400-UPDATE-UNITS-WRKD '                        33680000
337100                                    DELIMITED BY SIZE             33690000
337200                ' KEY INFO - '      DELIMITED BY SIZE             33700000
337300                PC-DISPLAY-PO       DELIMITED BY SIZE             33710000
337400                ' - '               DELIMITED BY SIZE             33720000
337500                PC-DISPLAY-RCVR     DELIMITED BY SIZE             33730000
337600                ' - '               DELIMITED BY SIZE             33740000
337700                PC-DISPLAY-LINE     DELIMITED BY SIZE             33750000
337800                             INTO PV-CICS-MSG-AREA                33760000
337900         MOVE LENGTH OF PV-CICS-MSG-AREA                          33770000
338000                               TO PV-COMMAREA-LENGTH              33780000
338100         PERFORM 9990-WRITE-CICS                                  33790000
338200         PERFORM Z900-SOFT-ABORT                                  33800000
338300     ELSE                                                         33810000
338400     IF  PC238-MOD-BAD-TRANS-TYPE                                 33820000
338500         STRING ' PCKCS770 - '      DELIMITED BY SIZE             33830000
338600                ' G400-UPDATE-UNITS-WRKD '                        33840000
338700                                    DELIMITED BY SIZE             33850000
338800                ' BAD TRAN TYPE '   DELIMITED BY SIZE             33860000
338900                PC238-TRANS-TYPE-CDE                              33870000
339000                                    DELIMITED BY SIZE             33880000
339100                             INTO PV-CICS-MSG-AREA                33890000
339200         MOVE LENGTH OF PV-CICS-MSG-AREA                          33900000
339300                               TO PV-COMMAREA-LENGTH              33910000
339400         PERFORM 9990-WRITE-CICS                                  33920000
339500         STRING ' PCKCS770 - '      DELIMITED BY SIZE             33930000
339600                ' G400-UPDATE-UNITS-WRKD '                        33940000
339700                                    DELIMITED BY SIZE             33950000
339800                ' KEY INFO - '      DELIMITED BY SIZE             33960000
339900                PC-DISPLAY-PO       DELIMITED BY SIZE             33970000
340000                ' - '               DELIMITED BY SIZE             33980000
340100                PC-DISPLAY-RCVR     DELIMITED BY SIZE             33990000
340200                ' - '               DELIMITED BY SIZE             34000000
340300                PC-DISPLAY-LINE     DELIMITED BY SIZE             34010000
340400                             INTO PV-CICS-MSG-AREA                34020000
340500         MOVE LENGTH OF PV-CICS-MSG-AREA                          34030000
340600                               TO PV-COMMAREA-LENGTH              34040000
340700         PERFORM 9990-WRITE-CICS                                  34050000
340800         PERFORM Z900-SOFT-ABORT                                  34060000
340900     ELSE                                                         34070000
341000     IF  PC238-MOD-BAD-PO                                         34080000
341100         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34090000
341200                ' G400-UPDATE-UNITS-WRKD '                        34100000
341300                                    DELIMITED BY SIZE             34110000
341400                ' BAD PO NUMBER '   DELIMITED BY SIZE             34120000
341500                PC-DISPLAY-PO       DELIMITED BY SIZE             34130000
341600                             INTO PV-CICS-MSG-AREA                34140000
341700         MOVE LENGTH OF PV-CICS-MSG-AREA                          34150000
341800                               TO PV-COMMAREA-LENGTH              34160000
341900         PERFORM 9990-WRITE-CICS                                  34170000
342000         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34180000
342100                ' G400-UPDATE-UNITS-WRKD '                        34190000
342200                                    DELIMITED BY SIZE             34200000
342300                ' KEY INFO - '      DELIMITED BY SIZE             34210000
342400                PC-DISPLAY-PO       DELIMITED BY SIZE             34220000
342500                ' - '               DELIMITED BY SIZE             34230000
342600                PC-DISPLAY-RCVR     DELIMITED BY SIZE             34240000
342700                ' - '               DELIMITED BY SIZE             34250000
342800                PC-DISPLAY-LINE     DELIMITED BY SIZE             34260000
342900                             INTO PV-CICS-MSG-AREA                34270000
343000         MOVE LENGTH OF PV-CICS-MSG-AREA                          34280000
343100                               TO PV-COMMAREA-LENGTH              34290000
343200         PERFORM 9990-WRITE-CICS                                  34300000
343300         PERFORM Z900-SOFT-ABORT                                  34310000
343400     ELSE                                                         34320000
343500     IF  PC238-MOD-BAD-RCVR                                       34330000
343600         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34340000
343700                ' G400-UPDATE-UNITS-WRKD '                        34350000
343800                                    DELIMITED BY SIZE             34360000
343900                ' BAD RCVR NBR  '   DELIMITED BY SIZE             34370000
344000                PC-DISPLAY-RCVR     DELIMITED BY SIZE             34380000
344100                             INTO PV-CICS-MSG-AREA                34390000
344200         MOVE LENGTH OF PV-CICS-MSG-AREA                          34400000
344300                               TO PV-COMMAREA-LENGTH              34410000
344400         PERFORM 9990-WRITE-CICS                                  34420000
344500         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34430000
344600                ' G400-UPDATE-UNITS-WRKD '                        34440000
344700                                    DELIMITED BY SIZE             34450000
344800                ' KEY INFO - '      DELIMITED BY SIZE             34460000
344900                PC-DISPLAY-PO       DELIMITED BY SIZE             34470000
345000                ' - '               DELIMITED BY SIZE             34480000
345100                PC-DISPLAY-RCVR     DELIMITED BY SIZE             34490000
345200                ' - '               DELIMITED BY SIZE             34500000
345300                PC-DISPLAY-LINE     DELIMITED BY SIZE             34510000
345400                             INTO PV-CICS-MSG-AREA                34520000
345500         MOVE LENGTH OF PV-CICS-MSG-AREA                          34530000
345600                               TO PV-COMMAREA-LENGTH              34540000
345700         PERFORM 9990-WRITE-CICS                                  34550000
345800         PERFORM Z900-SOFT-ABORT                                  34560000
345900     ELSE                                                         34570000
346000     IF  PC238-MOD-BAD-LINE                                       34580000
346100         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34590000
346200                ' G400-UPDATE-UNITS-WRKD '                        34600000
346300                                    DELIMITED BY SIZE             34610000
346400                ' BAD LINE NBR  '   DELIMITED BY SIZE             34620000
346500                PC-DISPLAY-LINE     DELIMITED BY SIZE             34630000
346600                             INTO PV-CICS-MSG-AREA                34640000
346700         MOVE LENGTH OF PV-CICS-MSG-AREA                          34650000
346800                               TO PV-COMMAREA-LENGTH              34660000
346900         PERFORM 9990-WRITE-CICS                                  34670000
347000         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34680000
347100                ' G400-UPDATE-UNITS-WRKD '                        34690000
347200                                    DELIMITED BY SIZE             34700000
347300                ' KEY INFO - '      DELIMITED BY SIZE             34710000
347400                PC-DISPLAY-PO       DELIMITED BY SIZE             34720000
347500                ' - '               DELIMITED BY SIZE             34730000
347600                PC-DISPLAY-RCVR     DELIMITED BY SIZE             34740000
347700                ' - '               DELIMITED BY SIZE             34750000
347800                PC-DISPLAY-LINE     DELIMITED BY SIZE             34760000
347900                             INTO PV-CICS-MSG-AREA                34770000
348000         MOVE LENGTH OF PV-CICS-MSG-AREA                          34780000
348100                               TO PV-COMMAREA-LENGTH              34790000
348200         PERFORM 9990-WRITE-CICS                                  34800000
348300         PERFORM Z900-SOFT-ABORT                                  34810000
348400     ELSE                                                         34820000
348500     IF  PC238-MOD-BAD-NO-SHIFT                                   34830000
348600         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34840000
348700                ' G400-UPDATE-UNITS-WRKD '                        34850000
348800                                    DELIMITED BY SIZE             34860000
348900                ' SHIFT NOT FOUND ' DELIMITED BY SIZE             34870000
349000                PC238-WRKD-TMST     DELIMITED BY SIZE             34880000
349100                ' FOR OPER '        DELIMITED BY SIZE             34890000
349200                PC-DISPLAY-OPER     DELIMITED BY SIZE             34900000
349300                             INTO PV-CICS-MSG-AREA                34910000
349400         MOVE LENGTH OF PV-CICS-MSG-AREA                          34920000
349500                               TO PV-COMMAREA-LENGTH              34930000
349600         PERFORM 9990-WRITE-CICS                                  34940000
349700         STRING ' PCKCS770 - '      DELIMITED BY SIZE             34950000
349800                ' G400-UPDATE-UNITS-WRKD '                        34960000
349900                                    DELIMITED BY SIZE             34970000
350000                ' KEY INFO - '      DELIMITED BY SIZE             34980000
350100                PC-DISPLAY-PO       DELIMITED BY SIZE             34990000
350200                ' - '               DELIMITED BY SIZE             35000000
350300                PC-DISPLAY-RCVR     DELIMITED BY SIZE             35010000
350400                ' - '               DELIMITED BY SIZE             35020000
350500                PC-DISPLAY-LINE     DELIMITED BY SIZE             35030000
350600                             INTO PV-CICS-MSG-AREA                35040000
350700         MOVE LENGTH OF PV-CICS-MSG-AREA                          35050000
350800                               TO PV-COMMAREA-LENGTH              35060000
350900         PERFORM 9990-WRITE-CICS                                  35070000
351000         PERFORM Z900-SOFT-ABORT                                  35080000
351100     ELSE                                                         35090000
351200         STRING ' PCKCS770 - '      DELIMITED BY SIZE             35100000
351300                ' G400-UPDATE-UNITS-WRKD '                        35110000
351400                                    DELIMITED BY SIZE             35120000
351500                ' DB ERROR - SQL CODE '                           35130000
351600                                    DELIMITED BY SIZE             35140000
351700                PC-DISPLAY-SQL-CODE DELIMITED BY SIZE             35150000
351800                ' FUNC: '           DELIMITED BY SIZE             35160000
351900                PC238-BAD-TABLE-FUNCTION                          35170000
352000                                    DELIMITED BY SIZE             35180000
352100                ' TABLE: '          DELIMITED BY SIZE             35190000
352200                PC238-BAD-TABLE-NAME                              35200000
352300                                    DELIMITED BY SIZE             35210000
352400                             INTO PV-CICS-MSG-AREA                35220000
352500         MOVE LENGTH OF PV-CICS-MSG-AREA                          35230000
352600                               TO PV-COMMAREA-LENGTH              35240000
352700         PERFORM 9990-WRITE-CICS                                  35250000
352800         STRING ' PCKCS770 - '      DELIMITED BY SIZE             35260000
352900                ' G400-UPDATE-UNITS-WRKD '                        35270000
353000                                    DELIMITED BY SIZE             35280000
353100                ' KEY INFO - '      DELIMITED BY SIZE             35290000
353200                PC-DISPLAY-PO       DELIMITED BY SIZE             35300000
353300                ' - '               DELIMITED BY SIZE             35310000
353400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             35320000
353500                ' - '               DELIMITED BY SIZE             35330000
353600                PC-DISPLAY-LINE     DELIMITED BY SIZE             35340000
353700                             INTO PV-CICS-MSG-AREA                35350000
353800         MOVE LENGTH OF PV-CICS-MSG-AREA                          35360000
353900                               TO PV-COMMAREA-LENGTH              35370000
354000         PERFORM 9990-WRITE-CICS                                  35380000
354100         PERFORM Z900-SOFT-ABORT                                  35390000
354200     END-IF                                                       35400000
354300     END-IF                                                       35410000
354400     END-IF                                                       35420000
354500     END-IF                                                       35430000
354600     END-IF                                                       35440000
354700     END-IF                                                       35450000
354800     END-IF.                                                      35460000
354900                                                                  35470000
355000 G600-CALL-PO-RCVR-TRKING-MOD.                                    35480000
355100                                                                  35490000
355200     INITIALIZE RC071-FIELDS.                                     35500000
355300     MOVE RC289-ORD-NBR             TO RC071-PO-NBR               35510000
355400     MOVE RC289-RCVR-SEQ-NBR        TO RC071-PO-RCVR              35520000
355500     IF RC289-PREPK-M-OR-I                                        35530000
355600        MOVE DK-PREPK-ID-HOLD          TO RC071-PREPK-ID          35540000
355700        MOVE ZEROES                    TO RC071-PO-LINE           35550000
355800     ELSE                                                         35560000
355900        MOVE DK-ORD-LNE-NBR            TO RC071-PO-LINE           35570000
356000        MOVE ZEROES                    TO RC071-PREPK-ID          35580000
356100     END-IF                                                       35590000
356200     MOVE DISTHD-OPER-UNT-ID        TO RC071-SIGNON-LOCATION      35600000
356300     MOVE RC289-USER-ID             TO RC071-USER-ID              35610000
356400     MOVE RC289-CALLING-PROGRAM     TO RC071-CALLING-PROGRAM      35620000
356500     MOVE RC289-DC-FUNCTION-CODE    TO RC071-DC-FUNCTION-CODE     35630000
356600                                                                  35640000
356700     IF PS-PROCESS-QTY-GRTR-ZERO                                  35650000
356800        CONTINUE                                                  35660000
356900     ELSE                                                         35670000
357000        EVALUATE TRUE                                             35680000
357100          WHEN RC071-VERIF-TRLR-UNLOAD                            35690000
357200            SET RC071-VERIF-TRLR-UNLOAD-AT-0 TO TRUE              35700000
357300          WHEN RC071-VERIF-HOT-COMPLETE                           35710000
357400            SET RC071-VERIF-HOT-COMPLETE-0   TO TRUE              35720000
357500        END-EVALUATE                                              35730000
357600     END-IF                                                       35740000
357700                                                                  35750000
357800     MOVE LENGTH OF RC071-FIELDS    TO PV-COMMAREA-LENGTH.        35760000
357900                                                                  35770000
358000     CALL RC071-PO-RCVR-TRACKING USING  DFHEIBLK                  35780000
358100                                        RC071-COMMAREA            35790000
358200                                        RC071-FIELDS.             35800000
358300                                                                  35810000
358400     EVALUATE TRUE                                                35820000
358500       WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                   35830000
358600          IF RC071-SUCCESSFUL                                     35840000
358700             CONTINUE                                             35850000
358800          ELSE                                                    35860000
358900             MOVE 'G600-CALL-PO-RCVR-TRKING-MOD'                  35870000
359000                                     TO DP013-PARAGRAPH           35880000
359100             MOVE RC289-ORD-NBR      TO PV-ERROR-ORD-NBR          35890000
359200             MOVE RC289-RCVR-SEQ-NBR  TO PV-ERROR-RCVR-SEQ-NBR    35900000
359300             MOVE DISTHD-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      35910000
359400             MOVE DISTDT-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY    35920000
359500             MOVE DISTHD-OPER-UNT-ID TO PV-OPER-UNT-ID-DISPLAY    35930000
359600             STRING ' PCKCS770-RC137'   DELIMITED BY SIZE         35940000
359700                    ' RCVR: '           DELIMITED BY SIZE         35950000
359800                    PV-ERROR-ORD-NBR    DELIMITED BY SIZE         35960000
359900                    '-'                 DELIMITED BY SIZE         35970000
360000                    PV-ERROR-RCVR-SEQ-NBR                         35980000
360100                                        DELIMITED BY SIZE         35990000
360200                    '  LINE: '          DELIMITED BY SIZE         36000000
360300                    PV-ORD-LNE-NBR-DISPLAY                        36010000
360400                                        DELIMITED BY SIZE         36020000
360500                    '  FCLTY: '         DELIMITED BY SIZE         36030000
360600                    PV-OPER-UNT-ID-DISPLAY                        36040000
360700                                        DELIMITED BY SIZE         36050000
360800                           INTO PV-CICS-MSG-AREA                  36060000
360900             PERFORM 9990-WRITE-CICS                              36070000
361000             STRING ' OPER: '            DELIMITED BY SIZE        36080000
361100                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        36090000
361200                    ' RCVR: '            DELIMITED BY SIZE        36100000
361300                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        36110000
361400                  '-'                    DELIMITED BY SIZE        36120000
361500                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        36130000
361600                  ' IND: '               DELIMITED BY SIZE        36140000
361700                  RC071-SUCCESS-IND      DELIMITED BY SIZE        36150000
361800                                   INTO DP013-MESSAGE-TEXT (1)    36160000
361900             SET DP013-XCTL-DISPLAY-RESTART                       36170000
362000                 DP013-DB2-ABEND     TO TRUE                      36180000
362100                                                                  36190000
362200             PERFORM Z999-ABEND                                   36200000
362300          END-IF                                                  36210000
362400     END-EVALUATE.                                                36220000
362500                                                                  36230000
362600                                                                  36240000
362700 9300-CHECK-LOGGING.                                              36250000
362800     EXEC SQL                                                     36260000
362900         SELECT FUNC_TXT                                          36270000
363000           INTO :KRPRPM-FUNC-TXT                                  36280000
363100           FROM TKRPRPM                                           36290000
363200          WHERE SYS_PRC_FUNC_CDE  = 'PC770D'                      36300000
363300            AND LOC_ID            = 90                            36310000
363400            AND INTFC_SYS_CDE     = 'KHL'                         36320000
363500            AND FUNC_PRC_STAT_CDE = 'AC'                          36330000
363600     END-EXEC.                                                    36340000
363700                                                                  36350000
363800     EVALUATE TRUE                                                36360000
363900         WHEN SQLCODE = ZERO                                      36370000
364000           CONTINUE                                               36380000
364100         WHEN OTHER                                               36390000
364200           MOVE SPACES TO PV-CICS-MSG-AREA                        36400000
364300     END-EVALUATE.                                                36410000
364400                                                                  36420000
364500                                                                  36430000
364600 9990-WRITE-CICS.                                                 36440000
364700*!                                                                36450000
364800     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-CLENG.                 36460000
364900*!                                                                36470000
365000     EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA)     36480000
365100          LENGTH(PV-CLENG) NOHANDLE                               36490000
365200     END-EXEC.                                                    36500000
365300                                                                  36510000
365400*                                                                 36520000
365500                                                                  36530000
365600 9995-WRITE-CICS-FOR-DEBUG.                                       36540000
365700     IF KRPRPM-FUNC-TXT = 'Y'                                     36550000
365800         MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-CLENG              36560000
365900         EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA) 36570000
366000              LENGTH(PV-CLENG) NOHANDLE                           36580000
366100         END-EXEC                                                 36590000
366200         MOVE SPACES TO PV-CICS-MSG-AREA                          36600000
366300     END-IF.                                                      36610000
366400*                                                                 36620000
366500******************************************************************36630000
366600*   STANDARD ABEND ROUTINE                                        36640000
366700* ==> PROCESSES:                                                  36650000
366800*   - ISSUES THE ABEND.                                           36660000
366900******************************************************************36670000
367000 Z999-ABEND.                                                      36680000
367100     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           36690000
367200     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          36700000
367300     INITIALIZE DP013-SRC-TASK-NUMBER                             36710000
367400                DP013-STACK.                                      36720000
367500     SET DP013-LINK-RETURN TO TRUE.                               36730000
367600     SET DP013-ROLLBACK    TO TRUE.                               36740000
367700                                                                  36750000
367800     EXEC CICS                                                    36760000
367900         LINK                                                     36770000
368000             PROGRAM  (DP013-NAME)                                36780000
368100             COMMAREA (DP013-PARAMETERS)                          36790000
368200             LENGTH   (DP013-LENGTH)                              36800000
368300     END-EXEC.                                                    36810000
368400                                                                  36820000
368500                                                                  36830000
368600     EXEC CICS                                                    36840000
368700         RETURN                                                   36850000
368800     END-EXEC.                                                    36860000
368900                                                                  36870000
369000******************************************************************36880000
369100*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *36890000
369200*    AND THE ERROR SWITCHES.                                     *36900000
369300******************************************************************36910000
369400 Z900-SOFT-ABORT.                                                 36920000
369500     SET PS-ERROR         TO TRUE.                                36930000
369600     IF PS-UPDATES-DONE AND SQLCODE = -913                        36940000
369700        PERFORM Z901-BACKUP                                       36950000
369800     END-IF.                                                      36960000
369900                                                                  36970000
370000     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          36980000
370100                                                                  36990000
370200 Z901-BACKUP.                                                     37000000
370300     EXEC CICS SYNCPOINT                                          37010000
370400          ROLLBACK                                                37020000
370500     END-EXEC.                                                    37030000
370600                                                                  37040000
