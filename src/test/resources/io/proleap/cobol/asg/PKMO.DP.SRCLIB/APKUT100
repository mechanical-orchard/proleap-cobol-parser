000100 IDENTIFICATION DIVISION.                                         00010035
000200                                                                  00020035
000300 PROGRAM-ID.    APKUT100.                                         00030035
000400                                                                  00040035
000500 AUTHOR.        MARILYN WILKINSON.                                00050035
000600                                                                  00060035
000700 DATE-WRITTEN.  OCT 1995.                                         00070035
000800                                                                  00080035
000900 DATE-COMPILED.                                                   00090035
001000******************************************************************00100035
001100*                                                                *00110035
001200*  EXTRACT UNJOURNALIZED NON-INVOICED RECEIPTS                   *00120035
001300*                                                                *00130035
001400******************************************************************00140035
001500*                                                                *00150035
001600* OUTPUT:                                                        *00160035
001700*  1. UNJOURNALED-NINREC-EXTRACT           (APRD042)             *00170035
001800*                                                                *00180035
001900******************************************************************00190035
002000*   DATE   *           D E S C R I P T I O N                     *00200035
002100*   11/06/96  CHANGED TO SUPPORT THE AUTOMATIC WRITE-OFF OF      *00210035
002200*             UNJORNALIZED RECEIPTS.                             *00220035
002300*             - PGRPH 2000- SET INT-NON-INVC TO TRUE             *00230035
002400*             - PGRPH 2000- FILL INT-RC1-SHRDATE AND RC2-MKDATE  *00240035
002500*             - PGRPH 2300- REMOVE CHECK FOR STATUS_CDE = 'A'    *00250035
002600*             - POPULATE NEW FIELD ON THE EXTRACT                *00260035
002700*               INT-RC2-MKDATE-REFMT                             *00270035
002800*   CHANGED BY: PDVOLK                               WR#3803     *00280035
002900*                                                                *00290035
003000*   08/02/99  Y2K.  REPLACED THE INTRANEX COPYBOOK WITH APRD042. *00300035
003100*   CHANGED BY: ROBIN BERNOSKI                       WR#  6041   *00310035
003200*                                                                *00320035
003300*   01/24/02 ADDED CODE TO UNPACK AND STRIP OFF THE SIGN FOR THE *00330035
003400*            NON-INVC-SEQ-NBR BEING MOVED TO THE AP042-REC-SEQ-  *00340035
003500*            NBR.                                                *00350035
003600*   CHANGED BY: MIKE BESKE                           WR# 23005   *00360035
003700*                                                                *00370035
003800* 02/06/2003                                                     *00380035
003900*    CHANGE MADE: ARKPO PHASE3 PROJECT.                          *00390035
004000*    UPDATED THE PGM TITLE TO MATCH THE SPEC TITLE.              *00400035
004100*    ADDED PGM COMMENT BLOCK WITH THE FILENAMES. CHANGED THE DD  *00410035
004200*    CARDNAME TO STANDARD OUT01.                                 *00420035
004300* MADE BY:  MIKE BESKE                          WR#: 23500       *00430035
004400*                                                                *00440035
004500* 04/01/2004                                                     *00450035
004600*    CHANGE MADE: INCREASED THE VARIUOS W/S STORE FIELDS FROM    *00460035
004700*    3 TO 4 CHARACTERS.                                          *00470035
004800* MADE BY:  MIKE BESKE                          WR#: 25805       *00480035
004810*                                                                *00481035
004820* 03/11/2007                                                     *00482037
004830*    CHANGE MADE: MATCH BY DC PROJECT.                           *00483035
004840*    ADDED DC_NBR TO THE NINREC_CURSOR.                          *00484035
004850* MADE BY:  MICHELE RINDFLEISCH                 WR#: 21578       *00485035
004851*                                                                *00485138
004852* 03/28/2009                                                     *00485239
004853*    CHANGE MADE: RECOMPILE FOR UPDATED DCLGEN.                  *00485338
004856*      MADE BY: SCOTT KRUSCHKA          WR/IR #: INC000000751993 *00485638
004851*                                                                *00485740
004852* 08/30/2021                                                     *00485840
004853*    CHANGE MADE: ADD SEPHORA INDICATOR TO OUTPUT RECORD         *00485940
004856*      MADE BY: JEAN KURK               WR/IR #: CHG0260549      *00486040
004860******************************************************************00486135
004870     EJECT                                                        00487035
004880 ENVIRONMENT DIVISION.                                            00488035
004890                                                                  00489035
004900 INPUT-OUTPUT SECTION.                                            00490035
005000                                                                  00500035
005100 FILE-CONTROL.                                                    00510035
005200                                                                  00520035
005300     SELECT UNJOURNALED-NINREC-EXTRACT ASSIGN TO UT-S-OUT01.      00530035
005400                                                                  00540035
005500 DATA DIVISION.                                                   00550035
005600                                                                  00560035
005700 FILE SECTION.                                                    00570035
005800                                                                  00580035
005900 FD  UNJOURNALED-NINREC-EXTRACT                                   00590035
006000     RECORDING MODE IS F                                          00600035
006100     LABEL RECORDS ARE STANDARD                                   00610035
006200     BLOCK CONTAINS 0 CHARACTERS.                                 00620035
006300                                                                  00630035
006400 01  UNJOURNALED-RECORD          PIC X(120).                      00640035
006500                                                                  00650035
006600 EJECT                                                            00660035
006700 WORKING-STORAGE SECTION.                                         00670035
006800                                                                  00680035
006900 01  ABEND-CODE                  PIC S9(04)  COMP SYNC            00690035
007000                                             VALUE +0.            00700035
007100     88 AP-DB2-ERROR               VALUE +4013.                   00710035
007200                                                                  00720035
007300 01  WS-ABEND-FIELDS.                                             00730035
007400     05  WS-ABEND-PROGRAM             PIC X(8)  VALUE 'APKUT100'. 00740035
007500     05  WS-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00750035
007600     05  WS-ABEND-OPERATION           PIC X(50) VALUE SPACES.     00760035
007700     05  WS-ABEND-STRUCTURE-1         PIC X(8)  VALUE SPACES.     00770035
007800     05  WS-ABEND-STRUCTURE-2         PIC X(8)  VALUE SPACES.     00780035
007900     05  WS-ABEND-STATUS              PIC XX    VALUE SPACES.     00790035
008000     05  WS-ABEND-SSA-1               PIC X(50) VALUE SPACES.     00800035
008100     05  WS-ABEND-SSA-2               PIC X(50) VALUE SPACES.     00810035
008200     05  WS-ABEND-SSA-3               PIC X(50) VALUE SPACES.     00820035
008300     05  WS-ABEND-SSA-4               PIC X(50) VALUE SPACES.     00830035
008400                                                                  00840035
008500 01  WORK-AREAS.                                                  00850035
008600     05  WS-TABLE-NAME           PIC X(7).                        00860035
008700     05  WS-PARAGRAPH-NAME       PIC X(30).                       00870035
008800                                                                  00880035
008900 01  WS-REC-SEQ-NBR              PIC S9(9) VALUE ZEROS.           00890035
009000 01  WS-REC-SEQ-NBR-9            PIC 9(9) VALUE ZEROS.            00900035
009100                                                                  00910035
009200 01  PC-PROGRAM-CONSTANTS.                                        00920035
009300     05  PC-MAX-RETRIES          PIC S9(04)  COMP   VALUE +3.     00930035
009400                                                                  00940035
009500 01  PV-PROGRAM-VARIABLES.                                        00950035
009600     05  PV-CALC-FIELD           PIC S9(07)V99 COMP-3 VALUE 0.    00960035
009700     05  PV-RETRY-COUNTER        PIC S9(04)  COMP   VALUE 0.      00970035
009800     05  PV-EXTRACT-WRITTEN      PIC S9(9)   COMP-3 VALUE ZERO.   00980035
009900     05  PV-EDIT-MASK            PIC ZZZ,ZZZ,ZZ9.                 00990035
010000     05  PV-STR-NBR              PIC 9(04).                       01000035
010100     05  FILLER     REDEFINES PV-STR-NBR.                         01010035
010200         10  PV-STR-NBR-X        PIC X(04).                       01020035
010300     05  WS-STR-NBR              PIC S9(4).                       01030035
010350                                                                  01035035
010360     05  PV-DATE-YYMMDD-9               PIC 9(10)   VALUE ZEROS.  01036035
010370     05  PV-DATE-YYMMDD-X REDEFINES     PV-DATE-YYMMDD-9.         01037035
010380         10  PV-DATE-CC                 PIC  X(02).               01038035
010390         10  PV-DATE-YY                 PIC  X(02).               01039035
010400         10  PV-DASH-1                  PIC  X(01).               01040035
010500         10  PV-DATE-MM                 PIC  X(02).               01050035
010600         10  PV-DASH-2                  PIC  X(01).               01060035
010700         10  PV-DATE-DD                 PIC  X(02).               01070035
010800                                                                  01080035
010900     05  PV-DASH-LINE.                                            01090035
011000         10  PV-DASHES                  PIC  X(01) VALUE '-'.     01100035
011100                                                                  01110035
011200     05  PV-DATE8-CCYYMMDD.                                       01120035
011300         10  PV-DATE8-CCYY              PIC  X(04).               01130035
011400         10  FILLER                     PIC  X(01) VALUE '-'.     01140035
011500         10  PV-DATE8-MM                PIC  X(02).               01150035
011600         10  FILLER                     PIC  X(01) VALUE '-'.     01160035
011700         10  PV-DATE8-DD                PIC  X(02).               01170035
011800                                                                  01180035
011900     05  PV-YYYYMMDD.                                             01190035
012000         10  PV-CENTURY          PIC X(02) VALUE '00'.            01200035
012100         10  PV-YYMMDD.                                           01210035
012200             15 PV-YY            PIC X(02) VALUE '00'.            01220035
012300             15 PV-MM            PIC X(02) VALUE '00'.            01230035
012400             15 PV-DD            PIC X(02) VALUE '00'.            01240035
012500         10  PV-YYMMDD-9  REDEFINES PV-YYMMDD  PIC 9(06).         01250035
012600                                                                  01260035
012700     05  PV-DATE-MMDDYY-9               PIC 9(06)   VALUE ZEROS.  01270035
012800     05  PV-DATE-MMDDYY-X REDEFINES     PV-DATE-MMDDYY-9.         01280035
012900         10  PV-DATE-REF-MM             PIC  X(02).               01290035
013000         10  PV-DATE-REF-DD             PIC  X(02).               01300035
013100         10  PV-DATE-REF-YY             PIC  X(02).               01310035
013200                                                                  01320035
013300 01  PS-PROGRAM-SWITCHES.                                         01330035
013400     05  PS-NINRECS-SWITCH              PIC  X(01)  VALUE 'Y'.    01340035
013500         88  PS-MORE-NINREC                         VALUE 'Y'.    01350035
013600         88  PS-NO-MORE-NINREC                      VALUE 'N'.    01360035
013700                                                                  01370035
013800     EJECT                                                        01380035
013900     COPY DPWS004.                                                01390035
014000     EJECT                                                        01400035
014100******************************************************************01410035
014200**                   EXTRACT RECORD LAYOUT                      **01420035
014300******************************************************************01430035
014400     COPY APRD042.                                                01440035
014500     EJECT                                                        01450035
014600******************************************************************01460035
014700**                      DB2 WORK AREAS                          **01470035
014800******************************************************************01480035
014900**                    PO HEADER    TABLE LAYOUT                 **01490035
015000******************************************************************01500035
015100     EXEC SQL                                                     01510035
015200         INCLUDE TPURCHS                                          01520035
015300     END-EXEC.                                                    01530035
015400     EJECT                                                        01540035
015500******************************************************************01550035
015600**                    PO ITEM      TABLE LAYOUT                 **01560035
015700******************************************************************01570035
015800     EXEC SQL                                                     01580035
015900         INCLUDE TPURITM                                          01590035
016000     END-EXEC.                                                    01600035
016100     EJECT                                                        01610035
016200******************************************************************01620035
016300**        NONINVOICED RECEIPTS         TABLE LAYOUT             **01630035
016400******************************************************************01640035
016500     EXEC SQL                                                     01650035
016600         INCLUDE TNINREC                                          01660035
016700     END-EXEC.                                                    01670035
016800     EJECT                                                        01680035
016900******************************************************************01690035
017000**                                                              **01700035
017100******************************************************************01710035
017200     EXEC SQL                                                     01720035
017300         INCLUDE TEXTENT                                          01730035
017400     END-EXEC.                                                    01740035
017500     EJECT                                                        01750035
017600******************************************************************01760035
017700**                                                              **01770035
017800******************************************************************01780035
017900     EXEC SQL                                                     01790035
018000         INCLUDE TENTNME                                          01800035
018100     END-EXEC.                                                    01810035
018200     EJECT                                                        01820035
017600******************************************************************01821041
017700**                                                              **01822041
017800******************************************************************01823041
017900     EXEC SQL                                                     01824041
018000         INCLUDE TMDSEAR                                          01825041
018100     END-EXEC.                                                    01826041
018200     EJECT                                                        01827041
017600******************************************************************01828041
017700**  VNT_VND_CPBL                                                **01829041
017800******************************************************************01829141
017900     EXEC SQL                                                     01829241
018000         INCLUDE VNT00001                                         01829341
018100     END-EXEC.                                                    01829441
018200     EJECT                                                        01829541
018300******************************************************************01830035
018400**                  DB2 COMMUNICATION AREA                      **01840035
018500******************************************************************01850035
018600     EXEC SQL                                                     01860035
018700         INCLUDE SQLCA                                            01870035
018800     END-EXEC.                                                    01880035
018900******************************************************************01890035
019000**                  DB2 COMMUNICATION AREA  2                   **01900035
019100******************************************************************01910035
019200     COPY SQLCA2.                                                 01920035
019300     EJECT                                                        01930035
066700*--------------------------------------------------------------*  01931042
066800* COPYBOOK FOR SEPHORA LOGIC                                   *  01932042
066900*--------------------------------------------------------------*  01933042
067000     COPY APWS021.                                                01934042
067100                                                                  01935042
019400******************************************************************01940035
019500**   CURSOR USED TO FETCH THE NON-INVOICE RECEIPTS DATA         **01950035
019600******************************************************************01960035
019700     EXEC SQL                                                     01970035
019800         DECLARE NINREC_CURSOR CURSOR FOR                         01980035
019900             SELECT   PO_NBR                                      01990035
020000                    , PO_LNE_NBR                                  02000035
020100                    , NON_INVC_SEQ_NBR                            02010035
020200                    , UNT_COST_AMT                                02020035
020300                    , STR_NBR                                     02030035
020400                    , NON_INVC_UNT_QTY                            02040035
020500                    , REC_TMST                                    02050035
020600                    , DC_NBR                                      02060035
020700             FROM     TNINREC                                     02070035
020800             WHERE    STATUS_CDE = ' '                            02080035
020900             ORDER BY PO_NBR                                      02090035
021000                    , PO_LNE_NBR                                  02100035
021100     END-EXEC.                                                    02110035
021200     EJECT                                                        02120035
021300 PROCEDURE DIVISION.                                              02130035
021350                                                                  02135035
021360     EXEC SQL                                                     02136035
021370         WHENEVER SQLWARNING                                      02137035
021380             GO TO 9998-SQL-WARNING                               02138035
021390     END-EXEC.                                                    02139035
021400                                                                  02140035
021500     INITIALIZE DCLTPURCHS.                                       02150035
021600     INITIALIZE DCLTPURITM.                                       02160035
021700     INITIALIZE DCLTEXTENT.                                       02170035
021800     INITIALIZE DCLTENTNME.                                       02180035
021900                                                                  02190035
022000     OPEN OUTPUT UNJOURNALED-NINREC-EXTRACT.                      02200035
022100                                                                  02210035
129500*    GET SEPHORA DATA                                             02212040
129500     MOVE WS-ABEND-PROGRAM     TO SA-PROGRAM-NAME.                02213043
129500     PERFORM S100-GET-SEPHORA-DEPT.                               02214040
025200                                                                  02215040
022200     PERFORM 9000-OPEN-NINREC-CURSOR.                             02220035
022300     PERFORM 9100-FETCH-NINREC-CURSOR.                            02230035
022400                                                                  02240035
022500     PERFORM 2000-PROCESS-NINREC                                  02250035
022600            UNTIL PS-NO-MORE-NINREC.                              02260035
022700                                                                  02270035
022800     PERFORM 9200-CLOSE-NINREC-CURSOR.                            02280035
022900                                                                  02290035
023000     DISPLAY 'NONINVOICED ROWS SELECTED....'                      02300035
023100         PV-EDIT-MASK                                             02310035
023200     MOVE PV-EXTRACT-WRITTEN     TO PV-EDIT-MASK                  02320035
023300     INSPECT PV-EDIT-MASK REPLACING LEADING SPACES                02330035
023400         BY '.'                                                   02340035
023500     DISPLAY 'EXTRACT RECORDS WRITTEN......'                      02350035
023600         PV-EDIT-MASK                                             02360035
023700                                                                  02370035
023800     CLOSE UNJOURNALED-NINREC-EXTRACT.                            02380035
023900                                                                  02390035
024000     GOBACK.                                                      02400035
024100     EJECT                                                        02410035
024200******************************************************************02420035
024300**                    2000-PROCESS-NINREC                       **02430035
024400**  CONTROLS PROCESSING FOR EACH RECORD READ IN THE NINREC      **02440035
024500**  DATABASE.                                                   **02450035
024600******************************************************************02460035
024700                                                                  02470035
024800 2000-PROCESS-NINREC.                                             02480035
024900                                                                  02490035
025000     IF NINREC-PO-NBR NOT = PURCHS-PO-NBR                         02500035
025100        PERFORM 2100-PURCHS-DATA                                  02510035
025200        PERFORM 2200-PURITM-DATA                                  02520035
025200        PERFORM 2400-GET-SEPHORA-IND                              02521040
025300        IF PURCHS-ENT-ID NOT = EXTENT-ENT-ID                      02530035
025400           PERFORM 2300-EXTENT-DATA                               02540035
025500        END-IF                                                    02550035
025600     END-IF.                                                      02560035
025700                                                                  02570035
025800     IF NINREC-PO-LNE-NBR NOT = PURITM-APP-PO-LNE-NBR             02580035
025900        PERFORM 2200-PURITM-DATA                                  02590035
026000     END-IF.                                                      02600035
026100                                                                  02610035
026200     MOVE SPACES                     TO AP042-EXTRACT-FILE.       02620035
026300     INITIALIZE                         AP042-EXTRACT-FILE.       02630035
026400                                                                  02640035
026500     SET AP042-NON-INVC TO TRUE.                                  02650035
026600                                                                  02660035
026700     MOVE ZEROS                      TO WS-REC-SEQ-NBR            02670035
026800                                        WS-REC-SEQ-NBR-9.         02680035
026900     MOVE NINREC-NON-INVC-SEQ-NBR    TO WS-REC-SEQ-NBR.           02690035
027000     MOVE WS-REC-SEQ-NBR             TO WS-REC-SEQ-NBR-9.         02700035
027100     MOVE WS-REC-SEQ-NBR-9           TO AP042-REC-SEQ-NBR.        02710035
027200                                                                  02720035
027300     MOVE NINREC-REC-TMST(1:10)      TO AP042-REC-DTE.            02730035
027400     MOVE NINREC-REC-TMST(1:10)      TO AP042-VRFD-DTE.           02740035
027500                                                                  02750035
027600     MOVE NINREC-PO-NBR              TO AP042-PO-NBR.             02760035
027700                                                                  02770035
027800     MOVE NINREC-STR-NBR             TO WS-STR-NBR                02780035
027900     MOVE WS-STR-NBR                 TO PV-STR-NBR.               02790035
028000     MOVE PV-STR-NBR-X               TO AP042-STR-NBR.            02800035
028400                                                                  02840035
028500     COMPUTE PV-CALC-FIELD                                        02850035
028600        =    NINREC-NON-INVC-UNT-QTY                              02860035
028700        *    PURITM-UNT-RTL-PR-AMT.                               02870035
028800     MOVE PV-CALC-FIELD              TO AP042-CALCD-VRFD-RTL-AMT. 02880035
028900                                                                  02890035
029000     COMPUTE PV-CALC-FIELD                                        02900035
029100        =    NINREC-NON-INVC-UNT-QTY                              02910035
029200        *    NINREC-UNT-COST-AMT.                                 02920035
029300     MOVE PV-CALC-FIELD              TO AP042-CALCD-VRFD-COST-AMT.02930035
029400                                                                  02940035
029500     MOVE PURITM-CL-NBR              TO AP042-CL-NBR(1:2).        02950035
029600     MOVE '0'                        TO AP042-CL-NBR(3:1).        02960035
029700                                                                  02970035
029800     MOVE PURCHS-DEPT-NBR            TO AP042-DEPT-NBR.           02980035
029900     MOVE EXTENT-DUN-NBR             TO AP042-VND-NBR.            02990035
030000     IF ENTNME-ENT-NAME-DESC  = SPACES                            03000035
030100        MOVE ' UNKNOWN VENDOR          '                          03010035
030200                                     TO AP042-ENT-NM-DESC         03020035
030300     ELSE                                                         03030035
030400        MOVE ENTNME-ENT-NAME-DESC    TO AP042-ENT-NM-DESC.        03040035
030500     MOVE NINREC-PO-LNE-NBR          TO AP042-PO-LNE-NBR.         03050035
030600     MOVE NINREC-NON-INVC-UNT-QTY    TO AP042-PO-VRFD-QTY.        03060035
028400                                                                  03060140
216700     IF PS-SEPHORA-ALL                                            03061040
216700         SET AP042-IS-SEPHORA      TO TRUE                        03062040
216700     ELSE                                                         03063040
216700         SET AP042-IS-NOT-SEPHORA  TO TRUE                        03064040
216700     END-IF.                                                      03065040
030700                                                                  03070035
030800     WRITE UNJOURNALED-RECORD FROM AP042-EXTRACT-FILE.            03080035
030900     ADD 1 TO PV-EXTRACT-WRITTEN.                                 03090035
031000                                                                  03100035
031100     PERFORM 9100-FETCH-NINREC-CURSOR.                            03110035
031200                                                                  03120035
031300     EJECT                                                        03130035
031400 2100-PURCHS-DATA.                                                03140035
031500                                                                  03150035
031600     INITIALIZE DCLTPURCHS.                                       03160035
031700                                                                  03170035
031800     PERFORM WITH TEST AFTER                                      03180035
031900        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      03190035
032000        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              03200035
032100                SQLCODE = ZERO OR                                 03210035
032200                SQLCODE = +100                                    03220035
032300        EXEC SQL                                                  03230035
032400           SELECT PO_NBR                                          03240035
032500                , DEPT_NBR                                        03250035
032600                , ENT_ID                                          03260035
032700           INTO   :PURCHS-PO-NBR                                  03270035
032800                , :PURCHS-DEPT-NBR                                03280035
032900                , :PURCHS-ENT-ID                                  03290035
033000           FROM   TPURCHS                                         03300035
033100           WHERE  PO_NBR         = :NINREC-PO-NBR                 03310035
033200             AND  VER_STATUS_CDE = 'A'                            03320035
033300        END-EXEC                                                  03330035
033400                                                                  03340035
033500        EVALUATE TRUE                                             03350035
033600            WHEN SQLCODE = ZERO                                   03360035
033700            WHEN SQLCODE = +100                                   03370035
033800            WHEN SQLCODE = -904                                   03380035
033900            WHEN SQLCODE = -913                                   03390035
034000                 CONTINUE                                         03400035
034100            WHEN SQLWARN0 NOT = SPACES                            03410035
034200            WHEN SQLCODE  NOT = ZERO                              03420035
034300                 MOVE '2100-PURCHS-DATA              '            03430035
034400                               TO WS-ABEND-PARAGRAPH              03440035
034500                 MOVE 'UNSUCCESSFUL SELECT PURCHS'                03450035
034600                               TO WS-ABEND-OPERATION              03460035
034700                 MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1          03470035
034800                 MOVE '        ' TO WS-ABEND-STRUCTURE-2          03480035
034900                 PERFORM 9999-SQL-ERROR                           03490035
035000        END-EVALUATE                                              03500035
035100     END-PERFORM.                                                 03510035
035200                                                                  03520035
035300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         03530035
035400         MOVE '2100-PURCHS-DATA              '                    03540035
035500                       TO WS-ABEND-PARAGRAPH                      03550035
035600         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURCHS'             03560035
035700                         TO WS-ABEND-OPERATION                    03570035
035800         PERFORM 9999-SQL-ERROR                                   03580035
035900     END-IF.                                                      03590035
036000                                                                  03600035
036100     EVALUATE TRUE                                                03610035
036200        WHEN SQLCODE = ZEROS                                      03620035
036300        WHEN SQLCODE = +100                                       03630035
036400             CONTINUE                                             03640035
036500        WHEN OTHER                                                03650035
036600             MOVE '2100-PURCHS-DATA              ' TO             03660035
036700                                       WS-ABEND-PARAGRAPH         03670035
036800             MOVE 'UNSUCCESSFUL SELECT PURCHS'                    03680035
036900                           TO WS-ABEND-OPERATION                  03690035
037000             MOVE 'TPURCHS ' TO WS-ABEND-STRUCTURE-1              03700035
037100             MOVE '        ' TO WS-ABEND-STRUCTURE-2              03710035
037200             PERFORM 9999-SQL-ERROR                               03720035
037300     END-EVALUATE.                                                03730035
037400                                                                  03740035
037500 2200-PURITM-DATA.                                                03750035
037600                                                                  03760035
037700     INITIALIZE DCLTPURITM.                                       03770035
037800                                                                  03780035
037900     PERFORM WITH TEST AFTER                                      03790035
038000        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      03800035
038100        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              03810035
038200                SQLCODE = ZERO OR                                 03820035
038300                SQLCODE = +100                                    03830035
038400        EXEC SQL                                                  03840035
038500           SELECT PO_NBR                                          03850035
038600                , PO_LNE_NBR                                      03860035
038700                , CL_NBR                                          03870035
038800                , UNT_RTL_PR_AMT                                  03880035
038900           INTO   :PURITM-PO-NBR                                  03890035
039000                , :PURITM-APP-PO-LNE-NBR                          03900035
039100                , :PURITM-CL-NBR                                  03910035
039200                , :PURITM-UNT-RTL-PR-AMT                          03920035
039300           FROM   TPURITM                                         03930035
039400           WHERE  PO_NBR         = :NINREC-PO-NBR                 03940035
039500             AND  VER_STATUS_CDE = 'A'                            03950035
039600             AND  APP_PO_LNE_NBR = :NINREC-PO-LNE-NBR             03960035
039700        END-EXEC                                                  03970035
039800                                                                  03980035
039900        EVALUATE TRUE                                             03990035
040000            WHEN SQLCODE = ZERO                                   04000035
040100            WHEN SQLCODE = +100                                   04010035
040200            WHEN SQLCODE = -904                                   04020035
040300            WHEN SQLCODE = -913                                   04030035
040400                 CONTINUE                                         04040035
040500            WHEN SQLWARN0 NOT = SPACES                            04050035
040600            WHEN SQLCODE  NOT = ZERO                              04060035
040700                 MOVE '2200-PURITM-DATA              '            04070035
040800                               TO WS-ABEND-PARAGRAPH              04080035
040900                 MOVE 'UNSUCCESSFUL SELECT PURITM'                04090035
041000                               TO WS-ABEND-OPERATION              04100035
041100                 MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1          04110035
041200                 MOVE '        ' TO WS-ABEND-STRUCTURE-2          04120035
041300                 PERFORM 9999-SQL-ERROR                           04130035
041400        END-EVALUATE                                              04140035
041500     END-PERFORM.                                                 04150035
041600                                                                  04160035
041700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04170035
041800         MOVE '2200-PURITM-DATA              '                    04180035
041900                       TO WS-ABEND-PARAGRAPH                      04190035
042000         MOVE 'MAX RETRIES EXCEEDED ON SELECT PURITM'             04200035
042100                         TO WS-ABEND-OPERATION                    04210035
042200         PERFORM 9999-SQL-ERROR                                   04220035
042300     END-IF.                                                      04230035
042400                                                                  04240035
042500     EVALUATE TRUE                                                04250035
042600        WHEN SQLCODE = ZEROS                                      04260035
042700        WHEN SQLCODE = +100                                       04270035
042800             CONTINUE                                             04280035
042900        WHEN OTHER                                                04290035
043000             MOVE '2200-PURITM-DATA              ' TO             04300035
043100                                       WS-ABEND-PARAGRAPH         04310035
043200             MOVE 'UNSUCCESSFUL SELECT PURITM'                    04320035
043300                           TO WS-ABEND-OPERATION                  04330035
043400             MOVE 'TPURITM ' TO WS-ABEND-STRUCTURE-1              04340035
043500             MOVE '        ' TO WS-ABEND-STRUCTURE-2              04350035
043600             PERFORM 9999-SQL-ERROR                               04360035
043700     END-EVALUATE.                                                04370035
043800                                                                  04380035
043900 2300-EXTENT-DATA.                                                04390035
044000                                                                  04400035
044100     INITIALIZE DCLTEXTENT.                                       04410035
044200     INITIALIZE DCLTENTNME.                                       04420035
044300                                                                  04430035
044400     PERFORM WITH TEST AFTER                                      04440035
044500        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      04450035
044600        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              04460035
044700                SQLCODE = ZERO OR                                 04470035
044800                SQLCODE = +100                                    04480035
044900        EXEC SQL                                                  04490035
045000           SELECT A.ENT_ID                                        04500035
045100                , A.DUN_NBR                                       04510035
045200                , B.ENT_NAME_DESC                                 04520035
045300           INTO   :EXTENT-ENT-ID                                  04530035
045400                , :EXTENT-DUN-NBR                                 04540035
045500                , :ENTNME-ENT-NAME-DESC                           04550035
045600           FROM   TEXTENT  A                                      04560035
045700                , TENTNME  B                                      04570035
045800           WHERE  A.ENT_ID       = :PURCHS-ENT-ID                 04580035
045900             AND  B.ENT_ID       = :PURCHS-ENT-ID                 04590035
046000             AND  B.TYPE_CDE     = '01'                           04600035
046100        END-EXEC                                                  04610035
046200                                                                  04620035
046300        EVALUATE TRUE                                             04630035
046400            WHEN SQLCODE = ZERO                                   04640035
046500            WHEN SQLCODE = +100                                   04650035
046600            WHEN SQLCODE = -904                                   04660035
046700            WHEN SQLCODE = -913                                   04670035
046800                 CONTINUE                                         04680035
046900            WHEN SQLWARN0 NOT = SPACES                            04690035
047000            WHEN SQLCODE  NOT = ZERO                              04700035
047100                 MOVE '2300-EXTENT-DATA              '            04710035
047200                               TO WS-ABEND-PARAGRAPH              04720035
047300                 MOVE 'UNSUCCESSFUL SELECT EXTENT'                04730035
047400                               TO WS-ABEND-OPERATION              04740035
047500                 MOVE 'TEXTENT ' TO WS-ABEND-STRUCTURE-1          04750035
047600                 MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-2          04760035
047700                 PERFORM 9999-SQL-ERROR                           04770035
047800        END-EVALUATE                                              04780035
047900     END-PERFORM.                                                 04790035
048000                                                                  04800035
048100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         04810035
048200         MOVE '2300-EXTENT-DATA              '                    04820035
048300                       TO WS-ABEND-PARAGRAPH                      04830035
048400         MOVE 'MAX RETRIES EXCEEDED ON SELECT EXTENT'             04840035
048500                         TO WS-ABEND-OPERATION                    04850035
048600         PERFORM 9999-SQL-ERROR                                   04860035
048700     END-IF.                                                      04870035
048800                                                                  04880035
048900     EVALUATE TRUE                                                04890035
049000        WHEN SQLCODE = ZEROS                                      04900035
049100        WHEN SQLCODE = +100                                       04910035
049200             CONTINUE                                             04920035
049300        WHEN OTHER                                                04930035
049400             MOVE '2300-EXTENT-DATA              ' TO             04940035
049500                                       WS-ABEND-PARAGRAPH         04950035
049600             MOVE 'UNSUCCESSFUL SELECT EXTENT'                    04960035
049700                           TO WS-ABEND-OPERATION                  04970035
049800             MOVE 'TEXTENT ' TO WS-ABEND-STRUCTURE-1              04980035
049900             MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-2              04990035
050000             PERFORM 9999-SQL-ERROR                               05000035
050100     END-EVALUATE.                                                05010035
050200                                                                  05020035
037400                                                                  05021040
037500 2400-GET-SEPHORA-IND.                                            05022040
037600                                                                  05023040
037600     MOVE PURCHS-ENT-ID        TO PV-ENT-ID.                      05023143
037600     MOVE AP042-DEPT-NBR       TO PV-DEPT-NBR.                    05023243
037600     PERFORM S500-CHECK-FOR-SEPHORA.                              05023343
037600                                                                  05023440
037600                                                                  05023543
050400 9000-OPEN-NINREC-CURSOR.                                         05040035
050500                                                                  05050035
050600     PERFORM WITH TEST AFTER                                      05060035
050700        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      05070035
050800        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              05080035
050900                SQLCODE = ZERO                                    05090035
051000        EXEC SQL                                                  05100035
051100            OPEN NINREC_CURSOR                                    05110035
051200        END-EXEC                                                  05120035
051300                                                                  05130035
051400        EVALUATE TRUE                                             05140035
051500            WHEN SQLCODE = ZERO                                   05150035
051600            WHEN SQLCODE = -904                                   05160035
051700            WHEN SQLCODE = -913                                   05170035
051800                 CONTINUE                                         05180035
051900            WHEN SQLWARN0 NOT = SPACES                            05190035
052000            WHEN SQLCODE  NOT = ZERO                              05200035
052100                 MOVE '9000-OPEN-NINREC-CURSOR       '            05210035
052200                               TO WS-ABEND-PARAGRAPH              05220035
052300                 MOVE 'UNSUCCESSFUL OPEN   NINREC'                05230035
052400                               TO WS-ABEND-OPERATION              05240035
052500                 MOVE 'TNINREC ' TO WS-ABEND-STRUCTURE-1          05250035
052600                 MOVE '        ' TO WS-ABEND-STRUCTURE-2          05260035
052700                 PERFORM 9999-SQL-ERROR                           05270035
052800        END-EVALUATE                                              05280035
052900     END-PERFORM.                                                 05290035
053000                                                                  05300035
053100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05310035
053200         MOVE '9000-OPEN-NINREC-CURSOR       '                    05320035
053300                       TO WS-ABEND-PARAGRAPH                      05330035
053400         MOVE 'MAX RETRIES EXCEEDED ON OPEN   NINREC'             05340035
053500                         TO WS-ABEND-OPERATION                    05350035
053600         PERFORM 9999-SQL-ERROR                                   05360035
053700     END-IF.                                                      05370035
053800                                                                  05380035
053900     EVALUATE TRUE                                                05390035
054000        WHEN SQLCODE = ZEROS                                      05400035
054100             CONTINUE                                             05410035
054200        WHEN OTHER                                                05420035
054300             MOVE '9000-OPEN-NINREC-CURSOR       ' TO             05430035
054400                                       WS-ABEND-PARAGRAPH         05440035
054500             MOVE 'UNSUCCESSFUL OPEN   NINREC'                    05450035
054600                           TO WS-ABEND-OPERATION                  05460035
054700             MOVE 'TNINREC ' TO WS-ABEND-STRUCTURE-1              05470035
054800             MOVE '        ' TO WS-ABEND-STRUCTURE-2              05480035
054900             PERFORM 9999-SQL-ERROR                               05490035
055000     END-EVALUATE.                                                05500035
055100                                                                  05510035
055200 9100-FETCH-NINREC-CURSOR.                                        05520035
055300                                                                  05530035
055400     PERFORM WITH TEST AFTER                                      05540035
055500        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      05550035
055600        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              05560035
055700                SQLCODE = ZERO OR                                 05570035
055800                SQLCODE = +100                                    05580035
055900        EXEC SQL                                                  05590035
056000           FETCH NINREC_CURSOR                                    05600035
056100               INTO   :NINREC-PO-NBR                              05610035
056200                    , :NINREC-PO-LNE-NBR                          05620035
056300                    , :NINREC-NON-INVC-SEQ-NBR                    05630035
056400                    , :NINREC-UNT-COST-AMT                        05640035
056500                    , :NINREC-STR-NBR                             05650035
056600                    , :NINREC-NON-INVC-UNT-QTY                    05660035
056700                    , :NINREC-REC-TMST                            05670035
056800                    , :NINREC-DC-NBR                              05680035
056900        END-EXEC                                                  05690035
057000                                                                  05700035
057100        EVALUATE TRUE                                             05710035
057200            WHEN SQLCODE = ZERO                                   05720035
057300            WHEN SQLCODE = -904                                   05730035
057400            WHEN SQLCODE = -913                                   05740035
057500                 CONTINUE                                         05750035
057600            WHEN SQLCODE = +100                                   05760035
057700                 SET PS-NO-MORE-NINREC TO TRUE                    05770035
057800            WHEN SQLWARN0 NOT = SPACES                            05780035
057900            WHEN SQLCODE  NOT = ZERO                              05790035
058000                 MOVE '9100-FETCH-NINREC-CURSOR      '            05800035
058100                               TO WS-ABEND-PARAGRAPH              05810035
058200                 MOVE 'UNSUCCESSFUL FETCH  NINREC'                05820035
058300                               TO WS-ABEND-OPERATION              05830035
058400                 MOVE 'TNINREC ' TO WS-ABEND-STRUCTURE-1          05840035
058500                 MOVE '        ' TO WS-ABEND-STRUCTURE-2          05850035
058600                 PERFORM 9999-SQL-ERROR                           05860035
058700        END-EVALUATE                                              05870035
058800     END-PERFORM.                                                 05880035
058900                                                                  05890035
059000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05900035
059100         MOVE '9100-FETCH-NINREC-CURSOR      '                    05910035
059200                       TO WS-ABEND-PARAGRAPH                      05920035
059300         MOVE 'MAX RETRIES EXCEEDED ON FETCH  NINREC'             05930035
059400                         TO WS-ABEND-OPERATION                    05940035
059500         PERFORM 9999-SQL-ERROR                                   05950035
059600     END-IF.                                                      05960035
059700                                                                  05970035
059800     EVALUATE TRUE                                                05980035
059900        WHEN SQLCODE = ZEROS                                      05990035
060000        WHEN SQLCODE = +100                                       06000035
060100             CONTINUE                                             06010035
060200        WHEN OTHER                                                06020035
060300             MOVE '9100-FETCH-NINREC-CURSOR      ' TO             06030035
060400                                       WS-ABEND-PARAGRAPH         06040035
060500             MOVE 'UNSUCCESSFUL FETCH  NINREC'                    06050035
060600                           TO WS-ABEND-OPERATION                  06060035
060700             MOVE 'TNINREC ' TO WS-ABEND-STRUCTURE-1              06070035
060800             MOVE '        ' TO WS-ABEND-STRUCTURE-2              06080035
060900             PERFORM 9999-SQL-ERROR                               06090035
061000     END-EVALUATE.                                                06100035
061100                                                                  06110035
061200 9200-CLOSE-NINREC-CURSOR.                                        06120035
061300                                                                  06130035
061400     PERFORM WITH TEST AFTER                                      06140035
061500        VARYING PV-RETRY-COUNTER FROM 1 BY 1                      06150035
061600        UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES OR              06160035
061700                SQLCODE = ZERO                                    06170035
061800         EXEC SQL                                                 06180035
061900             CLOSE NINREC_CURSOR                                  06190035
062000         END-EXEC                                                 06200035
062100                                                                  06210035
062200        EVALUATE TRUE                                             06220035
062300            WHEN SQLCODE = ZERO                                   06230035
062400            WHEN SQLCODE = -904                                   06240035
062500            WHEN SQLCODE = -913                                   06250035
062600                 CONTINUE                                         06260035
062700            WHEN SQLWARN0 NOT = SPACES                            06270035
062800            WHEN SQLCODE  NOT = ZERO                              06280035
062900                 MOVE '9200-CLOSE-NINREC-CURSOR      '            06290035
063000                               TO WS-ABEND-PARAGRAPH              06300035
063100                 MOVE 'UNSUCCESSFUL CLOSE  NINREC'                06310035
063200                               TO WS-ABEND-OPERATION              06320035
063300                 MOVE 'TNINREC ' TO WS-ABEND-STRUCTURE-1          06330035
063400                 MOVE '        ' TO WS-ABEND-STRUCTURE-2          06340035
063500                 PERFORM 9999-SQL-ERROR                           06350035
063600        END-EVALUATE                                              06360035
063700     END-PERFORM.                                                 06370035
063800                                                                  06380035
063900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06390035
064000         MOVE '9200-CLOSE-NINREC-CURSOR      '                    06400035
064100                       TO WS-ABEND-PARAGRAPH                      06410035
064200         MOVE 'MAX RETRIES EXCEEDED ON CLOSE  NINREC'             06420035
064300                         TO WS-ABEND-OPERATION                    06430035
064400         PERFORM 9999-SQL-ERROR                                   06440035
064500     END-IF.                                                      06450035
064600                                                                  06460035
064700     EVALUATE TRUE                                                06470035
064800        WHEN SQLCODE = ZEROS                                      06480035
064900             CONTINUE                                             06490035
065000        WHEN OTHER                                                06500035
065100             MOVE '9200-CLOSE-NINREC-CURSOR      ' TO             06510035
065200                                       WS-ABEND-PARAGRAPH         06520035
065300             MOVE 'UNSUCCESSFUL CLOSE  NINREC'                    06530035
065400                           TO WS-ABEND-OPERATION                  06540035
065500             MOVE 'TNINREC ' TO WS-ABEND-STRUCTURE-1              06550035
065600             MOVE '        ' TO WS-ABEND-STRUCTURE-2              06560035
065700             PERFORM 9999-SQL-ERROR                               06570035
065800     END-EVALUATE.                                                06580035
065900                                                                  06590035
066000     EJECT                                                        06600035
066100 9998-SQL-WARNING.                                                06610035
066200         MOVE SQLCODE      TO SQLCODE2.                           06620035
066300         MOVE SQLERRD(3)   TO SQLERRD3.                           06630035
066400         DISPLAY '**** PROGRAM          ** = APKUT100'.           06640035
066500         DISPLAY '**** SQLCODE          ** = ' SQLCODE2.          06650035
066600         DISPLAY '**** ROWS PROCESSED   ** = ' SQLERRD3.          06660035
066700         DISPLAY '**** SQLWARN0         ** = ' SQLWARN0.          06670035
066800         DISPLAY '**** SQLWARN1         ** = ' SQLWARN1.          06680035
066900         DISPLAY '**** SQLWARN2         ** = ' SQLWARN2.          06690035
067000         DISPLAY '**** SQLWARN3         ** = ' SQLWARN3.          06700035
067100         DISPLAY '**** SQLWARN4         ** = ' SQLWARN4.          06710035
067200         DISPLAY '**** SQLWARN5         ** = ' SQLWARN5.          06720035
067300         DISPLAY '**** SQLWARN6         ** = ' SQLWARN6.          06730035
067400         DISPLAY '**** SQLWARN7         ** = ' SQLWARN7.          06740035
067500         MOVE +4013         TO ABEND-CODE.                        06750035
067600         CALL 'ILBOABN0' USING ABEND-CODE.                        06760035
067700                                                                  06770035
067800 9999-SQL-ERROR.                                                  06780035
067900                                                                  06790035
068000     DISPLAY '*** DB2 ERROR '.                                    06800035
068100     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 06810035
068200     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               06820035
068300     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               06830035
068400     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             06840035
068500     IF WS-ABEND-STRUCTURE-2 > SPACES                             06850035
068600         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         06860035
068700                                                                  06870035
068800     MOVE +4013                    TO ABEND-CODE.                 06880035
068900     COPY DPPD004.                                                06890035
069000     CALL 'ILBOABN0' USING ABEND-CODE.                            06900035
052900                                                                  06901040
066700*--------------------------------------------------------------*  06902040
066800* COPYBOOK FOR SEPHORA PROCESSES                               *  06903040
066900*--------------------------------------------------------------*  06904040
067000     COPY APPD021.                                                06905040
069100                                                                  06910035
