000100 TITLE 'TEMP ASSOCIATE ADD'.                                      00001000
000200 IDENTIFICATION DIVISION.                                         00010000
000300 PROGRAM-ID.    DLKCS401.                                         00020000
000400 AUTHOR.        THERESE RAMSEYER.                                 00030000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000600 DATE-WRITTEN.  JANUARY 2004.                                     00050000
000700 DATE-COMPILED.                                                   00060000
000800                                                                  00070000
000900*---------------------------------------------------------------* 00080000
001000*                                                               * 00090000
001100*    TRANID      - D401                                         * 00100000
001200*    TYPE        - CICS ARCHITECTURE - ADD                      * 00110000
001300*    DESCRIPTION - ADD TEMP ASSOC                               * 00120000
001400*    MAPSET      - DLKM401                                      * 00130000
001500*                                                               * 00140000
001600*    PROVIDES THE ABILITY TO ADD A TEMPORARY ASSOCIATE TO THE   * 00150000
001700*    DLT_TMP_USR DB2 TABLE.                                     * 00160000
001800*                                                               * 00170000
001900*    NAVIGATION: THIS SCREEN IS ENTERED FROM THE TEMP ASSOC LIST* 00171000
002000*                                                               * 00172000
009461* CHANGED 10/24/2022    BY BOB MCASEY      WR: CHG0279137                 
009491* ADD COPYBOOK DPWS930 CHANGE CICS ARCHITECTURE CALL TO                   
009491* TO USE CICS ARCHITECTURE CA                                             
002100*---------------------------------------------------------------* 00180000
002200                                                                  00190000
002300 ENVIRONMENT DIVISION.                                            00200000
002400 DATA DIVISION.                                                   00210000
002500/                                                                 00220000
002600 WORKING-STORAGE SECTION.                                         00230000
002700                                                                  00240000
002800 01  DN-DB2-NULL-INDICATORS.                                      00250000
002900     05  DN-TRIP-ID                   PIC S9(04) COMP VALUE +0.   00260000
003000     05  DN-SHIP-EST-AR-TMST          PIC S9(04) COMP VALUE +0.   00270000
003100     05  DN-VEH-NBR                   PIC S9(04) COMP VALUE +0.   00280000
003200     05  DN-SUBAREA-OF-ID             PIC S9(04) COMP VALUE +0.   00290000
003300     05  DN-TKT-FMT-ID-MAX            PIC S9(04) COMP VALUE +0.   00300000
003400     05  DN-TKT-FMT-ID-MIN            PIC S9(04) COMP VALUE +0.   00310000
003500     05  DN-TKT-DESC                  PIC S9(04) COMP VALUE +0.   00320000
003600     05  DN-AD-EVNT-DTE               PIC S9(04) COMP VALUE +0.   00330000
003700                                                                  00340000
003800 01  DK-DB2-KEYS.                                                 00350000
003900     05  DK-PO-NBR                    PIC S9(09) COMP VALUE +0.   00360000
004000     05  DK-ORD-NBR                   PIC S9(09) COMP VALUE +0.   00370000
004100     05  DK-OWNER-SCAC-ID             PIC X(04)  VALUE SPACES.    00380000
004200                                                                  00390000
004300 01  PC-PROGRAM-CONSTANTS.                                        00400000
004400     05  PC-FIRST                 PIC  X(08)  VALUE  'TP1     '.  00410000
004500     05  PC-Y                     PIC  X(01)  VALUE  'Y'.         00420000
004600     05  PC-MAX-RETRIES           PIC S9(03)  VALUE 3             00430000
004700                                                    COMP-3.       00440000
004800     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'DLKCS401'.  00450000
004900     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'DLK401  '.  00460000
005000     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'DLKM401 '.  00470000
005100                                                                  00480000
005200     05  PC-TSYMSG-NUMBERS.                                       00490000
005300* MUST KEY BOTH FIRST AND LAST NAME WHEN ADDING ASSOCIATE         00500000
005400         10  PC-TSYMSG-03175      PIC  9(05)  VALUE  03175.       00510000
005500* TEMP ASSOCIATE NAME ALREADY ASSIGNED TO ID &VAR - F2 TO CREATE  00520000
005600*                                                           NEW ID00530000
005700         10  PC-TSYMSG-03176      PIC  9(05)  VALUE  03176.       00540000
005800* TEMPORARY ASSOCIATE HAS BEEN ADDED - USE F24 TO ADD ANOTHER     00550000
005900*                                                        ASSOCIATE00560000
006000         10  PC-TSYMSG-03177      PIC  9(05)  VALUE  03177.       00570000
006100                                                                  00580000
006200 01  PS-PROGRAM-SWITCHES.                                         00590000
006300     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         00600000
006400         88  PS-ERROR                         VALUE  'Y'.         00610000
006500         88  PS-NO-ERROR                      VALUE  'N'.         00620000
006600     05  PS-COMMAREA-SW           PIC  X(01)  VALUE 'N'.          00630000
006700         88  PS-COMMAREA-VALID                VALUE 'Y'.          00640000
006800         88  PS-COMMAREA-NOT-VALID            VALUE 'N'.          00650000
006900     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00660000
007000         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00670000
007100         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00680000
007200                                                                  00690000
007300 01  PV-PROGRAM-VARIABLES.                                        00700000
007400     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00710000
007500                                              COMP SYNC.          00720000
007600     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00730000
007700                                              COMP SYNC.          00740000
007800     05  PV-DB2-COUNT             PIC S9(09)  VALUE +0            00750000
007900                                              COMP-3.             00760000
008000     05  PV-COUNT                 PIC S9(09)  VALUE +0            00770000
008100                                              COMP-3.             00780000
008200     05  PV-CURRENT-TIMESTAMP     PIC  X(26).                     00790000
008300     05  PV-DATE-USA              PIC  X(10).                     00800000
008400     05  PV-TIME-ISO              PIC  X(08).                     00810000
008500                                                                  00820000
008600     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        00830000
008700                                                COMP SYNC.        00840000
008800     05  PV-SOFT-ABORT-MSG.                                       00850000
008900         10  FILLER            PIC X(12) VALUE ' DLKCS401 - '.    00860000
009000         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       00870000
009100         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    00880000
009200         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    00890000
009300         10  PV-SOFT-PARAGRAPH PIC X(30).                         00900000
009400     05  PV-COMMAREA-LENGTH       PIC S9(04)  VALUE +0 COMP.      00910000
009500                                                                  00920000
009600     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 00930000
009700     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 00940000
009800     05  PV-CICS-MSG-HOLD.                                        00950000
009900         10  FILLER                      PIC  X(01)  VALUE SPACE. 00960000
010000         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 00970000
010100     05  PV-CICS-MSG-HOLD2.                                       00980000
010200         10  FILLER                      PIC  X(01)  VALUE SPACE. 00990000
010300         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 01000000
010400     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01010000
010500                                                    COMP SYNC.    01020000
010600/                                                                 01030000
010700*----------------------------------------------------------------*01040000
010800*    MAP LAYOUT                                                  *01050000
010900*----------------------------------------------------------------*01060000
011000     COPY DLKM401.                                                01070000
011100                                                                  01080000
011200/                                                                 01090000
011300*----------------------------------------------------------------*01100000
011400**  ASSOCIATE INFO SUBROUTINE PARAMETERS                          01110000
011500*----------------------------------------------------------------*01120000
011600     COPY XLWS067.                                                01130000
011700/                                                                 01150000
011800* COMMAREA FOR XLKUP003                                                   
011900     COPY XLWS072.                                                        
012000/                                                                         
012100*----------------------------------------------------------------*01160000
012200**  SECURITY SUBROUTINE PARAMETERS                                01170000
012300*----------------------------------------------------------------*01180000
012400     COPY DPWS008.                                                01190000
012500                                                                  01200000
012600/                                                                 01210000
012700*----------------------------------------------------------------*01220000
012800*    ATTRIBUTE SETTINGS COPYBOOK.                                *01230000
012900*----------------------------------------------------------------*01240000
013000     COPY DPWS015.                                                01250000
013100                                                                  01260000
013200/                                                                 01270000
013300*----------------------------------------------------------------*01280000
013400*    FUNCTION KEYS COPYBOOK                                      *01290000
013500*----------------------------------------------------------------*01300000
013600     COPY DPWS016.                                                01310000
013700                                                                  01320000
013800/                                                                 01330000
013900***************************************************************** 01340000
014000* RECORD LAYOUT OF TEMP QUEUE FROM LIST PROGRAM                   01350000
014100***************************************************************** 01360000
014200     COPY DLWS008.                                                01370000
014300                                                                  01380000
014400/                                                                 01390000
014500***************************************************************** 01400000
014600* PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).        01410000
014700***************************************************************** 01420000
014800     COPY DPWS017.                                                01430000
014900                                                                  01440000
015000     COPY DPWS030.                                                01450000
1022RM     COPY DPWS930.                                                01450000
015100/                                                                 01460000
015200***************************************************************** 01470000
015300*    STANDARD COMMAREA.                                           01480000
015400***************************************************************** 01490000
015500                                                                  01500000
015600     COPY DPWS020.                                                01510000
015700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01520000
015800                                                                  01530000
015900***************************************************************** 01540000
016000*    INTER-APPLICATION COMMAREA.                                  01550000
016100***************************************************************** 01560000
016200                                                                  01570000
016300         10  INTER-APPL-COMM-AREA PIC X(200).                     01580000
016400     COPY DLWS002.                                                01590000
016500                                                                  01600000
016600***************************************************************** 01610000
016700*    SPECIFIC COMMMAREA FOR DLKCS401.                             01620000
016800***************************************************************** 01630000
016900         10  ASC-SPECIFIC-COMMAREA.                               01640000
017000             15  ASC-USE-SELECTION-QUEUE-IND                      01650000
017100                                           PIC X(01).             01660000
017200                 88  ASC-USE-SELECTION-QUEUE    VALUE 'Y'.        01670000
017300             15  ASC-SEL-QUEUE-NAME        PIC X(08).             01680000
017400             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     01690000
017500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     01700000
017600                                           PIC S9(09) COMP-3.     01710000
017700             15  ASC-SEL-SUB               PIC S9(04) COMP.       01720000
017800             15  ASC-SEL-ITEM              PIC S9(04) COMP.       01730000
017900             15  ASC-MIN-USERID           PIC X(08).              01740000
018000             15  ASC-ACTION-SW            PIC X(03).              01741000
018100                 88  ASC-ADD-PENDING      VALUE 'ADD'.            01750000
018200                 88  ASC-UPDATE-PENDING   VALUE 'UPD'.            01760000
018300             15  ASC-TEMP-IN-TABLE-SW      PIC X(01).             01770000
018400                 88  ASC-TEMP-ALREADY-THERE VALUE 'N'.            01780000
018500                 88  ASC-TEMP-NOT-THERE     VALUE 'Y'.            01790000
018600             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            01800000
018700                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            01810000
018800                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            01820000
018900                                                                  01830000
019000             15  ASC-KEY-FIELDS.                                  01840000
019100                 20  ASC-KEY-OPER-UNT-ID     PIC S9(05) COMP.     01850000
019200                 20  ASC-KEY-OPER-DESC       PIC  X(40).          01860000
019300                                                                  01870000
019400             15  ASC-SCREEN-FIELDS.                               01880000
019500                 20  ASC-FIRST-NAME          PIC X(20).           01890000
019600                 20  ASC-LAST-NAME           PIC X(30).           01900000
019700                 20  ASC-SIGNON-USERID       PIC X(08).           01910000
019800                 20  ASC-MAX-USER-CODE       PIC X(08).           01920000
019900                 20  ASC-ADDED-BY-DC-NBR     PIC 9(04).           01930000
020000                 20  ASC-ADDED-BY-DC-NAME    PIC X(30).           01940000
020100                 20  ASC-ADDED-BY-NAME       PIC X(30).           01941000
020200                 20  ASC-DATE-ADDED          PIC X(10).           01950000
020300                 20  ASC-TIME-ADDED          PIC X(08).           01960000
020400                 20  ASC-ACTIVE-USER         PIC X(01).           01970000
020500/                                                                 01980000
020600*----------------------------------------------------------------*01990000
020700*    ABEND PROCESSING COPYBOOK.                                  *02000000
020800*----------------------------------------------------------------*02010000
020900     COPY DPWS013.                                                02020000
021000                                                                  02030000
021100/                                                                 02040000
021200*---------------------------------------------------------------* 02050000
021300*    DB2 AREA FOR THE TEMP ASSOCIATE TABLE                      * 02060000
021400*---------------------------------------------------------------* 02070000
021500     EXEC SQL                                                     02080000
021600          INCLUDE DLT00002                                        02090000
021700     END-EXEC.                                                    02100000
021800                                                                  02110000
021200*---------------------------------------------------------------* 02050000
021300*    DB2 AREA FOR THE RED PRAIRIE USER LISTING TABLE            * 02060000
021400*---------------------------------------------------------------* 02070000
021500     EXEC SQL                                                     02080000
021600          INCLUDE DLT00009                                        02090000
021700     END-EXEC.                                                    02100000
021800                                                                  02110000
021900/                                                                 02120000
022000*----------------------------------------------------------------*02130000
022100*    DB2 AREA FOR COMMUNICATIONS                                 *02140000
022200*----------------------------------------------------------------*02150000
022300                                                                  02160000
022400     EXEC SQL                                                     02170000
022500          INCLUDE SQLCA                                           02180000
022600     END-EXEC.                                                    02190000
022700                                                                  02200000
022800/                                                                 02210000
022900 LINKAGE SECTION.                                                 02220000
023000                                                                  02230000
023100 01  DFHCOMMAREA.                                                 02240000
023200     05  FILLER                         OCCURS  1 TO 4072 TIMES   02250000
023300                                        DEPENDING ON EIBCALEN.    02260000
023400         10  FILLER                     PIC  X(01).               02270000
023500/                                                                 02280000
023600 PROCEDURE DIVISION.                                              02290000
023700***************************************************************** 02300000
023800** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 02310000
023900** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 02320000
024000** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 02330000
024100**                                                             ** 02340000
024200** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 02350000
024300** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 02360000
024400***************************************************************** 02370000
024500 0000-MAIN-MODULE.                                                02380000
024600     INITIALIZE DP030-CICS-API-FIELDS.                            02390000
024700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       02400000
024800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          02410000
024900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         02420000
025000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       02430000
025100     MOVE LENGTH OF DLK401I        TO DP030-MAP-LENGTH (1).       02440000
025200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     02450000
025300     PERFORM 0001-CALL-CICS-ARCH-API.                             02460000
025400*                                                                 02470000
025500     PERFORM 1000-CONTROL-PROCESSING.                             02480000
025600*                                                                 02490000
025700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     02500000
025800     PERFORM 0001-CALL-CICS-ARCH-API.                             02510000
025900                                                                  02520000
026000 0001-CALL-CICS-ARCH-API.                                         02530000
026100     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     02540000
026200                                     DFHCOMMAREA                  02550000
026300                                     DP030-CICS-API-FIELDS        02560000
026400                                     DP020-STANDARD-COMMAREA      02570000
026500                                     DLK401I.                     02580000
026600*                                                                 02590000
026700     IF  DP030-RC-CALL-SUCCESSFUL                                 02600000
026800         CONTINUE                                                 02610000
026900     ELSE                                                         02620000
027000         SET DP013-NO-ROLLBACK                                    02630000
027100             DP013-XCTL-DISPLAY-RESTART                           02640000
027200             DP013-CICS-ABEND      TO TRUE                        02650000
027300         MOVE 'BEFORE 0000-MAIN-MODULE'                           02660000
027400                                   TO DP013-PARAGRAPH             02670000
1022RM         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
1022RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
027700         MOVE DP030-RETURN-CODE                                   02700000
027800                                   TO DP013-MESSAGE-TEXT (3)      02710000
027900         PERFORM DP013-0000-PROCESS-ABEND                         02720000
028000     END-IF.                                                      02730000
028100                                                                  02740000
028200/                                                                 02750000
028300*----------------------------------------------------------------*02760000
028400*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *02770000
028500*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *02780000
028600*----------------------------------------------------------------*02790000
028700 1000-CONTROL-PROCESSING.                                         02800000
028800                                                                  02810000
028900     EVALUATE TRUE                                                02820000
029000         WHEN DP020-NEXT-ACT-INITIAL                              02830000
029100              PERFORM 1100-PROCESS-INTER-APPL-COMM                02840000
029200              IF  PS-ERROR                                        02850000
029300                  CONTINUE                                        02860000
029400              ELSE                                                02870000
029500                 PERFORM 4000-BUILD-INITIAL-PANEL                 02880000
029600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             02890000
029700              END-IF                                              02900000
029800                                                                  02910000
029900         WHEN DP020-NEXT-ACT-READ-MAP                             02920000
030000             PERFORM 2000-PROCESS-PANEL                           02930000
030100                                                                  02940000
030200         WHEN DP020-NEXT-ACT-RETURN                               02950000
030300              PERFORM 4000-BUILD-INITIAL-PANEL                    02960000
030400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                02970000
030500              PERFORM 3200-RESET-ATTRIBUTES                       02980000
030600                                                                  02990000
030700         WHEN OTHER                                               03000000
030800             SET DP013-LOGIC-ABEND                                03010000
030900                 DP013-NO-ROLLBACK TO TRUE                        03020000
031000             MOVE '1000-CONTROL-PROCESSING'                       03030000
031100                                   TO DP013-PARAGRAPH             03040000
031200             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   03050000
031300                                   TO DP013-MESSAGE-TEXT(1)       03060000
031400             MOVE DP020-NEXT-APPL-ACTIVITY                        03070000
031500                                   TO DP013-MESSAGE-TEXT(2)       03080000
031600             PERFORM DP013-0000-PROCESS-ABEND                     03090000
031700     END-EVALUATE.                                                03100000
031800                                                                  03110000
031900/                                                                 03120000
032000******************************************************************03130000
032100** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03140000
032200** INTER-APPLICATION FORMAT CODE.                               **03150000
032300******************************************************************03160000
032400 1100-PROCESS-INTER-APPL-COMM.                                    03170000
032500                                                                  03180000
032600     INITIALIZE ASC-SPECIFIC-COMMAREA.                            03190000
032700     SET PS-COMMAREA-VALID                                        03200000
032800         ASC-TEMP-ALREADY-THERE  TO TRUE.                         03210000
032900                                                                  03220000
033000     MOVE DP020-USERID                TO ASC-SIGNON-USERID        03230000
033100                                         AADDBYO.                 03240000
033200                                                                  03250000
033300     MOVE DP020-LOCATION-NBR          TO ADCO                     03260000
033400                                         ABYDCO                   03270000
033500                                         ASC-KEY-OPER-UNT-ID      03280000
033600                                         ASC-ADDED-BY-DC-NBR.     03290000
033700                                                                  03300000
033800     MOVE DL002-OPER-DESC             TO ASC-KEY-OPER-DESC        03310000
033900                                         ASC-ADDED-BY-DC-NAME     03320000
034000                                         ABYDCNMO                 03330000
034100                                         ADCNMEO.                 03340000
034200     PERFORM 7000-SIGNON-USER-NAME.                               03350000
034300                                                                  03360000
034400/                                                                 03370000
034500*----------------------------------------------------------------*03380000
034600*    DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA*03390000
034700*    ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT*03400000
034800*    USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE    *03410000
034900*    REST OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO      *03420000
035000*    INVALID FUNCTION KEYS CAN GET THIS FAR.                     *03430000
035100*----------------------------------------------------------------*03440000
035200 2000-PROCESS-PANEL.                                              03450000
035300                                                                  03460000
035400     EVALUATE TRUE                                                03470000
035500                                                                  03480000
035600         WHEN DP020-SRC-AID = DP016-CLEAR                         03490000
035700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03500000
035800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03510000
035900                                                                  03520000
036000         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     03530000
036100             PERFORM 4000-BUILD-INITIAL-PANEL                     03561000
036200             MOVE SPACES    TO ASC-FIRST-NAME                     03562000
036300                               ASC-LAST-NAME                      03563000
036400                               ASC-MAX-USER-CODE                  03564000
036500                               ASC-DATE-ADDED                     03565000
036600                               ASC-TIME-ADDED                     03566000
036700                               ASC-ACTIVE-USER                    03567000
036800                               AFNMEO                             03568000
036900                               ALNMEO                             03569000
037000                                                                  03569100
037100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03569200
037200                                                                  03570000
037300         WHEN OTHER                                               03580000
037400             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 03590000
037500             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   03600000
037600             IF  PS-NO-ERROR                                      03610000
037700                 SET DP030-CONTINUE-GO                            03620000
037800                                   TO TRUE                        03630000
037900                 PERFORM 2100-CHECK-FUNCTION-KEY                  03640000
038000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             03650000
038100             ELSE                                                 03660000
038200                 SET DP030-OVERRIDE-GO                            03670000
038300                                   TO TRUE                        03680000
038400             END-IF                                               03690000
038500     END-EVALUATE.                                                03700000
038600                                                                  03710000
038700/                                                                 03720000
038800******************************************************************03730000
038900** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **03740000
039000** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **03750000
039100** FROM THE CICS ARCHITECTURE API.                              **03760000
039200******************************************************************03770000
039300 2100-CHECK-FUNCTION-KEY.                                         03780000
039400                                                                  03790000
039500     EVALUATE TRUE                                                03800000
039600                                                                  03810000
039700         WHEN DP020-SRC-AID = DP016-ENTER                         03820000
039800             CONTINUE                                             03830000
039900                                                                  03840000
040000         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              03850000
040100*          ADD TEMP ASSOC                                         03860000
040200           IF PS-NO-ERROR                                         03870000
040300              SET ASC-TEMP-ALREADY-THERE  TO TRUE                 03880000
040400              PERFORM 5005-CHECK-DLT-TMP-EMP                      03890000
040500              IF ASC-TEMP-NOT-THERE                               03900000
040600                 PERFORM 5000-ADD-ASSOCIATE                       03910000
040700              ELSE                                                03920000
040800                 SET ASC-TEMP-ALREADY-THERE                       03930000
040900                     DP020-MSG-INFORMATIONAL TO TRUE              03931000
041000                 MOVE PC-TSYMSG-03176    TO DP020-MSG-NUMBER      03940000
041100                 PERFORM 5010-GET-MIN-USER-CODE                   03950100
041200                 MOVE SPACES             TO ASC-MAX-USER-CODE     03950200
041300                                            ASC-DATE-ADDED        03950300
041400                                            ASC-TIME-ADDED        03950400
041500                                            ASC-ACTIVE-USER       03950500
041600                 MOVE ASC-MIN-USERID     TO DP020-MSG-TEXT        03951000
041700              END-IF                                              03960000
041800           END-IF                                                 03970000
041900                                                                  03980000
042000         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              03990000
042100******       RESET NAME FIELDS FOR NEW ADD                        04000000
042200             PERFORM 4000-BUILD-INITIAL-PANEL                     04010000
042300             MOVE SPACES    TO ASC-FIRST-NAME                     04020000
042400                               ASC-LAST-NAME                      04030000
042500                               ASC-MAX-USER-CODE                  04040000
042600                               ASC-DATE-ADDED                     04050000
042700                               ASC-TIME-ADDED                     04060000
042800                               ASC-ACTIVE-USER                    04070000
042900                               AFNMEO                             04080000
043000                               ALNMEO                             04090000
043100                                                                  04100000
043200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 04110000
043300                                                                  04120000
043400         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    04140000
043500******       CONFIRM - PF2                                        04141000
043600             IF ASC-TEMP-ALREADY-THERE                            04142000
043700                PERFORM 5000-ADD-ASSOCIATE                        04150000
043800                SET ASC-TEMP-NOT-THERE TO TRUE                    04150100
043900             END-IF                                               04151000
044000         WHEN OTHER                                               04160000
044100             SET DP013-NO-ROLLBACK                                04170000
044200                 DP013-XCTL-DISPLAY-RESTART                       04180000
044300                 DP013-CICS-ABEND  TO TRUE                        04190000
044400             MOVE '2100-CHECK-FUNCTION-KEY'                       04200000
044500                                   TO DP013-PARAGRAPH             04210000
044600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      04220000
044700                                   TO DP013-MESSAGE-TEXT (1)      04230000
044800             PERFORM DP013-0000-PROCESS-ABEND                     04240000
044900     END-EVALUATE.                                                04250000
045000                                                                  04260000
045100/                                                                 04270000
045200*----------------------------------------------------------------*04280000
045300*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *04290000
045400*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *04300000
045500*----------------------------------------------------------------*04310000
045600 2200-MOVE-SCREEN-TO-COMMAREA.                                    04320000
045700                                                                  04330000
045800     IF  AFNMEL > ZERO                                            04340000
045900         MOVE AFNMEI               TO ASC-FIRST-NAME              04350000
046000     ELSE                                                         04360000
046100        IF  AFNMEF  = DP015-ERASE-EOF                             04370000
046200            MOVE SPACES            TO ASC-FIRST-NAME              04380000
046300        END-IF                                                    04390000
046400     END-IF.                                                      04400000
046500                                                                  04410000
046600     IF  ALNMEL > ZERO                                            04420000
046700         MOVE ALNMEI               TO ASC-LAST-NAME               04430000
046800     ELSE                                                         04440000
046900        IF  ALNMEF  = DP015-ERASE-EOF                             04450000
047000            MOVE SPACES            TO ASC-LAST-NAME               04460000
047100        END-IF                                                    04470000
047200     END-IF.                                                      04480000
047300                                                                  04490000
047400/                                                                 04500000
047500*----------------------------------------------------------------*04510000
047600* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *04520000
047700* IS FOUND THE CURSOR IS POSITIONED AT THAT FIELD AND AN         *04530000
047800* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *04540000
047900*----------------------------------------------------------------*04550000
048000 3000-EDIT-DATA-IN-COMMAREA.                                      04560000
048100                                                                  04560100
048200     PERFORM 3200-RESET-ATTRIBUTES.                               04560200
048300                                                                  04560300
048400     IF  PS-NO-ERROR                                              04580000
048500         IF  ASC-FIRST-NAME = (SPACES)                            04590000
048600             SET PS-ERROR                                         04600000
048700                 DP020-MSG-FATAL        TO TRUE                   04610000
048800             MOVE PC-TSYMSG-03175       TO DP020-MSG-NUMBER       04620000
048900             MOVE DP015-UNP-ALP-BRT-OFF TO AFNMEA                 04630000
049000             MOVE DP015-RED             TO AFNMEC                 04640000
049100             MOVE DP015-REVERSE         TO AFNMEH                 04650000
049200             MOVE -1                    TO AFNMEL                 04660000
049300             SET DP030-SET-CURSOR-APPL-1                          04670000
049400                                        TO TRUE                   04680000
049500         END-IF                                                   04690000
049600                                                                  04700000
049700         IF  ASC-LAST-NAME = (SPACES)                             04710000
049800             SET PS-ERROR                                         04720000
049900                 DP020-MSG-FATAL        TO TRUE                   04730000
050000             MOVE PC-TSYMSG-03175       TO DP020-MSG-NUMBER       04740000
050100             MOVE DP015-UNP-ALP-BRT-OFF TO ALNMEA                 04750000
050200             MOVE DP015-RED             TO ALNMEC                 04760000
050300             MOVE DP015-REVERSE         TO ALNMEH                 04770000
050400             MOVE -1                    TO ALNMEL                 04780000
050500             SET DP030-SET-CURSOR-APPL-1                          04790000
050600                                        TO TRUE                   04800000
050700         END-IF                                                   04810000
050800     END-IF.                                                      04820000
050900                                                                  04830000
051000                                                                  04840000
051100 3200-RESET-ATTRIBUTES.                                           04850000
051200                                                                  04860000
051300                                                                  05190000
051400         MOVE DP015-UNP-ALP-NOR-OFF  TO AFNMEA                    05200000
051500                                        ALNMEA.                   05210000
051600                                                                  05220000
051700         MOVE DP015-GREEN            TO AFNMEC                    05230000
051800                                        ALNMEC.                   05240000
051900                                                                  05250000
052000         MOVE DP015-UNDERLINE        TO AFNMEH                    05260000
052100                                        ALNMEH.                   05270000
052200                                                                  05280000
052300                                                                  05290000
052400/                                                                 05300000
052500 4000-BUILD-INITIAL-PANEL.                                        05310000
052600                                                                  05320000
052700       MOVE -1  TO AFNMEL.                                        05330000
052800                                                                  05340000
052900                                                                  05350000
053000*----------------------------------------------------------------*05360000
053100* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *05370000
053200*----------------------------------------------------------------*05380000
053300                                                                  05390000
053400 4400-MOVE-COMMAREA-TO-SCREEN.                                    05400000
053500                                                                  05410000
053600     MOVE ASC-SIGNON-USERID        TO AADDBYO.                    05420000
053700     MOVE ASC-MAX-USER-CODE        TO AUSRCDO.                    05430000
053800     MOVE ASC-DATE-ADDED           TO ADATEO.                     05440000
053900     MOVE ASC-TIME-ADDED           TO ATIMEO.                     05450000
054000     MOVE ASC-ACTIVE-USER          TO AACTUSRO.                   05460000
054100     MOVE ASC-KEY-OPER-UNT-ID      TO ADCO.                       05462000
054200     MOVE ASC-ADDED-BY-DC-NBR      TO ABYDCO.                     05463000
054300     MOVE ASC-KEY-OPER-DESC        TO ADCNMEO.                    05464000
054400     MOVE ASC-ADDED-BY-DC-NAME     TO ABYDCNMO.                   05465000
054500     MOVE ASC-SIGNON-USERID        TO AADDBYO.                    05466000
054600     MOVE ASC-ADDED-BY-NAME        TO AADDNMEO.                   05467000
054700                                                                  05480000
054800     MOVE -1                       TO AFNMEL.                     05490000
054900     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       05500000
055000                                                                  05510000
055100/                                                                 05520000
055200 5000-ADD-ASSOCIATE.                                              05530000
055300                                                                  05540000
055400     IF PS-NO-ERROR                                               05550000
055500        PERFORM 5015-GET-MAX-USER-CODE                            05560000
055600        PERFORM 5050-GET-CRE-TMST                                 05570000
055700        PERFORM 5100-INSERT-TEMP-ASSOC                            05580000
055700        PERFORM 5200-INSERT-RDPR-USR                              05580000
055800        PERFORM 8410-CALL-XLKUP033                                05581001
055900     END-IF.                                                      05590000
056000                                                                  05600000
056100     IF  PS-NO-ERROR                                              05610000
056200         SET DP020-MSG-INFORMATIONAL                              05620000
056300             ASC-ADD-SUCCESSFUL  TO TRUE                          05630000
056400         MOVE PC-TSYMSG-03177    TO DP020-MSG-NUMBER              05640000
056500     END-IF.                                                      05650000
056600                                                                  05660000
056700/                                                                 05670000
056800*----------------------------------------------------------------*05680000
056900*  CALL XLKUT067 ASSOCIATE INFO SUB-ROUTINE TO SEE IF THE        *05690000
057000*  ASSOCIATE NAME HAS ALREADY BEEN ADDED TO THE TABLE.           *05700000
057100*----------------------------------------------------------------*05710000
057200 5005-CHECK-DLT-TMP-EMP.                                          05720000
057300                                                                  05730000
057400     MOVE ASC-FIRST-NAME              TO XL067-KEY-FIRST-NAME.    05740000
057500     MOVE ASC-LAST-NAME               TO XL067-KEY-LAST-NAME.     05750000
057600                                                                  05760000
057700     SET XL067-BY-NAME                                            05770000
057800         XL067-SELECT-TEMP-USER       TO TRUE.                    05780000
057900                                                                  05790000
058000     CALL XL067-USER-PGM USING DFHEIBLK                           05800000
058100                               XL067-COMMAREA                     05810000
058200                               XL067-USER-COMMAREA.               05820000
058300                                                                  05830000
058400     EVALUATE TRUE                                                05840000
058500         WHEN XL067-SUCCESSFUL                                    05850000
058600             IF XL067-USER-NOT-FOUND                              05860000
058700                SET ASC-TEMP-NOT-THERE  TO TRUE                   05870000
058800             END-IF                                               05880000
058900                                                                  05890000
059000         WHEN XL067-SQL-ERROR                                     05900000
059100             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    05910000
059200             MOVE '5005-CHECK-DLT-TMP-EMP'  TO PV-SOFT-PARAGRAPH  05920000
059300             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  05930000
059400             MOVE LENGTH OF PV-CICS-MSG-AREA2                     05940000
059500               TO PV-COMMAREA-LENGTH                              05950000
059600             EXEC CICS                                            05960000
059700                  WRITEQ TD                                       05970000
059800                   QUEUE  ('CSSL')                                05980000
059900                    FROM  (PV-CICS-MSG-AREA2)                     05990000
060000                  LENGTH  (PV-COMMAREA-LENGTH)                    06000000
060100                    RESP  (PV-CICS-RESP)                          06010000
060200             END-EXEC                                             06020000
060300             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              06030000
060400             PERFORM 9900-SOFT-ABORT                              06040000
060500     END-EVALUATE.                                                06050000
060600                                                                  06060000
060700*----------------------------------------------------------------*06070000
060800* GET THE FIRST USERID WHERE A TEMP NAME OCCURS MORE THAN ONCE   *06080000
060900*----------------------------------------------------------------*06090000
061000 5010-GET-MIN-USER-CODE.                                          06100000
061100                                                                  06110000
061200     PERFORM                                                      06120000
061300         WITH TEST AFTER                                          06130000
061400         VARYING PV-RETRY-COUNTER                                 06140000
061500         FROM 1 BY 1                                              06150000
061600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06160000
061700            OR (SQLCODE = +0))                                    06170000
061800                                                                  06190000
061900         EXEC SQL                                                 06200000
062000           SELECT 'TP' CONCAT                                     06210000
062100             CHAR(MIN(SMALLINT(REPLACE(TMP_USR_ID,'TP','0'))))    06220000
062200           INTO  :ASC-MIN-USERID                                  06230000
062300           FROM   DLT_TMP_EMP                                     06240000
062400           WHERE  TMP_USR_ID LIKE 'TP%'                           06250000
062500             AND  FRST_NM         = :ASC-FIRST-NAME               06251000
062600             AND  LAST_NM         = :ASC-LAST-NAME                06252000
062700         END-EXEC                                                 06260000
062800                                                                  06270000
062900         EVALUATE TRUE                                            06280000
063000             WHEN SQLCODE = +0                                    06290000
063100                 CONTINUE                                         06300000
063200                                                                  06340000
063300             WHEN SQLCODE = -904                                  06350000
063400             WHEN SQLCODE = -913                                  06360000
063500                 CONTINUE                                         06370000
063600                                                                  06380000
063700             WHEN SQLWARN0 NOT = SPACE                            06390000
063800             WHEN SQLCODE < +0                                    06400000
063900             WHEN SQLCODE > +0                                    06410000
064000                 MOVE '5010-GET-MIN-USER-CODE'                    06420000
064100                                     TO DP013-PARAGRAPH           06430000
064200                 MOVE 'SELECT MIN ON TEMP USER TABLE'             06440000
064300                                     TO DP013-MESSAGE-TEXT (1)    06450000
064400                 MOVE SQLCA          TO DP013-SQLCA               06460000
064500                 MOVE 'DLT_TMP_EMP'  TO DP013-DB2-TABLE-NAME (1)  06470000
064600                     SET DP013-DB2-ABEND                          06480000
064700                         DP013-XCTL-DISPLAY-RESTART               06490000
064800                                     TO TRUE                      06500000
064900                 PERFORM DP013-0000-PROCESS-ABEND                 06510000
065000         END-EVALUATE                                             06520000
065100     END-PERFORM.                                                 06530000
065200                                                                  06540000
065300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06550000
065400             AND (SQLCODE = -904 OR -913)                         06560000
065500         MOVE '5010-GET-MAX-USER-CODE'                            06570000
065600                                  TO DP013-PARAGRAPH              06580000
065700         MOVE 'MAX RETRIES EXCEEDED - SELECT DLT_TMP_EMP'         06590000
065800                                  TO DP013-MESSAGE-TEXT (1)       06600000
065900         MOVE SQLCA               TO DP013-SQLCA                  06610000
066000         MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1)     06620000
066100         SET DP013-DB2-ABEND                                      06630000
066200             DP013-XCTL-DISPLAY-RESTART                           06640000
066300                                  TO TRUE                         06650000
066400         PERFORM DP013-0000-PROCESS-ABEND                         06660000
066500     END-IF.                                                      06670000
066600                                                                  06680000
066700*----------------------------------------------------------------*06681000
066800* GET THE NEXT HIGHEST USER CODE FROM DLT00002_TMP_EMP           *06682000
066900*----------------------------------------------------------------*06683000
067000 5015-GET-MAX-USER-CODE.                                          06684000
067100                                                                  06685000
067200     PERFORM                                                      06686000
067300         WITH TEST AFTER                                          06687000
067400         VARYING PV-RETRY-COUNTER                                 06688000
067500         FROM 1 BY 1                                              06689000
067600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06689100
067700            OR (SQLCODE = +0)                                     06689200
067800            OR (SQLCODE = -305))                                  06689300
067900                                                                  06689400
068000         EXEC SQL                                                 06689500
068100           SELECT 'TP' CONCAT                                     06689600
068200             CHAR(MAX(SMALLINT(REPLACE(TMP_USR_ID,'TP','0'))) + 1)06689700
068300           INTO  :ASC-MAX-USER-CODE                               06689800
068400           FROM   DLT_TMP_EMP                                     06689900
068500           WHERE  TMP_USR_ID LIKE 'TP%'                           06690000
068600         END-EXEC                                                 06690100
068700                                                                  06690200
068800         EVALUATE TRUE                                            06690300
068900             WHEN SQLCODE = +0                                    06690400
069000                 CONTINUE                                         06690500
069100                                                                  06690600
069200             WHEN SQLCODE = -305                                  06690700
069300                 MOVE PC-FIRST   TO ASC-MAX-USER-CODE             06690800
069400                                                                  06690900
069500             WHEN SQLCODE = -904                                  06691000
069600             WHEN SQLCODE = -913                                  06691100
069700                 CONTINUE                                         06691200
069800                                                                  06691300
069900             WHEN SQLWARN0 NOT = SPACE                            06691400
070000             WHEN SQLCODE < +0                                    06691500
070100             WHEN SQLCODE > +0                                    06691600
070200                 MOVE '5015-GET-MAX-USER-CODE'                    06691700
070300                                     TO DP013-PARAGRAPH           06691800
070400                 MOVE 'SELECT MAX ON TEMP USER TABLE'             06691900
070500                                     TO DP013-MESSAGE-TEXT (1)    06692000
070600                 MOVE SQLCA          TO DP013-SQLCA               06692100
070700                 MOVE 'DLT_TMP_EMP'  TO DP013-DB2-TABLE-NAME (1)  06692200
070800                     SET DP013-DB2-ABEND                          06692300
070900                         DP013-XCTL-DISPLAY-RESTART               06692400
071000                                     TO TRUE                      06692500
071100                 PERFORM DP013-0000-PROCESS-ABEND                 06692600
071200         END-EVALUATE                                             06692700
071300     END-PERFORM.                                                 06692800
071400                                                                  06692900
071500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06693000
071600             AND (SQLCODE = -904 OR -913)                         06693100
071700         MOVE '5015-GET-MAX-USER-CODE'                            06693200
071800                                  TO DP013-PARAGRAPH              06693300
071900         MOVE 'MAX RETRIES EXCEEDED - SELECT DLT_TMP_EMP'         06693400
072000                                  TO DP013-MESSAGE-TEXT (1)       06693500
072100         MOVE SQLCA               TO DP013-SQLCA                  06693600
072200         MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1)     06693700
072300         SET DP013-DB2-ABEND                                      06693800
072400             DP013-XCTL-DISPLAY-RESTART                           06693900
072500                                  TO TRUE                         06694000
072600         PERFORM DP013-0000-PROCESS-ABEND                         06694100
072700     END-IF.                                                      06694200
072800                                                                  06694300
072900*----------------------------------------------------------------*06695000
073000* GET THE CURRENT TIMESTAMP FOR AN INSERT TO DLT_TMP_EMP         *06700000
073100*----------------------------------------------------------------*06710000
073200 5050-GET-CRE-TMST.                                               06720000
073300                                                                  06730000
073400     PERFORM                                                      06740000
073500         WITH TEST AFTER                                          06750000
073600         VARYING PV-RETRY-COUNTER                                 06760000
073700         FROM 1 BY 1                                              06770000
073800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06780000
073900            OR (SQLCODE = +0))                                    06790000
074000                                                                  06800000
074100         EXEC SQL                                                 06810000
074200             SET :PV-DATE-USA = CHAR(DATE(CURRENT TIMESTAMP),USA) 06820000
074300                ,:PV-TIME-ISO = CHAR(TIME(CURRENT TIMESTAMP),ISO) 06830000
074400                ,:PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP        06840000
074500         END-EXEC                                                 06850000
074600                                                                  06860000
074700         EVALUATE TRUE                                            06870000
074800             WHEN SQLCODE = +0                                    06880000
074900                 MOVE PV-DATE-USA  TO ASC-DATE-ADDED              06890000
075000                 MOVE PV-TIME-ISO  TO ASC-TIME-ADDED              06900000
075100                                                                  06910000
075200             WHEN SQLCODE = -904                                  06920000
075300             WHEN SQLCODE = -913                                  06930000
075400                 CONTINUE                                         06940000
075500                                                                  06950000
075600             WHEN SQLWARN0 NOT = SPACE                            06960000
075700             WHEN SQLCODE < +0                                    06970000
075800             WHEN SQLCODE > +0                                    06980000
075900                 MOVE '5050-GET-CRE-TMST'                         06990000
076000                                     TO DP013-PARAGRAPH           07000000
076100                 MOVE 'SELECT TMST ON TEMP USER TABLE'            07010000
076200                                     TO DP013-MESSAGE-TEXT (1)    07020000
076300                 MOVE SQLCA          TO DP013-SQLCA               07030000
076400                 MOVE 'DLT_TMP_EMP'  TO DP013-DB2-TABLE-NAME (1)  07040000
076500                     SET DP013-DB2-ABEND                          07050000
076600                         DP013-XCTL-DISPLAY-RESTART               07060000
076700                                     TO TRUE                      07070000
076800                 PERFORM DP013-0000-PROCESS-ABEND                 07080000
076900         END-EVALUATE                                             07090000
077000     END-PERFORM.                                                 07100000
077100                                                                  07110000
077200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07120000
077300             AND (SQLCODE = -904 OR -913)                         07130000
077400         MOVE '5050-GET-CRE-TMST'                                 07140000
077500                                  TO DP013-PARAGRAPH              07150000
077600         MOVE 'MAX RETRIES EXCEEDED - SELECT DLT_TMP_EMP'         07160000
077700                                  TO DP013-MESSAGE-TEXT (1)       07170000
077800         MOVE SQLCA               TO DP013-SQLCA                  07180000
077900         MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1)     07190000
078000         SET DP013-DB2-ABEND                                      07200000
078100             DP013-XCTL-DISPLAY-RESTART                           07210000
078200                                  TO TRUE                         07220000
078300         PERFORM DP013-0000-PROCESS-ABEND                         07230000
078400     END-IF.                                                      07240000
078500                                                                  07250000
078600/                                                                 07260000
078700 5100-INSERT-TEMP-ASSOC.                                          07270000
078800                                                                  07280000
078900     MOVE ASC-MAX-USER-CODE    TO DLT00002-TMP-USR-ID.            07290000
079000     MOVE ASC-ADDED-BY-DC-NBR  TO DLT00002-DC-NBR.                07300000
079100     MOVE ASC-FIRST-NAME       TO DLT00002-FRST-NM.               07310000
079200     MOVE ASC-LAST-NAME        TO DLT00002-LAST-NM.               07320000
079300     MOVE PV-CURRENT-TIMESTAMP TO DLT00002-CRE-TMST.              07330000
079400     MOVE ASC-SIGNON-USERID    TO DLT00002-CRE-BY-USR-ID.         07340000
079500     MOVE PC-Y                 TO DLT00002-ACTV-IND.              07350000
079600                                                                  07360000
079700     PERFORM                                                      07370000
079800         WITH TEST AFTER                                          07380000
079900         VARYING PV-RETRY-COUNTER                                 07390000
080000         FROM 1 BY 1                                              07400000
080100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07410000
080200             OR (SQLCODE = +0))                                   07420000
080300                                                                  07430000
080400         EXEC SQL                                                 07440000
080500              INSERT INTO DLT_TMP_EMP                             07450000
080600                     ( TMP_USR_ID                                 07460000
080700                      ,DC_NBR                                     07470000
080800                      ,FRST_NM                                    07480000
080900                      ,LAST_NM                                    07490000
081000                      ,CRE_BY_USR_ID                              07500000
081100                      ,CRE_TMST                                   07510000
081200                      ,ACTV_IND                                   07520000
081300                      )                                           07530000
081400             VALUES ( :DLT00002-TMP-USR-ID                        07540000
081500                     ,:DLT00002-DC-NBR                            07550000
081600                     ,:DLT00002-FRST-NM                           07560000
081700                     ,:DLT00002-LAST-NM                           07570000
081800                     ,:DLT00002-CRE-BY-USR-ID                     07580000
081900                     ,:DLT00002-CRE-TMST                          07590000
082000                     ,:DLT00002-ACTV-IND                          07600000
082100                     )                                            07610000
082200         END-EXEC                                                 07620000
082300                                                                  07630000
082400         EVALUATE TRUE                                            07640000
082500             WHEN SQLCODE = +0                                    07650000
082600                 MOVE PC-Y TO ASC-ACTIVE-USER                     07660000
082700             WHEN SQLCODE = -904                                  07670000
082800             WHEN SQLCODE = -913                                  07680000
082900                 CONTINUE                                         07690000
083000                                                                  07700000
083100             WHEN SQLWARN0 NOT = SPACE                            07710000
083200             WHEN SQLCODE < +0                                    07720000
083300             WHEN SQLCODE > +0                                    07730000
083400                 MOVE '5100-INSERT-TEMP-ASSOC'                    07740000
083500                                 TO DP013-PARAGRAPH               07750000
083600                 MOVE 'INSERT ON DLT_TMP_EMP   '                  07760000
083700                                 TO DP013-MESSAGE-TEXT (1)        07770000
083800                 MOVE DLT00002-LAST-NM                            07780000
083900                                 TO DP013-MESSAGE-TEXT (2)        07790000
084000                 MOVE ASC-MAX-USER-CODE                           07800000
084100                                 TO DP013-MESSAGE-TEXT (3)        07810000
084200                 MOVE SQLCA      TO DP013-SQLCA                   07820000
084300                 MOVE 'TRECEIV'  TO DP013-DB2-TABLE-NAME (1)      07830000
084400                     SET DP013-DB2-ABEND                          07840000
084500                         DP013-XCTL-DISPLAY-RESTART               07850000
084600                                     TO TRUE                      07860000
084700                 PERFORM DP013-0000-PROCESS-ABEND                 07870000
084800         END-EVALUATE                                             07880000
084900     END-PERFORM.                                                 07890000
085000                                                                  07900000
085100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07910000
085200             AND (SQLCODE = -904 OR -913)                         07920000
085300         MOVE '5100-INSERT-TEMP-ASSOC'                            07930000
085400                                  TO DP013-PARAGRAPH              07940000
085500         MOVE 'MAX RETRIES EXCEEDED INSERT - DLT_TMP_EMP'         07950000
085600                                  TO DP013-MESSAGE-TEXT (1)       07960000
085700         MOVE SQLCA               TO DP013-SQLCA                  07970000
085800         MOVE 'DLT_TMP_EMP'       TO DP013-DB2-TABLE-NAME (1)     07980000
085900         SET DP013-DB2-ABEND                                      07990000
086000             DP013-XCTL-DISPLAY-RESTART                           08000000
086100                                  TO TRUE                         08010000
086200         PERFORM DP013-0000-PROCESS-ABEND                         08020000
086300     END-IF.                                                      08030000
086400/                                                                 08040000
078700 5200-INSERT-RDPR-USR.                                            07270000
079600                                                                  07360000
079700     PERFORM                                                      07370000
079800         WITH TEST AFTER                                          07380000
079900         VARYING PV-RETRY-COUNTER                                 07390000
080000         FROM 1 BY 1                                              07400000
080100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07410000
080200             OR (SQLCODE = +0 OR SQLCODE = -803))                 07420000
080300                                                                  07430000
022900         EXEC SQL                                                         
023000             INSERT INTO DLT_RDPR_USR_LSTG                                
023100                (USR_ID                                                   
023110                ,LOC_NBR                                                  
023110                ,TMP_USR_ID                                               
023110                ,CRE_TMST)                                                
023200                                                                          
023200             VALUES (NULL                                                 
023200                    ,:DLT00002-DC-NBR                                     
023200                    ,:DLT00002-TMP-USR-ID                                 
023200                    ,:DLT00002-CRE-TMST)                                  
023600         END-EXEC                                                         
082300                                                                  07630000
082400         EVALUATE TRUE                                            07640000
082500             WHEN SQLCODE = +0 OR -803                            07650000
082600                 CONTINUE                                         07660000
082700             WHEN SQLCODE = -904                                  07670000
082800             WHEN SQLCODE = -913                                  07680000
082900                 CONTINUE                                         07690000
083000                                                                  07700000
083100             WHEN SQLWARN0 NOT = SPACE                            07710000
083200             WHEN SQLCODE < +0                                    07720000
083300             WHEN SQLCODE > +0                                    07730000
083400                 MOVE '5200-INSERT-RDPR-USR  '                    07740000
083500                                 TO DP013-PARAGRAPH               07750000
083600                 MOVE 'INSERT ON DLT_RDPR_USR_LSTG  '             07760000
083700                                 TO DP013-MESSAGE-TEXT (1)        07770000
083800                 MOVE DLT00002-DC-NBR                             07780000
083900                                 TO DP013-MESSAGE-TEXT (2)        07790000
084000                 MOVE ASC-MAX-USER-CODE                           07800000
084100                                 TO DP013-MESSAGE-TEXT (3)        07810000
084200                 MOVE SQLCA      TO DP013-SQLCA                   07820000
084300                 MOVE 'DLT_RDPR' TO DP013-DB2-TABLE-NAME (1)      07830000
084400                     SET DP013-DB2-ABEND                          07840000
084500                         DP013-XCTL-DISPLAY-RESTART               07850000
084600                                     TO TRUE                      07860000
084700                 PERFORM DP013-0000-PROCESS-ABEND                 07870000
084800         END-EVALUATE                                             07880000
084900     END-PERFORM.                                                 07890000
085000                                                                  07900000
085100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07910000
085200             AND (SQLCODE = -904 OR -913)                         07920000
085300         MOVE '5200-INSERT-RDPR-USR  '                            07930000
085400                                  TO DP013-PARAGRAPH              07940000
085500         MOVE 'MAX RETRIES EXCEEDED INSERT - DLT_RDPR_USR_LSTG'   07950000
085600                                  TO DP013-MESSAGE-TEXT (1)       07960000
085700         MOVE SQLCA               TO DP013-SQLCA                  07970000
085800         MOVE 'DLT_RDPR'          TO DP013-DB2-TABLE-NAME (1)     07980000
085900         SET DP013-DB2-ABEND                                      07990000
086000             DP013-XCTL-DISPLAY-RESTART                           08000000
086100                                  TO TRUE                         08010000
086200         PERFORM DP013-0000-PROCESS-ABEND                         08020000
086300     END-IF.                                                      08030000
086500*----------------------------------------------------------------*08050000
086600*  CALL XLKUT067 ASSOCIATE INFO SUB-ROUTINE TO FILL IN THE       *08060000
086700*  SIGNON USER NAME GIVEN THE USER-ID FROM THE ARCHITECURE.      *08070000
086800*----------------------------------------------------------------*08080000
086900 7000-SIGNON-USER-NAME.                                           08090000
087000                                                                  08100000
087100     MOVE DP020-USERID                TO XL067-KEY-USER-ID.       08110000
087200                                                                  08120000
087300     SET XL067-BY-USER-ID                                         08130000
087400         XL067-SELECT-BOTH-USERS      TO TRUE.                    08140000
087500                                                                  08150000
087600     CALL XL067-USER-PGM USING DFHEIBLK                           08160000
087700                               XL067-COMMAREA                     08170000
087800                               XL067-USER-COMMAREA.               08180000
087900                                                                  08190000
088000     EVALUATE TRUE                                                08200000
088100         WHEN XL067-SUCCESSFUL                                    08210000
088200             MOVE XL067-COMBINED-NAME-4    TO AADDNMEO            08220000
088300                                              ASC-ADDED-BY-NAME   08221000
088400         WHEN XL067-SQL-ERROR                                     08230000
088500             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    08240000
088600             MOVE '7000-SIGNON-USER-NAME'   TO PV-SOFT-PARAGRAPH  08250000
088700             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  08260000
088800             MOVE LENGTH OF PV-CICS-MSG-AREA2                     08270000
088900               TO PV-COMMAREA-LENGTH                              08280000
089000             EXEC CICS                                            08290000
089100                  WRITEQ TD                                       08300000
089200                   QUEUE  ('CSSL')                                08310000
089300                    FROM  (PV-CICS-MSG-AREA2)                     08320000
089400                  LENGTH  (PV-COMMAREA-LENGTH)                    08330000
089500                    RESP  (PV-CICS-RESP)                          08340000
089600             END-EXEC                                             08350000
089700             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              08360000
089800             PERFORM 9900-SOFT-ABORT                              08370000
089900     END-EVALUATE.                                                08380000
090000/                                                                 08400001
090100 8410-CALL-XLKUP033.                                              08410001
090200                                                                  08420001
090300     INITIALIZE XL072-EAI-EXPORT-COMMAREA                         08430001
090400                                                                  08440001
090500     SET XL072-PC-APP-ID          TO TRUE.                        08450001
090600     MOVE 'DC LABOR'              TO XL072-EVNT-OBJ-TXT           08460001
090700     MOVE 'ASSOCIATE ADD'         TO XL072-EVNT-OBJ-ACTN-TXT      08470001
090800     MOVE ASC-SIGNON-USERID       TO XL072-CRE-BY-USR-ID          08490001
090900     MOVE 'DLKCS401'              TO XL072-CRE-PGM-NM.            08530001
091000     MOVE 'N/A'                   TO XL072-DTL-COPYBOOK-NM        08550001
091100     MOVE ASC-KEY-OPER-UNT-ID     TO XL072-EVNT-KY-1-NBR                  
091200     MOVE DLT00002-TMP-USR-ID     TO XL072-EVNT-KY-1-TXT          08490001
091300     MOVE DLT00002-LAST-NM        TO XL072-EVNT-KY-2-TXT                  
091400     MOVE DLT00002-FRST-NM        TO XL072-EVNT-KY-3-TXT                  
091500                                                                  08560001
091600     SET XL072-COMMIT-UPDATE      TO TRUE.                        08600001
091700     MOVE 'DLKCS401'              TO XL072-ORIG-CALLING-PGM-NM.   08610001
091800                                                                  08620001
091900     CALL XL072-USER-PGM USING DFHEIBLK                           08652001
092000                               XL072-COMMAREA                     08653001
092100                               XL072-EAI-EXPORT-COMMAREA          08654001
092200                                                                  08655001
092300                                                                  08656001
092400     EVALUATE TRUE                                                08657001
092500         WHEN XL072-SUCCESSFUL                                    08658001
092600             CONTINUE                                             08659001
092700         WHEN XL072-SQL-ERROR                                     08659101
092800                                                                          
092900             MOVE XL072-SQLCA               TO SQLCA                      
093000             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    08240000
093100             MOVE '8410-CALL-XLKUP033'      TO PV-SOFT-PARAGRAPH  08250000
093200             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  08260000
093300             MOVE LENGTH OF PV-CICS-MSG-AREA2                     08270000
093400               TO PV-COMMAREA-LENGTH                              08280000
093500             EXEC CICS                                            08290000
093600                  WRITEQ TD                                       08300000
093700                   QUEUE  ('CSSL')                                08310000
093800                    FROM  (PV-CICS-MSG-AREA2)                     08320000
093900                  LENGTH  (PV-COMMAREA-LENGTH)                    08330000
094000                    RESP  (PV-CICS-RESP)                          08340000
094100             END-EXEC                                             08350000
094200             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              08360000
094300             PERFORM 9900-SOFT-ABORT                              08370000
094400                                                                          
094500         WHEN OTHER                                               08662101
094600             MOVE '8410-CALL-XLKUP033' TO DP013-PARAGRAPH         08662201
094700             STRING 'DLKCS401 - UNDETERMINED ERROR IN PGM: '      08662301
094800                  'XLKUP033'                                      08662501
094900                   DELIMITED BY SIZE                                      
095000                                    INTO DP013-MESSAGE-TEXT (1)           
095100                                                                          
095200             STRING ' PARA= '                                             
095300                   XL072-SQL-ERROR-PARA                                   
095400                     ' MODULE= '                                          
095500                   XL072-CALL-MOD-FAIL-NM                                 
095600                     ' CALL-MOD-FAIL-ERR-CDE= '                           
095700                   XL072-CALL-MOD-FAIL-ERR-CDE                            
095800                 DELIMITED BY SIZE  INTO DP013-MESSAGE-TEXT (2)   08662501
095900             MOVE XL072-SQLCA         TO DP013-SQLCA              07820000
096000             SET DP013-CICS-ABEND                                 08662601
096100                 DP013-ROLLBACK       TO TRUE                     08662701
096200                                                                          
096300             SET DP013-DB2-ABEND                                  07840000
096400                 DP013-XCTL-DISPLAY-RESTART                       07850000
096500                                      TO TRUE                     07860000
096600             PERFORM DP013-0000-PROCESS-ABEND                     07870000
096700     END-EVALUATE.                                                08663501
096800/                                                                 08663701
096900*----------------------------------------------------------------*08664000
097000*    ABEND PROCESSOR MODULE                                      *08670000
097100*----------------------------------------------------------------*08680000
097200                                                                  08690000
097300     COPY DPPD013.                                                08700000
097400                                                                  08710000
097500/                                                                 08720000
097600*----------------------------------------------------------------*08730000
097700*  SOFT ABORT                                                    *08740000
097800*----------------------------------------------------------------*08750000
097900 9900-SOFT-ABORT.                                                 08760000
098000                                                                  08770000
098100     EXEC CICS SYNCPOINT                                          08780000
098200          ROLLBACK                                                08790000
098300     END-EXEC.                                                    08800000
098400                                                                  08810000
098500     SET  PS-ERROR                                                08820000
098600          PS-SOFT-ABORT-ERROR                                     08830000
098700          DP020-MSG-FATAL       TO  TRUE.                         08840000
098800                                                                  08850000
098900******************************************************************08860000
099000*                     END OF PROGRAM                             *08870000
099100******************************************************************08880000
