      ******************************************************************00010099
       IDENTIFICATION DIVISION.                                         00020099
      ******************************************************************00030099
                                                                        00040099
       PROGRAM-ID.             TFKRP494.                                00050099
       AUTHOR.                 JACK KRAMER.                             00060099
       INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070099
       DATE-WRITTEN            JUNE 1997.                               00080099
       DATE-COMPILED.                                                   00090099
                                                                        00100099
      ******************************************************************00110099
      *    THIS PROGRAM PRODUCES A REPORT OF OFFSITE STORAGE TRANSFERS  00120099
      *  SORTED BY TRANSFER NUMBER, DEPARTMENT, CLASS, & SKU.           00130099
      ******************************************************************00140099
      ******************************************************************00150099
      *  2/28/2003 - CHRIS ALBRIGHT                                     00151099
      *   PROCESS NONINTELLIGENT SKU.                                   00152099
      ******************************************************************00153099
100404** 10/04/2004 CHANGED BY: RAY GRAF                                00154099
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00155099
      ***************************************************************** 00156099
      ******************************************************************00160099
       ENVIRONMENT DIVISION.                                            00170099
      ******************************************************************00180099
                                                                        00190099
       CONFIGURATION SECTION.                                           00200099
                                                                        00210099
       SOURCE-COMPUTER.        IBM-3090.                                00220099
       OBJECT-COMPUTER.        IBM-3090.                                00230099
                                                                        00240099
       INPUT-OUTPUT SECTION.                                            00250099
                                                                        00260099
       FILE-CONTROL.                                                    00270099
                                                                        00280099
           SELECT OFFSITE-STORAGE-FILE                                  00290099
               ASSIGN TO INP01                                          00300099
               FILE STATUS  IS PV-FILE-STATUS.                          00310099
                                                                        00320099
           SELECT TRANSFER-REPORT-FILE                                  00330099
               ASSIGN TO RPT01.                                         00340099
      *                                                                 00350099
      ******************************************************************00360099
       DATA DIVISION.                                                   00370099
      ******************************************************************00380099
                                                                        00390099
       FILE SECTION.                                                    00400099
                                                                        00410099
       FD  OFFSITE-STORAGE-FILE                                         00420099
           RECORDING MODE IS F                                          00430099
           LABEL RECORDS ARE STANDARD                                   00440099
           BLOCK CONTAINS 0 RECORDS.                                    00450099
                                                                        00460099
       01  OFFSITE-STORAGE-FILE-RECORD         PIC  X(60).              00470099
                                                                        00480099
       FD  TRANSFER-REPORT-FILE                                         00490099
           LABEL RECORDS ARE STANDARD                                   00500099
           RECORDING MODE IS F                                          00510099
           BLOCK CONTAINS 0 RECORDS                                     00520099
           RECORD CONTAINS 132 CHARACTERS                               00530099
           DATA RECORD IS TRANSFER-REPORT-RECORD.                       00540099
                                                                        00550099
       01  TRANSFER-REPORT-RECORD PIC X(132).                           00561099
      *                                                                 00570099
       WORKING-STORAGE SECTION.                                         00580099
                                                                        00590099
      *                                                                 00600099
      *  STANDARD REPORT HEADER FOR A 132 COLUMN REPORT                 00610099
           COPY DPWS132O.                                               00620099
      *----------------------------------------------------------------*00630099
      *  RECORD LAYOUT FOR THE OFFSITE STORAGE FILE                     00640099
      *----------------------------------------------------------------*00650099
           COPY TFRD040.                                                00660099
           EJECT                                                        00670099
      *                                                                 00680099
       01  ABEND-CODE                  PIC S9(4)    VALUE ZERO          00690099
                                       COMP SYNC.                       00700099
                                                                        00710099
       01  PS-PROGRAM-SWITCHES.                                         00720099
           05  PS-ITEMS-READ-SW        PIC X(01)    VALUE 'N'.          00730099
               88  PS-ITEMS-READ                    VALUE 'Y'.          00740099
               88  PS-NO-ITEMS-READ                 VALUE 'N'.          00750099
           05  PS-FIRST-STORE-SW       PIC X(01)    VALUE 'Y'.          00760099
               88  PS-FIRST-STORE                   VALUE 'Y'.          00770099
               88  PS-NOT-FIRST-STORE               VALUE 'N'.          00780099
           05  PS-FIRST-TIME-SW        PIC X(01)    VALUE 'Y'.          00790099
               88  PS-FIRST-TIME                    VALUE 'Y'.          00800099
               88  PS-NOT-FIRST-TIME                VALUE 'N'.          00810099
           05  PS-END-OF-OFFSITE-SW    PIC  X(01)   VALUE 'N'.          00820099
               88  PS-END-OF-OFFSITE-FILE           VALUE 'Y'.          00830099
               88  PS-NOT-END-OF-OFFSITE-FILE       VALUE 'N'.          00840099
                                                                        00850099
       01  PC-PROGRAM-CONSTANTS.                                        00860099
           05  PC-PROGRAM-NAME           PIC  X(08)  VALUE  'TFKRP494'. 00870099
           05  PC-GRAND-TOTAL            PIC  X(16)  VALUE              00880099
                                         '     GRAND TOTAL'.            00890099
           05  PC-STORE-TOTAL            PIC  X(16)  VALUE              00900099
                                         '     STORE TOTAL'.            00910099
           05  PC-PAGE-MAX               PIC  S9(03) VALUE  +60.        00920099
           05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3      00930099
                                                           COMP-3.      00940099
      ******  CONSTANTS TO CHECK MAJOR CLASS AND SUBCLASS LENGTH  ******00940199
022803     05  PC-099                    PIC  9(03)  VALUE 099.         00941099
022803     05  PC-100                    PIC  9(03)  VALUE 100.         00950099
       01  PV-PROGRAM-VARIABLES.                                        00960099
           05  PV-RETRY-COUNT          PIC S9(4)    VALUE ZERO          00970099
                                       COMP SYNC.                       00980099
           05  PV-PAGE-COUNT           PIC 9(5)    VALUE ZERO.          00990099
           05  PV-ITEMS-READ           PIC 9(8)    VALUE ZERO.          01000099
           05  PV-FILE-STATUS          PIC  X(02)   VALUE SPACES.       01010099
               88  PV-FILE-SUCCESSFUL               VALUE '00'.         01020099
               88  PV-FILE-NOT-FOUND                VALUE '23'.         01030099
           05  PV-LINE-COUNT           PIC S9(4)   VALUE ZERO.          01040099
           05  PV-PARAGRAPH-NAME               PIC X(30)   VALUE SPACE. 01050099
           05  PV-DB2-OPERATION                PIC X(30)   VALUE SPACE. 01060099
           05  PV-EXT-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01110099
           05  PV-DOC-QTY              PIC S9(08)    VALUE ZERO COMP-3. 01120099
           05  PV-DOC-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01130099
           05  PV-DOC-EXT-RTL          PIC S9(09)V99 VALUE ZERO COMP-3. 01140099
           05  PV-CMP-QTY              PIC S9(08)    VALUE ZERO COMP-3. 01150099
           05  PV-CMP-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01160099
           05  PV-CMP-EXT-RTL          PIC S9(09)V99 VALUE ZERO COMP-3. 01170099
           05  PV-STR-QTY              PIC S9(08)    VALUE ZERO COMP-3. 01180099
           05  PV-STR-RTL              PIC S9(09)V99 VALUE ZERO COMP-3. 01190099
           05  PV-STR-EXT-RTL          PIC S9(09)V99 VALUE ZERO COMP-3. 01200099
       01  HV-HOLD-VARIABLES.                                           01210099
           05  HV-STORE-NBR            PIC 9(04)    VALUE ZERO.         01220099
100404*    05  HV-XFER-NBR             PIC X(09)    VALUE SPACE.        01230099
100404     05  HV-XFER-NBR             PIC X(11)    VALUE SPACE.        01231099
                                                                        01240099
       01  BLANK-LINE                  PIC X(132)   VALUE SPACES.       01250099
                                                                        01260099
       01  END-OF-REPORT-LINE.                                          01270099
           05  FILLER                  PIC X(52)    VALUE SPACES.       01280099
           05  FILLER                  PIC X(26)    VALUE               01290099
               '   *** END OF REPORT ***'.                              01300099
           05  FILLER                  PIC X(54)    VALUE SPACES.       01310099
                                                                        01320099
       01  NO-DATA-LINE.                                                01330099
           05  FILLER                  PIC X(35)    VALUE SPACES.       01340099
           05  FILLER                  PIC X(45)    VALUE               01350099
               '****  NO DATA TO PROCESS FOR THIS REPORT  ***'.         01360099
                                                                        01370099
       01  CD-CURRENT-DATE.                                             01380099
           05  CD-CURRENT-YEAR         PIC 9(2)     VALUE ZERO.         01390099
           05  CD-CURRENT-MONTH        PIC 9(2)     VALUE ZERO.         01400099
           05  CD-CURRENT-DAY          PIC 9(2)     VALUE ZERO.         01410099
                                                                        01420099
       01  CT-CURRENT-TIME.                                             01430099
           05  CT-CURRENT-HOUR         PIC 9(2)     VALUE ZERO.         01440099
           05  CT-CURRENT-MINUTE       PIC 9(2)     VALUE ZERO.         01450099
           05  FILLER                  PIC 9(4)     VALUE ZERO.         01460099
                                                                        01470099
       01  HL2-HEADING-LINE-2.                                          01480099
           05  FILLER                  PIC X(42)    VALUE SPACES.       01490099
           05  FILLER                  PIC X(60)    VALUE               01500099
           'OFF-SITE STORAGE BY STORE/TRANSFER DOCUMENT REPORT'.        01510099
                                                                        01520099
       01  HL3-HEADING-LINE-3.                                          01530099
           05  FILLER                  PIC X(06)  VALUE 'STORE '.       01540099
100404     05  HL3-STORE-NBR           PIC 9(04).                       01550099
           05  FILLER                  PIC X(01)  VALUE SPACE.          01560099
           05  HL3-STORE-NAME          PIC X(25)  VALUE SPACE.          01570099
                                                                        01580099
       01  HL4-HEADING-LINE-4.                                          01590099
           05  FILLER                  PIC X(04)  VALUE 'DOC'.          01610099
           05  FILLER                  PIC X(07)  VALUE 'NUMBER'.       01620099
022803     05  FILLER                  PIC X(12)  VALUE 'D/M/S'.        01631099
           05  FILLER                  PIC X(16)  VALUE 'SCN UPC'.      01640099
           05  FILLER                  PIC X(21)  VALUE 'SKU DESC'.     01650099
           05  FILLER                  PIC X(16)  VALUE 'STYLE'.        01660099
           05  FILLER                  PIC X(11)  VALUE 'COLOR'.        01670099
           05  FILLER                  PIC X(14)  VALUE 'SIZE'.         01680099
           05  FILLER                  PIC X(13)  VALUE 'QTY'.          01690099
           05  FILLER                  PIC X(11)  VALUE 'RTL'.          01700099
           05  FILLER                  PIC X(07)  VALUE 'EXT RTL'.      01710099
                                                                        01720099
       01  HL5-HEADING-LINE-5.                                          01730099
           05  FILLER                  PIC X(11)  VALUE '----------'.   01750099
022803     05  FILLER                  PIC X(12)  VALUE '-----------'.  01760099
           05  FILLER                  PIC X(16)  VALUE                 01770099
                                       '---------------'.               01771099
           05  FILLER                  PIC X(21)  VALUE                 01780099
                                       '--------------------'.          01790099
           05  FILLER                  PIC X(16)  VALUE                 01800099
                                       '---------------'.               01810099
           05  FILLER                  PIC X(11)  VALUE '----------'.   01820099
           05  FILLER                  PIC X(11)  VALUE '----------'.   01830099
           05  FILLER                  PIC X(07)  VALUE '------'.       01840099
           05  FILLER                  PIC X(13)  VALUE                 01850099
                                       '------------'.                  01860099
           05  FILLER                  PIC X(14)  VALUE                 01870099
                                       '--------------'.                01880099
                                                                        01890099
       01  UL1-UNDERLINE-1.                                             01900099
           05  FILLER                  PIC X(98)  VALUE SPACE.          01910099
           05  FILLER                  PIC X(07)  VALUE '------'.       01920099
           05  FILLER                  PIC X(13)  VALUE                 01930099
                                       '------------'.                  01940099
           05  FILLER                  PIC X(14)  VALUE                 01950099
                                       '--------------'.                01960099
                                                                        01970099
       01  UL2-UNDERLINE-2.                                             01980099
           05  FILLER                  PIC X(98)  VALUE SPACE.          01990099
           05  FILLER                  PIC X(07)  VALUE '======'.       02000099
           05  FILLER                  PIC X(13)  VALUE                 02010099
                                       '============'.                  02020099
           05  FILLER                  PIC X(14)  VALUE                 02030099
                                       '=============='.                02040099
                                                                        02050099
       01  DL1-DETAIL-LINE-1.                                           02060099
           05  DL1-TRANSFER-NBR.                                        02080099
100404*        10  DL1-FR-STR-NBR      PIC 9(03).                       02090099
100404         10  DL1-FR-STR-NBR      PIC 9(04).                       02091099
               10  DL1-DASH1           PIC X(01)  VALUE SPACES.         02100099
               10  DL1-XFER-SEQ-NBR    PIC 9(06).                       02110099
           05  FILLER                  PIC X(01)  VALUE SPACES.         02120099
022803     05  DL1-DPT-CL-SUBCL.                                        02177099
               10  DL1-DEPT                   PIC 999.                  02178099
               10  FILLER                     PIC X(01)   VALUE SPACE.  02179099
               10  DL1-GROUP-1.                                         02179199
                   15 DL1-CLASS-1             PIC 99      VALUE ZEROS.  02179299
                   15 FILLER                  PIC X(01)   VALUE SPACE.  02179399
                   15 DL1-SUBCLASS-1          PIC 99      VALUE ZEROS.  02179499
                   15 FILLER                  PIC X(02)   VALUE SPACE.  02179599
               10  DL1-GROUP-2 REDEFINES DL1-GROUP-1.                   02179699
                   15 DL1-CLASS-2             PIC  99.                  02179799
                   15 DL1-FILLER-2A           PIC  X(01).               02179899
                   15 DL1-SUBCLASS-2          PIC  999.                 02179999
                   15 DL1-FILLER-2B           PIC  X(01).               02180099
               10  DL1-GROUP-3 REDEFINES DL1-GROUP-1.                   02180199
                   15 DL1-CLASS-3             PIC  999.                 02180299
                   15 DL1-FILLER-3A           PIC  X(01).               02180399
                   15 DL1-SUBCLASS-3          PIC  99.                  02180499
                   15 DL1-FILLER-3B           PIC  X(01).               02180599
               10  DL1-GROUP-4 REDEFINES DL1-GROUP-1.                   02180699
                   15 DL1-CLASS-4             PIC  999.                 02180799
                   15 DL1-FILLER-4A           PIC  X(01).               02180899
                   15 DL1-SUBCLASS-4          PIC  999.                 02180999
           05  FILLER                  PIC X(01)  VALUE SPACES.         02182099
           05  DL1-UPC                 PIC Z(14).                       02191099
           05  FILLER                  PIC X(01)  VALUE SPACES.         02200099
           05  DL1-DESC                PIC X(20).                       02210099
           05  FILLER                  PIC X(01)  VALUE SPACES.         02220099
           05  DL1-STYLE               PIC X(15).                       02230099
           05  FILLER                  PIC X(01)  VALUE SPACE.          02240099
           05  DL1-TOTALS-LITERAL.                                      02250099
               10  DL1-COLOR           PIC X(10).                       02260099
               10  FILLER              PIC X(01)  VALUE SPACE.          02270099
               10  DL1-SIZE            PIC X(10).                       02280099
           05  FILLER                  PIC X(01)  VALUE SPACE.          02290099
           05  DL1-QTY                 PIC Z(06).                       02300099
           05  DL1-RTL                 PIC ZZ,ZZZ,ZZZ.99                02320099
                                           BLANK WHEN ZERO.             02330099
           05  FILLER                  PIC X(01)  VALUE SPACE.          02340099
           05  DL1-EXT-RTL             PIC ZZZ,ZZZ,ZZZ.99               02350099
                                           BLANK WHEN ZERO.             02360099
           05  FILLER                  PIC X(04)  VALUE SPACE.          02370099
      *---------------------------------------------------------------* 02380099
100404*    DB2 AREA FOR XST_LOC TABLE                                 * 02390099
      *---------------------------------------------------------------* 02400099
           EXEC SQL                                                     02410099
100404          INCLUDE XST00001                                        02420099
           END-EXEC.                                                    02430099
                                                                        02440099
      *---------------------------------------------------------------* 02500199
100404*    DB2 AREA FOR XST_SKU TABLE                                 * 02500299
      *---------------------------------------------------------------* 02500399
           EXEC SQL                                                     02500499
100404          INCLUDE XST00010                                        02500599
           END-EXEC.                                                    02500699
      *---------------------------------------------------------------* 02500799
100404*    DB2 AREA FOR XST_UPC TABLE                                 * 02500899
      *---------------------------------------------------------------* 02500999
           EXEC SQL                                                     02501099
100404          INCLUDE XST00012                                        02501199
           END-EXEC.                                                    02501299
      *---------------------------------------------------------------* 02501399
100404*    DB2 AREA FOR XST_VND_STYL TABLE                            * 02501499
      *---------------------------------------------------------------* 02501599
           EXEC SQL                                                     02501699
100404          INCLUDE XST00013                                        02501799
           END-EXEC.                                                    02501899
                                                                        02510099
           EXEC SQL                                                     02520099
               INCLUDE SQLCA                                            02530099
           END-EXEC.                                                    02540099
      *                                                                 02550099
      *  EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING           02560099
      *  SQL CODES FOR DISPLAY                                          02570099
      *                                                                 02580099
           COPY SQLCA2.                                                 02590099
                                                                        02600099
      ******************************************************************02610099
       PROCEDURE DIVISION.                                              02620099
      ******************************************************************02630099
       0000-MAINLINE.                                                   02640099
           PERFORM 1000-INITIALIZE.                                     02650099
           PERFORM 2000-PROCESS-OFFSITE-FILE.                           02660099
                                                                        02670099
           IF PS-NO-ITEMS-READ                                          02680099
               PERFORM 8000-PRINT-HEADINGS                              02690099
               WRITE TRANSFER-REPORT-RECORD                             02700099
                   FROM NO-DATA-LINE                                    02710099
                   AFTER ADVANCING 2                                    02720099
           ELSE                                                         02730099
               PERFORM 8200-GRAND-TOTALS                                02740099
           END-IF.                                                      02750099
                                                                        02760099
           WRITE TRANSFER-REPORT-RECORD                                 02770099
               FROM END-OF-REPORT-LINE                                  02780099
               AFTER ADVANCING 2.                                       02790099
           CLOSE TRANSFER-REPORT-FILE                                   02800099
                 OFFSITE-STORAGE-FILE.                                  02810099
           STOP RUN.                                                    02820099
                                                                        02830099
      ******************************************************************02840099
      *  SET UP FOR PROGRAM PROCESSING BY OPENING ALL FILES,            02850099
      *  FILLING THE FIELDS OF THE STANDARD REPORT HEADER,              02860099
      *  READING FIRST RECORD, PRINT HEADINGS.                          02870099
      ******************************************************************02880099
                                                                        02890099
       1000-INITIALIZE.                                                 02900099
           OPEN OUTPUT TRANSFER-REPORT-FILE                             02910099
                INPUT  OFFSITE-STORAGE-FILE.                            02920099
           ACCEPT CD-CURRENT-DATE FROM DATE.                            02930099
           MOVE CD-CURRENT-YEAR TO DP132O-RUN-YEAR.                     02940099
           MOVE CD-CURRENT-MONTH TO DP132O-RUN-MONTH.                   02950099
           MOVE CD-CURRENT-DAY TO DP132O-RUN-DAY.                       02960099
           MOVE +90 TO PV-LINE-COUNT.                                   02970099
                                                                        02980099
           ACCEPT CT-CURRENT-TIME FROM TIME.                            02990099
           MOVE CT-CURRENT-HOUR TO DP132O-RUN-HOUR.                     03000099
           MOVE CT-CURRENT-MINUTE TO DP132O-RUN-MINUTE.                 03010099
           MOVE PC-PROGRAM-NAME              TO DP132O-PROGRAM-NAME.    03020099
           MOVE 1 TO DP132O-REPORT-NUMBER.                              03030099
                                                                        03040099
      ******************************************************************03050099
      * CONTROL THE PROCESSING OF THE RECEIVED TRANSFERS FILE           03060099
      ******************************************************************03070099
       2000-PROCESS-OFFSITE-FILE.                                       03080099
           PERFORM                                                      03090099
               UNTIL (PS-END-OF-OFFSITE-FILE)                           03100099
                                                                        03110099
               PERFORM 2100-READ-OFFSITE-FILE                           03120099
                                                                        03130099
               IF  PS-NOT-END-OF-OFFSITE-FILE                           03140099
                   ADD +1                    TO PV-ITEMS-READ           03150099
                   PERFORM 3000-PROCESS-DATA                            03160099
               END-IF                                                   03170099
           END-PERFORM.                                                 03180099
           IF PV-ITEMS-READ > 0                                         03190099
               SET PS-ITEMS-READ             TO TRUE                    03200099
               PERFORM 5100-STORE-TOTALS                                03210099
           END-IF.                                                      03220099
       EJECT                                                            03230099
      *----------------------------------------------------------------*03240099
      *  READ THE OFFSITE STORAGE TRANSFER FILE.                       *03250099
      *----------------------------------------------------------------*03260099
       2100-READ-OFFSITE-FILE.                                          03270099
           READ OFFSITE-STORAGE-FILE                                    03280099
             INTO TF040-OFFSITE-STORAGE-RECORD                          03290099
               AT END                                                   03300099
                 SET PS-END-OF-OFFSITE-FILE          TO TRUE            03310099
           END-READ.                                                    03320099
      ******************************************************************03330099
      * PROCESS THE REPORT DATA                                         03340099
      ******************************************************************03350099
       3000-PROCESS-DATA.                                               03360099
           IF TF040-FR-STR-NBR         NOT = HV-STORE-NBR               03370099
               PERFORM 5000-NEW-STORE                                   03380099
           END-IF.                                                      03390099
           IF TF040-XFER-NBR           NOT = HV-XFER-NBR                03400099
               PERFORM 4000-DOCUMENT-TOTALS                             03410099
           END-IF.                                                      03420099
           MOVE SPACES                TO DL1-DETAIL-LINE-1.             03430099
           IF PV-LINE-COUNT > PC-PAGE-MAX                               03440099
               PERFORM 8000-PRINT-HEADINGS                              03450099
           END-IF.                                                      03460099
           MOVE TF040-SCN-UPC-NBR     TO DL1-UPC.                       03480199
           MOVE TF040-FR-STR-NBR      TO DL1-FR-STR-NBR.                03481099
           MOVE TF040-XFER-SEQ-NBR    TO DL1-XFER-SEQ-NBR.              03490099
022803     MOVE TF040-DEPT            TO DL1-DEPT.                      03500099
           MOVE TF040-XFER-PRIC-AMT   TO DL1-RTL.                       03520099
           MOVE TF040-XFER-QTY        TO DL1-QTY.                       03530099
           MOVE '-'                   TO DL1-DASH1.                     03540099
           COMPUTE PV-EXT-RTL = TF040-XFER-PRIC-AMT * TF040-XFER-QTY.   03550099
           MOVE PV-EXT-RTL            TO DL1-EXT-RTL.                   03550199
022803     IF TF040-CLASS < PC-100                                      03561299
              EVALUATE TRUE                                             03561399
              WHEN TF040-SUBCLASS < PC-100                              03561499
                MOVE TF040-CLASS TO DL1-CLASS-1                         03561599
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-1                   03561699
              WHEN TF040-SUBCLASS > PC-099                              03562199
                MOVE TF040-CLASS TO DL1-CLASS-2                         03562299
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-2                   03562399
                MOVE SPACES TO DL1-FILLER-2A                            03562499
                               DL1-FILLER-2B                            03562599
              END-EVALUATE                                              03564099
           ELSE IF                                                      03565099
              TF040-CLASS > PC-099                                      03566199
              EVALUATE TRUE                                             03566299
              WHEN TF040-SUBCLASS < PC-100                              03566399
                MOVE TF040-CLASS TO DL1-CLASS-3                         03566499
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-3                   03566599
                MOVE SPACES TO DL1-FILLER-3A                            03566699
                               DL1-FILLER-3B                            03566799
              WHEN TF040-SUBCLASS > PC-099                              03566899
                MOVE TF040-CLASS TO DL1-CLASS-4                         03566999
                MOVE TF040-SUBCLASS TO DL1-SUBCLASS-4                   03567099
                MOVE SPACES TO DL1-FILLER-4A                            03567199
              END-EVALUATE                                              03567299
           END-IF                                                       03639099
           END-IF                                                       03639199
100404     PERFORM 6000-READ-XST-UPC.                                   03640099
100404     MOVE XST00010-SKU-DESC      TO DL1-DESC.                     03650099
100404     MOVE XST00013-VS-NBR        TO DL1-STYLE.                    03660099
100404     MOVE XST00010-SIZE-DESC     TO DL1-SIZE.                     03670099
100404     MOVE XST00010-NRF-CLOR-DESC TO DL1-COLOR.                    03680099
           WRITE TRANSFER-REPORT-RECORD                                 03690099
               FROM DL1-DETAIL-LINE-1                                   03700099
               AFTER ADVANCING 1.                                       03710099
           ADD 1                      TO PV-LINE-COUNT.                 03720099
           ADD TF040-XFER-QTY         TO PV-DOC-QTY.                    03730099
           ADD TF040-XFER-PRIC-AMT    TO PV-DOC-RTL.                    03740099
           ADD PV-EXT-RTL             TO PV-DOC-EXT-RTL.                03750099
      ******************************************************************03760099
      *   DOCUMENT TOTALS                                               03770099
      ******************************************************************03780099
       4000-DOCUMENT-TOTALS.                                            03790099
           WRITE TRANSFER-REPORT-RECORD                                 03800099
               FROM UL1-UNDERLINE-1                                     03810099
               AFTER ADVANCING 1.                                       03820099
           MOVE SPACES                TO DL1-DETAIL-LINE-1              03830099
           MOVE PV-DOC-QTY            TO DL1-QTY                        03840099
           MOVE PV-DOC-RTL            TO DL1-RTL                        03850099
           MOVE PV-DOC-EXT-RTL        TO DL1-EXT-RTL.                   03860099
           WRITE TRANSFER-REPORT-RECORD                                 03870099
               FROM DL1-DETAIL-LINE-1                                   03880099
               AFTER ADVANCING 1.                                       03890099
           WRITE TRANSFER-REPORT-RECORD                                 03900099
               FROM BLANK-LINE                                          03910099
               AFTER ADVANCING 1.                                       03920099
           ADD  +3                    TO PV-LINE-COUNT.                 03930099
           ADD PV-DOC-QTY             TO PV-STR-QTY.                    03940099
           ADD PV-DOC-RTL             TO PV-STR-RTL.                    03950099
           ADD PV-DOC-EXT-RTL         TO PV-STR-EXT-RTL.                03960099
           MOVE ZEROES                TO PV-DOC-QTY                     03970099
                                         PV-DOC-RTL                     03980099
                                         PV-DOC-EXT-RTL.                03990099
           MOVE TF040-XFER-NBR        TO HV-XFER-NBR.                   04000099
      ******************************************************************04010099
      *   STORE NUMBER BREAK.                                           04020099
      ******************************************************************04030099
       5000-NEW-STORE.                                                  04040099
           IF PS-NOT-FIRST-STORE                                        04050099
               PERFORM 5100-STORE-TOTALS                                04060099
           ELSE                                                         04070099
               SET PS-NOT-FIRST-STORE    TO TRUE                        04080099
               MOVE TF040-XFER-NBR       TO HV-XFER-NBR                 04090099
           END-IF.                                                      04100099
           MOVE TF040-FR-STR-NBR         TO HV-STORE-NBR                04110099
                                            HL3-STORE-NBR               04120099
100404                                      XST00001-LOC-NBR.           04130099
           PERFORM 5200-READ-STORE.                                     04140099
100404     MOVE XST00001-LOC-NM          TO HL3-STORE-NAME.             04150099
      ******************************************************************04160099
      *    STORE TOTALS                                                 04170099
      ******************************************************************04180099
       5100-STORE-TOTALS.                                               04190099
           PERFORM 4000-DOCUMENT-TOTALS.                                04200099
           WRITE TRANSFER-REPORT-RECORD                                 04210099
               FROM UL1-UNDERLINE-1                                     04220099
               AFTER ADVANCING 1.                                       04230099
           MOVE SPACES                TO DL1-DETAIL-LINE-1              04240099
           MOVE PC-STORE-TOTAL        TO DL1-TOTALS-LITERAL.            04250099
           MOVE PV-STR-QTY            TO DL1-QTY                        04260099
           MOVE PV-STR-RTL            TO DL1-RTL                        04270099
           MOVE PV-STR-EXT-RTL        TO DL1-EXT-RTL.                   04280099
           WRITE TRANSFER-REPORT-RECORD                                 04290099
               FROM DL1-DETAIL-LINE-1                                   04300099
               AFTER ADVANCING 1.                                       04310099
           MOVE +90                   TO PV-LINE-COUNT.                 04320099
           ADD PV-STR-QTY             TO PV-CMP-QTY.                    04330099
           ADD PV-STR-RTL             TO PV-CMP-RTL.                    04340099
           ADD PV-STR-EXT-RTL         TO PV-CMP-EXT-RTL.                04350099
           MOVE ZEROES                TO PV-STR-QTY                     04360099
                                         PV-STR-RTL                     04370099
                                         PV-STR-EXT-RTL.                04380099
      *----------------------------------------------------------------*04390099
      *    GET THE STORE NAME.                                          04400099
      *----------------------------------------------------------------*04410099
       5200-READ-STORE.                                                 04420099
           PERFORM WITH TEST AFTER                                      04430099
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       04440099
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  04450099
                    OR SQLCODE = ZERO                                   04460099
                    OR SQLCODE = +100                                   04470099
               EXEC SQL                                                 04480099
100404             SELECT LOC_NM                                        04490099
100404                 INTO :XST00001-LOC-NM                            04500099
100404                 FROM XST_LOC                                     04510099
100404                 WHERE LOC_NBR = :XST00001-LOC-NBR                04520099
               END-EXEC                                                 04530099
               EVALUATE TRUE                                            04540099
                   WHEN SQLCODE = ZERO                                  04550099
                   WHEN SQLCODE = -904                                  04560099
                   WHEN SQLCODE = -913                                  04570099
                       CONTINUE                                         04580099
                   WHEN SQLCODE = +100                                  04590099
100404                 MOVE 'INVALID STORE'       TO XST00001-LOC-NM    04600099
                   WHEN OTHER                                           04610099
                       MOVE '5200-READ-STORE'     TO PV-PARAGRAPH-NAME  04640099
                       MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION  04650099
                       PERFORM 9100-SQL-ERROR                           04660099
               END-EVALUATE                                             04670099
           END-PERFORM.                                                 04680099
                                                                        04690099
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           04700099
               MOVE '5200-READ-STORE'     TO PV-PARAGRAPH-NAME          04710099
               MOVE 'READ THE STORE TABLE' TO PV-DB2-OPERATION          04720099
               PERFORM 9100-SQL-ERROR                                   04730099
           END-IF.                                                      04740099
      ******************************************************************04750099
      * READ THE SKU TABLE FOR DESCRIPTION, STYLE, COLOR & SIZE.        04760099
      ******************************************************************04770099
100404 6000-READ-XST-UPC.                                               04780099
100404     INITIALIZE DCLXST00010                                       04781099
100404                DCLXST00013.                                      04782099
           PERFORM WITH TEST AFTER                                      04790099
               VARYING PV-RETRY-COUNT FROM 1 BY 1                       04800099
                 UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                  04810099
                    OR SQLCODE = ZERO                                   04820099
                    OR SQLCODE = +100                                   04830099
               EXEC SQL                                                 04840099
100404             SELECT  B.SKU_DESC                                   04840599
100404                    ,B.SIZE_DESC                                  04840699
100404                    ,B.NRF_CLOR_DESC                              04840799
100404                    ,C.VS_NBR                                     04840899
100404               INTO  :XST00010-SKU-DESC                           04841399
100404                    ,:XST00010-SIZE-DESC                          04841499
100404                    ,:XST00010-NRF-CLOR-DESC                      04841599
100404                    ,:XST00013-VS-NBR                             04841699
100404               FROM  XST_UPC      A                               04841799
100404                    ,XST_SKU      B                               04841899
100404                    ,XST_VND_STYL C                               04841999
100404              WHERE A.UPC_NBR      =  :TF040-SCN-UPC-NBR          04842099
100404                AND A.LAST_ACTN_CDE IN ('A', 'U')                 04842199
100404                AND A.INTR_UPC_ID  =  B.INTR_UPC_ID               04842299
100404                AND B.STYL_ID      =  C.STYL_ID                   04842399
               END-EXEC                                                 04970099
                                                                        04980099
               EVALUATE TRUE                                            04990099
                   WHEN SQLCODE = ZERO                                  05001099
                   WHEN SQLCODE = -904                                  05010099
                   WHEN SQLCODE = -913                                  05021099
                     CONTINUE                                           05030099
                   WHEN SQLCODE = +100                                  05040099
100404               MOVE 'INVALID ITEM'       TO XST00010-SKU-DESC     05050199
                   WHEN OTHER                                           05060099
100404               MOVE '6000-READ-XST-UPC'   TO PV-PARAGRAPH-NAME    05090099
                     MOVE 'READ THE UPC TABLE' TO PV-DB2-OPERATION      05100099
                     PERFORM 9100-SQL-ERROR                             05110099
            END-EVALUATE                                                05120099
           END-PERFORM.                                                 05130099
                                                                        05140099
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          05150099
100404         MOVE '6000-READ-XST-UPC'   TO PV-PARAGRAPH-NAME          05160099
               MOVE 'READ THE UPC TABLE' TO PV-DB2-OPERATION            05170099
               PERFORM 9100-SQL-ERROR                                   05180099
           END-IF.                                                      05190099
      ******************************************************************05200099
      *  PRINT REPORT HEADINGS                                          05210099
      ******************************************************************05220099
                                                                        05230099
       8000-PRINT-HEADINGS.                                             05240099
           ADD 1 TO PV-PAGE-COUNT.                                      05250099
           MOVE 7             TO PV-LINE-COUNT.                         05260099
           MOVE PV-PAGE-COUNT TO DP132O-PAGE-NUMBER.                    05270099
           SET PS-FIRST-TIME          TO TRUE.                          05280099
           WRITE TRANSFER-REPORT-RECORD                                 05290099
               FROM DP132O-STANDRD-HEADER-132-COLS                      05300099
               AFTER ADVANCING PAGE.                                    05310099
           WRITE TRANSFER-REPORT-RECORD                                 05320099
               FROM HL2-HEADING-LINE-2                                  05330099
               AFTER ADVANCING 1.                                       05340099
           WRITE TRANSFER-REPORT-RECORD                                 05350099
               FROM HL3-HEADING-LINE-3                                  05360099
               AFTER ADVANCING 1.                                       05370099
           WRITE TRANSFER-REPORT-RECORD                                 05380099
               FROM HL4-HEADING-LINE-4                                  05390099
               AFTER ADVANCING 2.                                       05400099
           WRITE TRANSFER-REPORT-RECORD                                 05410099
               FROM HL5-HEADING-LINE-5                                  05420099
               AFTER ADVANCING 1.                                       05430099
           WRITE TRANSFER-REPORT-RECORD                                 05440099
               FROM BLANK-LINE                                          05450099
               AFTER ADVANCING 1.                                       05460099
      ******************************************************************05470099
      *  GRAND TOTALS                                                   05480099
      ******************************************************************05490099
       8200-GRAND-TOTALS.                                               05500099
           WRITE TRANSFER-REPORT-RECORD                                 05510099
               FROM UL2-UNDERLINE-2                                     05520099
               AFTER ADVANCING 2.                                       05530099
           MOVE SPACES                TO DL1-DETAIL-LINE-1              05540099
           MOVE PC-GRAND-TOTAL        TO DL1-TOTALS-LITERAL.            05550099
           MOVE PV-CMP-QTY            TO DL1-QTY                        05560099
           MOVE PV-CMP-RTL            TO DL1-RTL                        05570099
           MOVE PV-CMP-EXT-RTL        TO DL1-EXT-RTL.                   05580099
           WRITE TRANSFER-REPORT-RECORD                                 05590099
               FROM DL1-DETAIL-LINE-1                                   05600099
               AFTER ADVANCING 1.                                       05610099
      ******************************************************************05620099
      *  FORMAT A DB2 ERROR MESSAGE, RELEASE ALL LOCKS, AND ABEND THE  *05630099
      *  PROGRAM.                                                      *05640099
      ******************************************************************05650099
       9100-SQL-ERROR.                                                  05660099
           MOVE SQLCODE TO SQLCODE2.                                    05670099
           MOVE SQLERRD(3) TO SQLERRD3.                                 05680099
           DISPLAY '** ABEND **'.                                       05690099
           DISPLAY 'TFKRP494 - SQL ERROR'.                              05700099
           DISPLAY '       SQLCODE = ' SQLCODE2.                        05710099
           DISPLAY '      SQLWARN0 = ' SQLWARN0.                        05720099
           DISPLAY '      SQLWARN1 = ' SQLWARN1.                        05730099
           DISPLAY '      SQLWARN2 = ' SQLWARN2.                        05740099
           DISPLAY '      SQLWARN3 = ' SQLWARN3.                        05750099
           DISPLAY '      SQLWARN4 = ' SQLWARN4.                        05760099
           DISPLAY '      SQLWARN5 = ' SQLWARN5.                        05770099
           DISPLAY '      SQLWARN6 = ' SQLWARN6.                        05780099
           DISPLAY '      SQLWARN7 = ' SQLWARN7.                        05790099
           DISPLAY 'ROWS PROCESSED = ' SQLERRD3.                        05800099
           DISPLAY                    '** PARAGRAPH ** = '              05810099
                                       PV-PARAGRAPH-NAME.               05820099
           DISPLAY                    '** OPERATION ** = '              05830099
                                       PV-DB2-OPERATION.                05840099
                                                                        05850099
           EXEC SQL                                                     05860099
               COMMIT                                                   05870099
           END-EXEC.                                                    05880099
                                                                        05890099
           MOVE +4013 TO ABEND-CODE.                                    05900099
           CALL 'ILBOABN0' USING ABEND-CODE.                            05910099
                                                                        05920099
