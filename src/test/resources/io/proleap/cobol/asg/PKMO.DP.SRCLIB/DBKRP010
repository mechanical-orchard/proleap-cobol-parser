       IDENTIFICATION DIVISION.                                                 
                                                                                
       PROGRAM-ID.             DBKRP010.                                        
       AUTHOR.                 KARUN BONUGU.                                    
       INSTALLATION.           KOHLS DEPARTMENT STORES.                         
       DATE-WRITTEN.           MAY 2018.                                        
       DATE-COMPILED.                                                           
                                                                                
      *****************************************************************         
      ***  REPORTING PROGRAM USED FOR DB3T BIND STATS               ***         
      ***  ----------------------------------                       ***         
      ***  THIS PROGRAM WILL READ THE BIND STATS OF DB3T AND        ***         
      ***  CREATE A REPORT OF THE STATS.                            ***         
      *****************************************************************         
      *                                                                         
       ENVIRONMENT DIVISION.                                                    
                                                                                
       CONFIGURATION SECTION.                                                   
                                                                                
       SOURCE-COMPUTER.    IBM.                                                 
       OBJECT-COMPUTER.    IBM.                                                 
                                                                                
       INPUT-OUTPUT SECTION.                                                    
                                                                                
       FILE-CONTROL.                                                            
                                                                                
           SELECT INPUT-DB3T-BIND-STATS                                         
               ASSIGN TO INP01                                                  
               FILE STATUS IS W-IN-FILE-STATUS.                                 
                                                                                
           SELECT OUTPUT-DB3T-REPORTH                                           
               ASSIGN TO OUT01                                                  
               FILE STATUS IS W-OP1-FILE-STATUS.                                
                                                                                
           SELECT OUTPUT-DB3T-REPORTS                                           
               ASSIGN TO OUT02                                                  
               FILE STATUS IS W-OP2-FILE-STATUS.                                
                                                                                
           SELECT OUTPUT-DB3T-REPORTU                                           
               ASSIGN TO OUT03                                                  
               FILE STATUS IS W-OP3-FILE-STATUS.                                
                                                                                
           SELECT OUTPUT-DB3T-REPORTE                                           
               ASSIGN TO OUT04                                                  
               FILE STATUS IS W-OP4-FILE-STATUS.                                
                                                                                
       DATA DIVISION.                                                           
                                                                                
       FILE SECTION.                                                            
                                                                                
       FD  INPUT-DB3T-BIND-STATS                                                
           RECORDING MODE IS V                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  INPUT-DB3T-BIND-STATS-REC  PIC X(133).                               
                                                                                
       FD  OUTPUT-DB3T-REPORTH                                                  
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  OUTPUT-DB3T-REPORTH-REC    PIC X(133).                               
                                                                                
       FD  OUTPUT-DB3T-REPORTS                                                  
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  OUTPUT-DB3T-REPORTS-REC    PIC X(133).                               
                                                                                
       FD  OUTPUT-DB3T-REPORTU                                                  
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  OUTPUT-DB3T-REPORTU-REC    PIC X(133).                               
                                                                                
       FD  OUTPUT-DB3T-REPORTE                                                  
           RECORDING MODE IS F                                                  
           BLOCK CONTAINS 0 RECORDS.                                            
                                                                                
       01  OUTPUT-DB3T-REPORTE-REC    PIC X(080).                               
                                                                                
       WORKING-STORAGE SECTION.                                                 
                                                                                
       01  WS-ABEND-CODE                 PIC S9(04) VALUE +0 COMP SYNC.         
       01  WS-SUCCESS-CNT                PIC  9(09) VALUE  0.                   
       01  WS-UNSUCCESS-CNT              PIC  9(09) VALUE  0.                   
       01  WS-INPUT-EOF                  PIC X(01)  VALUE 'N'.                  
       01  WS-BIND-SUCC-STATUS-IND       PIC X(01)  VALUE SPACE.                
       01  WS-BIND-UNSUCC-STATUS-IND     PIC X(01)  VALUE SPACE.                
       01  W-IN-FILE-STATUS              PIC X(02)  VALUE '00'.                 
       01  W-OP1-FILE-STATUS             PIC X(02)  VALUE '00'.                 
       01  W-OP2-FILE-STATUS             PIC X(02)  VALUE '00'.                 
       01  W-OP3-FILE-STATUS             PIC X(02)  VALUE '00'.                 
       01  W-OP4-FILE-STATUS             PIC X(02)  VALUE '00'.                 
                                                                                
       01  WS-INPUT-RECORD.                                                     
           05 W-IP-FILLER                PIC X(01).                             
           05 W-IP-BIND-REASON           PIC X(08).                             
           05 W-IP-FILLER                PIC X(08).                             
           05 W-IP-BIND-STATUS           PIC X(10).                             
           05 W-IP-FILLER                PIC X(106).                            
                                                                                
       01  WS-PREV-INPUT-RECORD.                                                
           05 W-PREV-IP-FILLER           PIC X(01).                             
           05 W-PREV-IP-BIND-REASON      PIC X(08).                             
           05 W-PREV-IP-FILLER           PIC X(08).                             
           05 W-PREV-IP-BIND-STATUS      PIC X(10).                             
           05 W-PREV-IP-FILLER           PIC X(106).                            
                                                                                
       01  WS-INPUT1-RECORD.                                                    
           05 W-IP1-FILLER               PIC X(22).                             
           05 W-IP1-COLL-ID              PIC X(33).                             
           05 W-IP1-FILLER               PIC X(88).                             
                                                                                
                                                                                
       01  WS-PAGE-HEADER1.                                                     
           05  FILLER                          PIC  X(13)  VALUE SPACE.         
           05  FILLER                          PIC  X(30)  VALUE                
                'COTOKEN DB3T BIND STATISTICS'.                                 
                                                                                
       01  WS-PAGE-HEADER2.                                                     
           05  FILLER                          PIC  X(10)  VALUE SPACE.         
           05  FILLER                          PIC  X(60)  VALUE                
                '   ------------------------------------------------'.          
                                                                                
       01  WS-HEADER-LINE1.                                                     
           05 FILLER                           PIC  X(01)  VALUE SPACE.         
           05 FILLER                           PIC  X(12)  VALUE                
               'PACKAGE NAME'.                                                  
           05 FILLER                           PIC  X(02)  VALUE '||'.          
           05 FILLER                           PIC  X(12)  VALUE                
               'PACKAGE MODE'.                                                  
           05 FILLER                           PIC  X(02)  VALUE '||'.          
           05 FILLER                           PIC  X(20)  VALUE                
               'BIND STATUS       ||'.                                          
           05 FILLER                           PIC  X(11)  VALUE                
               'BIND REASON'.                                                   
           05 FILLER                           PIC  X(02)  VALUE SPACE.         
                                                                                
       01  WS-HEADER-LINE2.                                                     
           05 FILLER                           PIC  X(01)  VALUE SPACE.         
           05 FILLER                           PIC  X(24)  VALUE                
               '------------------------'.                                      
           05 FILLER                           PIC  X(02)  VALUE '||'.          
           05 FILLER                           PIC  X(24)  VALUE                
               '------------------------'.                                      
           05 FILLER                           PIC  X(02)  VALUE '||'.          
           05 FILLER                           PIC  X(27)  VALUE                
               '-------------------------||'.                                   
           05 FILLER                           PIC  X(21)  VALUE                
               '---------------------'.                                         
           05 FILLER                           PIC  X(02)  VALUE SPACE.         
                                                                                
       01  WS-RPT-DT-LINE.                                                      
           05 FILLER                           PIC  X(01)  VALUE SPACE.         
           05 WS-RPT-PACKAGE-NAME              PIC  X(08).                      
           05 FILLER                           PIC  X(10)  VALUE SPACE.         
           05 FILLER                           PIC  X(02)  VALUE '||'.          
           05 WS-RPT-PACKAGE-MODE              PIC  X(05).                      
           05 FILLER                           PIC  X(19)  VALUE SPACE.         
           05 FILLER                           PIC  X(02)  VALUE '||'.          
           05 WS-RPT-BIND-STATUS               PIC  X(12).                      
           05 FILLER                           PIC  X(01)  VALUE SPACE.         
           05 FILLER                           PIC  X(02)  VALUE '||'.          
           05 WS-RPT-BIND-REASON               PIC  X(08).                      
           05 FILLER                           PIC  X(02)  VALUE SPACE.         
                                                                                
       01  WS-PAGE-TRAILER1.                                                    
           05  FILLER                          PIC  X(50)  VALUE                
                'SUCCESSFUL      PACKAGES BOUND COUNT:   '.                     
           05  WS-TR-SUCCESS-CNT               PIC  9(09) VALUE  0.             
                                                                                
       01  WS-PAGE-TRAILER2.                                                    
           05  FILLER                          PIC  X(47)  VALUE                
               'UNSUCCESSFUL PACKAGES BOUND COUNT:'.                            
           05  WS-TR-UNSUCCESS-CNT             PIC  9(09) VALUE  0.             
                                                                                
       PROCEDURE DIVISION.                                                      
                                                                                
      *****************************************************************         
      *** OPEN FILES, INITIALIZATIONS, READ THROUGH INPUT FILE,     ***         
      *** CLOSE FILES.                                              ***         
      *****************************************************************         
                                                                                
       0000-PROGRAM-MAINLINE SECTION.                                           
                                                                                
           OPEN INPUT  INPUT-DB3T-BIND-STATS.                                   
                                                                                
           OPEN OUTPUT OUTPUT-DB3T-REPORTH                                      
                       OUTPUT-DB3T-REPORTS                                      
                       OUTPUT-DB3T-REPORTU                                      
                       OUTPUT-DB3T-REPORTE.                                     
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTS-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTS-REC.                                       
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTU-REC.                                        
                                                                                
           PERFORM 1000-PROCESS-PARA                                            
              THRU 1000-EXIT                                                    
              UNTIL  WS-INPUT-EOF = 'Y'.                                        
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           MOVE WS-PAGE-HEADER1                                                 
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           MOVE WS-PAGE-HEADER2                                                 
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE WS-SUCCESS-CNT                                                  
             TO WS-TR-SUCCESS-CNT.                                              
           MOVE WS-PAGE-TRAILER1                                                
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE WS-UNSUCCESS-CNT                                                
             TO WS-TR-UNSUCCESS-CNT.                                            
           MOVE WS-PAGE-TRAILER2                                                
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE WS-HEADER-LINE1                                                 
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           MOVE WS-HEADER-LINE2                                                 
             TO OUTPUT-DB3T-REPORTH-REC.                                        
                                                                                
           WRITE OUTPUT-DB3T-REPORTH-REC.                                       
                                                                                
           MOVE SPACES                                                          
             TO OUTPUT-DB3T-REPORTE-REC.                                        
                                                                                
           IF WS-UNSUCCESS-CNT = 0 AND                                          
              WS-SUCCESS-CNT   = 0                                              
              CONTINUE                                                          
           ELSE                                                                 
              MOVE 'NON-EMPTY FILE'                                             
                TO  OUTPUT-DB3T-REPORTE-REC                                     
              WRITE OUTPUT-DB3T-REPORTE-REC                                     
           END-IF.                                                              
                                                                                
           CLOSE INPUT-DB3T-BIND-STATS                                          
                 OUTPUT-DB3T-REPORTH                                            
                 OUTPUT-DB3T-REPORTS                                            
                 OUTPUT-DB3T-REPORTU                                            
                 OUTPUT-DB3T-REPORTE.                                           
                                                                                
       0000-EXIT.                                                               
           GOBACK.                                                              
                                                                                
                                                                                
      *****************************************************************         
      *** PROCESS THE INPUT FILE                                                
      *****************************************************************         
       1000-PROCESS-PARA.                                                       
                                                                                
           READ INPUT-DB3T-BIND-STATS INTO WS-INPUT-RECORD                      
              AT END                                                            
                  MOVE 'Y'  TO  WS-INPUT-EOF                                    
                  GO TO 1000-EXIT.                                              
                                                                                
                                                                                
           IF WS-BIND-SUCC-STATUS-IND = 'Y'                                     
                                                                                
              MOVE WS-INPUT-RECORD TO WS-INPUT1-RECORD                          
              MOVE W-PREV-IP-BIND-REASON                                        
                TO WS-RPT-BIND-REASON                                           
              MOVE 'SUCCESSFUL'                                                 
                TO WS-RPT-BIND-STATUS                                           
              IF W-IP1-COLL-ID(12:04) = 'BATC'                                  
                 MOVE 'BATCH'                                                   
                   TO WS-RPT-PACKAGE-MODE                                       
                 MOVE W-IP1-COLL-ID(26:8)                                       
                   TO WS-RPT-PACKAGE-NAME                                       
              ELSE                                                              
                 MOVE 'CICS'                                                    
                   TO WS-RPT-PACKAGE-MODE                                       
                 MOVE W-IP1-COLL-ID(25:8)                                       
                   TO WS-RPT-PACKAGE-NAME                                       
              END-IF                                                            
                                                                                
              MOVE WS-RPT-DT-LINE                                               
                TO OUTPUT-DB3T-REPORTS-REC                                      
                                                                                
              WRITE OUTPUT-DB3T-REPORTS-REC                                     
                                                                                
              MOVE SPACES                                                       
                TO WS-BIND-SUCC-STATUS-IND                                      
              MOVE SPACES                                                       
                TO WS-PREV-INPUT-RECORD                                         
                                                                                
           ELSE                                                                 
                                                                                
           IF WS-BIND-UNSUCC-STATUS-IND = 'Y'                                   
                                                                                
              MOVE WS-INPUT-RECORD TO WS-INPUT1-RECORD                          
              MOVE W-PREV-IP-BIND-REASON                                        
                TO WS-RPT-BIND-REASON                                           
              MOVE 'UNSUCCESSFUL'                                               
                TO WS-RPT-BIND-STATUS                                           
              IF W-IP1-COLL-ID(12:04) = 'BATC'                                  
                 MOVE 'BATCH'                                                   
                   TO WS-RPT-PACKAGE-MODE                                       
                 MOVE W-IP1-COLL-ID(26:8)                                       
                   TO WS-RPT-PACKAGE-NAME                                       
              ELSE                                                              
                 MOVE 'CICS'                                                    
                   TO WS-RPT-PACKAGE-MODE                                       
                 MOVE W-IP1-COLL-ID(25:8)                                       
                   TO WS-RPT-PACKAGE-NAME                                       
                                                                                
              MOVE WS-RPT-DT-LINE                                               
                TO OUTPUT-DB3T-REPORTU-REC                                      
                                                                                
              WRITE OUTPUT-DB3T-REPORTU-REC                                     
                                                                                
              MOVE SPACES                                                       
                TO WS-BIND-UNSUCC-STATUS-IND                                    
              MOVE SPACES                                                       
                TO WS-PREV-INPUT-RECORD                                         
              END-IF.                                                           
                                                                                
           IF W-IP-BIND-STATUS = 'SUCCESSFUL'                                   
                                                                                
              MOVE WS-INPUT-RECORD                                              
                TO WS-PREV-INPUT-RECORD                                         
              MOVE 'Y'                                                          
                TO WS-BIND-SUCC-STATUS-IND                                      
               ADD +1                                                           
                TO WS-SUCCESS-CNT                                               
           ELSE                                                                 
                                                                                
           IF W-IP-BIND-STATUS = 'UNSUCCESSF'                                   
                                                                                
              MOVE WS-INPUT-RECORD                                              
                TO WS-PREV-INPUT-RECORD                                         
              MOVE 'Y'                                                          
                TO WS-BIND-UNSUCC-STATUS-IND                                    
               ADD +1                                                           
                TO WS-UNSUCCESS-CNT                                             
                                                                                
           END-IF.                                                              
                                                                                
       1000-EXIT.                                                               
            EXIT.                                                               
                                                                                
      *****************************************************************         
      *** ABEND REPORTING PARA                                      ***         
      *****************************************************************         
       9999-ABEND.                                                              
                                                                                
           CALL 'ILBOABN0' USING WS-ABEND-CODE.                                 
                                                                                
