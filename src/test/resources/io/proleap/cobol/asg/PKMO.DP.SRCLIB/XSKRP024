000100*----------------------------------------------------------       00000100
000200 IDENTIFICATION DIVISION.                                         00000200
000300*----------------------------------------------------------       00000300
000400 PROGRAM-ID.    XSKRP024.                                         00000400
000500 AUTHOR.        JOSEPH MENYAH.                                    00000500
000600 DATE-WRITTEN.  OCTOBER , 2002.                                   00000600
000700                                                                  00000700
000800*----------------------------------------------------------       00000800
000900*            PROMOTION BUSINESS EVENT INTEGRITY CHECK             00000900
001000*----------------------------------------------------------       00001000
001010* THIS PROGRAM WILL PERFORM THE NECESSARY BUSINESS EVENT          00002000
001020* INTEGRITY CHECK FOR THE PROMOTION BSINESS EVENT.                00003000
001124*                                                                 00004000
001125*----------------------------------------------------------       00005000
001126* HISTORY LOG:                                                    00006000
001127*                                                                 00007000
001128*----------------------------------------------------------       00008000
001129* DATE:   08/20/2010                                              00009016
001130* WR/IR#: WR38172                                                 00010016
001131* PROGRAMMER: CHERI PARMLEY                                       00020016
001140* DESCRIPTION: FIXED THE INCORRECT PV-DOMAIN-NF AND               00030016
001140* PV-PROMO-NF REFERENCES.                                         00031016
001150*                                                                 00040000
001160*----------------------------------------------------------       00050000
001170 ENVIRONMENT DIVISION.                                            00060000
001180*----------------------------------------------------------       00070000
001190 CONFIGURATION SECTION.                                           00080000
001200 SOURCE-COMPUTER. IBM-3090.                                       00090000
001300 OBJECT-COMPUTER. IBM-3090.                                       00100000
001400                                                                  00110000
001500 INPUT-OUTPUT SECTION.                                            00120000
001600                                                                  00130000
001700 FILE-CONTROL.                                                    00140000
004900     SELECT CONTROL-CARD                                          00150000
005000         ASSIGN TO INP00.                                         00151000
                                                                        00152000
004900     SELECT PROMO-EXTRACT-FILE                                    00153000
005000         ASSIGN TO INP01.                                         00154000
                                                                        00155000
004900     SELECT DOMAIN-EXTRACT-FILE                                   00156000
005000         ASSIGN TO INP02.                                         00157000
                                                                        00158000
                                                                        00159000
004900     SELECT ERROR-FILE                                            00160000
005000         ASSIGN TO OUT01.                                         00170000
                                                                        00180000
004900     SELECT REPORT-FILE                                           00190000
005000         ASSIGN TO RPT01.                                         00200000
                                                                        00201000
001900*----------------------------------------------------------       00202000
002000 DATA DIVISION.                                                   00203000
002100*----------------------------------------------------------       00204000
002200 FILE SECTION.                                                    00205000
002300                                                                  00206000
008000 FD  PROMO-EXTRACT-FILE                                           00207000
008100     RECORDING MODE IS F                                          00208000
008200     LABEL RECORDS ARE OMITTED                                    00209000
008300     RECORD CONTAINS 250 CHARACTERS                               00210000
008400     DATA RECORD IS PROMO-EVNT-RECORD.                            00220000
008500 01  PROMO-EVNT-REC              PIC X(250).                      00230000
008600                                                                  00240000
008000 FD  DOMAIN-EXTRACT-FILE                                          00250000
008100     RECORDING MODE IS F                                          00260000
008200     LABEL RECORDS ARE OMITTED                                    00270000
008300     RECORD CONTAINS 250 CHARACTERS                               00280000
008400     DATA RECORD IS DOMAIN-EVNT-RECORD.                           00290000
008500 01  DOMAIN-EVNT-REC              PIC X(250).                     00300000
006500                                                                  00310000
       FD  CONTROL-CARD                                                 00320000
           RECORDING MODE F                                             00330000
           BLOCK CONTAINS 0 RECORDS                                     00340000
           LABEL RECORDS ARE OMITTED                                    00350000
           DATA RECORD IS CONTROL-CARD-RECORD.                          00360000
       01  CONTROL-CARD-RECORD             PIC X(080).                  00370000
                                                                        00380000
       FD  REPORT-FILE                                                  00390000
           RECORDING MODE F                                             00400000
           BLOCK CONTAINS 0 RECORDS                                     00401000
           LABEL RECORDS ARE OMITTED                                    00402000
009600     RECORD CONTAINS 132 CHARACTERS                               00403000
           DATA RECORD IS REPORT-RECORD.                                00404000
       01  REPORT-RECORD                   PIC X(132).                  00405000
                                                                        00406000
       FD  ERROR-FILE                                                   00407000
           RECORDING MODE F                                             00408000
           BLOCK CONTAINS 0 RECORDS                                     00409000
           LABEL RECORDS ARE OMITTED                                    00410000
           DATA RECORD IS DIFFERENCES-RECORD.                           00410100
       01  DIFFERENCES-RECORD              PIC X(250).                  00410200
                                                                        00410300
002500*---------------------------------------------------------        00410400
002600                                                                  00410500
002700 WORKING-STORAGE SECTION.                                         00410600
002800*---------------------------------------------------------        00410700
003500* PC- PROGRAM CONSTANTS                                           00410800
003600*----------------------------------------------------------       00410900
003700 01  PC-PROGRAM-CONSTANTS.                                        00411000
003800     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKRP024'. 00412000
003900     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   00413000
004000                                                                  00414000
097700 01  CD-CPU-DATE.                                                 00415000
097800     03  CD-CPU-YEAR             PIC 99.                          00416000
097900     03  CD-CPU-MONTH            PIC 99.                          00417000
098000     03  CD-CPU-DAY              PIC 99.                          00418000
098100                                                                  00419000
098200 01  CD-CPU-DATE-CC.                                              00420000
098300     03  CD-CPU-CENT             PIC 99.                          00430000
098400     03  CD-CPU-YYMMDD           PIC 9(6).                        00440000
                                                                        00450000
084800 01  PC-REPORT-NO                PIC  9(5)          VALUE 00001.  00460000
                                                                        00470000
011200 01  CT-CPU-TIME.                                                 00480000
011300     03  CT-HOUR                 PIC 99.                          00490000
011400     03  CT-MINUTE               PIC 99.                          00500000
011500     03  FILLER                  PIC 9(4).                        00501000
      *----------------------------------------------------------       00501100
      **PROGRAM                                                         00501200
      *----------------------------------------------------------       00501300
       01  PC-PROGRAM-COUNTER.                                          00501400
           05  PC-RECORD-COUNT                 PIC S9(09) VALUE ZEROS   00501500
                                                          COMP-3.       00501600
           05  PC-PROMO-EXTRACT-RECS-READ      PIC 9(09) VALUE ZEROS.   00501700
           05  PC-DOMAIN-EXTRACT-RECS-READ     PIC 9(09) VALUE ZEROS.   00501800
           05  PC-ERROR-RECORD-WRITTEN         PIC 9(09) VALUE ZEROS.   00501900
           05  PC-ERROR-REPORT-WRITTEN         PIC 9(09) VALUE ZEROS.   00502000
           05  PC-PAGE-CNT                     PIC 9(09) VALUE ZEROS.   00503000
004100*----------------------------------------------------------       00504000
004200* PS- PROGRAM SWITCHES                                            00505000
004300*----------------------------------------------------------       00506000
004400 01  PS-PROGRAM-SWITCHES.                                         00507000
004500     05  PS-EOF-PROMO-EXTRACT-SW          PIC X(01)  VALUE SPACE. 00508000
004600         88  PS-EOF-PROMO                        VALUE 'Y'.       00509000
004600         88  PS-NOT-EOF-PROMO                    VALUE 'N'.       00510000
004800                                                                  00520000
004500     05  PS-EOF-DOMAIN-EXTRACT-SW         PIC X(01)  VALUE SPACE. 00530000
004600         88  PS-EOF-DOMAIN                       VALUE 'Y'.       00540000
004600         88  PS-NOT-EOF-DOMAIN                   VALUE 'N'.       00550000
004800                                                                  00560000
004500     05  PS-NEW-RECORD-SW                 PIC X(01)  VALUE SPACE. 00570000
004600         88  PS-NEW-RECORD                       VALUE 'Y'.       00580000
004600         88  PS-NOT-NEW-RECORD                   VALUE 'N'.       00580100
004800                                                                  00580200
004900*----------------------------------------------------------       00580300
      *    CONTROL-CARD-LAYOUT.                                         00580400
004900*----------------------------------------------------------       00580500
       01  CONTROL-CARD-LAYOUT.                                         00580600
           05  CC-START-POINT                  PIC 9(05) VALUE ZEROS.   00580700
           05  FILLER                          PIC X(01) VALUE SPACES.  00580800
           05  CC-READ-FREQUENCY               PIC 9(05) VALUE ZEROS.   00580900
           05  FILLER                          PIC X(69) VALUE SPACES.  00581000
004900*----------------------------------------------------------       00582000
005000* PV- PROGRAM VARIABLES                                           00583000
005100*----------------------------------------------------------       00584000
005200 01 PV-PROGRAM-VARIABLES.                                         00585000
013800    05  ABEND-CODE              PIC S9(4)  VALUE ZEROS COMP SYNC. 00586000
005500    05  PV-SQL-SUB                    PIC S9(4)  VALUE +0 COMP.   00587000
005600    05  PV-MAX-OFFSET-DTE             PIC 9(08)  VALUE 0.         00588000
005710    05  PV-PROMO-ID-HOLD              PIC 9(10) VALUE 0.          00589000
005800    05  PV-ACTION-CODE                PIC X(01).                  00590000
005810        88  PV-INSERT-DATA                       VALUE 'I'.       00600000
005820        88  PV-UPDATE-DATA                       VALUE 'U'.       00610000
                                                                        00620000
006000    05  PV-RECORD-COUNT               PIC 9(05) VALUE ZEROS.      00630000
006000    05  PV-LD-STATUS-CDE              PIC X(02).                  00640000
006100        88  PV-NO-ERROR                          VALUE '00'.      00650000
006200        88  PV-CRITICAL-ERROR                    VALUE '01'.      00660000
006300        88  PV-NOT-CRITICAL-ERROR                VALUE '02'.      00670000
007000                                                                  00680000
           05  PS-ERROR-FOUND-SW               PIC X(01) VALUE 'N'.     00690000
               88  PS-ERROR-FOUND                        VALUE 'Y'.     00700000
               88  PS-ERROR-NOT-FOUND                    VALUE 'N'.     00710000
                                                                        00720000
007100    05  PV-STRT-PARM.                                             00730000
007200        10  PV-STRT-DTE-CC            PIC X(02).                  00740000
007200        10  PV-STRT-DTE-YY            PIC X(02).                  00750000
007400        10  PV-STRT-DTE-MM            PIC X(02).                  00760000
007600        10  PV-STRT-DTE-DD            PIC X(02).                  00770000
007400        10  FILLER                    PIC X.                      00780000
007400        10  PV-DECREMENT              PIC X(02).                  00790000
007400        10  FILLER                    PIC X(69).                  00800000
                                                                        00810000
008600    05  PV-PROMO-KEY.                                             00820000
008700        10  PV-PM-PROMO-ID                PIC 9(10).              00830000
                                                                        00840000
008600    05  PV-DOMAIN-KEY.                                            00850000
008700        10  PV-XS-PROMO-ID                PIC 9(10).              00851000
                                                                        00852000
007700                                                                  00853000
007100    05  PV-PROMO-STRT-DTE           PIC X(10).                    00854000
007100    05  PV-PROMO-END-DTE            PIC X(10).                    00855000
                                                                        00856000
008600    05  PV-AD-EVNT-END-DTE-TM.                                    00857000
008700        10  PV-AD-EVNT-END-DTE.                                   00858000
008800            15  PV-AD-EVNT-DTE-TM2-CCYY   PIC X(04).              00859000
008900            15  FILLER                    PIC X(01).              00860000
009000            15  PV-AD-EVNT-DTE-TM2-MM     PIC X(02).              00870000
009100            15  FILLER                    PIC X(01).              00880000
009200            15  PV-AD-EVNT-DTE-TM2-DD     PIC X(02).              00890000
009300        10  PV-AD-EVNT-END-TM             PIC X(16).              00900000
009400                                                                  00910000
008600    05  PV-PROMO-SOURCE              PIC X(40) VALUE              00920000
              'DATA SOURCE IS THE PROMO DATABASE'.                      00930000
                                                                        00940000
008600    05  PV-PROMO-NF                  PIC X(40) VALUE              00950000
              'RECORD NOT FOUND IN PROMO TABLES'.                       00960013
                                                                        00970000
008600    05  PV-DOMAIN-SOURCE             PIC X(40) VALUE              00980000
              'DATA SOURCE IS THE XS DOMAIN DATABASE'.                  00980100
                                                                        00980200
008600    05  PV-DOMAIN-NF                  PIC X(40) VALUE             00980300
              'RECORD NOT FOUND IN XS DOMAIN   '.                       00980413
                                                                        00980500
                                                                        00980600
000700 01  ERROR-RECORD.                                                00980700
000800   05 ERROR-BUSINESS-EVNT-ID         PIC 9(03) VALUE ZERO.        00980800
000900   05 ERROR-ACTION-CDE               PIC X(01) VALUE SPACES.      00980900
001000   05 ERROR-BUSINESS-EVNT-CRE-TMST   PIC X(26) VALUE SPACES.      00981000
001100   05 ERROR-AD-EVNT-ID               PIC 9(10) VALUE ZERO.        00982000
001200   05 ERROR-AD-EVNT-NBR-TXT          PIC X(15) VALUE SPACES.      00983000
001300   05 ERROR-CPLT-NM                  PIC X(40) VALUE SPACES.      00984000
001400   05 ERROR-STRT-DTE                 PIC X(26) VALUE SPACES.      00985000
001500   05 ERROR-END-DTE                  PIC X(26) VALUE SPACES.      00986000
001600   05 ERROR-STAT-CDE                 PIC X(01) VALUE SPACES.      00987000
001700   05 ERROR-LAST-UPD-TMST            PIC X(26) VALUE SPACES.      00988000
                                                                        00989000
042800     COPY DPWS132O.                                               00990100
042900                                                                  00990200
                                                                        00990300
043100 01  DR-HEAD2.                                                    00990400
043200     05  FILLER                 PIC X(41)    VALUE SPACES.        00990500
043300     05  DR-TITLE               PIC X(55)    VALUE                00990600
043400      'INTEGRITY CHECK PROGRAM  - PROMOTION BUSINESS EVENT'.      00990700
                                                                        00990800
043500                                                                  00990900
043100 01  DR-HEAD3.                                                    00991000
043200     05  FILLER                 PIC X(03)    VALUE                00992000
            'KEY'.                                                      00993000
043200     05  FILLER                 PIC X(15)    VALUE SPACES.        00993100
043200     05  FILLER                 PIC X(10)    VALUE                00993200
            'FIELD NAME'.                                               00993300
043200     05  FILLER                 PIC X(14)    VALUE SPACES.        00993400
043200     05  FILLER                 PIC X(05)    VALUE                00993500
            'VALUE'.                                                    00993600
043200     05  FILLER                 PIC X(31)    VALUE SPACES.        00993700
043200     05  FILLER                 PIC X(16)    VALUE                00993800
            'SOURCE / MESSAGE'.                                         00993900
043200     05  FILLER                 PIC X(35)    VALUE SPACES.        00994000
043500                                                                  00995000
043100 01  DR-HEAD5.                                                    00995100
043200     05  FILLER                 PIC X(132)   VALUE ALL '='.       00995200
000700 01  REPORT-DETAIL.                                               00995300
000800   05 PROMO-RPT-INFO.                                             00995400
000800      10 PROMO-EVNT-KEY.                                          00995500
000800         15 PROMO-EVNT-ID            PIC 9(10) VALUE ZERO.        00995600
 00800      10 FILLER                      PIC X(5).                    00995700
 00800      10 PROMO-RPT-DATA-NAME         PIC X(20).                   00995800
 00800      10 FILLER                      PIC X(2).                    00995900
 00800      10 PROMO-RPT-DATA-VALUE        PIC X(40).                   00996000
000800   05 REPORT-NOTES                   PIC X(40).                   00996100
010900*----------------------------------------------------------       00996200
011000* DOMAIN PROMOTION BUSINESS EVENT RECORD LAYOUT                   00996300
011100*----------------------------------------------------------       00996400
011200     COPY XSRD016.                                                00996500
011800                                                                  00996600
004900*----------------------------------------------------------       00996700
005000* PROMO PROMOTION COPY BOOK                                       00996800
005100*----------------------------------------------------------       00996900
           COPY PMRD702.                                                00997000
011800                                                                  00998000
030310                                                                  00999000
031400*----------------------------------------------------------       01000000
031500 PROCEDURE DIVISION.                                              01010000
032100*----------------------------------------------------------       01020000
032200 0000-MAINLINE.                                                   01030000
128200     ACCEPT CD-CPU-DATE FROM DATE.                                01040000
128300     IF CD-CPU-YEAR > 80                                          01050000
128400         MOVE 19 TO CD-CPU-CENT                                   01060000
128500     ELSE                                                         01070000
128600         MOVE 20 TO CD-CPU-CENT.                                  01080000
128700     MOVE CD-CPU-DATE TO CD-CPU-YYMMDD.                           01090000
128800                                                                  01100000
128900     ACCEPT CT-CPU-TIME FROM TIME.                                01110000
032300                                                                  01120000
032400     PERFORM 1000-INITIALIZATION.                                 01130000
032500                                                                  01140000
032600     PERFORM 2000-PROCESS-EXTRACT-DATA                            01150000
032700             UNTIL PS-EOF-DOMAIN                                  01160000
032700                OR PS-EOF-PROMO.                                  01170000
                                                                        01180000
           PERFORM 3000-PROCESS-EXTRA-RECORDS                           01190000
032700             UNTIL PS-EOF-DOMAIN                                  01200000
032700               AND PS-EOF-PROMO.                                  01210000
035000                                                                  01220000
035100     PERFORM 9999-WRAPUP.                                         01230000
035200                                                                  01240000
035500     GOBACK.                                                      01250000
035700                                                                  01260000
035701*0000-EXIT.                                                       01270000
035702 EJECT.                                                           01280000
035703                                                                  01290000
035800*----------------------------------------------------------       01300000
035900* 1000-INITIALIZATION.                                            01310000
036000*     INTIALIZES OR MOVES ANY VARIABLES BEFORE IT WILL            01320000
036100*     UPDATE OR INSERT A RECORD.                                  01330000
036200*----------------------------------------------------------       01340000
036300 1000-INITIALIZATION.                                             01350000
                                                                        01360000
132408     MOVE CD-CPU-YEAR  TO DP132O-RUN-YEAR.                        01370000
132409     MOVE CD-CPU-MONTH TO DP132O-RUN-MONTH.                       01380000
132410     MOVE CD-CPU-DAY   TO DP132O-RUN-DAY.                         01390000
132420     MOVE CT-HOUR    TO DP132O-RUN-HOUR.                          01400000
132430     MOVE CT-MINUTE  TO DP132O-RUN-MINUTE.                        01410000
132440     MOVE 'XSKRP024' TO DP132O-PROGRAM-NAME.                      01420000
132450     MOVE 1          TO DP132O-REPORT-NUMBER.                     01430000
           SET PS-NOT-EOF-PROMO TO TRUE.                                01440000
           SET PS-NOT-EOF-DOMAIN TO TRUE.                               01450000
026600     OPEN INPUT  PROMO-EXTRACT-FILE                               01460000
026600                 DOMAIN-EXTRACT-FILE                              01470000
026600                 CONTROL-CARD                                     01480000
026600          OUTPUT ERROR-FILE                                       01490000
026600                 REPORT-FILE.                                     01500000
                                                                        01510000
           PERFORM 9999-PRINT-HEADINGS.                                 01520000
           PERFORM 9999-READ-CONTROL-CARD.                              01530000
           PERFORM 9999-READ-PROMO-EXTRACT.                             01540000
           PERFORM 9999-READ-DOMAIN-EXTRACT.                            01550000
                                                                        01560000
           IF XS016-AD-EVNT-ID NOT EQUAL TO PM702-AD-EVNT-ID            01570000
             MOVE 1 TO CC-START-POINT                                   01580000
             MOVE 1 TO CC-READ-FREQUENCY                                01590000
           END-IF.                                                      01600000
                                                                        01610000
           PERFORM 9999-READ-PROMO-EXTRACT CC-START-POINT TIMES.        01620000
           PERFORM 9999-READ-DOMAIN-EXTRACT  CC-START-POINT TIMES.      01630000
                                                                        01640000
056500                                                                  01650000
037240*1100-EXIT.                                                       01660000
037250 EJECT.                                                           01670000
037251                                                                  01680000
037260*----------------------------------------------------------       01690000
037300* 2000-PROCESS-EXTRACT-DATA.                                      01700000
037400*     THIS CHECKS THE ACTION TO SEE WHETHER THE RECORD            01710000
037500*     SHOULD BE INSERTED INTO THE AD EVENT TABLE OR UPDATED.      01720000
037600*     IF SOMETHING IS WRONG WITH THE ACTION CODE IT WILL          01730000
037700*     PROCESS AN ERROR AND EXIT THE PROGRAM.                      01740000
037800*----------------------------------------------------------       01750000
037900 2000-PROCESS-EXTRACT-DATA.                                       01760000
           IF PM702-PROMO-ID = XS016-PROMO-ID                           01770000
                PERFORM 2100-COMPARE-FIELDS                             01780000
                PERFORM 9999-READ-DOMAIN-EXTRACT                        01790000
                        CC-READ-FREQUENCY TIMES                         01800000
                PERFORM 9999-READ-PROMO-EXTRACT                         01810000
                        CC-READ-FREQUENCY TIMES                         01820000
           ELSE                                                         01830000
              IF PM702-PROMO-ID > XS016-PROMO-ID                        01840000
                 MOVE PV-PROMO-NF  TO REPORT-NOTES                      01850014
                 MOVE PV-DOMAIN-KEY TO PROMO-EVNT-KEY                   01860013
                 PERFORM 9999-WRITE-ERROR-REPORT                        01870000
                 MOVE XS016-PROMOTION-RECORD TO ERROR-RECORD            01880000
                 PERFORM 9999-WRITE-ERROR-RECORD                        01890000
                 PERFORM 9999-READ-DOMAIN-EXTRACT                       01900000
              ELSE                                                      01910000
                 MOVE PV-DOMAIN-NF TO REPORT-NOTES                      01920014
                 MOVE PV-PROMO-KEY TO PROMO-EVNT-KEY                    01930013
                 PERFORM 9999-WRITE-ERROR-REPORT                        01940000
                 MOVE PM702-PROMOTION-RECORD TO ERROR-RECORD            01940100
                 PERFORM 9999-WRITE-ERROR-RECORD                        01940200
                 PERFORM 9999-READ-PROMO-EXTRACT                        01940300
              END-IF                                                    01940400
           END-IF.                                                      01940500
038000                                                                  01940600
038110*2000-EXIT.                                                       01940700
038200 EJECT.                                                           01940800
                                                                        01940900
038300*------------------------------------------------------           01941000
038400* 2100-COMPARE-FIELDS.                                            01942000
038500*     COMPARES THE EXTRACT FILES AND NOTES ANY DIFFERENCES        01943000
038600*------------------------------------------------------           01944000
038210                                                                  01945000
054400 2100-COMPARE-FIELDS.                                             01946000
036600     IF PM702-BUSINESS-EVNT-ID NOT EQUAL XS016-BUSINESS-EVNT-ID   01947000
              MOVE 'PM702-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      01948000
              MOVE PM702-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     01949000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             01950000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           01960000
              PERFORM 9999-WRITE-ERROR-REPORT                           01970000
              MOVE 'XS016-BUSINESS-EVNT-ID' TO PROMO-RPT-DATA-NAME      01980000
              MOVE XS016-BUSINESS-EVNT-ID   TO PROMO-RPT-DATA-VALUE     01990000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02000000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02010000
              PERFORM 9999-WRITE-ERROR-REPORT                           02020000
              SET PS-ERROR-FOUND     TO TRUE                            02030000
           END-IF.                                                      02040000
                                                                        02050000
036600     IF PM702-PROMO-ID         NOT EQUAL XS016-PROMO-ID           02060000
              MOVE 'PM702-PRMO-ID'          TO PROMO-RPT-DATA-NAME      02070000
              MOVE PM702-PROMO-ID           TO PROMO-RPT-DATA-VALUE     02080000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02090000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02100000
              PERFORM 9999-WRITE-ERROR-REPORT                           02110000
              MOVE 'XS016-PROMO-ID'         TO PROMO-RPT-DATA-NAME      02120000
              MOVE XS016-PROMO-ID           TO PROMO-RPT-DATA-VALUE     02130000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02140000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02150000
              PERFORM 9999-WRITE-ERROR-REPORT                           02160000
              SET PS-ERROR-FOUND     TO TRUE                            02170000
           END-IF.                                                      02180000
                                                                        02190000
036600     IF PM702-PROMO-TYP-CDE    NOT EQUAL XS016-PROMO-TYP-CDE      02200000
              MOVE 'PM702-PROMO-TYP-CDE'    TO PROMO-RPT-DATA-NAME      02210000
              MOVE PM702-PROMO-TYP-CDE      TO PROMO-RPT-DATA-VALUE     02220000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02230000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02240000
              PERFORM 9999-WRITE-ERROR-REPORT                           02250000
              MOVE 'XS016-PROMO-TYP-CDE'    TO PROMO-RPT-DATA-NAME      02260000
              MOVE XS016-PROMO-TYP-CDE      TO PROMO-RPT-DATA-VALUE     02270000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02280000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02290000
              PERFORM 9999-WRITE-ERROR-REPORT                           02300000
              SET PS-ERROR-FOUND     TO TRUE                            02310000
           END-IF.                                                      02320000
                                                                        02330000
036600     IF PM702-ABBR-NM          NOT EQUAL XS016-ABBR-NM            02340000
              MOVE 'PM702-ABBR-NM'          TO PROMO-RPT-DATA-NAME      02350000
              MOVE PM702-ABBR-NM            TO PROMO-RPT-DATA-VALUE     02360000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02370000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02380000
              PERFORM 9999-WRITE-ERROR-REPORT                           02390000
              MOVE 'XS016-ABBR-NM'          TO PROMO-RPT-DATA-NAME      02400000
              MOVE XS016-ABBR-NM            TO PROMO-RPT-DATA-VALUE     02410000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02420000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02430000
              PERFORM 9999-WRITE-ERROR-REPORT                           02440000
              SET PS-ERROR-FOUND     TO TRUE                            02450000
           END-IF.                                                      02460000
                                                                        02470000
                                                                        02480000
036800     IF PM702-CPLT-NM NOT EQUAL TO XS016-CPLT-NM                  02490000
              MOVE PM702-CPLT-NM           TO PROMO-RPT-DATA-VALUE      02500000
              MOVE 'PROMO-CPLT-NM'             TO PROMO-RPT-DATA-NAME   02510000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02520000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02530000
              PERFORM 9999-WRITE-ERROR-REPORT                           02540000
              MOVE 'XS016-CPLT-NM'             TO PROMO-RPT-DATA-NAME   02550000
              MOVE XS016-CPLT-NM           TO PROMO-RPT-DATA-VALUE      02560000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02561000
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02562000
              PERFORM 9999-WRITE-ERROR-REPORT                           02563000
              DISPLAY 'CPLT-NM OUT OF SYNCH'                            02564000
              SET PS-ERROR-FOUND     TO TRUE                            02565000
           END-IF.                                                      02566000
                                                                        02567000
036800     IF PM702-REG-PROMO-TYP-CDE NOT EQUAL TO                      02568000
                                              XS016-REG-PROMO-TYP-CDE   02569000
              MOVE PM702-REG-PROMO-TYP-CDE TO PROMO-RPT-DATA-VALUE      02569100
              MOVE 'PROMO-REG-PROMO-TYP-CDE'   TO PROMO-RPT-DATA-NAME   02569200
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02569300
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02569400
              PERFORM 9999-WRITE-ERROR-REPORT                           02569500
              MOVE 'XS016-REG-PROMO-TYP-CDE'   TO PROMO-RPT-DATA-NAME   02569600
              MOVE XS016-REG-PROMO-TYP-CDE TO PROMO-RPT-DATA-VALUE      02569700
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02569800
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02569900
              PERFORM 9999-WRITE-ERROR-REPORT                           02570000
              SET PS-ERROR-FOUND     TO TRUE                            02570100
           END-IF.                                                      02570200
                                                                        02570300
036800     IF PM702-SPECIFIC-PROMO-TYP-CDE NOT EQUAL TO                 02570400
                                       XS016-SPECIFIC-PROMO-TYP-CDE     02570500
              MOVE PM702-SPECIFIC-PROMO-TYP-CDE TO                      02570600
                                      PROMO-RPT-DATA-VALUE              02570700
              MOVE 'PROMO-SPECIFIC-PROMO-TYP-CDE' TO                    02570800
                                           PROMO-RPT-DATA-NAME          02570900
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02571000
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02571100
              PERFORM 9999-WRITE-ERROR-REPORT                           02571200
              MOVE 'XS016-SPECIFIC-PROMO-TYP-CDE' TO                    02571300
                                           PROMO-RPT-DATA-NAME          02571400
              MOVE XS016-SPECIFIC-PROMO-TYP-CDE TO                      02571500
                                           PROMO-RPT-DATA-VALUE         02571600
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02571700
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02571800
              PERFORM 9999-WRITE-ERROR-REPORT                           02571900
              SET PS-ERROR-FOUND     TO TRUE                            02572000
           END-IF.                                                      02572100
                                                                        02572200
036900     IF PM702-STRT-TMST   NOT EQUAL TO XS016-STRT-TMST            02572300
              MOVE 'PROMO-STRT-TMST'       TO PROMO-RPT-DATA-NAME       02572400
              MOVE PM702-STRT-TMST         TO PROMO-RPT-DATA-VALUE      02572500
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02572600
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02572700
              PERFORM 9999-WRITE-ERROR-REPORT                           02572800
              MOVE 'XS016-STRT-TMST'       TO PROMO-RPT-DATA-NAME       02572900
              MOVE XS016-STRT-TMST         TO PROMO-RPT-DATA-VALUE      02573000
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02573100
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02573200
              PERFORM 9999-WRITE-ERROR-REPORT                           02573300
              SET PS-ERROR-FOUND     TO TRUE                            02573400
           END-IF.                                                      02573500
                                                                        02573600
037000     IF PM702-END-TMST   NOT EQUAL TO XS016-END-TMST              02573700
              MOVE 'PROMO-END-TMST'       TO PROMO-RPT-DATA-NAME        02573800
              MOVE PM702-END-TMST         TO PROMO-RPT-DATA-VALUE       02573900
              MOVE PV-PROMO-SOURCE         TO REPORT-NOTES              02574000
              PERFORM 9999-WRITE-ERROR-REPORT                           02574100
              MOVE 'XS016-END-TMST'       TO PROMO-RPT-DATA-NAME        02574200
              MOVE XS016-END-TMST         TO PROMO-RPT-DATA-VALUE       02574300
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02574400
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02574500
              PERFORM 9999-WRITE-ERROR-REPORT                           02574600
              SET PS-ERROR-FOUND     TO TRUE                            02574700
           END-IF.                                                      02574800
                                                                        02574900
037000     IF PM702-ACT-STRT-TMST   NOT EQUAL TO XS016-ACT-STRT-TMST    02575000
              MOVE 'PROMO-ACT-STRT-TMST'  TO PROMO-RPT-DATA-NAME        02575100
              MOVE PM702-ACT-STRT-TMST    TO PROMO-RPT-DATA-VALUE       02575200
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02575300
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02575400
              PERFORM 9999-WRITE-ERROR-REPORT                           02575500
              MOVE 'XS016-ACT-STRT-TMST'  TO PROMO-RPT-DATA-NAME        02575600
              MOVE XS016-ACT-STRT-TMST    TO PROMO-RPT-DATA-VALUE       02575700
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02575800
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02575900
              PERFORM 9999-WRITE-ERROR-REPORT                           02576000
              SET PS-ERROR-FOUND     TO TRUE                            02576100
           END-IF.                                                      02576200
                                                                        02576300
037000     IF PM702-ACT-END-TMST   NOT EQUAL TO XS016-ACT-END-TMST      02576400
              MOVE 'PROMO-ACT-END-TMST'  TO PROMO-RPT-DATA-NAME         02576500
              MOVE PM702-ACT-END-TMST    TO PROMO-RPT-DATA-VALUE        02576600
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02576700
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02576800
              PERFORM 9999-WRITE-ERROR-REPORT                           02576900
              MOVE 'XS016-ACT-END-TMST'  TO PROMO-RPT-DATA-NAME         02577000
              MOVE XS016-ACT-END-TMST    TO PROMO-RPT-DATA-VALUE        02577100
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02577200
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02577300
              PERFORM 9999-WRITE-ERROR-REPORT                           02577400
              SET PS-ERROR-FOUND     TO TRUE                            02577500
           END-IF.                                                      02577600
                                                                        02577700
037000     IF PM702-ESL-TOPR-TYP   NOT EQUAL TO XS016-ESL-TOPR-TYP      02577800
              MOVE 'PROMO-ESL-TOPR-TYP'  TO PROMO-RPT-DATA-NAME         02577900
              MOVE PM702-ESL-TOPR-TYP    TO PROMO-RPT-DATA-VALUE        02578000
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02578100
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02578200
              PERFORM 9999-WRITE-ERROR-REPORT                           02578300
              MOVE 'XS016-ESL-TOPR-TYP'  TO PROMO-RPT-DATA-NAME         02578400
              MOVE XS016-ESL-TOPR-TYP    TO PROMO-RPT-DATA-VALUE        02578500
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02578600
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02578700
              PERFORM 9999-WRITE-ERROR-REPORT                           02578800
              SET PS-ERROR-FOUND     TO TRUE                            02578900
           END-IF.                                                      02579000
                                                                        02580000
037100     IF PM702-STAT-CDE NOT EQUAL TO XS016-STAT-CDE                02580100
              MOVE 'PROMO-STAT-CDE'           TO PROMO-RPT-DATA-NAME    02580200
              MOVE PM702-STAT-CDE         TO PROMO-RPT-DATA-VALUE       02580300
              MOVE PV-PROMO-SOURCE          TO REPORT-NOTES             02580400
              MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY           02580500
              PERFORM 9999-WRITE-ERROR-REPORT                           02580600
              MOVE 'XS016-STAT-CDE'       TO PROMO-RPT-DATA-NAME        02580700
              MOVE XS016-STAT-CDE         TO PROMO-RPT-DATA-VALUE       02580800
              MOVE PV-DOMAIN-SOURCE         TO REPORT-NOTES             02580900
              MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY           02581000
              PERFORM 9999-WRITE-ERROR-REPORT                           02581100
              SET PS-ERROR-FOUND     TO TRUE                            02581200
           END-IF.                                                      02581300
                                                                        02581400
           IF  PS-ERROR-FOUND                                           02581500
037200        IF PM702-LAST-UPD-TMST > XS016-LAST-UPD-TMST              02581600
                 PERFORM 9999-FORMAT-ERROR-RECORD                       02581700
                 PERFORM 9999-WRITE-ERROR-RECORD                        02581800
                 SET PS-ERROR-NOT-FOUND     TO TRUE                     02581900
              END-IF                                                    02582000
           END-IF.                                                      02583000
054500                                                                  02583100
056900 2100-EXIT.                                                       02583200
057000     EXIT.                                                        02583300
043600 EJECT.                                                           02583400
043610                                                                  02583500
                                                                        02583600
      ******************************************************************02583700
      **COMPARES FIELDS BETWEEN FILES TO SEE IF ANY DIFFERENCES EXIST   02583800
      ******************************************************************02583900
       3000-PROCESS-EXTRA-RECORDS.                                      02584000
                                                                        02585000
           IF  PS-NOT-EOF-PROMO                                         02586000
               INITIALIZE REPORT-DETAIL                                 02587000
               MOVE PV-DOMAIN-NF            TO REPORT-NOTES             02588015
               MOVE PV-PROMO-KEY             TO PROMO-EVNT-KEY          02589015
               PERFORM 9999-WRITE-ERROR-REPORT                          02590000
               MOVE PM702-PROMOTION-RECORD TO ERROR-RECORD              02600000
               PERFORM 9999-WRITE-ERROR-RECORD                          02610000
               PERFORM 9999-READ-PROMO-EXTRACT                          02620000
           END-IF.                                                      02630000
                                                                        02640000
           IF  PS-NOT-EOF-DOMAIN                                        02650000
               INITIALIZE REPORT-DETAIL                                 02660000
               MOVE PV-PROMO-NF              TO REPORT-NOTES            02670015
               MOVE PV-DOMAIN-KEY            TO PROMO-EVNT-KEY          02680015
               PERFORM 9999-WRITE-ERROR-REPORT                          02690000
               MOVE XS016-PROMOTION-RECORD TO ERROR-RECORD              02700000
               PERFORM 9999-WRITE-ERROR-RECORD                          02710000
               PERFORM 9999-READ-DOMAIN-EXTRACT                         02720000
           END-IF.                                                      02730000
                                                                        02740000
056900 3000-EXIT.                                                       02750000
057000     EXIT.                                                        02760000
                                                                        02770000
       EJECT.                                                           02780000
059800*----------------------------------------------------------       02790000
059900* 9999-WRAPUP.                                                    02800000
059910*     MOVES ALL ERROR CODES TO THE LINKAGE VARIABLES TO           02810000
059920*     BE PASSED BACK TO THE CALLING PROGRAM.  EXITS THE           02820000
059930*     PROGRAM.                                                    02830000
060000*----------------------------------------------------------       02840000
060100 9999-WRAPUP.                                                     02850000
026600     CLOSE PROMO-EXTRACT-FILE                                     02860000
026600           DOMAIN-EXTRACT-FILE                                    02870000
026600           ERROR-FILE                                             02880000
026600           REPORT-FILE.                                           02890000
           IF  PC-ERROR-RECORD-WRITTEN > 0                              02900000
               MOVE 04               TO RETURN-CODE                     02910000
           END-IF.                                                      02920000
                                                                        02930000
                                                                        02940000
                                                                        02950000
060500                                                                  02960000
060710*9999-EXIT.                                                       02970000
060800 EJECT.                                                           02980000
      ***************************************************************** 02990000
      **FORMAT ERROR-RECORD                                             03000000
      ***************************************************************** 03010000
       9999-FORMAT-ERROR-RECORD.                                        03020000
           MOVE PM702-PROMOTION-RECORD TO ERROR-RECORD.                 03030000
                                                                        03040000
       EJECT.                                                           03050000
      ***************************************************************** 03060000
      **READ PROMO  EXTRACT FILE                                        03070000
      ***************************************************************** 03080000
       9999-READ-PROMO-EXTRACT.                                         03090000
           IF  PS-NOT-EOF-PROMO                                         03100000
               READ PROMO-EXTRACT-FILE INTO PM702-PROMOTION-RECORD      03110000
                    AT END                                              03120000
                       SET PS-EOF-PROMO TO TRUE                         03130000
               END-READ                                                 03140000
           END-IF.                                                      03150000
                                                                        03160000
           IF  PS-NOT-EOF-PROMO                                         03170000
               ADD +1                  TO PC-PROMO-EXTRACT-RECS-READ    03180000
               MOVE PM702-PROMO-ID TO PV-PM-PROMO-ID                    03190000
           END-IF.                                                      03200000
                                                                        03210000
       EJECT.                                                           03220000
      ***************************************************************** 03230000
      **READ XS EXTRACT FILE                                            03240000
      ***************************************************************** 03250000
       9999-READ-DOMAIN-EXTRACT.                                        03260000
           IF  PS-NOT-EOF-DOMAIN                                        03270000
               READ DOMAIN-EXTRACT-FILE INTO XS016-PROMOTION-RECORD     03280000
                    AT END                                              03290000
                       SET PS-EOF-DOMAIN TO TRUE                        03300000
               END-READ                                                 03310000
           END-IF.                                                      03320000
                                                                        03330000
           IF  PS-NOT-EOF-DOMAIN                                        03340000
               ADD +1              TO PC-DOMAIN-EXTRACT-RECS-READ       03350000
               MOVE XS016-PROMO-ID TO  PV-XS-PROMO-ID                   03360000
           END-IF.                                                      03370000
                                                                        03380000
       EJECT.                                                           03390000
      ***************************************************************** 03400000
      **READ CONTROL CARD FOR FREQUENCY OF COMPARE                      03410000
      ***************************************************************** 03420000
       9999-READ-CONTROL-CARD.                                          03430000
                                                                        03440000
           READ CONTROL-CARD INTO CONTROL-CARD-LAYOUT.                  03450000
                                                                        03460000
       EJECT.                                                           03470000
      ***************************************************************** 03480000
      **WRITE ERROR RECORD                                              03490000
      ***************************************************************** 03500000
       9999-WRITE-ERROR-RECORD.                                         03510000
                                                                        03520000
           WRITE DIFFERENCES-RECORD FROM ERROR-RECORD.                  03530000
                                                                        03540000
           ADD +1                       TO PC-ERROR-RECORD-WRITTEN.     03550000
                                                                        03560000
       EJECT.                                                           03570000
      ***************************************************************** 03580000
      **WRITE ERROR REPORT                                              03590000
      ***************************************************************** 03600000
       9999-WRITE-ERROR-REPORT.                                         03610000
           IF PC-ERROR-REPORT-WRITTEN > 66                              03620000
              PERFORM 9999-PRINT-HEADINGS                               03630000
           ELSE                                                         03640000
              WRITE REPORT-RECORD FROM REPORT-DETAIL                    03650000
              INITIALIZE REPORT-DETAIL                                  03660000
              ADD +1 TO PC-ERROR-REPORT-WRITTEN                         03670000
           END-IF.                                                      03680000
                                                                        03690000
       EJECT.                                                           03700000
      ***************************************************************** 03710000
      **PRINT HEADINGS                                                  03720000
      ***************************************************************** 03730000
       9999-PRINT-HEADINGS.                                             03740000
           ADD 1 TO PC-PAGE-CNT.                                        03750000
           MOVE PC-PAGE-CNT TO DP132O-PAGE-NUMBER.                      03760000
           MOVE ZEROS TO PC-ERROR-REPORT-WRITTEN.                       03770000
491700     WRITE REPORT-RECORD                                          03780000
491800         FROM DP132O-STANDRD-HEADER-132-COLS                      03790000
491900         AFTER ADVANCING PAGE.                                    03800000
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     03810000
                                                                        03820000
491700     WRITE REPORT-RECORD                                          03830000
491800         FROM DR-HEAD2                                            03840000
491900         AFTER ADVANCING 1 LINE.                                  03850000
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     03860000
                                                                        03870000
491700     WRITE REPORT-RECORD                                          03880000
491800         FROM DR-HEAD3                                            03890000
491900         AFTER ADVANCING 2 LINE.                                  03900000
           ADD +2                       TO PC-ERROR-REPORT-WRITTEN.     03910000
                                                                        03920000
491700     WRITE REPORT-RECORD                                          03930000
491800         FROM DR-HEAD5                                            03931000
491900         AFTER ADVANCING 1 LINE.                                  03932000
                                                                        03933000
           ADD +1                       TO PC-ERROR-REPORT-WRITTEN.     03934000
                                                                        03935000
       EJECT.                                                           03936000
