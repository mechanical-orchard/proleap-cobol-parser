000100*************************                                         00010020
000200 IDENTIFICATION DIVISION.                                         00020020
000300*************************                                         00030020
000400 PROGRAM-ID.      MRKRP117.                                       00040020
000500 AUTHOR.          ANNE KINTOPF.                                   00050020
000600 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00060020
000700 DATE-WRITTEN.    06/04/01.                                       00070030
000800 DATE-COMPILED.                                                   00080020
000900******************************************************************00090020
001000* THIS PROGRAM WILL CREATE A REPORT TO DETERMINE WHETHER INFOREM *00100020
001100* IS PERFORMING AS DESIRED FOR E-COMMERCE ITEMS                  *00110020
001200******************************************************************00120020
001300*                                                                 00130026
001310* CHANGED 10/22/2001 BY NICK MOULTON    WR#21601                  00140026
001320*   UPDATES FOR NI-SKU:                                           00150026
001330*     - ADDED ACCESS TO TSKXREF WHEN NECESSARY.                   00160029
001340*     - CHANGED REPORT TO REFLECT INCREASED FIELD SIZES.          00170026
002600*                                                                 00171029
003100******************************************************************00171129
002600*                                                                 00171229
002700* CHANGED 07/25/2002 BY LINDA FRIESS    PITS# PM00482645          00172029
002800*   ADDED VSAM STATUS CODE 97 (VERIFY) AS ACCEPTABLE FOR          00173029
002800*   EXCEPTION FILE & BIM FILE.                                    00174029
001350******************************************************************00180026
002700* CHANGED 07/15/2004 BY BOB FORD          WR# 26363               00181036
002800*   CHANGED PROGRAM TO HANDLE 5 DIGIT STORE AS PART OF STORE      00182036
002800*   NUMBER EXPANSION.  CHANGED CURSORS AND SELECTS TO USE XMT_LOC 00183036
002800*   INSTEAD OF TSTR000.  CHANGED TO USE MHT_DLY_SLS FOR SALES INFO00183136
002800*   INSTEAD OF TSKSTWKS.                                          00183236
001350******************************************************************00184035
001400                                                                  00190020
001500 ENVIRONMENT DIVISION.                                            00200020
001600                                                                  00210020
001700 CONFIGURATION SECTION.                                           00220020
001800 SOURCE-COMPUTER. IBM-3090.                                       00230020
001900 OBJECT-COMPUTER. IBM-3090.                                       00240020
002000                                                                  00250020
002100 INPUT-OUTPUT SECTION.                                            00260020
002200 FILE-CONTROL.                                                    00270020
002300                                                                  00280020
002400     SELECT EXCEPTION-FILE     ORGANIZATION IS INDEXED            00290020
002500                               ACCESS       IS RANDOM             00300020
002600                               RECORD KEY   IS EXCEPTION-KEY      00310020
002700                               ASSIGN       TO INP01              00320020
002800                               FILE STATUS  IS SC-EXCEPT-STATUS.  00330020
002900                                                                  00340020
003000     SELECT BIM-FILE           ASSIGN       TO INP02              00350020
003100                               ORGANIZATION IS INDEXED            00360020
003200                               ACCESS       IS RANDOM             00370020
003300                               RECORD KEY   IS BIM-FILE-KEY       00380020
003400                               FILE STATUS  IS SC-BIM-STATUS.     00390020
003500                                                                  00400020
003600     SELECT PRINT-REPORT       ASSIGN       TO RPT01.             00410020
003700                                                                  00420020
003800     EJECT                                                        00430020
003900                                                                  00440020
004000***************                                                   00450020
004100 DATA DIVISION.                                                   00460020
004200***************                                                   00470020
004300                                                                  00480020
004400 FILE SECTION.                                                    00490020
004500                                                                  00500020
004600 FD  EXCEPTION-FILE.                                              00510020
004700                                                                  00520020
004800 01  EXCEPTION-REC.                                               00530020
004900     05  EXCEPTION-KEY               PIC  X(4).                   00540021
005000     05  EXCEPTION-KEY-NBR  REDEFINES                             00550021
005100         EXCEPTION-KEY               PIC  9(4).                   00560021
005200     05  FILLER                      PIC  X(76).                  00570021
005300                                                                  00580020
005400 FD  BIM-FILE.                                                    00590020
005500                                                                  00600020
005600 01  BIM-REC.                                                     00610020
005700     05  BIM-FILE-KEY                 PIC  X(07).                 00620020
005800     05  FILLER                       PIC  X(228).                00630020
005900                                                                  00640020
006000 FD  PRINT-REPORT                                                 00650020
006100     LABEL RECORDS ARE STANDARD                                   00660020
006200     RECORDING MODE IS F                                          00670020
006300     BLOCK CONTAINS 0 RECORDS.                                    00680020
006400                                                                  00690020
006500 01  PRINT-LINE                       PIC  X(132).                00700020
006600                                                                  00710020
006700 WORKING-STORAGE SECTION.                                         00720020
006800                                                                  00730020
006900 01  FILLER.                                                      00740020
007000     05  FILLER                       PIC  X(36)     VALUE        00750020
007100        ' ***** WORKING STORAGE PGM=MRKRP117 '.                   00760020
007200     05  FILLER                       PIC  X(10)     VALUE        00770020
007300         ' LOCATION='.                                            00780020
007400     05  PGM-LOCATION                 PIC  X(05)     VALUE SPACE. 00790020
007500     05  FILLER                       PIC  X(06)     VALUE        00800020
007600         ' *****'.                                                00810020
007700 EJECT                                                            00820020
007800                                                                  00830020
007900****************************************************************  00840020
008000** STANDARD HEADER LINE - KOHLS 132 COL                           00850020
008100****************************************************************  00860020
008200     COPY DPWS132.                                                00870020
008300                                                                  00880020
008400*---------------------------------------------------------------* 00890020
008500*   COPYBOOK FOR DATE MODULE                                      00900020
008600*---------------------------------------------------------------* 00910020
008700     COPY DPWS500.                                                00920020
008800*                                                                 00930020
008900 01  CT-CPU-TIME.                                                 00940020
009000     05  CT-CPU-HR                    PIC 9(2)       VALUE ZEROS. 00950020
009100     05  CT-CPU-MIN                   PIC 9(2)       VALUE ZEROS. 00960020
009200     05  CT-CPU-SEC                   PIC 9(2)       VALUE ZEROS. 00970020
009300     05  CT-CPU-HSEC                  PIC 9(2)       VALUE ZEROS. 00980020
009400                                                                  00990020
009500 01  CD-SCHEDULE-DATE                 PIC X(10).                  01000020
009600 01  CD-DATE REDEFINES CD-SCHEDULE-DATE.                          01010020
009700     05  CD-YEAR                      PIC 9(4).                   01020020
009800     05  FILLER                       PIC X.                      01030020
009900     05  CD-MONTH                     PIC 99.                     01040020
010000     05  FILLER                       PIC X.                      01050020
010100     05  CD-DAY                       PIC 99.                     01060020
010200                                                                  01070020
010300 01  END-OF-REPORT-LINE.                                          01080020
010400     05  FILLER                       PIC X(25)      VALUE        01090020
010500         ' ** END OF REPORT **     '.                             01100020
010600                                                                  01110020
010700 01  HL-HEADING-BLANK.                                            01120020
010800     05  FILLER                       PIC X(132)     VALUE SPACE. 01130020
010900                                                                  01140020
011000 01  HL-HEADING-LINE1.                                            01150020
011100     05  FILLER                       PIC X(50)      VALUE SPACE. 01160020
011200     05  FILLER                       PIC X(23)      VALUE        01170020
011300         'FORECAST VS. ACTUAL  - '.                               01180020
011400     05  FILLER                       PIC X(10)      VALUE        01190020
011500         '02 SYSTEM '.                                            01200020
011600     05  FILLER                       PIC X(49)      VALUE SPACE. 01210020
011700                                                                  01220020
011800 01  DETAIL-LINE1.                                                01230020
011900     05  FILLER                       PIC X(12)      VALUE        01240021
012000         '        DPT:'.                                          01250021
012100     05  DL1-DEPARTMENT               PIC ZZZ9.                   01260021
012200     05  FILLER                       PIC X(03)      VALUE SPACES.01270027
012300     05  DL1-MCL-TITLE                PIC X(04)      VALUE SPACES.01280027
012400     05  DL1-MCL                      PIC X(04)      VALUE SPACES.01290027
012500     05  DL1-MCL-94 REDEFINES DL1-MCL PIC ZZZ9.                   01300021
012600     05  FILLER                       PIC X(03)      VALUE SPACES.01310027
012700     05  DL1-SCL-TITLE                PIC X(04)      VALUE SPACES.01320027
012800     05  DL1-SCL                      PIC X(04)      VALUE SPACES.01330027
012900     05  DL1-SCL-94 REDEFINES DL1-SCL PIC ZZZ9.                   01340021
013000     05  FILLER                       PIC X(94)      VALUE SPACES.01350027
013100                                                                  01360020
013200 01  DETAIL-LINE2.                                                01370020
013300     05  DL2-RPT-LVL                  PIC X(12).                  01380021
013400     05  DL2-DATA.                                                01390021
013500         10  FILLER                   PIC X(01)      VALUE SPACE. 01400021
013600         10  DL2-RPT-LVL-DATA         PIC X(40)      VALUE SPACES.01410021
013700     05  DL2-DATA-NUM REDEFINES DL2-DATA.                         01420021
013800         10  DL2-RPT-LVL-DATA-94      PIC ZZZ9.                   01430021
013900         10  FILLER                   PIC X(37).                  01440021
014000     05  FILLER                       PIC X(10)      VALUE        01450020
014100         ' MAX LT:  '.                                            01460020
014200     05  DL2-LEAD-TIME                PIC X(03).                  01470020
014300     05  FILLER                       PIC X(20)      VALUE        01480020
014400         '      AVG. OSTRAT:  '.                                  01490020
014500     05  DL2-AVG-OSTRAT               PIC ZZ9.9.                  01500020
014600     05  FILLER                       PIC X(41)      VALUE SPACE. 01510021
014700                                                                  01520020
014800 01  DETAIL-LINE3.                                                01530020
014900     05  FILLER                       PIC X(13)      VALUE        01540020
015000         '    ONORDER: '.                                         01550020
015100     05  DL3-ONORDER                  PIC ZZZZZZ9.                01560020
015200     05  FILLER                       PIC X(20)      VALUE        01570020
015300         '              WOS:  '.                                  01580020
015400     05  DL3-WOS-ONHAND               PIC X(03).                  01590020
015500     05  FILLER                       PIC X(19)      VALUE        01600020
015600         '    WEEKS ONORDER: '.                                   01610020
015700     05  DL3-WOS-ONORDER              PIC X(03).                  01620020
015800     05  FILLER                       PIC X(24)      VALUE        01630020
015900         '     WOS ABOVE CSTOCK:  '.                              01640020
016000     05  DL3-WOS-CSTOCK               PIC X(03).                  01650020
016100     05  FILLER                       PIC X(20)      VALUE        01660020
016200         '          % CSTOCK: '.                                  01670020
016300     05  DL3-PCNT-CSTOCK              PIC ZZ9.                    01680020
016400     05  FILLER                       PIC X(15)      VALUE SPACE. 01690020
016500                                                                  01700020
016600 01  DETAIL-LINE4.                                                01710020
016700     05  FILLER                       PIC X(32)      VALUE SPACE. 01720020
016800     05  FILLER                       PIC X(50)      VALUE        01730020
016900         'LAST 4 WEEKS                     4 WEEK   CURRENT '.    01740020
017000     05  FILLER                       PIC X(50)      VALUE        01750020
017100         '                FORECAST NEXT 5 WEEKS             '.    01760020
017200                                                                  01770020
017300 01  DETAIL-LINE5.                                                01780020
017400     05  FILLER                       PIC X(25)      VALUE        01790020
017500         '                    WEEK '.                             01800020
017600     05  DL5-LAST-WEEK-1              PIC 9(2).                   01810020
017700     05  FILLER                       PIC X(9)       VALUE        01820020
017800         '    WEEK '.                                             01830020
017900     05  DL5-LAST-WEEK-2              PIC 9(2).                   01840020
018000     05  FILLER                       PIC X(9)       VALUE        01850020
018100         '    WEEK '.                                             01860020
018200     05  DL5-LAST-WEEK-3              PIC 9(2).                   01870020
018300     05  FILLER                       PIC X(9)       VALUE        01880020
018400         '    WEEK '.                                             01890020
018500     05  DL5-LAST-WEEK-4              PIC 9(2).                   01900020
018600     05  FILLER                       PIC X(12)      VALUE        01910020
018700         '      TOTAL '.                                          01920020
018800     05  FILLER                       PIC X(7)       VALUE        01930020
018900         '  WEEK '.                                               01940020
019000     05  DL5-CURRENT-WEEK             PIC 9(2).                   01950020
019100     05  FILLER                       PIC X(9)       VALUE        01960020
019200         '   WEEK '.                                              01970020
019300     05  DL5-FRCST-WEEK-1             PIC 9(2).                   01980020
019400     05  FILLER                       PIC X(8)       VALUE        01990020
019500         '   WEEK '.                                              02000020
019600     05  DL5-FRCST-WEEK-2             PIC 9(2).                   02010020
019700     05  FILLER                       PIC X(8)       VALUE        02020020
019800         '   WEEK '.                                              02030020
019900     05  DL5-FRCST-WEEK-3             PIC 9(2).                   02040020
020000     05  FILLER                       PIC X(8)       VALUE        02050020
020100         '   WEEK '.                                              02060020
020200     05  DL5-FRCST-WEEK-4             PIC 9(2).                   02070020
020300     05  FILLER                       PIC X(8)       VALUE        02080020
020400         '   WEEK '.                                              02090020
020500     05  DL5-FRCST-WEEK-5             PIC 9(2).                   02100020
020600                                                                  02110020
020700 01  DETAIL-LINE6.                                                02120020
020800     05  FILLER                       PIC X(18)      VALUE        02130020
020900         'DD                '.                                    02140020
021000     05  DL6-DD-WEEK-TABLE            OCCURS 4 TIMES.             02150020
021100         10  DL6-DD                   PIC Z,ZZZ,ZZ9.              02160020
021200         10  FILLER                   PIC X(2)       VALUE SPACE. 02170020
021300     05  FILLER                       PIC X(10)      VALUE SPACE. 02180020
021400     05  DL6-DD-CURR                  PIC Z,ZZZ,ZZ9.              02190020
021500     05  FILLER                       PIC X(51)      VALUE SPACE. 02200020
021600                                                                  02210020
021700 01  DETAIL-LINE7.                                                02220020
021800     05  FILLER                       PIC X(18)      VALUE        02230020
021900         'FORECAST          '.                                    02240020
022000     05  DL7-HIST-FRCST-TABLE         OCCURS 4 TIMES.             02250020
022100         10  DL7-HIST-FRCST           PIC Z,ZZZ,ZZ9.              02260020
022200         10  FILLER                   PIC X(2)       VALUE SPACE. 02270020
022300     05  DL7-CUMM-FRCST               PIC Z,ZZZ,ZZ9.              02280020
022400     05  FILLER                       PIC X(1)       VALUE SPACE. 02290020
022500     05  DL7-CURRENT-FRCST            PIC Z,ZZZ,ZZ9.              02300020
022600     05  FILLER                       PIC X(1)       VALUE SPACE. 02310020
022700     05  DL7-FUTURE-FRCST-TABLE              OCCURS 5 TIMES.      02320020
022800         10  FILLER                   PIC X(1)       VALUE SPACE. 02330020
022900         10  DL7-FUTURE-FRCST         PIC Z,ZZZ,ZZ9.              02340020
023000                                                                  02350020
023100 01  DETAIL-LINE8.                                                02360020
023200     05  FILLER                       PIC X(18)      VALUE        02370020
023300         'ACTUAL SALES      '.                                    02380020
023400     05  DL8-SALES-TABLE                      OCCURS 4 TIMES.     02390020
023500         10  DL8-SALES                PIC Z,ZZZ,ZZ9.              02400020
023600         10  FILLER                   PIC X(2)       VALUE SPACE. 02410020
023700     05  DL8-CUMM-SALES               PIC Z,ZZZ,ZZ9.              02420020
023800     05  FILLER                       PIC X(61)      VALUE SPACE. 02430020
023900                                                                  02440020
024000 01  DETAIL-LINE9.                                                02450020
024100     05  FILLER                       PIC X(22)      VALUE        02460020
024200         '% DIFFERENCES    '.                                     02470020
024300     05  DL9-DIFFERENCE-TABLE                 OCCURS 4 TIMES.     02480020
024400         10  DL9-DIFFRNC-N            PIC ---9.                   02490020
024500         10  DL9-DIFFRNC-ALPHA REDEFINES DL9-DIFFRNC-N.           02500020
024600             15  DL9-DIFFRNC          PIC X(4).                   02510020
024700         10  FILLER                   PIC X(7)                    02520020
024800                                      VALUE '%      '.            02530020
024900     05  DL9-CUMM-DIFFRNC             PIC ---9.                   02540020
025000     05  FILLER                       PIC X(1)       VALUE '%'.   02550020
025100     05  FILLER                       PIC X(60)      VALUE SPACE. 02560020
025200                                                                  02570020
025300                                                                  02580020
025400 01  DETAIL-LINE10.                                               02590020
025500     05  FILLER                       PIC X(18)      VALUE        02600020
025600         'ONHAND            '.                                    02610020
025700     05  DL10-ONHAND-TABLE                     OCCURS 4 TIMES.    02620020
025800         10  DL10-OH-HIST             PIC Z,ZZZ,ZZ9.              02630020
025900         10  FILLER                   PIC X(2)       VALUE SPACE. 02640020
026000     05  FILLER                       PIC X(10)      VALUE SPACE. 02650020
026100     05  DL10-ONHAND                  PIC Z,ZZZ,ZZ9.              02660020
026200     05  FILLER                       PIC X(51)      VALUE SPACE. 02670020
026300                                                                  02680020
026400 01  DETAIL-LINE11.                                               02690020
026500     05  FILLER                       PIC X(18)      VALUE        02700020
026600         'CSTOCK            '.                                    02710020
026700     05  FILLER                       PIC X(54)      VALUE SPACE. 02720020
026800     05  DL11-CSTOCK                  PIC Z,ZZZ,ZZ9.              02730020
026900     05  FILLER                       PIC X(51)      VALUE SPACE. 02740020
027000                                                                  02750020
027100 01  PROGRAM-CONSTANTS.                                           02760020
027200     05  PC-ROW-NOT-FOUND             PIC S9(04)     VALUE +100   02770020
027300                                                     COMP SYNC.   02780020
027400     05  PC-ONE                       PIC S9(2)      VALUE +1.    02790020
027500     05  PC-TWO                       PIC S9(2)      VALUE +2.    02800020
027600     05  PC-THREE                     PIC S9(2)      VALUE +3.    02810020
027700     05  PC-FOUR                      PIC S9(2)      VALUE +4.    02820020
027800     05  PC-FIVE                      PIC S9(2)      VALUE +5.    02830020
027900     05  PC-SIX                       PIC S9(2)      VALUE +6.    02840020
028000     05  PC-FOURTEEN                  PIC S9(2)      VALUE +14.   02850020
028100     05  PC-52                        PIC S9(03)     VALUE +52    02860020
028200                                                     COMP-3.      02870020
028300     05  PC-52X                       PIC X(02)      VALUE '52'.  02880020
028400     05  PC-F2                        PIC X(02)      VALUE 'F2'.  02890020
028500     05  PC-N                         PIC X(01)      VALUE 'N'.   02900020
028600     05  PC-Y                         PIC X(01)      VALUE 'Y'.   02910020
028700     05  PC-PGRM-NAME                 PIC X(8)   VALUE 'MRKRP117'.02920020
028800     05  PC-PGM-DPKUT500              PIC X(8)   VALUE 'DPKUT500'.02930020
028900                                                                  02940020
029000 01  SC-STATUS-CODES.                                             02950020
029100     05  SC-EXCEPT-STATUS            PIC X(02).                   02960029
029200         88  SC-EXCEPT-STATUS-OK               VALUE '00', '97'.  02970029
029300     05  SC-BIM-STATUS               PIC X(02).                   02980029
029400         88  SC-BIM-STATUS-OK                  VALUE '00', '97'.  02990029
029500         88  SC-BIM-RECORD-NOT-FOUND           VALUE '23'.        03000029
029600                                                                  03010020
029700 01  PS-PROGRAM-SWITCHES.                                         03020020
029800     05  PS-EOC-LEVEL-CSR             PIC  X(01)     VALUE 'N'.   03030020
029900         88  EOC-LEVEL-CSR                           VALUE 'Y'.   03040020
030000     05  PS-EOC-H-FRCST-CSR           PIC  X(01)     VALUE 'N'.   03050020
030100         88  EOC-H-FRCST-CSR                         VALUE 'Y'.   03060020
030200     05  PS-EOC-C-FRCST-CSR           PIC  X(01)     VALUE 'N'.   03070020
030300         88  EOC-C-FRCST-CSR                         VALUE 'Y'.   03080020
030400     05  PS-EOC-HIST-CSR              PIC  X(01)     VALUE 'N'.   03090020
030500         88  EOC-HIST-CSR                            VALUE 'Y'.   03100020
030600     05  PS-EOC-SLS-HIST-CSR          PIC  X(01)     VALUE 'N'.   03110020
030700         88  EOC-SLS-HIST-CSR                        VALUE 'Y'.   03120020
030800     05  PS-EOC-CURR-CSR              PIC  X(01)     VALUE 'N'.   03130020
030900         88  EOC-CURR-CSR                            VALUE 'Y'.   03140020
031000     05  PS-EOC-COLOR-STYLE-CSR       PIC  X(01)     VALUE 'N'.   03150020
031100         88  EOC-COLOR-STYLE-CSR                     VALUE 'Y'.   03160020
031200     05  PS-EOC-MAJOR-CLASS-CSR       PIC  X(01)     VALUE 'N'.   03170020
031300         88  EOC-MAJOR-CLASS-CSR                     VALUE 'Y'.   03180020
031400     05  PS-EOC-SUB-CLASS-CSR         PIC  X(01)     VALUE 'N'.   03190020
031500         88  EOC-SUB-CLASS-CSR                       VALUE 'Y'.   03200020
031600     05  PS-EOC-GROUP-CSR             PIC  X(01)     VALUE 'N'.   03210020
031700         88  EOC-GROUP-CSR                           VALUE 'Y'.   03220020
031800     05  PS-EOC-VENDOR-CSR            PIC  X(01)     VALUE 'N'.   03230020
031900         88  EOC-VENDOR-CSR                          VALUE 'Y'.   03240020
032000     05  PS-FOUND-WEEKS-ONHAND        PIC  X(01)     VALUE 'N'.   03250020
032100         88  FOUND-WEEKS-ONHAND                      VALUE 'Y'.   03260020
032200     05  PS-FOUND-WEEKS-ONORDER       PIC  X(01)     VALUE 'N'.   03270020
032300         88  FOUND-WEEKS-ONORDER                     VALUE 'Y'.   03280020
032400     05  PS-FOUND-WEEKS-CSTOCK        PIC  X(01)     VALUE 'N'.   03290020
032500         88  FOUND-WEEKS-CSTOCK                      VALUE 'Y'.   03300020
032600     05  PS-PROCESS-LINE-INFO         PIC  X(01)     VALUE 'Y'.   03310020
032700         88  PROCESS-LINE-INFO                       VALUE 'Y'.   03320020
032800         88  DONE-PROCESSING                         VALUE 'N'.   03330020
032900     05  PS-WITHIN-WEEK-RANGE         PIC  X(01)     VALUE 'N'.   03340020
033000         88  WITHIN-WEEK-RANGE                       VALUE 'Y'.   03350020
033100     05  PS-WITHIN-PCNT-RANGE         PIC  X(01)     VALUE 'N'.   03360020
033200         88  WITHIN-PCNT-RANGE                       VALUE 'Y'.   03370020
033300     05  PS-BIM-RECORD-FOUND-SW       PIC  X(01)     VALUE 'Y'.   03380020
033400         88  BIM-RECORD-FOUND                        VALUE 'Y'.   03390020
033500         88  BIM-RECORD-NOT-FOUND                    VALUE 'N'.   03400020
033600*                                                                 03410020
033700 01  PV-PROGRAM-VARIABLES.                                        03420020
033800     05  PV-REPORT-VARIABLES.                                     03430020
033900         10  PV-LINE-CNT              PIC S9(3)      VALUE +61    03440020
034000                                                     COMP-3.      03450020
034100         10  PV-PAGE-CNT              PIC 9(3)       VALUE ZEROS. 03460020
034200         10  PV-LINE-CONTROL          PIC 9(1)       VALUE ZEROS. 03470020
034300     05  PV-INDEXES.                                              03480020
034400         10  PV-FUTR-INDEX            PIC 9(02)      VALUE ZEROS. 03490020
034500         10  PV-HIST-INDEX            PIC 9(02)      VALUE ZEROS. 03500020
034600         10  PV-BIM-WEEK-INDEX        PIC 9(02)      VALUE ZEROS. 03510020
034700         10  PV-BIM-INDEX             PIC 9(02)      VALUE ZEROS. 03520020
034800         10  PV-WOS-INDEX             PIC 9(02)      VALUE ZEROS. 03530020
034900         10  PV-PCNT-INDEX            PIC 9(02)      VALUE ZEROS. 03540020
035000     05  PV-DATE-FIELDS.                                          03550020
035100         10 PV-DATE.                                              03560020
035200             15 PV-YR                 PIC  9(4)      VALUE ZEROS. 03570020
035300             15 PV-MO                 PIC  9(2)      VALUE ZEROS. 03580020
035400             15 PV-DY                 PIC  9(2)      VALUE ZEROS. 03590020
035500         10  PV-CURR-WEEK-YEAR.                                   03600020
035600             15  PV-CURR-YEAR         PIC  X(04).                 03610020
035700             15  PV-CURR-WEEK         PIC  X(02).                 03620020
035800         10  PV-HOLD-WEEK-YEAR.                                   03630020
035900             15  PV-HOLD-YEAR         PIC  X(04).                 03640020
036000             15  PV-HOLD-WEEK         PIC  X(02).                 03650020
036100         10  PV-WEEK-YEAR.                                        03660020
036200             15  PV-YEAR              PIC  9(04).                 03670020
036300             15  PV-WEEK              PIC  9(02).                 03680020
036400         10  PV-HOLD-FSCL-DATE        PIC  X(10).                 03690020
036500         10  PV-DECREMENT             PIC  9(2)      VALUE ZERO.  03700020
036600     05 PV-COMPUTE-FIELDS.                                        03710020
036700         10 PV-FORECAST               PIC 9(7)V99    VALUE ZEROS. 03720020
036800         10 PV-TOTAL-FORECAST         PIC 9(7)V99    VALUE ZEROS. 03730020
036900         10 PV-CUMM-FRCST             PIC 9(7)       VALUE ZEROS. 03740020
037000         10 PV-CUMM-SALES             PIC 9(7)       VALUE ZEROS. 03750020
037100         10 PV-DD-COMPUTED            PIC S9(8)V999  COMP-3.      03760020
037200     05 PV-HOLD-FIELDS.                                           03770020
037300         10 PV-DD                     PIC S9(8)V9    COMP-3.      03780020
037400         10 PV-SALES                  PIC S9(8)V     COMP-3.      03790020
037500         10 PV-MADDSS                 PIC S9(8)V9    COMP-3.      03800020
037600         10 PV-ONHAND                 PIC S9(11)V    COMP-3.      03810020
037700         10 PV-ON-ORDER               PIC S9(11)V    COMP-3.      03820020
037800         10 PV-CSTOCK                 PIC S9(11)V    COMP-3.      03830020
037900         10 PV-OSTRAT                 PIC S9(3)V9    COMP-3.      03840020
038000         10 PV-LT                     PIC S9(3)V     COMP-3.      03850020
038100         10 PV-BI                     PIC S99V99     COMP-3.      03860020
038200     05 PV-PERCENT-FIELDS.                                        03870020
038300         10  PV-HOLD-CSTOCK-PCT       PIC S9(04)V9(03)            03880020
038400                                      VALUE ZERO     COMP-3.      03890020
038500         10  PV-HOLD-CUMM-FRCST-PCT   PIC S9(04)V9(03)            03900020
038600                                      VALUE ZERO     COMP-3.      03910020
038700         10  PV-CSTOCK-PERCENT        PIC S9(3)      VALUE ZEROS. 03920020
038800         10  PV-FRCST-PERCENT         PIC S9(3)      VALUE ZEROS. 03930020
038900         10  PV-CUMM-FRCST-PCT        PIC S9(3)      VALUE ZEROS. 03940020
039000     05 PV-COMPARE-VARIABLES.                                     03950020
039100         10 PV-ONHAND-COMPARE         PIC S9(11)V    COMP-3       03960020
039200                                                     VALUE ZEROS. 03970020
039300         10 PV-ONORDER-COMPARE        PIC S9(11)V    COMP-3       03980020
039400                                                     VALUE ZEROS. 03990020
039500         10 PV-CSTOCK-COMPARE         PIC S9(11)V    COMP-3       04000020
039600                                                     VALUE ZEROS. 04010020
039700         10 PV-ONHAND-ONORDER         PIC S9(11)V    COMP-3       04020020
039800                                                     VALUE ZEROS. 04030020
039900         10 PV-ONHAND-CSTOCK          PIC S9(11)V    COMP-3       04040020
040000                                                     VALUE ZEROS. 04050020
040100         10 PV-WOS                    PIC 9(2)       VALUE ZEROS. 04060020
040200         10 PV-WOO                    PIC 9(2)       VALUE ZEROS. 04070020
040300         10 PV-COMP-PERCENT           PIC S9(3)      VALUE ZEROS. 04080020
040400     05 PV-DEFAULT-VARIABLES.                                     04090020
040500         10 PV-DEFAULT-LEVEL          PIC X(3)       VALUE SPACES.04100020
040600         10 PV-DEFAULT-SW-EXCEPT      PIC X(3)       VALUE SPACES.04110020
040700             88 PV-DEFAULT-NONE                      VALUE 'NO '. 04120020
040800             88 PV-DEFAULT-PER                       VALUE 'PER'. 04130020
040900             88 PV-DEFAULT-WOS                       VALUE 'WOS'. 04140020
041000         10 PV-DEFAULT-PERCENT        PIC S9(3)      VALUE ZEROS. 04150020
041100         10 PV-DEFAULT-NEG-PERCENT    PIC S9(3)      VALUE ZEROS. 04160020
041200         10 PV-DEFAULT-LESS-WEEK      PIC 9(2)       VALUE ZEROS. 04170020
041300         10 PV-DEFAULT-MORE-WEEK      PIC 9(2)       VALUE ZEROS. 04180020
041400     05 PV-HOLD-VARIABLES.                                        04190020
041500         10 PV-HOLD-LEVEL             PIC X(3)       VALUE SPACES.04200020
041600         10 PV-HOLD-SW-EXCEPT         PIC X(3)       VALUE SPACES.04210020
041700             88 PV-HOLD-NONE                         VALUE 'NO '. 04220020
041800             88 PV-HOLD-PER                          VALUE 'PER'. 04230020
041900             88 PV-HOLD-WOS                          VALUE 'WOS'. 04240020
042000         10 PV-HOLD-PERCENT           PIC S9(3)      VALUE ZEROS. 04250020
042100         10 PV-HOLD-NEG-PERCENT       PIC S9(3)      VALUE ZEROS. 04260020
042200         10 PV-HOLD-LESS-WEEK         PIC 9(2)       VALUE ZEROS. 04270020
042300         10 PV-HOLD-MORE-WEEK         PIC 9(2)       VALUE ZEROS. 04280020
042400         10 PV-HOLD-DEPT-NBR          PIC S9(04)V    VALUE ZEROS  04290020
042500                                                     COMP-3.      04300020
042600         10 PV-HOLD-CLASS-NBR         PIC S9(04)V    VALUE ZEROS  04310020
042700                                                     COMP-3.      04320020
042800         10 PV-HOLD-SCL-NBR           PIC S9(04)V    VALUE ZEROS  04330020
042900                                                     COMP-3.      04340020
043000         10 PV-HOLD-COLOR             PIC X(20)      VALUE SPACES.04350020
043100         10 PV-HOLD-STYLE             PIC X(20)      VALUE SPACES.04360020
043200         10 PV-HOLD-GROUP-CODE        PIC X(3)       VALUE SPACES.04370020
043300         10 PV-HOLD-VENDOR-NAME       PIC X(30)      VALUE SPACES.04380020
043400         10 PV-HOLD-VENDOR-CODE       PIC S9(9)      COMP.        04390020
043500                                                                  04400020
043600 01  PV-ABEND-INFO.                                               04410020
043700     05  PV-ABEND-CODE                PIC S9(04)     VALUE ZERO.  04420020
043800     05  PV-ABEND-PARAGRAPH           PIC  X(30)     VALUE SPACES.04430020
043900     05  PV-MESSAGES.                                             04440020
044000         10   PV-PARAGRAPH-NAME-MSG.                              04450020
044100             15  FILLER               PIC  X(13)     VALUE        04460020
044200                                    'PARAGRAPH IS '.              04470020
044300             15  PV-PARAGRAPH-NAME    PIC  X(25).                 04480020
044400         10   PV-ERROR-FILE-MSG.                                  04490020
044500             15  FILLER               PIC  X(26)     VALUE        04500020
044600                   'ERROR HAS OCCURED FILE IS '.                  04510020
044700             15  PV-ERROR-FILE        PIC  X(19).                 04520020
044800         10   PV-ERROR-OPERATION-MSG.                             04530020
044900             15  FILLER               PIC  X(13)     VALUE        04540020
045000                   'OPERATION IS '.                               04550020
045100             15  PV-ERROR-OPERATION   PIC  X(19).                 04560020
045200         10   PV-ERROR-STATUS-MSG.                                04570020
045300             15  FILLER               PIC  X(10)     VALUE        04580020
045400                   'STATUS IS '.                                  04590020
045500             15  PV-ERROR-STATUS      PIC  X(20).                 04600020
045600         10   PV-NOT-FOUND-MSG.                                   04610020
045700             15  FILLER               PIC  X(12)     VALUE        04620020
045800                   'FILE KEY IS '.                                04630020
045900             15  PV-NOT-FOUND-KEY     PIC  X(21).                 04640020
046000     05  PV-VSAM-STATUS               PIC  X(02)     VALUE SPACE. 04650020
046100         88   PV-NO-REC-FOUND                        VALUE '23'.  04660020
046200                                                                  04670020
046300                                                                  04680020
046400 EJECT                                                            04690020
046500 01 PAN-BIM-FILE.                                                 04700020
046600     COPY IPFGBIC.                                                04710020
046700 EJECT                                                            04720020
046800                                                                  04730020
046900** RECORD LAYOUT FOR INPUT FILE                                   04740020
047000     COPY MRRD032.                                                04750020
047100 EJECT                                                            04760020
047200                                                                  04770020
047300 01  PT-PGM-TABLES.                                               04780020
047400     05  PT-FUTURE-WEEK-TABLE.                                    04790020
047500         10 PT-FUTURE-WEEK            PIC  X(2)                   04800020
047600                                      OCCURS 5 TIMES.             04810020
047700         10 PT-FUTURE-YEAR            PIC  X(4)                   04820020
047800                                      OCCURS 5 TIMES.             04830020
047900     05  PT-HIST-WEEK-TABLE.                                      04840020
048000         10 PT-HIST-WEEK              PIC  X(2)                   04850020
048100                                      OCCURS 4 TIMES.             04860020
048200         10 PT-HIST-YEAR              PIC  X(4)                   04870020
048300                                      OCCURS 4 TIMES.             04880020
048400     05  PT-FSCL-DATE-TABLE.                                      04890020
048500         10 PT-FSCL-DATE              PIC  X(10)                  04900020
048600                                      OCCURS 4 TIMES.             04910020
048700     05  PT-FORECAST-TABLE.                                       04920020
048800         10 PT-FORECAST-AMOUNT        PIC  9(6)V99                04930020
048900                                      OCCURS 52 TIMES.            04940020
049000                                                                  04950022
049100*************************************************************     04960022
049200* MRNIS-RFC      PREVIOUS   NOT INCLUDED                          04970022
049300* MRNIS-RFC      CURRENT    DCLGEN FOR TSKXREF                    04980022
049400* MRNIS-RFC      FUTURE     REMOVE WHEN TSKXREF NO LONGER NEE     04990022
049500*************************************************************     05000022
049600     EXEC SQL                                                     05010022
049700         INCLUDE TSKXREF                                          05020022
049800     END-EXEC.                                                    05030022
049900                                                                  05040020
050000     EXEC SQL                                                     05050020
050100         INCLUDE TMRITEM                                          05060020
050200     END-EXEC.                                                    05070020
050300                                                                  05080020
050400     EXEC SQL                                                     05090020
050500         INCLUDE TMRITST                                          05100020
050600     END-EXEC.                                                    05110020
050700                                                                  05120020
050800     EXEC SQL                                                     05130020
050900         INCLUDE TSK                                              05140020
051000     END-EXEC.                                                    05150020
051100                                                                  05160020
051200     EXEC SQL                                                     05170020
051300         INCLUDE MHT00000                                         05180031
051400     END-EXEC.                                                    05190020
051500                                                                  05200020
051600     EXEC SQL                                                     05210020
051700         INCLUDE TSKST                                            05220020
051800     END-EXEC.                                                    05230020
051900                                                                  05240020
052000     EXEC SQL                                                     05250020
052100         INCLUDE TMRISHS                                          05260020
052200     END-EXEC.                                                    05270020
052300                                                                  05280020
052400     EXEC SQL                                                     05290020
052500         INCLUDE TENTNME                                          05300020
052600     END-EXEC.                                                    05310020
052700                                                                  05320020
052800     EXEC SQL                                                     05330020
052900         INCLUDE XMT00001                                         05340031
053000     END-EXEC.                                                    05350020
053100                                                                  05360020
053200* DB2 COMMUNICATION AREA                                          05370020
053300                                                                  05380020
053400     EXEC SQL                                                     05390020
053500         INCLUDE SQLCA                                            05400020
053600     END-EXEC.                                                    05410020
053700                                                                  05420020
053800* DB2 COMMUNICATION AREA2                                         05430020
053900                                                                  05440020
054000     COPY SQLCA2.                                                 05450020
054100                                                                  05460020
054200******************************************************************05470023
054300* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      05480023
054400* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        05490023
054500* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 05500023
054600******************************************************************05510023
054700                                                                  05520023
054800     EXEC SQL                                                     05530020
054900       DECLARE DEPT-LEVEL CURSOR FOR                              05540020
055000             SELECT DISTINCT                                      05550020
055100                    X.DEPT                                        05560020
055200             FROM   TSKXREF X                                     05570028
055300                   ,TMRITEM B                                     05580028
055400                   ,TMRITST C                                     05590028
055500                   ,XMT_LOC D                                     05600031
055600             WHERE B.ITEM_NBR      = X.ITM_NBR                    05610020
055700              AND  C.ITEM_NBR      = X.ITM_NBR                    05620020
055800              AND  C.FT_CDE        = 'O'                          05630020
055900              AND  C.STR_NBR       = D.LOC_NBR                    05640031
056100              AND  D.E_BUS_IND     = :PC-Y                        05660031
056200              AND  D.LOC_TYP_CDE   = 'DS'                         05670032
056300** BELOW LINE IS USED FOR UNIT TESTING                            05680020
056400**             AND  X.DEPT  = 327                                 05690020
056500                       WITH UR                                    05700020
056600     END-EXEC.                                                    05710020
056700                                                                  05720020
056800******************************************************************05730023
056900* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               05740026
057000* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       05750026
057100* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 05760023
057200******************************************************************05770023
057300                                                                  05780023
057400     EXEC SQL                                                     05790020
057500       DECLARE COLOR-STYLE-LEVEL CURSOR FOR                       05800020
057600             SELECT DISTINCT                                      05810020
057700                    X.DEPT                                        05820020
057800                   ,X.CLASS                                       05830020
057900                   ,X.SUBCLASS                                    05840020
058000                   ,A.LONG_COLOR_DESC                             05850020
058100                   ,A.LONG_VENDOR_STYLE                           05860020
058200              FROM TSK A                                          05870020
058300                  ,TMRITEM B                                      05880020
058400                  ,TMRITST D                                      05890020
058500                  ,XMT_LOC G                                      05900031
058600                  ,TSKXREF X                                      05910020
058700             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       05920020
058800               AND  B.ITEM_NBR          = A.ITEM_NMBR             05930020
058900               AND  D.ITEM_NBR          = A.ITEM_NMBR             05940020
059000               AND  X.ITM_NBR           = A.ITEM_NMBR             05950020
059100               AND  D.STR_NBR           > 0                       05960031
059200               AND  D.FT_CDE            = 'O'                     05970020
059300               AND  D.STR_NBR           = G.LOC_NBR               05980031
059500               AND  G.E_BUS_IND         = :PC-Y                   06000031
059600                       WITH UR                                    06010020
059700     END-EXEC.                                                    06020020
059800                                                                  06030020
059900******************************************************************06040023
060000* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               06050026
060100* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       06060026
060200* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 06070023
060300******************************************************************06080023
060400                                                                  06090023
060500     EXEC SQL                                                     06100020
060600       DECLARE CLR-STL-HIST-FRCST CURSOR FOR                      06110020
060700             SELECT B.UCYCLE_CDE                                  06120020
060800                   ,C.DSD_HIST_QTY                                06130020
060900                   ,D.PTAG_ID                                     06140020
061000              FROM TSK A                                          06150020
061100                  ,TMRITEM B                                      06160020
061200                  ,TMRISHS C                                      06170020
061300                  ,TMRITST D                                      06180020
061400                  ,XMT_LOC G                                      06190031
061500                  ,TSKXREF X                                      06200020
061600               WHERE A.ITEM_NMBR         = B.ITEM_NBR             06210020
061700                AND  A.ITEM_NMBR         = C.ITM_NBR              06220020
061800                AND  A.ITEM_NMBR         = D.ITEM_NBR             06230020
061900                AND  A.ITEM_NMBR         = X.ITM_NBR              06240020
062000                AND  C.STR_NBR           = D.STR_NBR              06250020
062100                AND  C.STR_NBR           > 0                      06260031
062200                AND  D.FT_CDE            = 'O'                    06270020
062300                AND  D.STR_NBR           = G.LOC_NBR              06280031
062500                AND  G.E_BUS_IND         = :PC-Y                  06300031
062600                AND  C.YR_NBR            = :PV-HOLD-YEAR          06310020
062700                AND  C.WK_NBR            = :PV-HOLD-WEEK          06320020
062800                AND  X.DEPT              = :PV-HOLD-DEPT-NBR      06330020
062900                AND  X.CLASS             = :PV-HOLD-CLASS-NBR     06340020
063000                AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR       06350020
063100                AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR         06360020
063200                AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE         06370020
063300                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)06380020
063400                     FROM TMRISHS E                               06390020
063500                 WHERE                                            06400020
063600                         E.ITM_NBR         =  C.ITM_NBR           06410020
063700                     AND E.STR_NBR         =  C.STR_NBR           06420020
063800                     AND E.YR_NBR          = :PV-HOLD-YEAR        06430020
063900                     AND E.WK_NBR          = :PV-HOLD-WEEK)       06440020
                       WITH UR                                          06441037
064000     END-EXEC.                                                    06450025
064100                                                                  06460020
064200******************************************************************06470023
064300* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               06480026
064400* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       06490026
064500* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 06500023
064600******************************************************************06510023
064700                                                                  06520023
064800     EXEC SQL                                                     06530020
064900       DECLARE CLR-STL-CURR-FRCST CURSOR FOR                      06540020
065000             SELECT B.UCYCLE_CDE                                  06550020
065100                   ,D.DD_FCTR                                     06560020
065200                   ,D.PTAG_ID                                     06570020
065300              FROM TSK A                                          06580020
065400                  ,TMRITEM B                                      06590020
065500                  ,TMRITST D                                      06600020
065600                  ,XMT_LOC G                                      06610031
065700                  ,TSKXREF X                                      06620020
065800               WHERE A.ITEM_NMBR         = B.ITEM_NBR             06630020
065900                AND  A.ITEM_NMBR         = D.ITEM_NBR             06640020
066000                AND  A.ITEM_NMBR         = X.ITM_NBR              06650020
066100                AND  D.STR_NBR           > 0                      06660031
066200                AND  D.FT_CDE            = 'O'                    06670020
066300                AND  D.STR_NBR           = G.LOC_NBR              06680031
066500                AND  G.E_BUS_IND         = :PC-Y                  06700031
066600                AND  X.DEPT              = :PV-HOLD-DEPT-NBR      06710020
066700                AND  X.CLASS             = :PV-HOLD-CLASS-NBR     06720020
066800                AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR       06730020
066900                AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR         06740020
067000                AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE         06750020
                      WITH UR                                           06751037
067100     END-EXEC.                                                    06760020
067200                                                                  06770020
067300******************************************************************06780023
067400* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               06790026
067500* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       06800026
067600* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 06810023
067700******************************************************************06820023
067800                                                                  06830023
067900     EXEC SQL                                                     06840020
068000       DECLARE MAJOR-CLASS-LEVEL CURSOR FOR                       06850020
068100             SELECT DISTINCT                                      06860020
068200                    X.DEPT                                        06870020
068300                   ,X.CLASS                                       06880020
068400              FROM TSKXREF X                                      06890020
068500                  ,TMRITEM B                                      06900020
068600                  ,TMRITST D                                      06910020
068700                  ,XMT_LOC G                                      06920031
068800             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       06930020
068900               AND  B.ITEM_NBR          = X.ITM_NBR               06940020
069000               AND  D.ITEM_NBR          = X.ITM_NBR               06950020
069100               AND  D.STR_NBR           > 0                       06960031
069200               AND  D.FT_CDE            = 'O'                     06970020
069300               AND  D.STR_NBR           = G.LOC_NBR               06980031
069500               AND  G.E_BUS_IND         = :PC-Y                   07000031
069600                       WITH UR                                    07010020
069700     END-EXEC.                                                    07020020
069800                                                                  07030020
069900******************************************************************07040023
070000* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               07050026
070100* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       07060026
070200* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 07070023
070300******************************************************************07080023
070400                                                                  07090023
070500     EXEC SQL                                                     07100020
070600       DECLARE MAJ-CLS-HIST-FRCST CURSOR FOR                      07110020
070700             SELECT B.UCYCLE_CDE                                  07120020
070800                   ,C.DSD_HIST_QTY                                07130020
070900                   ,D.PTAG_ID                                     07140020
071000              FROM TSKXREF X                                      07150020
071100                  ,TMRITEM B                                      07160020
071200                  ,TMRISHS C                                      07170020
071300                  ,TMRITST D                                      07180020
071400                  ,XMT_LOC G                                      07190031
071500              WHERE X.ITM_NBR           = B.ITEM_NBR              07200020
071600                AND X.ITM_NBR           = C.ITM_NBR               07210020
071700                AND X.ITM_NBR           = D.ITEM_NBR              07220020
071800                AND C.STR_NBR           = D.STR_NBR               07230020
071900                AND C.STR_NBR           > 0                       07240031
072000                AND D.FT_CDE            = 'O'                     07250020
072100                AND D.STR_NBR           = G.LOC_NBR               07260031
072300                AND G.E_BUS_IND         = :PC-Y                   07280031
072400                AND X.CLASS             = :PV-HOLD-CLASS-NBR      07290020
072500                AND C.YR_NBR            = :PV-HOLD-YEAR           07300020
072600                AND C.WK_NBR            = :PV-HOLD-WEEK           07310020
072700                AND X.DEPT              = :PV-HOLD-DEPT-NBR       07320020
072800                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)07330020
072900                     FROM TMRISHS E                               07340020
073000                 WHERE                                            07350020
073100                         E.ITM_NBR         =  C.ITM_NBR           07360020
073200                     AND E.STR_NBR         =  C.STR_NBR           07370020
073300                     AND E.YR_NBR          = :PV-HOLD-YEAR        07380020
073400                     AND E.WK_NBR          = :PV-HOLD-WEEK)       07390020
                       WITH UR                                          07391037
073500     END-EXEC.                                                    07400020
073600                                                                  07410020
073700******************************************************************07420023
073800* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               07430026
073900* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       07440026
074000* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 07450023
074100******************************************************************07460023
074200                                                                  07470023
074300     EXEC SQL                                                     07480020
074400       DECLARE MAJ-CLS-CURR-FRCST CURSOR FOR                      07490020
074500             SELECT B.UCYCLE_CDE                                  07500020
074600                   ,D.DD_FCTR                                     07510020
074700                   ,D.PTAG_ID                                     07520020
074800             FROM  TSKXREF X                                      07530020
074900                  ,TMRITEM B                                      07540020
075000                  ,TMRITST D                                      07550020
075100                  ,XMT_LOC G                                      07560031
075200             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       07570020
075300               AND  X.CLASS             = :PV-HOLD-CLASS-NBR      07580020
075400               AND  X.ITM_NBR           = B.ITEM_NBR              07590020
075500               AND  X.ITM_NBR           = D.ITEM_NBR              07600020
075600               AND  D.STR_NBR           > 0                       07610031
075700               AND  D.FT_CDE            = 'O'                     07620020
075800               AND  D.STR_NBR           = G.LOC_NBR               07630031
076000               AND  G.E_BUS_IND         = :PC-Y                   07650031
                   WITH UR                                              07651037
076100     END-EXEC.                                                    07660020
076200                                                                  07670020
076300******************************************************************07680024
076400* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               07690026
076500* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       07700026
076600* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 07710024
076700******************************************************************07720024
076800                                                                  07730024
076900     EXEC SQL                                                     07740020
077000       DECLARE SUB-CLASS-LEVEL CURSOR FOR                         07750020
077100             SELECT DISTINCT                                      07760020
077200                    X.DEPT                                        07770020
077300                   ,X.CLASS                                       07780020
077400                   ,X.SUBCLASS                                    07790020
077500              FROM TSKXREF X                                      07800020
077600                  ,TMRITEM B                                      07810020
077700                  ,TMRITST D                                      07820020
077800                  ,XMT_LOC G                                      07830031
077900             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       07840020
078000               AND  X.ITM_NBR           = B.ITEM_NBR              07850020
078100               AND  X.ITM_NBR           = D.ITEM_NBR              07860020
078200               AND  D.STR_NBR           > 0                       07870031
078300               AND  D.FT_CDE            = 'O'                     07880020
078400               AND  D.STR_NBR           = G.LOC_NBR               07890031
078600               AND  G.E_BUS_IND         = :PC-Y                   07910031
078700                       WITH UR                                    07920020
078800     END-EXEC.                                                    07930020
078900                                                                  07940020
079000******************************************************************07950024
079100* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               07960026
079200* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       07970026
079300* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 07980024
079400******************************************************************07990024
079500                                                                  08000024
079600     EXEC SQL                                                     08010020
079700       DECLARE SUB-CLS-HIST-FRCST CURSOR FOR                      08020020
079800             SELECT B.UCYCLE_CDE                                  08030020
079900                   ,C.DSD_HIST_QTY                                08040020
080000                   ,D.PTAG_ID                                     08050020
080100              FROM TSKXREF X                                      08060020
080200                  ,TMRITEM B                                      08070020
080300                  ,TMRISHS C                                      08080020
080400                  ,TMRITST D                                      08090020
080500                  ,XMT_LOC G                                      08100031
080600               WHERE X.ITM_NBR          = B.ITEM_NBR              08110020
080700                AND  X.ITM_NBR          = C.ITM_NBR               08120020
080800                AND  X.ITM_NBR          = D.ITEM_NBR              08130020
080900                AND  C.STR_NBR          = D.STR_NBR               08140020
081000                AND  C.STR_NBR          > 0                       08150031
081100                AND  D.FT_CDE           = 'O'                     08160020
081200                AND  D.STR_NBR          = G.LOC_NBR               08170031
081400                AND  G.E_BUS_IND        = :PC-Y                   08190031
081500                AND  X.CLASS            = :PV-HOLD-CLASS-NBR      08200020
081600                AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR        08210020
081700                AND  C.YR_NBR           = :PV-HOLD-YEAR           08220020
081800                AND  C.WK_NBR           = :PV-HOLD-WEEK           08230020
081900                AND  X.DEPT             = :PV-HOLD-DEPT-NBR       08240020
082000                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)08250020
082100                     FROM TMRISHS E                               08260020
082200                 WHERE                                            08270020
082300                         E.ITM_NBR         =  C.ITM_NBR           08280020
082400                     AND E.STR_NBR         =  C.STR_NBR           08290020
082500                     AND E.YR_NBR          = :PV-HOLD-YEAR        08300020
082600                     AND E.WK_NBR          = :PV-HOLD-WEEK)       08310020
                      WITH UR                                           08311037
082700     END-EXEC.                                                    08320020
082800                                                                  08330020
082810******************************************************************08340026
082820* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               08350026
082830* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       08360026
082840* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 08370026
082850******************************************************************08380026
082900     EXEC SQL                                                     08390020
083000       DECLARE SUB-CLS-CURR-FRCST CURSOR FOR                      08400020
083100             SELECT B.UCYCLE_CDE                                  08410020
083200                   ,D.DD_FCTR                                     08420020
083300                   ,D.PTAG_ID                                     08430020
083400             FROM  TSKXREF X                                      08440020
083500                  ,TMRITEM B                                      08450020
083600                  ,TMRITST D                                      08460020
083700                  ,XMT_LOC G                                      08470031
083800             WHERE  X.ITM_NBR          = B.ITEM_NBR               08480020
083900               AND  X.ITM_NBR          = D.ITEM_NBR               08490020
084000               AND  D.STR_NBR          > 0                        08500031
084100               AND  D.FT_CDE           = 'O'                      08510020
084200               AND  D.STR_NBR          = G.LOC_NBR                08520031
084400               AND  G.E_BUS_IND        = :PC-Y                    08540031
084500               AND  X.DEPT             = :PV-HOLD-DEPT-NBR        08550020
084600               AND  X.CLASS            = :PV-HOLD-CLASS-NBR       08560020
084700               AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR         08570020
                   WITH UR                                              08571037
084800     END-EXEC.                                                    08580020
084900                                                                  08590020
084910******************************************************************08600026
084920* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               08610026
084930* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       08620026
084940* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 08630026
084950******************************************************************08640026
085000     EXEC SQL                                                     08650020
085100       DECLARE GROUP-LEVEL CURSOR FOR                             08660020
085200             SELECT DISTINCT                                      08670020
085300                    X.DEPT                                        08680020
085400                   ,X.CLASS                                       08690020
085500                   ,X.SUBCLASS                                    08700020
085600                   ,A.GROUP_CODE                                  08710020
085700              FROM TSK A                                          08720020
085800                  ,TMRITEM B                                      08730020
085900                  ,TMRITST D                                      08740020
086000                  ,XMT_LOC G                                      08750031
086100                  ,TSKXREF X                                      08760020
086200             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       08770020
086300               AND  A.ITEM_NMBR         = B.ITEM_NBR              08780020
086400               AND  A.ITEM_NMBR         = D.ITEM_NBR              08790020
086500               AND  A.ITEM_NMBR         = X.ITM_NBR               08800020
086600               AND  D.STR_NBR           > 0                       08810031
086700               AND  D.FT_CDE            = 'O'                     08820020
086800               AND  D.STR_NBR           = G.LOC_NBR               08830031
087000               AND  G.E_BUS_IND         = :PC-Y                   08850031
087100                       WITH UR                                    08860020
087200     END-EXEC.                                                    08870020
087300                                                                  08880020
087310******************************************************************08890026
087320* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               08900026
087330* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       08910026
087340* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 08920026
087350******************************************************************08930026
087400     EXEC SQL                                                     08940020
087500       DECLARE GROUP-HIST-FRCST CURSOR FOR                        08950020
087600             SELECT B.UCYCLE_CDE                                  08960020
087700                   ,C.DSD_HIST_QTY                                08970020
087800                   ,D.PTAG_ID                                     08980020
087900              FROM TSK A                                          08990020
088000                  ,TMRITEM B                                      09000020
088100                  ,TMRISHS C                                      09010020
088200                  ,TMRITST D                                      09020020
088300                  ,XMT_LOC G                                      09030031
088400                  ,TSKXREF X                                      09040020
088500               WHERE A.ITEM_NMBR        = B.ITEM_NBR              09050020
088600                AND  A.ITEM_NMBR        = C.ITM_NBR               09060020
088700                AND  A.ITEM_NMBR        = D.ITEM_NBR              09070020
088800                AND  A.ITEM_NMBR        = X.ITM_NBR               09080020
088900                AND  C.STR_NBR          = D.STR_NBR               09090020
089000                AND  C.STR_NBR          > 0                       09100031
089100                AND  D.FT_CDE           = 'O'                     09110020
089200                AND  D.STR_NBR          = G.LOC_NBR               09120031
089400                AND  G.E_BUS_IND        = :PC-Y                   09140031
089500                AND  C.YR_NBR           = :PV-HOLD-YEAR           09150020
089600                AND  C.WK_NBR           = :PV-HOLD-WEEK           09160020
089700                AND  X.DEPT             = :PV-HOLD-DEPT-NBR       09170020
089800                AND  X.CLASS            = :PV-HOLD-CLASS-NBR      09180020
089900                AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR        09190020
090000                AND  A.GROUP_CODE       = :PV-HOLD-GROUP-CODE     09200020
090100                AND  C.ITM_REV_ID     = (SELECT MAX (E.ITM_REV_ID)09210020
090200                     FROM TMRISHS E                               09220020
090300                 WHERE                                            09230020
090400                         E.ITM_NBR         =  C.ITM_NBR           09240020
090500                     AND E.STR_NBR         =  C.STR_NBR           09250020
090600                     AND E.YR_NBR          = :PV-HOLD-YEAR        09260020
090700                     AND E.WK_NBR          = :PV-HOLD-WEEK)       09270020
                      WITH UR                                           09271037
090800     END-EXEC.                                                    09280020
090900                                                                  09290020
090910******************************************************************09300026
090920* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               09310026
090930* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       09320026
090940* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 09330026
090950******************************************************************09340026
091000     EXEC SQL                                                     09350020
091100       DECLARE GROUP-CURR-FRCST CURSOR FOR                        09360020
091200             SELECT B.UCYCLE_CDE                                  09370020
091300                   ,D.DD_FCTR                                     09380020
091400                   ,D.PTAG_ID                                     09390020
091500             FROM  TSK A                                          09400020
091600                  ,TMRITEM B                                      09410020
091700                  ,TMRITST D                                      09420020
091800                  ,XMT_LOC G                                      09430031
091900                  ,TSKXREF X                                      09440020
092000             WHERE  A.ITEM_NMBR        = B.ITEM_NBR               09450020
092100               AND  A.ITEM_NMBR        = D.ITEM_NBR               09460020
092200               AND  A.ITEM_NMBR        = X.ITM_NBR                09470020
092300               AND  D.STR_NBR          > 0                        09480031
092400               AND  D.FT_CDE           = 'O'                      09490020
092500               AND  D.STR_NBR          = G.LOC_NBR                09500031
092700               AND  G.E_BUS_IND        = :PC-Y                    09520031
092800               AND  X.DEPT             = :PV-HOLD-DEPT-NBR        09530020
092900               AND  X.CLASS            = :PV-HOLD-CLASS-NBR       09540020
093000               AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR         09550020
093100               AND  A.GROUP_CODE       = :PV-HOLD-GROUP-CODE      09560020
                  WITH UR                                               09561037
093200     END-EXEC.                                                    09570020
093300                                                                  09580020
093310******************************************************************09590026
093320* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      09600026
093330* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        09610026
093340* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 09620026
093350******************************************************************09630026
093400     EXEC SQL                                                     09640020
093500       DECLARE VENDOR-LEVEL CURSOR FOR                            09650020
093600             SELECT DISTINCT                                      09660020
093700                    X.DEPT                                        09670020
093800                   ,A.ENT_ID                                      09680020
093900                   ,E.ENT_NAME_DESC                               09690020
094000              FROM TSK A                                          09700020
094100                  ,TMRITEM B                                      09710020
094200                  ,TMRITST D                                      09720020
094300                  ,TENTNME E                                      09730020
094400                  ,XMT_LOC G                                      09740031
094500                  ,TSKXREF X                                      09750020
094600             WHERE  X.DEPT              = :PV-HOLD-DEPT-NBR       09760020
094700               AND  A.ITEM_NMBR         = B.ITEM_NBR              09770020
094800               AND  A.ITEM_NMBR         = D.ITEM_NBR              09780020
094900               AND  A.ITEM_NMBR         = X.ITM_NBR               09790020
095000               AND  D.STR_NBR           > 0                       09800031
095100               AND  D.FT_CDE            = 'O'                     09810020
095200               AND  A.ENT_ID            = E.ENT_ID                09820020
095300               AND  E.TYPE_CDE          = '04'                    09830020
095400               AND  D.STR_NBR           = G.LOC_NBR               09840031
095600               AND  G.E_BUS_IND         = :PC-Y                   09860031
095700                       WITH UR                                    09870020
095800     END-EXEC.                                                    09880020
095900                                                                  09890020
095910******************************************************************09900026
095920* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      09910026
095930* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        09920026
095940* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 09930026
095950******************************************************************09940026
096000     EXEC SQL                                                     09950020
096100       DECLARE VENDOR-HIST-FRCST CURSOR FOR                       09960020
096200             SELECT B.UCYCLE_CDE                                  09970020
096300                   ,C.DSD_HIST_QTY                                09980020
096400                   ,D.PTAG_ID                                     09990020
096500              FROM TSK A                                          10000020
096600                  ,TMRITEM B                                      10010020
096700                  ,TMRISHS C                                      10020020
096800                  ,TMRITST D                                      10030020
096900                  ,XMT_LOC G                                      10040031
097000                  ,TSKXREF X                                      10050020
097100               WHERE A.ITEM_NMBR        = B.ITEM_NBR              10060020
097200                AND  A.ITEM_NMBR        = C.ITM_NBR               10070020
097300                AND  A.ITEM_NMBR        = D.ITEM_NBR              10080020
097400                AND  A.ITEM_NMBR        = X.ITM_NBR               10090020
097500                AND  C.STR_NBR          = D.STR_NBR               10100020
097600                AND  C.STR_NBR          > 0                       10110031
097700                AND  D.FT_CDE           = 'O'                     10120020
097800                AND  D.STR_NBR          = G.LOC_NBR               10130031
098000                AND  G.E_BUS_IND        = :PC-Y                   10150031
098100                AND  C.YR_NBR           = :PV-HOLD-YEAR           10160020
098200                AND  C.WK_NBR           = :PV-HOLD-WEEK           10170020
098300                AND  X.DEPT             = :PV-HOLD-DEPT-NBR       10180020
098400                AND  A.ENT_ID           = :PV-HOLD-VENDOR-CODE    10190020
098500                AND  C.ITM_REV_ID      = (SELECT MAX(E.ITM_REV_ID)10200020
098600                     FROM TMRISHS E                               10210020
098700                 WHERE                                            10220020
098800                         E.ITM_NBR         =  C.ITM_NBR           10230020
098900                     AND E.STR_NBR         =  C.STR_NBR           10240020
099000                     AND E.YR_NBR          = :PV-HOLD-YEAR        10250020
099100                     AND E.WK_NBR          = :PV-HOLD-WEEK)       10260020
                       WITH UR                                          10261037
099200     END-EXEC.                                                    10270020
099300                                                                  10280020
099310******************************************************************10290026
099320* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      10300026
099330* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        10310026
099340* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 10320026
099330******************************************************************10330026
099400     EXEC SQL                                                     10340020
099500       DECLARE VENDOR-CURR-FRCST CURSOR FOR                       10350020
099600             SELECT B.UCYCLE_CDE                                  10360020
099700                   ,D.DD_FCTR                                     10370020
099800                   ,D.PTAG_ID                                     10380020
099900             FROM  TSK A                                          10390020
100000                  ,TMRITEM B                                      10400020
100100                  ,TMRITST D                                      10410020
100200                  ,XMT_LOC G                                      10420031
100300                  ,TSKXREF X                                      10430020
100400             WHERE  A.ITEM_NMBR        = B.ITEM_NBR               10440020
100500               AND  A.ITEM_NMBR        = D.ITEM_NBR               10450020
100600               AND  A.ITEM_NMBR        = X.ITM_NBR                10460020
100700               AND  D.STR_NBR          > 0                        10470031
100800               AND  D.FT_CDE           = 'O'                      10480020
100900               AND  D.STR_NBR          = G.LOC_NBR                10490031
101000               AND  G.E_BUS_IND        = :PC-Y                    10500031
101200               AND  X.DEPT             = :PV-HOLD-DEPT-NBR        10520020
101300               AND  A.ENT_ID           = :PV-HOLD-VENDOR-CODE     10530020
                   WITH UR                                              10531037
101400     END-EXEC.                                                    10540020
101500                                                                  10550020
101600 LINKAGE SECTION.                                                 10560020
101700                                                                  10570020
101800 PROCEDURE DIVISION.                                              10580020
101900****************************************************************  10590020
102000* CONTROLS THE MAIN PROCESSING OF THE PROGRAM                  *  10600020
102100****************************************************************  10610020
102200                                                                  10620020
102300 0000-PROGRAM-MAINLINE.                                           10630020
102400                                                                  10640020
102500     PERFORM A0000-INITIALIZE.                                    10650020
102600                                                                  10660020
102700     PERFORM B0000-MAINLINE                                       10670020
102800         UNTIL EOC-LEVEL-CSR.                                     10680020
102900                                                                  10690020
103000     PERFORM Z9000-EOF-PROCESSING.                                10700020
103100                                                                  10710020
103200     STOP RUN.                                                    10720020
103300                                                                  10730020
103400     EJECT                                                        10740020
103500                                                                  10750020
103600****************************************************************  10760020
103700* OPENS ALL FILES ASSOCIATED WITH THE JOB, GETS CURRENT DATE   *  10770020
103800* AND TIME FOR REPORT HEADINGS, AND GETS DEFAULT VALUES        *  10780020
103900****************************************************************  10790020
104000 A0000-INITIALIZE.                                                10800020
104100                                                                  10810020
104200     OPEN INPUT  EXCEPTION-FILE                                   10820020
104300                 BIM-FILE                                         10830020
104400          OUTPUT PRINT-REPORT.                                    10840020
104500                                                                  10850020
104600     IF  NOT SC-EXCEPT-STATUS-OK                                  10860020
104700         MOVE 'A0000-INITIALIZE'      TO PV-ABEND-PARAGRAPH       10870020
104800         MOVE 'EXCPT-FILE'            TO PV-ERROR-FILE            10880020
104900         MOVE 'OPENING INPUT FILE'    TO PV-ERROR-OPERATION       10890020
105000         MOVE 'BAD-OPEN'              TO PV-ERROR-STATUS          10900020
105100         MOVE SC-EXCEPT-STATUS        TO PV-VSAM-STATUS           10910020
105200         MOVE '//////////////'        TO PV-NOT-FOUND-KEY         10920020
105300         PERFORM Z9999-VSAM-ERROR                                 10930020
105400         MOVE +4005                   TO PV-ABEND-CODE            10940020
105500         CALL 'ILBOABN0'        USING PV-ABEND-CODE               10950020
105600     END-IF.                                                      10960020
105700                                                                  10970020
105800     IF  NOT SC-BIM-STATUS-OK                                     10980020
105900         MOVE 'A0000-INITIALIZE'      TO PV-ABEND-PARAGRAPH       10990020
106000         MOVE 'BIM-FILE'              TO PV-ERROR-FILE            11000020
106100         MOVE 'OPENING INPUT FILE'    TO PV-ERROR-OPERATION       11010020
106200         MOVE 'BAD-OPEN'              TO PV-ERROR-STATUS          11020020
106300         MOVE SC-BIM-STATUS           TO PV-VSAM-STATUS           11030020
106400         MOVE '//////////////'        TO PV-NOT-FOUND-KEY         11040020
106500         PERFORM Z9999-VSAM-ERROR                                 11050020
106600         MOVE +4005                   TO PV-ABEND-CODE            11060020
106700         CALL 'ILBOABN0'        USING PV-ABEND-CODE               11070020
106800     END-IF.                                                      11080020
106900                                                                  11090020
107000     ACCEPT CT-CPU-TIME FROM TIME.                                11100020
107100     MOVE CT-CPU-HR                   TO DP132-RUN-HOUR.          11110020
107200     MOVE CT-CPU-MIN                  TO DP132-RUN-MINUTE.        11120020
107300                                                                  11130020
107400     ACCEPT CD-SCHEDULE-DATE.                                     11140020
107500     MOVE CD-MONTH                    TO DP132-RUN-MONTH          11150020
107600                                         PV-MO.                   11160020
107700     MOVE CD-DAY                      TO DP132-RUN-DAY            11170020
107800                                         PV-DY.                   11180020
107900     MOVE CD-YEAR                     TO DP132-RUN-YEAR           11190020
108000                                         PV-YR.                   11200020
108100                                                                  11210020
108200     MOVE 1                           TO DP132-REPORT-NUMBER.     11220020
108300     MOVE 'MRKRP117'                  TO DP132-PROGRAM-NAME.      11230020
108400                                                                  11240020
108500     PERFORM A1000-POPULATE-TABLE.                                11250020
108600                                                                  11260020
108700     MOVE ZEROS                       TO EXCEPTION-KEY.           11270020
108800     PERFORM B0200-READ-INPUT-FILE.                               11280020
108900                                                                  11290020
109000     MOVE MR032-LEVEL                 TO PV-DEFAULT-LEVEL.        11300020
109100     MOVE MR032-SW-EXCEPT             TO PV-DEFAULT-SW-EXCEPT.    11310020
109200     IF PV-DEFAULT-PER                                            11320020
109300         MOVE MR032-PERCENT-VARIANCE  TO PV-DEFAULT-PERCENT       11330020
109400         COMPUTE PV-DEFAULT-NEG-PERCENT = PV-DEFAULT-PERCENT * -1 11340020
109500     ELSE                                                         11350020
109600         IF PV-DEFAULT-WOS                                        11360020
109700             MOVE MR032-LESS-THAN     TO PV-DEFAULT-LESS-WEEK     11370020
109800             MOVE MR032-MORE-THAN     TO PV-DEFAULT-MORE-WEEK     11380020
109900         END-IF                                                   11390020
110000     END-IF.                                                      11400020
110100                                                                  11410020
110200     PERFORM A3000-OPEN-DRIVING-CURSOR.                           11420020
110300                                                                  11430020
110400***************************************************************** 11440020
110500*  POPULATE MONTH TABLE                                         * 11450020
110600***************************************************************** 11460020
110700 A1000-POPULATE-TABLE.                                            11470020
110800                                                                  11480020
110900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              11490020
111000     MOVE PV-DATE             TO DPG52-LK-DATE-INPUT.             11500020
111100                                                                  11510020
111200     MOVE SPACES              TO DPG51-INCREMENT-DECREMENT-FLAG.  11520020
111300     MOVE PC-F2               TO DPG51-CALENDAR-TYPE.             11530020
111400     SET DPG52-LK-DTE-ISO     TO TRUE.                            11540020
111500                                                                  11550020
111600     PERFORM A1100-CALENDAR-ROUTINE.                              11560020
111700     MOVE DPG56-FISCAL-YEAR-CCYY TO PV-YEAR                       11570020
111800                                    PV-CURR-YEAR.                 11580020
111900     MOVE DPG56-FISCAL-WEEK-NBR  TO PV-WEEK                       11590020
112000                                    PV-CURR-WEEK.                 11600020
112100                                                                  11610020
112200     IF PV-WEEK = 53                                              11620020
112300         MOVE PC-52             TO PV-WEEK                        11630020
112400         MOVE PC-52X            TO PV-CURR-WEEK                   11640020
112500     END-IF.                                                      11650020
112600                                                                  11660020
112700     PERFORM A1200-CALCULATE-FUTURE-WEEK                          11670020
112800             VARYING PV-FUTR-INDEX       FROM 1 BY 1              11680020
112900             UNTIL PV-FUTR-INDEX       GREATER THAN PC-FIVE.      11690020
113000                                                                  11700020
113100     PERFORM A1300-CALCULATE-HIST-WEEK.                           11710020
113200                                                                  11720020
113300******************************************************************11730020
113400* CALL CALENDAR ROUTINE                                           11740020
113500******************************************************************11750020
113600 A1100-CALENDAR-ROUTINE.                                          11760020
113700                                                                  11770020
113800     CALL PC-PGM-DPKUT500 USING DPG51 DPG52                       11780020
113900                                DPG53 DPG54                       11790020
114000                                DPG55 DPG56.                      11800020
114100     EVALUATE TRUE                                                11810020
114200     WHEN DPG54-SEVERE-ERROR                                      11820020
114300         DISPLAY 'SEVERE ERROR IN CALENDAR ROUTINE'               11830020
114400         DISPLAY DPG54-ERROR-MESSAGE                              11840020
114500         DISPLAY 'INPUT DATE: '  DPG52-LK-DATE-INPUT              11850020
114600         CALL 'ILBOABN0'        USING PV-ABEND-CODE               11860020
114700     WHEN DPG54-WARNING-ERROR                                     11870020
114800         DISPLAY 'WARNING ERROR IN CALENDAR ROUTINE'              11880020
114900         DISPLAY DPG54-ERROR-MESSAGE                              11890020
115000     WHEN DPG54-NO-ERROR                                          11900020
115100         CONTINUE                                                 11910020
115200     END-EVALUATE.                                                11920020
115300                                                                  11930020
115400******************************************************************11940020
115500* CALCULATE NEXT 5 FISCAL WEEKS AND STORES THEM TO GET THE FUTURE 11950020
115600* FORECASTS.                                                      11960020
115700******************************************************************11970020
115800 A1200-CALCULATE-FUTURE-WEEK.                                     11980020
115900                                                                  11990020
116000     IF PV-WEEK  < PC-52                                          12000020
116100         ADD 1              TO PV-WEEK                            12010020
116200     ELSE                                                         12020020
116300         IF PV-WEEK = PC-52                                       12030020
116400             MOVE PC-ONE    TO   PV-WEEK                          12040020
116500             ADD 1          TO PV-YEAR                            12050020
116600         END-IF                                                   12060020
116700     END-IF.                                                      12070020
116800                                                                  12080020
116900     MOVE PV-WEEK          TO PT-FUTURE-WEEK(PV-FUTR-INDEX).      12090020
117000     MOVE PV-YEAR          TO PT-FUTURE-YEAR(PV-FUTR-INDEX).      12100020
117100                                                                  12110020
117200******************************************************************12120020
117300* CALCULATE PREV 4 FISCAL WEEKS AND STORE THEM TO GET HISTORICAL  12130020
117400* DATA.                                                           12140020
117500******************************************************************12150020
117600 A1300-CALCULATE-HIST-WEEK.                                       12160020
117700                                                                  12170020
117800     MOVE PC-FOUR           TO PV-HIST-INDEX.                     12180020
117900     MOVE PC-ONE            TO PV-DECREMENT.                      12190020
118000     PERFORM A1400-FORMAT-DATE-READ.                              12200020
118100                                                                  12210020
118200     MOVE PC-THREE          TO PV-HIST-INDEX.                     12220020
118300     ADD  PC-ONE            TO PV-DECREMENT.                      12230020
118400     PERFORM A1400-FORMAT-DATE-READ.                              12240020
118500                                                                  12250020
118600     MOVE PC-TWO            TO PV-HIST-INDEX.                     12260020
118700     ADD  PC-ONE            TO PV-DECREMENT.                      12270020
118800     PERFORM A1400-FORMAT-DATE-READ.                              12280020
118900                                                                  12290020
119000     MOVE PC-ONE            TO PV-HIST-INDEX.                     12300020
119100     ADD  PC-ONE            TO PV-DECREMENT.                      12310020
119200     PERFORM A1400-FORMAT-DATE-READ.                              12320020
119300                                                                  12330020
119400******************************************************************12340020
119500* CALCULATE PREV 4 FISCAL WEEKS AND STORE THEM TO GET HISTORICAL  12350020
119600* DATA.                                                           12360020
119700******************************************************************12370020
119800 A1400-FORMAT-DATE-READ.                                          12380020
119900                                                                  12390020
120000     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              12400020
120100     MOVE PV-CURR-WEEK-YEAR        TO DPG52-LK-DATE-INPUT.        12410020
120200     SET DPG52-LK-DTE-FISC-WEEK-CC TO TRUE.                       12420020
120300     SET DPG51-DECREMENT-DATE    TO TRUE.                         12430020
120400     MOVE PV-DECREMENT           TO DPG51-INCR-DECR-FISCAL-WEEK-9.12440020
120500     MOVE PC-F2                  TO DPG51-CALENDAR-TYPE.          12450020
120600     PERFORM A1100-CALENDAR-ROUTINE.                              12460020
120700                                                                  12470020
120800     IF DPG56-FISCAL-WEEK-NBR  =  53                              12480020
120900         ADD  PC-ONE                    TO PV-DECREMENT           12490020
121000         INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56           12500020
121100         MOVE PV-CURR-WEEK-YEAR         TO DPG52-LK-DATE-INPUT    12510020
121200         SET  DPG52-LK-DTE-FISC-WEEK-CC TO TRUE                   12520020
121300         SET  DPG51-DECREMENT-DATE      TO TRUE                   12530020
121400         MOVE PV-DECREMENT       TO DPG51-INCR-DECR-FISCAL-WEEK-9 12540020
121500         MOVE PC-F2              TO DPG51-CALENDAR-TYPE           12550020
121600         PERFORM A1100-CALENDAR-ROUTINE                           12560020
121700     END-IF.                                                      12570020
121800                                                                  12580020
121900     MOVE DPG56-FISCAL-YEAR-CCYY TO PT-HIST-YEAR(PV-HIST-INDEX).  12590020
122000     MOVE DPG56-FISCAL-WEEK-NBR  TO PT-HIST-WEEK(PV-HIST-INDEX).  12600020
122100     DISPLAY 'DATE = ' DPG55-1ST-WKDY-DB2ISO-FMT                  12610034
122100     MOVE DPG55-1ST-WKDY-DB2ISO-FMT                               12611034
122200                                 TO PT-FSCL-DATE(PV-HIST-INDEX).  12620020
122300                                                                  12630020
122400                                                                  12640020
122500******************************************************************12650020
122600* OPEN DRIVING CURSOR                                             12660020
122700******************************************************************12670020
122800 A3000-OPEN-DRIVING-CURSOR.                                       12680020
122900                                                                  12690020
123000     MOVE 'A3000'                    TO PGM-LOCATION.             12700020
123100     MOVE 'A3000-OPEN-DRIVING-CURSOR' TO PV-ABEND-PARAGRAPH.      12710020
123200                                                                  12720020
123300     EXEC SQL                                                     12730020
123400         OPEN DEPT-LEVEL                                          12740020
123500     END-EXEC.                                                    12750020
123600                                                                  12760020
123700     EVALUATE TRUE                                                12770020
123800       WHEN SQLCODE         = ZERO                                12780020
123900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    12790020
124000         CONTINUE                                                 12800020
124100       WHEN OTHER                                                 12810020
124200         DISPLAY PV-ABEND-PARAGRAPH                               12820020
124300         PERFORM Z9900-SQL-ERROR                                  12830020
124400     END-EVALUATE.                                                12840020
124500                                                                  12850020
124600******************************************************************12860020
124700* MAIN PROCESSING                                                 12870020
124800******************************************************************12880020
124900 B0000-MAINLINE.                                                  12890020
125000                                                                  12900020
125100     PERFORM B0100-FETCH-DEPT-LEVEL-CSR.                          12910020
125200                                                                  12920020
125300     IF EOC-LEVEL-CSR                                             12930020
125400         CONTINUE                                                 12940020
125500     ELSE                                                         12950020
125600         IF PV-LINE-CNT > 2                                       12960020
125700             PERFORM R1100-PRINT-HEADINGS                         12970020
125800         END-IF                                                   12980020
125900         MOVE SKXREF-DEPT          TO  PV-HOLD-DEPT-NBR           12990020
126000                                       EXCEPTION-KEY              13000020
126100         PERFORM B0200-READ-INPUT-FILE                            13010020
126200         MOVE SC-EXCEPT-STATUS             TO PV-VSAM-STATUS      13020020
126300         IF PV-NO-REC-FOUND                                       13030020
126400             MOVE PV-DEFAULT-LEVEL         TO PV-HOLD-LEVEL       13040020
126500             MOVE PV-DEFAULT-SW-EXCEPT     TO PV-HOLD-SW-EXCEPT   13050020
126600             MOVE PV-DEFAULT-PERCENT       TO PV-HOLD-PERCENT     13060020
126700             MOVE PV-DEFAULT-NEG-PERCENT   TO PV-HOLD-NEG-PERCENT 13070020
126800             MOVE PV-DEFAULT-LESS-WEEK     TO PV-HOLD-LESS-WEEK   13080020
126900             MOVE PV-DEFAULT-MORE-WEEK     TO PV-HOLD-MORE-WEEK   13090020
127000         ELSE                                                     13100020
127100             MOVE MR032-LEVEL              TO PV-HOLD-LEVEL       13110020
127200             MOVE MR032-SW-EXCEPT          TO PV-HOLD-SW-EXCEPT   13120020
127300             IF PV-HOLD-PER                                       13130020
127400                 MOVE MR032-PERCENT-VARIANCE TO PV-HOLD-PERCENT   13140020
127500                 COMPUTE PV-HOLD-NEG-PERCENT =                    13150020
127600                                          PV-HOLD-PERCENT * -1    13160020
127700             ELSE                                                 13170020
127800                 IF PV-HOLD-WOS                                   13180020
127900                     MOVE MR032-LESS-THAN  TO PV-HOLD-LESS-WEEK   13190020
128000                     MOVE MR032-MORE-THAN  TO PV-HOLD-MORE-WEEK   13200020
128100                 END-IF                                           13210020
128200             END-IF                                               13220020
128300         END-IF                                                   13230020
128400         PERFORM B1000-DECIDE-CURSOR-PATH                         13240020
128500     END-IF.                                                      13250020
128600                                                                  13260020
128700******************************************************************13270020
128800* FETCHS ROW FROM THE DRIVING CURSOR                              13280020
128900******************************************************************13290020
129000 B0100-FETCH-DEPT-LEVEL-CSR.                                      13300020
129100                                                                  13310020
129200     MOVE 'B0100'                        TO PGM-LOCATION.         13320020
129300     MOVE 'B0100-FETCH-DEPT-LEVEL-CSR' TO PV-ABEND-PARAGRAPH.     13330020
129400                                                                  13340020
129500     EXEC SQL                                                     13350020
129600       FETCH DEPT-LEVEL                                           13360020
129700        INTO                                                      13370020
129800              :SKXREF-DEPT                                        13380020
129900     END-EXEC.                                                    13390020
130000                                                                  13400020
130100     EVALUATE TRUE                                                13410020
130200       WHEN SQLCODE         = ZERO                                13420020
130300         CONTINUE                                                 13430020
130400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    13440020
130500         PERFORM Z8000-CLOSE-DEPT-LEVEL-CSR                       13450020
130600         MOVE PC-Y TO PS-EOC-LEVEL-CSR                            13460020
130700       WHEN OTHER                                                 13470020
130800         DISPLAY PV-ABEND-PARAGRAPH                               13480020
130900         PERFORM Z9900-SQL-ERROR                                  13490020
131000     END-EVALUATE.                                                13500020
131100                                                                  13510020
131200***************************************************************** 13520020
131300* B0200-READ-INPUT-FILE - EXCEPTION FILE CONTAINS THE MERCHANDISE 13530020
131400* LEVEL TO REPORT AT AND EXCEPTION CRITERIA FOR A DEPARTMENT      13540020
131500***************************************************************** 13550020
131600 B0200-READ-INPUT-FILE.                                           13560020
131700                                                                  13570020
131800     READ EXCEPTION-FILE     INTO MR032-FORECAST-V-ACTUAL-RECORD. 13580020
131900                                                                  13590020
132000***************************************************************** 13600020
132100* DECIDES WHICH LEVEL TO REPORT AT AND CREATES CONTROL BREAKS     13610020
132200***************************************************************** 13620020
132300 B1000-DECIDE-CURSOR-PATH.                                        13630020
132400                                                                  13640020
132500     EVALUATE TRUE                                                13650020
132600       WHEN PV-HOLD-LEVEL   = 'VSC'                               13660020
132700           PERFORM C0000-COLOR-STYLE-BREAK                        13670020
132800       WHEN PV-HOLD-LEVEL   = 'MCL'                               13680020
132900           PERFORM D0000-MAJOR-CLASS-BREAK                        13690020
133000       WHEN PV-HOLD-LEVEL   = 'SCL'                               13700020
133100           PERFORM E0000-SUB-CLASS-BREAK                          13710020
133200       WHEN PV-HOLD-LEVEL   = 'GRP'                               13720020
133300           PERFORM F0000-GROUP-BREAK                              13730020
133400       WHEN PV-HOLD-LEVEL   = 'VND'                               13740020
133500           PERFORM G0000-VENDOR-BREAK                             13750020
133600     END-EVALUATE.                                                13760020
133700                                                                  13770020
133800***************************************************************** 13780020
133900* READ BIM FILE TO GET BI FOR FORECAST CALCULATION                13790020
134000***************************************************************** 13800020
134100 B2000-READ-BIM-FILE.                                             13810020
134200                                                                  13820020
134300     READ BIM-FILE        INTO  PAN-BIM-FILE                      13830020
134400                                KEY IS BIM-FILE-KEY.              13840020
134500                                                                  13850020
134600     IF  NOT SC-BIM-STATUS-OK                                     13860020
134700         IF SC-BIM-RECORD-NOT-FOUND                               13870020
134800             SET BIM-RECORD-NOT-FOUND TO TRUE                     13880020
134900         ELSE                                                     13890020
135000             MOVE 'B2000-READ-BIM-FILE'   TO PV-ABEND-PARAGRAPH   13900020
135100             MOVE 'BIM-FILE'              TO PV-ERROR-FILE        13910020
135200             MOVE 'READ FILE         ' TO PV-ERROR-OPERATION      13920020
135300             MOVE 'BAD-READ'          TO PV-ERROR-STATUS          13930020
135400             MOVE SC-BIM-STATUS       TO PV-VSAM-STATUS           13940020
135500             MOVE BIM-FILE-KEY        TO PV-NOT-FOUND-KEY         13950020
135600             PERFORM Z9999-VSAM-ERROR                             13960020
135700             MOVE +4005               TO PV-ABEND-CODE            13970020
135800             CALL 'ILBOABN0'    USING PV-ABEND-CODE               13980020
135900         END-IF                                                   13990020
136000     END-IF.                                                      14000020
136100                                                                  14010020
136200***************************************************************** 14020020
136300* B3000-CALCULATE-WEEKS-SUPPLY.                                   14030020
136400***************************************************************** 14040020
136500 B3000-CALCULATE-WEEKS-SUPPLY.                                    14050020
136600                                                                  14060020
136700     MOVE PC-N  TO PS-FOUND-WEEKS-ONHAND.                         14070020
136800     MOVE ZERO  TO PV-ONHAND-COMPARE.                             14080020
136900     MOVE ZERO  TO PV-WOS.                                        14090020
137000     PERFORM B3100-FIND-WEEKS-ONHAND                              14100020
137100         VARYING PV-WOS-INDEX  FROM 1 BY 1                        14110020
137200         UNTIL FOUND-WEEKS-ONHAND                                 14120020
137300           OR PV-WOS-INDEX > PC-52.                               14130020
137400                                                                  14140020
137500     IF PV-HOLD-WOS                                               14150020
137600         IF DL3-WOS-ONHAND  = '+++'                               14160020
137700             CONTINUE                                             14170020
137800         ELSE                                                     14180020
137900             MOVE PC-N                   TO PS-WITHIN-WEEK-RANGE  14190020
138000             IF PV-HOLD-MORE-WEEK  NOT = 0                        14200020
138100                 IF PV-HOLD-MORE-WEEK < PV-WOS                    14210020
138200                     MOVE PC-Y           TO PS-WITHIN-WEEK-RANGE  14220020
138300                 END-IF                                           14230020
138400             END-IF                                               14240020
138500             IF PV-HOLD-LESS-WEEK  NOT = 0                        14250020
138600                 IF PV-HOLD-LESS-WEEK > PV-WOS                    14260020
138700                     MOVE PC-Y           TO PS-WITHIN-WEEK-RANGE  14270020
138800                 END-IF                                           14280020
138900             END-IF                                               14290020
139000             IF NOT WITHIN-WEEK-RANGE                             14300020
139100                 MOVE PC-N               TO PS-PROCESS-LINE-INFO  14310020
139200             END-IF                                               14320020
139300         END-IF                                                   14330020
139400     END-IF.                                                      14340020
139500                                                                  14350020
139600     IF PROCESS-LINE-INFO                                         14360020
139700         IF DL3-WOS-ONHAND  = '+++'                               14370020
139800            MOVE  '+++'              TO DL3-WOS-ONORDER           14380020
139900         ELSE                                                     14390020
140000            MOVE 0                   TO PV-WOO                    14400020
140100            MOVE SPACES              TO DL3-WOS-ONORDER           14410020
140200            ADD PV-ONHAND TO PV-ON-ORDER GIVING PV-ONHAND-ONORDER 14420020
140300            MOVE ZERO TO PV-ONORDER-COMPARE                       14430020
140400            MOVE PC-N TO PS-FOUND-WEEKS-ONORDER                   14440020
140500            PERFORM B3200-FIND-WEEKS-ONORDER                      14450020
140600              VARYING PV-WOS-INDEX  FROM 1 BY 1                   14460020
140700              UNTIL FOUND-WEEKS-ONORDER OR PV-WOS-INDEX > PC-52   14470020
140800            IF DL3-WOS-ONORDER  NOT EQUAL '+++'                   14480020
140900                SUBTRACT PV-WOS FROM PV-WOO                       14490020
141000                MOVE PV-WOO                TO DL3-WOS-ONORDER     14500020
141100            END-IF                                                14510020
141200         END-IF                                                   14520020
141300         SUBTRACT PV-CSTOCK FROM PV-ONHAND                        14530020
141400                                          GIVING PV-ONHAND-CSTOCK 14540020
141500         MOVE ZERO TO PV-CSTOCK-COMPARE                           14550020
141600         MOVE PC-N TO PS-FOUND-WEEKS-CSTOCK                       14560020
141700         PERFORM B3300-FIND-WEEKS-CSTOCK                          14570020
141800             VARYING PV-WOS-INDEX  FROM 1 BY 1                    14580020
141900             UNTIL FOUND-WEEKS-CSTOCK                             14590020
142000               OR PV-WOS-INDEX > PC-52                            14600020
142100     END-IF.                                                      14610020
142200                                                                  14620020
142300***************************************************************** 14630020
142400* CALCULATE WEEKS OF SUPPLY ONHAND                                14640020
142500***************************************************************** 14650020
142600 B3100-FIND-WEEKS-ONHAND.                                         14660020
142700                                                                  14670020
142800     ADD PT-FORECAST-AMOUNT(PV-WOS-INDEX) TO PV-ONHAND-COMPARE.   14680020
142900     IF PV-ONHAND-COMPARE          =  PV-ONHAND                   14690020
143000         SET FOUND-WEEKS-ONHAND TO TRUE                           14700020
143100         MOVE PV-WOS-INDEX      TO DL3-WOS-ONHAND                 14710020
143200                                   PV-WOS                         14720020
143300     ELSE                                                         14730020
143400         IF PV-ONHAND-COMPARE > PV-ONHAND                         14740020
143500             SET FOUND-WEEKS-ONHAND  TO TRUE                      14750020
143600             SUBTRACT PC-ONE         FROM PV-WOS-INDEX            14760020
143700             MOVE PV-WOS-INDEX       TO DL3-WOS-ONHAND            14770020
143800                                        PV-WOS                    14780020
143900         ELSE                                                     14790020
144000             IF PV-WOS-INDEX = PC-52                              14800020
144100                 MOVE '+++'              TO DL3-WOS-ONHAND        14810020
144200             END-IF                                               14820020
144300         END-IF                                                   14830020
144400     END-IF.                                                      14840020
144500                                                                  14850020
144600***************************************************************** 14860020
144700* CALCULATE WEEKS OF SUPPLY THAT ARE ONORDER                      14870020
144800***************************************************************** 14880020
144900 B3200-FIND-WEEKS-ONORDER.                                        14890020
145000                                                                  14900020
145100     ADD PT-FORECAST-AMOUNT(PV-WOS-INDEX) TO PV-ONORDER-COMPARE.  14910020
145200     IF PV-ONORDER-COMPARE         =  PV-ONHAND-ONORDER           14920020
145300         SET FOUND-WEEKS-ONORDER TO TRUE                          14930020
145400         MOVE PV-WOS-INDEX      TO PV-WOO                         14940020
145500     ELSE                                                         14950020
145600         IF PV-ONORDER-COMPARE > PV-ONHAND-ONORDER                14960020
145700             SET FOUND-WEEKS-ONORDER  TO TRUE                     14970020
145800             SUBTRACT PC-ONE         FROM PV-WOS-INDEX            14980020
145900             MOVE PV-WOS-INDEX       TO PV-WOO                    14990020
146000         ELSE                                                     15000020
146100             IF PV-WOS-INDEX = PC-52                              15010020
146200                 MOVE '+++'              TO DL3-WOS-ONORDER       15020020
146300             END-IF                                               15030020
146400         END-IF                                                   15040020
146500     END-IF.                                                      15050020
146600                                                                  15060020
146700***************************************************************** 15070020
146800* CALCULATE WEEKS OF SUPPLY LESS CSTOCK                           15080020
146900***************************************************************** 15090020
147000 B3300-FIND-WEEKS-CSTOCK.                                         15100020
147100                                                                  15110020
147200     ADD PT-FORECAST-AMOUNT(PV-WOS-INDEX) TO PV-CSTOCK-COMPARE.   15120020
147300     IF PV-CSTOCK-COMPARE         =  PV-ONHAND-CSTOCK             15130020
147400         SET FOUND-WEEKS-CSTOCK  TO TRUE                          15140020
147500         MOVE PV-WOS-INDEX      TO DL3-WOS-CSTOCK                 15150020
147600     ELSE                                                         15160020
147700         IF PV-CSTOCK-COMPARE > PV-ONHAND-CSTOCK                  15170020
147800             SET FOUND-WEEKS-CSTOCK   TO TRUE                     15180020
147900             SUBTRACT PC-ONE         FROM PV-WOS-INDEX            15190020
148000             MOVE PV-WOS-INDEX       TO DL3-WOS-CSTOCK            15200020
148100         ELSE                                                     15210020
148200             IF PV-WOS-INDEX = PC-52                              15220020
148300                 MOVE '+++'              TO DL3-WOS-CSTOCK        15230020
148400             END-IF                                               15240020
148500         END-IF                                                   15250020
148600     END-IF.                                                      15260020
148700                                                                  15270020
148800***************************************************************** 15280020
148900* CHECK PERCENT VARIANCE TO DECIDE IF THE REPORT LINES SHOULD     15290020
149000* BE WRITTEN.                                                     15300020
149100***************************************************************** 15310020
149200  B4000-CHECK-PERCENT-VARIANCE.                                   15320020
149300                                                                  15330020
149400     MOVE PC-N                      TO PS-WITHIN-PCNT-RANGE.      15340020
149500     PERFORM VARYING PV-PCNT-INDEX FROM 1 BY 1                    15350020
149600      UNTIL WITHIN-PCNT-RANGE OR PV-PCNT-INDEX > PC-FOUR          15360020
149700         IF DL9-DIFFRNC(PV-PCNT-INDEX) = '***'                    15370020
149800             CONTINUE                                             15380020
149900         ELSE                                                     15390020
150000             MOVE DL9-DIFFRNC-N(PV-PCNT-INDEX) TO PV-COMP-PERCENT 15400020
150100             IF PV-COMP-PERCENT           =  PV-HOLD-PERCENT      15410020
150200              OR PV-COMP-PERCENT          >  PV-HOLD-PERCENT      15420020
150300                 MOVE PC-Y                TO PS-WITHIN-PCNT-RANGE 15430020
150400             ELSE                                                 15440020
150500                 IF PV-COMP-PERCENT        =  PV-HOLD-NEG-PERCENT 15450020
150600                  OR PV-COMP-PERCENT       <  PV-HOLD-NEG-PERCENT 15460020
150700                     MOVE PC-Y            TO PS-WITHIN-PCNT-RANGE 15470020
150800                 END-IF                                           15480020
150900             END-IF                                               15490020
151000         END-IF                                                   15500020
151100     END-PERFORM.                                                 15510020
151200                                                                  15520020
151300     IF WITHIN-PCNT-RANGE                                         15530020
151400         CONTINUE                                                 15540020
151500     ELSE                                                         15550020
151600         SET DONE-PROCESSING        TO TRUE                       15560020
151700     END-IF.                                                      15570020
151800                                                                  15580020
151900***************************************************************** 15590020
152000* CALCULATE THE PERCENT OF VARIANCE FOR THE PREVIOUS FOUR WEEKS   15600020
152100***************************************************************** 15610020
152200 B4100-CALCULATE-CUMM-PCNT.                                       15620020
152300                                                                  15630020
152400     IF PV-CUMM-FRCST = 0 OR PV-CUMM-SALES = 0                    15640020
152500         MOVE 0                       TO DL9-CUMM-DIFFRNC         15650020
152600     ELSE                                                         15660020
152700        COMPUTE PV-HOLD-CUMM-FRCST-PCT =                          15670020
152800             (PV-CUMM-SALES - PV-CUMM-FRCST) / PV-CUMM-FRCST * 10015680020
152900        COMPUTE PV-CUMM-FRCST-PCT ROUNDED = PV-HOLD-CUMM-FRCST-PCT15690020
153000        MOVE PV-CUMM-FRCST-PCT       TO DL9-CUMM-DIFFRNC          15700020
153100     END-IF.                                                      15710020
153200                                                                  15720020
153300***************************************************************** 15730020
153400* CALCULATE THE PERCENT OF CSTOCK.                                15740020
153500***************************************************************** 15750020
153600 B4200-CALCULATE-CSTOCK-PERCENT.                                  15760020
153700                                                                  15770020
153800     IF PV-CSTOCK = 0 OR PV-ONHAND = 0                            15780020
153900         MOVE 0                       TO DL3-PCNT-CSTOCK          15790020
154000     ELSE                                                         15800020
154100         COMPUTE PV-HOLD-CSTOCK-PCT =                             15810020
154200                           (PV-CSTOCK / PV-ONHAND) * 100          15820020
154300         COMPUTE PV-CSTOCK-PERCENT ROUNDED = PV-HOLD-CSTOCK-PCT   15830020
154400         MOVE PV-CSTOCK-PERCENT       TO DL3-PCNT-CSTOCK          15840020
154500     END-IF.                                                      15850020
154600                                                                  15860020
154700***************************************************************** 15870020
154800* CONTROL BREAK AT THE COLOR STYLE LEVEL                          15880020
154900***************************************************************** 15890020
155000 C0000-COLOR-STYLE-BREAK.                                         15900020
155100                                                                  15910020
155200     MOVE PC-N                         TO PS-EOC-COLOR-STYLE-CSR. 15920020
155300     PERFORM C0100-OPEN-COLOR-STYLE-CSR.                          15930020
155400     PERFORM C0200-PROCESS-COLOR-STYLE-CSR                        15940020
155500                                       UNTIL EOC-COLOR-STYLE-CSR. 15950020
155600                                                                  15960020
155700***************************************************************** 15970020
155800* OPEN COLOR STYLE CURSOR                                         15980020
155900***************************************************************** 15990020
156000 C0100-OPEN-COLOR-STYLE-CSR.                                      16000020
156100                                                                  16010020
156200     MOVE 'C0100'                      TO PGM-LOCATION.           16020020
156300     MOVE 'C0100-OPEN-COLOR-STYLE-CSR' TO PV-ABEND-PARAGRAPH.     16030020
156400                                                                  16040020
156500     EXEC SQL                                                     16050020
156600         OPEN COLOR-STYLE-LEVEL                                   16060020
156700     END-EXEC.                                                    16070020
156800                                                                  16080020
156900     EVALUATE TRUE                                                16090020
157000       WHEN SQLCODE         = ZERO                                16100020
157100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    16110020
157200         CONTINUE                                                 16120020
157300       WHEN OTHER                                                 16130020
157400         DISPLAY PV-ABEND-PARAGRAPH                               16140020
157500         PERFORM Z9900-SQL-ERROR                                  16150020
157600     END-EVALUATE.                                                16160020
157700                                                                  16170020
157800***************************************************************** 16180020
157900* PROCESS COLOR STYLE CURSOR                                      16190020
158000***************************************************************** 16200020
158100 C0200-PROCESS-COLOR-STYLE-CSR.                                   16210020
158200                                                                  16220020
158300     PERFORM C0300-FETCH-COLOR-STYLE-CSR.                         16230020
158400     IF EOC-COLOR-STYLE-CSR                                       16240020
158500         CONTINUE                                                 16250020
158600     ELSE                                                         16260020
158700         MOVE SKXREF-CLASS               TO  PV-HOLD-CLASS-NBR    16270020
158800         MOVE SKXREF-SUBCLASS            TO  PV-HOLD-SCL-NBR      16280020
158900         MOVE TSK-LONG-COLOR-DESC        TO  PV-HOLD-COLOR        16290020
159000         MOVE TSK-LONG-VENDOR-STYLE      TO  PV-HOLD-STYLE        16300020
159100         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 16310020
159200         PERFORM C1000-CREATE-REPORT-LINES                        16320020
159300         IF PROCESS-LINE-INFO                                     16330020
159400             PERFORM R0000-PRINT-REPORT-LINES                     16340020
159500         END-IF                                                   16350020
159600     END-IF.                                                      16360020
159700                                                                  16370020
159800***************************************************************** 16380020
159900* FETCH COLOR STYLE CURSOR                                        16390020
160000***************************************************************** 16400020
160100  C0300-FETCH-COLOR-STYLE-CSR.                                    16410020
160200                                                                  16420020
160300     MOVE 'C0300'                       TO PGM-LOCATION.          16430020
160400     MOVE 'C0300-FETCH-COLOR-STYLE-CURSOR'                        16440020
160500                                        TO PV-ABEND-PARAGRAPH.    16450020
160600                                                                  16460020
160700     EXEC SQL                                                     16470020
160800       FETCH COLOR-STYLE-LEVEL                                    16480020
160900        INTO                                                      16490020
161000              :SKXREF-DEPT                                        16500020
161100             ,:SKXREF-CLASS                                       16510020
161200             ,:SKXREF-SUBCLASS                                    16520020
161300             ,:TSK-LONG-COLOR-DESC                                16530023
161400             ,:TSK-LONG-VENDOR-STYLE                              16540020
161500     END-EXEC.                                                    16550020
161600                                                                  16560020
161700     EVALUATE TRUE                                                16570020
161800       WHEN SQLCODE         = ZERO                                16580020
161900         CONTINUE                                                 16590020
162000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    16600020
162100         PERFORM C0400-CLOSE-COLOR-STYLE-CSR                      16610020
162200         MOVE PC-Y TO PS-EOC-COLOR-STYLE-CSR                      16620020
162300       WHEN OTHER                                                 16630020
162400         DISPLAY PV-ABEND-PARAGRAPH                               16640020
162500         PERFORM Z9900-SQL-ERROR                                  16650020
162600     END-EVALUATE.                                                16660020
162700                                                                  16670020
162800******************************************************************16680020
162900* CLOSE COLOR STYLE CURSOR                                       *16690020
163000******************************************************************16700020
163100 C0400-CLOSE-COLOR-STYLE-CSR.                                     16710020
163200                                                                  16720020
163300     MOVE 'C0400'                        TO PGM-LOCATION.         16730020
163400     MOVE 'C0400-CLOSE-COLOR-STYLE-CSR'  TO PV-ABEND-PARAGRAPH.   16740020
163500                                                                  16750020
163600     EXEC SQL                                                     16760020
163700         CLOSE COLOR-STYLE-LEVEL                                  16770020
163800     END-EXEC.                                                    16780020
163900                                                                  16790020
164000     EVALUATE TRUE                                                16800020
164100         WHEN SQLCODE EQUAL ZERO                                  16810020
164200         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      16820020
164300             CONTINUE                                             16830020
164400         WHEN OTHER                                               16840020
164500             DISPLAY PV-ABEND-PARAGRAPH                           16850020
164600             PERFORM Z9900-SQL-ERROR                              16860020
164700     END-EVALUATE.                                                16870020
164800                                                                  16880020
164900***************************************************************** 16890020
165000* SET UP DATA FOR THE REPORT LINES                                16900020
165100***************************************************************** 16910020
165200 C1000-CREATE-REPORT-LINES.                                       16920020
165300                                                                  16930020
165400     MOVE ZERO                       TO PV-CUMM-SALES.            16940020
165500     PERFORM C2000-GET-HISTORY-INFO.                              16950020
165600     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           16960020
165700                                                                  16970020
165800     MOVE ZERO                       TO PV-CUMM-FRCST.            16980020
165900     PERFORM C3000-GET-HISTORY-FORECAST.                          16990020
166000     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           17000020
166100                                                                  17010020
166200     IF PV-HOLD-PER                                               17020020
166300         PERFORM B4000-CHECK-PERCENT-VARIANCE                     17030020
166400     END-IF.                                                      17040020
166500                                                                  17050020
166600                                                                  17060020
166700     IF PROCESS-LINE-INFO                                         17070020
166800         PERFORM C4000-GET-CURRENT-INFO                           17080020
166900         PERFORM C5000-GET-CURRENT-FORECAST                       17090020
167000         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     17100020
167100     END-IF.                                                      17110020
167200                                                                  17120020
167300     IF PROCESS-LINE-INFO                                         17130020
167400         PERFORM B4100-CALCULATE-CUMM-PCNT                        17140020
167500         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   17150020
167600     END-IF.                                                      17160020
167700***************************************************************** 17170020
167800* GETS DD,  MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS     17180020
167900***************************************************************** 17190020
168000 C2000-GET-HISTORY-INFO.                                          17200020
168100                                                                  17210020
168200     PERFORM                                                      17220020
168300       VARYING PV-HIST-INDEX FROM 1 BY 1                          17230020
168400       UNTIL PV-HIST-INDEX > 4                                    17240020
168500          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        17250020
168600          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        17260020
168700          MOVE PC-N                   TO PS-EOC-HIST-CSR          17270020
168800          PERFORM C2100-FETCH-HISTORY-INFO                        17280020
168900          IF EOC-HIST-CSR                                         17290020
169000              MOVE ZEROS       TO  DL6-DD(PV-HIST-INDEX)          17300020
169100              MOVE ZEROS       TO  DL10-OH-HIST(PV-HIST-INDEX)    17310020
169200          ELSE                                                    17320020
169300              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          17330020
169400              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    17340020
169500          END-IF                                                  17350020
169600     END-PERFORM.                                                 17360020
169700                                                                  17370020
169800     PERFORM                                                      17380020
169900       VARYING PV-HIST-INDEX FROM 1 BY 1                          17390020
170000       UNTIL PV-HIST-INDEX > 4                                    17400020
170100          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   17410020
170200          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 17420020
170300          PERFORM C2300-FETCH-HIST-SLS-INFO                       17430020
170400          IF EOC-SLS-HIST-CSR                                     17440020
170500              MOVE ZEROS       TO  DL8-SALES(PV-HIST-INDEX)       17450020
170600          ELSE                                                    17460020
170700              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       17470020
170800              ADD  PV-SALES    TO  PV-CUMM-SALES                  17480020
170900          END-IF                                                  17490020
171000     END-PERFORM.                                                 17500020
171100                                                                  17510020
171200***************************************************************** 17520020
171300* FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.        17530020
171400***************************************************************** 17540020
171500 C2100-FETCH-HISTORY-INFO.                                        17550020
171600                                                                  17560020
171700     MOVE 'C2100'                       TO PGM-LOCATION.          17570020
171800     MOVE 'C2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    17580020
171900                                                                  17590020
171910******************************************************************17600026
171920* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               17610026
171930* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       17620026
171940* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 17630026
171950******************************************************************17640026
172000     EXEC SQL                                                     17650020
172100          SELECT                                                  17660020
172200                  COALESCE(SUM(C.OH_HIST_QTY),0)                  17670020
172300                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 17680020
172400                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 17690020
172500          INTO                                                    17700020
172600                :PV-ONHAND                                        17710020
172700               ,:PV-DD                                            17720020
172800               ,:PV-MADDSS                                        17730020
172900          FROM   TSK          A                                   17740020
173000                ,TMRITEM B                                        17750020
173100                ,TMRISHS C                                        17760020
173200                ,TMRITST D                                        17770020
173300                ,XMT_LOC G                                        17780031
173400                ,TSKXREF X                                        17790020
173500          WHERE  A.ITEM_NMBR         = B.ITEM_NBR                 17800020
173600            AND  A.ITEM_NMBR         = C.ITM_NBR                  17810020
173700            AND  A.ITEM_NMBR         = D.ITEM_NBR                 17820020
173800            AND  A.ITEM_NMBR         = X.ITM_NBR                  17830020
173900            AND  D.FT_CDE            = 'O'                        17840020
174000            AND  D.STR_NBR           = C.STR_NBR                  17850020
174100            AND  C.STR_NBR           > 0                          17860031
174200            AND  D.STR_NBR           = G.LOC_NBR                  17870031
174400            AND  G.E_BUS_IND         = :PC-Y                      17890031
174500            AND  C.YR_NBR            = :PV-HOLD-YEAR              17900020
174600            AND  C.WK_NBR            = :PV-HOLD-WEEK              17910020
174700            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          17920020
174800            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         17930020
174900            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           17940020
175000            AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR             17950020
175100            AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE             17960020
175200            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 17970020
175300                  FROM TMRISHS E                                  17980020
175400              WHERE                                               17990020
175500                    E.ITM_NBR         =  C.ITM_NBR                18000020
175600                AND E.STR_NBR         =  C.STR_NBR                18010020
175700                AND E.YR_NBR          = :PV-HOLD-YEAR             18020020
175800                AND E.WK_NBR          = :PV-HOLD-WEEK)            18030020
                    WITH UR                                             18031037
175900     END-EXEC.                                                    18040020
176000                                                                  18050020
176100     EVALUATE TRUE                                                18060020
176200       WHEN SQLCODE         = ZERO                                18070020
176300         CONTINUE                                                 18080020
176400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    18090020
176500         MOVE PC-Y TO PS-EOC-HIST-CSR                             18100020
176600       WHEN OTHER                                                 18110020
176700         DISPLAY PV-ABEND-PARAGRAPH                               18120020
176800         PERFORM Z9900-SQL-ERROR                                  18130020
176900     END-EVALUATE.                                                18140020
177000                                                                  18150020
177100***************************************************************** 18160020
177200* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              18170020
177300***************************************************************** 18180020
177400 C2300-FETCH-HIST-SLS-INFO.                                       18190020
177500                                                                  18200020
177600     MOVE 'C2300'                       TO PGM-LOCATION.          18210020
177700     MOVE 'C2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    18220020
177800                                                                  18230020
177810******************************************************************18240026
177820* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               18250026
177830* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       18260026
177840* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 18270026
177850******************************************************************18280026
177900     EXEC SQL                                                     18290020
178000          SELECT                                                  18300020
178100                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  18310032
178200          INTO                                                    18320020
178300                :PV-SALES                                         18330020
178400          FROM   TSK       A                                      18340020
178500                ,TMRITEM   B                                      18350020
178600                ,MHT_DLY_SLS C                                    18360031
178700                ,TMRITST   D                                      18370020
178800                ,XMT_LOC   G                                      18380031
178900                ,TSKXREF   X                                      18390020
179000          WHERE  A.ITEM_NMBR         = B.ITEM_NBR                 18400020
179200            AND  A.ITEM_NMBR         = D.ITEM_NBR                 18420020
179300            AND  A.ITEM_NMBR         = X.ITM_NBR                  18430020
179100            AND  X.SKU               = C.SKU_NBR                  18431033
179400            AND  D.FT_CDE            = 'O'                        18440020
179500            AND  D.STR_NBR           = C.STR_NBR                  18450031
179600            AND  C.STR_NBR           > 0                          18460031
179800            AND  D.STR_NBR           = G.LOC_NBR                  18480031
179900            AND  G.E_BUS_IND         = :PC-Y                      18490031
180000            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          18500020
180100            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         18510020
180200            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           18520020
180300            AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR             18530020
180400            AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE             18540020
458500            AND  C.PRCG_DTE                                       18550031
                  BETWEEN :PV-HOLD-FSCL-DATE  AND                       18551031
                     DATE(:PV-HOLD-FSCL-DATE) + 6 DAYS                  18552031
264300            AND C.SKU_STAT_CDE IN ('10', '20', '40')              18553031
                  WITH UR                                               18554037
180700     END-EXEC.                                                    18570020
180800                                                                  18580020
180900     EVALUATE TRUE                                                18590020
181000       WHEN SQLCODE         = ZERO                                18600020
181100         CONTINUE                                                 18610020
181200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    18620020
181300         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         18630020
181400       WHEN OTHER                                                 18640020
181500         DISPLAY PV-ABEND-PARAGRAPH                               18650020
181600         PERFORM Z9900-SQL-ERROR                                  18660020
181700     END-EVALUATE.                                                18670020
181800                                                                  18680020
181900***************************************************************** 18690020
182000* CALCULATES FORECAST FOR LAST 4 WEEKS                            18700020
182100***************************************************************** 18710020
182200 C3000-GET-HISTORY-FORECAST.                                      18720020
182300                                                                  18730020
182400     PERFORM                                                      18740020
182500       VARYING PV-HIST-INDEX FROM 1 BY 1                          18750020
182600       UNTIL PV-HIST-INDEX > 4                                    18760020
182700        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          18770020
182800        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          18780020
182900        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     18790020
183000        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           18800020
183100        PERFORM C3100-OPEN-HIST-FRCST-CSR                         18810020
183200        MOVE ZERO                        TO PV-TOTAL-FORECAST     18820020
183300        PERFORM C3200-LOOP-THRU-CSR                               18830020
183400                    UNTIL EOC-H-FRCST-CSR                         18840020
183500        MOVE PV-TOTAL-FORECAST                                    18850020
183600                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 18860020
183700        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 18870020
183800     END-PERFORM.                                                 18880020
183900                                                                  18890020
184000     PERFORM C3500-CALCULATE-FRCST-PERCENT                        18900020
184100       VARYING PV-HIST-INDEX FROM 1 BY 1                          18910020
184200       UNTIL PV-HIST-INDEX > 4.                                   18920020
184300                                                                  18930020
184400***************************************************************** 18940020
184500* OPEN HIST-FRCST CURSOR                                          18950020
184600***************************************************************** 18960020
184700 C3100-OPEN-HIST-FRCST-CSR.                                       18970020
184800                                                                  18980020
184900     MOVE 'C3100'                    TO PGM-LOCATION.             18990020
185000     MOVE 'C3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      19000020
185100                                                                  19010020
185200     EXEC SQL                                                     19020020
185300         OPEN CLR-STL-HIST-FRCST                                  19030020
185400     END-EXEC.                                                    19040020
185500                                                                  19050020
185600     EVALUATE TRUE                                                19060020
185700       WHEN SQLCODE         = ZERO                                19070020
185800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    19080020
185900         CONTINUE                                                 19090020
186000       WHEN OTHER                                                 19100020
186100         DISPLAY PV-ABEND-PARAGRAPH                               19110020
186200         PERFORM Z9900-SQL-ERROR                                  19120020
186300     END-EVALUATE.                                                19130020
186400                                                                  19140020
186500***************************************************************** 19150020
186600* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    19160020
186700* TO TOTAL                                                        19170020
186800***************************************************************** 19180020
186900 C3200-LOOP-THRU-CSR.                                             19190020
187000                                                                  19200020
187100     PERFORM C3300-FETCH-HIST-FRCST-CSR.                          19210020
187200     IF EOC-H-FRCST-CSR                                           19220020
187300         CONTINUE                                                 19230020
187400     ELSE                                                         19240020
187500         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                19250020
187600         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      19260020
187700         PERFORM B2000-READ-BIM-FILE                              19270020
187800         IF BIM-RECORD-FOUND                                      19280020
187900             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         19290020
188000             IF MRITEM-UCYCLE-CDE = 9                             19300020
188100                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       19310020
188200             ELSE                                                 19320020
188300                 IF MRITEM-UCYCLE-CDE = 5                         19330020
188400                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        19340020
188500                                     GIVING PV-DD-COMPUTED ROUNDED19350020
188600                 END-IF                                           19360020
188700             END-IF                                               19370020
188800             MULTIPLY PV-BI BY PV-DD-COMPUTED                     19380020
188900                                            GIVING PV-FORECAST    19390020
189000             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 19400020
189100         END-IF                                                   19410020
189200     END-IF.                                                      19420020
189300                                                                  19430020
189400***************************************************************** 19440020
189500* FETCH CLR-STL-HIST-FRCST CURSOR GETS DD AND PTAG TO READ BIM    19450020
189600* FILE                                                            19460020
189700***************************************************************** 19470020
189800 C3300-FETCH-HIST-FRCST-CSR.                                      19480020
189900                                                                  19490020
190000     MOVE 'C3300'                       TO PGM-LOCATION.          19500020
190100     MOVE 'C3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    19510020
190200                                                                  19520020
190300     EXEC SQL                                                     19530020
190400       FETCH CLR-STL-HIST-FRCST                                   19540020
190500        INTO                                                      19550020
190600              :MRITEM-UCYCLE-CDE,                                 19560020
190700              :MRISHS-DSD-HIST-QTY,                               19570020
190800              :MRITST-PTAG-ID                                     19580020
190900     END-EXEC.                                                    19590020
191000                                                                  19600020
191100     EVALUATE TRUE                                                19610020
191200       WHEN SQLCODE         = ZERO                                19620020
191300         CONTINUE                                                 19630020
191400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    19640020
191500         PERFORM C3400-CLOSE-FRCST-LEVEL-CSR                      19650020
191600         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          19660020
191700       WHEN OTHER                                                 19670020
191800         DISPLAY PV-ABEND-PARAGRAPH                               19680020
191900         PERFORM Z9900-SQL-ERROR                                  19690020
192000     END-EVALUATE.                                                19700020
192100                                                                  19710020
192200******************************************************************19720020
192300* CLOSE CLR-STL-HIST-FRCST CURSOR                               * 19730020
192400******************************************************************19740020
192500 C3400-CLOSE-FRCST-LEVEL-CSR.                                     19750020
192600                                                                  19760020
192700     MOVE 'C3400'                        TO PGM-LOCATION.         19770020
192800     MOVE 'C3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   19780020
192900                                                                  19790020
193000     EXEC SQL                                                     19800020
193100         CLOSE CLR-STL-HIST-FRCST                                 19810020
193200     END-EXEC.                                                    19820020
193300                                                                  19830020
193400     EVALUATE TRUE                                                19840020
193500         WHEN SQLCODE EQUAL ZERO                                  19850020
193600         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      19860020
193700             CONTINUE                                             19870020
193800         WHEN OTHER                                               19880020
193900             DISPLAY PV-ABEND-PARAGRAPH                           19890020
194000             PERFORM Z9900-SQL-ERROR                              19900020
194100     END-EVALUATE.                                                19910020
194200                                                                  19920020
194300***************************************************************** 19930020
194400* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     19940020
194500* WHAT WAS SOLD.                                                  19950020
194600***************************************************************** 19960020
194700 C3500-CALCULATE-FRCST-PERCENT.                                   19970020
194800                                                                  19980020
194900     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         19990020
195000     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            20000020
195100                                                                  20010020
195200     IF  PV-FORECAST = 0                                          20020020
195300         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       20030020
195400     ELSE                                                         20040020
195500         IF PV-SALES  = 0                                         20050020
195600             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     20060020
195700         ELSE                                                     20070020
195800             COMPUTE PV-FRCST-PERCENT ROUNDED =                   20080020
195900                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    20090020
196000             MOVE PV-FRCST-PERCENT                                20100020
196100                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          20110020
196200         END-IF                                                   20120020
196300     END-IF.                                                      20130020
196400                                                                  20140020
196500***************************************************************** 20150020
196600* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  20160020
196700* TIME.                                                           20170020
196800***************************************************************** 20180020
196900 C4000-GET-CURRENT-INFO.                                          20190020
197000                                                                  20200020
197100     MOVE PC-N TO PS-EOC-CURR-CSR.                                20210020
197200     PERFORM C4100-FETCH-CURRENT-INFO.                            20220020
197300     IF EOC-CURR-CSR                                              20230020
197400         MOVE ZEROS            TO  DL3-ONORDER                    20240020
197500         MOVE ZEROS            TO  DL10-ONHAND                    20250020
197600         MOVE ZEROS            TO  DL6-DD-CURR                    20260020
197700         MOVE ZEROS            TO  DL11-CSTOCK                    20270020
197800         MOVE ZEROS            TO  DL2-AVG-OSTRAT                 20280020
197900         MOVE ZEROS            TO  DL2-LEAD-TIME                  20290020
198000     ELSE                                                         20300020
198100         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    20310020
198200         MOVE PV-ONHAND        TO  DL10-ONHAND                    20320020
198300         MOVE PV-DD            TO  DL6-DD-CURR                    20330020
198400         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    20340020
198500         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 20350020
198600         MOVE PV-LT            TO  DL2-LEAD-TIME                  20360020
198700     END-IF.                                                      20370020
198800                                                                  20380020
198900***************************************************************** 20390020
199000* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  20400020
199100* AND MAXIMUM LEAD TIME                                           20410020
199200***************************************************************** 20420020
199300 C4100-FETCH-CURRENT-INFO.                                        20430020
199400                                                                  20440020
199500     MOVE 'C4100'                       TO PGM-LOCATION.          20450020
199600     MOVE 'C4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    20460020
199700                                                                  20470020
199710******************************************************************20480026
199720* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               20490026
199730* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       20500026
199740* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 20510026
199750******************************************************************20520026
199800     EXEC SQL                                                     20530020
199900          SELECT                                                  20540020
200000                  COALESCE(SUM(D.DD_FCTR),0)                      20550020
200100                , COALESCE(SUM(F.ONHAND_QTY),0)                   20560020
200200                , COALESCE(SUM(D.CSTOCK_QTY),0)                   20570020
200300                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 20580020
200400                , COALESCE(AVG(D.OSTRAT_QTY),0)                   20590020
200500                , COALESCE(MAX(LT_QTY),0)                         20600020
200600          INTO  :PV-DD                                            20610020
200700               ,:PV-ONHAND                                        20620020
200800               ,:PV-CSTOCK                                        20630020
200900               ,:PV-ON-ORDER                                      20640020
201000               ,:PV-OSTRAT                                        20650020
201100               ,:PV-LT                                            20660020
201200          FROM   TSK      A                                       20670020
201300                ,TMRITEM  B                                       20680020
201400                ,TMRITST  D                                       20690020
201500                ,TSKST    F                                       20700020
201600                ,XMT_LOC  G                                       20710031
201700                ,TSKXREF  X                                       20720020
201800          WHERE  A.ITEM_NMBR         = B.ITEM_NBR                 20730020
201900            AND  A.ITEM_NMBR         = D.ITEM_NBR                 20740020
202000            AND  A.ITEM_NMBR         = F.ITEM_NMBR                20750020
202100            AND  A.ITEM_NMBR         = X.ITM_NBR                  20760020
202200            AND  D.STR_NBR           = F.LOC_NBR                  20770032
202300            AND  D.STR_NBR           > 0                          20780031
202400            AND  D.FT_CDE            = 'O'                        20790020
202500            AND  D.STR_NBR           = G.LOC_NBR                  20800031
202700            AND  G.E_BUS_IND         = :PC-Y                      20820031
202800            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          20830020
202900            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         20840020
203000            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           20850020
203100            AND  A.LONG_COLOR_DESC   = :PV-HOLD-COLOR             20860020
203200            AND  A.LONG_VENDOR_STYLE = :PV-HOLD-STYLE             20870020
                WITH UR                                                 20871037
203300     END-EXEC.                                                    20880020
203400                                                                  20890020
203500     EVALUATE TRUE                                                20900020
203600       WHEN SQLCODE         = ZERO                                20910020
203700         CONTINUE                                                 20920020
203800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    20930020
203900         MOVE PC-Y TO PS-EOC-CURR-CSR                             20940020
204000       WHEN OTHER                                                 20950020
204100         DISPLAY PV-ABEND-PARAGRAPH                               20960020
204200         PERFORM Z9900-SQL-ERROR                                  20970020
204300     END-EVALUATE.                                                20980020
204400                                                                  20990020
204500***************************************************************** 21000020
204600* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    21010020
204700* FOR THE NEXT 52 WEEKS.                                          21020020
204800***************************************************************** 21030020
204900 C5000-GET-CURRENT-FORECAST.                                      21040020
205000                                                                  21050020
205100        PERFORM C5100-INITIALZE-TABLE.                            21060020
205200        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           21070020
205300        PERFORM C5200-OPEN-CURR-FRCST-CSR.                        21080020
205400        PERFORM C5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   21090020
205500        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           21100020
205600                                    TO DL7-CURRENT-FRCST.         21110020
205700        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           21120020
205800                                    TO DL7-FUTURE-FRCST(PC-ONE).  21130020
205900        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         21140020
206000                                    TO DL7-FUTURE-FRCST(PC-TWO).  21150020
206100        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          21160020
206200                                    TO DL7-FUTURE-FRCST(PC-THREE).21170020
206300        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          21180020
206400                                    TO DL7-FUTURE-FRCST(PC-FOUR). 21190020
206500        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           21200020
206600                                    TO DL7-FUTURE-FRCST(PC-FIVE). 21210020
206700                                                                  21220020
206800***************************************************************** 21230020
206900* INITIALZE FORECAST TABLE.                                       21240020
207000***************************************************************** 21250020
207100 C5100-INITIALZE-TABLE.                                           21260020
207200                                                                  21270020
207300        MOVE PC-ONE      TO PV-BIM-INDEX.                         21280020
207400        PERFORM UNTIL PV-BIM-INDEX > PC-52                        21290020
207500            MOVE ZEROS   TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      21300020
207600            ADD PC-ONE   TO PV-BIM-INDEX                          21310020
207700        END-PERFORM.                                              21320020
207800                                                                  21330020
207900                                                                  21340020
208000***************************************************************** 21350020
208100* OPEN CLR-STL-CURR-FRCST CURSOR                                  21360020
208200***************************************************************** 21370020
208300 C5200-OPEN-CURR-FRCST-CSR.                                       21380020
208400                                                                  21390020
208500     MOVE 'C5200'                    TO PGM-LOCATION.             21400020
208600     MOVE 'C5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      21410020
208700                                                                  21420020
208800     EXEC SQL                                                     21430020
208900         OPEN CLR-STL-CURR-FRCST                                  21440020
209000     END-EXEC.                                                    21450020
209100                                                                  21460020
209200     EVALUATE TRUE                                                21470020
209300       WHEN SQLCODE         = ZERO                                21480020
209400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    21490020
209500         CONTINUE                                                 21500020
209600       WHEN OTHER                                                 21510020
209700         DISPLAY PV-ABEND-PARAGRAPH                               21520020
209800         PERFORM Z9900-SQL-ERROR                                  21530020
209900     END-EVALUATE.                                                21540020
210000                                                                  21550020
210100***************************************************************** 21560020
210200* LOOP THRU CLR-STL-CURR-FRCST CURSOR AND CALCULATE FORECASTS.    21570020
210300***************************************************************** 21580020
210400 C5300-LOOP-THRU-CURR-CSR.                                        21590020
210500                                                                  21600020
210600     PERFORM C5400-FETCH-CURR-FRCST-CSR.                          21610020
210700     IF EOC-C-FRCST-CSR                                           21620020
210800         CONTINUE                                                 21630020
210900     ELSE                                                         21640020
211000         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           21650020
211100         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                21660020
211200         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      21670020
211300         PERFORM B2000-READ-BIM-FILE                              21680020
211400         IF BIM-RECORD-FOUND                                      21690020
211500             PERFORM C5600-CALCULATE-FORECAST                     21700020
211600                 VARYING PV-BIM-INDEX  FROM 1 BY 1                21710020
211700                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            21720020
211800         END-IF                                                   21730020
211900     END-IF.                                                      21740020
212000                                                                  21750020
212100***************************************************************** 21760020
212200* FETCH CLR-STL-CURR-FRCST CURSOR                                 21770020
212300***************************************************************** 21780020
212400 C5400-FETCH-CURR-FRCST-CSR.                                      21790020
212500                                                                  21800020
212600     MOVE 'C5400'                       TO PGM-LOCATION.          21810020
212700     MOVE 'C5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    21820020
212800                                                                  21830020
212900     EXEC SQL                                                     21840020
213000       FETCH CLR-STL-CURR-FRCST                                   21850020
213100        INTO                                                      21860020
213200              :MRITEM-UCYCLE-CDE,                                 21870020
213300              :MRITST-DD-FCTR,                                    21880020
213400              :MRITST-PTAG-ID                                     21890020
213500     END-EXEC.                                                    21900020
213600                                                                  21910020
213700     EVALUATE TRUE                                                21920020
213800       WHEN SQLCODE         = ZERO                                21930020
213900         CONTINUE                                                 21940020
214000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    21950020
214100         PERFORM C5500-CLOSE-CURR-FRCST-CSR                       21960020
214200         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          21970020
214300       WHEN OTHER                                                 21980020
214400         DISPLAY PV-ABEND-PARAGRAPH                               21990020
214500         PERFORM Z9900-SQL-ERROR                                  22000020
214600     END-EVALUATE.                                                22010020
214700                                                                  22020020
214800******************************************************************22030020
214900* CLOSE CLR-STL-CURR-FRCST CURSOR                                *22040020
215000******************************************************************22050020
215100 C5500-CLOSE-CURR-FRCST-CSR.                                      22060020
215200                                                                  22070020
215300     MOVE 'C5500'                       TO PGM-LOCATION.          22080020
215400     MOVE 'C5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    22090020
215500                                                                  22100020
215600     EXEC SQL                                                     22110020
215700         CLOSE CLR-STL-CURR-FRCST                                 22120020
215800     END-EXEC.                                                    22130020
215900                                                                  22140020
216000     EVALUATE TRUE                                                22150020
216100         WHEN SQLCODE EQUAL ZERO                                  22160020
216200         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      22170020
216300             CONTINUE                                             22180020
216400         WHEN OTHER                                               22190020
216500             DISPLAY PV-ABEND-PARAGRAPH                           22200020
216600             PERFORM Z9900-SQL-ERROR                              22210020
216700     END-EVALUATE.                                                22220020
216800                                                                  22230020
216900***************************************************************** 22240020
217000* CALCULATE FORECAST.                                             22250020
217100***************************************************************** 22260020
217200 C5600-CALCULATE-FORECAST.                                        22270020
217300                                                                  22280020
217400     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI.                22290020
217500     IF MRITEM-UCYCLE-CDE = 9                                     22300020
217600         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               22310020
217700     ELSE                                                         22320020
217800         IF MRITEM-UCYCLE-CDE = 5                                 22330020
217900             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                22340020
218000                             GIVING PV-DD-COMPUTED ROUNDED        22350020
218100         END-IF                                                   22360020
218200     END-IF.                                                      22370020
218300                                                                  22380020
218400     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        22390020
218500     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX).      22400020
218600                                                                  22410020
218700     IF PV-BIM-WEEK-INDEX = PC-52                                 22420020
218800         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    22430020
218900     ELSE                                                         22440020
219000         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    22450020
219100     END-IF.                                                      22460020
219200                                                                  22470020
219300***************************************************************** 22480020
219400* CONTROL BREAK AT THE MAJOR CLASS LEVEL                          22490020
219500***************************************************************** 22500020
219600 D0000-MAJOR-CLASS-BREAK.                                         22510020
219700                                                                  22520020
219800     MOVE PC-N                         TO PS-EOC-MAJOR-CLASS-CSR. 22530020
219900     PERFORM D0100-OPEN-MAJOR-CLASS-CSR.                          22540020
220000     PERFORM D0200-PROCESS-MAJOR-CLASS-CSR                        22550020
220100                                       UNTIL EOC-MAJOR-CLASS-CSR. 22560020
220200                                                                  22570020
220300***************************************************************** 22580020
220400* OPEN MAJOR-CLASS-LEVEL CURSOR                                   22590020
220500***************************************************************** 22600020
220600 D0100-OPEN-MAJOR-CLASS-CSR.                                      22610020
220700                                                                  22620020
220800     MOVE 'D0100'                      TO PGM-LOCATION.           22630020
220900     MOVE 'D0100-OPEN-MAJOR-CLASS-CSR' TO PV-ABEND-PARAGRAPH.     22640020
221000                                                                  22650020
221100     EXEC SQL                                                     22660020
221200         OPEN MAJOR-CLASS-LEVEL                                   22670020
221300     END-EXEC.                                                    22680020
221400                                                                  22690020
221500     EVALUATE TRUE                                                22700020
221600       WHEN SQLCODE         = ZERO                                22710020
221700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    22720020
221800         CONTINUE                                                 22730020
221900       WHEN OTHER                                                 22740020
222000         DISPLAY PV-ABEND-PARAGRAPH                               22750020
222100         PERFORM Z9900-SQL-ERROR                                  22760020
222200     END-EVALUATE.                                                22770020
222300                                                                  22780020
222400***************************************************************** 22790020
222500* D0200-PROCESS-MAJOR-CLASS-CSR                                   22800020
222600***************************************************************** 22810020
222700 D0200-PROCESS-MAJOR-CLASS-CSR.                                   22820020
222800                                                                  22830020
222900     PERFORM D0300-FETCH-MAJOR-CLASS-CSR.                         22840020
223000                                                                  22850020
223100     IF EOC-MAJOR-CLASS-CSR                                       22860020
223200         CONTINUE                                                 22870020
223300     ELSE                                                         22880020
223400         IF SKXREF-CLASS = PV-HOLD-CLASS-NBR                      22890020
223500             CONTINUE                                             22900020
223600         ELSE                                                     22910020
223700             MOVE SKXREF-CLASS       TO PV-HOLD-CLASS-NBR         22920020
223800             MOVE PC-Y               TO PS-PROCESS-LINE-INFO      22930020
223900             PERFORM D1000-CREATE-REPORT-LINES                    22940020
224000             IF PROCESS-LINE-INFO                                 22950020
224100                 PERFORM R0000-PRINT-REPORT-LINES                 22960020
224200             END-IF                                               22970020
224300         END-IF                                                   22980020
224400     END-IF.                                                      22990020
224500                                                                  23000020
224600***************************************************************** 23010020
224700* FETCH MAJOR-CLASS-LEVEL CURSOR                                  23020020
224800***************************************************************** 23030020
224900  D0300-FETCH-MAJOR-CLASS-CSR.                                    23040020
225000                                                                  23050020
225100     MOVE 'D0300'                       TO PGM-LOCATION.          23060020
225200     MOVE 'D0300-FETCH-MAJOR-CLASS-CURSOR'                        23070020
225300                                        TO PV-ABEND-PARAGRAPH.    23080020
225400                                                                  23090020
225500     EXEC SQL                                                     23100020
225600       FETCH MAJOR-CLASS-LEVEL                                    23110020
225700        INTO                                                      23120020
225800              :SKXREF-DEPT                                        23130021
225900             ,:SKXREF-CLASS                                       23140021
226100     END-EXEC.                                                    23150020
226200                                                                  23160020
226300     EVALUATE TRUE                                                23170020
226400       WHEN SQLCODE         = ZERO                                23180020
226500         CONTINUE                                                 23190020
226600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    23200020
226700         PERFORM D0400-CLOSE-MAJOR-CLASS-CSR                      23210020
226800         MOVE PC-Y TO PS-EOC-MAJOR-CLASS-CSR                      23220020
226900       WHEN OTHER                                                 23230020
227000         DISPLAY PV-ABEND-PARAGRAPH                               23240020
227100         PERFORM Z9900-SQL-ERROR                                  23250020
227200     END-EVALUATE.                                                23260020
227300                                                                  23270020
227400******************************************************************23280020
227500* CLOSE MAJOR-CLASS-LEVEL CURSOR                                 *23290020
227600******************************************************************23300020
227700 D0400-CLOSE-MAJOR-CLASS-CSR.                                     23310020
227800                                                                  23320020
227900     MOVE 'D0400'                        TO PGM-LOCATION.         23330020
228000     MOVE 'D0400-CLOSE-MAJOR-CLASS-CSR'  TO PV-ABEND-PARAGRAPH.   23340020
228100                                                                  23350020
228200     EXEC SQL                                                     23360020
228300         CLOSE MAJOR-CLASS-LEVEL                                  23370020
228400     END-EXEC.                                                    23380020
228500                                                                  23390020
228600     EVALUATE TRUE                                                23400020
228700         WHEN SQLCODE EQUAL ZERO                                  23410020
228800         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      23420020
228900             CONTINUE                                             23430020
229000         WHEN OTHER                                               23440020
229100             DISPLAY PV-ABEND-PARAGRAPH                           23450020
229200             PERFORM Z9900-SQL-ERROR                              23460020
229300     END-EVALUATE.                                                23470020
229400                                                                  23480020
229500***************************************************************** 23490020
229600* SET UP DATA FOR THE REPORT LINES                                23500020
229700***************************************************************** 23510020
229800 D1000-CREATE-REPORT-LINES.                                       23520020
229900                                                                  23530020
230000     MOVE ZERO                       TO PV-CUMM-SALES.            23540020
230100     PERFORM D2000-GET-HISTORY-INFO.                              23550020
230200     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           23560020
230300                                                                  23570020
230400     MOVE ZERO                       TO PV-CUMM-FRCST.            23580020
230500     PERFORM D3000-GET-HISTORY-FORECAST.                          23590020
230600     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           23600020
230700                                                                  23610020
230800     IF PV-HOLD-PER                                               23620020
230900         PERFORM B4000-CHECK-PERCENT-VARIANCE                     23630020
231000     END-IF.                                                      23640020
231100                                                                  23650020
231200                                                                  23660020
231300     IF PROCESS-LINE-INFO                                         23670020
231400         PERFORM D4000-GET-CURRENT-INFO                           23680020
231500         PERFORM D5000-GET-CURRENT-FORECAST                       23690020
231600         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     23700020
231700     END-IF.                                                      23710020
231800                                                                  23720020
231900     IF PROCESS-LINE-INFO                                         23730020
232000         PERFORM B4100-CALCULATE-CUMM-PCNT                        23740020
232100         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   23750020
232200     END-IF.                                                      23760020
232300                                                                  23770020
232400***************************************************************** 23780020
232500* GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS      23790020
232600***************************************************************** 23800020
232700 D2000-GET-HISTORY-INFO.                                          23810020
232800                                                                  23820020
232900     PERFORM                                                      23830020
233000       VARYING PV-HIST-INDEX FROM 1 BY 1                          23840020
233100       UNTIL PV-HIST-INDEX > 4                                    23850020
233200          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        23860020
233300          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        23870020
233400          MOVE PC-N                   TO PS-EOC-HIST-CSR          23880020
233500          PERFORM D2100-FETCH-HISTORY-INFO                        23890020
233600          IF EOC-HIST-CSR                                         23900020
233700              MOVE ZEROS       TO  DL6-DD(PV-HIST-INDEX)          23910020
233800              MOVE ZEROS       TO  DL10-OH-HIST(PV-HIST-INDEX)    23920020
233900          ELSE                                                    23930020
234000              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          23940020
234100              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    23950020
234200          END-IF                                                  23960020
234300     END-PERFORM.                                                 23970020
234400                                                                  23980020
234500     PERFORM                                                      23990020
234600       VARYING PV-HIST-INDEX FROM 1 BY 1                          24000020
234700       UNTIL PV-HIST-INDEX > 4                                    24010020
234800          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   24020020
234900          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 24030020
235000          PERFORM D2300-FETCH-HIST-SLS-INFO                       24040020
235100          IF EOC-SLS-HIST-CSR                                     24050020
235200              MOVE ZEROS       TO  DL8-SALES(PV-HIST-INDEX)       24060020
235300          ELSE                                                    24070020
235400              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       24080020
235500              ADD  PV-SALES    TO  PV-CUMM-SALES                  24090020
235600          END-IF                                                  24100020
235700     END-PERFORM.                                                 24110020
235800                                                                  24120020
235900***************************************************************** 24130020
236000* FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.        24140020
236100***************************************************************** 24150020
236200 D2100-FETCH-HISTORY-INFO.                                        24160020
236300                                                                  24170020
236400     MOVE 'D2100'                       TO PGM-LOCATION.          24180020
236500     MOVE 'D2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    24190020
236600                                                                  24200020
236610******************************************************************24210026
236620* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               24220026
236630* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       24230026
236640* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 24240026
236650******************************************************************24250026
236700     EXEC SQL                                                     24260020
236800          SELECT                                                  24270020
236900                  COALESCE(SUM(C.OH_HIST_QTY),0)                  24280020
237000                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 24290020
237100                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 24300020
237200          INTO                                                    24310020
237300                :PV-ONHAND                                        24320020
237400               ,:PV-DD                                            24330020
237500               ,:PV-MADDSS                                        24340020
237600          FROM   TSKXREF X                                        24350021
237700                ,TMRITEM B                                        24360020
237800                ,TMRISHS C                                        24370020
237900                ,TMRITST D                                        24380020
238000                ,XMT_LOC G                                        24390031
238100          WHERE  X.ITM_NBR           = B.ITEM_NBR                 24400021
238200            AND  X.ITM_NBR           = C.ITM_NBR                  24410021
238300            AND  X.ITM_NBR           = D.ITEM_NBR                 24420021
238400            AND  D.FT_CDE            = 'O'                        24430020
238500            AND  C.STR_NBR           = D.STR_NBR                  24440020
238600            AND  C.STR_NBR           > 0                          24450031
238700            AND  D.STR_NBR           = G.LOC_NBR                  24460031
238900            AND  G.E_BUS_IND         = :PC-Y                      24480031
239000            AND  C.YR_NBR            = :PV-HOLD-YEAR              24490020
239100            AND  C.WK_NBR            = :PV-HOLD-WEEK              24500020
239200            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          24510021
239300            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         24520021
239400            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 24530020
239500                  FROM TMRISHS E                                  24540020
239600              WHERE                                               24550020
239700                    E.ITM_NBR        = C.ITM_NBR                  24560020
239800                AND E.STR_NBR        = C.STR_NBR                  24570020
239900                AND E.YR_NBR         = :PV-HOLD-YEAR              24580020
240000                AND E.WK_NBR         = :PV-HOLD-WEEK)             24590020
                  WITH UR                                               24591037
240100     END-EXEC.                                                    24600020
240200                                                                  24610020
240300     EVALUATE TRUE                                                24620020
240400       WHEN SQLCODE         = ZERO                                24630020
240500         CONTINUE                                                 24640020
240600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    24650020
240700         MOVE PC-Y TO PS-EOC-HIST-CSR                             24660020
240800       WHEN OTHER                                                 24670020
240900         DISPLAY PV-ABEND-PARAGRAPH                               24680020
241000         PERFORM Z9900-SQL-ERROR                                  24690020
241100     END-EVALUATE.                                                24700020
241200                                                                  24710020
241300***************************************************************** 24720020
241400* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              24730020
241500***************************************************************** 24740020
241600 D2300-FETCH-HIST-SLS-INFO.                                       24750020
241700                                                                  24760020
241800     MOVE 'D2300'                       TO PGM-LOCATION.          24770020
241900     MOVE 'D2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    24780020
242000                                                                  24790020
242010******************************************************************24800026
242020* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               24810026
242030* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       24820026
242040* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 24830026
242050******************************************************************24840026
242100     EXEC SQL                                                     24850020
242200          SELECT                                                  24860020
242300                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  24870032
242400          INTO                                                    24880020
242500                :PV-SALES                                         24890020
242600          FROM   TSKXREF  X                                       24900021
242700                ,TMRITEM  B                                       24910021
242800                ,MHT_DLY_SLS C                                    24920031
242900                ,TMRITST  D                                       24930021
243000                ,XMT_LOC  G                                       24940031
243100          WHERE  X.ITM_NBR          = B.ITEM_NBR                  24950021
179100            AND  X.SKU               = C.SKU_NBR                  24961033
243300            AND  X.ITM_NBR          = D.ITEM_NBR                  24970021
243400            AND  D.FT_CDE           = 'O'                         24980020
243500            AND  D.STR_NBR          = C.STR_NBR                   24990031
243600            AND  C.STR_NBR          > 0                           25000031
243700            AND  D.STR_NBR          = G.LOC_NBR                   25010031
243900            AND  G.E_BUS_IND        = :PC-Y                       25030031
244000            AND  X.DEPT             = :PV-HOLD-DEPT-NBR           25040021
244100            AND  X.CLASS            = :PV-HOLD-CLASS-NBR          25050021
458500            AND  C.PRCG_DTE                                       25061031
                  BETWEEN :PV-HOLD-FSCL-DATE  AND                       25062031
                     DATE(:PV-HOLD-FSCL-DATE) + 6 DAYS                  25063031
264300            AND C.SKU_STAT_CDE IN ('10', '20', '40')              25064031
                WITH UR                                                 25065037
244400     END-EXEC.                                                    25080020
244500                                                                  25090020
244600     EVALUATE TRUE                                                25100020
244700       WHEN SQLCODE         = ZERO                                25110020
244800         CONTINUE                                                 25120020
244900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    25130020
245000         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         25140020
245100       WHEN OTHER                                                 25150020
245200         DISPLAY PV-ABEND-PARAGRAPH                               25160020
245300         PERFORM Z9900-SQL-ERROR                                  25170020
245400     END-EVALUATE.                                                25180020
245500                                                                  25190020
245600***************************************************************** 25200020
245700* CALCULATES FORECAST FOR LAST 4 WEEKS                            25210020
245800***************************************************************** 25220020
245900 D3000-GET-HISTORY-FORECAST.                                      25230020
246000                                                                  25240020
246100     PERFORM                                                      25250020
246200       VARYING PV-HIST-INDEX FROM 1 BY 1                          25260020
246300       UNTIL PV-HIST-INDEX > 4                                    25270020
246400        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          25280020
246500        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          25290020
246600        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     25300020
246700        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           25310020
246800        PERFORM D3100-OPEN-HIST-FRCST-CSR                         25320020
246900        MOVE ZERO                        TO PV-TOTAL-FORECAST     25330020
247000        PERFORM D3200-LOOP-THRU-CSR                               25340020
247100                    UNTIL EOC-H-FRCST-CSR                         25350020
247200        MOVE PV-TOTAL-FORECAST                                    25360020
247300                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 25370020
247400        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 25380020
247500     END-PERFORM.                                                 25390020
247600                                                                  25400020
247700     PERFORM D3500-CALCULATE-FRCST-PERCENT                        25410020
247800       VARYING PV-HIST-INDEX FROM 1 BY 1                          25420020
247900       UNTIL PV-HIST-INDEX > 4.                                   25430020
248000                                                                  25440020
248100***************************************************************** 25450020
248200* OPEN MAJ-CLS-HIST-FRCST CURSOR                                  25460020
248300***************************************************************** 25470020
248400 D3100-OPEN-HIST-FRCST-CSR.                                       25480020
248500                                                                  25490020
248600     MOVE 'D3100'                     TO PGM-LOCATION.            25500020
248700     MOVE 'D3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      25510020
248800                                                                  25520020
248900     EXEC SQL                                                     25530020
249000         OPEN MAJ-CLS-HIST-FRCST                                  25540020
249100     END-EXEC.                                                    25550020
249200                                                                  25560020
249300     EVALUATE TRUE                                                25570020
249400       WHEN SQLCODE         = ZERO                                25580020
249500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    25590020
249600         CONTINUE                                                 25600020
249700       WHEN OTHER                                                 25610020
249800         DISPLAY PV-ABEND-PARAGRAPH                               25620020
249900         PERFORM Z9900-SQL-ERROR                                  25630020
250000     END-EVALUATE.                                                25640020
250100                                                                  25650020
250200***************************************************************** 25660020
250300* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    25670020
250400* TO TOTAL                                                        25680020
250500***************************************************************** 25690020
250600 D3200-LOOP-THRU-CSR.                                             25700020
250700                                                                  25710020
250800     PERFORM D3300-FETCH-HIST-FRCST-CSR.                          25720020
250900                                                                  25730020
251000     IF EOC-H-FRCST-CSR                                           25740020
251100         CONTINUE                                                 25750020
251200     ELSE                                                         25760020
251300         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                25770020
251400         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      25780020
251500         PERFORM B2000-READ-BIM-FILE                              25790020
251600         IF BIM-RECORD-FOUND                                      25800020
251700             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         25810020
251800             IF MRITEM-UCYCLE-CDE = 9                             25820020
251900                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       25830020
252000             ELSE                                                 25840020
252100                 IF MRITEM-UCYCLE-CDE = 5                         25850020
252200                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        25860020
252300                                     GIVING PV-DD-COMPUTED ROUNDED25870020
252400                 END-IF                                           25880020
252500             END-IF                                               25890020
252600             MULTIPLY PV-BI BY PV-DD-COMPUTED                     25900020
252700                                            GIVING PV-FORECAST    25910020
252800             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 25920020
252900         END-IF                                                   25930020
253000     END-IF.                                                      25940020
253100                                                                  25950020
253200***************************************************************** 25960020
253300* FETCH MAJ-CLS-HIST-FRCST CURSOR - GETS DD AND PTAG TO READ BIM  25970020
253400* FILE                                                            25980020
253500***************************************************************** 25990020
253600 D3300-FETCH-HIST-FRCST-CSR.                                      26000020
253700                                                                  26010020
253800     MOVE 'D3300'                       TO PGM-LOCATION.          26020020
253900     MOVE 'D3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    26030020
254000                                                                  26040020
254100     EXEC SQL                                                     26050020
254200       FETCH MAJ-CLS-HIST-FRCST                                   26060020
254300        INTO                                                      26070020
254400              :MRITEM-UCYCLE-CDE,                                 26080020
254500              :MRISHS-DSD-HIST-QTY,                               26090020
254600              :MRITST-PTAG-ID                                     26100020
254700     END-EXEC.                                                    26110020
254800                                                                  26120020
254900     EVALUATE TRUE                                                26130020
255000       WHEN SQLCODE         = ZERO                                26140020
255100         CONTINUE                                                 26150020
255200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    26160020
255300         PERFORM D3400-CLOSE-FRCST-LEVEL-CSR                      26170020
255400         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          26180020
255500       WHEN OTHER                                                 26190020
255600         DISPLAY PV-ABEND-PARAGRAPH                               26200020
255700         PERFORM Z9900-SQL-ERROR                                  26210020
255800     END-EVALUATE.                                                26220020
255900                                                                  26230020
256000******************************************************************26240020
256100* CLOSE MAJ CLS-HIST-FRCST CURSOR                                *26250020
256200******************************************************************26260020
256300 D3400-CLOSE-FRCST-LEVEL-CSR.                                     26270020
256400                                                                  26280020
256500     MOVE 'D3400'                        TO PGM-LOCATION.         26290020
256600     MOVE 'D3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   26300020
256700                                                                  26310020
256800     EXEC SQL                                                     26320020
256900         CLOSE MAJ-CLS-HIST-FRCST                                 26330020
257000     END-EXEC.                                                    26340020
257100                                                                  26350020
257200     EVALUATE TRUE                                                26360020
257300         WHEN SQLCODE EQUAL ZERO                                  26370020
257400         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      26380020
257500             CONTINUE                                             26390020
257600         WHEN OTHER                                               26400020
257700             DISPLAY PV-ABEND-PARAGRAPH                           26410020
257800             PERFORM Z9900-SQL-ERROR                              26420020
257900     END-EVALUATE.                                                26430020
258000                                                                  26440020
258100***************************************************************** 26450020
258200* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     26460020
258300* WHAT WAS SOLD.                                                  26470020
258400***************************************************************** 26480020
258500 D3500-CALCULATE-FRCST-PERCENT.                                   26490020
258600                                                                  26500020
258700     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         26510020
258800     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            26520020
258900                                                                  26530020
259000     IF  PV-FORECAST = 0                                          26540020
259100         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       26550020
259200     ELSE                                                         26560020
259300         IF  PV-SALES  = 0                                        26570020
259400             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     26580020
259500         ELSE                                                     26590020
259600             COMPUTE PV-FRCST-PERCENT ROUNDED =                   26600020
259700                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    26610020
259800             MOVE PV-FRCST-PERCENT                                26620020
259900                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          26630020
260000         END-IF                                                   26640020
260100     END-IF.                                                      26650020
260200                                                                  26660020
260300***************************************************************** 26670020
260400* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  26680020
260500* TIME.                                                           26690020
260600***************************************************************** 26700020
260700 D4000-GET-CURRENT-INFO.                                          26710020
260800                                                                  26720020
260900     MOVE PC-N TO PS-EOC-CURR-CSR                                 26730020
261000     PERFORM D4100-FETCH-CURRENT-INFO.                            26740020
261100                                                                  26750020
261200     IF EOC-CURR-CSR                                              26760020
261300         MOVE ZEROES           TO  DL3-ONORDER                    26770020
261400         MOVE ZEROES           TO  DL10-ONHAND                    26780020
261500         MOVE ZEROES           TO  DL6-DD-CURR                    26790020
261600         MOVE ZEROES           TO  DL11-CSTOCK                    26800020
261700         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 26810020
261800         MOVE ZEROES           TO  DL2-LEAD-TIME                  26820020
261900     ELSE                                                         26830020
262000         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    26840020
262100         MOVE PV-ONHAND        TO  DL10-ONHAND                    26850020
262200         MOVE PV-DD            TO  DL6-DD-CURR                    26860020
262300         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    26870020
262400         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 26880020
262500         MOVE PV-LT            TO  DL2-LEAD-TIME                  26890020
262600     END-IF.                                                      26900020
262700                                                                  26910020
262800***************************************************************** 26920020
262900* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  26930020
263000***************************************************************** 26940020
263100 D4100-FETCH-CURRENT-INFO.                                        26950020
263200                                                                  26960020
263300     MOVE 'D4100'                       TO PGM-LOCATION.          26970020
263400     MOVE 'D4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    26980020
263500                                                                  26990020
263510******************************************************************27000026
263520* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               27010026
263530* MRNIS-RFC   CURRENT    DEPT, CLASS FROM TSKXREF                 27020026
263540* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 27030026
263550******************************************************************27040026
263600     EXEC SQL                                                     27050020
263700          SELECT                                                  27060020
263800                  COALESCE(SUM(D.DD_FCTR),0)                      27070020
263900                , COALESCE(SUM(F.ONHAND_QTY),0)                   27080020
264000                , COALESCE(SUM(D.CSTOCK_QTY),0)                   27090020
264100                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 27100020
264200                , COALESCE(AVG(D.OSTRAT_QTY),0)                   27110020
264300                , COALESCE(MAX(LT_QTY),0)                         27120020
264400          INTO  :PV-DD                                            27130020
264500               ,:PV-ONHAND                                        27140020
264600               ,:PV-CSTOCK                                        27150020
264700               ,:PV-ON-ORDER                                      27160020
264800               ,:PV-OSTRAT                                        27170020
264900               ,:PV-LT                                            27180020
265000          FROM   TSKXREF X                                        27190021
265100                ,TMRITEM B                                        27200020
265200                ,TMRITST D                                        27210020
265300                ,TSKST   F                                        27220021
265400                ,XMT_LOC G                                        27230031
265500          WHERE  X.ITM_NBR            = B.ITEM_NBR                27240021
265600            AND  X.ITM_NBR            = D.ITEM_NBR                27250021
265700            AND  X.ITM_NBR            = F.ITEM_NMBR               27260021
265800            AND  D.STR_NBR            = F.LOC_NBR                 27270032
265900            AND  D.STR_NBR            > 0                         27280031
266000            AND  D.FT_CDE             = 'O'                       27290020
266100            AND  D.STR_NBR            = G.LOC_NBR                 27300031
266300            AND  G.E_BUS_IND          = :PC-Y                     27320031
266400            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         27330021
266500            AND  X.CLASS              = :PV-HOLD-CLASS-NBR        27340021
                WITH UR                                                 27341037
266600     END-EXEC.                                                    27350020
266700                                                                  27360020
266800     EVALUATE TRUE                                                27370020
266900       WHEN SQLCODE         = ZERO                                27380020
267000         CONTINUE                                                 27390020
267100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    27400020
267200         MOVE PC-Y TO PS-EOC-CURR-CSR                             27410020
267300       WHEN OTHER                                                 27420020
267400         DISPLAY PV-ABEND-PARAGRAPH                               27430020
267500         PERFORM Z9900-SQL-ERROR                                  27440020
267600     END-EVALUATE.                                                27450020
267700                                                                  27460020
267800***************************************************************** 27470020
267900* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    27480020
268000* FOR THE NEXT 52 WEEKS.                                          27490020
268100***************************************************************** 27500020
268200 D5000-GET-CURRENT-FORECAST.                                      27510020
268300                                                                  27520020
268400        PERFORM D5100-INITIALZE-TABLE.                            27530020
268500        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           27540020
268600        PERFORM D5200-OPEN-CURR-FRCST-CSR.                        27550020
268700        PERFORM D5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   27560020
268800        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           27570020
268900                                    TO DL7-CURRENT-FRCST.         27580020
269000        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           27590020
269100                                    TO DL7-FUTURE-FRCST(PC-ONE).  27600020
269200        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         27610020
269300                                    TO DL7-FUTURE-FRCST(PC-TWO).  27620020
269400        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          27630020
269500                                    TO DL7-FUTURE-FRCST(PC-THREE).27640020
269600        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          27650020
269700                                    TO DL7-FUTURE-FRCST(PC-FOUR). 27660020
269800        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           27670020
269900                                    TO DL7-FUTURE-FRCST(PC-FIVE). 27680020
270000                                                                  27690020
270100***************************************************************** 27700020
270200* INITIALZE FORECAST TABLE.                                       27710020
270300***************************************************************** 27720020
270400 D5100-INITIALZE-TABLE.                                           27730020
270500                                                                  27740020
270600        MOVE PC-ONE      TO PV-BIM-INDEX.                         27750020
270700        PERFORM UNTIL PV-BIM-INDEX > PC-52                        27760020
270800            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      27770020
270900            ADD PC-ONE   TO PV-BIM-INDEX                          27780020
271000        END-PERFORM.                                              27790020
271100                                                                  27800020
271200                                                                  27810020
271300***************************************************************** 27820020
271400* OPEN MAJ-CLS-CURR-FRCST CURSOR                                  27830020
271500***************************************************************** 27840020
271600 D5200-OPEN-CURR-FRCST-CSR.                                       27850020
271700                                                                  27860020
271800     MOVE 'D5200'                    TO PGM-LOCATION.             27870020
271900     MOVE 'D5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      27880020
272000                                                                  27890020
272100     EXEC SQL                                                     27900020
272200         OPEN MAJ-CLS-CURR-FRCST                                  27910020
272300     END-EXEC.                                                    27920020
272400                                                                  27930020
272500     EVALUATE TRUE                                                27940020
272600       WHEN SQLCODE         = ZERO                                27950020
272700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    27960020
272800         CONTINUE                                                 27970020
272900       WHEN OTHER                                                 27980020
273000         DISPLAY PV-ABEND-PARAGRAPH                               27990020
273100         PERFORM Z9900-SQL-ERROR                                  28000020
273200     END-EVALUATE.                                                28010020
273300                                                                  28020020
273400***************************************************************** 28030020
273500* LOOP THRU CLR-STL-CURR-FRCST CURSOR AND CALCULATE FORECASTS.    28040020
273600***************************************************************** 28050020
273700 D5300-LOOP-THRU-CURR-CSR.                                        28060020
273800                                                                  28070020
273900     PERFORM D5400-FETCH-CURR-FRCST-CSR.                          28080020
274000     IF EOC-C-FRCST-CSR                                           28090020
274100         CONTINUE                                                 28100020
274200     ELSE                                                         28110020
274300         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           28120020
274400         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                28130020
274500         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      28140020
274600         PERFORM B2000-READ-BIM-FILE                              28150020
274700         IF BIM-RECORD-FOUND                                      28160020
274800             PERFORM D5600-CALCULATE-FORECAST                     28170020
274900                 VARYING PV-BIM-INDEX  FROM 1 BY 1                28180020
275000                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            28190020
275100         END-IF                                                   28200020
275200     END-IF.                                                      28210020
275300                                                                  28220020
275400***************************************************************** 28230020
275500* FETCH MAJ-CLS-CURR-FRCST CURSOR                                 28240020
275600***************************************************************** 28250020
275700 D5400-FETCH-CURR-FRCST-CSR.                                      28260020
275800                                                                  28270020
275900     MOVE 'D5400'                       TO PGM-LOCATION.          28280020
276000     MOVE 'D5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    28290020
276100                                                                  28300020
276200     EXEC SQL                                                     28310020
276300       FETCH MAJ-CLS-CURR-FRCST                                   28320020
276400        INTO                                                      28330020
276500              :MRITEM-UCYCLE-CDE,                                 28340020
276600              :MRITST-DD-FCTR,                                    28350020
276700              :MRITST-PTAG-ID                                     28360020
276800     END-EXEC.                                                    28370020
276900                                                                  28380020
277000     EVALUATE TRUE                                                28390020
277100       WHEN SQLCODE         = ZERO                                28400020
277200         CONTINUE                                                 28410020
277300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    28420020
277400         PERFORM D5500-CLOSE-CURR-FRCST-CSR                       28430020
277500         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          28440020
277600       WHEN OTHER                                                 28450020
277700         DISPLAY PV-ABEND-PARAGRAPH                               28460020
277800         PERFORM Z9900-SQL-ERROR                                  28470020
277900     END-EVALUATE.                                                28480020
278000                                                                  28490020
278100******************************************************************28500020
278200*  CLOSE MAJ-CLS-CURR-FRCST CURSOR                               *28510020
278300******************************************************************28520020
278400 D5500-CLOSE-CURR-FRCST-CSR.                                      28530020
278500*                                                                 28540020
278600     MOVE 'D5500'                       TO PGM-LOCATION.          28550020
278700     MOVE 'D5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    28560020
278800                                                                  28570020
278900     EXEC SQL                                                     28580020
279000         CLOSE MAJ-CLS-CURR-FRCST                                 28590020
279100     END-EXEC.                                                    28600020
279200                                                                  28610020
279300     EVALUATE TRUE                                                28620020
279400         WHEN SQLCODE EQUAL ZERO                                  28630020
279500         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      28640020
279600             CONTINUE                                             28650020
279700         WHEN OTHER                                               28660020
279800             DISPLAY PV-ABEND-PARAGRAPH                           28670020
279900             PERFORM Z9900-SQL-ERROR                              28680020
280000     END-EVALUATE.                                                28690020
280100                                                                  28700020
280200***************************************************************** 28710020
280300* CALCULATE FORECAST.                                             28720020
280400***************************************************************** 28730020
280500 D5600-CALCULATE-FORECAST.                                        28740020
280600                                                                  28750020
280700     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 28760020
280800     IF MRITEM-UCYCLE-CDE = 9                                     28770020
280900         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               28780020
281000     ELSE                                                         28790020
281100         IF MRITEM-UCYCLE-CDE = 5                                 28800020
281200             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                28810020
281300                            GIVING PV-DD-COMPUTED ROUNDED         28820020
281400         END-IF                                                   28830020
281500     END-IF.                                                      28840020
281600                                                                  28850020
281700     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        28860020
281800     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX).      28870020
281900                                                                  28880020
282000     IF PV-BIM-WEEK-INDEX = PC-52                                 28890020
282100         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    28900020
282200     ELSE                                                         28910020
282300         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    28920020
282400     END-IF.                                                      28930020
282500                                                                  28940020
282600                                                                  28950020
282700***************************************************************** 28960020
282800* CONTROL BREAK AT THE SUB CLASS LEVEL                            28970020
282900***************************************************************** 28980020
283000 E0000-SUB-CLASS-BREAK.                                           28990020
283100                                                                  29000020
283200     MOVE PC-N                         TO PS-EOC-SUB-CLASS-CSR.   29010020
283300     PERFORM E0100-OPEN-SUB-CLASS-CSR.                            29020020
283400     PERFORM E0200-PROCESS-SUB-CLASS-CSR                          29030020
283500                                       UNTIL EOC-SUB-CLASS-CSR.   29040020
283600                                                                  29050020
283700***************************************************************** 29060020
283800*  OPEN SUB CLASS CURSOR                                          29070020
283900***************************************************************** 29080020
284000 E0100-OPEN-SUB-CLASS-CSR.                                        29090020
284100                                                                  29100020
284200     MOVE 'E0100'                      TO PGM-LOCATION.           29110020
284300     MOVE 'E0100-OPEN-SUB-CLASS-CSR'   TO PV-ABEND-PARAGRAPH.     29120020
284400                                                                  29130020
284500     EXEC SQL                                                     29140020
284600         OPEN SUB-CLASS-LEVEL                                     29150020
284700     END-EXEC.                                                    29160020
284800                                                                  29170020
284900     EVALUATE TRUE                                                29180020
285000       WHEN SQLCODE         = ZERO                                29190020
285100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    29200020
285200         CONTINUE                                                 29210020
285300       WHEN OTHER                                                 29220020
285400         DISPLAY PV-ABEND-PARAGRAPH                               29230020
285500         PERFORM Z9900-SQL-ERROR                                  29240020
285600     END-EVALUATE.                                                29250020
285700                                                                  29260020
285800***************************************************************** 29270020
285900* PROCESS SUB CLASS CURSOR                                        29280020
286000***************************************************************** 29290020
286100 E0200-PROCESS-SUB-CLASS-CSR.                                     29300020
286200                                                                  29310020
286300     PERFORM E0300-FETCH-SUB-CLASS-CSR.                           29320020
286400     IF EOC-SUB-CLASS-CSR                                         29330020
286500         CONTINUE                                                 29340020
286600     ELSE                                                         29350020
286700         MOVE SKXREF-CLASS               TO  PV-HOLD-CLASS-NBR    29360021
286800         MOVE SKXREF-SUBCLASS            TO  PV-HOLD-SCL-NBR      29370021
286900         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 29380020
287000         PERFORM E1000-CREATE-REPORT-LINES                        29390020
287100         IF PROCESS-LINE-INFO                                     29400020
287200             PERFORM R0000-PRINT-REPORT-LINES                     29410020
287300         END-IF                                                   29420020
287400     END-IF.                                                      29430020
287500                                                                  29440020
287600***************************************************************** 29450020
287700* FETCH SUB CLASS CURSOR                                          29460020
287800***************************************************************** 29470020
287900  E0300-FETCH-SUB-CLASS-CSR.                                      29480020
288000                                                                  29490020
288100     MOVE 'E0300'                       TO PGM-LOCATION.          29500020
288200     MOVE 'E0300-FETCH-SUB-CLASS-CURSOR'                          29510020
288300                                        TO PV-ABEND-PARAGRAPH.    29520020
288400                                                                  29530020
288500     EXEC SQL                                                     29540020
288600       FETCH SUB-CLASS-LEVEL                                      29550020
288700        INTO                                                      29560020
288800              :SKXREF-DEPT                                        29570021
288900             ,:SKXREF-CLASS                                       29580021
289000             ,:SKXREF-SUBCLASS                                    29590021
289100     END-EXEC.                                                    29600020
289200                                                                  29610020
289300     EVALUATE TRUE                                                29620020
289400       WHEN SQLCODE         = ZERO                                29630020
289500         CONTINUE                                                 29640020
289600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    29650020
289700         PERFORM E0400-CLOSE-SUB-CLASS-CSR                        29660020
289800         MOVE PC-Y TO PS-EOC-SUB-CLASS-CSR                        29670020
289900       WHEN OTHER                                                 29680020
290000         DISPLAY PV-ABEND-PARAGRAPH                               29690020
290100         PERFORM Z9900-SQL-ERROR                                  29700020
290200     END-EVALUATE.                                                29710020
290300                                                                  29720020
290400******************************************************************29730020
290500*  CLOSE SUB CLASS CURSOR                                        *29740020
290600******************************************************************29750020
290700 E0400-CLOSE-SUB-CLASS-CSR.                                       29760020
290800                                                                  29770020
290900     MOVE 'E0400'                        TO PGM-LOCATION.         29780020
291000     MOVE 'E0400-CLOSE-SUB-CLASS-CSR'    TO PV-ABEND-PARAGRAPH.   29790020
291100                                                                  29800020
291200     EXEC SQL                                                     29810020
291300         CLOSE SUB-CLASS-LEVEL                                    29820020
291400     END-EXEC.                                                    29830020
291500                                                                  29840020
291600     EVALUATE TRUE                                                29850020
291700         WHEN SQLCODE EQUAL ZERO                                  29860020
291800         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      29870020
291900             CONTINUE                                             29880020
292000         WHEN OTHER                                               29890020
292100             DISPLAY PV-ABEND-PARAGRAPH                           29900020
292200             PERFORM Z9900-SQL-ERROR                              29910020
292300     END-EVALUATE.                                                29920020
292400                                                                  29930020
292500***************************************************************** 29940020
292600* SET UP DATA FOR THE REPORT LINES                                29950020
292700***************************************************************** 29960020
292800 E1000-CREATE-REPORT-LINES.                                       29970020
292900                                                                  29980020
293000     MOVE ZERO                       TO PV-CUMM-SALES.            29990020
293100     PERFORM E2000-GET-HISTORY-INFO.                              30000020
293200     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           30010020
293300                                                                  30020020
293400     MOVE ZERO                       TO PV-CUMM-FRCST.            30030020
293500     PERFORM E3000-GET-HISTORY-FORECAST.                          30040020
293600     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           30050020
293700                                                                  30060020
293800     IF PV-HOLD-PER                                               30070020
293900         PERFORM B4000-CHECK-PERCENT-VARIANCE                     30080020
294000     END-IF.                                                      30090020
294100                                                                  30100020
294200                                                                  30110020
294300     IF PROCESS-LINE-INFO                                         30120020
294400         PERFORM E4000-GET-CURRENT-INFO                           30130020
294500         PERFORM E5000-GET-CURRENT-FORECAST                       30140020
294600         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     30150020
294700     END-IF.                                                      30160020
294800                                                                  30170020
294900     IF PROCESS-LINE-INFO                                         30180020
295000         PERFORM B4100-CALCULATE-CUMM-PCNT                        30190020
295100         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   30200020
295200     END-IF.                                                      30210020
295300                                                                  30220020
295400***************************************************************** 30230020
295500* GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS      30240020
295600***************************************************************** 30250020
295700 E2000-GET-HISTORY-INFO.                                          30260020
295800                                                                  30270020
295900     PERFORM                                                      30280020
296000       VARYING PV-HIST-INDEX FROM 1 BY 1                          30290020
296100       UNTIL PV-HIST-INDEX > 4                                    30300020
296200          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        30310020
296300          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        30320020
296400          MOVE PC-N                   TO PS-EOC-HIST-CSR          30330020
296500          PERFORM E2100-FETCH-HISTORY-INFO                        30340020
296600          IF EOC-HIST-CSR                                         30350020
296700              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          30360020
296800              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    30370020
296900          ELSE                                                    30380020
297000              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          30390020
297100              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    30400020
297200          END-IF                                                  30410020
297300     END-PERFORM.                                                 30420020
297400                                                                  30430020
297500     PERFORM                                                      30440020
297600       VARYING PV-HIST-INDEX FROM 1 BY 1                          30450020
297700       UNTIL PV-HIST-INDEX > 4                                    30460020
297800          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   30470020
297900          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 30480020
298000          PERFORM E2300-FETCH-HIST-SLS-INFO                       30490020
298100          IF EOC-SLS-HIST-CSR                                     30500020
298200              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       30510020
298300          ELSE                                                    30520020
298400              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       30530020
298500              ADD  PV-SALES    TO  PV-CUMM-SALES                  30540020
298600          END-IF                                                  30550020
298700     END-PERFORM.                                                 30560020
298800                                                                  30570020
298900***************************************************************** 30580020
299000* FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.        30590020
299100***************************************************************** 30600020
299200 E2100-FETCH-HISTORY-INFO.                                        30610020
299300                                                                  30620020
299400     MOVE 'E2100'                       TO PGM-LOCATION.          30630020
299500     MOVE 'E2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    30640020
299600                                                                  30650020
299610******************************************************************30660026
299620* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               30670026
299630* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       30680026
299640* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 30690026
299650******************************************************************30700026
299700     EXEC SQL                                                     30710020
299800          SELECT                                                  30720020
299900                  COALESCE(SUM(C.OH_HIST_QTY),0)                  30730020
300000                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 30740020
300100                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 30750020
300200          INTO                                                    30760020
300300                :PV-ONHAND                                        30770020
300400               ,:PV-DD                                            30780020
300500               ,:PV-MADDSS                                        30790020
300600          FROM   TSKXREF X                                        30800021
300700                ,TMRITEM B                                        30810020
300800                ,TMRISHS C                                        30820020
300900                ,TMRITST D                                        30830020
301000                ,XMT_LOC G                                        30840031
301100          WHERE  X.ITM_NBR           = B.ITEM_NBR                 30850021
301200            AND  X.ITM_NBR           = C.ITM_NBR                  30860021
301300            AND  X.ITM_NBR           = D.ITEM_NBR                 30870021
301400            AND  C.STR_NBR           = D.STR_NBR                  30880020
301500            AND  C.STR_NBR           > 0                          30890031
301600            AND  D.FT_CDE            = 'O'                        30900020
301700            AND  D.STR_NBR           = G.LOC_NBR                  30910031
301900            AND  G.E_BUS_IND         = :PC-Y                      30930031
302000            AND  C.YR_NBR            = :PV-HOLD-YEAR              30940020
302100            AND  C.WK_NBR            = :PV-HOLD-WEEK              30950020
302200            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          30960021
302300            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         30970021
302400            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           30980021
302500            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 30990020
302600                  FROM TMRISHS E                                  31000020
302700              WHERE                                               31010020
302800                    E.ITM_NBR        = C.ITM_NBR                  31020020
302900                AND E.STR_NBR        = C.STR_NBR                  31030020
303000                AND E.YR_NBR         = :PV-HOLD-YEAR              31040020
303100                AND E.WK_NBR         = :PV-HOLD-WEEK)             31050020
                    WITH UR                                             31051037
303200     END-EXEC.                                                    31060020
303300                                                                  31070020
303400     EVALUATE TRUE                                                31080020
303500       WHEN SQLCODE         = ZERO                                31090020
303600         CONTINUE                                                 31100020
303700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    31110020
303800         MOVE PC-Y TO PS-EOC-HIST-CSR                             31120020
303900       WHEN OTHER                                                 31130020
304000         DISPLAY PV-ABEND-PARAGRAPH                               31140020
304100         PERFORM Z9900-SQL-ERROR                                  31150020
304200     END-EVALUATE.                                                31160020
304300                                                                  31170020
304400***************************************************************** 31180020
304500* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              31190020
304600***************************************************************** 31200020
304700 E2300-FETCH-HIST-SLS-INFO.                                       31210020
304800                                                                  31220020
304900     MOVE 'E2300'                       TO PGM-LOCATION.          31230020
305000     MOVE 'E2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    31240020
305100                                                                  31250020
305110******************************************************************31260026
305120* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               31270026
305130* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       31280026
305140* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 31290026
305150******************************************************************31300026
305200     EXEC SQL                                                     31310020
305300          SELECT                                                  31320020
305400                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  31330032
305500          INTO                                                    31340020
305600                :PV-SALES                                         31350020
305700          FROM   TSKXREF  X                                       31360021
305800                ,TMRITEM  B                                       31370021
305900                ,MHT_DLY_SLS C                                    31380031
306000                ,TMRITST  D                                       31390021
306100                ,XMT_LOC  G                                       31400031
306200          WHERE  X.ITM_NBR           = B.ITEM_NBR                 31410021
179100            AND  X.SKU               = C.SKU_NBR                  31420033
306400            AND  X.ITM_NBR           = D.ITEM_NBR                 31430021
306500            AND  D.FT_CDE            = 'O'                        31440020
306600            AND  D.STR_NBR           = C.STR_NBR                  31450031
306700            AND  C.STR_NBR           > 0                          31460031
306800            AND  D.STR_NBR           = G.LOC_NBR                  31470031
307000            AND  G.E_BUS_IND         = :PC-Y                      31490031
307100            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          31500021
307200            AND  X.CLASS             = :PV-HOLD-CLASS-NBR         31510021
307300            AND  X.SUBCLASS          = :PV-HOLD-SCL-NBR           31520021
458500            AND  C.PRCG_DTE                                       31530031
                  BETWEEN :PV-HOLD-FSCL-DATE  AND                       31531031
                     DATE(:PV-HOLD-FSCL-DATE) + 6 DAYS                  31532031
264300            AND C.SKU_STAT_CDE IN ('10', '20', '40')              31533031
                  WITH UR                                               31534037
307600     END-EXEC.                                                    31550020
307700                                                                  31560020
307800     EVALUATE TRUE                                                31570020
307900       WHEN SQLCODE         = ZERO                                31580020
308000         CONTINUE                                                 31590020
308100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    31600020
308200         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         31610020
308300       WHEN OTHER                                                 31620020
308400         DISPLAY PV-ABEND-PARAGRAPH                               31630020
308500         PERFORM Z9900-SQL-ERROR                                  31640020
308600     END-EVALUATE.                                                31650020
308700                                                                  31660020
308800***************************************************************** 31670020
308900* CALCULATES FORECAST FOR LAST 4 WEEKS                            31680020
309000***************************************************************** 31690020
309100 E3000-GET-HISTORY-FORECAST.                                      31700020
309200                                                                  31710020
309300     PERFORM                                                      31720020
309400       VARYING PV-HIST-INDEX FROM 1 BY 1                          31730020
309500       UNTIL PV-HIST-INDEX > 4                                    31740020
309600        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          31750020
309700        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          31760020
309800        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     31770020
309900        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           31780020
310000        PERFORM E3100-OPEN-HIST-FRCST-CSR                         31790020
310100        MOVE ZERO                        TO PV-TOTAL-FORECAST     31800020
310200        PERFORM E3200-LOOP-THRU-CSR                               31810020
310300                    UNTIL EOC-H-FRCST-CSR                         31820020
310400        MOVE PV-TOTAL-FORECAST                                    31830020
310500                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 31840020
310600        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 31850020
310700     END-PERFORM.                                                 31860020
310800                                                                  31870020
310900     PERFORM E3500-CALCULATE-FRCST-PERCENT                        31880020
311000       VARYING PV-HIST-INDEX FROM 1 BY 1                          31890020
311100       UNTIL PV-HIST-INDEX > 4.                                   31900020
311200                                                                  31910020
311300***************************************************************** 31920020
311400*  OPEN SUB-CLS-HIST-FRCST CURSOR                                 31930020
311500***************************************************************** 31940020
311600 E3100-OPEN-HIST-FRCST-CSR.                                       31950020
311700                                                                  31960020
311800     MOVE 'E3100'                    TO PGM-LOCATION.             31970020
311900     MOVE 'E3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      31980020
312000                                                                  31990020
312100     EXEC SQL                                                     32000020
312200         OPEN SUB-CLS-HIST-FRCST                                  32010020
312300     END-EXEC.                                                    32020020
312400                                                                  32030020
312500     EVALUATE TRUE                                                32040020
312600       WHEN SQLCODE         = ZERO                                32050020
312700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    32060020
312800         CONTINUE                                                 32070020
312900       WHEN OTHER                                                 32080020
313000         DISPLAY PV-ABEND-PARAGRAPH                               32090020
313100         PERFORM Z9900-SQL-ERROR                                  32100020
313200     END-EVALUATE.                                                32110020
313300                                                                  32120020
313400***************************************************************** 32130020
313500* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    32140020
313600* TO TOTAL                                                        32150020
313700***************************************************************** 32160020
313800 E3200-LOOP-THRU-CSR.                                             32170020
313900                                                                  32180020
314000     PERFORM E3300-FETCH-HIST-FRCST-CSR.                          32190020
314100     IF EOC-H-FRCST-CSR                                           32200020
314200         CONTINUE                                                 32210020
314300     ELSE                                                         32220020
314400         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                32230020
314500         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      32240020
314600         PERFORM B2000-READ-BIM-FILE                              32250020
314700         IF BIM-RECORD-FOUND                                      32260020
314800             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         32270020
314900             IF MRITEM-UCYCLE-CDE = 9                             32280020
315000                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       32290020
315100             ELSE                                                 32300020
315200                 IF MRITEM-UCYCLE-CDE = 5                         32310020
315300                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        32320020
315400                                     GIVING PV-DD-COMPUTED ROUNDED32330020
315500                 END-IF                                           32340020
315600             END-IF                                               32350020
315700             MULTIPLY PV-BI BY PV-DD-COMPUTED                     32360020
315800                                            GIVING PV-FORECAST    32370020
315900             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 32380020
316000         END-IF                                                   32390020
316100     END-IF.                                                      32400020
316200                                                                  32410020
316300***************************************************************** 32420020
316400* FETCH SUB-CLS-HIST-FRCST CURSOR - GETS DD AND PTAG TO READ BIM  32430020
316500* FILE                                                            32440020
316600***************************************************************** 32450020
316700 E3300-FETCH-HIST-FRCST-CSR.                                      32460020
316800                                                                  32470020
316900     MOVE 'E3300'                       TO PGM-LOCATION.          32480020
317000     MOVE 'E3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    32490020
317100                                                                  32500020
317200     EXEC SQL                                                     32510020
317300       FETCH SUB-CLS-HIST-FRCST                                   32520020
317400        INTO                                                      32530020
317500              :MRITEM-UCYCLE-CDE,                                 32540020
317600              :MRISHS-DSD-HIST-QTY,                               32550020
317700              :MRITST-PTAG-ID                                     32560020
317800     END-EXEC.                                                    32570020
317900*                                                                 32580020
318000     EVALUATE TRUE                                                32590020
318100       WHEN SQLCODE         = ZERO                                32600020
318200         CONTINUE                                                 32610020
318300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    32620020
318400         PERFORM E3400-CLOSE-FRCST-LEVEL-CSR                      32630020
318500         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          32640020
318600       WHEN OTHER                                                 32650020
318700         DISPLAY PV-ABEND-PARAGRAPH                               32660020
318800         PERFORM Z9900-SQL-ERROR                                  32670020
318900     END-EVALUATE.                                                32680020
319000                                                                  32690020
319100******************************************************************32700020
319200* CLOSE SUB-CLS-HIST-FRCST CURSOR                                *32710020
319300******************************************************************32720020
319400 E3400-CLOSE-FRCST-LEVEL-CSR.                                     32730020
319500                                                                  32740020
319600     MOVE 'E3400'                        TO PGM-LOCATION.         32750020
319700     MOVE 'E3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   32760020
319800                                                                  32770020
319900     EXEC SQL                                                     32780020
320000         CLOSE SUB-CLS-HIST-FRCST                                 32790020
320100     END-EXEC.                                                    32800020
320200                                                                  32810020
320300     EVALUATE TRUE                                                32820020
320400         WHEN SQLCODE EQUAL ZERO                                  32830020
320500         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      32840020
320600             CONTINUE                                             32850020
320700         WHEN OTHER                                               32860020
320800             DISPLAY PV-ABEND-PARAGRAPH                           32870020
320900             PERFORM Z9900-SQL-ERROR                              32880020
321000     END-EVALUATE.                                                32890020
321100                                                                  32900020
321200***************************************************************** 32910020
321300* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     32920020
321400* WHAT WAS SOLD.                                                  32930020
321500***************************************************************** 32940020
321600 E3500-CALCULATE-FRCST-PERCENT.                                   32950020
321700                                                                  32960020
321800     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         32970020
321900     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            32980020
322000                                                                  32990020
322100     IF  PV-FORECAST = 0                                          33000020
322200         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       33010020
322300     ELSE                                                         33020020
322400         IF PV-SALES  = 0                                         33030020
322500             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     33040020
322600         ELSE                                                     33050020
322700             COMPUTE PV-FRCST-PERCENT ROUNDED =                   33060020
322800                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    33070020
322900             MOVE PV-FRCST-PERCENT                                33080020
323000                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          33090020
323100         END-IF                                                   33100020
323200     END-IF.                                                      33110020
323300                                                                  33120020
323400***************************************************************** 33130020
323500* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  33140020
323600* TIME.                                                           33150020
323700***************************************************************** 33160020
323800 E4000-GET-CURRENT-INFO.                                          33170020
323900                                                                  33180020
324000     MOVE PC-N TO PS-EOC-CURR-CSR.                                33190020
324100     PERFORM E4100-FETCH-CURRENT-INFO.                            33200020
324200     IF EOC-CURR-CSR                                              33210020
324300         MOVE ZEROES           TO  DL3-ONORDER                    33220020
324400         MOVE ZEROES           TO  DL10-ONHAND                    33230020
324500         MOVE ZEROES           TO  DL6-DD-CURR                    33240020
324600         MOVE ZEROES           TO  DL11-CSTOCK                    33250020
324700         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 33260020
324800         MOVE ZEROES           TO  DL2-LEAD-TIME                  33270020
324900     ELSE                                                         33280020
325000         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    33290020
325100         MOVE PV-ONHAND        TO  DL10-ONHAND                    33300020
325200         MOVE PV-DD            TO  DL6-DD-CURR                    33310020
325300         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    33320020
325400         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 33330020
325500         MOVE PV-LT            TO  DL2-LEAD-TIME                  33340020
325600     END-IF.                                                      33350020
325700                                                                  33360020
325800***************************************************************** 33370020
325900* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  33380020
326000* AND MAXIMUM LEAD TIME                                           33390020
326100***************************************************************** 33400020
326200 E4100-FETCH-CURRENT-INFO.                                        33410020
326300                                                                  33420020
326400     MOVE 'E4100'                       TO PGM-LOCATION.          33430020
326500     MOVE 'E4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    33440020
326600                                                                  33450020
326610******************************************************************33460026
326620* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               33470026
326630* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       33480026
326640* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 33490026
326650******************************************************************33500026
326700     EXEC SQL                                                     33510020
326800          SELECT                                                  33520020
326900                  COALESCE(SUM(D.DD_FCTR),0)                      33530020
327000                , COALESCE(SUM(F.ONHAND_QTY),0)                   33540020
327100                , COALESCE(SUM(D.CSTOCK_QTY),0)                   33550020
327200                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 33560020
327300                , COALESCE(AVG(D.OSTRAT_QTY),0)                   33570020
327400                , COALESCE(MAX(LT_QTY),0)                         33580020
327500          INTO  :PV-DD                                            33590020
327600               ,:PV-ONHAND                                        33600020
327700               ,:PV-CSTOCK                                        33610020
327800               ,:PV-ON-ORDER                                      33620020
327900               ,:PV-OSTRAT                                        33630020
328000               ,:PV-LT                                            33640020
328100          FROM   TSKXREF X                                        33650021
328200                ,TMRITEM B                                        33660020
328300                ,TMRITST D                                        33670020
328400                ,TSKST   F                                        33680021
328500                ,XMT_LOC G                                        33690031
328600          WHERE  X.ITM_NBR            = B.ITEM_NBR                33700021
328700            AND  X.ITM_NBR            = D.ITEM_NBR                33710021
328800            AND  X.ITM_NBR            = F.ITEM_NMBR               33720021
328900            AND  D.STR_NBR            = F.LOC_NBR                 33730032
329000            AND  D.STR_NBR            > 0                         33740031
329100            AND  D.FT_CDE             = 'O'                       33750020
329200            AND  D.STR_NBR            = G.LOC_NBR                 33760031
329400            AND  G.E_BUS_IND          = :PC-Y                     33780031
329500            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         33790021
329600            AND  X.CLASS              = :PV-HOLD-CLASS-NBR        33800021
329700            AND  X.SUBCLASS           = :PV-HOLD-SCL-NBR          33810021
                WITH UR                                                 33811037
329800     END-EXEC.                                                    33820020
329900                                                                  33830020
330000     EVALUATE TRUE                                                33840020
330100       WHEN SQLCODE         = ZERO                                33850020
330200         CONTINUE                                                 33860020
330300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    33870020
330400         MOVE PC-Y TO PS-EOC-CURR-CSR                             33880020
330500       WHEN OTHER                                                 33890020
330600         DISPLAY PV-ABEND-PARAGRAPH                               33900020
330700         PERFORM Z9900-SQL-ERROR                                  33910020
330800     END-EVALUATE.                                                33920020
330900                                                                  33930020
331000***************************************************************** 33940020
331100* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    33950020
331200* FOR THE NEXT 52 WEEKS.                                          33960020
331300***************************************************************** 33970020
331400 E5000-GET-CURRENT-FORECAST.                                      33980020
331500                                                                  33990020
331600        PERFORM E5100-INITIALZE-TABLE.                            34000020
331700        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           34010020
331800        PERFORM E5200-OPEN-CURR-FRCST-CSR.                        34020020
331900        PERFORM E5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   34030020
332000        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           34040020
332100                                    TO DL7-CURRENT-FRCST.         34050020
332200        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           34060020
332300                            TO DL7-FUTURE-FRCST(PC-ONE).          34070020
332400        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         34080020
332500                            TO DL7-FUTURE-FRCST(PC-TWO).          34090020
332600        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          34100020
332700                            TO DL7-FUTURE-FRCST(PC-THREE).        34110020
332800        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          34120020
332900                            TO DL7-FUTURE-FRCST(PC-FOUR).         34130020
333000        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           34140020
333100                            TO DL7-FUTURE-FRCST(PC-FIVE).         34150020
333200                                                                  34160020
333300***************************************************************** 34170020
333400* INITIALZE FORECAST TABLE.                                       34180020
333500***************************************************************** 34190020
333600 E5100-INITIALZE-TABLE.                                           34200020
333700                                                                  34210020
333800        MOVE PC-ONE      TO PV-BIM-INDEX.                         34220020
333900        PERFORM UNTIL PV-BIM-INDEX > PC-52                        34230020
334000            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      34240020
334100            ADD PC-ONE   TO PV-BIM-INDEX                          34250020
334200        END-PERFORM.                                              34260020
334300                                                                  34270020
334400                                                                  34280020
334500***************************************************************** 34290020
334600* OPEN SUB-CLS-CURR-FRCST CURSOR                                  34300020
334700***************************************************************** 34310020
334800 E5200-OPEN-CURR-FRCST-CSR.                                       34320020
334900                                                                  34330020
335000     MOVE 'E5200'                    TO PGM-LOCATION.             34340020
335100     MOVE 'E5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      34350020
335200                                                                  34360020
335300     EXEC SQL                                                     34370020
335400         OPEN SUB-CLS-CURR-FRCST                                  34380020
335500     END-EXEC.                                                    34390020
335600                                                                  34400020
335700     EVALUATE TRUE                                                34410020
335800       WHEN SQLCODE         = ZERO                                34420020
335900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    34430020
336000         CONTINUE                                                 34440020
336100       WHEN OTHER                                                 34450020
336200         DISPLAY PV-ABEND-PARAGRAPH                               34460020
336300         PERFORM Z9900-SQL-ERROR                                  34470020
336400     END-EVALUATE.                                                34480020
336500                                                                  34490020
336600***************************************************************** 34500020
336700* LOOP THRU SUB-CLS-CURR-FRCST CURSOR AND CALCULATE FORECASTS.    34510020
336800***************************************************************** 34520020
336900 E5300-LOOP-THRU-CURR-CSR.                                        34530020
337000                                                                  34540020
337100     PERFORM E5400-FETCH-CURR-FRCST-CSR.                          34550020
337200     IF EOC-C-FRCST-CSR                                           34560020
337300         CONTINUE                                                 34570020
337400     ELSE                                                         34580020
337500         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           34590020
337600         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                34600020
337700         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      34610020
337800         PERFORM B2000-READ-BIM-FILE                              34620020
337900         IF BIM-RECORD-FOUND                                      34630020
338000             PERFORM E5600-CALCULATE-FORECAST                     34640020
338100                 VARYING PV-BIM-INDEX  FROM 1 BY 1                34650020
338200                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            34660020
338300         END-IF                                                   34670020
338400     END-IF.                                                      34680020
338500                                                                  34690020
338600***************************************************************** 34700020
338700* FETCH SUB-CLS-CURR-FRCST CURSOR                                 34710020
338800***************************************************************** 34720020
338900 E5400-FETCH-CURR-FRCST-CSR.                                      34730020
339000                                                                  34740020
339100     MOVE 'E5400'                       TO PGM-LOCATION.          34750020
339200     MOVE 'E5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    34760020
339300                                                                  34770020
339400     EXEC SQL                                                     34780020
339500       FETCH SUB-CLS-CURR-FRCST                                   34790020
339600        INTO                                                      34800020
339700              :MRITEM-UCYCLE-CDE,                                 34810020
339800              :MRITST-DD-FCTR,                                    34820020
339900              :MRITST-PTAG-ID                                     34830020
340000     END-EXEC.                                                    34840020
340100                                                                  34850020
340200     EVALUATE TRUE                                                34860020
340300       WHEN SQLCODE         = ZERO                                34870020
340400         CONTINUE                                                 34880020
340500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    34890020
340600         PERFORM E5500-CLOSE-CURR-FRCST-CSR                       34900020
340700         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          34910020
340800       WHEN OTHER                                                 34920020
340900         DISPLAY PV-ABEND-PARAGRAPH                               34930020
341000         PERFORM Z9900-SQL-ERROR                                  34940020
341100     END-EVALUATE.                                                34950020
341200                                                                  34960020
341300******************************************************************34970020
341400* CLOSE SUB-CLS-CURR-FRCST CURSOR                                *34980020
341500******************************************************************34990020
341600 E5500-CLOSE-CURR-FRCST-CSR.                                      35000020
341700                                                                  35010020
341800     MOVE 'E5500'                       TO PGM-LOCATION.          35020020
341900     MOVE 'E5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    35030020
342000                                                                  35040020
342100     EXEC SQL                                                     35050020
342200         CLOSE SUB-CLS-CURR-FRCST                                 35060020
342300     END-EXEC.                                                    35070020
342400                                                                  35080020
342500     EVALUATE TRUE                                                35090020
342600         WHEN SQLCODE EQUAL ZERO                                  35100020
342700         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      35110020
342800             CONTINUE                                             35120020
342900         WHEN OTHER                                               35130020
343000             DISPLAY PV-ABEND-PARAGRAPH                           35140020
343100             PERFORM Z9900-SQL-ERROR                              35150020
343200     END-EVALUATE.                                                35160020
343300                                                                  35170020
343400***************************************************************** 35180020
343500* CALCULATE FORECAST.                                             35190020
343600***************************************************************** 35200020
343700 E5600-CALCULATE-FORECAST.                                        35210020
343800                                                                  35220020
343900     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 35230020
344000     IF MRITEM-UCYCLE-CDE = 9                                     35240020
344100         MOVE MRITST-DD-FCTR    TO PV-DD-COMPUTED                 35250020
344200     ELSE                                                         35260020
344300         IF MRITEM-UCYCLE-CDE = 5                                 35270020
344400             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                35280020
344500                            GIVING PV-DD-COMPUTED ROUNDED         35290020
344600         END-IF                                                   35300020
344700     END-IF.                                                      35310020
344800                                                                  35320020
344900     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        35330020
345000     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX).      35340020
345100                                                                  35350020
345200     IF PV-BIM-WEEK-INDEX = PC-52                                 35360020
345300         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    35370020
345400     ELSE                                                         35380020
345500         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    35390020
345600     END-IF.                                                      35400020
345700                                                                  35410020
345800***************************************************************** 35420020
345900* CONTROL BREAK AT THE GROUP LEVEL                                35430020
346000***************************************************************** 35440020
346100 F0000-GROUP-BREAK.                                               35450020
346200                                                                  35460020
346300     MOVE PC-N                         TO PS-EOC-GROUP-CSR.       35470020
346400     PERFORM F0100-OPEN-GROUP-CSR.                                35480020
346500     PERFORM F0200-PROCESS-GROUP-CSR   UNTIL EOC-GROUP-CSR.       35490020
346600                                                                  35500020
346700***************************************************************** 35510020
346800*  OPEN GROUP CURSOR                                              35520020
346900***************************************************************** 35530020
347000 F0100-OPEN-GROUP-CSR.                                            35540020
347100                                                                  35550020
347200     MOVE 'F0100'                      TO PGM-LOCATION.           35560020
347300     MOVE 'F0100-OPEN-GROUP-CSR' TO PV-ABEND-PARAGRAPH.           35570020
347400                                                                  35580020
347500     EXEC SQL                                                     35590020
347600         OPEN GROUP-LEVEL                                         35600020
347700     END-EXEC.                                                    35610020
347800                                                                  35620020
347900     EVALUATE TRUE                                                35630020
348000       WHEN SQLCODE         = ZERO                                35640020
348100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    35650020
348200         CONTINUE                                                 35660020
348300       WHEN OTHER                                                 35670020
348400         DISPLAY PV-ABEND-PARAGRAPH                               35680020
348500         PERFORM Z9900-SQL-ERROR                                  35690020
348600     END-EVALUATE.                                                35700020
348700                                                                  35710020
348800***************************************************************** 35720020
348900* PROCESS GROUP CURSOR                                            35730020
349000***************************************************************** 35740020
349100 F0200-PROCESS-GROUP-CSR.                                         35750020
349200                                                                  35760020
349300     PERFORM F0300-FETCH-GROUP-CSR.                               35770020
349400     IF EOC-GROUP-CSR                                             35780020
349500         CONTINUE                                                 35790020
349600     ELSE                                                         35800020
349700         MOVE SKXREF-CLASS               TO  PV-HOLD-CLASS-NBR    35810021
349800         MOVE SKXREF-SUBCLASS            TO  PV-HOLD-SCL-NBR      35820021
349900         MOVE TSK-GROUP-CODE             TO  PV-HOLD-GROUP-CODE   35830020
350000         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 35840020
350100         PERFORM F1000-CREATE-REPORT-LINES                        35850020
350200         IF PROCESS-LINE-INFO                                     35860020
350300             PERFORM R0000-PRINT-REPORT-LINES                     35870020
350400         END-IF                                                   35880020
350500     END-IF.                                                      35890020
350600                                                                  35900020
350700***************************************************************** 35910020
350800* FETCH GROUP CURSOR                                              35920020
350900***************************************************************** 35930020
351000  F0300-FETCH-GROUP-CSR.                                          35940020
351100                                                                  35950020
351200     MOVE 'F0300'                       TO PGM-LOCATION.          35960020
351300     MOVE 'F0300-FETCH-GROUP-CURSOR'                              35970020
351400                                        TO PV-ABEND-PARAGRAPH.    35980020
351500                                                                  35990020
351600     EXEC SQL                                                     36000020
351700       FETCH GROUP-LEVEL                                          36010020
351800        INTO                                                      36020020
351900              :SKXREF-DEPT                                        36030021
352000             ,:SKXREF-CLASS                                       36040021
352100             ,:SKXREF-SUBCLASS                                    36050021
352200             ,:TSK-GROUP-CODE                                     36060021
352300     END-EXEC.                                                    36070020
352400                                                                  36080020
352500     EVALUATE TRUE                                                36090020
352600       WHEN SQLCODE         = ZERO                                36100020
352700         CONTINUE                                                 36110020
352800       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    36120020
352900         PERFORM F0400-CLOSE-GROUP-CSR                            36130020
353000         MOVE PC-Y TO PS-EOC-GROUP-CSR                            36140020
353100       WHEN OTHER                                                 36150020
353200         DISPLAY PV-ABEND-PARAGRAPH                               36160020
353300         PERFORM Z9900-SQL-ERROR                                  36170020
353400     END-EVALUATE.                                                36180020
353500                                                                  36190020
353600******************************************************************36200020
353700*  CLOSE GROUP CURSOR                                            *36210020
353800******************************************************************36220020
353900 F0400-CLOSE-GROUP-CSR.                                           36230020
354000                                                                  36240020
354100     MOVE 'F0400'                        TO PGM-LOCATION.         36250020
354200     MOVE 'F0400-CLOSE-GROUP-CSR'        TO PV-ABEND-PARAGRAPH.   36260020
354300                                                                  36270020
354400     EXEC SQL                                                     36280020
354500         CLOSE GROUP-LEVEL                                        36290020
354600     END-EXEC.                                                    36300020
354700                                                                  36310020
354800     EVALUATE TRUE                                                36320020
354900         WHEN SQLCODE EQUAL ZERO                                  36330020
355000         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      36340020
355100             CONTINUE                                             36350020
355200         WHEN OTHER                                               36360020
355300             DISPLAY PV-ABEND-PARAGRAPH                           36370020
355400             PERFORM Z9900-SQL-ERROR                              36380020
355500     END-EVALUATE.                                                36390020
355600                                                                  36400020
355700***************************************************************** 36410020
355800*  SET UP DATA FOR THE REPORT LINES                               36420020
355900***************************************************************** 36430020
356000 F1000-CREATE-REPORT-LINES.                                       36440020
356100                                                                  36450020
356200     MOVE ZERO                       TO PV-CUMM-SALES.            36460020
356300     PERFORM F2000-GET-HISTORY-INFO.                              36470020
356400     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           36480020
356500                                                                  36490020
356600     MOVE ZERO                       TO PV-CUMM-FRCST.            36500020
356700     PERFORM F3000-GET-HISTORY-FORECAST.                          36510020
356800     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           36520020
356900                                                                  36530020
357000     IF PV-HOLD-PER                                               36540020
357100         PERFORM B4000-CHECK-PERCENT-VARIANCE                     36550020
357200     END-IF.                                                      36560020
357300                                                                  36570020
357400                                                                  36580020
357500     IF PROCESS-LINE-INFO                                         36590020
357600         PERFORM F4000-GET-CURRENT-INFO                           36600020
357700         PERFORM F5000-GET-CURRENT-FORECAST                       36610020
357800         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     36620020
357900     END-IF.                                                      36630020
358000                                                                  36640020
358100     IF PROCESS-LINE-INFO                                         36650020
358200         PERFORM B4100-CALCULATE-CUMM-PCNT                        36660020
358300         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   36670020
358400     END-IF.                                                      36680020
358500                                                                  36690020
358600                                                                  36700020
358700***************************************************************** 36710020
358800*  GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS     36720020
358900***************************************************************** 36730020
359000 F2000-GET-HISTORY-INFO.                                          36740020
359100                                                                  36750020
359200     PERFORM                                                      36760020
359300       VARYING PV-HIST-INDEX FROM 1 BY 1                          36770020
359400       UNTIL PV-HIST-INDEX > 4                                    36780020
359500          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        36790020
359600          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        36800020
359700          MOVE PC-N                   TO PS-EOC-HIST-CSR          36810020
359800          PERFORM F2100-FETCH-HISTORY-INFO                        36820020
359900          IF EOC-HIST-CSR                                         36830020
360000              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          36840020
360100              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    36850020
360200          ELSE                                                    36860020
360300              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          36870020
360400              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    36880020
360500          END-IF                                                  36890020
360600     END-PERFORM.                                                 36900020
360700                                                                  36910020
360800     PERFORM                                                      36920020
360900       VARYING PV-HIST-INDEX FROM 1 BY 1                          36930020
361000       UNTIL PV-HIST-INDEX > 4                                    36940020
361100          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   36950020
361200          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 36960020
361300          PERFORM F2300-FETCH-HIST-SLS-INFO                       36970020
361400          IF EOC-SLS-HIST-CSR                                     36980020
361500              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       36990020
361600          ELSE                                                    37000020
361700              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       37010020
361800              ADD  PV-SALES    TO  PV-CUMM-SALES                  37020020
361900          END-IF                                                  37030020
362000     END-PERFORM.                                                 37040020
362100                                                                  37050020
362200***************************************************************** 37060020
362300*  FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.       37070020
362400***************************************************************** 37080020
362500 F2100-FETCH-HISTORY-INFO.                                        37090020
362600                                                                  37100020
362700     MOVE 'F2100'                       TO PGM-LOCATION.          37110020
362800     MOVE 'F2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    37120020
362900                                                                  37130020
362910******************************************************************37140026
362920* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               37150026
362930* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       37160026
362940* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 37170026
362950******************************************************************37180026
363000     EXEC SQL                                                     37190020
363100          SELECT                                                  37200020
363200                  COALESCE(SUM(C.OH_HIST_QTY),0)                  37210020
363300                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 37220020
363400                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 37230020
363500          INTO                                                    37240020
363600                :PV-ONHAND                                        37250020
363700               ,:PV-DD                                            37260020
363800               ,:PV-MADDSS                                        37270020
363900          FROM   TSK          A                                   37280020
364000                ,TMRITEM B                                        37290020
364100                ,TMRISHS C                                        37300020
364200                ,TMRITST D                                        37310020
364300                ,XMT_LOC G                                        37320031
364400                ,TSKXREF X                                        37330021
364500          WHERE A.ITEM_NMBR         = B.ITEM_NBR                  37340020
364600            AND A.ITEM_NMBR         = C.ITM_NBR                   37350020
364700            AND A.ITEM_NMBR         = D.ITEM_NBR                  37360020
364800            AND A.ITEM_NMBR         = X.ITM_NBR                   37370021
364900            AND C.STR_NBR           = D.STR_NBR                   37380020
365000            AND C.STR_NBR           > 0                           37390031
365100            AND D.FT_CDE            = 'O'                         37400020
365200            AND D.STR_NBR           = G.LOC_NBR                   37410031
365400            AND G.E_BUS_IND         = :PC-Y                       37430031
365500            AND C.YR_NBR            = :PV-HOLD-YEAR               37440020
365600            AND C.WK_NBR            = :PV-HOLD-WEEK               37450020
365700            AND X.DEPT              = :PV-HOLD-DEPT-NBR           37460021
365800            AND X.CLASS             = :PV-HOLD-CLASS-NBR          37470021
365900            AND X.SUBCLASS          = :PV-HOLD-SCL-NBR            37480021
366000            AND A.GROUP_CODE        = :PV-HOLD-GROUP-CODE         37490020
366100            AND C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID)  37500020
366200                  FROM TMRISHS E                                  37510020
366300              WHERE                                               37520020
366400                    E.ITM_NBR       = C.ITM_NBR                   37530020
366500                AND E.STR_NBR       = C.STR_NBR                   37540020
366600                AND E.YR_NBR        = :PV-HOLD-YEAR               37550020
366700                AND E.WK_NBR        = :PV-HOLD-WEEK)              37560020
                   WITH UR                                              37561037
366800     END-EXEC.                                                    37570020
366900                                                                  37580020
367000     EVALUATE TRUE                                                37590020
367100       WHEN SQLCODE         = ZERO                                37600020
367200         CONTINUE                                                 37610020
367300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    37620020
367400         MOVE PC-Y TO PS-EOC-HIST-CSR                             37630020
367500       WHEN OTHER                                                 37640020
367600         DISPLAY PV-ABEND-PARAGRAPH                               37650020
367700         PERFORM Z9900-SQL-ERROR                                  37660020
367800     END-EVALUATE.                                                37670020
367900                                                                  37680020
368000***************************************************************** 37690020
368100* FETCHS SALES FOR 4 PREVIOUS WEEKS.                              37700020
368200***************************************************************** 37710020
368300 F2300-FETCH-HIST-SLS-INFO.                                       37720020
368400                                                                  37730020
368500     MOVE 'F2300'                       TO PGM-LOCATION.          37740020
368600     MOVE 'F2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    37750020
368700                                                                  37760020
368710******************************************************************37770026
368720* MRNIS-RFC   PREVIOUS   DEPT, CLASS FROM TSK OF FS               37780026
368730* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS FROM TSKXREF       37790026
368740* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 37800026
368750******************************************************************37810026
368800     EXEC SQL                                                     37820020
368900          SELECT                                                  37830020
369000                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  37840032
369100          INTO                                                    37850020
369200                :PV-SALES                                         37860020
369300          FROM   TSK       A                                      37870021
369400                ,TMRITEM   B                                      37880021
369500                ,MHT_DLY_SLS C                                    37890031
369600                ,TMRITST   D                                      37900021
369700                ,XMT_LOC   G                                      37910031
369800                ,TSKXREF   X                                      37920021
369900          WHERE  A.ITEM_NMBR        = B.ITEM_NBR                  37930020
179100            AND  X.SKU               = C.SKU_NBR                  37940033
370100            AND  A.ITEM_NMBR        = D.ITEM_NBR                  37950020
370200            AND  A.ITEM_NMBR        = X.ITM_NBR                   37960021
370300            AND  D.FT_CDE           = 'O'                         37970020
370400            AND  D.STR_NBR          = C.STR_NBR                   37980031
370500            AND  C.STR_NBR          > 0                           37990031
370600            AND  D.STR_NBR          = G.LOC_NBR                   38000031
370800            AND  G.E_BUS_IND        = :PC-Y                       38020031
370900            AND  X.DEPT             = :PV-HOLD-DEPT-NBR           38030021
371000            AND  X.CLASS            = :PV-HOLD-CLASS-NBR          38040021
371100            AND  X.SUBCLASS         = :PV-HOLD-SCL-NBR            38050021
371200            AND  A.GROUP_CODE       = :PV-HOLD-GROUP-CODE         38060020
458500            AND  C.PRCG_DTE                                       38070031
                  BETWEEN :PV-HOLD-FSCL-DATE  AND                       38071031
                     DATE(:PV-HOLD-FSCL-DATE) + 6 DAYS                  38072031
264300            AND C.SKU_STAT_CDE IN ('10', '20', '40')              38073031
                  WITH UR                                               38074037
371500     END-EXEC.                                                    38090020
371600                                                                  38100020
371700     EVALUATE TRUE                                                38110020
371800       WHEN SQLCODE         = ZERO                                38120020
371900         CONTINUE                                                 38130020
372000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    38140020
372100         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         38150020
372200       WHEN OTHER                                                 38160020
372300         DISPLAY PV-ABEND-PARAGRAPH                               38170020
372400         PERFORM Z9900-SQL-ERROR                                  38180020
372500     END-EVALUATE.                                                38190020
372600                                                                  38200020
372700***************************************************************** 38210020
372800* CALCULATES FORECAST FOR LAST 4 WEEKS                            38220020
372900***************************************************************** 38230020
373000 F3000-GET-HISTORY-FORECAST.                                      38240020
373100                                                                  38250020
373200     PERFORM                                                      38260020
373300       VARYING PV-HIST-INDEX FROM 1 BY 1                          38270020
373400       UNTIL PV-HIST-INDEX > 4                                    38280020
373500        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          38290020
373600        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          38300020
373700        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     38310020
373800        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           38320020
373900        PERFORM F3100-OPEN-HIST-FRCST-CSR                         38330020
374000        MOVE ZERO                        TO PV-TOTAL-FORECAST     38340020
374100        PERFORM F3200-LOOP-THRU-CSR                               38350020
374200                    UNTIL EOC-H-FRCST-CSR                         38360020
374300        MOVE PV-TOTAL-FORECAST                                    38370020
374400                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 38380020
374500        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 38390020
374600     END-PERFORM.                                                 38400020
374700                                                                  38410020
374800     PERFORM F3500-CALCULATE-FRCST-PERCENT                        38420020
374900       VARYING PV-HIST-INDEX FROM 1 BY 1                          38430020
375000       UNTIL PV-HIST-INDEX > 4.                                   38440020
375100                                                                  38450020
375200***************************************************************** 38460020
375300* OPEN GROUP-HIST-FRCST CURSOR                                    38470020
375400***************************************************************** 38480020
375500 F3100-OPEN-HIST-FRCST-CSR.                                       38490020
375600                                                                  38500020
375700     MOVE 'F3100'                    TO PGM-LOCATION.             38510020
375800     MOVE 'F3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      38520020
375900                                                                  38530020
376000     EXEC SQL                                                     38540020
376100         OPEN GROUP-HIST-FRCST                                    38550020
376200     END-EXEC.                                                    38560020
376300                                                                  38570020
376400     EVALUATE TRUE                                                38580020
376500       WHEN SQLCODE         = ZERO                                38590020
376600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    38600020
376700         CONTINUE                                                 38610020
376800       WHEN OTHER                                                 38620020
376900         DISPLAY PV-ABEND-PARAGRAPH                               38630020
377000         PERFORM Z9900-SQL-ERROR                                  38640020
377100     END-EVALUATE.                                                38650020
377200                                                                  38660020
377300***************************************************************** 38670020
377400* LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST    38680020
377500* TO TOTAL                                                        38690020
377600***************************************************************** 38700020
377700 F3200-LOOP-THRU-CSR.                                             38710020
377800                                                                  38720020
377900     PERFORM F3300-FETCH-HIST-FRCST-CSR.                          38730020
378000     IF EOC-H-FRCST-CSR                                           38740020
378100         CONTINUE                                                 38750020
378200     ELSE                                                         38760020
378300         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                38770020
378400         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      38780020
378500         PERFORM B2000-READ-BIM-FILE                              38790020
378600         IF BIM-RECORD-FOUND                                      38800020
378700             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         38810020
378800             IF MRITEM-UCYCLE-CDE = 9                             38820020
378900                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       38830020
379000             ELSE                                                 38840020
379100                 IF MRITEM-UCYCLE-CDE = 5                         38850020
379200                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        38860020
379300                                     GIVING PV-DD-COMPUTED ROUNDED38870020
379400                 END-IF                                           38880020
379500             END-IF                                               38890020
379600             MULTIPLY PV-BI BY PV-DD-COMPUTED                     38900020
379700                                            GIVING PV-FORECAST    38910020
379800             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 38920020
379900         END-IF                                                   38930020
380000     END-IF.                                                      38940020
380100                                                                  38950020
380200***************************************************************** 38960020
380300* FETCH GROUP-HIST-FRCST CURSOR - GETS DD AND PTAG TO READ BIM    38970020
380400* FILE                                                            38980020
380500***************************************************************** 38990020
380600 F3300-FETCH-HIST-FRCST-CSR.                                      39000020
380700                                                                  39010020
380800     MOVE 'F3300'                       TO PGM-LOCATION.          39020020
380900     MOVE 'F3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    39030020
381000                                                                  39040020
381100     EXEC SQL                                                     39050020
381200       FETCH GROUP-HIST-FRCST                                     39060020
381300        INTO                                                      39070020
381400              :MRITEM-UCYCLE-CDE,                                 39080020
381500              :MRISHS-DSD-HIST-QTY,                               39090020
381600              :MRITST-PTAG-ID                                     39100020
381700     END-EXEC.                                                    39110020
381800                                                                  39120020
381900     EVALUATE TRUE                                                39130020
382000       WHEN SQLCODE         = ZERO                                39140020
382100         CONTINUE                                                 39150020
382200       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    39160020
382300         PERFORM F3400-CLOSE-FRCST-LEVEL-CSR                      39170020
382400         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          39180020
382500       WHEN OTHER                                                 39190020
382600         DISPLAY PV-ABEND-PARAGRAPH                               39200020
382700         PERFORM Z9900-SQL-ERROR                                  39210020
382800     END-EVALUATE.                                                39220020
382900                                                                  39230020
383000******************************************************************39240020
383100*  CLOSE GROUP-HIST-FRCST CURSOR                               *  39250020
383200******************************************************************39260020
383300 F3400-CLOSE-FRCST-LEVEL-CSR.                                     39270020
383400                                                                  39280020
383500     MOVE 'F3400'                        TO PGM-LOCATION.         39290020
383600     MOVE 'F3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   39300020
383700                                                                  39310020
383800     EXEC SQL                                                     39320020
383900         CLOSE GROUP-HIST-FRCST                                   39330020
384000     END-EXEC.                                                    39340020
384100                                                                  39350020
384200     EVALUATE TRUE                                                39360020
384300         WHEN SQLCODE EQUAL ZERO                                  39370020
384400         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      39380020
384500             CONTINUE                                             39390020
384600         WHEN OTHER                                               39400020
384700             DISPLAY PV-ABEND-PARAGRAPH                           39410020
384800             PERFORM Z9900-SQL-ERROR                              39420020
384900     END-EVALUATE.                                                39430020
385000                                                                  39440020
385100***************************************************************** 39450020
385200* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     39460020
385300* WHAT WAS SOLD.                                                  39470020
385400***************************************************************** 39480020
385500 F3500-CALCULATE-FRCST-PERCENT.                                   39490020
385600                                                                  39500020
385700     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         39510020
385800     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            39520020
385900                                                                  39530020
386000     IF  PV-FORECAST = 0                                          39540020
386100         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       39550020
386200     ELSE                                                         39560020
386300         IF (PV-FORECAST = 0) OR (PV-SALES  = 0)                  39570020
386400             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     39580020
386500         ELSE                                                     39590020
386600             COMPUTE PV-FRCST-PERCENT ROUNDED =                   39600020
386700                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    39610020
386800             MOVE PV-FRCST-PERCENT                                39620020
386900                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          39630020
387000         END-IF                                                   39640020
387100     END-IF.                                                      39650020
387200                                                                  39660020
387300***************************************************************** 39670020
387400* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  39680020
387500* TIME.                                                           39690020
387600***************************************************************** 39700020
387700 F4000-GET-CURRENT-INFO.                                          39710020
387800                                                                  39720020
387900     MOVE PC-N TO PS-EOC-CURR-CSR                                 39730020
388000     PERFORM F4100-FETCH-CURRENT-INFO.                            39740020
388100     IF EOC-CURR-CSR                                              39750020
388200         MOVE ZEROES           TO  DL3-ONORDER                    39760020
388300         MOVE ZEROES           TO  DL10-ONHAND                    39770020
388400         MOVE ZEROES           TO  DL6-DD-CURR                    39780020
388500         MOVE ZEROES           TO  DL11-CSTOCK                    39790020
388600         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 39800020
388700         MOVE ZEROES           TO  DL2-LEAD-TIME                  39810020
388800     ELSE                                                         39820020
388900         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    39830020
389000         MOVE PV-ONHAND        TO  DL10-ONHAND                    39840020
389100         MOVE PV-DD            TO  DL6-DD-CURR                    39850020
389200         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    39860020
389300         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 39870020
389400         MOVE PV-LT            TO  DL2-LEAD-TIME                  39880020
389500     END-IF.                                                      39890020
389600                                                                  39900020
389700***************************************************************** 39910020
389800* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  39920020
389900* AND MAXIMUM LEAD TIME                                           39930020
390000***************************************************************** 39940020
390100 F4100-FETCH-CURRENT-INFO.                                        39950020
390200                                                                  39960020
390300     MOVE 'F4100'                       TO PGM-LOCATION.          39970020
390400     MOVE 'F4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    39980020
390500                                                                  39990020
390510******************************************************************40000026
390520* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      40010026
390530* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        40020026
390540* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 40030026
390550******************************************************************40040026
390600     EXEC SQL                                                     40050020
390700          SELECT                                                  40060020
390800                  COALESCE(SUM(D.DD_FCTR),0)                      40070020
390900                , COALESCE(SUM(F.ONHAND_QTY),0)                   40080020
391000                , COALESCE(SUM(D.CSTOCK_QTY),0)                   40090020
391100                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 40100020
391200                , COALESCE(AVG(D.OSTRAT_QTY),0)                   40110020
391300                , COALESCE(MAX(LT_QTY),0)                         40120020
391400          INTO  :PV-DD                                            40130020
391500               ,:PV-ONHAND                                        40140020
391600               ,:PV-CSTOCK                                        40150020
391700               ,:PV-ON-ORDER                                      40160020
391800               ,:PV-OSTRAT                                        40170020
391900               ,:PV-LT                                            40180020
392000          FROM   TSK      A                                       40190021
392100                ,TMRITEM  B                                       40200021
392200                ,TMRITST  D                                       40210021
392300                ,TSKST    F                                       40220021
392400                ,XMT_LOC  G                                       40230031
392500                ,TSKXREF  X                                       40240021
392600          WHERE  A.ITEM_NMBR          = B.ITEM_NBR                40250020
392700            AND  A.ITEM_NMBR          = D.ITEM_NBR                40260020
392800            AND  A.ITEM_NMBR          = F.ITEM_NMBR               40270020
392900            AND  A.ITEM_NMBR          = X.ITM_NBR                 40280021
393000            AND  D.STR_NBR            = F.LOC_NBR                 40290032
393100            AND  D.STR_NBR            > 0                         40300031
393200            AND  D.FT_CDE             = 'O'                       40310020
393300            AND  D.STR_NBR            = G.LOC_NBR                 40320031
393500            AND  G.E_BUS_IND          = :PC-Y                     40340031
393600            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         40350021
393700            AND  A.GROUP_CODE         = :PV-HOLD-GROUP-CODE       40360020
                WITH UR                                                 40361037
393800     END-EXEC.                                                    40370020
393900                                                                  40380020
394000     EVALUATE TRUE                                                40390020
394100       WHEN SQLCODE         = ZERO                                40400020
394200         CONTINUE                                                 40410020
394300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    40420020
394400         MOVE PC-Y TO PS-EOC-CURR-CSR                             40430020
394500       WHEN OTHER                                                 40440020
394600         DISPLAY PV-ABEND-PARAGRAPH                               40450020
394700         PERFORM Z9900-SQL-ERROR                                  40460020
394800     END-EVALUATE.                                                40470020
394900                                                                  40480020
395000***************************************************************** 40490020
395100* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    40500020
395200* FOR THE NEXT 52 WEEKS.                                          40510020
395300***************************************************************** 40520020
395400 F5000-GET-CURRENT-FORECAST.                                      40530020
395500                                                                  40540020
395600        PERFORM F5100-INITIALZE-TABLE.                            40550020
395700        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           40560020
395800        PERFORM F5200-OPEN-CURR-FRCST-CSR.                        40570020
395900        PERFORM F5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   40580020
396000        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           40590020
396100                                    TO DL7-CURRENT-FRCST.         40600020
396200        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           40610020
396300                            TO DL7-FUTURE-FRCST(PC-ONE).          40620020
396400        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         40630020
396500                            TO DL7-FUTURE-FRCST(PC-TWO).          40640020
396600        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          40650020
396700                            TO DL7-FUTURE-FRCST(PC-THREE).        40660020
396800        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          40670020
396900                            TO DL7-FUTURE-FRCST(PC-FOUR).         40680020
397000        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           40690020
397100                            TO DL7-FUTURE-FRCST(PC-FIVE).         40700020
397200                                                                  40710020
397300***************************************************************** 40720020
397400* INITIALZE FORECAST TABLE.                                       40730020
397500***************************************************************** 40740020
397600 F5100-INITIALZE-TABLE.                                           40750020
397700                                                                  40760020
397800        MOVE PC-ONE      TO PV-BIM-INDEX.                         40770020
397900        PERFORM UNTIL PV-BIM-INDEX > PC-52                        40780020
398000            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      40790020
398100            ADD PC-ONE   TO PV-BIM-INDEX                          40800020
398200        END-PERFORM.                                              40810020
398300                                                                  40820020
398400                                                                  40830020
398500***************************************************************** 40840020
398600* OPEN GROUP-CURR-FRCST CURSOR                                    40850020
398700***************************************************************** 40860020
398800 F5200-OPEN-CURR-FRCST-CSR.                                       40870020
398900                                                                  40880020
399000     MOVE 'F5200'                    TO PGM-LOCATION.             40890020
399100     MOVE 'F5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      40900020
399200                                                                  40910020
399300     EXEC SQL                                                     40920020
399400         OPEN GROUP-CURR-FRCST                                    40930020
399500     END-EXEC.                                                    40940020
399600                                                                  40950020
399700     EVALUATE TRUE                                                40960020
399800       WHEN SQLCODE         = ZERO                                40970020
399900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    40980020
400000         CONTINUE                                                 40990020
400100       WHEN OTHER                                                 41000020
400200         DISPLAY PV-ABEND-PARAGRAPH                               41010020
400300         PERFORM Z9900-SQL-ERROR                                  41020020
400400     END-EVALUATE.                                                41030020
400500                                                                  41040020
400600***************************************************************** 41050020
400700* LOOP THRU GROUP-CURR-FRCST CURSOR AND CALCULATE FORECASTS.      41060020
400800***************************************************************** 41070020
400900 F5300-LOOP-THRU-CURR-CSR.                                        41080020
401000                                                                  41090020
401100     PERFORM F5400-FETCH-CURR-FRCST-CSR.                          41100020
401200     IF EOC-C-FRCST-CSR                                           41110020
401300         CONTINUE                                                 41120020
401400     ELSE                                                         41130020
401500         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           41140020
401600         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                41150020
401700         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      41160020
401800         PERFORM B2000-READ-BIM-FILE                              41170020
401900         IF BIM-RECORD-FOUND                                      41180020
402000             PERFORM F5600-CALCULATE-FORECAST                     41190020
402100                 VARYING PV-BIM-INDEX  FROM 1 BY 1                41200020
402200                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            41210020
402300         END-IF                                                   41220020
402400     END-IF.                                                      41230020
402500                                                                  41240020
402600***************************************************************** 41250020
402700* FETCH GROUP-CURR-FRCST CURSOR                                   41260020
402800***************************************************************** 41270020
402900 F5400-FETCH-CURR-FRCST-CSR.                                      41280020
403000                                                                  41290020
403100     MOVE 'F5400'                       TO PGM-LOCATION.          41300020
403200     MOVE 'F5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    41310020
403300                                                                  41320020
403400     EXEC SQL                                                     41330020
403500       FETCH GROUP-CURR-FRCST                                     41340020
403600        INTO                                                      41350020
403700              :MRITEM-UCYCLE-CDE,                                 41360020
403800              :MRITST-DD-FCTR,                                    41370020
403900              :MRITST-PTAG-ID                                     41380020
404000     END-EXEC.                                                    41390020
404100                                                                  41400020
404200     EVALUATE TRUE                                                41410020
404300       WHEN SQLCODE         = ZERO                                41420020
404400         CONTINUE                                                 41430020
404500       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    41440020
404600         PERFORM F5500-CLOSE-CURR-FRCST-CSR                       41450020
404700         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          41460020
404800       WHEN OTHER                                                 41470020
404900         DISPLAY PV-ABEND-PARAGRAPH                               41480020
405000         PERFORM Z9900-SQL-ERROR                                  41490020
405100     END-EVALUATE.                                                41500020
405200                                                                  41510020
405300******************************************************************41520020
405400* CLOSE GROUP-CURR-FRCST CURSOR                                  *41530020
405500******************************************************************41540020
405600 F5500-CLOSE-CURR-FRCST-CSR.                                      41550020
405700                                                                  41560020
405800     MOVE 'F5500'                       TO PGM-LOCATION.          41570020
405900     MOVE 'F5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    41580020
406000                                                                  41590020
406100     EXEC SQL                                                     41600020
406200         CLOSE GROUP-CURR-FRCST                                   41610020
406300     END-EXEC.                                                    41620020
406400                                                                  41630020
406500     EVALUATE TRUE                                                41640020
406600         WHEN SQLCODE EQUAL ZERO                                  41650020
406700         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      41660020
406800             CONTINUE                                             41670020
406900         WHEN OTHER                                               41680020
407000             DISPLAY PV-ABEND-PARAGRAPH                           41690020
407100             PERFORM Z9900-SQL-ERROR                              41700020
407200     END-EVALUATE.                                                41710020
407300                                                                  41720020
407400***************************************************************** 41730020
407500* CALCULATE FORECAST.                                             41740020
407600***************************************************************** 41750020
407700 F5600-CALCULATE-FORECAST.                                        41760020
407800                                                                  41770020
407900     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 41780020
408000     IF MRITEM-UCYCLE-CDE = 9                                     41790020
408100         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               41800020
408200     ELSE                                                         41810020
408300         IF MRITEM-UCYCLE-CDE = 5                                 41820020
408400             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                41830020
408500                             GIVING PV-DD-COMPUTED ROUNDED        41840020
408600         END-IF                                                   41850020
408700     END-IF.                                                      41860020
408800                                                                  41870020
408900     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        41880020
409000     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX)       41890020
409100                                                                  41900020
409200     IF PV-BIM-WEEK-INDEX = PC-52                                 41910020
409300         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    41920020
409400     ELSE                                                         41930020
409500         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    41940020
409600     END-IF.                                                      41950020
409700                                                                  41960020
409800***************************************************************** 41970020
409900* CONTROL BREAK AT THE COLOR VENDOR LEVEL                         41980020
410000***************************************************************** 41990020
410100 G0000-VENDOR-BREAK.                                              42000020
410200                                                                  42010020
410300     MOVE PC-N                         TO PS-EOC-VENDOR-CSR.      42020020
410400     PERFORM G0100-OPEN-VENDOR-CSR.                               42030020
410500     PERFORM G0200-PROCESS-VENDOR-CSR  UNTIL EOC-VENDOR-CSR.      42040020
410600                                                                  42050020
410700***************************************************************** 42060020
410800*  OPEN VENDOR CURSOR                                             42070020
410900***************************************************************** 42080020
411000 G0100-OPEN-VENDOR-CSR.                                           42090020
411100                                                                  42100020
411200     MOVE 'G0100'                      TO PGM-LOCATION.           42110020
411300     MOVE 'G0100-OPEN-VENDOR-CSR' TO PV-ABEND-PARAGRAPH.          42120020
411400                                                                  42130020
411500     EXEC SQL                                                     42140020
411600         OPEN VENDOR-LEVEL                                        42150020
411700     END-EXEC.                                                    42160020
411800                                                                  42170020
411900     EVALUATE TRUE                                                42180020
412000       WHEN SQLCODE         = ZERO                                42190020
412100       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    42200020
412200         CONTINUE                                                 42210020
412300       WHEN OTHER                                                 42220020
412400         DISPLAY PV-ABEND-PARAGRAPH                               42230020
412500         PERFORM Z9900-SQL-ERROR                                  42240020
412600     END-EVALUATE.                                                42250020
412700                                                                  42260020
412800***************************************************************** 42270020
412900* PROCESS VENDOR CURSOR                                           42280020
413000***************************************************************** 42290020
413100 G0200-PROCESS-VENDOR-CSR.                                        42300020
413200                                                                  42310020
413300     PERFORM G0300-FETCH-VENDOR-CSR.                              42320020
413400     IF EOC-VENDOR-CSR                                            42330020
413500         CONTINUE                                                 42340020
413600     ELSE                                                         42350020
413700         MOVE TSK-ENT-ID                 TO  PV-HOLD-VENDOR-CODE  42360020
413800         MOVE ENTNME-ENT-NAME-DESC       TO  PV-HOLD-VENDOR-NAME  42370020
413900         MOVE PC-Y                       TO  PS-PROCESS-LINE-INFO 42380020
414000         PERFORM G1000-CREATE-REPORT-LINES                        42390020
414100         IF PROCESS-LINE-INFO                                     42400020
414200             PERFORM R0000-PRINT-REPORT-LINES                     42410020
414300         END-IF                                                   42420020
414400     END-IF.                                                      42430020
414500                                                                  42440020
414600***************************************************************** 42450020
414700* FETCH VENDOR CURSOR                                             42460020
414800***************************************************************** 42470020
414900  G0300-FETCH-VENDOR-CSR.                                         42480020
415000                                                                  42490020
415100     MOVE 'G0300'                       TO PGM-LOCATION.          42500020
415200     MOVE 'G0300-FETCH-VENDOR-CURSOR'                             42510020
415300                                        TO PV-ABEND-PARAGRAPH.    42520020
415400                                                                  42530020
415500     EXEC SQL                                                     42540020
415600       FETCH VENDOR-LEVEL                                         42550020
415700        INTO                                                      42560020
415800              :SKXREF-DEPT                                        42570027
415900             ,:TSK-ENT-ID                                         42580027
416000             ,:ENTNME-ENT-NAME-DESC                               42590027
416100     END-EXEC.                                                    42600020
416200                                                                  42610020
416300     EVALUATE TRUE                                                42620020
416400       WHEN SQLCODE         = ZERO                                42630020
416500         CONTINUE                                                 42640020
416600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    42650020
416700         PERFORM G0400-CLOSE-VENDOR-CSR                           42660020
416800         MOVE PC-Y TO PS-EOC-VENDOR-CSR                           42670020
416900       WHEN OTHER                                                 42680020
417000         DISPLAY PV-ABEND-PARAGRAPH                               42690020
417100         PERFORM Z9900-SQL-ERROR                                  42700020
417200     END-EVALUATE.                                                42710020
417300                                                                  42720020
417400******************************************************************42730020
417500*  CLOSE VENDOR CURSOR                                           *42740020
417600******************************************************************42750020
417700 G0400-CLOSE-VENDOR-CSR.                                          42760020
417800                                                                  42770020
417900     MOVE 'G0400'                        TO PGM-LOCATION.         42780020
418000     MOVE 'G0400-CLOSE-VENDOR-CSR'       TO PV-ABEND-PARAGRAPH.   42790020
418100                                                                  42800020
418200     EXEC SQL                                                     42810020
418300         CLOSE VENDOR-LEVEL                                       42820020
418400     END-EXEC.                                                    42830020
418500                                                                  42840020
418600     EVALUATE TRUE                                                42850020
418700         WHEN SQLCODE EQUAL ZERO                                  42860020
418800         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      42870020
418900             CONTINUE                                             42880020
419000         WHEN OTHER                                               42890020
419100             DISPLAY PV-ABEND-PARAGRAPH                           42900020
419200             PERFORM Z9900-SQL-ERROR                              42910020
419300     END-EVALUATE.                                                42920020
419400                                                                  42930020
419500***************************************************************** 42940020
419600*  SET UP DATA FOR THE REPORT LINES                               42950020
419700***************************************************************** 42960020
419800 G1000-CREATE-REPORT-LINES.                                       42970020
419900                                                                  42980020
420000     MOVE ZERO                       TO PV-CUMM-SALES.            42990020
420100     PERFORM G2000-GET-HISTORY-INFO.                              43000020
420200     MOVE PV-CUMM-SALES              TO DL8-CUMM-SALES.           43010020
420300                                                                  43020020
420400     MOVE ZERO                       TO PV-CUMM-FRCST.            43030020
420500     PERFORM G3000-GET-HISTORY-FORECAST.                          43040020
420600     MOVE PV-CUMM-FRCST              TO DL7-CUMM-FRCST.           43050020
420700                                                                  43060020
420800     IF PV-HOLD-PER                                               43070020
420900         PERFORM B4000-CHECK-PERCENT-VARIANCE                     43080020
421000     END-IF.                                                      43090020
421100                                                                  43100020
421200                                                                  43110020
421300     IF PROCESS-LINE-INFO                                         43120020
421400         PERFORM G4000-GET-CURRENT-INFO                           43130020
421500         PERFORM G5000-GET-CURRENT-FORECAST                       43140020
421600         PERFORM B3000-CALCULATE-WEEKS-SUPPLY                     43150020
421700     END-IF.                                                      43160020
421800                                                                  43170020
421900     IF PROCESS-LINE-INFO                                         43180020
422000         PERFORM B4100-CALCULATE-CUMM-PCNT                        43190020
422100         PERFORM B4200-CALCULATE-CSTOCK-PERCENT                   43200020
422200     END-IF.                                                      43210020
422300                                                                  43220020
422400                                                                  43230020
422500***************************************************************** 43240020
422600*  GETS DD, MADDSS, ONHAND, AND SALES FOR PREVIOUS FOUR WEEKS     43250020
422700***************************************************************** 43260020
422800 G2000-GET-HISTORY-INFO.                                          43270020
422900                                                                  43280020
423000     PERFORM                                                      43290020
423100       VARYING PV-HIST-INDEX FROM 1 BY 1                          43300020
423200       UNTIL PV-HIST-INDEX > 4                                    43310020
423300          MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR        43320020
423400          MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK        43330020
423500          MOVE PC-N                   TO PS-EOC-HIST-CSR          43340020
423600          PERFORM G2100-FETCH-HISTORY-INFO                        43350020
423700          IF EOC-HIST-CSR                                         43360020
423800              MOVE ZEROES      TO  DL6-DD(PV-HIST-INDEX)          43370020
423900              MOVE ZEROES      TO  DL10-OH-HIST(PV-HIST-INDEX)    43380020
424000          ELSE                                                    43390020
424100              MOVE PV-DD       TO  DL6-DD(PV-HIST-INDEX)          43400020
424200              MOVE PV-ONHAND   TO  DL10-OH-HIST(PV-HIST-INDEX)    43410020
424300          END-IF                                                  43420020
424400     END-PERFORM.                                                 43430020
424500                                                                  43440020
424600     PERFORM                                                      43450020
424700       VARYING PV-HIST-INDEX FROM 1 BY 1                          43460020
424800       UNTIL PV-HIST-INDEX > 4                                    43470020
424900          MOVE PT-FSCL-DATE(PV-HIST-INDEX) TO PV-HOLD-FSCL-DATE   43480020
425000          MOVE PC-N                        TO PS-EOC-SLS-HIST-CSR 43490020
425100          PERFORM G2300-FETCH-HIST-SLS-INFO                       43500020
425200          IF EOC-SLS-HIST-CSR                                     43510020
425300              MOVE ZEROES      TO  DL8-SALES(PV-HIST-INDEX)       43520020
425400          ELSE                                                    43530020
425500              MOVE PV-SALES    TO  DL8-SALES(PV-HIST-INDEX)       43540020
425600              ADD  PV-SALES    TO  PV-CUMM-SALES                  43550020
425700          END-IF                                                  43560020
425800     END-PERFORM.                                                 43570020
425900                                                                  43580020
426000***************************************************************** 43590020
426100*  FETCHS DD, MADDSS, AND ONHAND FOUR THE 4 PREVIOUS WEEKS.       43600020
426200***************************************************************** 43610020
426300 G2100-FETCH-HISTORY-INFO.                                        43620020
426400                                                                  43630020
426500     MOVE 'G2100'                       TO PGM-LOCATION.          43640020
426600     MOVE 'G2100-FETCH-HISTORY-INFO'    TO PV-ABEND-PARAGRAPH.    43650020
426700                                                                  43660020
426710******************************************************************43670026
426720* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      43680026
426730* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        43690026
426740* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 43700026
426750******************************************************************43710026
426800     EXEC SQL                                                     43720020
426900          SELECT                                                  43730020
427000                  COALESCE(SUM(C.OH_HIST_QTY),0)                  43740020
427100                , COALESCE(SUM(C.DSD_HIST_QTY),0)                 43750020
427200                , COALESCE(SUM(C.MAD_HIST_QTY),0)                 43760020
427300          INTO                                                    43770020
427400                :PV-ONHAND                                        43780020
427500               ,:PV-DD                                            43790020
427600               ,:PV-MADDSS                                        43800020
427700          FROM   TSK     A                                        43810021
427800                ,TMRITEM B                                        43820020
427900                ,TMRISHS C                                        43830020
428000                ,TMRITST D                                        43840020
428100                ,XMT_LOC G                                        43850031
428200                ,TSKXREF X                                        43860021
428300          WHERE  A.ITEM_NMBR         = B.ITEM_NBR                 43870020
428400            AND  A.ITEM_NMBR         = C.ITM_NBR                  43880020
428500            AND  A.ITEM_NMBR         = D.ITEM_NBR                 43890020
428600            AND  A.ITEM_NMBR         = X.ITM_NBR                  43900021
428700            AND  C.STR_NBR           = D.STR_NBR                  43910020
428800            AND  C.STR_NBR           > 0                          43920031
428900            AND  D.FT_CDE            = 'O'                        43930020
429000            AND  D.STR_NBR           = G.LOC_NBR                  43940031
429200            AND  G.E_BUS_IND         = :PC-Y                      43960031
429300            AND  C.YR_NBR            = :PV-HOLD-YEAR              43970020
429400            AND  C.WK_NBR            = :PV-HOLD-WEEK              43980020
429500            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          43990021
429600            AND  A.ENT_ID            = :PV-HOLD-VENDOR-CODE       44000020
429700            AND  C.ITM_REV_ID        = (SELECT MAX (E.ITM_REV_ID) 44010020
429800                  FROM TMRISHS E                                  44020020
429900              WHERE                                               44030020
430000                    E.ITM_NBR        = C.ITM_NBR                  44040020
430100                AND E.STR_NBR        = C.STR_NBR                  44050020
430200                AND E.YR_NBR         = :PV-HOLD-YEAR              44060020
430300                AND E.WK_NBR         = :PV-HOLD-WEEK)             44070020
                 WITH UR                                                44071037
430400     END-EXEC.                                                    44080020
430500                                                                  44090020
430600     EVALUATE TRUE                                                44100020
430700       WHEN SQLCODE         = ZERO                                44110020
430800         CONTINUE                                                 44120020
430900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    44130020
431000         MOVE PC-Y TO PS-EOC-HIST-CSR                             44140020
431100       WHEN OTHER                                                 44150020
431200         DISPLAY PV-ABEND-PARAGRAPH                               44160020
431300         PERFORM Z9900-SQL-ERROR                                  44170020
431400     END-EVALUATE.                                                44180020
431500                                                                  44190020
431600***************************************************************** 44200020
431700*  FETCHS SALES FOR 4 PREVIOUS WEEKS.                             44210020
431800***************************************************************** 44220020
431900 G2300-FETCH-HIST-SLS-INFO.                                       44230020
432000                                                                  44240020
432100     MOVE 'G2300'                       TO PGM-LOCATION.          44250020
432200     MOVE 'G2300-FETCH-HIST-SLS-INFO'   TO PV-ABEND-PARAGRAPH.    44260020
432300                                                                  44270020
432310******************************************************************44280026
432320* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      44290026
432330* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        44300026
432340* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 44310026
432350******************************************************************44320026
432400     EXEC SQL                                                     44330020
432500          SELECT                                                  44340020
432600                  COALESCE(SUM(C.SLS_UNT_QTY),0)                  44350032
432700          INTO                                                    44360020
432800                :PV-SALES                                         44370020
432900          FROM   TSK      A                                       44380021
433000                ,TMRITEM  B                                       44390021
433100                ,MHT_DLY_SLS C                                    44400031
433200                ,TMRITST  D                                       44410021
433300                ,XMT_LOC  G                                       44420031
433400                ,TSKXREF  X                                       44430021
433500          WHERE  A.ITEM_NMBR         = B.ITEM_NBR                 44440020
433700            AND  A.ITEM_NMBR         = D.ITEM_NBR                 44460020
433800            AND  A.ITEM_NMBR         = X.ITM_NBR                  44470021
179100            AND  X.SKU               = C.SKU_NBR                  44471033
433900            AND  D.FT_CDE            = 'O'                        44480020
434000            AND  D.STR_NBR           = C.STR_NBR                  44490031
434100            AND  C.STR_NBR           > 0                          44500031
434200            AND  D.STR_NBR           = G.LOC_NBR                  44510031
434400            AND  G.E_BUS_IND         = :PC-Y                      44530031
434500            AND  X.DEPT              = :PV-HOLD-DEPT-NBR          44540021
434600            AND  A.ENT_ID            = :PV-HOLD-VENDOR-CODE       44550020
458500            AND  C.PRCG_DTE                                       44560031
                  BETWEEN :PV-HOLD-FSCL-DATE  AND                       44561031
                     DATE(:PV-HOLD-FSCL-DATE) + 6 DAYS                  44562031
264300            AND C.SKU_STAT_CDE IN ('10', '20', '40')              44563031
                WITH UR                                                 44564037
434900     END-EXEC.                                                    44580020
435000                                                                  44590020
435100     EVALUATE TRUE                                                44600020
435200       WHEN SQLCODE         = ZERO                                44610020
435300         CONTINUE                                                 44620020
435400       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    44630020
435500         MOVE PC-Y TO PS-EOC-SLS-HIST-CSR                         44640020
435600       WHEN OTHER                                                 44650020
435700         DISPLAY PV-ABEND-PARAGRAPH                               44660020
435800         PERFORM Z9900-SQL-ERROR                                  44670020
435900     END-EVALUATE.                                                44680020
436000                                                                  44690020
436100***************************************************************** 44700020
436200* CALCULATES FORECAST FOR LAST 4 WEEKS                            44710020
436300***************************************************************** 44720020
436400 G3000-GET-HISTORY-FORECAST.                                      44730020
436500                                                                  44740020
436600     PERFORM                                                      44750020
436700       VARYING PV-HIST-INDEX FROM 1 BY 1                          44760020
436800       UNTIL PV-HIST-INDEX > 4                                    44770020
436900        MOVE PT-HIST-YEAR(PV-HIST-INDEX) TO PV-HOLD-YEAR          44780020
437000        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-HOLD-WEEK          44790020
437100        MOVE PT-HIST-WEEK(PV-HIST-INDEX) TO PV-BIM-WEEK-INDEX     44800020
437200        MOVE PC-N TO PS-EOC-H-FRCST-CSR                           44810020
437300        PERFORM G3100-OPEN-HIST-FRCST-CSR                         44820020
437400        MOVE ZERO                        TO PV-TOTAL-FORECAST     44830020
437500        PERFORM G3200-LOOP-THRU-CSR                               44840020
437600                    UNTIL EOC-H-FRCST-CSR                         44850020
437700        MOVE PV-TOTAL-FORECAST                                    44860020
437800                                 TO DL7-HIST-FRCST(PV-HIST-INDEX) 44870020
437900        ADD  PV-TOTAL-FORECAST   TO PV-CUMM-FRCST                 44880020
438000     END-PERFORM.                                                 44890020
438100                                                                  44900020
438200     PERFORM G3500-CALCULATE-FRCST-PERCENT                        44910020
438300       VARYING PV-HIST-INDEX FROM 1 BY 1                          44920020
438400       UNTIL PV-HIST-INDEX > 4.                                   44930020
438500                                                                  44940020
438600***************************************************************** 44950020
438700* OPEN VENDOR-HIST-FRCST CURSOR                                   44960020
438800***************************************************************** 44970020
438900 G3100-OPEN-HIST-FRCST-CSR.                                       44980020
439000                                                                  44990020
439100     MOVE 'G3100'                    TO PGM-LOCATION.             45000020
439200     MOVE 'G3100-OPEN-HIST-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      45010020
439300                                                                  45020020
439400     EXEC SQL                                                     45030020
439500         OPEN VENDOR-HIST-FRCST                                   45040020
439600     END-EXEC.                                                    45050020
439700                                                                  45060020
439800     EVALUATE TRUE                                                45070020
439900       WHEN SQLCODE         = ZERO                                45080020
440000       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    45090020
440100         CONTINUE                                                 45100020
440200       WHEN OTHER                                                 45110020
440300         DISPLAY PV-ABEND-PARAGRAPH                               45120020
440400         PERFORM Z9900-SQL-ERROR                                  45130020
440500     END-EVALUATE.                                                45140020
440600                                                                  45150020
440700***************************************************************** 45160020
440800*  LOOP THRU HIST-FRCST CURSOR AND CALCULATES AND ADDS FORECAST   45170020
440900*  TO TOTAL                                                       45180020
441000***************************************************************** 45190020
441100 G3200-LOOP-THRU-CSR.                                             45200020
441200                                                                  45210020
441300     PERFORM G3300-FETCH-HIST-FRCST-CSR.                          45220020
441400     IF EOC-H-FRCST-CSR                                           45230020
441500         CONTINUE                                                 45240020
441600     ELSE                                                         45250020
441700         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                45260020
441800         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      45270020
441900         PERFORM B2000-READ-BIM-FILE                              45280020
442000         IF BIM-RECORD-FOUND                                      45290020
442100             MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI         45300020
442200             IF MRITEM-UCYCLE-CDE = 9                             45310020
442300                 MOVE MRISHS-DSD-HIST-QTY TO PV-DD-COMPUTED       45320020
442400             ELSE                                                 45330020
442500                 IF MRITEM-UCYCLE-CDE = 5                         45340020
442600                     DIVIDE MRISHS-DSD-HIST-QTY BY PC-FOUR        45350020
442700                                     GIVING PV-DD-COMPUTED ROUNDED45360020
442800                 END-IF                                           45370020
442900             END-IF                                               45380020
443000             MULTIPLY PV-BI BY PV-DD-COMPUTED                     45390020
443100                                            GIVING PV-FORECAST    45400020
443200             ADD PV-FORECAST TO PV-TOTAL-FORECAST                 45410020
443300         END-IF                                                   45420020
443400     END-IF.                                                      45430020
443500                                                                  45440020
443600***************************************************************** 45450020
443700* FETCH VENDOR-HIST-FRCST CURSOR GETS DD AND PTAG TO READ BIM     45460020
443800* FILE                                                            45470020
443900***************************************************************** 45480020
444000 G3300-FETCH-HIST-FRCST-CSR.                                      45490020
444100                                                                  45500020
444200     MOVE 'G3300'                       TO PGM-LOCATION.          45510020
444300     MOVE 'G3300-FETCH-HIST-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    45520020
444400                                                                  45530020
444500     EXEC SQL                                                     45540020
444600       FETCH VENDOR-HIST-FRCST                                    45550020
444700        INTO                                                      45560020
444800              :MRITEM-UCYCLE-CDE,                                 45570020
444900              :MRISHS-DSD-HIST-QTY,                               45580020
445000              :MRITST-PTAG-ID                                     45590020
445100     END-EXEC.                                                    45600020
445200*                                                                 45610020
445300     EVALUATE TRUE                                                45620020
445400       WHEN SQLCODE         = ZERO                                45630020
445500         CONTINUE                                                 45640020
445600       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    45650020
445700         PERFORM G3400-CLOSE-FRCST-LEVEL-CSR                      45660020
445800         MOVE PC-Y TO PS-EOC-H-FRCST-CSR                          45670020
445900       WHEN OTHER                                                 45680020
446000         DISPLAY PV-ABEND-PARAGRAPH                               45690020
446100         PERFORM Z9900-SQL-ERROR                                  45700020
446200     END-EVALUATE.                                                45710020
446300                                                                  45720020
446400******************************************************************45730020
446500*  CLOSE VENDOR-HIST-FRCST CURSOR                               * 45740020
446600******************************************************************45750020
446700 G3400-CLOSE-FRCST-LEVEL-CSR.                                     45760020
446800*                                                                 45770020
446900     MOVE 'G3400'                        TO PGM-LOCATION.         45780020
447000     MOVE 'G3400-CLOSE-FRCST-LEVEL-CSR'  TO PV-ABEND-PARAGRAPH.   45790020
447100                                                                  45800020
447200     EXEC SQL                                                     45810020
447300         CLOSE VENDOR-HIST-FRCST                                  45820020
447400     END-EXEC.                                                    45830020
447500*                                                                 45840020
447600     EVALUATE TRUE                                                45850020
447700         WHEN SQLCODE EQUAL ZERO                                  45860020
447800         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      45870020
447900             CONTINUE                                             45880020
448000         WHEN OTHER                                               45890020
448100             DISPLAY PV-ABEND-PARAGRAPH                           45900020
448200             PERFORM Z9900-SQL-ERROR                              45910020
448300     END-EVALUATE.                                                45920020
448400                                                                  45930020
448500***************************************************************** 45940020
448600* CALCULATES PERCENT DIFFERENCE BETWEEN WHAT WAS FORECAST AND     45950020
448700* WHAT WAS SOLD.                                                  45960020
448800***************************************************************** 45970020
448900 G3500-CALCULATE-FRCST-PERCENT.                                   45980020
449000                                                                  45990020
449100     MOVE DL7-HIST-FRCST(PV-HIST-INDEX)   TO PV-FORECAST.         46000020
449200     MOVE DL8-SALES(PV-HIST-INDEX)        TO PV-SALES.            46010020
449300                                                                  46020020
449400     IF  PV-FORECAST = 0                                          46030020
449500         MOVE '***'          TO  DL9-DIFFRNC(PV-HIST-INDEX)       46040020
449600     ELSE                                                         46050020
449700         IF (PV-FORECAST = 0) OR (PV-SALES  = 0)                  46060020
449800             MOVE 0          TO  DL9-DIFFRNC-N(PV-HIST-INDEX)     46070020
449900         ELSE                                                     46080020
450000             COMPUTE PV-FRCST-PERCENT ROUNDED =                   46090020
450100                  (PV-SALES - PV-FORECAST) / PV-FORECAST * 100    46100020
450200             MOVE PV-FRCST-PERCENT                                46110020
450300                         TO DL9-DIFFRNC-N(PV-HIST-INDEX)          46120020
450400         END-IF                                                   46130020
450500     END-IF.                                                      46140020
450600                                                                  46150020
450700***************************************************************** 46160020
450800* GETS ONORDER, ONHAND, DD, CSTOCK, AVG OSTRAT, AND MAXIMUM LEAD  46170020
450900* TIME.                                                           46180020
451000***************************************************************** 46190020
451100 G4000-GET-CURRENT-INFO.                                          46200020
451200                                                                  46210020
451300     MOVE PC-N TO PS-EOC-CURR-CSR                                 46220020
451400     PERFORM G4100-FETCH-CURRENT-INFO.                            46230020
451500     IF EOC-CURR-CSR                                              46240020
451600         MOVE ZEROES           TO  DL3-ONORDER                    46250020
451700         MOVE ZEROES           TO  DL10-ONHAND                    46260020
451800         MOVE ZEROES           TO  DL6-DD-CURR                    46270020
451900         MOVE ZEROES           TO  DL11-CSTOCK                    46280020
452000         MOVE ZEROES           TO  DL2-AVG-OSTRAT                 46290020
452100         MOVE ZEROES           TO  DL2-LEAD-TIME                  46300020
452200     ELSE                                                         46310020
452300         MOVE PV-ON-ORDER      TO  DL3-ONORDER                    46320020
452400         MOVE PV-ONHAND        TO  DL10-ONHAND                    46330020
452500         MOVE PV-DD            TO  DL6-DD-CURR                    46340020
452600         MOVE PV-CSTOCK        TO  DL11-CSTOCK                    46350020
452700         MOVE PV-OSTRAT        TO  DL2-AVG-OSTRAT                 46360020
452800         MOVE PV-LT            TO  DL2-LEAD-TIME                  46370020
452900     END-IF.                                                      46380020
453000                                                                  46390020
453100***************************************************************** 46400020
453200* FETCH CURRENT INFO FOR DD, ONHAND, CSTOCK, ONORDER, AVG OSTRAT  46410020
453300* AND MAXIMUM LEAD TIME                                           46420020
453400***************************************************************** 46430020
453500 G4100-FETCH-CURRENT-INFO.                                        46440020
453600                                                                  46450020
453700     MOVE 'G4100'                       TO PGM-LOCATION.          46460020
453800     MOVE 'G4100-FETCH-CURRENT-INFO'    TO PV-ABEND-PARAGRAPH.    46470020
453900                                                                  46480020
453910******************************************************************46490026
453920* MRNIS-RFC   PREVIOUS   DEPT FROM TSK OF FS                      46500026
453930* MRNIS-RFC   CURRENT    DEPT FROM TSKXREF                        46510026
453940* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 46520026
453950******************************************************************46530026
454000     EXEC SQL                                                     46540020
454100          SELECT                                                  46550020
454200                  COALESCE(SUM(D.DD_FCTR),0)                      46560020
454300                , COALESCE(SUM(F.ONHAND_QTY),0)                   46570020
454400                , COALESCE(SUM(D.CSTOCK_QTY),0)                   46580020
454500                , COALESCE(SUM(D.ON_ORDER_QTY),0)                 46590020
454600                , COALESCE(AVG(D.OSTRAT_QTY),0)                   46600020
454700                , COALESCE(MAX(LT_QTY),0)                         46610020
454800          INTO  :PV-DD                                            46620020
454900               ,:PV-ONHAND                                        46630020
455000               ,:PV-CSTOCK                                        46640020
455100               ,:PV-ON-ORDER                                      46650020
455200               ,:PV-OSTRAT                                        46660020
455300               ,:PV-LT                                            46670020
455400          FROM   TSK     A                                        46680021
455500                ,TMRITEM B                                        46690020
455600                ,TMRITST D                                        46700020
455700                ,TSKST   F                                        46710021
455800                ,XMT_LOC G                                        46720031
455900                ,TSKXREF X                                        46730021
456000          WHERE  A.ITEM_NMBR          = B.ITEM_NBR                46740020
456100            AND  A.ITEM_NMBR          = D.ITEM_NBR                46750020
456200            AND  A.ITEM_NMBR          = F.ITEM_NMBR               46760020
456300            AND  A.ITEM_NMBR          = X.ITM_NBR                 46770021
456400            AND  D.STR_NBR            = F.LOC_NBR                 46780032
456500            AND  D.STR_NBR            > 0                         46790031
456600            AND  D.FT_CDE             = 'O'                       46800020
456700            AND  D.STR_NBR            = G.LOC_NBR                 46810031
456900            AND  G.E_BUS_IND          = :PC-Y                     46830031
457000            AND  X.DEPT               = :PV-HOLD-DEPT-NBR         46840021
457100            AND  A.ENT_ID             = :PV-HOLD-VENDOR-CODE      46850020
                WITH UR                                                 46851037
457200     END-EXEC.                                                    46860020
457300                                                                  46870020
457400     EVALUATE TRUE                                                46880020
457500       WHEN SQLCODE         = ZERO                                46890020
457600         CONTINUE                                                 46900020
457700       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    46910020
457800         MOVE PC-Y TO PS-EOC-CURR-CSR                             46920020
457900       WHEN OTHER                                                 46930020
458000         DISPLAY PV-ABEND-PARAGRAPH                               46940020
458100         PERFORM Z9900-SQL-ERROR                                  46950020
458200     END-EVALUATE.                                                46960020
458300                                                                  46970020
458400***************************************************************** 46980020
458500* GETS CURRENT FORECAST AND CALCULATES AND STORES THE FORECAST    46990020
458600* FOR THE NEXT 52 WEEKS.                                          47000020
458700***************************************************************** 47010020
458800 G5000-GET-CURRENT-FORECAST.                                      47020020
458900                                                                  47030020
459000        PERFORM G5100-INITIALZE-TABLE.                            47040020
459100        MOVE PC-N TO PS-EOC-C-FRCST-CSR                           47050020
459200        PERFORM G5200-OPEN-CURR-FRCST-CSR.                        47060020
459300        PERFORM G5300-LOOP-THRU-CURR-CSR UNTIL EOC-C-FRCST-CSR.   47070020
459400        MOVE PT-FORECAST-AMOUNT(PC-ONE)                           47080020
459500                                    TO DL7-CURRENT-FRCST.         47090020
459600        MOVE PT-FORECAST-AMOUNT(PC-TWO)                           47100020
459700                            TO DL7-FUTURE-FRCST(PC-ONE).          47110020
459800        MOVE PT-FORECAST-AMOUNT(PC-THREE)                         47120020
459900                            TO DL7-FUTURE-FRCST(PC-TWO).          47130020
460000        MOVE PT-FORECAST-AMOUNT(PC-FOUR)                          47140020
460100                            TO DL7-FUTURE-FRCST(PC-THREE).        47150020
460200        MOVE PT-FORECAST-AMOUNT(PC-FIVE)                          47160020
460300                            TO DL7-FUTURE-FRCST(PC-FOUR).         47170020
460400        MOVE PT-FORECAST-AMOUNT(PC-SIX)                           47180020
460500                            TO DL7-FUTURE-FRCST(PC-FIVE).         47190020
460600                                                                  47200020
460700***************************************************************** 47210020
460800* INITIALZE FORECAST TABLE.                                       47220020
460900***************************************************************** 47230020
461000 G5100-INITIALZE-TABLE.                                           47240020
461100                                                                  47250020
461200        MOVE PC-ONE      TO PV-BIM-INDEX.                         47260020
461300        PERFORM UNTIL PV-BIM-INDEX > PC-52                        47270020
461400            MOVE ZEROES  TO PT-FORECAST-AMOUNT(PV-BIM-INDEX)      47280020
461500            ADD PC-ONE   TO PV-BIM-INDEX                          47290020
461600        END-PERFORM.                                              47300020
461700                                                                  47310020
461800                                                                  47320020
461900***************************************************************** 47330020
462000* OPEN VENDOR-CURR-FRCST CURSOR                                   47340020
462100***************************************************************** 47350020
462200 G5200-OPEN-CURR-FRCST-CSR.                                       47360020
462300                                                                  47370020
462400     MOVE 'G5200'                    TO PGM-LOCATION.             47380020
462500     MOVE 'G5200-OPEN-CURR-FRCST-CSR' TO PV-ABEND-PARAGRAPH.      47390020
462600                                                                  47400020
462700     EXEC SQL                                                     47410020
462800         OPEN VENDOR-CURR-FRCST                                   47420020
462900     END-EXEC.                                                    47430020
463000                                                                  47440020
463100     EVALUATE TRUE                                                47450020
463200       WHEN SQLCODE         = ZERO                                47460020
463300       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    47470020
463400         CONTINUE                                                 47480020
463500       WHEN OTHER                                                 47490020
463600         DISPLAY PV-ABEND-PARAGRAPH                               47500020
463700         PERFORM Z9900-SQL-ERROR                                  47510020
463800     END-EVALUATE.                                                47520020
463900                                                                  47530020
464000***************************************************************** 47540020
464100* LOOP THRU VENDOR-CURR-FRCST CURSOR AND CALCULATE FORECASTS.     47550020
464200***************************************************************** 47560020
464300 G5300-LOOP-THRU-CURR-CSR.                                        47570020
464400                                                                  47580020
464500     PERFORM G5400-FETCH-CURR-FRCST-CSR.                          47590020
464600     IF EOC-C-FRCST-CSR                                           47600020
464700         CONTINUE                                                 47610020
464800     ELSE                                                         47620020
464900         MOVE PV-CURR-WEEK         TO PV-BIM-WEEK-INDEX           47630020
465000         MOVE MRITST-PTAG-ID       TO BIM-FILE-KEY                47640020
465100         MOVE PC-Y                 TO PS-BIM-RECORD-FOUND-SW      47650020
465200         PERFORM B2000-READ-BIM-FILE                              47660020
465300         IF BIM-RECORD-FOUND                                      47670020
465400             PERFORM G5600-CALCULATE-FORECAST                     47680020
465500                 VARYING PV-BIM-INDEX  FROM 1 BY 1                47690020
465600                 UNTIL PV-BIM-INDEX GREATER THAN PC-52            47700020
465700         END-IF                                                   47710020
465800     END-IF.                                                      47720020
465900                                                                  47730020
466000***************************************************************** 47740020
466100* FETCH VENDOR-CURR-FRCST CURSOR                                  47750020
466200***************************************************************** 47760020
466300 G5400-FETCH-CURR-FRCST-CSR.                                      47770020
466400                                                                  47780020
466500     MOVE 'G5400'                       TO PGM-LOCATION.          47790020
466600     MOVE 'G5400-FETCH-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    47800020
466700                                                                  47810020
466800     EXEC SQL                                                     47820020
466900       FETCH VENDOR-CURR-FRCST                                    47830020
467000        INTO                                                      47840020
467100              :MRITEM-UCYCLE-CDE,                                 47850020
467200              :MRITST-DD-FCTR,                                    47860020
467300              :MRITST-PTAG-ID                                     47870020
467400     END-EXEC.                                                    47880020
467500*                                                                 47890020
467600     EVALUATE TRUE                                                47900020
467700       WHEN SQLCODE         = ZERO                                47910020
467800         CONTINUE                                                 47920020
467900       WHEN SQLCODE         = PC-ROW-NOT-FOUND                    47930020
468000         PERFORM G5500-CLOSE-CURR-FRCST-CSR                       47940020
468100         MOVE PC-Y TO PS-EOC-C-FRCST-CSR                          47950020
468200       WHEN OTHER                                                 47960020
468300         DISPLAY PV-ABEND-PARAGRAPH                               47970020
468400         PERFORM Z9900-SQL-ERROR                                  47980020
468500     END-EVALUATE.                                                47990020
468600                                                                  48000020
468700******************************************************************48010020
468800* CLOSE VENDOR-CURR-FRCST CURSOR                                 *48020020
468900******************************************************************48030020
469000 G5500-CLOSE-CURR-FRCST-CSR.                                      48040020
469100*                                                                 48050020
469200     MOVE 'G5500'                       TO PGM-LOCATION.          48060020
469300     MOVE 'G5500-CLOSE-CURR-FRCST-CSR'  TO PV-ABEND-PARAGRAPH.    48070020
469400                                                                  48080020
469500     EXEC SQL                                                     48090020
469600         CLOSE VENDOR-CURR-FRCST                                  48100020
469700     END-EXEC.                                                    48110020
469800*                                                                 48120020
469900     EVALUATE TRUE                                                48130020
470000         WHEN SQLCODE EQUAL ZERO                                  48140020
470100         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      48150020
470200             CONTINUE                                             48160020
470300         WHEN OTHER                                               48170020
470400             DISPLAY PV-ABEND-PARAGRAPH                           48180020
470500             PERFORM Z9900-SQL-ERROR                              48190020
470600     END-EVALUATE.                                                48200020
470700                                                                  48210020
470800***************************************************************** 48220020
470900* CALCULATE FORECAST.                                             48230020
471000***************************************************************** 48240020
471100 G5600-CALCULATE-FORECAST.                                        48250020
471200                                                                  48260020
471300     MOVE GBI-BI-WEEK(PV-BIM-WEEK-INDEX) TO PV-BI                 48270020
471400     IF MRITEM-UCYCLE-CDE = 9                                     48280020
471500         MOVE MRITST-DD-FCTR      TO PV-DD-COMPUTED               48290020
471600     ELSE                                                         48300020
471700         IF MRITEM-UCYCLE-CDE = 5                                 48310020
471800             DIVIDE MRITST-DD-FCTR      BY PC-FOUR                48320020
471900                            GIVING PV-DD-COMPUTED ROUNDED         48330020
472000         END-IF                                                   48340020
472100     END-IF.                                                      48350020
472200                                                                  48360020
472300     MULTIPLY PV-BI BY PV-DD-COMPUTED  GIVING PV-FORECAST.        48370020
472400     ADD  PV-FORECAST  TO  PT-FORECAST-AMOUNT(PV-BIM-INDEX)       48380020
472500                                                                  48390020
472600     IF PV-BIM-WEEK-INDEX = PC-52                                 48400020
472700         MOVE PC-ONE      TO PV-BIM-WEEK-INDEX                    48410020
472800     ELSE                                                         48420020
472900         ADD PC-ONE       TO PV-BIM-WEEK-INDEX                    48430020
473000     END-IF.                                                      48440020
473100                                                                  48450020
473200***************************************************************** 48460020
473300* R0000-PRINT-REPORT-LINES CHECKS FOR PAGE BREAK AND PRINTS OUT   48470020
473400* THE REPORT LINES.                                               48480020
473500***************************************************************** 48490020
473600 R0000-PRINT-REPORT-LINES.                                        48500020
473700                                                                  48510020
473800     PERFORM R1000-SET-HEADING-LINES.                             48520020
473900                                                                  48530020
474000     IF PV-LINE-CNT > 54                                          48540020
474100          PERFORM R1100-PRINT-HEADINGS                            48550020
474200     END-IF                                                       48560020
474300                                                                  48570020
474400     MOVE PC-ONE                       TO PV-LINE-CONTROL.        48580020
474500     MOVE HL-HEADING-BLANK             TO PRINT-LINE.             48590020
474600     PERFORM R1200-WRITE-PRINT-LINE.                              48600020
474700     MOVE HL-HEADING-BLANK             TO PRINT-LINE.             48610020
474800     PERFORM R1200-WRITE-PRINT-LINE.                              48620020
474900     MOVE DETAIL-LINE1                 TO PRINT-LINE.             48630020
475000     PERFORM R1200-WRITE-PRINT-LINE.                              48640020
475100     MOVE DETAIL-LINE2                 TO PRINT-LINE.             48650020
475200     PERFORM R1200-WRITE-PRINT-LINE.                              48660020
475300     MOVE DETAIL-LINE3                 TO PRINT-LINE.             48670020
475400     PERFORM R1200-WRITE-PRINT-LINE.                              48680020
475500     MOVE HL-HEADING-BLANK             TO PRINT-LINE.             48690020
475600     PERFORM R1200-WRITE-PRINT-LINE.                              48700020
475700     MOVE DETAIL-LINE4                 TO PRINT-LINE.             48710020
475800     PERFORM R1200-WRITE-PRINT-LINE.                              48720020
475900     MOVE DETAIL-LINE5                 TO PRINT-LINE.             48730020
476000     PERFORM R1200-WRITE-PRINT-LINE.                              48740020
476100     MOVE DETAIL-LINE6                 TO PRINT-LINE.             48750020
476200     PERFORM R1200-WRITE-PRINT-LINE.                              48760020
476300     MOVE DETAIL-LINE7                 TO PRINT-LINE.             48770020
476400     PERFORM R1200-WRITE-PRINT-LINE.                              48780020
476500     MOVE DETAIL-LINE8                 TO PRINT-LINE.             48790020
476600     PERFORM R1200-WRITE-PRINT-LINE.                              48800020
476700     MOVE DETAIL-LINE9                 TO PRINT-LINE.             48810020
476800     PERFORM R1200-WRITE-PRINT-LINE.                              48820020
476900     MOVE DETAIL-LINE10                TO PRINT-LINE.             48830020
477000     PERFORM R1200-WRITE-PRINT-LINE.                              48840020
477100     MOVE DETAIL-LINE11                TO PRINT-LINE.             48850020
477200     PERFORM R1200-WRITE-PRINT-LINE.                              48860020
477300                                                                  48870020
477400     ADD  PC-FOURTEEN                  TO PV-LINE-CNT.            48880020
477500                                                                  48890020
477600***************************************************************** 48900020
477700* R1000-SET-HEADING-LINES.                                        48910020
477800***************************************************************** 48920020
477900 R1000-SET-HEADING-LINES.                                         48930020
478000                                                                  48940020
478100     INITIALIZE DETAIL-LINE1.                                     48950021
478200     MOVE PV-HOLD-DEPT-NBR            TO DL1-DEPARTMENT.          48960020
478300                                                                  48970020
478400     EVALUATE PV-HOLD-LEVEL                                       48980020
478500         WHEN 'MCL'                                               48990020
479000             MOVE '        MCL:'      TO DL2-RPT-LVL              49000021
479100             MOVE PV-HOLD-CLASS-NBR   TO DL2-RPT-LVL-DATA-94      49010021
479200         WHEN 'SCL'                                               49020020
479210             MOVE 'MCL:'              TO DL1-MCL-TITLE            49030027
479300             MOVE PV-HOLD-CLASS-NBR   TO DL1-MCL-94               49040021
479600             MOVE '        SCL:'      TO DL2-RPT-LVL              49050021
479700             MOVE PV-HOLD-SCL-NBR     TO DL2-RPT-LVL-DATA-94      49060021
479800         WHEN 'GRP'                                               49070020
479810             MOVE 'MCL:'              TO DL1-MCL-TITLE            49080027
479900             MOVE PV-HOLD-CLASS-NBR   TO DL1-MCL-94               49090021
479910             MOVE 'SCL:'              TO DL1-SCL-TITLE            49100027
480000             MOVE PV-HOLD-SCL-NBR     TO DL1-SCL-94               49110021
480100             MOVE '      GROUP:'      TO DL2-RPT-LVL              49120021
480200             MOVE PV-HOLD-GROUP-CODE  TO DL2-RPT-LVL-DATA         49130021
480300         WHEN 'VSC'                                               49140020
480310             MOVE 'MCL:'              TO DL1-MCL-TITLE            49150027
480400             MOVE PV-HOLD-CLASS-NBR   TO DL1-MCL-94               49160021
480410             MOVE 'SCL:'              TO DL1-SCL-TITLE            49170027
480500             MOVE PV-HOLD-SCL-NBR     TO DL1-SCL-94               49180021
480600             MOVE 'STYLE/COLOR:'      TO DL2-RPT-LVL              49190021
480700             MOVE PV-HOLD-STYLE       TO DL2-RPT-LVL-DATA         49200021
480800             MOVE '/'                 TO DL2-RPT-LVL-DATA(21:1)   49210021
480900             MOVE PV-HOLD-COLOR       TO DL2-RPT-LVL-DATA(22:15)  49220021
481000         WHEN 'VND'                                               49230020
481500             MOVE '     VENDOR:'      TO DL2-RPT-LVL              49240021
481600             MOVE PV-HOLD-VENDOR-NAME TO DL2-RPT-LVL-DATA         49250021
481700     END-EVALUATE.                                                49260020
481800                                                                  49270020
481900     MOVE PT-HIST-WEEK(PC-ONE)        TO DL5-LAST-WEEK-1.         49280020
482000     MOVE PT-HIST-WEEK(PC-TWO)        TO DL5-LAST-WEEK-2.         49290020
482100     MOVE PT-HIST-WEEK(PC-THREE)      TO DL5-LAST-WEEK-3.         49300020
482200     MOVE PT-HIST-WEEK(PC-FOUR)       TO DL5-LAST-WEEK-4.         49310020
482300     MOVE PV-CURR-WEEK                TO DL5-CURRENT-WEEK.        49320020
482400     MOVE PT-FUTURE-WEEK(PC-ONE)      TO DL5-FRCST-WEEK-1.        49330020
482500     MOVE PT-FUTURE-WEEK(PC-TWO)      TO DL5-FRCST-WEEK-2.        49340020
482600     MOVE PT-FUTURE-WEEK(PC-THREE)    TO DL5-FRCST-WEEK-3.        49350020
482700     MOVE PT-FUTURE-WEEK(PC-FOUR)     TO DL5-FRCST-WEEK-4.        49360020
482800     MOVE PT-FUTURE-WEEK(PC-FIVE)     TO DL5-FRCST-WEEK-5.        49370020
482900                                                                  49380020
483000****************************************************************  49390020
483100* R1100-PRINT-HEADINGS - WRITES THE HEADING LINES FOR THE      *  49400020
483200* REPORT WHEN THER PAGE IS FULL.                               *  49410020
483300****************************************************************  49420020
483400 R1100-PRINT-HEADINGS.                                            49430020
483500                                                                  49440020
483600     ADD +1                             TO PV-PAGE-CNT.           49450020
483700     MOVE PV-PAGE-CNT                   TO DP132-PAGE-NUMBER.     49460020
483800                                                                  49470020
483900                                                                  49480020
484000     MOVE DP132-STANDRD-HEADER-132-COLS TO PRINT-LINE.            49490020
484100     MOVE PC-ONE                        TO PV-LINE-CONTROL.       49500020
484200     PERFORM R1300-WRITE-TOP-OF-PAGE.                             49510020
484300                                                                  49520020
484400     MOVE  HL-HEADING-LINE1             TO PRINT-LINE.            49530020
484500     MOVE  PC-ONE                       TO PV-LINE-CONTROL.       49540020
484600     PERFORM R1200-WRITE-PRINT-LINE.                              49550020
484700                                                                  49560020
484800     MOVE PC-TWO                        TO PV-LINE-CNT.           49570020
484900                                                                  49580020
485000***************************************************************** 49590020
485100* R1200-WRITE-PRINT-LINE -                                        49600020
485200***************************************************************** 49610020
485300 R1200-WRITE-PRINT-LINE.                                          49620020
485400                                                                  49630020
485500     WRITE PRINT-LINE                                             49640020
485600         AFTER ADVANCING PV-LINE-CONTROL.                         49650020
485700                                                                  49660020
485800***************************************************************** 49670020
485900* R1300-WRITE-TOP-OF-PAGE -                                       49680020
486000***************************************************************** 49690020
486100 R1300-WRITE-TOP-OF-PAGE.                                         49700020
486200                                                                  49710020
486300     WRITE PRINT-LINE                                             49720020
486400         AFTER ADVANCING PAGE.                                    49730020
486500                                                                  49740020
486600******************************************************************49750020
486700* Z8000-CLOSE-DEPT-LEVEL-CSR                                    * 49760020
486800******************************************************************49770020
486900 Z8000-CLOSE-DEPT-LEVEL-CSR.                                      49780020
487000*                                                                 49790020
487100     MOVE 'Z8000'                       TO PGM-LOCATION.          49800020
487200     MOVE 'Z8000-CLOSE-DEPT-LEVEL-CSR' TO PV-ABEND-PARAGRAPH.     49810020
487300                                                                  49820020
487400     EXEC SQL                                                     49830020
487500         CLOSE DEPT-LEVEL                                         49840020
487600     END-EXEC.                                                    49850020
487700*                                                                 49860020
487800     EVALUATE TRUE                                                49870020
487900         WHEN SQLCODE EQUAL ZERO                                  49880020
488000         WHEN SQLCODE EQUAL PC-ROW-NOT-FOUND                      49890020
488100             CONTINUE                                             49900020
488200         WHEN OTHER                                               49910020
488300             DISPLAY PV-ABEND-PARAGRAPH                           49920020
488400             PERFORM Z9900-SQL-ERROR                              49930020
488500     END-EVALUATE.                                                49940020
488600                                                                  49950020
488700******************************************************************49960020
488800* Z9000-EOF-PROCESSING - CLOSES ALL FILES ASSOCIATED WITH THE JOB*49970020
488900******************************************************************49980020
489000 Z9000-EOF-PROCESSING.                                            49990020
489100                                                                  50000020
489200     CLOSE EXCEPTION-FILE                                         50010020
489300           BIM-FILE                                               50020020
489400           PRINT-REPORT.                                          50030020
489500                                                                  50040020
489600     IF  NOT SC-EXCEPT-STATUS-OK                                  50050020
489700         MOVE 'Z9000-EOF-PROCESSING' TO PV-PARAGRAPH-NAME         50060020
489800         MOVE 'BIM-FILE'            TO PV-ERROR-FILE              50070020
489900         MOVE 'CLOSING INPUT FILE'  TO PV-ERROR-OPERATION         50080020
490000         MOVE 'BAD-CLOSE'           TO PV-ERROR-STATUS            50090020
490100         MOVE  SC-BIM-STATUS        TO PV-VSAM-STATUS             50100020
490200         MOVE  '//////////////'     TO PV-NOT-FOUND-KEY           50110020
490300         PERFORM Z9999-VSAM-ERROR                                 50120020
490400         MOVE +4006                 TO PV-ABEND-CODE              50130020
490500         CALL 'ILBOABN0'            USING PV-ABEND-CODE           50140020
490600     END-IF.                                                      50150020
490700                                                                  50160020
490800     IF  NOT SC-BIM-STATUS-OK                                     50170020
490900         MOVE 'Z9000-EOF-PROCESSING' TO PV-PARAGRAPH-NAME         50180020
491000         MOVE 'EXCEPT-FILE'         TO PV-ERROR-FILE              50190020
491100         MOVE 'CLOSING INPUT FILE'  TO PV-ERROR-OPERATION         50200020
491200         MOVE 'BAD-CLOSE'           TO PV-ERROR-STATUS            50210020
491300         MOVE  SC-BIM-STATUS        TO PV-VSAM-STATUS             50220020
491400         MOVE  '//////////////'     TO PV-NOT-FOUND-KEY           50230020
491500         PERFORM Z9999-VSAM-ERROR                                 50240020
491600         MOVE +4006                 TO PV-ABEND-CODE              50250020
491700         CALL 'ILBOABN0'            USING PV-ABEND-CODE           50260020
491800     END-IF.                                                      50270020
491900                                                                  50280020
492000******************************************************************50290020
492100*     VSAM WARNING OR ERROR PROCESSING                           *50300020
492200******************************************************************50310020
492300 Z9900-SQL-ERROR.                                                 50320020
492400                                                                  50330020
492500     MOVE SQLCODE    TO SQLCODE2.                                 50340020
492600     MOVE SQLERRD(3) TO SQLERRD3.                                 50350020
492700     DISPLAY '** ABEND **       ** = SQLERROR'.                   50360020
492800     DISPLAY '** PROGRAM        ** = MRKRP117'.                   50370020
492900     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  50380020
493000     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  50390020
493100     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   50400020
493200     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  50410020
493300     MOVE +4013 TO PV-ABEND-CODE.                                 50420020
493400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         50430020
493500                                                                  50440020
493600******************************************************************50450020
493700*     VSAM WARNING OR ERROR PROCESSING                           *50460020
493800******************************************************************50470020
493900 Z9999-VSAM-ERROR.                                                50480020
494000                                                                  50490020
494100     DISPLAY '**   ABEND   **'.                                   50500020
494200     DISPLAY 'PROGRAM NAME = ' PC-PGRM-NAME.                      50510020
494300     DISPLAY PV-PARAGRAPH-NAME-MSG.                               50520020
494400     DISPLAY PV-ERROR-FILE-MSG.                                   50530020
494500     DISPLAY PV-ERROR-OPERATION-MSG.                              50540020
494600     DISPLAY PV-ERROR-STATUS-MSG.                                 50550020
494700     DISPLAY PV-NOT-FOUND-MSG                                     50560020
494800     DISPLAY 'VSAM STATUS = ' PV-VSAM-STATUS.                     50570020
494900     DISPLAY '***************'.                                   50580020
495000******************************************************************50590020
495100******************END OF PROGRAM   *******************************50600020
495200******************************************************************50610020
