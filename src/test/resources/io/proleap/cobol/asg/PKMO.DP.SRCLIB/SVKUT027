000100******************************************************************00010066
000200 IDENTIFICATION DIVISION.                                         00020066
000300******************************************************************00030066
000400                                                                  00040066
000500 PROGRAM-ID.             SVKUT027.                                00050066
000600 AUTHOR.                 DOUGLAS W ROUSAR.                        00060066
000700 INSTALLATION.           KOHLS.                                   00070066
000800 DATE-WRITTEN            JANUARY, 1998.                           00080066
000900 DATE-COMPILED.                                                   00090066
001000******************************************************************00100066
001100* THIS PROGRAM WAS COPIED FROM RDKUT012                           00110066
001200******************************************************************00120066
001300* HISTORY LOG:                                                   *00130066
001400* 02/01/99  WR6041 TKMA348                                       *00140066
001500*           CHANGED CODE TO MAKE CALENDAR ROUTINE CALLS COMPLIANT*00150066
001600*           TO KOHLS STANDARDS.                                  *00160066
001700* 02/11/00  WR5220 DAVID COLOMBO - COMPUWARE                     *00170066
001800*           CHANGED ACTVY-CSR SO IT WOULD NOT INCLUDE FEES       *00180066
001900*           (ACTIVITY TYPE CODE 4).                              *00190066
002000* 10/22/01                                                       *00200085
002100*    CHANGE MADE: ADDED 'WITH UR' TO TKMCTBL, TKMCACT CURSORS.   *00210085
002200*    MADE BY: GREG SHEFF - WR/IR #: 22765                        *00220085
002210* 06/08/09                                                       *00221085
002220*    CHANGE MADE: PROJECT 2317-GIFT CARD NUMBERING TO 30 DIGITS. *00222085
002230*                 RECOMPILE TO PICK UP CHANGES IN SVWS004.       *00223085
002240*    MADE BY: ROLF NOHE - WR/IR #: 29062                         *00224085
002300******************************************************************00230066
002400                                                                  00240066
002500******************************************************************00250066
002600 ENVIRONMENT DIVISION.                                            00260066
002700******************************************************************00270066
002800                                                                  00280066
002900 CONFIGURATION SECTION.                                           00290066
003000                                                                  00300066
003100 SOURCE-COMPUTER.        IBM-3090.                                00310066
003200 OBJECT-COMPUTER.        IBM-3090.                                00320066
003300                                                                  00330066
003400 INPUT-OUTPUT SECTION.                                            00340066
003500                                                                  00350066
003600 FILE-CONTROL.                                                    00360066
003700                                                                  00370066
003800     SELECT CONTROL-DATE-FILE         ASSIGN TO INP01.            00380066
003900     SELECT BALANCE-EXTRACT           ASSIGN TO OUT01.            00390066
004000                                                                  00400066
004100******************************************************************00410066
004200 DATA DIVISION.                                                   00420066
004300******************************************************************00430066
004400                                                                  00440066
004500 FILE SECTION.                                                    00450066
004600                                                                  00460066
004700 FD  CONTROL-DATE-FILE                                            00470066
004800     RECORDING MODE IS F                                          00480066
004900     BLOCK CONTAINS 0 RECORDS.                                    00490066
005000 01  CONTROL-DATE-RECORD              PIC X(80).                  00500066
005100                                                                  00510066
005200 FD  BALANCE-EXTRACT                                              00520066
005300     RECORDING MODE IS F                                          00530066
005400     LABEL RECORDS ARE STANDARD                                   00540066
005500     BLOCK CONTAINS 0 RECORDS                                     00550066
005600     RECORD CONTAINS 58 CHARACTERS                                00560066
005700     DATA RECORD IS LINE-OUT.                                     00570066
005800 01  LINE-OUT                       PIC X(58).                    00580066
005900                                                                  00590066
006000******************************************************************00600066
006100 WORKING-STORAGE SECTION.                                         00610066
006200******************************************************************00620066
006300*                                                                 00630066
006400* CR-CONTROL-RECORD                                               00640066
006500*                                                                 00650066
006600                                                                  00660066
006700 01  CR-CONTROL-RECORD.                                           00670066
006800     05  CR-CONTROL-BEG-DATE.                                     00680066
006900         10  CR-BEG-CC                PIC  X(02)    VALUE SPACES. 00690066
007000         10  CR-BEG-YY                PIC  X(02)    VALUE SPACES. 00700066
007100         10  FILLER                   PIC  X(01)    VALUE '-'.    00710066
007200         10  CR-BEG-MM                PIC  X(02)    VALUE SPACES. 00720066
007300         10  FILLER                   PIC  X(01)    VALUE '-'.    00730066
007400         10  CR-BEG-DD                PIC  X(02)    VALUE SPACES. 00740066
007500     05  CR-CONTROL-END-DATE.                                     00750066
007600         10  CR-END-CC                PIC  X(02)    VALUE SPACES. 00760066
007700         10  CR-END-YY                PIC  X(02)    VALUE SPACES. 00770066
007800         10  FILLER                   PIC  X(01)    VALUE '-'.    00780066
007900         10  CR-END-MM                PIC  X(02)    VALUE SPACES. 00790066
008000         10  FILLER                   PIC  X(01)    VALUE '-'.    00800066
008100         10  CR-END-DD                PIC  X(02)    VALUE SPACES. 00810066
008200     05  FILLER                       PIC  X(68)    VALUE SPACES. 00820066
008300                                                                  00830066
008400*                                                                 00840066
008500* PROGRAM SWITCHES                                                00850066
008600*                                                                 00860066
008700                                                                  00870066
008800 01  PROGRAM-SWITCHES.                                            00880066
008900     05  PS-END-OF-CONTROL-FILE-SW     PIC  X(01)     VALUE 'N'.  00890066
009000         88  PS-END-OF-CONTROL-FILE                   VALUE 'Y'.  00900066
009100     05  PS-END-OF-BALANCE-CSR-SW      PIC  X(01)     VALUE 'N'.  00910066
009200         88  PS-END-OF-BALANCE-CSR                    VALUE 'Y'.  00920066
009300     05  PS-END-OF-ACTVY-CSR-SW      PIC  X(01)     VALUE 'N'.    00930066
009400         88  PS-END-OF-ACTVY-CSR                    VALUE 'Y'.    00940066
009500     05  PS-END-OF-ISSUE-CSR-SW      PIC  X(01)     VALUE 'N'.    00950066
009600         88  PS-END-OF-ISSUE-CSR                    VALUE 'Y'.    00960066
009700                                                                  00970066
009800*                                                                 00980066
009900* PROGRAM VARIABLES                                               00990066
010000*                                                                 01000066
010100                                                                  01010066
010200 01  PROGRAM-VAIABLES.                                            01020066
010300     05  PV-SPACE-CONTROL             PIC 9(01)   VALUE 1.        01030066
010400     05  PV-CRD-STK-TYP-ID            PIC X(08)   VALUE SPACES.   01040066
010500     05  PV-CRD-NMBR                  PIC S9(12)V VALUE 0         01050066
010600                                                  COMP-3.         01060066
010700     05  PV-SUM                       PIC S9(09)V99 VALUE 0       01070066
010800                                                  COMP-3.         01080066
010900     05  PV-STR-NMBR                  PIC S9(04)  VALUE 0         01090066
011000                                                  COMP.           01100066
011100     05  PV-STORE                     PIC 9(04)   VALUE ZEROES.   01110066
011510     05  PV-DIST                      PIC S9(04)  COMP-3          01151074
011520                                                  VALUE ZERO.     01152070
011600     05  PV-TRN-AUTH-TMST             PIC X(26)   VALUE SPACES.   01160066
011700     05  FILLER REDEFINES PV-TRN-AUTH-TMST.                       01170066
011800         10  PV-TRN-AUTH-DATE.                                    01180066
011900             15 PV-TRN-AUTH-DATE-YYYY PIC X(04).                  01190066
012000             15 FILLER                PIC X(01).                  01200066
012100             15 PV-TRN-AUTH-DATE-MM   PIC X(02).                  01210066
012200             15 FILLER                PIC X(01).                  01220066
012300             15 PV-TRN-AUTH-DATE-DD   PIC X(02).                  01230066
012400         10  PV-TRN-AUTH-TIME         PIC X(16).                  01240066
012500     05  PV-AUTH-DATE-FRMTD.                                      01250066
012600         10 PV-AUTH-DATE-FRMTD-MM     PIC X(02).                  01260066
012700         10 FILLER                    PIC X(01) VALUE '-'.        01270066
012800         10 PV-AUTH-DATE-FRMTD-DD     PIC X(02).                  01280066
012900         10 FILLER                    PIC X(01) VALUE '-'.        01290066
013000         10 PV-AUTH-DATE-FRMTD-YYYY   PIC X(04).                  01300066
013100     05  PV-POS-TRMNL-NMBR            PIC S9(4)   VALUE 0         01310066
013200                                          COMP.                   01320066
013300     05  PV-POS-TRN-NMBR              PIC S9(4)   VALUE 0         01330066
013400                                          COMP.                   01340066
013500     05  PV-APVL-USR-ID               PIC X(08)   VALUE SPACES.   01350066
013600     05  PV-ACTVY-TYP-CDE             PIC S9(01)V VALUE 0         01360066
013700                                          COMP-3.                 01370066
013800     05  PV-ACTVY-TYP-CDE-B           PIC S9(01)V VALUE 0         01380066
013900                                          COMP-3.                 01390066
014000     05  PV-POS-OPRT-ID               PIC S9(11)V VALUE 0         01400066
014100                                          COMP-3.                 01410066
014200     05  PV-POS-OPRT                  PIC 9(11) VALUE 0.          01420066
014300     05  FILLER REDEFINES PV-POS-OPRT                             01430066
014400                                      PIC X(11).                  01440066
014500     05  PV-APP-AUTH-AMT              PIC S9(7)V9(2) VALUE 0      01450066
014600                                                   COMP-3.        01460066
014700     05  PV-PARAGRAPH-NAME            PIC  X(30)     VALUE SPACES.01470066
014800     05  PV-DB2-OPERATION-ATTEMPTED   PIC  X(30)     VALUE SPACES.01480066
014900     05  PV-CR-START-DATE-UNFMT.                                  01490066
015000         10  PV-CR-START-CC           PIC  9(02)     VALUE ZERO.  01500066
015100         10  PV-CR-START-YY           PIC  9(02)     VALUE ZERO.  01510066
015200         10  PV-CR-START-MM           PIC  9(02)     VALUE ZERO.  01520066
015300         10  PV-CR-START-DD           PIC  9(02)     VALUE ZERO.  01530066
015400     05  PV-CR-END-DATE-UNFMT.                                    01540066
015500         10  PV-CR-END-CC             PIC  9(02)     VALUE ZERO.  01550066
015600         10  PV-CR-END-YY             PIC  9(02)     VALUE ZERO.  01560066
015700         10  PV-CR-END-MM             PIC  9(02)     VALUE ZERO.  01570066
015800         10  PV-CR-END-DD             PIC  9(02)     VALUE ZERO.  01580066
015900     05  PV-FORMAT-OUTPUT-VARIABLES.                              01590066
016000         10  PV-FORMAT-BEG-DTE-MMDDCCYY.                          01600066
016100             15 PV-FORMAT-BEG-DTE-CC  PIC  X(02)    VALUE SPACES. 01610066
016200             15 PV-FORMAT-BEG-DTE-YY  PIC  X(02)    VALUE SPACES. 01620066
016300             15 FILLER                PIC  X(01)                  01630066
016400                VALUE '-'.                                        01640066
016500             15 PV-FORMAT-BEG-DTE-MM  PIC  X(02)    VALUE SPACES. 01650066
016600             15 FILLER                PIC  X(01)                  01660066
016700                VALUE '-'.                                        01670066
016800             15 PV-FORMAT-BEG-DTE-DD  PIC  X(02)    VALUE SPACES. 01680066
016900         10  PV-FORMAT-END-DTE-MMDDCCYY.                          01690066
017000             15 PV-FORMAT-END-DTE-CC  PIC  X(02)    VALUE SPACES. 01700066
017100             15 PV-FORMAT-END-DTE-YY  PIC  X(02)    VALUE SPACES. 01710066
017200             15 FILLER                PIC  X(01)                  01720066
017300                VALUE '-'.                                        01730066
017400             15 PV-FORMAT-END-DTE-MM  PIC  X(02)    VALUE SPACES. 01740066
017500             15 FILLER                PIC  X(01)                  01750066
017600                VALUE '-'.                                        01760066
017700             15 PV-FORMAT-END-DTE-DD  PIC  X(02)    VALUE SPACES. 01770066
017800         10  PV-FORMAT-CARD-TYPE      PIC  X(25)    VALUE SPACES. 01780066
017900     05  PV-START-TMSTP.                                          01790066
018000         10  PV-START-DATE            PIC  X(10).                 01800066
018100         10  PV-START-TIME            PIC  X(16).                 01810066
018200     05  PV-END-TMSTP.                                            01820066
018300         10  PV-END-DATE            PIC  X(10).                   01830066
018400         10  PV-END-TIME            PIC  X(16).                   01840066
018500     05  PV-START-RANGE-TMSTP-DET.                                01850066
018600         10  PV-START-RANGE-CC        PIC  X(02).                 01860066
018700         10  PV-START-RANGE-YY        PIC  X(02).                 01870066
018800         10  FILLER                   PIC  X(01)     VALUE '-'.   01880066
018900         10  PV-START-RANGE-MM        PIC  X(02).                 01890066
019000         10  FILLER                   PIC  X(01)     VALUE '-'.   01900066
019100         10  PV-START-RANGE-DD        PIC  X(02).                 01910066
019200         10  FILLER                   PIC  X(01)     VALUE '-'.   01920066
019300         10  PV-START-RANGE-HH        PIC  X(02)     VALUE '00'.  01930066
019400         10  FILLER                   PIC  X(01)     VALUE '.'.   01940066
019500         10  PV-START-RANGE-MN        PIC  X(02)     VALUE '00'.  01950066
019600         10  FILLER                   PIC  X(01)     VALUE '.'.   01960066
019700         10  PV-START-RANGE-SS        PIC  X(02)     VALUE '00'.  01970066
019800         10  FILLER                   PIC  X(01)     VALUE '.'.   01980066
019900         10  PV-START-RANGE-TTTTTT    PIC  X(06)     VALUE        01990066
020000                                                      '000000'.   02000066
020100     05  PV-START-RANGE-TMSTP REDEFINES                           02010066
020200           PV-START-RANGE-TMSTP-DET                               02020066
020300                                      PIC  X(26).                 02030066
020400     05  PV-END-RANGE-TMSTP-DET.                                  02040066
020500         10  PV-END-RANGE-CC          PIC  X(02).                 02050066
020600         10  PV-END-RANGE-YY          PIC  X(02).                 02060066
020700         10  FILLER                   PIC  X(01)     VALUE '-'.   02070066
020800         10  PV-END-RANGE-MM          PIC  X(02).                 02080066
020900         10  FILLER                   PIC  X(01)     VALUE '-'.   02090066
021000         10  PV-END-RANGE-DD          PIC  X(02).                 02100066
021100         10  FILLER                   PIC  X(01)     VALUE '-'.   02110066
021200         10  PV-END-RANGE-HH          PIC  X(02)     VALUE '23'.  02120066
021300         10  FILLER                   PIC  X(01)     VALUE '.'.   02130066
021400         10  PV-END-RANGE-MN          PIC  X(02)     VALUE '59'.  02140066
021500         10  FILLER                   PIC  X(01)     VALUE '.'.   02150066
021600         10  PV-END-RANGE-SS          PIC  X(02)     VALUE '59'.  02160066
021700         10  FILLER                   PIC  X(01)     VALUE '.'.   02170066
021800         10  PV-END-RANGE-TTTTTT      PIC  X(06)     VALUE        02180066
021900                                                     '999999'.    02190066
022000     05  PV-END-RANGE-TMSTP REDEFINES                             02200066
022100           PV-END-RANGE-TMSTP-DET                                 02210066
022200                                      PIC  X(26).                 02220066
022210     05  PV-CRD-CLO-DTE               PIC  X(10)    VALUE SPACE.  02221078
022300*                                                                 02230066
022400* PROGRAM CONSTANTS                                               02240066
022500*                                                                 02250066
022600                                                                  02260066
022700 01  PROGRAM-CONSTANTS.                                           02270066
022800     05  PC-PROGRAM-NAME                 PIC X(08)  VALUE         02280066
022900                                               'SVKUT027'.        02290066
023000     05  PC-N                            PIC X(01)  VALUE 'N'.    02300066
023030     05  PC-UNKNOWN-DIST                 PIC S9(04)  COMP-3       02303084
023040                                                    VALUE 0.      02304084
023100                                                                  02310066
023200*                                                                 02320066
023300* ABEND CODES                                                     02330066
023400*                                                                 02340066
023500                                                                  02350066
023600 01  ABEND-CODE                          PIC S9(04) VALUE +0.     02360066
023700     88  ABEND-4001-WRITE-ERROR                     VALUE +4001.  02370066
023800     88  ABEND-4002-READ-ERROR                      VALUE +4002.  02380066
023900     88  ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.  02390066
024000     88  ABEND-4004-TABLE-ERROR                     VALUE +4004.  02400066
024100     88  ABEND-4005-OPEN-ERROR                      VALUE +4005.  02410066
024200     88  ABEND-4006-CLOSE-ERROR                     VALUE +4006.  02420066
024300     88  ABEND-4007-SEQUENCE-ERROR                  VALUE +4007.  02430066
024400     88  ABEND-4008-DATA-ERROR                      VALUE +4008.  02440066
024500     88  ABEND-4009-KEY-DATA-ERROR                  VALUE +4009.  02450066
024600     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  02460066
024700     88  ABEND-4019-CALENDER-ERROR                  VALUE +4019.  02470066
024800                                                                  02480066
024900*                                                                 02490066
025000* WORKING STORAGE MEMBER USED TO CREATE FILE                      02500066
025100*                                                                 02510066
025200                                                                  02520066
025300     COPY SVRD017.                                                02530066
025400                                                                  02540066
025500*                                                                 02550066
025600* COPYBOOK USED FOR GITCARD AND KMRC CONSTANTS                    02560066
025700*                                                                 02570066
025800                                                                  02580066
025900     COPY SVWS004.                                                02590066
026000                                                                  02600066
026100*                                                                 02610066
026200* DATE ROUTINE COPY MEMBERS                                       02620066
026300*                                                                 02630066
026400     COPY DPWS500.                                                02640066
026500                                                                  02650066
026600*                                                                 02660066
026700* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         02670066
026800*                                                                 02680066
026900     COPY DPWS004.                                                02690066
027000                                                                  02700066
027731*                                                                 02773167
027732* DOMAIN LOCATION DISTRICT TABLE                                  02773267
027733*                                                                 02773367
027740     EXEC SQL                                                     02774067
027750         INCLUDE XST00002                                         02775067
027760     END-EXEC.                                                    02776067
027800                                                                  02780066
027900******************************************************************02790066
028000*    DB2 AREA FOR SVT_KOHLS_CRD_ACCT                             *02800066
028100*    SV-KOHL'S MERCHANDISE CARD TABLE                            *02810066
028200******************************************************************02820066
028300     EXEC SQL                                                     02830066
028400         INCLUDE SVT00001                                         02840066
028500     END-EXEC.                                                    02850066
028600                                                                  02860066
028700******************************************************************02870066
028800*    DB2 AREA FOR SVT_KOHLS_CRD_TXN                              *02880066
028900*    SV-KOHL'S MERCHANDISE CARD ACTIVITY TABLE                   *02890066
029000******************************************************************02900066
029100     EXEC SQL                                                     02910066
029200         INCLUDE SVT00002                                         02920066
029300     END-EXEC.                                                    02930066
029400                                                                  02940066
029500******************************************************************02950066
029600*    DB2 AREA FOR SVT_CRD_PROD                                   *02960066
029700*    SV-KOHL'S CONTROL NUMBER INFORMATION TABLE                  *02970066
029800******************************************************************02980066
029900     EXEC SQL                                                     02990066
030000         INCLUDE SVT00000                                         03000066
030100     END-EXEC.                                                    03010066
030200                                                                  03020066
030300*                                                                 03030066
030400*  COMMUNICATION AREAS FOR DB2                                    03040066
030500*                                                                 03050066
030600     EXEC SQL                                                     03060066
030700         INCLUDE SQLCA                                            03070066
030800     END-EXEC.                                                    03080066
030900                                                                  03090066
031000*                                                                 03100066
031100* BALANCE CURSOR                                                  03110066
031200*                                                                 03120066
031300                                                                  03130066
031400     EXEC SQL                                                     03140066
031500        DECLARE BALANCE-CSR CURSOR FOR                            03150066
031600           SELECT CRD_STK_TYP_ID,                                 03160081
031601                  A.CRD_NBR,                                      03160181
031602                  CRD_CLO_DTE,                                    03160281
031603                  SUM(APP_AUTH_AMT)                               03160381
031700             FROM SVT_KOHLS_CRD_ACCT T                            03170066
031800                 ,SVT_KOHLS_CRD_TXN A                             03180066
031900                 ,SVT_CRD_PROD C                                  03190066
032000           WHERE T.CRD_NBR = A.CRD_NBR                            03200066
032100              AND   C.CRD_PROD_YR = T.CRD_PROD_YR                 03210066
032200              AND   C.SHIPT_REQ_NBR = T.SHIPT_REQ_NBR             03220066
032300              AND   (CRD_CLO_DTE BETWEEN :PV-START-DATE AND       03230066
032400                                         :PV-END-DATE)            03240066
032500              AND   CRD_STAT_CDE = :SV004-CRD-STAT-TYP-CORP       03250066
032600           GROUP BY CRD_STK_TYP_ID, A.CRD_NBR, CRD_CLO_DTE        03260082
032700           HAVING (SUM(APP_AUTH_AMT) > 0 OR                       03270066
032800                  SUM(APP_AUTH_AMT) < 0)                          03280066
032900           WITH UR                                                03290066
033000     END-EXEC.                                                    03300066
033100                                                                  03310066
033200*                                                                 03320066
033300* ISSUE CURSOR                                                    03330066
033400*                                                                 03340066
033500                                                                  03350066
033600     EXEC SQL                                                     03360066
033700        DECLARE ISSUE-CSR CURSOR FOR                              03370066
033800           SELECT ACTVY_TYP_CDE                                   03380066
033900                 ,APP_AUTH_AMT                                    03390066
034000           FROM SVT_KOHLS_CRD_TXN                                 03400066
034100           WHERE ((CRD_NBR = :PV-CRD-NMBR) AND                    03410066
034200                 (TRN_RVRSL_CDE = :SV004-REV-CDE-NORMAL) AND      03420066
034300             ((ACTVY_TYP_CDE = :SV004-ISSUE-KMRC-ACT-TYP-N) OR    03430066
034400              (ACTVY_TYP_CDE = :SV004-ISSUE-GIFT-CRD-ACT-TYP-N))) 03440066
034410          ORDER BY TRN_AUTH_TMST  DESC                            03441067
034500           WITH UR                                                03450066
034600     END-EXEC.                                                    03460066
034700                                                                  03470066
034800*                                                                 03480066
034900* ACTVY CURSOR                                                    03490066
035000*                                                                 03500066
035100                                                                  03510066
035200     EXEC SQL                                                     03520066
035300        DECLARE ACTVY-CSR CURSOR FOR                              03530066
035400           SELECT STR_NBR                                         03540066
035500                 ,ACTVY_TYP_CDE                                   03550066
035600                 ,TRN_AUTH_TMST                                   03560066
035700                 ,POS_TRMNL_NBR                                   03570066
035800                 ,POS_TRN_NBR                                     03580066
035900                 ,APVL_USR_ID                                     03590066
036000                 ,POS_OPRT_ID                                     03600066
036100                 ,APP_AUTH_AMT                                    03610066
036200           FROM SVT_KOHLS_CRD_TXN                                 03620066
036300           WHERE CRD_NBR = :PV-CRD-NMBR                           03630066
036400             AND ACTVY_TYP_CDE <> :SV004-SRV-FEE-ACT-TYP-N        03640066
036500             AND TRN_VOID_IND = :PC-N                             03650066
036600           ORDER BY ACTVY_TYP_CDE DESC, TRN_AUTH_TMST DESC        03660066
036700           WITH UR                                                03670066
036800     END-EXEC.                                                    03680066
036900                                                                  03690066
037000*                                                                 03700066
037100*  DB2 COMMUNICATION AREA 2                                       03710066
037200*                                                                 03720066
037300     COPY SQLCA2.                                                 03730066
037400                                                                  03740066
037500******************************************************************03750066
037600 PROCEDURE DIVISION.                                              03760066
037700******************************************************************03770066
037800                                                                  03780066
037900* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03790066
038000*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM    03800066
038100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03810066
038200                                                                  03820066
038300 0000-PROGRAM-MAINLINE.                                           03830066
038400*---------------------                                            03840066
038500                                                                  03850066
038600     PERFORM 1000-INITIALIZE.                                     03860066
038700     PERFORM 2000-OPEN-BALANCE-CSR.                               03870066
038800     PERFORM 3000-CREATE-FILE UNTIL PS-END-OF-BALANCE-CSR.        03880066
038900     EXEC SQL                                                     03890066
039000        CLOSE BALANCE-CSR                                         03900066
039100     END-EXEC.                                                    03910066
039200     PERFORM 9000-EOJ-ROUTINE.                                    03920066
039300     STOP RUN.                                                    03930066
039400                                                                  03940066
039500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03950066
039600*  1000-INITIALIZE OPENS ALL THE FILES ASSOCIATED WITH THE JOB.   03960066
039700*  ACCEPTS THE SYSTEM DATE AND TIME, FILLING THE APPROPRIATE RE-  03970066
039800*  PORT HEADERS. ACCEPTS CONTROL CARD FOR ACTIVITY DATE.          03980066
039900* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 03990066
040000                                                                  04000066
040100 1000-INITIALIZE.                                                 04010066
040200*---------------                                                  04020066
040300                                                                  04030066
040400     OPEN INPUT CONTROL-DATE-FILE.                                04040066
040500     OPEN OUTPUT BALANCE-EXTRACT.                                 04050066
040600                                                                  04060066
040700     READ CONTROL-DATE-FILE INTO CR-CONTROL-RECORD                04070066
040800       AT END                                                     04080066
040900         SET PS-END-OF-CONTROL-FILE TO TRUE.                      04090066
041000                                                                  04100066
041100     IF PS-END-OF-CONTROL-FILE                                    04110066
041200       DISPLAY ' '                                                04120066
041300       DISPLAY '** ABEND     **'                                  04130066
041400       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              04140066
041500       DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE      '         04150066
041600       DISPLAY '** CONTROL DATE FILE IS EMPTY  '                  04160066
041700       SET  ABEND-4002-READ-ERROR TO TRUE                         04170066
041800       CALL 'ILBOABN0' USING ABEND-CODE                           04180066
041900     ELSE                                                         04190066
042000       MOVE CR-BEG-CC TO PV-FORMAT-BEG-DTE-CC                     04200066
042100                         PV-CR-START-CC                           04210066
042200                         PV-START-RANGE-CC                        04220066
042300       MOVE CR-BEG-YY TO PV-FORMAT-BEG-DTE-YY                     04230066
042400                         PV-CR-START-YY                           04240066
042500                         PV-START-RANGE-YY                        04250066
042600       MOVE CR-BEG-MM TO PV-FORMAT-BEG-DTE-MM                     04260066
042700                         PV-CR-START-MM                           04270066
042800                         PV-START-RANGE-MM                        04280066
042900       MOVE CR-BEG-DD TO PV-FORMAT-BEG-DTE-DD                     04290066
043000                         PV-CR-START-DD                           04300066
043100                         PV-START-RANGE-DD                        04310066
043200       MOVE CR-END-CC TO PV-FORMAT-END-DTE-CC                     04320066
043300                         PV-CR-END-CC                             04330066
043400                         PV-END-RANGE-CC                          04340066
043500       MOVE CR-END-YY TO PV-FORMAT-END-DTE-YY                     04350066
043600                         PV-CR-END-YY                             04360066
043700                         PV-END-RANGE-YY                          04370066
043800       MOVE CR-END-MM TO PV-FORMAT-END-DTE-MM                     04380066
043900                         PV-CR-END-MM                             04390066
044000                         PV-END-RANGE-MM                          04400066
044100       MOVE CR-END-DD TO PV-FORMAT-END-DTE-DD                     04410066
044200                         PV-CR-END-DD                             04420066
044300                         PV-END-RANGE-DD                          04430066
044400       DISPLAY ' '                                                04440066
044500       DISPLAY PC-PROGRAM-NAME ' CONTROL DATE:  '                 04450066
044600               PV-FORMAT-BEG-DTE-MMDDCCYY ' TO '                  04460066
044700               PV-FORMAT-END-DTE-MMDDCCYY                         04470066
044800     END-IF.                                                      04480066
044900                                                                  04490066
045000** VERIFY THE BEGINNING DATE IS LESS THAN THE ENDING DATE **      04500066
045100     IF PV-CR-END-DATE-UNFMT < PV-CR-START-DATE-UNFMT             04510066
045200       DISPLAY ' '                                                04520066
045300       DISPLAY '** ABEND     **'                                  04530066
045400       DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME              04540066
045500       DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'               04550066
045600       DISPLAY '** THE BEGINNING DATE CAN NOT BE '                04560066
045700               'GREATER THAN THE ENDING DATE **'                  04570066
045800       SET ABEND-4002-READ-ERROR TO TRUE                          04580066
045900       CALL 'ILBOABN0' USING ABEND-CODE                           04590066
046000     END-IF.                                                      04600066
046100                                                                  04610066
046200** VERIFY THE BEGINNING AND ENDING CONTROL DATES ARE VALID **     04620066
046300     INITIALIZE DPG51 DPG52 DPG53                                 04630066
046400                DPG54 DPG55 DPG56.                                04640066
046500                                                                  04650066
046600     SET DPG51-ACTUAL-CALENDAR-ONLY                               04660066
046700                                 TO TRUE.                         04670066
046800     SET DPG51-DO-NOT-INCR-DECR-DATE                              04680066
046900                                 TO TRUE.                         04690066
047000     MOVE ZEROES TO DPG51-INCR-DECR-DAYS-9                        04700066
047100                    DPG51-INCR-DECR-BUS-DAYS-9.                   04710066
047200     MOVE CR-CONTROL-BEG-DATE    TO DPG52-LK-DATE-INPUT.          04720066
047300     SET DPG52-LK-DTE-ISO-FMT    TO TRUE                          04730066
047400                                                                  04740066
047500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04750066
047600                                             DPG54 DPG55 DPG56.   04760066
047700     EVALUATE TRUE                                                04770066
047800       WHEN DPG54-SEVERE-ERROR                                    04780066
047900       WHEN DPG54-DATE-INVALID                                    04790066
048000         DISPLAY ' '                                              04800066
048100         DISPLAY '** ABEND     **'                                04810066
048200         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            04820066
048300         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             04830066
048400         DISPLAY '** BAD CALL TO CALENDAR MODULE '                04840066
048500         DISPLAY '** DETERMINE VALID BEGINNING DATE **'           04850066
048600         DISPLAY DPG54-ERROR-MESSAGE                              04860066
048700         SET ABEND-4019-CALENDER-ERROR TO TRUE                    04870066
048800         CALL 'ILBOABN0' USING ABEND-CODE                         04880066
048900     END-EVALUATE.                                                04890066
049000                                                                  04900066
049100     INITIALIZE DPG51 DPG52 DPG53                                 04910066
049200                DPG54 DPG55 DPG56.                                04920066
049300     SET DPG51-ACTUAL-CALENDAR-ONLY                               04930066
049400                                 TO TRUE.                         04940066
049500     SET DPG51-DO-NOT-INCR-DECR-DATE                              04950066
049600                                 TO TRUE.                         04960066
049700     MOVE ZEROES TO DPG51-INCR-DECR-DAYS-9                        04970066
049800                    DPG51-INCR-DECR-BUS-DAYS-9.                   04980066
049900     MOVE CR-CONTROL-END-DATE    TO DPG52-LK-DATE-INPUT.          04990079
050000     SET DPG52-LK-DTE-ISO-FMT    TO TRUE                          05000066
050100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05010066
050200                                             DPG54 DPG55 DPG56.   05020066
050300     EVALUATE TRUE                                                05030066
050400       WHEN DPG54-SEVERE-ERROR                                    05040066
050500       WHEN DPG54-DATE-INVALID                                    05050066
050600         DISPLAY ' '                                              05060066
050700         DISPLAY '** ABEND     **'                                05070066
050800         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05080066
050900         DISPLAY '** PARAGRAPH **  = 1000-INITIALIZE'             05090066
051000         DISPLAY '** BAD CALL TO CALENDAR MODULE '                05100066
051100         DISPLAY '** DETERMINE VALID ENDING DATE **'              05110066
051200         DISPLAY DPG54-ERROR-MESSAGE                              05120066
051300         SET ABEND-4019-CALENDER-ERROR TO TRUE                    05130066
051400         CALL 'ILBOABN0' USING ABEND-CODE                         05140066
051500     END-EVALUATE.                                                05150066
051600                                                                  05160066
051700     MOVE PV-START-RANGE-TMSTP TO PV-START-TMSTP.                 05170066
051800     MOVE PV-END-RANGE-TMSTP TO PV-END-TMSTP.                     05180066
051900                                                                  05190066
052000* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05200066
052100*  2000-OPEN-BALANCE-CSR                                          05210066
052200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05220066
052300                                                                  05230066
052400 2000-OPEN-BALANCE-CSR.                                           05240066
052500*---------------------                                            05250066
052600                                                                  05260066
052700     EXEC SQL                                                     05270066
052800       OPEN BALANCE-CSR                                           05280066
052900     END-EXEC.                                                    05290066
053000                                                                  05300066
053100     EVALUATE TRUE                                                05310066
053200       WHEN SQLCODE NOT = 0                                       05320066
053300       WHEN SQLWARN0    = 'W'                                     05330066
053400         DISPLAY ' '                                              05340066
053500         DISPLAY '** ABEND     **'                                05350066
053600         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            05360066
053700         DISPLAY '** PARAGRAPH **  = 2000-OPEN-BALANCE-CSR'       05370066
053800         PERFORM 9100-SQL-ABEND                                   05380066
053900     END-EVALUATE.                                                05390066
054000                                                                  05400066
054100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05410066
054200*  3000-CREATE-FILE                                               05420066
054300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05430066
054400                                                                  05440066
054500 3000-CREATE-FILE.                                                05450066
054600*----------------                                                 05460066
054700                                                                  05470066
054800     EXEC SQL                                                     05480066
054900        FETCH BALANCE-CSR                                         05490066
055000          INTO :PV-CRD-STK-TYP-ID,                                05500066
055100               :PV-CRD-NMBR,                                      05510066
055110               :PV-CRD-CLO-DTE,                                   05511081
055200               :PV-SUM                                            05520081
055300     END-EXEC.                                                    05530066
055400                                                                  05540066
055500     EVALUATE SQLCODE                                             05550066
055600       WHEN +100                                                  05560066
055700         MOVE 'Y' TO PS-END-OF-BALANCE-CSR-SW                     05570066
055800       WHEN 0                                                     05580066
055900         PERFORM 3100-GET-ACTVY                                   05590066
056000         PERFORM 3050-FILL-DETAIL                                 05600066
056100       WHEN OTHER                                                 05610066
056200         MOVE '3000-CREATE-FILE     ' TO                          05620066
056300          PV-PARAGRAPH-NAME                                       05630066
056400         MOVE 'FETCH BALANCE CURSOR   ' TO                        05640066
056500          PV-DB2-OPERATION-ATTEMPTED                              05650066
056600         PERFORM 9100-SQL-ABEND                                   05660066
056700     END-EVALUATE.                                                05670066
056800                                                                  05680066
056900* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05690066
057000*  3050-FILL-DETAIL                                               05700066
057100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 05710066
057200                                                                  05720066
057300 3050-FILL-DETAIL.                                                05730066
057400*----------------                                                 05740066
057500                                                                  05750066
057600     IF  PV-ACTVY-TYP-CDE = SV004-TENDER-ACT-TYP                  05760066
057700     AND PV-SUM > 0                                               05770066
057800        MOVE '1' TO SV017-REPORT-IND                              05780066
057900        PERFORM 3200-OPEN-ISSUE-CSR                               05790066
058000        PERFORM 3300-FETCH-ISSUE-CSR                              05800066
058100        PERFORM 3400-CLOSE-ISSUE-CSR                              05810066
058200     ELSE                                                         05820066
058300        IF  PV-ACTVY-TYP-CDE = SV004-TENDER-ACT-TYP               05830066
058400        AND PV-SUM < 0                                            05840066
058500           MOVE '3' TO SV017-REPORT-IND                           05850066
058600           PERFORM 3200-OPEN-ISSUE-CSR                            05860066
058700           PERFORM 3300-FETCH-ISSUE-CSR                           05870066
058800           PERFORM 3400-CLOSE-ISSUE-CSR                           05880066
058900        ELSE                                                      05890066
059000           IF  PV-ACTVY-TYP-CDE = SV004-ISSUE-KMRC-ACT-TYP        05900066
059100           OR  PV-ACTVY-TYP-CDE = SV004-ISSUE-GIFT-CRD-ACT-TYP    05910066
059200              MOVE '2' TO SV017-REPORT-IND                        05920066
059300           END-IF                                                 05930066
059400        END-IF                                                    05940066
059500     END-IF.                                                      05950066
059600                                                                  05960066
059700     IF PV-APVL-USR-ID > SPACES                                   05970066
059800        MOVE PV-APVL-USR-ID   TO  SV017-USR-OR-OPRT-ID            05980066
059900     ELSE                                                         05990066
060000        MOVE PV-POS-OPRT-ID   TO  PV-POS-OPRT                     06000066
060100        MOVE PV-POS-OPRT-ID   TO  SV017-USR-OR-OPRT-ID            06010066
060200     END-IF.                                                      06020066
060300                                                                  06030066
060400     MOVE PV-TRN-AUTH-DATE-YYYY  TO PV-AUTH-DATE-FRMTD-YYYY.      06040066
060500     MOVE PV-TRN-AUTH-DATE-MM    TO PV-AUTH-DATE-FRMTD-MM.        06050066
060600     MOVE PV-TRN-AUTH-DATE-DD    TO PV-AUTH-DATE-FRMTD-DD.        06060066
060700     MOVE PV-AUTH-DATE-FRMTD     TO SV017-TRN-AUTH-DATE.          06070066
060800                                                                  06080066
060900     MOVE PV-CRD-STK-TYP-ID  TO  SV017-CRD-STK-TYP-ID.            06090066
061020     MOVE PV-DIST            TO  SV017-DISTRICT-NMBR.             06102073
061100     MOVE PV-STR-NMBR        TO  PV-STORE.                        06110066
061200     MOVE PV-STORE           TO  SV017-STR-NMBR.                  06120066
061300     MOVE PV-POS-TRMNL-NMBR  TO  SV017-POS-TRMNL-NMBR.            06130066
061400     MOVE PV-POS-TRN-NMBR    TO  SV017-POS-TRN-NMBR.              06140066
061500     MOVE PV-CRD-NMBR        TO  SV017-CARD-NMBR.                 06150066
061600     MOVE PV-SUM             TO  SV017-BALANCE.                   06160066
061700     MOVE PV-APP-AUTH-AMT    TO  SV017-APP-AUTH-AMT.              06170066
061800                                                                  06180066
061900     WRITE LINE-OUT FROM SV017-KMC-GFTCRD-BALANCE.                06190066
062000                                                                  06200066
062100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06210066
062200*  3100-GET-ACTVY                                                 06220066
062300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 06230066
062400                                                                  06240066
062500 3100-GET-ACTVY.                                                  06250066
062600*--------------                                                   06260066
062700                                                                  06270066
062800     EXEC SQL                                                     06280066
062900        OPEN ACTVY-CSR                                            06290066
063000     END-EXEC.                                                    06300066
063100                                                                  06310066
063200     EVALUATE TRUE                                                06320066
063300       WHEN SQLCODE NOT = 0                                       06330066
063400       WHEN SQLWARN0    = 'W'                                     06340066
063500         DISPLAY ' '                                              06350066
063600         DISPLAY '** ABEND     **'                                06360066
063700         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            06370066
063800         DISPLAY '** PARAGRAPH **  = 3100-GET-ACTVY'              06380066
063900         DISPLAY '** ERROR OPENING ACTVY-CSR'                     06390066
064000         PERFORM 9100-SQL-ABEND                                   06400066
064100     END-EVALUATE.                                                06410066
064200                                                                  06420066
064300     EXEC SQL                                                     06430066
064400        FETCH ACTVY-CSR                                           06440066
064500        INTO  :PV-STR-NMBR,                                       06450066
064600              :PV-ACTVY-TYP-CDE,                                  06460066
064700              :PV-TRN-AUTH-TMST,                                  06470066
064800              :PV-POS-TRMNL-NMBR,                                 06480066
064900              :PV-POS-TRN-NMBR,                                   06490066
065000              :PV-APVL-USR-ID,                                    06500066
065100              :PV-POS-OPRT-ID,                                    06510066
065200              :PV-APP-AUTH-AMT                                    06520066
065300     END-EXEC.                                                    06530066
065400                                                                  06540066
065500     EVALUATE SQLCODE                                             06550066
065600       WHEN +100                                                  06560066
065700         MOVE 'Y' TO PS-END-OF-ACTVY-CSR-SW                       06570066
065800       WHEN 0                                                     06580066
065900         MOVE PV-STR-NMBR TO PV-STORE                             06590066
066000       WHEN OTHER                                                 06600066
066100         MOVE '3100-GET-ACTVY     ' TO                            06610066
066200          PV-PARAGRAPH-NAME                                       06620066
066300         MOVE 'FETCH ACTVY CURSOR   ' TO                          06630066
066400          PV-DB2-OPERATION-ATTEMPTED                              06640066
066500         PERFORM 9100-SQL-ABEND                                   06650066
066600     END-EVALUATE.                                                06660066
066700                                                                  06670066
067410     EXEC SQL                                                     06741067
067420        SELECT DIST_NBR                                           06742067
067430        INTO :PV-DIST                                             06743071
067440        FROM XST_LOC_DIST                                         06744067
067441        WHERE LOC_NBR = :PV-STR-NMBR                              06744168
067442          AND  ((:PV-CRD-CLO-DTE BETWEEN BEG_DTE AND END_DTE)     06744280
067445           OR  ((:PV-CRD-CLO-DTE >= BEG_DTE)                      06744583
067446          AND  (END_DTE IS NULL)))                                06744680
067460     END-EXEC.                                                    06746067
067470                                                                  06747067
067500     EVALUATE SQLCODE                                             06750066
067600       WHEN 0                                                     06760066
067700         CONTINUE                                                 06770066
067710       WHEN +100                                                  06771084
067720         MOVE PC-UNKNOWN-DIST TO PV-DIST                          06772084
067800       WHEN OTHER                                                 06780066
067900         MOVE '3100-GET-ACTVY     ' TO                            06790066
068000          PV-PARAGRAPH-NAME                                       06800066
068100         MOVE 'SELECT DISTRICT NMBR ' TO                          06810066
068200          PV-DB2-OPERATION-ATTEMPTED                              06820066
068300         PERFORM 9100-SQL-ABEND                                   06830066
068400     END-EVALUATE.                                                06840066
068500                                                                  06850066
068600     EXEC SQL                                                     06860066
068700         CLOSE ACTVY-CSR                                          06870066
068800     END-EXEC.                                                    06880066
068900                                                                  06890066
069000     EVALUATE TRUE                                                06900066
069100       WHEN SQLCODE NOT = 0                                       06910066
069200       WHEN SQLWARN0    = 'W'                                     06920066
069300         DISPLAY ' '                                              06930066
069400         DISPLAY '** ABEND     **'                                06940066
069500         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            06950066
069600         DISPLAY '** PARAGRAPH **  = 3100-GET-ACTVY'              06960066
069700         DISPLAY '** ERROR CLOSING ACTVY-CSR'                     06970066
069800         PERFORM 9100-SQL-ABEND                                   06980066
069900     END-EVALUATE.                                                06990066
070000                                                                  07000066
070100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07010066
070200*  3200-OPEN-ISSUE-CSR                                            07020066
070300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07030066
070400                                                                  07040066
070500 3200-OPEN-ISSUE-CSR.                                             07050066
070600*-------------------                                              07060066
070700                                                                  07070066
070800     EXEC SQL                                                     07080066
070900        OPEN ISSUE-CSR                                            07090066
071000     END-EXEC.                                                    07100066
071100                                                                  07110066
071200     EVALUATE TRUE                                                07120066
071300       WHEN SQLCODE NOT = 0                                       07130066
071400       WHEN SQLWARN0    = 'W'                                     07140066
071500         DISPLAY ' '                                              07150066
071600         DISPLAY '** ABEND     **'                                07160066
071700         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            07170066
071800         DISPLAY '** PARAGRAPH **  = 3200-OPEN-ISSUE-CSR'         07180066
071900         DISPLAY '** ERROR OPENING ACTVY-CSR'                     07190066
072000         PERFORM 9100-SQL-ABEND                                   07200066
072100     END-EVALUATE.                                                07210066
072200                                                                  07220066
072300     MOVE 'N' TO PS-END-OF-ISSUE-CSR-SW.                          07230066
072400                                                                  07240066
072500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07250066
072600*  3300-FETCH-ISSUE-CSR                                           07260066
072700* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07270066
072800                                                                  07280066
072900 3300-FETCH-ISSUE-CSR.                                            07290066
073000*--------------------                                             07300066
073100                                                                  07310066
073200     EXEC SQL                                                     07320066
073300        FETCH ISSUE-CSR                                           07330066
073400        INTO  :PV-ACTVY-TYP-CDE-B,                                07340066
073500              :PV-APP-AUTH-AMT                                    07350066
073600     END-EXEC.                                                    07360066
073700                                                                  07370066
073800     EVALUATE SQLCODE                                             07380066
073900       WHEN +100                                                  07390066
074000         MOVE 'Y' TO PS-END-OF-ISSUE-CSR-SW                       07400066
074100       WHEN 0                                                     07410066
074200         MOVE PV-STR-NMBR TO PV-STORE                             07420066
074300       WHEN OTHER                                                 07430066
074400         MOVE '3300-FETCH-ISSUE-CSR' TO                           07440066
074500          PV-PARAGRAPH-NAME                                       07450066
074600         MOVE 'FETCH ISSUE CURSOR   ' TO                          07460066
074700          PV-DB2-OPERATION-ATTEMPTED                              07470066
074800         PERFORM 9100-SQL-ABEND                                   07480066
074900     END-EVALUATE.                                                07490066
075000                                                                  07500066
075100* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07510066
075200*  3400-CLOSE-ISSUE-CSR                                           07520066
075300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07530066
075400                                                                  07540066
075500 3400-CLOSE-ISSUE-CSR.                                            07550066
075600*--------------------                                             07560066
075700                                                                  07570066
075800     EXEC SQL                                                     07580066
075900         CLOSE ISSUE-CSR                                          07590066
076000     END-EXEC.                                                    07600066
076100                                                                  07610066
076200     EVALUATE TRUE                                                07620066
076300       WHEN SQLCODE NOT = 0                                       07630066
076400       WHEN SQLWARN0    = 'W'                                     07640066
076500         DISPLAY ' '                                              07650066
076600         DISPLAY '** ABEND     **'                                07660066
076700         DISPLAY '** PROGRAM   **  = ' PC-PROGRAM-NAME            07670066
076800         DISPLAY '** PARAGRAPH **  = 3400-CLOSE-ISSUE-CSR'        07680066
076900         DISPLAY '** ERROR CLOSING ISSUE-CSR'                     07690066
077000         PERFORM 9100-SQL-ABEND                                   07700066
077100     END-EVALUATE.                                                07710066
077200                                                                  07720066
077300* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07730066
077400* 9000-EOJ-ROUTINE - CLOSES ALL FILES ASSOCIATED WITH THE JOB     07740066
077500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07750066
077600                                                                  07760066
077700 9000-EOJ-ROUTINE.                                                07770066
077800*----------------                                                 07780066
077900                                                                  07790066
078000     CLOSE BALANCE-EXTRACT.                                       07800066
078100                                                                  07810066
078200* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07820066
078300* 9100-SQL-ERROR - PERFORMS THE ABEND FOR THE PROGRAM IN THE      07830066
078400* EVENT THAT AN SQL ERROR CODE OCCURS.                            07840066
078500* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * 07850066
078600                                                                  07860066
078700 9100-SQL-ABEND.                                                  07870066
078800                                                                  07880066
078900     DISPLAY ' '.                                                 07890066
079000     DISPLAY '9100-SQL-ABEND'.                                    07900066
079100     DISPLAY '**  ABEND     **'.                                  07910066
079200     DISPLAY '**  PROGRAM   ** = ' PC-PROGRAM-NAME.               07920066
079300     DISPLAY '**  PARAGRAPH ** = ' PV-PARAGRAPH-NAME.             07930066
079400     DISPLAY '**  OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.    07940066
079500                                                                  07950066
079600*                                                                 07960066
079700* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    07970066
079800* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         07980066
079900* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     07990066
080000* FORMAT.                                                         08000066
080100*                                                                 08010066
080200     COPY DPPD004.                                                08020066
080300                                                                  08030066
080400     SET ABEND-4013-DB2-ERROR TO TRUE                             08040066
080500     CALL 'ILBOABN0' USING ABEND-CODE.                            08050087
