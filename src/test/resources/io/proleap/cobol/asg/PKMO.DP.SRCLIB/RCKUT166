000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300 PROGRAM-ID.             RCKUT166.                                00030000
000400 AUTHOR.                 DENISE HAHN.                             00040000
000500 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00050000
000600 DATE-WRITTEN.           MARCH, 2017.                             00060000
000700 DATE-COMPILED.                                                   00070000
000800***************************************************************** 00080000
000900*  THIS PROGRAM WILL USE A CURSOR TO SELECT ALL OF THE P2L      * 00090000
001000*  FAILED STORE UNITS ADJUSTMENTS AS INPUT.                     * 00100000
001100*  THIS PROGRAM WILL TAKE IN THE INPUT, GET SOME ADDITIONAL     * 00110000
001200*  INFO AND THEN WRITE A RECORD FOR EACH DC-PO-LINE .           * 00120024
001300*  COPYBOOK FOR THE OUTPUT IS RCRD098.                          * 00130002
001400*  THE OUTPUT FILES WOULD BE RUN THRU PROGRAM RCKUP066          * 00140000
001500*  TO CREATE THE NECESSARY RECEIVERS.                           * 00150000
001600***************************************************************** 00160000
001700 ENVIRONMENT DIVISION.                                            00170000
001800 CONFIGURATION SECTION.                                           00180000
001900                                                                  00190000
002000 SOURCE-COMPUTER.        IBM-3090.                                00200000
002100 OBJECT-COMPUTER.        IBM-3090.                                00210000
002200                                                                  00220000
002300***************************************************************** 00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
003100     SELECT OUT-FILE                                              00310000
003200         ASSIGN TO OUT01.                                         00320000
003300                                                                  00330000
005800***************************************************************** 00580000
005900 DATA DIVISION.                                                   00590000
006000***************************************************************** 00600000
006100 FILE SECTION.                                                    00610000
006200                                                                  00620000
006800 FD  OUT-FILE                                                     00680000
006900     RECORDING MODE IS F                                          00690000
007000     BLOCK CONTAINS 0  RECORDS.                                   00700000
007100 01  OUT-FILE-RECORD                 PIC X(200).                  00710015
007200                                                                  00720000
011300***************************************************************** 01130000
011400 WORKING-STORAGE SECTION.                                         01140000
011500                                                                  01150000
011600 01  PROGRAM-SWITCHES.                                            01160000
011700     05  PS-EOF-CURSOR-SW             PIC X(01) VALUE 'N'.        01170002
011800         88  PS-EOF-CURSOR                      VALUE 'Y'.        01180002
011900         88  PS-NOT-EOF-CURSOR                  VALUE 'N'.        01190002
012000     05  PS-VALID-PO-SW               PIC X(01) VALUE 'N'.        01200005
012100         88  PS-VALID-PO                        VALUE 'Y'.        01210005
012200         88  PS-NOT-VALID-PO                    VALUE 'N'.        01220005
012300     05  PS-VALID-PO-LINE-SW          PIC X(01) VALUE 'N'.        01230005
012400         88  PS-VALID-PO-LINE                   VALUE 'Y'.        01240005
012500         88  PS-NOT-VALID-PO-LINE               VALUE 'N'.        01250005
014000                                                                  01400000
014100 01  PC-PROGRAM-CONSTANTS.                                        01410000
014200     05  PC-RCKUT166                 PIC X(08) VALUE              01420000
014300                                               'RCKUT166'.        01430000
014400     05  PC-DEFAULT-TMST             PIC X(26)  VALUE             01440000
014500                                    '9999-09-09-09.09.09.999999'. 01450000
014600     05  PC-SLASH                    PIC X(01) VALUE '/'.         01460000
014700     05  PC-DASH                     PIC X(01) VALUE '-'.         01470000
014800                                                                  01480000
014900                                                                  01490000
015000 01  PV-PROGRAM-VARIABLES.                                        01500000
015100                                                                  01510000
015900     05  PV-READ-COUNT               PIC 9(09)  VALUE ZERO.       01590005
016000     05  PV-READ-COUNT-2             PIC 9(09)  VALUE ZERO.       01600005
016100     05  PV-WRITE-COUNT              PIC 9(09)  VALUE ZERO.       01610005
016212     05  PV-INVALID-PO-COUNT         PIC 9(09)  VALUE ZERO.       01621205
016213     05  PV-INVALID-PO-LINE-COUNT    PIC 9(09)  VALUE ZERO.       01621305
016214     05  PV-INVALID-DC-COUNT         PIC 9(09)  VALUE ZERO.       01621405
016215     05  PV-PREV-PO-NBR              PIC 9(08)  VALUE ZEROS.      01621505
016216                                                                  01621605
016217     05  PV-DISP-SQLCODE             PIC -999.                    01621705
016218     05  PV-DISP-OPER                PIC  9(04) VALUE ZEROES.     01621805
016219     05  PV-DISP-PO                  PIC Z(09).                   01621905
016220     05  PV-DISP-RCVR                PIC 9999.                    01622005
016222     05  PV-DISP-LINE                PIC 9999.                    01622205
016223     05  PV-DISP-STORE               PIC 9999.                    01622305
016224     05  PV-DISP-SKU                 PIC 9(08).                   01622405
016230                                                                  01623005
016233     05  PV-DISPLAY-READ-COUNT1      PIC ZZZ,ZZZ,ZZ9.             01623305
016235     05  PV-DISPLAY-WRITE-COUNT      PIC ZZZ,ZZZ,ZZ9.             01623505
016244                                                                  01624405
016250 01  PV-ABEND-FIELDS.                                             01625002
016260     05  PV-ABEND-CODE               PIC S9(4) VALUE +0           01626002
016270                                               COMP SYNC.         01627002
016280     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'RCKUT166'.  01628002
016290     05  PV-ABEND-PARAGRAPH          PIC X(50) VALUE SPACES.      01629002
016300     05  PV-ABEND-OPERATION          PIC X(50) VALUE SPACES.      01630002
016400     05  PV-ABEND-STRUCTURE-1        PIC X(08) VALUE SPACES.      01640002
016500     05  PV-DB2-OPERATION-MESSAGE-1  PIC X(79) VALUE SPACES.      01650002
016600     05  PV-DB2-OPERATION-MESSAGE-2  PIC X(79) VALUE SPACES.      01660002
016700     05  PV-DB2-OPERATION-MESSAGE-3  PIC X(79) VALUE SPACES.      01670002
016800     05  PV-DB2-OPERATION-MESSAGE-4  PIC X(79) VALUE SPACES.      01680002
016900     05  PV-DB2-TABLE-NAME-1         PIC X(08) VALUE SPACES.      01690002
017000     05  PV-DB2-TABLE-NAME-2         PIC X(08) VALUE SPACES.      01700002
021607                                                                  02160702
021608 01  DK-DB-KEYS.                                                  02160804
021609     05  DK-PO-NBR                   PIC S9(9) COMP VALUE ZEROES. 02160904
021610     05  DK-PO-LINE-NBR              PIC S9(9) COMP VALUE ZEROES. 02161004
021620     05  DK-SKU-NBR                  PIC S9(8)V COMP-3.           02162004
021630                                                                  02163000
021640*----------------------------------------------------------------*02164002
021650* OUTPUT RECEIPT RECORD LAYOUT                                    02165000
021660*----------------------------------------------------------------*02166002
021670     COPY RCRD098.                                                02167002
021680                                                                  02168000
021690*----------------------------------------------------------------*02169002
021700*  USED FOR DB2 ERROR MESSAGE BUILDING                            02170000
021800*----------------------------------------------------------------*02180002
021900     COPY DPWS004.                                                02190000
022000                                                                  02200000
022800*---------------------------------------------------------------* 02280000
022900*  SUT_FINCL_ADJ                                                  02290000
023000*---------------------------------------------------------------* 02300000
023100     EXEC SQL                                                     02310000
023200         INCLUDE SUT00030                                         02320000
023300     END-EXEC.                                                    02330000
023400                                                                  02340000
023401*---------------------------------------------------------------* 02340100
023402*  SUT_ADJ_ERR_CDE                                                02340200
023403*---------------------------------------------------------------* 02340300
023404     EXEC SQL                                                     02340400
023405         INCLUDE SUT00031                                         02340500
023406     END-EXEC.                                                    02340600
023407                                                                  02340700
023408*---------------------------------------------------------------* 02340802
023409*  TSURSNC - SU REASON CODE                                       02340902
023410*---------------------------------------------------------------* 02341002
023411     EXEC SQL                                                     02341102
023412         INCLUDE TSURSNC                                          02341202
023413     END-EXEC.                                                    02341302
023414                                                                  02341402
023415*---------------------------------------------------------------* 02341504
023416*  XLT_SKU                                                        02341604
023417*---------------------------------------------------------------* 02341704
023418     EXEC SQL                                                     02341804
023419         INCLUDE XLT00003                                         02341904
023420     END-EXEC.                                                    02342004
023421                                                                  02342104
023422*---------------------------------------------------------------* 02342205
023423*  XLT_UPC                                                        02342305
023424*---------------------------------------------------------------* 02342405
023425     EXEC SQL                                                     02342505
023426         INCLUDE XLT00006                                         02342605
023427     END-EXEC.                                                    02342705
023428                                                                  02342805
023429*---------------------------------------------------------------* 02342900
023430*  TPURCHS                                                        02343000
023431*---------------------------------------------------------------* 02343100
023440     EXEC SQL                                                     02344019
023450         INCLUDE TPURCHS                                          02345019
023460     END-EXEC.                                                    02346019
023470                                                                  02347019
023500*---------------------------------------------------------------* 02350000
023600*  TPURITM                                                        02360000
023700*---------------------------------------------------------------* 02370000
023800     EXEC SQL                                                     02380000
023900         INCLUDE TPURITM                                          02390000
024000     END-EXEC.                                                    02400000
024001                                                                  02400102
024002*---------------------------------------------------------------* 02400209
024003*  TRECEIV                                                        02400309
024004*---------------------------------------------------------------* 02400409
024005     EXEC SQL                                                     02400514
024006         INCLUDE TRECEIV                                          02400614
024007     END-EXEC.                                                    02400714
024008                                                                  02400814
024009*---------------------------------------------------------------* 02400909
024010*  TRECITM                                                        02401010
024011*---------------------------------------------------------------* 02401109
024012     EXEC SQL                                                     02401209
024013         INCLUDE TRECITM                                          02401310
024014     END-EXEC.                                                    02401409
024015                                                                  02401509
024020*----------------------------------------------------------------*02402002
024100*  PACK-TO-LIGHT - FAILED UNIT ADJUSTMENT CURSOR                  02410002
024101*----------------------------------------------------------------*02410102
024110                                                                  02411002
024120     EXEC SQL                                                     02412002
024130          DECLARE P2L_FAIL_ADJ_CSR CURSOR FOR                     02413002
024140           SELECT A.FINCL_ADJ_ID                                  02414008
024141                , A.ORGN_LOC_NBR                                  02414108
024150                , A.PO_NBR                                        02415004
024160                , A.RCVR_SEQ_NBR                                  02416002
024170                , A.RCVR_LNE_NBR                                  02417004
024180                , A.DEST_LOC_NBR                                  02418004
024190                , A.UPC_NBR                                       02419002
024191                , F.SKU_NBR                                       02419104
024192                , A.FINCL_BEF_QTY                                 02419202
024193                , A.FINCL_AFT_QTY                                 02419302
024194                , A.ADJ_QTY                                       02419404
024195                , A.RSLV_BY_USR_ID                                02419502
024196                , A.RSLV_TMST                                     02419602
024197                , A.ADJ_ERR_CDE                                   02419702
024198                , D.ADJ_ERR_SHRT_DESC                             02419802
024199                , A.PRC_RSN_CDE                                   02419902
024200                , C.PRC_RSN_DESC                                  02420009
024201                , G.PKGNG_CDE                                     02420109
024202                , H.PREPK_ID                                      02420209
024203                , H.PREPK_RATO_QTY                                02420309
024204                , H.PREPK_DRV_LNE_CDE                             02420409
024205             FROM SUT_FINCL_ADJ A                                 02420502
024206                , TSURSNC C                                       02420602
024207                , SUT_ADJ_ERR_CDE D                               02420702
024208                , XLT_UPC E                                       02420802
024209                , XLT_SKU F                                       02420912
024210                , TRECEIV G                                       02421009
024211                , TRECITM H                                       02421109
024212           WHERE                                                  02421202
024213                 A.RSLV_BY_USR_ID = ' '                           02421302
024214             AND A.RSLV_TMST > CURRENT TIMESTAMP                  02421402
024215             AND A.PRC_RSN_CDE IN ('PCKCS722',                    02421502
024216                                   'PCCS722B',                    02421602
024217                                   'PCCS722C',                    02421702
024218                                   'PCCS722D',                    02421802
024219                                   'PCCS722E')                    02421902
024220             AND A.PRC_RSN_CDE  =  C.PRC_RSN_CDE                  02422002
024221             AND A.ADJ_ERR_CDE  =  D.ADJ_ERR_CDE                  02422102
024247             AND A.UPC_NBR  =  E.UPC_NBR                          02424728
024248             AND E.INTR_UPC_ID  =  F.INTR_UPC_ID                  02424828
024249             AND A.PO_NBR        =  G.ORD_NBR                     02424928
024250             AND A.RCVR_SEQ_NBR  =  G.REC_SEQ_NBR                 02425028
024251             AND G.ORD_NBR       =  H.ORD_NBR                     02425128
024252             AND G.REC_SEQ_NBR   =  H.REC_SEQ_NBR                 02425228
024253             AND A.RCVR_LNE_NBR  =  H.ORD_LNE_NBR                 02425328
024254           ORDER BY                                               02425428
024255                    A.PO_NBR                                      02425528
024256                  , A.ORGN_LOC_NBR                                02425628
024257                  , A.RCVR_LNE_NBR                                02425728
024258                  , A.DEST_LOC_NBR                                02425828
024259     END-EXEC.                                                    02425928
024260                                                                  02426028
024261                                                                  02426128
024262*----------------------------------------------------------------*02426228
024263*   DB2 SQL COMMUNICATION AREA                                    02426328
024264*----------------------------------------------------------------*02426428
024265     EXEC SQL                                                     02426528
024266          INCLUDE SQLCA                                           02426628
024267     END-EXEC.                                                    02426728
024270                                                                  02427002
024300******************************************************************02430000
024310                                                                  02431002
024400 PROCEDURE DIVISION.                                              02440000
024500     DISPLAY '**** START OF RCKUT166 ****'.                       02450000
024600                                                                  02460000
024700*OPEN FILES.                                                      02470000
024900     OPEN OUTPUT OUT-FILE.                                        02490000
025800                                                                  02580000
025900     SET   PS-NOT-EOF-CURSOR      TO  TRUE.                       02590005
026000                                                                  02600000
026100     PERFORM 1000-INITIALIZATION.                                 02610000
026200                                                                  02620000
026300     PERFORM 2000-PROCESS-INPUT                                   02630000
026400       UNTIL PS-EOF-CURSOR.                                       02640005
026500                                                                  02650000
026600                                                                  02660000
026700     DISPLAY '***'                                                02670000
026800     DISPLAY '*** INPUT COUNT      :  ' PV-READ-COUNT             02680000
026900     DISPLAY '*** '                                               02690000
027000     DISPLAY '*** OUTPUT FILE COUNT:  '                           02700000
027100             PV-WRITE-COUNT                                       02710000
027200     DISPLAY '*** '                                               02720000
029600     DISPLAY '*** '                                               02960000
029700     DISPLAY '*** INVALID PO COUNT       :  '                     02970000
029800             PV-INVALID-PO-COUNT                                  02980000
029900     DISPLAY '*** '                                               02990000
030000     DISPLAY '*** INVALID PO LINE COUNT  :  '                     03000000
030100             PV-INVALID-PO-LINE-COUNT                             03010000
030200     DISPLAY '*** '                                               03020000
030300     DISPLAY '*** INVALID DC NBR COUNT   :  '                     03030000
030400             PV-INVALID-DC-COUNT                                  03040000
030500     DISPLAY '*** '                                               03050000
030600                                                                  03060000
030610     PERFORM 5030-CLOSE-CURSOR.                                   03061005
030620                                                                  03062005
030700*CLOSE FILES.                                                     03070000
030900     CLOSE OUT-FILE.                                              03090000
031800                                                                  03180000
031900     GOBACK.                                                      03190000
032000                                                                  03200000
032100******************************************************************03210000
032200*  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               *03220000
032300******************************************************************03230000
032400 1000-INITIALIZATION.                                             03240000
032500     DISPLAY '1000-INITIALIZE '.                                  03250000
032600                                                                  03260000
033510     PERFORM 5000-OPEN-CURSOR.                                    03351002
033520     PERFORM 5010-FETCH-CURSOR.                                   03352002
033700                                                                  03370000
033800                                                                  03380000
033900******************************************************************03390000
034000**  READ INPUT-FILE, VALIDATE IF DATA IS TO BE PROCESSED TO       03400000
034100**  OUPUT FILE AND IF SO, THEN PROCESS.  IF NOT, JUST READ        03410000
034200**  NEXT RECORD.                                                  03420000
034300******************************************************************03430000
034400 2000-PROCESS-INPUT.                                              03440000
034500                                                                  03450000
034600     MOVE SUT00030-ORGN-LOC-NBR   TO PV-DISP-OPER.                03460006
034700     MOVE SUT00030-PO-NBR         TO PV-DISP-PO.                  03470006
034710     MOVE SUT00030-RCVR-SEQ-NBR   TO PV-DISP-RCVR.                03471006
034720     MOVE SUT00030-RCVR-LNE-NBR   TO PV-DISP-LINE.                03472006
034730     MOVE SUT00030-DEST-LOC-NBR   TO PV-DISP-STORE.               03473006
034740     MOVE XLT00003-SKU-NBR        TO PV-DISP-SKU.                 03474006
035781                                                                  03578105
035782     DISPLAY ' '                                                  03578205
035783             PV-DISP-OPER  '-'                                    03578305
035784             PV-DISP-PO    '-'                                    03578405
035785             PV-DISP-RCVR  '-'                                    03578505
035786             PV-DISP-LINE  '-'                                    03578605
035787             PV-DISP-STORE '-'                                    03578705
035788             PV-DISP-SKU.                                         03578805
035792                                                                  03579205
035793     INITIALIZE  RC098-ITEM-REC.                                  03579305
035795     MOVE SUT00030-ORGN-LOC-NBR   TO  RC098-OPER-UNIT             03579508
035796                                      RC098-ORIG-OPER-UNIT.       03579608
035797     MOVE SUT00030-PO-NBR         TO  DK-PO-NBR                   03579708
035798                                      RC098-ORIG-PO-NBR           03579808
035799                                      RC098-PO-NBR.               03579908
035800     MOVE SUT00030-RCVR-SEQ-NBR   TO  RC098-ORIG-PO-RCVR.         03580008
035801     MOVE SUT00030-RCVR-LNE-NBR   TO  DK-PO-LINE-NBR              03580108
035802                                      RC098-ORIG-PO-LNE-NBR       03580208
035803                                      RC098-PO-LNE-NBR.           03580308
035804     MOVE XLT00003-SKU-NBR        TO  DK-SKU-NBR                  03580408
035805                                      RC098-SKU-NBR.              03580508
035806     MOVE SUT00030-DEST-LOC-NBR   TO  RC098-STR-NBR               03580608
035807                                      RC098-ORIG-STR-NBR.         03580708
035808     MOVE SUT00030-ADJ-QTY        TO  RC098-AP-VERIFY-QTY         03580808
035810                                      RC098-MANIFEST-QTY          03581005
035900                                      RC098-TO-VERIFY-QTY.        03590005
036000     MOVE 'CR'                    TO  RC098-REC-TYP-CDE.          03600005
036100     MOVE 'PTL-FSA'               TO  RC098-CRE-UID.              03610021
036101     MOVE SUT00030-FINCL-ADJ-ID   TO  RC098-FINCL-ADJ-ID          03610108
036102     MOVE SUT00030-PRC-RSN-CDE    TO  RC098-PRC-RSN-CDE           03610220
036110*  FSA = FAILED STORE ADJUSTMENT                                  03611007
036200     MOVE 'FSA'                   TO  RC098-RCVG-CLERK-INIT-ID.   03620007
036300                                                                  03630005
036412     MOVE SUT00030-ADJ-ERR-CDE    TO  RC098-FINCL-ADJ-ERR-CDE.    03641205
036414     MOVE SUT00031-ADJ-ERR-SHRT-DESC                              03641405
036415                                  TO  RC098-ADJ-ERR-DESC.         03641505
036416                                                                  03641605
036417     MOVE RECEIV-PKGNG-CDE         TO  RC098-PKGNG-CDE.           03641709
036418     MOVE RECITM-PREPK-ID          TO  RC098-PREPK-ID.            03641809
036419     MOVE RECITM-PREPK-RATO-QTY    TO  RC098-PREPK-RATO-QTY.      03641909
036420     MOVE RECITM-PREPK-DRV-LNE-CDE TO  RC098-PREPK-DRV-LNE-CDE.   03642009
036421                                                                  03642109
036430     IF  PV-PREV-PO-NBR = SUT00030-PO-NBR                         03643009
036500         CONTINUE                                                 03650005
036600     ELSE                                                         03660005
036700         SET PS-NOT-VALID-PO       TO  TRUE                       03670005
036800         PERFORM 4000-GET-PO-INFO                                 03680018
036900         MOVE SUT00030-PO-NBR      TO  PV-PREV-PO-NBR             03690005
037000     END-IF.                                                      03700005
037100                                                                  03710005
037200     IF  PS-VALID-PO                                              03720005
037300         SET PS-NOT-VALID-PO-LINE  TO  TRUE                       03730005
037400         PERFORM 4500-GET-LINE-INFO                               03740005
037500     END-IF.                                                      03750005
037600                                                                  03760005
037700     IF  PS-NOT-VALID-PO                                          03770005
037800         ADD +1 TO PV-INVALID-PO-COUNT                            03780005
037900     ELSE                                                         03790005
038000         IF  PS-NOT-VALID-PO-LINE                                 03800005
038100             ADD +1 TO PV-INVALID-PO-LINE-COUNT                   03810005
038200         ELSE                                                     03820005
038300             PERFORM 8000-WRITE-OUTPUT                            03830005
038400         END-IF                                                   03840005
038500     END-IF.                                                      03850005
038600                                                                  03860005
038610     PERFORM 5010-FETCH-CURSOR.                                   03861005
038700                                                                  03870005
038720*                                                                 03872013
038800 4000-GET-PO-INFO.                                                03880018
038900                                                                  03890018
039000     MOVE '4000-GET-PO-INFO'                                      03900018
039100         TO PV-ABEND-PARAGRAPH.                                   03910018
039200     MOVE 'SELECT TPURCHS'                                        03920018
039300         TO PV-ABEND-OPERATION.                                   03930018
039400                                                                  03940018
039500     EXEC SQL                                                     03950018
039600          SELECT PKGNG_CDE                                        03960018
039700          INTO  :PURCHS-PKGNG-CDE                                 03970018
039800          FROM   TPURCHS                                          03980018
039900          WHERE  PO_NBR            = :DK-PO-NBR                   03990018
040000           AND   VER_STATUS_CDE    = 'A'                          04000018
040100          WITH UR                                                 04010018
040200     END-EXEC.                                                    04020018
040300                                                                  04030018
040400     EVALUATE TRUE                                                04040018
040500         WHEN SQLCODE = ZERO                                      04050018
040600         WHEN SQLCODE = -811                                      04060018
040700             SET PS-VALID-PO       TO  TRUE                       04070018
040800             MOVE PURCHS-PKGNG-CDE TO  RC098-PKGNG-CDE            04080018
040900             IF  RC098-PKGNG-CDE = 'M' OR 'I'                     04090018
041000                 MOVE 'B'          TO  RC098-PKGNG-CDE            04100018
041100             END-IF                                               04110018
041200         WHEN SQLCODE = +100                                      04120018
041300             DISPLAY 'INVALID PO NUMBER: ' SUT00030-PO-NBR        04130018
041400             MOVE 'XX'             TO  RC098-PKGNG-CDE            04140018
041500         WHEN SQLWARN0 NOT = SPACE                                04150018
041600         WHEN SQLCODE < ZERO                                      04160018
041700         WHEN SQLCODE > ZERO                                      04170018
041710             MOVE  SQLCODE         TO  PV-DISP-SQLCODE            04171018
041800             DISPLAY 'ABEND INFO - KEY DATA'                      04180018
041900             DISPLAY 'PO:          '   SUT00030-PO-NBR            04190018
042100             DISPLAY 'SQL CODE IS: '  PV-DISP-SQLCODE             04210018
042200             PERFORM 9900-DB2-ABEND                               04220018
042300     END-EVALUATE.                                                04230018
042400                                                                  04240005
042500 4500-GET-LINE-INFO.                                              04250005
042600                                                                  04260005
042700     MOVE '4500-GET-LINE-INFO'                                    04270005
042800         TO PV-ABEND-PARAGRAPH.                                   04280005
042900     MOVE 'SELECT TPURITM'                                        04290005
043000         TO PV-ABEND-OPERATION.                                   04300005
043100                                                                  04310005
043200     EXEC SQL                                                     04320005
043300          SELECT PO_LNE_NBR                                       04330005
043400          INTO  :PURITM-PO-LNE-NBR                                04340005
043500          FROM   TPURITM                                          04350005
043600          WHERE  PO_NBR            = :DK-PO-NBR                   04360005
043700           AND   PO_LNE_NBR        = :DK-PO-LINE-NBR              04370005
043800           AND   RMS_PO_SKU_NBR    = :DK-SKU-NBR                  04380005
043900           AND   VER_STATUS_CDE    = 'A'                          04390005
044000          WITH UR                                                 04400005
044100     END-EXEC.                                                    04410005
044200                                                                  04420005
044300     EVALUATE TRUE                                                04430005
044400         WHEN SQLCODE = ZERO                                      04440005
044500         WHEN SQLCODE = -811                                      04450005
044600             SET PS-VALID-PO-LINE TO TRUE                         04460005
044700         WHEN SQLCODE = +100                                      04470005
044800             DISPLAY 'INVALID SKU/LINE COMBO'                     04480005
044900             DISPLAY 'PO NUMBER:   ' SUT00030-PO-NBR              04490005
045000             DISPLAY 'SKU NUMBER:  ' XLT00003-SKU-NBR             04500005
045100             DISPLAY 'LINE NUMBER: ' SUT00030-RCVR-LNE-NBR        04510005
045200         WHEN SQLWARN0 NOT = SPACE                                04520005
045300         WHEN SQLCODE < ZERO                                      04530005
045400         WHEN SQLCODE > ZERO                                      04540005
045410             MOVE  SQLCODE           TO PV-DISP-SQLCODE           04541005
045500             DISPLAY 'ABEND INFO - KEY DATA'                      04550005
045600             DISPLAY 'PO NUMBER IS:  '  SUT00030-PO-NBR           04560005
045800             DISPLAY 'SQL CODE:    '    PV-DISP-SQLCODE           04580005
045900             PERFORM 9900-DB2-ABEND                               04590005
046000     END-EVALUATE.                                                04600005
046100                                                                  04610005
046110                                                                  04611005
046200*---------------------------------------------------------------- 04620005
046300*                                                                 04630005
046400*---------------------------------------------------------------- 04640005
046500 5000-OPEN-CURSOR.                                                04650005
046600                                                                  04660005
046700         EXEC SQL                                                 04670005
046800              OPEN P2L_FAIL_ADJ_CSR                               04680005
046900         END-EXEC                                                 04690005
047000                                                                  04700005
047100         MOVE SQLCODE  TO  PV-DISP-SQLCODE                        04710005
047200                                                                  04720005
047300         EVALUATE TRUE                                            04730005
047400             WHEN SQLWARN0 NOT = SPACES                           04740005
047500             WHEN SQLCODE < ZERO                                  04750005
047600             WHEN SQLCODE > ZERO                                  04760005
047700                 MOVE '5000-OPEN-CURSOR  '                        04770005
047800                                 TO PV-ABEND-PARAGRAPH            04780005
047900                 MOVE 'OPEN P2L_FAIL_ADJ_CSR '                    04790005
048000                                 TO PV-ABEND-OPERATION            04800005
048100                 PERFORM 9900-DB2-ABEND                           04810005
048200             WHEN SQLCODE = ZERO                                  04820005
048300             WHEN SQLCODE = +100                                  04830005
048400                 CONTINUE                                         04840005
048410         END-EVALUATE.                                            04841005
048420                                                                  04842005
048430                                                                  04843005
048440*---------------------------------------------------------------- 04844005
048450*                                                                 04845005
048460*---------------------------------------------------------------- 04846005
048470 5010-FETCH-CURSOR.                                               04847005
048480                                                                  04848005
048492     SET  PS-NOT-EOF-CURSOR    TO  TRUE.                          04849205
048493                                                                  04849305
048494     EXEC SQL                                                     04849405
048495          FETCH P2L_FAIL_ADJ_CSR                                  04849505
048496           INTO                                                   04849605
048497                :SUT00030-FINCL-ADJ-ID                            04849708
048498              , :SUT00030-ORGN-LOC-NBR                            04849808
048499              , :SUT00030-PO-NBR                                  04849908
048500              , :SUT00030-RCVR-SEQ-NBR                            04850008
048501              , :SUT00030-RCVR-LNE-NBR                            04850108
048502              , :SUT00030-DEST-LOC-NBR                            04850208
048503              , :SUT00030-UPC-NBR                                 04850308
048504              , :XLT00003-SKU-NBR                                 04850408
048505              , :SUT00030-FINCL-BEF-QTY                           04850508
048506              , :SUT00030-FINCL-AFT-QTY                           04850608
048507              , :SUT00030-ADJ-QTY                                 04850708
048508              , :SUT00030-RSLV-BY-USR-ID                          04850808
048509              , :SUT00030-RSLV-TMST                               04850908
048510              , :SUT00030-ADJ-ERR-CDE                             04851008
048511              , :SUT00031-ADJ-ERR-SHRT-DESC                       04851108
048512              , :SUT00030-PRC-RSN-CDE                             04851208
048513              , :SURSNC-PRC-RSN-DESC                              04851308
048514              , :RECEIV-PKGNG-CDE                                 04851409
048515              , :RECITM-PREPK-ID                                  04851509
048516              , :RECITM-PREPK-RATO-QTY                            04851609
048517              , :RECITM-PREPK-DRV-LNE-CDE                         04851709
048528     END-EXEC.                                                    04852805
048529                                                                  04852905
048530     EVALUATE TRUE                                                04853005
048531         WHEN SQLCODE = ZERO                                      04853105
048532              ADD  1  TO  PV-READ-COUNT                           04853205
048533              ADD  1  TO  PV-READ-COUNT-2                         04853305
048534                                                                  04853405
048535              IF  PV-READ-COUNT-2  > 49                           04853505
048536                  MOVE  PV-READ-COUNT  TO  PV-DISPLAY-READ-COUNT1 04853605
048537                  MOVE  PV-WRITE-COUNT TO  PV-DISPLAY-WRITE-COUNT 04853705
048538                  DISPLAY 'READ:'   PV-DISPLAY-READ-COUNT1        04853805
048539                          '   '                                   04853905
048540                          'WRITE:'  PV-DISPLAY-WRITE-COUNT        04854005
048541                  MOVE 0  TO PV-READ-COUNT-2                      04854105
048542              END-IF                                              04854205
048543                                                                  04854305
048569         WHEN SQLCODE = +100                                      04856905
048570             SET PS-EOF-CURSOR TO TRUE                            04857005
048571         WHEN SQLWARN0 NOT = SPACES                               04857105
048572         WHEN SQLCODE < ZERO                                      04857205
048573         WHEN SQLCODE > ZERO                                      04857305
048574             MOVE '5010-FETCH-CURSOR'                             04857405
048575                                 TO PV-ABEND-PARAGRAPH            04857505
048576             MOVE 'FETCH P2L_FAIL_ADJ_CSR '                       04857605
048577                                 TO PV-ABEND-OPERATION            04857705
048578             PERFORM 9900-DB2-ABEND                               04857805
048579     END-EVALUATE.                                                04857905
048580                                                                  04858005
048581                                                                  04858105
048582*---------------------------------------------------------------- 04858205
048583*                                                                 04858305
048584*---------------------------------------------------------------- 04858405
048585 5030-CLOSE-CURSOR.                                               04858505
048586                                                                  04858605
048587         EXEC SQL                                                 04858705
048588              CLOSE P2L_FAIL_ADJ_CSR                              04858805
048589         END-EXEC                                                 04858905
048590                                                                  04859005
048591         EVALUATE TRUE                                            04859105
048592             WHEN SQLWARN0 NOT = SPACES                           04859205
048593             WHEN SQLCODE < ZERO                                  04859305
048594             WHEN SQLCODE > ZERO                                  04859405
048595                 MOVE '5030-CLOSE-CURSOR       '                  04859505
048596                                 TO PV-ABEND-PARAGRAPH            04859605
048597                 MOVE 'CLOSE P2L_FAIL_ADJ_CSR '                   04859705
048598                                 TO PV-ABEND-OPERATION            04859805
048599                 PERFORM 9900-DB2-ABEND                           04859905
048600             WHEN SQLCODE = ZERO                                  04860005
048601                 CONTINUE                                         04860105
048602         END-EVALUATE.                                            04860205
048603                                                                  04860305
048604                                                                  04860405
048605******************************************************************04860505
048610*                                                                *04861005
048700******************************************************************04870005
048800 8000-WRITE-OUTPUT.                                               04880005
048900                                                                  04890005
049100     WRITE OUT-FILE-RECORD                                        04910005
049200      FROM RC098-ITEM-REC.                                        04920005
049300     ADD +1 TO PV-WRITE-COUNT.                                    04930005
053900                                                                  05390005
054000******************************************************************05400005
054100*  ABEND ROUTINE                                                 *05410005
054200******************************************************************05420005
054300 9900-DB2-ABEND.                                                  05430005
054400                                                                  05440005
054500     MOVE SQLCODE TO PV-DISP-SQLCODE.                             05450005
054600     DISPLAY '*** DB2 ERROR '.                                    05460005
054700     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  05470005
054800     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 05480005
054900     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               05490005
055000     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               05500005
055100     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       05510005
055200     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       05520005
055300     DISPLAY '*** TABLE 1   = ' PV-DB2-TABLE-NAME-1.              05530005
055400     DISPLAY '*** TABLE 2   = ' PV-DB2-TABLE-NAME-2.              05540005
055500                                                                  05550005
055600     COPY DPPD004.                                                05560005
055700                                                                  05570005
055800     MOVE +4013 TO PV-ABEND-CODE.                                 05580005
055900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05590005
056000                                                                  05600005
056100 9999-ABEND.                                                      05610005
056200                                                                  05620005
056300     DISPLAY '***************'.                                   05630005
056400     DISPLAY '** ABEND     **'.                                   05640005
056500     DISPLAY '** PROGRAM   ** = ' PV-ABEND-PROGRAM.               05650005
056600     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             05660005
056700     DISPLAY '***************'.                                   05670005
056800                                                                  05680005
056900     MOVE +4008                  TO PV-ABEND-CODE.                05690005
057000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         05700005
057100                                                                  05710005
057200******************************************************************05720005
057300*                 E N D   O F   P R O G R A M                    *05730005
057400******************************************************************05740005
