000100***************************************************************** 00010018
000200 IDENTIFICATION DIVISION.                                         00020018
000300***************************************************************** 00030018
000400                                                                  00040018
000500 PROGRAM-ID.             SUKUT010.                                00050018
000600 AUTHOR.                 MARY SARDINA.                            00060018
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070018
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080018
000900 DATE-COMPILED.                                                   00090018
001000***************************************************************** 00100018
001100***************************************************************** 00110018
001200*                                                               * 00120018
001300*  THIS PROGRAM WILL CREATE AN EXTRACT FILE FROM THE AUDIT      * 00130018
001400*  DATABASE.                                                    * 00140018
001500***************************************************************** 00150018
001600*  CHANGED 10/05/09 BY SAURABH DUDDALWAR                        * 00160018
017000*   WR# CHANGES DONE FOR HANDLING DATA CONTENTION ERRORS.       * 00170018
001800*                                                               * 00180018
001900***************************************************************** 00190018
002000***************************************************************** 00200018
002100 ENVIRONMENT DIVISION.                                            00210018
002200***************************************************************** 00220018
002300                                                                  00230018
002400 CONFIGURATION SECTION.                                           00240018
002500                                                                  00250018
002600 SOURCE-COMPUTER.        IBM-3090.                                00260018
002700 OBJECT-COMPUTER.        IBM-3090.                                00270018
002800                                                                  00280018
002900 INPUT-OUTPUT SECTION.                                            00290018
003000                                                                  00300018
003100 FILE-CONTROL.                                                    00310018
003200*                                                                 00320018
003300     SELECT SU-CARTON-EXTRACT-FILE                                00330018
003400         ASSIGN TO INP01.                                         00340018
003500                                                                  00350018
003600     SELECT SU-VENDOR-EXTRACT-FILE                                00360018
003700         ASSIGN TO OUT01.                                         00370018
003800*                                                                 00380018
003900***************************************************************** 00390018
004000 DATA DIVISION.                                                   00400018
004100***************************************************************** 00410018
004200*                                                                 00420018
004300 FILE SECTION.                                                    00430018
004400*                                                                 00440018
004500 FD  SU-CARTON-EXTRACT-FILE                                       00450018
004600     RECORDING MODE IS F                                          00460018
004700     BLOCK CONTAINS 0  RECORDS.                                   00470018
004800 01  SU-CARTON-EXTRACT-RECORD        PIC  X(200).                 00480018
004900                                                                  00490018
005000 FD  SU-VENDOR-EXTRACT-FILE                                       00500018
005100     RECORDING MODE IS F                                          00510018
005200     BLOCK CONTAINS 0  RECORDS.                                   00520018
005300 01  SU-VENDOR-EXTRACT-RECORD        PIC  X(200).                 00530018
005400*                                                                 00540018
005500                                                                  00550018
005600 WORKING-STORAGE SECTION.                                         00560018
005700*                                                                 00570018
005800 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00580018
005900                                                   COMP SYNC.     00590018
006000*                                                                 00600018
006100 01  PROGRAM-SWITCHES.                                            00610018
006200     05  PS-CARTON-AUDIT-DATA-SW     PIC  X(01)    VALUE 'N'.     00620018
006300         88  PS-CARTON-AUDIT-DATA                  VALUE 'Y'.     00630018
006400         88  PS-NO-CARTON-AUDIT-DATA               VALUE 'N'.     00640018
006500     05  PS-SKU-MATCH-COMPLETE-SW    PIC  X(01)    VALUE 'N'.     00650018
006600         88  PS-SKU-MATCH-COMPLETE                 VALUE 'Y'.     00660018
006700         88  PS-SKU-MATCH-NOT-COMPLETE             VALUE 'N'.     00670018
006800     05  PS-PROCESS-COMPLETE-SW      PIC  X(01)    VALUE 'N'.     00680018
006900         88  PS-PROCESS-COMPLETE                   VALUE 'Y'.     00690018
007000         88  PS-PROCESS-NOT-COMPLETE               VALUE 'N'.     00700018
007100     05  PS-EXPECT-COMPLETE-SW       PIC  X(01)    VALUE 'N'.     00710018
007200         88  PS-EXPECT-COMPLETE                    VALUE 'Y'.     00720018
007300         88  PS-EXPECT-NOT-COMPLETE                VALUE 'N'.     00730018
007400     05  PS-PROCESS-EXPECT-TABLE-SW  PIC  X(01)    VALUE 'N'.     00740018
007500         88  PS-PROCESS-EXPECT-TABLE               VALUE 'Y'.     00750018
007600         88  PS-NO-PROCESS-EXPECT-TABLE            VALUE 'N'.     00760018
007700     05  PS-END-OF-SUATRN-CURSOR-SW  PIC  X(01)    VALUE 'N'.     00770018
007800         88  PS-END-OF-SUATRN-CURSOR               VALUE 'Y'.     00780018
007900         88  PS-NOT-END-OF-SUATRN-CURSOR          VALUE 'N'.      00790018
008000     05  PS-END-OF-TRIP-CURSOR-SW    PIC  X(01)    VALUE 'N'.     00800018
008100         88  PS-END-OF-TRIP-CURSOR                 VALUE 'Y'.     00810018
008200         88  PS-NOT-END-OF-TRIP-CURSOR             VALUE 'N'.     00820018
008300     05  PS-END-OF-CARTON-CURSOR-SW PIC   X(01)    VALUE 'N'.     00830018
008400         88  PS-END-OF-CARTON-CURSOR               VALUE 'Y'.     00840018
008500         88  PS-NOT-END-OF-CARTON-CURSOR           VALUE 'N'.     00850018
008600     05  PS-END-OF-PKSLIP-CURSOR-SW PIC   X(01)    VALUE 'N'.     00860018
008700         88  PS-END-OF-PKSLIP-CURSOR               VALUE 'Y'.     00870018
008800         88  PS-NOT-END-OF-PKSLIP-CURSOR           VALUE 'N'.     00880018
008900     05  PS-END-OF-INPKSU-CURSOR-SW PIC   X(01)    VALUE 'N'.     00890018
009000         88  PS-END-OF-INPKSU-CURSOR               VALUE 'Y'.     00900018
009100         88  PS-NOT-END-OF-INPKSU-CURSOR           VALUE 'N'.     00910018
009200     05  PS-END-OF-SHUUPC-CURSOR-SW PIC   X(01)    VALUE 'N'.     00920018
009300         88  PS-END-OF-SHUUPC-CURSOR               VALUE 'Y'.     00930018
009400         88  PS-NOT-END-OF-SHUUPC-CURSOR           VALUE 'N'.     00940018
009500     05  PS-END-OF-SUAUPC-CURSOR-SW PIC   X(01)    VALUE 'N'.     00950018
009600         88  PS-END-OF-SUAUPC-CURSOR               VALUE 'Y'.     00960018
009700         88  PS-NOT-END-OF-SUAUPC-CURSOR           VALUE 'N'.     00970018
009800     05  PS-END-OF-CARDIN-SW         PIC  X(01)    VALUE 'N'.     00980018
009900         88  PS-END-OF-CARDIN-FILE                 VALUE 'Y'.     00990018
010000         88  PS-NOT-END-OF-CARDIN-FILE             VALUE 'N'.     01000018
010100     05  PS-END-OF-CARTON-SW         PIC  X(01)    VALUE 'N'.     01010018
010200         88  PS-END-OF-CARTON-FILE                 VALUE 'Y'.     01020018
010300         88  PS-NOT-END-OF-CARTON-FILE             VALUE 'N'.     01030018
010400*                                                                 01040018
010500 01  CARTON-UPC-AUDIT-TABLE.                                      01050018
010600     05  CUA-TABLE                   OCCURS 2500 TIMES            01060018
010700                                     INDEXED BY CUA-INDX          01070018
010800                                                CUA-MAX-INDX.     01080018
010900         10  CUA-UPC-NBR             PIC S9(15)    COMP-3.        01090018
011000         10  CUA-SKU-NBR             PIC X(13).                   01100018
011010         10  CUA-INTR-UPC-ID         PIC S9(15)    COMP-3.        01110018
011100         10  CUA-PROCESS-IND         PIC X(01).                   01120018
011200             88  CUA-PROCESSED                     VALUE 'Y'.     01130018
011300             88  CUA-NOT-PROCESSED                 VALUE 'N'.     01140018
011400                                                                  01150018
011500 01  CARTON-UPC-EXPECT-TABLE.                                     01160018
011600     05  CUE-TABLE                   OCCURS 2500 TIMES            01170018
011700                                     INDEXED BY CUE-INDX          01180018
011800                                                CUE-MAX-INDX.     01190018
011900         10  CUE-UPC-NBR             PIC S9(15)    COMP-3.        01200018
012000         10  CUE-SKU-NBR             PIC X(13).                   01210018
012010         10  CUE-INTR-UPC-ID         PIC S9(15)    COMP-3.        01220018
012020         10  CUE-EXPECT-QTY          PIC S9(05)    COMP-3.        01230018
012030         10  CUE-PROCESS-IND         PIC X(01).                   01240018
012040             88  CUE-PROCESSED                     VALUE 'Y'.     01250018
012050             88  CUE-NOT-PROCESSED                 VALUE 'N'.     01260018
012060                                                                  01270018
012070*                                                                 01280018
012080 01  PC-CONSTANTS.                                                01290018
012090     05  PC-1                        PIC S9(03)    VALUE +1       01300018
012100                                                   COMP-3.        01310018
012200     05  PC-2500                     PIC S9(04)    VALUE +2500    01320018
012300                                                   COMP-3.        01330018
012400     05  PC-A                        PIC  X(01)    VALUE 'A'.     01340018
012500     05  PC-Y                        PIC  X(01)    VALUE 'Y'.     01350018
012600     05  PC-E                        PIC  X(01)    VALUE 'E'.     01360018
012700     05  PC-RCV                      PIC  X(03)    VALUE 'RCV'.   01370018
012800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01380018
012900         'SUKUT010'.                                              01390018
013000*                                                                 01400018
013100 01  PV-MISC-FIELDS.                                              01410018
013200     05  PV-DEPT-NBR-X               PIC X(03).                   01420018
013300     05  PV-DEPT-NBR-N REDEFINES PV-DEPT-NBR-X                    01430018
013310                                     PIC 9(03).                   01440018
013320     05  PV-CLASS-NBR-X              PIC X(02).                   01450018
013330     05  PV-CLASS-NBR-N REDEFINES PV-CLASS-NBR-X                  01460018
013340                                     PIC 9(02).                   01470018
013350     05  PV-HOLD-SHPD-QTY            PIC S9(09)    VALUE ZERO     01480018
013360                                                   COMP-3.        01490018
013370     05  PV-WRITE-COUNT              PIC S9(09)    COMP.          01500018
013380     05  PV-HOLD-PO-NBR              PIC S9(09)    COMP.          01510018
013381     05  PV-FORMAT-SKU-NBR.                                       01520018
013382         10  PV-FSN-DEPT-NBR         PIC X(03)     VALUE SPACES.  01530018
013383         10  PV-FSN-CLASS-NBR        PIC X(02)     VALUE SPACES.  01540018
013384         10  PV-FSN-SKU-NMBR         PIC 9(08)     VALUE ZERO.    01550018
013385     05  PV-HOLD-REC-SEQ-NBR         PIC S9(09)    COMP.          01560018
013386     05  PV-LINE-SUB                 PIC S9(03)    VALUE ZERO     01570018
013387                                                   COMP-3.        01580018
013388     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01590018
013389                                                   COMP SYNC.     01600018
013390     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  01610018
013400     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  01620018
013500     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01630018
013600     05  PV-AUDIT-NBR-X              PIC  X(09).                  01640018
013700     05  PV-AUDIT-NBR REDEFINES PV-AUDIT-NBR-X                    01650018
013800                                     PIC  9(09).                  01660018
013900     05  PV-SKU-COUNT                    PIC S9(09)  VALUE +0     01670018
014000                                                     COMP-3.      01680018
014100     05  PV-RECS-WRITTEN-COUNT       PIC S9(07)  VALUE ZERO       01690018
014200                                                 COMP-3.          01700018
014300     05  PV-RECS-READ-COUNT          PIC S9(07)  VALUE ZERO       01710018
014400                                                 COMP-3.          01720018
014500     05  PV-DISP-NBR                 PIC ZZZ,ZZ9.                 01730018
014600 EJECT                                                            01740018
014700*                                                                 01750018
014800 01  DK-DB-KEYS.                                                  01760018
014900    05  DK-SHIPT-UNT-ID             PIC S9(18) COMP-3.            01770018
015000    05  DK-AUD-CNTL-NBR             PIC S9(09) COMP.              01780018
015100    05  DK-PO-NBR                   PIC S9(09) COMP.              01790018
015200    05  DK-UPC-NBR                  PIC S9(15) COMP-3.            01800018
015300                                                                  01810018
015400                                                                  01820018
015500 01  DISPLAY-FIELDS.                                              01830018
015600    05  DF-SHIPT-UNT-ID             PIC 9(18).                    01840018
015700    05  DF-UPC-NBR                  PIC 9(15).                    01850018
015800    05  DF-SHPD-QTY                 PIC 9(09).                    01860018
015900    05  DF-DISPLAY-FIELD            PIC 9(18).                    01870018
016000    05  DF-UPC-NBR-FIELD            PIC 9(15).                    01880018
016100                                                                  01890018
016200                                                                  01900018
016300*                                                                 01910018
016400 01  SU003-COPYBOOK.                                              01920018
016500     COPY SURD003.                                                01930018
016600                                                                  01940018
016610*  DOMAIN ITEM MODULE                                             01950018
016620     COPY XLWS001.                                                01960018
016700*                                                                 01970018
016800******************************************************************01980018
016900*  DB2 FORMATTED MESSAGE AREA                                     01990018
017000******************************************************************02000018
017100     COPY DPWS004.                                                02010018
017300*                                                                 02020018
017400*  COPY BOOK FOR THE XLV_UPC TABLE                                02030018
017500*                                                                 02040018
017600     EXEC SQL                                                     02050018
017700          INCLUDE XLV00003                                        02060018
017800     END-EXEC.                                                    02070018
017801*                                                                 02080018
017802*  COPY BOOK FOR THE XLT_SKU TABLE                                02090018
017803*                                                                 02100018
017804     EXEC SQL                                                     02110018
017805          INCLUDE XLT00003                                        02120018
017806     END-EXEC.                                                    02130018
017807*                                                                 02140018
017808*  COPY BOOK FOR THE XLT_VND_STYL TABLE                           02150018
017809*                                                                 02160018
017810     EXEC SQL                                                     02170018
017811          INCLUDE XLT00004                                        02180018
017812     END-EXEC.                                                    02190018
017813*                                                                 02200018
017820*  COPY BOOK FOR THE SHIPPING UNIT AUDIT TRANSACTION TABLE        02210018
017830*                                                                 02220018
017840     EXEC SQL                                                     02230018
017850          INCLUDE TSUATRN                                         02240018
017860     END-EXEC.                                                    02250018
017900                                                                  02260018
018000*                                                                 02270018
018100*  COPY BOOK FOR THE RECEIVING TABLE                              02280018
018200*                                                                 02290018
018300     EXEC SQL                                                     02300018
018400          INCLUDE TRECEIV                                         02310018
018500     END-EXEC.                                                    02320018
018600                                                                  02330018
018700*                                                                 02340018
018800*  COPY BOOK FOR THE SHIPPING UNIT CONTENT AUDIT TABLE            02350018
018900*                                                                 02360018
019000     EXEC SQL                                                     02370018
019100          INCLUDE TPKSLIP                                         02380018
019200     END-EXEC.                                                    02390018
019300                                                                  02400018
019400*                                                                 02410018
019500*  COPY BOOK FOR THE SHIPPING UNIT CONTENT AUDIT TABLE            02420018
019600*                                                                 02430018
019700     EXEC SQL                                                     02440018
019800          INCLUDE TINPKSU                                         02450018
019900     END-EXEC.                                                    02460018
020000*                                                                 02470018
020100*  COPY BOOK FOR THE SHIPPING UNIT CONTENT AUDIT TABLE            02480018
020200*                                                                 02490018
020300     EXEC SQL                                                     02500018
020400          INCLUDE TSHUUPC                                         02510018
020500     END-EXEC.                                                    02520018
020600*                                                                 02530018
020700*  COPY BOOK FOR THE SHIPPING UNIT CONTENT AUDIT TABLE            02540018
020800*                                                                 02550018
020900     EXEC SQL                                                     02560018
021000          INCLUDE TSUNAUD                                         02570018
021100     END-EXEC.                                                    02580018
021200*                                                                 02590018
021300*  COPY BOOK FOR THE SHIPPING UNIT UPC AUDIT TABLE                02600018
021400*                                                                 02610018
021500     EXEC SQL                                                     02620018
021600          INCLUDE TSUAUPC                                         02630018
021700     END-EXEC.                                                    02640018
021800*                                                                 02650018
021900*  COPY BOOK FOR THE SHIPPING UNIT TABLE                          02660018
022000*                                                                 02670018
022100     EXEC SQL                                                     02680018
022200          INCLUDE TSHPUNT                                         02690018
022300     END-EXEC.                                                    02700018
022400                                                                  02710018
022500 EJECT                                                            02720018
022600*  DB2 COMMUNICATION AREA                                         02730018
022700*                                                                 02740018
022800     EXEC SQL                                                     02750018
022900         INCLUDE SQLCA                                            02760018
023000     END-EXEC.                                                    02770018
023100 EJECT                                                            02780018
023200*  DB2 COMMUNICATION AREA2                                        02790018
023300*                                                                 02800018
023400     COPY SQLCA2.                                                 02810018
023500 EJECT                                                            02820018
023600                                                                  02830018
023700     EXEC SQL                                                     02840018
023800       DECLARE SUATRN-CSR CURSOR FOR                              02850018
023900         SELECT DISTINCT(TRN_NBR)                                 02860018
024000                       ,(REC_SEQ_NBR)                             02870018
024100          FROM  TSUATRN                                           02880018
024200          WHERE AUD_CNTL_NBR        = :DK-AUD-CNTL-NBR            02890018
024300         GROUP BY TRN_NBR,REC_SEQ_NBR                             02900018
024400     END-EXEC.                                                    02910018
024500                                                                  02920018
024600     EXEC SQL                                                     02930018
024700       DECLARE PKSLIP-CSR CURSOR FOR                              02940018
024800         SELECT PO_NBR                                            02950018
024900               ,SEQ_NBR                                           02960018
025000          FROM  TPKSLIP                                           02970018
025100          WHERE PO_NBR  =     :SUATRN-TRN-NBR                     02980018
025200            AND REC_SEQ_NBR = :SUATRN-REC-SEQ-NBR                 02990018
025300            AND VER_STAT_CDE = :PC-A                              03000018
025400     END-EXEC.                                                    03010018
025500                                                                  03020018
025600     EXEC SQL                                                     03030018
025700       DECLARE INPKSU-CSR CURSOR FOR                              03040018
025800         SELECT SHIPT_UNT_ID                                      03050018
025900          FROM  TINPKSU                                           03060018
026000          WHERE PO_NBR  =     :SUATRN-TRN-NBR                     03070018
026100            AND SEQ_NBR =     :PKSLIP-SEQ-NBR                     03080018
026200          ORDER BY SHIPT_UNT_ID                                   03090018
026300     END-EXEC.                                                    03100018
026400                                                                  03110018
026500     EXEC SQL                                                     03120018
026600       DECLARE SHUUPC-CSR CURSOR FOR                              03130018
028800         SELECT SHUUPC.UPC_NBR                                    03140018
028900              , SHUUPC.SHPD_QTY                                   03150018
029000              , SHUUPC.TRN_NBR                                    03160018
029100              , SHPUNT.DEST_OPER_UNT_ID                           03170018
029500          FROM  TSHUUPC        SHUUPC                             03180018
029510              , TSHPUNT        SHPUNT                             03190018
029520          WHERE SHUUPC.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID           03200018
029521            AND SHUUPC.SHIPT_UNT_ID  = SHPUNT.SHIPT_UNT_ID        03210018
029527         ORDER BY UPC_NBR                                         03220018
029528     END-EXEC.                                                    03230018
029529                                                                  03240018
029530*        SELECT A.UPC_NBR                                         03250018
029531*             , A.SHPD_QTY                                        03260018
029532*             , A.TRN_NBR                                         03270018
029533*             , B.DEST_OPER_UNT_ID                                03280018
029534*             , D.MERCH_DEPT_NMBR                                 03290018
029535*             , D.MERCH_CLASS_NMBR                                03300018
029536*             , D.SEQ_NMBR                                        03310018
029537*         FROM  TSHUUPC A                                         03320018
029538*             , TSHPUNT B                                         03330018
029539*             , TUPCSKU C                                         03340018
029540*             , TSK     D                                         03350018
029541*         WHERE A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                03360018
029542*           AND A.SHIPT_UNT_ID  = B.SHIPT_UNT_ID                  03370018
029543*           AND A.UPC_NBR       = C.UPC_NBR                       03380018
029544*           AND C.ITEM_NBR      = D.ITEM_NMBR                     03390018
029545*        ORDER BY A.UPC_NBR                                       03400018
029546                                                                  03410018
029547     EXEC SQL                                                     03420018
029548       DECLARE SUAUPC-CSR CURSOR FOR                              03430018
029549         SELECT A.UPC_NBR                                         03440018
029550              , A.SKU_NBR                                         03450018
029560              , A.SCN_TMST                                        03460018
029570          FROM  TSUAUPC A                                         03470018
029580          WHERE A.SHIPT_UNT_ID  = :DK-SHIPT-UNT-ID                03480018
029590            AND A.AUD_CNTL_NBR  = :DK-AUD-CNTL-NBR                03490018
029600            AND A.SCN_TYP_CDE  <> :PC-E                           03500018
029700          ORDER BY A.UPC_NBR, A.SCN_TMST                          03510018
029800     END-EXEC.                                                    03520018
029900                                                                  03530018
030000                                                                  03540018
030100*                                                                 03550018
030200 PROCEDURE DIVISION.                                              03560018
030300*                                                                 03570018
030400 0000-MAINLINE-PROCESSING.                                        03580018
030500******************************************************************03590018
030600**  THIS IS THE MAIN DRIVER FOR THE PROGRAM.                      03600018
030700******************************************************************03610018
030800*                                                                 03620018
030900     PERFORM 1000-INITIALIZATION.                                 03630018
031000*                                                                 03640018
031100     IF PS-NOT-END-OF-CARTON-FILE                                 03650018
031200         PERFORM 1500-PROCESS-CARTON-FILE                         03660018
031300            UNTIL PS-END-OF-CARTON-FILE                           03670018
031400     END-IF.                                                      03680018
031500*                                                                 03690018
031600     PERFORM 9000-EOJ-ROUTINE.                                    03700018
031700     GOBACK.                                                      03710018
031800*                                                                 03720018
031900*                                                                 03730018
032000 1000-INITIALIZATION.                                             03740018
032100******************************************************************03750018
032200**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               03760018
032300******************************************************************03770018
032400                                                                  03780018
032500     OPEN INPUT  SU-CARTON-EXTRACT-FILE                           03790018
032600          OUTPUT SU-VENDOR-EXTRACT-FILE.                          03800018
032700                                                                  03810018
032800     PERFORM 7100-READ-CARTON-FILE.                               03820018
032900                                                                  03830018
033000     IF PS-END-OF-CARTON-FILE                                     03840018
033100         DISPLAY '** CARTON FILE IS EMPTY **'                     03850018
033200     ELSE                                                         03860018
033300         MOVE SU003-AUD-CNTL-NBR TO DK-AUD-CNTL-NBR               03870018
033400         MOVE DK-AUD-CNTL-NBR TO DF-DISPLAY-FIELD                 03880018
033500         DISPLAY 'AUDIT NUMBER IS: ' DF-DISPLAY-FIELD             03890018
033600     END-IF.                                                      03900018
033700                                                                  03910018
033800 1500-PROCESS-CARTON-FILE.                                        03920018
033900     PERFORM 6500-SELECT-TSUNAUD.                                 03930018
034000                                                                  03940018
034100*    IF THIS IS A SPOT CHECK, OR A CARTON EXTRACT, GO THROUGH THE 03950018
034200*    SPOT AUDIT LOGIC (WILL ONLY PULL THE ITEMS THAT WERE SUPPOSE 03960018
034300*    TO BE RECEIVED FOR THE CARTONS THAT ARE ON THE FILE.  A      03970018
034400*    100% CHECK, AND/OR AN AUDIT EXTRACT WILL NEED TO PULL EVERY  03980018
034500*    CARTON FOR THE RECEIVER)                                     03990018
034600     IF SUNAUD-AUD-TYP-CDE  = '02'                                04000018
034700     OR SU003-CARTON-EXTRACT                                      04010018
034800         MOVE SU003-SHIPT-UNT-ID TO DK-SHIPT-UNT-ID               04020018
034900         PERFORM 6000-PROCESS-SPOT-CHECKS                         04030018
035000     ELSE                                                         04040018
035100         PERFORM 2000-PROCESS-SUATRN                              04050018
035200     END-IF.                                                      04060018
035300*                                                                 04070018
035400 2000-PROCESS-SUATRN.                                             04080018
035500     SET PS-NOT-END-OF-SUATRN-CURSOR TO TRUE                      04090018
035600     PERFORM 2100-OPEN-SUATRN-CURSOR.                             04100018
035700     PERFORM 2200-FETCH-SUATRN-CURSOR.                            04110018
035800     PERFORM 2300-PROCESS-SUATRN-CURSOR                           04120018
035900         UNTIL PS-END-OF-SUATRN-CURSOR.                           04130018
036000     PERFORM 2400-CLOSE-SUATRN-CURSOR.                            04140018
036100     PERFORM 7100-READ-CARTON-FILE                                04150018
036200         UNTIL                                                    04160018
036300          SU003-AUD-CNTL-NBR NOT = DK-AUD-CNTL-NBR                04170018
036400             OR PS-END-OF-CARTON-FILE.                            04180018
036500     IF PS-END-OF-CARTON-FILE                                     04190018
036600          CONTINUE                                                04200018
036700     ELSE                                                         04210018
036800         MOVE SU003-AUD-CNTL-NBR TO DK-AUD-CNTL-NBR               04220018
036900     END-IF.                                                      04230018
037000 2100-OPEN-SUATRN-CURSOR.                                         04240018
037100     MOVE '2100-OPEN-SUATRN-CURSOR   '                            04250018
037200                                 TO PV-ABEND-PARAGRAPH.           04260018
037300     EXEC SQL                                                     04270018
037400         OPEN SUATRN-CSR                                          04280018
037500     END-EXEC.                                                    04290018
037600     EVALUATE TRUE                                                04300018
037700         WHEN SQLCODE = ZERO                                      04310018
037800             CONTINUE                                             04320018
037900         WHEN SQLWARN0 NOT = SPACES                               04330018
038000         WHEN SQLCODE < ZERO                                      04340018
038100         WHEN SQLCODE > ZERO                                      04350018
038200             MOVE '2100-OPEN-SUATRN-CURSOR         '              04360018
038300                             TO PV-PARAGRAPH-NAME                 04370018
038400             MOVE 'OPEN THE SUATRN_CUROSR         '               04380018
038500                             TO PV-DB2-OPERATION-ATTEMPTED        04390018
038600             PERFORM 9100-SQL-ABEND                               04400018
038700     END-EVALUATE.                                                04410018
038800                                                                  04420018
038900 2200-FETCH-SUATRN-CURSOR.                                        04430018
039000     MOVE '2200-FETCH-SUATRN-CURSOR   '                           04440018
039100                                 TO PV-ABEND-PARAGRAPH.           04450018
039200     EXEC SQL                                                     04460018
039300          FETCH SUATRN-CSR                                        04470018
039400          INTO  :SUATRN-TRN-NBR                                   04480018
039500              , :SUATRN-REC-SEQ-NBR                               04490018
039600     END-EXEC.                                                    04500018
039700                                                                  04510018
039800     EVALUATE TRUE                                                04520018
039900       WHEN SQLCODE = ZEROS                                       04530018
040000         CONTINUE                                                 04540018
040100       WHEN SQLCODE = +100                                        04550018
040200           SET PS-END-OF-SUATRN-CURSOR TO TRUE                    04560018
040300       WHEN SQLWARN0 NOT = SPACES                                 04570018
040400       WHEN SQLCODE < ZERO                                        04580018
040500       WHEN SQLCODE > ZERO                                        04590018
040600           MOVE '2200-FETCH-SUATRN-CURSOR'                        04600018
040700                               TO PV-PARAGRAPH-NAME               04610018
040800           MOVE 'FETCH SUATRN CURSOR '                            04620018
040900                               TO PV-DB2-OPERATION-ATTEMPTED      04630018
041000           PERFORM 9100-SQL-ABEND                                 04640018
041100     END-EVALUATE.                                                04650018
041200                                                                  04660018
041300 2300-PROCESS-SUATRN-CURSOR.                                      04670018
041400                                                                  04680018
041500*    FOR EACH UNIQUE PO, CHECK THE AGREEMENT TO SEE IF IT IS A    04690018
041600*    PACK-BY-STORE OR BULK ORDER                                  04700018
041700     IF SUATRN-TRN-NBR = PV-HOLD-PO-NBR AND                       04710018
041800        SUATRN-REC-SEQ-NBR = PV-HOLD-REC-SEQ-NBR                  04720018
041900         CONTINUE                                                 04730018
042000     ELSE                                                         04740018
042100         MOVE SUATRN-TRN-NBR       TO PV-HOLD-PO-NBR              04750018
042200                                      DK-PO-NBR                   04760018
042300         MOVE SUATRN-REC-SEQ-NBR   TO PV-HOLD-REC-SEQ-NBR         04770018
042400         PERFORM 2310-GET-ORDER-TYPE                              04780018
042500     END-IF.                                                      04790018
042600                                                                  04800018
042700     PERFORM 3000-PROCESS-PKSLIP                                  04810018
042800     PERFORM 2200-FETCH-SUATRN-CURSOR.                            04820018
042900                                                                  04830018
043000                                                                  04840018
043100***************************************************************** 04850018
043200*  2310-GET-ORDER-TYPE.                                         * 04860018
043300* THIS PARAGRAPH WILL PERFORM A SELECT ON THE PO AGREEMENT TABLE* 04870018
043400* TO DETERMINE IF THE PO IS A PACK BY STORE ORDER OR NOT        * 04880018
043500***************************************************************** 04890018
043600 2310-GET-ORDER-TYPE.                                             04900018
043700                                                                  04910018
043800     EXEC SQL                                                     04920018
043900       SELECT  PACK_BY_ST_IND                                     04930018
044000         INTO  :RECEIV-PACK-BY-ST-IND                             04940018
044100         FROM  TRECEIV                                            04950018
044200        WHERE  ORD_NBR        = :DK-PO-NBR                        04960018
044300          AND  REC_SEQ_NBR    = :SUATRN-REC-SEQ-NBR               04970018
044400     END-EXEC.                                                    04980018
044500                                                                  04990018
044600     EVALUATE TRUE                                                05000018
044700       WHEN SQLCODE = ZEROS                                       05010018
044800            CONTINUE                                              05020018
044900       WHEN SQLCODE = +100                                        05030018
045000            MOVE 'N'                     TO RECEIV-PACK-BY-ST-IND 05040018
045100                                                                  05050018
045200       WHEN OTHER                                                 05060018
045300             MOVE '2310-GET-ORDER-TYPE'                           05070018
045400                             TO PV-PARAGRAPH-NAME                 05080018
045500             MOVE 'SELECT THE PBS INDICATOR FROM TRECEIV'         05090018
045600                             TO PV-DB2-OPERATION-ATTEMPTED        05100018
045700             DISPLAY 'PO NUMBER:   ' DK-PO-NBR                    05110018
045800             DISPLAY 'REC SEQ NBR: ' SUATRN-REC-SEQ-NBR           05120018
045900             PERFORM 9100-SQL-ABEND                               05130018
046000     END-EVALUATE.                                                05140018
046100                                                                  05150018
046200                                                                  05160018
046300                                                                  05170018
046400 2400-CLOSE-SUATRN-CURSOR.                                        05180018
046500     MOVE '2400-CLOSE-SUATRN-CURSOR   '                           05190018
046600                                 TO PV-ABEND-PARAGRAPH.           05200018
046700     EXEC SQL                                                     05210018
046800         CLOSE SUATRN-CSR                                         05220018
046900     END-EXEC.                                                    05230018
047000     EVALUATE TRUE                                                05240018
      * SND 10/2009  DATA CONTENTION CHANGES START                      05250018
047100*        WHEN SQLCODE = -904                                      05260018
047200*        WHEN SQLCODE = -911                                      05270018
047300*            CONTINUE                                             05280018
      * SND 10/2009  DATA CONTENTION CHANGES END                        05290018
047400         WHEN SQLWARN0 NOT = SPACES                               05300018
047500         WHEN SQLCODE < ZERO                                      05310018
047600         WHEN SQLCODE > ZERO                                      05320018
047700             MOVE '2400-CLOSE-CURSOR '                            05330018
047800                             TO PV-PARAGRAPH-NAME                 05340018
047900             MOVE 'CLOSE THE SUATRN_CURSOR        '               05350018
048000                             TO PV-DB2-OPERATION-ATTEMPTED        05360018
048100             PERFORM 9100-SQL-ABEND                               05370018
048200          WHEN SQLCODE = ZERO                                     05380018
048300              CONTINUE                                            05390018
048400     END-EVALUATE.                                                05400018
048500*                                                                 05410018
048600 3000-PROCESS-PKSLIP.                                             05420018
048700     SET PS-NOT-END-OF-PKSLIP-CURSOR TO TRUE                      05430018
048800     PERFORM 3100-OPEN-PKSLIP-CURSOR.                             05440018
048900     PERFORM 3200-FETCH-PKSLIP-CURSOR.                            05450018
049000     PERFORM 3300-PROCESS-PKSLIP-CURSOR                           05460018
049100         UNTIL PS-END-OF-PKSLIP-CURSOR.                           05470018
049200     PERFORM 3400-CLOSE-PKSLIP-CURSOR.                            05480018
049300 3100-OPEN-PKSLIP-CURSOR.                                         05490018
049400     MOVE '3100-OPEN-PKSLIP-CURSOR   '                            05500018
049500                                 TO PV-ABEND-PARAGRAPH.           05510018
049600     EXEC SQL                                                     05520018
049700         OPEN PKSLIP-CSR                                          05530018
049800     END-EXEC.                                                    05540018
049900     EVALUATE TRUE                                                05550018
050000         WHEN SQLWARN0 NOT = SPACES                               05560018
050100         WHEN SQLCODE < ZERO                                      05570018
050200         WHEN SQLCODE > ZERO                                      05580018
050300             MOVE '3100-OPEN-PKSLIP-CURSOR           '            05590018
050400                             TO PV-PARAGRAPH-NAME                 05600018
050500             MOVE 'OPEN THE PKSLIP_CURSOR           '             05610018
050600                             TO PV-DB2-OPERATION-ATTEMPTED        05620018
050700             DISPLAY 'PO NBR:      ' SUATRN-TRN-NBR               05630018
050800             DISPLAY 'REC SEQ NBR: ' SUATRN-REC-SEQ-NBR           05640018
050900             PERFORM 9100-SQL-ABEND                               05650018
051000         WHEN SQLCODE = ZEROS                                     05660018
051100             CONTINUE                                             05670018
051200     END-EVALUATE.                                                05680018
051300                                                                  05690018
051400 3200-FETCH-PKSLIP-CURSOR.                                        05700018
051500     MOVE '3200-FETCH-PKSLIP-CURSOR   '                           05710018
051600                                 TO PV-ABEND-PARAGRAPH.           05720018
051700     EXEC SQL                                                     05730018
051800          FETCH PKSLIP-CSR                                        05740018
051900          INTO  :PKSLIP-PO-NBR                                    05750018
052000              , :PKSLIP-SEQ-NBR                                   05760018
052100     END-EXEC.                                                    05770018
052200                                                                  05780018
052300     EVALUATE TRUE                                                05790018
052400       WHEN SQLCODE = ZEROS                                       05800018
052500         CONTINUE                                                 05810018
052600       WHEN SQLCODE = +100                                        05820018
052700           SET PS-END-OF-PKSLIP-CURSOR TO TRUE                    05830018
052800       WHEN SQLWARN0 NOT = SPACES                                 05840018
052900       WHEN SQLCODE < ZERO                                        05850018
053000       WHEN SQLCODE > ZERO                                        05860018
053100           MOVE '3200-FETCH-PKSLIP-CURSOR  '                      05870018
053200                               TO PV-PARAGRAPH-NAME               05880018
053300           MOVE 'FETCH PKSLIP CURSOR   '                          05890018
053400                               TO PV-DB2-OPERATION-ATTEMPTED      05900018
053500           PERFORM 9100-SQL-ABEND                                 05910018
053600     END-EVALUATE.                                                05920018
053700                                                                  05930018
053800 3300-PROCESS-PKSLIP-CURSOR.                                      05940018
053900     PERFORM 4000-PROCESS-INPKSU                                  05950018
054000     PERFORM 3200-FETCH-PKSLIP-CURSOR.                            05960018
054100                                                                  05970018
054200 3400-CLOSE-PKSLIP-CURSOR.                                        05980018
054300     MOVE '3400-CLOSE-PKSLIP-CURSOR   '                           05990018
054400                                 TO PV-ABEND-PARAGRAPH.           06000018
054500     EXEC SQL                                                     06010018
054600         CLOSE PKSLIP-CSR                                         06020018
054700     END-EXEC.                                                    06030018
054800     EVALUATE TRUE                                                06040018
      * SND 10/2009  DATA CONTENTION CHANGES START                      06050018
054900*        WHEN SQLCODE = -904                                      06060018
055000*        WHEN SQLCODE = -911                                      06070018
055100*            CONTINUE                                             06080018
      * SND 10/2009  DATA CONTENTION CHANGES END                        06090018
055200         WHEN SQLWARN0 NOT = SPACES                               06100018
055300         WHEN SQLCODE < ZERO                                      06110018
055400         WHEN SQLCODE > ZERO                                      06120018
055500             MOVE '3400-CLOSE-CURSOR '                            06130018
055600                             TO PV-PARAGRAPH-NAME                 06140018
055700             MOVE 'CLOSE THE PKSLIP_CURSOR          '             06150018
055800                             TO PV-DB2-OPERATION-ATTEMPTED        06160018
055900             PERFORM 9100-SQL-ABEND                               06170018
056000          WHEN SQLCODE = ZERO                                     06180018
056100              CONTINUE                                            06190018
056200       WHEN SQLCODE = ZEROS                                       06200018
056300         CONTINUE                                                 06210018
056400     END-EVALUATE.                                                06220018
056500                                                                  06230018
056600 3500-CALL-XLKUT001.                                              06240018
056700                                                                  06250018
056800     MOVE '3500-CALL-XLKUT001'   TO PV-ABEND-PARAGRAPH.           06260018
056900     MOVE 'CALL XLUT0001'        TO PV-DB2-OPERATION-ATTEMPTED.   06270018
057000                                                                  06280018
057100                                                                  06290018
057300     SET XL001-SELECT-SKU                                         06300018
057400         XL001-SELECT-VND-STYL                                    06310018
057500         XL001-BY-UPC-NBR             TO TRUE.                    06320018
057600                                                                  06330018
057620                                                                  06340018
057630     CALL XL001-VSM-PGM USING XL001-ITEM-COMMAREA.                06350018
057640                                                                  06360018
057650     EVALUATE TRUE                                                06370018
057660         WHEN XL001-SUCCESSFUL                                    06380018
057670         WHEN XL001-SKU-NOT-FOUND                                 06390018
057670         WHEN XL001-UPC-NOT-FOUND                                 06400018
057670         WHEN XL001-VND-STYL-NOT-FOUND                            06410018
057680             CONTINUE                                             06420018
057690         WHEN XL001-SQL-ERROR                                     06430018
057700         WHEN XL001-INVALID-ACCESS                                06440018
057701             PERFORM 9200-XL-ABEND                                06450018
057702         WHEN OTHER                                               06460018
057703             PERFORM 9200-XL-ABEND                                06470018
057704     END-EVALUATE.                                                06480018
057705                                                                  06490018
057706                                                                  06500018
057707                                                                  06510018
057708 4000-PROCESS-INPKSU.                                             06520018
057709     SET PS-NOT-END-OF-INPKSU-CURSOR TO TRUE                      06530018
057710     PERFORM 4100-OPEN-INPKSU-CURSOR.                             06540018
057720     PERFORM 4200-FETCH-INPKSU-CURSOR.                            06550018
057730     PERFORM 4300-PROCESS-INPKSU-CURSOR                           06560018
057740         UNTIL PS-END-OF-INPKSU-CURSOR.                           06570018
057750     PERFORM 4400-CLOSE-INPKSU-CURSOR.                            06580018
057760 4100-OPEN-INPKSU-CURSOR.                                         06590018
057770     MOVE '4100-OPEN-INPKSU-CURSOR   '                            06600018
057780                                 TO PV-ABEND-PARAGRAPH.           06610018
057790     EXEC SQL                                                     06620018
057800         OPEN INPKSU-CSR                                          06630018
057900     END-EXEC.                                                    06640018
058000     EVALUATE TRUE                                                06650018
058100         WHEN SQLCODE = ZEROS                                     06660018
058200            CONTINUE                                              06670018
058300         WHEN SQLWARN0 NOT = SPACES                               06680018
058400         WHEN SQLCODE < ZERO                                      06690018
058500         WHEN SQLCODE > ZERO                                      06700018
058600             MOVE '4100-OPEN-INPKSU-CURSOR           '            06710018
058700                             TO PV-PARAGRAPH-NAME                 06720018
058800             MOVE 'OPEN THE INPKSU_CURSOR           '             06730018
058900                             TO PV-DB2-OPERATION-ATTEMPTED        06740018
059000             DISPLAY 'PO NBR:    ' SUATRN-TRN-NBR                 06750018
059100             DISPLAY 'SEQ NBR:   ' PKSLIP-SEQ-NBR                 06760018
059200             PERFORM 9100-SQL-ABEND                               06770018
059300     END-EVALUATE.                                                06780018
059400                                                                  06790018
059500 4200-FETCH-INPKSU-CURSOR.                                        06800018
059600     MOVE '4200-FETCH-INPKSU-CURSOR   '                           06810018
059700                                 TO PV-ABEND-PARAGRAPH.           06820018
059800     EXEC SQL                                                     06830018
059900          FETCH INPKSU-CSR                                        06840018
060000          INTO  :INPKSU-SHIPT-UNT-ID                              06850018
060100     END-EXEC.                                                    06860018
060200                                                                  06870018
060300     EVALUATE TRUE                                                06880018
060400       WHEN SQLCODE = ZEROS                                       06890018
060500          MOVE INPKSU-SHIPT-UNT-ID TO                             06900018
060600                             DK-SHIPT-UNT-ID                      06910018
060700       WHEN SQLCODE = +100                                        06920018
060800           SET PS-END-OF-INPKSU-CURSOR TO TRUE                    06930018
060900       WHEN SQLWARN0 NOT = SPACES                                 06940018
061000       WHEN SQLCODE < ZERO                                        06950018
061100       WHEN SQLCODE > ZERO                                        06960018
061200           MOVE '4200-FETCH-INPKSU-CURSOR  '                      06970018
061300                               TO PV-PARAGRAPH-NAME               06980018
061400           MOVE 'FETCH PKSLIP CURSOR   '                          06990018
061500                               TO PV-DB2-OPERATION-ATTEMPTED      07000018
061600           PERFORM 9100-SQL-ABEND                                 07010018
061700     END-EVALUATE.                                                07020018
061800                                                                  07030018
061900                                                                  07040018
062000 4300-PROCESS-INPKSU-CURSOR.                                      07050018
062100     PERFORM 5000-PROCESS-SHUUPC                                  07060018
062200     PERFORM 4200-FETCH-INPKSU-CURSOR.                            07070018
062300                                                                  07080018
062400                                                                  07090018
062500 4400-CLOSE-INPKSU-CURSOR.                                        07100018
062600     MOVE '4400-CLOSE-INPKSU-CURSOR   '                           07110018
062700                                 TO PV-ABEND-PARAGRAPH.           07120018
062800     EXEC SQL                                                     07130018
062900         CLOSE INPKSU-CSR                                         07140018
063000     END-EXEC.                                                    07150018
063100     EVALUATE TRUE                                                07160018
      * SND 10/2009  DATA CONTENTION CHANGES START                      07170018
063200*        WHEN SQLCODE = -904                                      07180018
063300*        WHEN SQLCODE = -911                                      07190018
063400*            CONTINUE                                             07200018
      * SND 10/2009  DATA CONTENTION CHANGES END                        07210018
063500         WHEN SQLWARN0 NOT = SPACES                               07220018
063600         WHEN SQLCODE < ZERO                                      07230018
063700         WHEN SQLCODE > ZERO                                      07240018
063800             MOVE '4400-CLOSE-CURSOR '                            07250018
063900                             TO PV-PARAGRAPH-NAME                 07260018
064000             MOVE 'CLOSE THE INPKSU_CURSOR          '             07270018
064100                             TO PV-DB2-OPERATION-ATTEMPTED        07280018
064200             PERFORM 9100-SQL-ABEND                               07290018
064300          WHEN SQLCODE = ZERO                                     07300018
064400              CONTINUE                                            07310018
064500       WHEN SQLCODE = ZEROS                                       07320018
064600         CONTINUE                                                 07330018
064700     END-EVALUATE.                                                07340018
064800                                                                  07350018
064900 5000-PROCESS-SHUUPC.                                             07360018
065000     SET PS-NO-PROCESS-EXPECT-TABLE  TO TRUE.                     07370018
065100     SET PS-NOT-END-OF-SHUUPC-CURSOR TO TRUE.                     07380018
065200     PERFORM 7300-BUILD-AUDIT-TABLE.                              07390018
065300     PERFORM 5100-OPEN-SHUUPC-CURSOR.                             07400018
065400     PERFORM 5200-FETCH-SHUUPC-CURSOR.                            07410018
065500     PERFORM 5300-PROCESS-SHUUPC-CURSOR                           07420018
065600         UNTIL PS-END-OF-SHUUPC-CURSOR.                           07430018
065700     PERFORM 5400-CLOSE-SHUUPC-CURSOR.                            07440018
065800                                                                  07450018
065900* THE FOLLOWING LOGIC WILL BE USED TO DETERMINE IF THERE ARE UPC'S07460018
066000* WHICH WERE NOT MATCHED FROM THE TSHUUPC TABLE TO WHAT WAS       07470018
066100* AUDITED.  IF THERE ARE UPC'S WHICH WERE NOT MATCHED BY UPC      07480018
066200* NUMBER, THE FOLLOWING PROCESS WILL PERFORM LOGIC TO ATTEMPT A   07490018
066300* MATCH BY SKU NUMBER.  IF A MATCH BY SKU NUMBER IS FOUND, THE    07500018
066400* VENDOR CARTON RECORD WILL BE WRITTEN WITH THE AUDITED UPC       07510018
066500* NUMBER.  IF THERE IS NO MATCH BY SKU NUMBER, THEN THE VENDOR    07520018
066600* CARTON RECORD WILL BE WRITTEN WITH THE EXPECTED UPC NUMBER.     07530018
066700                                                                  07540018
066800     IF  PS-PROCESS-EXPECT-TABLE                                  07550018
066900         SET PS-EXPECT-NOT-COMPLETE TO TRUE                       07560018
067000         PERFORM 7600-SEARCH-EXPECT-TABLE                         07570018
067100             VARYING CUE-INDX FROM 1 BY 1                         07580018
067200                 UNTIL CUE-INDX >= CUE-MAX-INDX                   07590018
067300     END-IF.                                                      07600018
067400                                                                  07610018
067500 5100-OPEN-SHUUPC-CURSOR.                                         07620018
067600     MOVE '5100-OPEN-SHUUPC-CURSOR   '                            07630018
067700                                 TO PV-ABEND-PARAGRAPH.           07640018
067800     EXEC SQL                                                     07650018
067900         OPEN SHUUPC-CSR                                          07660018
068000     END-EXEC.                                                    07670018
068100     EVALUATE TRUE                                                07680018
068200         WHEN SQLCODE = ZEROS                                     07690018
068300            CONTINUE                                              07700018
068400         WHEN SQLWARN0 NOT = SPACES                               07710018
068500         WHEN SQLCODE < ZERO                                      07720018
068600         WHEN SQLCODE > ZERO                                      07730018
068700             MOVE '5100-OPEN-SHUUPC-CURSOR           '            07740018
068800                             TO PV-PARAGRAPH-NAME                 07750018
068900             MOVE 'OPEN THE SHUUPC-CSR              '             07760018
069000                             TO PV-DB2-OPERATION-ATTEMPTED        07770018
069100             DISPLAY 'SHIPT UNIT ID: ' DK-SHIPT-UNT-ID            07780018
069200             PERFORM 9100-SQL-ABEND                               07790018
069300     END-EVALUATE.                                                07800018
069400                                                                  07810018
069500 5200-FETCH-SHUUPC-CURSOR.                                        07820018
069600     MOVE '5200-FETCH-SHUUPC-CURSOR   '                           07830018
069700                                 TO PV-ABEND-PARAGRAPH.           07840018
069800     EXEC SQL                                                     07850018
069900          FETCH SHUUPC-CSR                                        07860018
070000          INTO  :SHUUPC-UPC-NBR                                   07870018
070100               ,:SHUUPC-SHPD-QTY                                  07880018
070200               ,:SHUUPC-TRN-NBR                                   07890018
070300               ,:SHPUNT-DEST-OPER-UNT-ID                          07900018
070620     END-EXEC.                                                    07910018
070630                                                                  07920018
070640     EVALUATE TRUE                                                07930018
070650       WHEN SQLCODE = ZEROS                                       07940018
070660         CONTINUE                                                 07950018
070670       WHEN SQLCODE = +100                                        07960018
070680           SET PS-END-OF-SHUUPC-CURSOR TO TRUE                    07970018
070690       WHEN SQLWARN0 NOT = SPACES                                 07980018
070700       WHEN SQLCODE < ZERO                                        07990018
070800       WHEN SQLCODE > ZERO                                        08000018
070900           MOVE '5200-FETCH-SHUUPC-CURSOR  '                      08010018
071000                               TO PV-PARAGRAPH-NAME               08020018
071100           MOVE 'FETCH SHUUPC CURSOR   '                          08030018
071200                               TO PV-DB2-OPERATION-ATTEMPTED      08040018
071300           PERFORM 9100-SQL-ABEND                                 08050018
071400     END-EVALUATE.                                                08060018
071500                                                                  08070018
071600                                                                  08080018
071700 5300-PROCESS-SHUUPC-CURSOR.                                      08090018
071800     INITIALIZE SU003-EXTRACT-RECORD.                             08100018
071900     MOVE DK-AUD-CNTL-NBR           TO SU003-AUD-CNTL-NBR.        08110018
072000     MOVE INPKSU-SHIPT-UNT-ID       TO SU003-SHIPT-UNT-ID.        08120018
072100                                                                  08130018
072200     MOVE SHUUPC-UPC-NBR            TO DK-UPC-NBR                 08140018
072300                                       SU003-UPC.                 08150018
073200     MOVE +1                        TO SU003-QTY-EXP.             08160018
073300     MOVE +0                        TO SU003-QTY-AUD              08170018
073400                                       SU003-PICK-ERR-CNT         08180018
073500                                       SU003-TOT-ERR-QTY          08190018
073600                                       SU003-UNT-ERR-CNT-COMBO.   08200018
073700     MOVE '9999-09-09-09.09.09.999999'                            08210018
073800                                    TO SU003-SCN-TMST.            08220018
073900     MOVE SUATRN-TRN-NBR            TO SU003-PO-NBR.              08230018
074000     MOVE SUATRN-REC-SEQ-NBR        TO SU003-REC-SEQ-NBR.         08240018
074100     MOVE SHPUNT-DEST-OPER-UNT-ID   TO SU003-DEST-OPER-UNT-ID.    08250018
074200     MOVE SUNAUD-OPER-UNT-ID        TO SU003-AUD-OPER-UNT-ID.     08260018
074300                                                                  08270018
074400     IF RECEIV-PACK-BY-ST-IND = 'Y'                               08280018
074500         SET SU003-PBS-ORDER           TO TRUE                    08290018
074600     ELSE                                                         08300018
074700         SET SU003-CASEPACK-ORDER      TO TRUE                    08310018
074800     END-IF                                                       08320018
074900                                                                  08330018
075000     SET PS-PROCESS-NOT-COMPLETE TO TRUE.                         08340018
075100                                                                  08350018
075200     PERFORM 5310-CHECK-AUDIT-UPC-TABLE                           08360018
075300         UNTIL PS-PROCESS-COMPLETE.                               08370018
075400                                                                  08380018
075500     PERFORM 5200-FETCH-SHUUPC-CURSOR.                            08390018
075600                                                                  08400018
075700                                                                  08410018
075800* THE NEXT 2 PARAGRAPHS WILL TAKE THE UPC NUMBER FROM THE TSHUUPC 08420018
075900* TABLE AND ATTEMPT TO FIND THE SAME UPC WITHIN THE INTERNAL TABLE08430018
076000* WHICH WAS LOADED WITH THE UPC'S WHICH WERE SCANNED DURING THE   08440018
076100* AUDIT PROCESS.                                                  08450018
076200* IF A MATCH IS FOUND, THE VENDOR CARTON RECORD WILL BE WRITTEN.  08460018
076300* IF A MATCH IS NOT FOUND, THE EXPECTED UPC AND ITS SKU WILL BE   08470018
076400* WRITTEN TO THE INTERNAL EXPECTED UPC TABLE AND WILL BE PROCESSED08480018
076500* LATER BY A SKU MATCH.                                           08490018
076600                                                                  08500018
076700 5310-CHECK-AUDIT-UPC-TABLE.                                      08510018
076800                                                                  08520018
076900     MOVE SHUUPC-SHPD-QTY TO PV-HOLD-SHPD-QTY.                    08530018
077000                                                                  08540018
077100     PERFORM 5320-SEARCH-UPC-TABLE                                08550018
077200         VARYING CUA-INDX FROM 1 BY 1                             08560018
077300             UNTIL PS-PROCESS-COMPLETE.                           08570018
077400                                                                  08580018
077500                                                                  08590018
077600 5320-SEARCH-UPC-TABLE.                                           08600018
077700*                                                                 08610018
077800*    MOVE SHUUPC-UPC-NBR TO DF-UPC-NBR.                           08620018
077900*    DISPLAY '5320-SHUUPC IS:  ' DF-UPC-NBR.                      08630018
078000*    MOVE CUA-UPC-NBR (CUA-INDX) TO DF-UPC-NBR.                   08640018
078100*    DISPLAY '5320-CUA UPC IS: ' DF-UPC-NBR.                      08650018
078200*    DISPLAY '     PROCESS CODE IS: ' CUA-PROCESS-IND (CUA-INDX). 08660018
078300*    MOVE PV-HOLD-SHPD-QTY TO DF-SHPD-QTY.                        08670018
078400*    DISPLAY '5320-SHPD QTY IS: ' DF-SHPD-QTY.                    08680018
078500                                                                  08690018
078600     IF  PS-CARTON-AUDIT-DATA                                     08700018
078700         IF  CUA-UPC-NBR (CUA-INDX) > SHUUPC-UPC-NBR              08710018
078800         OR  CUA-INDX > CUA-MAX-INDX                              08720018
078801             INITIALIZE XL001-ITEM-COMMAREA                       08730018
078802             MOVE SHUUPC-UPC-NBR              TO XL001-KEY-UPC-NBR08740018
078810             PERFORM 3500-CALL-XLKUT001                           08750018
078900             MOVE SHUUPC-UPC-NBR TO CUE-UPC-NBR (CUE-INDX)        08760018
079100             MOVE XL001-DEPT-NBR-3CH    TO PV-FSN-DEPT-NBR        08770018
079300             MOVE XL001-SUB-CL-NBR-2CH  TO PV-FSN-CLASS-NBR       08780018
079400             MOVE XL001-SKU-NBR         TO PV-FSN-SKU-NMBR        08790018
079500             MOVE XL001-INTR-UPC-ID TO                            08800018
079600                   CUE-INTR-UPC-ID (CUE-INDX)                     08810018
079700             MOVE PV-FORMAT-SKU-NBR   TO                          08820018
079800                  CUE-SKU-NBR (CUE-INDX)                          08830018
079900             MOVE PV-HOLD-SHPD-QTY TO                             08840018
080000                  CUE-EXPECT-QTY (CUE-INDX)                       08850018
080100             MOVE ZERO TO PV-HOLD-SHPD-QTY                        08860018
080200             SET PS-PROCESS-EXPECT-TABLE TO TRUE                  08870018
080300             SET CUE-INDX     UP BY 1                             08880018
080400             SET CUE-MAX-INDX UP BY 1                             08890018
080500         ELSE                                                     08900018
080600             IF  SHUUPC-UPC-NBR = CUA-UPC-NBR (CUA-INDX)          08910018
080700                 IF  CUA-PROCESSED (CUA-INDX)                     08920018
080800                     NEXT SENTENCE                                08930018
080900                 ELSE                                             08940018
081000                     MOVE CUA-UPC-NBR (CUA-INDX)    TO DK-UPC-NBR 08950018
081100                                                       SU003-UPC  08960018
081200                     MOVE CUA-SKU-NBR (CUA-INDX)                  08970018
081210                                              TO SU003-SKU-NBR    08980018
081300                     MOVE CUA-INTR-UPC-ID (CUA-INDX)              08990018
081310                                              TO SU003-INTR-UPC-ID09000018
081400                     SET CUA-PROCESSED (CUA-INDX) TO TRUE         09010018
081500                     PERFORM 8000-WRITE-VENDOR-EXTRACT-REC        09020018
081600                     SUBTRACT 1 FROM PV-HOLD-SHPD-QTY             09030018
081700             ELSE                                                 09040018
081800                 NEXT SENTENCE                                    09050018
081900     ELSE                                                         09060018
082000         MOVE SHUUPC-UPC-NBR            TO DK-UPC-NBR             09070018
082100                                           SU003-UPC              09080018
082101         INITIALIZE XL001-ITEM-COMMAREA                           09090018
082102         MOVE SHUUPC-UPC-NBR            TO XL001-KEY-UPC-NBR      09100018
082110         PERFORM 3500-CALL-XLKUT001                               09110018
082120         MOVE XL001-INTR-UPC-ID         TO SU003-INTR-UPC-ID      09120018
082130                                                                  09130018
082140         MOVE XL001-DEPT-NBR-3CH        TO SU003-SKU-DEPT-NBR     09140018
082150         MOVE XL001-SUB-CL-NBR-2CH      TO SU003-SKU-CL-NBR       09150018
082160         MOVE XL001-SKU-NBR             TO SU003-SKU-NMBR         09160018
082170         INSPECT SU003-SKU-NBR REPLACING ALL SPACES BY ZEROES     09170018
082200         MOVE XL001-INTR-UPC-ID TO SU003-INTR-UPC-ID              09180018
082300         PERFORM 8000-WRITE-VENDOR-EXTRACT-REC                    09190018
082400             VARYING PV-WRITE-COUNT FROM 1 BY 1                   09200018
082500             UNTIL   PV-WRITE-COUNT > PV-HOLD-SHPD-QTY            09210018
082600         MOVE ZERO TO PV-HOLD-SHPD-QTY.                           09220018
082700                                                                  09230018
082800     IF  PV-HOLD-SHPD-QTY = ZERO                                  09240018
082900         SET  PS-PROCESS-COMPLETE TO TRUE                         09250018
083000     END-IF.                                                      09260018
083100                                                                  09270018
083200                                                                  09280018
083300 5400-CLOSE-SHUUPC-CURSOR.                                        09290018
083400     MOVE '5400-CLOSE-INPKSU-CURSOR   '                           09300018
083500                                 TO PV-ABEND-PARAGRAPH.           09310018
083600     EXEC SQL                                                     09320018
083700         CLOSE SHUUPC-CSR                                         09330018
083800     END-EXEC.                                                    09340018
083900     EVALUATE TRUE                                                09350018
      * SND 10/2009  DATA CONTENTION CHANGES START                      09360018
084000*        WHEN SQLCODE = -904                                      09370018
084100*        WHEN SQLCODE = -911                                      09380018
084200*            CONTINUE                                             09390018
      * SND 10/2009  DATA CONTENTION CHANGES END                        09400018
084300         WHEN SQLWARN0 NOT = SPACES                               09410018
084400         WHEN SQLCODE < ZERO                                      09420018
084500         WHEN SQLCODE > ZERO                                      09430018
084600             MOVE '5400-CLOSE-CURSOR '                            09440018
084700                             TO PV-PARAGRAPH-NAME                 09450018
084800             MOVE 'CLOSE THE SHUUPC_CURSOR          '             09460018
084900                             TO PV-DB2-OPERATION-ATTEMPTED        09470018
085000             PERFORM 9100-SQL-ABEND                               09480018
085100          WHEN SQLCODE = ZERO                                     09490018
085200              CONTINUE                                            09500018
085300       WHEN SQLCODE = ZEROS                                       09510018
085400         CONTINUE                                                 09520018
085500     END-EVALUATE.                                                09530018
085600                                                                  09540018
085700 6000-PROCESS-SPOT-CHECKS.                                        09550018
085800     SET PS-NO-PROCESS-EXPECT-TABLE  TO TRUE.                     09560018
085900     SET PS-NOT-END-OF-SHUUPC-CURSOR TO TRUE.                     09570018
086000     PERFORM 7300-BUILD-AUDIT-TABLE.                              09580018
086100     PERFORM 5100-OPEN-SHUUPC-CURSOR.                             09590018
086200     PERFORM 5200-FETCH-SHUUPC-CURSOR.                            09600018
086300     PERFORM 6300-PROCESS-SHUUPC-CURSOR                           09610018
086400         UNTIL PS-END-OF-SHUUPC-CURSOR.                           09620018
086500     PERFORM 5400-CLOSE-SHUUPC-CURSOR.                            09630018
086600                                                                  09640018
086700     IF  PS-PROCESS-EXPECT-TABLE                                  09650018
086800         SET PS-EXPECT-NOT-COMPLETE TO TRUE                       09660018
086900         PERFORM 7600-SEARCH-EXPECT-TABLE                         09670018
087000             VARYING CUE-INDX FROM 1 BY 1                         09680018
087100                 UNTIL CUE-INDX >= CUE-MAX-INDX                   09690018
087200     END-IF.                                                      09700018
087300                                                                  09710018
087400     PERFORM 7100-READ-CARTON-FILE                                09720018
087500         UNTIL                                                    09730018
087600          SU003-SHIPT-UNT-ID NOT = DK-SHIPT-UNT-ID                09740018
087700             OR PS-END-OF-CARTON-FILE.                            09750018
087800     IF PS-END-OF-CARTON-FILE                                     09760018
087900          CONTINUE                                                09770018
088000     ELSE                                                         09780018
088100         MOVE SU003-SHIPT-UNT-ID TO DK-SHIPT-UNT-ID               09790018
088200         MOVE SU003-AUD-CNTL-NBR TO    DK-AUD-CNTL-NBR            09800018
088300     END-IF.                                                      09810018
088400                                                                  09820018
088500 6300-PROCESS-SHUUPC-CURSOR.                                      09830018
088600     PERFORM 6400-PROCESS-SHUUPC-SPOT-CHECK.                      09840018
088700                                                                  09850018
088800 6400-PROCESS-SHUUPC-SPOT-CHECK.                                  09860018
088900     MOVE SHUUPC-UPC-NBR            TO DK-UPC-NBR                 09870018
089000                                       SU003-UPC.                 09880018
089001     INITIALIZE XL001-ITEM-COMMAREA.                              09890018
089002     MOVE SHUUPC-UPC-NBR            TO XL001-KEY-UPC-NBR.         09900018
089010     PERFORM 3500-CALL-XLKUT001.                                  09910018
089100     MOVE XL001-INTR-UPC-ID         TO SU003-INTR-UPC-ID.         09920018
089300     MOVE XL001-DEPT-NBR-3CH        TO SU003-SKU-DEPT-NBR.        09930018
089410     MOVE XL001-SUB-CL-NBR-2CH      TO SU003-SKU-CL-NBR.          09940018
089420     MOVE XL001-SKU-NBR             TO SU003-SKU-NMBR.            09950018
089430     INSPECT SU003-SKU-NBR REPLACING ALL SPACES BY ZEROES         09960018
089440     MOVE +1                        TO SU003-QTY-EXP.             09970018
089450     MOVE +0                        TO SU003-QTY-AUD              09980018
089460                                       SU003-PICK-ERR-CNT         09990018
089470                                       SU003-TOT-ERR-QTY          10000018
089480                                       SU003-UNT-ERR-CNT-COMBO.   10010018
089490     MOVE '9999-09-09-09.09.09.999999'                            10020018
089500                                    TO SU003-SCN-TMST.            10030018
089600     MOVE SHPUNT-DEST-OPER-UNT-ID   TO SU003-DEST-OPER-UNT-ID.    10040018
089700     MOVE SUNAUD-OPER-UNT-ID        TO SU003-AUD-OPER-UNT-ID.     10050018
089800                                                                  10060018
089900*NOTE:  THIS CODE IS COMMENTED OUT BECAUSE THE TYPE (PBS OR BULK) 10070018
090000*       IS ALREADY SET ON THE INPUT FILE                          10080018
090100*                                                                 10090018
090200*    FOR EACH UNIQUE PO NUMBER, CHECK THE PO AGREEMENT TABLE TO   10100018
090300*    DETERMINE IF IT WAS A PACK-BY-STORE OR BULK ORDER            10110018
090400*    IF SHUUPC-TRN-NBR   = PV-HOLD-PO-NBR                         10120018
090500*        CONTINUE                                                 10130018
090600*    ELSE                                                         10140018
090700*        MOVE SHUUPC-TRN-NBR           TO DK-PO-NBR               10150018
090800*                                         PV-HOLD-PO-NBR          10160018
090900*        PERFORM 2310-GET-ORDER-TYPE                              10170018
091000*    END-IF.                                                      10180018
091100*                                                                 10190018
091200*    IF RECEIV-PACK-BY-ST-IND = 'Y'                               10200018
091300*        SET SU003-PBS-ORDER           TO TRUE                    10210018
091400*    ELSE                                                         10220018
091500*        SET SU003-CASEPACK-ORDER      TO TRUE                    10230018
091600*    END-IF.                                                      10240018
091700                                                                  10250018
091800     SET PS-PROCESS-NOT-COMPLETE TO TRUE.                         10260018
091900                                                                  10270018
092000     PERFORM 5310-CHECK-AUDIT-UPC-TABLE                           10280018
092100         UNTIL PS-PROCESS-COMPLETE.                               10290018
092200                                                                  10300018
092300     PERFORM 5200-FETCH-SHUUPC-CURSOR.                            10310018
092400                                                                  10320018
092500*                                                                 10330018
092600 6500-SELECT-TSUNAUD.                                             10340018
092700******************************************************************10350018
092800**  SELECT INFORMATION FROM THE SHIPPING UNIT AUDIT TABLE FOR THE 10360018
092900******************************************************************10370018
093000     INITIALIZE DCLTSUNAUD.                                       10380018
093100                                                                  10390018
093200     MOVE '1100-SELECT-TSUNAUD '                                  10400018
093300                                 TO PV-ABEND-PARAGRAPH.           10410018
093400     EXEC SQL                                                     10420018
093500       SELECT  AUD_STRT_TMST                                      10430018
093600              ,AUD_STP_TMST                                       10440018
093700              ,AUD_PSPND_MNIT_QTY                                 10450018
093800              ,AUD_CLO_MNIT_QTY                                   10460018
093900              ,OPER_UNT_ID                                        10470018
094000              ,FCLTY_ID                                           10480018
094100              ,PRC_FCLTY_AREA_ID                                  10490018
094200              ,AUD_STAT_CDE                                       10500018
094300              ,AUD_TYP_CDE                                        10510018
094400         INTO  :SUNAUD-AUD-STRT-TMST                              10520018
094500              ,:SUNAUD-AUD-STP-TMST                               10530018
094600              ,:SUNAUD-AUD-PSPND-MNIT-QTY                         10540018
094700              ,:SUNAUD-AUD-CLO-MNIT-QTY                           10550018
094800              ,:SUNAUD-OPER-UNT-ID                                10560018
094900              ,:SUNAUD-FCLTY-ID                                   10570018
095000              ,:SUNAUD-PRC-FCLTY-AREA-ID                          10580018
095100              ,:SUNAUD-AUD-STAT-CDE                               10590018
095200              ,:SUNAUD-AUD-TYP-CDE                                10600018
095300         FROM  TSUNAUD                                            10610018
095400        WHERE  AUD_CNTL_NBR = :SU003-AUD-CNTL-NBR                 10620018
095500     END-EXEC.                                                    10630018
095600                                                                  10640018
095700     EVALUATE TRUE                                                10650018
095800       WHEN SQLCODE = ZEROS                                       10660018
095900         CONTINUE                                                 10670018
096000       WHEN OTHER                                                 10680018
096100         DISPLAY PV-ABEND-PARAGRAPH                               10690018
096200         DISPLAY 'AUD CONTROL NBR: ' SU003-AUD-CNTL-NBR           10700018
096300         PERFORM 9100-SQL-ABEND                                   10710018
096400     END-EVALUATE.                                                10720018
096500                                                                  10730018
096600                                                                  10740018
096700 7100-READ-CARTON-FILE.                                           10750018
096800******************************************************************10760018
096900                                                                  10770018
097000     READ SU-CARTON-EXTRACT-FILE  INTO SU003-EXTRACT-RECORD       10780018
097100        AT END                                                    10790018
097200           SET PS-END-OF-CARTON-FILE TO TRUE                      10800018
097300        NOT AT END                                                10810018
097400           ADD 1 TO PV-RECS-READ-COUNT                            10820018
097500     END-READ.                                                    10830018
097600                                                                  10840018
097700******************************************************************10850018
097800* THE FOLLOWING PARAGRAPH IS THE DRIVER TO THE PROCESS OF LOADING 10860018
097900* THE UPC'S AUDITED TO THE INTERNAL AUDIT TABLE SO THAT THE       10870018
098000* EXPECTED UPC'S FOR THE CARTON CAN BE MATCHED TO IT BY BOTH UPC  10880018
098100* AND SKU.                                                        10890018
098200******************************************************************10900018
098300                                                                  10910018
098400 7300-BUILD-AUDIT-TABLE.                                          10920018
098500                                                                  10930018
098600     SET PS-NO-CARTON-AUDIT-DATA TO TRUE.                         10940018
098700     SET PS-NOT-END-OF-SUAUPC-CURSOR TO TRUE.                     10950018
098800     PERFORM 7310-INIT-TABLES.                                    10960018
098900     PERFORM 7400-OPEN-SUAUPC-CURSOR.                             10970018
099000     PERFORM 7410-FETCH-SUAUPC-CURSOR.                            10980018
099100     PERFORM 7500-PROCESS-SUAUPC-CURSOR                           10990018
099200         UNTIL PS-END-OF-SUAUPC-CURSOR.                           11000018
099300     PERFORM 7420-CLOSE-SUAUPC-CURSOR.                            11010018
099400*                                                                 11020018
099500     IF  PS-CARTON-AUDIT-DATA                                     11030018
099600         SET CUA-MAX-INDX DOWN BY 1                               11040018
099700*        DISPLAY 'AUDIT TABLE LOADED'                             11050018
099800*        MOVE DK-SHIPT-UNT-ID TO                                  11060018
099900*             DF-SHIPT-UNT-ID                                     11070018
100000*        DISPLAY 'SHIPT UNIT ID: ' DF-SHIPT-UNT-ID                11080018
100100*        MOVE CUA-UPC-NBR (1)        TO DF-UPC-NBR                11090018
100200*        DISPLAY 'AUDIT UPC 1 IN TABLE: ' DF-UPC-NBR              11100018
100300*        MOVE CUA-UPC-NBR (2)        TO DF-UPC-NBR                11110018
100400*        DISPLAY 'AUDIT UPC 2 IN TABLE: ' DF-UPC-NBR              11120018
100500*        PERFORM VARYING CUA-INDX FROM 1 BY 1                     11130018
100600*            UNTIL CUA-INDX > CUA-MAX-INDX                        11140018
100700*            MOVE CUA-UPC-NBR (CUA-INDX) TO DF-UPC-NBR            11150018
100800*            DISPLAY 'AUDIT UPC IN TABLE: ' DF-UPC-NBR            11160018
100900*        END-PERFORM                                              11170018
101000     END-IF.                                                      11180018
101100                                                                  11190018
101200 7310-INIT-TABLES.                                                11200018
101300                                                                  11210018
101400     INITIALIZE CARTON-UPC-AUDIT-TABLE.                           11220018
101500     INITIALIZE CARTON-UPC-EXPECT-TABLE.                          11230018
101600                                                                  11240018
101700     SET CUA-INDX TO 1.                                           11250018
101800     SET CUA-MAX-INDX TO 1.                                       11260018
101900     SET CUE-INDX TO 1.                                           11270018
102000     SET CUE-MAX-INDX TO 1.                                       11280018
102100                                                                  11290018
102200 7400-OPEN-SUAUPC-CURSOR.                                         11300018
102300                                                                  11310018
102400     MOVE '7400-OPEN-SUAUPC-CURSOR   '                            11320018
102500                                 TO PV-ABEND-PARAGRAPH.           11330018
102600     EXEC SQL                                                     11340018
102700         OPEN SUAUPC-CSR                                          11350018
102800     END-EXEC.                                                    11360018
102900                                                                  11370018
103000     EVALUATE TRUE                                                11380018
103100         WHEN SQLCODE = ZEROS                                     11390018
103200           CONTINUE                                               11400018
103300         WHEN SQLWARN0 NOT = SPACES                               11410018
103400         WHEN SQLCODE < ZERO                                      11420018
103500         WHEN SQLCODE > ZERO                                      11430018
103600             MOVE '7400-OPEN-SUAUPC-CURSOR           '            11440018
103700                             TO PV-PARAGRAPH-NAME                 11450018
103800             MOVE 'OPEN THE SUAUPC_CURSOR           '             11460018
103900                             TO PV-DB2-OPERATION-ATTEMPTED        11470018
104000             DISPLAY 'SHIPT UNIT ID: ' DK-SHIPT-UNT-ID            11480018
104100             PERFORM 9100-SQL-ABEND                               11490018
104200     END-EVALUATE.                                                11500018
104300                                                                  11510018
104400                                                                  11520018
104500 7410-FETCH-SUAUPC-CURSOR.                                        11530018
104600                                                                  11540018
104700     MOVE '7410-FETCH-SUAUPC-CURSOR   '                           11550018
104800                                 TO PV-ABEND-PARAGRAPH.           11560018
104900                                                                  11570018
105000*    DISPLAY 'ENTERED INTO 7410-FETCH-SUAUPC-CURSOR'.             11580018
105100                                                                  11590018
105200     EXEC SQL                                                     11600018
105300          FETCH SUAUPC-CSR                                        11610018
105400          INTO  :SUAUPC-UPC-NBR                                   11620018
105500               ,:SUAUPC-SKU-NBR                                   11630018
105600               ,:SUAUPC-SCN-TMST                                  11640018
105700     END-EXEC.                                                    11650018
105800                                                                  11660018
105900     EVALUATE TRUE                                                11670018
106000       WHEN SQLCODE = ZEROS                                       11680018
106100           SET PS-CARTON-AUDIT-DATA TO TRUE                       11690018
106200*          DISPLAY 'FETCH OK IN 7410-FETCH-SUAUPC-CURSOR'         11700018
106300       WHEN SQLCODE = +100                                        11710018
106400           SET PS-END-OF-SUAUPC-CURSOR TO TRUE                    11720018
106500       WHEN SQLWARN0 NOT = SPACES                                 11730018
106600       WHEN SQLCODE < ZERO                                        11740018
106700       WHEN SQLCODE > ZERO                                        11750018
106800           MOVE '7410-FETCH-SUAUPC-CURSOR  '                      11760018
106900                               TO PV-PARAGRAPH-NAME               11770018
107000           MOVE 'FETCH SUAUPC CURSOR   '                          11780018
107100                               TO PV-DB2-OPERATION-ATTEMPTED      11790018
107200           DISPLAY 'SHIPT UNIT ID: ' DK-SHIPT-UNT-ID              11800018
107300           PERFORM 9100-SQL-ABEND                                 11810018
107400     END-EVALUATE.                                                11820018
107500                                                                  11830018
107600 7420-CLOSE-SUAUPC-CURSOR.                                        11840018
107700                                                                  11850018
107800     MOVE '7420-CLOSE-SUAUPC-CURSOR   '                           11860018
107900                                 TO PV-ABEND-PARAGRAPH.           11870018
108000     EXEC SQL                                                     11880018
108100         CLOSE SUAUPC-CSR                                         11890018
108200     END-EXEC.                                                    11900018
108300     EVALUATE TRUE                                                11910018
      * SND 10/2009  DATA CONTENTION CHANGES START                      11920018
108400*        WHEN SQLCODE = -904                                      11930018
108500*        WHEN SQLCODE = -911                                      11940018
108600*            CONTINUE                                             11950018
      * SND 10/2009  DATA CONTENTION CHANGES END                        11960018
108700         WHEN SQLWARN0 NOT = SPACES                               11970018
108800         WHEN SQLCODE < ZERO                                      11980018
108900         WHEN SQLCODE > ZERO                                      11990018
109000             MOVE '7420-CLOSE-CURSOR '                            12000018
109100                             TO PV-PARAGRAPH-NAME                 12010018
109200             MOVE 'CLOSE THE SUAUPC_CURSOR          '             12020018
109300                             TO PV-DB2-OPERATION-ATTEMPTED        12030018
109400             PERFORM 9100-SQL-ABEND                               12040018
109500          WHEN SQLCODE = ZERO                                     12050018
109600              CONTINUE                                            12060018
109700       WHEN SQLCODE = ZEROS                                       12070018
109800         CONTINUE                                                 12080018
109900     END-EVALUATE.                                                12090018
110000                                                                  12100018
110100 7500-PROCESS-SUAUPC-CURSOR.                                      12110018
110200                                                                  12120018
110300*    DISPLAY 'ENTERED INTO 7500-PROCESS-SUAUPC-CURSOR'.           12130018
110400                                                                  12140018
110500     IF  CUA-INDX > PC-2500                                       12150018
110600         DISPLAY '***********************************'            12160018
110700         DISPLAY 'TABLE OVERFLOW ON   '                           12170018
110800         DISPLAY 'UPC AUDIT TABLE - OVER 2500 OCCURS  '           12180018
110900         DISPLAY 'RUN ABORTED'                                    12190018
111000         DISPLAY '***********************************'            12200018
111100         DISPLAY '                                   '            12210018
111200         MOVE DK-AUD-CNTL-NBR TO DF-DISPLAY-FIELD                 12220018
111300         DISPLAY 'AUDIT NUMBER IS: ' DF-DISPLAY-FIELD             12230018
111400         MOVE DK-SHIPT-UNT-ID TO DF-DISPLAY-FIELD                 12240018
111500         DISPLAY 'CARTON NUMBER IS: ' DF-DISPLAY-FIELD            12250018
111510         SET PS-END-OF-SUAUPC-CURSOR TO TRUE                      12260018
111520         SET CUA-INDX           DOWN BY +1                        12270018
111530         SET CUA-MAX-INDX       DOWN BY +1                        12280018
111600**       MOVE 4001  TO PV-ABEND-CODE                              12290018
111700**       PERFORM 9999-ABORT                                       12300018
111800     ELSE                                                         12310018
111810         INITIALIZE XL001-ITEM-COMMAREA                           12320018
111820         MOVE SUAUPC-UPC-NBR            TO XL001-KEY-UPC-NBR      12330018
111900         PERFORM 3500-CALL-XLKUT001                               12340018
112000                                                                  12350018
112100         MOVE SUAUPC-UPC-NBR      TO CUA-UPC-NBR (CUA-INDX)       12360018
112200         MOVE XL001-DEPT-NBR-3CH  TO PV-FSN-DEPT-NBR              12370018
112300         MOVE XL001-SUB-CL-NBR-2CH TO PV-FSN-CLASS-NBR            12380018
112400         MOVE SUAUPC-SKU-NBR      TO PV-FSN-SKU-NMBR              12390018
112500         MOVE PV-FORMAT-SKU-NBR   TO CUA-SKU-NBR (CUA-INDX)       12400018
112510         MOVE XL001-INTR-UPC-ID   TO CUA-INTR-UPC-ID (CUA-INDX)   12410018
112600         SET  CUA-NOT-PROCESSED (CUA-INDX) TO TRUE                12420018
112700                                                                  12430018
112800         SET CUA-INDX             UP BY +1                        12440018
112900         SET CUA-MAX-INDX         UP BY +1                        12450018
113000                                                                  12460018
113100         PERFORM 7410-FETCH-SUAUPC-CURSOR                         12470018
113110     END-IF.                                                      12480018
113200                                                                  12490018
113300                                                                  12500018
113400 7600-SEARCH-EXPECT-TABLE.                                        12510018
113500                                                                  12520018
113600     SET PS-SKU-MATCH-NOT-COMPLETE TO TRUE                        12530018
113700                                                                  12540018
113800     PERFORM 7610-SEARCH-AUDIT-TABLE                              12550018
113900         VARYING CUA-INDX FROM 1 BY 1                             12560018
114000             UNTIL PS-SKU-MATCH-COMPLETE.                         12570018
114100                                                                  12580018
114200                                                                  12590018
114300 7610-SEARCH-AUDIT-TABLE.                                         12600018
114400                                                                  12610018
114500     IF  CUA-INDX > CUA-MAX-INDX                                  12620018
114600         MOVE CUE-EXPECT-QTY (CUE-INDX) TO                        12630018
114700              PV-HOLD-SHPD-QTY                                    12640018
114800         MOVE CUE-UPC-NBR (CUE-INDX)      TO DK-UPC-NBR           12650018
114900                                             SU003-UPC            12660018
115000         MOVE CUE-INTR-UPC-ID (CUE-INDX) TO SU003-INTR-UPC-ID     12670018
115100         MOVE CUE-SKU-NBR (CUE-INDX) TO                           12680018
115200              SU003-SKU-NBR                                       12690018
115300         INSPECT SU003-SKU-NBR REPLACING ALL SPACES BY ZEROES     12700018
115400         PERFORM 8000-WRITE-VENDOR-EXTRACT-REC                    12710018
115500             VARYING PV-WRITE-COUNT FROM 1 BY 1                   12720018
115600             UNTIL   PV-WRITE-COUNT > PV-HOLD-SHPD-QTY            12730018
115700         MOVE ZERO TO CUE-EXPECT-QTY (CUE-INDX)                   12740018
115800     ELSE                                                         12750018
115900         IF  CUE-SKU-NBR (CUE-INDX) = CUA-SKU-NBR (CUA-INDX)      12760018
116000             IF  CUA-PROCESSED (CUA-INDX)                         12770018
116100                 NEXT SENTENCE                                    12780018
116200             ELSE                                                 12790018
116300                 MOVE CUA-UPC-NBR (CUA-INDX)      TO DK-UPC-NBR   12800018
116400                                                     SU003-UPC    12810018
116500                 MOVE CUA-INTR-UPC-ID (CUA-INDX)                  12820018
116600                                          TO SU003-INTR-UPC-ID    12830018
116700                 MOVE CUA-SKU-NBR (CUA-INDX) TO                   12840018
116800                      SU003-SKU-NBR                               12850018
116900                 INSPECT SU003-SKU-NBR                            12860018
117000                      REPLACING ALL SPACES BY ZEROES              12870018
117100                 PERFORM 8000-WRITE-VENDOR-EXTRACT-REC            12880018
117200                 SUBTRACT 1 FROM CUE-EXPECT-QTY (CUE-INDX)        12890018
117300                 SET CUA-PROCESSED (CUA-INDX) TO TRUE             12900018
117400         ELSE                                                     12910018
117500             NEXT SENTENCE.                                       12920018
117600                                                                  12930018
117700     IF  CUE-EXPECT-QTY (CUE-INDX) = ZERO                         12940018
117800         SET PS-SKU-MATCH-COMPLETE TO TRUE                        12950018
117900     END-IF.                                                      12960018
118000*                                                                 12970018
118100                                                                  12980018
118200 8000-WRITE-VENDOR-EXTRACT-REC.                                   12990018
118300     WRITE SU-VENDOR-EXTRACT-RECORD                               13000018
118400       FROM SU003-EXTRACT-RECORD.                                 13010018
118500     ADD 1 TO PV-RECS-WRITTEN-COUNT.                              13020018
118600*                                                                 13030018
118700 9000-EOJ-ROUTINE.                                                13040018
118800                                                                  13050018
118900                                                                  13060018
119000     CLOSE SU-CARTON-EXTRACT-FILE                                 13070018
119100           SU-VENDOR-EXTRACT-FILE.                                13080018
119200     MOVE PV-RECS-READ-COUNT TO PV-DISP-NBR                       13090018
119300     DISPLAY 'RECORDS READ    = ' PV-DISP-NBR.                    13100018
119400     MOVE PV-RECS-WRITTEN-COUNT TO PV-DISP-NBR                    13110018
119500     DISPLAY 'RECORDS WRITTEN = ' PV-DISP-NBR.                    13120018
119600                                                                  13130018
      * SND 10/2009  DATA CONTENTION CHANGES START                      13140018
119700 9100-SQL-ABEND.                                                  13150018
           IF SQLCODE                  = -904 OR -911 OR -913           13160018
              MOVE +4050               TO RETURN-CODE                   13170018
              STOP RUN                                                  13180018
           ELSE                                                         13190018
              PERFORM 9110-ABEND-PROGRAM                                13200018
           END-IF.                                                      13210018
      *                                                                 13220018
      *9100-EXIT.                                                       13230018
      *                                                                 13240018
       9110-ABEND-PROGRAM.                                              13250018
119800******************************************************************13260018
119900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    13270018
120000*  ERROR OR WARNING CODE OCCURS.                                  13280018
120100******************************************************************13290018
120200     DISPLAY '9100-SQL-ABEND'.                                    13300018
120300     DISPLAY '** ABEND     **'.                                   13310018
120400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        13320018
120500     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              13330018
120600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     13340018
120700                                                                  13350018
120800******************************************************************13360018
120900* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    13370018
121000* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         13380018
121100* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     13390018
121200* FORMAT.                                                         13400018
121300******************************************************************13410018
121400     COPY DPPD004.                                                13420018
121500                                                                  13430018
121600     MOVE +4013                  TO ABEND-CODE.                   13440018
121700     CALL 'ILBOABN0' USING ABEND-CODE.                            13450018
121800                                                                  13460018
121900 9200-XL-ABEND.                                                   13470018
      *                                                                 13480018
           IF SQLCODE                  = -904 OR -911 OR -913           13490018
              MOVE +4050               TO RETURN-CODE                   13500018
              STOP RUN                                                  13510018
           ELSE                                                         13520018
              PERFORM 9210-ABEND-PROGRAM                                13530018
           END-IF.                                                      13540018
      *                                                                 13550018
      *9200-EXIT.                                                       13560018
      *                                                                 13570018
       9210-ABEND-PROGRAM.                                              13580018
122000     DISPLAY '9200-XL-ABEND'.                                     13590018
122100     DISPLAY '** ABEND     **'.                                   13600018
122200     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        13610018
122300     DISPLAY '** PARAGRAPH ** = ' XL001-ERROR-PARAGRAPH-NBR       13620018
122400     DISPLAY '** OPERATION ** =  ERROR INSIDE XLKUT001'.          13630018
122500     MOVE XL001-SQLCA         TO SQLCA                            13640018
122600                                                                  13650018
122610     COPY DPPD004.                                                13660018
122620                                                                  13670018
122630     MOVE +4013                  TO ABEND-CODE.                   13680018
122640     CALL 'ILBOABN0' USING ABEND-CODE.                            13690018
122650                                                                  13700018
      * SND 10/2009  DATA CONTENTION CHANGES END                        13710018
122660 9999-ABORT.                                                      13720018
122670                                                                  13730018
122680      DISPLAY 'PV-ABEND-CODE = ' PV-ABEND-CODE                    13740018
122690      CALL 'ILBOABN0'   USING PV-ABEND-CODE.                      13750018
122700                                                                  13760018
