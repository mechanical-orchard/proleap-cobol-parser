000100*-----------------------*                                         00010055
000200 IDENTIFICATION DIVISION.                                         00020056
000300*-----------------------*                                         00030056
000400 PROGRAM-ID.    VNKCS015.                                         00040056
000500 AUTHOR.        TIM SMITH.                                        00050056
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060056
000700 DATE-WRITTEN.  06-21-93.                                         00070056
000800*----------------------------------------------------------------*00080056
000900*    V015 - ADD/UPDATE VENDOR DEPARTMENTS                        *00090056
001000*                                                                *00100056
001100*    THIS PROGRAM ALLOWS THE USER TO ADD OR UPDATE A             *00110056
001200*    VENDOR DEPARTMENT. VENDOR NAME IS A PROTECTED FIELD.        *00120056
001300*                                                                *00130056
001400*                                                                *00140056
001500*  DATE  05/27/2003                                              *00150059
001600*      CHANGE MADE: VENDOR MULTI PRE-PACK USAGE PROJECT.  ADDED  *00160059
001700*      COMMAREA FIELD, ASC-PO-PREPK-CDE.  ADDED EDI-PO-PREPK-CDE *00170059
001800*      TO CURSOR IN PARAGRAPH 4100.  INCLUDE ASC-PO-PREPK-CDE IN *00180059
001900*      MOVE TO VNWS013 COPYBOOK IN PARAGRAPH 5160.               *00190060
002000*      MADE BY: KEVIN CATLIN            WR/IR #: WR24663         *00200059
002100*                                                                *00210059
002200*  DATE  11/05/2003                                              *00220064
002300*      CHANGE MADE: ADDED CODE TO MOVE THE 4 NEW COLUMNS FROM    *00230064
002400*      TEXTENT (GVRNG_IND, GVRNG_ENT_ID, CART_LBL_IND,           *00240064
002500*      CART_LBL_EFF_DTE) TO THE RMS PO MESSAGING CODE.           *00250064
002600*      MADE BY: MIKE BESKE              WR/IR #: WR25358         *00260064
002700*                                                                *00270064
002800*  DATE  04/12/2004                                              *00280066
002900*      CHANGE MADE: CHANGED SQL ACCESSING TMDSEAR TO INCLUDE     *00290066
003000*      A WHERE CONDITION 'AND CURRENT DATE BETWEEN STRT_DTE AND  *00300066
003100*      END_DTE'.  WITH THE ADDITION OF A THIRD GMM AND ALIGNING  *00310066
003200*      DEPTS ACCORDINGLY, THIS CONDITION IS NEEDED TO PREVENT    *00320066
003300*      MULTIPLE ROWS BEING RETURNED.                             *00330066
003400*      MADE BY: NANCY EILBES            WR/IR #: P000647632      *00340066
003500*                                                                *00350066
003600*  DATE  04/01/2005                                              *00360072
003700*      CHANGE MADE: ADDED 2 NEW MESSAGES, AND LOGIC IN THE RETURN*00370072
003800*      FROM CALLING VNKCS023 TO IDENTIFY THE FACT THAT THE       *00380072
003900*      MAX NUMBER OF CAPABILITIES OR RELATIONSHIPS WAS EXCEEDED  *00390072
004000*      WHEN SENDING A 'NEW VENDOR' MESSAGE TO RMS.               *00400072
004100*      MADE BY: JACK KRAMER             WR/IR #: WR25278         *00410072
004200*                                                                *00420072
004300*  DATE  07/21/2005                                              *00430069
004400*      CHANGE MADE: OFF-INVOICE CO-OP ADVERTISING ALLOWANCES.    *00440069
004500*      RECOMPILE FROM PRODUCTION TO INCORPORATE CHANGES TO       *00450069
004600*      COPYBOOK VNWS013.                                         *00460069
004700*      MADE BY: KRYSTEN LEARY           WR/IR #: WR28651         *00470069
004800*                                                                *00480069
004900*  DATE  03/08/2006                                              *00490073
005000*      CHANGE MADE: ADDED CODE FOR THE EMAIL ADDRESS THAT WAS    *00500073
005100*      ADDED TO TVNDDPT AS EMAIL_ADDR_ID.  THE EMAIL ADDR IS     *00510081
005200*      REQUIRED FOR ALL MERCHANDISE DEPTS THAT ARE ACTIVE OR     *00520083
005300*      INACTIVE ONES THAT ARE ACTIVATED.  IT IS NOT REQUIRED     *00530083
005400*      FOR EXPENSE DEPTS BUT IT CAN BE USED FOR EXPENSE DEPTS.   *00540081
005500*      MADE BY: MIKE BESKE              WR/IR #: WR30028         *00550073
005600*                                                                *00560073
005700*  DATE  04/11/2006                                              *00570084
005800*      CHANGE MADE: VENDOR ALLOWANCE AUTOMATION PROJECT.         *00580084
005900*      RECOMPILE FROM PRODUCTION TO INCORPORATE CHANGES TO       *00590084
006000*      COPYBOOK VNWS007 AND VNWS013.                             *00600084
006100*      MADE BY: MIKE BESKE              WR/IR #: WR30028         *00610084
006160*                                                               * 00610190
006110*  DATE  09/07/2021                                              *00611087
006120*            - CHANGE CALL OF DPKUT100 TO                       * 00612087
006130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00613087
006140*              MAKING THE CALL DYNAMIC VS STATIC                * 00614087
006150*      MADE BY: GERMAN BANDA            WR/IR #: CHG0261091      *00615089
006160*                                                               * 00616087
006110*  DATE  01/05/2023                                              *00617090
006120*            - CHANGE CALL OF DPKCS030 TO DYNAMIC               * 00618090
006150*      MADE BY: JEAN KURK               WR/IR #: CHG0277999      *00619290
006200*                                                                *00620084
006300*----------------------------------------------------------------*00630056
006400 ENVIRONMENT DIVISION.                                            00640056
006500 DATA DIVISION.                                                   00650056
006600 WORKING-STORAGE SECTION.                                         00660056
006700                                                                  00670056
006800 01  DK-DB2-KEYS.                                                 00680056
006900     05  DK-OPERATING-COMPANY           PIC  X(02)  VALUE SPACE.  00690056
007000     05  DK-ENT-ID                      PIC S9(09)  COMP          00700056
007100                                                    VALUE +0.     00710056
007200     05  DK-DEPT-NBR                    PIC  X(03)  VALUE SPACE.  00720056
007300     05  DK-INHOUSE-NUMBER              PIC S9(03)  COMP-3        00730056
007400                                                    VALUE ZERO.   00740056
007500     05  DK-VEND-TYPE                   PIC  X(01)  VALUE SPACE.  00750056
007600     05  DK-DMA-NBR                     PIC  X(02)  VALUE SPACES. 00760056
007700     05  DK-GMA-NBR                     PIC  X(02)  VALUE SPACES. 00770056
007800                                                                  00780056
007900 01  PC-PROGRAM-CONSTANTS.                                        00790056
008000     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'VNKCS015'.  00800056
008100     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'VN015A  '.  00810056
008200     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'VNKM015 '.  00820056
008300     05  PC-VNKCS023              PIC  X(08)  VALUE  'VNKCS023'.  00830056
008400     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00840056
008500                                              COMP.               00850056
008600     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00860056
008700                                              COMP.               00870056
008800     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           00880056
008900                                              COMP.               00890056
009000     05  PC-INTER-APPL-CODES.                                     00900056
009100         10  PC-INTER-APPL-ADD    PIC  X(01)  VALUE '1'.          00910056
009200         10  PC-INTER-APPL-UPDATE PIC  X(01)  VALUE '2'.          00920056
009300     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00930056
009400     05  PC-INIT-EXP-TMST         PIC  X(26)  VALUE               00940056
009500         '9999-09-09-09.09.09.999999'.                            00950056
009600     05  PC-TSYMSG-NUMBERS.                                       00960056
009700         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00970056
009800         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00980056
009900         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00990056
010000         10  PC-TSYMSG-00014      PIC  9(05)  VALUE  00014.       01000056
010100         10  PC-TSYMSG-00032      PIC  9(05)  VALUE  00032.       01010056
010200         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       01020056
010300         10  PC-TSYMSG-00057      PIC  9(05)  VALUE  00057.       01030056
010400         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       01040056
010500         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       01050056
010600         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       01060056
010700         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       01070056
010800         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       01080056
010900         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       01090056
011000         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       01100056
011100         10  PC-TSYMSG-00475      PIC  9(05)  VALUE  00475.       01110056
011200         10  PC-TSYMSG-00478      PIC  9(05)  VALUE  00478.       01120056
011300         10  PC-TSYMSG-02018      PIC  9(05)  VALUE  02018.       01130056
011400         10  PC-TSYMSG-02019      PIC  9(05)  VALUE  02019.       01140056
011500         10  PC-TSYMSG-02020      PIC  9(05)  VALUE  02020.       01150056
011600         10  PC-TSYMSG-02645      PIC  9(05)  VALUE  02645.       01160056
011700         10  PC-TSYMSG-02646      PIC  9(05)  VALUE  02646.       01170056
011800         10  PC-TSYMSG-03380      PIC  9(05)  VALUE  03380.       01180068
011900         10  PC-TSYMSG-03381      PIC  9(05)  VALUE  03381.       01190069
012000         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01200056
012100                                                                  01210056
012200 01  PS-PROGRAM-SWITCHES.                                         01220056
012300     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01230056
012400         88  PS-ERROR                         VALUE  'Y'.         01240056
012500         88  PS-NO-ERROR                      VALUE  'N'.         01250056
012600     05  PS-TVNDTAU-ROW-FND-SW  PIC X(01)     VALUE  'N'.         01260056
012700         88  TVNDTAU-ROW-FOUND                VALUE  'Y'.         01270056
012800         88  TVNDTAU-ROW-NOT-FOUND            VALUE  'N'.         01280056
012900                                                                  01290056
013000 01  PV-PROGRAM-VARIABLES.                                        01300056
013100     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01310056
013200                                              COMP SYNC.          01320056
013300     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01330056
013400                                              COMP SYNC.          01340056
013500     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            01350056
013600                                              COMP SYNC.          01360056
013700     05  PV-DB2-COUNT             PIC S9(04)  VALUE +0            01370056
013800                                              COMP SYNC.          01380056
013900     05  PV-VEND-TYP-CNT          PIC S9(04)  VALUE +0            01390056
014000                                              COMP SYNC.          01400056
014100     05  PV-HOLD-STATUS           PIC  X(01)  VALUE SPACES.       01410056
014200     05  PV-VNDDPT-EMAIL-ADDR-ID  PIC  X(250) VALUE SPACES.       01420074
014300     05  PV-VNDDPT-EMAIL-ADDR-ID-X REDEFINES                      01430075
014400                                   PV-VNDDPT-EMAIL-ADDR-ID.       01440075
014500         10  PV-EMAIL-ADDR1       PIC  X(62).                     01450075
014600         10  PV-EMAIL-ADDR2       PIC  X(62).                     01460075
014700         10  PV-EMAIL-ADDR3       PIC  X(62).                     01470075
014800         10  PV-EMAIL-ADDR4       PIC  X(64).                     01480075
014900     05  PV-ERROR-MESSAGE-AREA.                                   01490075
015000         10  PV-ERROR-MSG-1.                                      01500075
015100             15  FILLER               PIC X(21)  VALUE            01510075
015200                 'UNSUCCESSFUL CALL TO '.                         01520075
015300             15  PV-ERROR-PGM-NAME    PIC X(08).                  01530075
015400             15  FILLER               PIC X(11)  VALUE            01540075
015500                 ' IN PARA:  '.                                   01550075
015600             15  PV-ERROR-PARA-NAME   PIC X(30).                  01560075
015700         10  PV-ERROR-MSG-2.                                      01570075
015800             15  PV-ERROR-MESSAGE     PIC X(57).                  01580075
015900         10  PV-ERROR-MSG-3.                                      01590075
016000             15  PV-ERROR-TYPE        PIC X(15).                  01600075
016100             15  PV-OPTIONAL-TEXT     PIC X(10).                  01610075
016200             15  PV-ERROR-REASON      PIC X(30).                  01620075
016300                                                                  01630075
016400**--------------------------------------------------------------**01640075
016500** THE LAYOUT FOR THE TEMPORARY STORAGE QUEUE CONTAINING        **01650075
016600** SELECTED LIST ITEMS TO BE PROCESSED BY THIS PROGRAM.         **01660075
016700**--------------------------------------------------------------**01670075
016800     COPY VNWS003.                                                01680075
016900                                                                  01690075
017000*----------------------------------------------------------------*01700075
017100*    MAP LAYOUT                                                  *01710075
017200*----------------------------------------------------------------*01720075
017300     COPY VNKM015.                                                01730075
017400                                                                  01740075
017500*----------------------------------------------------------------*01750075
017600*    ATTRIBUTE SETTINGS COPYBOOK.                                *01760075
017700*----------------------------------------------------------------*01770075
017800     COPY DPWS015.                                                01780075
017900                                                                  01790075
018000*----------------------------------------------------------------*01800075
018100*    FUNCTION KEYS COPYBOOK                                      *01810075
018200*----------------------------------------------------------------*01820075
018300     COPY DPWS016.                                                01830075
018400                                                                  01840075
018500**--------------------------------------------------------------**01850075
018600** THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT    **01860075
018700** SUB-ROUTINE (DPKUT100).                                      **01870075
018800**--------------------------------------------------------------**01880075
018900     COPY DPWS010I.                                               01890075
019000                                                                  01900075
019100**--------------------------------------------------------------**01910075
019200** THE CALLING PARAMETER LIST (VNWS013) FOR THE RMS DATA BUILDER**01920075
019300** SUB-ROUTINE (VNKCS023).                                      **01930075
019400**--------------------------------------------------------------**01940075
019500 01  VN013-COMMAREA.                                              01950075
019600     COPY VNWS013.                                                01960075
019700                                                                  01970075
019800**--------------------------------------------------------------**01980075
020000** PARAMETERS FOR CALLING CICS ARCHITECTURE API                 **02000090
020100**--------------------------------------------------------------**02010075
020200     COPY DPWS030.                                                02020075
020200     COPY DPWS930.                                                02021090
020300                                                                  02030075
020400**--------------------------------------------------------------**02040075
020500*    STANDARD COMMAREA.                                           02050075
020600**--------------------------------------------------------------**02060075
020700     COPY DPWS020.                                                02070075
020800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02080075
020900***************************************************************** 02090075
021000*    INTER-APPLICATION COMMAREA.                                  02100075
021100***************************************************************** 02110075
021200         10  INTER-APPL-COMM-AREA PIC X(200).                     02120075
021300     COPY VNWS002.                                                02130075
021400***************************************************************** 02140075
021500*    SPECIFIC COMMMAREA FOR VNKCS015.                             02150075
021600***************************************************************** 02160075
021700         10  ASC-SPECIFIC-COMMAREA.                               02170075
021800             15  ASC-INT-APPL-FORMAT-IND   PIC  X(01).            02180075
021900             15  ASC-VEND-NAME             PIC  X(30).            02190075
022000             15  ASC-VEND-TYPE             PIC  X(01).            02200075
022100             15  ASC-DEPT-NUMBER           PIC  X(03).            02210075
022200             15  ASC-DEPT-NUMBER-N REDEFINES ASC-DEPT-NUMBER      02220075
022300                                           PIC  9(03).            02230075
022400             15  ASC-INHOUSE-NUMBER        PIC  X(03).            02240075
022500             15  ASC-INHOUSE-NUMBER-N REDEFINES                   02250075
022600                 ASC-INHOUSE-NUMBER        PIC  9(03).            02260075
022700             15  ASC-INVC-REQD             PIC  X(01).            02270075
022800             15  ASC-STATUS                PIC  X(01).            02280075
022900             15  ASC-ENT-ID                PIC S9(09)  COMP.      02290075
023000             15  ASC-USE-SELECTION-QUEUE-IND                      02300075
023100                                           PIC  X(01).            02310075
023200                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 02320075
023300             15  ASC-SEL-QUEUE-NAME        PIC  X(08).            02330075
023400             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    02340075
023500             15  ASC-NUMBER-OF-SELECTED-ITEMS                     02350075
023600                                           PIC S9(09)  COMP-3.    02360075
023700             15  ASC-SEL-SUB               PIC S9(04)  COMP.      02370075
023800             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      02380075
023900             15  ASC-ADD-COMPLETE-SW       PIC  X(01).            02390075
024000                 88  ASC-ADD-COMPLETE                  VALUE 'Y'. 02400075
024100                 88  ASC-ADD-PENDING                   VALUE 'N'. 02410075
024200             15  ASC-DUN-NBR               PIC  X(09).            02420075
024300             15  ASC-STATUS-CDE            PIC  X(01).            02430075
024400             15  ASC-PRIM-TYP-CDE          PIC  X(01).            02440075
024500             15  ASC-VND-IN-RMS-IND        PIC  X(01).            02450075
024600             15  ASC-PO-PREPK-CDE          PIC  X(01).            02460075
024700             15  ASC-EMAIL-ADDR1           PIC X(62).             02470075
024800             15  ASC-EMAIL-ADDR2           PIC X(62).             02480075
024900             15  ASC-EMAIL-ADDR3           PIC X(62).             02490075
025000             15  ASC-EMAIL-ADDR4           PIC X(64).             02500075
025100                                                                  02510075
025200*----------------------------------------------------------------*02520075
025300*    ABEND PROCESSING COPYBOOK.                                  *02530075
025400*----------------------------------------------------------------*02540075
025500     COPY DPWS013.                                                02550075
025600                                                                  02560075
025700     EXEC SQL                                                     02570075
025800          INCLUDE TVNDDPT                                         02580075
025900     END-EXEC.                                                    02590075
026000                                                                  02600075
026100     EXEC SQL                                                     02610075
026200          INCLUDE TMDSEAR                                         02620075
026300     END-EXEC.                                                    02630075
026400                                                                  02640075
026500     EXEC SQL                                                     02650075
026600          INCLUDE TRSPBAR                                         02660075
026700     END-EXEC.                                                    02670075
026800                                                                  02680075
026900     EXEC SQL                                                     02690075
027000          INCLUDE TWORKER                                         02700075
027100     END-EXEC.                                                    02710075
027200                                                                  02720075
027300     EXEC SQL                                                     02730075
027400          INCLUDE TORGUNT                                         02740075
027500     END-EXEC.                                                    02750075
027600                                                                  02760075
027700     EXEC SQL                                                     02770075
027800          INCLUDE TORGWRK                                         02780075
027900     END-EXEC.                                                    02790075
028000                                                                  02800075
028100     EXEC SQL                                                     02810075
028200          INCLUDE TEXTENT                                         02820075
028300     END-EXEC.                                                    02830075
028400                                                                  02840075
028500     EXEC SQL                                                     02850075
028600          INCLUDE TENTNME                                         02860075
028700     END-EXEC.                                                    02870075
028800                                                                  02880075
028900     EXEC SQL                                                     02890075
029000          INCLUDE TVNDTAU                                         02900075
029100     END-EXEC.                                                    02910075
029200                                                                  02920075
029300     EXEC SQL                                                     02930075
029400          INCLUDE SQLCA                                           02940075
029500     END-EXEC.                                                    02950075
029600                                                                  02960075
029700 LINKAGE SECTION.                                                 02970075
029800                                                                  02980075
029900 01  DFHCOMMAREA.                                                 02990075
030000     05  FILLER OCCURS 1 TO 4072 TIMES                            03000075
030100                DEPENDING ON EIBCALEN.                            03010075
030200         10  FILLER PIC X.                                        03020075
030300                                                                  03030075
030400 PROCEDURE DIVISION.                                              03040075
030500***************************************************************** 03050075
030600** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 03060075
030700** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 03070075
030800** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 03080075
030900**                                                             ** 03090075
031000** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 03100075
031100** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 03110075
031200***************************************************************** 03120075
031300 0000-MAIN-MODULE.                                                03130075
031400                                                                  03140075
031500     INITIALIZE DP030-CICS-API-FIELDS.                            03150075
031600     MOVE +1                     TO DP030-NUMBER-OF-MAPS.         03160075
031700     MOVE PC-CURRENT-MAPSET-NAME TO DP030-MAPSET-NAME.            03170075
031800     MOVE PC-CURRENT-MAP-NAME    TO DP030-MAP-NAME (1).           03180075
031900     SET DP030-RECEIVE-APPL-MAP  TO TRUE.                         03190075
032000     MOVE LENGTH OF VN015AI      TO DP030-MAP-LENGTH (1).         03200075
032100     MOVE 'PROGRAM ENTRY CALL'   TO DP013-MESSAGE-TEXT (1).       03210075
032200     PERFORM 0001-CALL-CICS-ARCH-API.                             03220075
032300                                                                  03230075
032400     PERFORM 1000-CONTROL-PROCESSING.                             03240075
032500                                                                  03250075
032600     MOVE 'PROGRAM EXIT CALL'    TO DP013-MESSAGE-TEXT (1).       03260075
032700     PERFORM 0001-CALL-CICS-ARCH-API.                             03270075
032800                                                                  03280075
032900 0001-CALL-CICS-ARCH-API.                                         03290075
033000                                                                  03300075
033100*    CALL 'DPKCS030' USING DFHEIBLK                               03310090
033100     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03311091
033200                           DFHCOMMAREA                            03320075
033300                           DP030-CICS-API-FIELDS                  03330075
033400                           DP020-STANDARD-COMMAREA                03340075
033500                           VN015AI.                               03350075
033600                                                                  03360075
033700     IF DP030-RC-CALL-SUCCESSFUL                                  03370075
033800         CONTINUE                                                 03380075
033900     ELSE                                                         03390075
034000         SET DP013-CICS-ABEND                                     03400075
034100             DP013-NO-ROLLBACK                                    03410075
034200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   03420075
034300         MOVE 'BEFORE 0000-MAIN-MODULE' TO DP013-PARAGRAPH        03430075
034400*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX03440090
034500*             'T LINE'          TO DP013-MESSAGE-TEXT (2)         03450090
034400         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03451090
034500-             'N NEXT LINE'     TO DP013-MESSAGE-TEXT (2)         03452090
034600         MOVE DP030-RETURN-CODE TO DP013-MESSAGE-TEXT (3)         03460075
034700         PERFORM DP013-0000-PROCESS-ABEND                         03470075
034800     END-IF.                                                      03480075
034900                                                                  03490075
035000*----------------------------------------------------------------*03500075
035100*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03510075
035200*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03520075
035300*----------------------------------------------------------------*03530075
035400 1000-CONTROL-PROCESSING.                                         03540075
035500                                                                  03550075
035600     EVALUATE TRUE                                                03560075
035700         WHEN DP020-NEXT-ACT-INITIAL                              03570075
035800         WHEN ASC-ADD-COMPLETE                                    03580075
035900              PERFORM 1100-FIND-OBJECT-KEYS                       03590075
036000                                                                  03600075
036100              IF PS-NO-ERROR                                      03610075
036200                  MOVE SPACES TO ADPTNBRO                         03620075
036300                  MOVE ZERO   TO AINHSO                           03630075
036400                  MOVE 'N'    TO AINVCO                           03640075
036500                                                                  03650075
036600                  PERFORM 4000-BUILD-INITIAL-PANEL                03660075
036700                                                                  03670075
036800                  IF DP020-INT-APPL-FORMAT-IND = '2'              03680075
036900                      IF SQLCODE = +100                           03690075
037000                          MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER03700075
037100                          SET DP020-MSG-INFORMATIONAL             03710075
037200                              DP020-NEXT-ACT-APPL-ERROR TO TRUE   03720075
037300                      END-IF                                      03730075
037400                  END-IF                                          03740075
037500              END-IF                                              03750075
037600                                                                  03760075
037700         WHEN DP020-NEXT-ACT-READ-MAP                             03770075
037800              PERFORM 2000-PROCESS-PANEL                          03780075
037900                                                                  03790075
038000         WHEN DP020-NEXT-ACT-RETURN                               03800075
038100              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                03810075
038200                                                                  03820075
038300              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  03830075
038400                                                                  03840075
038500         WHEN OTHER                                               03850075
038600              SET DP013-LOGIC-ABEND                               03860075
038700                  DP013-NO-ROLLBACK TO TRUE                       03870075
038800              MOVE '1000-CONTROL-PROCESSING'                      03880075
038900                                    TO DP013-PARAGRAPH            03890075
039000              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  03900075
039100                                    TO DP013-MESSAGE-TEXT(1)      03910075
039200              MOVE DP020-NEXT-APPL-ACTIVITY                       03920075
039300                                    TO DP013-MESSAGE-TEXT(2)      03930075
039400              PERFORM DP013-0000-PROCESS-ABEND                    03940075
039500     END-EVALUATE.                                                03950075
039600                                                                  03960075
039700******************************************************************03970075
039800** DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   **03980075
039900** INTER-APPLICATION FORMAT CODE.                               **03990075
040000******************************************************************04000075
040100 1100-FIND-OBJECT-KEYS.                                           04010075
040200                                                                  04020075
040300     INITIALIZE ASC-SPECIFIC-COMMAREA.                            04030075
040400     MOVE DP020-INT-APPL-FORMAT-IND TO ASC-INT-APPL-FORMAT-IND.   04040075
040500     MOVE VN002-ENT-ID              TO DK-ENT-ID.                 04050075
040600                                                                  04060075
040700     PERFORM 1110-VENDOR-TYPE-VERIFICATION.                       04070075
040800                                                                  04080075
040900     IF PV-VEND-TYP-CNT > ZERO                                    04090075
041000                                                                  04100075
041100         EVALUATE DP020-INT-APPL-FORMAT-IND                       04110075
041200             WHEN PC-INTER-APPL-ADD                               04120075
041300                  SET ASC-ADD-PENDING    TO TRUE                  04130075
041400                  MOVE VN002-ENT-ID      TO ASC-ENT-ID            04140075
041500                  MOVE 'A'               TO ASC-STATUS            04150075
041600                                            ASTATO                04160075
041700                  MOVE DP015-PRO-NOR-OFF TO ASTATA                04170075
041800                  MOVE DP015-BLUE        TO ASTATC                04180075
041900                  MOVE DP015-HL-OFF      TO ASTATH                04190075
042000                                                                  04200075
042100             WHEN PC-INTER-APPL-UPDATE                            04210075
042200                  MOVE DP015-PRO-NOR-OFF TO AVNDTYPA              04220075
042300                                            ADPTNBRA              04230075
042400                  MOVE DP015-BLUE        TO AVNDTYPC              04240075
042500                                            ADPTNBRC              04250075
042600                  MOVE DP015-HL-OFF      TO AVNDTYPH              04260075
042700                                            ADPTNBRH              04270075
042800                  SET ASC-USE-SELECTION-QUEUE TO TRUE             04280075
042900                  MOVE VN002-NUMBER-OF-SELECTED-ITEMS             04290075
043000                                   TO ASC-NUMBER-OF-SELECTED-ITEMS04300075
043100                  MOVE VN002-NUMBER-OF-TS-ITEMS                   04310075
043200                                       TO ASC-NUMBER-OF-TS-ITEMS  04320075
043300                  MOVE VN002-SEL-QUEUE-NAME                       04330075
043400                                       TO ASC-SEL-QUEUE-NAME      04340075
043500                  IF ASC-NUMBER-OF-SELECTED-ITEMS = ZERO          04350075
043600*                     --- NO ITEMS WERE SELECTED ---              04360075
043700                      MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER    04370075
043800                      SET PS-ERROR                                04380075
043900                          DP020-MSG-WARNING                       04390075
044000                          DP020-NEXT-ACT-APPL-ERROR TO TRUE       04400075
044100                  ELSE                                            04410075
044200                      PERFORM 1120-PREPARE-LIST-ENTRY             04420075
044300                                                                  04430075
044400                      INITIALIZE PV-DB2-COUNT                     04440075
044500                                                                  04450075
044600                      IF ASC-VEND-TYPE = 'E'                      04460075
044700                          PERFORM 1139-CHECK-AUTHORIZATION        04470075
044800                      ELSE                                        04480075
044900                          PERFORM 1140-CHECK-AUTHORIZATION        04490075
045000                      END-IF                                      04500075
045100                                                                  04510075
045200                      IF PV-DB2-COUNT = ZERO                      04520075
045300                          MOVE PC-TSYMSG-00014 TO DP020-MSG-NUMBER04530075
045400                          SET  PS-ERROR                           04540075
045500                               DP020-MSG-FATAL                    04550075
045600                               DP020-NEXT-ACT-APPL-ERROR TO TRUE  04560075
045700                      END-IF                                      04570075
045800                  END-IF                                          04580075
045900                                                                  04590075
046000             WHEN OTHER                                           04600075
046100                  MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER        04610075
046200                  SET DP020-MSG-FATAL                             04620075
046300                      DP020-NEXT-ACT-APPL-ERROR TO TRUE           04630075
046400         END-EVALUATE                                             04640075
046500     ELSE                                                         04650075
046600         MOVE PC-TSYMSG-02018 TO DP020-MSG-NUMBER                 04660075
046700         SET  PS-ERROR                                            04670075
046800              DP020-MSG-FATAL                                     04680075
046900              DP020-NEXT-ACT-APPL-ERROR TO TRUE                   04690075
047000     END-IF.                                                      04700075
047100                                                                  04710075
047200*----------------------------------------------------------------*04720075
047300* VERIFY ONLY MERCHANDISE AND EXPENSE VENDORS CAN HAVE DEPTS     *04730075
047400* ADDED                                                          *04740075
047500*----------------------------------------------------------------*04750075
047600 1110-VENDOR-TYPE-VERIFICATION.                                   04760075
047700                                                                  04770075
047800     PERFORM WITH TEST AFTER                                      04780075
047900             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 04790075
048000               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         04800075
048100                     SQLCODE = ZERO                               04810075
048200                                                                  04820075
048300        EXEC SQL                                                  04830075
048400            SELECT COUNT(*)                                       04840075
048500              INTO :PV-VEND-TYP-CNT                               04850075
048600              FROM TEXTENT                                        04860075
048700             WHERE ENT_ID = :DK-ENT-ID                            04870075
048800               AND (PRIM_TYP_CDE = 'M'                            04880075
048900                OR  PRIM_TYP_CDE = 'E')                           04890075
049000        END-EXEC                                                  04900075
049100                                                                  04910075
049200        EVALUATE TRUE                                             04920075
049300            WHEN SQLCODE = ZERO                                   04930075
049400            WHEN SQLCODE = -904                                   04940075
049500            WHEN SQLCODE = -913                                   04950075
049600                CONTINUE                                          04960075
049700                                                                  04970075
049800            WHEN SQLWARN0 NOT = SPACES                            04980075
049900            WHEN SQLCODE < ZERO                                   04990075
050000            WHEN SQLCODE > ZERO                                   05000075
050100                 MOVE '1110-VENDOR-TYPE-VERIFICATION'             05010075
050200                                   TO DP013-PARAGRAPH             05020075
050300                 MOVE 'SELECT TEXTENT'                            05030075
050400                                   TO DP013-MESSAGE-TEXT (1)      05040075
050500                 MOVE SQLCA        TO DP013-SQLCA                 05050075
050600                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    05060075
050700                 SET DP013-DB2-ABEND                              05070075
050800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05080075
050900                 PERFORM DP013-0000-PROCESS-ABEND                 05090075
051000         END-EVALUATE                                             05100075
051100     END-PERFORM.                                                 05110075
051200                                                                  05120075
051300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        05130075
051400         MOVE '1110-VENDOR-TYPE-VERIFICATION'                     05140075
051500                                   TO DP013-PARAGRAPH             05150075
051600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     05160075
051700                                   TO DP013-MESSAGE-TEXT (1)      05170075
051800         MOVE 'TEXTENT'            TO DP013-MESSAGE-TEXT (2)      05180075
051900         MOVE SQLCA                TO DP013-SQLCA                 05190075
052000         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    05200075
052100         SET DP013-DB2-ABEND                                      05210075
052200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   05220075
052300         PERFORM DP013-0000-PROCESS-ABEND                         05230075
052400     END-IF.                                                      05240075
052500                                                                  05250075
052600*----------------------------------------------------------------*05260075
052700* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *05270075
052800* STORAGE QUEUE PASSED FROM THE LIST.                            *05280075
052900*----------------------------------------------------------------*05290075
053000 1120-PREPARE-LIST-ENTRY.                                         05300075
053100                                                                  05310075
053200     MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB.                         05320075
053300     MOVE ZERO            TO ASC-SEL-ITEM.                        05330075
053400                                                                  05340075
053500     PERFORM 2110-GET-NEXT-VEND-DEPT.                             05350075
053600                                                                  05360075
053700 1139-CHECK-AUTHORIZATION.                                        05370075
053800                                                                  05380075
053900     PERFORM WITH TEST AFTER                                      05390075
054000             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 05400075
054100               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         05410075
054200                     SQLCODE = ZERO OR                            05420075
054300                     SQLCODE = +100                               05430075
054400                                                                  05440075
054500        EXEC SQL                                                  05450075
054600                SELECT COUNT(*)                                   05460075
054700                  INTO :PV-DB2-COUNT                              05470075
054800                  FROM TORGUNT A                                  05480075
054900                      ,TORGWRK B                                  05490075
055000                 WHERE A.ORGUNT_NICK_NAME = :ASC-DEPT-NUMBER      05500075
055100                   AND A.ORGUNT_TYP_CDE   = '01'                  05510075
055200                   AND B.ORGUNT_ID        = A.ORGUNT_ID           05520075
055300                   AND B.WORKER_NBR       =                       05530075
055400                       (SELECT WORKER_NBR                         05540075
055500                          FROM TWORKER                            05550075
055600                         WHERE OPERCO_NBR = '03'                  05560075
055700                           AND UID_NBR    = :DP020-USERID)        05570075
055800        END-EXEC                                                  05580075
055900                                                                  05590075
056000        EVALUATE TRUE                                             05600075
056100            WHEN SQLCODE = ZERO                                   05610075
056200            WHEN SQLCODE = +100                                   05620075
056300            WHEN SQLCODE = -904                                   05630075
056400            WHEN SQLCODE = -913                                   05640075
056500                 CONTINUE                                         05650075
056600                                                                  05660075
056700            WHEN SQLWARN0 NOT = SPACES                            05670075
056800            WHEN SQLCODE < ZERO                                   05680075
056900            WHEN SQLCODE > ZERO                                   05690075
057000                 MOVE '1139-CHECK-AUTHORIZATION'                  05700075
057100                                      TO DP013-PARAGRAPH          05710075
057200                 MOVE 'VALIDATE EXPENSE DEPT: '                   05720075
057300                                      TO DP013-MESSAGE-TEXT (1)   05730075
057400                 MOVE ASC-DEPT-NUMBER TO DP013-MESSAGE-TEXT (2)   05740075
057500                 MOVE SQLCA           TO DP013-SQLCA              05750075
057600                 MOVE 'TORGUNT'       TO DP013-DB2-TABLE-NAME (1) 05760075
057700                 SET DP013-DB2-ABEND                              05770075
057800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           05780075
057900                 PERFORM DP013-0000-PROCESS-ABEND                 05790075
058000         END-EVALUATE                                             05800075
058100     END-PERFORM.                                                 05810075
058200                                                                  05820075
058300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05830075
058400         MOVE '1139-CHECK-AUTHORIZATION' TO DP013-PARAGRAPH       05840075
058500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO VALIDATE '  05850075
058600                                    TO DP013-MESSAGE-TEXT (1)     05860075
058700         MOVE 'EXPENSE DEPARTMENT:'                               05870075
058800                                    TO DP013-MESSAGE-TEXT (2)     05880075
058900         MOVE ASC-DEPT-NUMBER       TO DP013-MESSAGE-TEXT (3)     05890075
059000         MOVE SQLCA                 TO DP013-SQLCA                05900075
059100         MOVE 'TORGUNT'             TO DP013-DB2-TABLE-NAME (1)   05910075
059200         SET DP013-DB2-ABEND                                      05920075
059300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   05930075
059400         PERFORM DP013-0000-PROCESS-ABEND                         05940075
059500     END-IF.                                                      05950075
059600                                                                  05960075
059700*----------------------------------------------------------------*05970075
059800*   VALIDATE THAT USER HAS AUTHORITY TO UPDATE THIS MDSE. DEPT.   05980075
059900*----------------------------------------------------------------*05990075
060000 1140-CHECK-AUTHORIZATION.                                        06000075
060100                                                                  06010075
060200     PERFORM                                                      06020075
060300         WITH TEST AFTER                                          06030075
060400         VARYING PV-RETRY-COUNTER                                 06040075
060500         FROM 1 BY 1                                              06050075
060600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               06060075
060700             OR (SQLCODE = +0)                                    06070075
060800             OR (SQLCODE = +100))                                 06080075
060900                                                                  06090075
061000         EXEC SQL                                                 06100075
061100              SELECT COUNT(*)                                     06110075
061200                INTO :PV-DB2-COUNT                                06120075
061300                FROM TMDSEAR A                                    06130075
061400                    ,TRSPBAR B                                    06140075
061500               WHERE A.MDSEAR_DKEY     = B.MDSEAR_DKEY            06150075
061600                 AND A.DEPT_NBR        = :ASC-DEPT-NUMBER         06160075
061700                 AND A.MDSELV_CDE      = 'DPT'                    06170075
061800                 AND A.OPERCO_NBR      = '03'                     06180075
061900                 AND CURRENT DATE BETWEEN A.STRT_DTE AND A.END_DTE06190075
062000                 AND B.WORKER_STRT_DTE <= CURRENT DATE            06200075
062100                 AND B.WORKER_END_DTE  >= CURRENT DATE            06210075
062200                 AND B.WORKER_NBR  =                              06220075
062300                    (SELECT WORKER_NBR                            06230075
062400                       FROM TWORKER                               06240075
062500                      WHERE OPERCO_NBR = '03'                     06250075
062600                        AND UID_NBR    = :DP020-USERID)           06260075
062700         END-EXEC                                                 06270075
062800                                                                  06280075
062900         EVALUATE TRUE                                            06290075
063000             WHEN SQLCODE = +0                                    06300075
063100             WHEN SQLCODE = +100                                  06310075
063200             WHEN SQLCODE = -904                                  06320075
063300             WHEN SQLCODE = -913                                  06330075
063400                  CONTINUE                                        06340075
063500                                                                  06350075
063600             WHEN SQLWARN0 NOT = SPACES                           06360075
063700             WHEN SQLCODE < +0                                    06370075
063800             WHEN SQLCODE > +0                                    06380075
063900                  MOVE '1140-CHECK-AUTHORIZATION'                 06390075
064000                                  TO DP013-PARAGRAPH              06400075
064100                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             06410075
064200                                  TO DP013-MESSAGE-TEXT (1)       06420075
064300                  MOVE SQLCA      TO DP013-SQLCA                  06430075
064400                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     06440075
064500                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     06450075
064600                  SET DP013-DB2-ABEND                             06460075
064700                      DP013-XCTL-DISPLAY-RESTART                  06470075
064800                                  TO TRUE                         06480075
064900                  PERFORM DP013-0000-PROCESS-ABEND                06490075
065000         END-EVALUATE                                             06500075
065100     END-PERFORM.                                                 06510075
065200                                                                  06520075
065300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        06530075
065400         MOVE '1140-CHECK-AUTHORIZATION'                          06540075
065500                                  TO DP013-PARAGRAPH              06550075
065600         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          06560075
065700                                  TO DP013-MESSAGE-TEXT (1)       06570075
065800         MOVE SQLCA               TO DP013-SQLCA                  06580075
065900         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     06590075
066000         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     06600075
066100         SET DP013-DB2-ABEND                                      06610075
066200             DP013-XCTL-DISPLAY-RESTART                           06620075
066300                                  TO TRUE                         06630075
066400         PERFORM DP013-0000-PROCESS-ABEND                         06640075
066500     END-IF.                                                      06650075
066600                                                                  06660075
066700     IF PV-DB2-COUNT = +0                                         06670075
066800         PERFORM 1141-GET-DMA-GMA                                 06680075
066900         IF SQLCODE = +100                                        06690075
067000             CONTINUE                                             06700075
067100         ELSE                                                     06710075
067200             PERFORM 1142-CHECK-DMA-AUTHORIZATION                 06720075
067300             IF PV-DB2-COUNT = +0                                 06730075
067400                 PERFORM 1143-CHECK-GMA-AUTHORIZATION             06740075
067500             END-IF                                               06750075
067600         END-IF                                                   06760075
067700     END-IF.                                                      06770075
067800                                                                  06780075
067900     IF PV-DB2-COUNT = +0                                         06790075
068000         PERFORM 1144-CHECK-NO-AUTHORIZATION                      06800075
068100         IF PV-DB2-COUNT = +0                                     06810075
068200             PERFORM 1145-CHECK-NO-DMA-AUTH                       06820075
068300             IF PV-DB2-COUNT = +0                                 06830075
068400                 PERFORM 1146-CHECK-NO-GMA-AUTH                   06840075
068500                 IF PV-DB2-COUNT = +0                             06850075
068600                     MOVE +0       TO PV-DB2-COUNT                06860075
068700                 ELSE                                             06870075
068800                     MOVE +0       TO PV-DB2-COUNT                06880075
068900                 END-IF                                           06890075
069000             ELSE                                                 06900075
069100                 MOVE +0           TO PV-DB2-COUNT                06910075
069200             END-IF                                               06920075
069300         ELSE                                                     06930075
069400             MOVE +0               TO PV-DB2-COUNT                06940075
069500         END-IF                                                   06950075
069600     END-IF.                                                      06960075
069700                                                                  06970075
069800                                                                  06980075
069900 1141-GET-DMA-GMA.                                                06990075
070000                                                                  07000075
070100     PERFORM                                                      07010075
070200         WITH TEST AFTER                                          07020075
070300         VARYING PV-RETRY-COUNTER                                 07030075
070400         FROM 1 BY 1                                              07040075
070500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07050075
070600             OR (SQLCODE = +0)                                    07060075
070700             OR (SQLCODE = +100))                                 07070075
070800                                                                  07080075
070900         EXEC SQL                                                 07090075
071000              SELECT GMA_NBR,                                     07100075
071100                     DMA_NBR                                      07110075
071200                INTO :DK-GMA-NBR,                                 07120075
071300                     :DK-DMA-NBR                                  07130075
071400                FROM TMDSEAR                                      07140075
071500               WHERE DEPT_NBR    = :ASC-DEPT-NUMBER               07150075
071600                 AND MDSELV_CDE  = 'DPT'                          07160075
071700                 AND OPERCO_NBR  = '03'                           07170075
071800                 AND STRT_DTE   <= CURRENT DATE                   07180075
071900                 AND END_DTE    >= CURRENT DATE                   07190075
072000         END-EXEC                                                 07200075
072100                                                                  07210075
072200         EVALUATE TRUE                                            07220075
072300             WHEN SQLCODE = +0                                    07230075
072400             WHEN SQLCODE = +100                                  07240075
072500             WHEN SQLCODE = -904                                  07250075
072600             WHEN SQLCODE = -913                                  07260075
072700                  CONTINUE                                        07270075
072800                                                                  07280075
072900             WHEN SQLWARN0 NOT = SPACES                           07290075
073000             WHEN SQLCODE < +0                                    07300075
073100             WHEN SQLCODE > +0                                    07310075
073200                  MOVE '1141-GET-DMA-GMA'                         07320075
073300                                  TO DP013-PARAGRAPH              07330075
073400                  MOVE 'UNSUCCESSFUL SELECT ON MDSEAR'            07340075
073500                                  TO DP013-MESSAGE-TEXT (1)       07350075
073600                  MOVE SQLCA      TO DP013-SQLCA                  07360075
073700                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     07370075
073800                  SET DP013-DB2-ABEND                             07380075
073900                      DP013-XCTL-DISPLAY-RESTART                  07390075
074000                                  TO TRUE                         07400075
074100                  PERFORM DP013-0000-PROCESS-ABEND                07410075
074200         END-EVALUATE                                             07420075
074300     END-PERFORM.                                                 07430075
074400                                                                  07440075
074500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        07450075
074600         MOVE '1141-GET-DMA-GMA'                                  07460075
074700                                  TO DP013-PARAGRAPH              07470075
074800         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON MDSEAR'          07480075
074900                                  TO DP013-MESSAGE-TEXT (1)       07490075
075000         MOVE SQLCA               TO DP013-SQLCA                  07500075
075100         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     07510075
075200         SET DP013-DB2-ABEND                                      07520075
075300             DP013-XCTL-DISPLAY-RESTART                           07530075
075400                                  TO TRUE                         07540075
075500         PERFORM DP013-0000-PROCESS-ABEND                         07550075
075600     END-IF.                                                      07560075
075700                                                                  07570075
075800 1142-CHECK-DMA-AUTHORIZATION.                                    07580075
075900                                                                  07590075
076000     PERFORM                                                      07600075
076100         WITH TEST AFTER                                          07610075
076200         VARYING PV-RETRY-COUNTER                                 07620075
076300         FROM 1 BY 1                                              07630075
076400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               07640075
076500             OR (SQLCODE = +0)                                    07650075
076600             OR (SQLCODE = +100))                                 07660075
076700                                                                  07670075
076800         EXEC SQL                                                 07680075
076900              SELECT COUNT(*)                                     07690075
077000                INTO :PV-DB2-COUNT                                07700075
077100                FROM TMDSEAR A                                    07710075
077200                    ,TRSPBAR B                                    07720075
077300               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                07730075
077400                 AND A.DMA_NBR    = :DK-DMA-NBR                   07740075
077500                 AND A.MDSELV_CDE  = 'DMA'                        07750075
077600                 AND A.OPERCO_NBR  = '03'                         07760075
077700                 AND B.WORKER_STRT_DTE <= CURRENT DATE            07770075
077800                 AND B.WORKER_END_DTE  >= CURRENT DATE            07780075
077900                 AND B.WORKER_NBR  =                              07790075
078000                    (SELECT WORKER_NBR                            07800075
078100                       FROM TWORKER                               07810075
078200                      WHERE OPERCO_NBR = '03'                     07820075
078300                        AND UID_NBR    = :DP020-USERID)           07830075
078400         END-EXEC                                                 07840075
078500                                                                  07850075
078600         EVALUATE TRUE                                            07860075
078700             WHEN SQLCODE = +0                                    07870075
078800             WHEN SQLCODE = +100                                  07880075
078900             WHEN SQLCODE = -904                                  07890075
079000             WHEN SQLCODE = -913                                  07900075
079100                  CONTINUE                                        07910075
079200                                                                  07920075
079300             WHEN SQLWARN0 NOT = SPACES                           07930075
079400             WHEN SQLCODE < +0                                    07940075
079500             WHEN SQLCODE > +0                                    07950075
079600                  MOVE '1142-CHECK-DMA-AUTHORIZATION'             07960075
079700                                  TO DP013-PARAGRAPH              07970075
079800                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             07980075
079900                                  TO DP013-MESSAGE-TEXT (1)       07990075
080000                  MOVE SQLCA      TO DP013-SQLCA                  08000075
080100                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     08010075
080200                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     08020075
080300                  SET DP013-DB2-ABEND                             08030075
080400                      DP013-XCTL-DISPLAY-RESTART                  08040075
080500                                  TO TRUE                         08050075
080600                  PERFORM DP013-0000-PROCESS-ABEND                08060075
080700         END-EVALUATE                                             08070075
080800     END-PERFORM.                                                 08080075
080900                                                                  08090075
081000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08100075
081100         MOVE '1142-CHECK-DMA-AUTHORIZATION'                      08110075
081200                                  TO DP013-PARAGRAPH              08120075
081300         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          08130075
081400                                  TO DP013-MESSAGE-TEXT (1)       08140075
081500         MOVE SQLCA               TO DP013-SQLCA                  08150075
081600         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     08160075
081700         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     08170075
081800         SET DP013-DB2-ABEND                                      08180075
081900             DP013-XCTL-DISPLAY-RESTART                           08190075
082000                                  TO TRUE                         08200075
082100         PERFORM DP013-0000-PROCESS-ABEND                         08210075
082200     END-IF.                                                      08220075
082300                                                                  08230075
082400 1143-CHECK-GMA-AUTHORIZATION.                                    08240075
082500                                                                  08250075
082600     PERFORM                                                      08260075
082700         WITH TEST AFTER                                          08270075
082800         VARYING PV-RETRY-COUNTER                                 08280075
082900         FROM 1 BY 1                                              08290075
083000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08300075
083100             OR (SQLCODE = +0)                                    08310075
083200             OR (SQLCODE = +100))                                 08320075
083300                                                                  08330075
083400         EXEC SQL                                                 08340075
083500              SELECT COUNT(*)                                     08350075
083600                INTO :PV-DB2-COUNT                                08360075
083700                FROM TMDSEAR A                                    08370075
083800                    ,TRSPBAR B                                    08380075
083900               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                08390075
084000                 AND A.GMA_NBR    = :DK-GMA-NBR                   08400075
084100                 AND A.MDSELV_CDE  = 'GMA'                        08410075
084200                 AND A.OPERCO_NBR  = '03'                         08420075
084300                 AND B.WORKER_STRT_DTE <= CURRENT DATE            08430075
084400                 AND B.WORKER_END_DTE  >= CURRENT DATE            08440075
084500                 AND B.WORKER_NBR  =                              08450075
084600                    (SELECT WORKER_NBR                            08460075
084700                       FROM TWORKER                               08470075
084800                      WHERE OPERCO_NBR = '03'                     08480075
084900                        AND UID_NBR    = :DP020-USERID)           08490075
085000         END-EXEC                                                 08500075
085100                                                                  08510075
085200         EVALUATE TRUE                                            08520075
085300             WHEN SQLCODE = +0                                    08530075
085400             WHEN SQLCODE = +100                                  08540075
085500             WHEN SQLCODE = -904                                  08550075
085600             WHEN SQLCODE = -913                                  08560075
085700                  CONTINUE                                        08570075
085800                                                                  08580075
085900             WHEN SQLWARN0 NOT = SPACES                           08590075
086000             WHEN SQLCODE < +0                                    08600075
086100             WHEN SQLCODE > +0                                    08610075
086200                  MOVE '1143-CHECK-GMA-AUTHORIZATION'             08620075
086300                                  TO DP013-PARAGRAPH              08630075
086400                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             08640075
086500                                  TO DP013-MESSAGE-TEXT (1)       08650075
086600                  MOVE SQLCA      TO DP013-SQLCA                  08660075
086700                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     08670075
086800                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     08680075
086900                  SET DP013-DB2-ABEND                             08690075
087000                      DP013-XCTL-DISPLAY-RESTART                  08700075
087100                                  TO TRUE                         08710075
087200                  PERFORM DP013-0000-PROCESS-ABEND                08720075
087300         END-EVALUATE                                             08730075
087400     END-PERFORM.                                                 08740075
087500                                                                  08750075
087600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        08760075
087700         MOVE '1143-CHECK-GMA-AUTHORIZATION'                      08770075
087800                                  TO DP013-PARAGRAPH              08780075
087900         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          08790075
088000                                  TO DP013-MESSAGE-TEXT (1)       08800075
088100         MOVE SQLCA               TO DP013-SQLCA                  08810075
088200         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     08820075
088300         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     08830075
088400         SET DP013-DB2-ABEND                                      08840075
088500             DP013-XCTL-DISPLAY-RESTART                           08850075
088600                                  TO TRUE                         08860075
088700         PERFORM DP013-0000-PROCESS-ABEND                         08870075
088800     END-IF.                                                      08880075
088900                                                                  08890075
089000 1144-CHECK-NO-AUTHORIZATION.                                     08900075
089100                                                                  08910075
089200     PERFORM                                                      08920075
089300         WITH TEST AFTER                                          08930075
089400         VARYING PV-RETRY-COUNTER                                 08940075
089500         FROM 1 BY 1                                              08950075
089600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08960075
089700             OR (SQLCODE = +0)                                    08970075
089800             OR (SQLCODE = +100))                                 08980075
089900                                                                  08990075
090000         EXEC SQL                                                 09000075
090100              SELECT COUNT(*)                                     09010075
090200                INTO :PV-DB2-COUNT                                09020075
090300                FROM TMDSEAR A                                    09030075
090400                    ,TRSPBAR B                                    09040075
090500               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                09050075
090600                 AND A.MDSELV_CDE  = 'DPT'                        09060075
090700                 AND A.OPERCO_NBR  = '03'                         09070075
090800                 AND B.WORKER_STRT_DTE <= CURRENT DATE            09080075
090900                 AND B.WORKER_END_DTE  >= CURRENT DATE            09090075
091000                 AND B.WORKER_NBR  =                              09100075
091100                    (SELECT WORKER_NBR                            09110075
091200                       FROM TWORKER                               09120075
091300                      WHERE OPERCO_NBR = '03'                     09130075
091400                        AND UID_NBR    = :DP020-USERID)           09140075
091500         END-EXEC                                                 09150075
091600                                                                  09160075
091700         EVALUATE TRUE                                            09170075
091800             WHEN SQLCODE = +0                                    09180075
091900             WHEN SQLCODE = +100                                  09190075
092000             WHEN SQLCODE = -904                                  09200075
092100             WHEN SQLCODE = -913                                  09210075
092200                  CONTINUE                                        09220075
092300                                                                  09230075
092400             WHEN SQLWARN0 NOT = SPACES                           09240075
092500             WHEN SQLCODE < +0                                    09250075
092600             WHEN SQLCODE > +0                                    09260075
092700                  MOVE '1144-CHECK-NO-AUTHORIZATION'              09270075
092800                                  TO DP013-PARAGRAPH              09280075
092900                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             09290075
093000                                  TO DP013-MESSAGE-TEXT (1)       09300075
093100                  MOVE SQLCA      TO DP013-SQLCA                  09310075
093200                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     09320075
093300                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     09330075
093400                  SET DP013-DB2-ABEND                             09340075
093500                      DP013-XCTL-DISPLAY-RESTART                  09350075
093600                                  TO TRUE                         09360075
093700                  PERFORM DP013-0000-PROCESS-ABEND                09370075
093800         END-EVALUATE                                             09380075
093900     END-PERFORM.                                                 09390075
094000                                                                  09400075
094100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09410075
094200         MOVE '1144-CHECK-NO-AUTHORIZATION'                       09420075
094300                                  TO DP013-PARAGRAPH              09430075
094400         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          09440075
094500                                  TO DP013-MESSAGE-TEXT (1)       09450075
094600         MOVE SQLCA               TO DP013-SQLCA                  09460075
094700         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     09470075
094800         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     09480075
094900         SET DP013-DB2-ABEND                                      09490075
095000             DP013-XCTL-DISPLAY-RESTART                           09500075
095100                                  TO TRUE                         09510075
095200         PERFORM DP013-0000-PROCESS-ABEND                         09520075
095300     END-IF.                                                      09530075
095400                                                                  09540075
095500 1145-CHECK-NO-DMA-AUTH.                                          09550075
095600                                                                  09560075
095700     PERFORM                                                      09570075
095800         WITH TEST AFTER                                          09580075
095900         VARYING PV-RETRY-COUNTER                                 09590075
096000         FROM 1 BY 1                                              09600075
096100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09610075
096200             OR (SQLCODE = +0)                                    09620075
096300             OR (SQLCODE = +100))                                 09630075
096400                                                                  09640075
096500         EXEC SQL                                                 09650075
096600              SELECT COUNT(*)                                     09660075
096700                INTO :PV-DB2-COUNT                                09670075
096800                FROM TMDSEAR A                                    09680075
096900                    ,TRSPBAR B                                    09690075
097000               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                09700075
097100                 AND A.MDSELV_CDE  = 'DMA'                        09710075
097200                 AND A.OPERCO_NBR  = '03'                         09720075
097300                 AND B.WORKER_STRT_DTE <= CURRENT DATE            09730075
097400                 AND B.WORKER_END_DTE  >= CURRENT DATE            09740075
097500                 AND B.WORKER_NBR  =                              09750075
097600                    (SELECT WORKER_NBR                            09760075
097700                       FROM TWORKER                               09770075
097800                      WHERE OPERCO_NBR = '03'                     09780075
097900                        AND UID_NBR    = :DP020-USERID)           09790075
098000         END-EXEC                                                 09800075
098100                                                                  09810075
098200         EVALUATE TRUE                                            09820075
098300             WHEN SQLCODE = +0                                    09830075
098400             WHEN SQLCODE = +100                                  09840075
098500             WHEN SQLCODE = -904                                  09850075
098600             WHEN SQLCODE = -913                                  09860075
098700                  CONTINUE                                        09870075
098800                                                                  09880075
098900             WHEN SQLWARN0 NOT = SPACES                           09890075
099000             WHEN SQLCODE < +0                                    09900075
099100             WHEN SQLCODE > +0                                    09910075
099200                  MOVE '1145-CHECK-NO-DMA-AUTH'                   09920075
099300                                  TO DP013-PARAGRAPH              09930075
099400                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             09940075
099500                                  TO DP013-MESSAGE-TEXT (1)       09950075
099600                  MOVE SQLCA      TO DP013-SQLCA                  09960075
099700                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     09970075
099800                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     09980075
099900                  SET DP013-DB2-ABEND                             09990075
100000                      DP013-XCTL-DISPLAY-RESTART                  10000075
100100                                  TO TRUE                         10010075
100200                  PERFORM DP013-0000-PROCESS-ABEND                10020075
100300         END-EVALUATE                                             10030075
100400     END-PERFORM.                                                 10040075
100500                                                                  10050075
100600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10060075
100700         MOVE '1145-CHECK-NO-DMA-AUTH'                            10070075
100800                                  TO DP013-PARAGRAPH              10080075
100900         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          10090075
101000                                  TO DP013-MESSAGE-TEXT (1)       10100075
101100         MOVE SQLCA               TO DP013-SQLCA                  10110075
101200         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     10120075
101300         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     10130075
101400         SET DP013-DB2-ABEND                                      10140075
101500             DP013-XCTL-DISPLAY-RESTART                           10150075
101600                                  TO TRUE                         10160075
101700         PERFORM DP013-0000-PROCESS-ABEND                         10170075
101800     END-IF.                                                      10180075
101900                                                                  10190075
102000 1146-CHECK-NO-GMA-AUTH.                                          10200075
102100                                                                  10210075
102200     PERFORM                                                      10220075
102300         WITH TEST AFTER                                          10230075
102400         VARYING PV-RETRY-COUNTER                                 10240075
102500         FROM 1 BY 1                                              10250075
102600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               10260075
102700             OR (SQLCODE = +0)                                    10270075
102800             OR (SQLCODE = +100))                                 10280075
102900                                                                  10290075
103000         EXEC SQL                                                 10300075
103100              SELECT COUNT(*)                                     10310075
103200                INTO :PV-DB2-COUNT                                10320075
103300                FROM TMDSEAR A                                    10330075
103400                    ,TRSPBAR B                                    10340075
103500               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                10350075
103600                 AND A.MDSELV_CDE  = 'GMA'                        10360075
103700                 AND A.OPERCO_NBR  = '03'                         10370075
103800                 AND B.WORKER_STRT_DTE <= CURRENT DATE            10380075
103900                 AND B.WORKER_END_DTE  >= CURRENT DATE            10390075
104000                 AND B.WORKER_NBR  =                              10400075
104100                    (SELECT WORKER_NBR                            10410075
104200                       FROM TWORKER                               10420075
104300                      WHERE OPERCO_NBR = '03'                     10430075
104400                        AND UID_NBR    = :DP020-USERID)           10440075
104500         END-EXEC                                                 10450075
104600                                                                  10460075
104700         EVALUATE TRUE                                            10470075
104800             WHEN SQLCODE = +0                                    10480075
104900             WHEN SQLCODE = +100                                  10490075
105000             WHEN SQLCODE = -904                                  10500075
105100             WHEN SQLCODE = -913                                  10510075
105200                  CONTINUE                                        10520075
105300                                                                  10530075
105400             WHEN SQLWARN0 NOT = SPACES                           10540075
105500             WHEN SQLCODE < +0                                    10550075
105600             WHEN SQLCODE > +0                                    10560075
105700                  MOVE '1146-CHECK-NO-GMA-AUTH'                   10570075
105800                                  TO DP013-PARAGRAPH              10580075
105900                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             10590075
106000                                  TO DP013-MESSAGE-TEXT (1)       10600075
106100                  MOVE SQLCA      TO DP013-SQLCA                  10610075
106200                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     10620075
106300                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     10630075
106400                  SET DP013-DB2-ABEND                             10640075
106500                      DP013-XCTL-DISPLAY-RESTART                  10650075
106600                                  TO TRUE                         10660075
106700                  PERFORM DP013-0000-PROCESS-ABEND                10670075
106800         END-EVALUATE                                             10680075
106900     END-PERFORM.                                                 10690075
107000                                                                  10700075
107100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10710075
107200         MOVE '1146-CHECK-NO-GMA-AUTH'                            10720075
107300                                  TO DP013-PARAGRAPH              10730075
107400         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          10740075
107500                                  TO DP013-MESSAGE-TEXT (1)       10750075
107600         MOVE SQLCA               TO DP013-SQLCA                  10760075
107700         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     10770075
107800         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     10780075
107900         SET DP013-DB2-ABEND                                      10790075
108000             DP013-XCTL-DISPLAY-RESTART                           10800075
108100                                  TO TRUE                         10810075
108200         PERFORM DP013-0000-PROCESS-ABEND                         10820075
108300     END-IF.                                                      10830075
108400*----------------------------------------------------------------*10840075
108500* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10850075
108600* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10860075
108700* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10870075
108800* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10880075
108900* FUNCTION KEYS CAN GET THIS FAR.                                *10890075
109000*----------------------------------------------------------------*10900075
109100 2000-PROCESS-PANEL.                                              10910075
109200                                                                  10920075
109300     EVALUATE TRUE                                                10930075
109400         WHEN DP020-SRC-AID = DP016-CLEAR                         10940075
109500              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                10950075
109600                                                                  10960075
109700              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  10970075
109800                                                                  10980075
109900         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     10990075
110000              SET DP030-DONT-ERASE                                11000075
110100                  DP030-SEND-DATAONLY (PC-APPL-MAP) TO TRUE       11010075
110200                                                                  11020075
110300              PERFORM 4000-BUILD-INITIAL-PANEL                    11030075
110400                                                                  11040075
110500              PERFORM 3200-RESET-ATTRIBUTES                       11050075
110600                                                                  11060075
110700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             11070075
110800              IF ASC-USE-SELECTION-QUEUE                          11080075
110900                  PERFORM 2110-GET-NEXT-VEND-DEPT                 11090075
111000                                                                  11100075
111100                  PERFORM 4000-BUILD-INITIAL-PANEL                11110075
111200                                                                  11120075
111300                  PERFORM 3200-RESET-ATTRIBUTES                   11130075
111400              ELSE                                                11140075
111500*                 --- BOTTOM OF LIST ---                          11150075
111600                  MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER        11160075
111700                  SET DP020-MSG-INFORMATIONAL TO TRUE             11170075
111800              END-IF                                              11180075
111900                                                                  11190075
112000         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             11200075
112100              IF ASC-USE-SELECTION-QUEUE                          11210075
112200                  PERFORM 2120-GET-PREV-VEND-DEPT                 11220075
112300                                                                  11230075
112400                  PERFORM 4000-BUILD-INITIAL-PANEL                11240075
112500                                                                  11250075
112600                  PERFORM 3200-RESET-ATTRIBUTES                   11260075
112700              ELSE                                                11270075
112800*                 --- TOP OF LIST ---                             11280075
112900                  MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER        11290075
113000                  SET DP020-MSG-INFORMATIONAL TO TRUE             11300075
113100              END-IF                                              11310075
113200                                                                  11320075
113300         WHEN OTHER                                               11330075
113400              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                11340075
113500                                                                  11350075
113600              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  11360075
113700                                                                  11370075
113800              IF PS-NO-ERROR                                      11380075
113900                  SET DP030-CONTINUE-GO TO TRUE                   11390075
114000                                                                  11400075
114100                  PERFORM 2100-CHECK-FUNCTION-KEY                 11410075
114200              ELSE                                                11420075
114300                  SET DP030-OVERRIDE-GO TO TRUE                   11430075
114400              END-IF                                              11440075
114500     END-EVALUATE.                                                11450075
114600                                                                  11460075
114700*----------------------------------------------------------------*11470075
114800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *11480075
114900* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *11490075
115000* FROM THE CICS ARCHITECTURE API.                                *11500075
115100*----------------------------------------------------------------*11510075
115200 2100-CHECK-FUNCTION-KEY.                                         11520075
115300                                                                  11530075
115400     EVALUATE TRUE                                                11540075
115500         WHEN DP020-SRC-AID = DP016-ENTER                         11550075
115600              CONTINUE                                            11560075
115700                                                                  11570075
115800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              11580075
115900              PERFORM 5000-UPDATE-VEND-DEPT                       11590075
116000                                                                  11600075
116100*             --- UPDATES SUCCESSFUL ---                          11610075
116200              MOVE PC-TSYMSG-00059 TO DP020-MSG-NUMBER            11620075
116300              SET DP030-CONTINUE-GO                               11630075
116400                  DP020-MSG-INFORMATIONAL TO TRUE                 11640075
116500                                                                  11650075
116600         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              11660075
116700              PERFORM 5500-ADD-VEND-DEPT                          11670075
116800                                                                  11680075
116900*             --- ADD SUCCESSFUL ---                              11690075
117000              MOVE PC-TSYMSG-00034 TO DP020-MSG-NUMBER            11700075
117100              SET ASC-ADD-COMPLETE                                11710075
117200                  DP030-ERASE-UNPROT                              11720075
117300                  DP030-CONTINUE-GO                               11730075
117400                  DP020-MSG-INFORMATIONAL TO TRUE                 11740075
117500                                                                  11750075
117600         WHEN OTHER                                               11760075
117700              SET DP013-CICS-ABEND                                11770075
117800                  DP013-NO-ROLLBACK                               11780075
117900                  DP013-XCTL-DISPLAY-RESTART TO TRUE              11790075
118000              MOVE '2000-PROCESS-PANEL' TO DP013-PARAGRAPH        11800075
118100              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     11810075
118200                                         TO DP013-MESSAGE-TEXT (1)11820075
118300              PERFORM DP013-0000-PROCESS-ABEND                    11830075
118400     END-EVALUATE.                                                11840075
118500                                                                  11850075
118600 2110-GET-NEXT-VEND-DEPT.                                         11860075
118700                                                                  11870075
118800     ADD +1 TO ASC-SEL-SUB.                                       11880075
118900                                                                  11890075
119000     IF ASC-SEL-SUB > VN003-MAX-ITEMS                             11900075
119100         ADD  +1 TO ASC-SEL-ITEM                                  11910075
119200         MOVE +1 TO ASC-SEL-SUB                                   11920075
119300     END-IF.                                                      11930075
119400                                                                  11940075
119500     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 11950075
119600         PERFORM 9100-READ-SEL-QUEUE                              11960075
119700                                                                  11970075
119800         IF VN003-ITEM (ASC-SEL-SUB) > ZERO                       11980075
119900             MOVE VN003-VEND-TYPE  (ASC-SEL-SUB) TO ASC-VEND-TYPE 11990075
120000             MOVE VN003-DEPARTMENT (ASC-SEL-SUB) TO               12000075
120100                                                   ASC-DEPT-NUMBER12010075
120200             MOVE VN003-ENT-ID     (ASC-SEL-SUB) TO ASC-ENT-ID    12020075
120300             SET  VN003-INQ        (ASC-SEL-SUB) TO TRUE          12030075
120400                                                                  12040075
120500             PERFORM 9200-REWRITE-LIST-QUEUE                      12050075
120600         ELSE                                                     12060075
120700             SUBTRACT +1 FROM ASC-SEL-SUB                         12070075
120800*            --- BOTTOM OF LIST ---                               12080075
120900             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             12090075
121000             SET DP020-MSG-INFORMATIONAL TO TRUE                  12100075
121100         END-IF                                                   12110075
121200     ELSE                                                         12120075
121300         SUBTRACT +1 FROM ASC-SEL-ITEM                            12130075
121400         MOVE VN003-MAX-ITEMS TO ASC-SEL-SUB                      12140075
121500         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER                 12150075
121600         SET DP020-MSG-INFORMATIONAL TO TRUE                      12160075
121700     END-IF.                                                      12170075
121800                                                                  12180075
121900 2120-GET-PREV-VEND-DEPT.                                         12190075
122000                                                                  12200075
122100     SUBTRACT +1 FROM ASC-SEL-SUB.                                12210075
122200                                                                  12220075
122300     IF ASC-SEL-SUB < +1                                          12230075
122400         SUBTRACT +1 FROM ASC-SEL-ITEM                            12240075
122500         MOVE VN003-MAX-ITEMS      TO ASC-SEL-SUB                 12250075
122600     END-IF.                                                      12260075
122700                                                                  12270075
122800     IF ASC-SEL-ITEM > ZERO                                       12280075
122900         PERFORM 9100-READ-SEL-QUEUE                              12290075
123000                                                                  12300075
123100         MOVE VN003-DEPARTMENT (ASC-SEL-SUB) TO ASC-DEPT-NUMBER   12310075
123200         MOVE VN003-ENT-ID     (ASC-SEL-SUB) TO ASC-ENT-ID        12320075
123300     ELSE                                                         12330075
123400         MOVE +1 TO ASC-SEL-ITEM                                  12340075
123500                    ASC-SEL-SUB                                   12350075
123600*        --- TOP OF LIST ---                                      12360075
123700         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 12370075
123800         SET DP020-MSG-INFORMATIONAL TO TRUE                      12380075
123900     END-IF.                                                      12390075
124000                                                                  12400075
124100*----------------------------------------------------------------*12410075
124200* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *12420075
124300* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *12430075
124400* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *12440075
124500*----------------------------------------------------------------*12450075
124600 2200-MOVE-SCREEN-TO-COMMAREA.                                    12460075
124700                                                                  12470075
124800     IF AVNDTYPL > ZERO                                           12480075
124900         MOVE AVNDTYPI  TO ASC-VEND-TYPE                          12490075
125000     ELSE                                                         12500075
125100         IF AVNDTYPF = DP015-ERASE-EOF                            12510075
125200             MOVE SPACE TO ASC-VEND-TYPE                          12520075
125300         END-IF                                                   12530075
125400     END-IF.                                                      12540075
125500                                                                  12550075
125600     IF ADPTNBRL > ZERO                                           12560075
125700         MOVE ADPTNBRI  TO ASC-DEPT-NUMBER                        12570075
125800     ELSE                                                         12580075
125900         IF  ADPTNBRF = DP015-ERASE-EOF                           12590075
126000             MOVE SPACE TO ASC-DEPT-NUMBER                        12600075
126100         END-IF                                                   12610075
126200     END-IF.                                                      12620075
126300                                                                  12630075
126400     IF AINHSL > ZERO                                             12640075
126500         MOVE AINHSI    TO ASC-INHOUSE-NUMBER                     12650075
126600     ELSE                                                         12660075
126700         IF  AINHSF = DP015-ERASE-EOF                             12670075
126800             MOVE SPACE TO ASC-INHOUSE-NUMBER                     12680075
126900         END-IF                                                   12690075
127000     END-IF.                                                      12700075
127100                                                                  12710075
127200     IF AINVCL > ZERO                                             12720075
127300         MOVE AINVCI    TO ASC-INVC-REQD                          12730075
127400     ELSE                                                         12740075
127500         IF  AINVCF = DP015-ERASE-EOF                             12750075
127600             MOVE SPACE TO ASC-INVC-REQD                          12760075
127700         END-IF                                                   12770075
127800     END-IF.                                                      12780075
127900                                                                  12790075
128000     IF ASTATL > ZERO                                             12800075
128100         MOVE ASTATI    TO ASC-STATUS                             12810075
128200                           PV-HOLD-STATUS                         12820075
128300     ELSE                                                         12830075
128400         IF  ASTATF = DP015-ERASE-EOF                             12840075
128500             MOVE SPACE TO ASC-STATUS                             12850075
128600                           PV-HOLD-STATUS                         12860075
128700         END-IF                                                   12870075
128800     END-IF.                                                      12880075
128900                                                                  12890080
129000     IF AEMAIL1L > ZERO                                           12900080
129100        MOVE AEMAIL1I  TO ASC-EMAIL-ADDR1                         12910080
129200     ELSE                                                         12920080
129300        IF  AEMAIL1F = DP015-ERASE-EOF                            12930080
129400            MOVE SPACE TO ASC-EMAIL-ADDR1                         12940080
129500        END-IF                                                    12950080
129600     END-IF.                                                      12960080
129700                                                                  12970080
129800     IF AEMAIL2L > ZERO                                           12980080
129900        MOVE AEMAIL2I  TO ASC-EMAIL-ADDR2                         12990080
130000     ELSE                                                         13000080
130100        IF  AEMAIL2F = DP015-ERASE-EOF                            13010080
130200            MOVE SPACE TO ASC-EMAIL-ADDR2                         13020080
130300        END-IF                                                    13030080
130400     END-IF.                                                      13040080
130500                                                                  13050080
130600     IF AEMAIL3L > ZERO                                           13060080
130700        MOVE AEMAIL3I  TO ASC-EMAIL-ADDR3                         13070080
130800     ELSE                                                         13080080
130900        IF  AEMAIL3F = DP015-ERASE-EOF                            13090080
131000            MOVE SPACE TO ASC-EMAIL-ADDR3                         13100080
131100        END-IF                                                    13110080
131200     END-IF.                                                      13120080
131300                                                                  13130080
131400     IF AEMAIL4L > ZERO                                           13140080
131500        MOVE AEMAIL4I  TO ASC-EMAIL-ADDR4                         13150080
131600     ELSE                                                         13160080
131700        IF  AEMAIL4F = DP015-ERASE-EOF                            13170080
131800            MOVE SPACE TO ASC-EMAIL-ADDR4                         13180080
131900        END-IF                                                    13190080
132000     END-IF.                                                      13200080
132100                                                                  13210080
132200*----------------------------------------------------------------*13220080
132300* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *13230080
132400* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *13240080
132500* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *13250080
132600*----------------------------------------------------------------*13260080
132700 3000-EDIT-DATA-IN-COMMAREA.                                      13270080
132800                                                                  13280080
132900     PERFORM 3200-RESET-ATTRIBUTES.                               13290080
133000                                                                  13300080
133100     IF ASC-STATUS    NOT = 'A' AND 'I'                           13310080
133200         SET PS-ERROR                                             13320080
133300             DP020-MSG-FATAL                                      13330080
133400             DP030-SET-CURSOR-APPL-1 TO TRUE                      13340080
133500         MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER          13350080
133600         MOVE DP015-UNP-ALP-BRT-OFF  TO ASTATA                    13360080
133700         MOVE DP015-RED              TO ASTATC                    13370080
133800         MOVE DP015-REVERSE          TO ASTATH                    13380080
133900         MOVE -1                     TO ASTATL                    13390080
134000     ELSE                                                         13400080
134100         MOVE ASC-STATUS    TO ASTATO                             13410080
134200     END-IF.                                                      13420080
134300                                                                  13430080
134400     IF ASC-INVC-REQD NOT = 'Y' AND 'N'                           13440080
134500         SET PS-ERROR                                             13450080
134600             DP020-MSG-FATAL                                      13460080
134700             DP030-SET-CURSOR-APPL-1 TO TRUE                      13470080
134800         MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER          13480080
134900         MOVE DP015-UNP-ALP-BRT-OFF  TO AINVCA                    13490080
135000         MOVE DP015-RED              TO AINVCC                    13500080
135100         MOVE DP015-REVERSE          TO AINVCH                    13510080
135200         MOVE -1                     TO AINVCL                    13520080
135300     ELSE                                                         13530080
135400         MOVE ASC-INVC-REQD TO AINVCO                             13540080
135500     END-IF.                                                      13550080
135600                                                                  13560080
135700     IF ASC-VEND-TYPE = 'M'                                       13570080
135800         IF ASC-INHOUSE-NUMBER = SPACES                           13580080
135900             SET PS-ERROR                                         13590080
136000                 DP020-MSG-FATAL                                  13600080
136100                 DP030-SET-CURSOR-APPL-1 TO TRUE                  13610080
136200             MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER      13620080
136300             MOVE DP015-UNP-ALP-BRT-OFF  TO AINHSA                13630080
136400             MOVE DP015-RED              TO AINHSC                13640080
136500             MOVE DP015-REVERSE          TO AINHSH                13650080
136600             MOVE -1                     TO AINHSL                13660080
136700         ELSE                                                     13670080
136800             MOVE ASC-INHOUSE-NUMBER   TO DP010I-UNEDITED-FIELD   13680080
136900             MOVE LENGTH OF ASC-INHOUSE-NUMBER                    13690080
137000                                       TO DP010I-MAXIMUM-DIGITS   13700080
137100             MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS 13710080
137200             SET DP010I-NEGATIVE-NOT-ALLOWED                      13720080
137300                                       TO TRUE                    13730080
137410             CALL DP010I-NUMERIC-EDIT-ROUTINE                     13741087
137420                         USING DP010I-NUMERIC-EDIT-AREA           13742087
137500             IF DP010I-ERROR-DETECTED                             13750080
137600                 SET PS-ERROR                                     13760080
137700                     DP020-MSG-FATAL                              13770080
137800                     DP030-SET-CURSOR-APPL-1 TO TRUE              13780080
137900                 MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER  13790080
138000                 MOVE DP015-UNP-ALP-BRT-OFF  TO AINHSA            13800080
138100                 MOVE DP015-RED              TO AINHSC            13810080
138200                 MOVE DP015-REVERSE          TO AINHSH            13820080
138300                 MOVE -1                     TO AINHSL            13830080
138400             ELSE                                                 13840080
138500                 MOVE DP010I-NUMERIC-FIELD TO ASC-INHOUSE-NUMBER-N13850080
138600                 MOVE ASC-INHOUSE-NUMBER-N TO AINHSO              13860080
138700             END-IF                                               13870080
138800         END-IF                                                   13880080
138900     END-IF.                                                      13890080
139000                                                                  13900080
139100     IF (ASC-VEND-TYPE = 'M') AND                                 13910082
139200        (ASC-STATUS = 'A')                                        13920082
139300        MOVE ASC-EMAIL-ADDR1 TO PV-EMAIL-ADDR1                    13930080
139400        MOVE ASC-EMAIL-ADDR2 TO PV-EMAIL-ADDR2                    13940080
139500        MOVE ASC-EMAIL-ADDR3 TO PV-EMAIL-ADDR3                    13950080
139600        MOVE ASC-EMAIL-ADDR4 TO PV-EMAIL-ADDR4                    13960080
139700        IF PV-VNDDPT-EMAIL-ADDR-ID = SPACES                       13970080
139800           SET PS-ERROR                                           13980080
139900               DP020-MSG-FATAL                                    13990080
140000               DP030-SET-CURSOR-APPL-1 TO TRUE                    14000080
140100           MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER        14010080
140200           MOVE DP015-UNP-ALP-BRT-OFF  TO AEMAIL1A                14020080
140300                                          AEMAIL2A                14030080
140400                                          AEMAIL3A                14040080
140500                                          AEMAIL4A                14050080
140600           MOVE DP015-RED              TO AEMAIL1C                14060080
140700                                          AEMAIL2C                14070080
140800                                          AEMAIL3C                14080080
140900                                          AEMAIL4C                14090080
141000           MOVE DP015-REVERSE          TO AEMAIL1H                14100080
141100                                          AEMAIL2H                14110080
141200                                          AEMAIL3H                14120080
141300                                          AEMAIL4H                14130080
141400           MOVE -1                     TO AEMAIL1L                14140080
141500        ELSE                                                      14150080
141600           MOVE ASC-EMAIL-ADDR1 TO AEMAIL1O                       14160080
141700           MOVE ASC-EMAIL-ADDR2 TO AEMAIL2O                       14170080
141800           MOVE ASC-EMAIL-ADDR3 TO AEMAIL3O                       14180080
141900           MOVE ASC-EMAIL-ADDR4 TO AEMAIL4O                       14190080
142000        END-IF                                                    14200080
142100     END-IF.                                                      14210080
142200                                                                  14220080
142300     IF ASC-DEPT-NUMBER = SPACES                                  14230080
142400         SET PS-ERROR                                             14240080
142500             DP020-MSG-FATAL                                      14250080
142600             DP030-SET-CURSOR-APPL-1 TO TRUE                      14260080
142700         MOVE PC-TSYMSG-00007        TO DP020-MSG-NUMBER          14270080
142800         MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTNBRA                  14280080
142900         MOVE DP015-RED              TO ADPTNBRC                  14290080
143000         MOVE DP015-REVERSE          TO ADPTNBRH                  14300080
143100         MOVE -1                     TO ADPTNBRL                  14310080
143200     ELSE                                                         14320080
143300         MOVE ASC-DEPT-NUMBER      TO DP010I-UNEDITED-FIELD       14330080
143400         MOVE LENGTH OF ASC-DEPT-NUMBER                           14340080
143500                                   TO DP010I-MAXIMUM-DIGITS       14350080
143600         MOVE ZERO                 TO DP010I-MAXIMUM-DECIMALS     14360080
143700         SET DP010I-NEGATIVE-NOT-ALLOWED                          14370080
143800                                   TO TRUE                        14380080
143910         CALL DP010I-NUMERIC-EDIT-ROUTINE                         14391087
143920                         USING DP010I-NUMERIC-EDIT-AREA           14392087
144000         IF DP010I-ERROR-DETECTED                                 14400080
144100             SET PS-ERROR                                         14410080
144200                 DP020-MSG-FATAL                                  14420080
144300                 DP030-SET-CURSOR-APPL-1 TO TRUE                  14430080
144400             MOVE PC-TSYMSG-00008        TO DP020-MSG-NUMBER      14440080
144500             MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTNBRA              14450080
144600             MOVE DP015-RED              TO ADPTNBRC              14460080
144700             MOVE DP015-REVERSE          TO ADPTNBRH              14470080
144800             MOVE -1                     TO ADPTNBRL              14480080
144900         ELSE                                                     14490080
145000             MOVE DP010I-NUMERIC-FIELD TO ASC-DEPT-NUMBER-N       14500080
145100             MOVE ASC-DEPT-NUMBER-N    TO ADPTNBRO                14510080
145200         END-IF                                                   14520080
145300     END-IF.                                                      14530080
145400                                                                  14540080
145500     IF ASC-VEND-TYPE NOT = 'M' AND 'E'                           14550080
145600         SET PS-ERROR                                             14560080
145700             DP020-MSG-FATAL                                      14570080
145800             DP030-SET-CURSOR-APPL-1 TO TRUE                      14580080
145900         MOVE PC-TSYMSG-00005        TO DP020-MSG-NUMBER          14590080
146000         MOVE DP015-UNP-ALP-BRT-OFF  TO AVNDTYPA                  14600080
146100         MOVE DP015-RED              TO AVNDTYPC                  14610080
146200         MOVE DP015-REVERSE          TO AVNDTYPH                  14620080
146300         MOVE -1                     TO AVNDTYPL                  14630080
146400     ELSE                                                         14640080
146500         MOVE ASC-VEND-TYPE TO AVNDTYPO                           14650080
146600     END-IF.                                                      14660080
146700                                                                  14670080
146800     IF PS-NO-ERROR                                               14680080
146900         EVALUATE DP020-INT-APPL-FORMAT-IND                       14690080
147000             WHEN PC-INTER-APPL-ADD                               14700080
147100                  PERFORM 3400-EDIT-ADD                           14710080
147200                                                                  14720080
147300             WHEN PC-INTER-APPL-UPDATE                            14730080
147400                  PERFORM 3600-EDIT-UPDATE                        14740080
147500         END-EVALUATE                                             14750080
147600     END-IF.                                                      14760080
147700                                                                  14770080
147800     IF PS-NO-ERROR                                               14780080
147900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      14790080
148000         IF DP020-INT-APPL-FORMAT-IND = '1'                       14800080
148100             MOVE -1 TO AVNDTYPL                                  14810080
148200         ELSE                                                     14820080
148300             IF DP020-INT-APPL-FORMAT-IND = '2'                   14830080
148400                 IF ASC-VEND-TYPE = 'M'                           14840080
148500                     MOVE -1 TO AINHSL                            14850080
148600                 ELSE                                             14860080
148700                     IF ASC-VEND-TYPE = 'E'                       14870080
148800                         MOVE -1 TO AINVCL                        14880080
148900                     END-IF                                       14890080
149000                 END-IF                                           14900080
149100             END-IF                                               14910080
149200         END-IF                                                   14920080
149300     END-IF.                                                      14930080
149400                                                                  14940080
149500 3200-RESET-ATTRIBUTES.                                           14950080
149600                                                                  14960080
149700     IF DP020-INT-APPL-FORMAT-IND = '2'                           14970080
149800         MOVE DP015-PRO-NOR-OFF TO AVNDTYPA                       14980080
149900                                   ADPTNBRA                       14990080
150000         MOVE DP015-BLUE        TO AVNDTYPC                       15000080
150100                                   ADPTNBRC                       15010080
150200         MOVE DP015-HL-OFF      TO AVNDTYPH                       15020080
150300                                   ADPTNBRH                       15030080
150400         IF ASC-VEND-TYPE = 'M'                                   15040080
150500             MOVE DP015-UNP-ALP-NOR-OFF TO AINHSA                 15050080
150600             MOVE DP015-GREEN           TO AINHSC                 15060080
150700             MOVE DP015-UNDERLINE       TO AINHSH                 15070080
150800             MOVE DP015-UNP-ALP-NOR-OFF TO ASTATA                 15080080
150900             MOVE DP015-GREEN           TO ASTATC                 15090080
151000             MOVE DP015-UNDERLINE       TO ASTATH                 15100080
151100             MOVE DP015-PRO-NOR-OFF     TO AINVCA                 15110080
151200             MOVE DP015-BLUE            TO AINVCC                 15120080
151300             MOVE DP015-HL-OFF          TO AINVCH                 15130080
151400             MOVE DP015-UNP-ALP-NOR-OFF TO AEMAIL1A               15140080
151500             MOVE DP015-GREEN           TO AEMAIL1C               15150080
151600             MOVE DP015-UNDERLINE       TO AEMAIL1H               15160080
151700             MOVE DP015-UNP-ALP-NOR-OFF TO AEMAIL2A               15170080
151800             MOVE DP015-GREEN           TO AEMAIL2C               15180080
151900             MOVE DP015-UNDERLINE       TO AEMAIL2H               15190080
152000             MOVE DP015-UNP-ALP-NOR-OFF TO AEMAIL3A               15200080
152100             MOVE DP015-GREEN           TO AEMAIL3C               15210080
152200             MOVE DP015-UNDERLINE       TO AEMAIL3H               15220080
152300             MOVE DP015-UNP-ALP-NOR-OFF TO AEMAIL4A               15230080
152400             MOVE DP015-GREEN           TO AEMAIL4C               15240080
152500             MOVE DP015-UNDERLINE       TO AEMAIL4H               15250080
152600         ELSE                                                     15260080
152700             IF ASC-VEND-TYPE = 'E'                               15270080
152800                 MOVE DP015-PRO-NOR-OFF     TO AINHSA             15280080
152900                 MOVE DP015-BLUE            TO AINHSC             15290080
153000                 MOVE DP015-HL-OFF          TO AINHSH             15300080
153100                 MOVE DP015-PRO-NOR-OFF     TO ASTATA             15310080
153200                 MOVE DP015-BLUE            TO ASTATC             15320080
153300                 MOVE DP015-HL-OFF          TO ASTATH             15330080
153400                 MOVE DP015-UNP-ALP-NOR-OFF TO AINVCA             15340080
153500                 MOVE DP015-GREEN           TO AINVCC             15350080
153600                 MOVE DP015-UNDERLINE       TO AINVCH             15360080
153700                 MOVE DP015-PRO-NOR-OFF     TO AEMAIL1A           15370080
153800                 MOVE DP015-BLUE            TO AEMAIL1C           15380080
153900                 MOVE DP015-HL-OFF          TO AEMAIL1H           15390080
154000                 MOVE DP015-PRO-NOR-OFF     TO AEMAIL2A           15400080
154100                 MOVE DP015-BLUE            TO AEMAIL2C           15410080
154200                 MOVE DP015-HL-OFF          TO AEMAIL2H           15420080
154300                 MOVE DP015-PRO-NOR-OFF     TO AEMAIL3A           15430080
154400                 MOVE DP015-BLUE            TO AEMAIL3C           15440080
154500                 MOVE DP015-HL-OFF          TO AEMAIL3H           15450080
154600                 MOVE DP015-PRO-NOR-OFF     TO AEMAIL4A           15460080
154700                 MOVE DP015-BLUE            TO AEMAIL4C           15470080
154800                 MOVE DP015-HL-OFF          TO AEMAIL4H           15480080
154900             END-IF                                               15490080
155000         END-IF                                                   15500080
155100     ELSE                                                         15510080
155200         MOVE DP015-UNP-ALP-NOR-OFF TO AVNDTYPA                   15520080
155300                                       ADPTNBRA                   15530080
155400                                       AINHSA                     15540080
155500                                       AINVCA                     15550080
155600                                       AEMAIL1A                   15560080
155700                                       AEMAIL2A                   15570080
155800                                       AEMAIL3A                   15580080
155900                                       AEMAIL4A                   15590080
156000         MOVE DP015-GREEN           TO AVNDTYPC                   15600080
156100                                       ADPTNBRC                   15610080
156200                                       AINHSC                     15620080
156300                                       AINVCC                     15630080
156400                                       AEMAIL1C                   15640080
156500                                       AEMAIL2C                   15650080
156600                                       AEMAIL3C                   15660080
156700                                       AEMAIL4C                   15670080
156800         MOVE DP015-UNDERLINE       TO AVNDTYPH                   15680080
156900                                       ADPTNBRH                   15690080
157000                                       AINHSH                     15700080
157100                                       AINVCH                     15710080
157200                                       AEMAIL1H                   15720080
157300                                       AEMAIL2H                   15730080
157400                                       AEMAIL3H                   15740080
157500                                       AEMAIL4H                   15750080
157600     END-IF.                                                      15760080
157700                                                                  15770080
157800******************************************************************15780080
157900*   VALIDATE DEPARTMENT NUMBER                                    15790080
158000*   CHECK FOR DUPLICATE DEPARTMENT NUMBER                         15800080
158100*   CHECK FOR DUPLICATE INHOUSE NUMBER                            15810080
158200*   CHECK IF AUTHORIZED TO ADD / UPDATE DEPARTMENT                15820080
158300******************************************************************15830080
158400 3400-EDIT-ADD.                                                   15840080
158500                                                                  15850080
158600     MOVE ASC-ENT-ID              TO DK-ENT-ID.                   15860080
158700     MOVE ASC-DEPT-NUMBER         TO DK-DEPT-NBR.                 15870080
158800     MOVE ASC-INHOUSE-NUMBER-N    TO DK-INHOUSE-NUMBER.           15880080
158900     MOVE DP020-OPERATING-COMPANY TO DK-OPERATING-COMPANY.        15890080
159000                                                                  15900080
159100     IF ASC-VEND-TYPE = 'E'                                       15910080
159200         PERFORM 3410-VALIDATE-EXP-DEPT                           15920080
159300     ELSE                                                         15930080
159400         PERFORM 3420-VALIDATE-MDSE-DEPT                          15940080
159500     END-IF.                                                      15950080
159600                                                                  15960080
159700     IF SQLCODE = +100                                            15970080
159800         SET DP020-MSG-FATAL                                      15980080
159900             PS-ERROR                                             15990080
160000             DP030-SET-CURSOR-APPL-1 TO TRUE                      16000080
160100*        --- INVALID DEPARTMENT ---                               16010080
160200         MOVE PC-TSYMSG-00032        TO DP020-MSG-NUMBER          16020080
160300         MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTNBRA                  16030080
160400         MOVE DP015-RED              TO ADPTNBRC                  16040080
160500         MOVE DP015-REVERSE          TO ADPTNBRH                  16050080
160600         MOVE -1                     TO ADPTNBRL                  16060080
160700     ELSE                                                         16070080
160800         PERFORM 3430-VALIDATE-EXIST-DEPT                         16080080
160900                                                                  16090080
161000         IF SQLCODE = ZERO                                        16100080
161100             SET DP020-MSG-FATAL                                  16110080
161200                 PS-ERROR                                         16120080
161300                 DP030-SET-CURSOR-APPL-1 TO TRUE                  16130080
161400*            --- DEPARTMENT ALREADY EXISTS ---                    16140080
161500             MOVE PC-TSYMSG-00478        TO DP020-MSG-NUMBER      16150080
161600             MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTNBRA              16160080
161700             MOVE DP015-RED              TO ADPTNBRC              16170080
161800             MOVE DP015-REVERSE          TO ADPTNBRH              16180080
161900             MOVE -1                     TO ADPTNBRL              16190080
162000         ELSE                                                     16200080
162100             IF ASC-VEND-TYPE NOT = 'E'                           16210080
162200                 PERFORM 3440-VALIDATE-EXIST-INHS                 16220080
162300                                                                  16230080
162400                 IF SQLCODE NOT = +100                            16240080
162500                     SET PS-ERROR                                 16250080
162600                         DP020-MSG-FATAL                          16260080
162700                         DP030-SET-CURSOR-APPL-1 TO TRUE          16270080
162800*                    --- INHOUSE ALREADY EXISTS ---               16280080
162900                     MOVE PC-TSYMSG-00475 TO DP020-MSG-NUMBER     16290080
163000                     MOVE DP015-UNP-ALP-BRT-OFF TO AINHSA         16300080
163100                     MOVE DP015-RED             TO AINHSC         16310080
163200                     MOVE DP015-REVERSE         TO AINHSH         16320080
163300                     MOVE -1                    TO AINHSL         16330080
163400                 END-IF                                           16340080
163500             END-IF                                               16350080
163600         END-IF                                                   16360080
163700     END-IF.                                                      16370080
163800                                                                  16380080
163900     IF PS-NO-ERROR                                               16390080
164000         IF ASC-VEND-TYPE = 'E'                                   16400080
164100             PERFORM 3700-VERIFY-IF-EXP-VENDOR                    16410080
164200         ELSE                                                     16420080
164300             PERFORM 3800-VERIFY-IF-MERCH-VENDOR                  16430080
164400         END-IF                                                   16440080
164500     END-IF.                                                      16450080
164600                                                                  16460080
164700     IF PS-NO-ERROR                                               16470080
164800         IF ASC-VEND-TYPE = 'E'                                   16480080
164900             PERFORM 3450-CHECK-EXP-DEPT-AUTH                     16490080
165000         ELSE                                                     16500080
165100             PERFORM 3460-CHECK-MDSE-DEPT-AUTH                    16510080
165200         END-IF                                                   16520080
165300     END-IF.                                                      16530080
165400                                                                  16540080
165500     IF PS-NO-ERROR                                               16550080
165600         IF PV-DB2-COUNT = ZERO                                   16560080
165700             SET DP020-MSG-FATAL                                  16570080
165800                 PS-ERROR                                         16580080
165900                 DP030-SET-CURSOR-APPL-1 TO TRUE                  16590080
166000*            --- NOT AUTHORIZED FOR DEPT ---                      16600080
166100             MOVE PC-TSYMSG-00014        TO DP020-MSG-NUMBER      16610080
166200             MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTNBRA              16620080
166300             MOVE DP015-RED              TO ADPTNBRC              16630080
166400             MOVE DP015-REVERSE          TO ADPTNBRH              16640080
166500             MOVE -1                     TO ADPTNBRL              16650080
166600         END-IF                                                   16660080
166700     END-IF.                                                      16670080
166800                                                                  16680080
166900******************************************************************16690080
167000*   VALIDATE AN EXPENSE DEPARTMENT                                16700080
167100******************************************************************16710080
167200 3410-VALIDATE-EXP-DEPT.                                          16720080
167300                                                                  16730080
167400     PERFORM WITH TEST AFTER                                      16740080
167500             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 16750080
167600               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         16760080
167700                     SQLCODE = ZERO OR                            16770080
167800                     SQLCODE = +100                               16780080
167900        EXEC SQL                                                  16790080
168000                SELECT ORGUNT_NICK_NAME                           16800080
168100                  INTO :ORGUNT-ORGUNT-NICK-NAME                   16810080
168200                  FROM TORGUNT                                    16820080
168300                 WHERE ORGUNT_NICK_NAME = :DK-DEPT-NBR            16830080
168400                   AND ORGUNT_TYP_CDE   = '01'                    16840080
168500        END-EXEC                                                  16850080
168600                                                                  16860080
168700        EVALUATE TRUE                                             16870080
168800            WHEN SQLCODE = ZERO                                   16880080
168900            WHEN SQLCODE = +100                                   16890080
169000            WHEN SQLCODE = -904                                   16900080
169100            WHEN SQLCODE = -913                                   16910080
169200                CONTINUE                                          16920080
169300                                                                  16930080
169400            WHEN SQLWARN0 NOT = SPACES                            16940080
169500            WHEN SQLCODE < ZERO                                   16950080
169600            WHEN SQLCODE > ZERO                                   16960080
169700                MOVE '3410-VALIDATE-EXP-DEPT'                     16970080
169800                                  TO DP013-PARAGRAPH              16980080
169900                MOVE 'SELECT MERCHANDISE DEPT:'                   16990080
170000                                  TO DP013-MESSAGE-TEXT (1)       17000080
170100                MOVE DK-DEPT-NBR                                  17010080
170200                                  TO DP013-MESSAGE-TEXT (2)       17020080
170300                MOVE SQLCA        TO DP013-SQLCA                  17030080
170400                MOVE 'TMDSEAR'    TO DP013-DB2-TABLE-NAME (1)     17040080
170500                SET DP013-DB2-ABEND                               17050080
170600                    DP013-XCTL-DISPLAY-RESTART TO TRUE            17060080
170700                PERFORM DP013-0000-PROCESS-ABEND                  17070080
170800        END-EVALUATE                                              17080080
170900     END-PERFORM.                                                 17090080
171000                                                                  17100080
171100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17110080
171200         MOVE '3410-VALIDATE-EXP-DEPT'                            17120080
171300                                   TO DP013-PARAGRAPH             17130080
171400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     17140080
171500                                   TO DP013-MESSAGE-TEXT (1)      17150080
171600         MOVE 'EXPENSE DEPARTMENT:'                               17160080
171700                                   TO DP013-MESSAGE-TEXT (2)      17170080
171800         MOVE DK-DEPT-NBR          TO DP013-MESSAGE-TEXT (3)      17180080
171900         MOVE SQLCA                TO DP013-SQLCA                 17190080
172000         MOVE 'TORGUNT'            TO DP013-DB2-TABLE-NAME (1)    17200080
172100         SET DP013-DB2-ABEND                                      17210080
172200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   17220080
172300         PERFORM DP013-0000-PROCESS-ABEND                         17230080
172400     END-IF.                                                      17240080
172500                                                                  17250080
172600******************************************************************17260080
172700*   VALIDATE A MERCHANDISE DEPARTMENT                             17270080
172800******************************************************************17280080
172900 3420-VALIDATE-MDSE-DEPT.                                         17290080
173000                                                                  17300080
173100     PERFORM WITH TEST AFTER                                      17310080
173200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 17320080
173300               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         17330080
173400                     SQLCODE = ZERO OR                            17340080
173500                     SQLCODE = +100                               17350080
173600        EXEC SQL                                                  17360080
173700                SELECT DEPT_NBR                                   17370080
173800                  INTO :MDSEAR-DEPT-NBR                           17380080
173900                  FROM TMDSEAR                                    17390080
174000                 WHERE OPERCO_NBR = :DK-OPERATING-COMPANY         17400080
174100                   AND DEPT_NBR   = :DK-DEPT-NBR                  17410080
174200                   AND MDSELV_CDE = 'DPT'                         17420080
174300                   AND STRT_DTE  <= CURRENT DATE                  17430080
174400                   AND END_DTE   >= CURRENT DATE                  17440080
174500        END-EXEC                                                  17450080
174600                                                                  17460080
174700        EVALUATE TRUE                                             17470080
174800            WHEN SQLCODE = ZERO                                   17480080
174900            WHEN SQLCODE = +100                                   17490080
175000            WHEN SQLCODE = -904                                   17500080
175100            WHEN SQLCODE = -913                                   17510080
175200                CONTINUE                                          17520080
175300                                                                  17530080
175400            WHEN SQLWARN0 NOT = SPACES                            17540080
175500            WHEN SQLCODE < ZERO                                   17550080
175600            WHEN SQLCODE > ZERO                                   17560080
175700                MOVE '3420-VALIDATE-MDSE-DEPT'                    17570080
175800                                  TO DP013-PARAGRAPH              17580080
175900                MOVE 'SELECT MERCHANDISE DEPT:'                   17590080
176000                                  TO DP013-MESSAGE-TEXT (1)       17600080
176100                MOVE DK-DEPT-NBR                                  17610080
176200                                  TO DP013-MESSAGE-TEXT (2)       17620080
176300                MOVE SQLCA        TO DP013-SQLCA                  17630080
176400                MOVE 'TMDSEAR'    TO DP013-DB2-TABLE-NAME (1)     17640080
176500                SET DP013-DB2-ABEND                               17650080
176600                    DP013-XCTL-DISPLAY-RESTART TO TRUE            17660080
176700                PERFORM DP013-0000-PROCESS-ABEND                  17670080
176800        END-EVALUATE                                              17680080
176900     END-PERFORM.                                                 17690080
177000                                                                  17700080
177100     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         17710080
177200         MOVE '3420-VALIDATE-MDSE-DEPT'                           17720080
177300                                   TO DP013-PARAGRAPH             17730080
177400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     17740080
177500                                   TO DP013-MESSAGE-TEXT (1)      17750080
177600         MOVE 'MERCHANDISE DEPARTMENT:'                           17760080
177700                                   TO DP013-MESSAGE-TEXT (2)      17770080
177800         MOVE DK-DEPT-NBR          TO DP013-MESSAGE-TEXT (3)      17780080
177900         MOVE SQLCA                TO DP013-SQLCA                 17790080
178000         MOVE 'TMDSEAR'            TO DP013-DB2-TABLE-NAME (1)    17800080
178100         SET DP013-DB2-ABEND                                      17810080
178200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   17820080
178300         PERFORM DP013-0000-PROCESS-ABEND                         17830080
178400     END-IF.                                                      17840080
178500                                                                  17850080
178600******************************************************************17860080
178700*   VALIDATE IF THE DEPARTMENT ALREADY EXISTS                     17870080
178800******************************************************************17880080
178900 3430-VALIDATE-EXIST-DEPT.                                        17890080
179000                                                                  17900080
179100     PERFORM WITH TEST AFTER                                      17910080
179200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 17920080
179300               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         17930080
179400                     SQLCODE = ZERO OR                            17940080
179500                     SQLCODE = +100                               17950080
179600                                                                  17960080
179700        EXEC SQL                                                  17970080
179800                SELECT DEPT_NBR                                   17980080
179900                  INTO :VNDDPT-DEPT-NBR                           17990080
180000                  FROM TVNDDPT                                    18000080
180100                 WHERE DEPT_NBR = :DK-DEPT-NBR                    18010080
180200                   AND ENT_ID   = :DK-ENT-ID                      18020080
180300        END-EXEC                                                  18030080
180400                                                                  18040080
180500        EVALUATE TRUE                                             18050080
180600            WHEN SQLCODE = ZERO                                   18060080
180700            WHEN SQLCODE = +100                                   18070080
180800            WHEN SQLCODE = -904                                   18080080
180900            WHEN SQLCODE = -913                                   18090080
181000                 CONTINUE                                         18100080
181100                                                                  18110080
181200            WHEN SQLWARN0 NOT = SPACES                            18120080
181300            WHEN SQLCODE < ZERO                                   18130080
181400            WHEN SQLCODE > ZERO                                   18140080
181500                 MOVE '3430-VALIDATE-EXIST-DEPT'                  18150080
181600                                       TO DP013-PARAGRAPH         18160080
181700                 MOVE 'SELECT TVNDDPT ROW'                        18170080
181800                                       TO DP013-MESSAGE-TEXT (1)  18180080
181900                 MOVE SQLCA            TO DP013-SQLCA             18190080
182000                 MOVE 'TVNDDPT'        TO DP013-DB2-TABLE-NAME (1)18200080
182100                 SET DP013-DB2-ABEND                              18210080
182200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18220080
182300                 PERFORM DP013-0000-PROCESS-ABEND                 18230080
182400        END-EVALUATE                                              18240080
182500     END-PERFORM.                                                 18250080
182600                                                                  18260080
182700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18270080
182800         MOVE '3430-VALIDATE-EXIST-DEPT'                          18280080
182900                                   TO DP013-PARAGRAPH             18290080
183000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     18300080
183100                                   TO DP013-MESSAGE-TEXT (1)      18310080
183200         MOVE 'TVNDDPT'                                           18320080
183300                                   TO DP013-MESSAGE-TEXT (2)      18330080
183400         MOVE SQLCA                TO DP013-SQLCA                 18340080
183500         MOVE 'TVNDDPT'            TO DP013-DB2-TABLE-NAME (1)    18350080
183600         SET DP013-DB2-ABEND                                      18360080
183700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18370080
183800         PERFORM DP013-0000-PROCESS-ABEND                         18380080
183900     END-IF.                                                      18390080
184000                                                                  18400080
184100******************************************************************18410080
184200*   VALIDATE IF THE INHOUSE ALREADY EXISTS                        18420080
184300******************************************************************18430080
184400 3440-VALIDATE-EXIST-INHS.                                        18440080
184500                                                                  18450080
184600     PERFORM WITH TEST AFTER                                      18460080
184700             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 18470080
184800               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         18480080
184900                     SQLCODE = ZERO OR                            18490080
185000                     SQLCODE = +100                               18500080
185100                                                                  18510080
185200        EXEC SQL                                                  18520080
185300                SELECT DEPT_NBR                                   18530080
185400                  INTO :VNDDPT-DEPT-NBR                           18540080
185500                  FROM TVNDDPT                                    18550080
185600                 WHERE DEPT_NBR    = :DK-DEPT-NBR                 18560080
185700                   AND INHOUSE_NBR = :DK-INHOUSE-NUMBER           18570080
185800                   AND NOT ENT_ID  = :DK-ENT-ID                   18580080
185900        END-EXEC                                                  18590080
186000                                                                  18600080
186100        EVALUATE TRUE                                             18610080
186200            WHEN SQLCODE = ZERO                                   18620080
186300            WHEN SQLCODE = +100                                   18630080
186400            WHEN SQLCODE = -904                                   18640080
186500            WHEN SQLCODE = -913                                   18650080
186600                CONTINUE                                          18660080
186700                                                                  18670080
186800            WHEN SQLWARN0 NOT = SPACES                            18680080
186900            WHEN SQLCODE < ZERO                                   18690080
187000            WHEN SQLCODE > ZERO                                   18700080
187100                 MOVE '3440-VALIDATE-EXIST-INHS'                  18710080
187200                                   TO DP013-PARAGRAPH             18720080
187300                 MOVE 'SELECT TVNDDPT'                            18730080
187400                                   TO DP013-MESSAGE-TEXT (1)      18740080
187500                 MOVE SQLCA        TO DP013-SQLCA                 18750080
187600                 MOVE 'TVNDDPT'    TO DP013-DB2-TABLE-NAME (1)    18760080
187700                 SET DP013-DB2-ABEND                              18770080
187800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           18780080
187900                 PERFORM DP013-0000-PROCESS-ABEND                 18790080
188000         END-EVALUATE                                             18800080
188100     END-PERFORM.                                                 18810080
188200                                                                  18820080
188300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         18830080
188400         MOVE '3440-VALIDATE-EXIST-INHS' TO DP013-PARAGRAPH       18840080
188500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     18850080
188600                                    TO DP013-MESSAGE-TEXT (1)     18860080
188700         MOVE 'TVNDDPT'             TO DP013-MESSAGE-TEXT (2)     18870080
188800         MOVE SQLCA                 TO DP013-SQLCA                18880080
188900         MOVE 'TVNDDPT'             TO DP013-DB2-TABLE-NAME (1)   18890080
189000         SET DP013-DB2-ABEND                                      18900080
189100             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18910080
189200         PERFORM DP013-0000-PROCESS-ABEND                         18920080
189300     END-IF.                                                      18930080
189400                                                                  18940080
189500******************************************************************18950080
189600*   CHECK IF USER IS AUTHORIZED TO UPDATE THIS EXPENSE DEPT.      18960080
189700******************************************************************18970080
189800 3450-CHECK-EXP-DEPT-AUTH.                                        18980080
189900                                                                  18990080
190000     PERFORM WITH TEST AFTER                                      19000080
190100             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 19010080
190200               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         19020080
190300                     SQLCODE = ZERO OR                            19030080
190400                     SQLCODE = +100                               19040080
190500                                                                  19050080
190600        EXEC SQL                                                  19060080
190700                SELECT COUNT(*)                                   19070080
190800                  INTO :PV-DB2-COUNT                              19080080
190900                  FROM TORGUNT A                                  19090080
191000                      ,TORGWRK B                                  19100080
191100                 WHERE A.ORGUNT_NICK_NAME = :DK-DEPT-NBR          19110080
191200                   AND A.ORGUNT_TYP_CDE   = '01'                  19120080
191300                   AND B.ORGUNT_ID        = A.ORGUNT_ID           19130080
191400                   AND B.WORKER_NBR       =                       19140080
191500                       (SELECT WORKER_NBR                         19150080
191600                          FROM TWORKER                            19160080
191700                         WHERE OPERCO_NBR = '03'                  19170080
191800                           AND UID_NBR    = :DP020-USERID)        19180080
191900        END-EXEC                                                  19190080
192000                                                                  19200080
192100        EVALUATE TRUE                                             19210080
192200            WHEN SQLCODE = ZERO                                   19220080
192300            WHEN SQLCODE = +100                                   19230080
192400            WHEN SQLCODE = -904                                   19240080
192500            WHEN SQLCODE = -913                                   19250080
192600                 CONTINUE                                         19260080
192700                                                                  19270080
192800            WHEN SQLWARN0 NOT = SPACES                            19280080
192900            WHEN SQLCODE < ZERO                                   19290080
193000            WHEN SQLCODE > ZERO                                   19300080
193100                 MOVE '3450-CHECK-EXP-DEPT-AUTH'                  19310080
193200                                     TO DP013-PARAGRAPH           19320080
193300                 MOVE 'VALIDATE EXPENSE DEPT: '                   19330080
193400                                     TO DP013-MESSAGE-TEXT (1)    19340080
193500                 MOVE DK-DEPT-NBR    TO DP013-MESSAGE-TEXT (2)    19350080
193600                 MOVE SQLCA          TO DP013-SQLCA               19360080
193700                 MOVE 'TORGUNT'      TO DP013-DB2-TABLE-NAME (1)  19370080
193800                 SET DP013-DB2-ABEND                              19380080
193900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           19390080
194000                 PERFORM DP013-0000-PROCESS-ABEND                 19400080
194100         END-EVALUATE                                             19410080
194200     END-PERFORM.                                                 19420080
194300                                                                  19430080
194400     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         19440080
194500         MOVE '3450-CHECK-EXP-DEPT-AUTH' TO DP013-PARAGRAPH       19450080
194600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO VALIDATE '  19460080
194700                                    TO DP013-MESSAGE-TEXT (1)     19470080
194800         MOVE 'EXPENSE DEPARTMENT:'                               19480080
194900                                    TO DP013-MESSAGE-TEXT (2)     19490080
195000         MOVE DK-DEPT-NBR           TO DP013-MESSAGE-TEXT (3)     19500080
195100         MOVE SQLCA                 TO DP013-SQLCA                19510080
195200         MOVE 'TORGUNT'             TO DP013-DB2-TABLE-NAME (1)   19520080
195300         SET DP013-DB2-ABEND                                      19530080
195400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   19540080
195500         PERFORM DP013-0000-PROCESS-ABEND                         19550080
195600     END-IF.                                                      19560080
195700                                                                  19570080
195800******************************************************************19580080
195900*   CHECK IF USER IS AUTHORIZED TO UPDATE THIS MERCHANDISE DEPT.  19590080
196000******************************************************************19600080
196100 3460-CHECK-MDSE-DEPT-AUTH.                                       19610080
196200                                                                  19620080
196300     PERFORM                                                      19630080
196400         WITH TEST AFTER                                          19640080
196500         VARYING PV-RETRY-COUNTER                                 19650080
196600         FROM 1 BY 1                                              19660080
196700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19670080
196800             OR (SQLCODE = +0)                                    19680080
196900             OR (SQLCODE = +100))                                 19690080
197000                                                                  19700080
197100         EXEC SQL                                                 19710080
197200              SELECT COUNT(*)                                     19720080
197300                INTO :PV-DB2-COUNT                                19730080
197400                FROM TMDSEAR A                                    19740080
197500                    ,TRSPBAR B                                    19750080
197600               WHERE A.MDSEAR_DKEY     = B.MDSEAR_DKEY            19760080
197700                 AND A.DEPT_NBR        = :DK-DEPT-NBR             19770080
197800                 AND A.MDSELV_CDE      = 'DPT'                    19780080
197900                 AND A.OPERCO_NBR      = '03'                     19790080
198000                 AND B.WORKER_STRT_DTE <= CURRENT DATE            19800080
198100                 AND B.WORKER_END_DTE  >= CURRENT DATE            19810080
198200                 AND B.WORKER_NBR  =                              19820080
198300                    (SELECT WORKER_NBR                            19830080
198400                       FROM TWORKER                               19840080
198500                      WHERE OPERCO_NBR = '03'                     19850080
198600                        AND UID_NBR    = :DP020-USERID)           19860080
198700         END-EXEC                                                 19870080
198800                                                                  19880080
198900         EVALUATE TRUE                                            19890080
199000             WHEN SQLCODE = +0                                    19900080
199100             WHEN SQLCODE = +100                                  19910080
199200             WHEN SQLCODE = -904                                  19920080
199300             WHEN SQLCODE = -913                                  19930080
199400                  CONTINUE                                        19940080
199500                                                                  19950080
199600             WHEN SQLWARN0 NOT = SPACES                           19960080
199700             WHEN SQLCODE < +0                                    19970080
199800             WHEN SQLCODE > +0                                    19980080
199900                  MOVE '3460-CHECK-MDSE-DEPT-AUTH'                19990080
200000                                  TO DP013-PARAGRAPH              20000080
200100                  MOVE 'UNSUCCESSFUL MDSE DEPT VALIDATION'        20010080
200200                                  TO DP013-MESSAGE-TEXT (1)       20020080
200300                  MOVE SQLCA      TO DP013-SQLCA                  20030080
200400                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     20040080
200500                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     20050080
200600                  SET DP013-DB2-ABEND                             20060080
200700                      DP013-XCTL-DISPLAY-RESTART                  20070080
200800                                  TO TRUE                         20080080
200900                  PERFORM DP013-0000-PROCESS-ABEND                20090080
201000         END-EVALUATE                                             20100080
201100     END-PERFORM.                                                 20110080
201200                                                                  20120080
201300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20130080
201400         MOVE '3460-CHECK-MDSE-DEPT-AUTH'                         20140080
201500                                  TO DP013-PARAGRAPH              20150080
201600         MOVE 'MAX RETRIES EXCEEDED ON MDSE DEPT VALIDATION'      20160080
201700                                  TO DP013-MESSAGE-TEXT (1)       20170080
201800         MOVE SQLCA               TO DP013-SQLCA                  20180080
201900         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     20190080
202000         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     20200080
202100         SET DP013-DB2-ABEND                                      20210080
202200             DP013-XCTL-DISPLAY-RESTART                           20220080
202300                                  TO TRUE                         20230080
202400         PERFORM DP013-0000-PROCESS-ABEND                         20240080
202500     END-IF.                                                      20250080
202600                                                                  20260080
202700     IF PV-DB2-COUNT = +0                                         20270080
202800         PERFORM 3461-GET-DMA-GMA                                 20280080
202900         IF SQLCODE = +100                                        20290080
203000             CONTINUE                                             20300080
203100         ELSE                                                     20310080
203200             PERFORM 3462-CHECK-DMA-AUTHORIZATION                 20320080
203300             IF PV-DB2-COUNT = +0                                 20330080
203400                 PERFORM 3463-CHECK-GMA-AUTHORIZATION             20340080
203500             END-IF                                               20350080
203600         END-IF                                                   20360080
203700     END-IF.                                                      20370080
203800                                                                  20380080
203900     IF PV-DB2-COUNT = +0                                         20390080
204000         PERFORM 3464-CHECK-NO-AUTHORIZATION                      20400080
204100         IF PV-DB2-COUNT = +0                                     20410080
204200             PERFORM 3465-CHECK-NO-DMA-AUTH                       20420080
204300             IF PV-DB2-COUNT = +0                                 20430080
204400                 PERFORM 3466-CHECK-NO-GMA-AUTH                   20440080
204500                 IF PV-DB2-COUNT = +0                             20450080
204600                     MOVE +1       TO PV-DB2-COUNT                20460080
204700                 ELSE                                             20470080
204800                     MOVE +0       TO PV-DB2-COUNT                20480080
204900                 END-IF                                           20490080
205000             ELSE                                                 20500080
205100                 MOVE +0           TO PV-DB2-COUNT                20510080
205200             END-IF                                               20520080
205300         ELSE                                                     20530080
205400             MOVE +0               TO PV-DB2-COUNT                20540080
205500         END-IF                                                   20550080
205600     END-IF.                                                      20560080
205700                                                                  20570080
205800 3461-GET-DMA-GMA.                                                20580080
205900                                                                  20590080
206000     PERFORM                                                      20600080
206100         WITH TEST AFTER                                          20610080
206200         VARYING PV-RETRY-COUNTER                                 20620080
206300         FROM 1 BY 1                                              20630080
206400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20640080
206500             OR (SQLCODE = +0)                                    20650080
206600             OR (SQLCODE = +100))                                 20660080
206700                                                                  20670080
206800         EXEC SQL                                                 20680080
206900              SELECT GMA_NBR,                                     20690080
207000                     DMA_NBR                                      20700080
207100                INTO :DK-GMA-NBR,                                 20710080
207200                     :DK-DMA-NBR                                  20720080
207300                FROM TMDSEAR                                      20730080
207400               WHERE DEPT_NBR    = :DK-DEPT-NBR                   20740080
207500                 AND MDSELV_CDE  = 'DPT'                          20750080
207600                 AND OPERCO_NBR  = '03'                           20760080
207700                 AND STRT_DTE   <= CURRENT DATE                   20770080
207800                 AND END_DTE    >= CURRENT DATE                   20780080
207900         END-EXEC                                                 20790080
208000                                                                  20800080
208100         EVALUATE TRUE                                            20810080
208200             WHEN SQLCODE = +0                                    20820080
208300             WHEN SQLCODE = +100                                  20830080
208400             WHEN SQLCODE = -904                                  20840080
208500             WHEN SQLCODE = -913                                  20850080
208600                  CONTINUE                                        20860080
208700                                                                  20870080
208800             WHEN SQLWARN0 NOT = SPACES                           20880080
208900             WHEN SQLCODE < +0                                    20890080
209000             WHEN SQLCODE > +0                                    20900080
209100                  MOVE '3461-GET-DMA-GMA'                         20910080
209200                                  TO DP013-PARAGRAPH              20920080
209300                  MOVE 'UNSUCCESSFUL SELECT ON MDSEAR'            20930080
209400                                  TO DP013-MESSAGE-TEXT (1)       20940080
209500                  MOVE SQLCA      TO DP013-SQLCA                  20950080
209600                  MOVE 'TMDSEAR ' TO DP013-DB2-TABLE-NAME (1)     20960080
209700                  SET DP013-DB2-ABEND                             20970080
209800                      DP013-XCTL-DISPLAY-RESTART                  20980080
209900                                  TO TRUE                         20990080
210000                  PERFORM DP013-0000-PROCESS-ABEND                21000080
210100         END-EVALUATE                                             21010080
210200     END-PERFORM.                                                 21020080
210300                                                                  21030080
210400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21040080
210500         MOVE '3461-GET-DMA-GMA'                                  21050080
210600                                  TO DP013-PARAGRAPH              21060080
210700         MOVE 'MAX RETRIES EXCEEDED ON SELECT ON MDSEAR'          21070080
210800                                  TO DP013-MESSAGE-TEXT (1)       21080080
210900         MOVE SQLCA               TO DP013-SQLCA                  21090080
211000         MOVE 'TMDSEAR '          TO DP013-DB2-TABLE-NAME (1)     21100080
211100         SET DP013-DB2-ABEND                                      21110080
211200             DP013-XCTL-DISPLAY-RESTART                           21120080
211300                                  TO TRUE                         21130080
211400         PERFORM DP013-0000-PROCESS-ABEND                         21140080
211500     END-IF.                                                      21150080
211600                                                                  21160080
211700 3462-CHECK-DMA-AUTHORIZATION.                                    21170080
211800                                                                  21180080
211900     PERFORM                                                      21190080
212000         WITH TEST AFTER                                          21200080
212100         VARYING PV-RETRY-COUNTER                                 21210080
212200         FROM 1 BY 1                                              21220080
212300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21230080
212400             OR (SQLCODE = +0)                                    21240080
212500             OR (SQLCODE = +100))                                 21250080
212600                                                                  21260080
212700         EXEC SQL                                                 21270080
212800              SELECT COUNT(*)                                     21280080
212900                INTO :PV-DB2-COUNT                                21290080
213000                FROM TMDSEAR A                                    21300080
213100                    ,TRSPBAR B                                    21310080
213200               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                21320080
213300                 AND A.DMA_NBR    = :DK-DMA-NBR                   21330080
213400                 AND A.MDSELV_CDE  = 'DMA'                        21340080
213500                 AND A.OPERCO_NBR  = '03'                         21350080
213600                 AND B.WORKER_STRT_DTE <= CURRENT DATE            21360080
213700                 AND B.WORKER_END_DTE  >= CURRENT DATE            21370080
213800                 AND B.WORKER_NBR  =                              21380080
213900                    (SELECT WORKER_NBR                            21390080
214000                       FROM TWORKER                               21400080
214100                      WHERE OPERCO_NBR = '03'                     21410080
214200                        AND UID_NBR    = :DP020-USERID)           21420080
214300         END-EXEC                                                 21430080
214400                                                                  21440080
214500         EVALUATE TRUE                                            21450080
214600             WHEN SQLCODE = +0                                    21460080
214700             WHEN SQLCODE = +100                                  21470080
214800             WHEN SQLCODE = -904                                  21480080
214900             WHEN SQLCODE = -913                                  21490080
215000                  CONTINUE                                        21500080
215100                                                                  21510080
215200             WHEN SQLWARN0 NOT = SPACES                           21520080
215300             WHEN SQLCODE < +0                                    21530080
215400             WHEN SQLCODE > +0                                    21540080
215500                  MOVE '3462-CHECK-DMA-AUTHORIZATION'             21550080
215600                                  TO DP013-PARAGRAPH              21560080
215700                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             21570080
215800                                  TO DP013-MESSAGE-TEXT (1)       21580080
215900                  MOVE SQLCA      TO DP013-SQLCA                  21590080
216000                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     21600080
216100                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     21610080
216200                  SET DP013-DB2-ABEND                             21620080
216300                      DP013-XCTL-DISPLAY-RESTART                  21630080
216400                                  TO TRUE                         21640080
216500                  PERFORM DP013-0000-PROCESS-ABEND                21650080
216600         END-EVALUATE                                             21660080
216700     END-PERFORM.                                                 21670080
216800                                                                  21680080
216900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21690080
217000         MOVE '3462-CHECK-DMA-AUTHORIZATION'                      21700080
217100                                  TO DP013-PARAGRAPH              21710080
217200         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          21720080
217300                                  TO DP013-MESSAGE-TEXT (1)       21730080
217400         MOVE SQLCA               TO DP013-SQLCA                  21740080
217500         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     21750080
217600         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     21760080
217700         SET DP013-DB2-ABEND                                      21770080
217800             DP013-XCTL-DISPLAY-RESTART                           21780080
217900                                  TO TRUE                         21790080
218000         PERFORM DP013-0000-PROCESS-ABEND                         21800080
218100     END-IF.                                                      21810080
218200                                                                  21820080
218300 3463-CHECK-GMA-AUTHORIZATION.                                    21830080
218400                                                                  21840080
218500     PERFORM                                                      21850080
218600         WITH TEST AFTER                                          21860080
218700         VARYING PV-RETRY-COUNTER                                 21870080
218800         FROM 1 BY 1                                              21880080
218900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21890080
219000             OR (SQLCODE = +0)                                    21900080
219100             OR (SQLCODE = +100))                                 21910080
219200                                                                  21920080
219300         EXEC SQL                                                 21930080
219400              SELECT COUNT(*)                                     21940080
219500                INTO :PV-DB2-COUNT                                21950080
219600                FROM TMDSEAR A                                    21960080
219700                    ,TRSPBAR B                                    21970080
219800               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                21980080
219900                 AND A.GMA_NBR    = :DK-GMA-NBR                   21990080
220000                 AND A.MDSELV_CDE  = 'GMA'                        22000080
220100                 AND A.OPERCO_NBR  = '03'                         22010080
220200                 AND B.WORKER_STRT_DTE <= CURRENT DATE            22020080
220300                 AND B.WORKER_END_DTE  >= CURRENT DATE            22030080
220400                 AND B.WORKER_NBR  =                              22040080
220500                    (SELECT WORKER_NBR                            22050080
220600                       FROM TWORKER                               22060080
220700                      WHERE OPERCO_NBR = '03'                     22070080
220800                        AND UID_NBR    = :DP020-USERID)           22080080
220900         END-EXEC                                                 22090080
221000                                                                  22100080
221100         EVALUATE TRUE                                            22110080
221200             WHEN SQLCODE = +0                                    22120080
221300             WHEN SQLCODE = +100                                  22130080
221400             WHEN SQLCODE = -904                                  22140080
221500             WHEN SQLCODE = -913                                  22150080
221600                  CONTINUE                                        22160080
221700                                                                  22170080
221800             WHEN SQLWARN0 NOT = SPACES                           22180080
221900             WHEN SQLCODE < +0                                    22190080
222000             WHEN SQLCODE > +0                                    22200080
222100                  MOVE '3463-CHECK-GMA-AUTHORIZATION'             22210080
222200                                  TO DP013-PARAGRAPH              22220080
222300                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             22230080
222400                                  TO DP013-MESSAGE-TEXT (1)       22240080
222500                  MOVE SQLCA      TO DP013-SQLCA                  22250080
222600                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     22260080
222700                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     22270080
222800                  SET DP013-DB2-ABEND                             22280080
222900                      DP013-XCTL-DISPLAY-RESTART                  22290080
223000                                  TO TRUE                         22300080
223100                  PERFORM DP013-0000-PROCESS-ABEND                22310080
223200         END-EVALUATE                                             22320080
223300     END-PERFORM.                                                 22330080
223400                                                                  22340080
223500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22350080
223600         MOVE '3463-CHECK-GMA-AUTHORIZATION'                      22360080
223700                                  TO DP013-PARAGRAPH              22370080
223800         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          22380080
223900                                  TO DP013-MESSAGE-TEXT (1)       22390080
224000         MOVE SQLCA               TO DP013-SQLCA                  22400080
224100         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     22410080
224200         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     22420080
224300         SET DP013-DB2-ABEND                                      22430080
224400             DP013-XCTL-DISPLAY-RESTART                           22440080
224500                                  TO TRUE                         22450080
224600         PERFORM DP013-0000-PROCESS-ABEND                         22460080
224700     END-IF.                                                      22470080
224800                                                                  22480080
224900 3464-CHECK-NO-AUTHORIZATION.                                     22490080
225000                                                                  22500080
225100     PERFORM                                                      22510080
225200         WITH TEST AFTER                                          22520080
225300         VARYING PV-RETRY-COUNTER                                 22530080
225400         FROM 1 BY 1                                              22540080
225500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22550080
225600             OR (SQLCODE = +0)                                    22560080
225700             OR (SQLCODE = +100))                                 22570080
225800                                                                  22580080
225900         EXEC SQL                                                 22590080
226000              SELECT COUNT(*)                                     22600080
226100                INTO :PV-DB2-COUNT                                22610080
226200                FROM TMDSEAR A                                    22620080
226300                    ,TRSPBAR B                                    22630080
226400               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                22640080
226500                 AND A.MDSELV_CDE  = 'DPT'                        22650080
226600                 AND A.OPERCO_NBR  = '03'                         22660080
226700                 AND B.WORKER_STRT_DTE <= CURRENT DATE            22670080
226800                 AND B.WORKER_END_DTE  >= CURRENT DATE            22680080
226900                 AND B.WORKER_NBR  =                              22690080
227000                    (SELECT WORKER_NBR                            22700080
227100                       FROM TWORKER                               22710080
227200                      WHERE OPERCO_NBR = '03'                     22720080
227300                        AND UID_NBR    = :DP020-USERID)           22730080
227400         END-EXEC                                                 22740080
227500                                                                  22750080
227600         EVALUATE TRUE                                            22760080
227700             WHEN SQLCODE = +0                                    22770080
227800             WHEN SQLCODE = +100                                  22780080
227900             WHEN SQLCODE = -904                                  22790080
228000             WHEN SQLCODE = -913                                  22800080
228100                  CONTINUE                                        22810080
228200                                                                  22820080
228300             WHEN SQLWARN0 NOT = SPACES                           22830080
228400             WHEN SQLCODE < +0                                    22840080
228500             WHEN SQLCODE > +0                                    22850080
228600                  MOVE '3464-CHECK-NO-AUTHORIZATION'              22860080
228700                                  TO DP013-PARAGRAPH              22870080
228800                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             22880080
228900                                  TO DP013-MESSAGE-TEXT (1)       22890080
229000                  MOVE SQLCA      TO DP013-SQLCA                  22900080
229100                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     22910080
229200                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     22920080
229300                  SET DP013-DB2-ABEND                             22930080
229400                      DP013-XCTL-DISPLAY-RESTART                  22940080
229500                                  TO TRUE                         22950080
229600                  PERFORM DP013-0000-PROCESS-ABEND                22960080
229700         END-EVALUATE                                             22970080
229800     END-PERFORM.                                                 22980080
229900                                                                  22990080
230000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23000080
230100         MOVE '3464-CHECK-NO-AUTHORIZATION'                       23010080
230200                                  TO DP013-PARAGRAPH              23020080
230300         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          23030080
230400                                  TO DP013-MESSAGE-TEXT (1)       23040080
230500         MOVE SQLCA               TO DP013-SQLCA                  23050080
230600         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     23060080
230700         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     23070080
230800         SET DP013-DB2-ABEND                                      23080080
230900             DP013-XCTL-DISPLAY-RESTART                           23090080
231000                                  TO TRUE                         23100080
231100         PERFORM DP013-0000-PROCESS-ABEND                         23110080
231200     END-IF.                                                      23120080
231300                                                                  23130080
231400 3465-CHECK-NO-DMA-AUTH.                                          23140080
231500                                                                  23150080
231600     PERFORM                                                      23160080
231700         WITH TEST AFTER                                          23170080
231800         VARYING PV-RETRY-COUNTER                                 23180080
231900         FROM 1 BY 1                                              23190080
232000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23200080
232100             OR (SQLCODE = +0)                                    23210080
232200             OR (SQLCODE = +100))                                 23220080
232300                                                                  23230080
232400         EXEC SQL                                                 23240080
232500              SELECT COUNT(*)                                     23250080
232600                INTO :PV-DB2-COUNT                                23260080
232700                FROM TMDSEAR A                                    23270080
232800                    ,TRSPBAR B                                    23280080
232900               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                23290080
233000                 AND A.MDSELV_CDE  = 'DMA'                        23300080
233100                 AND A.OPERCO_NBR  = '03'                         23310080
233200                 AND B.WORKER_STRT_DTE <= CURRENT DATE            23320080
233300                 AND B.WORKER_END_DTE  >= CURRENT DATE            23330080
233400                 AND B.WORKER_NBR  =                              23340080
233500                    (SELECT WORKER_NBR                            23350080
233600                       FROM TWORKER                               23360080
233700                      WHERE OPERCO_NBR = '03'                     23370080
233800                        AND UID_NBR    = :DP020-USERID)           23380080
233900         END-EXEC                                                 23390080
234000                                                                  23400080
234100         EVALUATE TRUE                                            23410080
234200             WHEN SQLCODE = +0                                    23420080
234300             WHEN SQLCODE = +100                                  23430080
234400             WHEN SQLCODE = -904                                  23440080
234500             WHEN SQLCODE = -913                                  23450080
234600                  CONTINUE                                        23460080
234700                                                                  23470080
234800             WHEN SQLWARN0 NOT = SPACES                           23480080
234900             WHEN SQLCODE < +0                                    23490080
235000             WHEN SQLCODE > +0                                    23500080
235100                  MOVE '3465-CHECK-NO-DMA-AUTH'                   23510080
235200                                  TO DP013-PARAGRAPH              23520080
235300                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             23530080
235400                                  TO DP013-MESSAGE-TEXT (1)       23540080
235500                  MOVE SQLCA      TO DP013-SQLCA                  23550080
235600                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     23560080
235700                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     23570080
235800                  SET DP013-DB2-ABEND                             23580080
235900                      DP013-XCTL-DISPLAY-RESTART                  23590080
236000                                  TO TRUE                         23600080
236100                  PERFORM DP013-0000-PROCESS-ABEND                23610080
236200         END-EVALUATE                                             23620080
236300     END-PERFORM.                                                 23630080
236400                                                                  23640080
236500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        23650080
236600         MOVE '3465-CHECK-NO-DMA-AUTH'                            23660080
236700                                  TO DP013-PARAGRAPH              23670080
236800         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          23680080
236900                                  TO DP013-MESSAGE-TEXT (1)       23690080
237000         MOVE SQLCA               TO DP013-SQLCA                  23700080
237100         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     23710080
237200         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     23720080
237300         SET DP013-DB2-ABEND                                      23730080
237400             DP013-XCTL-DISPLAY-RESTART                           23740080
237500                                  TO TRUE                         23750080
237600         PERFORM DP013-0000-PROCESS-ABEND                         23760080
237700     END-IF.                                                      23770080
237800                                                                  23780080
237900 3466-CHECK-NO-GMA-AUTH.                                          23790080
238000                                                                  23800080
238100     PERFORM                                                      23810080
238200         WITH TEST AFTER                                          23820080
238300         VARYING PV-RETRY-COUNTER                                 23830080
238400         FROM 1 BY 1                                              23840080
238500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               23850080
238600             OR (SQLCODE = +0)                                    23860080
238700             OR (SQLCODE = +100))                                 23870080
238800                                                                  23880080
238900         EXEC SQL                                                 23890080
239000              SELECT COUNT(*)                                     23900080
239100                INTO :PV-DB2-COUNT                                23910080
239200                FROM TMDSEAR A                                    23920080
239300                    ,TRSPBAR B                                    23930080
239400               WHERE A.MDSEAR_DKEY = B.MDSEAR_DKEY                23940080
239500                 AND A.MDSELV_CDE  = 'GMA'                        23950080
239600                 AND A.OPERCO_NBR  = '03'                         23960080
239700                 AND B.WORKER_STRT_DTE <= CURRENT DATE            23970080
239800                 AND B.WORKER_END_DTE  >= CURRENT DATE            23980080
239900                 AND B.WORKER_NBR  =                              23990080
240000                    (SELECT WORKER_NBR                            24000080
240100                       FROM TWORKER                               24010080
240200                      WHERE OPERCO_NBR = '03'                     24020080
240300                        AND UID_NBR    = :DP020-USERID)           24030080
240400         END-EXEC                                                 24040080
240500                                                                  24050080
240600         EVALUATE TRUE                                            24060080
240700             WHEN SQLCODE = +0                                    24070080
240800             WHEN SQLCODE = +100                                  24080080
240900             WHEN SQLCODE = -904                                  24090080
241000             WHEN SQLCODE = -913                                  24100080
241100                  CONTINUE                                        24110080
241200                                                                  24120080
241300             WHEN SQLWARN0 NOT = SPACES                           24130080
241400             WHEN SQLCODE < +0                                    24140080
241500             WHEN SQLCODE > +0                                    24150080
241600                  MOVE '3466-CHECK-NO-GMA-AUTH'                   24160080
241700                                  TO DP013-PARAGRAPH              24170080
241800                  MOVE 'UNSUCCESSFUL COUNT ON WORKER'             24180080
241900                                  TO DP013-MESSAGE-TEXT (1)       24190080
242000                  MOVE SQLCA      TO DP013-SQLCA                  24200080
242100                  MOVE 'TWORKER ' TO DP013-DB2-TABLE-NAME (1)     24210080
242200                  MOVE 'TRSPBAR ' TO DP013-DB2-TABLE-NAME (2)     24220080
242300                  SET DP013-DB2-ABEND                             24230080
242400                      DP013-XCTL-DISPLAY-RESTART                  24240080
242500                                  TO TRUE                         24250080
242600                  PERFORM DP013-0000-PROCESS-ABEND                24260080
242700         END-EVALUATE                                             24270080
242800     END-PERFORM.                                                 24280080
242900                                                                  24290080
243000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24300080
243100         MOVE '3466-CHECK-NO-GMA-AUTH'                            24310080
243200                                  TO DP013-PARAGRAPH              24320080
243300         MOVE 'MAX RETRIES EXCEEDED ON COUNT ON TWORKER'          24330080
243400                                  TO DP013-MESSAGE-TEXT (1)       24340080
243500         MOVE SQLCA               TO DP013-SQLCA                  24350080
243600         MOVE 'TWORKER '          TO DP013-DB2-TABLE-NAME (1)     24360080
243700         MOVE 'TRSPBAR '          TO DP013-DB2-TABLE-NAME (2)     24370080
243800         SET DP013-DB2-ABEND                                      24380080
243900             DP013-XCTL-DISPLAY-RESTART                           24390080
244000                                  TO TRUE                         24400080
244100         PERFORM DP013-0000-PROCESS-ABEND                         24410080
244200     END-IF.                                                      24420080
244300                                                                  24430080
244400******************************************************************24440080
244500*   CHECK FOR DUPLICATE INHOUSE NUMBER                            24450080
244600*   CHECK IF AUTHORIZED TO ADD / UPDATE DEPARTMENT                24460080
244700******************************************************************24470080
244800 3600-EDIT-UPDATE.                                                24480080
244900                                                                  24490080
245000     MOVE ASC-ENT-ID              TO DK-ENT-ID.                   24500080
245100     MOVE ASC-DEPT-NUMBER         TO DK-DEPT-NBR.                 24510080
245200     MOVE ASC-INHOUSE-NUMBER-N    TO DK-INHOUSE-NUMBER.           24520080
245300     MOVE DP020-OPERATING-COMPANY TO DK-OPERATING-COMPANY.        24530080
245400                                                                  24540080
245500     IF ASC-VEND-TYPE NOT = 'E'                                   24550080
245600         PERFORM 3440-VALIDATE-EXIST-INHS                         24560080
245700                                                                  24570080
245800         IF SQLCODE NOT = +100                                    24580080
245900             SET PS-ERROR                                         24590080
246000                 DP020-MSG-FATAL                                  24600080
246100                 DP030-SET-CURSOR-APPL-1 TO TRUE                  24610080
246200*            --- INHOUSE ALREADY EXISTS ---                       24620080
246300             MOVE PC-TSYMSG-00475 TO DP020-MSG-NUMBER             24630080
246400             MOVE DP015-UNP-ALP-BRT-OFF TO AINHSA                 24640080
246500             MOVE DP015-RED             TO AINHSC                 24650080
246600             MOVE DP015-REVERSE         TO AINHSH                 24660080
246700             MOVE -1                    TO AINHSL                 24670080
246800         END-IF                                                   24680080
246900     END-IF.                                                      24690080
247000                                                                  24700080
247100     IF PS-NO-ERROR                                               24710080
247200         IF ASC-VEND-TYPE = 'E'                                   24720080
247300             PERFORM 3450-CHECK-EXP-DEPT-AUTH                     24730080
247400         ELSE                                                     24740080
247500             PERFORM 3460-CHECK-MDSE-DEPT-AUTH                    24750080
247600         END-IF                                                   24760080
247700     END-IF.                                                      24770080
247800                                                                  24780080
247900     IF PS-NO-ERROR                                               24790080
248000         IF PV-DB2-COUNT = ZERO                                   24800080
248100             SET DP020-MSG-FATAL                                  24810080
248200                 PS-ERROR                                         24820080
248300                 DP030-SET-CURSOR-APPL-1 TO TRUE                  24830080
248400*            --- NOT AUTHORIZED FOR DEPT ---                      24840080
248500             MOVE PC-TSYMSG-00014        TO DP020-MSG-NUMBER      24850080
248600             MOVE DP015-UNP-ALP-BRT-OFF  TO ADPTNBRA              24860080
248700             MOVE DP015-RED              TO ADPTNBRC              24870080
248800             MOVE DP015-REVERSE          TO ADPTNBRH              24880080
248900             MOVE -1                     TO ADPTNBRL              24890080
249000         END-IF                                                   24900080
249100     END-IF.                                                      24910080
249200                                                                  24920080
249300 3700-VERIFY-IF-EXP-VENDOR.                                       24930080
249400                                                                  24940080
249500     PERFORM WITH TEST AFTER                                      24950080
249600             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 24960080
249700               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         24970080
249800                     SQLCODE = ZERO                               24980080
249900                                                                  24990080
250000        EXEC SQL                                                  25000080
250100            SELECT COUNT(*)                                       25010080
250200              INTO :PV-VEND-TYP-CNT                               25020080
250300              FROM TEXTENT                                        25030080
250400             WHERE ENT_ID = :DK-ENT-ID                            25040080
250500               AND  PRIM_TYP_CDE = 'E'                            25050080
250600                OR (CAP_EXP_CDE   = 'Y'                           25060080
250700                OR  CAP_EXP_CDE   = 'B')                          25070080
250800        END-EXEC                                                  25080080
250900                                                                  25090080
251000        EVALUATE TRUE                                             25100080
251100            WHEN SQLCODE = ZERO                                   25110080
251200                IF PV-VEND-TYP-CNT > 0                            25120080
251300                    CONTINUE                                      25130080
251400                ELSE                                              25140080
251500                    MOVE PC-TSYMSG-02020 TO DP020-MSG-NUMBER      25150080
251600                    SET  PS-ERROR                                 25160080
251700                         DP020-MSG-FATAL                          25170080
251800                         DP030-SET-CURSOR-APPL-1 TO TRUE          25180080
251900                    MOVE DP015-UNP-ALP-BRT-OFF  TO AVNDTYPA       25190080
252000                    MOVE DP015-RED              TO AVNDTYPC       25200080
252100                    MOVE DP015-REVERSE          TO AVNDTYPH       25210080
252200                    MOVE -1                     TO AVNDTYPL       25220080
252300                END-IF                                            25230080
252400                                                                  25240080
252500            WHEN SQLCODE = -904                                   25250080
252600            WHEN SQLCODE = -913                                   25260080
252700                CONTINUE                                          25270080
252800                                                                  25280080
252900            WHEN SQLWARN0 NOT = SPACES                            25290080
253000            WHEN SQLCODE < ZERO                                   25300080
253100            WHEN SQLCODE > ZERO                                   25310080
253200                 MOVE '3700-VERIFY-IF-EXP-VENDOR'                 25320080
253300                                   TO DP013-PARAGRAPH             25330080
253400                 MOVE 'SELECT TEXTENT'                            25340080
253500                                   TO DP013-MESSAGE-TEXT (1)      25350080
253600                 MOVE SQLCA        TO DP013-SQLCA                 25360080
253700                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    25370080
253800                 SET DP013-DB2-ABEND                              25380080
253900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           25390080
254000                 PERFORM DP013-0000-PROCESS-ABEND                 25400080
254100         END-EVALUATE                                             25410080
254200     END-PERFORM.                                                 25420080
254300                                                                  25430080
254400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        25440080
254500         MOVE '3700-VERIFY-IF-EXP-VENDOR'                         25450080
254600                                   TO DP013-PARAGRAPH             25460080
254700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     25470080
254800                                   TO DP013-MESSAGE-TEXT (1)      25480080
254900         MOVE 'TEXTENT'            TO DP013-MESSAGE-TEXT (2)      25490080
255000         MOVE SQLCA                TO DP013-SQLCA                 25500080
255100         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    25510080
255200         SET DP013-DB2-ABEND                                      25520080
255300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   25530080
255400         PERFORM DP013-0000-PROCESS-ABEND                         25540080
255500     END-IF.                                                      25550080
255600                                                                  25560080
255700 3800-VERIFY-IF-MERCH-VENDOR.                                     25570080
255800                                                                  25580080
255900     PERFORM WITH TEST AFTER                                      25590080
256000             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 25600080
256100               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         25610080
256200                     SQLCODE = ZERO                               25620080
256300                                                                  25630080
256400        EXEC SQL                                                  25640080
256500            SELECT COUNT(*)                                       25650080
256600              INTO :PV-VEND-TYP-CNT                               25660080
256700              FROM TEXTENT                                        25670080
256800             WHERE ENT_ID = :DK-ENT-ID                            25680080
256900               AND PRIM_TYP_CDE = 'M'                             25690080
257000        END-EXEC                                                  25700080
257100                                                                  25710080
257200        EVALUATE TRUE                                             25720080
257300            WHEN SQLCODE = ZERO                                   25730080
257400                IF PV-VEND-TYP-CNT > 0                            25740080
257500                    CONTINUE                                      25750080
257600                ELSE                                              25760080
257700                    MOVE PC-TSYMSG-02019 TO DP020-MSG-NUMBER      25770080
257800                    SET  PS-ERROR                                 25780080
257900                         DP020-MSG-FATAL                          25790080
258000                         DP030-SET-CURSOR-APPL-1 TO TRUE          25800080
258100                    MOVE DP015-UNP-ALP-BRT-OFF  TO AVNDTYPA       25810080
258200                    MOVE DP015-RED              TO AVNDTYPC       25820080
258300                    MOVE DP015-REVERSE          TO AVNDTYPH       25830080
258400                    MOVE -1                     TO AVNDTYPL       25840080
258500                END-IF                                            25850080
258600                                                                  25860080
258700            WHEN SQLCODE = -904                                   25870080
258800            WHEN SQLCODE = -913                                   25880080
258900                CONTINUE                                          25890080
259000                                                                  25900080
259100            WHEN SQLWARN0 NOT = SPACES                            25910080
259200            WHEN SQLCODE < ZERO                                   25920080
259300            WHEN SQLCODE > ZERO                                   25930080
259400                 MOVE '3800-VERIFY-IF-MERCH-VENDOR'               25940080
259500                                   TO DP013-PARAGRAPH             25950080
259600                 MOVE 'SELECT TEXTENT'                            25960080
259700                                   TO DP013-MESSAGE-TEXT (1)      25970080
259800                 MOVE SQLCA        TO DP013-SQLCA                 25980080
259900                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    25990080
260000                 SET DP013-DB2-ABEND                              26000080
260100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26010080
260200                 PERFORM DP013-0000-PROCESS-ABEND                 26020080
260300         END-EVALUATE                                             26030080
260400     END-PERFORM.                                                 26040080
260500                                                                  26050080
260600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        26060080
260700         MOVE '3800-VERIFY-IF-MERCH-VENDOR'                       26070080
260800                                   TO DP013-PARAGRAPH             26080080
260900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     26090080
261000                                   TO DP013-MESSAGE-TEXT (1)      26100080
261100         MOVE 'TEXTENT'            TO DP013-MESSAGE-TEXT (2)      26110080
261200         MOVE SQLCA                TO DP013-SQLCA                 26120080
261300         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    26130080
261400         SET DP013-DB2-ABEND                                      26140080
261500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   26150080
261600         PERFORM DP013-0000-PROCESS-ABEND                         26160080
261700     END-IF.                                                      26170080
261800                                                                  26180080
261900 4000-BUILD-INITIAL-PANEL.                                        26190080
262000                                                                  26200080
262100     SET DP030-SET-CURSOR-APPL-1 TO TRUE.                         26210080
262200     MOVE ASC-ENT-ID      TO DK-ENT-ID.                           26220080
262300     MOVE ASC-DEPT-NUMBER TO DK-DEPT-NBR.                         26230080
262400                                                                  26240080
262500     PERFORM 4100-GET-VENDOR-NAME.                                26250080
262600                                                                  26260080
262700     PERFORM 4200-GET-TVNDDPT-INFO.                               26270080
262800                                                                  26280080
262900     IF DP020-INT-APPL-FORMAT-IND = '2'                           26290080
263000         IF SQLCODE = +100                                        26300080
263100             SET DP020-MSG-INFORMATIONAL                          26310080
263200                 DP020-NEXT-ACT-APPL-ERROR TO TRUE                26320080
263300             MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER             26330080
263400         END-IF                                                   26340080
263500     END-IF.                                                      26350080
263600                                                                  26360080
263700     IF DP020-INT-APPL-FORMAT-IND = '1'                           26370080
263800         MOVE -1 TO AVNDTYPL                                      26380080
263900     ELSE                                                         26390080
264000         IF DP020-INT-APPL-FORMAT-IND = '2'                       26400080
264100             IF ASC-VEND-TYPE = 'M'                               26410080
264200                 MOVE ASC-DEPT-NUMBER TO DK-DEPT-NBR              26420080
264300                                                                  26430080
264400                 PERFORM 4300-GET-INHOUSE                         26440080
264500                                                                  26450080
264600                 MOVE VNDDPT-INHOUSE-NBR TO ASC-INHOUSE-NUMBER    26460080
264700                 MOVE DP015-PRO-NOR-OFF  TO AINVCA                26470080
264800                 MOVE DP015-BLUE         TO AINVCC                26480080
264900                 MOVE DP015-HL-OFF       TO AINVCH                26490080
265000                 MOVE -1                 TO AINHSL                26500080
265100             ELSE                                                 26510080
265200                 IF ASC-VEND-TYPE = 'E'                           26520080
265300                     MOVE ZERO              TO ASC-INHOUSE-NUMBER 26530080
265400                     MOVE DP015-PRO-NOR-OFF TO AINHSA             26540080
265500                     MOVE DP015-BLUE        TO AINHSC             26550080
265600                     MOVE DP015-HL-OFF      TO AINHSH             26560080
265700                     MOVE -1                TO AINVCL             26570080
265800                 END-IF                                           26580080
265900             END-IF                                               26590080
266000         END-IF.                                                  26600080
266100                                                                  26610080
266200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        26620080
266300                                                                  26630080
266400 4100-GET-VENDOR-NAME.                                            26640080
266500                                                                  26650080
266600     PERFORM WITH TEST AFTER                                      26660080
266700             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 26670080
266800               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         26680080
266900                     SQLCODE = ZERO OR                            26690080
267000                     SQLCODE = +100                               26700080
267100                                                                  26710080
267200        EXEC SQL                                                  26720080
267300                SELECT B.ENT_NAME_DESC                            26730080
267400                      ,A.DUN_NBR                                  26740080
267500                      ,A.STATUS_CDE                               26750080
267600                      ,A.EDI_PO_PREPK_CDE                         26760080
267700                      ,A.PRIM_TYP_CDE                             26770080
267800                      ,A.VND_IN_RMS_IND                           26780080
267900                  INTO :ENTNME-ENT-NAME-DESC                      26790080
268000                      ,:EXTENT-DUN-NBR                            26800080
268100                      ,:EXTENT-STATUS-CDE                         26810080
268200                      ,:EXTENT-EDI-PO-PREPK-CDE                   26820080
268300                      ,:EXTENT-PRIM-TYP-CDE                       26830080
268400                      ,:EXTENT-VND-IN-RMS-IND                     26840080
268500                  FROM TEXTENT A,                                 26850080
268600                       TENTNME B                                  26860080
268700                 WHERE A.ENT_ID   = :DK-ENT-ID                    26870080
268800                   AND B.ENT_ID   = A.ENT_ID                      26880080
268900                   AND B.TYPE_CDE = '01'                          26890080
269000        END-EXEC                                                  26900080
269100                                                                  26910080
269200        EVALUATE TRUE                                             26920080
269300            WHEN SQLCODE = ZERO                                   26930080
269400            WHEN SQLCODE = +100                                   26940080
269500            WHEN SQLCODE = -904                                   26950080
269600            WHEN SQLCODE = -913                                   26960080
269700                CONTINUE                                          26970080
269800                                                                  26980080
269900            WHEN SQLWARN0 NOT = SPACES                            26990080
270000            WHEN SQLCODE < ZERO                                   27000080
270100            WHEN SQLCODE > ZERO                                   27010080
270200                 MOVE '4100-GET-VENDOR-NAME'                      27020080
270300                                   TO DP013-PARAGRAPH             27030080
270400                 MOVE 'SELECT ENTERPRISE'                         27040080
270500                                   TO DP013-MESSAGE-TEXT (1)      27050080
270600                 MOVE SQLCA        TO DP013-SQLCA                 27060080
270700                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    27070080
270800                 SET DP013-DB2-ABEND                              27080080
270900                     DP013-XCTL-DISPLAY-RESTART TO TRUE           27090080
271000                 PERFORM DP013-0000-PROCESS-ABEND                 27100080
271100         END-EVALUATE                                             27110080
271200     END-PERFORM.                                                 27120080
271300                                                                  27130080
271400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27140080
271500         MOVE '4100-GET-VENDOR-NAME'                              27150080
271600                                   TO DP013-PARAGRAPH             27160080
271700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     27170080
271800                                   TO DP013-MESSAGE-TEXT (1)      27180080
271900         MOVE 'ENTERPRISE'         TO DP013-MESSAGE-TEXT (2)      27190080
272000         MOVE SQLCA                TO DP013-SQLCA                 27200080
272100         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    27210080
272200         SET DP013-DB2-ABEND                                      27220080
272300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   27230080
272400         PERFORM DP013-0000-PROCESS-ABEND                         27240080
272500     END-IF.                                                      27250080
272600                                                                  27260080
272700     IF SQLCODE = ZERO                                            27270080
272800         MOVE ENTNME-ENT-NAME-DESC TO ASC-VEND-NAME               27280080
272900         MOVE EXTENT-DUN-NBR       TO ASC-DUN-NBR                 27290080
273000         MOVE EXTENT-STATUS-CDE    TO ASC-STATUS-CDE              27300080
273100         MOVE EXTENT-EDI-PO-PREPK-CDE TO ASC-PO-PREPK-CDE         27310080
273200         MOVE EXTENT-PRIM-TYP-CDE  TO ASC-PRIM-TYP-CDE            27320080
273300         MOVE EXTENT-VND-IN-RMS-IND                               27330080
273400                                   TO ASC-VND-IN-RMS-IND          27340080
273500     ELSE                                                         27350080
273600         IF SQLCODE = +100                                        27360080
273700             MOVE 'VENDOR NOT FOUND' TO ASC-VEND-NAME             27370080
273800         END-IF                                                   27380080
273900     END-IF.                                                      27390080
274000                                                                  27400080
274100 4200-GET-TVNDDPT-INFO.                                           27410080
274200                                                                  27420080
274300     PERFORM WITH TEST AFTER                                      27430080
274400             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 27440080
274500               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         27450080
274600                     SQLCODE = ZERO OR                            27460080
274700                     SQLCODE = +100                               27470080
274800                                                                  27480080
274900        EXEC SQL                                                  27490080
275000                SELECT VEND_TYP_IND                               27500080
275100                      ,INVC_REQ_PO_IND                            27510080
275200                      ,VND_DEPT_STAT_CD                           27520080
275300                      ,COALESCE(EMAIL_ADDR_ID,' ')                27530080
275400                  INTO :VNDDPT-VEND-TYP-IND                       27540080
275500                      ,:VNDDPT-INVC-REQ-PO-IND                    27550080
275600                      ,:VNDDPT-VND-DEPT-STAT-CD                   27560080
275700                      ,:VNDDPT-EMAIL-ADDR-ID                      27570080
275800                  FROM TVNDDPT                                    27580080
275900                 WHERE ENT_ID   = :DK-ENT-ID                      27590080
276000                   AND DEPT_NBR = :DK-DEPT-NBR                    27600080
276100        END-EXEC                                                  27610080
276200                                                                  27620080
276300        EVALUATE TRUE                                             27630080
276400            WHEN SQLCODE = ZERO                                   27640080
276500            WHEN SQLCODE = +100                                   27650080
276600            WHEN SQLCODE = -904                                   27660080
276700            WHEN SQLCODE = -913                                   27670080
276800                CONTINUE                                          27680080
276900                                                                  27690080
277000            WHEN SQLWARN0 NOT = SPACES                            27700080
277100            WHEN SQLCODE < ZERO                                   27710080
277200            WHEN SQLCODE > ZERO                                   27720080
277300                 MOVE '4200-GET-VENDOR-TYPE'                      27730080
277400                                   TO DP013-PARAGRAPH             27740080
277500                 MOVE 'SELECT VENDOR TYPE'                        27750080
277600                                   TO DP013-MESSAGE-TEXT (1)      27760080
277700                 MOVE SQLCA        TO DP013-SQLCA                 27770080
277800                 MOVE 'TVNDDPT'    TO DP013-DB2-TABLE-NAME (1)    27780080
277900                 SET DP013-DB2-ABEND                              27790080
278000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           27800080
278100                 PERFORM DP013-0000-PROCESS-ABEND                 27810080
278200         END-EVALUATE                                             27820080
278300     END-PERFORM.                                                 27830080
278400                                                                  27840080
278500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        27850080
278600         MOVE '4200-GET-VENDOR-TYPE'                              27860080
278700                                   TO DP013-PARAGRAPH             27870080
278800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     27880080
278900                                   TO DP013-MESSAGE-TEXT (1)      27890080
279000         MOVE 'VENDOR TYPE'        TO DP013-MESSAGE-TEXT (2)      27900080
279100         MOVE SQLCA                TO DP013-SQLCA                 27910080
279200         MOVE 'TVNDDPT'            TO DP013-DB2-TABLE-NAME (1)    27920080
279300         SET DP013-DB2-ABEND                                      27930080
279400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   27940080
279500         PERFORM DP013-0000-PROCESS-ABEND                         27950080
279600     END-IF.                                                      27960080
279700                                                                  27970080
279800     IF SQLCODE = ZERO                                            27980080
279900         IF VNDDPT-INVC-REQ-PO-IND = ' '                          27990080
280000             MOVE 'N' TO ASC-INVC-REQD                            28000080
280100         ELSE                                                     28010080
280200             MOVE VNDDPT-INVC-REQ-PO-IND TO ASC-INVC-REQD         28020080
280300         END-IF                                                   28030080
280400         IF VNDDPT-VEND-TYP-IND = ' '                             28040080
280500             MOVE 'M' TO ASC-VEND-TYPE                            28050080
280600         ELSE                                                     28060080
280700             MOVE VNDDPT-VEND-TYP-IND TO ASC-VEND-TYPE            28070080
280800         END-IF                                                   28080080
280900                                                                  28090080
281000         IF VNDDPT-VND-DEPT-STAT-CD = ' '                         28100080
281100             MOVE 'A' TO ASC-STATUS                               28110080
281200         ELSE                                                     28120080
281300             MOVE VNDDPT-VND-DEPT-STAT-CD TO ASC-STATUS           28130080
281400                                             PV-HOLD-STATUS       28140080
281500         END-IF                                                   28150080
281600         IF VNDDPT-EMAIL-ADDR-ID = SPACE                          28160080
281700            MOVE SPACE TO ASC-EMAIL-ADDR1                         28170080
281800                          ASC-EMAIL-ADDR2                         28180080
281900                          ASC-EMAIL-ADDR3                         28190080
282000                          ASC-EMAIL-ADDR4                         28200080
282100         ELSE                                                     28210080
282200            MOVE VNDDPT-EMAIL-ADDR-ID TO PV-VNDDPT-EMAIL-ADDR-ID  28220080
282300            MOVE PV-EMAIL-ADDR1       TO ASC-EMAIL-ADDR1          28230080
282400            MOVE PV-EMAIL-ADDR2       TO ASC-EMAIL-ADDR2          28240080
282500            MOVE PV-EMAIL-ADDR3       TO ASC-EMAIL-ADDR3          28250080
282600            MOVE PV-EMAIL-ADDR4       TO ASC-EMAIL-ADDR4          28260080
282700         END-IF                                                   28270080
282800     ELSE                                                         28280080
282900         IF SQLCODE = +100                                        28290080
283000             MOVE 'M' TO ASC-VEND-TYPE                            28300080
283100             MOVE 'N' TO ASC-INVC-REQD                            28310080
283200             MOVE 'A' TO ASC-STATUS                               28320080
283300             MOVE SPACE TO ASC-EMAIL-ADDR1                        28330080
283400                           ASC-EMAIL-ADDR2                        28340080
283500                           ASC-EMAIL-ADDR3                        28350080
283600                           ASC-EMAIL-ADDR4                        28360080
283700         END-IF                                                   28370080
283800     END-IF.                                                      28380080
283900                                                                  28390080
284000 4300-GET-INHOUSE.                                                28400080
284100                                                                  28410080
284200     PERFORM WITH TEST AFTER                                      28420080
284300             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 28430080
284400               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         28440080
284500                     SQLCODE = ZERO OR                            28450080
284600                     SQLCODE = +100                               28460080
284700                                                                  28470080
284800        EXEC SQL                                                  28480080
284900                SELECT INHOUSE_NBR                                28490080
285000                  INTO :VNDDPT-INHOUSE-NBR                        28500080
285100                  FROM TVNDDPT                                    28510080
285200                 WHERE ENT_ID   = :DK-ENT-ID                      28520080
285300                   AND DEPT_NBR = :DK-DEPT-NBR                    28530080
285400        END-EXEC                                                  28540080
285500                                                                  28550080
285600         EVALUATE TRUE                                            28560080
285700             WHEN SQLCODE = ZERO                                  28570080
285800             WHEN SQLCODE = +100                                  28580080
285900             WHEN SQLCODE = -904                                  28590080
286000             WHEN SQLCODE = -913                                  28600080
286100                 CONTINUE                                         28610080
286200                                                                  28620080
286300             WHEN SQLWARN0 NOT = SPACES                           28630080
286400             WHEN SQLCODE < ZERO                                  28640080
286500             WHEN SQLCODE > ZERO                                  28650080
286600                 MOVE '4300-GET-INHOUSE'                          28660080
286700                                   TO DP013-PARAGRAPH             28670080
286800                 MOVE 'SELECT VENDOR DEPARTMENT'                  28680080
286900                                   TO DP013-MESSAGE-TEXT (1)      28690080
287000                 MOVE SQLCA        TO DP013-SQLCA                 28700080
287100                 MOVE 'TVNDDPT'    TO DP013-DB2-TABLE-NAME (1)    28710080
287200                 SET DP013-DB2-ABEND                              28720080
287300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           28730080
287400                 PERFORM DP013-0000-PROCESS-ABEND                 28740080
287500         END-EVALUATE                                             28750080
287600     END-PERFORM.                                                 28760080
287700                                                                  28770080
287800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        28780080
287900         MOVE '4200-GET-INHOUSE'  TO DP013-PARAGRAPH              28790080
288000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     28800080
288100                                  TO DP013-MESSAGE-TEXT (1)       28810080
288200         MOVE 'VENDOR DEPARTMENT' TO DP013-MESSAGE-TEXT (2)       28820080
288300         MOVE SQLCA               TO DP013-SQLCA                  28830080
288400         MOVE 'TVNDDPT'           TO DP013-DB2-TABLE-NAME (1)     28840080
288500         SET DP013-DB2-ABEND                                      28850080
288600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   28860080
288700         PERFORM DP013-0000-PROCESS-ABEND                         28870080
288800     END-IF.                                                      28880080
288900                                                                  28890080
289000*----------------------------------------------------------------*28900080
289100*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *28910080
289200*----------------------------------------------------------------*28920080
289300 4400-MOVE-COMMAREA-TO-SCREEN.                                    28930080
289400                                                                  28940080
289500     IF DP020-INT-APPL-FORMAT-IND = '2'                           28950080
289600         MOVE ASC-DEPT-NUMBER    TO ADPTNBRO                      28960080
289700         MOVE ASC-INHOUSE-NUMBER TO AINHSO                        28970080
289800         MOVE ASC-INVC-REQD      TO AINVCO                        28980080
289900         MOVE ASC-STATUS         TO ASTATO                        28990080
290000         MOVE ASC-EMAIL-ADDR1    TO AEMAIL1O                      29000080
290100         MOVE ASC-EMAIL-ADDR2    TO AEMAIL2O                      29010080
290200         MOVE ASC-EMAIL-ADDR3    TO AEMAIL3O                      29020080
290300         MOVE ASC-EMAIL-ADDR4    TO AEMAIL4O                      29030080
290400     END-IF.                                                      29040080
290500                                                                  29050080
290600     MOVE ASC-VEND-NAME TO AVNNAMEO.                              29060080
290700     MOVE ASC-VEND-TYPE TO AVNDTYPO.                              29070080
290800                                                                  29080080
290900 5000-UPDATE-VEND-DEPT.                                           29090080
291000                                                                  29100080
291100     MOVE ASC-ENT-ID           TO DK-ENT-ID.                      29110080
291200     MOVE ASC-DEPT-NUMBER      TO DK-DEPT-NBR.                    29120080
291300     MOVE ASC-INHOUSE-NUMBER-N TO VNDDPT-INHOUSE-NBR.             29130080
291400     MOVE ASC-INVC-REQD        TO VNDDPT-INVC-REQ-PO-IND.         29140080
291500     MOVE ASC-STATUS           TO VNDDPT-VND-DEPT-STAT-CD.        29150080
291600     STRING ASC-EMAIL-ADDR1 DELIMITED BY SIZE                     29160080
291700            ASC-EMAIL-ADDR2 DELIMITED BY SIZE                     29170080
291800            ASC-EMAIL-ADDR3 DELIMITED BY SIZE                     29180080
291900            ASC-EMAIL-ADDR4 DELIMITED BY SIZE                     29190080
292000                                INTO PV-VNDDPT-EMAIL-ADDR-ID.     29200080
292100     MOVE PV-VNDDPT-EMAIL-ADDR-ID TO VNDDPT-EMAIL-ADDR-ID.        29210080
292200                                                                  29220080
292300     PERFORM 5550-SELECT-VNDDPT-STATUS.                           29230080
292400                                                                  29240080
292500     IF PV-HOLD-STATUS NOT = ASC-STATUS                           29250080
292600        PERFORM 5520-SELECT-TVNDTAU                               29260080
292700        IF TVNDTAU-ROW-FOUND                                      29270080
292800           PERFORM 5540-UPDATE-TVNDTAU-CHG-TMST                   29280080
292900        END-IF                                                    29290080
293000        INITIALIZE DCLTVNDTAU                                     29300080
293100        MOVE ASC-ENT-ID           TO VNDTAU-ENT-ID                29310080
293200        MOVE ASC-DEPT-NUMBER      TO VNDTAU-DEPT-NBR              29320080
293300        MOVE ASC-STATUS           TO VNDTAU-STAT-CDE              29330080
293400        MOVE 'D'                  TO VNDTAU-AUD-TYP-CDE           29340080
293500        MOVE PC-INIT-EXP-TMST     TO VNDTAU-PREV-STAT-CHG-TMST    29350080
293600        PERFORM 5530-INSERT-TVNDTAU                               29360080
293700     END-IF.                                                      29370080
293800                                                                  29380080
293900     PERFORM 5100-UPDATE-TVNDDPT.                                 29390080
294000                                                                  29400080
294100     IF ASC-VEND-TYPE      = 'M' AND                              29410080
294200        PV-HOLD-STATUS NOT = ASC-STATUS                           29420080
294300         PERFORM 5150-INTERFACE-TO-RMS                            29430080
294400     END-IF.                                                      29440080
294500                                                                  29450080
294600     IF ASC-USE-SELECTION-QUEUE                                   29460080
294700         PERFORM 5200-UPDATE-SELECTION-QUEUE                      29470080
294800     END-IF.                                                      29480080
294900                                                                  29490080
295000 5100-UPDATE-TVNDDPT.                                             29500080
295100                                                                  29510080
295200     PERFORM WITH TEST AFTER                                      29520080
295300             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 29530080
295400               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         29540080
295500                     SQLCODE = ZERO                               29550080
295600        EXEC SQL                                                  29560080
295700                UPDATE TVNDDPT                                    29570080
295800                  SET INHOUSE_NBR      = :VNDDPT-INHOUSE-NBR      29580080
295900                     ,INVC_REQ_PO_IND  = :VNDDPT-INVC-REQ-PO-IND  29590080
296000                     ,VND_DEPT_STAT_CD = :VNDDPT-VND-DEPT-STAT-CD 29600080
296100                     ,EMAIL_ADDR_ID    = :VNDDPT-EMAIL-ADDR-ID    29610080
296200                 WHERE ENT_ID   = :DK-ENT-ID                      29620080
296300                   AND DEPT_NBR = :DK-DEPT-NBR                    29630080
296400        END-EXEC                                                  29640080
296500                                                                  29650080
296600        EVALUATE TRUE                                             29660080
296700            WHEN SQLCODE = ZERO                                   29670080
296800            WHEN SQLCODE = -904                                   29680080
296900            WHEN SQLCODE = -913                                   29690080
297000                CONTINUE                                          29700080
297100                                                                  29710080
297200            WHEN SQLWARN0 NOT = SPACES                            29720080
297300            WHEN SQLCODE < ZERO                                   29730080
297400            WHEN SQLCODE > ZERO                                   29740080
297500                 MOVE '5100-UPDATE-TVNDDPT'                       29750080
297600                                   TO DP013-PARAGRAPH             29760080
297700                 MOVE 'UPDATE A ROW ON THE VENDOR DEPT TABLE'     29770080
297800                                   TO DP013-MESSAGE-TEXT(1)       29780080
297900                 MOVE SQLCA        TO DP013-SQLCA                 29790080
298000                 MOVE 'TVNDDPT'    TO DP013-DB2-TABLE-NAME (1)    29800080
298100                 SET DP013-DB2-ABEND                              29810080
298200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           29820080
298300                 PERFORM DP013-0000-PROCESS-ABEND                 29830080
298400         END-EVALUATE                                             29840080
298500     END-PERFORM.                                                 29850080
298600                                                                  29860080
298700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         29870080
298800         MOVE '5100-UPDATE-TVNDDPT' TO DP013-PARAGRAPH            29880080
298900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A VEN29890080
299000-             'DOR DEPARTMENT'      TO DP013-MESSAGE-TEXT (1)     29900080
299100         MOVE SQLCA                 TO DP013-SQLCA                29910080
299200         MOVE 'TVNDDPT'             TO DP013-DB2-TABLE-NAME (1)   29920080
299300         SET DP013-DB2-ABEND                                      29930080
299400             DP013-XCTL-DISPLAY-RESTART TO TRUE                   29940080
299500         PERFORM DP013-0000-PROCESS-ABEND                         29950080
299600     END-IF.                                                      29960080
299700                                                                  29970080
299800******************************************************************29980080
299900* DETERMINE IF DATA NEEDS TO BE PASSED TO RMS                    *29990080
300000******************************************************************30000080
300100 5150-INTERFACE-TO-RMS.                                           30010080
300200     IF ASC-VND-IN-RMS-IND    = 'N'  AND                          30020080
300300        PV-HOLD-STATUS        = 'I'  AND                          30030080
300400        ASC-STATUS            = 'A'                               30040080
300500         INITIALIZE VN013-VENDOR-INTERFACE-PARMS                  30050080
300600         SET VN013-ACTION-ADD TO TRUE                             30060080
300700         PERFORM 5160-CALL-VNKCS023                               30070080
300800         IF VN013-RMS-VENDOR-ADDED                                30080080
300900             PERFORM 5170-UPDATE-TEXTENT                          30090080
301000         END-IF                                                   30100080
301100     ELSE                                                         30110080
301200         IF ASC-VND-IN-RMS-IND = 'Y'                              30120080
301300             INITIALIZE VN013-VENDOR-INTERFACE-PARMS              30130080
301400             SET VN013-ACTION-UPDATE TO TRUE                      30140080
301500             PERFORM 5160-CALL-VNKCS023                           30150080
301600         END-IF                                                   30160080
301700     END-IF.                                                      30170080
301800                                                                  30180080
301900 5160-CALL-VNKCS023.                                              30190080
302000******************************************************************30200080
302100*   CALL PROGRAM VNKCS023                                        *30210080
302200******************************************************************30220080
302300     SET VN013-FUNCTION-DEPT        TO TRUE.                      30230080
302400     MOVE ASC-ENT-ID                TO VN013-ENT-ID.              30240080
302500     MOVE ASC-DUN-NBR               TO VN013-VND-NBR.             30250080
302600     MOVE ASC-PRIM-TYP-CDE          TO VN013-PRIM-TYP-CDE.        30260080
302700     MOVE ASC-VND-IN-RMS-IND        TO VN013-VND-IN-RMS-IND.      30270080
302800     MOVE ASC-STATUS-CDE            TO VN013-STATUS-CDE.          30280080
302900     MOVE ASC-PO-PREPK-CDE          TO VN013-PO-PREPK-CDE.        30290080
303000                                                                  30300080
303100*                                                                 30310080
303200* FEED TENTNME FIELDS TO VNKCS023:                                30320080
303300*                                                                 30330080
303400                                                                  30340080
303500     MOVE ASC-VEND-NAME             TO VN013-ENT-NAME-DESC.       30350080
303600                                                                  30360080
303700*                                                                 30370080
303800* FEED TVNDDPT FIELDS TO VNKCS023:                                30380080
303900*                                                                 30390080
304000                                                                  30400080
304100     MOVE ASC-DEPT-NUMBER           TO VN013-DEPT-NBR.            30410080
304200     MOVE ASC-STATUS                TO VN013-VND-DEPT-STAT-CD.    30420080
304300                                                                  30430080
304400     EXEC CICS LINK PROGRAM (PC-VNKCS023)                         30440080
304500                    COMMAREA(VN013-COMMAREA)                      30450080
304600                    RESP    (PV-CICS-RESPONSE)                    30460080
304700     END-EXEC.                                                    30470080
304800                                                                  30480080
304900     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       30490080
305000         CONTINUE                                                 30500080
305100     ELSE                                                         30510080
305200         SET DP013-ROLLBACK                                       30520080
305300             DP013-XCTL-DISPLAY-RESTART                           30530080
305400             DP013-CICS-ABEND      TO TRUE                        30540080
305500         MOVE '5160-CALL-VNKCS023' TO DP013-PARAGRAPH             30550080
305600         MOVE 'FAILED CALL TO RMS DATA BUILDER ROUTINE: VNKCS023' 30560080
305700                                   TO DP013-MESSAGE-TEXT (1)      30570080
305800         PERFORM DP013-0000-PROCESS-ABEND                         30580080
305900     END-IF.                                                      30590080
306000                                                                  30600080
306100     IF VN013-NO-ERRORS                                           30610080
306200         CONTINUE                                                 30620080
306300     ELSE                                                         30630080
306400         SET DP013-CICS-ABEND                                     30640080
306500             DP013-ROLLBACK                                       30650080
306600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   30660080
306700         MOVE '5160-CALL-VNKCS023'      TO DP013-PARAGRAPH        30670080
306800         MOVE VN013-PROGRAM-NAME        TO PV-ERROR-PGM-NAME      30680080
306900         MOVE VN013-PARAGRAPH-NAME      TO PV-ERROR-PARA-NAME     30690080
307000         MOVE VN013-MESSAGE             TO PV-ERROR-MESSAGE       30700080
307100         IF VN013-DB-ERROR                                        30710080
307200             MOVE 'DB2 ERROR      '     TO PV-ERROR-TYPE          30720080
307300             MOVE 'SQL CODE: '          TO PV-OPTIONAL-TEXT       30730080
307400             MOVE VN013-SQLCODE         TO PV-ERROR-REASON        30740080
307500         ELSE                                                     30750080
307600             MOVE SPACES                TO PV-OPTIONAL-TEXT       30760080
307700                                           PV-ERROR-REASON        30770080
307800             IF VN013-MQ-ERROR                                    30780080
307900                 MOVE 'MQ SERIES ERROR' TO PV-ERROR-TYPE          30790080
308000             ELSE                                                 30800080
308100                 MOVE 'UNKNOWN ERROR  ' TO PV-ERROR-TYPE          30810080
308200             END-IF                                               30820080
308300         END-IF                                                   30830080
308400         MOVE PV-ERROR-MSG-1       TO DP013-MESSAGE-TEXT (2)      30840080
308500         MOVE PV-ERROR-MSG-2       TO DP013-MESSAGE-TEXT (3)      30850080
308600         MOVE PV-ERROR-MSG-3       TO DP013-MESSAGE-TEXT (4)      30860080
308700         PERFORM DP013-0000-PROCESS-ABEND                         30870080
308800     END-IF.                                                      30880080
308900                                                                  30890080
309000     IF VN013-MAX-CPBLTY-EXCEEDED                                 30900080
309100         SET DP030-OVERRIDE-GO TO TRUE                            30910080
309200         MOVE PC-TSYMSG-03380  TO DP020-MSG-NUMBER                30920080
309300         SET DP020-MSG-WARNING TO TRUE                            30930080
309400     END-IF.                                                      30940080
309500                                                                  30950080
309600     IF VN013-MAX-RLTNSHP-EXCEEDED                                30960080
309700         SET DP030-OVERRIDE-GO TO TRUE                            30970080
309800         MOVE PC-TSYMSG-03381  TO DP020-MSG-NUMBER                30980080
309900         SET DP020-MSG-WARNING TO TRUE                            30990080
310000     END-IF.                                                      31000080
310100                                                                  31010080
310200     IF VN013-MAX-ADDR-EXCEEDED                                   31020080
310300         SET DP030-OVERRIDE-GO TO TRUE                            31030080
310400         MOVE PC-TSYMSG-02645  TO DP020-MSG-NUMBER                31040080
310500         SET DP020-MSG-WARNING TO TRUE                            31050080
310600     END-IF.                                                      31060080
310700                                                                  31070080
310800     IF VN013-MAX-DEPT-EXCEEDED                                   31080080
310900         SET DP030-OVERRIDE-GO TO TRUE                            31090080
311000         MOVE PC-TSYMSG-02646  TO DP020-MSG-NUMBER                31100080
311100         SET DP020-MSG-WARNING TO TRUE                            31110080
311200     END-IF.                                                      31120080
311300                                                                  31130080
311400 5170-UPDATE-TEXTENT.                                             31140080
311500     PERFORM                                                      31150080
311600         WITH TEST AFTER                                          31160080
311700         VARYING PV-RETRY-COUNTER                                 31170080
311800         FROM 1 BY 1                                              31180080
311900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               31190080
312000                   OR (SQLCODE = ZERO))                           31200080
312100         EXEC SQL                                                 31210080
312200           UPDATE TEXTENT                                         31220080
312300              SET VND_IN_RMS_IND     = 'Y'                        31230080
312400             WHERE ENT_ID  = :ASC-ENT-ID                          31240080
312500         END-EXEC                                                 31250080
312600                                                                  31260080
312700         EVALUATE TRUE                                            31270080
312800             WHEN SQLCODE = ZERO                                  31280080
312900             WHEN SQLCODE = -904                                  31290080
313000             WHEN SQLCODE = -913                                  31300080
313100                 CONTINUE                                         31310080
313200             WHEN SQLWARN0 NOT = SPACES                           31320080
313300             WHEN SQLCODE < ZERO                                  31330080
313400             WHEN SQLCODE > ZERO                                  31340080
313500                 MOVE '5170-UPDATE-TEXTENT'                       31350080
313600                                   TO DP013-PARAGRAPH             31360080
313700                 MOVE 'UPDATE A ROW ON THE EXTERNAL ENT TABLE'    31370080
313800                                   TO DP013-MESSAGE-TEXT(1)       31380080
313900                 MOVE SQLCA        TO DP013-SQLCA                 31390080
314000                 MOVE 'TEXTENT'    TO DP013-DB2-TABLE-NAME (1)    31400080
314100                 SET DP013-DB2-ABEND                              31410080
314200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           31420080
314300                 PERFORM DP013-0000-PROCESS-ABEND                 31430080
314400         END-EVALUATE                                             31440080
314500     END-PERFORM.                                                 31450080
314600                                                                  31460080
314700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        31470080
314800         MOVE '5170-UPDATE-TEXTENT'                               31480080
314900                                   TO DP013-PARAGRAPH             31490080
315000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A VEN31500080
315100-             'DOR'                TO DP013-MESSAGE-TEXT (1)      31510080
315200         MOVE SQLCA                TO DP013-SQLCA                 31520080
315300         MOVE 'TEXTENT'            TO DP013-DB2-TABLE-NAME (1)    31530080
315400         SET DP013-DB2-ABEND                                      31540080
315500             DP013-XCTL-DISPLAY-RESTART                           31550080
315600                                   TO TRUE                        31560080
315700         PERFORM DP013-0000-PROCESS-ABEND                         31570080
315800     END-IF.                                                      31580080
315900                                                                  31590080
316000                                                                  31600080
316100*----------------------------------------------------------------*31610080
316200* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *31620080
316300* OBJECT WAS UDPATED.                                            *31630080
316400*----------------------------------------------------------------*31640080
316500 5200-UPDATE-SELECTION-QUEUE.                                     31650080
316600                                                                  31660080
316700     PERFORM 9100-READ-SEL-QUEUE.                                 31670080
316800                                                                  31680080
316900     SET VN003-UPD (ASC-SEL-SUB) TO TRUE.                         31690080
317000                                                                  31700080
317100     PERFORM 9200-REWRITE-LIST-QUEUE.                             31710080
317200                                                                  31720080
317300 5500-ADD-VEND-DEPT.                                              31730080
317400                                                                  31740080
317500     INITIALIZE DCLTVNDTAU.                                       31750080
317600     MOVE ASC-ENT-ID           TO VNDDPT-ENT-ID                   31760080
317700                                  VNDTAU-ENT-ID.                  31770080
317800     MOVE ASC-DEPT-NUMBER      TO VNDDPT-DEPT-NBR                 31780080
317900                                  VNDTAU-DEPT-NBR.                31790080
318000     MOVE ASC-INHOUSE-NUMBER-N TO VNDDPT-INHOUSE-NBR.             31800080
318100     MOVE ASC-VEND-TYPE        TO VNDDPT-VEND-TYP-IND.            31810080
318200     MOVE ASC-INVC-REQD        TO VNDDPT-INVC-REQ-PO-IND.         31820080
318300     MOVE ASC-STATUS           TO VNDDPT-VND-DEPT-STAT-CD         31830080
318400                                  VNDTAU-STAT-CDE.                31840080
318500     STRING ASC-EMAIL-ADDR1 DELIMITED BY SIZE                     31850080
318600            ASC-EMAIL-ADDR2 DELIMITED BY SIZE                     31860080
318700            ASC-EMAIL-ADDR3 DELIMITED BY SIZE                     31870080
318800            ASC-EMAIL-ADDR4 DELIMITED BY SIZE                     31880080
318900                                INTO PV-VNDDPT-EMAIL-ADDR-ID.     31890080
319000     MOVE PV-VNDDPT-EMAIL-ADDR-ID TO VNDDPT-EMAIL-ADDR-ID.        31900080
319100                                                                  31910080
319200     PERFORM 5510-INSERT-TVNDDPT.                                 31920080
319300                                                                  31930080
319400     MOVE 'D'                  TO VNDTAU-AUD-TYP-CDE.             31940080
319500     MOVE PC-INIT-EXP-TMST     TO VNDTAU-PREV-STAT-CHG-TMST.      31950080
319600     PERFORM 5530-INSERT-TVNDTAU.                                 31960080
319700                                                                  31970080
319800 5510-INSERT-TVNDDPT.                                             31980080
319900                                                                  31990080
320000     PERFORM WITH TEST AFTER                                      32000080
320100             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 32010080
320200               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         32020080
320300                     SQLCODE = ZERO                               32030080
320400        EXEC SQL                                                  32040080
320500                INSERT INTO TVNDDPT                               32050080
320600                      (ENT_ID                                     32060080
320700                      ,DEPT_NBR                                   32070080
320800                      ,INHOUSE_NBR                                32080080
320900                      ,VEND_TYP_IND                               32090080
321000                      ,INVC_REQ_PO_IND                            32100080
321100                      ,VND_DEPT_STAT_CD                           32110080
321200                      ,CRE_DTE                                    32120080
321300                      ,EMAIL_ADDR_ID)                             32130080
321400                VALUES                                            32140080
321500                      (:VNDDPT-ENT-ID                             32150080
321600                      ,:VNDDPT-DEPT-NBR                           32160080
321700                      ,:VNDDPT-INHOUSE-NBR                        32170080
321800                      ,:VNDDPT-VEND-TYP-IND                       32180080
321900                      ,:VNDDPT-INVC-REQ-PO-IND                    32190080
322000                      ,:VNDDPT-VND-DEPT-STAT-CD                   32200080
322100                      ,CURRENT DATE                               32210080
322200                      ,:VNDDPT-EMAIL-ADDR-ID)                     32220080
322300        END-EXEC                                                  32230080
322400                                                                  32240080
322500        EVALUATE TRUE                                             32250080
322600            WHEN SQLCODE = ZERO                                   32260080
322700            WHEN SQLCODE = -904                                   32270080
322800            WHEN SQLCODE = -913                                   32280080
322900                CONTINUE                                          32290080
323000                                                                  32300080
323100            WHEN SQLWARN0 NOT = SPACES                            32310080
323200            WHEN SQLCODE < ZERO                                   32320080
323300            WHEN SQLCODE > ZERO                                   32330080
323400                 MOVE '5100-INSERT-TVNDDPT'                       32340080
323500                                   TO DP013-PARAGRAPH             32350080
323600                 MOVE 'INSERT A ROW ON THE VENDOR DEPT TABLE'     32360080
323700                                   TO DP013-MESSAGE-TEXT(1)       32370080
323800                 MOVE SQLCA        TO DP013-SQLCA                 32380080
323900                 MOVE 'TVNDDPT'    TO DP013-DB2-TABLE-NAME (1)    32390080
324000                 SET DP013-DB2-ABEND                              32400080
324100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           32410080
324200                 PERFORM DP013-0000-PROCESS-ABEND                 32420080
324300        END-EVALUATE                                              32430080
324400     END-PERFORM.                                                 32440080
324500                                                                  32450080
324600     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         32460080
324700         MOVE '5510-INSERT-TVNDDPT' TO DP013-PARAGRAPH            32470080
324800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO INSERT A VEN32480080
324900-             'DOR DEPARTMENT'      TO DP013-MESSAGE-TEXT (1)     32490080
325000         MOVE SQLCA                 TO DP013-SQLCA                32500080
325100         MOVE 'TVNDDPT'             TO DP013-DB2-TABLE-NAME (1)   32510080
325200         SET DP013-DB2-ABEND                                      32520080
325300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   32530080
325400         PERFORM DP013-0000-PROCESS-ABEND                         32540080
325500     END-IF.                                                      32550080
325600                                                                  32560080
325700 5520-SELECT-TVNDTAU.                                             32570080
325800     PERFORM WITH TEST AFTER                                      32580080
325900             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 32590080
326000               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         32600080
326100                     SQLCODE = ZERO OR                            32610080
326200                     SQLCODE = +100                               32620080
326300                                                                  32630080
326400        EXEC SQL                                                  32640080
326500                SELECT ENT_ID                                     32650080
326600                  INTO :VNDTAU-ENT-ID                             32660080
326700                  FROM TVNDTAU                                    32670080
326800                 WHERE ENT_ID   = :DK-ENT-ID                      32680080
326900                   AND DEPT_NBR = :DK-DEPT-NBR                    32690080
327000                   AND AUD_FUNC_CDE = ' '                         32700080
327100                   AND PREV_STAT_CHG_TMST > CURRENT TIMESTAMP     32710080
327200        END-EXEC                                                  32720080
327300                                                                  32730080
327400         EVALUATE TRUE                                            32740080
327500             WHEN SQLCODE = ZERO                                  32750080
327600                 SET TVNDTAU-ROW-FOUND TO TRUE                    32760080
327700             WHEN SQLCODE = -904                                  32770080
327800             WHEN SQLCODE = -913                                  32780080
327900                 CONTINUE                                         32790080
328000                                                                  32800080
328100             WHEN SQLCODE = +100                                  32810080
328200                 SET TVNDTAU-ROW-NOT-FOUND TO TRUE                32820080
328300             WHEN SQLWARN0 NOT = SPACES                           32830080
328400             WHEN SQLCODE < ZERO                                  32840080
328500             WHEN SQLCODE > ZERO                                  32850080
328600                 MOVE '5520-SELECT-TVNDTAU'                       32860080
328700                                   TO DP013-PARAGRAPH             32870080
328800                 MOVE 'SELECT VENDOR DETAIL AUD'                  32880080
328900                                   TO DP013-MESSAGE-TEXT (1)      32890080
329000                 MOVE SQLCA        TO DP013-SQLCA                 32900080
329100                 MOVE 'TVNDTAU'    TO DP013-DB2-TABLE-NAME (1)    32910080
329200                 SET DP013-DB2-ABEND                              32920080
329300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           32930080
329400                 PERFORM DP013-0000-PROCESS-ABEND                 32940080
329500         END-EVALUATE                                             32950080
329600     END-PERFORM.                                                 32960080
329700                                                                  32970080
329800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        32980080
329900         MOVE '5520-SELECT-TVNDTAU'  TO DP013-PARAGRAPH           32990080
330000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     33000080
330100                                  TO DP013-MESSAGE-TEXT (1)       33010080
330200         MOVE 'VENDOR DTL AUDIT ' TO DP013-MESSAGE-TEXT (2)       33020080
330300         MOVE SQLCA               TO DP013-SQLCA                  33030080
330400         MOVE 'TVNDTAU'           TO DP013-DB2-TABLE-NAME (1)     33040080
330500         SET DP013-DB2-ABEND                                      33050080
330600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   33060080
330700         PERFORM DP013-0000-PROCESS-ABEND                         33070080
330800     END-IF.                                                      33080080
330900                                                                  33090080
331000 5530-INSERT-TVNDTAU.                                             33100080
331100     PERFORM WITH TEST AFTER                                      33110080
331200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 33120080
331300               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         33130080
331400                     SQLCODE = ZERO                               33140080
331500        EXEC SQL                                                  33150080
331600            INSERT INTO TVNDTAU                                   33160080
331700                 ( ENT_ID                                         33170080
331800                  ,AUD_TMST                                       33180080
331900                  ,LAST_UPD_BY_USR_ID                             33190080
332000                  ,AUD_FUNC_CDE                                   33200080
332100                  ,VND_NM                                         33210080
332200                  ,STAT_CDE                                       33220080
332300                  ,PRIM_TYP_CDE                                   33230080
332400                  ,PRTNR_IND                                      33240080
332500                  ,PRTNR_TYP_CDE                                  33250080
332600                  ,PRNT_CO_IND_CDE                                33260080
332700                  ,PAY_FCTR_IND_CDE                               33270080
332800                  ,HLD_PAYT_IND_CDE                               33280080
332900                  ,SEPR_INVC_IND_CDE                              33290080
333000                  ,PAYT_HNDLG_CDE                                 33300080
333100                  ,NEED_1099_IND_CDE                              33310080
333200                  ,FED_TX_ID_NBR                                  33320080
333300                  ,DEPT_NBR                                       33330080
333400                  ,PREV_STAT_CHG_TMST                             33340080
333500                  ,AUD_TYP_CDE)                                   33350080
333600             VALUES                                               33360080
333700                 (:VNDTAU-ENT-ID                                  33370080
333800                 ,CURRENT TIMESTAMP                               33380080
333900                 ,:DP020-USERID                                   33390080
334000                 ,:VNDTAU-AUD-FUNC-CDE                            33400080
334100                 ,:VNDTAU-VND-NM                                  33410080
334200                 ,:VNDTAU-STAT-CDE                                33420080
334300                 ,:VNDTAU-PRIM-TYP-CDE                            33430080
334400                 ,:VNDTAU-PRTNR-IND                               33440080
334500                 ,:VNDTAU-PRTNR-TYP-CDE                           33450080
334600                 ,:VNDTAU-PRNT-CO-IND-CDE                         33460080
334700                 ,:VNDTAU-PAY-FCTR-IND-CDE                        33470080
334800                 ,:VNDTAU-HLD-PAYT-IND-CDE                        33480080
334900                 ,:VNDTAU-SEPR-INVC-IND-CDE                       33490080
335000                 ,:VNDTAU-PAYT-HNDLG-CDE                          33500080
335100                 ,:VNDTAU-NEED-1099-IND-CDE                       33510080
335200                 ,:VNDTAU-FED-TX-ID-NBR                           33520080
335300                 ,:VNDTAU-DEPT-NBR                                33530080
335400                 ,:VNDTAU-PREV-STAT-CHG-TMST                      33540080
335500                 ,:VNDTAU-AUD-TYP-CDE)                            33550080
335600        END-EXEC                                                  33560080
335700                                                                  33570080
335800        EVALUATE TRUE                                             33580080
335900            WHEN SQLCODE = ZERO                                   33590080
336000            WHEN SQLCODE = -904                                   33600080
336100            WHEN SQLCODE = -913                                   33610080
336200                CONTINUE                                          33620080
336300                                                                  33630080
336400            WHEN SQLWARN0 NOT = SPACES                            33640080
336500            WHEN SQLCODE < ZERO                                   33650080
336600            WHEN SQLCODE > ZERO                                   33660080
336700                 MOVE '5530-INSERT-TVNDTAU'                       33670080
336800                                   TO DP013-PARAGRAPH             33680080
336900                 MOVE 'INSERT A ROW ON THE TVNDTAU TABLE'         33690080
337000                                   TO DP013-MESSAGE-TEXT(1)       33700080
337100                 MOVE SQLCA        TO DP013-SQLCA                 33710080
337200                 MOVE 'TVNDTAU'    TO DP013-DB2-TABLE-NAME (1)    33720080
337300                 SET DP013-DB2-ABEND                              33730080
337400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           33740080
337500                 PERFORM DP013-0000-PROCESS-ABEND                 33750080
337600        END-EVALUATE                                              33760080
337700     END-PERFORM.                                                 33770080
337800                                                                  33780080
337900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         33790080
338000         MOVE '5530-INSERT-TVNDTAU' TO DP013-PARAGRAPH            33800080
338100         MOVE 'MAX RETRIES EXCEEDED TRYING TO INSERT TO TVNDTAU'  33810080
338200                                    TO DP013-MESSAGE-TEXT (1)     33820080
338300         MOVE SQLCA                 TO DP013-SQLCA                33830080
338400         MOVE 'TVNDTAU'             TO DP013-DB2-TABLE-NAME (1)   33840080
338500         SET DP013-DB2-ABEND                                      33850080
338600             DP013-XCTL-DISPLAY-RESTART TO TRUE                   33860080
338700         PERFORM DP013-0000-PROCESS-ABEND                         33870080
338800     END-IF.                                                      33880080
338900                                                                  33890080
339000 5540-UPDATE-TVNDTAU-CHG-TMST.                                    33900080
339100     PERFORM                                                      33910080
339200         WITH TEST AFTER                                          33920080
339300         VARYING PV-RETRY-COUNTER                                 33930080
339400         FROM 1 BY 1                                              33940080
339500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               33950080
339600                   OR (SQLCODE = ZERO))                           33960080
339700         EXEC SQL                                                 33970080
339800             UPDATE TVNDTAU                                       33980080
339900                SET PREV_STAT_CHG_TMST = CURRENT TIMESTAMP        33990080
340000             WHERE ENT_ID   = :DK-ENT-ID                          34000080
340100               AND STAT_CDE > ' '                                 34010080
340200               AND DEPT_NBR = :DK-DEPT-NBR                        34020080
340300               AND AUD_FUNC_CDE = ' '                             34030080
340400               AND PREV_STAT_CHG_TMST > CURRENT TIMESTAMP         34040080
340500         END-EXEC                                                 34050080
340600                                                                  34060080
340700         EVALUATE TRUE                                            34070080
340800             WHEN SQLCODE = ZERO                                  34080080
340900             WHEN SQLCODE = -904                                  34090080
341000             WHEN SQLCODE = -913                                  34100080
341100                 CONTINUE                                         34110080
341200             WHEN SQLWARN0 NOT = SPACES                           34120080
341300             WHEN SQLCODE < ZERO                                  34130080
341400             WHEN SQLCODE > ZERO                                  34140080
341500                 MOVE '5540-UPDATE-TVNDTAU-CHG-TMST'              34150080
341600                                   TO DP013-PARAGRAPH             34160080
341700                 MOVE 'UPDATE A ROW ON THE TVNDTAU TABLE    '     34170080
341800                                   TO DP013-MESSAGE-TEXT(1)       34180080
341900                 MOVE SQLCA        TO DP013-SQLCA                 34190080
342000                 MOVE 'TVNDTAU'    TO DP013-DB2-TABLE-NAME (1)    34200080
342100                 SET DP013-DB2-ABEND                              34210080
342200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           34220080
342300                 PERFORM DP013-0000-PROCESS-ABEND                 34230080
342400         END-EVALUATE                                             34240080
342500     END-PERFORM.                                                 34250080
342600                                                                  34260080
342700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34270080
342800         MOVE '5540-UPDATE-TVNDTAU-CHG-TMST'                      34280080
342900                                   TO DP013-PARAGRAPH             34290080
343000         MOVE 'MAXIMUM RETRIES EXCEEDED TRYING TO UPDATE TVNDTAU' 34300080
343100                                   TO DP013-MESSAGE-TEXT (1)      34310080
343200         MOVE SQLCA                TO DP013-SQLCA                 34320080
343300         MOVE 'TVNDTAU'            TO DP013-DB2-TABLE-NAME (1)    34330080
343400         SET DP013-DB2-ABEND                                      34340080
343500             DP013-XCTL-DISPLAY-RESTART                           34350080
343600                                   TO TRUE                        34360080
343700         PERFORM DP013-0000-PROCESS-ABEND                         34370080
343800     END-IF.                                                      34380080
343900                                                                  34390080
344000  5550-SELECT-VNDDPT-STATUS.                                      34400080
344100     PERFORM WITH TEST AFTER                                      34410080
344200             VARYING PV-RETRY-COUNTER FROM 1 BY 1                 34420080
344300               UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES OR         34430080
344400                     SQLCODE = ZERO OR                            34440080
344500                     SQLCODE = +100                               34450080
344600                                                                  34460080
344700        EXEC SQL                                                  34470080
344800                SELECT VND_DEPT_STAT_CD                           34480080
344900                  INTO :PV-HOLD-STATUS                            34490080
345000                  FROM TVNDDPT                                    34500080
345100                 WHERE ENT_ID   = :DK-ENT-ID                      34510080
345200                   AND DEPT_NBR = :DK-DEPT-NBR                    34520080
345300        END-EXEC                                                  34530080
345400                                                                  34540080
345500        EVALUATE TRUE                                             34550080
345600            WHEN SQLCODE = ZERO                                   34560080
345700            WHEN SQLCODE = -904                                   34570080
345800            WHEN SQLCODE = -913                                   34580080
345900                CONTINUE                                          34590080
346000                                                                  34600080
346100            WHEN SQLWARN0 NOT = SPACES                            34610080
346200            WHEN SQLCODE < ZERO                                   34620080
346300            WHEN SQLCODE > ZERO                                   34630080
346400                 MOVE '5550-SELECT-VNDDPT-STATUS'                 34640080
346500                                   TO DP013-PARAGRAPH             34650080
346600                 MOVE 'SELECT VENDOR STATUS'                      34660080
346700                                   TO DP013-MESSAGE-TEXT (1)      34670080
346800                 MOVE SQLCA        TO DP013-SQLCA                 34680080
346900                 MOVE 'TVNDDPT'    TO DP013-DB2-TABLE-NAME (1)    34690080
347000                 SET DP013-DB2-ABEND                              34700080
347100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           34710080
347200                 PERFORM DP013-0000-PROCESS-ABEND                 34720080
347300         END-EVALUATE                                             34730080
347400     END-PERFORM.                                                 34740080
347500                                                                  34750080
347600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        34760080
347700         MOVE '5550-SELECT-VNDDPT-STATUS'                         34770080
347800                                   TO DP013-PARAGRAPH             34780080
347900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     34790080
348000                                   TO DP013-MESSAGE-TEXT (1)      34800080
348100         MOVE 'VNDR STATUS'        TO DP013-MESSAGE-TEXT (2)      34810080
348200         MOVE SQLCA                TO DP013-SQLCA                 34820080
348300         MOVE 'TVNDDPT'            TO DP013-DB2-TABLE-NAME (1)    34830080
348400         SET DP013-DB2-ABEND                                      34840080
348500             DP013-XCTL-DISPLAY-RESTART TO TRUE                   34850080
348600         PERFORM DP013-0000-PROCESS-ABEND                         34860080
348700     END-IF.                                                      34870080
348800                                                                  34880080
348900                                                                  34890080
349000*----------------------------------------------------------------*34900080
349100* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *34910080
349200*----------------------------------------------------------------*34920080
349300 9100-READ-SEL-QUEUE.                                             34930080
349400                                                                  34940080
349500     EXEC CICS                                                    34950080
349600         READQ TS                                                 34960080
349700             QUEUE (ASC-SEL-QUEUE-NAME)                           34970080
349800             INTO  (VN003-VENDOR-SEL-REC)                         34980080
349900             ITEM  (ASC-SEL-ITEM)                                 34990080
350000             RESP  (PV-CICS-RESPONSE)                             35000080
350100     END-EXEC.                                                    35010080
350200                                                                  35020080
350300     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   35030080
350400         CONTINUE                                                 35040080
350500     ELSE                                                         35050080
350600         SET DP013-LOGIC-ABEND                                    35060080
350700             DP013-NO-ROLLBACK     TO TRUE                        35070080
350800         MOVE '9100-READ-SEL-QUEUE'                               35080080
350900                                   TO DP013-PARAGRAPH             35090080
351000         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   35100080
351100                                   TO DP013-MESSAGE-TEXT (1)      35110080
351200         PERFORM DP013-0000-PROCESS-ABEND                         35120080
351300     END-IF.                                                      35130080
351400                                                                  35140080
351500*----------------------------------------------------------------*35150080
351600* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *35160080
351700*----------------------------------------------------------------*35170080
351800 9200-REWRITE-LIST-QUEUE.                                         35180080
351900                                                                  35190080
352000     EXEC CICS                                                    35200080
352100          WRITEQ TS                                               35210080
352200              QUEUE  (ASC-SEL-QUEUE-NAME)                         35220080
352300              FROM   (VN003-VENDOR-SEL-REC)                       35230080
352400              ITEM   (ASC-SEL-ITEM)                               35240080
352500              RESP   (PV-CICS-RESPONSE)                           35250080
352600              REWRITE                                             35260080
352700     END-EXEC.                                                    35270080
352800                                                                  35280080
352900     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               35290080
353000         SET DP013-CICS-ABEND                                     35300080
353100             DP013-NO-ROLLBACK     TO TRUE                        35310080
353200         MOVE '9200-REWRITE-LIST-QUEUE'                           35320080
353300                                   TO DP013-PARAGRAPH             35330080
353400         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   35340080
353500                                   TO DP013-MESSAGE-TEXT (1)      35350080
353600         PERFORM DP013-0000-PROCESS-ABEND                         35360080
353700     END-IF.                                                      35370080
353800                                                                  35380080
353900*----------------------------------------------------------------*35390080
354000*    ABEND PROCESSOR MODULE                                      *35400080
354100*----------------------------------------------------------------*35410080
354200     COPY DPPD013.                                                35420080
354300*----------------------------------------------------------------*35430080
