000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             MPKCS026.                                00050000
000600 AUTHOR.                 WILLIAM B. BURT.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            MARCH, 1991.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS A UPC INQUIRY SCREEN.         WR # 21361 *00120000
001900******************************************************************00190000
001900*  CHANGED 02/14/2023  JEAN KURK                  CHG0281369     *00191024
001900*          CHANGE CALL OF UPC CHECK DIGIT ROUTINE TO DYNAMIC     *00192025
001900******************************************************************00193024
002000                                                                  00200000
002100******************************************************************00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300******************************************************************00230000
002400                                                                  00240000
002500******************************************************************00250000
002600 DATA DIVISION.                                                   00260000
002700******************************************************************00270000
002800                                                                  00280000
002900******************************************************************00290000
003000 WORKING-STORAGE SECTION.                                         00300000
003100******************************************************************00310000
003200*                                                                 00320000
003300 01  CA-COMMAREA.                                                 00330000
003400     05  CA-COMMON-DATA.                                          00340000
003500         10  CA-TRANSACTION-STATUS                                00350000
003600                                         PIC  X(01)  VALUE SPACE. 00360000
003700             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00370000
003800             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00380000
003900         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00390000
004000     05  CA-PROGRAM-DATA.                                         00400000
004100         10  CA-UPC-NMBR-X               PIC  X(13)  VALUE SPACE. 00410000
004200         10  CA-UPC-NMBR  REDEFINES  CA-UPC-NMBR-X                00420000
004300                                         PIC  9(13).              00430000
004400         10  CA-UPC-FIRST-12  REDEFINES  CA-UPC-NMBR-X.           00440000
004500             15  CA-FIRST-TWELVE-BYTES-OF-UPC                     00450000
004600                                         PIC  9(12).              00460000
004700             15  CA-CHECK-DIGIT          PIC  X(01).              00470000
004800         10  CA-UPC-LAST-12  REDEFINES  CA-UPC-NMBR-X.            00480000
004900             15  CA-FIRST-DIGIT-COUNTRY-CODE                      00490000
005000                                         PIC  X(01).              00500000
005100             15  CA-LAST-TWELVE-BYTES-OF-UPC                      00510000
005200                                         PIC  9(12).              00520000
005300         10  CA-SKU                      PIC  X(10)  VALUE SPACE. 00530000
005400         10  CA-CURRENT-UNIT-RETAIL-AMOUNT                        00540000
005500                                         PIC 9(05)V9(02)          00550020
005600                                                     VALUE ZEROS. 00560000
005700         10  CA-FORMATTED-GROUP-PRICING  PIC  X(09)  VALUE SPACE. 00570022
005800         10  CA-VENDOR-STYLE-CODE        PIC  X(15)  VALUE SPACE. 00580000
005900         10  CA-SKU-DESCRIPTION          PIC  X(19)  VALUE SPACE. 00590000
006000         10  CA-IN-HOUSE-VENDOR-NAME     PIC  X(19)  VALUE SPACE. 00600000
006100         10  CA-SIZE-DESCRIPTION         PIC  X(05)  VALUE SPACE. 00610000
006200         10  CA-COLOR-DESCRIPTION        PIC  X(04)  VALUE SPACE. 00620000
006300         10  CA-MARKOUT-IND              PIC  X(02)  VALUE SPACE. 00630000
006400*                                                                 00640000
006500 01  DS-DATABASE-SEGMENT-KEYS.                                    00650000
006600     05  DS-CONCATENATED-CDM200DS-KEY.                            00660000
006700         10  FILLER                      PIC  9(02)  VALUE 03.    00670000
006800         10  DS-CDM100DS-DEPT            PIC  9(03)  VALUE ZERO.  00680000
006900         10  DS-CDM200DS-IN-HSE-VENDOR   PIC  9(03)  VALUE ZERO.  00690000
007000*                                                                 00700000
007100 01  PC-PROGRAM-CONSTANTS.                                        00710000
007200     05  PC-TRANID                       PIC  X(04)  VALUE 'M026'.00720000
007300     05  PC-SLASH                        PIC  X(01)  VALUE '/'.   00730000
007400     05  PC-LRT-MP-MENU-TRANID           PIC  X(04)  VALUE 'M027'.00740000
007500     05  PC-LRT-STORE-MENU-TRANID        PIC  X(04)  VALUE 'M029'.00750000
007600     05  PC-LRT-QC-MENU-TRANID           PIC  X(04)  VALUE 'E270'.00760000
007700     05  PC-ONE                          PIC  9(01)  VALUE 1.     00770000
007800     05  PC-MAX-RETRIES                  PIC S9(04)  VALUE +3     00780000
007900                                                     COMP SYNC.   00790000
008000     05  PC-ROW-NOT-FOUND                PIC S9(04)  VALUE +100   00800000
008100                                                     COMP SYNC.   00810000
008200     05  PC-COMMAREA-LENGTH              PIC S9(04)  VALUE +112   00820022
008300                                                     COMP SYNC.   00830000
008400     05  PC-TRANSFER-UP-LENGTH           PIC S9(04)  VALUE +9     00840000
008500                                                     COMP SYNC.   00850000
008600     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00860000
008700         'MPKCS026'.                                              00870000
008800     05  PC-LRT-MP-MENU-PGM              PIC  X(08)  VALUE        00880000
008900         'MPKCS027'.                                              00890000
009000     05  PC-LRT-STORE-MENU-PGM           PIC  X(08)  VALUE        00900000
009100         'MPKCS029'.                                              00910000
009200     05  PC-LRT-QC-MENU-PGM              PIC  X(08)  VALUE        00920000
009300         'RCKCS270'.                                              00930000
009400     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00940000
009500         'F3 =END            '.                                   00950000
009800     05  PC-DB2-DATABASE-ERROR-MSG       PIC  X(19)  VALUE        00980000
009900         'DB2 ACCESS ERROR   '.                                   00990000
010000     05  PC-UPC-NOT-NUMERIC-MSG          PIC  X(19)  VALUE        01000000
010100         'UPC NOT NUMERIC    '.                                   01010000
010200     05  PC-UPC-NOT-FOUND-MSG            PIC  X(19)  VALUE        01020000
010300         'UPC NOT FOUND      '.                                   01030000
010400     05  PC-UPC-NOT-VALID-MSG            PIC  X(19)  VALUE        01040000
010500         'UPC NOT VALID      '.                                   01050000
010600     05  PC-UPC-NOT-ASOC-TO-SKU-MSG      PIC  X(19)  VALUE        01060000
010700         'UPC NOT ASOC TO SKU'.                                   01070000
010800     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        01080000
010900         'UNRECOGNIZED PF KEY'.                                   01090000
011000     05  PC-NO-VENDOR-NAME-MSG           PIC  X(19)  VALUE        01100000
011100         'NO VNDR NAME FOUND '.                                   01110000
011200     05  PC-ENTER-THROUGH-MENU-MSG       PIC  X(19)  VALUE        01120000
011300         'ENTER THROUGH MENU '.                                   01130000
011400     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        01140000
011500         'TRANS NOT AVAILABLE'.                                   01150000
011600     05  PC-PRIMARY-NAME         PIC X(2)     VALUE '01'.         01160000
011700*                                                                 01170000
011800 01  PS-PROGRAM-SWITCHES.                                         01180000
011900     05  PS-VENDOR-NAME-FOUND-IND        PIC  X(01)  VALUE 'N'.   01190000
012000         88  PS-VENDOR-NAME-NOT-FOUND                VALUE 'N'.   01200000
012100         88  PS-VENDOR-NAME-FOUND                    VALUE 'Y'.   01210000
012200     05  PS-EDIT-FAILED-IND              PIC  X(01)  VALUE 'N'.   01220000
012300         88  PS-NO-EDIT-ERROR                        VALUE 'N'.   01230000
012400         88  PS-EDIT-FAILED                          VALUE 'Y'.   01240000
012500*                                                                 01250000
012600 01  PV-PROGRAM-VARIABLES.                                        01260000
012700     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01270000
012800     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01280000
012900                                                     COMP SYNC.   01290000
013000     05  PV-UPC-CHECK-DIGIT-MSG.                                  01300000
013100         10  FILLER                      PIC  X(17)  VALUE        01310000
013200             'CORRECT CKDGT IS '.                                 01320000
013300         10  PV-COMPUTED-UPC-CHECK-DIGIT                          01330000
013400                                         PIC  9(01)  VALUE ZERO.  01340000
013500         10  FILLER                      PIC  X(02)  VALUE SPACE. 01350000
013600     05  PV-UPC-NMBR                     PIC S9(15)  VALUE ZEROS  01360000
013700                                                     COMP-3.      01370000
013710******************************************************************01371000
013720*  PV-FORMATTED-SKU VARIABLE REPLACED BY PV-SKU-NBR  WR # 21361  *01372000
013730******************************************************************01373000
014310     05  PV-SEQ-NBR                      PIC  X(08)  VALUE SPACE. 01431000
014400     05  PV-SELECT-COUNTER               PIC S9(04)  VALUE +0     01440000
014500                                                     COMP SYNC.   01450000
014600     05  PV-DEPT-NUMBER                  PIC  X(03)  VALUE ZEROES.01460000
014700     05  PV-INHOUSE-NUMBER               PIC  9(03)  VALUE ZEROES.01470000
014800     05  PV-KEY-FEEDBACK-AREA            PIC  X(11)  VALUE SPACES.01480000
014900     05  PV-FORMATTED-GROUP-PRICING.                              01490000
015000         10  PV-FORMATTED-GROUP-QUANTITY.                         01500000
015100             15  PV-GROUP-QUANTITY-X     PIC  X(01)  VALUE SPACE. 01510000
015200             15  PV-GROUP-QUANTITY  REDEFINES                     01520000
015300                     PV-GROUP-QUANTITY-X PIC  9(01).              01530000
015400             15  PV-GROUP-QUANTITY-SLASH PIC  X(01)  VALUE SPACE. 01540000
015500         10  PV-FORMATTED-GROUP-PRICE    PIC  X(07)  VALUE SPACE. 01550021
015600     05  PV-GROUP-PRICE-NUMERIC-EDIT     PIC ZZZZZ.ZZ.            01560022
015700     05  PV-GROUP-PRICE-NUMERIC-EDIT-X  REDEFINES                 01570000
015800             PV-GROUP-PRICE-NUMERIC-EDIT PIC  X(08).              01580022
015900     05  PV-UNSTRING-SPACE-DELIMITER     PIC  X(01)  VALUE SPACE. 01590000
016000     05  PV-MAX-GROUP-PRICE-DIGITS       PIC  9(04)V9(02)         01600000
016100                                                     VALUE ZEROS. 01610000
016200     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01620000
016300                                                                  01630000
016400*                                                                 01640000
016500*  GENEREATED DSECT FOR THE FSKM026 MAPSET                        01650000
016600*                                                                 01660000
016700     COPY MPKM026.                                                01670000
016800                                                                  01680000
016900*                                                                 01690000
017000*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               01700000
017100*                                                                 01710000
017200     COPY DPWS013.                                                01720000
017300                                                                  01730000
017400*                                                                 01740000
017500*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01750000
017600*                                                                 01760000
017700     COPY DPWS015.                                                01770000
017800                                                                  01780000
017900*                                                                 01790000
018000*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01800000
018100*                                                                 01810000
018200     COPY DFHAID.                                                 01820000
018300                                                                  01830000
018301******************************************************************01830100
018302*   INCLUDED COPYBOOK XLWS001                        WR # 21361  *01830200
018303******************************************************************01830300
018304     COPY XLWS001.                                                01830400
018305                                                                  01830500
018310******************************************************************01831000
018320*   REMOVED REFERENCES TO TSK TABLE                    WR# 21361 *01832000
018330******************************************************************01833000
019000                                                                  01900000
019011******************************************************************01901100
019020*   REMOVED REFERENCES TO TUPCSKU TABLE                WR# 21361 *01902000
019030******************************************************************01903000
019610******************************************************************01961000
019620*   CHANGE MADE FOR WR# 21361 ENDS HERE                           01962000
019630******************************************************************01963000
019700                                                                  01970000
019800*                                                                 01980000
019900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE VENDOR NAME TABLE. 01990000
020000*                                                                 02000000
020100     EXEC SQL                                                     02010000
020200         INCLUDE TENTNME                                          02020000
020300     END-EXEC.                                                    02030000
020400                                                                  02040000
020500*                                                                 02050000
020600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE VENDOR/DEPT TABLE. 02060000
020700*                                                                 02070000
020800     EXEC SQL                                                     02080000
020900         INCLUDE TVNDDPT                                          02090000
021000     END-EXEC.                                                    02100000
021100                                                                  02110000
021200*                                                                 02120000
021300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE VENDOR AGREEMENT   02130000
021400*  TABLE.                                                         02140000
021500*                                                                 02150000
021600     EXEC SQL                                                     02160000
021700         INCLUDE TVNDAGR                                          02170000
021800     END-EXEC.                                                    02180000
021900                                                                  02190000
022000*                                                                 02200000
022100*  COMMUNICATIONS AREA FOR DB2                                    02210000
022200*                                                                 02220000
022300     EXEC SQL                                                     02230000
022400         INCLUDE SQLCA                                            02240000
022500     END-EXEC.                                                    02250000
022600                                                                  02260000
022700*                                                                 02270000
022800*  UPC PARAMETER LIST FOR CALLING THE UPC CHECK DIGIT ROUTINE.    02280000
022900*                                                                 02290000
023000     COPY DPWS040I.                                               02300000
023100                                                                  02310000
023200******************************************************************02320000
023300 LINKAGE SECTION.                                                 02330000
023400******************************************************************02340000
023500 01  DFHCOMMAREA.                                                 02350000
023501     05  FILLER                       OCCURS 1 TO 4072 TIMES      02350100
023502                                      DEPENDING ON EIBCALEN.      02350200
023503         10  FILLER                   PIC X.                      02350300
023510                                                                  02351000
023600                                                                  02360000
023700******************************************************************02370000
023800 PROCEDURE DIVISION.                                              02380000
023900******************************************************************02390000
024000 0000-PROGRAM-MAINLINE.                                           02400000
024100     MOVE DFHCOMMAREA TO CA-COMMAREA.                             02410000
024200                                                                  02420000
024300     EVALUATE TRUE                                                02430000
024400         WHEN EIBCALEN = ZERO                                     02440000
024500             MOVE PC-ENTER-THROUGH-MENU-MSG TO PV-MESSAGE-AREA    02450000
024600             PERFORM 8300-RETURN                                  02460000
024700         WHEN CA-INITIALIZE-SCREEN                                02470000
024800             PERFORM 1000-INITIALIZE                              02480000
024900             PERFORM 8000-SEND-MAP                                02490000
025000             PERFORM 8200-RETURN-TRANID                           02500000
025100         WHEN EIBAID = DFHENTER                                   02510000
025200             PERFORM 2000-PROCESS-SCREEN-FIELDS                   02520000
025300         WHEN EIBAID = DFHPF3                                     02530000
025400             PERFORM 4000-XCTL-LRT-MENU                           02540000
025500         WHEN EIBAID = DFHCLEAR                                   02550000
025600             MOVE SPACES TO AMSGLNO                               02560000
025700             INITIALIZE CA-PROGRAM-DATA                           02570000
025800             PERFORM 8000-SEND-MAP                                02580000
025900             PERFORM 8200-RETURN-TRANID                           02590000
026000         WHEN OTHER                                               02600000
026100             MOVE PC-UNRECOGNIZED-PF-KEY-MSG TO AMSGLNO           02610000
026200             PERFORM 8100-SEND-DATA-ONLY                          02620000
026300             PERFORM 8200-RETURN-TRANID                           02630000
026400     END-EVALUATE.                                                02640000
026500                                                                  02650000
026600     GOBACK.                                                      02660000
026700*                                                                 02670000
026800 1000-INITIALIZE.                                                 02680000
026900     MOVE LOW-VALUES               TO MP026AI.                    02690000
027000     SET CA-PROCESS-SCREEN         TO TRUE.                       02700000
027100     MOVE SPACES                   TO AMSGLNO.                    02710000
027200     INITIALIZE CA-PROGRAM-DATA.                                  02720000
027300*                                                                 02730000
027400 2000-PROCESS-SCREEN-FIELDS.                                      02740000
027500     MOVE LOW-VALUES      TO MP026AI.                             02750000
027600     SET PS-NO-EDIT-ERROR TO TRUE.                                02760000
027700                                                                  02770000
027800     PERFORM 2100-RECEIVE-MAP.                                    02780000
027900     PERFORM 2200-SET-ATTRIBUTES-TO-DEFAULT.                      02790000
028000                                                                  02800000
028100     PERFORM 3000-EDIT-UPC.                                       02810000
028200     PERFORM 3100-VALIDATE-CHECK-DIGIT.                           02820000
028210******************************************************************02821000
028220*                                                      WR# 21361 *02822000
028221*   CALL TO 3200-DETERMINE-ITEM-NMBR REMOVED AND                 *02822100
028230*   CALL TO 7100-SELECT-SKUINFO-BY-ITEMNBR REPLACED BY           *02823000
028231*   CALL TO 7100-CALL-XLKUT-DOMAIN-PGM                           *02823100
028240******************************************************************02824000
028410     PERFORM 7100-CALL-XLKUT-DOMAIN-PGM.                          02841000
028420******************************************************************02842000
028430*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *02843000
028440******************************************************************02844000
028500                                                                  02850000
028600     EVALUATE TRUE                                                02860000
028700         WHEN SQLCODE = ZERO                                      02870000
028800             CONTINUE                                             02880000
028900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          02890000
029000             MOVE PC-UPC-NOT-ASOC-TO-SKU-MSG TO AMSGLNO           02900000
029100             PERFORM 8100-SEND-DATA-ONLY                          02910000
029200             PERFORM 8200-RETURN-TRANID                           02920000
029300     END-EVALUATE.                                                02930000
029400                                                                  02940000
029500     PERFORM 3300-FILL-MAP-AND-COMMAREA.                          02950000
029600     PERFORM 8100-SEND-DATA-ONLY.                                 02960000
029700     PERFORM 8200-RETURN-TRANID.                                  02970000
029800*                                                                 02980000
029900 2100-RECEIVE-MAP.                                                02990000
030000     EXEC CICS                                                    03000000
030100         RECEIVE MAP    ('MP026A')                                03010000
030200                 MAPSET ('MPKM026')                               03020000
030300                 RESP   (PV-CICS-RESPONSE)                        03030000
030400     END-EXEC.                                                    03040000
030500                                                                  03050000
030600     EVALUATE TRUE                                                03060000
030700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03070000
030800             PERFORM 2110-RECEIVE-SCREEN-FIELDS                   03080000
030900         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                03090000
031000             CONTINUE                                             03100000
031100         WHEN OTHER                                               03110000
031200            MOVE '2100-RECEIVE-MAP'      TO DP013-PARAGRAPH       03120000
031300            MOVE 'UNABLE TO RECEIVE MAP' TO DP013-MESSAGE-TEXT (1)03130000
031400            SET DP013-LOGIC-ABEND        TO TRUE                  03140000
031500            SET DP013-NO-ROLLBACK        TO TRUE                  03150000
031600            PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                03160000
031700     END-EVALUATE.                                                03170000
031800*                                                                 03180000
031900 2110-RECEIVE-SCREEN-FIELDS.                                      03190000
032000     IF  AUPCNBRL > ZERO                                          03200000
032100         MOVE AUPCNBRI TO CA-UPC-NMBR-X                           03210000
032200     ELSE                                                         03220000
032300         IF AUPCNBRA = DP015-ERASE-EOF                            03230000
032400             MOVE SPACES TO CA-UPC-NMBR-X                         03240000
032500         END-IF                                                   03250000
032600     END-IF.                                                      03260000
032700*                                                                 03270000
032800 2200-SET-ATTRIBUTES-TO-DEFAULT.                                  03280000
032900     MOVE DP015-UNP-ALP-NOR-OFF    TO AUPCNBRA.                   03290000
033000     MOVE SPACES                   TO ASKUO                       03300000
033100                                      AMOINDO                     03310000
033200                                      ADESCO                      03320000
033300                                      AVNDRNMO                    03330000
033400                                      ASTYLEO                     03340000
033500                                      ASIZEO                      03350000
033600                                      ACOLORO                     03360000
033700                                      AGRPRTLO                    03370000
033800                                      AMSGLNO.                    03380000
033900     MOVE ZEROS                    TO ARETAILO.                   03390000
034000*                                                                 03400000
034100 3000-EDIT-UPC.                                                   03410000
034200     IF CA-FIRST-DIGIT-COUNTRY-CODE = SPACES                      03420000
034300         IF CA-LAST-TWELVE-BYTES-OF-UPC NUMERIC                   03430000
034400             MOVE CA-LAST-TWELVE-BYTES-OF-UPC                     03440000
034500                 TO PV-UPC-NMBR                                   03450000
034600         ELSE                                                     03460000
034700             MOVE DP015-UNP-NUM-BRT-MDT  TO AUPCNBRA              03470000
034800             MOVE PC-UPC-NOT-NUMERIC-MSG TO AMSGLNO               03480000
034900             SET PS-EDIT-FAILED          TO TRUE                  03490000
035000         END-IF                                                   03500000
035100     ELSE                                                         03510000
035200         IF CA-CHECK-DIGIT = SPACES                               03520000
035300             IF CA-FIRST-TWELVE-BYTES-OF-UPC NUMERIC              03530000
035400                 MOVE CA-FIRST-TWELVE-BYTES-OF-UPC                03540000
035500                     TO PV-UPC-NMBR                               03550000
035600             ELSE                                                 03560000
035700                 MOVE DP015-UNP-NUM-BRT-MDT  TO AUPCNBRA          03570000
035800                 MOVE PC-UPC-NOT-NUMERIC-MSG TO AMSGLNO           03580000
035900                 SET PS-EDIT-FAILED          TO TRUE              03590000
036000             END-IF                                               03600000
036100         ELSE                                                     03610000
036200             IF CA-UPC-NMBR NOT NUMERIC                           03620000
036300                 MOVE DP015-UNP-NUM-BRT-MDT  TO AUPCNBRA          03630000
036400                 MOVE PC-UPC-NOT-NUMERIC-MSG TO AMSGLNO           03640000
036500                 SET PS-EDIT-FAILED          TO TRUE              03650000
036600             ELSE                                                 03660000
036700                 MOVE CA-UPC-NMBR TO PV-UPC-NMBR                  03670000
036800             END-IF                                               03680000
036900         END-IF                                                   03690000
037000     END-IF.                                                      03700000
037100                                                                  03710000
037200     IF PS-EDIT-FAILED                                            03720000
037300         PERFORM 8100-SEND-DATA-ONLY                              03730000
037400         PERFORM 8200-RETURN-TRANID                               03740000
037500     END-IF.                                                      03750000
037600*                                                                 03760000
037700 3100-VALIDATE-CHECK-DIGIT.                                       03770000
037800     INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS.                     03780000
037900     SET DP040I-COMP-CHECK-DIGIT-OPTION TO TRUE.                  03790000
038000                                                                  03800000
038100     IF CA-UPC-NMBR = ZEROS                                       03810000
038200         MOVE DP015-UNP-NUM-BRT-MDT TO AUPCNBRA                   03820000
038300         MOVE PC-UPC-NOT-VALID-MSG  TO AMSGLNO                    03830000
038400         PERFORM 8100-SEND-DATA-ONLY                              03840000
038500         PERFORM 8200-RETURN-TRANID                               03850000
038600     ELSE                                                         03860000
038700         MOVE PV-UPC-NMBR TO DP040I-UPC-CODE                      03870000
038800     END-IF.                                                      03880000
038900                                                                  03890000
039000     CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                          03900024
039000                     USING DP040I-UPC-CHECK-DIGIT-PARMS.          03901024
039100                                                                  03910000
039200     IF DP040I-COMPUTED-UPC-CHK-DIGIT = DP040I-UPC-CHECK-DIGIT    03920000
039300         CONTINUE                                                 03930000
039400     ELSE                                                         03940000
039500         MOVE DP015-UNP-NUM-BRT-MDT  TO AUPCNBRA                  03950000
039600         MOVE DP040I-COMPUTED-UPC-CHK-DIGIT                       03960000
039700             TO PV-COMPUTED-UPC-CHECK-DIGIT                       03970000
039800         MOVE PV-UPC-CHECK-DIGIT-MSG TO AMSGLNO                   03980000
039900         PERFORM 8100-SEND-DATA-ONLY                              03990000
040000         PERFORM 8200-RETURN-TRANID                               04000000
040100     END-IF.                                                      04010000
040200*                                                                 04020000
040210******************************************************************04021000
040220*  PARAGRAPH 3200-DETERMINE-ITEM-NMBR REMOVED          WR# 21361 *04022000
040240******************************************************************04024000
041410******************************************************************04141000
041420*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *04142000
041430******************************************************************04143000
041500*                                                                 04150000
041600 3300-FILL-MAP-AND-COMMAREA.                                      04160000
041700     PERFORM 3310-GET-VENDOR-NAME.                                04170000
041800     MOVE SPACE                  TO  AMSGLNO.                     04180000
041810******************************************************************04181000
041820*                                                    WR # 21361  *04182000
041821*   TSK VARIABLES REPLACED BY XL001 VARIABLE AND                 *04182100
041822*   PV-FORMATTED-SKU IS REPLACED BY PV-SKU-NBR                   *04182200
041830******************************************************************04183000
042310     MOVE XL001-SKU-NBR          TO  PV-SEQ-NBR.                  04231000
042320     MOVE PV-SEQ-NBR             TO  CA-SKU                       04232000
042330                                     ASKUO.                       04233000
042510     MOVE XL001-UNT-RTL-AMT      TO  CA-CURRENT-UNIT-RETAIL-AMOUNT04251000
042520                                     ARETAILO.                    04252000
042600                                                                  04260000
042700     PERFORM 3320-GET-MARKOUT-STATUS.                             04270000
042800                                                                  04280000
042900     IF VNDAGR-MARKOUT-IND = 'Y'                                  04290000
043000        MOVE '*MO'               TO  CA-MARKOUT-IND               04300000
043100                                     AMOINDO                      04310000
043200     ELSE                                                         04320000
043300        MOVE SPACES              TO  CA-MARKOUT-IND               04330000
043400                                     AMOINDO                      04340000
043500     END-IF.                                                      04350000
043600                                                                  04360000
043700     PERFORM 3330-FORMAT-GROUP-PRICING.                           04370000
044510     IF  XL001-VS-NBR  =  SPACES                                  04451000
044520         MOVE XL001-VS-NBR       TO  CA-VENDOR-STYLE-CODE         04452000
044530                                     ASTYLEO                      04453000
044540     ELSE                                                         04454000
044550         MOVE XL001-VS-NBR       TO  CA-VENDOR-STYLE-CODE         04455000
044560                                     ASTYLEO                      04456000
044570     END-IF.                                                      04457000
044580     MOVE XL001-SKU-DESC         TO  CA-SKU-DESCRIPTION           04458000
044590                                     ADESCO.                      04459000
044591     MOVE XL001-SIZE-DESC        TO  CA-SIZE-DESCRIPTION          04459100
044592                                     ASIZEO.                      04459200
044593     MOVE XL001-SHRT-CLOR-DESC   TO  CA-COLOR-DESCRIPTION         04459300
044594                                     ACOLORO.                     04459400
044600     MOVE SPACES                 TO  AMSGLNO.                     04460000
044610******************************************************************04461000
044620*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *04462000
044630******************************************************************04463000
044700*                                                                 04470000
044800******************************************************************04480000
044900*  FIND THE VENDOR NAME FOR THAT SKU FROM THE IN HOUSE VENDOR     04490000
045000*  NUMBER OFF THE TSK TABLE.  THE PSB IS SCHEDULED AND TERMINATED 04500000
045100*  DIRECTLY BEFORE AND AFTER IT'S USE.                            04510000
045200******************************************************************04520000
045300 3310-GET-VENDOR-NAME.                                            04530000
045400                                                                  04540000
045500     SET PS-VENDOR-NAME-NOT-FOUND TO TRUE.                        04550000
045600                                                                  04560000
045700     PERFORM 3312-READ-VENDOR.                                    04570000
045800                                                                  04580000
045900     IF PS-VENDOR-NAME-FOUND                                      04590000
046000         MOVE ENTNME-ENT-NAME-DESC                                04600000
046100           TO CA-IN-HOUSE-VENDOR-NAME                             04610000
046200              AVNDRNMO                                            04620000
046300     ELSE                                                         04630000
046400         MOVE PC-NO-VENDOR-NAME-MSG TO CA-IN-HOUSE-VENDOR-NAME    04640000
046500                                       AVNDRNMO                   04650000
046600     END-IF.                                                      04660000
046700*                                                                 04670000
046800******************************************************************04680000
046900*  READ THE VENDOR / INHOUSE XREF TABLE AND VENDOR NAME TO GET   *04690000
047000*  THE VENDOR'S NAME                                             *04700000
047100*  IF ANY ERRORS ARE DETECTED, AN ERROR MESSAGE WILL             *04710000
047200*  BE FORMATTED AND SENT TO THE SCREEN AND CONTROL WILL BE RE-   *04720000
047300*  TURNED TO NATIVE CICS.                                        *04730000
047400******************************************************************04740000
047500 3312-READ-VENDOR.                                                04750000
047600     INITIALIZE DCLTVNDDPT                                        04760000
047700                DCLTENTNME                                        04770000
047800                PV-SELECT-COUNTER.                                04780000
047810******************************************************************04781000
047820*  ADDED VARYING PV-SELECT-COUNTER FROM 1 BY 1       WR # 21361  *04782000
047821*  IN THE PERFORM STATEMENT                                      *04782100
047830******************************************************************04783000
047900     PERFORM                                                      04790000
048000         WITH TEST AFTER                                          04800000
048010         VARYING PV-SELECT-COUNTER                                04801000
048020         FROM 1 BY 1                                              04802000
048100         UNTIL SQLCODE = ZERO                                     04810000
048200            OR SQLCODE = +100                                     04820000
048300            OR PV-SELECT-COUNTER > PC-MAX-RETRIES                 04830000
048310******************************************************************04831000
048320*  TSK VARIABLES REPLACED BY XL001 VARIABLES         WR # 21361  *04832000
048330******************************************************************04833000
048400         EXEC SQL                                                 04840000
048500              SELECT B.ENT_ID,                                    04850000
048600                     B.ENT_NAME_DESC                              04860000
048700                INTO :ENTNME-ENT-ID,                              04870000
048800                     :ENTNME-ENT-NAME-DESC                        04880000
048900                FROM TVNDDPT A,                                   04890000
049000                     TENTNME B                                    04900000
049210               WHERE A.DEPT_NBR = :XL001-DEPT-NBR-3CH             04921000
049230                 AND A.ENT_ID = :XL001-ENT-ID                     04923000
049300                 AND B.ENT_ID = A.ENT_ID                          04930000
049400                 AND B.TYPE_CDE = :PC-PRIMARY-NAME                04940000
049500         END-EXEC                                                 04950000
049600         EVALUATE TRUE                                            04960000
049700             WHEN SQLCODE = ZERO                                  04970000
049800             WHEN SQLCODE = +100                                  04980000
049900                  CONTINUE                                        04990000
050000             WHEN SQLCODE = -904                                  05000000
050100             WHEN SQLCODE = -913                                  05010000
050110******************************************************************05011000
050111*  ADD +1 TO PV-SELECT-COUNTER REMOVED              WR # 21361   *05011100
050120******************************************************************05012000
050210                  CONTINUE                                        05021000
050300             WHEN SQLCODE < ZERO                                  05030000
050400             WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))     05040000
050500             WHEN SQLWARN0 NOT = SPACES                           05050000
050600                 MOVE 'SELECT A VEND NAME FROM THE TENTNME TABLE' 05060000
050700                                    TO DP013-MESSAGE-TEXT(1)      05070000
050800         END-EVALUATE                                             05080000
050900     END-PERFORM.                                                 05090000
050910******************************************************************05091000
050920*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *05092000
050930******************************************************************05093000
051000                                                                  05100000
051100     EVALUATE TRUE                                                05110000
051200         WHEN SQLCODE = ZERO                                      05120000
051300             SET PS-VENDOR-NAME-FOUND    TO TRUE                  05130000
051400         WHEN SQLCODE = +100                                      05140000
051500             CONTINUE                                             05150000
051600         WHEN OTHER                                               05160000
051700               MOVE '3312-GET-VENDOR-NAME '                       05170000
051800                   TO DP013-PARAGRAPH                             05180000
051900               MOVE 'SELECTING VENDOR NAME FOR FOLLOWING UPC:'    05190000
052000                   TO DP013-MESSAGE-TEXT (1)                      05200000
052100               MOVE PV-UPC-NMBR                                   05210000
052200                   TO DP013-MESSAGE-TEXT (2)                      05220000
052300               MOVE SQLCA            TO DP013-SQLCA               05230000
052400               MOVE 'TVNDDPT'        TO DP013-DB2-TABLE-NAME (1)  05240000
052500               SET DP013-DB2-ABEND   TO TRUE                      05250000
052600               SET DP013-NO-ROLLBACK TO TRUE                      05260000
052700               PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG             05270000
052800               MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO          05280000
052900               PERFORM 8100-SEND-DATA-ONLY                        05290000
053000               PERFORM 8200-RETURN-TRANID                         05300000
053100     END-EVALUATE.                                                05310000
053200*                                                                 05320000
053300******************************************************************05330000
053400*  READ THE VENDOR AGREEMENT TABLE TO DETERMINE IF THE AGREEMENT *05340000
053500*  FOR THE SPECIFIED ITEM IS MARKOUT.                            *05350000
053600*  IF ANY ERRORS ARE DETECTED, AN ERROR MESSAGE WILL             *05360000
053700*  BE FORMATTED AND SENT TO THE SCREEN AND CONTROL WILL BE RE-   *05370000
053800*  TURNED TO NATIVE CICS.                                        *05380000
053900******************************************************************05390000
054000 3320-GET-MARKOUT-STATUS.                                         05400000
054100     INITIALIZE DCLTVNDAGR                                        05410000
054200                PV-SELECT-COUNTER.                                05420000
054210******************************************************************05421000
054220*  ADDED VARYING PV-SELECT-COUNTER FROM 1 BY 1       WR # 21361  *05422000
054230*  IN THE PERFORM STATEMENT                                      *05423000
054240******************************************************************05424000
054300     PERFORM                                                      05430000
054400         WITH TEST AFTER                                          05440000
054410         VARYING PV-SELECT-COUNTER                                05441000
054420         FROM 1 BY 1                                              05442000
054500         UNTIL SQLCODE = ZERO                                     05450000
054600            OR SQLCODE = +100                                     05460000
054700            OR PV-SELECT-COUNTER > PC-MAX-RETRIES                 05470000
054710******************************************************************05471000
054720*  TSK VARIABLES REPLACED BY XL001 VARIABLES         WR # 21361  *05472000
054730******************************************************************05473000
054800         EXEC SQL                                                 05480000
054900              SELECT MARKOUT_IND                                  05490000
055000                INTO :VNDAGR-MARKOUT-IND                          05500000
055100                FROM TVNDAGR                                      05510000
055200               WHERE ENT_ID     = :ENTNME-ENT-ID                  05520000
055310                 AND DEPT_NBR   = :XL001-DEPT-NBR-3CH             05531000
055400                 AND AGRMT_TYP_ID = '3'                           05540000
055500                 AND EFFECTIVE_DATE  <= CURRENT DATE              05550000
055600                 AND EXPIRATION_DATE >  CURRENT DATE              05560000
055700         END-EXEC                                                 05570000
055800         EVALUATE TRUE                                            05580000
055900             WHEN SQLCODE = ZERO                                  05590000
056000             WHEN SQLCODE = +100                                  05600000
056100                  CONTINUE                                        05610000
056200             WHEN SQLCODE = -904                                  05620000
056300             WHEN SQLCODE = -913                                  05630000
056310******************************************************************05631000
056320*  ADD +1 TO PV-SELECT-COUNTER REMOVED              WR # 21361   *05632000
056330******************************************************************05633000
056410                  CONTINUE                                        05641000
056500             WHEN SQLCODE < ZERO                                  05650000
056600             WHEN ((SQLCODE > ZERO) AND (SQLCODE NOT = +100))     05660000
056700             WHEN SQLWARN0 NOT = SPACES                           05670000
056800                 MOVE 'SELECT A VEND AGREEMENT FROM TVNDAGR'      05680000
056900                                    TO DP013-MESSAGE-TEXT(1)      05690000
057000         END-EVALUATE                                             05700000
057100     END-PERFORM.                                                 05710000
057200                                                                  05720000
057300     EVALUATE TRUE                                                05730000
057400         WHEN SQLCODE = ZERO                                      05740000
057500         WHEN SQLCODE = +100                                      05750000
057600             CONTINUE                                             05760000
057700         WHEN OTHER                                               05770000
057800               MOVE '3320-GET-MARKOUT-STATUS'                     05780000
057900                   TO DP013-PARAGRAPH                             05790000
058000               MOVE 'SELECTING MARKOUT STAT FOR THE FOLLOWING'    05800000
058100                   TO DP013-MESSAGE-TEXT (1)                      05810000
058200               MOVE 'VENDOR AND DEPARTMENT: '                     05820000
058300                   TO DP013-MESSAGE-TEXT (2)                      05830000
058400               STRING ENTNME-ENT-NAME-DESC  DELIMITED BY SIZE     05840000
058500                      '  DEPT: '            DELIMITED BY SIZE     05850000
058600*                     TSK-MERCH-DEPT-NMBR   DELIMITED BY SIZE     05860000
058610                      XL001-DEPT-NBR-3CH    DELIMITED BY SIZE     05861000
058700                   INTO DP013-MESSAGE-TEXT (3)                    05870000
058800               MOVE SQLCA            TO DP013-SQLCA               05880000
058900               MOVE 'TVNDAGR'        TO DP013-DB2-TABLE-NAME (1)  05890000
059000               SET DP013-DB2-ABEND   TO TRUE                      05900000
059100               SET DP013-NO-ROLLBACK TO TRUE                      05910000
059200               PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG             05920000
059300               MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO          05930000
059400               PERFORM 8100-SEND-DATA-ONLY                        05940000
059500               PERFORM 8200-RETURN-TRANID                         05950000
059600     END-EVALUATE.                                                05960000
059700*                                                                 05970000
059800******************************************************************05980000
059900* THIS MODULE FORMATS GROUP PRICING ON THE SCREEN WHEN BOTH       05990000
060000* OPTIONAL UNITS AND OPTIONAL RETAIL EXIST, I.E. 3/16.00.         06000000
060100******************************************************************06010000
060200 3330-FORMAT-GROUP-PRICING.                                       06020000
060300*    IF TSK-GP-QTY > PC-ONE                                       06030000
060400*        MOVE TSK-GP-QTY     TO PV-GROUP-QUANTITY                 06040000
060410     IF XL001-GP-QTY > PC-ONE                                     06041000
060420         MOVE XL001-GP-QTY     TO PV-GROUP-QUANTITY               06042000
060500         MOVE PC-SLASH       TO PV-GROUP-QUANTITY-SLASH           06050000
060600                                                                  06060000
060700*        MOVE TSK-GP-RTL-AMT TO PV-MAX-GROUP-PRICE-DIGITS         06070000
060710         MOVE XL001-GP-AMT   TO PV-MAX-GROUP-PRICE-DIGITS         06071000
060800         MOVE PV-MAX-GROUP-PRICE-DIGITS                           06080000
060900             TO PV-GROUP-PRICE-NUMERIC-EDIT                       06090000
061000                                                                  06100000
061100         UNSTRING PV-GROUP-PRICE-NUMERIC-EDIT-X                   06110000
061200             DELIMITED BY ALL SPACES                              06120000
061300                 INTO PV-UNSTRING-SPACE-DELIMITER                 06130000
061400                      PV-FORMATTED-GROUP-PRICE                    06140000
061500                                                                  06150000
061600         MOVE PV-FORMATTED-GROUP-PRICING                          06160000
061700             TO CA-FORMATTED-GROUP-PRICING                        06170000
061800                AGRPRTLO                                          06180000
061900                                                                  06190000
062000         INITIALIZE PV-FORMATTED-GROUP-PRICING                    06200000
062100                    PV-GROUP-PRICE-NUMERIC-EDIT-X                 06210000
062200     ELSE                                                         06220000
062300         MOVE SPACES TO PV-GROUP-QUANTITY-X                       06230000
062400                        PV-GROUP-QUANTITY-SLASH                   06240000
062500                        PV-FORMATTED-GROUP-PRICE                  06250000
062600     END-IF.                                                      06260000
062610******************************************************************06261000
062620*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *06262000
062630******************************************************************06263000
062700*                                                                 06270000
062800 4000-XCTL-LRT-MENU.                                              06280000
062900     SET CA-INITIALIZE-SCREEN     TO TRUE.                        06290000
063000                                                                  06300000
063100     EVALUATE TRUE                                                06310000
063200         WHEN CA-LAST-PROGRAM = PC-LRT-MP-MENU-PGM                06320000
063300             MOVE PC-LRT-MP-MENU-PGM TO PV-TRANSFER-PROGRAM       06330000
063400         WHEN CA-LAST-PROGRAM = PC-LRT-STORE-MENU-PGM             06340000
063500             MOVE PC-LRT-STORE-MENU-PGM TO PV-TRANSFER-PROGRAM    06350000
063600         WHEN CA-LAST-PROGRAM = PC-LRT-QC-MENU-PGM                06360000
063700             MOVE PC-LRT-QC-MENU-PGM TO PV-TRANSFER-PROGRAM       06370000
063800     END-EVALUATE.                                                06380000
063900                                                                  06390000
064000     MOVE PC-CURRENT-PROGRAM-NAME TO CA-LAST-PROGRAM.             06400000
064100                                                                  06410000
064200     EXEC CICS                                                    06420000
064300         XCTL  PROGRAM   (PV-TRANSFER-PROGRAM)                    06430000
064400               COMMAREA  (CA-COMMON-DATA)                         06440000
064500               LENGTH    (PC-TRANSFER-UP-LENGTH)                  06450000
064600               RESP      (PV-CICS-RESPONSE)                       06460000
064700     END-EXEC.                                                    06470000
064800                                                                  06480000
064900     EVALUATE TRUE                                                06490000
065000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06500000
065100             CONTINUE                                             06510000
065200         WHEN OTHER                                               06520000
065300             MOVE '4000-XCTL-TO-LRT-MENU'                         06530000
065400                 TO DP013-PARAGRAPH                               06540000
065500             MOVE 'UNABLE TO XCTL TO THE LRT MENU PROGRAM: '      06550000
065600                 TO DP013-MESSAGE-TEXT (1)                        06560000
065700             MOVE PV-TRANSFER-PROGRAM                             06570000
065800                 TO DP013-MESSAGE-TEXT (2)                        06580000
065900             SET DP013-CICS-ABEND  TO TRUE                        06590000
066000             SET DP013-NO-ROLLBACK TO TRUE                        06600000
066100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               06610000
066200             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             06620000
066300             SET CA-PROCESS-SCREEN TO TRUE                        06630000
066400             INITIALIZE CA-PROGRAM-DATA                           06640000
066500             PERFORM 8000-SEND-MAP                                06650000
066600             PERFORM 8200-RETURN-TRANID                           06660000
066700     END-EVALUATE.                                                06670000
066800*                                                                 06680000
066810******************************************************************06681000
066820*   PARAGRAPH 7000-SELECT-ITEM-NMBR REMOVED            WR# 21361 *06682000
066830******************************************************************06683000
073210******************************************************************07321000
073220*                                                      WR# 21361 *07322000
073221*   PARAGRAPH 7100-SELECT-SKUINFO-BY-ITEMNBR RENAMED             *07322100
073230*   TO 7100-CALL-XLKUT-DOMAIN-PGM AND CALL TO XLKUT001 DOMAIN    *07323000
073231*   PGM IS ADDED.                                                *07323100
073240******************************************************************07324000
073310 7100-CALL-XLKUT-DOMAIN-PGM.                                      07331000
073400     PERFORM                                                      07340000
073500         WITH TEST AFTER                                          07350000
073600         VARYING PV-SELECT-COUNTER                                07360000
073700         FROM 1 BY 1                                              07370000
073800         UNTIL (PV-SELECT-COUNTER > PC-MAX-RETRIES                07380000
073900                   OR SQLCODE = ZERO                              07390000
074000                   OR SQLCODE = PC-ROW-NOT-FOUND)                 07400000
074100                                                                  07410000
074110******************************************************************07411000
074120*   REFERENCES TO DB2 TABLE TSK REMOVED              WR # 21361  *07412000
074130******************************************************************07413000
076710         INITIALIZE XL001-ITEM-COMMAREA                           07671000
076720                    XL001-COMMAREA                                07672000
076730*                                                                 07673000
076740         MOVE PV-UPC-NMBR TO XL001-KEY-UPC-NBR                    07674000
076750*                                                                 07675000
076760         SET XL001-BY-UPC-NBR                                     07676000
076770             XL001-SELECT-SKU                                     07677000
076780             XL001-SELECT-VND-STYL                                07678000
076790             XL001-SELECT-SKU-STR  TO TRUE                        07679000
076791*                                                                 07679100
076792         CALL XL001-VSM-PGM USING DFHEIBLK                        07679200
076793                                  XL001-COMMAREA                  07679300
076794                                  XL001-ITEM-COMMAREA             07679400
076795*                                                                 07679500
076796         MOVE XL001-SQLCA       TO SQLCA                          07679600
076797         MOVE XL001-SKU-SQLCODE TO SQLCODE                        07679700
076800                                                                  07680000
076900         EVALUATE TRUE                                            07690000
077000             WHEN SQLCODE = ZERO                                  07700000
077100             WHEN SQLCODE = -904                                  07710000
077200             WHEN SQLCODE = -913                                  07720000
077300             WHEN SQLCODE = +100                                  07730000
077400                 CONTINUE                                         07740000
077500             WHEN SQLWARN0 NOT = SPACES                           07750000
077600             WHEN SQLCODE < ZERO                                  07760000
077700             WHEN SQLCODE > ZERO                                  07770000
077800                 MOVE '7100-CALL-XLKUT-DOMAIN-PGM'                07780000
077900                     TO DP013-PARAGRAPH                           07790000
078110                 MOVE 'SELECT SKU INFORMATION FOR THE FOLLOWING UP07811000
078120-                     'C NUMBER: '                                07812000
078200                     TO DP013-MESSAGE-TEXT (1)                    07820000
078300                 MOVE PV-UPC-NMBR                                 07830000
078400                     TO DP013-MESSAGE-TEXT (2)                    07840000
078500                 MOVE SQLCA            TO DP013-SQLCA             07850000
078610                 MOVE 'XLV_SKU'        TO DP013-DB2-TABLE-NAME (1)07861000
078700                 SET DP013-DB2-ABEND   TO TRUE                    07870000
078800                 SET DP013-NO-ROLLBACK TO TRUE                    07880000
078900                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           07890000
079000                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO        07900000
079100                 PERFORM 8100-SEND-DATA-ONLY                      07910000
079200                 PERFORM 8200-RETURN-TRANID                       07920000
079300         END-EVALUATE                                             07930000
079301*                                                                 07930100
079310         MOVE XL001-VND-STYL-SQLCODE TO SQLCODE                   07931000
079320                                                                  07932000
079330         EVALUATE TRUE                                            07933000
079340             WHEN SQLCODE = ZERO                                  07934000
079350             WHEN SQLCODE = -904                                  07935000
079360             WHEN SQLCODE = -913                                  07936000
079370             WHEN SQLCODE = +100                                  07937000
079380                 CONTINUE                                         07938000
079390             WHEN SQLWARN0 NOT = SPACES                           07939000
079391             WHEN SQLCODE < ZERO                                  07939100
079392             WHEN SQLCODE > ZERO                                  07939200
079393                 MOVE '7100-CALL-XLKUT-DOMAIN-PGM'                07939300
079394                     TO DP013-PARAGRAPH                           07939400
079397                 MOVE 'SELECT SKU INFORMATION FOR THE FOLLOWING UP07939700
079398-                     'C NUMBER: '                                07939800
079399                     TO DP013-MESSAGE-TEXT (1)                    07939900
079400                 MOVE PV-UPC-NMBR                                 07940000
079401                     TO DP013-MESSAGE-TEXT (2)                    07940100
079402                 MOVE SQLCA            TO DP013-SQLCA             07940200
079404                 MOVE 'XLV_VND_STYL'   TO DP013-DB2-TABLE-NAME (1)07940400
079405                 SET DP013-DB2-ABEND   TO TRUE                    07940500
079406                 SET DP013-NO-ROLLBACK TO TRUE                    07940600
079407                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           07940700
079408                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO        07940800
079409                 PERFORM 8100-SEND-DATA-ONLY                      07940900
079410                 PERFORM 8200-RETURN-TRANID                       07941000
079411         END-EVALUATE                                             07941100
079412*                                                                 07941200
079413         MOVE XL001-SKU-STR-SQLCODE TO SQLCODE                    07941300
079414                                                                  07941400
079415         EVALUATE TRUE                                            07941500
079416             WHEN SQLCODE = ZERO                                  07941600
079417             WHEN SQLCODE = -904                                  07941700
079418             WHEN SQLCODE = -913                                  07941800
079419             WHEN SQLCODE = +100                                  07941900
079420                 CONTINUE                                         07942000
079421             WHEN SQLWARN0 NOT = SPACES                           07942100
079422             WHEN SQLCODE < ZERO                                  07942200
079423             WHEN SQLCODE > ZERO                                  07942300
079424                 MOVE '7100-CALL-XLKUT-DOMAIN-PGM'                07942400
079425                     TO DP013-PARAGRAPH                           07942500
079428                 MOVE 'SELECT SKU INFORMATION FOR THE FOLLOWING UP07942800
079429-                     'C NUMBER: '                                07942900
079430                     TO DP013-MESSAGE-TEXT (1)                    07943000
079431                 MOVE PV-UPC-NMBR                                 07943100
079432                     TO DP013-MESSAGE-TEXT (2)                    07943200
079433                 MOVE SQLCA            TO DP013-SQLCA             07943300
079435                 MOVE 'XLV_SKU_STR'    TO DP013-DB2-TABLE-NAME (1)07943500
079436                 SET DP013-DB2-ABEND   TO TRUE                    07943600
079437                 SET DP013-NO-ROLLBACK TO TRUE                    07943700
079438                 PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG           07943800
079439                 MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO        07943900
079440                 PERFORM 8100-SEND-DATA-ONLY                      07944000
079441                 PERFORM 8200-RETURN-TRANID                       07944100
079442         END-EVALUATE                                             07944200
079450     END-PERFORM.                                                 07945000
079500                                                                  07950000
079600     IF PV-SELECT-COUNTER > PC-MAX-RETRIES                        07960000
079700        MOVE '7100-CALL-XLKUT-DOMAIN-PGM'                         07970000
079800            TO DP013-PARAGRAPH                                    07980000
079900        MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT A ROW'07990000
080000            TO DP013-MESSAGE-TEXT (1)                             08000000
080100        MOVE 'FROM THE SKU TABLE FOR THE FOLLOWING ITEM NUMBER: ' 08010000
080200            TO DP013-MESSAGE-TEXT (2)                             08020000
080300        MOVE PV-UPC-NMBR                                          08030000
080400            TO DP013-MESSAGE-TEXT (3)                             08040000
080500        MOVE SQLCA            TO DP013-SQLCA                      08050000
080610        MOVE 'XLKUT001'       TO DP013-DB2-TABLE-NAME (1)         08061017
080700        SET DP013-DB2-ABEND   TO TRUE                             08070000
080800        SET DP013-NO-ROLLBACK TO TRUE                             08080000
080900        PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                    08090000
081000        MOVE PC-DB2-DATABASE-ERROR-MSG TO AMSGLNO                 08100000
081100        PERFORM 8100-SEND-DATA-ONLY                               08110000
081200        PERFORM 8200-RETURN-TRANID                                08120000
081300     END-IF.                                                      08130000
081310******************************************************************08131017
081320*   CHANGE MADE FOR WR# 21361 ENDS HERE                          *08132017
081330******************************************************************08133017
081400*                                                                 08140000
081500 8000-SEND-MAP.                                                   08150000
081600     EXEC CICS                                                    08160000
081700         SEND MAP       ('MP026A')                                08170000
081800              MAPSET    ('MPKM026')                               08180000
081900              ERASE                                               08190000
082000              RESP      (PV-CICS-RESPONSE)                        08200000
082100     END-EXEC.                                                    08210000
082200                                                                  08220000
082300     EVALUATE TRUE                                                08230000
082400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08240000
082500             CONTINUE                                             08250000
082600         WHEN OTHER                                               08260000
082700             MOVE '8000-SEND-MAP'      TO DP013-PARAGRAPH         08270000
082800             MOVE 'UNABLE TO SEND MAP' TO DP013-MESSAGE-TEXT (1)  08280000
082900             SET DP013-CICS-ABEND      TO TRUE                    08290000
083000             SET DP013-NO-ROLLBACK     TO TRUE                    08300000
083100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08310000
083200     END-EVALUATE.                                                08320000
083300*                                                                 08330000
083400 8100-SEND-DATA-ONLY.                                             08340000
083500     MOVE -1 TO AUPCNBRL.                                         08350000
083600                                                                  08360000
083700     EXEC CICS                                                    08370000
083800         SEND MAP       ('MP026A')                                08380000
083900              MAPSET    ('MPKM026')                               08390000
084000              CURSOR                                              08400000
084100              DATAONLY                                            08410000
084200              RESP      (PV-CICS-RESPONSE)                        08420000
084300     END-EXEC.                                                    08430000
084400                                                                  08440000
084500     EVALUATE TRUE                                                08450000
084600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08460000
084700             CONTINUE                                             08470000
084800         WHEN OTHER                                               08480000
084900             MOVE '8100-SEND-DATA-ONLY' TO DP013-PARAGRAPH        08490000
085000             MOVE 'UNABLE TO SEND DATA' TO DP013-MESSAGE-TEXT (1) 08500000
085100             SET DP013-CICS-ABEND       TO TRUE                   08510000
085200             SET DP013-NO-ROLLBACK      TO TRUE                   08520000
085300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08530000
085400     END-EVALUATE.                                                08540000
085500*                                                                 08550000
085600 8200-RETURN-TRANID.                                              08560000
085700     EXEC CICS                                                    08570000
085800         RETURN TRANSID  (PC-TRANID)                              08580000
085900                COMMAREA (CA-COMMAREA)                            08590000
086000                LENGTH   (PC-COMMAREA-LENGTH)                     08600000
086100                RESP     (PV-CICS-RESPONSE)                       08610000
086200     END-EXEC.                                                    08620000
086300                                                                  08630000
086400     EVALUATE TRUE                                                08640000
086500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 08650000
086600             CONTINUE                                             08660000
086700         WHEN OTHER                                               08670000
086800             MOVE '8200-RETURN-TRANIND' TO DP013-PARAGRAPH        08680000
086900             MOVE 'UNABLE TO RETURN TO TRANID'                    08690000
087000                 TO DP013-MESSAGE-TEXT (1)                        08700000
087100             SET DP013-CICS-ABEND       TO TRUE                   08710000
087200             SET DP013-NO-ROLLBACK      TO TRUE                   08720000
087300             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               08730000
087400     END-EVALUATE.                                                08740000
087500*                                                                 08750000
087600 8300-RETURN.                                                     08760000
087700     EXEC CICS                                                    08770000
087800         SEND FROM (PV-MESSAGE-AREA)                              08780000
087900              LENGTH (19)                                         08790000
088000              ERASE                                               08800000
088100     END-EXEC.                                                    08810000
088200                                                                  08820000
088300     EXEC CICS                                                    08830000
088400         RETURN                                                   08840000
088500     END-EXEC.                                                    08850000
088600*                                                                 08860000
088700 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  08870000
088800     MOVE PC-CURRENT-PROGRAM-NAME  TO DP013-PROGRAM.              08880000
088900     MOVE DFHEIBLK                 TO DP013-DFHEIBLK.             08890000
089000     INITIALIZE DP013-SRC-TASK-NUMBER                             08900000
089100                DP013-STACK.                                      08910000
089200     SET DP013-LINK-RETURN TO TRUE.                               08920000
089300                                                                  08930000
089400     EXEC CICS                                                    08940000
089500         LINK                                                     08950000
089600             PROGRAM   (DP013-NAME)                               08960000
089700             COMMAREA  (DP013-PARAMETERS)                         08970000
089800             LENGTH    (DP013-LENGTH)                             08980000
089900     END-EXEC.                                                    08990000
090000*                                                                 09000000
