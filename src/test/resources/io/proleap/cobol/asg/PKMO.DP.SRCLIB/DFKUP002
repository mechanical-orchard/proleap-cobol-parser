000100******************************************************************00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300******************************************************************00030099
000400*                                                                 00040099
000500*    DAILY FLASH SALES ONLINE SUMMARY LOADER                      00050099
000600*                                                                 00060099
000700******************************************************************00070099
000800 PROGRAM-ID.             DFKUP002.                                00080099
000900 AUTHOR.                 JOSEPH MENYAH.                           00090099
001000 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00100099
001100 DATE-WRITTEN.           08-09-2004.                              00110099
001200 DATE-COMPILED.                                                   00120099
001300******************************************************************00130099
001400* THIS PROGRAM WILL READ THE MS DAILY SALES FILE AND POPULATE A   00140099
001500* TABLE THAT WILL TRACK RESULTS REQUIRED FOR FLASH SALES REPORTING00150099
001500*                                                                 00160099
KCK830* DELETE '830' FROM THE PV-BYPASS-DEPTS LIST, SO THAT KCK SALES   00170099
KCK830* WILL BE LOADED TO FLASH.                                        00180099
001700******************************************************************00190099
207210*  CHANGES MADE:                                                 *00200099
207210*     BY JIM HUNTER                          WR: CHG0207210      *00210099
207210*           08/27/2018                                           *00220099
207210*     REPLACE COPYBOOK KDU1806 WITH PSWS010                      *00230099
207210*                                                                *00231099
207210*     BY JEAN KURK                           WR: CHG0270407      *00232099
207210*           05/31/2022                                           *00233099
207210*     CHANGE FROM DOING A COMMIT AFTER EVERY STORE, TO COMMIT    *00234099
207210*     AFTER EVERY 10 SECONDS                                     *00235099
207210******************************************************************00240099
001800 ENVIRONMENT DIVISION.                                            00250099
001900******************************************************************00260099
002000 CONFIGURATION SECTION.                                           00270099
002100 SOURCE-COMPUTER.        IBM-3090.                                00280099
002200 OBJECT-COMPUTER.        IBM-3090.                                00290099
002300 INPUT-OUTPUT SECTION.                                            00300099
002400 FILE-CONTROL.                                                    00310099
005000     SELECT DAILY-SALES-FILE                                      00320099
005100            ASSIGN TO INP01.                                      00330099
002700                                                                  00340099
003100     SELECT DATE-CONTROL-FILE                                     00350099
003200            ASSIGN TO INP02.                                      00360099
003300                                                                  00370099
003400******************************************************************00380099
003500 DATA DIVISION.                                                   00390099
003600******************************************************************00400099
003700 FILE SECTION.                                                    00410099
006200 FD  DAILY-SALES-FILE                                             00420099
006300     LABEL RECORDS ARE STANDARD                                   00430099
006400     RECORDING MODE IS F                                          00440099
006500     BLOCK CONTAINS 0 RECORDS                                     00450099
006600     RECORD CONTAINS 65 CHARACTERS                                00460099
006700     DATA RECORD IS DAILY-SALES-RECORD.                           00470099
006800                                                                  00480099
006900 01  DAILY-SALES-RECORD        PIC X(65).                         00490099
004300                                                                  00500099
004400 FD  DATE-CONTROL-FILE                                            00510099
004500     RECORDING MODE F                                             00520099
004600     BLOCK CONTAINS 0 RECORDS                                     00530099
004700     LABEL RECORDS ARE OMITTED.                                   00540099
004800 01  DATE-CONTROL-RECORD              PIC  X(80).                 00550099
                                                                        00560099
005600 WORKING-STORAGE SECTION.                                         00570099
005700 01  FILLER                           PIC X(41)                   00580099
005800     VALUE 'WORKING STORAGE STARTS HERE FOR DFKUP002'.            00590099
006500                                                                  00600099
007100 01  PS-PROGRAM-SWITCHES-GLOBAL.                                  00610099
007200     05  PS-OFFICIAL-DLRS-SW       PIC X(01)  VALUE 'N'.          00620099
007300         88  PS-OFFICIAL-DLRS                 VALUE 'Y'.          00630099
007300         88  PS-NO-OFFICIAL-DLRS              VALUE 'N'.          00640099
                                                                        00650099
007200     05  PS-PROCESS-CURR-REC-SW    PIC X(01)  VALUE 'N'.          00660099
007300         88  PS-PROCESS-CURR-REC              VALUE 'Y'.          00670099
                                                                        00680099
007200     05  PS-PROCESS-PREV-REC-SW    PIC X(01)  VALUE 'N'.          00690099
007300         88  PS-PROCESS-PREV-REC              VALUE 'Y'.          00700099
                                                                        00710099
007400     05  PS-CONTROL-CARD-1-SW      PIC X(01)  VALUE 'N'.          00720099
007500         88  PS-CONTROL-CARD-1-END            VALUE 'Y'.          00730099
007600         88  PS-CONTROL-CARD-1-START          VALUE 'N'.          00740099
                                                                        00750099
007700     05  PS-CONTROL-CARD-2-SW      PIC X(01)  VALUE 'N'.          00760099
007800         88  PS-CONTROL-CARD-2-END            VALUE 'Y'.          00770099
007900         88  PS-CONTROL-CARD-2-START          VALUE 'N'.          00780099
                                                                        00790099
008000     05  PS-END-OF-DATE-FILE-SW    PIC X(01)  VALUE 'N'.          00800099
008100         88  PS-END-OF-DATE-FILE              VALUE 'Y'.          00810099
008200         88  PS-NOT-END-OF-DATE-FILE          VALUE 'N'.          00820099
008900                                                                  00830099
008000     05  PS-END-OF-FILE-SW         PIC X(01)  VALUE 'N'.          00840099
008100         88  PS-END-OF-FILE                   VALUE 'Y'.          00850099
008200         88  PS-NOT-END-OF-FILE               VALUE 'N'.          00860099
008900                                                                  00870099
010700     05  PS-VALID-DATE-SW          PIC X(01)  VALUE 'N'.          00880099
010800         88  PS-VALID-DATE                    VALUE 'Y'.          00890099
010900         88  PS-INVALID-DATE                  VALUE 'N'.          00900099
011000                                                                  00910099
011100     05  PS-VALID-DEPT-SW          PIC X(01)  VALUE 'N'.          00920099
011200         88  PS-VALID-DEPT                    VALUE 'Y'.          00930099
011300         88  PS-INVALID-DEPT                  VALUE 'N'.          00940099
011400                                                                  00950099
011500     05  PS-VALID-REC-SW           PIC X(01)  VALUE 'N'.          00960099
011600         88  PS-VALID-RECORD                  VALUE 'Y'.          00970099
011700         88  PS-INVALID-RECORD                VALUE 'N'.          00980099
011800                                                                  00990099
011500     05  PS-UPDATE-RECORD-SW       PIC X(01)  VALUE 'N'.          01000099
011600         88  PS-UPDATE-RECORD                 VALUE 'Y'.          01010099
011700         88  PS-NO-UPDATE-RECORD              VALUE 'N'.          01020099
011800                                                                  01030099
011500     05  PS-INSERT-RECORD-SW       PIC X(01)  VALUE 'N'.          01040099
011600         88  PS-INSERT-RECORD                 VALUE 'Y'.          01050099
011700         88  PS-NO-INSERT-RECORD              VALUE 'N'.          01060099
015800     05  PV-PARAGRAPH              PIC  X(48) VALUE SPACES.       01070099
011800                                                                  01080099
009400     05  PV-SAVED-STR              PIC S9(4)  COMP                01090099
009500                                              VALUE ZEROS.        01100099
011100     05  PV-COMMIT-TIMESTAMP     PIC X(26)    VALUE SPACES.       01101099
011200     05  PV-CURRENT-TIMESTAMP    PIC X(26)    VALUE SPACES.       01102099
                                                                        01110099
014000 01 PC-CONSTANTS.                                                 01120099
014100     05  PC-HEADER-LENGTH          PIC S9(9) COMP-3 VALUE 27.     01130099
014200     05  PC-DET-ITEM-LENGTH        PIC S9(9) COMP-3 VALUE 35.     01140099
014300     05  PC-PGM-NAME               PIC X(08)  VALUE 'DFKUP002'.   01150099
014400     05  PC-MAX-DETAIL-ITEMS       PIC S9(9) COMP-3 VALUE 200.    01160099
014500     05  PC-MAX-STORES             PIC 9(04)  VALUE 9999.         01170099
014600     05  PC-FIFTY-STARS            PIC X(50)  VALUE ALL '*'.      01180099
014700     05  PC-END-PGM-MSG            PIC X(100)                     01190099
014800                                   VALUE 'END RUN OF PROGRAM '.   01200099
                                                                        01210099
011900 01  ABEND-CODE                  PIC S9(4) COMP SYNC VALUE ZERO.  01220099
012000     88  AC-CONTROL-CARD-ERROR                  VALUE +4003.      01230099
006000     88  AC-INVALID-DATE-ERROR                   VALUE +4004.     01240099
006100     88  AC-DB2-ERROR                            VALUE +4013.     01250099
014900                                                                  01260099
017000 01  PV-PROGRAM-VARIABLES.                                        01270099
017100     05  PV-AMT-CLSN-CDE-N         PIC X  VALUE 'N'.              01280099
017100     05  PV-AMT-CLSN-CDE           PIC X.                         01290099
017100     05  PV-D040-STORENO           PIC S9(4) COMP.                01300099
017200     05  PV-D040-DATE1             PIC X(6).                      01310099
                                                                        01320099
017200     05  PV-D040-DATE.                                            01330099
017300         10  PV-D040-DATE-MM       PIC X(02).                     01340099
017400         10  PV-D040-DATE-DD       PIC X(02).                     01350099
017500         10  PV-D040-DATE-YY       PIC X(02).                     01360099
017600                                                                  01370099
017200     05  PV-DFT00000-SLS-DTE.                                     01380099
017500         10  PV-DFT00000-DATE-CC       PIC X(02).                 01390099
017500         10  PV-DFT00000-DATE-YY       PIC X(02).                 01400099
               10  FILLER                    PIC X.                     01410099
017300         10  PV-DFT00000-DATE-MM       PIC X(02).                 01420099
               10  FILLER                    PIC X.                     01430099
017400         10  PV-DFT00000-DATE-DD       PIC X(02).                 01440099
                                                                        01450099
017700     05  PV-DEPT-NBR               PIC S9(4)  COMP-3.             01460099
017700     05  PV-DEPT-CLS.                                             01470099
017800         10  PV-DEPT               PIC 9(4).                      01480099
017900         10  PV-CLASS              PIC 9(2).                      01490099
018000                                                                  01500099
018100     05  PV-BYPASS-DEPT-CLS        PIC 9(06).                     01510099
018200         88  PV-INVALID-DEPT-CLS   VALUE 009920                   01520099
018300                                         009970                   01530099
018400                                         009990.                  01540099
018500                                                                  01550099
018600     05  PV-BYPASS-DEPTS           PIC S9(04).                    01560099
018700         88  PV-INVALID-DEPTS      VALUE 0800                     01570099
018800                                         0817                     01580099
018900                                         0818                     01590099
019100                                         0981                     01600099
019200                                         0983                     01610099
019300                                         0098.                    01620099
019400     05  PV-READ-CNT               PIC 9(11).                     01630099
019400     05  PV-BYPASS-CNT             PIC 9(11).                     01640099
019400     05  PV-REC-UPDT-CNT           PIC 9(7).                      01650099
019400     05  PV-REC-INSRT-CNT          PIC 9(7).                      01660099
019400     05  PV-MSG-CNT                PIC 9(7).                      01670099
019400     05  PV-COMMIT-CNT             PIC 9(7).                      01671099
019400     05  PV-CURRENT-DATE1          PIC X(10).                     01680099
019500     05  PV-CURRENT-DATE.                                         01690099
019600         10  PV-CURR-CC            PIC X(02).                     01700099
019700         10  PV-CURR-YY            PIC X(02).                     01710099
019800         10  FILLER                PIC X(01) VALUE '-'.           01720099
019900         10  PV-CURR-MM            PIC X(02).                     01730099
020000         10  FILLER                PIC X(01) VALUE '-'.           01740099
020100         10  PV-CURR-DD            PIC X(02).                     01750099
020200                                                                  01760099
020300     05  PV-D040-DATE-RFMT1        PIC X(10).                     01770099
020300     05  PV-D040-DATE-RFMT.                                       01780099
020400         10  PV-D040-DATE-RFMT-CC  PIC X(02) VALUE '20'.          01790099
020500         10  PV-D040-DATE-RFMT-YY  PIC X(02).                     01800099
020600         10  FILLER                PIC X(01) VALUE '-'.           01810099
020700         10  PV-D040-DATE-RFMT-MM  PIC X(02).                     01820099
020800         10  FILLER                PIC X(01) VALUE '-'.           01830099
020900         10  PV-D040-DATE-RFMT-DD  PIC X(02).                     01840099
021000                                                                  01850099
021100     05  PV-ABEND-CODE             PIC 9999   COMP   VALUE ZEROS. 01860099
021200     05  PV-CUT-OFF-CCYY-MM-DD     PIC X(10).                     01870099
021300                                                                  01880099
021400     05  PV-STORE-COMPARE-DATE     PIC X(10).                     01890099
021500                                                                  01900099
021600     05  PV-EOD-MSG-COUNT          PIC S9(04) COMP-3              01910099
021700                                              VALUE ZERO.         01920099
021800     05  PV-EP15-INDEX-CNTR        PIC  9(15) COMP-3              01930099
021900                                              VALUE ZERO.         01940099
022000     05  PV-MTD-BEGIN-DATE.                                       01950099
022100         10 PV-MTD-BEGIN-YY      PIC 9(04)    VALUE ZEROES.       01960099
022200         10 FILLER               PIC X        VALUE SPACES.       01970099
022300         10 PV-MTD-BEGIN-MM      PIC 9(02)    VALUE ZEROES.       01980099
022400         10 FILLER               PIC X        VALUE SPACES.       01990099
022500         10 PV-MTD-BEGIN-DD      PIC 9(02)    VALUE ZEROES.       02000099
022600                                                                  02010099
022700     05  PV-MTD-END-DATE.                                         02020099
022800         10 PV-MTD-END-YY        PIC 9(04)    VALUE ZEROES.       02030099
022900         10 FILLER               PIC X        VALUE SPACES.       02040099
023000         10 PV-MTD-END-MM        PIC 9(02)    VALUE ZEROES.       02050099
023100         10 FILLER               PIC X        VALUE SPACES.       02060099
023200         10 PV-MTD-END-DD        PIC 9(02)    VALUE ZEROES.       02070099
023300                                                                  02080099
023400     05  PV-YTD-BEGIN-DATE.                                       02090099
023500         10 PV-YTD-BEGIN-YY      PIC 9(04)    VALUE ZEROES.       02100099
023600         10 FILLER               PIC X        VALUE SPACES.       02110099
023700         10 PV-YTD-BEGIN-MM      PIC 9(02)    VALUE ZEROES.       02120099
023800         10 FILLER               PIC X        VALUE SPACES.       02130099
023900         10 PV-YTD-BEGIN-DD      PIC 9(02)    VALUE ZEROES.       02140099
024000                                                                  02150099
024100     05  PV-YTD-END-DATE.                                         02160099
024200         10 PV-YTD-END-YY        PIC 9(04)    VALUE ZEROES.       02170099
024300         10 FILLER               PIC X        VALUE SPACES.       02180099
024400         10 PV-YTD-END-MM        PIC 9(02)    VALUE ZEROES.       02190099
024500         10 FILLER               PIC X        VALUE SPACES.       02200099
024600         10 PV-YTD-END-DD        PIC 9(02)    VALUE ZEROES.       02210099
024700                                                                  02220099
024800     05  PV-STD-BEGIN-DATE.                                       02230099
024900         10 PV-STD-BEGIN-YY      PIC 9(04)    VALUE ZEROES.       02240099
025000         10 FILLER               PIC X        VALUE SPACES.       02250099
025100         10 PV-STD-BEGIN-MM      PIC 9(02)    VALUE ZEROES.       02260099
025200         10 FILLER               PIC X        VALUE SPACES.       02270099
025300         10 PV-STD-BEGIN-DD      PIC 9(02)    VALUE ZEROES.       02280099
025400*                                                                 02290099
025500     05  PV-STD-END-DATE.                                         02300099
025600         10 PV-STD-END-YY        PIC 9(04)    VALUE ZEROES.       02310099
025700         10 FILLER               PIC X        VALUE SPACES.       02320099
025800         10 PV-STD-END-MM        PIC 9(02)    VALUE ZEROES.       02330099
025900         10 FILLER               PIC X        VALUE SPACES.       02340099
026000         10 PV-STD-END-DD        PIC 9(02)    VALUE ZEROES.       02350099
026100*                                                                 02360099
026200     05  PV-WTD-BEGIN-DATE.                                       02370099
026300         10 PV-WTD-BEGIN-YY      PIC 9(04)    VALUE ZEROES.       02380099
026400         10 FILLER               PIC X        VALUE SPACES.       02390099
026500         10 PV-WTD-BEGIN-MM      PIC 9(02)    VALUE ZEROES.       02400099
026600         10 FILLER               PIC X        VALUE SPACES.       02410099
026700         10 PV-WTD-BEGIN-DD      PIC 9(02)    VALUE ZEROES.       02420099
026800*                                                                 02430099
026900     05  PV-WTD-END-DATE.                                         02440099
027000         10 PV-WTD-END-YY        PIC 9(04)    VALUE ZEROES.       02450099
027100         10 FILLER               PIC X        VALUE SPACES.       02460099
027200         10 PV-WTD-END-MM        PIC 9(02)    VALUE ZEROES.       02470099
027300         10 FILLER               PIC X        VALUE SPACES.       02480099
027400         10 PV-WTD-END-DD        PIC 9(02)    VALUE ZEROES.       02490099
027500                                                                  02500099
026200     05  PV-QTD-BEGIN-DATE.                                       02510099
026300         10 PV-QTD-BEGIN-YY      PIC 9(04)    VALUE ZEROES.       02520099
026400         10 FILLER               PIC X        VALUE SPACES.       02530099
026500         10 PV-QTD-BEGIN-MM      PIC 9(02)    VALUE ZEROES.       02540099
026600         10 FILLER               PIC X        VALUE SPACES.       02550099
026700         10 PV-QTD-BEGIN-DD      PIC 9(02)    VALUE ZEROES.       02560099
026800*                                                                 02570099
026900     05  PV-QTD-END-DATE.                                         02580099
027000         10 PV-QTD-END-YY        PIC 9(04)    VALUE ZEROES.       02590099
027100         10 FILLER               PIC X        VALUE SPACES.       02600099
027200         10 PV-QTD-END-MM        PIC 9(02)    VALUE ZEROES.       02610099
027300         10 FILLER               PIC X        VALUE SPACES.       02620099
027400         10 PV-QTD-END-DD        PIC 9(02)    VALUE ZEROES.       02630099
027500                                                                  02640099
027600     05  PV-ARRAY-LENGTH            PIC S9(9) COMP-3 VALUE 0.     02650099
027700     05  PV-DET-ITEMS-COUNT         PIC S9(9) COMP-3 VALUE 0.     02660099
027800     05  PV-REMAINDER               PIC S9(9) COMP-3 VALUE 0.     02670099
027900     05  PV-SALE-AMT                PIC S9(5)V99 COMP-3 VALUE 0.  02680099
028000     05  PV-SALE-UNITS              PIC S9(5) COMP-3 VALUE 0.     02690099
028100                                                                  02700099
028200 01 CD-CONTROL-DATE.                                              02710099
028300     05  FILLER                    PIC X(20).                     02720099
028400     05  CD-POS-DATE-CYMD          PIC X(8).                      02730099
028500     05  FILLER                    REDEFINES CD-POS-DATE-CYMD.    02740099
028600         10  CD-POS-CENTURY        PIC X(2).                      02750099
028700         10  CD-POS-YEAR           PIC X(2).                      02760099
028800         10  CD-POS-MONTH          PIC X(2).                      02770099
028900         10  CD-POS-DAY            PIC X(2).                      02780099
029000     05  FILLER                    PIC X(52).                     02790099
029100*                                                                 02800099
029200*  DAILY SALES FILE COPYBOOK                                      02810099
029300*                                                                 02820099
207210     COPY PSWS010.                                                02830099
029500                                                                  02840099
029600*                                                                 02850099
029700*  DCLGEN FOR THE DAILY FLASH SUMMARY TABLE.                      02860099
029800*                                                                 02870099
029900     EXEC SQL                                                     02880099
030000        INCLUDE DFT00000                                          02890099
030100     END-EXEC.                                                    02900099
                                                                        02910099
015000*  DCLGEN FOR THE DAILY FLASH ML FINANCIAL SUMMARY TABLE.         02920099
015100*                                                                 02930099
015200     EXEC SQL                                                     02940099
015300        INCLUDE DFT00002                                          02950099
015400     END-EXEC.                                                    02960099
030200*                                                                 02970099
029700*  DCLGEN FOR THE XST LOCATION TABLE.                             02980099
029800*                                                                 02990099
029900     EXEC SQL                                                     03000099
030000        INCLUDE XST00001                                          03010099
030100     END-EXEC.                                                    03020099
030200*                                                                 03030099
014700*  DCLGEN FOR THE CHECKPOINT RESTART TABLE                        03032099
014900     EXEC SQL                                                     03034099
015000         INCLUDE TCKRSTCN                                         03035099
015100     END-EXEC.                                                    03036099
015200                                                                  03037099
030300*  DB2 COMMUNICATION AREA                                         03040099
030400     EXEC SQL                                                     03050099
030500        INCLUDE SQLCA                                             03060099
030600     END-EXEC.                                                    03070099
030700*                                                                 03080099
030800*  DB2 COMMUNICATION AREA 2                                       03090099
030900     COPY SQLCA2.                                                 03100099
031000                                                                  03110099
031100******************************************************************03120099
031200*    DATE CALCULATION ROUTINE RECORD LAYOUT                      *03130099
031300******************************************************************03140099
031400     COPY DPWS500.                                                03150099
031500                                                                  03160099
031600******************************************************************03170099
031700 PROCEDURE DIVISION.                                              03180099
031800******************************************************************03190099
031900**  IN PRODUCTION, INFORMATION FROM ALL FOUR FORMATTERS WILL BE   03200099
032000**  BE FUNNELED INTO ONE DAILY FLASH QUEUE SO MAIN PROCESSING WILL03210099
032100**  NOT END UNTIL ALL FOUR END OF DAY MESSAGES ARE IN.            03220099
032200**  IN TEST, MAIN PROCESSING WILL END WHEN ONE END OF DAY         03230099
032300**  MESSAGE IS FOUND.                                             03240099
                                                                        03250099
032400 0000-MAINLINE.                                                   03260099
032500     PERFORM 1000-READ-DATE-CONTROL.                              03270099
018900                                                                  03271099
019000     PERFORM 9250-GET-COMMIT-TIMESTAMP.                           03272099
                                                                        03280099
           MOVE ZEROS TO PV-SAVED-STR.                                  03290099
049100     PERFORM 9500-READ-DAILY-SALES-FILE.                          03300099
032700                                                                  03310099
033300     PERFORM 2000-PROCESS-DAILY-FILE                              03320099
033400             UNTIL PS-END-OF-FILE.                                03330099
                                                                        03340099
036900     CLOSE DAILY-SALES-FILE.                                      03350099
           DISPLAY 'RECORDS READ     ' PV-READ-CNT.                     03360099
           DISPLAY 'RECORDS BYPASSED ' PV-BYPASS-CNT.                   03370099
           DISPLAY 'COMMITS TAKEN    ' PV-COMMIT-CNT.                   03371099
                                                                        03380099
034000     GOBACK.                                                      03390099
034100                                                                  03400099
034200*0000-MAINLINE-EXIT.                                              03410099
034300******************************************************************03420099
034400 1000-READ-DATE-CONTROL.                                          03430099
034500*                                                                 03440099
034600******************************************************************03450099
034700     OPEN INPUT DATE-CONTROL-FILE                                 03460099
034700                DAILY-SALES-FILE.                                 03470099
034800                                                                  03480099
034900     READ DATE-CONTROL-FILE                                       03490099
035000       AT END                                                     03500099
035100         DISPLAY ' '                                              03510099
035200         DISPLAY '** ABEND     **'                                03520099
035300         DISPLAY '** PROGRAM   **  = DFKUP002'                    03530099
035400         DISPLAY '** PARAGRAPH **'                                03540099
035500          '= 1000-READ-DATE-CONTROL'                              03550099
035600         DISPLAY '** DATE CONTROL RECORD IS MISSING'              03560099
035700         CALL 'ILBOABN0' USING ABEND-CODE                         03570099
035800     END-READ.                                                    03580099
035900                                                                  03590099
036000     MOVE DATE-CONTROL-RECORD TO CD-CONTROL-DATE.                 03600099
036100                                                                  03610099
036200     MOVE CD-POS-CENTURY   TO PV-CURR-CC.                         03620099
036300     MOVE CD-POS-YEAR      TO PV-CURR-YY.                         03630099
036400     MOVE CD-POS-MONTH     TO PV-CURR-MM.                         03640099
036500     MOVE CD-POS-DAY       TO PV-CURR-DD.                         03650099
036500     MOVE PV-CURRENT-DATE  TO PV-CURRENT-DATE1                    03660099
036600                                                                  03670099
036700     PERFORM 9100-DATE-ROUTINE.                                   03680099
036800                                                                  03690099
036900     CLOSE DATE-CONTROL-FILE.                                     03700099
037000                                                                  03710099
048100                                                                  03720099
048200******************************************************************03730099
048300* THE MAIN PROCESS WILL RETRIEVE A MESSAGE, VALIDATE THE MESSAGE *03740099
048400* AND IF THE MESSAGE PASSES VALIDATION, LOAD IT TO THE DB2 FLASH *03750099
048500* TABLES.                                                        *03760099
048600******************************************************************03770099
048700 2000-PROCESS-DAILY-FILE.                                         03780099
                                                                        03790099
049400     IF NOT PS-END-OF-FILE                                        03800099
049500       PERFORM 2100-ANALYZE-RECORD                                03810099
049700     END-IF.                                                      03820099
                                                                        03830099
049100     PERFORM 9500-READ-DAILY-SALES-FILE.                          03840099
                                                                        03850099
022300     PERFORM 9150-CHECK-FOR-COMMIT.                               03851099
040012     IF PV-SAVED-STR NOT = DFT00000-STR-NBR                       03852099
040013*       DISPLAY '****COMITTING DEPARTMENT****'                    03870099
040014*       DISPLAY 'STORE COMMITTED: ' PV-SAVED-STR                  03880099
      *       PERFORM 9200-COMMIT-DB2                                   03890099
              MOVE DFT00000-STR-NBR TO PV-SAVED-STR                     03900099
           END-IF.                                                      03910099
049800                                                                  03920099
050000                                                                  03930099
050100*2000-EXIT.                                                       03940099
050200******************************************************************03950099
050300*  DETERMINE IF THE DAILY SALES RECORD SHOULD BE BYPASSED OR NOT.*03960099
050900******************************************************************03970099
051000 2100-ANALYZE-RECORD.                                             03980099
051200     EVALUATE TRUE                                                03990099
052200        WHEN D040-NORMAL-TRANS                                    04000099
051600            PERFORM 2200-PROCESS-RECORD                           04010099
                                                                        04020099
052200        WHEN D040-SALES-AUDIT-CORR                                04030099
                  ADD 1 TO PV-BYPASS-CNT                                04040099
052300            CONTINUE                                              04050099
                                                                        04060099
051300        WHEN D040-SYSTEM-LATE-CORR                                04070099
051400            PERFORM 2500-VERIFY-CUT-OFF                           04080099
051500            IF PS-VALID-DATE                                      04090099
051600               PERFORM 2200-PROCESS-RECORD                        04100099
                  ELSE                                                  04110099
                     ADD 1 TO PV-BYPASS-CNT                             04120099
052100            END-IF                                                04130099
052500                                                                  04140099
052600     END-EVALUATE.                                                04150099
052700                                                                  04160099
052800*2100-EXIT.                                                       04170099
052900                                                                  04180099
053000******************************************************************04190099
053100*  PROCESS THE VALID DAILY SALES FILE RECORD                     *04200099
053700******************************************************************04210099
053800 2200-PROCESS-RECORD.                                             04220099
           MOVE 'N'                    TO PV-AMT-CLSN-CDE.              04230099
                                                                        04240099
053900     PERFORM 2210-DEPT-CHECK                                      04250099
                                                                        04260099
054000     IF PS-VALID-DEPT                                             04270099
059800        PERFORM 2750-SELECT-DLY-FLSH-REC                          04280099
                                                                        04290099
054100        IF PS-UPDATE-RECORD                                       04300099
059800           PERFORM 2800-FORMAT-UPDATE-RECORD                      04310099
054400        ELSE                                                      04320099
069900           PERFORM 2910-FORMAT-INSERT-RECORD                      04330099
069900           PERFORM 3000-INSERT-DLY-FLASH-REC                      04340099
                                                                        04350099
054400        END-IF                                                    04360099
054500     END-IF.                                                      04370099
054600                                                                  04380099
054700******************************************************************04390099
054800*  EVALUATE RECORD TO DETERMINE IF THE DEPARTMENT IS VALID.      *04400099
      *  IF THE DEPARTMENT IS NOT VALID THE RECORD WILL BE BYPASSED.   *04410099
055000******************************************************************04420099
055100 2210-DEPT-CHECK.                                                 04430099
055200     MOVE D040-DEPT                 TO PV-BYPASS-DEPTS.           04440099
055200     MOVE D040-DEPT                 TO PV-DEPT.                   04450099
055200     MOVE D040-DEPT                 TO PV-DEPT-NBR.               04460099
055200     MOVE D040-CLASS                TO PV-CLASS.                  04470099
055300     MOVE PV-DEPT-CLS               TO PV-BYPASS-DEPT-CLS.        04480099
                                                                        04490099
055400     IF PV-INVALID-DEPTS OR                                       04500099
055500        PV-INVALID-DEPT-CLS                                       04510099
                 ADD 1 TO PV-BYPASS-CNT                                 04520099
055600           SET PS-INVALID-DEPT   TO TRUE                          04530099
055700     ELSE                                                         04540099
055800           SET PS-VALID-DEPT     TO TRUE                          04550099
055900     END-IF.                                                      04560099
056000                                                                  04570099
056100*2210-EXIT.                                                       04580099
056200                                                                  04590099
056300******************************************************************04600099
056400*  VERIFY THAT THE LATE RECORD IS NOT FROM A CUT-OFF WEEK.  IF   *04610099
056500*  THE RECORD IS FROM A CUT-OFF WEEK; THE RECORD DATE WILL BE    *04620099
      *  CHANGED TO THE CURRENT PROCESSING DATE.                        04630099
056600******************************************************************04640099
056700 2500-VERIFY-CUT-OFF.                                             04650099
056800     IF PV-D040-DATE-RFMT LESS THAN PV-CUT-OFF-CCYY-MM-DD         04660099
             ADD 1 TO PV-BYPASS-CNT                                     04670099
057000     ELSE                                                         04680099
057100        MOVE PV-CURRENT-DATE1 TO PV-D040-DATE-RFMT1               04690099
057200        SET PS-VALID-DATE TO TRUE                                 04700099
057300     END-IF.                                                      04710099
057400                                                                  04720099
057500*2500-EXIT.                                                       04730099
057600                                                                  04740099
059400******************************************************************04750099
059500*  RETRIEVE THE DAILY FLASH RECORD.  IF ROW EXISTS UPDATE THE    *04760099
059600*  RECORD.  IF ROW DOES NOT EXIST, INSERT THE RECORD             *04770099
059700******************************************************************04780099
059800 2750-SELECT-DLY-FLSH-REC.                                        04790099
059900     EXEC SQL                                                     04800099
060000           SELECT SLS_DTE,                                        04810099
060100                  STR_NBR,                                        04820099
060200                  DEPT_NBR,                                       04830099
060300                  AMT_CLSN_CDE,                                   04840099
060500                  DLY_DOL_AMT,                                    04850099
060600                  WTD_DOL_AMT,                                    04860099
060700                  MTD_DOL_AMT,                                    04870099
060700                  QTD_DOL_AMT,                                    04880099
060800                  S_T_D_DOL_AMT,                                  04890099
060900                  YTD_DOL_AMT,                                    04900099
061000                  DLY_ITM_QTY,                                    04910099
061100                  WTD_ITM_QTY,                                    04920099
061200                  MTD_ITM_QTY,                                    04930099
061200                  QTD_ITM_QTY,                                    04940099
061300                  S_T_D_ITM_QTY,                                  04950099
061400                  YTD_ITM_QTY                                     04960099
061500         INTO   :DFT00000-SLS-DTE,                                04970099
061600                :DFT00000-STR-NBR,                                04980099
061700                :DFT00000-DEPT-NBR,                               04990099
061800                :DFT00000-AMT-CLSN-CDE,                           05000099
062000                :DFT00000-DLY-DOL-AMT,                            05010099
062100                :DFT00000-WTD-DOL-AMT,                            05020099
062200                :DFT00000-MTD-DOL-AMT,                            05030099
062200                :DFT00000-QTD-DOL-AMT,                            05040099
062300                :DFT00000-S-T-D-DOL-AMT,                          05050099
062400                :DFT00000-YTD-DOL-AMT,                            05060099
062500                :DFT00000-DLY-ITM-QTY,                            05070099
062600                :DFT00000-WTD-ITM-QTY,                            05080099
062700                :DFT00000-MTD-ITM-QTY,                            05090099
062700                :DFT00000-QTD-ITM-QTY,                            05100099
062800                :DFT00000-S-T-D-ITM-QTY,                          05110099
062900                :DFT00000-YTD-ITM-QTY                             05120099
063000              FROM DFT_DLY_FLSH_SUM                               05130099
063100              WHERE SLS_DTE = :PV-D040-DATE-RFMT1 AND             05140099
063400                    AMT_CLSN_CDE = :PV-AMT-CLSN-CDE AND           05150099
063300                    DEPT_NBR     = :PV-DEPT-NBR AND               05160099
063200                    STR_NBR      = :PV-D040-STORENO               05170099
068935               WITH UR                                            05180099
063500     END-EXEC.                                                    05190099
           EVALUATE TRUE                                                05200099
063600        WHEN SQLCODE = ZERO                                       05210099
054300           SET PS-UPDATE-RECORD TO TRUE                           05220099
054300           SET PS-NO-INSERT-RECORD TO TRUE                        05230099
063900                                                                  05240099
063600        WHEN SQLCODE < 0                                          05250099
063700           DISPLAY 'SELECT UNSUCCESSFUL FOR DAILY FLASH TABLE  '  05260099
063800           GO TO 9400-SQL-ABEND                                   05270099
063900                                                                  05280099
064000        WHEN  (SQLCODE > 0 AND NOT = +100) OR SQLWARN0 = 'W'      05290099
064100           DISPLAY 'SELECT WARNING FOR DAILY FLASH TABLE'         05300099
064200           GO TO 9300-SQL-WARNING                                 05310099
064300                                                                  05320099
064400        WHEN  SQLCODE = 100                                       05330099
054300           SET PS-INSERT-RECORD TO TRUE                           05340099
054300           SET PS-NO-UPDATE-RECORD TO TRUE                        05350099
                                                                        05360099
           END-EVALUATE.                                                05370099
064600*2750-EXIT.                                                       05380099
064700                                                                  05390099
064800                                                                  05400099
057700******************************************************************05410099
057800*  MOVE THE DAILY SALES FILE FIELDS TO THE DAILY FLASH TABLE     *05420099
057900*  FIELDS.                                                       *05430099
058000******************************************************************05440099
058100 2800-FORMAT-UPDATE-RECORD.                                       05450099
                                                                        05460099
058200     MOVE PV-D040-STORENO              TO DFT00000-STR-NBR.       05470099
058300     MOVE PV-D040-DATE-RFMT1           TO DFT00000-SLS-DTE.       05480099
058400     MOVE D040-DEPT                    TO DFT00000-DEPT-NBR.      05490099
                                                                        05500099
058500     ADD  D040-SALE-UNITS              TO DFT00000-DLY-ITM-QTY    05510099
058500                                          DFT00000-WTD-ITM-QTY    05520099
058500                                          DFT00000-MTD-ITM-QTY    05530099
058500                                          DFT00000-QTD-ITM-QTY    05540099
058500                                          DFT00000-S-T-D-ITM-QTY  05550099
058500                                          DFT00000-YTD-ITM-QTY.   05560099
                                                                        05570099
058600     ADD  D040-SALE-AMT                TO DFT00000-DLY-DOL-AMT    05580099
058600                                          DFT00000-WTD-DOL-AMT    05590099
058600                                          DFT00000-MTD-DOL-AMT    05600099
058600                                          DFT00000-QTD-DOL-AMT    05610099
058600                                          DFT00000-S-T-D-DOL-AMT  05620099
058600                                          DFT00000-YTD-DOL-AMT.   05630099
           PERFORM 3010-UPDATE-DLY-FLASH-REC.                           05640099
059300*2800-EXIT.                                                       05650099
070100******************************************************************05660099
070200*  PREPARE THE DAILY FLASH TABLE RECORD.                         *05670099
070300*                                                                *05680099
070400******************************************************************05690099
070500 2910-FORMAT-INSERT-RECORD.                                       05700099
                                                                        05710099
           MOVE D040-SALE-AMT             TO DFT00000-DLY-DOL-AMT       05720099
                                             DFT00000-WTD-DOL-AMT       05730099
                                             DFT00000-MTD-DOL-AMT       05740099
                                             DFT00000-QTD-DOL-AMT       05750099
                                             DFT00000-S-T-D-DOL-AMT     05760099
                                             DFT00000-YTD-DOL-AMT.      05770099
                                                                        05780099
071100     MOVE D040-SALE-UNITS           TO DFT00000-DLY-ITM-QTY       05790099
071100                                       DFT00000-WTD-ITM-QTY       05800099
071100                                       DFT00000-MTD-ITM-QTY       05810099
071100                                       DFT00000-QTD-ITM-QTY       05820099
071100                                       DFT00000-S-T-D-ITM-QTY     05830099
071100                                       DFT00000-YTD-ITM-QTY.      05840099
                                                                        05850099
071100     MOVE D040-STORENO              TO DFT00000-STR-NBR.          05860099
071100     MOVE D040-DEPT                 TO DFT00000-DEPT-NBR.         05870099
071100     MOVE PV-D040-DATE-RFMT1        TO DFT00000-SLS-DTE.          05880099
071100     MOVE PV-AMT-CLSN-CDE           TO DFT00000-AMT-CLSN-CDE.     05890099
075300                                                                  05900099
051600                                                                  05910099
070100******************************************************************05920099
070200* INSERT RECORD INTO DFT_DLY_FLSH_SUM TABLE.                     *05930099
070300*                                                                *05940099
070400******************************************************************05950099
070500 3000-INSERT-DLY-FLASH-REC.                                       05960099
900        EXEC SQL                                                     05970099
000             INSERT INTO DFT_DLY_FLSH_SUM                            05980099
600         VALUES                                                      05990099
              (:DFT00000-SLS-DTE                                        06000099
              ,:DFT00000-STR-NBR                                        06010099
              ,:DFT00000-DEPT-NBR                                       06020099
              ,:DFT00000-AMT-CLSN-CDE                                   06030099
              ,:DFT00000-DLY-DOL-AMT                                    06040099
              ,:DFT00000-WTD-DOL-AMT                                    06050099
              ,:DFT00000-MTD-DOL-AMT                                    06060099
              ,:DFT00000-QTD-DOL-AMT                                    06070099
              ,:DFT00000-S-T-D-DOL-AMT                                  06080099
              ,:DFT00000-YTD-DOL-AMT                                    06090099
              ,:DFT00000-DLY-ITM-QTY                                    06100099
              ,:DFT00000-WTD-ITM-QTY                                    06110099
              ,:DFT00000-MTD-ITM-QTY                                    06120099
              ,:DFT00000-QTD-ITM-QTY                                    06130099
              ,:DFT00000-S-T-D-ITM-QTY                                  06140099
              ,:DFT00000-YTD-ITM-QTY)                                   06150099
200         END-EXEC.                                                   06160099
                                                                        06170099
068938     EVALUATE TRUE                                                06180099
068939        WHEN SQLCODE = ZERO                                       06190099
050600          ADD +1 TO PV-REC-INSRT-CNT                              06200099
      *         INITIALIZE DCLDFT00000                                  06210099
                                                                        06220099
068943        WHEN OTHER                                                06230099
                MOVE '3000-INSERT-DLY-FLASH-REC'  TO PV-PARAGRAPH       06240099
068944          DISPLAY 'SLS DTE= '   PV-D040-DATE-RFMT1                06250099
068945          DISPLAY 'STR NBR= '   PV-D040-STORENO                   06260099
068946          DISPLAY 'DEPT_NBR= '  PV-DEPT-NBR                       06270099
068949          PERFORM 9400-SQL-ABEND                                  06280099
068950     END-EVALUATE.                                                06290099
070100******************************************************************06300099
070200* UPDATE DFT_DLY_FLSH_SUM RECORD.                                *06310099
070300*                                                                *06320099
070400******************************************************************06330099
070500 3010-UPDATE-DLY-FLASH-REC.                                       06340099
           EXEC SQL                                                     06350099
              UPDATE DFT_DLY_FLSH_SUM                                   06360099
              SET SLS_DTE            = :DFT00000-SLS-DTE                06370099
                 ,STR_NBR            = :DFT00000-STR-NBR                06380099
                 ,DEPT_NBR           = :DFT00000-DEPT-NBR               06390099
                 ,AMT_CLSN_CDE       = :DFT00000-AMT-CLSN-CDE           06400099
                 ,DLY_DOL_AMT        = :DFT00000-DLY-DOL-AMT            06410099
                 ,WTD_DOL_AMT        = :DFT00000-WTD-DOL-AMT            06420099
                 ,MTD_DOL_AMT        = :DFT00000-MTD-DOL-AMT            06430099
                 ,QTD_DOL_AMT        = :DFT00000-QTD-DOL-AMT            06440099
                 ,S_T_D_DOL_AMT      = :DFT00000-S-T-D-DOL-AMT          06450099
                 ,YTD_DOL_AMT        = :DFT00000-YTD-DOL-AMT            06460099
                 ,DLY_ITM_QTY        = :DFT00000-DLY-ITM-QTY            06470099
                 ,WTD_ITM_QTY        = :DFT00000-WTD-ITM-QTY            06480099
                 ,MTD_ITM_QTY        = :DFT00000-MTD-ITM-QTY            06490099
                 ,QTD_ITM_QTY        = :DFT00000-QTD-ITM-QTY            06500099
                 ,S_T_D_ITM_QTY      = :DFT00000-S-T-D-ITM-QTY          06510099
                 ,YTD_ITM_QTY        = :DFT00000-YTD-ITM-QTY            06520099
             WHERE                                                      06530099
               SLS_DTE      = :DFT00000-SLS-DTE AND                     06540099
               STR_NBR      = :DFT00000-STR-NBR AND                     06550099
               DEPT_NBR     = :DFT00000-DEPT-NBR AND                    06560099
               AMT_CLSN_CDE = :DFT00000-AMT-CLSN-CDE                    06570099
           END-EXEC.                                                    06580099
                                                                        06590099
068938     EVALUATE TRUE                                                06600099
068939        WHEN SQLCODE = ZERO                                       06610099
069900          ADD +1 TO PV-REC-UPDT-CNT                               06620099
      *         INITIALIZE DCLDFT00000                                  06630099
                                                                        06640099
068943        WHEN OTHER                                                06650099
                MOVE '3010-UPDATE-DLY-FLASH-REC'  TO PV-PARAGRAPH       06660099
068944          DISPLAY 'SLS DTE= '   PV-D040-DATE-RFMT1                06670099
068945          DISPLAY 'STR NBR= '   PV-D040-STORENO                   06680099
068946          DISPLAY 'DEPT_NBR= '  PV-DEPT-NBR                       06690099
068949          PERFORM 9400-SQL-ABEND                                  06700099
068950     END-EVALUATE.                                                06710099
083400                                                                  06720099
                                                                        06730099
097500****************************************************              06740099
097600* DATE ROUTINE TO SET UP THE PROCESS DATE IN       *              06750099
097700* CCYYMMDD FORMAT.                                 *              06760099
097800****************************************************              06770099
097900 9100-DATE-ROUTINE.                                               06780099
098000                                                                  06790099
098100     INITIALIZE DPG51 DPG52 DPG53                                 06800099
098200                DPG54 DPG55 DPG56.                                06810099
098300                                                                  06820099
098400     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      06830099
098500     MOVE CD-POS-DATE-CYMD     TO DPG52-DB2-ISO-DATE.             06840099
098600     SET DPG52-LK-DTE-ISO      TO TRUE.                           06850099
098700                                                                  06860099
098800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    06870099
098900                                             DPG54 DPG55 DPG56.   06880099
099000                                                                  06890099
099100     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  06900099
099200         DISPLAY '** ABEND **'                                    06910099
099300         DISPLAY '** PROGRAM = DFKUP002'                          06920099
099400         DISPLAY 'DATE = ' DATE-CONTROL-RECORD                    06930099
099500         DISPLAY DPG54-ERROR-MESSAGE                              06940099
099600         MOVE 4019 TO PV-ABEND-CODE                               06950099
099700         CALL 'ILBOABN0' USING PV-ABEND-CODE.                     06960099
099800                                                                  06970099
099900     MOVE DPG55-DB2-ISO-DATE         TO PV-STORE-COMPARE-DATE.    06980099
100000     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-MTD-BEGIN-DATE         06990099
100100     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-MTD-END-DATE           07000099
100000     MOVE DPG56-FIRST-FQ-DB2-ISO-FMT TO PV-QTD-BEGIN-DATE         07010099
100000     MOVE DPG56-LAST-FQ-DB2-ISO-FMT  TO PV-QTD-END-DATE           07020099
100000     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-CUT-OFF-CCYY-MM-DD     07030099
100200     MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO PV-YTD-BEGIN-DATE         07040099
100300     MOVE DPG56-LAST-FD-DB2-ISO-FMT  TO PV-YTD-END-DATE           07050099
100400     MOVE DPG56-FIRST-FS-DB2-ISO-FMT TO PV-STD-BEGIN-DATE         07060099
100500     MOVE DPG56-LAST-FS-DB2-ISO-FMT  TO PV-STD-END-DATE           07070099
100600     MOVE DPG55-1ST-WKDY-DB2ISO-FMT  TO PV-WTD-BEGIN-DATE         07080099
100700     MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO PV-WTD-END-DATE           07090099
                                                                        07100099
100800     DISPLAY 'DATE = ' DATE-CONTROL-RECORD                        07110099
100900     DISPLAY 'FIRST DATE =   ' DPG56-FIRST-FP-DB2-ISO-FMT.        07120099
101000     DISPLAY 'LAST DATE =    ' DPG56-LAST-FP-DB2-ISO-FMT.         07130099
101100     DISPLAY '               '                                    07140099
101200     DISPLAY 'FIRST YEAR =   ' DPG56-FIRST-FD-DB2-ISO-FMT.        07150099
101300     DISPLAY 'LAST YEAR =    ' DPG56-LAST-FD-DB2-ISO-FMT.         07160099
101100     DISPLAY '               '                                    07170099
101400     DISPLAY 'FIRST SEASON = ' DPG56-FIRST-FS-DB2-ISO-FMT.        07180099
101500     DISPLAY 'LAST SEASON =  ' DPG56-LAST-FS-DB2-ISO-FMT.         07190099
101100     DISPLAY '               '                                    07200099
101600     DISPLAY 'FIRST WEEK =   ' DPG55-1ST-WKDY-DB2ISO-FMT.         07210099
101700     DISPLAY 'LAST WEEK =    ' DPG55-LAST-WKDY-DB2ISO-FMT.        07220099
101800                                                                  07230099
036500******************************************************************07231099
036600* CHECK TO SEE IF A COMMIT NEEDS TO BE TAKEN                     *07232099
036700******************************************************************07233099
036800 9150-CHECK-FOR-COMMIT.                                           07234099
036900                                                                  07235099
037000     EXEC SQL                                                     07236099
037100         SET :PV-CURRENT-TIMESTAMP = CURRENT TIMESTAMP            07237099
037200     END-EXEC.                                                    07238099
037300                                                                  07239099
037400     EVALUATE TRUE                                                07239199
037500         WHEN SQLCODE = ZERO                                      07239299
037600             IF PV-CURRENT-TIMESTAMP > PV-COMMIT-TIMESTAMP        07239399
037700                 PERFORM 9200-COMMIT-DB2                          07239499
037800                 PERFORM 9250-GET-COMMIT-TIMESTAMP                07239599
037900             END-IF                                               07239699
038000         WHEN SQLWARN0 NOT EQUAL SPACE                            07239799
038100         WHEN SQLCODE NOT EQUAL ZERO                              07239899
038200             DISPLAY '9150-CHECK-FOR-COMMIT'                      07239999
063800             GO TO 9400-SQL-ABEND                                 07240499
038600     END-EVALUATE.                                                07240599
038700*                                                                 07240699
109615******************************************************************07241099
109620 9200-COMMIT-DB2.                                                 07250099
109630******************************************************************07260099
109640     EXEC SQL                                                     07270099
109650        COMMIT                                                    07280099
109660     END-EXEC.                                                    07290099
109670                                                                  07300099
109680     EVALUATE TRUE                                                07310099
109690        WHEN SQLCODE = 0                                          07320099
109691           ADD 1 TO PV-COMMIT-CNT                                 07330099
109691           CONTINUE                                               07331099
109692        WHEN OTHER                                                07340099
109698           PERFORM 9400-SQL-ABEND                                 07350099
109700            CALL 'ILBOABN0' USING ABEND-CODE                      07360099
109701     END-EVALUATE.                                                07370099
109702                                                                  07380099
040800******************************************************************07381099
040900*  GET THE TIMESTAMP THAT WILL BE USED TO DETERMINE COMMIT       *07382099
041000*  PROCESSING                                                    *07383099
041100******************************************************************07384099
041200 9250-GET-COMMIT-TIMESTAMP.                                       07385099
041300                                                                  07386099
041400     EXEC SQL                                                     07387099
041500         SELECT (CURRENT TIMESTAMP + CKPT_FRQNCY_QTY SECONDS)     07388099
041600         INTO :PV-COMMIT-TIMESTAMP                                07389099
041700         FROM TCKRSTCNTL                                          07389199
041800         WHERE PLAN_NAME           = :PC-PGM-NAME                 07389299
041900     END-EXEC.                                                    07389399
042000                                                                  07389499
042100     EVALUATE TRUE                                                07389599
042200         WHEN SQLCODE = ZERO                                      07389699
042300             CONTINUE                                             07389799
042400         WHEN SQLWARN0 NOT EQUAL SPACE                            07389899
042500         WHEN SQLCODE NOT EQUAL ZERO                              07389999
042600             DISPLAY '9250-GET-COMMIT-TIMESTAMP'                  07390099
063800             GO TO 9400-SQL-ABEND                                 07390499
043000     END-EVALUATE.                                                07390599
043100                                                                  07390699
109630******************************************************************07391099
101900 9300-SQL-WARNING.                                                07400099
109630******************************************************************07410099
102000                                                                  07420099
102100     MOVE SQLERRD(3) TO SQLERRD3.                                 07430099
102200     DISPLAY 'AT PARAGRAPH = ' PV-PARAGRAPH.                      07440099
102300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 07450099
102400     DISPLAY '** PROGRAM        ** = DFKUP002'.                   07460099
102500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07470099
102600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07480099
102700     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  07490099
102800     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  07500099
102900     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  07510099
103000     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  07520099
103100     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  07530099
103200     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  07540099
103300     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  07550099
103400     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  07560099
103500     EXEC SQL                                                     07570099
103600         COMMIT                                                   07580099
103700     END-EXEC.                                                    07590099
103800     MOVE 4013 TO PV-ABEND-CODE.                                  07600099
103900     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07610099
104000*                                                                 07620099
104100 9400-SQL-ABEND.                                                  07630099
104200                                                                  07640099
104300     MOVE SQLCODE    TO SQLCODE2.                                 07650099
104400     MOVE SQLERRD(3) TO SQLERRD3.                                 07660099
104500     DISPLAY 'AT PARAGRAPH = ' PV-PARAGRAPH.                      07670099
104600     DISPLAY '** ABEND **       ** = SQLERROR'.                   07680099
104700     DISPLAY '** PROGRAM        ** = DFKUP002'.                   07690099
104800     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  07700099
104900     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  07710099
105000     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   07720099
105100     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  07730099
105200     EXEC SQL                                                     07740099
105300         COMMIT                                                   07750099
105400     END-EXEC.                                                    07760099
105500     MOVE 4013 TO PV-ABEND-CODE.                                  07770099
105600     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         07780099
105700*                                                                 07790099
083500 9500-READ-DAILY-SALES-FILE.                                      07800099
083600******************************************************************07810099
083700*  READ DAILY SALES FILE                                         *07820099
084200******************************************************************07830099
098500     READ DAILY-SALES-FILE INTO D040-RECORD                       07840099
098600         AT END                                                   07850099
098700             SET PS-END-OF-FILE TO TRUE.                          07860099
                                                                        07870099
           ADD 1 TO PV-READ-CNT.                                        07880099
089300     MOVE D040-STORENO          TO PV-D040-STORENO                07890099
089500     MOVE D040-DATE             TO PV-D040-DATE.                  07900099
089600     MOVE PV-D040-DATE-MM       TO PV-D040-DATE-RFMT-MM.          07910099
089700     MOVE PV-D040-DATE-DD       TO PV-D040-DATE-RFMT-DD.          07920099
089800     MOVE PV-D040-DATE-YY       TO PV-D040-DATE-RFMT-YY.          07930099
 89800     MOVE PV-D040-DATE-RFMT     TO PV-D040-DATE-RFMT1.            07940099
