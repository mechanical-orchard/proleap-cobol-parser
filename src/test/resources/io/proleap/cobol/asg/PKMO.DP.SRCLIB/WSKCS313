000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    WSKCS313.                                         00020000
000300 AUTHOR.        GERMAN BANDA.                                     00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  MARCH 2007.                                       00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800******************************************************************00080000
000900*    TRANSACTION - W313   COMMAREA - RCWS289 COPYBOOK            *00090008
001500* TABLES:  TDISTHD  -  TRANSACTION HEADER TABLE                  *00150000
001600*          TRECDIS  -  RECEIPT ITEM DISTRIBUTION TABLE           *00160000
001700*          TRECITM  -  RECEIPT ITEM TABLE                        *00170000
001800*          TRECEIV  -  RECEIVER TABLE                            *00180000
001900*          TPURCHS  -  PURCHASE ORDER TABLE                      *00190000
002000*          TPURITM  -  PURCHASE ORDER ITEM TABLE                 *00200000
002100*                                                                *00210000
002200******************************************************************00220000
002300*                                                                 00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500*                                                                 00250000
002600 CONFIGURATION SECTION.                                           00260000
002700*                                                                 00270000
002800 SOURCE-COMPUTER.        IBM-3090.                                00280000
002900 OBJECT-COMPUTER.        IBM-3090.                                00290000
003000*                                                                 00300000
003100******************************************************************00310000
003200 DATA DIVISION.                                                   00320000
003300******************************************************************00330000
003400*                                                                 00340000
003500******************************************************************00350000
003600 WORKING-STORAGE SECTION.                                         00360000
003700******************************************************************00370000
003800                                                                  00380000
003900 01  DK-DB2-KEYS.                                                 00390000
004000     05  DK-ORD-NBR              PIC S9(9) VALUE ZERO COMP SYNC.  00400000
004100     05  DK-REC-SEQ-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00410000
004200     05  DK-ORD-LNE-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00420000
004300                                                                  00430000
004400******************************************************************00440000
004500* PS PROGRAM SWITCHES                                            *00450000
004600******************************************************************00460000
004700 01  PS-PROGRAM-SWITCHES.                                         00470000
004800     05  PS-AUTO-VE-SW                  PIC  X(01)  VALUE 'Y'.    00480000
004900         88  PS-AUTO-VE-YES                         VALUE 'Y'.    00490000
005000         88  PS-AUTO-VE-NO                          VALUE 'N'.    00500000
005100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00510000
005200         88  PS-NO-ERROR                            VALUE 'Y'.    00520000
005300         88  PS-ERROR                               VALUE 'N'.    00530000
005400     05  PS-DATA-OK-SW                  PIC  X(01)  VALUE 'Y'.    00540000
005500         88  PS-DATA-OK                             VALUE 'Y'.    00550000
005600         88  PS-DATA-NOT-OK                         VALUE 'N'.    00560000
005700     05  PS-UPDATE-SW                   PIC  X(01)   VALUE 'N'.   00570000
005800         88  PS-NO-UPDATES-DONE                      VALUE 'N'.   00580000
005900         88  PS-UPDATES-DONE                         VALUE 'Y'.   00590000
006000     05  PS-INV-ERR-SW                  PIC  X(01)   VALUE 'N'.   00600000
006100         88  PS-NO-INV-ERR                           VALUE 'N'.   00610000
006200         88  PS-INV-ERR                              VALUE 'Y'.   00620000
006300     05  PS-INV-CYC-SW                  PIC  X(01)   VALUE 'N'.   00630000
006400         88  PS-INV-CYC-NOT-FOUND                    VALUE 'N'.   00640000
006500         88  PS-INV-CYC-FOUND                        VALUE 'Y'.   00650000
006600     05  PS-DATA-ON-TDISTHD-SW           PIC X(01)   VALUE 'Y'.   00660000
006700         88  PS-DATA-LEFT-ON-TDISTHD                 VALUE 'Y'.   00670000
006800         88  PS-NO-DATA-LEFT-ON-TDISTHD              VALUE 'N'.   00680000
006900     05  PS-DATA-LEFT-TO-PROCESS-IND     PIC X(01)   VALUE 'Y'.   00690000
007000         88  PS-DATA-LEFT-TO-PROCESS                 VALUE 'Y'.   00700000
007100         88  PS-NO-DATA-LEFT-TO-PROCESS              VALUE 'N'.   00710000
007200     05  PS-TRANSACTION-HEADER-SWITCH    PIC X(01)   VALUE 'Y'.   00720000
007300         88  PS-NO-R-RECORD                          VALUE 'N'.   00730000
007400         88  PS-HEADER-RECORD-OK                     VALUE 'Y'.   00740000
007500     05  PS-END-OF-VRFY-ITM-CSR-SW  PIC  X(01)  VALUE 'N'.        00750000
007600         88  PS-END-OF-VRFY-ITM-CSR             VALUE 'Y'.        00760000
007700         88  PS-NOT-END-OF-VRFY-ITM-CSR         VALUE 'N'.        00770000
007800     05  PS-FIRST-VRFY-ITM-FETCH-SW PIC  X(01)  VALUE 'N'.        00780000
007900         88  PS-FIRST-VRFY-ITM-FETCH            VALUE 'Y'.        00790000
008000         88  PS-NOT-FIRST-VRFY-ITM-FETCH        VALUE 'N'.        00800000
008010     05  PS-FRASTY-SW               PIC  X(01)  VALUE 'N'.        00801016
008020         88  PS-FRASTY                          VALUE 'Y'.        00802009
008030         88  PS-NOT-FRASTY                      VALUE 'N'.        00803009
008040     05  PS-SHOW-DEBUG-SW                PIC  X(01)  VALUE 'N'.   00804018
008050         88  PS-DONT-SHOW-DEBUG-INFO                 VALUE 'N'.   00805018
008060         88  PS-SHOW-DEBUG-INFO                      VALUE 'Y'.   00806018
008100******************************************************************00810000
008200* COMMAREA PASSED TO THE PROGRAM FROM PCKS107 AND RCKCS291       *00820000
008300******************************************************************00830000
008400                                                                  00840000
008500     COPY RCWS289.                                                00850000
008600                                                                  00860000
008700***************************************************************** 00870000
008800*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 00880000
008900*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 00890000
009000***************************************************************** 00900000
009100     COPY RCWS040.                                                00910000
009200                                                                  00920000
009300***************************************************************** 00930000
009400*   RCWS040 - COPYBOOK IS USED FOR THE MODULE TO CALCULATE UNIT * 00940000
009500*             QUANTITIES AND CARTON COUNTS (RCKUT128)          .* 00950000
009600***************************************************************** 00960000
009700     COPY RCWS074.                                                00970000
009800                                                                  00980000
009900***************************************************************** 00990000
010000*   RCWS071 - COPYBOOK IS USED FOR THE MODULE TO TRACK DC ASSOC * 01000000
010100*             FUNCTIONS                                        .* 01010000
010200***************************************************************** 01020000
010300     COPY RCWS071.                                                01030000
010400                                                                  01040000
010500*---------------------------------------------------------------* 01050000
010600*  RECORD LAYOUTS FOR THE FREE ASTRAY HANDLER MODULE              01060000
010700*---------------------------------------------------------------* 01070000
010800     COPY SUWS044.                                                01080000
010900                                                                  01090000
011000******************************************************************01100000
011100* PV PROGRAM VARIABLES                                           *01110000
011200******************************************************************01120000
011300 01  PV-PROGRAM-VARIABLES.                                        01130000
011400     05  PV-RETRY-COUNTER                PIC S9(4) VALUE ZERO     01140000
011500                                                    COMP SYNC.    01150000
011600     05  PV-AUDIT-RTN-LENGTH             PIC S9(04) VALUE ZERO    01160000
011700                                                    COMP SYNC.    01170000
011800     05  PV-PRT-LST-TRANID               PIC  X(04)  VALUE '    '.01180000
011900     05  PV-PRT-ERROR-TRANID             PIC  X(04)  VALUE '    '.01190000
012000     05  PV-CURRENT-TMST                 PIC X(26).               01200000
012100     05  PV-CURR-DATE                    PIC  X(10)  VALUE ZEROS. 01210000
012200     05  PV-CURRENT-DATE                 PIC  X(10)  VALUE ZEROS. 01220000
012300     05  FILLER   REDEFINES PV-CURRENT-DATE.                      01230000
012400         10  PV-CURRENT-CC               PIC  X(02).              01240000
012500         10  PV-CURRENT-YY               PIC  X(02).              01250000
012600         10  FILLER                      PIC  X(01).              01260000
012700         10  PV-CURRENT-MM               PIC  X(02).              01270000
012800         10  FILLER                      PIC  X(01).              01280000
012900         10  PV-CURRENT-DD               PIC  X(02).              01290000
013000     05  PV-HOLD-CURR-DATE.                                       01300000
013100         10  PV-HOLD-CURR-CC             PIC  9(02).              01310000
013200         10  PV-HOLD-CURR-YY             PIC  9(02).              01320000
013300         10  PV-HOLD-CURR-MM             PIC  9(02).              01330000
013400         10  PV-HOLD-CURR-DD             PIC  9(02).              01340000
013500*                                                                 01350000
013600     05  PV-TOTAL-ACTL-LINE-QTY          PIC S9(09)  COMP         01360000
013700                                                     VALUE +0.    01370000
013800     05  PV-PREV-ORD-LNE-NBR             PIC S9(9) COMP.          01380000
013900     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01390000
014000                                                     COMP SYNC.   01400000
014100     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +12    01410000
014200                                                     COMP SYNC.   01420000
014300     05  PV-WRK-ORD-SEQ-NBR              PIC  S9(4)  COMP         01430000
014400                                                     VALUE ZEROS. 01440000
014500     05  PV-FCLTY-ID                     PIC  S9(4)  COMP         01450000
014600                                                     VALUE +1.    01460000
014700     05  PV-CLENG                        PIC   9(4)  COMP         01470000
014800                                                     VALUE ZEROS. 01480000
014900     05  PV-TOTAL-ALLOC-QTY              PIC  S9(9)  COMP         01490000
015000                                                     VALUE ZEROS. 01500000
015100     05  PV-TOTAL-ALLOC-QTY-ALL          PIC  S9(9)  COMP         01510000
015200                                                     VALUE ZEROS. 01520000
015300     05  PV-TASK-X.                                               01530000
015400         10  PV-TASK                     PIC   9(7)  VALUE ZERO.  01540000
015500     05  PV-STATUS-CDE                   PIC   X(02)              01550000
015600                                                     VALUE SPACES.01560000
015700     05  PV-AUDIT-STATUS-CDE             PIC   X(02)              01570000
015800                                                     VALUE SPACES.01580000
015900     05  PV-COUNT-STATUS-CDE             PIC   X(02)              01590000
016000                                                     VALUE SPACES.01600000
016100     05  PV-RCPT-DISTR-UPD-CDE           PIC   X(01)              01610000
016200                                                     VALUE SPACES.01620000
016300     05  PV-PREV-DISTR-UPD-CDE           PIC   X(01)              01630000
016400                                                     VALUE SPACES.01640000
016500     05  PV-VRFD-USR-ID                  PIC   X(08)              01650000
016600                                                     VALUE SPACES.01660000
016700     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACES.01670000
016800     05  PV-CICS-MSG-AREA                PIC  X(95)  VALUE SPACE. 01680000
016900                                                                  01690000
017000     05  PV-ORD-NBR-DISPLAY              PIC  9(08)  VALUE ZEROES.01700000
017100     05  PV-REC-SEQ-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.01710000
017200     05  PV-ORD-LNE-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.01720000
017300     05  PV-OPER-UNT-ID-DISPLAY          PIC  9(04)  VALUE ZEROES.01730000
017400     05  PV-STORE-NBR-DISPLAY            PIC  9(04)  VALUE ZEROES.01740000
017500     05  PV-FCLTY-ID-DISPLAY             PIC  9(04)  VALUE ZEROES.01750000
017600     05  PV-ID-NBR-DISPLAY               PIC  X(04)  VALUE SPACES.01760000
017700     05  PV-DEPT-NBR-PIC9                PIC  9(03)  VALUE ZEROES.01770000
017800                                                                  01780000
017900     05  PV-NULL-IND                     PIC S9(04)  VALUE +0     01790000
018000                                                     COMP SYNC.   01800000
018100     05  PV-ERROR-ORD-NBR                PIC  9(08)  VALUE ZEROS. 01810000
018200     05  PV-ERROR-RCVR-SEQ-NBR           PIC  9(04)  VALUE ZEROS. 01820000
018300     05  PV-ERROR-ORD-LNE-NBR            PIC  9(04)  VALUE ZEROS. 01830000
018400     05  PV-ERROR-STR-NBR                PIC  9(04)  VALUE ZEROS. 01840000
018500     05  PV-ERROR-OPER-UNT-ID            PIC  9(04)  VALUE ZEROS. 01850000
018600     05  PV-ERROR-STATUS                 PIC  X(01)  VALUE SPACE. 01860000
018700     05  PV-ERROR-SOURCE                 PIC  X(02)  VALUE SPACE. 01870000
018800                                                                  01880000
018900                                                                  01890000
019000 01  ST-SYSTEM-TIME-AREA.                                         01900000
019100     05  ST-ABSTIME                      PIC S9(16)  VALUE +0     01910000
019200                                                     COMP SYNC.   01920000
019300     05  ST-TIME-EDIT.                                            01930000
019400         10  ST-TIME-HHMM                PIC  X(05)  VALUE SPACE. 01940000
019500         10  FILLER                      PIC  X(03)  VALUE SPACE. 01950000
019600                                                                  01960000
019700******************************************************************01970000
019800* PC PROGRAM CONSTANTS                                           *01980000
019900******************************************************************01990000
020000 01  PC-PROGRAM-CONSTANTS.                                        02000000
020100     05  PC-FA-HANDLER-PGM          PIC  X(08)  VALUE 'SUKUT705'. 02010000
020200     05  PC-ZERO                      PIC S9(09) VALUE ZERO       02020000
020300                                                    COMP.         02030000
020400     05  PV-DB2-COUNT                 PIC S9(9)  VALUE +0         02040000
020500                                                    COMP-3.       02050000
020600     05  PV-COUNT-DISPLAY             PIC  9(9)  VALUE ZERO.      02060000
020700     05  PC-MAX-RETRIES               PIC S9(04) VALUE  +1        02070000
020800                                                    COMP.         02080000
020900     05  PC-ROW-ALREADY-PRESENT       PIC S9(04) VALUE -803       02090000
021000                                                    COMP SYNC.    02100000
021100     05  PC-SQL-904                   PIC S9(04) VALUE -904       02110000
021200                                                    COMP SYNC.    02120000
021300     05  PC-PBS                       PIC  X(03) VALUE 'PBS'.     02130000
021400     05  PC-RECV                      PIC  X(04) VALUE 'RECV'.    02140000
021500     05  PC-AP                        PIC  X(02) VALUE 'AP'.      02150000
021600     05  PC-IP                        PIC  X(02) VALUE 'IP'.      02160000
021700     05  PC-VE                        PIC  X(02) VALUE 'VE'.      02170000
021800     05  PC-CM                        PIC  X(02) VALUE 'CM'.      02180000
021900     05  PC-CB                        PIC  X(02) VALUE 'CB'.      02190000
022000     05  PC-CASE                      PIC  X(04) VALUE 'CASE'.    02200000
022100     05  PC-I                         PIC  X(01) VALUE 'I'.       02210000
022200     05  PC-CA                        PIC  X(02) VALUE 'CA'.      02220000
022300     05  PC-AC                        PIC  X(02) VALUE 'AC'.      02230000
022400     05  PC-P2                        PIC  X(02) VALUE 'P2'.      02240000
022500     05  PC-CP                        PIC  X(02) VALUE 'CP'.      02250000
022600     05  PC-A                         PIC  X     VALUE 'A'.       02260000
022700     05  PC-V                         PIC  X(01) VALUE 'V'.       02270000
022800     05  PC-W                         PIC  X(01) VALUE 'W'.       02280000
022810     05  PC-WMS                       PIC  X(03) VALUE 'WMS'.     02281007
022900     05  PC-ERROR-STATUS              PIC  X(01) VALUE 'E'.       02290000
023000     05  PC-INV-CYC-STATUS            PIC  X(01) VALUE 'I'.       02300000
023100     05  PC-NO-PRO-STATUS             PIC  X(01) VALUE 'F'.       02310000
023200     05  PC-READY-TO-VERIFY           PIC  X(01) VALUE 'R'.       02320000
023300     05  PC-POSTED-STATUS             PIC  X(01) VALUE 'P'.       02330000
023400     05  PC-CHECK-IN                  PIC  X(08) VALUE            02340000
023500                                            'CHECK IN'.           02350000
023600     05  PC-TRLRUNLD                  PIC  X(08) VALUE            02360000
023700                                            'TRLRUNLD'.           02370000
023800     05  PC-WO-HOTCM                  PIC  X(08) VALUE            02380000
023900                                            'WO HOTCM'.           02390000
024000     05  PC-SWEEPER                   PIC  X(08) VALUE            02400000
024100                                            'SWEEPER '.           02410000
024200     05  PC-P2L                       PIC  X(08) VALUE            02420000
024300                                            'P2L     '.           02430000
024400     05  PC-DPKUT038                  PIC  X(08) VALUE            02440000
024500         'DPKUT038'.                                              02450000
024600     05  PC-DEFAULT-TMST           PIC X(26)  VALUE               02460000
024700                                  '9999-09-09-09.09.09.999999'.   02470000
024800     05  PC-DEFAULT-DATE            PIC X(10)  VALUE '9999-09-09'.02480000
024900     05  PC-DEFAULT-TIME              PIC X(08)  VALUE '01.01.01'.02490000
025000     05  PC-AUDIT-RTN                 PIC  X(08) VALUE 'RCKCS290'.02500000
025100     05  PC-CURRENT-JOB-NAME          PIC  X(04) VALUE            02510000
025200         'CICS'.                                                  02520000
025300     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE 'WSKCS313'.02530000
025400     05  PC-UNTS-WRKD-PGRM-NAME       PIC  X(08) VALUE 'PCKCS756'.02540000
025500     05  PC-UNAVAILABLE-RESOURCES     PIC S9(04)  VALUE -904.     02550000
025600     05  PC-DEADLOCK                  PIC S9(04)  VALUE -913.     02560000
025700     05  PC-ROW-NOT-FOUND             PIC S9(04)  VALUE +100.     02570000
025800     05  PC-CURRENT-OPERATING-COMPANY PIC  X(02)  VALUE '03'.     02580000
025900     05  PC-SYSTEM-CODE               PIC  X(02)  VALUE 'PC'.     02590000
026000     05  PC-DISPLAY-PO                PIC  9(8)   VALUE ZEROS.    02600000
026100     05  PC-DISPLAY-RCVR              PIC  9(8)   VALUE ZEROS.    02610000
026200     05  PC-DISPLAY-LINE              PIC  9(8)   VALUE ZEROS.    02620000
026300     05  PC-DISPLAY-OPER              PIC  9(4)   VALUE ZEROS.    02630000
026400     05  PC-DISPLAY-SQL-CODE          PIC  9999-  VALUE ZEROS.    02640000
026500     05  PC-DISPLAY-CICS-RESP         PIC  999999999-             02650000
026600                                                  VALUE ZEROS.    02660000
026700*                                                                 02670000
026800*  LAYOUT FOR THE DATE ROUTINE DPKUT500                           02680000
026900*                                                                 02690000
027000     COPY DPWS500.                                                02700000
027100     EJECT                                                        02710000
027200*                                                                 02720000
027300*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       02730000
027400     COPY DPWS013.                                                02740000
027500     EJECT                                                        02750000
027600*                                                                 02760000
027700*  AUDIT MODULE LAYOUT                                            02770000
027800     COPY RCWS031.                                                02780000
027900                                                                  02790000
028000* COPY BOOK FOR CALLED MODULE PCKCS756                            02800000
028100     COPY PCWS238.                                                02810000
028200/                                                                 02820000
028300     EXEC SQL                                                     02830000
028400          INCLUDE TKRPRPM                                         02840000
028500     END-EXEC.                                                    02850000
028600*---------------------------------------------------------------* 02860000
028610*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 02861000
028620*---------------------------------------------------------------* 02862000
028630     EXEC SQL                                                     02863000
028640          INCLUDE TRECEIV                                         02864000
028650     END-EXEC.                                                    02865000
028660     EJECT                                                        02866000
028670*---------------------------------------------------------------* 02867000
028680*    DB2 AREA FOR RECEIPT ITEM TABLE                            * 02868000
028690*---------------------------------------------------------------* 02869000
028700     EXEC SQL                                                     02870000
028800          INCLUDE TRECITM                                         02880000
028900     END-EXEC.                                                    02890000
029000     EJECT                                                        02900000
029100*---------------------------------------------------------------* 02910000
029200*    DB2 AREA FOR RECEIPT DISTRIBUTION TABLE                    * 02920000
029300*---------------------------------------------------------------* 02930000
029400     EXEC SQL                                                     02940000
029500          INCLUDE TRECDIS                                         02950000
029600     END-EXEC.                                                    02960000
029700     EJECT                                                        02970000
029800*---------------------------------------------------------------* 02980000
029900*    DB2 AREA FOR RECEIPT VERIFICATION SOURCE TABLE             * 02990000
030000*---------------------------------------------------------------* 03000000
030100     EXEC SQL                                                     03010000
030200          INCLUDE TRECDVS                                         03020000
030300     END-EXEC.                                                    03030000
030400     EJECT                                                        03040000
030500*---------------------------------------------------------------* 03050000
030600*    DB2 AREA FOR THE TRANSACTION HEADER TABLE                  * 03060000
030700*---------------------------------------------------------------* 03070000
030800      EXEC SQL                                                    03080000
030900          INCLUDE TDISTHD                                         03090000
031000      END-EXEC.                                                   03100000
031100 EJECT                                                            03110000
031200*                                                                 03120000
031300*---------------------------------------------------------------* 03130000
031400*    DB2 AREA FOR THE PURCHASE ORDER HEADER TABLE               * 03140000
031500*---------------------------------------------------------------* 03150000
031600     EXEC SQL                                                     03160000
031700          INCLUDE TPURCHS                                         03170000
031800     END-EXEC.                                                    03180000
031900                                                                  03190000
032000 EJECT                                                            03200000
032100*---------------------------------------------------------------* 03210000
032200*    DB2 AREA FOR THE PURCHASE ORDER LINE TABLE                 * 03220000
032300*---------------------------------------------------------------* 03230000
032400     EXEC SQL                                                     03240000
032500          INCLUDE TPURITM                                         03250000
032600     END-EXEC.                                                    03260000
032700                                                                  03270000
032800 EJECT                                                            03280000
032900                                                                  03290000
033000*   DB2 COMMUNICATIONS AREA                                       03300000
033100*                                                                 03310000
033200      EXEC SQL                                                    03320000
033300          INCLUDE SQLCA                                           03330000
033400      END-EXEC.                                                   03340000
033500*                                                                 03350000
033600*   DB2 COMMUNICATIONS AREA2                                      03360000
033700*                                                                 03370000
033800     COPY SQLCA2.                                                 03380000
033900 EJECT                                                            03390000
034000                                                                  03400000
034100***************************************************************** 03410000
034200*    RECITM CURSOR TO RETURN THE UNVERIFIED LINES                 03420000
034300***************************************************************** 03430000
034400     EXEC SQL                                                     03440000
034500          DECLARE VRFY-ITM-CURSOR CURSOR WITH HOLD FOR            03450000
034600           SELECT                                                 03460000
034700                 B.STR_NBR                                        03470000
034800                ,B.VERIFY_ITM_QTY                                 03480000
034900                ,B.ORD_LNE_NBR                                    03490000
035000                ,A.RCPT_DISTR_UPD_CDE                             03500000
035100             FROM                                                 03510000
035200                  TRECITM A                                       03520000
035300               ,  TRECDIS B                                       03530000
035400             WHERE                                                03540000
035500                 A.ORD_NBR       = :DK-ORD-NBR                    03550000
035600             AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                03560000
035700             AND A.ORD_NBR       = B.ORD_NBR                      03570000
035800             AND A.REC_SEQ_NBR   = B.REC_SEQ_NBR                  03580000
035900             AND A.ORD_LNE_NBR   = B.ORD_LNE_NBR                  03590000
036000             AND A.STATUS_CDE  NOT IN ('VE','DE')                 03600000
036100             AND A.VER_STATUS_CDE     = 'A'                       03610000
036300          ORDER BY B.ORD_LNE_NBR ,B.STR_NBR                       03630000
036400     END-EXEC.                                                    03640000
036500 EJECT                                                            03650000
036600 LINKAGE SECTION.                                                 03660000
036700                                                                  03670000
036800     EJECT                                                        03680000
036900                                                                  03690000
037000******************************************************************03700000
037100 PROCEDURE DIVISION.                                              03710000
037200******************************************************************03720000
037300*                                                                 03730000
037400******************************************************************03740000
037500* 0000-MAIN-MODULE  - HIGHEST LEVEL CONTROL ROUTINE.             *03750000
037600******************************************************************03760000
037700 0000-MAIN-MODULE.                                                03770000
037800                                                                  03780000
037900     MOVE EIBTASKN               TO PV-TASK                       03790000
038000     EXEC SQL                                                     03800000
038100         SET :PV-CURR-DATE = CURRENT_DATE                         03810000
038200     END-EXEC.                                                    03820000
038300                                                                  03830000
038400     MOVE PV-CURR-DATE     TO PV-CURRENT-DATE.                    03840000
038500     MOVE PV-CURRENT-CC    TO PV-HOLD-CURR-CC.                    03850000
038600     MOVE PV-CURRENT-YY    TO PV-HOLD-CURR-YY.                    03860000
038700     MOVE PV-CURRENT-MM    TO PV-HOLD-CURR-MM.                    03870000
038800     MOVE PV-CURRENT-DD    TO PV-HOLD-CURR-DD.                    03880000
038900                                                                  03890000
039000                                                                  03900000
039100                                                                  03910000
039200     MOVE LENGTH RC289-COMMAREA-FOR-E200 TO                       03920000
039300                                     PV-COMMAREA-LENGTH.          03930000
039400                                                                  03940000
039500     EXEC CICS                                                    03950000
039600         RETRIEVE                                                 03960000
039700         INTO(RC289-COMMAREA-FOR-E200)                            03970000
039800         LENGTH(PV-COMMAREA-LENGTH)                               03980000
039900         RESP(PV-CICS-RESPONSE)                                   03990000
040000     END-EXEC.                                                    04000000
040100                                                                  04010000
040200                                                                  04020000
040300     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        04030000
040301                                                                  04030119
040310           PERFORM 9300-CHECK-LOGGING                             04031019
040320                                                                  04032019
040400           MOVE RC289-ORD-NBR        TO DK-ORD-NBR                04040000
040500                                        PC238-PO-NBR              04050000
040600           MOVE RC289-RCVR-SEQ-NBR   TO DK-REC-SEQ-NBR            04060000
040700                                        PC238-RCVR-SEQ-NBR        04070000
040800           PERFORM 2500-GET-TRECEIV-OPER-UNT-ID                   04080000
040900           MOVE RECEIV-CURR-OPER-UNT-ID TO PC238-WRKD-OPER-UNT-ID 04090000
041000           PERFORM 3000-PROCESS-VRFY-ITM-CSR                      04100000
041100           MOVE DK-ORD-NBR     TO PV-ORD-NBR-DISPLAY              04110000
041200           MOVE DK-REC-SEQ-NBR TO PV-REC-SEQ-NBR-DISPLAY          04120000
041300           MOVE DK-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY          04130000
041400           MOVE RECEIV-CURR-OPER-UNT-ID                           04140000
041500                               TO PV-OPER-UNT-ID-DISPLAY          04150000
041600           MOVE PV-FCLTY-ID    TO PV-FCLTY-ID-DISPLAY             04160000
041700           MOVE EIBTRNID       TO PV-ID-NBR-DISPLAY               04170000
041900           STRING ' WSKCS313 STARTED - TASK = ' PV-TASK-X         04190000
042000                      '  '                                        04200000
042100                      PV-OPER-UNT-ID-DISPLAY                      04210000
042200                      '-'                                         04220000
042300                      PV-ORD-NBR-DISPLAY                          04230000
042400                      '-'                                         04240000
042500                      PV-REC-SEQ-NBR-DISPLAY                      04250000
042600                      '-'                                         04260000
042700                      PV-ORD-LNE-NBR-DISPLAY                      04270000
042800             DELIMITED BY SIZE INTO PV-CICS-MSG-AREA              04280000
042900           PERFORM 9995-WRITE-CICS-FOR-DEBUG                      04290000
043000           PERFORM 9990-WRITE-CICS                                04300000
043100                                                                  04310000
043200           IF PS-DATA-OK                                          04320000
043300               STRING ' WSKCS313'                                 04330000
043400                      '   '                                       04340000
043500                      PV-OPER-UNT-ID-DISPLAY                      04350000
043600                      '-'                                         04360000
043700                      PV-ORD-NBR-DISPLAY                          04370000
043800                      '-'                                         04380000
043900                      PV-REC-SEQ-NBR-DISPLAY                      04390000
044000                      '-'                                         04400000
044100                      PV-ORD-LNE-NBR-DISPLAY                      04410000
044200                      '  SUCCESSFUL VERIFICATION'                 04420000
044300                                          DELIMITED BY SIZE       04430000
044400                             INTO PV-CICS-MSG-AREA                04440000
044500              PERFORM 9995-WRITE-CICS-FOR-DEBUG                   04450000
044600              PERFORM 9990-WRITE-CICS                             04460000
044700              PERFORM 6500-CALL-PO-RCVR-TRKING-MOD                04470000
044800     END-IF.                                                      04480000
044900                                                                  04490000
045000     STRING ' WSKCS313 ENDED - TASK = ' PV-TASK-X                 04500000
045100         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 04510000
045200     PERFORM 9995-WRITE-CICS-FOR-DEBUG.                           04520000
045300     PERFORM 9990-WRITE-CICS.                                     04530000
045400                                                                  04540000
045500     EXEC CICS                                                    04550000
045600         RETURN                                                   04560000
045700     END-EXEC.                                                    04570000
045800                                                                  04580000
045900     GOBACK.                                                      04590000
046000     EJECT                                                        04600000
046100*                                                                 04610000
046200*                                                                 04620000
046300*----------------------------------------------------------------*04630000
046400*    FETCH THE OPERATING UNIT ID THAT IS ASSOCIATED WITH THE     *04640000
046500*    RECEIVER AND LINE NUMBER THAT WE ARE ATTEMPTING TO VERIFY.  *04650000
046600*----------------------------------------------------------------*04660000
046700 2500-GET-TRECEIV-OPER-UNT-ID.                                    04670000
046710     IF PS-SHOW-DEBUG-INFO                                        04671018
046720         STRING   ' ' PV-TASK-X                                   04672018
046730                ' WSKCS313-2500-GET-TRECEIV-OPER-UNT-ID'          04673018
046740         DELIMITED BY SIZE                                        04674018
046750         INTO PV-CICS-MSG-AREA                                    04675018
046760         PERFORM 9990-WRITE-CICS                                  04676018
046791     END-IF.                                                      04679118
046792                                                                  04679218
046800     INITIALIZE DCLTRECEIV.                                       04680000
046900                                                                  04690000
047000         EXEC SQL                                                 04700000
047100              SELECT                                              04710000
047200                 OPER_UNT_ID                                      04720000
047300                ,CURR_OPER_UNT_ID                                 04730000
047400                ,CURRENT TIMESTAMP                                04740000
047410                ,PACK_BY_ST_IND                                   04741021
047420                ,PKGNG_CDE                                        04742020
047500            INTO                                                  04750000
047600                 :RECEIV-OPER-UNT-ID                              04760000
047700                ,:RECEIV-CURR-OPER-UNT-ID                         04770000
047800                ,:PV-CURRENT-TIMESTAMP                            04780000
047810                ,:RECEIV-PACK-BY-ST-IND                           04781021
047820                ,:RECEIV-PKGNG-CDE                                04782020
047900              FROM  TRECEIV                                       04790000
048000              WHERE                                               04800000
048100                     ORD_NBR          =  :DK-ORD-NBR              04810000
048200              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          04820000
048300              AND    VER_STATUS_CDE   =  :PC-A                    04830000
048400              WITH UR                                             04840000
048500         END-EXEC                                                 04850000
048600                                                                  04860000
048700         EVALUATE TRUE                                            04870000
048800             WHEN SQLCODE = ZERO                                  04880000
048900                  SET PS-DATA-OK    TO  TRUE                      04890000
049000             WHEN SQLCODE = +100                                  04900000
049100                  SET PS-DATA-NOT-OK  TO  TRUE                    04910000
049200             WHEN SQLWARN0 NOT = SPACE                            04920000
049300             WHEN SQLCODE NOT = ZERO                              04930000
049400                  MOVE '2500-GET-TRECEIV-OPER-UNT-ID'             04940000
049500                                   TO DP013-PARAGRAPH             04950000
049600                  MOVE 'SELECT TRECEIV'                           04960000
049700                                   TO DP013-MESSAGE-TEXT (1)      04970000
049800                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          04980000
049900                  MOVE DK-REC-SEQ-NBR                             04990000
050000                                   TO PV-ERROR-RCVR-SEQ-NBR       05000000
050100                  STRING ' RCVR: '            DELIMITED BY SIZE   05010000
050200                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   05020000
050300                       '-'                    DELIMITED BY SIZE   05030000
050400                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   05040000
050500                                 INTO DP013-MESSAGE-TEXT (2)      05050000
050600                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    05060000
050700                  MOVE SQLCA       TO DP013-SQLCA                 05070000
050800                  SET DP013-DB2-ABEND                             05080000
050900                                   TO TRUE                        05090000
051000                  PERFORM Z999-ABEND                              05100000
051100         END-EVALUATE.                                            05110000
051200/                                                                 05120000
051300 3000-PROCESS-VRFY-ITM-CSR.                                       05130000
051310     IF PS-SHOW-DEBUG-INFO                                        05131018
051320         STRING   ' ' PV-TASK-X                                   05132018
051330                ' WSKCS313-3000-PROCESS-VRFY-ITM-CSR   '          05133018
051340         DELIMITED BY SIZE                                        05134018
051350         INTO PV-CICS-MSG-AREA                                    05135018
051360         PERFORM 9990-WRITE-CICS                                  05136018
051370     END-IF.                                                      05137018
051380                                                                  05138018
051400      SET PS-FIRST-VRFY-ITM-FETCH                                 05140000
051410          PS-NOT-FRASTY                                           05141012
051500          PS-NOT-END-OF-VRFY-ITM-CSR  TO TRUE                     05150000
051600      MOVE ZEROES TO PV-TOTAL-ACTL-LINE-QTY                       05160000
051700                                                                  05170000
051800      PERFORM 3100-OPEN-VRFY-ITM-CURSOR                           05180000
051900      PERFORM 3200-PROCESS-VRFY-ITM-CSR                           05190000
052000          UNTIL ((PS-END-OF-VRFY-ITM-CSR) OR                      05200000
052100                 (PS-DATA-NOT-OK))                                05210000
052200      PERFORM 3300-CLOSE-VRFY-ITM-CURSOR                          05220000
052300      PERFORM 5300-COUNT-TRECITM-ROWS.                            05230000
052400      IF PV-DB2-COUNT  = 0                                        05240000
052500*        PERFORM 4700-UPDATE-TRECEIV-AUDIT                        05250005
052600*        PERFORM 5200-UPDATE-TRECEIV                              05260005
052700* CALL UNITS MODULE AT A PO/RCVR LEVEL TO RETURN TOTAL UNITS FOR  05270000
052800* THE RECEIVER                                                    05280000
052900         MOVE ZEROES                  TO RC074-LINE-NBR           05290000
053000                                         RC074-STR-NBR            05300000
053100         PERFORM 4000-CALL-RCKUT128                               05310000
053200         MOVE RECEIV-CURR-OPER-UNT-ID TO                          05320000
053300                              PC238-WRKD-OPER-UNT-ID              05330000
053400         MOVE RC074-TOTAL-ACTL-ITM-QTY TO                         05340000
053500                              PC238-WRKD-UNT-QTY                  05350000
053600         MOVE DK-ORD-NBR              TO PC238-PO-NBR             05360000
053700         MOVE DK-REC-SEQ-NBR          TO PC238-RCVR-SEQ-NBR       05370000
053800         MOVE RECEIV-CURR-OPER-UNT-ID TO PC238-WRKD-OPER-UNT-ID   05380000
053900         MOVE ZEROES                  TO PC238-PO-LNE-NBR         05390000
054000         MOVE PC-W TO PC238-TRANS-TYPE-CDE                        05400000
054001         MOVE RC074-TOTAL-ACTL-OTBND-CNT TO RECEIV-ACTL-CART-CNT  05400105
054010         PERFORM 4700-UPDATE-TRECEIV-AUDIT                        05401005
054020         PERFORM 5200-UPDATE-TRECEIV                              05402005
054030                                                                  05403005
054100         PERFORM 6000-UPDATE-UNITS-WRKD                           05410000
054200         PERFORM 4800-UPDATE-DISTHD                               05420000
054201         PERFORM 6201-CHECK-FOR-FRASTY-HANDLING                   05420112
054210         IF PS-FRASTY                                             05421009
054300             PERFORM 6200-LINK-TO-FRASTY-HANDLER                  05430009
054310         END-IF                                                   05431009
054400      END-IF.                                                     05440000
054500                                                                  05450000
054600                                                                  05460000
054700******************************************************************05470000
054800* 3100-OPEN-VRFY-ITM-CURSOR                                      *05480000
054900*    OPEN THE DETAIL TRANSACTION CURSOR                          *05490000
055000******************************************************************05500000
055100 3100-OPEN-VRFY-ITM-CURSOR.                                       05510000
055110     IF PS-SHOW-DEBUG-INFO                                        05511018
055120         STRING   ' ' PV-TASK-X                                   05512018
055130                ' WSKCS313-3100-OPEN-VRFY-ITM-CURSOR   '          05513018
055140         DELIMITED BY SIZE                                        05514018
055150         INTO PV-CICS-MSG-AREA                                    05515018
055160         PERFORM 9990-WRITE-CICS                                  05516018
055170     END-IF.                                                      05517018
055180                                                                  05518018
055200                                                                  05520000
055300         EXEC SQL                                                 05530000
055400              OPEN VRFY-ITM-CURSOR                                05540000
055500         END-EXEC                                                 05550000
055600                                                                  05560000
055700         EVALUATE TRUE                                            05570000
055800             WHEN SQLCODE NOT EQUAL ZERO                          05580000
055900                  MOVE '3100-OPEN-VRFY-ITM-CURSOR'                05590000
056000                                   TO  DP013-PARAGRAPH            05600000
056100                  MOVE 'OPEN VRFY-ITM-CURSOR'                     05610000
056200                                   TO  DP013-MESSAGE-TEXT (1)     05620000
056300                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          05630000
056400                  MOVE DK-REC-SEQ-NBR                             05640000
056500                                   TO  PV-ERROR-RCVR-SEQ-NBR      05650000
056600                  STRING ' RCVR: '            DELIMITED BY SIZE   05660000
056700                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   05670000
056800                       '-'                    DELIMITED BY SIZE   05680000
056900                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   05690000
057000                                 INTO DP013-MESSAGE-TEXT (2)      05700000
057100                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    05710000
057200                  MOVE SQLCA       TO  DP013-SQLCA                05720000
057300                  SET DP013-DB2-ABEND                             05730000
057400                                   TO  TRUE                       05740000
057500                  PERFORM Z999-ABEND                              05750000
057600         END-EVALUATE.                                            05760000
057700                                                                  05770000
057800******************************************************************05780000
057900* 3200-PROCESS-VRFY-ITM-CSR                                       05790000
058000*  DOES A FETCH ON THE TRECITM AND CALLS THE MODULE               05800000
058100*  USED TO ACQUIRE EXPECTED/ACTUAL/VERIFIED UNIT QUANTITIES       05810000
058200*  AND CARTON COUNTS (RCKUT128)                                   05820000
058300******************************************************************05830000
058400                                                                  05840000
058500 3200-PROCESS-VRFY-ITM-CSR.                                       05850000
058510     IF PS-SHOW-DEBUG-INFO                                        05851018
058520         STRING   ' ' PV-TASK-X                                   05852018
058530                ' WSKCS313-3200-PROCESS-VRFY-ITM-CSR   '          05853018
058540         DELIMITED BY SIZE                                        05854018
058550         INTO PV-CICS-MSG-AREA                                    05855018
058560         PERFORM 9990-WRITE-CICS                                  05856018
058570     END-IF.                                                      05857018
058580                                                                  05858018
058600      PERFORM 3250-FETCH-VRFY-ITM-CSR                             05860000
058700      IF PS-NOT-END-OF-VRFY-ITM-CSR                               05870000
058800*CALL TO GET TOTAL UNITS FOR STORE                                05880000
058900           PERFORM 4000-CALL-RCKUT128                             05890000
059000           IF PS-DATA-OK                                          05900000
059100              IF RC074-TOTAL-ACTL-ITM-QTY NOT =                   05910000
059200                                            RECDIS-VERIFY-ITM-QTY 05920000
059300                  PERFORM 4500-ADD-TO-RECD-AUDIT                  05930000
059400              END-IF                                              05940000
059500              PERFORM 5000-UPDATE-TRECDIS                         05950000
059600              IF RECDIS-ORD-LNE-NBR = PV-PREV-ORD-LNE-NBR         05960000
059700                 COMPUTE PV-TOTAL-ACTL-LINE-QTY =                 05970000
059800                                PV-TOTAL-ACTL-LINE-QTY +          05980000
059900                                RC074-TOTAL-ACTL-ITM-QTY          05990000
060000                 MOVE PV-PREV-ORD-LNE-NBR TO PC238-PO-LNE-NBR     06000000
060100              ELSE                                                06010000
060200                 PERFORM 4600-AUDIT-TRECITM                       06020000
060300                 PERFORM 5100-UPDATE-TRECITM-ACTUAL               06030000
060400                 PERFORM 5400-PURITM-UPD-CHECK                    06040000
060500                 SET PC238-TRANS-LINE-VERIFY TO TRUE              06050000
060600                 MOVE PV-TOTAL-ACTL-LINE-QTY TO                   06060000
060700                                           PC238-WRKD-UNT-QTY     06070000
060800                 MOVE ZEROES   TO PV-TOTAL-ACTL-LINE-QTY          06080000
060900                 COMPUTE PV-TOTAL-ACTL-LINE-QTY =                 06090000
061000                                PV-TOTAL-ACTL-LINE-QTY +          06100000
061100                                RC074-TOTAL-ACTL-ITM-QTY          06110000
061200                 MOVE PV-PREV-ORD-LNE-NBR TO PC238-PO-LNE-NBR     06120000
061300                 PERFORM 6000-UPDATE-UNITS-WRKD                   06130000
061400                 PERFORM 9100-SYNCPOINT                           06140000
061500                 MOVE RECDIS-ORD-LNE-NBR TO PV-PREV-ORD-LNE-NBR   06150000
061600                 MOVE RECITM-RCPT-DISTR-UPD-CDE TO                06160000
061700                                        PV-PREV-DISTR-UPD-CDE     06170000
061800              END-IF                                              06180000
061900           END-IF                                                 06190000
062000      END-IF.                                                     06200000
062100                                                                  06210000
062200      IF PS-END-OF-VRFY-ITM-CSR AND PS-NOT-FIRST-VRFY-ITM-FETCH   06220000
062300         PERFORM 4600-AUDIT-TRECITM                               06230000
062400         PERFORM 5100-UPDATE-TRECITM-ACTUAL                       06240000
062500         PERFORM 5400-PURITM-UPD-CHECK                            06250000
062600         MOVE PV-PREV-ORD-LNE-NBR TO PC238-PO-LNE-NBR             06260000
062700         SET PC238-TRANS-LINE-VERIFY TO TRUE                      06270000
062800         MOVE PV-TOTAL-ACTL-LINE-QTY  TO PC238-WRKD-UNT-QTY       06280000
062900         PERFORM 6000-UPDATE-UNITS-WRKD                           06290000
063000         PERFORM 9100-SYNCPOINT                                   06300000
063100      END-IF.                                                     06310000
063200                                                                  06320000
063300                                                                  06330000
063400******************************************************************06340000
063500*                                                                *06350000
063600*                                                                *06360000
063700******************************************************************06370000
063800 3250-FETCH-VRFY-ITM-CSR.                                         06380000
063810     IF PS-SHOW-DEBUG-INFO                                        06381018
063820         STRING   ' ' PV-TASK-X                                   06382018
063830                ' WSKCS313-3250-FETCH-VRFY-ITM-CSR     '          06383018
063840         DELIMITED BY SIZE                                        06384018
063850         INTO PV-CICS-MSG-AREA                                    06385018
063860         PERFORM 9990-WRITE-CICS                                  06386018
063870     END-IF.                                                      06387018
063880                                                                  06388018
063900                                                                  06390000
064000     INITIALIZE DCLTRECDIS.                                       06400000
064100                                                                  06410000
064200     EXEC SQL                                                     06420000
064300          FETCH VRFY-ITM-CURSOR                                   06430000
064400                                                                  06440000
064500          INTO                                                    06450000
064600               :RECDIS-STR-NBR                                    06460000
064700             , :RECDIS-VERIFY-ITM-QTY                             06470000
064800             , :RECDIS-ORD-LNE-NBR                                06480000
064900             , :RECITM-RCPT-DISTR-UPD-CDE                         06490000
065000     END-EXEC.                                                    06500000
065100                                                                  06510000
065200     EVALUATE TRUE                                                06520000
065300         WHEN SQLCODE = ZERO                                      06530000
065400              MOVE RECDIS-ORD-LNE-NBR TO DK-ORD-LNE-NBR           06540000
065500              IF PS-FIRST-VRFY-ITM-FETCH                          06550000
065600                 SET PS-NOT-FIRST-VRFY-ITM-FETCH                  06560000
065700                     PC238-NO-PRCG-AREA-CDE      TO TRUE          06570000
065800                 MOVE RECDIS-ORD-LNE-NBR TO PV-PREV-ORD-LNE-NBR   06580000
065900                 MOVE RECITM-RCPT-DISTR-UPD-CDE                   06590000
066000                                 TO PV-PREV-DISTR-UPD-CDE         06600000
066100              END-IF                                              06610000
066101                                                                  06610127
066102     IF PS-SHOW-DEBUG-INFO                                        06610227
066111        MOVE DK-ORD-NBR          TO  PV-ORD-NBR-DISPLAY           06611127
066120        MOVE DK-REC-SEQ-NBR      TO  PV-REC-SEQ-NBR-DISPLAY       06612027
066130        MOVE RECDIS-ORD-LNE-NBR  TO  PV-ORD-LNE-NBR-DISPLAY       06613027
066150        MOVE RECDIS-STR-NBR      TO  PV-STORE-NBR-DISPLAY         06615027
066160         STRING   ' ' PV-TASK-X                                   06616027
066170                  ' WSKCS313-3250-'                               06617027
066173                      PV-ORD-NBR-DISPLAY     '-'                  06617327
066174                      PV-REC-SEQ-NBR-DISPLAY '-'                  06617427
066175                      PV-ORD-LNE-NBR-DISPLAY '-'                  06617527
066176                      PV-STORE-NBR-DISPLAY                        06617627
066180                      DELIMITED BY SIZE                           06618027
066190                 INTO PV-CICS-MSG-AREA                            06619027
066191         PERFORM 9990-WRITE-CICS                                  06619127
066192     END-IF                                                       06619227
066193                                                                  06619327
066200         WHEN SQLCODE = +100                                      06620000
066300              SET PS-END-OF-VRFY-ITM-CSR TO TRUE                  06630000
066400         WHEN SQLWARN0 NOT EQUAL SPACE                            06640000
066500         WHEN SQLCODE NOT EQUAL ZERO                              06650000
066600              MOVE '3250-FETCH-VRFY-ITM-CSR '                     06660000
066700                               TO  DP013-PARAGRAPH                06670000
066800              MOVE 'FETCH TRECDIS CURSOR'                         06680000
066900                               TO  DP013-MESSAGE-TEXT (1)         06690000
067000              MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR                 06700000
067100              MOVE DK-REC-SEQ-NBR                                 06710000
067200                               TO PV-ERROR-RCVR-SEQ-NBR           06720000
067300              MOVE DK-ORD-LNE-NBR                                 06730000
067400                               TO PV-ERROR-ORD-LNE-NBR            06740000
067500              STRING ' RCVR: '            DELIMITED BY SIZE       06750000
067600                   PV-ERROR-ORD-NBR       DELIMITED BY SIZE       06760000
067700                   '-'                    DELIMITED BY SIZE       06770000
067800                   PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE       06780000
067900                   '  LINE: '             DELIMITED BY SIZE       06790000
068000                   PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE       06800000
068100                             INTO DP013-MESSAGE-TEXT (2)          06810000
068200              MOVE 'TRECDIS'   TO  DP013-DB2-TABLE-NAME (1)       06820000
068300              MOVE SQLCA       TO  DP013-SQLCA                    06830000
068400              SET DP013-DB2-ABEND                                 06840000
068500                               TO  TRUE                           06850000
068600              PERFORM Z999-ABEND                                  06860000
068700     END-EVALUATE.                                                06870000
068800/                                                                 06880000
068900******************************************************************06890000
069000* 3300-CLOSE-VRFY-ITM-CURSOR.                                     06900000
069100******************************************************************06910000
069200 3300-CLOSE-VRFY-ITM-CURSOR.                                      06920000
069210     IF PS-SHOW-DEBUG-INFO                                        06921018
069220         STRING   ' ' PV-TASK-X                                   06922018
069230                ' WSKCS313-3300-CLOSE-VRFY-ITM-CURSOR  '          06923018
069240         DELIMITED BY SIZE                                        06924018
069250         INTO PV-CICS-MSG-AREA                                    06925018
069260         PERFORM 9990-WRITE-CICS                                  06926018
069270     END-IF.                                                      06927018
069280                                                                  06928018
069300                                                                  06930000
069400     EXEC SQL                                                     06940000
069500         CLOSE VRFY-ITM-CURSOR                                    06950000
069600     END-EXEC.                                                    06960000
069700                                                                  06970000
069800     EVALUATE TRUE                                                06980000
069900         WHEN SQLWARN0 NOT EQUAL SPACE                            06990000
070000         WHEN SQLCODE NOT EQUAL ZERO                              07000000
070100              MOVE '3300-CLOSE-VRFY-ITM-CURSOR  '                 07010000
070200                               TO  DP013-PARAGRAPH                07020000
070300              MOVE 'CLOSE TRECITM CURSOR'                         07030000
070400                               TO  DP013-MESSAGE-TEXT (1)         07040000
070500              MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)        07050000
070600              MOVE SQLCA       TO  DP013-SQLCA                    07060000
070700              SET DP013-DB2-ABEND                                 07070000
070800                               TO  TRUE                           07080000
070900              PERFORM Z999-ABEND                                  07090000
071000     END-EVALUATE.                                                07100000
071100                                                                  07110000
071200                                                                  07120000
071300 4000-CALL-RCKUT128.                                              07130000
071400     INITIALIZE RC074-FIELDS.                                     07140000
071500     MOVE RECEIV-CURR-OPER-UNT-ID TO RC074-OPER-UNT-ID.           07150000
071600     MOVE PV-FCLTY-ID         TO RC074-FCLTY-ID.                  07160000
071700     MOVE DK-ORD-NBR          TO RC074-PO-NBR.                    07170000
071800     MOVE DK-REC-SEQ-NBR      TO RC074-RCVR-SEQ-NBR.              07180000
071900     MOVE RECDIS-ORD-LNE-NBR  TO RC074-LINE-NBR.                  07190000
072000     MOVE RECDIS-STR-NBR      TO RC074-STR-NBR.                   07200000
072100     SET RC074-CARTON-COUNT-YES                                   07210006
072110         RC074-UNIT-QTY-YES   TO TRUE.                            07211006
072200                                                                  07220000
072300                                                                  07230000
072400     CALL RC074-UNIT-CRTN-CNT-PGM USING  DFHEIBLK                 07240000
072500                                         RC074-COMMAREA           07250000
072600                                         RC074-FIELDS.            07260000
072700                                                                  07270000
072800     EVALUATE TRUE                                                07280000
072900         WHEN RC074-SUCCESSFUL                                    07290000
073000             CONTINUE                                             07300000
073100         WHEN OTHER                                               07310000
073200             SET PS-DATA-NOT-OK  TO TRUE                          07320000
073300             MOVE '4000-CALL-RCKUT128 '                           07330000
073400                                     TO DP013-PARAGRAPH           07340000
073500             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          07350000
073600             MOVE DK-REC-SEQ-NBR      TO PV-ERROR-RCVR-SEQ-NBR    07360000
073700             MOVE RECEIV-CURR-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID 07370000
073800             MOVE RECDIS-ORD-LNE-NBR TO PV-ORD-LNE-NBR-DISPLAY    07380000
073900             MOVE DISTHD-OPER-UNT-ID TO PV-OPER-UNT-ID-DISPLAY    07390000
074000             MOVE RECDIS-STR-NBR     TO PV-STORE-NBR-DISPLAY      07400000
074100             STRING ' WSKCS313-RC128'   DELIMITED BY SIZE         07410000
074200                    ' RCVR: '           DELIMITED BY SIZE         07420000
074300                    PV-ERROR-ORD-NBR    DELIMITED BY SIZE         07430000
074400                    '-'                 DELIMITED BY SIZE         07440000
074500                    PV-ERROR-RCVR-SEQ-NBR                         07450000
074600                                        DELIMITED BY SIZE         07460000
074700                    '  LINE: '          DELIMITED BY SIZE         07470000
074800                    PV-ORD-LNE-NBR-DISPLAY                        07480000
074900                                        DELIMITED BY SIZE         07490000
075000                    '  FCLTY: '         DELIMITED BY SIZE         07500000
075100                    PV-OPER-UNT-ID-DISPLAY                        07510000
075200                    '  FCLTY: '         DELIMITED BY SIZE         07520000
075300                    PV-STORE-NBR-DISPLAY                          07530000
075400                                        DELIMITED BY SIZE         07540000
075500                           INTO PV-CICS-MSG-AREA                  07550000
075600             PERFORM 9990-WRITE-CICS                              07560000
075700             STRING ' OPER: '            DELIMITED BY SIZE        07570000
075800                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        07580000
075900                    ' RCVR: '            DELIMITED BY SIZE        07590000
076000                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        07600000
076100                  '-'                    DELIMITED BY SIZE        07610000
076200                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        07620000
076300                  ' IND: '               DELIMITED BY SIZE        07630000
076400                  RC074-SUCCESS-IND      DELIMITED BY SIZE        07640000
076500                                   INTO DP013-MESSAGE-TEXT (1)    07650000
076600             SET DP013-XCTL-DISPLAY-RESTART                       07660000
076700                 DP013-DB2-ABEND     TO TRUE                      07670000
076800                                                                  07680000
076900             PERFORM Z999-ABEND                                   07690000
077000     END-EVALUATE.                                                07700000
077100*----------------------------------------------------------------*07710000
077200/                                                                 07720000
077300                                                                  07730000
077400******************************************************************07740000
077500 4500-ADD-TO-RECD-AUDIT.                                          07750000
077510     IF PS-SHOW-DEBUG-INFO                                        07751018
077520         STRING   ' ' PV-TASK-X                                   07752018
077530                ' WSKCS313-4500-ADD-TO-RECD-AUDIT      '          07753018
077540         DELIMITED BY SIZE                                        07754018
077550         INTO PV-CICS-MSG-AREA                                    07755018
077560         PERFORM 9990-WRITE-CICS                                  07756018
077570     END-IF.                                                      07757018
077580                                                                  07758018
077600     MOVE DK-ORD-NBR     TO RC031-PO-NBR.                         07760000
077700     MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR.                    07770000
077800     MOVE RECDIS-ORD-LNE-NBR TO RC031-PO-LNE-NBR.                 07780000
077900     MOVE RECEIV-OPER-UNT-ID                                      07790000
078000                         TO RC031-OPER-UNT-ID.                    07800000
078100     MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID.                       07810000
078200     MOVE RECDIS-STR-NBR TO RC031-STR-NBR.                        07820000
078300     MOVE PC-CURRENT-PROGRAM-NAME                                 07830000
078400                         TO RC031-UPD-PGM-ID                      07840000
078500                            RC031-UPD-UID.                        07850000
078600     MOVE PV-CURRENT-TIMESTAMP                                    07860000
078700                         TO RC031-UPD-TMST.                       07870000
078800     MOVE LENGTH OF RC031-FIELDS                                  07880000
078900                         TO PV-AUDIT-RTN-LENGTH.                  07890000
079000*                                                                 07900000
079100     SET  RC031-AUDIT-TRECDIS                                     07910000
079200          RC031-BEFORE                                            07920000
079300          RC031-UPDATE   TO TRUE.                                 07930000
079310                                                                  07931027
079320     IF PS-SHOW-DEBUG-INFO                                        07932027
079330        MOVE RC031-OPER-UNT-ID   TO  PV-OPER-UNT-ID-DISPLAY       07933027
079331        MOVE RC031-FCLTY-ID      TO  PV-FCLTY-ID-DISPLAY          07933127
079340        MOVE RC031-PO-NBR        TO  PV-ORD-NBR-DISPLAY           07934027
079341        MOVE RC031-REC-SEQ-NBR   TO  PV-REC-SEQ-NBR-DISPLAY       07934127
079350        MOVE RC031-PO-LNE-NBR    TO  PV-ORD-LNE-NBR-DISPLAY       07935027
079360        MOVE RC031-STR-NBR       TO  PV-STORE-NBR-DISPLAY         07936027
079370         STRING   ' ' PV-TASK-X                                   07937027
079380                  ' WSKCS313-4500-'                               07938027
079390                      PV-OPER-UNT-ID-DISPLAY '-'                  07939027
079391                      PV-FCLTY-ID-DISPLAY    '-'                  07939127
079392                      PV-ORD-NBR-DISPLAY     '-'                  07939227
079393                      PV-REC-SEQ-NBR-DISPLAY '-'                  07939327
079394                      PV-ORD-LNE-NBR-DISPLAY '-'                  07939427
079395                      PV-STORE-NBR-DISPLAY                        07939527
079396                      '   BEFORE   '                              07939627
079397                      DELIMITED BY SIZE                           07939727
079398                 INTO PV-CICS-MSG-AREA                            07939827
079399         PERFORM 9990-WRITE-CICS                                  07939927
079400     END-IF                                                       07940027
079401                                                                  07940127
079410*                                                                 07941027
079500     EXEC CICS                                                    07950000
079600          LINK PROGRAM  (PC-AUDIT-RTN)                            07960000
079700          COMMAREA      (RC031-FIELDS)                            07970000
079800          LENGTH        (PV-AUDIT-RTN-LENGTH)                     07980000
079900     END-EXEC.                                                    07990000
080000*                                                                 08000000
080100     IF  RC031-CALL-SUCCESSFUL                                    08010000
080200         CONTINUE                                                 08020000
080300     ELSE                                                         08030000
080400         MOVE '4500-ADD-TO-RECD-AUDIT'                            08040000
080500                                 TO DP013-PARAGRAPH               08050000
080600         MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECDIS'        08060000
080700                                 TO DP013-MESSAGE-TEXT (1)        08070000
080800         MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR              08080000
080900         MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR             08090000
081000         MOVE RECDIS-ORD-LNE-NBR TO PV-ERROR-ORD-LNE-NBR          08100000
081100         MOVE RECDIS-STR-NBR     TO PV-ERROR-STR-NBR              08110000
081200         STRING ' RCVR: '            DELIMITED BY SIZE            08120000
081300              PV-ERROR-ORD-NBR       DELIMITED BY SIZE            08130000
081400              '-'                    DELIMITED BY SIZE            08140000
081500              PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE            08150000
081600              '  LINE: '             DELIMITED BY SIZE            08160000
081700              PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE            08170000
081800              '  STORE: '            DELIMITED BY SIZE            08180000
081900              PV-ERROR-STR-NBR       DELIMITED BY SIZE            08190000
082000                               INTO DP013-MESSAGE-TEXT (2)        08200000
082100         STRING RC031-RETURN-CODE    DELIMITED BY SIZE            08210000
082200              '-'                    DELIMITED BY SIZE            08220000
082300              RC031-RETURN-DESC      DELIMITED BY SIZE            08230000
082400              '  SQL CODE: '         DELIMITED BY SIZE            08240000
082500              RC031-SQLCODE          DELIMITED BY SIZE            08250000
082600                               INTO DP013-MESSAGE-TEXT (3)        08260000
082700         MOVE RC031-SQLCA        TO DP013-SQLCA                   08270000
082800         MOVE 'TAURECD '         TO DP013-DB2-TABLE-NAME (1)      08280000
082900         SET DP013-DB2-ABEND     TO TRUE                          08290000
083000                                                                  08300000
083100         PERFORM Z999-ABEND                                       08310000
083200     END-IF.                                                      08320000
083300                                                                  08330000
083400                                                                  08340000
083500*----------------------------------------------------------------*08350000
083600*    TO UPDATE A ROW, THE CURRENT ROW IS ADDED TO THE            *08360000
083700*    AUDIT FILE AS THE 'BEFORE' ROW.  THE ROW IS THEN UPDATED    *08370000
083800*    ON RECITM AND THIS ROW AS ADDED TO THE AUDIT TABLE AS       *08380000
083900*    THE AFTER ROW.                                              *08390000
084000*----------------------------------------------------------------*08400000
084100 4600-AUDIT-TRECITM.                                              08410000
084110     IF PS-SHOW-DEBUG-INFO                                        08411018
084120         STRING   ' ' PV-TASK-X                                   08412018
084130                ' WSKCS313-4600-AUDIT-TRECITM          '          08413018
084140         DELIMITED BY SIZE                                        08414018
084150         INTO PV-CICS-MSG-AREA                                    08415018
084160         PERFORM 9990-WRITE-CICS                                  08416018
084170     END-IF.                                                      08417018
084180                                                                  08418018
084200                                                                  08420000
084300     IF  PS-DATA-OK AND PV-PREV-ORD-LNE-NBR > 0                   08430000
084400         MOVE DK-ORD-NBR     TO RC031-PO-NBR                      08440000
084500         MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR                 08450000
084600         MOVE PV-PREV-ORD-LNE-NBR TO RC031-PO-LNE-NBR             08460000
084700         MOVE RECEIV-OPER-UNT-ID                                  08470000
084800                             TO RC031-OPER-UNT-ID                 08480000
084900         MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID                    08490000
085000         MOVE PC-CURRENT-PROGRAM-NAME                             08500000
085100                             TO RC031-UPD-PGM-ID                  08510000
085200                                RC031-UPD-UID                     08520000
085300         MOVE PV-CURRENT-TIMESTAMP                                08530000
085400                             TO RC031-UPD-TMST                    08540000
085500         MOVE LENGTH OF RC031-FIELDS                              08550000
085600                             TO PV-AUDIT-RTN-LENGTH               08560000
085700*                                                                 08570000
085800         SET  RC031-AUDIT-TRECITM                                 08580000
085900              RC031-BEFORE                                        08590000
086000              RC031-UPDATE   TO TRUE                              08600000
086100*                                                                 08610000
086110     IF PS-SHOW-DEBUG-INFO                                        08611027
086120        MOVE RC031-OPER-UNT-ID   TO  PV-OPER-UNT-ID-DISPLAY       08612027
086121        MOVE RC031-FCLTY-ID      TO  PV-FCLTY-ID-DISPLAY          08612127
086122        MOVE RC031-PO-NBR        TO  PV-ORD-NBR-DISPLAY           08612227
086130        MOVE RC031-REC-SEQ-NBR   TO  PV-REC-SEQ-NBR-DISPLAY       08613027
086140        MOVE RC031-PO-LNE-NBR    TO  PV-ORD-LNE-NBR-DISPLAY       08614027
086150***     MOVE RECDIS-STR-NBR      TO  PV-STORE-NBR-DISPLAY         08615027
086160         STRING   ' ' PV-TASK-X                                   08616027
086170                  ' WSKCS313-4600-'                               08617027
086180                      PV-OPER-UNT-ID-DISPLAY '-'                  08618027
086181                      PV-FCLTY-ID-DISPLAY    '-'                  08618127
086182                      PV-ORD-NBR-DISPLAY     '-'                  08618227
086190                      PV-REC-SEQ-NBR-DISPLAY '-'                  08619027
086191                      PV-ORD-LNE-NBR-DISPLAY                      08619127
086192                      '   BEFORE   '                              08619227
086193                      DELIMITED BY SIZE                           08619327
086194                 INTO PV-CICS-MSG-AREA                            08619427
086195         PERFORM 9990-WRITE-CICS                                  08619527
086196     END-IF                                                       08619627
086197                                                                  08619727
086200         EXEC CICS                                                08620000
086300              LINK PROGRAM  (PC-AUDIT-RTN)                        08630000
086400              COMMAREA      (RC031-FIELDS)                        08640000
086500              LENGTH        (PV-AUDIT-RTN-LENGTH)                 08650000
086600         END-EXEC                                                 08660000
086700*                                                                 08670000
086800         IF  RC031-CALL-SUCCESSFUL                                08680000
086900             CONTINUE                                             08690000
087000         ELSE                                                     08700000
087100             MOVE '4600-UPDATE-TRECITM'                           08710000
087200                                     TO DP013-PARAGRAPH           08720000
087300             MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECITM'    08730000
087400                                     TO DP013-MESSAGE-TEXT (1)    08740000
087500             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          08750000
087600             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         08760000
087700             MOVE DK-ORD-LNE-NBR     TO PV-ERROR-ORD-LNE-NBR      08770000
087800             STRING ' RCVR: '            DELIMITED BY SIZE        08780000
087900                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        08790000
088000                  '-'                    DELIMITED BY SIZE        08800000
088100                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        08810000
088200                  '  LINE: '             DELIMITED BY SIZE        08820000
088300                  PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE        08830000
088400                                   INTO DP013-MESSAGE-TEXT (2)    08840000
088500             STRING RC031-RETURN-CODE    DELIMITED BY SIZE        08850000
088600                  '-'                    DELIMITED BY SIZE        08860000
088700                  RC031-RETURN-DESC      DELIMITED BY SIZE        08870000
088800                  '  SQL CODE: '         DELIMITED BY SIZE        08880000
088900                  RC031-SQLCODE          DELIMITED BY SIZE        08890000
089000                                   INTO DP013-MESSAGE-TEXT (3)    08900000
089100             MOVE RC031-SQLCA        TO DP013-SQLCA               08910000
089200             MOVE 'TAURECI '         TO DP013-DB2-TABLE-NAME (1)  08920000
089300             SET DP013-DB2-ABEND     TO TRUE                      08930000
089400                                                                  08940000
089500             PERFORM Z999-ABEND                                   08950000
089600         END-IF.                                                  08960000
089700                                                                  08970000
089800/                                                                 08980000
089900******************************************************************08990000
090000*----------------------------------------------------------------*09000000
090100*    GET THE DATA.                                               *09010000
090200*     INSERT THE BEFORE ROW OF THE TRECEIV TABLE INTO THE        *09020000
090300*     RECEIV AUDIT TABLE.                                        *09030000
090400*     UPDATE THE CURRENT ROW                                     *09040000
090500*----------------------------------------------------------------*09050000
090600                                                                  09060000
090700 4700-UPDATE-TRECEIV-AUDIT.                                       09070000
090710     IF PS-SHOW-DEBUG-INFO                                        09071018
090720         STRING   ' ' PV-TASK-X                                   09072018
090730                ' WSKCS313-4700-UPDATE-TRECEIV-AUDIT   '          09073018
090740         DELIMITED BY SIZE                                        09074018
090750         INTO PV-CICS-MSG-AREA                                    09075018
090760         PERFORM 9990-WRITE-CICS                                  09076018
090770     END-IF.                                                      09077018
090780                                                                  09078018
090800                                                                  09080000
090900     IF PS-DATA-OK                                                09090000
091000         MOVE DK-ORD-NBR     TO RC031-PO-NBR                      09100000
091100         MOVE DK-REC-SEQ-NBR TO RC031-REC-SEQ-NBR                 09110000
091200         MOVE RECEIV-OPER-UNT-ID                                  09120000
091300                             TO RC031-OPER-UNT-ID                 09130000
091400         MOVE PV-FCLTY-ID    TO RC031-FCLTY-ID                    09140000
091500         MOVE PC-CURRENT-PROGRAM-NAME                             09150000
091600                             TO RC031-UPD-PGM-ID                  09160000
091700                                RC031-UPD-UID                     09170000
091800         MOVE PV-CURRENT-TIMESTAMP                                09180000
091900                             TO RC031-UPD-TMST                    09190000
092000         MOVE LENGTH OF RC031-FIELDS                              09200000
092100                             TO PV-AUDIT-RTN-LENGTH               09210000
092200*                                                                 09220000
092300         SET  RC031-AUDIT-TRECEIV                                 09230000
092400              RC031-BEFORE                                        09240000
092500              RC031-UPDATE   TO TRUE                              09250000
092600*                                                                 09260000
092700         EXEC CICS                                                09270000
092800              LINK PROGRAM  (PC-AUDIT-RTN)                        09280000
092900              COMMAREA      (RC031-FIELDS)                        09290000
093000              LENGTH        (PV-AUDIT-RTN-LENGTH)                 09300000
093100         END-EXEC                                                 09310000
093200*                                                                 09320000
093300         IF  RC031-CALL-SUCCESSFUL                                09330000
093400             CONTINUE                                             09340000
093500         ELSE                                                     09350000
093600             MOVE '4700-UPDATE-TRECEIV-AUDIT'                     09360000
093700                                     TO DP013-PARAGRAPH           09370000
093800             MOVE 'ERROR IN CALL TO AUDIT ROUTINE FOR TRECEIV'    09380000
093900                                     TO DP013-MESSAGE-TEXT (1)    09390000
094000             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          09400000
094100             MOVE DK-REC-SEQ-NBR TO PV-ERROR-RCVR-SEQ-NBR         09410000
094200             STRING ' RCVR: '            DELIMITED BY SIZE        09420000
094300                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        09430000
094400                  '-'                    DELIMITED BY SIZE        09440000
094500                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        09450000
094600                                   INTO DP013-MESSAGE-TEXT (2)    09460000
094700             STRING RC031-RETURN-CODE    DELIMITED BY SIZE        09470000
094800                  '-'                    DELIMITED BY SIZE        09480000
094900                  RC031-RETURN-DESC      DELIMITED BY SIZE        09490000
095000                  '  SQL CODE: '         DELIMITED BY SIZE        09500000
095100                  RC031-SQLCODE          DELIMITED BY SIZE        09510000
095200                                   INTO DP013-MESSAGE-TEXT (3)    09520000
095300             MOVE RC031-SQLCA        TO DP013-SQLCA               09530000
095400             MOVE 'TAURECV '         TO DP013-DB2-TABLE-NAME (1)  09540000
095500             SET DP013-DB2-ABEND     TO TRUE                      09550000
095600                                                                  09560000
095700             PERFORM Z999-ABEND                                   09570000
095800         END-IF                                                   09580000
095900     END-IF.                                                      09590000
096000                                                                  09600000
096100 4800-UPDATE-DISTHD.                                              09610000
096110     IF PS-SHOW-DEBUG-INFO                                        09611018
096120         STRING   ' ' PV-TASK-X                                   09612018
096130                ' WSKCS313-4800-UPDATE-DISTHD          '          09613018
096140         DELIMITED BY SIZE                                        09614018
096150         INTO PV-CICS-MSG-AREA                                    09615018
096160         PERFORM 9990-WRITE-CICS                                  09616018
096170     END-IF.                                                      09617018
096180                                                                  09618018
096200                                                                  09620000
096300         EXEC SQL                                                 09630000
096400              UPDATE TDISTHD                                      09640000
096500              SET    PRCG_STAT_CDE  =  :PC-V                      09650000
096600                    ,VRFD_TMST      =   CURRENT TIMESTAMP         09660000
096700              WHERE                                               09670000
096800                     ORD_NBR          =  :DK-ORD-NBR              09680000
096900*             AND    ORD_LNE_NBR      =  0                        09690004
097000              AND    RCVR_SEQ_NBR     =  :DK-REC-SEQ-NBR          09700000
097100         END-EXEC                                                 09710000
097200                                                                  09720000
097300         EVALUATE TRUE                                            09730000
097400             WHEN SQLCODE = ZERO                                  09740000
097500             WHEN SQLCODE = +100                                  09750000
097600                  CONTINUE                                        09760000
097700             WHEN SQLWARN0 NOT = SPACE                            09770000
097800             WHEN SQLCODE NOT = ZERO                              09780000
097900                  MOVE '4800-UPDATE-DISTHD'                       09790000
098000                                   TO DP013-PARAGRAPH             09800000
098100                  MOVE 'UPDATE TRANSACTION HEADER TABLE'          09810000
098200                                   TO DP013-MESSAGE-TEXT (1)      09820000
098300                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          09830000
098400                  MOVE DK-REC-SEQ-NBR                             09840000
098500                                   TO PV-ERROR-RCVR-SEQ-NBR       09850000
098600                  MOVE DK-ORD-LNE-NBR                             09860000
098700                                   TO PV-ERROR-ORD-LNE-NBR        09870000
098800                  STRING ' RCVR: '            DELIMITED BY SIZE   09880000
098900                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   09890000
099000                       '-'                    DELIMITED BY SIZE   09900000
099100                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   09910000
099200                       '  LINE: '             DELIMITED BY SIZE   09920000
099300                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   09930000
099400                                 INTO DP013-MESSAGE-TEXT (2)      09940000
099500                  MOVE 'TDISTHD '  TO DP013-DB2-TABLE-NAME (1)    09950000
099600                  MOVE SQLCA       TO DP013-SQLCA                 09960000
099700                  SET DP013-DB2-ABEND                             09970000
099800                                   TO TRUE                        09980000
099900                  PERFORM Z999-ABEND                              09990000
100000         END-EVALUATE.                                            10000000
100100 5000-UPDATE-TRECDIS.                                             10010000
100110     IF PS-SHOW-DEBUG-INFO                                        10011018
100120         STRING   ' ' PV-TASK-X                                   10012018
100130                ' WSKCS313-5000-UPDATE-TRECDIS         '          10013018
100140         DELIMITED BY SIZE                                        10014018
100150         INTO PV-CICS-MSG-AREA                                    10015018
100160         PERFORM 9990-WRITE-CICS                                  10016018
100170     END-IF.                                                      10017018
100171                                                                  10017127
100172     IF PS-SHOW-DEBUG-INFO                                        10017227
100175        MOVE DK-ORD-NBR          TO  PV-ORD-NBR-DISPLAY           10017527
100176        MOVE DK-REC-SEQ-NBR      TO  PV-REC-SEQ-NBR-DISPLAY       10017627
100177        MOVE RECDIS-ORD-LNE-NBR  TO  PV-ORD-LNE-NBR-DISPLAY       10017727
100178        MOVE RECDIS-STR-NBR      TO  PV-STORE-NBR-DISPLAY         10017827
100179         STRING   ' ' PV-TASK-X                                   10017927
100180                  ' WSKCS313-5000-'                               10018027
100183                      PV-ORD-NBR-DISPLAY     '-'                  10018327
100184                      PV-REC-SEQ-NBR-DISPLAY '-'                  10018427
100185                      PV-ORD-LNE-NBR-DISPLAY '-'                  10018527
100186                      PV-STORE-NBR-DISPLAY                        10018627
100187                      DELIMITED BY SIZE                           10018727
100188                 INTO PV-CICS-MSG-AREA                            10018827
100189         PERFORM 9990-WRITE-CICS                                  10018927
100190     END-IF                                                       10019027
100191                                                                  10019127
100192                                                                  10019218
100200         EXEC SQL                                                 10020000
100300              UPDATE TRECDIS                                      10030000
100400              SET    AP_VERIFY_ITM_QTY = :RC074-TOTAL-ACTL-ITM-QTY10040000
100500                    ,VERIFY_ITM_QTY    = :RC074-TOTAL-ACTL-ITM-QTY10050000
100600              WHERE                                               10060000
100700                     ORD_NBR          =  :DK-ORD-NBR              10070000
100800              AND    ORD_LNE_NBR      =  :RECDIS-ORD-LNE-NBR      10080000
100900              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          10090000
101100              AND    STR_NBR          =  :RECDIS-STR-NBR          10110000
101200         END-EXEC                                                 10120000
101300                                                                  10130000
101400         EVALUATE TRUE                                            10140000
101500             WHEN SQLCODE = ZERO                                  10150000
101600                  CONTINUE                                        10160000
101700             WHEN SQLWARN0 NOT = SPACE                            10170000
101800             WHEN SQLCODE NOT = ZERO                              10180000
101900                  MOVE '5000-UPDATE-TRECDIS'                      10190000
102000                                   TO DP013-PARAGRAPH             10200000
102100                  MOVE 'UPDATE RECEIPT DISTRIBUTION TABLE'        10210000
102200                                   TO DP013-MESSAGE-TEXT (1)      10220000
102300                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             10230000
102400                  MOVE DK-REC-SEQ-NBR                             10240000
102500                                   TO PV-ERROR-RCVR-SEQ-NBR       10250000
102600                  MOVE RECDIS-ORD-LNE-NBR                         10260000
102700                                   TO PV-ERROR-ORD-LNE-NBR        10270000
102800                  MOVE RECDIS-STR-NBR                             10280000
102900                                   TO PV-ERROR-STR-NBR            10290000
103000                  STRING ' RCVR: '            DELIMITED BY SIZE   10300000
103100                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   10310000
103200                       '-'                    DELIMITED BY SIZE   10320000
103300                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   10330000
103400                       '  LINE: '             DELIMITED BY SIZE   10340000
103500                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   10350000
103600                       '  STORE: '            DELIMITED BY SIZE   10360000
103700                       PV-ERROR-STR-NBR       DELIMITED BY SIZE   10370000
103800                                 INTO DP013-MESSAGE-TEXT (2)      10380000
103900                  MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (1)    10390000
104000                  MOVE SQLCA       TO DP013-SQLCA                 10400000
104100                  SET DP013-DB2-ABEND                             10410000
104200                                   TO TRUE                        10420000
104300                  PERFORM Z999-ABEND                              10430000
104400         END-EVALUATE.                                            10440000
104500                                                                  10450000
104600                                                                  10460000
104700 5100-UPDATE-TRECITM-ACTUAL.                                      10470000
104710     IF PS-SHOW-DEBUG-INFO                                        10471018
104720         STRING   ' ' PV-TASK-X                                   10472018
104730                ' WSKCS313-5100-UPDATE-TRECITM-ACTUAL  '          10473018
104740         DELIMITED BY SIZE                                        10474018
104750         INTO PV-CICS-MSG-AREA                                    10475018
104760         PERFORM 9990-WRITE-CICS                                  10476018
104770     END-IF.                                                      10477018
104780                                                                  10478018
104800                                                                  10480000
104900         EVALUATE TRUE                                            10490000
105000           WHEN RC289-VERIF-CHECK-IN                              10500000
105100                MOVE PC-CHECK-IN  TO PV-VRFD-USR-ID               10510000
105200           WHEN RC289-VERIF-TRLR-UNLOAD                           10520000
105300           WHEN RC289-VERIF-TRLR-UNLOAD-AT-0                      10530000
105400                MOVE PC-TRLRUNLD  TO PV-VRFD-USR-ID               10540000
105500           WHEN RC289-VERIF-HOT-COMPLETE                          10550000
105600           WHEN RC289-VERIF-HOT-COMPLETE-0                        10560000
105700                MOVE PC-WO-HOTCM  TO PV-VRFD-USR-ID               10570000
105800           WHEN RC289-VERIF-SWEEPER                               10580000
105900                MOVE PC-SWEEPER   TO PV-VRFD-USR-ID               10590000
106000           WHEN RC289-VERIF-P2L                                   10600000
106100                MOVE PC-P2L       TO PV-VRFD-USR-ID               10610000
106200           WHEN OTHER                                             10620000
106300                MOVE RC289-USER-ID TO PV-VRFD-USR-ID              10630000
106400         END-EVALUATE                                             10640000
106500                                                                  10650000
106510     IF PS-SHOW-DEBUG-INFO                                        10651027
106520***     MOVE RC031-OPER-UNT-ID   TO  PV-OPER-UNT-ID-DISPLAY       10652027
106530***     MOVE RC031-FCLTY-ID      TO  PV-FCLTY-ID-DISPLAY          10653027
106540        MOVE DK-ORD-NBR          TO  PV-ORD-NBR-DISPLAY           10654027
106550        MOVE DK-REC-SEQ-NBR      TO  PV-REC-SEQ-NBR-DISPLAY       10655027
106560        MOVE PV-PREV-ORD-LNE-NBR TO  PV-ORD-LNE-NBR-DISPLAY       10656027
106570***     MOVE RECDIS-STR-NBR      TO  PV-STORE-NBR-DISPLAY         10657027
106580         STRING   ' ' PV-TASK-X                                   10658027
106590                  ' WSKCS313-5100-'                               10659027
106591***                   PV-OPER-UNT-ID-DISPLAY '-'                  10659127
106592***                   PV-FCLTY-ID-DISPLAY    '-'                  10659227
106593                      PV-ORD-NBR-DISPLAY     '-'                  10659327
106594                      PV-REC-SEQ-NBR-DISPLAY '-'                  10659427
106595                      PV-ORD-LNE-NBR-DISPLAY                      10659527
106596***                   '   BEFORE   '                              10659627
106597                      DELIMITED BY SIZE                           10659727
106598                 INTO PV-CICS-MSG-AREA                            10659827
106599         PERFORM 9990-WRITE-CICS                                  10659927
106600     END-IF                                                       10660027
106601                                                                  10660127
106610                                                                  10661000
106700         EXEC SQL                                                 10670000
106800              UPDATE                                              10680000
106900                    TRECITM                                       10690000
107000              SET   STATUS_CDE        =  :PC-VE                   10700000
107100                   ,VERFYD_TMST       =   CURRENT TIMESTAMP       10710000
107200                   ,RCPT_DISTR_UPD_CDE = :PV-PREV-DISTR-UPD-CDE   10720000
107300                   ,VRFD_USR_ID        = :PV-VRFD-USR-ID          10730000
107400              WHERE                                               10740000
107500                     ORD_NBR          =  :DK-ORD-NBR              10750000
107600              AND    ORD_LNE_NBR      =  :PV-PREV-ORD-LNE-NBR     10760000
107700              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          10770000
107800              AND    VER_STATUS_CDE   =  :PC-A                    10780000
107900         END-EXEC                                                 10790000
108000                                                                  10800000
108100         EVALUATE TRUE                                            10810000
108200             WHEN SQLCODE = ZERO                                  10820000
108300                  CONTINUE                                        10830000
108400             WHEN SQLWARN0 NOT = SPACE                            10840000
108500             WHEN SQLCODE NOT = ZERO                              10850000
108600                  MOVE '5100-UPDATE-TRECITM-ACTUAL'               10860000
108700                                   TO DP013-PARAGRAPH             10870000
108800                  MOVE 'UPDATE TRECITM STATUS CODE'               10880000
108900                                   TO DP013-MESSAGE-TEXT (1)      10890000
109000                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             10900000
109100                  MOVE DK-REC-SEQ-NBR                             10910000
109200                                   TO PV-ERROR-RCVR-SEQ-NBR       10920000
109300                  MOVE DK-ORD-LNE-NBR                             10930000
109400                                   TO PV-ERROR-ORD-LNE-NBR        10940000
109500                  STRING ' RCVR: '            DELIMITED BY SIZE   10950000
109600                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   10960000
109700                       '-'                    DELIMITED BY SIZE   10970000
109800                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   10980000
109900                       '  LINE: '             DELIMITED BY SIZE   10990000
110000                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   11000000
110100                                 INTO DP013-MESSAGE-TEXT (2)      11010000
110200                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    11020000
110300                  MOVE SQLCA       TO DP013-SQLCA                 11030000
110400                  SET DP013-DB2-ABEND                             11040000
110500                                   TO TRUE                        11050000
110600                  PERFORM Z999-ABEND                              11060000
110700         END-EVALUATE.                                            11070000
110800                                                                  11080000
110900 5200-UPDATE-TRECEIV.                                             11090000
110910     IF PS-SHOW-DEBUG-INFO                                        11091018
110920         STRING   ' ' PV-TASK-X                                   11092018
110930                ' WSKCS313-5200-UPDATE-TRECEIV         '          11093018
110940         DELIMITED BY SIZE                                        11094018
110950         INTO PV-CICS-MSG-AREA                                    11095018
110960         PERFORM 9990-WRITE-CICS                                  11096018
110970     END-IF.                                                      11097018
110980                                                                  11098018
111000                                                                  11100000
111100         EVALUATE TRUE                                            11110000
111200           WHEN RC289-VERIF-CHECK-IN                              11120000
111300                MOVE PC-CHECK-IN  TO PV-VRFD-USR-ID               11130000
111400           WHEN RC289-VERIF-TRLR-UNLOAD                           11140000
111500           WHEN RC289-VERIF-TRLR-UNLOAD-AT-0                      11150000
111600                MOVE PC-TRLRUNLD  TO PV-VRFD-USR-ID               11160000
111700           WHEN RC289-VERIF-HOT-COMPLETE                          11170000
111800           WHEN RC289-VERIF-HOT-COMPLETE-0                        11180000
111810                MOVE PC-WO-HOTCM  TO PV-VRFD-USR-ID               11181000
111820           WHEN RC289-VERIF-SWEEPER                               11182000
111830                MOVE PC-SWEEPER   TO PV-VRFD-USR-ID               11183000
111840           WHEN RC289-VERIF-P2L                                   11184000
111850                MOVE PC-P2L       TO PV-VRFD-USR-ID               11185000
111860           WHEN OTHER                                             11186000
111870                MOVE RC289-USER-ID TO PV-VRFD-USR-ID              11187000
111880         END-EVALUATE                                             11188000
111890                                                                  11189000
111900                                                                  11190000
112000         EXEC SQL                                                 11200000
112100              UPDATE                                              11210000
112200                    TRECEIV                                       11220000
112300              SET   STATUS_CDE    =  :PC-VE                       11230000
112400                   ,VERFYD_TMST   =   CURRENT TIMESTAMP           11240000
112410                   ,ACTL_CART_CNT = :RECEIV-ACTL-CART-CNT         11241005
112500                   ,UPD_TMST      =   CURRENT TIMESTAMP           11250000
112600                   ,UPD_PGM_ID    =  :PC-CURRENT-PROGRAM-NAME     11260000
112700                   ,VRFD_USR_ID   =  :PV-VRFD-USR-ID              11270000
112710                   ,RCVG_CLERK_INIT_ID = :PC-WMS                  11271007
112800              WHERE                                               11280000
112900                     ORD_NBR      =  :DK-ORD-NBR                  11290000
113000              AND    REC_SEQ_NBR  =  :DK-REC-SEQ-NBR              11300000
113100              AND    VER_STATUS_CDE   =  :PC-A                    11310000
113200         END-EXEC                                                 11320000
113300                                                                  11330000
113400         EVALUATE TRUE                                            11340000
113500             WHEN SQLCODE = ZERO                                  11350000
113600                  CONTINUE                                        11360000
113700             WHEN SQLCODE NOT = ZERO                              11370000
113800                  MOVE '5200-UPDATE-TRECEIV'                      11380000
113900                                   TO DP013-PARAGRAPH             11390000
114000                  MOVE 'UPDATE TRECEIV STATUS CODE'               11400000
114100                                   TO DP013-MESSAGE-TEXT (1)      11410000
114200                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             11420000
114300                  MOVE DK-REC-SEQ-NBR                             11430000
114400                                   TO PV-ERROR-RCVR-SEQ-NBR       11440000
114500                  STRING ' RCVR: '            DELIMITED BY SIZE   11450000
114600                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   11460000
114700                       '-'                    DELIMITED BY SIZE   11470000
114800                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   11480000
114900                                 INTO DP013-MESSAGE-TEXT (2)      11490000
115000                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    11500000
115100                  MOVE SQLCA       TO DP013-SQLCA                 11510000
115200                  SET DP013-DB2-ABEND                             11520000
115300                                   TO TRUE                        11530000
115400                  PERFORM Z999-ABEND                              11540000
115500         END-EVALUATE.                                            11550000
115600                                                                  11560000
115700*                                                                 11570000
115800 EJECT                                                            11580000
115900*----------------------------------------------------------------*11590000
116000*    FIRST, SEE IF THERE ARE ANY ROWS LEFT THAT ARE NOT          *11600000
116100*    'VE' STATUS CODE.                                           *11610000
116200*----------------------------------------------------------------*11620000
116300 5300-COUNT-TRECITM-ROWS.                                         11630000
116310     IF PS-SHOW-DEBUG-INFO                                        11631018
116320         STRING   ' ' PV-TASK-X                                   11632018
116330                ' WSKCS313-5300-COUNT-TRECITM-ROWS     '          11633018
116340         DELIMITED BY SIZE                                        11634018
116350         INTO PV-CICS-MSG-AREA                                    11635018
116360         PERFORM 9990-WRITE-CICS                                  11636018
116370     END-IF.                                                      11637018
116380                                                                  11638018
116400                                                                  11640000
116500     MOVE ZERO            TO  PV-DB2-COUNT.                       11650000
116600         EXEC SQL                                                 11660000
116700              SELECT                                              11670000
116800                    COUNT(*)                                      11680000
116900              INTO                                                11690000
117000                    :PV-DB2-COUNT :PV-NULL-IND                    11700000
117100              FROM                                                11710000
117200                    TRECITM                                       11720000
117300              WHERE                                               11730000
117400                    ORD_NBR            =  :DK-ORD-NBR             11740000
117500              AND   REC_SEQ_NBR        =  :DK-REC-SEQ-NBR         11750000
117600              AND   STATUS_CDE     NOT IN ('VE', 'DE')            11760000
117700              AND   VER_STATUS_CDE     =  :PC-A                   11770000
117710             WITH UR                                              11771026
117800         END-EXEC                                                 11780000
117900                                                                  11790000
118000         EVALUATE TRUE                                            11800000
118100             WHEN SQLCODE = ZERO                                  11810000
118200             WHEN SQLCODE = +100                                  11820000
118300                  CONTINUE                                        11830000
118400             WHEN SQLWARN0 NOT = SPACE                            11840000
118500             WHEN SQLCODE NOT = ZERO                              11850000
118600                  MOVE '5300-COUNT-TRECITM-ROWS'                  11860000
118700                                   TO DP013-PARAGRAPH             11870000
118800                  MOVE 'COUNT NUMBER OF "VE" STATUS RECITM ROWS'  11880000
118900                                   TO DP013-MESSAGE-TEXT (1)      11890000
119000                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          11900000
119100                  MOVE DK-REC-SEQ-NBR                             11910000
119200                                   TO PV-ERROR-RCVR-SEQ-NBR       11920000
119300                  STRING ' RCVR: '            DELIMITED BY SIZE   11930000
119400                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   11940000
119500                       '-'                    DELIMITED BY SIZE   11950000
119600                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   11960000
119700                                 INTO DP013-MESSAGE-TEXT (2)      11970000
119800                  MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)    11980000
119900                  MOVE SQLCA       TO DP013-SQLCA                 11990000
120000                  SET DP013-DB2-ABEND                             12000000
120100                                   TO TRUE                        12010000
120200                  PERFORM Z999-ABEND                              12020000
120300         END-EVALUATE.                                            12030000
120400*----------------------------------------------------------------*12040000
120500*    UPDATE THE STATUS ON THE PURITM ROW.                        *12050000
120600*----------------------------------------------------------------*12060000
120700                                                                  12070000
120800 5400-PURITM-UPD-CHECK.                                           12080000
120820     IF PS-SHOW-DEBUG-INFO                                        12082018
120830         STRING   ' ' PV-TASK-X                                   12083018
120840                ' WSKCS313-5400-PURITM-UPD-CHECK       '          12084018
120850         DELIMITED BY SIZE                                        12085018
120860         INTO PV-CICS-MSG-AREA                                    12086018
120870         PERFORM 9990-WRITE-CICS                                  12087018
120880     END-IF.                                                      12088018
120890                                                                  12089018
120900                                                                  12090000
121000     MOVE ZERO                  TO  PURITM-UNT-QTY.               12100000
121100     PERFORM 5450-GET-PO-UNT-QTY.                                 12110000
121200     IF  PURITM-UNT-QTY GREATER THAN ZERO                         12120000
121300         MOVE ZERO              TO  RECDIS-AP-VERIFY-ITM-QTY      12130000
121400         PERFORM 5600-GET-RECDIS-QTY                              12140000
121500         IF  PURITM-UNT-QTY NOT GREATER RECDIS-AP-VERIFY-ITM-QTY  12150000
121600             PERFORM 5700-UPDATE-PURITM-PROCESS                   12160000
121700     END-IF.                                                      12170000
121800/                                                                 12180000
121900 5450-GET-PO-UNT-QTY.                                             12190000
121910     IF PS-SHOW-DEBUG-INFO                                        12191018
121920         STRING   ' ' PV-TASK-X                                   12192018
121930                ' WSKCS313-5450-GET-PO-UNT-QTY         '          12193018
121940         DELIMITED BY SIZE                                        12194018
121950         INTO PV-CICS-MSG-AREA                                    12195018
121960         PERFORM 9990-WRITE-CICS                                  12196018
121970     END-IF.                                                      12197018
121980                                                                  12198018
122000                                                                  12200000
122100       EXEC SQL                                                   12210000
122200            SELECT                                                12220000
122300                   B.UNT_QTY                                      12230000
122400             INTO                                                 12240000
122500                   :PURITM-UNT-QTY                                12250000
122600             FROM                                                 12260000
122700                   TPURCHS A                                      12270000
122800                 , TPURITM B                                      12280000
122900            WHERE                                                 12290000
123000                   A.PO_NBR            =  :DK-ORD-NBR             12300000
123100             AND   A.PO_NBR            =  B.PO_NBR                12310000
123200             AND   B.APP_PO_LNE_NBR    =  :DK-ORD-LNE-NBR         12320000
123300             AND   A.VER_STATUS_CDE    =  :PC-A                   12330000
123400             AND   B.VER_STATUS_CDE    =  :PC-A                   12340000
123410             WITH UR                                              12341026
123500       END-EXEC                                                   12350000
123600                                                                  12360000
123700       EVALUATE TRUE                                              12370000
123800           WHEN SQLCODE = ZERO                                    12380000
123900           WHEN SQLCODE = +100                                    12390000
124000                CONTINUE                                          12400000
124100           WHEN SQLCODE = -904                                    12410000
124200           WHEN SQLCODE = -911                                    12420000
124300           WHEN SQLCODE = -913                                    12430000
124400                CONTINUE                                          12440000
124500           WHEN SQLWARN0 NOT = SPACE                              12450000
124600           WHEN SQLCODE NOT = ZERO                                12460000
124700                MOVE '5450-GET-PO-UNT-QTY'                        12470000
124800                                 TO DP013-PARAGRAPH               12480000
124900                MOVE 'GET PO LINE UNIT QUANTITY'                  12490000
125000                                 TO DP013-MESSAGE-TEXT (1)        12500000
125100                MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR               12510000
125200                MOVE DK-ORD-LNE-NBR                               12520000
125300                                 TO PV-ERROR-ORD-LNE-NBR          12530000
125400                STRING ' PO: '              DELIMITED BY SIZE     12540000
125500                     PV-ERROR-ORD-NBR       DELIMITED BY SIZE     12550000
125600                     '  LINE: '             DELIMITED BY SIZE     12560000
125700                     PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE     12570000
125800                               INTO DP013-MESSAGE-TEXT (2)        12580000
125900                MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)      12590000
126000                MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (2)      12600000
126100                MOVE SQLCA       TO DP013-SQLCA                   12610000
126200                SET DP013-DB2-ABEND                               12620000
126300                                 TO TRUE                          12630000
126400                PERFORM Z999-ABEND                                12640000
126500       END-EVALUATE.                                              12650000
126600******************************************************************12660000
126700******************************************************************12670000
126800 5600-GET-RECDIS-QTY.                                             12680000
126810     IF PS-SHOW-DEBUG-INFO                                        12681018
126820         STRING   ' ' PV-TASK-X                                   12682018
126830                ' WSKCS313-5600-GET-RECDIS-QTY         '          12683018
126840         DELIMITED BY SIZE                                        12684018
126850         INTO PV-CICS-MSG-AREA                                    12685018
126860         PERFORM 9990-WRITE-CICS                                  12686018
126870     END-IF.                                                      12687018
126880                                                                  12688018
126900                                                                  12690000
127000       EXEC SQL                                                   12700000
127100            SELECT                                                12710000
127200                   SUM(C.AP_VERIFY_ITM_QTY)                       12720000
127300             INTO                                                 12730000
127400                   :RECDIS-AP-VERIFY-ITM-QTY :PV-NULL-IND         12740000
127500             FROM                                                 12750000
127600                   TRECEIV A                                      12760000
127700                 , TRECITM B                                      12770000
127800                 , TRECDIS C                                      12780000
127900             WHERE                                                12790000
128000                   A.ORD_NBR         =  :DK-ORD-NBR               12800000
128100              AND  A.ORD_NBR         =  B.ORD_NBR                 12810000
128200              AND  A.ORD_NBR         =  C.ORD_NBR                 12820000
128300              AND  B.ORD_LNE_NBR     =  :DK-ORD-LNE-NBR           12830000
128400              AND  B.ORD_LNE_NBR     =  C.ORD_LNE_NBR             12840000
128500              AND  A.VER_STATUS_CDE  =  :PC-A                     12850000
128600              AND  B.VER_STATUS_CDE  =  :PC-A                     12860000
128800              AND  B.STATUS_CDE      =  :PC-VE                    12880000
128900              AND  A.REC_SEQ_NBR     =  B.REC_SEQ_NBR             12890000
129000              AND  A.REC_SEQ_NBR     =  C.REC_SEQ_NBR             12900000
129010             WITH UR                                              12901025
129100       END-EXEC                                                   12910000
129200                                                                  12920000
129300       EVALUATE TRUE                                              12930000
129400           WHEN SQLCODE = ZERO                                    12940000
129500           WHEN SQLCODE = +100                                    12950000
129600                CONTINUE                                          12960000
129700           WHEN SQLWARN0 NOT = SPACE                              12970000
129800           WHEN SQLCODE NOT = ZERO                                12980000
129900                MOVE '5600-GET-RECDIS-QTY'                        12990000
130000                                 TO DP013-PARAGRAPH               13000000
130100                MOVE 'SUM RECDIS VERIFY QUANTITY'                 13010000
130200                                 TO DP013-MESSAGE-TEXT (1)        13020000
130300                MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR               13030000
130400                MOVE DK-ORD-LNE-NBR                               13040000
130500                                 TO PV-ERROR-ORD-LNE-NBR          13050000
130600                STRING ' PO: '              DELIMITED BY SIZE     13060000
130700                     PV-ERROR-ORD-NBR       DELIMITED BY SIZE     13070000
130800                     '  LINE: '             DELIMITED BY SIZE     13080000
130900                     PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE     13090000
131000                               INTO DP013-MESSAGE-TEXT (2)        13100000
131100                MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)      13110000
131200                MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (2)      13120000
131300                MOVE 'TRECDIS '  TO DP013-DB2-TABLE-NAME (3)      13130000
131400                MOVE SQLCA       TO DP013-SQLCA                   13140000
131500                SET DP013-DB2-ABEND                               13150000
131600                                 TO TRUE                          13160000
131700                PERFORM Z999-ABEND                                13170000
131800       END-EVALUATE.                                              13180000
131900*----------------------------------------------------------------*13190000
132000*    UPDATE THE STATUS ON THE PURCHASE ITEM ROW                  *13200000
132100*----------------------------------------------------------------*13210000
132200                                                                  13220000
132300 5700-UPDATE-PURITM-PROCESS.                                      13230000
132310     IF PS-SHOW-DEBUG-INFO                                        13231018
132320         STRING   ' ' PV-TASK-X                                   13232018
132330                ' WSKCS313-5700-UPDATE-PURITM-PROCESS  '          13233018
132340         DELIMITED BY SIZE                                        13234018
132350         INTO PV-CICS-MSG-AREA                                    13235018
132360         PERFORM 9990-WRITE-CICS                                  13236018
132370     END-IF.                                                      13237018
132380                                                                  13238018
132400                                                                  13240000
132500     PERFORM 5750-GET-PURITM.                                     13250000
132600     IF  SQLCODE EQUAL ZERO                                       13260000
132700             IF PURITM-STATUS-CDE = PC-AC OR PC-AP                13270000
132800                 PERFORM 5800-UPDATE-PURITM-VERIFY                13280000
132900             END-IF                                               13290000
133000     END-IF.                                                      13300000
133100                                                                  13310000
133200*----------------------------------------------------------------*13320000
133300*    HERE, WE CHECK IF ALL PURCHASE ITEM LINES ARE EQUAL TO      *13330000
133400*    'CM' 'CB' OR 'CA' AND THE PURCHASE ORDER HEADER IS EQUAL    *13340000
133500*    TO 'AP' OR 'AC'.  IF SO, UPDATE THE PURCHASE ORDER HEADER   *13350000
133600*    TO A STATUS OF 'CM'.                                        *13360000
133700*----------------------------------------------------------------*13370000
133800                                                                  13380000
133900 5750-GET-PURITM.                                                 13390000
133910     IF PS-SHOW-DEBUG-INFO                                        13391018
133920         STRING   ' ' PV-TASK-X                                   13392018
133930                ' WSKCS313-5750-GET-PURITM             '          13393018
133940         DELIMITED BY SIZE                                        13394018
133950         INTO PV-CICS-MSG-AREA                                    13395018
133960         PERFORM 9990-WRITE-CICS                                  13396018
133970     END-IF.                                                      13397018
133980                                                                  13398018
134000                                                                  13400000
134100     INITIALIZE DCLTPURITM.                                       13410000
134200                                                                  13420000
134300         EXEC SQL                                                 13430000
134400              SELECT                                              13440000
134500                      STATUS_CDE                                  13450000
134600               INTO                                               13460000
134700                      :PURITM-STATUS-CDE                          13470000
134800               FROM                                               13480000
134900                      TPURITM                                     13490000
135000              WHERE                                               13500000
135100                      PO_NBR             =  :DK-ORD-NBR           13510000
135200               AND    APP_PO_LNE_NBR     =  :RECDIS-ORD-LNE-NBR   13520000
135300               AND    VER_STATUS_CDE     =  :PC-A                 13530000
135310               WITH UR                                            13531026
135400         END-EXEC                                                 13540000
135500                                                                  13550000
135600         EVALUATE TRUE                                            13560000
135700             WHEN SQLCODE = ZERO                                  13570000
135800             WHEN SQLCODE = +100                                  13580000
135900                  CONTINUE                                        13590000
136000             WHEN SQLWARN0 NOT = SPACE                            13600000
136100             WHEN SQLCODE NOT = ZERO                              13610000
136200                  MOVE '5750-GET-PURITM'                          13620000
136300                                   TO DP013-PARAGRAPH             13630000
136400                  MOVE 'SELECT TPURITM            '               13640000
136500                                   TO DP013-MESSAGE-TEXT (1)      13650000
136600                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             13660000
136700                  MOVE RECDIS-ORD-LNE-NBR                         13670000
136800                                   TO PV-ERROR-ORD-LNE-NBR        13680000
136900                  STRING ' PO: '              DELIMITED BY SIZE   13690000
137000                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   13700000
137100                       '  LINE: '             DELIMITED BY SIZE   13710000
137200                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   13720000
137300                                 INTO DP013-MESSAGE-TEXT (2)      13730000
137400                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    13740000
137500                  MOVE SQLCA       TO DP013-SQLCA                 13750000
137600                  SET DP013-DB2-ABEND                             13760000
137700                                   TO TRUE                        13770000
137800                  PERFORM Z999-ABEND                              13780000
137900         END-EVALUATE.                                            13790000
138000/                                                                 13800000
138100 5800-UPDATE-PURITM-VERIFY.                                       13810000
138110     IF PS-SHOW-DEBUG-INFO                                        13811018
138120         STRING   ' ' PV-TASK-X                                   13812018
138130                ' WSKCS313-5800-UPDATE-PURITM-VERIFY   '          13813018
138140         DELIMITED BY SIZE                                        13814018
138150         INTO PV-CICS-MSG-AREA                                    13815018
138160         PERFORM 9990-WRITE-CICS                                  13816018
138170     END-IF.                                                      13817018
138180                                                                  13818018
138200                                                                  13820000
138300         EXEC SQL                                                 13830000
138400              UPDATE                                              13840000
138500                     TPURITM                                      13850000
138600              SET    STATUS_CDE   =  :PC-CM                       13860000
138700                   , STAT_TMST    =  CURRENT TIMESTAMP            13870000
138800              WHERE                                               13880000
138900                     PO_NBR           =  :DK-ORD-NBR              13890000
139000              AND    APP_PO_LNE_NBR   =  :RECDIS-ORD-LNE-NBR      13900000
139100              AND    VER_STATUS_CDE   =  :PC-A                    13910000
139200         END-EXEC                                                 13920000
139300                                                                  13930000
139400         EVALUATE TRUE                                            13940000
139500             WHEN SQLCODE = ZERO                                  13950000
139600                  CONTINUE                                        13960000
139700             WHEN SQLWARN0 NOT = SPACE                            13970000
139800             WHEN SQLCODE NOT = ZERO                              13980000
139900                  MOVE '5800-UPDATE-PURITM-VERIFY'                13990000
140000                                   TO DP013-PARAGRAPH             14000000
140100                  MOVE 'SET STATUS TO "CM" COMPLETE'              14010000
140200                                   TO DP013-MESSAGE-TEXT (1)      14020000
140300                  MOVE DK-ORD-NBR TO PV-ERROR-ORD-NBR             14030000
140400                  MOVE RECDIS-ORD-LNE-NBR                         14040000
140500                                   TO PV-ERROR-ORD-LNE-NBR        14050000
140600                  STRING ' PO: '              DELIMITED BY SIZE   14060000
140700                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   14070000
140800                       '  LINE: '             DELIMITED BY SIZE   14080000
140900                       PV-ERROR-ORD-LNE-NBR   DELIMITED BY SIZE   14090000
141000                                 INTO DP013-MESSAGE-TEXT (2)      14100000
141100                  MOVE 'TPURITM '  TO DP013-DB2-TABLE-NAME (1)    14110000
141200                  MOVE SQLCA       TO DP013-SQLCA                 14120000
141300                  SET DP013-DB2-ABEND                             14130000
141400                                   TO TRUE                        14140000
141500                  PERFORM Z999-ABEND                              14150000
141600         END-EVALUATE.                                            14160000
141700/                                                                 14170000
141800                                                                  14180000
141900 6000-UPDATE-UNITS-WRKD.                                          14190000
141910     IF PS-SHOW-DEBUG-INFO                                        14191018
141920         STRING   ' ' PV-TASK-X                                   14192018
141930                ' WSKCS313-6000-UPDATE-UNITS-WRKD      '          14193018
141940         DELIMITED BY SIZE                                        14194018
141950         INTO PV-CICS-MSG-AREA                                    14195018
141960         PERFORM 9990-WRITE-CICS                                  14196018
141970     END-IF.                                                      14197018
141980                                                                  14198018
142000* THIS WILL CALL PCKCS756 WHICH WILL UPDATE THE TABLES FOR UNITS  14200000
142100* WORKED OR VERIFIED                                              14210000
142200     EXEC SQL                                                     14220000
142300         SET :PV-CURRENT-TMST =  CURRENT_TIMESTAMP                14230000
142400     END-EXEC.                                                    14240000
142500                                                                  14250000
142600     MOVE PV-CURRENT-TMST             TO PC238-WRKD-TMST.         14260000
142700     MOVE PC-A                        TO PC238-VERIFY-TYPE-CDE.   14270000
142800     MOVE LENGTH OF PC238-COMM-AREA   TO PV-COMMAREA-LENGTH.      14280000
142900                                                                  14290000
143000     EXEC CICS                                                    14300000
143100         LINK                                                     14310000
143200             PROGRAM   (PC-UNTS-WRKD-PGRM-NAME)                   14320000
143300             COMMAREA  (PC238-COMM-AREA)                          14330000
143400             LENGTH    (PV-COMMAREA-LENGTH)                       14340000
143500             RESP      (PV-CICS-RESPONSE)                         14350000
143600     END-EXEC.                                                    14360000
143700                                                                  14370000
143800     EVALUATE TRUE                                                14380000
143900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 14390000
144000              EVALUATE TRUE                                       14400000
144100                  WHEN PC238-MOD-SUCCESSFUL                       14410000
144200                       CONTINUE                                   14420000
144300                 WHEN PC238-MOD-UNSUCCESSFUL                      14430000
144400                     PERFORM 6100-MOD-UNSUCCESSFUL                14440000
144500             END-EVALUATE                                         14450000
144600                                                                  14460000
144700         WHEN OTHER                                               14470000
144800             STRING ' WSKCS313 - '      DELIMITED BY SIZE         14480000
144900                    ' 6000-UPDATE-UNITS-WRKD '                    14490000
145000                                        DELIMITED BY SIZE         14500000
145100                    ' KEY INFO - '      DELIMITED BY SIZE         14510000
145200                    PC-DISPLAY-PO       DELIMITED BY SIZE         14520000
145300                    ' - '               DELIMITED BY SIZE         14530000
145400                    PC-DISPLAY-RCVR     DELIMITED BY SIZE         14540000
145500                    ' - '               DELIMITED BY SIZE         14550000
145600                    PC-DISPLAY-LINE     DELIMITED BY SIZE         14560000
145700                                  INTO PV-CICS-MSG-AREA           14570000
145800             MOVE LENGTH OF PV-CICS-MSG-AREA                      14580000
145900                                   TO PV-COMMAREA-LENGTH          14590000
146000             PERFORM 9990-WRITE-CICS                              14600000
146100             PERFORM Z900-SOFT-ABORT                              14610000
146200     END-EVALUATE.                                                14620000
146300/                                                                 14630000
146400/                                                                 14640000
146500 6100-MOD-UNSUCCESSFUL.                                           14650000
146510     IF PS-SHOW-DEBUG-INFO                                        14651018
146520         STRING   ' ' PV-TASK-X                                   14652018
146530                ' WSKCS313-6100-MOD-UNSUCCESSFUL       '          14653018
146540         DELIMITED BY SIZE                                        14654018
146550         INTO PV-CICS-MSG-AREA                                    14655018
146560         PERFORM 9990-WRITE-CICS                                  14656018
146570     END-IF.                                                      14657018
146580                                                                  14658018
146600                                                                  14660000
146700     MOVE PC238-PO-NBR              TO PC-DISPLAY-PO.             14670000
146800     MOVE PC238-RCVR-SEQ-NBR        TO PC-DISPLAY-RCVR.           14680000
146900     MOVE PC238-PO-LNE-NBR          TO PC-DISPLAY-LINE.           14690000
147000     MOVE PC238-WRKD-OPER-UNT-ID    TO PC-DISPLAY-OPER.           14700000
147100     MOVE PC238-BAD-SQL-CDE         TO PC-DISPLAY-SQL-CODE        14710000
147200                                       SQLCODE.                   14720000
147300      SET PS-UPDATES-DONE           TO TRUE.                      14730000
147400                                                                  14740000
147500     IF  PC238-MOD-BAD-TMST                                       14750000
147600         STRING ' WSKCS313 - '      DELIMITED BY SIZE             14760000
147700                ' 6000-UPDATE-UNITS-WRKD '                        14770000
147800                                    DELIMITED BY SIZE             14780000
147900                ' BAD TIMESTAMP '   DELIMITED BY SIZE             14790000
148000                PC238-WRKD-TMST     DELIMITED BY SIZE             14800000
148100                             INTO PV-CICS-MSG-AREA                14810000
148200         MOVE LENGTH OF PV-CICS-MSG-AREA                          14820000
148300                               TO PV-COMMAREA-LENGTH              14830000
148400         PERFORM 9990-WRITE-CICS                                  14840000
148500         STRING ' WSKCS313 - '      DELIMITED BY SIZE             14850000
148600                ' 6000-UPDATE-UNITS-WRKD '                        14860000
148700                                    DELIMITED BY SIZE             14870000
148800                ' KEY INFO - '      DELIMITED BY SIZE             14880000
148900                PC-DISPLAY-PO       DELIMITED BY SIZE             14890000
149000                ' - '               DELIMITED BY SIZE             14900000
149100                PC-DISPLAY-RCVR     DELIMITED BY SIZE             14910000
149200                ' - '               DELIMITED BY SIZE             14920000
149300                PC-DISPLAY-LINE     DELIMITED BY SIZE             14930000
149400                             INTO PV-CICS-MSG-AREA                14940000
149500         MOVE LENGTH OF PV-CICS-MSG-AREA                          14950000
149600                               TO PV-COMMAREA-LENGTH              14960000
149700         PERFORM 9990-WRITE-CICS                                  14970000
149800         PERFORM Z900-SOFT-ABORT                                  14980000
149900     ELSE                                                         14990000
150000     IF  PC238-MOD-BAD-OPER                                       15000000
150100         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15010000
150200                ' 6000-UPDATE-UNITS-WRKD '                        15020000
150300                                    DELIMITED BY SIZE             15030000
150400                ' BAD OPER UNIT '   DELIMITED BY SIZE             15040000
150500                PC-DISPLAY-OPER     DELIMITED BY SIZE             15050000
150600                             INTO PV-CICS-MSG-AREA                15060000
150700         MOVE LENGTH OF PV-CICS-MSG-AREA                          15070000
150800                               TO PV-COMMAREA-LENGTH              15080000
150900         PERFORM 9990-WRITE-CICS                                  15090000
151000         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15100000
151100                ' 6000-UPDATE-UNITS-WRKD '                        15110000
151200                                    DELIMITED BY SIZE             15120000
151300                ' KEY INFO - '      DELIMITED BY SIZE             15130000
151400                PC-DISPLAY-PO       DELIMITED BY SIZE             15140000
151500                ' - '               DELIMITED BY SIZE             15150000
151600                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15160000
151700                ' - '               DELIMITED BY SIZE             15170000
151800                PC-DISPLAY-LINE     DELIMITED BY SIZE             15180000
151900                             INTO PV-CICS-MSG-AREA                15190000
152000         MOVE LENGTH OF PV-CICS-MSG-AREA                          15200000
152100                               TO PV-COMMAREA-LENGTH              15210000
152200         PERFORM 9990-WRITE-CICS                                  15220000
152300         PERFORM Z900-SOFT-ABORT                                  15230000
152400     ELSE                                                         15240000
152500     IF  PC238-MOD-BAD-TRANS-TYPE                                 15250000
152600         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15260000
152700                ' 6000-UPDATE-UNITS-WRKD '                        15270000
152800                                    DELIMITED BY SIZE             15280000
152900                ' BAD TRAN TYPE '   DELIMITED BY SIZE             15290000
153000                PC238-TRANS-TYPE-CDE                              15300000
153100                                    DELIMITED BY SIZE             15310000
153200                             INTO PV-CICS-MSG-AREA                15320000
153300         MOVE LENGTH OF PV-CICS-MSG-AREA                          15330000
153400                               TO PV-COMMAREA-LENGTH              15340000
153500         PERFORM 9990-WRITE-CICS                                  15350000
153600         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15360000
153700                ' 6000-UPDATE-UNITS-WRKD '                        15370000
153800                                    DELIMITED BY SIZE             15380000
153900                ' KEY INFO - '      DELIMITED BY SIZE             15390000
154000                PC-DISPLAY-PO       DELIMITED BY SIZE             15400000
154100                ' - '               DELIMITED BY SIZE             15410000
154200                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15420000
154300                ' - '               DELIMITED BY SIZE             15430000
154400                PC-DISPLAY-LINE     DELIMITED BY SIZE             15440000
154500                             INTO PV-CICS-MSG-AREA                15450000
154600         MOVE LENGTH OF PV-CICS-MSG-AREA                          15460000
154700                               TO PV-COMMAREA-LENGTH              15470000
154800         PERFORM 9990-WRITE-CICS                                  15480000
154900         PERFORM Z900-SOFT-ABORT                                  15490000
155000     ELSE                                                         15500000
155100     IF  PC238-MOD-BAD-PO                                         15510000
155200         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15520000
155300                ' 6000-UPDATE-UNITS-WRKD '                        15530000
155400                                    DELIMITED BY SIZE             15540000
155500                ' BAD PO NUMBER '   DELIMITED BY SIZE             15550000
155600                PC-DISPLAY-PO       DELIMITED BY SIZE             15560000
155700                             INTO PV-CICS-MSG-AREA                15570000
155800         MOVE LENGTH OF PV-CICS-MSG-AREA                          15580000
155900                               TO PV-COMMAREA-LENGTH              15590000
156000         PERFORM 9990-WRITE-CICS                                  15600000
156100         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15610000
156200                ' 6000-UPDATE-UNITS-WRKD '                        15620000
156300                                    DELIMITED BY SIZE             15630000
156400                ' KEY INFO - '      DELIMITED BY SIZE             15640000
156500                PC-DISPLAY-PO       DELIMITED BY SIZE             15650000
156600                ' - '               DELIMITED BY SIZE             15660000
156700                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15670000
156800                ' - '               DELIMITED BY SIZE             15680000
156900                PC-DISPLAY-LINE     DELIMITED BY SIZE             15690000
157000                             INTO PV-CICS-MSG-AREA                15700000
157100         MOVE LENGTH OF PV-CICS-MSG-AREA                          15710000
157200                               TO PV-COMMAREA-LENGTH              15720000
157300         PERFORM 9990-WRITE-CICS                                  15730000
157400         PERFORM Z900-SOFT-ABORT                                  15740000
157500     ELSE                                                         15750000
157600     IF  PC238-MOD-BAD-RCVR                                       15760000
157700         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15770000
157800                ' 6000-UPDATE-UNITS-WRKD '                        15780000
157900                                    DELIMITED BY SIZE             15790000
158000                ' BAD RCVR NBR  '   DELIMITED BY SIZE             15800000
158100                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15810000
158200                             INTO PV-CICS-MSG-AREA                15820000
158300         MOVE LENGTH OF PV-CICS-MSG-AREA                          15830000
158400                               TO PV-COMMAREA-LENGTH              15840000
158500         PERFORM 9990-WRITE-CICS                                  15850000
158600         STRING ' WSKCS313 - '      DELIMITED BY SIZE             15860000
158700                ' 6000-UPDATE-UNITS-WRKD '                        15870000
158800                                    DELIMITED BY SIZE             15880000
158900                ' KEY INFO - '      DELIMITED BY SIZE             15890000
159000                PC-DISPLAY-PO       DELIMITED BY SIZE             15900000
159100                ' - '               DELIMITED BY SIZE             15910000
159200                PC-DISPLAY-RCVR     DELIMITED BY SIZE             15920000
159300                ' - '               DELIMITED BY SIZE             15930000
159400                PC-DISPLAY-LINE     DELIMITED BY SIZE             15940000
159500                             INTO PV-CICS-MSG-AREA                15950000
159600         MOVE LENGTH OF PV-CICS-MSG-AREA                          15960000
159700                               TO PV-COMMAREA-LENGTH              15970000
159800         PERFORM 9990-WRITE-CICS                                  15980000
159900         PERFORM Z900-SOFT-ABORT                                  15990000
160000     ELSE                                                         16000000
160100     IF  PC238-MOD-BAD-LINE                                       16010000
160200         STRING ' WSKCS313 - '      DELIMITED BY SIZE             16020000
160300                ' 6000-UPDATE-UNITS-WRKD '                        16030000
160400                                    DELIMITED BY SIZE             16040000
160500                ' BAD LINE NBR  '   DELIMITED BY SIZE             16050000
160600                PC-DISPLAY-LINE     DELIMITED BY SIZE             16060000
160700                             INTO PV-CICS-MSG-AREA                16070000
160800         MOVE LENGTH OF PV-CICS-MSG-AREA                          16080000
160900                               TO PV-COMMAREA-LENGTH              16090000
161000         PERFORM 9990-WRITE-CICS                                  16100000
161100         STRING ' WSKCS313 - '      DELIMITED BY SIZE             16110000
161200                ' 6000-UPDATE-UNITS-WRKD '                        16120000
161300                                    DELIMITED BY SIZE             16130000
161400                ' KEY INFO - '      DELIMITED BY SIZE             16140000
161500                PC-DISPLAY-PO       DELIMITED BY SIZE             16150000
161600                ' - '               DELIMITED BY SIZE             16160000
161700                PC-DISPLAY-RCVR     DELIMITED BY SIZE             16170000
161800                ' - '               DELIMITED BY SIZE             16180000
161900                PC-DISPLAY-LINE     DELIMITED BY SIZE             16190000
162000                             INTO PV-CICS-MSG-AREA                16200000
162100         MOVE LENGTH OF PV-CICS-MSG-AREA                          16210000
162200                               TO PV-COMMAREA-LENGTH              16220000
162300         PERFORM 9990-WRITE-CICS                                  16230000
162400         PERFORM Z900-SOFT-ABORT                                  16240000
162500     ELSE                                                         16250000
162600     IF  PC238-MOD-BAD-NO-SHIFT                                   16260000
162700         STRING ' WSKCS313 - '      DELIMITED BY SIZE             16270000
162800                ' 6000-UPDATE-UNITS-WRKD '                        16280000
162900                                    DELIMITED BY SIZE             16290000
163000                ' SHIFT NOT FOUND ' DELIMITED BY SIZE             16300000
163100                PC238-WRKD-TMST     DELIMITED BY SIZE             16310000
163200                ' FOR OPER '        DELIMITED BY SIZE             16320000
163300                PC-DISPLAY-OPER     DELIMITED BY SIZE             16330000
163400                             INTO PV-CICS-MSG-AREA                16340000
163500         MOVE LENGTH OF PV-CICS-MSG-AREA                          16350000
163600                               TO PV-COMMAREA-LENGTH              16360000
163700         PERFORM 9990-WRITE-CICS                                  16370000
163800         STRING ' WSKCS313 - '      DELIMITED BY SIZE             16380000
163900                ' 6000-UPDATE-UNITS-WRKD '                        16390000
164000                                    DELIMITED BY SIZE             16400000
164100                ' KEY INFO - '      DELIMITED BY SIZE             16410000
164200                PC-DISPLAY-PO       DELIMITED BY SIZE             16420000
164300                ' - '               DELIMITED BY SIZE             16430000
164400                PC-DISPLAY-RCVR     DELIMITED BY SIZE             16440000
164500                ' - '               DELIMITED BY SIZE             16450000
164600                PC-DISPLAY-LINE     DELIMITED BY SIZE             16460000
164700                             INTO PV-CICS-MSG-AREA                16470000
164800         MOVE LENGTH OF PV-CICS-MSG-AREA                          16480000
164900                               TO PV-COMMAREA-LENGTH              16490000
165000         PERFORM 9990-WRITE-CICS                                  16500000
165100         PERFORM Z900-SOFT-ABORT                                  16510000
165200     ELSE                                                         16520000
165300         STRING ' WSKCS313 - '      DELIMITED BY SIZE             16530000
165400                ' 6000-UPDATE-UNITS-WRKD '                        16540000
165500                                    DELIMITED BY SIZE             16550000
165600                ' DB ERROR - SQL CODE '                           16560000
165700                                    DELIMITED BY SIZE             16570000
165800                PC-DISPLAY-SQL-CODE DELIMITED BY SIZE             16580000
165900                ' FUNC: '           DELIMITED BY SIZE             16590000
166000                PC238-BAD-TABLE-FUNCTION                          16600000
166100                                    DELIMITED BY SIZE             16610000
166200                ' TABLE: '          DELIMITED BY SIZE             16620000
166300                PC238-BAD-TABLE-NAME                              16630000
166400                                    DELIMITED BY SIZE             16640000
166500                             INTO PV-CICS-MSG-AREA                16650000
166600         MOVE LENGTH OF PV-CICS-MSG-AREA                          16660000
166700                               TO PV-COMMAREA-LENGTH              16670000
166800         PERFORM 9990-WRITE-CICS                                  16680000
166900         STRING ' WSKCS313 - '      DELIMITED BY SIZE             16690000
167000                ' 6000-UPDATE-UNITS-WRKD '                        16700000
167100                                    DELIMITED BY SIZE             16710000
167200                ' KEY INFO - '      DELIMITED BY SIZE             16720000
167300                PC-DISPLAY-PO       DELIMITED BY SIZE             16730000
167400                ' - '               DELIMITED BY SIZE             16740000
167500                PC-DISPLAY-RCVR     DELIMITED BY SIZE             16750000
167600                ' - '               DELIMITED BY SIZE             16760000
167700                PC-DISPLAY-LINE     DELIMITED BY SIZE             16770000
167800                             INTO PV-CICS-MSG-AREA                16780000
167900         MOVE LENGTH OF PV-CICS-MSG-AREA                          16790000
168000                               TO PV-COMMAREA-LENGTH              16800000
168100         PERFORM 9990-WRITE-CICS                                  16810000
168200         PERFORM Z900-SOFT-ABORT                                  16820000
168300     END-IF                                                       16830000
168400     END-IF                                                       16840000
168500     END-IF                                                       16850000
168600     END-IF                                                       16860000
168700     END-IF                                                       16870000
168800     END-IF                                                       16880000
168900     END-IF.                                                      16890000
169000                                                                  16900000
172800                                                                  17280000
172801 6200-LINK-TO-FRASTY-HANDLER.                                     17280114
172802     IF PS-SHOW-DEBUG-INFO                                        17280218
172803         STRING   ' ' PV-TASK-X                                   17280318
172804                ' WSKCS313-6200-LINK-TO-FRASTY-HANDLER '          17280418
172805         DELIMITED BY SIZE                                        17280518
172806         INTO PV-CICS-MSG-AREA                                    17280618
172807         PERFORM 9990-WRITE-CICS                                  17280718
172808     END-IF.                                                      17280818
172809                                                                  17280918
172810                                                                  17281014
172811     INITIALIZE SU044-COMM-AREA.                                  17281114
172812     MOVE DK-ORD-NBR               TO SU044-PO.                   17281214
172813     MOVE DK-REC-SEQ-NBR           TO SU044-ORIG-REC-SEQ-NBR.     17281314
172814     MOVE RECEIV-CURR-OPER-UNT-ID  TO SU044-OPER-UNT-ID.          17281414
172815     MOVE 1                        TO SU044-FCLTY-ID.             17281514
172816     MOVE PC-CURRENT-PROGRAM-NAME  TO SU044-PROGRAM-NAME.         17281614
172817     SET  SU044-SRC-VERIFICATION   TO TRUE.                       17281714
172818*                                                                 17281817
172819*** 6/30/14 - DMH BEGIN                                           17281917
172820*    SET  SU044-RCVR-PBS           TO TRUE.                       17282017
172821*    MOVE RECDIS-STR-NBR           TO SU044-DEST-STR-NBR.         17282117
172822                                                                  17282219
172831     IF  RECEIV-PACK-BY-ST-IND     =  'Y'                         17283123
172832         SET  SU044-RCVR-PBS       TO TRUE                        17283217
172833         MOVE RECDIS-STR-NBR       TO SU044-DEST-STR-NBR          17283317
172834     ELSE                                                         17283417
172835         IF  RECEIV-PKGNG-CDE   =  'B'  OR                        17283523
172836             RECEIV-PKGNG-CDE   =  'C'                            17283623
172837             SET  SU044-RCVR-BULK  TO  TRUE                       17283719
172838         ELSE                                                     17283819
172839             IF  RECEIV-PKGNG-CDE   = 'M'  OR                     17283923
172840                 RECEIV-PKGNG-CDE   = 'I'                         17284024
172841                 SET  SU044-RCVR-PREPK  TO  TRUE                  17284123
172842             END-IF                                               17284223
172843         END-IF                                                   17284323
172844     END-IF.                                                      17284423
172845                                                                  17284523
172846     IF PS-SHOW-DEBUG-INFO                                        17284623
172847         STRING   ' ' PV-TASK-X                                   17284723
172848                ' WSKCS313-6200 RC289:' RC289-PACKAGE-TYPE-CDE    17284823
172849         DELIMITED BY SIZE                                        17284923
172850         INTO PV-CICS-MSG-AREA                                    17285023
172851         PERFORM 9990-WRITE-CICS                                  17285123
172852         STRING   ' ' PV-TASK-X                                   17285223
172853                ' WSKCS313-6200 SU044:' SU044-RCVR-TYPE-CDE       17285323
172854         DELIMITED BY SIZE                                        17285423
172855         INTO PV-CICS-MSG-AREA                                    17285523
172856         PERFORM 9990-WRITE-CICS                                  17285623
172857         STRING   ' ' PV-TASK-X                                   17285723
172858                ' WSKCS313-6200 RCVR: ' RECEIV-PKGNG-CDE          17285823
172859                                    ' ' RECEIV-PACK-BY-ST-IND     17285923
172860         DELIMITED BY SIZE                                        17286023
172861         INTO PV-CICS-MSG-AREA                                    17286123
172862         PERFORM 9990-WRITE-CICS                                  17286223
172863     END-IF.                                                      17286323
172864                                                                  17286423
172865*** 6/30/14 - DMH END                                             17286523
172866*                                                                 17286623
172867                                                                  17286723
172868     MOVE LENGTH OF SU044-COMM-AREA TO  PV-COMMAREA-LENGTH.       17286823
172869                                                                  17286923
172870     EXEC CICS                                                    17287023
172871         LINK PROGRAM  (PC-FA-HANDLER-PGM)                        17287123
172872              COMMAREA (SU044-COMM-AREA)                          17287223
172873              LENGTH   (PV-COMMAREA-LENGTH)                       17287323
172874     END-EXEC.                                                    17287423
172875                                                                  17287523
172876                                                                  17287623
172877     EVALUATE TRUE                                                17287723
172878         WHEN SU044-SUCCESSFUL                                    17287823
172879              CONTINUE                                            17287923
172880                                                                  17288023
172881         WHEN OTHER                                               17288123
172882             MOVE '6200-LINK-TO-FRASTY-HANDLER'                   17288223
172883                                  TO DP013-PARAGRAPH              17288323
172884             STRING ' SUCCESS IND = '                             17288423
172885                    SU044-SUCCESS-IND                             17288523
172886                         DELIMITED BY SIZE                        17288623
172887                                INTO DP013-MESSAGE-TEXT (1)       17288723
172888             MOVE SQLCA           TO DP013-SQLCA                  17288823
172889             SET DP013-DB2-ABEND     TO TRUE                      17288923
172890                                                                  17289023
172891             PERFORM Z999-ABEND                                   17289123
172892     END-EVALUATE.                                                17289223
172893                                                                  17289323
172894 6201-CHECK-FOR-FRASTY-HANDLING.                                  17289423
172895     IF PS-SHOW-DEBUG-INFO                                        17289523
172896         STRING   ' ' PV-TASK-X                                   17289623
172897                ' WSKCS313-6201-CHECK-FOR-FRASTY-HANDLING '       17289723
172898         DELIMITED BY SIZE                                        17289823
172899         INTO PV-CICS-MSG-AREA                                    17289923
172900         PERFORM 9990-WRITE-CICS                                  17290023
172901     END-IF.                                                      17290123
172902                                                                  17290223
172903     EXEC SQL                                                     17290323
172904         SELECT FUNC_TXT                                          17290423
172905           INTO :KRPRPM-FUNC-TXT                                  17290523
172906           FROM TKRPRPM                                           17290623
172907          WHERE SYS_PRC_FUNC_CDE  = 'FRASTY'                      17290723
172908            AND INTFC_SYS_CDE     = 'KHL'                         17290823
172909            AND FUNC_PRC_STAT_CDE = 'AC'                          17290923
172910            AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP            17291023
172911            AND FUNC_END_TMST     >= CURRENT TIMESTAMP            17291123
172912            AND LOC_ID            = :RECEIV-CURR-OPER-UNT-ID      17291223
172913            WITH UR                                               17291326
172914     END-EXEC.                                                    17291423
172915                                                                  17291523
172916     EVALUATE TRUE                                                17291623
172917         WHEN SQLCODE = ZERO                                      17291723
172918            IF KRPRPM-FUNC-TXT = 'Y'                              17291823
172919                SET  PS-FRASTY               TO TRUE              17291923
172920            END-IF                                                17292023
172921         WHEN OTHER                                               17292123
172922           MOVE SPACES TO PV-CICS-MSG-AREA                        17292223
172923     END-EVALUATE.                                                17292323
172924                                                                  17292423
172925                                                                  17292523
172926 6500-CALL-PO-RCVR-TRKING-MOD.                                    17292623
172927     IF PS-SHOW-DEBUG-INFO                                        17292723
172930         STRING   ' ' PV-TASK-X                                   17293018
172940                ' WSKCS313-6500-CALL-PO-RCVR-TRKING-MOD   '       17294018
172950         DELIMITED BY SIZE                                        17295018
172960         INTO PV-CICS-MSG-AREA                                    17296018
172970         PERFORM 9990-WRITE-CICS                                  17297018
172980     END-IF.                                                      17298018
172990                                                                  17299018
173000                                                                  17300000
173100     INITIALIZE RC071-FIELDS.                                     17310000
173200     MOVE RC289-ORD-NBR             TO RC071-PO-NBR               17320000
173300     MOVE RC289-RCVR-SEQ-NBR        TO RC071-PO-RCVR              17330000
173400     MOVE ZEROES                    TO RC071-PO-LINE              17340000
173500                                       RC071-PREPK-ID.            17350000
173600                                                                  17360000
173700     MOVE RECEIV-CURR-OPER-UNT-ID   TO RC071-SIGNON-LOCATION      17370000
173800     MOVE RC289-USER-ID             TO RC071-USER-ID              17380000
173900     MOVE RC289-CALLING-PROGRAM     TO RC071-CALLING-PROGRAM      17390000
173910     SET  RC289-VERIF-TRLR-UNLOAD   TO TRUE                       17391002
174000     MOVE RC289-DC-FUNCTION-CODE    TO RC071-DC-FUNCTION-CODE     17400000
174100     IF RC074-TOTAL-ACTL-ITM-QTY = 0                              17410000
174200        EVALUATE TRUE                                             17420000
174300          WHEN RC071-VERIF-TRLR-UNLOAD                            17430000
174400            SET RC071-VERIF-TRLR-UNLOAD-AT-0 TO TRUE              17440000
174500          WHEN RC071-VERIF-HOT-COMPLETE                           17450000
174600            SET RC071-VERIF-HOT-COMPLETE-0   TO TRUE              17460000
174700        END-EVALUATE                                              17470000
174800     END-IF                                                       17480000
174900                                                                  17490000
175000     MOVE LENGTH OF RC071-FIELDS    TO PV-COMMAREA-LENGTH.        17500000
175100                                                                  17510000
175200     CALL RC071-PO-RCVR-TRACKING USING  DFHEIBLK                  17520000
175300                                        RC071-COMMAREA            17530000
175400                                        RC071-FIELDS.             17540000
175500                                                                  17550000
175600     EVALUATE TRUE                                                17560000
175700       WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                   17570000
175800          IF RC071-SUCCESSFUL                                     17580000
175900             CONTINUE                                             17590000
176000          ELSE                                                    17600000
176100             MOVE '6500-CALL-PO-RCVR-TRKING-MOD'                  17610000
176200                                     TO DP013-PARAGRAPH           17620000
176300             MOVE RC289-ORD-NBR      TO PV-ERROR-ORD-NBR          17630000
176400             MOVE RC289-RCVR-SEQ-NBR  TO PV-ERROR-RCVR-SEQ-NBR    17640000
176500             MOVE RECEIV-CURR-OPER-UNT-ID  TO                     17650000
176600                                        PV-ERROR-OPER-UNT-ID      17660000
176700                                        PV-OPER-UNT-ID-DISPLAY    17670000
176800             MOVE DK-ORD-LNE-NBR     TO PV-ORD-LNE-NBR-DISPLAY    17680000
176900             STRING ' WSKCS313-RC137'   DELIMITED BY SIZE         17690002
177000                    ' RCVR: '           DELIMITED BY SIZE         17700000
177100                    PV-ERROR-ORD-NBR    DELIMITED BY SIZE         17710000
177200                    '-'                 DELIMITED BY SIZE         17720000
177300                    PV-ERROR-RCVR-SEQ-NBR                         17730000
177400                                        DELIMITED BY SIZE         17740000
177500                    '  LINE: '          DELIMITED BY SIZE         17750000
177600                    PV-ORD-LNE-NBR-DISPLAY                        17760000
177700                                        DELIMITED BY SIZE         17770000
177800                    '  FCLTY: '         DELIMITED BY SIZE         17780000
177900                    PV-OPER-UNT-ID-DISPLAY                        17790000
178000                                        DELIMITED BY SIZE         17800000
178100                           INTO PV-CICS-MSG-AREA                  17810000
178200             PERFORM 9990-WRITE-CICS                              17820000
178300             STRING ' OPER: '            DELIMITED BY SIZE        17830000
178400                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        17840000
178500                    ' RCVR: '            DELIMITED BY SIZE        17850000
178600                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        17860000
178700                  '-'                    DELIMITED BY SIZE        17870000
178800                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        17880000
178900                  ' IND: '               DELIMITED BY SIZE        17890000
179000                  RC071-SUCCESS-IND      DELIMITED BY SIZE        17900000
179100                                   INTO DP013-MESSAGE-TEXT (1)    17910000
179200*            SET DP013-XCTL-DISPLAY-RESTART                       17920003
179300*                DP013-DB2-ABEND     TO TRUE                      17930003
179400                                                                  17940000
179500*            PERFORM Z999-ABEND                                   17950003
179600          END-IF                                                  17960000
179700     END-EVALUATE.                                                17970000
179800                                                                  17980000
179900                                                                  17990000
180050                                                                  18005018
180051                                                                  18005118
180060 9300-CHECK-LOGGING.                                              18006000
180100     EXEC SQL                                                     18010000
180200         SELECT FUNC_TXT                                          18020000
180300           INTO :KRPRPM-FUNC-TXT                                  18030000
180400           FROM TKRPRPM                                           18040000
180500          WHERE SYS_PRC_FUNC_CDE  = 'PC780D'                      18050000
180510            AND LOC_ID            = 90                            18051000
180520            AND INTFC_SYS_CDE     = 'KHL'                         18052000
180530            AND FUNC_PRC_STAT_CDE = 'AC'                          18053000
180531           WITH UR                                                18053126
180540     END-EXEC.                                                    18054000
180550                                                                  18055000
180560     EVALUATE TRUE                                                18056000
180570         WHEN SQLCODE = ZERO                                      18057000
180580              MOVE KRPRPM-FUNC-TXT  TO  PS-SHOW-DEBUG-SW          18058018
180590         WHEN OTHER                                               18059000
180591           MOVE SPACES TO PV-CICS-MSG-AREA                        18059100
180592     END-EVALUATE.                                                18059200
180593                                                                  18059300
180594                                                                  18059400
180595                                                                  18059500
180596/                                                                 18059600
180597 9990-WRITE-CICS.                                                 18059700
180598*!                                                                18059800
180599     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-CLENG.                 18059900
180600*!                                                                18060000
180700     EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA)     18070000
180800          LENGTH(PV-CLENG) NOHANDLE                               18080000
180900     END-EXEC.                                                    18090000
181000                                                                  18100000
181100     MOVE SPACES TO PV-CICS-MSG-AREA.                             18110000
181200*                                                                 18120000
181300                                                                  18130000
181400 9995-WRITE-CICS-FOR-DEBUG.                                       18140000
181500     IF KRPRPM-FUNC-TXT = 'Y'                                     18150000
181600         MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-CLENG              18160000
181700         EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA) 18170000
181800              LENGTH(PV-CLENG) NOHANDLE                           18180000
181810         END-EXEC                                                 18181000
181820         MOVE SPACES TO PV-CICS-MSG-AREA                          18182000
181830     END-IF.                                                      18183000
181840*                                                                 18184000
181850 9100-SYNCPOINT.                                                  18185000
181860                                                                  18186000
181870     EXEC CICS                                                    18187000
181880         SYNCPOINT                                                18188000
181890     END-EXEC.                                                    18189000
181900                                                                  18190000
182000******************************************************************18200000
182100*   STANDARD ABEND ROUTINE                                        18210000
182200* ==> PROCESSES:                                                  18220000
182300*   - ISSUES THE ABEND.                                           18230000
182400******************************************************************18240000
182500 Z999-ABEND.                                                      18250000
182600     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           18260000
182700     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          18270000
182800     INITIALIZE DP013-SRC-TASK-NUMBER                             18280000
182900                DP013-STACK.                                      18290000
183000     SET DP013-LINK-RETURN TO TRUE.                               18300000
183100     SET DP013-ROLLBACK    TO TRUE.                               18310000
183200                                                                  18320000
183300     EXEC CICS                                                    18330000
183400         LINK                                                     18340000
183500             PROGRAM  (DP013-NAME)                                18350000
183600             COMMAREA (DP013-PARAMETERS)                          18360000
183700             LENGTH   (DP013-LENGTH)                              18370000
183800     END-EXEC.                                                    18380000
183900                                                                  18390000
184000                                                                  18400000
184100     EXEC CICS                                                    18410000
184200         RETURN                                                   18420000
184300     END-EXEC.                                                    18430000
184400                                                                  18440000
184500******************************************************************18450000
184600*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *18460000
184700*    AND THE ERROR SWITCHES.                                     *18470000
184800******************************************************************18480000
184900 Z900-SOFT-ABORT.                                                 18490000
185000     SET PS-ERROR         TO TRUE.                                18500000
185100     IF PS-UPDATES-DONE AND SQLCODE = -913                        18510000
185200        PERFORM Z901-BACKUP                                       18520000
185300     END-IF.                                                      18530000
185400                                                                  18540000
185500     MOVE 'PROGRAM EXIT CALL' TO DP013-MESSAGE-TEXT (1).          18550000
185600                                                                  18560000
185700 Z901-BACKUP.                                                     18570000
185800     EXEC CICS SYNCPOINT                                          18580000
185900          ROLLBACK                                                18590000
186000     END-EXEC.                                                    18600000
186100                                                                  18610000
