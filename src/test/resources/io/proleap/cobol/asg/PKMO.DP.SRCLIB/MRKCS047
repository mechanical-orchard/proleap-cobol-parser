000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    MRKCS047.                                         00040000
000500 AUTHOR.        KOHLS DEPARTMENT STORES.                          00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  11-15-93.                                         00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000*---------------------------------------------------------------* 00100000
001100*    Y047 - MR-SKUS FOR A PTAG                                  * 00110001
001200*                                                               * 00120000
001300*    THIS PROGRAM GENERATES A LIST OF ALL SKUS FOR A            * 00130001
001400*    SPECIFIC PTAG.                                             * 00140001
002000*---------------------------------------------------------------* 00200000
002010******************************************************************00201006
002020* 08/09/01 - THERESE RAMSEYER - COMPUWARE   WR #21601            *00202006
002030*    - UPDATED PROGRAM FOR CHANGEOVER TO NI-SKU.                 *00203006
002040*    - INCREASED LENGTH OF DEPT, CLASS, AND SKU. ADDED SUBCLASS. *00204006
002060*    - ADDED TSKXREF TABLE TO SQL STATEMENTS WHEN NECCESSARY     *00206006
002070*    - ELIMINATED WORKING STORAGE VARIABLES AND PARAGRAPHS FROM  *00207006
002080*      THE TEMPLATE THAT WERE NEVER REFERENCED.                  *00208006
002090*    - ELIMINATED SOME DOCUMENTATION THAT REFERRED TO THE        *00209006
002091*      SYSTEM MESSAGE SCREEN TEMPLATE, NOT THE CURRENT PROGRAM.  *00209106
002092*    - ADDED STANDARD RETRY LOGIC TO 4310- FETCH.                *00209220
002093******************************************************************00209306
262436* CHANGED 10/12/2021    BY JIM HUNTER      WR: CHG0262436         00209426
262436* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00209526
262436* MAKING THE CALL DYNAMIC VS STATIC.                              00209626
262436******************************************************************00209726
CICS  * CHANGED 10/28/2022    BY JIM HUNTER      WR: CHG0277420         00209828
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00209928
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00210028
CICS  ******************************************************************00210128
002100 EJECT                                                            00211000
002200 ENVIRONMENT DIVISION.                                            00220000
002300                                                                  00230000
002400 DATA DIVISION.                                                   00240000
002500                                                                  00250000
002600 WORKING-STORAGE SECTION.                                         00260000
004400                                                                  00440000
004500 01  PC-PROGRAM-CONSTANTS.                                        00450000
004600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00460000
004700                                                    'MR047A  '.   00470000
004800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00480000
004900                                                    'MRKM047 '.   00490000
005000     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00500000
005100                                                    'MRKCS047'.   00510000
005200     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00520000
005300     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00530000
005400     05  PC-BY-SKU-REQUEST              PIC  X(01)  VALUE '1'.    00540000
005500     05  PC-BY-STORE-REQUEST            PIC  X(01)  VALUE '2'.    00550000
005600     05  PC-BY-PTAG-REQUEST             PIC  X(01)  VALUE '3'.    00560000
005700     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00570000
005800     05  PC-INTER-APPL-LIST             PIC  X(01)  VALUE '2'.    00580000
005900     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00590000
006000                                                    COMP SYNC.    00600000
006100     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00610000
006200                                                    COMP SYNC.    00620000
006300     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         00630000
006400                                                    +1000000      00640000
006500                                                    COMP-3.       00650000
006600     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00660000
006700                                                    COMP SYNC.    00670000
006800     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00680000
006900                                                    COMP-3.       00690000
007000     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    00700000
007100     05  PC-INQ                         PIC  X(03)  VALUE 'INQ'.  00710000
007200     05  PC-UPD                         PIC  X(03)  VALUE 'UPD'.  00720000
007300     05  PC-DEL                         PIC  X(03)  VALUE 'DEL'.  00730000
007400     05  PC-ERR                         PIC  X(03)  VALUE 'ERR'.  00740000
007500*                                                                 00750000
007600     05  PC-TSYMSG-NUMBERS.                                       00760000
007700         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00770000
007800         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  00780000
007900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00790000
008000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  00800000
008100         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00810000
008200         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00820000
008300         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00830000
008400         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00840000
008500         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00850000
008600         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00860000
008700         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00870000
008800         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00880000
008900         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00890000
009000         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00900000
009100         10  PC-TSYMSG-00146            PIC  9(05)  VALUE 00146.  00910000
009200         10  PC-TSYMSG-00148            PIC  9(05)  VALUE 00148.  00920000
009300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00930000
009400         10  PC-TSYMSG-00696            PIC  9(05)  VALUE 00696.  00940000
009500         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  00950000
009600*                                                                 00960000
009700 01  PS-PROGRAM-SWITCHES.                                         00970000
009800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00980000
009900         88  PS-NO-ERROR                            VALUE 'Y'.    00990000
010000         88  PS-ERROR                               VALUE 'N'.    01000000
010100     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01010000
010200         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01020000
010300         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01030000
010400     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01040000
010500         88  PS-DONE                                VALUE 'Y'.    01050000
010600         88  PS-NOT-DONE                            VALUE 'N'.    01060000
010700     05  PS-USE-WILDCARD-SW             PIC  X(01)  VALUE 'N'.    01070000
010800         88  PS-USE-WILDCARD                        VALUE 'Y'.    01080000
010900*                                                                 01090000
011000 01  PV-PROGRAM-VARIABLES.                                        01100000
011100     05  PV-DEPT-NUMBER-S               PIC S9(04)V COMP-3.       01110002
011200     05  PV-DEPT-NUMBER                 PIC  9(04).               01120002
011300     05  PV-DEPT-X         REDEFINES                              01130002
011400         PV-DEPT-NUMBER                 PIC  X(04).               01140002
011500     05  PV-DEPT-93                     PIC  9(03).               01150002
011600     05  PV-DEPT-X3                     PIC  X(03).               01160002
011700     05  PV-CLASS-NUMBER                PIC  9(04).               01170002
011800     05  PV-CLASS-X        REDEFINES                              01180002
011900         PV-CLASS-NUMBER                PIC  X(04).               01190002
012000     05  PV-SUBCLASS-NUMBER             PIC  9(04).               01200002
012100     05  PV-SUBCLASS-X     REDEFINES                              01210002
012110         PV-SUBCLASS-NUMBER             PIC  X(04).               01211002
012120     05  PV-SUBCLASS-X3                 PIC  X(03).               01212002
012130     05  PV-SKU-NUMBER-S                PIC S9(08)V COMP-3.       01213002
012140     05  PV-SKU-NUMBER                  PIC  9(08).               01214002
012170     05  PV-CLASS-X2                    PIC  X(02).               01217002
012200     05  PV-PTAG                        PIC  X(07).               01220000
012900     05  PV-SUB                         PIC S9(04)  VALUE +0      01290000
013000                                                    COMP SYNC.    01300000
013100     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01310000
013200                                                    COMP SYNC.    01320000
013300     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01330000
013400                                                    COMP-3.       01340000
013500     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01350000
013600                                                    COMP-3.       01360000
013700     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01370000
013800                                                    COMP-3.       01380000
013900     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01390000
014000                                                    COMP-3.       01400000
014100     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01410000
014200                                                    COMP-3.       01420000
014300     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01430000
014400                                                    COMP-3.       01440000
014500     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01450000
014600                                                    COMP-3.       01460000
014700     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01470000
014800                                                    COMP SYNC.    01480000
014900     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01490000
015000                                                    COMP SYNC.    01500000
015100     05  PV-ITEM                        PIC S9(04)  VALUE +0      01510000
015200                                                    COMP SYNC.    01520000
015300     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01530000
015400                                                    COMP SYNC.    01540000
015500     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01550000
015600                                                    COMP SYNC.    01560000
015700     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01570000
015800                                                    COMP SYNC.    01580000
015900     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01590000
016000                                                    COMP SYNC.    01600000
016100     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01610000
016200                                                    COMP SYNC.    01620000
016300     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01630000
016400                                                    COMP SYNC.    01640000
016500     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01650000
016600                                                    COMP SYNC.    01660000
016700     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01670000
016800                                                    COMP SYNC.    01680000
016900     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01690000
017000                                                    COMP SYNC.    01700000
017100     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01710000
017200                                                    COMP SYNC.    01720000
017300     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01730000
017400                                                    COMP SYNC.    01740000
017500     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01750000
017600                                                    COMP SYNC.    01760000
017700     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01770000
017800                                                    COMP SYNC.    01780000
017900******************************************************************01790000
018000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01800000
018100**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **01810000
018200**  APPLICATION-SPECIFIC COMMAREA.                              **01820000
018300******************************************************************01830000
018400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01840000
018500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01850000
018600     05  LQW-ITEM-ENTRIES               OCCURS 15 TIMES           01860000
018700                                        INDEXED BY LQW-IDX.       01870000
018800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)   COMP-3.      01880000
018900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01890000
019000         10  LQW-SELECTED-SW            PIC  X(01).               01900000
019100             88  LQW-SELECT                         VALUE 'S'.    01910000
019200             88  LQW-DESELECT                       VALUE ' '.    01920000
019300         10  LQW-ACTION                 PIC  X(03).               01930000
019400         10  LQW-PTAG                   PIC  X(07).               01940000
019500         10  LQW-DEPT                   PIC  9(03).               01950001
019510         10  LQW-CLASS                  PIC  9(02).               01951001
019520         10  LQW-SCLASS                 PIC  9(02).               01952001
019530         10  LQW-SKU                    PIC  9(08).               01953001
019600         10  LQW-DESCRIPTION            PIC  X(23).               01960004
019700         10  LQW-SIZE                   PIC  X(05).               01970000
019800         10  LQW-COLOR                  PIC  X(04).               01980000
019900                                                                  01990000
020000                                                                  02000000
020100     EJECT                                                        02010000
020200*---------------------------------------------------------------* 02020000
020300*  RECORD LAYOUT FOR THE SELECTION TEMP STORAGE QUEUE.          * 02030017
020400*---------------------------------------------------------------* 02040000
020500                                                                  02050000
020600     COPY MRWS115.                                                02060000
020700                                                                  02070000
020800     EJECT                                                        02080000
020900*---------------------------------------------------------------* 02090000
021000*    MAP LAYOUT                                                 * 02100000
021100*---------------------------------------------------------------* 02110000
021200                                                                  02120000
021300     COPY MRKM047.                                                02130000
021400*                                                                 02140000
021500 01  MR-OCCURS-LAYOUT                   REDEFINES  MR047AO.       02150000
021600     05  FILLER                         PIC X(44).                02160000
021700     05  MR-SCROLL-AREA                 OCCURS 15 TIMES.          02170000
021800         10  MR-SELECTL                 PIC S9(04) COMP.          02180000
021900         10  MR-SELECTA                 PIC  X(01).               02190000
022000         10  MR-SELECTC                 PIC  X(01).               02200000
022100         10  MR-SELECTH                 PIC  X(01).               02210000
022200         10  MR-SELECTI                 PIC  X(01).               02220000
022300                                                                  02230000
022400         10  MR-ACTIONL                 PIC S9(04) COMP.          02240000
022500         10  MR-ACTIONA                 PIC  X(01).               02250000
022600         10  MR-ACTIONC                 PIC  X(01).               02260000
022700         10  MR-ACTIONH                 PIC  X(01).               02270000
022800         10  MR-ACTION                  PIC  X(03).               02280000
022900                                                                  02290000
023000         10  MR-PTAGL                   PIC S9(04) COMP.          02300000
023100         10  MR-PTAGA                   PIC  X(01).               02310000
023200         10  MR-PTAGC                   PIC  X(01).               02320000
023300         10  MR-PTAGH                   PIC  X(01).               02330000
023400         10  MR-PTAG                    PIC X(07).                02340000
023500                                                                  02350000
023600         10  MR-DEPTL                   PIC S9(04) COMP.          02360001
023700         10  MR-DEPTA                   PIC  X(01).               02370001
023800         10  MR-DEPTC                   PIC  X(01).               02380001
023900         10  MR-DEPTH                   PIC  X(01).               02390001
024000         10  MR-DEPT                    PIC  X(03).               02400001
024010                                                                  02401001
024020         10  MR-CLASSL                  PIC S9(04) COMP.          02402001
024030         10  MR-CLASSA                  PIC  X(01).               02403001
024040         10  MR-CLASSC                  PIC  X(01).               02404001
024050         10  MR-CLASSH                  PIC  X(01).               02405001
024060         10  MR-CLASS                   PIC  X(02).               02406001
024070                                                                  02407001
024080         10  MR-SCLASSL                 PIC S9(04) COMP.          02408001
024090         10  MR-SCLASSA                 PIC  X(01).               02409001
024091         10  MR-SCLASSC                 PIC  X(01).               02409101
024092         10  MR-SCLASSH                 PIC  X(01).               02409201
024093         10  MR-SCLASS                  PIC  X(02).               02409301
024094                                                                  02409401
024095         10  MR-SKUL                    PIC S9(04) COMP.          02409501
024096         10  MR-SKUA                    PIC  X(01).               02409601
024097         10  MR-SKUC                    PIC  X(01).               02409701
024098         10  MR-SKUH                    PIC  X(01).               02409801
024099         10  MR-SKU                     PIC  X(08).               02409901
024100                                                                  02410000
024200         10  MR-DESCRIPTIONL            PIC S9(04) COMP.          02420000
024300         10  MR-DESCRIPTIONA            PIC  X(01).               02430000
024400         10  MR-DESCRIPTIONC            PIC  X(01).               02440000
024500         10  MR-DESCRIPTIONH            PIC  X(01).               02450000
024600         10  MR-DESCRIPTION             PIC  X(23).               02460004
024700                                                                  02470000
024800         10  MR-SIZEL                   PIC S9(04) COMP.          02480000
024900         10  MR-SIZEA                   PIC  X(01).               02490000
025000         10  MR-SIZEC                   PIC  X(01).               02500000
025100         10  MR-SIZEH                   PIC  X(01).               02510000
025200         10  MR-SIZE                    PIC  X(05).               02520000
025300                                                                  02530000
025400         10  MR-COLORL                  PIC S9(04) COMP.          02540000
025500         10  MR-COLORA                  PIC  X(01).               02550000
025600         10  MR-COLORC                  PIC  X(01).               02560000
025700         10  MR-COLORH                  PIC  X(01).               02570000
025800         10  MR-COLOR                   PIC  X(04).               02580000
025900     EJECT                                                        02590000
026000*---------------------------------------------------------------* 02600000
026100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02610000
026200*---------------------------------------------------------------* 02620000
026300                                                                  02630000
026400     COPY DPWS015.                                                02640000
026500                                                                  02650000
026600*---------------------------------------------------------------* 02660000
026700*    FUNCTION KEYS COPYBOOK.                                    * 02670000
026800*---------------------------------------------------------------* 02680000
026900                                                                  02690000
027000     COPY DPWS016.                                                02700000
027100                                                                  02710000
027200*---------------------------------------------------------------* 02720000
027300*    NUMERIC EDIT LAYOUT.                                       * 02730000
027400*---------------------------------------------------------------* 02740000
027500                                                                  02750000
027600     COPY DPWS010I.                                               02760000
027700 EJECT                                                            02770000
027800*---------------------------------------------------------------* 02780000
027900*    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02790028
028000*---------------------------------------------------------------* 02800000
028100                                                                  02810000
028200     COPY DPWS030.                                                02820000
CICS       COPY DPWS930.                                                02821028
028300 EJECT                                                            02830000
028400*---------------------------------------------------------------* 02840000
028500*    STANDARD COMMAREA.                                         * 02850000
028600*---------------------------------------------------------------* 02860000
028700                                                                  02870000
028800     COPY DPWS020.                                                02880000
028900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02890000
029000                                                                  02900000
029100*---------------------------------------------------------------* 02910000
029200* INTER-APPLICATION COMMAREA.                                   * 02920000
029300*   MRWS114 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02930000
029400*             SPEC SCREEN.                                      * 02940000
029500*   MRWS102 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02950000
029600*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02960000
029700*---------------------------------------------------------------* 02970000
029800                                                                  02980000
029900         10  INTER-APPL-COMM-AREA       PIC X(200).               02990000
030000     COPY MRWS114.                                                03000000
030100     COPY MRWS102.                                                03010000
030200*---------------------------------------------------------------* 03020000
030300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03030000
030400*---------------------------------------------------------------* 03040000
030500         10  ASC-SPECIFIC-COMMAREA.                               03050000
030600             15  ASC-LIST-KEYS.                                   03060000
030700                 20  ASC-KEY-DEPT-N                  PIC  9(04).  03070001
030800                 20  ASC-KEY-DEPT          REDEFINES              03080001
030900                     ASC-KEY-DEPT-N                  PIC  X(04).  03090001
030910                 20  ASC-KEY-CLASS-N                 PIC  9(04).  03091001
030920                 20  ASC-KEY-CLASS         REDEFINES              03092001
030930                     ASC-KEY-CLASS-N                 PIC  X(04).  03093001
030940                 20  ASC-KEY-SUBCLASS-N              PIC  9(04).  03094001
030950                 20  ASC-KEY-SUBCLASS      REDEFINES              03095001
030960                     ASC-KEY-SUBCLASS-N              PIC  X(04).  03096001
030970                 20  ASC-KEY-SKU-N                   PIC  9(08).  03097001
030980                 20  ASC-KEY-SKU           REDEFINES              03098001
030990                     ASC-KEY-SKU-N                   PIC  X(08).  03099001
031000                 20  ASC-KEY-PTAG                    PIC  X(07).  03100000
031100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03110000
031200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03120000
031300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03130000
031400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03140000
031500                                                                  03150000
031600                 20  ASC-ITEM-ARRAY.                              03160000
031700                     25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        03170000
031800                         30  ASC-LIST-ITEM-NUMBER                 03180000
031900                                                     PIC S9(09)   03190000
032000                                                     COMP-3.      03200000
032100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03210000
032200                             88  ASC-VALID-SELECT    VALUE ' '    03220000
032300                                                           'S'    03230000
032400                                                           'B'    03240000
032500                                                           'E'.   03250000
032600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03260000
032700                             88  ASC-TEMP-SELECT     VALUE 'S'.   03270000
032800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03280000
032900                             88  ASC-TEMP-END        VALUE 'E'.   03290000
033000                         30  ASC-SELECTED-SW         PIC  X(01).  03300000
033100                             88  ASC-NO-SELECT       VALUE ' '.   03310000
033200                             88  ASC-SELECT          VALUE 'S'.   03320000
033300                             88  ASC-BEGIN           VALUE 'B'.   03330000
033400                             88  ASC-END             VALUE 'E'.   03340000
033500                         30  ASC-ACTION              PIC  X(03).  03350000
033600                         30  ASC-PTAG                PIC  X(07).  03360000
033700                         30  ASC-DEPT                PIC  9(03).  03370001
033710                         30  ASC-CLASS               PIC  9(02).  03371001
033720                         30  ASC-SUBCLASS            PIC  9(02).  03372001
033730                         30  ASC-SKU                 PIC  9(08).  03373001
033800                         30  ASC-DESCRIPTION         PIC  X(23).  03380004
033900                         30  ASC-SIZE                PIC  X(05).  03390000
034000                         30  ASC-COLOR               PIC  X(04).  03400000
034100                                                                  03410000
034200             15  ASC-BLK-SUB                         PIC S9(04)   03420000
034300                                                          COMP    03430000
034400                                                          SYNC.   03440000
034500             15  ASC-ITEM-SUB                        PIC S9(04)   03450000
034600                                                          COMP    03460000
034700                                                          SYNC.   03470000
034800             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   03480000
034900                                                          COMP-3. 03490000
035000             15  ASC-NUMBER-OF-TS-ITEMS              PIC S9(05)   03500000
035100                                                          COMP-3. 03510000
035200             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   03520000
035300                                                          COMP-3. 03530000
035400             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   03540000
035500                                                          COMP-3. 03550000
035600             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   03560000
035700                                                          COMP-3. 03570000
035800             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   03580000
035900                                                          COMP-3. 03590000
036000             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   03600000
036100                                                          COMP    03610000
036200                                                          SYNC.   03620000
036300             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   03630000
036400                                                          COMP-3. 03640000
036500             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   03650000
036600                                                          COMP-3. 03660000
036700             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  03670000
036800                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   03680000
036900                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   03690000
037000             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  03700000
037100                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   03710000
037200                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   03720000
037300             15  ASC-LIST-QUEUE-NAME.                             03730000
037400                 20  ASC-LIST-TERM-ID                PIC  X(04).  03740000
037500                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   03750000
037600                                                          COMP-3. 03760000
037700                 20  ASC-LIST-SEQ                    PIC  9(01).  03770000
037800             15  ASC-SEL-QUEUE-NAME.                              03780000
037900                 20  ASC-SEL-TERM-ID                 PIC  X(04).  03790000
038000                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   03800000
038100                                                          COMP-3. 03810000
038200                 20  ASC-SEL-SEQ                     PIC  9(01).  03820000
038300                                                                  03830000
038400             15  ASC-SEL-SUB                         PIC S9(04)   03840000
038500                                                          COMP.   03850000
038600             15  ASC-SEL-ITEM                        PIC S9(04)   03860000
038700                                                          COMP.   03870000
039300             15  ASC-START-ITEM-REQUEST.                          03930000
039400                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  03940000
039410             15  FILLER                              PIC  X(10).  03941021
039420                                                                  03942021
039500     EJECT                                                        03950000
039600*---------------------------------------------------------------* 03960000
039700*    ABEND PROCESSING COPYBOOK.                                 * 03970000
039800*---------------------------------------------------------------* 03980000
039900                                                                  03990000
040000     COPY DPWS013.                                                04000000
040100                                                                  04010000
040200 EJECT                                                            04020000
040300*---------------------------------------------------------------* 04030000
040400*    DB2 AREA FOR TSK                                           * 04040000
040500*---------------------------------------------------------------* 04050000
040600     EXEC SQL                                                     04060000
040700          INCLUDE TSK                                             04070000
040800     END-EXEC.                                                    04080000
040900*---------------------------------------------------------------* 04090000
041000*    DB2 AREA FOR TMRITST                                       * 04100000
041100*---------------------------------------------------------------* 04110000
041200     EXEC SQL                                                     04120000
041300          INCLUDE TMRITST                                         04130000
041400     END-EXEC.                                                    04140000
041410******************************************************************04141001
041420* MRNIS-RFC      PREVIOUS   NOT INCLUDED                          04142001
041430* MRNIS-RFC      CURRENT    DCLGEN FOR TSKXREF                    04143001
041440* MRNIS-RFC      FUTURE     REMOVE WHEN TSKXREF NO LONGER NEEDED  04144001
041450******************************************************************04145001
041460*---------------------------------------------------------------* 04146001
041470*    DB2 AREA FOR TSKXREF                                       * 04147001
041480*---------------------------------------------------------------* 04148001
041490     EXEC SQL                                                     04149001
041491         INCLUDE TSKXREF                                          04149101
041492     END-EXEC.                                                    04149201
041493                                                                  04149301
041500*---------------------------------------------------------------* 04150000
041600*    DB2 AREA FOR COMMUNICATIONS                                * 04160000
041700*---------------------------------------------------------------* 04170000
041800     EXEC SQL                                                     04180000
041900          INCLUDE SQLCA                                           04190000
042000     END-EXEC.                                                    04200000
042100                                                                  04210000
042200*---------------------------------------------------------------* 04220000
042300*    SKUS-FOR-A-PTAG CURSOR                                     * 04230000
042400*---------------------------------------------------------------* 04240000
042460******************************************************************04246005
042470* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       04247005
042480* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  04248005
042490* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 04249005
042491******************************************************************04249105
042500                                                                  04250000
042600     EXEC SQL                                                     04260000
042700          DECLARE SKUS-FOR-A-PTAG CURSOR                          04270000
042800          FOR SELECT DISTINCT                                     04280000
042900                A.PTAG_ID                                         04290000
043000              , X.DEPT                                            04300001
043100              , X.CLASS                                           04310001
043200              , X.SUBCLASS                                        04320001
043210              , X.SKU                                             04321001
043300              , B.SKU_DESC                                        04330000
043400              , B.SIZE_DESC                                       04340000
043500              , B.COLOR_DESC                                      04350000
043600              , A.ITEM_NBR                                        04360000
043700          FROM                                                    04370000
043800                TMRITST  A                                        04380000
043900              , TSK      B                                        04390000
043910              , TSKXREF  X                                        04391001
044000          WHERE                                                   04400000
044100                A.ITEM_NBR            = B.ITEM_NMBR               04410000
044110           AND  B.ITEM_NMBR           = X.ITM_NBR                 04411001
044200           AND  A.PTAG_ID             = :PV-PTAG                  04420000
044300          ORDER BY                                                04430000
044400                X.DEPT                                            04440001
044500              , X.CLASS                                           04450001
044600              , X.SUBCLASS                                        04460001
044610              , X.SKU                                             04461001
044700     END-EXEC.                                                    04470000
044800                                                                  04480000
044900                                                                  04490000
045000                                                                  04500000
045100 EJECT                                                            04510000
045200 LINKAGE SECTION.                                                 04520000
045300                                                                  04530000
045400 01  DFHCOMMAREA.                                                 04540000
045500     05  FILLER                         OCCURS  1 TO 4072 TIMES   04550000
045600                                        DEPENDING ON EIBCALEN.    04560000
045700         10  FILLER                     PIC X.                    04570000
045800                                                                  04580000
045900 EJECT                                                            04590000
046000 PROCEDURE DIVISION.                                              04600000
046100******************************************************************04610000
046200**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04620000
046300**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04630000
046400**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04640000
046500******************************************************************04650000
046600 0000-MAIN-MODULE.                                                04660000
046700     INITIALIZE DP030-CICS-API-FIELDS.                            04670000
046800     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04680000
046900     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04690000
047000     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04700000
047100     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04710000
047200     MOVE LENGTH OF MR047AI        TO DP030-MAP-LENGTH (1).       04720000
047300     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04730000
047400     PERFORM 0001-CALL-CICS-ARCH-API.                             04740000
047500*                                                                 04750000
047600     PERFORM 1000-CONTROL-PROCESSING                              04760000
047700*                                                                 04770000
047800     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04780000
047900     PERFORM 0001-CALL-CICS-ARCH-API.                             04790000
048000                                                                  04800000
048100******************************************************************04810000
048200**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04820000
048300**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04830000
048400******************************************************************04840000
048500 0001-CALL-CICS-ARCH-API.                                         04850000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04860028
048700                                    DFHCOMMAREA                   04870028
048800                                    DP030-CICS-API-FIELDS         04880028
048900                                    DP020-STANDARD-COMMAREA       04890028
049000                                    MR047AI.                      04900028
049100*                                                                 04910000
049200     IF  DP030-RC-CALL-SUCCESSFUL                                 04920000
049300         CONTINUE                                                 04930000
049400     ELSE                                                         04940000
049500         SET DP013-NO-ROLLBACK                                    04950000
049600             DP013-XCTL-DISPLAY-RESTART                           04960000
049700             DP013-CICS-ABEND      TO TRUE                        04970000
049800         MOVE '0001-CALL-CICS-ARCH-API'                           04980000
049900                                   TO DP013-PARAGRAPH             04990000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04991028
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04992028
050200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05020000
050300         PERFORM DP013-0000-PROCESS-ABEND                         05030000
050400     END-IF.                                                      05040000
050500*----------------------------------------------------------------*05050000
050600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05060000
050700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05070000
050800*                                                                *05080000
050900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05090000
051000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05100000
051100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05110000
051200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05120000
051300*----------------------------------------------------------------*05130000
051400                                                                  05140000
051500 1000-CONTROL-PROCESSING.                                         05150000
051600                                                                  05160000
051700     EVALUATE TRUE                                                05170000
051800         WHEN DP020-NEXT-ACT-INITIAL                              05180000
051900             INITIALIZE ASC-SPECIFIC-COMMAREA                     05190000
052000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            05200000
052100                                      ASC-SEL-TERM-ID             05210000
052200             MOVE DP020-SRC-TASK-NUMBER                           05220000
052300                                   TO ASC-LIST-TASK-NUMBER        05230000
052400                                      ASC-SEL-TASK-NUMBER         05240000
052500             MOVE PC-LIST-QUEUE-SEQ                               05250000
052600                                   TO ASC-LIST-SEQ                05260000
052700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 05270000
052800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05280000
052900***-----$TEMPLATE NOTE$-------------------------------------------05290000
053000*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,05300000
053100*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  05310000
053200*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.05320000
053300***---------------------------------------------------------------05330000
053400             IF  PS-COMMAREA-NOT-VALID                            05340000
053500                 SET DP020-MSG-FATAL                              05350000
053600                                   TO TRUE                        05360000
053700                 SET DP020-NEXT-ACT-APPL-ERROR                    05370000
053800                                   TO TRUE                        05380000
053900             ELSE                                                 05390000
054000                 PERFORM 4000-BUILD-INITIAL-PANEL                 05400000
054100             END-IF                                               05410000
054200                                                                  05420000
054300         WHEN DP020-NEXT-ACT-READ-MAP                             05430000
054400             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05440000
054500                                   TO PV-TOP-ITEM                 05450000
054600             PERFORM 2000-PROCESS-PANEL                           05460000
054700                                                                  05470000
054800         WHEN DP020-NEXT-ACT-RETURN                               05480000
054900             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        05490000
055000                                   TO PV-TOP-ITEM                 05500000
055100             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05510000
055200             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05520000
055300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05530000
055400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05540000
055500                                                                  05550000
055600         WHEN OTHER                                               05560000
055700             SET DP013-LOGIC-ABEND TO TRUE                        05570000
055800             SET DP013-NO-ROLLBACK TO TRUE                        05580000
055900             MOVE '1000-CONTROL-PROCESSING'                       05590000
056000                                   TO DP013-PARAGRAPH             05600000
056100             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05610000
056200                                   TO DP013-MESSAGE-TEXT(1)       05620000
056300             PERFORM DP013-0000-PROCESS-ABEND                     05630000
056400     END-EVALUATE.                                                05640000
056500                                                                  05650000
056600 EJECT                                                            05660000
056700*----------------------------------------------------------------*05670000
056800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05680000
056900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05690000
057000*----------------------------------------------------------------*05700000
057100                                                                  05710000
057200 1100-PROCESS-INTER-APPL-COMM.                                    05720000
057300                                                                  05730000
057400     SET PS-COMMAREA-VALID         TO TRUE.                       05740000
057500     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05750000
057600     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05760000
057700         IF MR114-PTAG NOT = SPACES                               05770000
057800             MOVE MR114-PTAG           TO ASC-KEY-PTAG            05780000
057900         ELSE                                                     05790000
058000             SET PS-COMMAREA-NOT-VALID TO TRUE                    05800000
058100*  PTAG IS REQUIRED                                               05810000
058200             MOVE PC-TSYMSG-00696      TO DP020-MSG-NUMBER        05820000
058300         END-IF                                                   05830000
058400     ELSE                                                         05840000
058500         IF  DP020-INT-APPL-FORMAT-IND = PC-INTER-APPL-LIST       05850000
058600             MOVE MR102-NUMBER-OF-SELECTED-ITEMS                  05860000
058700                                   TO ASC-NUMBER-OF-SELECTED-ITEMS05870000
058800             MOVE MR102-NUMBER-OF-TS-ITEMS                        05880000
058900                                   TO ASC-NUMBER-OF-TS-ITEMS      05890000
059000             MOVE MR102-SEL-QUEUE-NAME                            05900000
059100                                   TO ASC-SEL-QUEUE-NAME          05910000
059200             PERFORM 1120-PREPARE-LIST-ENTRY                      05920000
059300             MOVE MR114-PTAG           TO ASC-KEY-PTAG            05930000
059400                                                                  05940000
059500         ELSE                                                     05950000
059600             MOVE PC-TSYMSG-00148                                 05960000
059700                               TO DP020-MSG-NUMBER                05970000
059800             SET DP020-MSG-FATAL                                  05980000
059900                 DP020-NEXT-ACT-APPL-ERROR                        05990000
060000                               TO TRUE.                           06000000
060100                                                                  06010000
060200                                                                  06020000
060300*----------------------------------------------------------------*06030000
060400* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *06040000
060500* STORAGE QUEUE PASSED FROM THE LIST.                            *06050000
060600*----------------------------------------------------------------*06060000
060700 1120-PREPARE-LIST-ENTRY.                                         06070000
060800     MOVE MR115-MAX-ITEMS          TO ASC-SEL-SUB.                06080000
060900     MOVE ZERO                     TO ASC-SEL-ITEM                06090000
061000                                      PV-SEL-QUEUE-ITEM.          06100000
061100     PERFORM 1130-GET-NEXT-MESSAGE.                               06110000
061200                                                                  06120000
061300 1130-GET-NEXT-MESSAGE.                                           06130000
061400     ADD +1                        TO ASC-SEL-SUB.                06140000
061500     IF  ASC-SEL-SUB > MR115-MAX-ITEMS                            06150000
061600         ADD +1                    TO PV-SEL-QUEUE-ITEM           06160000
061700         MOVE +1                   TO ASC-SEL-SUB                 06170000
061800     END-IF.                                                      06180000
061900     IF  PV-SEL-QUEUE-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS           06190000
062000         PERFORM 6105-READ-SEL-QUEUE                              06200000
062100         SET MR115-IDX TO ASC-SEL-SUB                             06210000
062200         IF  MR115-ITEM (MR115-IDX) > ZERO                        06220000
062300             MOVE MR115-SKU (MR115-IDX)      TO MR114-SKU         06230024
062510             MOVE MR115-DEPT (MR115-IDX)     TO MR114-DEPT        06251024
062520             MOVE MR115-CLASS (MR115-IDX)    TO MR114-CLASS       06252024
062530             MOVE MR115-SUBCLASS (MR115-IDX) TO MR114-SUBCLASS    06253010
062800             MOVE MR115-PTAG (MR115-IDX)     TO MR114-PTAG        06280025
063000             PERFORM 9200-REWRITE-LIST-QUEUE                      06300000
063100         ELSE                                                     06310000
063200             SUBTRACT +1 FROM ASC-SEL-SUB                         06320000
063300*            --- BOTTOM OF LIST ---                               06330000
063400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            06340000
063500             SET DP020-MSG-INFORMATIONAL                          06350000
063600                                   TO TRUE                        06360000
063700         END-IF                                                   06370000
063800     ELSE                                                         06380000
063900         SUBTRACT +1 FROM PV-SEL-QUEUE-ITEM                       06390000
064000         MOVE MR115-MAX-ITEMS      TO ASC-SEL-SUB                 06400000
064100         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            06410000
064200         SET DP020-MSG-INFORMATIONAL                              06420000
064300                                   TO TRUE                        06430000
064400     END-IF.                                                      06440000
064500                                                                  06450000
064600 EJECT                                                            06460000
064700*----------------------------------------------------------------*06470000
064800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06480000
064900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06490000
065000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06500000
065100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06510000
065200* FUNCTION KEYS CAN GET THIS FAR.                                *06520000
065300*----------------------------------------------------------------*06530000
065400                                                                  06540000
065500 2000-PROCESS-PANEL.                                              06550000
065600     EVALUATE TRUE                                                06560000
065700         WHEN DP020-SRC-AID = DP016-CLEAR                         06570000
065800             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06580000
065900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06590000
066000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06600000
066100                                                                  06610000
066200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06620000
066300             PERFORM 2050-DELETE-LIST-QUEUE                       06630000
066400             PERFORM 4000-BUILD-INITIAL-PANEL                     06640000
066500                                                                  06650000
066600         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    06660000
066700             PERFORM 2140-DESELECT-ALL-ITEMS                      06670000
066800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06680000
066900                                                                  06690000
067000         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  06700000
067100             PERFORM 2150-SELECT-ALL-ITEMS                        06710000
067200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06720000
067300                                                                  06730000
067400         WHEN OTHER                                               06740000
067500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 06750000
067600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06760000
067700             IF  PS-NO-ERROR                                      06770000
067800                 SET DP030-CONTINUE-GO                            06780000
067900                                 TO TRUE                          06790000
068000                 PERFORM 2100-CHECK-FUNCTION-KEY                  06800000
068100             ELSE                                                 06810000
068200                 SET DP030-OVERRIDE-GO                            06820000
068300                                 TO TRUE                          06830000
068400             END-IF                                               06840000
068500     END-EVALUATE.                                                06850000
068600 EJECT                                                            06860000
068700*----------------------------------------------------------------*06870000
068800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06880000
068900*----------------------------------------------------------------*06890000
069000 2050-DELETE-LIST-QUEUE.                                          06900000
069100                                                                  06910000
069200     EXEC CICS                                                    06920000
069300         DELETEQ TS                                               06930000
069400             QUEUE (ASC-LIST-QUEUE-NAME)                          06940000
069500             RESP  (PV-CICS-RESP)                                 06950000
069600     END-EXEC.                                                    06960000
069700                                                                  06970000
069800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06980000
069900        (PV-CICS-RESP = DFHRESP(QIDERR))                          06990000
070000         CONTINUE                                                 07000000
070100     ELSE                                                         07010000
070200         SET DP013-CICS-ABEND      TO TRUE                        07020000
070300         SET DP013-NO-ROLLBACK     TO TRUE                        07030000
070400                                                                  07040000
070500         MOVE '2050-DELETE-LIST-QUEUE'                            07050000
070600                                   TO DP013-PARAGRAPH             07060000
070700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07070000
070800                                   TO DP013-MESSAGE-TEXT (1)      07080000
070900         PERFORM DP013-0000-PROCESS-ABEND                         07090000
071000     END-IF.                                                      07100000
071100                                                                  07110000
071200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  07120000
071300 EJECT                                                            07130000
071400*----------------------------------------------------------------*07140000
071500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07150000
071600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07160000
071700* CICS ARCHITECTURE API.                                         *07170000
071800*----------------------------------------------------------------*07180000
071900 2100-CHECK-FUNCTION-KEY.                                         07190000
072000     EVALUATE TRUE                                                07200000
072100         WHEN DP020-FK-LOCAL-GOTO(DP020-SRC-AID)                  07210000
072200             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              07220000
072300                 INITIALIZE MR102-INTER-APPL-COMMAREA             07230000
072400                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                07240000
072500                                TO MR102-NUMBER-OF-SELECTED-ITEMS 07250000
072600                 PERFORM 5000-PREPARE-SEL-QUEUE                   07260000
072700             ELSE                                                 07270000
072800                 SET DP030-OVERRIDE-GO                            07280000
072900                                   TO TRUE                        07290000
073000                 MOVE PC-TSYMSG-00057                             07300000
073100                                   TO DP020-MSG-NUMBER            07310000
073200                 SET DP020-MSG-WARNING                            07320000
073300                                   TO TRUE                        07330000
073400             END-IF                                               07340000
073500                                                                  07350000
073600                                                                  07360000
073700         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07370000
073800             MOVE +1               TO PV-TOP-ITEM                 07380000
073900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07390000
074000                                                                  07400000
074100         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07410000
074200             PERFORM 2110-BROWSE-BACKWARD                         07420000
074300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07430000
074400                                                                  07440000
074500         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07450000
074600             PERFORM 2120-BROWSE-FORWARD                          07460000
074700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07470000
074800                                                                  07480000
074900         WHEN DP020-SRC-AID = DP016-ENTER                         07490000
075000             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   07500000
075100             IF  PS-ERROR                                         07510000
075200                 CONTINUE                                         07520000
075300             ELSE                                                 07530000
075400                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07540000
075500             END-IF                                               07550000
075600                                                                  07560000
075700                                                                  07570000
075800         WHEN OTHER                                               07580000
075900             SET DP013-NO-ROLLBACK                                07590000
076000                 DP013-XCTL-DISPLAY-RESTART                       07600000
076100                 DP013-CICS-ABEND  TO TRUE                        07610000
076200             MOVE '2100-CHECK-FUNCTION-KEY'                       07620000
076300                                   TO DP013-PARAGRAPH             07630000
076400             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      07640000
076500                                   TO DP013-MESSAGE-TEXT (1)      07650000
076600             PERFORM DP013-0000-PROCESS-ABEND                     07660000
076700     END-EVALUATE.                                                07670000
076800*                                                                 07680000
076900*----------------------------------------------------------------*07690000
077000*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *07700000
077100*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *07710000
077200*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *07720000
077300*    MESSAGE.                                                    *07730000
077400*----------------------------------------------------------------*07740000
077500                                                                  07750000
077600 2110-BROWSE-BACKWARD.                                            07760000
077700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07770000
077800         GIVING PV-TOP-ITEM.                                      07780000
077900*                                                                 07790000
078000     IF  ((PV-TOP-ITEM < +1)                                      07800000
078100       OR (PV-TOP-ITEM = +1))                                     07810000
078200         MOVE +1                   TO PV-TOP-ITEM                 07820000
078300*        -- TOP OF LIST --                                        07830000
078400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07840000
078500         SET DP020-MSG-INFORMATIONAL TO TRUE                      07850000
078600     END-IF.                                                      07860000
078700                                                                  07870000
078800 EJECT                                                            07880000
078900*----------------------------------------------------------------*07890000
079000*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07900000
079100*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07910000
079200*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07920000
079300*----------------------------------------------------------------*07930000
079400                                                                  07940000
079500 2120-BROWSE-FORWARD.                                             07950000
079600                                                                  07960000
079700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07970000
079800         GIVING PV-TOP-ITEM.                                      07980000
079900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07990000
080000         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08000000
080100                                   TO PV-TOP-ITEM                 08010000
080200*        -- BOTTOM OF LIST --                                     08020000
080300         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08030000
080400         SET DP020-MSG-INFORMATIONAL                              08040000
080500                                   TO TRUE                        08050000
080600     ELSE                                                         08060000
080700         COMPUTE PV-BOTTOM-ITEM =                                 08070000
080800             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08080000
080900         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08090000
081000*            -- BOTTOM OF LIST --                                 08100000
081100             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08110000
081200             SET DP020-MSG-INFORMATIONAL                          08120000
081300                                   TO TRUE                        08130000
081400         END-IF                                                   08140000
081500     END-IF.                                                      08150000
081600 EJECT                                                            08160000
081700*----------------------------------------------------------------*08170000
081800*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08180000
081900*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08190000
082000*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08200000
082100*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08210000
082200*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08220000
082300*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08230000
082400*----------------------------------------------------------------*08240000
082500                                                                  08250000
082600 2130-CHECK-FOR-JUMP-BROWSE.                                      08260000
082700     SET PS-NO-ERROR               TO TRUE.                       08270000
082800     IF (ASC-START-ITEM-REQUEST = SPACE)                          08280000
082900         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            08290000
083000                                   TO PV-TOP-ITEM                 08300000
083100     ELSE                                                         08310000
083200         MOVE ASC-START-ITEM-REQUEST                              08320000
083300                                   TO DP010I-UNEDITED-FIELD       08330000
083400         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08340000
083500         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08350000
083600         SET DP010I-NEGATIVE-NOT-ALLOWED                          08360000
083700                                   TO TRUE                        08370000
262436         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08381026
262436              USING DP010I-NUMERIC-EDIT-AREA                      08382026
083900                                                                  08390000
084000         IF  NOT DP010I-ERROR-DETECTED                            08400000
084100             MOVE DP010I-NUMERIC-FIELD                            08410000
084200                                   TO  ASC-START-ITEM-REQUEST-N   08420000
084300             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08430000
084400                 IF  ASC-START-ITEM-REQUEST-N >                   08440000
084500                                          ASC-NUMBER-OF-ITEMS-READ08450000
084600                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08460000
084700                     COMPUTE PV-TOP-ITEM =                        08470000
084800                             ASC-NUMBER-OF-ITEMS-READ             08480000
084900                             - PC-ITEMS-PER-PANEL + 1             08490000
085000                     IF  PV-TOP-ITEM < +1                         08500000
085100                         MOVE +1   TO PV-TOP-ITEM                 08510000
085200                         MOVE PC-TSYMSG-00070                     08520000
085300                                   TO DP020-MSG-NUMBER            08530000
085400                         SET DP020-MSG-INFORMATIONAL              08540000
085500                                   TO TRUE                        08550000
085600                     END-IF                                       08560000
085700                 ELSE                                             08570000
085800                     MOVE ASC-START-ITEM-REQUEST-N                08580000
085900                                   TO PV-TOP-ITEM                 08590000
086000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      08600000
086100                     COMPUTE PV-BOTTOM-ITEM =                     08610000
086200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     08620000
086300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ08630000
086400*                        -- BOTTOM OF LIST --                     08640000
086500                         MOVE PC-TSYMSG-00070                     08650000
086600                                   TO DP020-MSG-NUMBER            08660000
086700                         SET DP020-MSG-INFORMATIONAL              08670000
086800                                   TO TRUE                        08680000
086900                     END-IF                                       08690000
087000                 END-IF                                           08700000
087100             ELSE                                                 08710000
087200*                --- VALUE OUT OF RANGE ----                      08720000
087300                 MOVE PC-TSYMSG-00101                             08730000
087400                                   TO DP020-MSG-NUMBER            08740000
087500                 MOVE -1           TO ASTRTITL                    08750000
087600                 SET DP030-SET-CURSOR-APPL-1                      08760000
087700                                   TO TRUE                        08770000
087800                 MOVE DP015-REVERSE                               08780000
087900                                   TO ASTRTITH                    08790000
088000                 MOVE DP015-RED    TO ASTRTITC                    08800000
088100                 MOVE DP015-UNP-NUM-BRT-MDT                       08810000
088200                                   TO ASTRTITA                    08820000
088300                 SET DP020-MSG-FATAL                              08830000
088400                                   TO TRUE                        08840000
088500                 SET PS-ERROR      TO TRUE                        08850000
088600             END-IF                                               08860000
088700                                                                  08870000
088800         ELSE                                                     08880000
088900             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            08890000
089000             MOVE -1               TO ASTRTITL                    08900000
089100             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  08910000
089200             MOVE DP015-REVERSE    TO ASTRTITH                    08920000
089300             MOVE DP015-RED        TO ASTRTITC                    08930000
089400             MOVE DP015-UNP-NUM-BRT-MDT                           08940000
089500                                   TO ASTRTITA                    08950000
089600             SET DP020-MSG-FATAL   TO TRUE                        08960000
089700             SET PS-ERROR          TO TRUE                        08970000
089800         END-IF                                                   08980000
089900     END-IF.                                                      08990000
090000 EJECT                                                            09000000
090100*----------------------------------------------------------------*09010000
090200*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09020000
090300*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09030000
090400*----------------------------------------------------------------*09040000
090500 2140-DESELECT-ALL-ITEMS.                                         09050000
090600     MOVE +1                       TO ASC-BLK-SUB.                09060000
090700                                                                  09070000
090800     PERFORM 2141-CLEAR-SELECTED-INDS                             09080000
090900         VARYING ASC-ITEM-SUB                                     09090000
091000         FROM 1 BY 1                                              09100000
091100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09110000
091200                                                                  09120000
091300     ADD +1                        TO ASC-BLK-SUB.                09130000
091400                                                                  09140000
091500     PERFORM 2141-CLEAR-SELECTED-INDS                             09150000
091600         VARYING ASC-ITEM-SUB                                     09160000
091700         FROM 1 BY 1                                              09170000
091800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09180000
091900                                                                  09190000
092000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09200000
092100                                   TO PV-LIST-ITEM-NUMBER.        09210000
092200                                                                  09220000
092300     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09230000
092400         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09240000
092500                                                                  09250000
092600     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09260000
092700        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09270000
092800         MOVE +1                   TO ASC-BLK-SUB                 09280000
092900                                                                  09290000
093000         PERFORM 5100-WRITE-TEMP-STORAGE                          09300000
093100                                                                  09310000
093200         MOVE +1                   TO PV-BLOCK-NUMBER             09320000
093300                                                                  09330000
093400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09340000
093500             PV-FIRST-BLOCK-IN-ARRAY - 1                          09350000
093600                                                                  09360000
093700         PERFORM                                                  09370000
093800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09380000
093900                                                                  09390000
094000             PERFORM 4410-READ-TEMP-STORAGE                       09400000
094100                                                                  09410000
094200             PERFORM 2141-CLEAR-SELECTED-INDS                     09420000
094300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09430000
094400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09440000
094500                                                                  09450000
094600             PERFORM 5100-WRITE-TEMP-STORAGE                      09460000
094700                                                                  09470000
094800             ADD +1                TO PV-BLOCK-NUMBER             09480000
094900                                                                  09490000
095000         END-PERFORM                                              09500000
095100                                                                  09510000
095200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         09520000
095300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     09530000
095400                                                                  09540000
095500         PERFORM                                                  09550000
095600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       09560000
095700                   ASC-HIGHEST-BLOCK-WRITTEN                      09570000
095800                                                                  09580000
095900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          09590000
096000                                   TO PV-BLOCK-NUMBER             09600000
096100                                                                  09610000
096200             PERFORM 4410-READ-TEMP-STORAGE                       09620000
096300                                                                  09630000
096400             PERFORM 2141-CLEAR-SELECTED-INDS                     09640000
096500                 VARYING ASC-ITEM-SUB                             09650000
096600                 FROM 1 BY 1                                      09660000
096700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09670000
096800                                                                  09680000
096900             PERFORM 5100-WRITE-TEMP-STORAGE                      09690000
097000                                                                  09700000
097100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      09710000
097200                                                                  09720000
097300         END-PERFORM                                              09730000
097400                                                                  09740000
097500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             09750000
097600                                   TO PV-BLOCK-NUMBER             09760000
097700                                                                  09770000
097800         PERFORM 4410-READ-TEMP-STORAGE                           09780000
097900     END-IF.                                                      09790000
098000                                                                  09800000
098100                                                                  09810000
098200     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 09820000
098300     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.09830000
098400     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  09840000
098500                                                                  09850000
098600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        09860000
098700                                                                  09870000
098800 EJECT                                                            09880000
098900*----------------------------------------------------------------*09890000
099000*    MARK EACH ITEM AS BEING NOT SELECTED.                       *09900000
099100*----------------------------------------------------------------*09910000
099200                                                                  09920000
099300 2141-CLEAR-SELECTED-INDS.                                        09930000
099400                                                                  09940000
099500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           09950000
099600             NOT EQUAL ZERO                                       09960000
099700         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09970000
099800             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          09980000
099900                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    09990000
100000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  10000000
100100                                   TO TRUE                        10010000
100200         END-IF                                                   10020000
100300     END-IF.                                                      10030000
100400                                                                  10040000
100500 EJECT                                                            10050000
100600*----------------------------------------------------------------*10060000
100700*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *10070000
100800*  FOR ALL ITEMS.                                                *10080000
100900*----------------------------------------------------------------*10090000
101000                                                                  10100000
101100 2150-SELECT-ALL-ITEMS.                                           10110000
101200                                                                  10120000
101300     MOVE +1                       TO ASC-BLK-SUB.                10130000
101400                                                                  10140000
101500     PERFORM 2151-SET-SELECTED-INDS                               10150000
101600         VARYING ASC-ITEM-SUB                                     10160000
101700         FROM 1 BY 1                                              10170000
101800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10180000
101900                                                                  10190000
102000     ADD +1                        TO ASC-BLK-SUB.                10200000
102100                                                                  10210000
102200     PERFORM 2151-SET-SELECTED-INDS                               10220000
102300         VARYING ASC-ITEM-SUB                                     10230000
102400         FROM 1 BY 1                                              10240000
102500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10250000
102600                                                                  10260000
102700     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10270000
102800                                   TO PV-LIST-ITEM-NUMBER.        10280000
102900                                                                  10290000
103000     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10300000
103100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10310000
103200                                                                  10320000
103300     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10330000
103400        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10340000
103500         MOVE +1                   TO ASC-BLK-SUB                 10350000
103600                                                                  10360000
103700         PERFORM 5100-WRITE-TEMP-STORAGE                          10370000
103800                                                                  10380000
103900         MOVE +1                   TO PV-BLOCK-NUMBER             10390000
104000                                                                  10400000
104100         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10410000
104200             PV-FIRST-BLOCK-IN-ARRAY - 1                          10420000
104300                                                                  10430000
104400         PERFORM                                                  10440000
104500             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10450000
104600                                                                  10460000
104700             PERFORM 4410-READ-TEMP-STORAGE                       10470000
104800                                                                  10480000
104900             PERFORM 2151-SET-SELECTED-INDS                       10490000
105000                 VARYING ASC-ITEM-SUB                             10500000
105100                 FROM 1 BY 1                                      10510000
105200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10520000
105300                                                                  10530000
105400             PERFORM 5100-WRITE-TEMP-STORAGE                      10540000
105500                                                                  10550000
105600             ADD +1                TO PV-BLOCK-NUMBER             10560000
105700                                                                  10570000
105800         END-PERFORM                                              10580000
105900                                                                  10590000
106000         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10600000
106100             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10610000
106200                                                                  10620000
106300         PERFORM                                                  10630000
106400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10640000
106500                   ASC-HIGHEST-BLOCK-WRITTEN                      10650000
106600                                                                  10660000
106700             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10670000
106800                                   TO PV-BLOCK-NUMBER             10680000
106900                                                                  10690000
107000             PERFORM 4410-READ-TEMP-STORAGE                       10700000
107100                                                                  10710000
107200             PERFORM 2151-SET-SELECTED-INDS                       10720000
107300                 VARYING ASC-ITEM-SUB                             10730000
107400                 FROM 1 BY 1                                      10740000
107500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10750000
107600                                                                  10760000
107700             PERFORM 5100-WRITE-TEMP-STORAGE                      10770000
107800                                                                  10780000
107900             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10790000
108000                                                                  10800000
108100         END-PERFORM                                              10810000
108200                                                                  10820000
108300         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10830000
108400                                   TO PV-BLOCK-NUMBER             10840000
108500                                                                  10850000
108600         PERFORM 4410-READ-TEMP-STORAGE                           10860000
108700     END-IF.                                                      10870000
108800                                                                  10880000
108900                                                                  10890000
109000     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             10900000
109100                       ASC-NUMBER-OF-SELECTED-ITEMS.              10910000
109200                                                                  10920000
109300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10930000
109400                                                                  10940000
109500 EJECT                                                            10950000
109600*----------------------------------------------------------------*10960000
109700*    MARK EACH ITEM AS BEING SELECTED.                           *10970000
109800*----------------------------------------------------------------*10980000
109900                                                                  10990000
110000 2151-SET-SELECTED-INDS.                                          11000000
110100                                                                  11010000
110200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11020000
110300             NOT EQUAL ZERO                                       11030000
110400         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11040000
110500             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11050000
110600                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11060000
110700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11070000
110800                               TO  TRUE                           11080000
110900         END-IF                                                   11090000
111000     END-IF.                                                      11100000
111010                                                                  11101001
115800******************************************************************11580000
115900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11590000
116000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **11600000
116100******************************************************************11610000
116200 2200-MOVE-SCREEN-TO-COMMAREA.                                    11620000
116300                                                                  11630000
116400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11640000
116500     MOVE +1                       TO PV-SUB.                     11650000
116600*                                                                 11660000
116700     PERFORM 3100-SET-SUBSCRIPTS.                                 11670000
116800     IF  ASTRTITL > ZERO                                          11680000
116900         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11690000
117000     ELSE                                                         11700000
117100         IF  ASTRTITF = DP015-ERASE-EOF                           11710000
117200             INITIALIZE ASC-START-ITEM-REQUEST                    11720000
117300         END-IF                                                   11730000
117400     END-IF.                                                      11740000
117500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11750000
117600         VARYING PV-SUB                                           11760000
117700         FROM 1 BY 1                                              11770000
117800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11780000
117900******************************************************************11790000
118000** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**11800000
118100******************************************************************11810000
118200 2210-MOVE-LINES-TO-COMMAREA.                                     11820000
118300     IF  MR-SELECTL (PV-SUB) > ZERO                               11830000
118400         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11840000
118500         MOVE MR-SELECTI (PV-SUB)                                 11850000
118600                                   TO ASC-TEMP-SELECTED-SW        11860000
118700                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11870000
118800     ELSE                                                         11880000
118900         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11890000
119000                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11900000
119100                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        11910000
119200                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      11920000
119300         END-IF                                                   11930000
119400     END-IF.                                                      11940000
119500     ADD +1                        TO ASC-ITEM-SUB.               11950000
119600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11960000
119700         ADD +1                    TO ASC-BLK-SUB                 11970000
119800         MOVE +1                   TO ASC-ITEM-SUB                11980000
119900     END-IF.                                                      11990000
120000******************************************************************12000000
120100** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12010000
120200** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12020000
120300******************************************************************12030000
120400 3000-EDIT-DATA-IN-COMMAREA.                                      12040000
120500     SET PS-NO-ERROR               TO TRUE.                       12050000
120600     PERFORM 3200-RESET-ATTRIBUTES.                               12060000
120700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12070000
120800**                                                                12080000
120900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12090000
121000* EDITTING IS DONE FROM THE BOTTOM UP.                            12100000
121100**                                                                12110000
121200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12120000
121300         ASC-ITEMS-DISPLAYED - 1.                                 12130000
121400     PERFORM 3100-SET-SUBSCRIPTS.                                 12140000
121500     PERFORM 3300-EDIT-SELECTIONS                                 12150000
121600         VARYING PV-SUB                                           12160000
121700         FROM PV-SUB BY -1                                        12170000
121800         UNTIL PV-SUB < +1                                        12180000
121900*                                                                 12190000
122000     IF  PS-NO-ERROR                                              12200000
122100         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12210000
122200     END-IF.                                                      12220000
122300*                                                                 12230000
122400     IF  ((PS-NO-ERROR)                                           12240000
122500       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12250000
122600       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12260000
122700             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12270000
122800     END-IF.                                                      12280000
122900 EJECT                                                            12290000
123000*----------------------------------------------------------------*12300000
123100*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12310000
123200*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12320000
123300*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12330000
123400*                                                                *12340000
123500*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12350000
123600*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *12360000
123700*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *12370000
123800*    US IN THE 2ND BLOCK OF THE ARRAY.                           *12380000
123900*----------------------------------------------------------------*12390000
124000                                                                  12400000
124100 3100-SET-SUBSCRIPTS.                                             12410000
124200                                                                  12420000
124300     COMPUTE ASC-ITEM-SUB =                                       12430000
124400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        12440000
124500                                                                  12450000
124600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12460000
124700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            12470000
124800                                                                  12480000
124900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               12490000
125000     ELSE                                                         12500000
125100         MOVE +1                     TO ASC-BLK-SUB               12510000
125200     END-IF.                                                      12520000
125300******************************************************************12530000
125400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **12540000
125500******************************************************************12550000
125600                                                                  12560000
125700 3200-RESET-ATTRIBUTES.                                           12570000
125800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   12580000
125900     MOVE DP015-GREEN              TO ASTRTITC.                   12590000
126000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   12600000
126100*                                                                 12610000
126200     PERFORM                                                      12620000
126300         VARYING PV-SUB                                           12630000
126400         FROM 1 BY 1                                              12640000
126500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        12650000
126600         MOVE DP015-UNP-ALP-NOR-OFF                               12660000
126700                                   TO MR-SELECTA (PV-SUB)         12670000
126800         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         12680000
126900         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         12690000
127000     END-PERFORM.                                                 12700000
127100******************************************************************12710000
127200** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **12720000
127300** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **12730000
127400** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **12740000
127500** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **12750000
127600******************************************************************12760000
127700 3300-EDIT-SELECTIONS.                                            12770000
127800     EVALUATE TRUE                                                12780000
127900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12790000
128000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         12800000
128100                 CONTINUE                                         12810000
128200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         12820000
128300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        12830000
128400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   12840000
128500                 MOVE ASC-TEMP-SELECTED-SW                        12850000
128600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12860000
128700                                TO ASC-SELECTED-SW                12870000
128800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12880000
128900             END-IF                                               12890000
129000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     12900000
129100                 = SPACE                                          12910000
129200             EVALUATE TRUE                                        12920000
129300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       12930000
129400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS12940000
129500                     MOVE SPACE TO ASC-SELECTED-SW                12950000
129600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  12960000
129700                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        12970000
129800                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    12980000
129900                     MOVE SPACE TO ASC-SELECTED-SW                12990000
130000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13000000
130100                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13010000
130200                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13020000
130300                     MOVE SPACE TO ASC-SELECTED-SW                13030000
130400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13040000
130500             END-EVALUATE                                         13050000
130600         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           13060000
130700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13070000
130800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13080000
130900             END-IF                                               13090000
131000             PERFORM 3310-EDIT-RANGE                              13100000
131100         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             13110000
131200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13120000
131300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    13130000
131400             END-IF                                               13140000
131500             PERFORM 3310-EDIT-RANGE                              13150000
131600         WHEN OTHER                                               13160000
131700             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13170000
131800             SET DP020-MSG-FATAL    TO TRUE                       13180000
131900             MOVE -1                TO MR-SELECTL (PV-SUB)        13190000
132000             SET DP030-SET-CURSOR-APPL-1                          13200000
132100                                    TO TRUE                       13210000
132200             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13220000
132300             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13230000
132400             SET PS-ERROR TO TRUE                                 13240000
132500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13250000
132600                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13260000
132700                 MOVE SPACE         TO ASC-SELECTED-SW            13270000
132800                                        (ASC-BLK-SUB ASC-ITEM-SUB)13280000
132900             END-IF                                               13290000
133000     END-EVALUATE.                                                13300000
133100                                                                  13310000
133200     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13320000
133300     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13330000
133400     IF  ASC-ITEM-SUB < 1                                         13340000
133500         SUBTRACT +1 FROM ASC-BLK-SUB                             13350000
133600         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13360000
133700     END-IF.                                                      13370000
133800******************************************************************13380000
133900** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **13390000
134000** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **13400000
134100** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**13410000
134200** THE ENDING.                                                  **13420000
134300******************************************************************13430000
134400 3310-EDIT-RANGE.                                                 13440000
134500     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                13450000
134600         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   13460000
134700             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)13470000
134800                                   TO ASC-SELECTED-SW             13480000
134900                                        (ASC-BLK-SUB ASC-ITEM-SUB)13490000
135000             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 13500000
135100         ELSE                                                     13510000
135200             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     13520000
135300                 CONTINUE                                         13530000
135400             ELSE                                                 13540000
135500*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        13550000
135600                 MOVE PC-TSYMSG-00054                             13560000
135700                                   TO DP020-MSG-NUMBER            13570000
135800                 SET DP020-MSG-FATAL                              13580000
135900                                   TO TRUE                        13590000
136000                 MOVE -1           TO MR-SELECTL (PV-SUB)         13600000
136100                 SET DP030-SET-CURSOR-APPL-1                      13610000
136200                                   TO TRUE                        13620000
136300                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         13630000
136400                 MOVE DP015-UNDERLINE                             13640000
136500                                   TO MR-SELECTH (PV-SUB)         13650000
136600                 SET PS-ERROR      TO TRUE                        13660000
136700             END-IF                                               13670000
136800         END-IF                                                   13680000
136900     ELSE                                                         13690000
137000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     13700000
137100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 13710000
137200                                   TO ASC-SELECTED-SW             13720000
137300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   13730000
137400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   13740000
137500         ELSE                                                     13750000
137600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       13760000
137700                 CONTINUE                                         13770000
137800             ELSE                                                 13780000
137900*                -- ONLY ONE END-OF-RANGE ALLOWED --              13790000
138000                 MOVE PC-TSYMSG-00055                             13800000
138100                                   TO DP020-MSG-NUMBER            13810000
138200                 SET DP020-MSG-FATAL                              13820000
138300                                   TO TRUE                        13830000
138400                 MOVE -1           TO MR-SELECTL (PV-SUB)         13840000
138500                 SET DP030-SET-CURSOR-APPL-1                      13850000
138600                                   TO TRUE                        13860000
138700                 SET PS-ERROR      TO TRUE                        13870000
138800             END-IF                                               13880000
138900         END-IF                                                   13890000
139000     END-IF.                                                      13900000
139100*                                                                 13910000
139200******************************************************************13920000
139300** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **13930000
139400** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **13940000
139500******************************************************************13950000
139600 3400-CHECK-RANGE-SEQUENCE.                                       13960000
139700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       13970000
139800       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      13980000
139900       AND  ASC-START-OF-SELECTED-RANGE >                         13990000
140000                                         ASC-END-OF-SELECTED-RANGE14000000
140100*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14010000
140200         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14020000
140300         SET DP020-MSG-FATAL TO TRUE                              14030000
140400         SET PS-ERROR TO TRUE                                     14040000
140500         PERFORM 3410-POSITION-AT-ERROR                           14050000
140600     END-IF.                                                      14060000
140700******************************************************************14070000
140800** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **14080000
140900** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **14090000
141000** SHOULD BE POSITIONED ON A RANGE ERROR.                       **14100000
141100******************************************************************14110000
141200 3410-POSITION-AT-ERROR.                                          14120000
141300     SET DP030-SET-CURSOR-APPL-1                                  14130000
141400                                   TO TRUE.                       14140000
141500     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 14150000
141600                    - PV-TOP-ITEM + 1.                            14160000
141700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14170000
141800         CONTINUE                                                 14180000
141900     ELSE                                                         14190000
142000         MOVE -1                   TO MR-SELECTL (PV-SUB)         14200000
142100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14210000
142200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14220000
142300     END-IF.                                                      14230000
142400*                                                                 14240000
142500     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   14250000
142600                    - PV-TOP-ITEM + 1.                            14260000
142700     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      14270000
142800         CONTINUE                                                 14280000
142900     ELSE                                                         14290000
143000         MOVE -1                   TO MR-SELECTL (PV-SUB)         14300000
143100         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         14310000
143200         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         14320000
143300     END-IF.                                                      14330000
143400 EJECT                                                            14340000
143500*----------------------------------------------------------------*14350000
143600*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *14360000
143700*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *14370000
143800*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *14380000
143900*----------------------------------------------------------------*14390000
144000                                                                  14400000
144100 3500-MARK-RANGE-AS-SELECTED.                                     14410000
144200     MOVE +1                       TO  ASC-BLK-SUB.               14420000
144300     PERFORM 3510-MARK-SELECTED-INDS                              14430000
144400         VARYING ASC-ITEM-SUB                                     14440000
144500         FROM 1 BY 1                                              14450000
144600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14460000
144700                                                                  14470000
144800     ADD +1                        TO ASC-BLK-SUB.                14480000
144900     PERFORM 3510-MARK-SELECTED-INDS                              14490000
145000         VARYING ASC-ITEM-SUB                                     14500000
145100         FROM 1 BY 1                                              14510000
145200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14520000
145300                                                                  14530000
145400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14540000
145500                                   TO  PV-LIST-ITEM-NUMBER.       14550000
145600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14560000
145700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         14570000
145800               PC-ITEMS-PER-PANEL).                               14580000
145900                                                                  14590000
146000     MOVE ASC-START-OF-SELECTED-RANGE                             14600000
146100                                   TO PV-START-OF-SELECTED-RANGE. 14610000
146200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            14620000
146300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  14630000
146400               PC-ITEMS-PER-PANEL).                               14640000
146500                                                                  14650000
146600     MOVE ASC-END-OF-SELECTED-RANGE                               14660000
146700                                   TO  PV-END-OF-SELECTED-RANGE.  14670000
146800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             14680000
146900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    14690000
147000               PC-ITEMS-PER-PANEL).                               14700000
147100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             14710000
147200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             14720000
147300                                                                  14730000
147400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    14740000
147500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        14750000
147600         MOVE +1                   TO ASC-BLK-SUB                 14760000
147700         PERFORM 5100-WRITE-TEMP-STORAGE                          14770000
147800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14780000
147900             PV-FIRST-BLOCK-IN-ARRAY - 1                          14790000
148000                                                                  14800000
148100         PERFORM                                                  14810000
148200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      14820000
148300                   PV-PREV-BLOCK-IN-ARRAY                         14830000
148400             MOVE PV-FIRST-BLOCK-IN-RANGE                         14840000
148500                                   TO PV-BLOCK-NUMBER             14850000
148600             PERFORM 4410-READ-TEMP-STORAGE                       14860000
148700             PERFORM 3510-MARK-SELECTED-INDS                      14870000
148800                 VARYING ASC-ITEM-SUB                             14880000
148900                 FROM 1 BY 1                                      14890000
149000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14900000
149100             PERFORM 5100-WRITE-TEMP-STORAGE                      14910000
149200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     14920000
149300         END-PERFORM                                              14930000
149400                                                                  14940000
149500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14950000
149600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14960000
149700         PERFORM                                                  14970000
149800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14980000
149900                   PV-LAST-BLOCK-IN-RANGE                         14990000
150000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15000000
150100                                   TO PV-BLOCK-NUMBER             15010000
150200             PERFORM 4410-READ-TEMP-STORAGE                       15020000
150300             PERFORM 3510-MARK-SELECTED-INDS                      15030000
150400                 VARYING ASC-ITEM-SUB                             15040000
150500                 FROM 1 BY 1                                      15050000
150600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15060000
150700             PERFORM 5100-WRITE-TEMP-STORAGE                      15070000
150800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15080000
150900         END-PERFORM                                              15090000
151000                                                                  15100000
151100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15110000
151200                                   TO PV-BLOCK-NUMBER             15120000
151300         PERFORM 4410-READ-TEMP-STORAGE                           15130000
151400     END-IF.                                                      15140000
151500                                                                  15150000
151600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 15160000
151700                                      ASC-END-OF-SELECTED-RANGE.  15170000
151800                                                                  15180000
151900 EJECT                                                            15190000
152000*----------------------------------------------------------------*15200000
152100* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *15210000
152200*----------------------------------------------------------------*15220000
152300                                                                  15230000
152400 3510-MARK-SELECTED-INDS.                                         15240000
152500                                                                  15250000
152600     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15260000
152700                                ASC-ITEM-SUB) >                   15270000
152800         ASC-START-OF-SELECTED-RANGE)                             15280000
152900     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         15290000
153000                                ASC-ITEM-SUB) =                   15300000
153100         ASC-START-OF-SELECTED-RANGE)                             15310000
153200                                                                  15320000
153300         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15330000
153400                                    ASC-ITEM-SUB) <               15340000
153500             ASC-END-OF-SELECTED-RANGE)                           15350000
153600         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     15360000
153700                                    ASC-ITEM-SUB) =               15370000
153800             ASC-END-OF-SELECTED-RANGE)                           15380000
153900                                                                  15390000
154000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15400000
154100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   15410000
154200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   15420000
154300                               TO TRUE                            15430000
154400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              15440000
154500                               TO TRUE                            15450000
154600                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    15460000
154700             END-IF                                               15470000
154800         END-IF                                                   15480000
154900     END-IF.                                                      15490000
155000                                                                  15500000
155100 EJECT                                                            15510000
155200*----------------------------------------------------------------*15520000
155300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *15530000
155400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *15540000
155500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *15550000
155600*    DISPLAY THE PANEL TO USER.                                  *15560000
155700*----------------------------------------------------------------*15570000
155800                                                                  15580000
155900 4000-BUILD-INITIAL-PANEL.                                        15590000
156000                                                                  15600000
156100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            15610000
156200                                 ASC-BLOCK-ENTRIES (2).           15620000
156300     MOVE +1                 TO ASC-BLK-SUB.                      15630000
156400     SET ASC-ITEMS-LEFT-ON-DB                                     15640000
156500                             TO TRUE.                             15650000
156600                                                                  15660000
156700     MOVE +0                 TO ASC-ITEM-SUB                      15670000
156800                                ASC-NUMBER-OF-ITEMS-READ          15680000
156900                                ASC-NUMBER-OF-SELECTED-ITEMS      15690000
157000                                ASC-HIGHEST-BLOCK-WRITTEN         15700000
157100                                ASC-START-OF-SELECTED-RANGE       15710000
157200                                ASC-END-OF-SELECTED-RANGE         15720000
157300                                ASC-ITEM-AT-TOP-OF-PANEL.         15730000
157400     PERFORM 4100-PREPARE-CURSOR                                  15740000
157500                                                                  15750000
157600     PERFORM 4010-OPEN-CURSOR.                                    15760000
157700                                                                  15770000
157800     PERFORM 4300-READ-ITEMS-FROM-DB.                             15780000
157900                                                                  15790000
158000     PERFORM 4020-CLOSE-CURSOR.                                   15800000
158100                                                                  15810000
158200     MOVE +1                   TO  PV-TOP-ITEM.                   15820000
158300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          15830000
158400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    15840000
158500         SET DP020-MSG-FATAL   TO  TRUE                           15850000
158600         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               15860000
158700     ELSE                                                         15870000
158800         MOVE -1               TO MR-SELECTL (1)                  15880000
158900         SET DP030-SET-CURSOR-APPL-1                              15890000
159000                               TO TRUE                            15900000
159100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15910000
159200     END-IF.                                                      15920000
159300 EJECT                                                            15930000
160000                                                                  16000000
160100 4010-OPEN-CURSOR.                                                16010000
160200     PERFORM                                                      16020000
160300         WITH TEST AFTER                                          16030000
160400         VARYING PV-RETRY-COUNTER                                 16040000
160500         FROM 1 BY 1                                              16050000
160600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16060000
160700                   OR (SQLCODE = ZERO))                           16070000
160800             EXEC SQL                                             16080000
160900                  OPEN SKUS-FOR-A-PTAG                            16090000
161000             END-EXEC                                             16100000
161100                                                                  16110000
161200         EVALUATE TRUE                                            16120000
161300             WHEN SQLCODE = ZERO                                  16130000
161400             WHEN SQLCODE = -904                                  16140000
161500             WHEN SQLCODE = -913                                  16150000
161600                 CONTINUE                                         16160000
161700             WHEN SQLWARN0 NOT = SPACES                           16170000
161800             WHEN SQLCODE < ZERO                                  16180000
161900             WHEN SQLCODE > ZERO                                  16190000
162000                 MOVE '4010-OPEN-CURSOR'                          16200000
162100                                   TO DP013-PARAGRAPH             16210000
162200                 MOVE 'OPEN SKUS FOR PTAG CURSOR - '              16220017
162300                                   TO DP013-MESSAGE-TEXT (1)      16230000
162400                 MOVE SQLCA        TO DP013-SQLCA                 16240000
162500                 MOVE 'TMRITST '   TO DP013-DB2-TABLE-NAME (1)    16250017
162600                 SET DP013-DB2-ABEND                              16260000
162700                     DP013-XCTL-DISPLAY-RESTART TO TRUE           16270000
162800                 PERFORM DP013-0000-PROCESS-ABEND                 16280000
162900         END-EVALUATE                                             16290000
163000     END-PERFORM.                                                 16300000
163100*                                                                 16310000
163200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16320000
163300         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             16330000
163400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   16340000
163500                                   TO DP013-MESSAGE-TEXT (1)      16350000
163600         MOVE SQLCA                TO DP013-SQLCA                 16360000
163700         MOVE 'TMRITST '           TO DP013-DB2-TABLE-NAME (1)    16370017
163800         SET DP013-DB2-ABEND                                      16380000
163900             DP013-XCTL-DISPLAY-RESTART                           16390000
164000                                   TO TRUE                        16400000
164100         PERFORM DP013-0000-PROCESS-ABEND                         16410000
164200     END-IF.                                                      16420000
164300                                                                  16430000
164400 EJECT                                                            16440000
165100                                                                  16510000
165200 4020-CLOSE-CURSOR.                                               16520000
165300                                                                  16530000
165400     EXEC SQL                                                     16540000
165500          CLOSE SKUS-FOR-A-PTAG                                   16550000
165600     END-EXEC.                                                    16560000
165700*                                                                 16570000
165800     EVALUATE TRUE                                                16580000
165900         WHEN SQLCODE = ZERO                                      16590000
166000             CONTINUE                                             16600000
166100         WHEN SQLWARN0 NOT = SPACES                               16610000
166200         WHEN SQLCODE < ZERO                                      16620000
166300         WHEN SQLCODE > ZERO                                      16630000
166400             MOVE '4020-CLOSE-CURSOR'                             16640000
166500                               TO DP013-PARAGRAPH                 16650000
166600             MOVE 'CLOSE SKUS FOR PTAG CURSOR'                    16660017
166700                               TO DP013-MESSAGE-TEXT (1)          16670000
166800             MOVE SQLCA        TO DP013-SQLCA                     16680000
166900             MOVE 'TMRITST '   TO DP013-DB2-TABLE-NAME (1)        16690017
167000             SET DP013-DB2-ABEND                                  16700000
167100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               16710000
167200             PERFORM DP013-0000-PROCESS-ABEND                     16720000
167300     END-EVALUATE.                                                16730000
167400                                                                  16740000
167500 EJECT                                                            16750000
167600*----------------------------------------------------------------*16760000
167700*    SET UP THE HOST VARIABLES.                                  *16770000
167800*----------------------------------------------------------------*16780000
167900                                                                  16790000
168000 4100-PREPARE-CURSOR.                                             16800000
168100                                                                  16810000
169200     MOVE ASC-KEY-PTAG                TO PV-PTAG.                 16920000
169300                                                                  16930000
169400 EJECT                                                            16940000
169500*----------------------------------------------------------------*16950000
169600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *16960000
169700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *16970000
169800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *16980000
169900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *16990000
170000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17000000
170100*                                                                *17010000
170200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17020000
170300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17030000
170400*    UPON INITIALIZATION.                                        *17040000
170500*----------------------------------------------------------------*17050000
170700 4300-READ-ITEMS-FROM-DB.                                         17070000
170800                                                                  17080000
170900     PERFORM                                                      17090000
171000         VARYING PV-READ-COUNT                                    17100000
171100         FROM 1 BY 1                                              17110000
171200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    17120000
171300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         17130000
171400                                                                  17140000
171500         PERFORM 4310-FETCH                                       17150000
171600                                                                  17160000
171700         IF  ASC-ITEMS-LEFT-ON-DB                                 17170000
171800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                17180000
171900                 ADD +1            TO ASC-ITEM-SUB                17190000
172000             ELSE                                                 17200000
172100                 ADD +1            TO ASC-BLK-SUB                 17210000
172200                 MOVE +1           TO ASC-ITEM-SUB                17220000
172300                                                                  17230000
172400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         17240000
172500                     MOVE +1       TO ASC-BLK-SUB                 17250000
172600                     SET ASC-BLOCK-MODIFIED (1)                   17260000
172700                                   TO TRUE                        17270000
172800                     PERFORM 5100-WRITE-TEMP-STORAGE              17280000
172900                     MOVE ASC-BLOCK-ENTRIES                       17290000
173000                               (PC-MAX-BLOCKS-IN-ARRAY)           17300000
173100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 17310000
173200                     ADD +1        TO ASC-BLK-SUB                 17320000
173300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   17330000
173400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      17340000
173500                                   TO TRUE                        17350000
173600                 END-IF                                           17360000
173700             END-IF                                               17370000
173800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    17380000
173900             MOVE ASC-NUMBER-OF-ITEMS-READ                        17390000
174000                                   TO ASC-LIST-ITEM-NUMBER        17400000
174100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17410000
174200             MOVE MRITST-PTAG-ID   TO  ASC-PTAG                   17420000
174300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17430000
174400             MOVE SKXREF-DEPT      TO  ASC-DEPT                   17440001
174500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17450001
174600             MOVE SKXREF-CLASS     TO  ASC-CLASS                  17460001
174700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17470001
174800             MOVE SKXREF-SUBCLASS  TO  ASC-SUBCLASS               17480001
174810                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17481001
174820             MOVE SKXREF-SKU       TO  ASC-SKU                    17482001
174830                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17483001
174900             MOVE TSK-SKU-DESC     TO  ASC-DESCRIPTION            17490000
175000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17500000
175100             MOVE TSK-SIZE-DESC    TO  ASC-SIZE                   17510000
175200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17520000
175300             MOVE TSK-COLOR-DESC   TO  ASC-COLOR                  17530000
175400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 17540000
175500         END-IF                                                   17550000
175600     END-PERFORM.                                                 17560000
175700                                                                  17570000
175800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          17580000
175900         MOVE +1               TO ASC-BLK-SUB                     17590000
176000         PERFORM 5100-WRITE-TEMP-STORAGE                          17600000
176100         ADD +1                TO ASC-BLK-SUB                     17610000
176200         PERFORM 5100-WRITE-TEMP-STORAGE                          17620000
176300                                                                  17630000
176400         MOVE 1                TO ASC-BLK-SUB                     17640000
176500                                  PV-BLOCK-NUMBER                 17650000
176600         PERFORM 4410-READ-TEMP-STORAGE                           17660000
176700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             17670000
176800             MOVE 2            TO ASC-BLK-SUB                     17680000
176900                                  PV-BLOCK-NUMBER                 17690000
177000             PERFORM 4410-READ-TEMP-STORAGE                       17700000
177100         END-IF                                                   17710000
177200     END-IF.                                                      17720000
177300 EJECT                                                            17730000
177710******************************************************************17771005
177720* MRNIS-RFC   PREVIOUS   DEPT, CLASS AND SKU FROM TSK OF FS       17772005
177730* MRNIS-RFC   CURRENT    DEPT, CLASS, SUBCLASS, SKU FROM TSKXREF  17773005
177740* MRNIS-RFC   FUTURE     REMOVE ACCESS TO TSKXREF                 17774005
177750******************************************************************17775005
177800 4310-FETCH.                                                      17780000
177900                                                                  17790000
177910     PERFORM                                                      17791018
177920         WITH TEST AFTER                                          17792018
177930         VARYING PV-SQL-SUB                                       17793018
177940         FROM 1 BY 1                                              17794018
177950         UNTIL PV-SQL-SUB > PC-MAX-RETRIES                        17795018
177960           OR (SQLCODE EQUAL ZERO OR +100)                        17796018
177970                                                                  17797018
178000         EXEC SQL                                                 17800018
178100              FETCH SKUS-FOR-A-PTAG                               17810018
178200              INTO                                                17820018
178300                    :MRITST-PTAG-ID                               17830018
178400                  , :SKXREF-DEPT                                  17840018
178500                  , :SKXREF-CLASS                                 17850018
178600                  , :SKXREF-SUBCLASS                              17860018
178610                  , :SKXREF-SKU                                   17861018
178700                  , :TSK-SKU-DESC                                 17870018
178800                  , :TSK-SIZE-DESC                                17880018
178900                  , :TSK-COLOR-DESC                               17890018
179000                  , :MRITST-ITEM-NBR                              17900018
179100         END-EXEC                                                 17910018
179200                                                                  17920018
179300         EVALUATE TRUE                                            17930018
179400             WHEN SQLCODE = ZERO                                  17940018
179500             WHEN SQLCODE = +100                                  17950018
179600                  CONTINUE                                        17960018
179700             WHEN SQLWARN0 NOT = SPACE                            17970018
179800             WHEN SQLCODE NOT = ZERO                              17980018
179900                  MOVE '4310-FETCH-CURSOR'                        17990018
180000                                   TO DP013-PARAGRAPH             18000018
180100                  MOVE 'FETCH PTAG CURSOR'                        18010018
180200                                   TO DP013-MESSAGE-TEXT (1)      18020018
180300                  MOVE SQLCA       TO DP013-SQLCA                 18030018
180400                  SET DP013-DB2-ABEND                             18040018
180500                                   TO TRUE                        18050018
180600                  PERFORM DP013-0000-PROCESS-ABEND                18060018
180700         END-EVALUATE                                             18070018
180710     END-PERFORM.                                                 18071018
180800                                                                  18080000
180801     IF  PV-SQL-SUB > PC-MAX-RETRIES                              18080118
180802         MOVE 'MAX RETRIES EXCEEDED ON SELECT'                    18080218
180803                                 TO DP013-MESSAGE-TEXT (1)        18080318
180804         MOVE SQLCA              TO DP013-SQLCA                   18080418
180805         MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)      18080518
180806         SET DP013-DB2-ABEND                                      18080618
180807             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18080718
180808         PERFORM DP013-0000-PROCESS-ABEND                         18080818
180809     END-IF.                                                      18080918
180810                                                                  18081018
180900     IF  SQLCODE EQUAL +100                                       18090000
181000         SET ASC-NO-ITEMS-LEFT-ON-DB                              18100000
181100                                   TO TRUE                        18110000
181200     END-IF.                                                      18120000
181300                                                                  18130000
181400 EJECT                                                            18140000
181500*----------------------------------------------------------------*18150000
181600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18160000
181700*----------------------------------------------------------------*18170000
181800                                                                  18180000
181900 4400-MOVE-COMMAREA-TO-SCREEN.                                    18190000
182000     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18200000
182100         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18210000
182200         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18220000
182300             MOVE +1    TO ASC-BLK-SUB                            18230000
182400             PERFORM 5100-WRITE-TEMP-STORAGE                      18240000
182500             ADD +1     TO ASC-BLK-SUB                            18250000
182600             PERFORM 5100-WRITE-TEMP-STORAGE                      18260000
182700             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             18270000
182800                 GIVING PV-BLOCK-NUMBER                           18280000
182900                 REMAINDER PV-REMAINDER                           18290000
183000             IF  PV-REMAINDER > ZERO                              18300000
183100                 ADD +1 TO PV-BLOCK-NUMBER                        18310000
183200             END-IF                                               18320000
183300             MOVE +1    TO ASC-BLK-SUB                            18330000
183400             PERFORM 4410-READ-TEMP-STORAGE                       18340000
183500             ADD +1     TO ASC-BLK-SUB                            18350000
183600                           PV-BLOCK-NUMBER                        18360000
183700             PERFORM 4410-READ-TEMP-STORAGE                       18370000
183800     END-IF.                                                      18380000
183900     MOVE +1            TO ASC-BLK-SUB.                           18390000
184000     COMPUTE ASC-ITEM-SUB =                                       18400000
184100         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              18410000
184200         + PC-ITEMS-PER-PANEL).                                   18420000
184300*                                                                 18430000
184400     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18440000
184500         ADD +1         TO ASC-BLK-SUB                            18450000
184600         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            18460000
184700     END-IF.                                                      18470000
184800*                                                                 18480000
184900     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           18490000
185000         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                18500000
185100     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        18510000
185200     PERFORM 4420-FORMAT-LIST-LINES                               18520000
185300         VARYING PV-SUB                                           18530000
185400         FROM PC-ITEMS-PER-PANEL BY -1                            18540000
185500         UNTIL PV-SUB < +1.                                       18550000
185600*                                                                 18560000
185700     COMPUTE ASC-ITEMS-DISPLAYED =                                18570000
185800         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          18580000
185900     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    18590000
186000                                      ASTRTITO.                   18600000
186100     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    18610000
186200     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    18620000
186300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            18630000
186400                                   TO ASELITO.                    18640000
186500*                                                                 18650000
186600     IF  DP020-MSG-NUMBER-X = SPACE                               18660000
186700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  18670000
186800*            --- MORE ITEMS TO DISPLAY ----                       18680000
186900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            18690000
187000             SET DP020-MSG-INFORMATIONAL TO TRUE                  18700000
187100         END-IF                                                   18710000
187200     END-IF.                                                      18720000
187300*----------------------------------------------------------------*18730000
187400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *18740000
187500*----------------------------------------------------------------*18750000
187600                                                                  18760000
187700 4410-READ-TEMP-STORAGE.                                          18770000
187800                                                                  18780000
187900     EXEC CICS                                                    18790000
188000         READQ TS                                                 18800000
188100             QUEUE (ASC-LIST-QUEUE-NAME)                          18810000
188200             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               18820000
188300             ITEM  (PV-BLOCK-NUMBER)                              18830000
188400             RESP  (PV-CICS-RESP)                                 18840000
188500     END-EXEC.                                                    18850000
188600                                                                  18860000
188700     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       18870000
188800       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     18880000
188900         CONTINUE                                                 18890000
189000     ELSE                                                         18900000
189100         SET DP013-CICS-ABEND     TO TRUE                         18910000
189200         SET DP013-NO-ROLLBACK    TO TRUE                         18920000
189300         MOVE '4410-READ-TEMP-STORAGE'                            18930000
189400                                  TO DP013-PARAGRAPH              18940000
189500         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      18950000
189600                                  TO DP013-MESSAGE-TEXT(1)        18960000
189700         PERFORM DP013-0000-PROCESS-ABEND                         18970000
189800     END-IF.                                                      18980000
189900                                                                  18990000
190000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19000000
190100*                                                                 19010000
190200     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19020000
190300         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19030000
190400     END-IF.                                                      19040000
190500 EJECT                                                            19050000
190600*----------------------------------------------------------------*19060000
190700*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19070000
190800*----------------------------------------------------------------*19080000
190900                                                                  19090000
191000 4420-FORMAT-LIST-LINES.                                          19100000
191100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19110000
191200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19120000
191300         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19130000
191400         MOVE SPACE              TO MR-SELECTI (PV-SUB)           19140000
191500                                    MR-ACTION (PV-SUB)            19150000
191600                                    MR-PTAG (PV-SUB)              19160000
191700                                    MR-DEPT (PV-SUB)              19170001
191710                                    MR-CLASS (PV-SUB)             19171001
191720                                    MR-SCLASS (PV-SUB)            19172001
191730                                    MR-SKU (PV-SUB)               19173001
191800                                    MR-DESCRIPTION (PV-SUB)       19180000
191900                                    MR-SIZE (PV-SUB)              19190000
192000                                    MR-COLOR (PV-SUB)             19200000
192100     ELSE                                                         19210000
192200         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19220000
192300                                                   > SPACE        19230000
192400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19240000
192500                                 TO MR-SELECTI (PV-SUB)           19250000
192600         ELSE                                                     19260000
192700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19270000
192800                                 TO MR-SELECTI (PV-SUB)           19280000
192900         END-IF                                                   19290000
193000*                                                                 19300000
193100         IF  DP030-SET-CURSOR-TRAILER                             19310000
193200             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)19320000
193300                 > SPACE)                                         19330000
193400               OR (PV-SUB = 1))                                   19340000
193500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               19350000
193600                MOVE -1          TO MR-SELECTL (PV-SUB)           19360000
193700             END-IF                                               19370000
193800         END-IF                                                   19380000
193900*                                                                 19390000
194000         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           19400000
194100             MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)           19410000
194200                                 TO MR-ACTION (PV-SUB)            19420000
194300             MOVE ASC-PTAG (ASC-BLK-SUB ASC-ITEM-SUB)             19430000
194400                                 TO MR-PTAG (PV-SUB)              19440000
194500             MOVE ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)             19450008
194600                                 TO MR-DEPT (PV-SUB)              19460008
194610             MOVE ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)            19461008
194620                                 TO MR-CLASS (PV-SUB)             19462008
194630             MOVE ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)         19463008
194640                                 TO MR-SCLASS (PV-SUB)            19464008
194650             MOVE ASC-SKU (ASC-BLK-SUB ASC-ITEM-SUB)              19465008
194660                                 TO MR-SKU (PV-SUB)               19466008
194700             MOVE ASC-DESCRIPTION (ASC-BLK-SUB ASC-ITEM-SUB)      19470000
194800                                 TO MR-DESCRIPTION (PV-SUB)       19480000
194900             MOVE ASC-SIZE (ASC-BLK-SUB ASC-ITEM-SUB)             19490000
195000                                 TO MR-SIZE (PV-SUB)              19500000
195100             MOVE ASC-COLOR (ASC-BLK-SUB ASC-ITEM-SUB)            19510000
195200                                 TO MR-COLOR (PV-SUB)             19520000
195300         END-IF                                                   19530000
195400     END-IF.                                                      19540000
195500     SUBTRACT +1 FROM ASC-ITEM-SUB                                19550000
195600     IF  ASC-ITEM-SUB < + 1                                       19560000
195700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  19570000
195800         MOVE +1                 TO ASC-BLK-SUB                   19580000
195900     END-IF.                                                      19590000
196000******************************************************************19600000
196100** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **19610000
196200** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **19620000
196300** ISSUE A WARNING.                                             **19630000
196400******************************************************************19640000
196500 4430-CHECK-FOR-BEGIN-AND-END.                                    19650000
196600     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19660000
196700         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     19670000
196800*            -- NO END-OF-RANGE SPECFIED ---                      19680000
196900             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            19690000
197000             SET DP020-MSG-WARNING TO TRUE                        19700000
197100             PERFORM 4431-POSITION-AT-WARNING                     19710000
197200         END-IF                                                   19720000
197300     ELSE                                                         19730000
197400         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     19740000
197500*            -- NO BEGINNING-OF-RANGE SPECFIED ---                19750000
197600             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            19760000
197700             SET DP020-MSG-WARNING TO TRUE                        19770000
197800             PERFORM 4431-POSITION-AT-WARNING                     19780000
197900         END-IF                                                   19790000
198000     END-IF.                                                      19800000
198100******************************************************************19810000
198200** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **19820000
198300** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **19830000
198400** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **19840000
198500** POSITION THE CURSOR THERE.                                   **19850000
198600******************************************************************19860000
198700 4431-POSITION-AT-WARNING.                                        19870000
198800     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19880000
198900                    - PV-TOP-ITEM + 1.                            19890000
199000     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19900000
199100         CONTINUE                                                 19910000
199200     ELSE                                                         19920000
199300         SET DP030-SET-CURSOR-APPL-1                              19930000
199400                                   TO TRUE                        19940000
199500         MOVE -1                   TO MR-SELECTL (PV-SUB)         19950000
199600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19960000
199700         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         19970000
199800     END-IF.                                                      19980000
199900*                                                                 19990000
200000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20000000
200100                    - PV-TOP-ITEM + 1.                            20010000
200200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20020000
200300         CONTINUE                                                 20030000
200400     ELSE                                                         20040000
200500         SET DP030-SET-CURSOR-APPL-1                              20050000
200600                                   TO TRUE                        20060000
200700         MOVE -1                   TO MR-SELECTL (PV-SUB)         20070000
200800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20080000
200900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20090000
201000     END-IF.                                                      20100000
201100 EJECT                                                            20110000
201200*----------------------------------------------------------------*20120000
201300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20130000
201400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20140000
201500* FOR THE SELECTED ITEMS QUEUE.                                  *20150000
201600*                                                                *20160000
201700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20170000
201800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20180000
201900* THE ARRAY IS FULL.                                             *20190000
202000*----------------------------------------------------------------*20200000
202100                                                                  20210000
202200 5000-PREPARE-SEL-QUEUE.                                          20220000
202300                                                                  20230000
202400     MOVE +1                   TO  ASC-BLK-SUB.                   20240000
202500     PERFORM 5100-WRITE-TEMP-STORAGE.                             20250000
202600     ADD +1                    TO  ASC-BLK-SUB.                   20260000
202700     PERFORM 5100-WRITE-TEMP-STORAGE.                             20270000
202800                                                                  20280000
202900     MOVE ASC-SEL-QUEUE-NAME   TO  MR102-SEL-QUEUE-NAME.          20290000
203000     PERFORM 6010-DELETE-SEL-QUEUE.                               20300000
203100                                                                  20310000
203200     SET ASC-UPDATE-TSQ        TO  TRUE.                          20320000
203300                                                                  20330000
203400     SET MR115-IDX             TO  1.                             20340000
203500     MOVE ZERO                 TO MR102-NUMBER-OF-TS-ITEMS.       20350000
203600     INITIALIZE MR115-SELECTED-ITEM-ARRAY.                        20360000
203700                                                                  20370000
203800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           20380000
203900             VARYING PV-ITEM                                      20390000
204000             FROM 1 BY 1                                          20400000
204100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     20410000
204200                                                                  20420000
204300     IF  MR115-IDX > 1                                            20430000
204400         PERFORM 5205-WRITE-SEL-QUEUE                             20440000
204500         ADD +1                TO MR102-NUMBER-OF-TS-ITEMS        20450000
204600     END-IF.                                                      20460000
204700 EJECT                                                            20470000
204800*----------------------------------------------------------------*20480000
204900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *20490000
205000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *20500000
205100*----------------------------------------------------------------*20510000
205200                                                                  20520000
205300 5100-WRITE-TEMP-STORAGE.                                         20530000
205400     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     20540000
205500                                   TO PV-LIST-ITEM-NUMBER.        20550000
205600     COMPUTE PV-BLOCK-NUMBER =                                    20560000
205700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    20570000
205800                                                                  20580000
205900     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             20590000
206000     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             20600000
206100         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      20610000
206200             PERFORM 5105-REWRITE-ASC-LISTQ                       20620000
206300         END-IF                                                   20630000
206400     ELSE                                                         20640000
206500         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       20650000
206600         ASC-HIGHEST-BLOCK-WRITTEN + 1                            20660000
206700         PERFORM 5110-WRITE-ASC-LISTQ                             20670000
206800         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   20680000
206900     END-IF.                                                      20690000
207000                                                                  20700000
207100     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20710000
207200******************************************************************20720000
207300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **20730000
207400** SPECIFIC COMMAREA.                                           **20740000
207500******************************************************************20750000
207600 5105-REWRITE-ASC-LISTQ.                                          20760000
207700     EXEC CICS                                                    20770000
207800         WRITEQ TS                                                20780000
207900             QUEUE (ASC-LIST-QUEUE-NAME)                          20790000
208000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20800000
208100             ITEM  (PV-BLOCK-NUMBER)                              20810000
208200             REWRITE                                              20820000
208300             RESP  (PV-CICS-RESP)                                 20830000
208400     END-EXEC.                                                    20840000
208500                                                                  20850000
208600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           20860000
208700         CONTINUE                                                 20870000
208800     ELSE                                                         20880000
208900         SET DP013-CICS-ABEND            TO TRUE                  20890000
209000         SET DP013-NO-ROLLBACK           TO TRUE                  20900000
209100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       20910000
209200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     20920000
209300                                         TO DP013-MESSAGE-TEXT(1) 20930000
209400         PERFORM DP013-0000-PROCESS-ABEND                         20940000
209500     END-IF.                                                      20950000
209600                                                                  20960000
209700******************************************************************20970000
209800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **20980000
209900** SPECIFIC COMMAREA.                                           **20990000
210000******************************************************************21000000
210100 5110-WRITE-ASC-LISTQ.                                            21010000
210200     EXEC CICS                                                    21020000
210300         WRITEQ TS                                                21030000
210400             QUEUE (ASC-LIST-QUEUE-NAME)                          21040000
210500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               21050000
210600             ITEM  (PV-BLOCK-NUMBER)                              21060000
210700             RESP  (PV-CICS-RESP)                                 21070000
210800     END-EXEC.                                                    21080000
210900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      21090000
211000         SET DP013-CICS-ABEND      TO TRUE                        21100000
211100         SET DP013-NO-ROLLBACK     TO TRUE                        21110000
211200         MOVE '5110-WRITE-ASC-LISTQ'                              21120000
211300                                   TO DP013-PARAGRAPH             21130000
211400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           21140000
211500                                   TO DP013-MESSAGE-TEXT(1)       21150000
211600         PERFORM DP013-0000-PROCESS-ABEND                         21160000
211700     END-IF.                                                      21170000
211800 EJECT                                                            21180000
211900*----------------------------------------------------------------*21190000
212000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *21200000
212100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *21210000
212200*----------------------------------------------------------------*21220000
212300                                                                  21230000
212400 5200-FILL-SEL-QUEUE-RECORD.                                      21240000
212500                                                                  21250000
212600     PERFORM 6112-READ-LIST-QUEUE.                                21260000
212700                                                                  21270000
212800     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       21280000
212900         PERFORM                                                  21290000
213000         VARYING LQW-IDX                                          21300000
213100         FROM 1 BY 1                                              21310000
213200         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            21320000
213300           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          21330000
213400                                                                  21340000
213500             IF  LQW-SELECT (LQW-IDX)                             21350000
213600                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              21360000
213700                                   TO MR115-ITEM (MR115-IDX)      21370000
213800                 MOVE LQW-SKU (LQW-IDX)                           21380000
213900                                   TO MR115-SKU (MR115-IDX)       21390000
214001                                      ASC-KEY-SKU                 21400123
214002                 MOVE LQW-DEPT (LQW-IDX)                          21400214
214003                                   TO MR115-DEPT (MR115-IDX)      21400314
214004                                      ASC-KEY-DEPT                21400414
214005                 MOVE LQW-CLASS (LQW-IDX)                         21400514
214006                                   TO MR115-CLASS (MR115-IDX)     21400614
214007                                      ASC-KEY-CLASS               21400714
214008                 MOVE LQW-SCLASS (LQW-IDX)                        21400814
214009                                   TO MR115-SUBCLASS (MR115-IDX)  21400914
214010                                      ASC-KEY-SUBCLASS            21401014
214400                 MOVE LQW-PTAG (LQW-IDX)                          21440000
214500                                   TO MR115-PTAG (MR115-IDX)      21450000
214600                                      ASC-KEY-PTAG                21460000
214700                 MOVE LQW-DESCRIPTION (LQW-IDX)                   21470000
214800                                 TO MR115-DESCRIPTION (MR115-IDX) 21480000
214900                 MOVE LQW-SIZE (LQW-IDX)                          21490000
215000                                   TO MR115-SIZE (MR115-IDX)      21500000
215100                 MOVE LQW-COLOR (LQW-IDX)                         21510000
215200                                   TO MR115-COLOR (MR115-IDX)     21520000
215300                 SET MR115-IDX UP BY 1                            21530000
215400                 IF  MR115-IDX > MR115-MAX-ITEMS                  21540000
215500                     PERFORM 5205-WRITE-SEL-QUEUE                 21550000
215600                     ADD +1        TO MR102-NUMBER-OF-TS-ITEMS    21560000
215700                     INITIALIZE MR115-SELECTED-ITEM-ARRAY         21570000
215800                     SET MR115-IDX TO  1                          21580000
215900                 END-IF                                           21590000
216000             END-IF                                               21600000
216100         END-PERFORM                                              21610000
216200     END-IF.                                                      21620000
216300                                                                  21630000
216400*----------------------------------------------------------------*21640000
216500*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *21650000
216600*----------------------------------------------------------------*21660000
216700                                                                  21670000
216800 5205-WRITE-SEL-QUEUE.                                            21680000
216900                                                                  21690000
217000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            21700000
217100                                   TO MR115-SELECTED-ITEMS.       21710000
217200                                                                  21720000
217300     EXEC CICS                                                    21730000
217400          WRITEQ TS                                               21740000
217500              QUEUE (ASC-SEL-QUEUE-NAME)                          21750000
217600              FROM  (MR115-MESSAGE-SEL-REC)                       21760000
217700              ITEM  (PV-SEL-QUEUE-ITEM)                           21770000
217800              RESP  (PV-CICS-RESP)                                21780000
217900     END-EXEC.                                                    21790000
218000                                                                  21800000
218100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          21810000
218200         CONTINUE                                                 21820000
218300     ELSE                                                         21830000
218400         SET DP013-CICS-ABEND      TO TRUE                        21840000
218500         SET DP013-NO-ROLLBACK     TO TRUE                        21850000
218600         MOVE '5205-WRITE-SEL-QUEUE'                              21860000
218700                                   TO DP013-PARAGRAPH             21870000
218800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          21880000
218900                                   TO DP013-MESSAGE-TEXT(1)       21890000
219000         PERFORM DP013-0000-PROCESS-ABEND                         21900000
219100     END-IF.                                                      21910000
219200 EJECT                                                            21920000
219300******************************************************************21930000
219400** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **21940000
219500** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **21950000
219600** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **21960000
219700** THE USER.                                                    **21970000
219800******************************************************************21980000
219900 6000-REFRESH-PANEL-FROM-TEMP.                                    21990000
220000     IF  ASC-UPDATE-TSQ                                           22000000
220100         SET ASC-NO-TSQ-UPDATE TO TRUE                            22010000
220200         MOVE ZERO                 TO PV-SAVE-ITEM                22020000
220300                                      PV-SEL-QUEUE-ITEM           22030000
220400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        22040000
220500                                   TO PV-HOLD-SELECTED-ITEMS      22050000
220600         PERFORM 6100-UPDATE-TSQ                                  22060000
220700             UNTIL PV-ITEMS-PROCESSED >                           22070000
220800                                     ASC-NUMBER-OF-SELECTED-ITEMS 22080000
220900         PERFORM 6010-DELETE-SEL-QUEUE                            22090000
221000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         22100000
221100                    ASC-BLOCK-ENTRIES (2)                         22110000
221200     END-IF.                                                      22120000
221300                                                                  22130000
221400*----------------------------------------------------------------*22140000
221500*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *22150000
221600*----------------------------------------------------------------*22160000
221700 6010-DELETE-SEL-QUEUE.                                           22170000
221800                                                                  22180000
221900     EXEC CICS                                                    22190000
222000         DELETEQ TS                                               22200000
222100             QUEUE (ASC-SEL-QUEUE-NAME)                           22210000
222200             RESP  (PV-CICS-RESP)                                 22220000
222300     END-EXEC.                                                    22230000
222400*                                                                 22240000
222500     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      22250000
222600        (PV-CICS-RESP = DFHRESP(QIDERR)))                         22260000
222700         CONTINUE                                                 22270000
222800     ELSE                                                         22280000
222900         SET DP013-CICS-ABEND TO TRUE                             22290000
223000         SET DP013-NO-ROLLBACK TO TRUE                            22300000
223100         MOVE '6010-DELETE-SEL-QUEUE'                             22310000
223200                        TO DP013-PARAGRAPH                        22320000
223300         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         22330000
223400                        TO DP013-MESSAGE-TEXT (1)                 22340000
223500         PERFORM DP013-0000-PROCESS-ABEND                         22350000
223600     END-IF.                                                      22360000
223700                                                                  22370000
223800*----------------------------------------------------------------*22380000
223900*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *22390000
224000*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *22400000
224100*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *22410000
224200*    THE TEMP QUEUE.                                             *22420000
224300*----------------------------------------------------------------*22430000
224400                                                                  22440000
224500 6100-UPDATE-TSQ.                                                 22450000
224600                                                                  22460000
224700     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             22470000
224800     PERFORM 6105-READ-SEL-QUEUE.                                 22480000
224900     PERFORM                                                      22490000
225000         VARYING MR115-IDX                                        22500000
225100         FROM 1 BY 1                                              22510000
225200         UNTIL ((PV-ITEMS-PROCESSED >                             22520000
225300                              PV-HOLD-SELECTED-ITEMS)             22530000
225400         OR (MR115-IDX GREATER THAN MR115-MAX-ITEMS))             22540000
225500         IF  MR115-ACTION-SW (MR115-IDX) > SPACE                  22550000
225600             PERFORM 6110-PROCESS-ITEMS                           22560000
225700         END-IF                                                   22570000
225800         ADD +1                TO PV-ITEMS-PROCESSED              22580000
225900     END-PERFORM.                                                 22590000
226000     PERFORM 6111-WRITE-LIST-QUEUE.                               22600000
226100*----------------------------------------------------------------*22610000
226200*    READ THE LIST QUEUE RECORD.                                 *22620000
226300*----------------------------------------------------------------*22630000
226400                                                                  22640000
226500 6105-READ-SEL-QUEUE.                                             22650000
226600                                                                  22660000
226700     EXEC CICS                                                    22670000
226800          READQ TS                                                22680000
226900              QUEUE (ASC-SEL-QUEUE-NAME)                          22690000
227000              INTO  (MR115-MESSAGE-SEL-REC)                       22700000
227100              ITEM  (PV-SEL-QUEUE-ITEM)                           22710000
227200              RESP  (PV-CICS-RESP)                                22720000
227300     END-EXEC.                                                    22730000
227400*                                                                 22740000
227500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          22750000
227600         CONTINUE                                                 22760000
227700     ELSE                                                         22770000
227800         SET DP013-CICS-ABEND      TO  TRUE                       22780000
227900         SET DP013-NO-ROLLBACK     TO  TRUE                       22790000
228000         MOVE '6105-READ-SEL-QUEUE'                               22800000
228100                                   TO  DP013-PARAGRAPH            22810000
228200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           22820000
228300                                   TO  DP013-MESSAGE-TEXT(1)      22830000
228400         PERFORM DP013-0000-PROCESS-ABEND                         22840000
228500     END-IF.                                                      22850000
228600 EJECT                                                            22860000
228700*----------------------------------------------------------------*22870000
228800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*22880000
228900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*22890000
229000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *22900000
229100*----------------------------------------------------------------*22910000
229200                                                                  22920000
229300 6110-PROCESS-ITEMS.                                              22930000
229400                                                                  22940000
229500     COMPUTE PV-ITEM = 1 + ((MR115-ITEM (MR115-IDX) - 1)          22950000
229600                     / PC-ITEMS-PER-PANEL).                       22960000
229700                                                                  22970000
229800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           22980000
229900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          22990000
230000             PERFORM 6111-WRITE-LIST-QUEUE                        23000000
230100         END-IF                                                   23010000
230200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    23020000
230300                                                                  23030000
230400         PERFORM 6112-READ-LIST-QUEUE                             23040000
230500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               23050000
230600             CONTINUE                                             23060000
230700         END-IF                                                   23070000
230800     END-IF.                                                      23080000
230900                                                                  23090000
231000     COMPUTE PV-SUB = (MR115-ITEM (MR115-IDX)                     23100000
231100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              23110000
231200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         23120000
231300     MOVE LQW-SELECTED-SW (PV-SUB)                                23130000
231400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  23140000
231500     EVALUATE TRUE                                                23150000
231600         WHEN MR115-INQ (MR115-IDX)                               23160000
231700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             23170000
231800                                                                  23180000
231900         WHEN MR115-UPD (MR115-IDX)                               23190000
232000              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             23200000
232100                                                                  23210000
232200         WHEN MR115-DEL (MR115-IDX)                               23220000
232300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             23230000
232400                                                                  23240000
232500         WHEN MR115-ERR (MR115-IDX)                               23250000
232600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             23260000
232700     END-EVALUATE.                                                23270000
232800                                                                  23280000
232900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                23290000
233000                                                                  23300000
233100*----------------------------------------------------------------*23310000
233200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *23320000
233300*----------------------------------------------------------------*23330000
233400                                                                  23340000
233500 6111-WRITE-LIST-QUEUE.                                           23350000
233600                                                                  23360000
233700     EXEC CICS                                                    23370000
233800         WRITEQ TS                                                23380000
233900             QUEUE (ASC-LIST-QUEUE-NAME)                          23390000
234000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     23400000
234100             ITEM  (PV-SAVE-ITEM)                                 23410000
234200             REWRITE                                              23420000
234300             RESP  (PV-CICS-RESP)                                 23430000
234400     END-EXEC.                                                    23440000
234500*                                                                 23450000
234600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23460000
234700         CONTINUE                                                 23470000
234800     ELSE                                                         23480000
234900         SET DP013-CICS-ABEND  TO  TRUE                           23490000
235000         SET DP013-NO-ROLLBACK TO  TRUE                           23500000
235100         MOVE '6111-WRITE-LIST-QUEUE'                             23510000
235200                               TO  DP013-PARAGRAPH                23520000
235300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  23530000
235400                               TO  DP013-MESSAGE-TEXT(1)          23540000
235500         PERFORM DP013-0000-PROCESS-ABEND                         23550000
235600     END-IF.                                                      23560000
235700                                                                  23570000
235800 EJECT                                                            23580000
235900*----------------------------------------------------------------*23590000
236000*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*23600000
236100*----------------------------------------------------------------*23610000
236200                                                                  23620000
236300 6112-READ-LIST-QUEUE.                                            23630000
236400                                                                  23640000
236500     EXEC CICS                                                    23650000
236600         READQ TS                                                 23660000
236700             QUEUE (ASC-LIST-QUEUE-NAME)                          23670000
236800             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     23680000
236900             ITEM  (PV-ITEM)                                      23690000
237000             RESP  (PV-CICS-RESP)                                 23700000
237100     END-EXEC.                                                    23710000
237200*                                                                 23720000
237300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23730000
237400         CONTINUE                                                 23740000
237500     ELSE                                                         23750000
237600         SET DP013-CICS-ABEND        TO TRUE                      23760000
237700         SET DP013-NO-ROLLBACK       TO TRUE                      23770000
237800         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           23780000
237900         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    23790000
238000                                     TO DP013-MESSAGE-TEXT(1)     23800000
238100         PERFORM DP013-0000-PROCESS-ABEND                         23810000
238200     END-IF.                                                      23820000
238300                                                                  23830000
238400*----------------------------------------------------------------*23840000
238500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23850000
238600*----------------------------------------------------------------*23860000
238700 9200-REWRITE-LIST-QUEUE.                                         23870000
238800     EXEC CICS                                                    23880000
238900          WRITEQ TS                                               23890000
239000              QUEUE  (ASC-SEL-QUEUE-NAME)                         23900000
239100              FROM   (MR115-MESSAGE-SEL-REC)                      23910000
239200              ITEM   (PV-SEL-QUEUE-ITEM)                          23920000
239300              RESP   (PV-CICS-RESP)                               23930000
239400              REWRITE                                             23940000
239500     END-EXEC.                                                    23950000
239600                                                                  23960000
239700     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   23970000
239800         SET DP013-CICS-ABEND                                     23980000
239900             DP013-NO-ROLLBACK     TO TRUE                        23990000
240000         MOVE '9200-REWRITE-LIST-QUEUE'                           24000000
240100                                   TO DP013-PARAGRAPH             24010000
240200         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   24020000
240300                                   TO DP013-MESSAGE-TEXT (1)      24030000
240400         PERFORM DP013-0000-PROCESS-ABEND                         24040000
240500     END-IF.                                                      24050000
240600                                                                  24060000
240700 EJECT                                                            24070000
240800*----------------------------------------------------------------*24080000
240900*    ABEND PROCESSOR MODULE                                      *24090000
241000*----------------------------------------------------------------*24100000
241100                                                                  24110000
241200     COPY DPPD013.                                                24120000
