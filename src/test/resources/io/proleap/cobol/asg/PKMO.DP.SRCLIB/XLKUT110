000200***************************************************************** 00020000
000300 IDENTIFICATION DIVISION.                                         00030000
000400***************************************************************** 00040000
000500*                                                                 00050000
000600 PROGRAM-ID.             XLKUT110.                                00060001
000700 AUTHOR.                 AYAN SARKAR.                             00070001
000800 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00080000
000900 DATE-WRITTEN.           MARCH 2015.                              00090001
001000 DATE-COMPILED.                                                   00100000
001100*                                                                 00110000
001200***************************************************************** 00120000
001300* THIS PROGRAM READS LEGACY AND RMS SORTED HEADER FILES, AND      00130001
001400* DETERMINES WHICH ARE THE POS MISSING IN LEGACY FILE. MISSING    00140001
001410* POS ARE WRITTEN TO THE OUTPUT FILE ALONG WITH RMS-PO-UPD-TMST   00141001
001420* AS '9999-09-09-09.09.09.999999'.                                00142001
001500***************************************************************** 00150000
001600 ENVIRONMENT DIVISION.                                            00160000
001610***************************************************************** 00161000
001800 CONFIGURATION SECTION.                                           00180000
001900 SOURCE-COMPUTER.                        IBM-3090.                00190000
002000 OBJECT-COMPUTER.                        IBM-3090.                00200000
002100 INPUT-OUTPUT SECTION.                                            00210000
002200 FILE-CONTROL.                                                    00220000
002300                                                                  00230000
002400     SELECT LEGACY-INP-FILE                                       00240001
002500         ASSIGN TO INP01.                                         00250000
002510                                                                  00251001
002520     SELECT RMS-INP-FILE                                          00252001
002530         ASSIGN TO INP02.                                         00253001
002540                                                                  00254002
002550     SELECT RMSONLY-OUT-FILE                                      00255002
002560         ASSIGN TO OUT01.                                         00256002
002600/                                                                 00260000
002710***************************************************************** 00271000
002800 DATA DIVISION.                                                   00280000
002810***************************************************************** 00281000
003000 FILE SECTION.                                                    00300000
003100                                                                  00310000
003200 FD  LEGACY-INP-FILE                                              00320001
003300     RECORDING MODE IS F                                          00330000
003400     LABEL RECORDS ARE STANDARD                                   00340000
003500     BLOCK CONTAINS 0 RECORDS.                                    00350000
003600 01  LEGACY-INP-REC                   PIC X(482).                 00360001
003610                                                                  00361001
003620 FD  RMS-INP-FILE                                                 00362001
003630     RECORDING MODE IS F                                          00363001
003640     LABEL RECORDS ARE STANDARD                                   00364001
003650     BLOCK CONTAINS 0 RECORDS.                                    00365001
003660 01  RMS-INP-RECORD                   PIC X(373).                 00366001
003670                                                                  00367002
003680 FD  RMSONLY-OUT-FILE                                             00368002
003690     RECORDING MODE IS F                                          00369002
003691     LABEL RECORDS ARE STANDARD                                   00369102
003692     BLOCK CONTAINS 0 RECORDS.                                    00369202
003693 01  RMSONLY-OUT-RECORD               PIC X(30).                  00369302
003700/                                                                 00370000
003800***************************************************************** 00380000
003900 WORKING-STORAGE SECTION.                                         00390000
004000***************************************************************** 00400000
004100                                                                  00410000
004200 01  PS-SWITCHES.                                                 00420000
004300     05  PS-END-OF-LEG-INP-FILE-SW    PIC X(01) VALUE 'N'.        00430001
004400         88  PS-END-OF-LEG-INP                  VALUE 'Y'.        00440001
004500         88  PS-NOT-END-OF-LEG-INP              VALUE 'N'.        00450001
004510     05  PS-END-OF-RMS-INP-FILE-SW    PIC X(01) VALUE 'N'.        00451001
004520         88  PS-END-OF-RMS-INP                  VALUE 'Y'.        00452001
004530         88  PS-NOT-END-OF-RMS-INP              VALUE 'N'.        00453001
004600                                                                  00460000
004700 01  PV-PROGRAM-VARIABLES.                                        00470000
004900     05  PV-LEGACY-REC-READ           PIC 9(09) VALUE ZERO.       00490003
004901     05  PV-RMS-REC-READ              PIC 9(09) VALUE ZERO.       00490103
004910     05  PV-RMSONLY-RECS              PIC 9(09) VALUE ZERO.       00491003
005600     05  PV-DISPLAY-COUNT             PIC Z(08)9.                 00560003
005601** CHG0107941 START                                               00560117
005610     05  PV-PO-NBR-9                  PIC 9(09) VALUE ZERO.       00561008
005620     05  PV-LEGONLY-RECS              PIC 9(09) VALUE ZERO.       00562011
005630** CHG0107941 END                                                 00563017
005700                                                                  00570000
005900 01  PV-ABEND-FIELDS.                                             00590000
006300     05  PV-ABEND-PARAGRAPH           PIC X(50) VALUE SPACES.     00630003
007200/                                                                 00720000
007300 01  PC-PROGRAM-CONSTANTS.                                        00730003
007400     05  PC-CURRENT-PROGRAM-NAME      PIC X(08) VALUE 'XLKUT110'. 00740001
007700     05  PC-RMS-PO-UPD-TMST           PIC X(26) VALUE             00770003
007800                                    '9999-09-09-09.09.09.999999'. 00780003
007900/                                                                 00790000
008000*** LEGACY INPUT FILE COPYBOOK                                    00800001
009300     COPY XLRD063.                                                00930001
009400                                                                  00940000
009500*** RMS INPUT FILE COPYBOOK                                       00950001
009510 01  PC-RMS-INP-RECORD.                                           00951001
009600     COPY XLRD015.                                                00960001
009700                                                                  00970001
009800*** OUTPUT FILE COPYBOOK                                          00980001
009900     COPY XLRD013.                                                00990001
010000                                                                  01000001
010300******************************************************************01030000
010400 PROCEDURE DIVISION.                                              01040000
010500******************************************************************01050000
010600 0000-MAINLINE.                                                   01060000
010700                                                                  01070000
010800     PERFORM 1000-INITIALIZE.                                     01080000
010900                                                                  01090000
011000     PERFORM 2000-COMPARE-INP-FLIES                               01100005
011100         UNTIL PS-END-OF-RMS-INP                                  01110015
011200           AND PS-END-OF-LEG-INP.                                 01120015
011210                                                                  01121015
011300     PERFORM 9000-EOJ.                                            01130000
011400                                                                  01140000
011500     STOP RUN.                                                    01150000
011600                                                                  01160000
012100******************************************************************01210000
012200 1000-INITIALIZE.                                                 01220000
012210******************************************************************01221000
012220                                                                  01222005
012230     MOVE '1000-INITIALIZE'           TO PV-ABEND-PARAGRAPH.      01223005
012300                                                                  01230000
012400     OPEN INPUT  LEGACY-INP-FILE                                  01240002
012410                 RMS-INP-FILE                                     01241002
012420          OUTPUT RMSONLY-OUT-FILE.                                01242002
012500                                                                  01250000
012600     PERFORM 2100-READ-LEGACY-INPUT-FILE.                         01260003
012610     PERFORM 2200-READ-RMS-INPUT-FILE.                            01261003
012700                                                                  01270000
012810******************************************************************01281000
012900 2000-COMPARE-INP-FLIES.                                          01290005
012910******************************************************************01291000
013000                                                                  01300000
013010     MOVE '2000-COMPARE-INP-FLIES'    TO PV-ABEND-PARAGRAPH.      01301005
013020                                                                  01302005
013030** CHG0107941 START                                               01303017
013100     IF PS-NOT-END-OF-LEG-INP AND PS-NOT-END-OF-RMS-INP           01310015
013200        IF XL063-PO-NBR = XL015-PO-NBR                            01320011
013300            PERFORM 2100-READ-LEGACY-INPUT-FILE                   01330003
013400            PERFORM 2200-READ-RMS-INPUT-FILE                      01340003
013500        ELSE                                                      01350003
013600           IF XL063-PO-NBR > XL015-PO-NBR                         01360011
013700              MOVE XL015-PO-NBR    TO XL013-PO-NBR                01370005
013800              MOVE PC-RMS-PO-UPD-TMST                             01380003
013801                                   TO XL013-PURCHS-RMS-PO-UPD-TMST01380103
013802              PERFORM 3000-WRITE-RMSONLY-RECORDS                  01380203
013803              PERFORM 2200-READ-RMS-INPUT-FILE                    01380303
013804           ELSE                                                   01380403
013806              ADD +1               TO PV-LEGONLY-RECS             01380613
013807              MOVE XL063-PO-NBR    TO PV-PO-NBR-9                 01380714
013808*             DISPLAY 'PO ' XL063-PO-NBR ' MISSING FROM RMS FILE' 01380811
013809              DISPLAY 'PO ' PV-PO-NBR-9 ' MISSING FROM RMS FILE'  01380911
013810              PERFORM 2100-READ-LEGACY-INPUT-FILE                 01381011
013811*             PERFORM 2200-READ-RMS-INPUT-FILE                    01381111
013813           END-IF                                                 01381311
013814        END-IF                                                    01381411
013815     ELSE                                                         01381511
013816        IF PS-END-OF-LEG-INP AND PS-NOT-END-OF-RMS-INP            01381615
013818           MOVE XL015-PO-NBR          TO XL013-PO-NBR             01381811
013819           MOVE PC-RMS-PO-UPD-TMST                                01381911
013820                                 TO XL013-PURCHS-RMS-PO-UPD-TMST  01382011
013821           PERFORM 3000-WRITE-RMSONLY-RECORDS                     01382111
013822           PERFORM 2200-READ-RMS-INPUT-FILE                       01382216
013823*       END-IF                                                    01382315
013824        ELSE                                                      01382415
013825           IF PS-NOT-END-OF-LEG-INP AND PS-END-OF-RMS-INP         01382515
013826              ADD +1               TO PV-LEGONLY-RECS             01382615
013827              MOVE XL063-PO-NBR    TO PV-PO-NBR-9                 01382715
013828              DISPLAY 'PO ' PV-PO-NBR-9 ' MISSING FROM RMS FILE'  01382815
013829              PERFORM 2100-READ-LEGACY-INPUT-FILE                 01382915
013830           END-IF                                                 01383015
013831     END-IF.                                                      01383111
013832** CHG0107941 END                                                 01383217
013833                                                                  01383311
013840******************************************************************01384000
013900 2100-READ-LEGACY-INPUT-FILE.                                     01390003
013910******************************************************************01391000
014000                                                                  01400000
014010     MOVE '2100-READ-LEGACY-INPUT-FILE' TO PV-ABEND-PARAGRAPH.    01401005
014020                                                                  01402005
014100     READ LEGACY-INP-FILE INTO XL063-DCLTPURCHS                   01410002
014200        AT END                                                    01420000
014300           SET PS-END-OF-LEG-INP     TO TRUE                      01430003
014400        NOT AT END                                                01440000
014500           ADD +1                    TO PV-LEGACY-REC-READ        01450003
014700     END-READ.                                                    01470000
014710                                                                  01471002
014720******************************************************************01472002
014730 2200-READ-RMS-INPUT-FILE.                                        01473002
014740******************************************************************01474002
014750                                                                  01475002
014751     MOVE '2200-READ-RMS-INPUT-FILE' TO PV-ABEND-PARAGRAPH.       01475105
014752                                                                  01475205
014760     READ RMS-INP-FILE INTO XL015-DATA-AREA                       01476002
014770        AT END                                                    01477002
014780           SET PS-END-OF-RMS-INP     TO TRUE                      01478003
014790        NOT AT END                                                01479002
014791           ADD +1                    TO PV-RMS-REC-READ           01479103
014792     END-READ.                                                    01479202
014800                                                                  01480000
014810******************************************************************01481003
014900 3000-WRITE-RMSONLY-RECORDS.                                      01490003
014910******************************************************************01491003
015100                                                                  01510003
015110     MOVE '3000-WRITE-RMSONLY-RECORDS' TO PV-ABEND-PARAGRAPH.     01511005
015120                                                                  01512005
015200     WRITE RMSONLY-OUT-RECORD  FROM XL013-DRIVER-RECORD-LAYOUT.   01520003
015300     ADD +1                          TO PV-RMSONLY-RECS.          01530003
015400                                                                  01540003
017800******************************************************************01780000
017900 9000-EOJ.                                                        01790000
017910******************************************************************01791000
017911                                                                  01791105
018100     CLOSE LEGACY-INP-FILE                                        01810003
018110           RMS-INP-FILE                                           01811003
018200           RMSONLY-OUT-FILE.                                      01820003
018201                                                                  01820103
018210     DISPLAY '** ' PC-CURRENT-PROGRAM-NAME ' SUMMARY **'          01821000
018300     MOVE PV-RMS-REC-READ             TO PV-DISPLAY-COUNT.        01830003
018400     DISPLAY '** RECORDS IN RMS FILE    : '  PV-DISPLAY-COUNT.    01840001
018500     MOVE PV-LEGACY-REC-READ          TO PV-DISPLAY-COUNT.        01850003
018501     DISPLAY '** RECORDS IN LEGACY FILE : '  PV-DISPLAY-COUNT.    01850101
018700     MOVE PV-RMSONLY-RECS             TO PV-DISPLAY-COUNT.        01870003
018710     DISPLAY '** RMSONLY RECORDS        : '  PV-DISPLAY-COUNT.    01871003
018711** CHG0107941 START                                               01871118
018720     MOVE PV-LEGONLY-RECS             TO PV-DISPLAY-COUNT.        01872011
018730     DISPLAY '** LEGACY ONLY RECORDS    : '  PV-DISPLAY-COUNT.    01873011
018740** CHG0107941 END                                                 01874018
018900                                                                  01890000
