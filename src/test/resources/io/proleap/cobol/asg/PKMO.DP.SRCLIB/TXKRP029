000100***************************************************************** 00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300***************************************************************** 00030099
000400                                                                  00040099
000500 PROGRAM-ID.             TXKRP029.                                00050099
000600 AUTHOR.                 M WILLIAMS.                              00060099
000700 INSTALLATION.           KOHLS.                                   00070099
000800 DATE-WRITTEN            08/2001.                                 00080099
000900 DATE-COMPILED.                                                   00090099
001000                                                                  00100099
001100***************************************************************** 00110099
001200*  PURPOSE:                                                       00120099
001300*  LIST INFORMATION ON MEXICAN CITIZENS TAX REFUNDS FOR           00130099
001400*  SELECTED MONTHS AND STORE  TRANSACTIONS IN DATE ORDER          00140099
001500*  ALSO CREATES AN EXCEL FILE OF THE DETAIL LINE INFORMATION.     00150099
001600*  THAT ALLOWS THE TAX DEPT TO DO FUTURE CALCUATIONS.             00160099
001700*                                                                 00170099
001800***************************************************************** 00180099
001900*  WR22027                                                        00190099
002000*  THIS PROGRAM SEQUENTIALLY PROCESSES THE TEPTRN DB2 TABLE       00200099
002100*  FOR A SELECT GROUP OF STORES AND CREATES A MONTHLY REPORT OF   00210099
002200*  TAX REFUNDS GIVEN TO MEXICAN CITIZENS.                         00220099
002300*  A DATE CARD IS ACCEPTED TO BE USED IN THE CURSOR FOR THE FIRST 00230099
002400*  AND LAST DAYS OF THE MONTH TO BE INCLUDED IN THE REPORT.       00240099
002500*  CNTL CARD 1: MONTH START AND END DATES                         00250099
002600***************************************************************** 00260099
002700*  CHANGES:                                                       00270099
002800***************************************************************** 00280099
002900 ENVIRONMENT DIVISION.                                            00290099
003000***************************************************************** 00300099
003100                                                                  00310099
003200 CONFIGURATION SECTION.                                           00320099
003300                                                                  00330099
003400 SOURCE-COMPUTER.        IBM-3090.                                00340099
003500                                                                  00350099
003600 OBJECT-COMPUTER.        IBM-3090.                                00360099
003700                                                                  00370099
003800 INPUT-OUTPUT SECTION.                                            00380099
003900                                                                  00390099
004000 FILE-CONTROL.                                                    00400099
004100                                                                  00410099
004200     SELECT POS-DATE-CARD-FILE                                    00420099
004300         ASSIGN TO INP01.                                         00430099
004400                                                                  00440099
004500     SELECT TAX-EXTRACT-FILE                                      00450099
004600         ASSIGN TO OUT01.                                         00460099
004700                                                                  00470099
004800     SELECT TAX-REFUND-DETAIL                                     00480099
004900         ASSIGN TO RPT01.                                         00490099
005000                                                                  00500099
005100     SELECT TAX-REFUND-SUMMARY                                    00510099
005200         ASSIGN TO RPT02.                                         00520099
005300                                                                  00530099
005400                                                                  00540099
005500******************************************************************00550099
005600 DATA DIVISION.                                                   00560099
005700******************************************************************00570099
005800                                                                  00580099
005900 FILE SECTION.                                                    00590099
006000                                                                  00600099
006100 FD  POS-DATE-CARD-FILE                                           00610099
006200     RECORDING MODE IS F                                          00620099
006300     BLOCK CONTAINS 0 RECORDS                                     00630099
006400     LABEL RECORDS ARE STANDARD.                                  00640099
006500                                                                  00650099
006600 01  POS-DATE-CARD-RECORD            PIC X(80).                   00660099
006700                                                                  00670099
006800 FD  TAX-REFUND-DETAIL                                            00680099
006900     RECORDING MODE IS F                                          00690099
007000     BLOCK CONTAINS 0  RECORDS.                                   00700099
007100                                                                  00710099
007200 01  TAX-REFUND-REC                  PIC  X(132).                 00720099
007300                                                                  00730099
007400 FD  TAX-REFUND-SUMMARY                                           00740099
007500     RECORDING MODE IS F                                          00750099
007600     BLOCK CONTAINS 0  RECORDS.                                   00760099
007700                                                                  00770099
007800 01  TAX-REFUND2-REC                PIC X(132).                   00780099
007900                                                                  00790099
008000 FD  TAX-EXTRACT-FILE                                             00800099
008100     RECORDING MODE IS F                                          00810099
008200     LABEL RECORDS ARE STANDARD                                   00820099
008300     BLOCK CONTAINS 0 RECORDS                                     00830099
008400     RECORD CONTAINS 101 CHARACTERS.                              00840099
008500                                                                  00850099
008600 01  TX-TAX-EXTRACT-RECORD           PIC X(101).                  00860099
008700                                                                  00870099
008800                                                                  00880099
008900******************************************************************00890099
009000 WORKING-STORAGE SECTION.                                         00900099
009100******************************************************************00910099
009200 01  FILLER                            PIC X(50)  VALUE           00920099
009300     ' *** WORKING STORAGE STARTS HERE FOR TXKRP029 *** '.        00930099
009400                                                                  00940099
009500******************************************************************00950099
009600* RECORD LAYOUT FOR INPUT DATE CARD                               00960099
009700* LISTS THE FIRST AND LAST DAYS OF THE FISCAL PERIOD.             00970099
009800* LAYOUT:   CCYYMMDD CCYYMMDD                                     00980099
009900******************************************************************00990099
010000 01  CC-DATE-CARD.                                                01000099
010100     05  CC-FROM-DATE.                                            01010099
010200         10 CC-YEAR                     PIC 9(04).                01020099
010300         10 CC-MONTH                    PIC 9(02).                01030099
010400         10 CC-DAY                      PIC 9(02).                01040099
010500     05  FILLER                         PIC X(01).                01050099
010600     05  CC-TO-DATE.                                              01060099
010700         10 CC-YEAR1                    PIC 9(04).                01070099
010800         10 CC-MONTH1                   PIC 9(02).                01080099
010900         10 CC-DAY1                     PIC 9(02).                01090099
011000     05  FILLER                         PIC X(63) VALUE SPACES.   01100099
011100                                                                  01110099
011200 01  AC-ABEND-CODE                      PIC S9(04) VALUE ZERO     01120099
011300                                                  COMP SYNC.      01130099
011400     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01140099
011500     88  AC-DB2-ERROR                             VALUE +4013.    01150099
011600                                                                  01160099
011700  01  PS-PROGRAM-SWITCHES.                                        01170099
011800     05  PS-END-OF-TEPTRN-SW           PIC X(01)  VALUE 'N'.      01180099
011900         88  PS-END-OF-TEPTRN                     VALUE 'Y'.      01190099
012000         88  PS-NOT-END-OF-TEPTRN                 VALUE 'N'.      01200099
012100     05  PS-END-OF-DATE-FILE-SW        PIC X(01)  VALUE 'N'.      01210099
012200         88  PS-END-OF-DATE-FILE                  VALUE 'Y'.      01220099
012300     05  PS-FIRST-TIME-SW              PIC X(01)  VALUE 'Y'.      01230099
012400         88  PS-FIRST-TIME                        VALUE 'Y'.      01240099
012500         88  PS-NOT-FIRST-TIME                    VALUE 'N'.      01250099
012600     05  PS-LOADED-SW                  PIC X(01)  VALUE 'N'.      01260099
012700         88  PS-LOADED                            VALUE 'Y'.      01270099
012800                                                                  01280099
012900 01  PC-CONSTANTS.                                                01290099
013000     05  PC-LINE-LIMIT                 PIC S9(04) VALUE +60.      01300099
013100     05  PC-CURRENT-PROGRAM-NAME       PIC  X(08) VALUE           01310099
013200                                                 'TXKRP029'.      01320099
013300     05  PC-01                         PIC  X(02) VALUE '01'.     01330099
013400     05  PC-02                         PIC  X(02) VALUE '02'.     01340099
013500     05  MAX-TABLE-SIZE                PIC  9(02) VALUE 35.       01350099
013600 01  PV-PROGRAM-VARIABLES.                                        01360099
013700     05  PV-MISC-COUNT-FIELDS                         COMP-3.     01370099
013800          10  PV-PAGE-CNT1             PIC S9(05) VALUE ZERO.     01380099
013900          10  PV-PAGE-CNT2             PIC S9(05) VALUE ZERO.     01390099
014000                                                                  01400099
014100     05  PV-LINE-SPACING               PIC S9(04) VALUE ZERO      01410099
014200                                                  COMP SYNC.      01420099
014300     05  PV-LINE-SPACING2              PIC S9(04) VALUE +65       01430099
014400                                                  COMP SYNC.      01440099
014500     05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACE.    01450099
014600     05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACE.    01460099
014700     05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACE.    01470099
014800     05  PV-DB2-OPERATION              PIC  X(30) VALUE SPACE.    01480099
014900     05  PV-PARM-FROM-DATE             PIC  X(10).                01490099
015000     05  PV-PARM-TO-DATE               PIC  X(10).                01500099
015100     05  PV-HOLD-STR-NBR               PIC  9(4).                 01510099
015200     05  PV-HOLD-WITH                  PIC  9(7)V99 VALUE ZERO.   01520099
015300     05  PV-HOLD-WITHOUT               PIC S9(7)V99 VALUE ZERO.   01530099
015400     05  PV-HOLD-TAX                   PIC  9(7)V99 VALUE ZERO.   01540099
015500     05  PV-HOLD-RETURN-REFUND         PIC  9(7)V99 VALUE ZERO.   01550099
015600     05  PV-ACCUM-REFUND               PIC S9(7)V99 VALUE ZERO.   01560099
015700     05  PV-EACH-REFUND                PIC S9(7)V99 VALUE ZERO.   01570099
015800     05  PV-ACCUM-VARIANCE             PIC S9(7)V99 VALUE ZERO.   01580099
015900     05  PV-HOLD-VARIANCE              PIC S9(7)V99 VALUE ZERO.   01590099
016000     05  PV-STR-TOT-REFUND-TAX         PIC S9(7)V99 VALUE +0.     01600099
016100     05  PV-SELECT-COUNTER             PIC S9(04)   VALUE +0 COMP.01610099
016200     05  PV-TRN-STAT-CDE               PIC  X(01)   VALUE ' '.    01620099
016300         88 PV-VALID-TRN-STAT-CDE  VALUES  'Z', 'V', 'R', 'L'.    01630099
016400     05  PV-LIV-RSLU-CDE               PIC  X(01)  VALUE SPACES.  01640099
016500         88 PV-VALID-LIV-RSLU-CDE                                 01650099
016600            VALUES '+' '-'.                                       01660099
016610     05  PV-TRN-TYP-CDE                PIC  X(02)  VALUE SPACES.  01661099
016620         88 PV-VALID-TRN-TYP-CDE                                  01662099
016630            VALUES '01' '02' '11' '12' '22' '23' '24' '25'.       01663099
016700     05  PV-DATE-AND-TIME-FIELDS.                                 01670099
016800         10  PV-POS-CCYY-MM-DD         PIC X(10)   VALUE SPACE.   01680099
016900         10  FILLER REDEFINES PV-POS-CCYY-MM-DD.                  01690099
017000            15  PV-POS-CCYY            PIC X(04).                 01700099
017100            15  FILLER                 PIC X(01).                 01710099
017200            15  PV-POS-MM              PIC X(02).                 01720099
017300            15  FILLER                 PIC X(01).                 01730099
017400            15  PV-POS-DD              PIC X(02).                 01740099
017500     05  PV-CURR-DATE-CCYYMMDD.                                   01750099
017600         10  PV-CURR-DATE-CCYY         PIC 9(04).                 01760099
017700         10  PV-CURR-DATE-MM           PIC 9(02).                 01770099
017800         10  PV-CURR-DATE-DD           PIC 9(02).                 01780099
017900     05  PV-CURR-TIME.                                            01790099
018000         10  PV-CURR-TIME-HH           PIC 9(02)  VALUE ZERO.     01800099
018100         10  PV-CURR-TIME-MM           PIC 9(02)  VALUE ZERO.     01810099
018200         10  PV-CURR-TIME-SSHH         PIC 9(04)  VALUE ZERO.     01820099
018300     05  PV-HEADER-DATE.                                          01830099
018400         10  PV-HEADER-MM              PIC XX.                    01840099
018500         10  PV-HEADER-SLASH-1         PIC X.                     01850099
018600         10  PV-HEADER-DD              PIC XX.                    01860099
018700         10  PV-HEADER-SLASH-2         PIC X.                     01870099
018800         10  PV-HEADER-CCYY            PIC X(04).                 01880099
018900     05  PV-FROM-DATE.                                            01890099
019000         10  PV-YEAR                   PIC 9(04).                 01900099
019100         10  FILLER                    PIC X(01)   VALUE '-'.     01910099
019200         10  PV-MONTH                  PIC 9(02).                 01920099
019300         10  FILLER                    PIC X(01)   VALUE '-'.     01930099
019400         10  PV-DAY                    PIC 9(02).                 01940099
019500     05  PV-TO-DATE.                                              01950099
019600         10  PV-YEAR1                  PIC 9(04).                 01960099
019700         10  FILLER                    PIC X(01)   VALUE '-'.     01970099
019800         10  PV-MONTH1                 PIC 9(02).                 01980099
019900         10  FILLER                    PIC X(01)   VALUE '-'.     01990099
020000         10  PV-DAY1                   PIC 9(02).                 02000099
020100     05  PV-THE-DATE.                                             02010099
020200         10  PV-YR                     PIC 9(04).                 02020099
020300         10  FILLER                    PIC X(01)   VALUE '/'.     02030099
020400         10  PV-MO                     PIC 9(02).                 02040099
020500         10  FILLER                    PIC X(01)   VALUE '/'.     02050099
020600         10  PV-DY                     PIC 9(02).                 02060099
020700     05  PV-KEEP-DATE.                                            02070099
020800         10  PV-YR2                    PIC 9(04).                 02080099
020900         10  FILLER                    PIC X(01)   VALUE '/'.     02090099
021000         10  PV-MO2                    PIC 9(02).                 02100099
021100         10  FILLER                    PIC X(01)   VALUE '/'.     02110099
021200         10  PV-DY2                    PIC 9(02).                 02120099
021300     05  PV-SAVE-DTE.                                             02130099
021400         15  WS-MO                     PIC 9(02).                 02140099
021500         15  FILLER                    PIC X(01)   VALUE '/'.     02150099
021600         15  WS-DY                     PIC 9(02).                 02160099
021700         15  FILLER                    PIC X(01)   VALUE '/'.     02170099
021800         15  WS-YR                     PIC 9(04).                 02180099
021900     05  PV-COMP-DATE                  PIC X(10).                 02190099
022000 01 TAX-TABLE.                                                    02200099
022100    05 WS-TAX-TOTAL-TABLE OCCURS 35 TIMES INDEXED BY TBL-INDEX.   02210099
022200       10 WS-DATE                      PIC X(10).                 02220099
022300       10 WS-TAX-AMT                   PIC S9(9)V99.              02230099
022400                                                                  02240099
022500                                                                  02250099
022600******************************************************************02260099
022700*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  02270099
022800******************************************************************02280099
022900     COPY DPWS132O.                                               02290099
023000******************************************************************02300099
023100*  HEADING LINES FOR THE NON TAXABLE DETAIL REPORT                02310099
023200******************************************************************02320099
023300 01  RH-HEADER1.                                                  02330099
023400     05  FILLER                        PIC X(44)   VALUE SPACES.  02340099
023500     05  FILLER                        PIC X(43)   VALUE          02350099
023600         'EL PASO MONTHLY TRANSACTION DETAIL BY STORE'.           02360099
023700                                                                  02370099
023800 01  RH-HEADER1B.                                                 02380099
023900     05  FILLER                        PIC X(48)   VALUE SPACES.  02390099
024000     05  FILLER                        PIC X(12)   VALUE          02400099
024100         'TIME PERIOD '.                                          02410099
024200     05  RH1B-FROM-DATE                PIC X(10)   VALUE SPACE.   02420099
024300     05  FILLER                        PIC X(04)   VALUE ' TO '.  02430099
024400     05  RH1B-TO-DATE                  PIC X(10)   VALUE SPACE.   02440099
024500                                                                  02450099
024600 01  RH-HEADER2.                                                  02460099
024700     05  FILLER                        PIC X(06)   VALUE 'STORE '.02470099
024800     05  RH2-STORE-NBR2                PIC ZZZ9    VALUE ZEROS.   02480099
024900     05  FILLER                        PIC X(02)   VALUE SPACES.  02490099
025000     05  RH2-STORE-NAME                PIC X(25)   VALUE SPACES.  02500099
025100                                                                  02510099
025200                                                                  02520099
025300 01  RH-HEADER3.                                                  02530099
025400     05  FILLER                        PIC X(21)   VALUE          02540099
025500         'RETURN TRANSACTION'.                                    02550099
025600     05  FILLER                        PIC X(10)   VALUE SPACES.  02560099
025700     05  FILLER                        PIC X(25)   VALUE          02570099
025800         'ORIGINAL TRANSACTION'.                                  02580099
025900                                                                  02590099
026000 01  RH-HEADER3A.                                                 02600099
026100     05  FILLER                        PIC X(111)  VALUE SPACES.  02610099
026200     05  FILLER                        PIC X(06)   VALUE          02620099
026300         'RETURN'.                                                02630099
026400                                                                  02640099
026500 01  RH-HEADER3B.                                                 02650099
026600     05  FILLER                        PIC X(69)   VALUE SPACES.  02660099
026700     05  FILLER                        PIC X(13)   VALUE          02670099
026800         'TOTAL TRANS $'.                                         02680099
026900     05  FILLER                        PIC X(03)   VALUE SPACES.  02690099
027000     05  FILLER                        PIC X(13)   VALUE          02700099
027100         'TOTAL TRANS $'.                                         02710099
027200     05  FILLER                        PIC X(03)   VALUE SPACES.  02720099
027300     05  FILLER                        PIC X(06)   VALUE          02730099
027400         'TOTAL '.                                                02740099
027500     05  FILLER                        PIC X(04)   VALUE SPACES.  02750099
027600     05  FILLER                        PIC X(09)   VALUE          02760099
027700         'TRANS TAX'.                                             02770099
027800                                                                  02780099
027900 01  RH-HEADER4.                                                  02790099
028000     05  FILLER                        PIC X(04)   VALUE          02800099
028100         'DATE'.                                                  02810099
028200     05  FILLER                        PIC X(10)   VALUE SPACES.  02820099
028300                                                                  02830099
028400     05  FILLER                        PIC X(13)   VALUE          02840099
028500         'TRANSACTION #'.                                         02850099
028600     05  FILLER                        PIC X(03)   VALUE  SPACES. 02860099
028700     05  FILLER                        PIC X(05)   VALUE          02870099
028800         'STORE'.                                                 02880099
028900     05  FILLER                        PIC X(05)   VALUE SPACES.  02890099
029000     05  FILLER                        PIC X(04)   VALUE          02900099
029100         'DATE'.                                                  02910099
029200     05  FILLER                        PIC X(11)   VALUE SPACES.  02920099
029300     05  FILLER                        PIC X(13)   VALUE          02930099
029400         'TRANSACTION #'.                                         02940099
029500     05  FILLER                        PIC X(03)   VALUE  SPACES. 02950099
029600     05  FILLER                        PIC X(08)   VALUE          02960099
029700         'WITH TAX'.                                              02970099
029800     05  FILLER                        PIC X(07)   VALUE  SPACES. 02980099
029900     05  FILLER                        PIC X(12)   VALUE          02990099
030000         'WITHOUT TAX'.                                           03000099
030100     05  FILLER                        PIC X(03)   VALUE SPACES.  03010099
030200     05  FILLER                        PIC X(05)   VALUE          03020099
030300         'TAX $'.                                                 03030099
030400     05  FILLER                        PIC X(05)   VALUE SPACES.  03040099
030500     05  FILLER                        PIC X(08)   VALUE          03050099
030600         'REFUNDED'.                                              03060099
030700     05  FILLER                        PIC X(04)   VALUE SPACES.  03070099
030800     05  FILLER                        PIC X(08)   VALUE          03080099
030900         'VARIANCE'.                                              03090099
031000                                                                  03100099
031100 01  RH-NO-TRANSACTIONS.                                          03110099
031200     05  FILLER                        PIC X(69)   VALUE          03120099
031300         'NO RETURN TRANSACTION FOR THE SPECIFIED TIME PERIOD'.   03130099
031400 01  RH1-SPACES.                                                  03140099
031500     05  FILLER                       PIC X(132)   VALUE SPACES.  03150099
031600                                                                  03160099
031700 01  RD1-DETAIL.                                                  03170099
031800     05  RD1-RTN-DATE.                                            03180099
031900         10 RD1-RTN-MONTH             PIC X(02).                  03190099
032000         10 FILLER                    PIC X(01)    VALUE '/'.     03200099
032100         10 RD1-RTN-DAY               PIC X(02).                  03210099
032200         10 FILLER                    PIC X(01)    VALUE '/'.     03220099
032300         10 RD1-RTN-YEAR              PIC X(04).                  03230099
032400     05  FILLER                       PIC X(04)    VALUE SPACES.  03240099
032500     05  RD1-RTN-RGST-ID              PIC 9(04)    VALUE ZEROS.   03250099
032600     05  FILLER                       PIC X(01)    VALUE '/'.     03260099
032700     05  RD1-RTN-TRN-NBR              PIC 9(04)    VALUE ZEROS.   03270099
032800     05  FILLER                       PIC X(07)    VALUE SPACES.  03280099
032900     05  RD1-ORIG-LINES.                                          03290099
033000         10  RD1-ORIG-STORE-NBR       PIC ZZZ9     VALUE ZEROS.   03300099
033100         10  RD1-FILLER1              PIC X(06)    VALUE SPACES.  03310099
033200         10  RD1-ORIG-DTE.                                        03320099
033300           15 RD1-ORIG-MONTH          PIC X(02).                  03330099
033400           15 RD1-SLASH1              PIC X(01)    VALUE '/'.     03340099
033500           15 RD1-ORIG-DAY            PIC X(02).                  03350099
033600           15 RD1-SLASH2              PIC X(01)    VALUE '/'.     03360099
033700           15 RD1-ORIG-YEAR           PIC X(04).                  03370099
033800         10  RD1-FILLER2              PIC X(05)    VALUE SPACES.  03380099
033900         10  RD1-ORIG-RGST-ID         PIC 9(04)    VALUE ZEROS.   03390099
034000         10  RD1-SLASH3               PIC X(01)    VALUE '/'.     03400099
034100         10  RD1-ORIG-TRN-NBR         PIC 9(04)    VALUE ZEROS.   03410099
034200         10  RD1-FILLER3              PIC X(06)    VALUE SPACES.  03420099
034300     05  RD1-NO-SALE-DATA-X REDEFINES RD1-ORIG-LINES.             03430099
034400         10  RD1-NO-SALE-DATA         PIC X(40).                  03440099
034500     05  RD1-AMOUNTS.                                             03450099
034600         10  RD1-TOT-WITH             PIC -(7).99.                03460099
034700         10  RD1-ORIG-INFO4-X REDEFINES RD1-TOT-WITH.             03470099
034800           15 RD1-ORIG-INFO4          PIC X(10).                  03480099
034900         10  FILLER                   PIC X(02)    VALUE SPACES.  03490099
035000         10  RD1-TOT-WITHOUT          PIC -(7).99.                03500099
035100         10  RD1-ORIG-INFO5-X REDEFINES RD1-TOT-WITHOUT.          03510099
035200           15 RD1-ORIG-INFO5          PIC X(10).                  03520099
035300         10  FILLER                   PIC X(03)    VALUE SPACES.  03530099
035400         10  RD1-TOT-TAX              PIC -(7).99.                03540099
035500         10  RD1-ORIG-INFO6-X REDEFINES RD1-TOT-TAX.              03550099
035600           15 RD1-ORIG-INFO6          PIC X(10).                  03560099
035700         10  FILLER                   PIC X(03)    VALUE SPACES.  03570099
035800         10  RD1-TAX-REFUND           PIC -(7).99.                03580099
035900         10  FILLER                   PIC X(03)    VALUE SPACES.  03590099
036000         10  RD1-VARIANCE             PIC -(7).99.                03600099
036100         10  RD1-ORIG-INFO7-X REDEFINES RD1-VARIANCE.             03610099
036200           15 RD1-ORIG-INFO7          PIC X(10).                  03620099
036300 01  RT-TOTAL-LINES.                                              03630099
036400     05  FILLER                       PIC X(06)    VALUE 'TOTAL '.03640099
036500     05  RT-STORE-NBR                 PIC ZZZ9     VALUE ZEROS.   03650099
036600     05  FILLER                       PIC X(98)    VALUE SPACES.  03660099
036700     05  RT-TOT-ALL-REFUND            PIC -(6)9.99.               03670099
036800     05  FILLER                       PIC X(03)    VALUE SPACES.  03680099
036900     05  RT-TOT-VARIANCE              PIC -(6)9.99.               03690099
037000*LAYOUT FOR THE EXCEL FILE                                        03700099
037100 01  EXCEL-DETAIL.                                                03710099
037200     05  EX-RTN-DATE.                                             03720099
037300         10 EX-MONTH                  PIC X(02).                  03730099
037400         10  FILLER                   PIC X(01)    VALUE '/'.     03740099
037500         10 EX-DAY                    PIC X(02).                  03750099
037600         10  FILLER                   PIC X(01)    VALUE '/'.     03760099
037700         10 EX-YEAR                   PIC X(04).                  03770099
037800     05  FILLER                       PIC X(01)    VALUE ','.     03780099
037900     05  EX-RTN-RGST-ID               PIC 9(04)    VALUE ZEROS.   03790099
038000     05  FILLER                       PIC X(01)    VALUE ','.     03800099
038100     05  EX-RTN-TRN-NBR               PIC 9(04)    VALUE ZEROS.   03810099
038200     05  FILLER                       PIC X(01)    VALUE ','.     03820099
038300     05  EX-ORIG-STORE-NBR            PIC 9(04)    VALUE ZEROS.   03830099
038400     05  FILLER                       PIC X(01)    VALUE ','.     03840099
038500     05  EX-ORIG-DTE                  PIC 9(10)    VALUE ZEROS.   03850099
038600     05  FILLER                       PIC X(01)    VALUE ','.     03860099
038700     05  EX-ORIG-RGST-ID              PIC 9(04)    VALUE ZEROS.   03870099
038800     05  FILLER                       PIC X(01)    VALUE ','.     03880099
038900     05  EX-ORIG-TRN-NBR              PIC 9(04)    VALUE ZEROS.   03890099
039000     05  FILLER                       PIC X(01)    VALUE ','.     03900099
039100     05  EX-TOT-WITH                  PIC -(7).99.                03910099
039200     05  FILLER                       PIC X(01)    VALUE ','.     03920099
039300     05  EX-TOT-WITHOUT               PIC -(7).99.                03930099
039400     05  FILLER                       PIC X(01)    VALUE ','.     03940099
039500     05  EX-TOT-TAX                   PIC -(7).99 .               03950099
039600     05  FILLER                       PIC X(01)    VALUE ','.     03960099
039700     05  EX-TAX-REFUND                PIC -(7).99.                03970099
039800     05  FILLER                       PIC X(01)    VALUE ','.     03980099
039900     05  EX-VARIANCE                  PIC -(7).99.                03990099
040000*LAYOUT FOR THE MONTHLY SUMMARY                                   04000099
040100 01  MS-HEADER1.                                                  04010099
040200     05  FILLER                        PIC X(48)   VALUE SPACES.  04020099
040300     05  FILLER                        PIC X(36)   VALUE          04030099
040400         'EL PASO MONTHLY TAX SUMMARY BY STORE'.                  04040099
040500                                                                  04050099
040600 01  MS-HEADER1B.                                                 04060099
040700     05  FILLER                        PIC X(48)   VALUE SPACES.  04070099
040800     05  FILLER                        PIC X(12)   VALUE          04080099
040900         'TIME PERIOD '.                                          04090099
041000     05  MS1B-FROM-DATE                PIC X(10)   VALUE SPACE.   04100099
041100     05  FILLER                        PIC X(04)   VALUE ' TO '.  04110099
041200     05  MS1B-TO-DATE                  PIC X(10)   VALUE SPACE.   04120099
041300 01  MS-HEADER2.                                                  04130099
041400     05  FILLER                        PIC X(06)   VALUE 'STORE '.04140099
041500     05  MS2-STORE-NBR2                PIC 9(04)   VALUE ZEROS.   04150099
041600     05  MS2-STR-NBR-X REDEFINES MS2-STORE-NBR2.                  04160099
041700         10 FILLER                     PIC X.                     04170099
041800         10 MS2-STR-NBR                PIC X(03).                 04180099
041900     05  FILLER                        PIC X(02)   VALUE SPACES.  04190099
042000     05  MS2-STORE-NAME                PIC X(25)   VALUE SPACES.  04200099
042100 01  MS-HEADER3.                                                  04210099
042200     05  FILLER                        PIC X(11)   VALUE          04220099
042300         'RETURN DATE'.                                           04230099
042400     05  FILLER                        PIC  X(10)  VALUE SPACES.  04240099
042500     05  FILLER                        PIC  X(26)  VALUE          04250099
042600         'TOTAL REFUNDED TAX AMOUNT'.                             04260099
042700 01  MS-MONTHLY-SUMMARY.                                          04270099
042800     05  MS-RTN-DATE.                                             04280099
042900         10 MS-RTN-MONTH              PIC X(02).                  04290099
043000         10 FILLER                    PIC X(01)    VALUE '/'.     04300099
043100         10 MS-RTN-DAY                PIC X(02).                  04310099
043200         10 FILLER                    PIC X(01)    VALUE '/'.     04320099
043300         10 MS-RTN-YEAR               PIC X(04).                  04330099
043400     05  FILLER                       PIC X(11)   VALUE SPACES.   04340099
043500     05  MS-REFUNDED-TAX              PIC -(9).99.                04350099
043600 01  MS-STORE-TOTAL.                                              04360099
043700     05  FILLER                       PIC X(10)   VALUE           04370099
043800         '   TOTAL  '.                                            04380099
043900     05  FILLER                       PIC X(11)   VALUE SPACES.   04390099
044000     05  MS-STR-TOTL-TAX              PIC -(9).99.                04400099
044100                                                                  04410099
044200***************************************************************** 04420099
044300*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            04430099
044400******************************************************************04440099
044500     COPY DPWS004.                                                04450099
044600                                                                  04460099
044700******************************************************************04470099
044800*  DB2 COMMUNICATION AREA.                                        04480099
044900******************************************************************04490099
045000     EXEC SQL                                                     04500099
045100          INCLUDE SQLCA                                           04510099
045200     END-EXEC.                                                    04520099
045300                                                                  04530099
045400******************************************************************04540099
045500*  DB2 TABLE XST_LOC                                              04550099
045600******************************************************************04560099
045700     EXEC SQL                                                     04570099
045800          INCLUDE XST00001                                        04580099
045900     END-EXEC.                                                    04590099
046000                                                                  04600099
046100******************************************************************04610099
046200*  DB2 TABLE DB2TDBA.TEPTRN  - TRANSACTION TABLE (OPERATIONAL)    04620099
046300******************************************************************04630099
046400     EXEC SQL                                                     04640099
046500          INCLUDE TEPTRN                                          04650099
046600     END-EXEC.                                                    04660099
046700******************************************************************04670099
046800*  DB2 TABLE DB2PDBA.TEPPART - PARTITION CONTROL TABLE            04680099
046900******************************************************************04690099
047000     EXEC SQL                                                     04700099
047100          INCLUDE TEPPART                                         04710099
047200     END-EXEC.                                                    04720099
047300                                                                  04730099
047400******************************************************************04740099
047500*  DB2 TABLE DB2PDBA.TEPITM  - ITEM TABLE                         04750099
047600******************************************************************04760099
047700     EXEC SQL                                                     04770099
047800          INCLUDE TEPITM                                          04780099
047900     END-EXEC.                                                    04790099
048000                                                                  04800099
048100******************************************************************04810099
048200*  DB2 TABLE DB2TDBA.TEPIRT - ITEM RETURN TABLE                   04820099
048300******************************************************************04830099
048400     EXEC SQL                                                     04840099
048500          INCLUDE TEPIRT                                          04850099
048600     END-EXEC.                                                    04860099
048700                                                                  04870099
048800******************************************************************04880099
048900* DATE ROUTINE                                                    04890099
049000******************************************************************04900099
049100     COPY DPWS500.                                                04910099
049200                                                                  04920099
049300                                                                  04930099
049400******************************************************************04940099
049500*  CREATE CURSOR FOR TEPTRN                                       04950099
049600******************************************************************04960099
049700     EXEC SQL                                                     04970099
049800         DECLARE TEPTRN-CURSOR CURSOR FOR                         04980099
049900             SELECT A.PARTN_NBR                                   04990099
050000                   ,A.SLS_DTE                                     05000099
050100                   ,B.STR_NBR                                     05010099
050200                   ,B.RGST_ID                                     05020099
050300                   ,B.TRN_NBR                                     05030099
050400                   ,B.STRT_TM                                     05040099
050500                   ,B.SLS_CORR_SEQ_NBR                            05050099
050600                   ,B.VOID_ABRT_CDE                               05060099
050700                   ,B.TRN_TYP_CDE                                 05070099
050800                   ,B.TRN_STAT_CDE                                05080099
050900                   ,B.TRN_TOT_AMT                                 05090099
051000                   ,B.SLS_TX_AMT                                  05100099
051100                   ,C.LNE_ITM_SEQ_NBR                             05110099
051110                   ,C.LIV_RSLU_CDE                                05111099
051200         FROM TEPPART A                                           05120099
051300         JOIN TEPITM  C                                           05130099
051400           ON  A.PARTN_NBR        = C.PARTN_NBR                   05140099
051500         JOIN TEPTRN  B                                           05150099
051600           ON  A.PARTN_NBR        = B.PARTN_NBR                   05160099
051700           AND B.STR_NBR          = C.STR_NBR                     05170099
051800           AND B.RGST_ID          = C.RGST_ID                     05180099
051900           AND B.TRN_NBR          = C.TRN_NBR                     05190099
052000           AND B.STRT_TM          = C.STRT_TM                     05200099
052100           AND B.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR            05210099
052200                                                                  05220099
052300         WHERE A.SLS_DTE BETWEEN :PV-PARM-FROM-DATE               05230099
052400                             AND :PV-PARM-TO-DATE                 05240099
052500           AND C.SKU_NBR          = 88268073                      05250099
052600         ORDER BY C.STR_NBR                                       05260099
052700                 ,A.SLS_DTE                                       05270099
052800                 ,C.RGST_ID                                       05280099
052900                 ,C.TRN_NBR                                       05290099
053000         WITH UR                                                  05300099
053100     END-EXEC.                                                    05310099
053200                                                                  05320099
053300***************************************************************** 05330099
053400 PROCEDURE DIVISION.                                              05340099
053500                                                                  05350099
053600******************************************************************05360099
053700* 0000-MAINLINE-PARAGRAPH                                         05370099
053800*      SET INITIAL SWITCH VALUES FOR FIRST TIME FETCHING          05380099
053900******************************************************************05390099
054000 0000-MAINLINE-PARAGRAPH.                                         05400099
054100                                                                  05410099
054200     PERFORM 1000-INITIALIZE-PROGRAM.                             05420099
054300                                                                  05430099
054400     PERFORM 1600-OPEN-TEPTRN-CURSOR.                             05440099
054500                                                                  05450099
054600     PERFORM 2100-FETCH-TEPTRN-CURSOR.                            05460099
054700                                                                  05470099
054800     PERFORM 2000-PROCESS-TEPTRN-CURSOR                           05480099
054900           UNTIL PS-END-OF-TEPTRN.                                05490099
055000                                                                  05500099
055100     IF PS-FIRST-TIME                                             05510099
055200     AND PS-END-OF-TEPTRN                                         05520099
055300        PERFORM 1500-FORMAT-HEADINGS                              05530099
055400        PERFORM 6700-WRITE-TAX-SUMMARY-HEADER                     05540099
055500        PERFORM 6500-WRITE-NO-TRANSACTION                         05550099
055600     ELSE                                                         05560099
055700        PERFORM 5700-END-VARIANCE-REFUND                          05570099
055800        PERFORM 2300-CLOSE-TEPTRN-CURSOR                          05580099
055900        PERFORM 3200-PROCESS-TAX-TOTAL-TABLE                      05590099
056000         VARYING TBL-INDEX FROM 1  BY 1                           05600099
056100            UNTIL TBL-INDEX > MAX-TABLE-SIZE                      05610099
056200        PERFORM 3400-PRINT-TABLE                                  05620099
056300     END-IF.                                                      05630099
056400                                                                  05640099
056500     CLOSE POS-DATE-CARD-FILE                                     05650099
056600           TAX-EXTRACT-FILE                                       05660099
056700           TAX-REFUND-SUMMARY                                     05670099
056800           TAX-REFUND-DETAIL.                                     05680099
056900                                                                  05690099
057000     GOBACK.                                                      05700099
057100                                                                  05710099
057200                                                                  05720099
057300******************************************************************05730099
057400* 1000-INITIALIZE-PROGRAM                                         05740099
057500*     OPEN FILES, PROCESS CONTROL CARD                            05750099
057600******************************************************************05760099
057700                                                                  05770099
057800 1000-INITIALIZE-PROGRAM.                                         05780099
057900                                                                  05790099
058000     OPEN INPUT  POS-DATE-CARD-FILE                               05800099
058100          OUTPUT TAX-REFUND-DETAIL                                05810099
058200                 TAX-REFUND-SUMMARY                               05820099
058300                 TAX-EXTRACT-FILE.                                05830099
058400                                                                  05840099
058500     PERFORM 1300-PROCESS-DATE-CARD.                              05850099
058600                                                                  05860099
058700     INITIALIZE TAX-TABLE.                                        05870099
058800                                                                  05880099
058900******************************************************************05890099
059000* 1300-PROCESS-DATE-CARD                                          05900099
059100******************************************************************05910099
059200                                                                  05920099
059300 1300-PROCESS-DATE-CARD.                                          05930099
059400     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         05940099
059500                                                                  05950099
059600     READ POS-DATE-CARD-FILE INTO CC-DATE-CARD                    05960099
059700         AT END                                                   05970099
059800             SET PS-END-OF-DATE-FILE TO TRUE                      05980099
059900     END-READ.                                                    05990099
060000                                                                  06000099
060100     IF PS-END-OF-DATE-FILE                                       06010099
060200         MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME      06020099
060300         MOVE 'DATE CARD MISSING      ' TO PV-OPERATION-MSG-1     06030099
060400         SET AC-CONTROL-CARD-ERROR TO TRUE                        06040099
060500         PERFORM 9999-ABEND                                       06050099
060600     END-IF.                                                      06060099
060700                                                                  06070099
060800     DISPLAY '****** ' PC-CURRENT-PROGRAM-NAME ' ******'.         06080099
060900     DISPLAY "TRANSACTIONS FOR THIS/THESE DAY: "                  06090099
061000              CC-DATE-CARD.                                       06100099
061100                                                                  06110099
061200     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     06120099
061300     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     06130099
061400     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     06140099
061500                                                                  06150099
061600     MOVE CC-YEAR      TO PV-YEAR.                                06160099
061700     MOVE CC-MONTH     TO PV-MONTH.                               06170099
061800     MOVE CC-DAY       TO PV-DAY.                                 06180099
061900     MOVE PV-FROM-DATE TO PV-PARM-FROM-DATE.                      06190099
062000     MOVE PV-FROM-DATE TO DPG52-LK-DATE-INPUT.                    06200099
062100     CALL DP500-KOHLS-CALENDAR-ROUTINE                            06210099
062200          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06220099
062300                                                                  06230099
062400     EVALUATE TRUE                                                06240099
062500         WHEN DPG54-NO-ERROR                                      06250099
062600             CONTINUE                                             06260099
062700         WHEN OTHER                                               06270099
062800             MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME  06280099
062900             MOVE 'INVALID BEGIN DATE     ' TO PV-OPERATION-MSG-1 06290099
063000             SET AC-CONTROL-CARD-ERROR TO TRUE                    06300099
063100             PERFORM 9999-ABEND                                   06310099
063200     END-EVALUATE.                                                06320099
063300* THIS IS FOR THE 'TO' PORTION OF THE DATE                        06330099
063400     MOVE CC-YEAR1     TO PV-YEAR1.                               06340099
063500     MOVE CC-MONTH1    TO PV-MONTH1.                              06350099
063600     MOVE CC-DAY1      TO PV-DAY1.                                06360099
063700     MOVE PV-TO-DATE   TO PV-PARM-TO-DATE.                        06370099
063800     MOVE PV-TO-DATE   TO DPG52-LK-DATE-INPUT.                    06380099
063900     CALL DP500-KOHLS-CALENDAR-ROUTINE                            06390099
064000          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              06400099
064100                                                                  06410099
064200     EVALUATE TRUE                                                06420099
064300         WHEN DPG54-NO-ERROR                                      06430099
064400             CONTINUE                                             06440099
064500         WHEN OTHER                                               06450099
064600             MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME  06460099
064700             MOVE 'INVALID END DATE       ' TO PV-OPERATION-MSG-1 06470099
064800             SET AC-CONTROL-CARD-ERROR TO TRUE                    06480099
064900             PERFORM 9999-ABEND                                   06490099
065000     END-EVALUATE.                                                06500099
065100* ABEND PROGRAM WHEN END DATE IS BEFORE START DATE                06510099
065200     IF CC-TO-DATE < CC-FROM-DATE                                 06520099
065300         MOVE '1300-PROCESS-DATE-CARD'  TO PV-PARAGRAPH-NAME      06530099
065400         MOVE 'END DATE BEFORE BEGIN DATE'                        06540099
065500                                        TO PV-OPERATION-MSG-1     06550099
065600         SET AC-CONTROL-CARD-ERROR TO TRUE                        06560099
065700         PERFORM 9999-ABEND                                       06570099
065800     END-IF.                                                      06580099
065900                                                                  06590099
066000                                                                  06600099
066100******************************************************************06610099
066200* 1500-FORMAT-HEADINGS                                            06620099
066300*     GET CURRENT DATE AND TIME FROM SYSTEM.                      06630099
066400*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          06640099
066500*     FORMAT HEADING LINE 3 WITH CONVERTED POS DATE.              06650099
066600******************************************************************06660099
066700 1500-FORMAT-HEADINGS.                                            06670099
066800                                                                  06680099
066900     MOVE FUNCTION CURRENT-DATE (1:8) TO PV-CURR-DATE-CCYYMMDD.   06690099
067000     ACCEPT PV-CURR-TIME FROM TIME.                               06700099
067100                                                                  06710099
067200     MOVE PV-CURR-DATE-MM             TO DP132O-RUN-MONTH.        06720099
067300     MOVE PV-CURR-DATE-DD             TO DP132O-RUN-DAY.          06730099
067400     MOVE PV-CURR-DATE-CCYY           TO DP132O-RUN-YEAR.         06740099
067500                                                                  06750099
067600     MOVE PV-CURR-TIME-HH             TO DP132O-RUN-HOUR.         06760099
067700     MOVE PV-CURR-TIME-MM             TO DP132O-RUN-MINUTE.       06770099
067800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.     06780099
067900     MOVE '1'                         TO DP132O-REPORT-NUMBER.    06790099
068000                                                                  06800099
068100     MOVE PV-PARM-FROM-DATE           TO PV-POS-CCYY-MM-DD.       06810099
068200     MOVE PV-POS-MM                   TO PV-HEADER-MM.            06820099
068300     MOVE '/'                         TO PV-HEADER-SLASH-1.       06830099
068400     MOVE PV-POS-DD                   TO PV-HEADER-DD.            06840099
068500     MOVE '/'                         TO PV-HEADER-SLASH-2.       06850099
068600     MOVE PV-POS-CCYY                 TO PV-HEADER-CCYY.          06860099
068700     MOVE PV-HEADER-DATE              TO RH1B-FROM-DATE.          06870099
068800     MOVE PV-HEADER-DATE              TO MS1B-FROM-DATE.          06880099
068900                                                                  06890099
069000     MOVE PV-PARM-TO-DATE             TO PV-POS-CCYY-MM-DD.       06900099
069100     MOVE PV-POS-MM                   TO PV-HEADER-MM.            06910099
069200     MOVE '/'                         TO PV-HEADER-SLASH-1.       06920099
069300     MOVE PV-POS-DD                   TO PV-HEADER-DD.            06930099
069400     MOVE '/'                         TO PV-HEADER-SLASH-2.       06940099
069500     MOVE PV-POS-CCYY                 TO PV-HEADER-CCYY.          06950099
069600     MOVE PV-HEADER-DATE              TO RH1B-TO-DATE.            06960099
069700     MOVE PV-HEADER-DATE              TO MS1B-TO-DATE.            06970099
069800                                                                  06980099
069900     PERFORM 9000-HEADER-ROUTINE-1.                               06990099
070000                                                                  07000099
070100******************************************************************07010099
070200* 1600-OPEN-TEPTRN-CURSOR.                                        07020099
070300*     OPEN TEPTRN CURSOR                                          07030099
070400******************************************************************07040099
070500 1600-OPEN-TEPTRN-CURSOR.                                         07050099
070600                                                                  07060099
070700     EXEC SQL                                                     07070099
070800          OPEN TEPTRN-CURSOR                                      07080099
070900     END-EXEC.                                                    07090099
071000                                                                  07100099
071100     EVALUATE TRUE                                                07110099
071200         WHEN SQLCODE = ZERO                                      07120099
071300              CONTINUE                                            07130099
071400         WHEN SQLWARN0 NOT EQUAL SPACE                            07140099
071500         WHEN SQLCODE NOT EQUAL ZERO                              07150099
071600             MOVE '1600-OPEN-TEPTRN-CURSOR'                       07160099
071700                                            TO PV-PARAGRAPH-NAME  07170099
071800             MOVE 'ERROR ON OPEN OF TEPTRN-CURSOR'                07180099
071900                                            TO PV-DB2-OPERATION   07190099
072000             PERFORM 9100-SQL-ABEND                               07200099
072100     END-EVALUATE.                                                07210099
072200                                                                  07220099
072300                                                                  07230099
072400******************************************************************07240099
072500* PROCESS STORE BREAK ON CHANGE IN STORE. IF A NEW RETURN TRANS  *07250099
072600* IS FETCHED, CALL THE ROUTINE TO PROCESS THE RETURN.  FETCH     *07260099
072700* ANOTHER RETURN TRANSACTION.                                    *07270099
072800******************************************************************07280099
072900 2000-PROCESS-TEPTRN-CURSOR.                                      07290099
073000                                                                  07300099
073100     MOVE EPTRN-TRN-STAT-CDE TO PV-TRN-STAT-CDE.                  07310099
073200     MOVE EPTRN-TRN-TYP-CDE  TO PV-TRN-TYP-CDE.                   07320099
073210     MOVE EPITM-LIV-RSLU-CDE TO PV-LIV-RSLU-CDE.                  07321099
073300                                                                  07330099
073400     IF EPTRN-VOID-ABRT-CDE = 'N' AND PV-VALID-LIV-RSLU-CDE AND   07340099
073500        PV-VALID-TRN-STAT-CDE AND PV-VALID-TRN-TYP-CDE            07350099
073600                                                                  07360099
073700         MOVE EPTRN-STR-NBR  TO MS2-STORE-NBR2                    07370099
073800         MOVE EPTRN-SLS-DTE  TO PV-KEEP-DATE                      07380099
073900                                PV-COMP-DATE                      07390099
074000         MOVE PV-MO2         TO WS-MO                             07400099
074100         MOVE PV-DY2         TO WS-DY                             07410099
074200         MOVE PV-YR2         TO WS-YR                             07420099
074300         MOVE PV-SAVE-DTE    TO PV-KEEP-DATE                      07430099
074400         IF PS-FIRST-TIME                                         07440099
074500             MOVE EPTRN-STR-NBR TO PV-HOLD-STR-NBR                07450099
074600                                   RH2-STORE-NBR2                 07460099
074700                                   XST00001-LOC-NBR               07470099
074800             PERFORM 4000-GET-STORE-NAME                          07480099
074900             PERFORM 1500-FORMAT-HEADINGS                         07490099
075000             SET PS-NOT-FIRST-TIME TO TRUE                        07500099
075100         END-IF                                                   07510099
075200                                                                  07520099
075300         IF PV-HOLD-STR-NBR NOT = EPTRN-STR-NBR                   07530099
075400            MOVE EPTRN-TRN-TOT-AMT                                07540099
075500                TO PV-HOLD-RETURN-REFUND                          07550099
075600            MOVE PV-HOLD-STR-NBR TO RH2-STORE-NBR2                07560099
075700            PERFORM 6600-WRITE-STORE-CHANGE                       07570099
075800            MOVE EPTRN-STR-NBR TO PV-HOLD-STR-NBR                 07580099
075900         END-IF                                                   07590099
076000                                                                  07600099
076100         IF EPTRN-SLS-DTE = PV-COMP-DATE                          07610099
076200            AND EPTRN-RGST-ID = RD1-RTN-RGST-ID                   07620099
076300            AND EPTRN-TRN-NBR = RD1-RTN-TRN-NBR                   07630099
076400            AND EPTRN-TRN-TOT-AMT = PV-EACH-REFUND                07640099
076500              CONTINUE                                            07650099
076600         ELSE                                                     07660099
076700             PERFORM 2200-PROCESS-LNE-ITM                         07670099
076800         END-IF                                                   07680099
076900     END-IF.                                                      07690099
077000                                                                  07700099
077100     PERFORM 2100-FETCH-TEPTRN-CURSOR.                            07710099
077200                                                                  07720099
077300******************************************************************07730099
077400*      FETCH INFO FROM CURSOR                                     07740099
077500******************************************************************07750099
077600 2100-FETCH-TEPTRN-CURSOR.                                        07760099
077700                                                                  07770099
077800     EXEC SQL                                                     07780099
077900          FETCH TEPTRN-CURSOR                                     07790099
078000           INTO :EPTRN-PARTN-NBR                                  07800099
078100               ,:EPTRN-SLS-DTE                                    07810099
078200               ,:EPTRN-STR-NBR                                    07820099
078300               ,:EPTRN-RGST-ID                                    07830099
078400               ,:EPTRN-TRN-NBR                                    07840099
078500               ,:EPTRN-STRT-TM                                    07850099
078600               ,:EPTRN-SLS-CORR-SEQ-NBR                           07860099
078700               ,:EPTRN-VOID-ABRT-CDE                              07870099
078800               ,:EPTRN-TRN-TYP-CDE                                07880099
078900               ,:EPTRN-TRN-STAT-CDE                               07890099
079000               ,:EPTRN-TRN-TOT-AMT                                07900099
079100               ,:EPTRN-SLS-TX-AMT                                 07910099
079200               ,:EPITM-LNE-ITM-SEQ-NBR                            07920099
079210               ,:EPITM-LIV-RSLU-CDE                               07921099
079300     END-EXEC.                                                    07930099
079400                                                                  07940099
079500     EVALUATE SQLCODE                                             07950099
079600         WHEN ZERO                                                07960099
079700             CONTINUE                                             07970099
079800         WHEN +100                                                07980099
079900             SET PS-END-OF-TEPTRN TO TRUE                         07990099
080000         WHEN OTHER                                               08000099
080100             MOVE '2100-FETCH-TEPTRN-CURSOR'                      08010099
080200                                            TO PV-PARAGRAPH-NAME  08020099
080300             MOVE 'ERROR ON FETCH OF TEPTRN-CURSOR'               08030099
080400                                            TO PV-DB2-OPERATION   08040099
080500             PERFORM 9100-SQL-ABEND                               08050099
080600     END-EVALUATE.                                                08060099
080700                                                                  08070099
080800******************************************************************08080099
080900* ADD THE AMOUNT TO THE AMOUNT FIELDS FOR SALES DATE.  PREPARE    08090099
081000* THE REPORT DETAIL LINE.                                         08100099
081100******************************************************************08110099
081200 2200-PROCESS-LNE-ITM.                                            08120099
081300                                                                  08130099
081400     PERFORM 3000-LOAD-TAX-TOTAL-TABLE.                           08140099
081500     MOVE 'N'                 TO PS-LOADED-SW.                    08150099
081600     MOVE EPTRN-SLS-DTE       TO PV-THE-DATE.                     08160099
081700     MOVE PV-MO               TO RD1-RTN-MONTH.                   08170099
081800     MOVE PV-DY               TO RD1-RTN-DAY.                     08180099
081900     MOVE PV-YR               TO RD1-RTN-YEAR.                    08190099
082000     MOVE RD1-RTN-DATE        TO EX-RTN-DATE.                     08200099
082100                                                                  08210099
082200     MOVE EPTRN-RGST-ID       TO RD1-RTN-RGST-ID                  08220099
082300                                  EX-RTN-RGST-ID.                 08230099
082400                                                                  08240099
082500     MOVE EPTRN-TRN-NBR       TO RD1-RTN-TRN-NBR                  08250099
082600                                 EX-RTN-TRN-NBR.                  08260099
082700                                                                  08270099
082800     MOVE EPTRN-TRN-TOT-AMT   TO RD1-TAX-REFUND                   08280099
082900                                 PV-EACH-REFUND                   08290099
083000                                 PV-HOLD-RETURN-REFUND            08300099
083100                                 EX-TAX-REFUND.                   08310099
083200                                                                  08320099
083300     PERFORM 5000-SELECT-IRT.                                     08330099
083400                                                                  08340099
083500***************************************************************** 08350099
083600* 2300-CLOSE-TEPTRN-CURSOR                                        08360099
083700*      CLOSE CURSOR                                               08370099
083800***************************************************************** 08380099
083900 2300-CLOSE-TEPTRN-CURSOR.                                        08390099
084000                                                                  08400099
084100     EXEC SQL                                                     08410099
084200          CLOSE TEPTRN-CURSOR                                     08420099
084300     END-EXEC.                                                    08430099
084400                                                                  08440099
084500     EVALUATE TRUE                                                08450099
084600         WHEN SQLCODE = ZERO                                      08460099
084700              CONTINUE                                            08470099
084800         WHEN SQLWARN0 NOT EQUAL SPACE                            08480099
084900         WHEN SQLCODE NOT EQUAL ZERO                              08490099
085000             MOVE '2300-CLOSE-TEPTRN-CURSOR'                      08500099
085100                                            TO PV-PARAGRAPH-NAME  08510099
085200             MOVE 'ERROR ON CLOSE OF TEPTRN-CURSOR'               08520099
085300                                            TO PV-DB2-OPERATION   08530099
085400             PERFORM 9100-SQL-ABEND                               08540099
085500     END-EVALUATE.                                                08550099
085600                                                                  08560099
085700                                                                  08570099
085800**************************************************************    08580099
085900*3000-LOAD-TAX-TOTAL-TABLE                                        08590099
086000*     LOAD THE TABLE WITH TOTAL REFUND TAX AMT BY RETURN DATE     08600099
086100*     FOR EACH STORE                                              08610099
086200**************************************************************    08620099
086300  3000-LOAD-TAX-TOTAL-TABLE.                                      08630099
086400                                                                  08640099
086500      PERFORM 3100-SEARCH-TABLE-ENTRY                             08650099
086600          VARYING TBL-INDEX FROM 1 BY 1                           08660099
086700              UNTIL TBL-INDEX > MAX-TABLE-SIZE                    08670099
086800              OR PS-LOADED.                                       08680099
086900                                                                  08690099
087000**************************************************************    08700099
087100*3100-SEARCH-TABLE-ENTRY                                          08710099
087200*     SEARCH AND PROCESS THE TABLE                                08720099
087300**************************************************************    08730099
087400 3100-SEARCH-TABLE-ENTRY.                                         08740099
087500      SEARCH WS-TAX-TOTAL-TABLE                                   08750099
087600          WHEN WS-DATE (TBL-INDEX) = PV-KEEP-DATE                 08760099
087700             MOVE 'Y'                TO PS-LOADED-SW              08770099
087800             ADD EPTRN-TRN-TOT-AMT   TO WS-TAX-AMT (TBL-INDEX)    08780099
087900          WHEN WS-DATE (TBL-INDEX) = SPACES                       08790099
088000                                                                  08800099
088100             MOVE 'Y'                TO PS-LOADED-SW              08810099
088200             MOVE PV-SAVE-DTE        TO WS-DATE(TBL-INDEX)        08820099
088300             ADD EPTRN-TRN-TOT-AMT   TO WS-TAX-AMT (TBL-INDEX).   08830099
088400                                                                  08840099
088500**************************************************************    08850099
088600*3200-PROCESS-TAX-TOTAL-TABLE                                     08860099
088700*     PROCESS THE TABLE                                           08870099
088800**************************************************************    08880099
088900 3200-PROCESS-TAX-TOTAL-TABLE.                                    08890099
089000                                                                  08900099
089100      IF WS-DATE(TBL-INDEX) NOT = SPACES                          08910099
089200          INITIALIZE MS-REFUNDED-TAX                              08920099
089300          MOVE PV-HOLD-STR-NBR       TO MS2-STORE-NBR2            08930099
089400                                        RH2-STORE-NBR2            08940099
089500          MOVE WS-DATE(TBL-INDEX)    TO  MS-RTN-DATE              08950099
089600          MOVE WS-TAX-AMT(TBL-INDEX) TO  MS-REFUNDED-TAX          08960099
089700          PERFORM 6800-WRITE-DETAIL-SUMMARY                       08970099
089800     END-IF.                                                      08980099
089900                                                                  08990099
090000********************************************************          09000099
090100*3400-PRINT TABLE                                                 09010099
090200*     PRINT TABLE VALUES WHEN AFTER STORE CHANGES                 09020099
090300**************************************************************    09030099
090400 3400-PRINT-TABLE.                                                09040099
090500     IF PV-LINE-SPACING2 GREATER PC-LINE-LIMIT                    09050099
090600         PERFORM 6700-WRITE-TAX-SUMMARY-HEADER                    09060099
090700     END-IF.                                                      09070099
090800     MOVE PV-STR-TOT-REFUND-TAX TO MS-STR-TOTL-TAX.               09080099
090900     WRITE TAX-REFUND2-REC FROM MS-STORE-TOTAL                    09090099
091000           AFTER ADVANCING 2 LINES.                               09100099
091100     MOVE +65                   TO  PV-LINE-SPACING2.             09110099
091200     INITIALIZE PV-STR-TOT-REFUND-TAX.                            09120099
091300                                                                  09130099
091400**************************************************************    09140099
091500*4000-GET-STORE-NAME                                              09150099
091600*     GET THE STORE NAME AND MOVE IT TO OUTPUT LINE               09160099
091700**************************************************************    09170099
091800 4000-GET-STORE-NAME.                                             09180099
091900                                                                  09190099
092000     EXEC  SQL                                                    09200099
092100        SELECT LOC_NM                                             09210099
092200        INTO :XST00001-LOC-NM                                     09220099
092300        FROM XST_LOC                                              09230099
092400        WHERE LOC_NBR = :XST00001-LOC-NBR                         09240099
092500        WITH UR                                                   09250099
092600     END-EXEC.                                                    09260099
092700                                                                  09270099
092800     EVALUATE TRUE                                                09280099
092900       WHEN SQLCODE = +0                                          09290099
093000            MOVE XST00001-LOC-NM    TO RH2-STORE-NAME             09300099
093100                                       MS2-STORE-NAME             09310099
093200       WHEN SQLCODE = +100                                        09320099
093300            MOVE 'STORE NAME NOT FOUND' TO RH2-STORE-NAME         09330099
093400                                           MS2-STORE-NAME         09340099
093500       WHEN OTHER                                                 09350099
093600          DISPLAY '** ABEND     **'                               09360099
093700          DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME   09370099
093800          DISPLAY '** PARAGRAPH **  = 4000-GET-STORE-NAME'        09380099
093900          PERFORM 9100-SQL-ABEND                                  09390099
094000     END-EVALUATE.                                                09400099
094100                                                                  09410099
094200**************************************************************    09420099
094300*5000-SELECT-IRT                                                  09430099
094400*     GETS ORIGINAL SALES INFO FROM TEPIRT TABLE                  09440099
094500**************************************************************    09450099
094600 5000-SELECT-IRT.                                                 09460099
094700                                                                  09470099
094800     EXEC SQL                                                     09480099
094900                                                                  09490099
095000        SELECT  B.PARTN_NBR                                       09500099
095100               ,B.ORIG_SLS_DTE                                    09510099
095200               ,B.ORIG_STR_NBR                                    09520099
095300               ,B.ORIG_RGST_ID                                    09530099
095400               ,B.ORIG_TRN_NBR                                    09540099
095500               ,B.ORIG_STRT_TM                                    09550099
095600               ,B.ORIG_LNE_ITM_NBR                                09560099
095700         INTO  :EPIRT-PARTN-NBR                                   09570099
095800              ,:EPIRT-ORIG-SLS-DTE                                09580099
095900              ,:EPIRT-ORIG-STR-NBR                                09590099
096000              ,:EPIRT-ORIG-RGST-ID                                09600099
096100              ,:EPIRT-ORIG-TRN-NBR                                09610099
096200              ,:EPIRT-ORIG-STRT-TM                                09620099
096300              ,:EPIRT-ORIG-LNE-ITM-NBR                            09630099
096400         FROM                                                     09640099
096500              TEPIRT  B                                           09650099
096600         WHERE  PARTN_NBR = :EPTRN-PARTN-NBR                      09660099
096700           AND  STR_NBR =   :EPTRN-STR-NBR                        09670099
096800           AND  RGST_ID =   :EPTRN-RGST-ID                        09680099
096900           AND  TRN_NBR =   :EPTRN-TRN-NBR                        09690099
097000           AND  STRT_TM =   :EPTRN-STRT-TM                        09700099
097100           AND  SLS_CORR_SEQ_NBR = :EPTRN-SLS-CORR-SEQ-NBR        09710099
097200           AND  LNE_ITM_SEQ_NBR = :EPITM-LNE-ITM-SEQ-NBR          09720099
097300         WITH UR                                                  09730099
097400     END-EXEC.                                                    09740099
097500                                                                  09750099
097600     EVALUATE TRUE                                                09760099
097700       WHEN SQLCODE = +0                                          09770099
097800           PERFORM 5200-ORIGINAL                                  09780099
097900       WHEN SQLCODE = +100                                        09790099
098000           PERFORM 5800-NO-ORIG-SALES-DATA                        09800099
098100       WHEN OTHER                                                 09810099
098200          DISPLAY '** ABEND     **'                               09820099
098300          DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME   09830099
098400          DISPLAY '** PARAGRAPH **  = 5000-SELECT-IRT'            09840099
098500          PERFORM 9100-SQL-ABEND                                  09850099
098600     END-EVALUATE.                                                09860099
098700                                                                  09870099
098800******************************************************************09880099
098900*5100-SELECT-ORIG-TRAN-AMT                                        09890099
099000*  SELECT TRANS AND SALES AMT INFO FROM TEPTRN TABLE              09900099
099100*  THIS COMBINES TEPPART WITH TEPTRN FOR THE TRANSACTIONS WE WANT 09910099
099200*  WITH THE SAME PARTITION NUMBER                                 09920099
099300******************************************************************09930099
099400 5100-SELECT-ORIG-TRAN-AMT.                                       09940099
099500     EXEC SQL                                                     09950099
099600                                                                  09960099
099700         SELECT A.TRN_TOT_AMT                                     09970099
099800               ,A.SLS_TX_AMT                                      09980099
099900         INTO :EPTRN-TRN-TOT-AMT                                  09990099
100000             ,:EPTRN-SLS-TX-AMT                                   10000099
100100         FROM TEPTRN  A                                           10010099
100200             ,TEPPART B                                           10020099
100300         WHERE B.SLS_DTE = :EPIRT-ORIG-SLS-DTE                    10030099
100400           AND A.PARTN_NBR = B.PARTN_NBR                          10040099
100500           AND A.STR_NBR = :EPIRT-ORIG-STR-NBR                    10050099
100600           AND A.RGST_ID = :EPIRT-ORIG-RGST-ID                    10060099
100700           AND A.TRN_NBR = :EPIRT-ORIG-TRN-NBR                    10070099
100800           AND A.STRT_TM = :EPIRT-ORIG-STRT-TM                    10080099
100900           AND A.SLS_CORR_SEQ_NBR = 0                             10090099
101000         WITH UR                                                  10100099
101100     END-EXEC.                                                    10110099
101200                                                                  10120099
101300     EVALUATE TRUE                                                10130099
101400       WHEN SQLCODE = +0                                          10140099
101500           PERFORM 5300-CALC-TRANS-WITHOUT                        10150099
101600       WHEN SQLCODE = +100                                        10160099
101700           PERFORM 5850-NO-ORIG-SALES-DATA                        10170099
101800       WHEN OTHER                                                 10180099
101900          DISPLAY '** ABEND     **'                               10190099
102000          DISPLAY '** PROGRAM   **  = ' PC-CURRENT-PROGRAM-NAME   10200099
102100          DISPLAY '** PARAGRAPH **  = 5100-SELECT-ORIG-TRAN-AMT'  10210099
102200          DISPLAY '**ORIGINAL SALES DATE = ' EPIRT-ORIG-SLS-DTE   10220099
102300          DISPLAY '**ORIGINAL STRT  DATE = ' EPIRT-ORIG-STRT-TM   10230099
102400          PERFORM 9100-SQL-ABEND                                  10240099
102500     END-EVALUATE.                                                10250099
102600                                                                  10260099
102700**************************************************************    10270099
102800*5200-ORIGINAL                                                    10280099
102900*     MOVE ORIGINAL TRANSACTIONS TO REPORT & EXCEL SPREADSHEET    10290099
103000**************************************************************    10300099
103100 5200-ORIGINAL.                                                   10310099
103200                                                                  10320099
103300      MOVE EPIRT-ORIG-SLS-DTE          TO PV-THE-DATE.            10330099
103400      MOVE PV-YR                       TO RD1-ORIG-YEAR.          10340099
103500      MOVE '/'                         TO RD1-SLASH1.             10350099
103600      MOVE PV-MO                       TO RD1-ORIG-MONTH.         10360099
103700      MOVE '/'                         TO RD1-SLASH2.             10370099
103800      MOVE PV-DY                       TO RD1-ORIG-DAY.           10380099
103900      MOVE RD1-ORIG-DTE                TO EX-ORIG-DTE.            10390099
104000                                                                  10400099
104100      MOVE EPIRT-ORIG-STR-NBR          TO RD1-ORIG-STORE-NBR      10410099
104200                                          EX-ORIG-STORE-NBR.      10420099
104300                                                                  10430099
104400      MOVE SPACES                      TO RD1-FILLER1             10440099
104500                                          RD1-FILLER2             10450099
104600                                          RD1-FILLER3.            10460099
104700                                                                  10470099
104800      MOVE EPIRT-ORIG-RGST-ID          TO RD1-ORIG-RGST-ID        10480099
104900                                          EX-ORIG-RGST-ID.        10490099
105000                                                                  10500099
105100      MOVE '/'                         TO RD1-SLASH3.             10510099
105200      MOVE EPIRT-ORIG-TRN-NBR          TO RD1-ORIG-TRN-NBR        10520099
105300                                          EX-ORIG-TRN-NBR.        10530099
105400                                                                  10540099
105500      PERFORM 5100-SELECT-ORIG-TRAN-AMT.                          10550099
105600                                                                  10560099
105700**************************************************************    10570099
105800*5300-CALC-TRANS-WITHOUT                                          10580099
105900*    MOVE TRANSACTION W/TAX AMOUNT TO REPORT & EXCEL SPREADSHEET  10590099
106000*    MOVE SALES TAX AMOUNT TO REPORT & EXCEL SPREADSHEET          10600099
106100*    MOVE TRANSACTION & SALES TAX AMOUNT TO HOLDING FIELDS        10610099
106200*    COMPUTE TOTAL BEFORE TAX                                     10620099
106300*    MOVE TRANSACTION W/O TAX AMOUNT TO REPORT & EXCEL SPREADSHEET10630099
106400**************************************************************    10640099
106500 5300-CALC-TRANS-WITHOUT.                                         10650099
106600     MOVE EPTRN-TRN-TOT-AMT           TO RD1-TOT-WITH             10660099
106700                                         EX-TOT-WITH              10670099
106800                                         PV-HOLD-WITH.            10680099
106900                                                                  10690099
107000     MOVE EPTRN-SLS-TX-AMT            TO RD1-TOT-TAX              10700099
107100                                         EX-TOT-TAX               10710099
107200                                         PV-HOLD-TAX.             10720099
107300     COMPUTE PV-HOLD-WITHOUT =                                    10730099
107400             PV-HOLD-WITH - PV-HOLD-TAX .                         10740099
107500                                                                  10750099
107600     MOVE PV-HOLD-WITHOUT             TO RD1-TOT-WITHOUT          10760099
107700                                         EX-TOT-WITHOUT.          10770099
107800     COMPUTE PV-HOLD-VARIANCE =                                   10780099
107900             PV-HOLD-TAX -  PV-HOLD-RETURN-REFUND.                10790099
108000                                                                  10800099
108100                                                                  10810099
108200     MOVE PV-HOLD-VARIANCE            TO RD1-VARIANCE             10820099
108300                                         EX-VARIANCE.             10830099
108400     PERFORM 6100-WRITE-REPORT.                                   10840099
108500     PERFORM 8800-CREATE-EXCEL-FILE.                              10850099
108600                                                                  10860099
108700     ADD PV-HOLD-VARIANCE          TO PV-ACCUM-VARIANCE.          10870099
108800     ADD PV-EACH-REFUND            TO PV-ACCUM-REFUND.            10880099
108900                                                                  10890099
109000*******************************************************           10900099
109100*5700-END-VARIANCE-REFUND                                         10910099
109200*     WRITE ACCUMULATED VALUES FOR VARIANCE AND REFUND            10920099
109300*     TO REPORT & EXCEL SPREADSHEET                               10930099
109400*******************************************************           10940099
109500 5700-END-VARIANCE-REFUND.                                        10950099
109600                                                                  10960099
109700     MOVE PV-ACCUM-REFUND           TO RT-TOT-ALL-REFUND.         10970099
109800     MOVE RT-TOT-ALL-REFUND         TO TAX-REFUND-REC.            10980099
109900                                                                  10990099
110000     MOVE PV-ACCUM-VARIANCE         TO RT-TOT-VARIANCE.           11000099
110100     MOVE RT-TOT-VARIANCE           TO TAX-REFUND-REC.            11010099
110200                                                                  11020099
110300     PERFORM 6200-WRITE-ACCUMULATED-TOTALS.                       11030099
110400                                                                  11040099
110500*******************************************************           11050099
110600*5800-NO-ORIG-SALES-DATA                                          11060099
110700*     INITIALIZE DETAIL LINES WHEN THERE ISN'T ANY                11070099
110800*     ORIGINIAL SALES DATA                                        11080099
110900*******************************************************           11090099
111000 5800-NO-ORIG-SALES-DATA.                                         11100099
111100                                                                  11110099
111200     ADD PV-EACH-REFUND            TO PV-ACCUM-REFUND.            11120099
111300     IF EPTRN-TRN-TYP-CDE = PC-01 OR PC-02                        11130099
111400         MOVE 'ENTERED AS A SALE TRANSACTION' TO RD1-NO-SALE-DATA 11140099
111500     ELSE                                                         11150099
111600         MOVE 'NO ORIGINAL SALES DATA FOUND ' TO RD1-NO-SALE-DATA 11160099
111700     END-IF.                                                      11170099
111800     MOVE SPACES                    TO RD1-ORIG-INFO4.            11180099
111900     MOVE SPACES                    TO RD1-ORIG-INFO5.            11190099
112000     MOVE SPACES                    TO RD1-ORIG-INFO6.            11200099
112100     MOVE SPACES                    TO RD1-ORIG-INFO7.            11210099
112200     PERFORM 6300-WRITE-ORIG-DETAILS.                             11220099
112300                                                                  11230099
112400*******************************************************           11240099
112500*5850-NO-ORIG-SALES-DATA                                          11250099
112600*     INITIALIZE DETAIL LINES WHEN THERE ISN'T ANY                11260099
112700*     ORIGINIAL SALES DATA                                        11270099
112800*******************************************************           11280099
112900 5850-NO-ORIG-SALES-DATA.                                         11290099
113000                                                                  11300099
113100     MOVE EPTRN-SLS-DTE       TO PV-THE-DATE.                     11310099
113200     MOVE PV-MO               TO RD1-RTN-MONTH.                   11320099
113300     MOVE PV-DY               TO RD1-RTN-DAY.                     11330099
113400     MOVE PV-YR               TO RD1-RTN-YEAR.                    11340099
113500     ADD PV-EACH-REFUND       TO PV-ACCUM-REFUND.                 11350099
113600     MOVE  "ORIGINAL SALES DATA NOT AVAILABLE"                    11360099
113700                              TO RD1-NO-SALE-DATA.                11370099
113800     MOVE SPACES              TO RD1-ORIG-INFO4                   11380099
113900                                 RD1-ORIG-INFO5                   11390099
114000                                 RD1-ORIG-INFO6                   11400099
114100                                 RD1-ORIG-INFO7.                  11410099
114200     PERFORM 6300-WRITE-ORIG-DETAILS.                             11420099
114300*******************************************************           11430099
114400*6100-WRITE-REPORT                                                11440099
114500*     WRITE-REPORT FROM DETAIL LINES                              11450099
114600*******************************************************           11460099
114700 6100-WRITE-REPORT.                                               11470099
114800     IF  PV-LINE-SPACING GREATER PC-LINE-LIMIT                    11480099
114900         PERFORM 9000-HEADER-ROUTINE-1                            11490099
115000     END-IF.                                                      11500099
115100                                                                  11510099
115200     WRITE TAX-REFUND-REC FROM RD1-DETAIL                         11520099
115300        AFTER ADVANCING 1 LINES.                                  11530099
115400     ADD +1                           TO PV-LINE-SPACING.         11540099
115500*******************************************************           11550099
115600*6200-WRITE-ACCUMULATED-TOTALS                                    11560099
115700*     WRITE-ACCUMULATED TOTALS TO REPORT                          11570099
115800*******************************************************           11580099
115900 6200-WRITE-ACCUMULATED-TOTALS.                                   11590099
116000                                                                  11600099
116100     IF  PV-LINE-SPACING GREATER PC-LINE-LIMIT                    11610099
116200         PERFORM 9000-HEADER-ROUTINE-1                            11620099
116300     END-IF.                                                      11630099
116400     WRITE TAX-REFUND-REC  FROM RH1-SPACES                        11640099
116500        AFTER ADVANCING 1 LINES.                                  11650099
116600     ADD +1                           TO PV-LINE-SPACING.         11660099
116700                                                                  11670099
116800     IF  PV-LINE-SPACING GREATER PC-LINE-LIMIT                    11680099
116900         PERFORM 9000-HEADER-ROUTINE-1                            11690099
117000     END-IF.                                                      11700099
117100                                                                  11710099
117200     MOVE PV-HOLD-STR-NBR TO RT-STORE-NBR.                        11720099
117300                                                                  11730099
117400     WRITE TAX-REFUND-REC FROM RT-TOTAL-LINES                     11740099
117500        AFTER ADVANCING 1 LINES.                                  11750099
117600     ADD +1                            TO  PV-LINE-SPACING.       11760099
117700                                                                  11770099
117800*******************************************************           11780099
117900*6300-WRITE-ORIG-DETAILS                                          11790099
118000*     WRITE REPORT FROM ORIG DETAIL LINES                         11800099
118100*******************************************************           11810099
118200 6300-WRITE-ORIG-DETAILS.                                         11820099
118300                                                                  11830099
118400     IF  PV-LINE-SPACING GREATER PC-LINE-LIMIT                    11840099
118500         PERFORM 9000-HEADER-ROUTINE-1                            11850099
118600     END-IF.                                                      11860099
118700     WRITE TAX-REFUND-REC FROM RD1-DETAIL                         11870099
118800        AFTER ADVANCING 1 LINES.                                  11880099
118900     ADD +1                           TO  PV-LINE-SPACING.        11890099
119000*******************************************************           11900099
119100*6500-WRITE-NO-TRANSACTION                                        11910099
119200*     WRITE-REPORT FOR  NO TRANSACTION                            11920099
119300*******************************************************           11930099
119400 6500-WRITE-NO-TRANSACTION.                                       11940099
119500     WRITE TAX-REFUND-REC FROM RH-NO-TRANSACTIONS                 11950099
119600        AFTER ADVANCING 2 LINES.                                  11960099
119700     ADD +1                           TO PV-LINE-SPACING.         11970099
119800     WRITE TAX-REFUND2-REC FROM RH-NO-TRANSACTIONS                11980099
119900        AFTER ADVANCING 2 LINES.                                  11990099
120000     ADD +1                           TO PV-LINE-SPACING2.        12000099
120100*******************************************************           12010099
120200*6600-WRITE-STORE-CHANGE                                          12020099
120300*     WRITE-REPORT HEADING IF STORE CHANGES                       12030099
120400*******************************************************           12040099
120500 6600-WRITE-STORE-CHANGE.                                         12050099
120600                                                                  12060099
120700     IF  PV-LINE-SPACING GREATER PC-LINE-LIMIT                    12070099
120800         PERFORM 9000-HEADER-ROUTINE-1                            12080099
120900     END-IF.                                                      12090099
121000     WRITE TAX-REFUND-REC  FROM RH1-SPACES                        12100099
121100        AFTER ADVANCING 1 LINES.                                  12110099
121200     ADD +1                           TO PV-LINE-SPACING.         12120099
121300                                                                  12130099
121400     PERFORM 5700-END-VARIANCE-REFUND.                            12140099
121500                                                                  12150099
121600     PERFORM 3200-PROCESS-TAX-TOTAL-TABLE                         12160099
121700      VARYING TBL-INDEX FROM 1     BY 1                           12170099
121800         UNTIL TBL-INDEX > MAX-TABLE-SIZE.                        12180099
121900                                                                  12190099
122000     PERFORM 3400-PRINT-TABLE.                                    12200099
122100     INITIALIZE RT-TOT-ALL-REFUND.                                12210099
122200     INITIALIZE RT-TOT-VARIANCE.                                  12220099
122300     INITIALIZE RD1-VARIANCE.                                     12230099
122400     INITIALIZE PV-EACH-REFUND.                                   12240099
122500     INITIALIZE PV-ACCUM-REFUND.                                  12250099
122600     INITIALIZE PV-ACCUM-VARIANCE.                                12260099
122700     INITIALIZE PV-HOLD-VARIANCE.                                 12270099
122800     INITIALIZE PV-HOLD-TAX.                                      12280099
122900     INITIALIZE TAX-TABLE.                                        12290099
123000                                                                  12300099
123100     MOVE EPTRN-STR-NBR                 TO RH2-STORE-NBR2         12310099
123200                                           MS2-STORE-NBR2         12320099
123300                                           XST00001-LOC-NBR.      12330099
123400     PERFORM 4000-GET-STORE-NAME.                                 12340099
123500     MOVE EPTRN-SLS-DTE                 TO PV-THE-DATE.           12350099
123600     MOVE PV-MO                         TO RD1-RTN-MONTH.         12360099
123700     MOVE PV-DY                         TO RD1-RTN-DAY.           12370099
123800     MOVE PV-YR                         TO RD1-RTN-YEAR.          12380099
123900     PERFORM 9000-HEADER-ROUTINE-1.                               12390099
124000                                                                  12400099
124100******************************************************************12410099
124200*6700-WRITE-TAX-SUMMARY-HEADER.                                   12420099
124300*     AFTER THE TABLE IS LOADED AN ACCUMULATED TOTAL IS WRITTEN   12430099
124400*     TO THE MONTHLY SUMMARY REPORT                               12440099
124500******************************************************************12450099
124600 6700-WRITE-TAX-SUMMARY-HEADER.                                   12460099
124700                                                                  12470099
124800     MOVE PC-CURRENT-PROGRAM-NAME     TO DP132O-PROGRAM-NAME.     12480099
124900     ADD +1                           TO PV-PAGE-CNT2.            12490099
125000     MOVE '2'                         TO DP132O-REPORT-NUMBER.    12500099
125100     MOVE PV-PAGE-CNT2                TO DP132O-PAGE-NUMBER.      12510099
125200     PERFORM 9900-WRITE-RPT-TOP-OF-PAGE.                          12520099
125300                                                                  12530099
125400     WRITE TAX-REFUND2-REC  FROM MS-HEADER1                       12540099
125500        AFTER ADVANCING 1 LINES.                                  12550099
125600                                                                  12560099
125700     WRITE TAX-REFUND2-REC  FROM MS-HEADER1B                      12570099
125800        AFTER ADVANCING 1 LINES.                                  12580099
125900                                                                  12590099
126000     WRITE TAX-REFUND2-REC  FROM RH1-SPACES                       12600099
126100        AFTER ADVANCING 1 LINES.                                  12610099
126200     MOVE +4                          TO PV-LINE-SPACING2.        12620099
126300                                                                  12630099
126400     WRITE TAX-REFUND2-REC   FROM MS-HEADER2                      12640099
126500            AFTER ADVANCING 3 LINES.                              12650099
126600     ADD +3                            TO  PV-LINE-SPACING2.      12660099
126700                                                                  12670099
126800     WRITE TAX-REFUND2-REC   FROM MS-HEADER3                      12680099
126900            AFTER ADVANCING 2 LINES.                              12690099
127000     ADD +2                            TO  PV-LINE-SPACING2.      12700099
127100                                                                  12710099
127200     WRITE TAX-REFUND2-REC  FROM RH1-SPACES                       12720099
127300        AFTER ADVANCING 1 LINES.                                  12730099
127400                                                                  12740099
127500     ADD +1                            TO  PV-LINE-SPACING2.      12750099
127600                                                                  12760099
127700*******************************************************           12770099
127800*6800-WRITE-DETAIL-SUMMARY                                        12780099
127900*     WRITE DETAIL LINES TO MONTHLY SUMMARY                       12790099
128000*******************************************************           12800099
128100 6800-WRITE-DETAIL-SUMMARY.                                       12810099
128200                                                                  12820099
128300     IF  PV-LINE-SPACING2 GREATER PC-LINE-LIMIT                   12830099
128400         PERFORM 6700-WRITE-TAX-SUMMARY-HEADER                    12840099
128500     END-IF.                                                      12850099
128600     WRITE TAX-REFUND2-REC FROM MS-MONTHLY-SUMMARY                12860099
128700        AFTER ADVANCING 1 LINE.                                   12870099
128800     ADD +1 TO PV-LINE-SPACING2.                                  12880099
128900     ADD WS-TAX-AMT(TBL-INDEX) TO  PV-STR-TOT-REFUND-TAX.         12890099
129000                                                                  12900099
129100******************************************************************12910099
129200* 8800-CREATE-EXCEL-FILE                                          12920099
129300*     AFTER EACH DETAIL LINE IS PRINTED, MOVE THE DATA FROM THE   12930099
129400*     DETAIL LINE TO THE EXCEL OUTPUT LINE AND PRINT.             12940099
129500******************************************************************12950099
129600                                                                  12960099
129700  8800-CREATE-EXCEL-FILE.                                         12970099
129800                                                                  12980099
129900     WRITE TX-TAX-EXTRACT-RECORD  FROM EXCEL-DETAIL.              12990099
130000                                                                  13000099
130100*                                                                 13010099
130200******************************************************************13020099
130300* 9000-HEADER-ROUTINE-1                                           13030099
130400*     PRINT THE HEADINGS FOR THE TAX AUDIT REPORT.                13040099
130500******************************************************************13050099
130600                                                                  13060099
130700 9000-HEADER-ROUTINE-1.                                           13070099
130800                                                                  13080099
130900     MOVE '1'                         TO DP132O-REPORT-NUMBER.    13090099
131000     ADD +1                           TO PV-PAGE-CNT1.            13100099
131100     MOVE PV-PAGE-CNT1                TO DP132O-PAGE-NUMBER.      13110099
131200     PERFORM 9800-WRITE-RPT-TOP-OF-PAGE.                          13120099
131300                                                                  13130099
131400                                                                  13140099
131500     WRITE TAX-REFUND-REC  FROM RH-HEADER1                        13150099
131600        AFTER ADVANCING 1 LINES.                                  13160099
131700                                                                  13170099
131800     WRITE TAX-REFUND-REC  FROM RH-HEADER1B                       13180099
131900        AFTER ADVANCING 1 LINES.                                  13190099
132000                                                                  13200099
132100     WRITE TAX-REFUND-REC  FROM RH-HEADER2                        13210099
132200        AFTER ADVANCING 1 LINES.                                  13220099
132300                                                                  13230099
132400     WRITE TAX-REFUND-REC  FROM RH-HEADER3                        13240099
132500        AFTER ADVANCING 2 LINES.                                  13250099
132600                                                                  13260099
132700     WRITE TAX-REFUND-REC  FROM RH-HEADER3A                       13270099
132800        AFTER ADVANCING 1 LINES.                                  13280099
132900                                                                  13290099
133000     WRITE TAX-REFUND-REC  FROM RH-HEADER3B                       13300099
133100        AFTER ADVANCING 1 LINES.                                  13310099
133200                                                                  13320099
133300     WRITE TAX-REFUND-REC  FROM RH-HEADER4                        13330099
133400        AFTER ADVANCING 1 LINES.                                  13340099
133500                                                                  13350099
133600     WRITE TAX-REFUND-REC  FROM RH1-SPACES                        13360099
133700        AFTER ADVANCING 1 LINES.                                  13370099
133800     MOVE +9                          TO PV-LINE-SPACING.         13380099
133900                                                                  13390099
134000******************************************************************13400099
134100* 9800-WRITE-RPT-TOP-OF-PAGE                                      13410099
134200*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   13420099
134300******************************************************************13430099
134400 9800-WRITE-RPT-TOP-OF-PAGE.                                      13440099
134500                                                                  13450099
134600     WRITE TAX-REFUND-REC                                         13460099
134700       FROM DP132O-STANDRD-HEADER-132-COLS                        13470099
134800         AFTER ADVANCING PAGE.                                    13480099
134900     MOVE +1                          TO PV-LINE-SPACING.         13490099
135000                                                                  13500099
135100******************************************************************13510099
135200* 9900-WRITE-RPT-TOP-OF-PAGE                                      13520099
135300*     WRITE FIRST REPORT LINE AFTER PAGE BREAK FOR SUMMARY        13530099
135400******************************************************************13540099
135500 9900-WRITE-RPT-TOP-OF-PAGE.                                      13550099
135600                                                                  13560099
135700     WRITE TAX-REFUND2-REC                                        13570099
135800       FROM DP132O-STANDRD-HEADER-132-COLS                        13580099
135900         AFTER ADVANCING PAGE.                                    13590099
136000     MOVE +1                          TO PV-LINE-SPACING2.        13600099
136100                                                                  13610099
136200******************************************************************13620099
136300* 9100-SQL-ABEND                                                  13630099
136400*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.13640099
136500******************************************************************13650099
136600 9100-SQL-ABEND.                                                  13660099
136700     DISPLAY '** ABEND     **'.                                   13670099
136800     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        13680099
136900     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              13690099
137000     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               13700099
137100                                                                  13710099
137200******************************************************************13720099
137300* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     13730099
137400* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      13740099
137500******************************************************************13750099
137600     COPY DPPD004.                                                13760099
137700                                                                  13770099
137800     SET AC-DB2-ERROR TO TRUE.                                    13780099
137900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         13790099
138000                                                                  13800099
138100******************************************************************13810099
138200* 9999-ABEND                                                      13820099
138300*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  13830099
138400******************************************************************13840099
138500 9999-ABEND.                                                      13850099
138600     DISPLAY '** ABEND           **'.                             13860099
138700     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  13870099
138800     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        13880099
138900     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       13890099
139000     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       13900099
139100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         13910099
