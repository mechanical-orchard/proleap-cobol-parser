000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.     APKUT285.                                        00020000
000300 AUTHOR.         NANCY EILBES.                                    00030000
000400 DATE-WRITTEN.   MAY 2022.                                        00040002
000500 DATE-COMPILED.                                                   00050000
000600******************************************************************00060000
000700*   JOURNALIZED RECEIPT EXTRACT BY PO                            *00070000
000800*                                                                *00080000
000900*   COBOL390 WITH SQL                                            *00090000
001000*                                                                *00100000
001100*  THIS PROGRAM WILL EXTRACT THE TOTAL COST OF JOURNALIZED       *00110000
001200*  RECEIPTS BY PO FOR THE FISCAL WEEK BEING PROCESSED.  THIS     *00120000
001300*  FILE WILL BE CONVERTED TO TEXT AND SENT TO THE FINANCE TEAM   *00130000
001400*  FOR ANALYSIS OF THE UNJOURNALIZED RECEIPTS.                   *00140000
001500*                                                                *00150000
001600*  THIS PROGRAM IS BASED ON APKUT004 AND ANY SIGNIFICANT LOGIC   *00160000
001700*  CHANGES TO HOW THE COST IS CALCULATED IN THAT PROGRAM SHOULD  *00170000
001800*  ALSO BE APPLIED HERE.                                         *00180000
001810*                                                                *00181000
001900* INPUT:                                                         *00190000
002000*  1. DATE CONTROL CARD                                          *00200000
002100*                                                                *00210000
002200* DB2:                                                           *00220000
002300*  1. PO-PURCHASE ITEM TABLE                      (TPURITM)      *00230000
002400*  2. RC-RECEIPT DISTRIBUTION TABLE               (TRECDIS)      *00240000
002500*  3. RC-RECEIPT ITEM TABLE                       (TRECITM)      *00250000
002510*  4. PURCHASE ORDER TABLE                        (TPURCHS)      *00251000
002520*                                                                *00252000
002530* OUTPUT:                                                        *00253000
002540*  1. JOURNALIZED RECEIPTS BY PO                  (APRD008)      *00254000
002550*                                                                *00255000
002560*----------------------------------------------------------------*00256000
002561* CHANGE LOG:                                                    *00256103
002562* DATE  05/09/2022                                               *00256203
002563*     CHANGE MADE: INITIAL IMPLEMENTATION.                       *00256303
002564*     MADE BY: NANCY EILBES            WR/IR #: CHG0269842       *00256403
002567*----------------------------------------------------------------*00256703
002570                                                                  00257000
002580 ENVIRONMENT DIVISION.                                            00258000
002590 CONFIGURATION SECTION.                                           00259000
002600 SOURCE-COMPUTER.    IBM-3090.                                    00260000
002700 OBJECT-COMPUTER.    IBM-3090.                                    00270000
002800                                                                  00280000
002900 INPUT-OUTPUT SECTION.                                            00290000
003000 FILE-CONTROL.                                                    00300000
003100     SELECT JOURNALIZED-BY-PO-FILE        ASSIGN TO UT-S-OUT01.   00310000
003200                                                                  00320000
003300 DATA DIVISION.                                                   00330000
003400 FILE SECTION.                                                    00340000
003500                                                                  00350000
003600 FD  JOURNALIZED-BY-PO-FILE                                       00360000
003700     RECORDING MODE IS F                                          00370000
003800     LABEL RECORDS ARE STANDARD                                   00380000
003810     DATA RECORD IS JOURNALIZED-BY-PO-REC.                        00381000
003820 01  JOURNALIZED-BY-PO-REC       PIC  X(50).                      00382000
003830                                                                  00383000
003840 WORKING-STORAGE SECTION.                                         00384000
003850                                                                  00385000
003860 01  PC-PROGRAM-CONSTANTS.                                        00386000
003870     05  FILLER                  PIC  X(30)  VALUE                00387000
003880         '** BEGINING OF APKUT285 W/S **'.                        00388000
003890                                                                  00389000
003900     05  PC-PROGRAM-NAME         PIC  X(08)     VALUE 'APKUT285'. 00390000
004000     05  PC-JOURNALIZED-RCPTS.                                    00400000
004100         10  FILLER              PIC  X(20)     VALUE             00410000
004200             'JOURNALIZED RECEIPT '.                              00420000
004300         10  PC-VRFD-RCPTS-DTE   PIC  X(10)     VALUE SPACES.     00430000
004400                                                                  00440000
004500 01  PV-PROGRAM-VARIABLES.                                        00450000
004600     05  PV-CURRENT-DATE.                                         00460000
004700         10  PV-CURRENT-CCYY     PIC  9(04)     VALUE ZEROS.      00470000
004800         10  PV-CURRENT-MONTH    PIC  9(02)     VALUE ZEROS.      00480000
004900         10  PV-CURRENT-DAY      PIC  9(02)     VALUE ZEROS.      00490000
005000     05  PV-DISPLAY-DATE.                                         00500000
005100         10  PV-DISPLAY-MONTH    PIC  9(02)     VALUE ZEROS.      00510000
005200         10  FILLER              PIC  X(01)     VALUE '-'.        00520000
005300         10  PV-DISPLAY-DAY      PIC  9(02)     VALUE ZEROS.      00530000
005400         10  FILLER              PIC  X(01)     VALUE '-'.        00540000
005500         10  PV-DISPLAY-CCYY     PIC  9(04)     VALUE ZEROS.      00550000
005600     05  PV-RUN-DTE-CYMD.                                         00560000
005700         10  PV-RUN-DTE-CC       PIC  X(02)     VALUE SPACES.     00570000
005800         10  PV-RUN-DTE-YY       PIC  X(02)     VALUE SPACES.     00580000
005900         10  PV-RUN-DTE-MM       PIC  X(02)     VALUE SPACES.     00590000
006000         10  PV-RUN-DTE-DD       PIC  X(02)     VALUE SPACES.     00600000
006100     05  PV-START-DTE            PIC  X(10)     VALUE SPACES.     00610000
006200     05  PV-END-DTE              PIC  X(10)     VALUE SPACES.     00620000
006300     05  PV-RCPTS-AMT            PIC S9(15)V99  VALUE ZEROS       00630000
006400                                                COMP-3.           00640000
006410     05  PV-RECITM-AMT            PIC S9(15)V99  VALUE ZEROS      00641001
006420                                                COMP-3.           00642001
006430     05  PV-TOTAL-AMT            PIC S9(15)V99  VALUE ZEROS       00643001
006440                                                COMP-3.           00644001
006450     05  PV-TOTAL-RECITM-AMT     PIC S9(15)V99  VALUE ZEROS       00645001
006460                                                COMP-3.           00646001
006700     05  PV-RCPTS-COST           PIC S9(15)V999 VALUE ZEROS       00670000
006900                                                COMP-3.           00690000
006910     05  PV-RECITM-COST           PIC S9(15)V99  VALUE ZEROS      00691001
006920                                                COMP-3.           00692001
007000     05  PV-OUT-COST             PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.    00700000
007100     05  PV-OUT-AMT              PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99-.     00710000
007200     05  PV-DISPLAY-COST         PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.999-.    00720000
007300     05  PV-DISPLAY-AMT          PIC ZZZ,ZZZ,ZZZ,ZZZ,ZZ9.99-.     00730000
007310     05  PV-DISPLAY-LINE         PIC ZZZ9.                        00731000
007320     05  PV-SUMMED-ITM-QTY       PIC S9(9)      COMP.             00732000
007330                                                                  00733000
007340 01  HOLD-FIELDS.                                                 00734000
007350     05  HOLD-ORD-NBR            PIC S9(9)      VALUE 0 COMP.     00735000
007360                                                                  00736000
007370 01  PV-COUNTERS.                                                 00737000
007380     05  PV-RETRY-COUNTER        PIC S9(04)     COMP.             00738000
007400     05  PV-COUNT-APRD008        PIC  9(07)     COMP-3.           00740000
007500                                                                  00750000
007600 01  PS-PROGRAM-SWITCHES.                                         00760000
007700     05  PS-END-OF-RECDIS-CSR    PIC X(01)      VALUE 'N'.        00770000
007800         88  NOT-END-OF-RECDIS-CSR              VALUE 'N'.        00780000
007900         88  END-OF-RECDIS-CSR                  VALUE 'Y'.        00790000
008000     05  PS-END-OF-POLINE-CSR    PIC X(01)      VALUE 'N'.        00800000
008100         88  NOT-END-OF-POLINE-CSR              VALUE 'N'.        00810000
008200         88  END-OF-POLINE-CSR                  VALUE 'Y'.        00820000
008300     05  PS-NEW-ORD-NBR          PIC X(01)      VALUE 'N'.        00830000
008400         88  NEW-ORD-NBR                        VALUE 'N'.        00840000
008500         88  SAME-ORD-NBR                       VALUE 'Y'.        00850000
008510     05  PV-COST-CHANGES-SW      PIC X(01)      VALUE 'N'.        00851001
008520         88  PV-NO-COST-CHANGES                 VALUE 'N'.        00852001
008530         88  PV-COST-CHANGES                    VALUE 'Y'.        00853001
008600                                                                  00860000
008700                                                                  00870000
008800*----------------------------------------------------------------*00880000
008900*  COMMUNICATIONS AREA2 FOR DB2                                  *00890000
009000*----------------------------------------------------------------*00900000
009100     COPY SQLCA2.                                                 00910000
009200                                                                  00920000
009300     EXEC SQL                                                     00930000
009400          INCLUDE SQLCA                                           00940000
009500     END-EXEC.                                                    00950000
009600                                                                  00960000
009700*----------------------------------------------------------------*00970000
009800*  PO-PURCHASE ITEM TABLE                                        *00980000
009900*----------------------------------------------------------------*00990000
010000     EXEC SQL                                                     01000000
010100          INCLUDE TPURITM                                         01010000
010200     END-EXEC.                                                    01020000
010300                                                                  01030000
010400*----------------------------------------------------------------*01040000
010500*  PO-PURCHASE ORDER TABLE                                       *01050000
010600*----------------------------------------------------------------*01060000
010700     EXEC SQL                                                     01070000
010800          INCLUDE TPURCHS                                         01080000
010900     END-EXEC.                                                    01090000
011000                                                                  01100000
011100*----------------------------------------------------------------*01110000
011200*  RC-RECEIPT DISTRIBUTION TABLE                                 *01120000
011300*----------------------------------------------------------------*01130000
011400     EXEC SQL                                                     01140000
011500          INCLUDE TRECDIS                                         01150000
011600     END-EXEC.                                                    01160000
011700                                                                  01170000
011800*----------------------------------------------------------------*01180000
011900*  RC-RECEIPT ITEM TABLE                                         *01190000
012000*----------------------------------------------------------------*01200000
012100     EXEC SQL                                                     01210000
012200          INCLUDE TRECITM                                         01220000
012300     END-EXEC.                                                    01230000
012400                                                                  01240000
012500*----------------------------------------------------------------*01250000
012600*  RECDIS CURSOR                                                 *01260000
012700*----------------------------------------------------------------*01270000
012800     EXEC SQL                                                     01280000
012900         DECLARE RECDIS_CSR CURSOR FOR                            01290000
013000             SELECT ORD_NBR                                       01300000
013100                  , REC_SEQ_NBR                                   01310000
013300                  , ORD_LNE_NBR                                   01330000
013400                  , SUM(AP_VERIFY_ITM_QTY)                        01340000
013500               FROM TRECDIS                                       01350000
013600              WHERE AP_PRC_CDE IN ('J','W')                       01360000
013700                AND VER_STATUS_CDE = 'A'                          01370000
013800                AND AP_PRC_DTE BETWEEN :PV-START-DTE              01380000
013900                                   AND :PV-END-DTE                01390000
014000              GROUP BY ORD_NBR                                    01400000
014100                     , REC_SEQ_NBR                                01410000
014300                     , ORD_LNE_NBR                                01430000
014400              ORDER BY ORD_NBR                                    01440000
014500                     , REC_SEQ_NBR                                01450000
014600                     , ORD_LNE_NBR                                01460000
014800     END-EXEC.                                                    01480000
014900*----------------------------------------------------------------*01490000
015000*  POLINE CURSOR                                                 *01500000
015100*----------------------------------------------------------------*01510000
015200     EXEC SQL                                                     01520000
015300         DECLARE POLINE_CSR CURSOR FOR                            01530000
015400             SELECT PI.APP_PO_LNE_NBR                             01540000
015500                  , PI.UNT_COST_AMT                               01550000
015600                  , RI.REC_SEQ_NBR                                01560000
015700                  , PI.PRD_1ST_COST_AMT                           01570000
015710                  , RI.UNT_COST_AMT                               01571001
015800               FROM TPURITM PI                                    01580000
015900                  , TRECITM RI                                    01590000
016000              WHERE PI.PO_NBR = :RECDIS-ORD-NBR                   01600000
016100                AND PI.PO_NBR = RI.ORD_NBR                        01610000
016200                AND PI.VER_NBR = RI.PO_VER_NBR                    01620000
016300                AND PI.APP_PO_LNE_NBR = RI.ORD_LNE_NBR            01630000
016400                AND RI.VER_STATUS_CDE = 'A'                       01640000
016500              ORDER BY RI.REC_SEQ_NBR                             01650000
016600                     , PI.APP_PO_LNE_NBR                          01660000
016700     END-EXEC.                                                    01670000
016800*----------------------------------------------------------------*01680000
016900*  CONTROL CARD RECORD LAYOUT                                    *01690000
017000*----------------------------------------------------------------*01700000
017100 01  CONTROL-CARD-RECORD.                                         01710000
017200     05  CC-RUN-DTE.                                              01720000
017300         10  CC-RUN-DTE-CC       PIC  X(02).                      01730000
017400         10  CC-RUN-DTE-YY       PIC  X(02).                      01740000
017500         10  FILLER              PIC  X(01).                      01750000
017600         10  CC-RUN-DTE-MM       PIC  X(02).                      01760000
017700         10  FILLER              PIC  X(01).                      01770000
017800         10  CC-RUN-DTE-DD       PIC  X(02).                      01780000
017900     05  CC-PERIOD               PIC  X.                          01790000
018000         88 CC-RUN-ONE-DAY            VALUE 'D'.                  01800000
018100         88 CC-RUN-ONE-WEEK           VALUE ' ' , 'W'.            01810000
018200     05  FILLER                  PIC  X(70).                      01820000
018300                                                                  01830000
018400*----------------------------------------------------------------*01840000
018500*  JOURNALIZED RECEIPT BY PO EXTRACT FILE RECORD LAYOUT          *01850001
018600*----------------------------------------------------------------*01860000
018700     COPY APRD008.                                                01870000
018800                                                                  01880000
018900*----------------------------------------------------------------*01890000
019000* WORKING STORAGE FOR DATE ROUTINE                               *01900000
019100*----------------------------------------------------------------*01910000
019200     COPY DPWS500.                                                01920000
019300                                                                  01930000
019400                                                                  01940000
019500*----------------------------------------------------------------*01950000
019600*  ABEND DATA AREAS                                              *01960000
019700*----------------------------------------------------------------*01970000
019800 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01980000
019900                                             COMP SYNC.           01990000
020000     88  AC-INVALID-CONTROL-CARD             VALUE +4003.         02000000
020100     88  AC-OPEN-ERROR                       VALUE +4005.         02010000
020200     88  AC-CLOSE-ERROR                      VALUE +4006.         02020000
020300     88  AC-DB2-ERROR                        VALUE +4013.         02030000
020400     88  AC-UNSUCCESSFUL-SELECT              VALUE +4015.         02040000
020500     88  AC-DATE-ERROR                       VALUE +4019.         02050000
020600                                                                  02060000
020700 01  ABEND-AREAS.                                                 02070000
020800     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02080000
020900             '*****       ABEND'.                                 02090000
021000     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02100000
021100             '*****   PROGRAM: APKUT285'.                         02110000
021200     05  AA-PARAGRAPH-LIT.                                        02120000
021300         10  FILLER              PIC  X(17)  VALUE                02130000
021400             '***** PARAGRAPH: '.                                 02140000
021500         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02150000
021600     05  AA-MESSAGE-LINE-1.                                       02160000
021700         10  FILLER              PIC  X(06)  VALUE '*****'.       02170000
021800         10  AA-MESSAGE-1        PIC  X(127) VALUE SPACES.        02180000
021900     05  AA-MESSAGE-LINE-2.                                       02190000
022000         10  FILLER              PIC  X(06)  VALUE '*****'.       02200000
022100         10  AA-MESSAGE-2        PIC  X(127) VALUE SPACES.        02210000
022200     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02220000
022300             '*****    DB2 ERROR'.                                02230000
022400     05  AA-DB2-OPERATION-LIT.                                    02240000
022500         10  FILLER              PIC  X(17)  VALUE                02250000
022600             '***** OPERATION: '.                                 02260000
022700         10  AA-DB2-OPERATION.                                    02270000
022800             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02280000
022900             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02290000
023000     05  AA-DB2-TABLE-1          PIC  X(18)  VALUE SPACES.        02300000
023100     05  AA-DB2-TABLE-2          PIC  X(18)  VALUE SPACES.        02310000
023200     05  AA-DB2-TABLE-3          PIC  X(18)  VALUE SPACES.        02320000
023300     05  AA-DB2-TABLE-4          PIC  X(18)  VALUE SPACES.        02330000
023400                                                                  02340000
023500     COPY DPWS004.                                                02350000
023600 01  FILLER                      PIC  X(25)  VALUE                02360000
023700     '** END OF APKUT285 W/S **'.                                 02370000
023800                                                                  02380000
023900 PROCEDURE DIVISION.                                              02390000
024000 A100-MAIN.                                                       02400000
024100                                                                  02410000
024200     PERFORM B100-HOUSEKEEPING.                                   02420000
024300                                                                  02430000
024400     PERFORM B200-PROCESS-JRNL-RECEIPTS.                          02440000
024500                                                                  02450000
024600     PERFORM B300-END-PROGRAM.                                    02460000
024700                                                                  02470000
024800     GOBACK.                                                      02480000
024900                                                                  02490000
025000                                                                  02500000
025100 B100-HOUSEKEEPING.                                               02510000
025200*----------------------------------------------------------------*02520000
025300*    INITIALIZATION PROCESS                                      *02530000
025400*----------------------------------------------------------------*02540000
025500                                                                  02550000
025600     MOVE FUNCTION CURRENT-DATE        TO PV-CURRENT-DATE.        02560000
025700     MOVE PV-CURRENT-CCYY              TO PV-DISPLAY-CCYY.        02570000
025800     MOVE PV-CURRENT-MONTH             TO PV-DISPLAY-MONTH.       02580000
025900     MOVE PV-CURRENT-DAY               TO PV-DISPLAY-DAY.         02590000
026000                                                                  02600000
026100     DISPLAY '** APKUT285 BEGIN PROCESSING ON '                   02610000
026200             PV-DISPLAY-DATE ' **'.                               02620000
026300                                                                  02630000
026400     OPEN OUTPUT JOURNALIZED-BY-PO-FILE.                          02640000
026500                                                                  02650000
026600     INITIALIZE DCLTPURITM                                        02660000
026700                DCLTRECDIS                                        02670000
026800                DCLTRECITM                                        02680000
026900                DCLTPURCHS                                        02690000
027000                CONTROL-CARD-RECORD                               02700000
027100                AA-DB2-TABLE-1                                    02710000
027200                AA-DB2-TABLE-2                                    02720000
027300                AA-DB2-TABLE-3                                    02730000
027400                AA-DB2-TABLE-4                                    02740000
027500                PV-COUNTERS.                                      02750000
027600                                                                  02760000
027700     ACCEPT CONTROL-CARD-RECORD.                                  02770000
027800     IF CC-RUN-DTE > SPACES                                       02780000
027900         INSPECT CC-RUN-DTE REPLACING ALL '/' BY '-'              02790000
028000     ELSE                                                         02800000
028100         MOVE 'B100-INITIALIZE'        TO AA-PARAGRAPH-NAME       02810000
028200         MOVE 'INVALID RUN DATE'       TO AA-MESSAGE-1            02820000
028300         MOVE SPACES                   TO AA-MESSAGE-2            02830000
028400         SET AC-INVALID-CONTROL-CARD   TO TRUE                    02840000
028500         PERFORM Z999-ABEND                                       02850000
028600     END-IF.                                                      02860000
028610                                                                  02861000
028620     INITIALIZE DPG51                                             02862000
028630                DPG52                                             02863000
028640                DPG53                                             02864000
028650                DPG54                                             02865000
028651                DPG55                                             02865100
028652                DPG56.                                            02865200
028653                                                                  02865300
028654     SET DPG52-LK-DTE-ISO-FMT          TO TRUE.                   02865400
028655     MOVE CC-RUN-DTE                   TO DPG52-LK-DATE-INPUT.    02865500
028656     PERFORM Z900-CALL-CALENDAR-ROUTINE.                          02865600
028657                                                                  02865700
028658     IF DPG55-NUMERIC-WEEK-DAY-SAT                                02865800
028659         NEXT SENTENCE                                            02865900
028660     ELSE                                                         02866000
028661         MOVE 'B100-INITIALIZE'        TO AA-PARAGRAPH-NAME       02866100
028662         MOVE 'RUN DATE IS NOT A SATURDAY'                        02866200
028663                                       TO AA-MESSAGE-1            02866300
028664         MOVE CC-RUN-DTE               TO AA-MESSAGE-2            02866400
028665         SET AC-DATE-ERROR             TO TRUE                    02866500
028666         PERFORM Z999-ABEND                                       02866600
028667     END-IF.                                                      02866700
028668                                                                  02866800
028669     MOVE DPG55-1ST-WKDY-DB2ISO-FMT    TO PV-START-DTE.           02866900
028670     MOVE CC-RUN-DTE                   TO PV-END-DTE              02867000
028671                                          PC-VRFD-RCPTS-DTE.      02867100
028672     MOVE CC-RUN-DTE-CC                TO PV-RUN-DTE-CC.          02867200
028673     MOVE CC-RUN-DTE-YY                TO PV-RUN-DTE-YY.          02867300
028674     MOVE CC-RUN-DTE-MM                TO PV-RUN-DTE-MM.          02867400
028675     MOVE CC-RUN-DTE-DD                TO PV-RUN-DTE-DD.          02867500
028676                                                                  02867600
028677*    DISPLAY CONTROL CARD INFO                                    02867700
028678     DISPLAY '** START DATE = ' PV-START-DTE.                     02867800
028679     DISPLAY '**   END DATE = ' PV-END-DTE.                       02867900
028680                                                                  02868000
028681     PERFORM Y100-OPEN-RECDIS-CSR.                                02868100
028682     PERFORM S100-FETCH-RECDIS-CSR.                               02868200
028683     SET SAME-ORD-NBR TO TRUE.                                    02868300
028684     PERFORM S300-SELECT-PO-TYPE-CDE.                             02868400
028685     PERFORM Y200-OPEN-POLINE-CSR.                                02868500
028686     PERFORM S200-FETCH-POLINE-CSR.                               02868600
028687                                                                  02868700
028688                                                                  02868800
028689 B200-PROCESS-JRNL-RECEIPTS.                                      02868900
028690*----------------------------------------------------------------*02869000
028700*    BUILD JOURNALIZED ENTRIES TO BE INTERFACED TO               *02870000
028800*    GENERAL LEDGER.                                             *02880000
028900*----------------------------------------------------------------*02890000
029000                                                                  02900000
029100     PERFORM C100-CALCULATE-MONETARY-AMT                          02910000
029200       UNTIL END-OF-RECDIS-CSR.                                   02920000
029300                                                                  02930000
031100                                                                  03110000
031200 B300-END-PROGRAM.                                                03120000
031300*----------------------------------------------------------------*03130000
031400*    ENDING PROCESSING: DISPLAYS COUNTS, AND CLOSES FILES.       *03140000
031500*----------------------------------------------------------------*03150000
031600                                                                  03160000
031700*    MOVE PV-RCPTS-COST TO PV-OUT-COST.                           03170000
031800*    DISPLAY 'PV-RCPTS-COST = ' PV-OUT-COST.                      03180000
031900     MOVE PV-TOTAL-AMT               TO PV-OUT-AMT.               03190000
032000                                                                  03200000
032100     DISPLAY '*************************************************'. 03210000
032200     DISPLAY '************* APKUT285 SUMMARY ******************'. 03220000
032300     DISPLAY ' '.                                                 03230000
032400     DISPLAY '** GL INTERFACE RECS WRITTEN = ' PV-COUNT-APRD008.  03240000
032500     DISPLAY '** RECEIPTS COST AMOUNT = ' PV-OUT-AMT.             03250000
032510     MOVE PV-TOTAL-RECITM-AMT        TO PV-OUT-AMT.               03251001
032520     DISPLAY '** RECITM COST AMOUNT = ' PV-OUT-AMT.               03252001
032600     DISPLAY ' '.                                                 03260000
032700     DISPLAY '** APKUT285 ENDING **'.                             03270000
032800     DISPLAY '*************************************************'. 03280000
032900                                                                  03290000
033000     PERFORM Y300-CLOSE-RECDIS-CSR.                               03300000
033100     CLOSE JOURNALIZED-BY-PO-FILE.                                03310000
033200                                                                  03320000
033300*----------------------------------------------------------------*03330000
033400*    FETCH RECDIS_CSR CURSOR                                     *03340000
033500*----------------------------------------------------------------*03350000
033600 C100-CALCULATE-MONETARY-AMT.                                     03360000
033700     IF END-OF-POLINE-CSR                                         03370000
033800         PERFORM Y400-CLOSE-POLINE-CSR                            03380000
033900         PERFORM Y200-OPEN-POLINE-CSR                             03390000
034000         PERFORM S200-FETCH-POLINE-CSR                            03400000
034100     ELSE                                                         03410000
034200         IF SAME-ORD-NBR                                          03420000
034300             IF RECDIS-REC-SEQ-NBR = RECITM-REC-SEQ-NBR           03430000
034400                 IF RECDIS-ORD-LNE-NBR = PURITM-APP-PO-LNE-NBR    03440000
034500                    IF PURCHS-PO-TYP-CDE = 'IM' OR 'IE' OR 'IF'   03450000
034600                        COMPUTE PV-RCPTS-COST = (PV-SUMMED-ITM-QTY03460000
034700                           * PURITM-UNT-COST-AMT)     + .005      03470000
035000                    ELSE                                          03500000
035100                        COMPUTE PV-RCPTS-COST = (PV-SUMMED-ITM-QTY03510000
035200                           * PURITM-PRD-1ST-COST-AMT) + .005      03520000
035500                    END-IF                                        03550000
035510                    COMPUTE PV-RECITM-COST = (PV-SUMMED-ITM-QTY   03551001
035520                           * RECITM-UNT-COST-AMT)     + .005      03552001
035530                    IF PURITM-UNT-COST-AMT = RECITM-UNT-COST-AMT  03553001
035540                       CONTINUE                                   03554001
035550                    ELSE                                          03555001
035560                       SET PV-COST-CHANGES TO TRUE                03556001
035570                    END-IF                                        03557001
035580                    ADD PV-RCPTS-COST TO PV-RCPTS-AMT             03558001
035590                    ADD PV-RECITM-COST TO PV-RECITM-AMT           03559001
035700                    PERFORM S100-FETCH-RECDIS-CSR                 03570000
035800                    PERFORM S200-FETCH-POLINE-CSR                 03580000
035900                 ELSE                                             03590000
036000                     IF RECDIS-ORD-LNE-NBR > PURITM-APP-PO-LNE-NBR03600000
036100                         PERFORM S200-FETCH-POLINE-CSR            03610000
036200                     ELSE                                         03620000
036300                         PERFORM S100-FETCH-RECDIS-CSR            03630000
036400                     END-IF                                       03640000
036500                 END-IF                                           03650000
036600             ELSE                                                 03660000
036700                 IF RECDIS-REC-SEQ-NBR > RECITM-REC-SEQ-NBR       03670000
036800                     PERFORM S200-FETCH-POLINE-CSR                03680000
036900                 ELSE                                             03690000
037000                     PERFORM S100-FETCH-RECDIS-CSR                03700000
037100                 END-IF                                           03710000
037200             END-IF                                               03720000
037300         ELSE                                                     03730000
037400             SET SAME-ORD-NBR TO TRUE                             03740000
037500             PERFORM S300-SELECT-PO-TYPE-CDE                      03750000
037600             PERFORM Y400-CLOSE-POLINE-CSR                        03760000
037700             PERFORM Y200-OPEN-POLINE-CSR                         03770000
037800             PERFORM S200-FETCH-POLINE-CSR                        03780000
037900         END-IF                                                   03790000
038000     END-IF.                                                      03800000
038100                                                                  03810000
038200*----------------------------------------------------------------*03820000
038300*    CREATE JOURNALIZED BY PO RECORD.                             03830000
038400*----------------------------------------------------------------*03840000
038500 C200-CREATE-PO-RECORD.                                           03850000
038600                                                                  03860000
038700     INITIALIZE AP008-VERIFIED-RECEIPT-FILE.                      03870000
038800                                                                  03880000
038900     MOVE 'VE'               TO AP008-AMT-TYP-CDE.                03890001
039000     MOVE PURCHS-PO-TYP-CDE  TO AP008-PO-TYP-CDE.                 03900001
039100     MOVE ZERO               TO AP008-LOC-NBR.                    03910001
039200     MOVE HOLD-ORD-NBR       TO AP008-PO-NBR.                     03920001
039300     MOVE PV-RCPTS-AMT       TO AP008-COST-AMT.                   03930001
039310     MOVE PV-COST-CHANGES-SW TO AP008-COST-CHANGES.               03931001
039320                                                                  03932001
039330     IF PV-COST-CHANGES-SW = 'Y'                                  03933001
039340        MOVE PV-RECITM-AMT  TO AP008-RI-COST-AMT                  03934001
039350     ELSE                                                         03935001
039360        MOVE ZERO TO AP008-RI-COST-AMT                            03936001
039370     END-IF.                                                      03937001
039400                                                                  03940000
039500     PERFORM W100-WRITE-JRNL-BY-PO.                               03950000
039600     ADD 1 TO PV-COUNT-APRD008.                                   03960000
039700                                                                  03970000
039800     ADD PV-RCPTS-AMT  TO PV-TOTAL-AMT.                           03980000
039810     ADD PV-RECITM-AMT  TO PV-TOTAL-RECITM-AMT.                   03981001
039820     MOVE ZERO TO PV-RCPTS-AMT.                                   03982001
039830     MOVE ZERO TO PV-RECITM-AMT.                                  03983001
039840     SET PV-NO-COST-CHANGES TO TRUE.                              03984001
039910                                                                  03991000
040000*----------------------------------------------------------------*04000000
040100*    FETCH RECDIS_CSR CURSOR                                     *04010000
040200*    NOTE: COLUMN FUNCTION 'SUM' WILL NOT RETURN SQL CODE +100   *04020000
040300*          WHEN A ROW IS NOT FOUND. INSTEAD, IT RETURNS A -305   *04030000
040400*          AS A RESULT OF ATTEMPTING TO SUM NULL VALUES.         *04040000
040500*----------------------------------------------------------------*04050000
040600 S100-FETCH-RECDIS-CSR.                                           04060000
040610                                                                  04061000
040700     EXEC SQL                                                     04070000
040800         FETCH RECDIS_CSR                                         04080000
040900          INTO :RECDIS-ORD-NBR                                    04090000
041000             , :RECDIS-REC-SEQ-NBR                                04100000
041100***          , :RECDIS-STR-NBR                                    04110000
041200             , :RECDIS-ORD-LNE-NBR                                04120000
041300             , :PV-SUMMED-ITM-QTY                                 04130000
041400     END-EXEC.                                                    04140000
041410                                                                  04141000
041500     EVALUATE TRUE                                                04150000
041600         WHEN SQLCODE = ZERO                                      04160000
041700              SET NOT-END-OF-RECDIS-CSR TO TRUE                   04170000
041800              IF RECDIS-ORD-NBR = HOLD-ORD-NBR                    04180000
041900                 SET SAME-ORD-NBR TO TRUE                         04190000
042000              ELSE                                                04200000
042100                 PERFORM C200-CREATE-PO-RECORD                    04210000
042200                 SET NEW-ORD-NBR TO TRUE                          04220000
042300                 MOVE RECDIS-ORD-NBR TO HOLD-ORD-NBR              04230000
042400              END-IF                                              04240000
042500         WHEN SQLCODE = +100                                      04250000
042600              PERFORM C200-CREATE-PO-RECORD                       04260000
042700              SET END-OF-RECDIS-CSR TO TRUE                       04270000
042800         WHEN SQLCODE = -305                                      04280000
042900              MOVE ZEROES TO PV-SUMMED-ITM-QTY                    04290000
043000         WHEN OTHER                                               04300000
043100             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                04310000
043200             MOVE 'S100-FETCH-RECDIS-CSR'  TO AA-PARAGRAPH-NAME   04320000
043300             MOVE 'UNSUCCESSFUL FETCH '    TO AA-DB2-OPERATION    04330000
043400             MOVE 'RECDIS-CSR'             TO AA-DB2-TABLE-1      04340000
043500             MOVE SPACES                   TO AA-DB2-TABLE-2      04350000
043600             MOVE SPACES                   TO AA-DB2-TABLE-3      04360000
043700             PERFORM Z998-DB2-ABEND                               04370000
043800     END-EVALUATE.                                                04380000
043810                                                                  04381000
043900*----------------------------------------------------------------*04390000
044000*    FETCH POLINE_CSR CURSOR                                     *04400000
044100*----------------------------------------------------------------*04410000
044200 S200-FETCH-POLINE-CSR.                                           04420000
044210                                                                  04421000
044300     EXEC SQL                                                     04430000
044400         FETCH POLINE_CSR                                         04440000
044500          INTO :PURITM-APP-PO-LNE-NBR                             04450000
044600             , :PURITM-UNT-COST-AMT                               04460000
044700             , :RECITM-REC-SEQ-NBR                                04470000
044800             , :PURITM-PRD-1ST-COST-AMT                           04480000
044810             , :RECITM-UNT-COST-AMT                               04481001
044900     END-EXEC.                                                    04490000
045000     EVALUATE TRUE                                                04500000
045100         WHEN SQLCODE = ZERO                                      04510000
045200              SET NOT-END-OF-POLINE-CSR TO TRUE                   04520000
045300         WHEN SQLCODE = +100                                      04530000
045400              SET END-OF-POLINE-CSR TO TRUE                       04540000
045500         WHEN OTHER                                               04550000
045600             SET AC-UNSUCCESSFUL-SELECT    TO TRUE                04560000
045700             MOVE 'S200-FETCH-POLINE-CSR'  TO AA-PARAGRAPH-NAME   04570000
045800             MOVE 'UNSUCCESSFUL FETCH '    TO AA-DB2-OPERATION    04580000
045900             MOVE 'POLINE-CSR'             TO AA-DB2-TABLE-1      04590000
046000             MOVE SPACES                   TO AA-DB2-TABLE-2      04600000
046100             MOVE SPACES                   TO AA-DB2-TABLE-3      04610000
046200             PERFORM Z998-DB2-ABEND                               04620000
046300     END-EVALUATE.                                                04630000
046400                                                                  04640000
046500*----------------------------------------------------------------*04650000
046600*    SELECT PURCHASE ORDER TYPE (IMPORT OR DOMESTIC)             *04660000
046700*----------------------------------------------------------------*04670000
046800 S300-SELECT-PO-TYPE-CDE.                                         04680000
046900                                                                  04690000
047000     EXEC SQL                                                     04700000
047100         SELECT PO_TYP_CDE                                        04710000
047200          INTO :PURCHS-PO-TYP-CDE                                 04720000
047300           FROM TPURCHS                                           04730000
047400          WHERE PO_NBR         = :RECDIS-ORD-NBR                  04740000
047500            AND VER_STATUS_CDE = 'A'                              04750000
047600     END-EXEC.                                                    04760000
047700                                                                  04770000
047800     EVALUATE TRUE                                                04780000
047900         WHEN SQLCODE = ZERO                                      04790000
048000             CONTINUE                                             04800000
048100         WHEN OTHER                                               04810000
048200             SET AC-UNSUCCESSFUL-SELECT     TO TRUE               04820000
048300             MOVE 'S300-SELECT-PO-TYPE-CDE' TO AA-PARAGRAPH-NAME  04830000
048400             MOVE 'UNSUCCESSFUL SELECT'     TO AA-DB2-OPERATION   04840000
048500             MOVE 'TPURCHS'                 TO AA-DB2-TABLE-1     04850000
048600             PERFORM Z998-DB2-ABEND                               04860000
048700     END-EVALUATE.                                                04870000
048800                                                                  04880000
048900                                                                  04890000
049000                                                                  04900000
049200*----------------------------------------------------------------*04920000
049300*    WRITE THE JOURNALIZED BY PO RECORD                          *04930000
049400*----------------------------------------------------------------*04940000
049410 W100-WRITE-JRNL-BY-PO.                                           04941000
049500                                                                  04950000
049600     WRITE JOURNALIZED-BY-PO-REC FROM AP008-VERIFIED-RECEIPT-FILE.04960000
049700                                                                  04970000
049800                                                                  04980000
049900*----------------------------------------------------------------*04990000
050000*    OPEN RECDIS_CSR CURSOR                                      *05000000
050100*----------------------------------------------------------------*05010000
050200 Y100-OPEN-RECDIS-CSR.                                            05020000
050210                                                                  05021000
050300     EXEC SQL                                                     05030000
050400         OPEN RECDIS_CSR                                          05040000
050500     END-EXEC.                                                    05050000
050510                                                                  05051000
050600     EVALUATE TRUE                                                05060000
050700         WHEN SQLCODE = ZERO                                      05070000
050800             CONTINUE                                             05080000
050900         WHEN OTHER                                               05090000
051000             SET AC-OPEN-ERROR TO TRUE                            05100000
051100             MOVE 'Y100-OPEN-RECDIS-CSR'   TO AA-PARAGRAPH-NAME   05110000
051200             MOVE 'UNSUCCESSFUL OPEN'      TO AA-DB2-OPERATION    05120000
051300             MOVE 'TRECDIS'                TO AA-DB2-TABLE-1      05130000
051400             MOVE SPACES                   TO AA-DB2-TABLE-2      05140000
051500             MOVE SPACES                   TO AA-DB2-TABLE-3      05150000
051600             PERFORM Z998-DB2-ABEND                               05160000
051700     END-EVALUATE.                                                05170000
051710                                                                  05171000
051800*----------------------------------------------------------------*05180000
051900*    OPEN POLINE_CSR CURSOR                                      *05190000
052000*----------------------------------------------------------------*05200000
052100 Y200-OPEN-POLINE-CSR.                                            05210000
052110                                                                  05211000
052200     EXEC SQL                                                     05220000
052300         OPEN POLINE_CSR                                          05230000
052400     END-EXEC.                                                    05240000
052410                                                                  05241000
052500     EVALUATE TRUE                                                05250000
052600         WHEN SQLCODE = ZERO                                      05260000
052700             CONTINUE                                             05270000
052800         WHEN OTHER                                               05280000
052900             SET AC-OPEN-ERROR TO TRUE                            05290000
053000             MOVE 'Y200-OPEN-POLINE-CSR'   TO AA-PARAGRAPH-NAME   05300000
053100             MOVE 'UNSUCCESSFUL OPEN'      TO AA-DB2-OPERATION    05310000
053200             MOVE 'TPURITM'                TO AA-DB2-TABLE-1      05320000
053300             MOVE 'TRECITM'                TO AA-DB2-TABLE-2      05330000
053400             MOVE SPACES                   TO AA-DB2-TABLE-3      05340000
053500             PERFORM Z998-DB2-ABEND                               05350000
053600     END-EVALUATE.                                                05360000
053610                                                                  05361000
053700*----------------------------------------------------------------*05370000
053800*    CLOSE RECDIS_CSR CURSOR                                     *05380000
053900*----------------------------------------------------------------*05390000
054000 Y300-CLOSE-RECDIS-CSR.                                           05400000
054010                                                                  05401000
054100     EXEC SQL                                                     05410000
054200         CLOSE RECDIS_CSR                                         05420000
054300     END-EXEC.                                                    05430000
054310                                                                  05431000
054400     EVALUATE TRUE                                                05440000
054500         WHEN SQLCODE = ZERO                                      05450000
054600             CONTINUE                                             05460000
054700         WHEN OTHER                                               05470000
054800             SET AC-CLOSE-ERROR TO TRUE                           05480000
054900             MOVE 'Y300-CLOSE-RECDIS-CSR'  TO AA-PARAGRAPH-NAME   05490000
055000             MOVE 'UNSUCCESSFUL CLOSE'     TO AA-DB2-OPERATION    05500000
055100             MOVE 'TRECDIS'                TO AA-DB2-TABLE-1      05510000
055200             MOVE SPACES                   TO AA-DB2-TABLE-2      05520000
055300             MOVE SPACES                   TO AA-DB2-TABLE-3      05530000
055400             PERFORM Z998-DB2-ABEND                               05540000
055500     END-EVALUATE.                                                05550000
055510                                                                  05551000
055600*----------------------------------------------------------------*05560000
055700*    CLOSE POLINE_CSR CURSOR                                     *05570000
055800*----------------------------------------------------------------*05580000
055900 Y400-CLOSE-POLINE-CSR.                                           05590000
055910                                                                  05591000
056000     EXEC SQL                                                     05600000
056100         CLOSE POLINE_CSR                                         05610000
056200     END-EXEC.                                                    05620000
056210                                                                  05621000
056300     EVALUATE TRUE                                                05630000
056400         WHEN SQLCODE = ZERO                                      05640000
056500             CONTINUE                                             05650000
056600         WHEN OTHER                                               05660000
056700             SET AC-CLOSE-ERROR TO TRUE                           05670000
056800             MOVE 'Y400-CLOSE-POLINE-CSR'  TO AA-PARAGRAPH-NAME   05680000
056900             MOVE 'UNSUCCESSFUL CLOSE'     TO AA-DB2-OPERATION    05690000
057000             MOVE 'TPURITM'                TO AA-DB2-TABLE-1      05700000
057100             MOVE 'TRECITM'                TO AA-DB2-TABLE-2      05710000
057200             MOVE SPACES                   TO AA-DB2-TABLE-3      05720000
057300             PERFORM Z998-DB2-ABEND                               05730000
057400     END-EVALUATE.                                                05740000
057500                                                                  05750000
057600*----------------------------------------------------------------*05760000
057700*    CALENDAR ROUTINE                                            *05770000
057800*----------------------------------------------------------------*05780000
057900 Z900-CALL-CALENDAR-ROUTINE.                                      05790000
058000                                                                  05800000
058100     SET DPG51-FISCAL-454-CALENDAR     TO TRUE.                   05810000
058200                                                                  05820000
058300     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05830000
058400                                             DPG54 DPG55 DPG56.   05840000
058500                                                                  05850000
058600     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  05860000
058700         MOVE 'Z900-CALL-CALENDAR-ROUTINE'                        05870000
058800                                       TO AA-PARAGRAPH-NAME       05880000
058900         MOVE DPG54-ERROR-MESSAGE      TO AA-MESSAGE-1            05890000
059000         MOVE DPG52-DB2-ISO-DATE-FMT   TO AA-MESSAGE-2            05900000
059100         SET AC-DATE-ERROR             TO TRUE                    05910000
059200         PERFORM Z999-ABEND                                       05920000
059300     END-IF.                                                      05930000
059400                                                                  05940000
059500                                                                  05950000
059700*----------------------------------------------------------------*05970000
059800*    ABEND ROUTINE FOR DB2 ERRORS                                *05980000
059900*----------------------------------------------------------------*05990000
059910 Z998-DB2-ABEND.                                                  05991000
060000                                                                  06000000
060100     DISPLAY AA-ABEND-LIT.                                        06010000
060200     DISPLAY AA-DB2-ERROR-LIT.                                    06020000
060300     DISPLAY AA-PROGRAM-LIT.                                      06030000
060400     DISPLAY AA-PARAGRAPH-LIT.                                    06040000
060500     DISPLAY AA-DB2-OPERATION-LIT.                                06050000
060600     DISPLAY AA-DB2-TABLE-1.                                      06060000
060700     DISPLAY AA-DB2-TABLE-2.                                      06070000
060800     DISPLAY AA-DB2-TABLE-3.                                      06080000
060900     DISPLAY AA-DB2-TABLE-4.                                      06090000
061000     SET AC-DB2-ERROR TO TRUE.                                    06100000
061100                                                                  06110000
061200     COPY DPPD004.                                                06120000
061300                                                                  06130000
061400     CALL 'ILBOABN0' USING ABEND-CODE.                            06140000
061500                                                                  06150000
061700*----------------------------------------------------------------*06170000
061800*    ABEND ROUTINE                                               *06180000
061900*----------------------------------------------------------------*06190000
061910 Z999-ABEND.                                                      06191000
062000                                                                  06200000
062100     DISPLAY AA-ABEND-LIT.                                        06210000
062200     DISPLAY AA-PROGRAM-LIT.                                      06220000
062300     DISPLAY AA-PARAGRAPH-LIT.                                    06230000
062400     DISPLAY AA-MESSAGE-LINE-1.                                   06240000
062500     DISPLAY AA-MESSAGE-LINE-2.                                   06250000
062600                                                                  06260000
062700     CALL 'ILBOABN0' USING ABEND-CODE.                            06270000
062800                                                                  06280000
