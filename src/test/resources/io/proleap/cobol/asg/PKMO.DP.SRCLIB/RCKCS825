000100******************************************************************00010010
000200 IDENTIFICATION DIVISION.                                         00020011
000300******************************************************************00030011
000400 PROGRAM-ID.    RCKCS825.                                         00040011
000500 AUTHOR.        CRAIG KEHOE.                                      00050011
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060011
000700 DATE-WRITTEN.  02-2003                                           00070011
000800 DATE-COMPILED. 05/30/2003                                        00080011
000810*                                                                 00081011
000820*********************************************************         00082011
000830* *   IF ANY CHANGES ARE MADE TO THIS PROGRAM         * *         00083011
000840* *   BE SURE TO CHECK THE BATCH PROGRAM (RCKUT825)   * *         00084011
000850* *   TO SEE IF THE SAME CHANGE SHOULD BE MADE        * *         00085011
000860*********************************************************         00086011
000870*                                                                 00087011
000880******************************************************************00088011
000890*  CICS PROGRAM                                                  *00089011
000900*                                                                *00090011
001000*      THIS PROGRAM IS THE PRORATION RANDOM ROUTINE.             *00100011
001100*      ITS BASIC FUNCTION IS TO COME UP WITH RANDOM STORES.      *00110011
001200******************************************************************00120011
001300******************************************************************00130011
001400 ENVIRONMENT DIVISION.                                            00140011
001500******************************************************************00150011
001600                                                                  00160011
001700******************************************************************00170011
001800 DATA DIVISION.                                                   00180011
001900******************************************************************00190011
002000 WORKING-STORAGE SECTION.                                         00200011
002100******************************************************************00210011
002200 01  PC-WG-PROGRAM-CONSTANTS.                                     00220011
002300     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'RCKCS825'.  00230011
002400     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00240011
002500                                              COMP.               00250011
002600 01  PV-WG-PROGRAM-VARIABLES.                                     00260011
002700     05  PV-UNIQUE-RANDOM     PIC  X(01)  VALUE 'N'.              00270011
002800     05  PV-RANDOM-MATCH      PIC  X(01)  VALUE 'N'.              00280011
002900     05  PV-DISPLAY-CNT       PIC  9(03)  VALUE 0.                00290011
003000     05  PV-RANDOM-VALUE      PIC  9(03)  VALUE 0.                00300011
003100     05  PV-RAND-ORDER        PIC  9(03)  VALUE 0.                00310011
003200     05  PV-STORES-CNT        PIC  9(03)  VALUE 0.                00320011
003300     05  PV-SWAP-NUM          PIC 9.                              00330011
003400     05  PV-RANDOM-SEL-MIN    PIC 9999.                           00340011
003500     05  PV-RANDOM-SEL-MAX    PIC 9999.                           00350011
003600     05  PV-RANDOM-SEL-CNT    PIC 9999.                           00360011
003700     05  PV-RANDOM-STORE-MIN  PIC 9999.                           00370011
003800     05  PV-RANDOM-STORE-MAX  PIC 9999.                           00380011
003900     05  PV-RANDOM-SEED       PIC 9(8).                           00390011
004000                                                                  00400011
004100 01  PV-RANDOM-SEED-X     PIC  X(08).                             00410011
004200 01  PT-RANDOM-SEED REDEFINES PV-RANDOM-SEED-X.                   00420011
004300     05  PT-SEED-DIGITS OCCURS 8 TIMES                            00430011
004400                            INDEXED BY PT-SEED-IDX.               00440011
004500         10 PT-SEED            PIC 9.                             00450011
004600                                                                  00460011
005100******************************************************************00510011
005200*  LAYOUT FOR THE ABEND MODULE COMMUNICATION AREA.               *00520011
005300******************************************************************00530011
005400     COPY DPWS013.                                                00540011
005500******************************************************************00550011
005600*    STANDARD COMMAREA.                                          *00560011
005700******************************************************************00570011
005800     COPY DPWS020.                                                00580011
005900*    THE FOLLOWING LINE ALWAYS GETS A WARNING THAT IT REDEFINES   00590011
006000*    A LARGER ITEM.                                               00600011
006100     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00610011
006200******************************************************************00620011
006300*    INTER-APPLICATION COMMAREA.                                 *00630011
006400******************************************************************00640011
006500         10  INTER-APPL-COMM-AREA PIC X(200).                     00650011
006600******************************************************************00660011
006700*  LAYOUT FOR THE RANDOM ROUTINE.                                *00670011
006800******************************************************************00680011
006900     COPY RCWS825.                                                00690011
007000                                                                  00700011
007100******************************************************************00710011
007200 LINKAGE SECTION.                                                 00720011
007300******************************************************************00730011
007400 01  DFHCOMMAREA.                                                 00740011
007500     05  FILLER              OCCURS 1 TO 1811 TIMES               00750011
007600                             DEPENDING ON EIBCALEN.               00760011
007700       10  FILLER                         PIC X.                  00770011
007800******************************************************************00780011
007900 PROCEDURE DIVISION USING DFHCOMMAREA.                            00790011
008000******************************************************************00800011
008100     PERFORM 0001-HOUSEKEEPING.                                   00810011
008200     PERFORM 1000-CONTROL-PROCESSING.                             00820011
008300     MOVE RC825-COMMAREA TO DFHCOMMAREA.                          00830011
008400     GOBACK.                                                      00840011
008500                                                                  00850011
008600 0001-HOUSEKEEPING.                                               00860011
008700                                                                  00870011
008800     INITIALIZE RC825-COMMAREA.                                   00880011
008900                                                                  00890011
009000     MOVE DFHCOMMAREA TO RC825-COMMAREA.                          00900011
009100                                                                  00910011
009200******************************************************************00920011
009300*  CONTROL PROCESSING                                            *00930011
009400******************************************************************00940011
009500 1000-CONTROL-PROCESSING.                                         00950011
009600     PERFORM 2000-INITIALIZE.                                     00960011
009700                                                                  00970011
009800     PERFORM 2100-VALIDATE-INPUT.                                 00980011
009900                                                                  00990011
010000*      GET RANDOM STORE NUMBERS                                   01000011
010100     PERFORM 2200-PROCESS-RANDOM-FUNCTION.                        01010011
010200                                                                  01020011
010300******************************************************************01030011
010400* INITIALIZE THE STORE-COUNT-NUMBERS AND                         *01040011
010500* PRIME THE RANDOM FUNCTION (ONLY ONCE).                         *01050011
010600******************************************************************01060011
010700 2000-INITIALIZE.                                                 01070011
010800                                                                  01080011
010900     MOVE FUNCTION CURRENT-DATE(9:8) TO PV-RANDOM-SEED-X.         01090011
011000                                                                  01100011
011100     MOVE PT-SEED(1)  TO PV-SWAP-NUM.                             01110011
011200     MOVE PT-SEED(8)  TO PT-SEED(1).                              01120011
011300     MOVE PV-SWAP-NUM TO PT-SEED(8).                              01130011
011400     MOVE PT-SEED(2)  TO PV-SWAP-NUM.                             01140011
011500     MOVE PT-SEED(7)  TO PT-SEED(2).                              01150011
011600     MOVE PV-SWAP-NUM TO PT-SEED(7).                              01160011
011700     MOVE PT-SEED(3)  TO PV-SWAP-NUM.                             01170011
011800     MOVE PT-SEED(6)  TO PT-SEED(3).                              01180011
011900     MOVE PV-SWAP-NUM TO PT-SEED(6).                              01190011
012000     MOVE PT-SEED(4)  TO PV-SWAP-NUM.                             01200011
012100     MOVE PT-SEED(5)  TO PT-SEED(4).                              01210011
012200     MOVE PV-SWAP-NUM TO PT-SEED(5).                              01220011
012300                                                                  01230011
012400     MOVE PT-RANDOM-SEED TO PV-RANDOM-SEED.                       01240011
012500                                                                  01250011
012600     COMPUTE PV-RANDOM-VALUE =                                    01260011
012700             FUNCTION RANDOM(PV-RANDOM-SEED).                     01270011
012800                                                                  01280011
012900******************************************************************01290011
013000* VALIDATE THE STORE COUNT, THE STORE MINIMUM AND THE STORE      *01300011
013100* MAXIMUM.                                                       *01310011
013200******************************************************************01320011
013300 2100-VALIDATE-INPUT.                                             01330011
013400     SET RC825-NO-ERRORS TO TRUE.                                 01340011
013500                                                                  01350011
013600     MOVE RC825-RANDOM-SEL-MIN     TO PV-RANDOM-SEL-MIN.          01360011
013700     MOVE RC825-RANDOM-SEL-MAX     TO PV-RANDOM-SEL-MAX.          01370011
013800     MOVE RC825-RANDOM-STR-SEL-CNT TO PV-RANDOM-SEL-CNT.          01380011
013900                                                                  01390011
014000     IF RC825-RANDOM-SEL-MIN < RC825-RANDOM-STORE-MIN             01400011
014100     OR RC825-RANDOM-SEL-MIN > RC825-RANDOM-SEL-MAX               01410011
014200     THEN                                                         01420011
014300       SET RC825-INV-MINIMUM TO TRUE                              01430011
014400     END-IF.                                                      01440011
014500                                                                  01450011
014600     IF RC825-RANDOM-SEL-MAX > RC825-RANDOM-STORE-MAX             01460011
014700     OR RC825-RANDOM-SEL-MAX < RC825-RANDOM-SEL-MIN               01470011
014800     THEN                                                         01480011
014900       SET RC825-INV-MAXIMUM TO TRUE                              01490011
015000     END-IF.                                                      01500011
015100                                                                  01510011
015200     IF RC825-RANDOM-STR-SEL-CNT < RC825-RANDOM-STORE-MIN         01520011
015300     OR RC825-RANDOM-STR-SEL-CNT > RC825-RANDOM-STORE-MAX         01530011
015400     THEN                                                         01540011
015500       SET RC825-INV-COUNT TO TRUE                                01550011
015600     END-IF.                                                      01560011
015700                                                                  01570011
015800******************************************************************01580011
015900* LOOP THROUGH RANDOM NUMBERS.  FOR EACH NUMBER CHOSEN           *01590011
016000*   SET RANDOM INDICATOR TO "Y" FOR MATCHING STORE-INDEX-NUMBER  *01600011
016100******************************************************************01610011
016200                                                                  01620011
016300 2200-PROCESS-RANDOM-FUNCTION.                                    01630011
016400     PERFORM PV-RANDOM-SEL-CNT TIMES                              01640011
016500       PERFORM 2210-GET-RANDOM-VALUE                              01650011
016600     END-PERFORM.                                                 01660011
016700                                                                  01670011
016800******************************************************************01680011
016900* GENERATE UNIQUE RANDOM VALUES.                                 *01690011
017000******************************************************************01700011
017100 2210-GET-RANDOM-VALUE.                                           01710011
017200                                                                  01720011
017300     PERFORM  UNTIL PV-UNIQUE-RANDOM = 'Y'                        01730011
017400* ASSUME THAT THIS WILL BE A RANDOM STORE INDEX                   01740011
017500       MOVE 'Y'  TO PV-UNIQUE-RANDOM                              01750011
017600* GET A RANDOM NUMBER WITHIN THE MINIMUM AND THE MAXIMUM          01760011
017700       COMPUTE PV-RANDOM-VALUE = FUNCTION RANDOM                  01770011
017800                              * (PV-RANDOM-SEL-MAX -              01780011
017900                                 PV-RANDOM-SEL-MIN)               01790011
018000                              + PV-RANDOM-SEL-MIN                 01800011
018100* IS THE RANDOM NUMBER UNIQUE?                                    01810011
018200       IF RC825-STORE-RANDOM-IND(PV-RANDOM-VALUE) = 'Y'           01820011
018300       THEN                                                       01830011
018400         MOVE 'N'  TO PV-UNIQUE-RANDOM                            01840011
018500       END-IF                                                     01850011
018600     END-PERFORM.                                                 01860011
018700                                                                  01870011
018800     MOVE 'Y'  TO RC825-STORE-RANDOM-IND (PV-RANDOM-VALUE).       01880011
018900                                                                  01890011
019000* FOUND 1 MORE UNIQUE RANDOM STORE                                01900011
019100     ADD 1 TO PV-RAND-ORDER.                                      01910011
019200                                                                  01920011
019300* MOVE THE CURRENT RANDOM STORE INDEX TO THE STORE TABLE          01930011
019400     MOVE RC825-STORE-NUMBER (PV-RANDOM-VALUE) TO                 01940011
019500          RC825-RANDOM-STORE-NBR (PV-RAND-ORDER).                 01950011
019600                                                                  01960011
019700* MOVE THE RANDOM STORE NUMBER TO THE RANDOM STORE TABLE          01970011
019800     MOVE 'N'  TO PV-UNIQUE-RANDOM.                               01980011
019900                                                                  01990011
