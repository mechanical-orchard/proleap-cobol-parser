000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    APKRP289.                                         00020001
000300 AUTHOR.        KRYSTEN LEARY.                                    00030001
000400 DATE-WRITTEN.  JUNE 2006.                                        00040001
000500                                                                  00050001
000600***************************************************************** 00060001
000700*          MISSED PROFIT ASSISTANCE ALLOWANCES REPORT           * 00070001
000800*---------------------------------------------------------------* 00080001
000900* COBOL II                                                      * 00090001
001000*---------------------------------------------------------------* 00100001
001100* THIS PROGRAM CREATES A REPORT OF MISSED PROFIT ASSISTANCE     * 00110023
001200* ALLOWANCES.  THE RECEIPTS AND INVOICES ARE DISPLAYED ALONG    * 00120023
001300* WITH THE ALLOWANCES.                                          * 00130023
001500*---------------------------------------------------------------* 00150001
001600* INPUT:                                                        * 00160001
001700*   1) SORTED MISSED PROFIT ALLOWANCES FILE      (APRD090)      * 00170099
001900* OUTPUT:                                                       * 00190001
002000*   1) REPORT FILE                               (DPWS200O)     * 00200099
002030*---------------------------------------------------------------* 00203001
002040* CHANGE LOG:                                                   * 00204001
002050*                                                               * 00205001
002060* 06/14/2006                                                    * 00206001
002070*   CHANGE MADE: INITIAL IMPLEMENTATION                         * 00207001
002100*   MADE BY: KRYSTEN LEARY                 WR#/IR#: WR30028     * 00210001
002110*                                                               * 00211099
002200* 08/21/2006                                                    * 00220099
002300*   CHANGE MADE: INCREASED THE DETAIL-LINE-TABLE INTERNAL TABLE * 00230099
002310*     LIMIT FROM 5000 TO 7500 RECORDS.                          * 00231099
002400*   MADE BY: KRYSTEN LEARY                 WR#/IR#: P000914020  * 00240099
002410*                                                               * 00241099
002500* 08/21/2006                                                    * 00250099
002600*   CHANGE MADE: INCREASED THE DETAIL-LINE-TABLE INTERNAL TABLE * 00260099
002700*     LIMIT FROM 7500 TO 10000 RECORDS.  ALSO CHANGED THE LOGIC * 00270099
002710*     IN PARAGRAPH B200-CREATE-REPORT FOR WRITING THE 'TOT:'    * 00271099
002720*     FOR RECEIVERS AND INVOICES.                               * 00272099
002800*   MADE BY: KRYSTEN LEARY                 WR#/IR#: P000914168  * 00280099
004808***************************************************************** 00480801
004809                                                                  00480901
004810 ENVIRONMENT DIVISION.                                            00481001
004811                                                                  00481101
004820 INPUT-OUTPUT SECTION.                                            00482001
004830 FILE-CONTROL.                                                    00483001
004840                                                                  00484001
004850     SELECT INPUT-FILE             ASSIGN TO INP01.               00485003
004860     SELECT REPORT-FILE            ASSIGN TO RPT01.               00486001
004870                                                                  00487001
004880 DATA DIVISION.                                                   00488001
004900 FILE SECTION.                                                    00490001
005000                                                                  00500001
005100 FD  INPUT-FILE                                                   00510003
005200     LABEL RECORDS ARE OMITTED                                    00520001
005300     RECORDING MODE IS F                                          00530001
005400     RECORD CONTAINS 120 CHARACTERS                               00540027
005500     BLOCK CONTAINS 0 RECORDS.                                    00550001
005600 01  INPUT-RECORD                    PIC X(120).                  00560027
005700                                                                  00570001
005800 FD  REPORT-FILE                                                  00580001
005900     LABEL RECORDS ARE STANDARD                                   00590001
006000     RECORDING MODE IS F                                          00600001
006100     BLOCK CONTAINS 0 RECORDS.                                    00610001
006200 01  REPORT-RECORD.                                               00620001
006300     05  FILLER                      PIC X(200).                  00630099
006500                                                                  00650001
006600 WORKING-STORAGE SECTION.                                         00660001
006610*----------------------------------------------------------------*00661001
006620* INPUT FILE LAYOUT                                              *00662001
006630*----------------------------------------------------------------*00663001
006700     COPY APRD090.                                                00670001
006710                                                                  00671001
006720*----------------------------------------------------------------*00672001
006730* STANDARD HEADER LAYOUT                                         *00673001
006740*----------------------------------------------------------------*00674001
006750     COPY DPWS200O.                                               00675099
006751                                                                  00675120
006770 01  PROGRAM-CONSTANTS.                                           00677001
006780     05  PC-PROGRAM-NAME             PIC X(08)  VALUE 'APKRP289'. 00678001
006781     05  PC-MAX-LINES                PIC S9(03) VALUE +78.        00678199
006790                                                                  00679001
007400 01  PROGRAM-COUNTERS.                                            00740001
007500     05  RECS-READ-CNT               PIC S9(06) COMP-3 VALUE +0.  00750008
007600     05  RECS-WRITTEN-CNT            PIC S9(06) COMP-3 VALUE +0.  00760008
008700                                                                  00870001
008800 01  PROGRAM-VARIABLES.                                           00880001
009110     05  PV-HOLD-TBL-PO-NBR          PIC 9(09)  VALUE ZEROS.      00911065
009200     05  PV-HOLD-DTL-SRT-CDE         PIC X(03)  VALUE SPACES.     00920012
009400     05  PV-HOLD-RECVR-AMT           PIC 9(09)V99 COMP-3          00940076
009410                                                VALUE ZEROS.      00941076
009500     05  PV-HOLD-INVC-AMT            PIC 9(09)V99 COMP-3          00950076
009600                                                VALUE ZEROS.      00960076
010800                                                                  01080001
010900 01  PROGRAM-SWITCHES.                                            01090001
011000     05  WS-END-OF-INPUT-SW               PIC X(01)  VALUE 'N'.   01100012
011100         88  END-OF-INPUT                            VALUE 'Y'.   01110012
011200         88  NOT-END-OF-INPUT                        VALUE 'N'.   01120012
011240     05  WS-FIRST-A-REC-SW                PIC X(01)  VALUE 'N'.   01124033
011250         88  FIRST-A-REC                             VALUE 'Y'.   01125033
011260         88  NOT-FIRST-A-REC                         VALUE 'N'.   01126033
011300     05  WS-FIRST-B-REC-SW                PIC X(01)  VALUE 'N'.   01130012
011400         88  FIRST-B-REC                             VALUE 'Y'.   01140012
011500         88  NOT-FIRST-B-REC                         VALUE 'N'.   01150012
011600     05  WS-FIRST-C-REC-SW                PIC X(01)  VALUE 'N'.   01160012
011700         88  FIRST-C-REC                             VALUE 'Y'.   01170012
011800         88  NOT-FIRST-C-REC                         VALUE 'N'.   01180012
011900     05  WS-FIRST-DTLLLNE-TBL-SEARCH-SW   PIC X(01)  VALUE 'N'.   01190012
011910         88  FIRST-DTLLNE-TBL-SEARCH                 VALUE 'Y'.   01191012
011920         88  NOT-FIRST-DTLLNE-TBL-SEARCH             VALUE 'N'.   01192012
011930     05  WS-DTLLNE-TBL-PO-MTCH-FOUND-SW   PIC X(01)  VALUE 'N'.   01193015
011940         88  DTLLNE-TBL-PO-MTCH-FOUND                VALUE 'Y'.   01194015
011950         88  DTLLNE-TBL-PO-MTCH-NOT-FOUND            VALUE 'N'.   01195015
012000                                                                  01200001
012100 01  DATE-WORK-AREA.                                              01210014
012200     05  SYSTEM-DATE           PIC 9(06)   VALUE ZEROS.           01220014
012300     05  FILLER REDEFINES SYSTEM-DATE.                            01230014
012400         10  SYSTEM-YEAR       PIC 9(02).                         01240014
012500         10  SYSTEM-MONTH      PIC 9(02).                         01250014
012600         10  SYSTEM-DAY        PIC 9(02).                         01260014
012700     05  SYSTEM-TIME           PIC 9(08)   VALUE ZEROS.           01270014
012800     05  FILLER REDEFINES SYSTEM-TIME.                            01280014
012900         10  SYSTEM-HOUR       PIC 9(02).                         01290014
013000         10  SYSTEM-MINUTE     PIC 9(02).                         01300014
013100         10  SYSTEM-SECOND     PIC 9(02).                         01310014
013200         10  FILLER            PIC 9(02).                         01320014
013300                                                                  01330014
027710*--------------------------------------------------------------*  02771001
027720* REPORT HEADING LINES, DETAIL LINES, CONTROLS, ETC.           *  02772001
027730*--------------------------------------------------------------*  02773001
027800 01  REPORT-CONTROLS.                                             02780001
027900     05  PAGE-COUNT            PIC S9(04)  COMP-3 VALUE +0.       02790001
028000     05  LINE-COUNT            PIC S9(04)  COMP-3 VALUE +0.       02800001
028200 01  BLANK-LINE                PIC X(200)  VALUE SPACES.          02820099
028210 01  DIVIDER-LINE.                                                02821029
028220     05  FILLER                PIC X(82)   VALUE SPACES.          02822099
028230     05  FILLER                PIC X(01)   VALUE '|'.             02823029
028240     05  FILLER                PIC X(76)   VALUE SPACES.          02824099
028250     05  FILLER                PIC X(01)   VALUE '|'.             02825029
028260     05  FILLER                PIC X(40)   VALUE SPACES.          02826099
028300                                                                  02830001
028400 01  HDR-LINE2.                                                   02840001
028500     05  FILLER                PIC X(83)   VALUE SPACES.          02850099
028600     05  FILLER                PIC X(35)   VALUE                  02860001
028700         'MISSED PROFIT ASSISTANCE ALLOWANCES'.                   02870001
028800     05  FILLER                PIC X(82)   VALUE SPACES.          02880099
028900                                                                  02890001
029000 01  HDR-LINE3.                                                   02900001
029100     05  FILLER                PIC X(08)   VALUE 'VENDOR: '.      02910001
029200     05  HDR3-VNDR-NBR         PIC 9(09)   VALUE ZEROS.           02920001
029400     05  FILLER                PIC X(07)   VALUE SPACES.          02940099
029410     05  HDR3-VNDR-NAME        PIC X(30)   VALUE SPACES.          02941001
029420     05  FILLER                PIC X(10)   VALUE SPACES.          02942099
029430     05  FILLER                PIC X(06)   VALUE 'DEPT: '.        02943001
029440     05  HDR3-DEPT             PIC X(03)   VALUE SPACES.          02944001
029450     05  FILLER                PIC X(10)   VALUE SPACES.          02945099
029451     05  FILLER                PIC X(08)   VALUE 'PO NBR: '.      02945156
029452     05  HDR3-PO-NBR           PIC 9(09)   VALUE ZEROS.           02945256
029453     05  FILLER                PIC X(10)   VALUE SPACES.          02945399
029460     05  FILLER                PIC X(23)   VALUE                  02946099
029470         'PROFIT ASSIST PERCENT: '.                               02947099
029480     05  HDR3-PRFT-ASST-PRCNT  PIC 9.9999  VALUE ZEROS.           02948037
029490     05  FILLER                PIC X(10)   VALUE SPACES.          02949099
029491     05  FILLER                PIC X(16)   VALUE                  02949199
029492         'EFFECTIVE DATE: '.                                      02949299
029493     05  HDR3-EFF-DT           PIC X(10)   VALUE SPACES.          02949301
029494     05  FILLER                PIC X(25)   VALUE SPACES.          02949499
029500                                                                  02950001
030100 01  HDR-LINE4.                                                   03010099
030110     05  FILLER                PIC X(23)   VALUE SPACES.          03011099
030120     05  FILLER                PIC X(22)   VALUE SPACES.          03012099
030200     05  FILLER                PIC X(14)   VALUE '** RECEIPTS **'.03020044
030300     05  FILLER                PIC X(23)   VALUE SPACES.          03030099
030310     05  FILLER                PIC X(01)   VALUE '|'.             03031001
030320     05  FILLER                PIC X(31)   VALUE SPACES.          03032099
030400     05  FILLER                PIC X(14)   VALUE '** INVOICES **'.03040044
030500     05  FILLER                PIC X(31)   VALUE SPACES.          03050099
030510     05  FILLER                PIC X(01)   VALUE '|'.             03051002
030520     05  FILLER                PIC X(12)   VALUE SPACES.          03052099
030600     05  FILLER                PIC X(16)   VALUE                  03060001
030610         '** ALLOWANCES **'.                                      03061044
030700     05  FILLER                PIC X(12)   VALUE SPACES.          03070099
031200                                                                  03120001
031300 01  HDR-LINE5.                                                   03130099
031310     05  FILLER                PIC X(25)   VALUE SPACES.          03131099
031400     05  FILLER                PIC X(07)   VALUE 'SEQ NBR'.       03140003
031500     05  FILLER                PIC X(07)   VALUE SPACES.          03150099
031600     05  FILLER                PIC X(08)   VALUE 'VERIFIED'.      03160002
031700     05  FILLER                PIC X(11)   VALUE SPACES.          03170099
031800     05  FILLER                PIC X(03)   VALUE 'QTY'.           03180002
031900     05  FILLER                PIC X(12)   VALUE SPACES.          03190099
032000     05  FILLER                PIC X(04)   VALUE 'COST'.          03200002
032100     05  FILLER                PIC X(05)   VALUE SPACE.           03210099
032200     05  FILLER                PIC X(01)   VALUE '|'.             03220002
032300     05  FILLER                PIC X(04)   VALUE SPACES.          03230099
032310     05  FILLER                PIC X(08)   VALUE 'INVC NBR'.      03231002
032320     05  FILLER                PIC X(18)   VALUE SPACES.          03232099
032330     05  FILLER                PIC X(09)   VALUE 'INVC DATE'.     03233002
032340     05  FILLER                PIC X(11)   VALUE SPACES.          03234099
032350     05  FILLER                PIC X(03)   VALUE 'QTY'.           03235002
032360     05  FILLER                PIC X(06)   VALUE SPACES.          03236099
032370     05  FILLER                PIC X(10)   VALUE 'GROSS COST'.    03237003
032380     05  FILLER                PIC X(07)   VALUE SPACES.          03238099
032390     05  FILLER                PIC X(01)   VALUE '|'.             03239002
032391     05  FILLER                PIC X(05)   VALUE SPACES.          03239199
032392     05  FILLER                PIC X(04)   VALUE 'TYPE'.          03239203
032393     05  FILLER                PIC X(05)   VALUE SPACES.          03239399
032394     05  FILLER                PIC X(04)   VALUE 'PCNT'.          03239403
032395     05  FILLER                PIC X(10)   VALUE SPACES.          03239599
032396     05  FILLER                PIC X(06)   VALUE 'AMOUNT'.        03239603
032397     05  FILLER                PIC X(06)   VALUE SPACES.          03239799
032398                                                                  03239802
032400 01  HDR-LINE6.                                                   03240099
032500     05  FILLER                PIC X(41)   VALUE SPACES.          03250099
032600     05  FILLER                PIC X(04)   VALUE 'DATE'.          03260003
032700     05  FILLER                PIC X(37)   VALUE SPACES.          03270099
032800     05  FILLER                PIC X(01)   VALUE '|'.             03280037
032900     05  FILLER                PIC X(76)   VALUE SPACES.          03290099
033000     05  FILLER                PIC X(01)   VALUE '|'.             03300037
033100     05  FILLER                PIC X(40)   VALUE SPACES.          03310099
035000                                                                  03500099
035600 01  DETAIL-LINE.                                                 03560012
035610     05  DTL-RECVR-PERIOD               PIC X(20).                03561099
035620     05  FILLER                         PIC X(03).                03562099
035700     05  DTL-RECVR-SEQ-NBR              PIC ZZZZZZZZZ.            03570043
035710     05  FILLER                         PIC X(06).                03571099
035800     05  DTL-RECVR-VRFD-DTE             PIC X(10).                03580012
035900     05  FILLER                         PIC X(04).                03590099
036000     05  DTL-RECVR-QTY                  PIC Z,ZZZ,ZZZ.            03600039
036010     05  DTL-RECVR-TXT                  PIC X(04).                03601099
036200     05  DTL-RECVR-AMT                  PIC ZZZ,ZZZ,ZZZ.ZZ.       03620039
036300     05  FILLER                         PIC X(03).                03630099
036400     05  FILLER                         PIC X(01)  VALUE '|'.     03640012
036500     05  FILLER                         PIC X(04).                03650099
036600     05  DTL-INVC-NBR                   PIC X(22).                03660012
036700     05  FILLER                         PIC X(04).                03670099
036800     05  DTL-INVC-DTE                   PIC X(10).                03680012
036900     05  FILLER                         PIC X(04).                03690099
037000     05  DTL-INVC-QTY                   PIC Z,ZZZ,ZZZ.            03700039
037010     05  DTL-INVC-TXT                   PIC X(04).                03701099
037200     05  DTL-INVC-AMT                   PIC ZZZ,ZZZ,ZZZ.ZZ.       03720039
037300     05  FILLER                         PIC X(05).                03730099
037400     05  FILLER                         PIC X(01)  VALUE '|'.     03740012
037500     05  FILLER                         PIC X(05).                03750099
037600     05  DTL-ALW-CDE                    PIC X(03).                03760012
037700     05  FILLER                         PIC X(05).                03770099
037800     05  DTL-ALW-PRCNT                  PIC Z.ZZZZ.               03780099
037900     05  FILLER                         PIC X(05).                03790099
038000     05  DTL-ALW-AMT                    PIC ZZZ,ZZZ,ZZZ.ZZ.       03800039
038100     05  FILLER                         PIC X(02).                03810099
038200                                                                  03820012
042100 01  END-OF-REPORT.                                               04210009
042110     05  FILLER                PIC X(87)      VALUE SPACES.       04211099
042120     05  FILLER                PIC X(26)      VALUE               04212009
042130         '*****  END OF REPORT *****'.                            04213009
042140     05  FILLER                PIC X(87)      VALUE SPACES.       04214099
042150                                                                  04215009
042160 01  NO-DATA-TO-REPORT.                                           04216009
042170     05  FILLER                PIC X(87)      VALUE SPACES.       04217099
042180     05  FILLER                PIC X(27)      VALUE               04218009
042190         'NO DATA FOUND ON INPUT FILE'.                           04219013
042191     05  FILLER                PIC X(86)      VALUE SPACES.       04219199
042192                                                                  04219209
042193*--------------------------------------------------------------*  04219315
042194* ABEND AREA                                                   *  04219415
042195*--------------------------------------------------------------*  04219515
042196 01  ABEND-CODE                PIC S9(4) COMP SYNC VALUE ZEROS.   04219618
042197     88  AC-TABLE-OVERFLOW                    VALUE +4004.        04219717
042198                                                                  04219817
042199 01  ABEND-AREAS.                                                 04219915
042200     05  AA-ABEND-LIT          PIC X(17)      VALUE               04220015
042201         '***** ABEND *****'.                                     04220115
042202     05  AA-PARAGRAPH-LIT      PIC X(19)      VALUE               04220215
042203         '***** PARAGRAPH: '.                                     04220315
042204     05  AA-PARAGRAPH-NAME     PIC X(35)      VALUE SPACES.       04220415
042205     05  AA-MESSAGE-LINE.                                         04220515
042206         10  FILLER            PIC X(06)      VALUE '******'.     04220615
042207         10  AA-MESSAGE        PIC X(144)     VALUE SPACES.       04220715
042208                                                                  04220815
042209*--------------------------------------------------------------*  04220912
042210* INTERNAL DETAIL LINE TABLE                                   *  04221012
042211*--------------------------------------------------------------*  04221112
042212 01  DETAIL-LINE-TABLE.                                           04221210
042213     05  DTLLNE-TBL OCCURS 10000 TIMES INDEXED BY DTLLNE-IDX.     04221399
042214         10  DTLLNE-TBL-PO-NBR            PIC 9(09).              04221412
042216         10  DTLLNE-TBL-PERIOD            PIC X(20).              04221677
042218         10  DTLLNE-TBL-RECVR-SEQ-NBR     PIC 9(09).              04221810
042219         10  DTLLNE-TBL-RECVR-VRFD-DTE    PIC X(10).              04221912
042220         10  DTLLNE-TBL-RECVR-QTY         PIC 9(07).              04222012
042221         10  DTLLNE-TBL-RECVR-AMT         PIC 9(09)V99.           04222112
042222         10  DTLLNE-TBL-RECVR-TXT         PIC X(04).              04222299
042223         10  DTLLNE-TBL-INVC-NBR          PIC X(22).              04222312
042224         10  DTLLNE-TBL-INVC-DTE          PIC X(10).              04222412
042225         10  DTLLNE-TBL-INVC-QTY          PIC 9(07).              04222512
042226         10  DTLLNE-TBL-INVC-AMT          PIC 9(09)V99.           04222612
042227         10  DTLLNE-TBL-INVC-TXT          PIC X(04).              04222799
042228         10  DTLLNE-TBL-ALW-CDE           PIC X(03).              04222812
042229         10  DTLLNE-TBL-ALW-PRCNT         PIC 9V9999.             04222912
042230         10  DTLLNE-TBL-ALW-AMT           PIC 9(09)V99.           04223012
042240                                                                  04224009
050500*----------------------*                                          05050001
050600 PROCEDURE DIVISION.                                              05060001
050700*----------------------*                                          05070001
050800 A100-MAINLINE-ROUTINE.                                           05080001
050810                                                                  05081003
050900     PERFORM B100-INITIALIZATION.                                 05090001
051100     PERFORM B200-CREATE-REPORT                                   05110003
051200       UNTIL END-OF-INPUT.                                        05120003
052770     PERFORM B300-END-OF-PROGRAM.                                 05277003
052780     GOBACK.                                                      05278001
052790                                                                  05279001
052800*--------------------------------------------------------------*  05280001
052900* INITIALIZATION PROCESSING                                    *  05290003
053000*--------------------------------------------------------------*  05300001
053100 B100-INITIALIZATION.                                             05310001
053200                                                                  05320001
053600     ACCEPT SYSTEM-DATE FROM DATE.                                05360001
053700     MOVE SYSTEM-YEAR                     TO DP200O-RUN-YEAR.     05370099
053800     MOVE SYSTEM-MONTH                    TO DP200O-RUN-MONTH.    05380099
053900     MOVE SYSTEM-DAY                      TO DP200O-RUN-DAY.      05390099
054100     ACCEPT SYSTEM-TIME FROM TIME.                                05410001
054200     MOVE SYSTEM-HOUR                     TO DP200O-RUN-HOUR.     05420099
054300     MOVE SYSTEM-MINUTE                   TO DP200O-RUN-MINUTE.   05430099
054400     MOVE PC-PROGRAM-NAME                 TO DP200O-PROGRAM-NAME. 05440099
054500     MOVE 1                               TO DP200O-REPORT-NUMBER.05450099
054600                                                                  05460001
054800     DISPLAY 'RUN DATE = ' SYSTEM-DATE.                           05480003
054900     DISPLAY 'RUN TIME = ' SYSTEM-TIME.                           05490003
055100                                                                  05510001
055200     OPEN INPUT INPUT-FILE                                        05520003
055300         OUTPUT REPORT-FILE.                                      05530003
055400                                                                  05540001
055500     INITIALIZE DETAIL-LINE-TABLE.                                05550011
055600     SET FIRST-A-REC                     TO TRUE.                 05560033
056200     PERFORM R100-READ-INPUT-FILE.                                05620003
056300     PERFORM W100-WRITE-REPORT-HEADINGS.                          05630003
056304                                                                  05630411
056310     IF END-OF-INPUT                                              05631009
056320        DISPLAY 'NO DATA FOUND ON INPUT FILE'                     05632009
056330        PERFORM W700-WRITE-NO-INPUT-DATA                          05633069
056340     END-IF.                                                      05634009
056350                                                                  05635009
056900*--------------------------------------------------------------*  05690001
057000* THIS ROUTINE WILL CREATE THE REPORT                          *  05700003
057100*--------------------------------------------------------------*  05710001
057200 B200-CREATE-REPORT.                                              05720003
057300                                                                  05730001
057400     EVALUATE AP090-RECORD-TYPE                                   05740003
057401       WHEN 'A'                                                   05740110
057409         IF NOT-FIRST-A-REC                                       05740999
057410            PERFORM T100-INVC-TOTAL                               05741099
057420            PERFORM W500-WRITE-REPORT                             05742069
057423         END-IF                                                   05742369
057424         SET NOT-FIRST-A-REC             TO TRUE                  05742433
057425         SET FIRST-B-REC                 TO TRUE                  05742511
057426         SET FIRST-C-REC                 TO TRUE                  05742624
057427         MOVE AP090-VENDOR-NBR           TO HDR3-VNDR-NBR         05742710
057428         MOVE AP090-VENDOR-NAME          TO HDR3-VNDR-NAME        05742810
057429         MOVE AP090-DEPT-NBR             TO HDR3-DEPT             05742924
057431         MOVE AP090-PO-NBR               TO HDR3-PO-NBR           05743157
057432                                            PV-HOLD-TBL-PO-NBR    05743265
057434         MOVE AP090-ALLOW-PERCENT        TO HDR3-PRFT-ASST-PRCNT  05743457
057435         MOVE AP090-EFFECTIVE-DATE       TO HDR3-EFF-DT           05743557
057436       WHEN 'B'                                                   05743657
057440         IF FIRST-B-REC                                           05744057
057446            SET DTLLNE-IDX               TO 1                     05744691
057447            SET NOT-FIRST-B-REC          TO TRUE                  05744757
057448         END-IF                                                   05744857
057449         PERFORM L100-LOAD-PO-NBR                                 05744957
057450         PERFORM L200-LOAD-RECVR-RECS                             05745057
057451       WHEN 'C'                                                   05745157
057453         IF FIRST-C-REC                                           05745357
057454            PERFORM T200-RECVR-TOTAL                              05745499
057463            SET DTLLNE-IDX               TO 1                     05746399
057464            SET NOT-FIRST-C-REC          TO TRUE                  05746457
057465         END-IF                                                   05746557
057466         IF AP090-INVC-RECORD-TYPE = 'A'                          05746657
057467            PERFORM L100-LOAD-PO-NBR                              05746757
057468            PERFORM L300-LOAD-INVC-RECS                           05746857
057469         ELSE                                                     05746957
057470            PERFORM L100-LOAD-PO-NBR                              05747057
057471            PERFORM L400-LOAD-ALW-RECS                            05747157
057472         END-IF                                                   05747257
057473     END-EVALUATE.                                                05747357
057480                                                                  05748003
063100     PERFORM R100-READ-INPUT-FILE.                                06310012
063101     IF END-OF-INPUT                                              06310169
063102        IF FIRST-C-REC                                            06310299
063103           PERFORM T200-RECVR-TOTAL                               06310399
063104        END-IF                                                    06310499
063105        IF NOT-FIRST-C-REC                                        06310599
063106           PERFORM T100-INVC-TOTAL                                06310699
063107        END-IF                                                    06310799
063109        PERFORM W500-WRITE-REPORT                                 06310969
063110     END-IF.                                                      06311069
063120                                                                  06312069
063400*---------------------------------------------------------------* 06340001
063500*  END OF PROGRAM PROCESSING                                    * 06350003
063600*---------------------------------------------------------------* 06360001
063700 B300-END-OF-PROGRAM.                                             06370003
063710                                                                  06371003
063720     DISPLAY 'B300-END-OF-PROGRAM'.                               06372029
063730                                                                  06373029
064200     DISPLAY '************************************************'.  06420001
064300     DISPLAY '****              APKRP289                  ****'.  06430001
064400     DISPLAY '************************************************'.  06440001
064500     DISPLAY 'RECORDS READ    = ' RECS-READ-CNT.                  06450023
064600     DISPLAY 'RECORDS WRITTEN = ' RECS-WRITTEN-CNT.               06460023
064900     DISPLAY '************************************************'.  06490001
065100                                                                  06510001
065110     PERFORM W600-WRITE-END-OF-REPORT.                            06511069
065200     CLOSE INPUT-FILE                                             06520003
065300           REPORT-FILE.                                           06530001
065500                                                                  06550001
065501*--------------------------------------------------------------*  06550112
065502* SEARCH THE INTERNAL TABLE SO THAT THE RECORDS CAN BE         *  06550212
065503* WRITTEN OUT ON THE REPORT                                    *  06550312
065504*--------------------------------------------------------------*  06550412
065505 C100-SEARCH-DTLLNE-TABLE.                                        06550512
065506                                                                  06550612
065509     IF FIRST-DTLLNE-TBL-SEARCH                                   06550912
065511        SET DTLLNE-IDX TO 1                                       06551112
065512     END-IF.                                                      06551212
065513                                                                  06551312
065514     SEARCH DTLLNE-TBL                                            06551412
065515       AT END                                                     06551512
065516         SET DTLLNE-TBL-PO-MTCH-NOT-FOUND          TO TRUE        06551612
065518         SET FIRST-DTLLNE-TBL-SEARCH               TO TRUE        06551812
065520       WHEN (DTLLNE-TBL-PO-NBR(DTLLNE-IDX) = PV-HOLD-TBL-PO-NBR)  06552065
065521         SET DTLLNE-TBL-PO-MTCH-FOUND              TO TRUE        06552112
065523         SET NOT-FIRST-DTLLNE-TBL-SEARCH           TO TRUE        06552312
065529                                                                  06552954
065532         IF DTLLNE-TBL-PERIOD(DTLLNE-IDX) NOT EQUAL SPACES        06553299
065533            MOVE DTLLNE-TBL-PERIOD(DTLLNE-IDX)                    06553399
065534              TO DTL-RECVR-PERIOD                                 06553499
065538         END-IF                                                   06553899
065539         IF DTLLNE-TBL-RECVR-TXT(DTLLNE-IDX) NOT EQUAL SPACES     06553999
065540            MOVE DTLLNE-TBL-RECVR-TXT(DTLLNE-IDX)                 06554099
065541              TO DTL-RECVR-TXT                                    06554199
065543         END-IF                                                   06554399
065544         IF DTLLNE-TBL-INVC-TXT(DTLLNE-IDX) NOT EQUAL SPACES      06554499
065545            MOVE DTLLNE-TBL-INVC-TXT(DTLLNE-IDX)                  06554599
065546              TO DTL-INVC-TXT                                     06554699
065548         END-IF                                                   06554899
065549                                                                  06554999
065550         MOVE DTLLNE-TBL-RECVR-SEQ-NBR(DTLLNE-IDX)                06555099
065551           TO DTL-RECVR-SEQ-NBR                                   06555199
065553         MOVE DTLLNE-TBL-RECVR-VRFD-DTE(DTLLNE-IDX)               06555399
065554           TO DTL-RECVR-VRFD-DTE                                  06555499
065555         MOVE DTLLNE-TBL-RECVR-QTY(DTLLNE-IDX)                    06555599
065556           TO DTL-RECVR-QTY                                       06555699
065557         MOVE DTLLNE-TBL-RECVR-AMT(DTLLNE-IDX)                    06555799
065558           TO DTL-RECVR-AMT                                       06555899
065559         MOVE DTLLNE-TBL-INVC-NBR(DTLLNE-IDX)                     06555999
065560           TO DTL-INVC-NBR                                        06556099
065562         MOVE DTLLNE-TBL-INVC-DTE(DTLLNE-IDX)                     06556299
065563           TO DTL-INVC-DTE                                        06556399
065564         MOVE DTLLNE-TBL-INVC-QTY(DTLLNE-IDX)                     06556499
065565           TO DTL-INVC-QTY                                        06556599
065566         MOVE DTLLNE-TBL-INVC-AMT(DTLLNE-IDX)                     06556699
065567           TO DTL-INVC-AMT                                        06556799
065568         MOVE DTLLNE-TBL-ALW-CDE(DTLLNE-IDX)                      06556899
065569           TO DTL-ALW-CDE                                         06556999
065570         MOVE DTLLNE-TBL-ALW-PRCNT(DTLLNE-IDX)                    06557099
065571           TO DTL-ALW-PRCNT                                       06557199
065572         MOVE DTLLNE-TBL-ALW-AMT(DTLLNE-IDX)                      06557299
065573           TO DTL-ALW-AMT                                         06557399
065574                                                                  06557412
065575         SET DTLLNE-IDX UP BY 1                                   06557599
065576     END-SEARCH.                                                  06557612
065577                                                                  06557712
065578*--------------------------------------------------------------*  06557812
065579* EVALUATE THE DETAIL SORT CODE TO DETERMINE WHICH PERIOD THE  *  06557912
065580* RECORD IS FROM (I.E. CURRENT, PREVIOUS, UNMATCHED)           *  06558012
065581*--------------------------------------------------------------*  06558112
065582 C200-EVALUATE-DTL-SRT-CDE.                                       06558212
065583                                                                  06558312
065585     EVALUATE AP090-DETAIL-SORT-CDE                               06558577
065586       WHEN 'A'                                                   06558677
065587         MOVE 'CURRENT PERIOD: '                                  06558799
065588           TO DTLLNE-TBL-PERIOD(DTLLNE-IDX)                       06558899
065589       WHEN 'B'                                                   06558977
065590         MOVE 'PREVIOUS PERIOD: '                                 06559099
065591           TO DTLLNE-TBL-PERIOD(DTLLNE-IDX)                       06559199
065592       WHEN 'C'                                                   06559277
065593         MOVE 'UNMATCHED: '                                       06559399
065594           TO DTLLNE-TBL-PERIOD(DTLLNE-IDX)                       06559499
065595     END-EVALUATE.                                                06559577
065596     MOVE AP090-DETAIL-SORT-CDE   TO PV-HOLD-DTL-SRT-CDE.         06559682
065597                                                                  06559782
065618*--------------------------------------------------------------*  06561834
065619* LOAD THE PO NUMBER TO THE INTERNAL TABLE                     *  06561934
065620*--------------------------------------------------------------*  06562034
065621 L100-LOAD-PO-NBR.                                                06562137
065622                                                                  06562237
065625     IF DTLLNE-IDX > 10000                                        06562599
065626        MOVE 'L100-LOAD-PO-NBR'         TO AA-PARAGRAPH-NAME      06562637
065627        MOVE 'DTLLNE TABLE EXCEEDS 10000 ENTRIES'                 06562799
065628                                        TO AA-MESSAGE             06562837
065629        SET AC-TABLE-OVERFLOW           TO TRUE                   06562937
065630        PERFORM Z998-ABEND                                        06563037
065631     ELSE                                                         06563137
065632       MOVE AP090-PO-NBR                                          06563240
065633         TO DTLLNE-TBL-PO-NBR(DTLLNE-IDX)                         06563340
065636     END-IF.                                                      06563637
065637                                                                  06563737
065638*--------------------------------------------------------------*  06563810
065639* LOAD THE RECEIVER RECORDS TO THE INTERNAL TABLE              *  06563934
065640*--------------------------------------------------------------*  06564010
065641 L200-LOAD-RECVR-RECS.                                            06564134
065642                                                                  06564210
065645     IF DTLLNE-IDX > 10000                                        06564599
065646        MOVE 'L200-LOAD-RECVR-RECS'     TO AA-PARAGRAPH-NAME      06564634
065647        MOVE 'DTLLNE TABLE EXCEEDS 10000 ENTRIES'                 06564799
065648                                        TO AA-MESSAGE             06564811
065649        SET AC-TABLE-OVERFLOW           TO TRUE                   06564911
065650        PERFORM Z998-ABEND                                        06565011
065651     ELSE                                                         06565111
065654       IF AP090-DETAIL-SORT-CDE NOT EQUAL PV-HOLD-DTL-SRT-CDE     06565499
065655          PERFORM C200-EVALUATE-DTL-SRT-CDE                       06565599
065656       END-IF                                                     06565699
065657                                                                  06565799
065658       MOVE AP090-RECVR-SEQ-NBR                                   06565899
065659         TO DTLLNE-TBL-RECVR-SEQ-NBR(DTLLNE-IDX)                  06565999
065662       MOVE AP090-RECVR-VERFYD-DTE                                06566299
065664         TO DTLLNE-TBL-RECVR-VRFD-DTE(DTLLNE-IDX)                 06566499
065665       MOVE AP090-RECVR-QTY                                       06566599
065666         TO DTLLNE-TBL-RECVR-QTY(DTLLNE-IDX)                      06566699
065669       MOVE AP090-RECVR-AMT                                       06566999
065670         TO DTLLNE-TBL-RECVR-AMT(DTLLNE-IDX)                      06567099
065673       ADD AP090-RECVR-AMT              TO PV-HOLD-RECVR-AMT      06567399
065679                                                                  06567910
065680       SET DTLLNE-IDX UP BY 1                                     06568099
065682     END-IF.                                                      06568211
065683                                                                  06568310
065684*--------------------------------------------------------------*  06568411
065685* LOAD THE INVOICE RECORDS TO THE INTERNAL TABLE               *  06568511
065686*--------------------------------------------------------------*  06568611
065687 L300-LOAD-INVC-RECS.                                             06568734
065688                                                                  06568812
065691     IF DTLLNE-IDX > 10000                                        06569199
065692        MOVE 'L300-LOAD-INVC-RECS'      TO AA-PARAGRAPH-NAME      06569234
065693        MOVE 'DTLLNE TABLE EXCEEDS 10000 ENTRIES'                 06569399
065694                                        TO AA-MESSAGE             06569411
065695        SET AC-TABLE-OVERFLOW           TO TRUE                   06569511
065696        PERFORM Z998-ABEND                                        06569611
065697     ELSE                                                         06569711
065701       MOVE AP090-INVC-NBR  TO DTLLNE-TBL-INVC-NBR(DTLLNE-IDX)    06570193
065703       MOVE AP090-INVC-DATE TO DTLLNE-TBL-INVC-DTE(DTLLNE-IDX)    06570393
065704       MOVE AP090-INVC-QTY  TO DTLLNE-TBL-INVC-QTY(DTLLNE-IDX)    06570493
065706       MOVE AP090-INVC-GRO-COST-AMT                               06570693
065707         TO DTLLNE-TBL-INVC-AMT(DTLLNE-IDX)                       06570793
065708       ADD AP090-INVC-GRO-COST-AMT        TO PV-HOLD-INVC-AMT     06570893
065709                                                                  06570999
065711       IF AP090-INVC-ALW-IND = 'N'                                06571193
065712          SET DTLLNE-IDX UP BY 1                                  06571293
065714       END-IF                                                     06571493
065716     END-IF.                                                      06571611
065717                                                                  06571711
065718*--------------------------------------------------------------*  06571811
065719* LOAD THE ALLOWANCE RECORDS TO THE INTERNAL TABLE             *  06571911
065720*--------------------------------------------------------------*  06572011
065721 L400-LOAD-ALW-RECS.                                              06572134
065722                                                                  06572211
065725     IF DTLLNE-IDX > 10000                                        06572599
065726        MOVE 'L400-LOAD-ALW-RECS'       TO AA-PARAGRAPH-NAME      06572634
065727        MOVE 'DTLLNE TABLE EXCEEDS 10000 ENTRIES'                 06572799
065728                                        TO AA-MESSAGE             06572811
065729        SET AC-TABLE-OVERFLOW           TO TRUE                   06572911
065730        PERFORM Z998-ABEND                                        06573011
065731     ELSE                                                         06573111
065738       MOVE AP090-ALW-CDE   TO DTLLNE-TBL-ALW-CDE(DTLLNE-IDX)     06573811
065740       MOVE AP090-ALW-PCNT  TO DTLLNE-TBL-ALW-PRCNT(DTLLNE-IDX)   06574011
065742       MOVE AP090-ALW-AMT   TO DTLLNE-TBL-ALW-AMT(DTLLNE-IDX)     06574211
065744       SET DTLLNE-IDX UP BY 1                                     06574425
065746     END-IF.                                                      06574611
065747                                                                  06574711
065748*--------------------------------------------------------------*  06574801
065750* READ THE INPUT FILE                                          *  06575003
065800*--------------------------------------------------------------*  06580001
065900 R100-READ-INPUT-FILE.                                            06590003
065910                                                                  06591003
066000     READ INPUT-FILE INTO AP090-RECORD                            06600003
066100        AT END                                                    06610001
066200           SET END-OF-INPUT             TO TRUE                   06620003
066300        NOT AT END                                                06630001
066400           ADD 1                        TO RECS-READ-CNT          06640023
066410           SET NOT-END-OF-INPUT         TO TRUE                   06641010
066500     END-READ.                                                    06650001
066600                                                                  06660001
066700*--------------------------------------------------------------*  06670099
066800* FORMAT THE INVOICE TOTAL                                     *  06680099
066900*--------------------------------------------------------------*  06690099
067000 T100-INVC-TOTAL.                                                 06700099
067010                                                                  06701099
067100     MOVE PV-HOLD-TBL-PO-NBR TO DTLLNE-TBL-PO-NBR(DTLLNE-IDX).    06710099
067300     MOVE PV-HOLD-INVC-AMT  TO DTLLNE-TBL-INVC-AMT(DTLLNE-IDX).   06730099
067500     MOVE 'TOT:'            TO DTLLNE-TBL-INVC-TXT(DTLLNE-IDX).   06750099
067800                                                                  06780099
067900*--------------------------------------------------------------*  06790099
068000* FORMAT THE RECEIVER TOTAL                                    *  06800099
068100*--------------------------------------------------------------*  06810099
068200 T200-RECVR-TOTAL.                                                06820099
068210                                                                  06821099
068300     MOVE PV-HOLD-TBL-PO-NBR TO DTLLNE-TBL-PO-NBR(DTLLNE-IDX).    06830099
068500     MOVE PV-HOLD-RECVR-AMT TO DTLLNE-TBL-RECVR-AMT(DTLLNE-IDX).  06850099
068700     MOVE 'TOT:'            TO DTLLNE-TBL-RECVR-TXT(DTLLNE-IDX).  06870099
068800                                                                  06880099
071124*--------------------------------------------------------------*  07112401
071125* WRITE REPORT HEADINGS                                        *  07112511
071126*--------------------------------------------------------------*  07112601
071127 W100-WRITE-REPORT-HEADINGS.                                      07112715
071128                                                                  07112801
071131     INITIALIZE LINE-COUNT.                                       07113101
071132     ADD 1                              TO PAGE-COUNT.            07113299
071133     MOVE PAGE-COUNT                    TO DP200O-PAGE-NUMBER.    07113399
071134                                                                  07113401
071140     WRITE REPORT-RECORD                                          07114001
071141           FROM DP200O-STANDRD-HEADER-200-COLS AFTER PAGE.        07114199
071150                                                                  07115001
071160     WRITE REPORT-RECORD                FROM HDR-LINE2 AFTER 1.   07116099
071161     WRITE REPORT-RECORD                FROM BLANK-LINE AFTER 1.  07116199
071700     MOVE 2                             TO LINE-COUNT.            07170099
071800                                                                  07180001
071900*--------------------------------------------------------------*  07190003
071910* WRITE SUB HEADINGS                                           *  07191011
071920*--------------------------------------------------------------*  07192003
071930 W200-WRITE-SUB-HEADINGS.                                         07193069
071940                                                                  07194003
071944     IF LINE-COUNT > 73                                           07194499
071946        PERFORM W100-WRITE-REPORT-HEADINGS                        07194699
071953     END-IF.                                                      07195399
071954     WRITE REPORT-RECORD              FROM HDR-LINE3 AFTER 1.     07195429
071970     WRITE REPORT-RECORD              FROM BLANK-LINE AFTER 1.    07197029
071971     WRITE REPORT-RECORD              FROM HDR-LINE4 AFTER 1.     07197199
071972     WRITE REPORT-RECORD              FROM DIVIDER-LINE AFTER 1.  07197229
071981     ADD 4                            TO LINE-COUNT.              07198156
071990                                                                  07199004
072011*--------------------------------------------------------------*  07201111
072012* WRITE REPORT DETAIL COLUMN HEADINGS                          *  07201211
072013*--------------------------------------------------------------*  07201311
072014 W300-WRITE-DETAIL-HEADINGS.                                      07201469
072015                                                                  07201511
072019     WRITE REPORT-RECORD               FROM HDR-LINE5 AFTER 1.    07201999
072020     WRITE REPORT-RECORD               FROM HDR-LINE6 AFTER 1.    07202099
072021     ADD 2                             TO LINE-COUNT.             07202111
072023                                                                  07202311
072030*--------------------------------------------------------------*  07203001
072100* WRITE REPORT DETAIL                                          *  07210003
072200*--------------------------------------------------------------*  07220001
072300 W400-WRITE-REPORT-DETAIL.                                        07230069
072400                                                                  07240003
072402     PERFORM C100-SEARCH-DTLLNE-TABLE.                            07240299
072410     IF LINE-COUNT > PC-MAX-LINES                                 07241099
072411        AND DTLLNE-TBL-PO-MTCH-FOUND                              07241199
072413        PERFORM W100-WRITE-REPORT-HEADINGS                        07241303
072414        PERFORM W200-WRITE-SUB-HEADINGS                           07241403
072415        PERFORM W300-WRITE-DETAIL-HEADINGS                        07241512
072420     END-IF.                                                      07242011
072458                                                                  07245803
072460     IF DTLLNE-TBL-PO-MTCH-FOUND                                  07246099
072473        WRITE REPORT-RECORD            FROM DETAIL-LINE AFTER 1   07247399
072474        ADD 1                          TO RECS-WRITTEN-CNT        07247499
072475        ADD 1                          TO LINE-COUNT              07247599
072476        INITIALIZE DETAIL-LINE                                    07247699
072478     END-IF.                                                      07247899
072479                                                                  07247999
072494*--------------------------------------------------------------*  07249469
072495* WRITES THE PREVIOUS PO'S DATA TO THE REPORT                  *  07249569
072496*--------------------------------------------------------------*  07249669
072497 W500-WRITE-REPORT.                                               07249769
072498                                                                  07249869
072501     PERFORM W200-WRITE-SUB-HEADINGS.                             07250169
072502     PERFORM W300-WRITE-DETAIL-HEADINGS.                          07250270
072503     SET FIRST-DTLLNE-TBL-SEARCH       TO TRUE.                   07250369
072504     INITIALIZE WS-DTLLNE-TBL-PO-MTCH-FOUND-SW.                   07250499
072505     PERFORM W400-WRITE-REPORT-DETAIL                             07250569
072506       UNTIL DTLLNE-TBL-PO-MTCH-NOT-FOUND.                        07250699
072508     WRITE REPORT-RECORD               FROM BLANK-LINE AFTER 1.   07250869
072509     ADD 1                             TO LINE-COUNT.             07250969
072510     INITIALIZE DETAIL-LINE-TABLE                                 07251076
072511                PV-HOLD-DTL-SRT-CDE                               07251199
072512                PV-HOLD-RECVR-AMT                                 07251276
072513                PV-HOLD-INVC-AMT.                                 07251376
072516     SET DTLLNE-IDX TO 1.                                         07251699
072517                                                                  07251769
072518*--------------------------------------------------------------*  07251812
072519* WRITE END OF REPORT                                          *  07251912
072520*--------------------------------------------------------------*  07252012
072600 W600-WRITE-END-OF-REPORT.                                        07260069
072700                                                                  07270012
072800     WRITE REPORT-RECORD            FROM END-OF-REPORT AFTER 1.   07280012
072900                                                                  07290012
104500*--------------------------------------------------------------*  10450010
104600* WRITES THE REPORT IF NO DATA IS FOUND ON THE INPUT FILE      *  10460010
104700*--------------------------------------------------------------*  10470010
104800 W700-WRITE-NO-INPUT-DATA.                                        10480069
104900                                                                  10490010
105100     WRITE REPORT-RECORD        FROM BLANK-LINE AFTER 1.          10510099
105200     WRITE REPORT-RECORD        FROM NO-DATA-TO-REPORT AFTER 1.   10520099
105300     WRITE REPORT-RECORD        FROM BLANK-LINE AFTER 1.          10530099
105400     ADD 3                      TO LINE-COUNT.                    10540099
105500                                                                  10550010
105600*--------------------------------------------------------------*  10560015
105700* DISPLAY ABEND MESSAGE                                        *  10570015
105800*--------------------------------------------------------------*  10580015
105900 Z998-ABEND.                                                      10590015
106000                                                                  10600015
106100     DISPLAY AA-ABEND-LIT.                                        10610015
106200     DISPLAY AA-PARAGRAPH-LIT.                                    10620015
106300     DISPLAY AA-PARAGRAPH-NAME.                                   10630016
106400     DISPLAY AA-MESSAGE-LINE.                                     10640015
106500                                                                  10650015
106700     CALL 'ILBOABN0' USING ABEND-CODE.                            10670015
