000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             RCKUP007.                                00050000
000600 AUTHOR.                 TAMARA KOLTUN.                           00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            08-17-96.                                00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100***************************************************************** 00110000
001200*  THIS PROGRAM WILL READ  A CARTON UPDATE FILE AND RE-WRITE    * 00120000
001300*  IT TO THE OUTPUT FILE IF THE UPC FROM THE INPUT FILE HAS NOT * 00130000
001400*  BEEN ATTACHED TO THE PO.                                     * 00140000
001500***************************************************************** 00150000
001300* CHANGE HISTORY:                                               * 00151064
001300*    CHANGES                                                    * 00152064
001300*     MADE BY: VENKATSUBBU (COGNIZANT)                          * 00153064
001300*     DATE:    10/28/2014                                       * 00154064
001300*                                                               * 00155064
001300*      PO EXPANSION PROJECT.                                    * 00156064
001300*      RECOMPILED TO PICK UP CHANGED COPYBOOK(S).               * 00157064
001100***************************************************************** 00158064
001600 ENVIRONMENT DIVISION.                                            00160000
001700***************************************************************** 00170000
001800                                                                  00180000
001900 CONFIGURATION SECTION.                                           00190000
002000                                                                  00200000
002100 SOURCE-COMPUTER.        IBM-3090.                                00210000
002200 OBJECT-COMPUTER.        IBM-3090.                                00220000
002300                                                                  00230000
002400 INPUT-OUTPUT SECTION.                                            00240000
002500                                                                  00250000
002600 FILE-CONTROL.                                                    00260000
002700                                                                  00270000
002800     SELECT ASN-CARTON-UPD-INPUT                                  00280000
002900         ASSIGN TO INP01.                                         00290000
003000                                                                  00300000
003100     SELECT ASN-CARTON-UPD-OUTPUT                                 00310000
003200         ASSIGN TO OUT01.                                         00320000
003201                                                                  00320144
003210     SELECT ASN-CRTN-UPC-ADD-OUTPUT                               00321044
003220         ASSIGN TO OUT02.                                         00322044
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500******************************************************************00350000
003600                                                                  00360000
003700 FILE SECTION.                                                    00370000
003800                                                                  00380000
003900 FD  ASN-CARTON-UPD-INPUT                                         00390000
004000     RECORDING MODE IS F                                          00400000
004100     LABEL RECORDS ARE STANDARD                                   00410000
004200     RECORD CONTAINS 93 CHARACTERS                                00420000
004300     BLOCK CONTAINS 0  RECORDS.                                   00430000
004400                                                                  00440000
004500 01  ASN-CARTON-UPD-INPUT-REC        PIC  X(93).                  00450000
004600                                                                  00460000
004700 FD  ASN-CARTON-UPD-OUTPUT                                        00470000
004800     RECORDING MODE IS F                                          00480000
004900     LABEL RECORDS ARE STANDARD                                   00490000
005000     RECORD CONTAINS 93 CHARACTERS                                00500000
005100     BLOCK CONTAINS 0  RECORDS.                                   00510000
005200                                                                  00520000
005300 01  ASN-CARTON-UPD-OUTPUT-REC       PIC  X(93).                  00530042
005400                                                                  00540000
005410 FD  ASN-CRTN-UPC-ADD-OUTPUT                                      00541042
005420     RECORDING MODE IS F                                          00542042
005430     LABEL RECORDS ARE STANDARD                                   00543042
005440     RECORD CONTAINS 150 CHARACTERS                               00544054
005450     BLOCK CONTAINS 0  RECORDS.                                   00545042
005460                                                                  00546042
005470 01  ASN-CRTN-UPC-ADD-OUTPUT-REC   PIC  X(150).                   00547054
005480                                                                  00548042
005500 WORKING-STORAGE SECTION.                                         00550000
005600                                                                  00560000
005700                                                                  00570000
005800 01  FILLER.                                                      00580000
005900     05  FILLER                      PIC  X(36)    VALUE          00590000
006000         ' ***** WORKING STORAGE PGM=RCKUP007 '.                  00600000
006100     05  PGM-COMPILED                PIC  X(20)    VALUE SPACE.   00610000
006200     05  FILLER                      PIC  X(10)    VALUE          00620000
006300         ' LOCATION='.                                            00630000
006400     05  PGM-LOCATION                PIC  X(04)    VALUE SPACE.   00640000
006500     05  FILLER                      PIC  X(06)    VALUE          00650000
006600         ' *****'.                                                00660000
006700 EJECT                                                            00670000
006800 01  PROGRAM-SWITCHES.                                            00680000
006900     05 PS-EOF-SW                     PIC X(01) VALUE 'N'.        00690000
007000        88 PS-EOF                     VALUE 'Y'.                  00700000
007100        88 PS-NOT-EOF                 VALUE 'N'.                  00710000
007200     05 PS-UPC-ADDED-SW               PIC X(01) VALUE 'N'.        00720000
007300        88 PS-UPC-ADDED               VALUE 'Y'.                  00730000
007400        88 PS-UPC-NOT-ADDED           VALUE 'N'.                  00740000
007410     05 PS-PROCESS-OUTBOUND-SW        PIC X(01) VALUE 'N'.        00741028
007420        88 PS-PROCESS-OUTBOUND        VALUE 'Y'.                  00742028
007430        88 PS-DONT-PROCESS-OUTBOUND   VALUE 'N'.                  00743028
007440     05 PS-OUTBOUND-CSR-SW            PIC X(01) VALUE 'N'.        00744028
007450        88 PS-END-OUTBOUND-CSR        VALUE 'Y'.                  00745028
007460        88 PS-START-OUTBOUND-CSR      VALUE 'N'.                  00746028
007500 01  DK-DB2-KEYS.                                                 00750000
007600     05  DK-UPC-NBR                   PIC S9(15)V COMP-3.         00760000
007700     05  DK-PO-NBR                    PIC S9(09)  COMP.           00770000
007800     05  DK-SHIPT-UNT-ID              PIC S9(18)  COMP-3.         00780000
007810     05  DK-CART-ID                   PIC S9(18)  COMP-3.         00781028
007900                                                                  00790000
008000 01  PC-CONSTANTS.                                                00800000
008100     05  PC-MAX-RETRIES              PIC S9(04)    VALUE  +3      00810000
008200                                                   COMP.          00820000
008300     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00830000
008400                                                   'RCKUP007'.    00840000
008500     05  PC-0                        PIC S9(09)    COMP  VALUE 0. 00850000
008600     05  PC-PO                       PIC  X(02)    VALUE 'PO'.    00860000
008700                                                                  00870000
008800 01  PV-PROGRAM-VARIABLES.                                        00880000
008900     05  PV-RETRY-COUNTER            PIC S9(04)    VALUE +0       00890000
009000                                                   COMP SYNC.     00900000
009100     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(60)    VALUE SPACE.   00910000
009200     05  PV-DB2-OPERATION-ATTEMPT-2  PIC  X(60)    VALUE SPACE.   00920000
009300     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     00930000
009400                                                   COMP SYNC.     00940000
009500     05  PV-SQL-CODE                 PIC  9(04)    VALUE ZERO.    00950000
009600     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  00960000
009700     05  PV-REC-IN-QTY               PIC 9(07)     VALUE ZEROES.  00970000
009800     05  PV-REC-UPD-QTY              PIC 9(07)     VALUE ZEROES.  00980000
009900                                                                  00990000
009901*----------------------------------------------------------------*00990127
009902* ADDED PROGRAM VARIABLES.                            WR # 230ZZ *00990228
009903*----------------------------------------------------------------*00990328
009904     05  PV-TEMP-SKU-NBR             PIC 9(8)      VALUE ZEROES.  00990428
009905     05  PV-TEMP-DEPT-NBR            PIC X(3)      VALUE SPACES.  00990528
009906     05  PV-TEMP-SUB-CL-NBR          PIC X(2)      VALUE SPACES.  00990628
009907*----------------------------------------------------------------*00990728
009908* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *00990828
009909*----------------------------------------------------------------*00990928
010000                                                                  01000000
010100 01  ABEND-CODE                       PIC S9(04)     VALUE +0     01010000
010200                                                     COMP SYNC.   01020000
010300     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 01030000
010400     88  ABEND-4002-READ-ERROR                       VALUE +4002. 01040000
010500     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 01050000
010600     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 01060000
010700     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 01070000
010800     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 01080000
010900     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 01090000
011000     88  ABEND-4008-DATS-ERROR                       VALUE +4008. 01100000
011100     88  ABEND-4009-KEY-DATS-ERROR                   VALUE +4009. 01110000
011400     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 01140000
011500                                                                  01150000
011510*  COPYBOOK FOR LOGISTICS DOMAIN ITEM ACCESS MODULE  WR # 230ZZ  *01151028
011530                                                                  01153000
011540     COPY XLWS001.                                                01154000
011550                                                                  01155000
011600******************************************************************01160000
011700*    UPDATE CARTON FILE LAYOUT                                    01170000
011800******************************************************************01180000
011900     COPY RCRD017.                                                01190062
011910******************************************************************01191045
011920*    LAYOUT FOR OUTPUT 02                                         01192045
011930******************************************************************01193045
011940     COPY RCRD052.                                                01194062
012000 EJECT                                                            01200000
012100*                                                                 01210000
012200*    DB2 DCLGEN FOR PURCHASE ORDER LINE ITEM TABLE                01220000
012300*                                                                 01230000
012400     EXEC SQL                                                     01240000
012500          INCLUDE TPURITM                                         01250000
012600     END-EXEC.                                                    01260000
012700                                                                  01270000
014100*                                                                 01410000
014200*    DB2 DCLGEN FOR TSHUUPC TABLE                                 01420000
014300*                                                                 01430000
014400     EXEC SQL                                                     01440000
014500          INCLUDE TSHUUPC                                         01450000
014600     END-EXEC.                                                    01460000
014700                                                                  01470000
014800*                                                                 01480000
014900*    DB2 DCLGEN FOR PURCHASE ORDER TABLE                          01490000
015000*                                                                 01500000
015100     EXEC SQL                                                     01510000
015200          INCLUDE TPURCHS                                         01520000
015300     END-EXEC.                                                    01530000
015400                                                                  01540000
015401*                                                                 01540128
015402*    DB2 DCLGEN FOR CARTON/LABEL CROSS REFERENCE TABLE            01540228
015403*                                                                 01540328
015410     EXEC SQL                                                     01541028
015420          INCLUDE TSULBXF                                         01542028
015430     END-EXEC.                                                    01543028
015440                                                                  01544028
015450*                                                                 01545028
015460*    DB2 DCLGEN FOR OUTBOUND CARTON TABLE (SUT_OTBND_CART)        01546028
015470*                                                                 01547028
015480     EXEC SQL                                                     01548028
015490          INCLUDE SUT00024                                        01549028
015491     END-EXEC.                                                    01549128
015492                                                                  01549228
015493*                                                                 01549329
015494*    DB2 DCLGEN FOR OUTBOUND CARTON TABLE (SUT_OTBND_UPC)         01549429
015495*                                                                 01549529
015496     EXEC SQL                                                     01549629
015497          INCLUDE SUT00028                                        01549729
015498     END-EXEC.                                                    01549829
015499                                                                  01549929
015500***********************************************************       01550043
015501*  DB2 DCLGEN FOR    - INBOUND EDI PACKLIST/VENDOR        *       01550151
015502*                      SHIPMENT UNIT ASSOCIATION          *       01550243
015503***********************************************************       01550343
015504     EXEC SQL                                                     01550443
015505          INCLUDE TINPKSU                                         01550543
015506     END-EXEC.                                                    01550643
015507                                                                  01550743
015508***********************************************************       01550851
015509*  DB2 DCLGEN FOR    - PACKSLIP                           *       01550951
015511***********************************************************       01551151
015512     EXEC SQL                                                     01551251
015513          INCLUDE TPKSLIP                                         01551351
015514     END-EXEC.                                                    01551451
015515                                                                  01551551
015520*                                                                 01552043
015600*  COMMUNICATIONS AREA FOR DB2                                    01560000
015700*                                                                 01570000
015800     EXEC SQL                                                     01580000
015900         INCLUDE SQLCA                                            01590000
016000     END-EXEC.                                                    01600000
016100                                                                  01610000
016101******************************************************************01610100
016110* REPLACED THE HOST VARIABLE TSK-MERCH-DEPT-NMBR WITH            *01611000
016120*                            XL001-DEPT-NBR-3CH.                 *01612000
016130* REMOVED THE HOST VARIABLES TSK-MERCH-CLASS-NMBR & TSK-SEQ-NMBR.*01613000
016140* ADDED   THE HOST VARIABLE  XL001-ITM-NBR.   WR/IR #: 230ZZ     *01614000
016150******************************************************************01615000
016200     EXEC SQL                                                     01620000
016300          DECLARE PO-CSR CURSOR FOR                               01630000
016400      SELECT                                                      01640000
016500            A.APP_PO_LNE_NBR                                      01650028
016600           ,A.STATUS_CDE                                          01660028
016700      FROM                                                        01670000
016900            TPURITM A                                             01690028
017000      WHERE                                                       01700000
017100            A.PO_NBR         = :DK-PO-NBR                         01710028
017400        AND A.VER_STATUS_CDE = 'A'                                01740028
017720        AND A.ITM_NBR        = :XL001-ITM-NBR                     01772028
017800      ORDER BY 2,1                                                01780000
017900     END-EXEC.                                                    01790000
018000*                                                                 01800000
018010     EXEC SQL                                                     01801028
018020          DECLARE OTBND_CARTON_CSR CURSOR FOR                     01802028
018030      SELECT                                                      01803028
018040            SHIPT_UNT_ID                                          01804028
018060      FROM                                                        01806028
018070            SUT_OTBND_CART                                        01807028
018080      WHERE                                                       01808028
018090            ORIG_CART_ID     = :DK-SHIPT-UNT-ID                   01809028
018094     END-EXEC.                                                    01809428
018095*                                                                 01809528
018100* DB2 COMMUNICATION AREA 2                                        01810000
018200*                                                                 01820000
018300     COPY SQLCA2.                                                 01830062
018400                                                                  01840000
018500*                                                                 01850000
018600 EJECT                                                            01860000
018700***************************************************************** 01870000
018800* PROCEDURE DIVISION.                                           * 01880000
018900***************************************************************** 01890000
019000 PROCEDURE DIVISION.                                              01900000
019100                                                                  01910000
019200 0000-MAINLINE-PROCESSING.                                        01920000
019300     DISPLAY '**** START OF RCKUP007 ****'.                       01930000
019400     OPEN   INPUT  ASN-CARTON-UPD-INPUT.                          01940000
019500     OPEN   OUTPUT ASN-CARTON-UPD-OUTPUT                          01950042
019600                   ASN-CRTN-UPC-ADD-OUTPUT.                       01960042
019610                                                                  01961042
019700     MOVE ZEROES TO PV-REC-IN-QTY                                 01970000
019800                    PV-REC-UPD-QTY.                               01980000
019900                                                                  01990000
020000     PERFORM UNTIL PS-EOF                                         02000000
020100       INITIALIZE RC017-CARTON-UPD-RECORD                         02010000
020200       READ ASN-CARTON-UPD-INPUT                                  02020000
020300          INTO RC017-CARTON-UPD-RECORD                            02030000
020400            AT END                                                02040000
020500               SET PS-EOF   TO TRUE                               02050000
020600            NOT AT END                                            02060000
020700               PERFORM 1000-PROCESS-INPUT-RECORD  THRU 1000-EXIT  02070000
020800       END-READ                                                   02080000
020900     END-PERFORM                                                  02090000
021000                                                                  02100000
021100     DISPLAY '  ** RECORDS READ    ==> ' PV-REC-IN-QTY.           02110000
021200     DISPLAY '  ** RECORDS UPDATED ==> ' PV-REC-UPD-QTY.          02120000
021300                                                                  02130000
021400     CLOSE  ASN-CARTON-UPD-INPUT                                  02140000
021500            ASN-CARTON-UPD-OUTPUT                                 02150042
021510            ASN-CRTN-UPC-ADD-OUTPUT.                              02151042
021600     DISPLAY '****  END OF RCKUP007  ****'.                       02160042
021700 0000-EXIT.  STOP RUN.                                            02170000
021800                                                                  02180000
021900 1000-PROCESS-INPUT-RECORD.                                       02190000
022000      ADD 1 TO PV-REC-IN-QTY.                                     02200000
022100                                                                  02210000
022200      SET PS-UPC-NOT-ADDED            TO TRUE.                    02220000
022300      MOVE RC017-UPC-NBR              TO DK-UPC-NBR               02230000
022400      MOVE RC017-PO-NBR               TO DK-PO-NBR                02240000
022500      MOVE RC017-CARTON-NBR           TO DK-SHIPT-UNT-ID          02250000
022600      PERFORM 1100-SELECT-SKU-FOR-PO  THRU 1100-EXIT              02260000
022700                                                                  02270000
022800      IF PS-UPC-ADDED                                             02280000
022900         PERFORM 1200-SELECT-PO-LNE-NBR  THRU 1200-EXIT           02290000
023000      END-IF                                                      02300000
023100                                                                  02310000
023200      IF PS-UPC-ADDED                                             02320000
023300         PERFORM 1300-UPDATE-TSHUUPC  THRU 1300-EXIT              02330000
023310         PERFORM 1500-CHECK-OTBND-CARTON-RECS                     02331029
023320         PERFORM 2200-SELECT-INPKSU-SEQ                           02332042
023324         IF SQLCODE = +0                                          02332450
023325            PERFORM 2300-LOAD-UPC-UPD-EXTRACT                     02332550
023330            PERFORM 2400-WRITE-UPC-ADD-OUTPUT                     02333050
023340         END-IF                                                   02334050
023400      ELSE                                                        02340000
023500         PERFORM 1400-WRITE-OUTPUT    THRU 1400-EXIT              02350000
023600      END-IF.                                                     02360000
023700 1000-EXIT. EXIT.                                                 02370000
023800                                                                  02380000
023900 1100-SELECT-SKU-FOR-PO.                                          02390000
026444*----------------------------------------------------------------*02644400
026445* CODE FOR ACCESSING LOGISTICS DOMAIN ITEM ACCESS MODULE.        *02644500
026446*                                                   WR # 230ZZ   *02644600
026447*----------------------------------------------------------------*02644700
026448     INITIALIZE XL001-ITEM-COMMAREA.                              02644800
026449                                                                  02644900
026450     SET  PS-UPC-NOT-ADDED        TO TRUE                         02645000
026480     MOVE DK-UPC-NBR              TO XL001-KEY-UPC-NBR.           02648000
026490                                                                  02649027
026491     SET  XL001-BY-UPC-NBR                                        02649100
026492          XL001-SELECT-SKU                                        02649200
026493          XL001-SELECT-VND-STYL                                   02649300
026494          XL001-SELECT-UPC        TO TRUE.                        02649400
026495                                                                  02649500
026496     CALL XL001-VSM-PGM USING  XL001-ITEM-COMMAREA.               02649600
026497                                                                  02649700
026513     EVALUATE TRUE                                                02651341
026514                                                                  02651440
026515      WHEN XL001-SKU-SQLCODE = +0                                 02651541
026516        SET  PS-UPC-ADDED          TO TRUE                        02651641
026517        MOVE XL001-SKU-NBR         TO PV-TEMP-SKU-NBR             02651741
026518                                                                  02651841
026519        PERFORM 1150-VIEW-VND-STYL                                02651941
026520                                                                  02652041
026521      WHEN XL001-SKU-SQLCODE = +100                               02652141
026522        INITIALIZE PV-TEMP-SKU-NBR                                02652241
026523                                                                  02652341
026524      WHEN XL001-SKU-CONTENTION                                   02652441
026525        MOVE '7000-SELECT-SKU'                                    02652541
026526                             TO PV-ABEND-PARAGRAPH                02652641
026527        MOVE 'SKU CONTENTION'                                     02652741
026528                             TO PV-DB2-OPERATION-ATTEMPTED        02652841
026529        MOVE XL001-SKU-SQLCODE TO SQLCODE                         02652941
026530        PERFORM 9100-SQL-ABEND                                    02653041
026531                                                                  02653141
026532      WHEN OTHER                                                  02653241
026533        MOVE '7000-SELECT-SKU'                                    02653341
026534                             TO PV-ABEND-PARAGRAPH                02653441
026535        MOVE 'INVALID RETURN'                                     02653541
026536                             TO PV-DB2-OPERATION-ATTEMPTED        02653641
026537        MOVE XL001-SKU-SQLCODE TO SQLCODE                         02653741
026538        PERFORM 9100-SQL-ABEND                                    02653841
026539     END-EVALUATE.                                                02653941
026558                                                                  02655840
026559 1150-VIEW-VND-STYL.                                              02655940
026560                                                                  02656040
026561     EVALUATE TRUE                                                02656140
026562                                                                  02656240
026563      WHEN XL001-VND-STYL-SQLCODE = +0                            02656340
026564        MOVE XL001-DEPT-NBR-3CH    TO PV-TEMP-DEPT-NBR            02656440
026565        MOVE XL001-SUB-CL-NBR-2CH  TO PV-TEMP-SUB-CL-NBR          02656540
026566                                                                  02656640
026567      WHEN XL001-VND-STYL-SQLCODE = +100                          02656740
026568        INITIALIZE PV-TEMP-DEPT-NBR                               02656840
026569                   PV-TEMP-SUB-CL-NBR                             02656940
026570                                                                  02657040
026571      WHEN XL001-VND-STYL-CONTENTION                              02657140
026572        MOVE '7110-SELECT-VND-STYL-BY-UPC'                        02657240
026573                             TO PV-ABEND-PARAGRAPH                02657340
026574        MOVE 'VND STYL CONTENTION'                                02657440
026575                             TO PV-DB2-OPERATION-ATTEMPTED        02657540
026576        MOVE XL001-VND-STYL-SQLCODE TO SQLCODE                    02657640
026577        PERFORM 9100-SQL-ABEND                                    02657740
026578                                                                  02657840
026579      WHEN OTHER                                                  02657940
026580        MOVE '7110-SELECT-VND-STYL-BY-UPC'                        02658040
026581                             TO PV-ABEND-PARAGRAPH                02658140
026582        MOVE 'INVALID RETURN'                                     02658240
026583                             TO PV-DB2-OPERATION-ATTEMPTED        02658340
026584        MOVE XL001-VND-STYL-SQLCODE TO SQLCODE                    02658440
026585        PERFORM 9100-SQL-ABEND                                    02658540
026586     END-EVALUATE.                                                02658640
026590                                                                  02659000
028900 1100-EXIT. EXIT.                                                 02890000
028910*----------------------------------------------------------------*02891000
028920* CHANGES MADE FOR WR # 230ZZ ENDS HERE.                         *02892000
028930*----------------------------------------------------------------*02893000
029000                                                                  02900000
029100 1200-SELECT-PO-LNE-NBR.                                          02910000
029200     SET PS-UPC-NOT-ADDED   TO TRUE.                              02920000
029300     MOVE '1200-SELECT-PO-LNE-NBR'  TO PV-ABEND-PARAGRAPH.        02930000
029400                                                                  02940000
029500     EXEC SQL                                                     02950000
029600        OPEN PO-CSR                                               02960000
029700     END-EXEC.                                                    02970000
029800                                                                  02980000
029900     EVALUATE TRUE                                                02990000
030000         WHEN SQLCODE = +0                                        03000000
030100              CONTINUE                                            03010000
030200         WHEN SQLWARN0 NOT = SPACES                               03020000
030300         WHEN SQLCODE < +0                                        03030000
030400         WHEN SQLCODE > +0                                        03040000
030500              MOVE 'UNSUCCESSFUL OPEN OF PO CURSOR'               03050000
030600                     TO PV-DB2-OPERATION-ATTEMPTED                03060000
030700              PERFORM 9100-SQL-ABEND                              03070000
030800     END-EVALUATE.                                                03080000
030900                                                                  03090000
031000     EXEC SQL                                                     03100000
031100      FETCH PO-CSR                                                03110000
031200         INTO  :PURITM-APP-PO-LNE-NBR                             03120000
031300              ,:PURITM-STATUS-CDE                                 03130000
031400     END-EXEC.                                                    03140000
031500                                                                  03150000
031600     EVALUATE TRUE                                                03160000
031700         WHEN SQLCODE = +0                                        03170000
031800              SET PS-UPC-ADDED  TO TRUE                           03180000
031900         WHEN SQLCODE = +100                                      03190000
032000              CONTINUE                                            03200000
032100         WHEN SQLWARN0 NOT = SPACES                               03210000
032200         WHEN SQLCODE < +0                                        03220000
032300         WHEN SQLCODE > +0                                        03230000
032400              MOVE 'UNSUCCESSFUL FETCH OF TPURCHS'                03240000
032500                     TO PV-DB2-OPERATION-ATTEMPTED                03250000
032600              PERFORM 9100-SQL-ABEND                              03260000
032700     END-EVALUATE.                                                03270000
032800                                                                  03280000
032900     EXEC SQL                                                     03290000
033000        CLOSE PO-CSR                                              03300000
033100     END-EXEC.                                                    03310000
033200                                                                  03320000
033300     EVALUATE TRUE                                                03330000
033400         WHEN SQLCODE = +0                                        03340000
033500              CONTINUE                                            03350000
033600         WHEN SQLWARN0 NOT = SPACES                               03360000
033700         WHEN SQLCODE < +0                                        03370000
033800         WHEN SQLCODE > +0                                        03380000
033900              MOVE 'UNSUCCESSFUL CLOSE OF PO CURSOR'              03390028
034000                     TO PV-DB2-OPERATION-ATTEMPTED                03400000
034100              PERFORM 9100-SQL-ABEND                              03410000
034200     END-EVALUATE.                                                03420000
034300 1200-EXIT. EXIT.                                                 03430000
034400                                                                  03440000
034500 1300-UPDATE-TSHUUPC.                                             03450000
034600     MOVE '1300-UPDATE-TSHUUPC'  TO PV-ABEND-PARAGRAPH.           03460000
034700                                                                  03470000
034800     PERFORM                                                      03480060
034900         WITH TEST AFTER                                          03490060
035000         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     03500060
035100         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            03510060
035200                 SQLCODE = ZERO OR                                03520060
035300                 SQLCODE = +100                                   03530060
035400                                                                  03540060
035500         EXEC SQL                                                 03550060
035600             UPDATE TSHUUPC                                       03560060
035700                SET TRN_LNE_NBR = :PURITM-APP-PO-LNE-NBR          03570060
035800              WHERE SHIPT_UNT_ID = :DK-SHIPT-UNT-ID               03580060
035900                AND TRN_NBR      = :DK-PO-NBR                     03590060
036000                AND TRN_LNE_NBR  = :PC-0                          03600060
036100                AND TRN_TYP_CDE  = :PC-PO                         03610060
036200                AND UPC_NBR      = :DK-UPC-NBR                    03620060
036300         END-EXEC                                                 03630060
036400                                                                  03640060
036500         EVALUATE TRUE                                            03650060
036600             WHEN SQLCODE = ZERO                                  03660060
036700             WHEN SQLCODE = -904                                  03670060
036800             WHEN SQLCODE = -913                                  03680060
037000                 ADD 1 TO PV-REC-UPD-QTY                          03700060
037100                                                                  03710060
037200             WHEN SQLCODE = +100                                  03720060
037300                 DISPLAY '**************************************' 03730060
037400                 DISPLAY 'DUPLICATE CARTON '                      03740060
037500                 DISPLAY 'RC017-PO-NBR:  '                        03750060
037600                          RC017-PO-NBR                            03760060
037700                 DISPLAY 'RC017-CARTON-NBR:  '                    03770060
037800                          RC017-CARTON-NBR                        03780060
037900                 DISPLAY 'PO LINE NUMBER:  '                      03790060
038000                         PURITM-APP-PO-LNE-NBR                    03800060
038100                 DISPLAY '**********************************'     03810060
038200                                                                  03820060
038300             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              03830060
038400                 DISPLAY '**************************************' 03840060
038500                 DISPLAY 'WARNING ISSUED ON UPDATE OF TSHUUPC   ' 03850060
038600                 DISPLAY 'RC017-PO-NBR:  '                        03860060
038700                          RC017-PO-NBR                            03870060
038800                 DISPLAY 'RC017-CARTON-NBR:  '                    03880060
038900                          RC017-CARTON-NBR                        03890060
039000                 DISPLAY '**********************************'     03900060
039100                 PERFORM 9800-SQL-WARNING                         03910060
039200                                                                  03920060
039300             WHEN SQLCODE < ZERO                                  03930060
039400                 DISPLAY '**************************************' 03940060
039500                 DISPLAY 'ERROR ISSUED ON UPDATE OF TSHUUPC     ' 03950060
039600                 DISPLAY 'RC017-PO-NBR:  '                        03960060
039700                          RC017-PO-NBR                            03970060
039800                 DISPLAY 'RC017-CARTON-NBR:  '                    03980060
039900                          RC017-CARTON-NBR                        03990060
040000                 DISPLAY '**************************************' 04000060
040100                 PERFORM 9900-SQL-ERROR                           04010060
040200                                                                  04020060
040300         END-EVALUATE                                             04030060
040400                                                                  04040060
040500     END-PERFORM.                                                 04050060
040600                                                                  04060060
040700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES AND                    04070060
040800        (SQLCODE NOT = +0 OR                                      04080060
040900         SQLCODE NOT = +100)                                      04090060
041000         DISPLAY '**************************************'         04100060
041100         DISPLAY 'MAX RETRIES EXCEEDED ATTEMPTING TO    '         04110060
041200         DISPLAY 'UPDATE TSHUUPC                        '         04120060
041300         DISPLAY 'RC017-PO-NBR: '                                 04130060
041400                  RC017-PO-NBR                                    04140060
041500         DISPLAY '**************************************'         04150060
041600         PERFORM 9900-SQL-ERROR                                   04160060
041700     END-IF.                                                      04170060
041800                                                                  04180060
041900                                                                  04190060
042000 1300-EXIT. EXIT.                                                 04200047
042100                                                                  04210000
042200 1400-WRITE-OUTPUT.                                               04220047
042300     WRITE ASN-CARTON-UPD-OUTPUT-REC                              04230000
042400         FROM RC017-CARTON-UPD-RECORD.                            04240000
042500 1400-EXIT. EXIT.                                                 04250000
042600*                                                                 04260000
042610 1500-CHECK-OTBND-CARTON-RECS.                                    04261029
042611     MOVE '1500-CHECK-OTBND-CARTON-RECS' TO PV-ABEND-PARAGRAPH.   04261129
042612     SET PS-DONT-PROCESS-OUTBOUND TO TRUE.                        04261228
042613     PERFORM 1600-SELECT-TSULBXF.                                 04261328
042614     IF PS-PROCESS-OUTBOUND                                       04261428
042615         PERFORM 1700-OPEN-OUTBOUND-CSR                           04261528
042616         PERFORM 1800-PROCESS-OUTBOUND-CSR                        04261628
042617             UNTIL PS-END-OUTBOUND-CSR                            04261728
042618         PERFORM 1900-CLOSE-OUTBOUND-CSR                          04261828
042619     END-IF.                                                      04261928
042620*                                                                 04262028
042621 1600-SELECT-TSULBXF.                                             04262128
042622     MOVE '1600-SELECT-TSULBXF'     TO PV-ABEND-PARAGRAPH.        04262228
042623                                                                  04262328
042624     EXEC SQL                                                     04262428
042625       SELECT  SHIPT_UNT_ID                                       04262528
042626         INTO :SULBXF-SHIPT-UNT-ID                                04262628
042627         FROM  TSULBXF                                            04262730
042630        WHERE  SHIPT_UNT_ID     = :DK-SHIPT-UNT-ID                04263028
042631          AND  CART_LBL_TYP_CDE <> 'P'                            04263128
042632     END-EXEC.                                                    04263228
042633                                                                  04263328
042634     EVALUATE TRUE                                                04263428
042635         WHEN SQLCODE = +0                                        04263528
042636         WHEN SQLCODE = -811                                      04263628
042637              SET PS-PROCESS-OUTBOUND TO TRUE                     04263728
042638         WHEN SQLCODE = +100                                      04263828
042639              CONTINUE                                            04263928
042640         WHEN SQLWARN0 NOT = SPACES                               04264028
042641         WHEN SQLCODE < +0                                        04264128
042642         WHEN SQLCODE > +0                                        04264228
042643              MOVE 'UNSUCCESSFUL OPEN OF PO CURSOR'               04264328
042644                     TO PV-DB2-OPERATION-ATTEMPTED                04264428
042645              PERFORM 9100-SQL-ABEND                              04264528
042646     END-EVALUATE.                                                04264628
042647                                                                  04264728
042648 1700-OPEN-OUTBOUND-CSR.                                          04264828
042649     MOVE '1700-OPEN-OUTBOUND-CSR'  TO PV-ABEND-PARAGRAPH.        04264928
042650                                                                  04265028
042653     EXEC SQL                                                     04265328
042654        OPEN OTBND_CARTON_CSR                                     04265428
042655     END-EXEC.                                                    04265528
042656                                                                  04265628
042657     EVALUATE TRUE                                                04265728
042658         WHEN SQLCODE = +0                                        04265828
042659              SET PS-START-OUTBOUND-CSR TO TRUE                   04265928
042660         WHEN SQLWARN0 NOT = SPACES                               04266028
042661         WHEN SQLCODE < +0                                        04266128
042662         WHEN SQLCODE > +0                                        04266228
042663              MOVE 'UNSUCCESSFUL OPEN OF OTBND_CARTON_CSR'        04266328
042664                     TO PV-DB2-OPERATION-ATTEMPTED                04266428
042665              PERFORM 9100-SQL-ABEND                              04266528
042666     END-EVALUATE.                                                04266628
042667                                                                  04266728
042668 1800-PROCESS-OUTBOUND-CSR.                                       04266828
042669     MOVE '1800-PROCESS-OUTBOUND-CSR' TO PV-ABEND-PARAGRAPH.      04266928
042670                                                                  04267036
042671     EXEC SQL                                                     04267146
042672      FETCH OTBND_CARTON_CSR                                      04267246
042673         INTO  :SUT00024-SHIPT-UNT-ID                             04267346
042674     END-EXEC.                                                    04267446
042675                                                                  04267546
042676     EVALUATE TRUE                                                04267646
042677         WHEN SQLCODE = +0                                        04267746
042678              PERFORM 2000-UPDATE-OUTBOUND-UPC                    04267846
042679         WHEN SQLCODE = +100                                      04267946
042680              SET PS-END-OUTBOUND-CSR TO TRUE                     04268046
042681         WHEN SQLWARN0 NOT = SPACES                               04268146
042682         WHEN SQLCODE < +0                                        04268246
042683         WHEN SQLCODE > +0                                        04268346
042684              MOVE 'UNSUCCESSFUL FETCH OF OTBND_CARTON_CSR'       04268446
042685                     TO PV-DB2-OPERATION-ATTEMPTED                04268546
042686              PERFORM 9100-SQL-ABEND                              04268646
042687     END-EVALUATE.                                                04268728
042688                                                                  04268828
042689 1900-CLOSE-OUTBOUND-CSR.                                         04268928
042690     MOVE '1900-CLOSE-OUTBOUND-CSR'   TO PV-ABEND-PARAGRAPH.      04269028
042691     EXEC SQL                                                     04269128
042692        CLOSE OTBND_CARTON_CSR                                    04269228
042693     END-EXEC.                                                    04269328
042694                                                                  04269428
042695     EVALUATE TRUE                                                04269528
042696         WHEN SQLCODE = +0                                        04269628
042697              CONTINUE                                            04269728
042698         WHEN SQLWARN0 NOT = SPACES                               04269828
042699         WHEN SQLCODE < +0                                        04269928
042700         WHEN SQLCODE > +0                                        04270028
042701              MOVE 'UNSUCCESSFUL CLOSE OF OTBND_CARTON_CSR'       04270128
042702                     TO PV-DB2-OPERATION-ATTEMPTED                04270228
042703              PERFORM 9100-SQL-ABEND                              04270328
042704     END-EVALUATE.                                                04270428
042705                                                                  04270528
042706 2000-UPDATE-OUTBOUND-UPC.                                        04270628
042707     MOVE '2000-UPDATE-OUTBOUND-UPC' TO PV-ABEND-PARAGRAPH.       04270728
042708     MOVE SUT00024-SHIPT-UNT-ID    TO DK-CART-ID.                 04270828
042709                                                                  04270928
042710     PERFORM                                                      04271060
042711         WITH TEST AFTER                                          04271160
042712         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     04271260
042713         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            04271360
042714                 SQLCODE = ZERO OR                                04271460
042715                 SQLCODE = +100                                   04271560
042716                                                                  04271660
042717         EXEC SQL                                                 04271760
042718             UPDATE SUT_OTBND_UPC                                 04271860
042719                SET TRN_LNE_NBR = :PURITM-APP-PO-LNE-NBR          04271960
042720              WHERE SHIPT_UNT_ID = :DK-CART-ID                    04272060
042721                AND TRN_NBR      = :DK-PO-NBR                     04272160
042722                AND TRN_LNE_NBR  = :PC-0                          04272260
042723                AND TRN_TYP_CDE  = :PC-PO                         04272360
042724                AND UPC_NBR      = :DK-UPC-NBR                    04272460
042725         END-EXEC                                                 04272560
042726                                                                  04272660
042727         EVALUATE TRUE                                            04272760
042728             WHEN SQLCODE = ZERO                                  04272860
042729             WHEN SQLCODE = -904                                  04272960
042730             WHEN SQLCODE = -913                                  04273060
042731                 CONTINUE                                         04273160
042733                                                                  04273360
042734             WHEN SQLCODE = +100                                  04273460
042735                 DISPLAY '**************************************' 04273560
042736                 DISPLAY 'DUPLICATE CARTON 2000- PARA'            04273660
042737                 DISPLAY 'RC017-PO-NBR:  '                        04273760
042738                          RC017-PO-NBR                            04273860
042739                 DISPLAY 'RC017-CARTON-NBR:  '                    04273960
042740                          RC017-CARTON-NBR                        04274060
042741                 DISPLAY 'PO LINE NUMBER:  '                      04274160
042742                         PURITM-APP-PO-LNE-NBR                    04274260
042743                 DISPLAY '**********************************'     04274360
042744                                                                  04274460
042745             WHEN (SQLCODE > ZERO OR SQLWARN0 = 'W')              04274560
042746                 DISPLAY '**************************************' 04274660
042747                 DISPLAY 'WARNING ISSUED ON UPDATE SUT_OTBND_UPC' 04274760
042748                 DISPLAY 'RC017-PO-NBR:  '                        04274860
042749                          RC017-PO-NBR                            04274960
042750                 DISPLAY 'RC017-CARTON-NBR:  '                    04275060
042751                          RC017-CARTON-NBR                        04275160
042752                 DISPLAY '**********************************'     04275260
042753                 PERFORM 9800-SQL-WARNING                         04275360
042754                                                                  04275460
042755             WHEN SQLCODE < ZERO                                  04275560
042756                 DISPLAY '**************************************' 04275660
042757                 DISPLAY 'ERROR ISSUED ON UPDATE SUT_OTBND_UPC  ' 04275760
042758                 DISPLAY 'RC017-PO-NBR:  '                        04275860
042759                          RC017-PO-NBR                            04275960
042760                 DISPLAY 'RC017-CARTON-NBR:  '                    04276060
042761                          RC017-CARTON-NBR                        04276160
042762                 DISPLAY '**************************************' 04276260
042763                 PERFORM 9900-SQL-ERROR                           04276360
042764                                                                  04276460
042765         END-EVALUATE                                             04276560
042766                                                                  04276660
042767     END-PERFORM.                                                 04276760
042768                                                                  04276828
042769*                                                                 04276928
042770 2200-SELECT-INPKSU-SEQ.                                          04277042
042771     MOVE '2200-SELECT-INPKSU-SEQ'  TO PV-ABEND-PARAGRAPH.        04277142
042772                                                                  04277242
042773     PERFORM                                                      04277360
042774         WITH TEST AFTER                                          04277460
042775         VARYING PV-RETRY-COUNTER FROM 1 BY 1                     04277560
042776         UNTIL   PV-RETRY-COUNTER > PC-MAX-RETRIES  OR            04277660
042777                 SQLCODE = ZERO OR                                04277760
042778                 SQLCODE = +100                                   04277860
042779                                                                  04277960
042780       EXEC SQL                                                   04278060
042781         SELECT  A.SEQ_NBR                                        04278160
042782           INTO :INPKSU-SEQ-NBR                                   04278260
042783           FROM  TINPKSU A                                        04278360
042784          WHERE  A.SHIPT_UNT_ID     = :DK-SHIPT-UNT-ID            04278460
042785       END-EXEC                                                   04278561
042786                                                                  04278660
042787       EVALUATE TRUE                                              04278760
042788           WHEN SQLCODE = +0                                      04278860
042789           WHEN SQLCODE = +100                                    04278960
042790                CONTINUE                                          04279060
042791           WHEN SQLWARN0 NOT = SPACES                             04279160
042792           WHEN SQLCODE < +0                                      04279260
042793           WHEN SQLCODE > +0                                      04279360
042797                 DISPLAY '**************************************' 04279760
042799                 DISPLAY 'RC017-PO-NBR:  '                        04279960
042800                          RC017-PO-NBR                            04280060
042801                 DISPLAY 'RC017-CARTON-NBR:  '                    04280160
042802                          RC017-CARTON-NBR                        04280260
042803                 DISPLAY 'PO LINE NUMBER:  '                      04280360
042804                         PURITM-APP-PO-LNE-NBR                    04280460
042805                 DISPLAY '**********************************'     04280560
042806                 MOVE 'SELECT FROM TINPKSU '                      04280660
042807                       TO PV-DB2-OPERATION-ATTEMPTED              04280760
042808                 PERFORM 9100-SQL-ABEND                           04280860
042809                                                                  04280960
042810       END-EVALUATE                                               04281060
042811                                                                  04281142
042812     END-PERFORM.                                                 04281260
042813                                                                  04281360
042820                                                                  04282060
042834 2300-LOAD-UPC-UPD-EXTRACT.                                       04283449
042835     INITIALIZE RC052-ASN-RECVR-PKSLIP-RECORD.                    04283557
042836                                                                  04283649
042838     MOVE RC017-PO-NBR              TO  RC052-PO-NBR.             04283856
042839     MOVE INPKSU-SEQ-NBR            TO  RC052-SEQ-NBR.            04283956
042840     MOVE 'Y'                       TO  RC052-UPC-BAD-CRTN-REC.   04284058
042841     MOVE +0                        TO  RC052-UPC-RECYCLE-COUNT.  04284163
042842******************************************************************04284250
042843 2400-WRITE-UPC-ADD-OUTPUT.                                       04284350
042844     WRITE ASN-CRTN-UPC-ADD-OUTPUT-REC                            04284450
042845         FROM RC052-ASN-RECVR-PKSLIP-RECORD.                      04284555
042846                                                                  04284650
042847******************************************************************04284750
042848 9100-SQL-ABEND.                                                  04284850
042850******************************************************************04285049
042900*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    04290000
043000*  ERROR OR WARNING CODE OCCURS.                                  04300000
043100******************************************************************04310000
043200     DISPLAY '9100-SQL-ABEND'.                                    04320000
043300     DISPLAY '** ABEND     **'.                                   04330000
043400     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        04340000
043500     DISPLAY '** PARAGRAPH ** = ' PV-ABEND-PARAGRAPH.             04350000
043600     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     04360000
043700     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPT-2.     04370000
043800     DISPLAY '** PO-NBR    ** = ' RC017-PO-NBR                    04380000
043900     MOVE SQLCODE TO PV-SQL-CODE.                                 04390000
044000     DISPLAY '** SQL CODE  ** = ' PV-SQL-CODE.                    04400000
044100     MOVE +4013 TO PV-ABEND-CODE.                                 04410000
044200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         04420000
044300                                                                  04430000
044400 9800-SQL-WARNING.                                                04440000
044500                                                                  04450000
044600      MOVE SQLCODE               TO SQLCODE2.                     04460000
044700      MOVE SQLERRD(3)            TO SQLERRD3.                     04470000
044800      DISPLAY '** ABEND **       ** = SQLWARNING'.                04480000
044900      DISPLAY '** PROGRAM        ** = RCKUP007'.                  04490000
045000      DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.       04500000
045100      DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 04510000
045200      DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 04520000
045300      DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                 04530000
045400      DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                 04540000
045500      DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                 04550000
045600      DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                 04560000
045700      DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                 04570000
045800      DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                 04580000
045900      DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                 04590000
046000      DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                 04600000
046100                                                                  04610000
046200      SET ABEND-4013-DB2-ERROR   TO TRUE                          04620000
046300      CALL 'ILBOABN0' USING ABEND-CODE.                           04630000
046400 9900-SQL-ERROR.                                                  04640000
046500                                                                  04650000
046600      MOVE SQLCODE               TO SQLCODE2.                     04660000
046700      MOVE SQLERRD(3)            TO SQLERRD3.                     04670000
046800      DISPLAY '** ABEND **       ** = SQLERROR'.                  04680000
046900      DISPLAY '** PROGRAM        ** = RCKUP007'.                  04690000
047000      DISPLAY '** PARAGRAPH      ** = ' PV-ABEND-PARAGRAPH.       04700000
047100      DISPLAY '** SQLCODE        ** = ' SQLCODE2.                 04710000
047200      DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                 04720000
047300      DISPLAY '** SQLERRM        ** = ' SQLERRM.                  04730000
047400      DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                 04740000
047500                                                                  04750000
047600      SET ABEND-4013-DB2-ERROR   TO TRUE                          04760000
047700      CALL 'ILBOABN0' USING ABEND-CODE.                           04770000
