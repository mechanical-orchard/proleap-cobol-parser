000100***************************************************************** 00010001
000200 IDENTIFICATION DIVISION.                                         00020001
000300***************************************************************** 00030001
000400 PROGRAM-ID.    XLKUT005.                                         00040001
000500 AUTHOR.        DAN HINTZ.                                        00050001
000600 INSTALLATION.  KOHLS.                                            00060001
000700 DATE-WRITTEN   JULY 2002.                                        00070001
000800 DATE-COMPILED.                                                   00080001
000900***************************************************************** 00090001
001000*  THIS BATCH DB2 PROGRAM READS THE FILE CREATED BY IMKUT023    * 00100001
001100*  CONTAINING VSM VENDOR STYLE INFORMATION.  INSERTS ROWS INTO  * 00110001
001200*  THE XLT_VND_STYL TABLE.                                      * 00120001
001400***************************************************************** 00140001
001500 ENVIRONMENT DIVISION.                                            00150001
001600 INPUT-OUTPUT SECTION.                                            00160001
001700                                                                  00170001
001800 FILE-CONTROL.                                                    00180001
001900                                                                  00190001
002000     SELECT STYLE-ADDS-IN                                         00200001
002010         ASSIGN TO INP01.                                         00201001
002100                                                                  00210001
002200***************************************************************** 00220001
002300 DATA DIVISION.                                                   00230001
002400***************************************************************** 00240001
002500 FILE SECTION.                                                    00250001
002600                                                                  00260001
002700 FD  STYLE-ADDS-IN                                                00270001
002800     RECORDING MODE IS F                                          00280001
002810     BLOCK CONTAINS 0 RECORDS                                     00281001
002900     LABEL RECORDS ARE STANDARD.                                  00290001
003000                                                                  00300001
003300 01  STYLE-ADDS-IN-RECORD         PIC X(510).                     00330011
003700                                                                  00370001
003800                                                                  00380001
003900***************************************************************** 00390001
004000 WORKING-STORAGE SECTION.                                         00400001
004100                                                                  00410001
004200 01  PS-PROGRAM-SWITCHES.                                         00420001
004300     05  PS-EOF-INPUT-SW              PIC X(01)  VALUE 'N'.       00430001
004400         88  PS-EOF-INPUT-YES                    VALUE 'Y'.       00440001
004500         88  PS-EOF-INPUT-NO                     VALUE 'N'.       00450001
004600                                                                  00460001
004700 01  PC-PROGRAM-CONSTANTS.                                        00470001
004800     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'XLKUT005'.00480001
005000                                                                  00500001
005100 01  PV-PROGRAM-VARIABLES.                                        00510001
005900     05  PV-RECORDS-READ              PIC  9(09) VALUE  0.        00590001
006000     05  PV-RECORDS-INSERTED          PIC  9(09) VALUE  0.        00600001
006200     05  PV-DISP-VS-ID                PIC  9(09) VALUE  0.        00620003
006300     05  PV-DISP-DEPT-NBR             PIC  9(04) VALUE  0.        00630003
006400     05  PV-DISP-RMS-STYL-ID          PIC  9(08) VALUE  0.        00640005
006700     05  PV-SQLCODE                   PIC  S9(9) VALUE +0.        00670003
006800     05  PV-DISP-SQLCODE              PIC ZZZZZZ9-.               00680001
006900                                                                  00690001
007000                                                                  00700001
007100 01  PV-ABEND-FIELDS.                                             00710001
007200     05  PV-ABEND-CODE                PIC  S9(4) VALUE +0         00720001
007300                                                 COMP SYNC.       00730001
007400     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'XLKUT005'.00740001
007500     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00750001
007600     05  PV-ABEND-OPERATION           PIC  X(50) VALUE SPACES.    00760001
007700     05  PV-ABEND-TABLE               PIC  X(12) VALUE SPACES.    00770005
007900     05  PV-DB2-OPERATION-MESSAGE-1   PIC  X(79) VALUE SPACES.    00790001
008000     05  PV-DB2-OPERATION-MESSAGE-2   PIC  X(79) VALUE SPACES.    00800001
008100     05  PV-DB2-OPERATION-MESSAGE-3   PIC  X(79) VALUE SPACES.    00810001
008200                                                                  00820001
008300                                                                  00830001
008400***********************************************************       00840001
008500*  COPYBOOK USED FOR THE STYLE ADDS INPUT FILE            *       00850003
008600***********************************************************       00860001
008700     COPY IMRD058.                                                00870011
008800                                                                  00880001
008900***********************************************************       00890001
009000*  USED FOR DB2 ERROR MESSAGE BUILDING                    *       00900001
009100***********************************************************       00910001
009200     COPY DPWS004.                                                00920010
009300                                                                  00930001
009400***********************************************************       00940001
009500*  DB2 SQL COMMUNICATION AREA                             *       00950001
009600***********************************************************       00960001
009700     EXEC SQL                                                     00970001
009800          INCLUDE SQLCA                                           00980001
009900     END-EXEC.                                                    00990001
010000                                                                  01000001
010100***********************************************************       01010001
010200*  XLT_VND_STYLE TABLE                                    *       01020001
010300***********************************************************       01030001
010400     EXEC SQL                                                     01040001
010500          INCLUDE XLT00004                                        01050001
010600     END-EXEC.                                                    01060001
010700                                                                  01070001
010800***************************************************************** 01080001
010900 PROCEDURE DIVISION.                                              01090001
011000***************************************************************** 01100001
011100     DISPLAY '**** BEGINNING XLKUT005 ****'.                      01110001
011200     DISPLAY ' '.                                                 01120001
011300                                                                  01130001
011400     OPEN INPUT  STYLE-ADDS-IN.                                   01140001
011500                                                                  01150001
011600     PERFORM 1000-READ-INPUT-FILE.                                01160001
011700                                                                  01170001
012100     PERFORM 2000-PROCESS-INPUT-FILE                              01210001
012200       UNTIL PS-EOF-INPUT-YES.                                    01220001
012300                                                                  01230001
012400     CLOSE STYLE-ADDS-IN.                                         01240004
012500                                                                  01250001
012510     PERFORM 3000-TABLE-COMMIT.                                   01251003
012520                                                                  01252003
012600     DISPLAY '  INPUT STYLE RECS READ  = ' PV-RECORDS-READ.       01260001
012700     DISPLAY '  XLT_VND_STYL INSERTED  = ' PV-RECORDS-INSERTED.   01270001
012800     DISPLAY ' '.                                                 01280001
012900     DISPLAY '****  END OF  XLKUT005  ****'.                      01290001
013000                                                                  01300001
013100     GOBACK.                                                      01310001
013200                                                                  01320001
013300                                                                  01330001
013400***************************************************************** 01340001
013500*  READ A STYLE ADD EXTRACT RECORD THAT WILL BE USED TO INSERT  * 01350003
013510*  A ROW OF DATA INTO THE XLT_VND_STYL TABLE.                   * 01351003
013600***************************************************************** 01360001
013700 1000-READ-INPUT-FILE.                                            01370001
013800                                                                  01380001
013900     MOVE '1000-READ-INPUT-FILE    ' TO PV-ABEND-PARAGRAPH.       01390001
014000                                                                  01400001
014010     INITIALIZE IM058-ITEM-STYLE-DOMAIN-REC.                      01401012
014020                                                                  01402003
014100     READ STYLE-ADDS-IN                                           01410004
014200          INTO IM058-ITEM-STYLE-DOMAIN-REC                        01420012
014300            AT END                                                01430001
014400               SET PS-EOF-INPUT-YES TO TRUE                       01440001
014500                                                                  01450001
014600            NOT AT END                                            01460001
014700               SET PS-EOF-INPUT-NO  TO TRUE                       01470001
014800               ADD +1 TO PV-RECORDS-READ                          01480001
014900     END-READ.                                                    01490001
015000                                                                  01500001
015100                                                                  01510001
015200***************************************************************** 01520001
015300*  LOAD THE INFORMATION FROM THE STYLE ADD EXTRACT FILE INTO    * 01530003
015310*  THE HOST VARIABLES AND PERFORM A PARAGRAPH TO INSERT THE     * 01531003
015320*  NEW ROW INTO THE XLT_VND_STYL TABLE.                         * 01532003
015400***************************************************************** 01540001
015500 2000-PROCESS-INPUT-FILE.                                         01550001
015600                                                                  01560001
015700     MOVE '2000-PROCESS-INPUT-FILE ' TO PV-ABEND-PARAGRAPH.       01570001
015800                                                                  01580001
015900     MOVE IM058-RMS-STYL-ID          TO XLT00004-STYL-ID.         01590012
016000     MOVE IM058-DEPT-NBR             TO XLT00004-DEPT-NBR.        01600012
016100     MOVE IM058-MAJ-CL-NBR           TO XLT00004-MAJ-CL-NBR.      01610012
016200     MOVE IM058-SUB-CL-NBR           TO XLT00004-SUB-CL-NBR.      01620012
016300     MOVE IM058-VS-ID                TO XLT00004-VS-ID.           01630012
016310     MOVE IM058-VS-NBR               TO XLT00004-VS-NBR.          01631012
016320     MOVE IM058-ENT-ID               TO XLT00004-ENT-ID.          01632012
016330     MOVE IM058-STKR-NBR             TO XLT00004-STKR-NBR.        01633012
016340     MOVE IM058-TKT-TYP-DESC         TO XLT00004-TKT-TYP-DESC.    01634012
016360     MOVE IM058-HNG-FOLD-DESC        TO XLT00004-HNG-FOLD-DESC.   01636012
016370                                                                  01637003
016400     PERFORM 2100-INSERT-XLT-VND-STYL.                            01640003
017700                                                                  01770001
017800     PERFORM 1000-READ-INPUT-FILE.                                01780001
018500                                                                  01850001
018600                                                                  01860001
021600***************************************************************** 02160001
021700*  INSERT A ROW TO THE XLT_VND_STYL TABLE.                      * 02170003
021800***************************************************************** 02180001
021900 2100-INSERT-XLT-VND-STYL.                                        02190003
022000                                                                  02200001
022100     EXEC SQL                                                     02210001
022200          INSERT                                                  02220001
022300          INTO  XLT_VND_STYL                                      02230003
023010              ( STYL_ID                                           02301003
023020               ,DEPT_NBR                                          02302003
023030               ,MAJ_CL_NBR                                        02303003
023040               ,SUB_CL_NBR                                        02304003
023050               ,VS_ID                                             02305003
023060               ,VS_NBR                                            02306003
023070               ,ENT_ID                                            02307003
023080               ,STKR_NBR                                          02308003
023090               ,TKT_TYP_DESC                                      02309003
023092               ,HNG_FOLD_DESC                                     02309210
                     ,LAST_UPD_TMST)                                    02309310
023200          VALUES                                                  02320001
023910              ( :XLT00004-STYL-ID                                 02391003
023920               ,:XLT00004-DEPT-NBR                                02392003
023930               ,:XLT00004-MAJ-CL-NBR                              02393003
023940               ,:XLT00004-SUB-CL-NBR                              02394003
023950               ,:XLT00004-VS-ID                                   02395003
023960               ,:XLT00004-VS-NBR                                  02396003
023970               ,:XLT00004-ENT-ID                                  02397003
023980               ,:XLT00004-STKR-NBR                                02398003
023990               ,:XLT00004-TKT-TYP-DESC                            02399003
023992               ,:XLT00004-HNG-FOLD-DESC                           02399210
                     ,CURRENT TIMESTAMP)                                02399310
024000     END-EXEC.                                                    02400001
024100                                                                  02410001
024200     EVALUATE TRUE                                                02420001
024300         WHEN SQLCODE = ZERO                                      02430001
024400              ADD +1                 TO PV-RECORDS-INSERTED       02440003
024500         WHEN SQLCODE NOT = +0                                    02450001
024600              MOVE '2100-INSERT-XLT-VND-STYL'                     02460003
024700                                     TO PV-ABEND-PARAGRAPH        02470003
024800              MOVE 'INSERT XLT_VND_STYL'                          02480006
024810                                     TO PV-ABEND-OPERATION        02481003
024830              MOVE IM058-VS-ID       TO PV-DISP-VS-ID             02483012
024840              MOVE IM058-DEPT-NBR    TO PV-DISP-DEPT-NBR          02484012
024850              MOVE IM058-RMS-STYL-ID TO PV-DISP-RMS-STYL-ID       02485012
025700              STRING '  VS ID: '              DELIMITED BY SIZE   02570008
025800                     PV-DISP-VS-ID            DELIMITED BY SIZE   02580004
025900                     '  DEPT NBR: '           DELIMITED BY SIZE   02590003
026000                     PV-DISP-DEPT-NBR         DELIMITED BY SIZE   02600004
026100                     '  STYLE ID: '           DELIMITED BY SIZE   02610005
026200                     PV-DISP-RMS-STYL-ID      DELIMITED BY SIZE   02620005
026700                                   INTO PV-DB2-OPERATION-MESSAGE-102670003
026800                                                                  02680001
026900              MOVE 'XLT_VND_STYL'    TO PV-ABEND-TABLE            02690005
027000              PERFORM Z999-SQL-ABEND                              02700001
027100     END-EVALUATE.                                                02710001
027200                                                                  02720001
027300                                                                  02730001
027400***************************************************************** 02740001
027500* COMMIT THE PENDING TABLE CHANGES.                             * 02750003
027600***************************************************************** 02760001
027700 3000-TABLE-COMMIT.                                               02770003
027800                                                                  02780001
027900     EXEC SQL                                                     02790001
028000          COMMIT                                                  02800001
028100     END-EXEC.                                                    02810001
028200                                                                  02820001
028300                                                                  02830001
028400***************************************************************** 02840001
028500*  DISPLAY DB2 ERROR INFORMATION, ROLLBACK ANY PENDING CHANGES, * 02850003
028510*  AND ABEND THE PROGRAM.                                       * 02851003
028600***************************************************************** 02860001
028700 Z999-SQL-ABEND.                                                  02870001
028800                                                                  02880001
028900     MOVE SQLCODE            TO PV-SQLCODE.                       02890001
029000     MOVE PV-SQLCODE         TO PV-DISP-SQLCODE.                  02900001
029100     DISPLAY '*** DB2 ERROR '.                                    02910001
029200     DISPLAY '*** SQLCODE   = ' PV-DISP-SQLCODE.                  02920001
029300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 02930001
029400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               02940001
029500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               02950001
029600     DISPLAY '*** MESSAGE   = ' PV-DB2-OPERATION-MESSAGE-1.       02960001
029700     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-2.       02970001
029800     DISPLAY '***           = ' PV-DB2-OPERATION-MESSAGE-3.       02980001
029900     DISPLAY '*** TABLE 1   = ' PV-ABEND-TABLE.                   02990005
030000                                                                  03000001
030100     COPY DPPD004.                                                03010010
030200                                                                  03020001
030300     MOVE +4013         TO PV-ABEND-CODE.                         03030001
030400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         03040001
