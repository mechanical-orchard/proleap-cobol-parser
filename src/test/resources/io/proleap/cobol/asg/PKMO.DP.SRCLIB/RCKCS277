000100*-----------------------*                                         00010027
000200 IDENTIFICATION DIVISION.                                         00020027
000300*-----------------------*                                         00030027
000400 PROGRAM-ID.    RCKCS277.                                         00040027
000500 AUTHOR.        MARY SARDINA                                      00050027
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060027
000700 DATE-WRITTEN.  2/96.                                             00070027
000800 DATE-COMPILED.                                                   00080027
000900                                                                  00090027
001000*----------------------------------------------------------------*00100027
001100*    E277 - CREATE VERIFIED COUNT ADJ COMMENTS                   *00110027
001200*                                                                *00120027
001300*    THIS PROGRAM IS USED TO ADD VERIFIED COUNT ADJUSTMENT       *00130027
001400*    COMMENTS.                                                   *00140027
001500*                                                                *00150027
001600*----------------------------------------------------------------*00160027
001610* CHANGED 11/10/2021    BY JIM HUNTER      WR: CHG0263784         00161058
001620* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00162059
001630* MAKING THE CALL DYNAMIC VS STATIC.                              00163059
001640*---------------------------------------------------------------* 00164059
001700 ENVIRONMENT DIVISION.                                            00170054
001800 DATA DIVISION.                                                   00180055
001900                                                                  00190055
002000 WORKING-STORAGE SECTION.                                         00200055
002100 01  PC-PROGRAM-CONSTANTS.                                        00210055
002200     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'RCKCS277'.  00220055
002300     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'RC277A  '.  00230055
002400     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'RCKM277 '.  00240055
002500     05  PC-AUDIT-RTN                 PIC X(08) VALUE 'RCKCS290'. 00250055
002600     05  PC-AUDIT-RTN-LENGTH          PIC S9(04) VALUE +300       00260055
002700                                               COMP SYNC.         00270055
002800     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00280055
002900                                              COMP.               00290055
003000     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00300055
003100                                              COMP.               00310055
003200     05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1           00320055
003300                                              COMP.               00330055
003400     05  PC-SEL-QUEUE-SEQ         PIC 9(01)   VALUE  1.           00340055
003500     05  PC-TRB-QUEUE-SEQ         PIC 9(01)   VALUE  2.           00350055
003600                                                                  00360055
003700     05  PC-COMPANY               PIC X(02) VALUE '03'.           00370055
003800     05  PC-DC                    PIC X(02) VALUE 'DC'.           00380055
003900     05  PC-CORP                  PIC S9(04)  VALUE 90            00390055
004000                                                    COMP.         00400055
004100     05  PC-INTER-APPL-CODES.                                     00410055
004200         10  PC-INTER-APPL-CRIT-SPEC                              00420055
004300                                  PIC  X(01)  VALUE '1'.          00430055
004400         10  PC-INTER-APPL-RCPT-ITEM                              00440055
004500                                  PIC  X(01)  VALUE '2'.          00450055
004600         10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '5'.          00460055
004700     05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.       00470055
004800     05  PC-TMKCS520              PIC  X(08)  VALUE  'TMKCS520'.  00480055
004900     05  PC-PERIOD                PIC  X(01)  VALUE '.'.          00490055
005000     05  PC-A                     PIC  X(01)  VALUE 'A'.          00500055
005100     05  PC-B                     PIC  X(01)  VALUE 'B'.          00510055
005200     05  PC-D                     PIC  X(01)  VALUE 'D'.          00520055
005300     05  PC-V                     PIC  X(01)  VALUE 'V'.          00530055
005400     05  PC-I                     PIC  X(01)  VALUE 'I'.          00540055
005500     05  PC-N                     PIC  X(01)  VALUE 'N'.          00550055
005600     05  PC-Y                     PIC  X(01)  VALUE 'Y'.          00560055
005700     05  PC-J                     PIC  X(01)  VALUE 'J'.          00570055
005800     05  PC-M                     PIC  X(01)  VALUE 'M'.          00580055
005900     05  PC-SPACE                 PIC  X(01)  VALUE ' '.          00590055
006000     05  PC-S                     PIC  X(01)  VALUE 'S'.          00600055
006100     05  PC-ACTIVE-STATUS         PIC  X(01)  VALUE 'A'.          00610055
006200     05  PC-VERIFIED-STATUS       PIC  X(02)  VALUE 'VE'.         00620055
006300     05  PC-3                     PIC  9(01)  VALUE 3.            00630055
006400     05  PC-4                     PIC  9(01)  VALUE 4.            00640055
006500     05  PC-0                     PIC S9(04)  VALUE 0             00650055
006600                                                    COMP.         00660055
006700     05  PC-9999                  PIC S9(04)  VALUE 9999          00670055
006800                                                    COMP.         00680055
006900     05  PC-DB2-DUMMY-DATE        PIC  X(26)  VALUE               00690055
007000         '9999-09-09-09.09.09.999999'.                            00700055
007100     05  PC-DEFAULT-RSN-CDE       PIC  9(03)  VALUE 600.          00710055
007200     05  PC-PO-AND-RCVR-REQUIRED-MSG    PIC  X(31)  VALUE         00720055
007300       'PO NUMBER AND RECEIVER REQUIRED'.                         00730055
007400     05  PC-CAN-NOT-CREATE-MANUALLY-MSG PIC  X(59)  VALUE         00740055
007500       'CAN NOT CREATE TROUBLE MANUALLY FOR THIS TROUBLE REASON'. 00750055
007600     05  PC-RECEIVER-NOT-FOUND-MSG      PIC  X(59)  VALUE         00760055
007700       'NNNNN-I-RECEIVER NOT FOUND FOR SPECIFIED LOCATION'.       00770055
007800     05  PC-PO-LINE-NOT-FOUND-MSG       PIC  X(59)  VALUE         00780055
007900       'NNNNN-I-LINE DOES NOT EXIST ON THE SPECIFIED PO'.         00790055
008000     05  PC-CANNOT-CREATE-PO-TRBL-MSG   PIC  X(59)  VALUE         00800055
008100       'NNNNN-I-CANNOT CREATE TROUBLE - RECEIVER IS VERIFIED'.    00810055
008200     05  PC-CANNOT-CREATE-LINE-TRBL-MSG PIC  X(59)  VALUE         00820055
008300       'NNNNN-I-CANNOT CREATE TROUBLE - PO LINE IS VERIFIED'.     00830055
008400     05  PC-INVALID-TRBL-TYPE-MSG       PIC  X(59)  VALUE         00840055
008500       'NNNNN-I-INVALID TROUBLE REASON TYPE'.                     00850055
008600     05  PC-PO-LEVEL-TRBL-MSG           PIC  X(56)  VALUE         00860055
008700       'NNNNN-I-LINE NBR NOT NEEDED WHEN CREATING PO LEVEL TRBL'. 00870055
008800     05  PC-TRBL-ALREADY-EXISTS-MSG     PIC  X(56)  VALUE         00880055
008900       'NNNNN-I-REQUESTED TRBL ALREADY EXISTS FOR PO OR PO LINE'. 00890055
009000                                                                  00900055
009100     05  PC-TSYMSG-NUMBERS.                                       00910055
009200         10  PC-TSYMSG-00004      PIC  9(05)  VALUE  00004.       00920055
009300         10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.       00930055
009400         10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.       00940055
009500         10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.       00950055
009600         10  PC-TSYMSG-00010      PIC  9(05)  VALUE  00010.       00960055
009700         10  PC-TSYMSG-00016      PIC  9(05)  VALUE  00016.       00970055
009800         10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.       00980055
009900         10  PC-TSYMSG-00050      PIC  9(05)  VALUE  00050.       00990055
010000         10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.       01000055
010100         10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.       01010055
010200         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       01020055
010300         10  PC-TSYMSG-00073      PIC  9(05)  VALUE  00073.       01030055
010400         10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.       01040055
010500         10  PC-TSYMSG-00100      PIC  9(05)  VALUE  00100.       01050055
010600         10  PC-TSYMSG-00115      PIC  9(05)  VALUE  00115.       01060055
010700         10  PC-TSYMSG-00117      PIC  9(05)  VALUE  00117.       01070055
010800         10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.       01080055
010900         10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.       01090055
011000         10  PC-TSYMSG-00316      PIC  9(05)  VALUE  00316.       01100055
011100         10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.       01110055
011200         10  PC-TSYMSG-00410      PIC  9(05)  VALUE  00410.       01120055
011300         10  PC-TSYMSG-00474      PIC  9(05)  VALUE  00474.       01130055
011400         10  PC-TSYMSG-00547      PIC  9(05)  VALUE  00547.       01140055
011500         10  PC-TSYMSG-00548      PIC  9(05)  VALUE  00548.       01150055
011600         10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.       01160055
011700         10  PC-TSYMSG-00686      PIC  9(05)  VALUE  00686.       01170055
011800         10  PC-TSYMSG-00687      PIC  9(05)  VALUE  00687.       01180055
011900         10  PC-TSYMSG-00688      PIC  9(05)  VALUE  00688.       01190055
012000         10  PC-TSYMSG-00738      PIC  9(05)  VALUE  00738.       01200055
012100         10  PC-TSYMSG-00815      PIC  9(05)  VALUE  00815.       01210055
012200         10  PC-TSYMSG-01182      PIC  9(05)  VALUE  01182.       01220055
012300         10  PC-TSYMSG-01183      PIC  9(05)  VALUE  01183.       01230055
012400         10  PC-TSYMSG-01184      PIC  9(05)  VALUE  01184.       01240055
012500         10  PC-TSYMSG-01185      PIC  9(05)  VALUE  01185.       01250055
012600         10  PC-TSYMSG-01186      PIC  9(05)  VALUE  01186.       01260055
012700         10  PC-TSYMSG-01187      PIC  9(05)  VALUE  01187.       01270055
012800         10  PC-TSYMSG-01445      PIC  9(05)  VALUE  01445.       01280055
012900         10  PC-TSYMSG-01522      PIC  9(05)  VALUE  01522.       01290055
013000         10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.       01300055
013100*                                                                 01310055
013200 01  PS-PROGRAM-SWITCHES.                                         01320055
013300     05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.         01330055
013400         88  PS-ERROR                         VALUE  'Y'.         01340055
013500         88  PS-WARNING                       VALUE  'W'.         01350055
013600         88  PS-NO-ERROR                      VALUE  'N'.         01360055
013700     05  PS-SOFT-ABORT-SW         PIC  X(01)  VALUE  'N'.         01370055
013800         88  PS-SOFT-ABORT                    VALUE  'Y'.         01380055
013900     05  PS-RECEIVER-FOUND-SW     PIC  X(01)  VALUE  'N'.         01390055
014000         88  PS-RECEIVER-FOUND                VALUE  'Y'.         01400055
014100         88  PS-NO-RECEIVER-FOUND             VALUE  'N'.         01410055
014200     05  PS-INV-STORE-FOUND-SW    PIC  X(01)  VALUE  'Y'.         01420055
014300         88  PS-INV-STORE-FOUND               VALUE  'Y'.         01430055
014400         88  PS-INV-STORE-NOT-FOUND           VALUE  'N'.         01440055
014500     05  PS-DC-FLUSH-SW           PIC  X(01)  VALUE  'Y'.         01450037
014600         88  PS-DC-FLUSH-YES                  VALUE  'Y'.         01460037
014700         88  PS-DC-FLUSH-NO                   VALUE  'N'.         01470037
014800     05  PS-RECDIS-FOUND-SW       PIC  X(01)  VALUE  'Y'.         01480027
014900         88  PS-RECDIS-FOUND                  VALUE  'Y'.         01490027
015000         88  PS-NO-RECDIS-FOUND               VALUE  'N'.         01500027
015100     05  PS-RECDIS-STORE-FOUND-SW PIC  X(01)  VALUE  'Y'.         01510027
015200         88  PS-RECDIS-STORE-FOUND            VALUE  'Y'.         01520027
015300         88  PS-RECDIS-STORE-NOT-FOUND        VALUE  'N'.         01530027
015400     05  PS-RSN-CDE-ENTERED-SW    PIC  X(01)  VALUE  'N'.         01540027
015500         88  PS-RSN-CDE-ENTERED               VALUE  'Y'.         01550027
015600     05  PS-RSN-DESC-ENTERED-SW   PIC  X(01)  VALUE  'N'.         01560027
015700         88  PS-RSN-DESC-ENTERED              VALUE  'Y'.         01570027
015800     05  PS-CAN-UPDATE-SW         PIC  X.                         01580027
015900         88  PS-CAN-UPDATE                    VALUE 'Y'.          01590027
016000         88  PS-CANT-UPDATE                   VALUE 'N'.          01600027
016100*                                                                 01610027
016200 01  PV-PROGRAM-VARIABLES.                                        01620027
016300     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            01630027
016400                                              COMP SYNC.          01640027
016500     05  PV-CICS-RESP             PIC S9(04)  VALUE +0            01650027
016600                                              COMP SYNC.          01660027
016700     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            01670027
016800                                              COMP SYNC.          01680027
016900     05  PV-MSG-VAR-CNT           PIC S9(04)  VALUE +0            01690027
017000                                              COMP SYNC.          01700027
017100     05  PV-DB2-COUNT             PIC S9(04)  VALUE +0            01710027
017200                                              COMP SYNC.          01720027
017300     05  PV-NULL                  PIC S9(04)  VALUE +0            01730027
017400                                              COMP SYNC.          01740027
017500     05  PV-NULL-IND              PIC S9(04)  VALUE +0            01750027
017600                                              COMP SYNC.          01760027
017700     05  PV-STRING-POINTER        PIC S9(04)  VALUE +0            01770027
017800                                              COMP SYNC.          01780027
017900     05  PV-CURRENT-TIMESTAMP     PIC X(26)   VALUE               01790027
018000                                                 SPACES.          01800027
018100     05  PV-FROM-PARAGRAPH        PIC X(35)   VALUE               01810055
018200                                                 SPACES.          01820029
018300     05  PV-INPUT-DATE.                                           01830027
018400         10  PV-INPUT-DATE-MM     PIC 9(2)     VALUE ZEROES.      01840027
018500         10  FILLER               PIC X(1)     VALUE SPACES.      01850027
018600         10  PV-INPUT-DATE-DD     PIC 9(2)     VALUE ZEROES.      01860027
018700         10  FILLER               PIC X(1)     VALUE SPACES.      01870027
018800         10  PV-INPUT-DATE-CCY    PIC 9(4)     VALUE ZEROES.      01880027
018900     05  PV-DB2-START-DATE        PIC X(10).                      01890027
019000     05  PV-DB2-END-DATE          PIC X(10).                      01900027
019100     05  PV-COMP-DATE-JULIAN      PIC X(08).                      01910027
019200     05  PV-END-DATE-JULIAN       PIC X(08).                      01920027
019300     05  PV-VFY-DATE-JULIAN       PIC X(08).                      01930027
019400     05  PV-TRBL-SHT-DESC-LOW     PIC X(10).                      01940027
019500     05  PV-TRBL-SHT-DESC-HIGH    PIC X(10).                      01950027
019600     05  PV-TRBL-LONG-DESC-LOW     PIC X(20).                     01960027
019700     05  PV-TRBL-LONG-DESC-HIGH    PIC X(20).                     01970027
019800     05  PV-TRB-QUEUE-ITEM         PIC S9(04)  VALUE +0           01980027
019900                                               COMP SYNC.         01990027
020000     05  PV-DISPLAY-PO.                                           02000027
020100** CHG0094517  CHANGED PO-NBR LENGTH FROM 7 TO 8                  02010046
020200         10  PV-PO-NBR            PIC  99999999.                  02020046
020300         10  FILLER               PIC  X(01)  VALUE '-'.          02030027
020400         10  PV-REC-SEQ-NBR       PIC  9(04).                     02040027
020500     05  PV-EIBDATE.                                              02050027
020600         10  PV-EIBDATE-N             PIC 9(5).                   02060027
020700         10  FILLER                   PIC X(5).                   02070027
020800     05  PV-WORK-TMST.                                            02080027
020900         10  PV-WORK-TMST-1.                                      02090027
021000             15  PV-WK-CCYY           PIC  X(04)  VALUE SPACE.    02100027
021100             15  FILLER               PIC  X(01)  VALUE SPACE.    02110027
021200             15  PV-WK-MO             PIC  X(02)  VALUE SPACE.    02120027
021300             15  FILLER               PIC  X(01)  VALUE SPACE.    02130027
021400             15  PV-WK-DA             PIC  X(02)  VALUE SPACE.    02140027
021500         10  PV-WORK-TMST-2.                                      02150027
021600             15  FILLER               PIC  X(01)  VALUE SPACE.    02160027
021700             15  PV-WK-HH             PIC  X(02)  VALUE SPACE.    02170027
021800             15  FILLER               PIC  X(01)  VALUE SPACE.    02180027
021900             15  PV-WK-MM             PIC  X(02)  VALUE SPACE.    02190027
022000             15  FILLER               PIC  X(01)  VALUE SPACE.    02200027
022100             15  PV-WK-SS             PIC  X(02)  VALUE SPACE.    02210027
022200             15  FILLER               PIC  X(01)  VALUE SPACE.    02220027
022300             15  FILLER               PIC  X(06)  VALUE ZERO.     02230027
022400     05  PV-LK-DTE-ISO.                                           02240027
022500         10  PV-LK-DTE-CCYY           PIC  X(04)  VALUE SPACE.    02250027
022600         10  PV-LK-DTE-MO             PIC  X(02)  VALUE SPACE.    02260027
022700         10  PV-LK-DTE-DD             PIC  X(02)  VALUE SPACE.    02270027
022800     05  PV-SCREEN-DISPLAY-DATE.                                  02280027
022900         10  PV-SD-MO                   PIC  X(02).               02290027
023000         10  FILLER                     PIC  X(01)   VALUE '/'.   02300027
023100         10  PV-SD-DA                   PIC  X(02).               02310027
023200         10  FILLER                     PIC  X(01)   VALUE '/'.   02320027
023300         10  PV-SD-YR                   PIC  X(02).               02330027
023400     05  PV-SCREEN-DISPLAY-TIME.                                  02340027
023500         10  PV-SD-HH                   PIC  X(02).               02350027
023600         10  FILLER                     PIC  X(01)   VALUE ':'.   02360027
023700         10  PV-SD-MM                   PIC  X(02).               02370027
023800         10  FILLER                     PIC  X(01)   VALUE ':'.   02380027
023900         10  PV-SD-SS                   PIC  X(02).               02390027
024000     05  PV-ACTL-CTOFF-YYYYMMDD         PIC  X(08).               02400027
024100     05  PV-VERIFY-DTE-YYYYMMDD         PIC  X(08).               02410027
024200     05  PV-CURRENT-DTE-YYYYMMDD        PIC  X(08).               02420027
024300     05  PV-RECEIPT-DTE-YYYYMMDD        PIC  X(08).               02430027
024400     05  PV-DB2-INV-FORMAT              PIC  X(10).               02440027
024500     05  PV-REASON-CHECKER              PIC  9(4).                02450027
024600         88  PV-VERIFIED-ADJUSTMENT   VALUES 0600 THRU 0609.      02460032
024700     05  PV-TODAYS-FISCAL-PERIOD        PIC  9(2).                02470027
024800     05  PV-VERIFY-FISCAL-PERIOD        PIC  9(2).                02480027
024801*                                                                 02480155
024802** DMH 07/07/2021 BEGIN                                           02480255
024803*                                                                 02480355
024820     05  PV-TRBL-CMNT-TEXT1             PIC X(50) VALUE SPACES.   02482055
024830     05  PV-TRBL-CMNT-TEXT2             PIC X(50) VALUE SPACES.   02483055
024840     05  PV-TRBL-CMNT-TEXT3             PIC X(50) VALUE SPACES.   02484055
024850     05  PV-TRBL-CMNT-TEXT4             PIC X(50) VALUE SPACES.   02485055
024860     05  PV-TRBL-CMNT-TEXT5             PIC X(50) VALUE SPACES.   02486055
024870*                                                                 02487055
024880** DMH 07/07/2021 END                                             02488055
024890*                                                                 02489055
025000                                                                  02500027
025100 01  DK-DB2-KEYS.                                                 02510027
025200     05  DK-PO-NBR                    PIC S9(9) COMP VALUE +0.    02520027
025300     05  DK-PKSL-LNE-NBR              PIC S9(9) COMP VALUE +0.    02530027
025400     05  DK-REC-SEQ-NBR               PIC S9(9) COMP VALUE +0.    02540027
025500     05  DK-STR-NBR                   PIC S9(4) COMP VALUE +0.    02550027
025600     05  DK-STR-NBR-N                 PIC 9(4).                   02560027
025700     05  DK-STORE                     PIC S9(4) COMP VALUE +0.    02570033
025800     05  DK-AGRMT-TYP-ID              PIC  X(01)  VALUE SPACE.    02580027
025900     05  DK-TYP-CDE                   PIC S9(04)  VALUE ZERO      02590027
026000                                                         COMP.    02600027
026100     05  DK-PO-LINE-NBR-LOW           PIC S9(9) COMP VALUE +0.    02610027
026200     05  DK-PO-LINE-NBR-HIGH          PIC S9(9) COMP VALUE +0.    02620027
026300*----------------------------------------------------------------*02630027
026400*    MAP LAYOUT                                                  *02640027
026500*----------------------------------------------------------------*02650027
026600                                                                  02660027
026700     COPY RCKM277.                                                02670027
026800                                                                  02680027
026900/                                                                 02690027
027000*----------------------------------------------------------------*02700027
027100*    TEMP STORAGE QUEUE LAYOUT FOR SELECTION INPUT QUEUE.        *02710027
027200*----------------------------------------------------------------*02720027
027300                                                                  02730027
027400     COPY RCWS013.                                                02740032
027500                                                                  02750027
027600     COPY RCWS031.                                                02760032
027700/                                                                 02770027
027800*----------------------------------------------------------------*02780027
027900*    COMMAREA FOR TMKCS520.                                      *02790027
028000*----------------------------------------------------------------*02800027
028100                                                                  02810027
028200     COPY TMWS500.                                                02820032
028300                                                                  02830027
028400/                                                                 02840027
028500*----------------------------------------------------------------*02850027
028600*    ATTRIBUTE SETTINGS COPYBOOK.                                *02860027
028700*----------------------------------------------------------------*02870027
028800                                                                  02880027
028900     COPY DPWS015.                                                02890032
029000                                                                  02900027
029100*----------------------------------------------------------------*02910027
029200*    FUNCTION KEYS COPYBOOK                                      *02920027
029300*----------------------------------------------------------------*02930027
029400                                                                  02940027
029500     COPY DPWS016.                                                02950032
029600                                                                  02960027
030300*----------------------------------------------------------------*03030027
030400*    DATE/TIME COPYBOOK                                          *03040027
030500*----------------------------------------------------------------*03050027
030600                                                                  03060027
030700     COPY DPWS017.                                                03070032
030800                                                                  03080027
030900/                                                                 03090027
031000*----------------------------------------------------------------*03100027
031100*  THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT     *03110027
031200*  SUB-ROUTINE (DPKUT100).                                       *03120027
031300*----------------------------------------------------------------*03130027
031400     COPY DPWS010I.                                               03140032
031500/                                                                 03150027
031600******************************************************************03160059
031700** THE CALLING PARAMETER LIST (DPWS030/DPWS930) FOR THE CICS    **03170059
031800** ARCHITECTURE API (BLACK BOX) SUB-ROUTINE.                    **03180059
031900******************************************************************03190059
032000     COPY DPWS030.                                                03200032
032010     COPY DPWS930.                                                03201059
032100/                                                                 03210027
032200*----------------------------------------------------------------*03220027
032300*    STANDARD COMMAREA.                                          *03230027
032400*----------------------------------------------------------------*03240027
032500                                                                  03250027
032600     COPY DPWS020.                                                03260032
032700     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03270027
032800                                                                  03280027
032900*----------------------------------------------------------------*03290027
033000*    INTER-APPLICATION COMMAREA.                                 *03300027
033100*----------------------------------------------------------------*03310027
033200                                                                  03320027
033300         10  INTER-APPL-COMM-AREA PIC X(200).                     03330027
033400     COPY RCWS017.                                                03340032
033500     COPY PCWS000.                                                03350032
033600     COPY TMWS001.                                                03360032
033700*----------------------------------------------------------------*03370027
033800*    SPECIFIC COMMMAREA.                                         *03380027
033900*----------------------------------------------------------------*03390027
034000         10  ASC-SPECIFIC-COMMAREA.                               03400027
034100             15  ASC-KEY-NOTIF-NBR               PIC S9(09)       03410027
034200                                                 COMP.            03420027
034300             15  ASC-KEY-PO-NBR                  PIC S9(09)       03430027
034400                                                 COMP.            03440027
034500             15  ASC-KEY-PO-LNE-NBR              PIC S9(09)       03450027
034600                                                 COMP.            03460027
034700             15  ASC-KEY-REC-SEQ-NBR             PIC S9(09)       03470027
034800                                                 COMP.            03480027
034900             15  ASC-KEY-OPER-UNT-ID             PIC S9(04)       03490027
035000                                                 COMP.            03500027
035100             15  ASC-KEY-FCLTY-ID                PIC S9(04)       03510027
035200                                                 COMP.            03520027
035300             15  ASC-SCREEN-ENTERABLE-FIELDS.                     03530027
035400                 20  ASC-TEXT1                   PIC X(50).       03540027
035500                 20  ASC-TEXT2                   PIC X(50).       03550027
035600                 20  ASC-TEXT3                   PIC X(50).       03560027
035700                 20  ASC-TEXT4                   PIC X(50).       03570027
035800                 20  ASC-TEXT5                   PIC X(50).       03580027
035900                 20  ASC-TRBL-RSN-CDE-X          PIC X(04).       03590027
036000                 20  ASC-TRBL-RSN-CDE REDEFINES                   03600027
036100                     ASC-TRBL-RSN-CDE-X          PIC 9(04).       03610027
036200                 20  ASC-TRBL-SHT-DESC           PIC X(10).       03620027
036300                 20  ASC-TRBL-LONG-DESC          PIC X(20).       03630027
036400***** THIS FILLER REPLACES ASC-RESP-AREA WHICH HAS BEEN REMOVED.  03640027
036500                 20  FILLER                      PIC X(07).       03650027
036600             15  ASC-ENT-ID                      PIC S9(09) COMP. 03660027
036700             15  ASC-DEPT-NBR                    PIC X(03).       03670027
036800             15  ASC-FCLTY-NME                   PIC X(25).       03680027
036900             15  ASC-FCLTY-AREA-ID               PIC X(06).       03690027
037000             15  ASC-VENDOR-NAME                 PIC X(30).       03700027
037100             15  ASC-TRBL-LVL-IND                PIC X(01).       03710027
037200                 88  ASC-PO-LEVEL-TRBL           VALUE 'P'.       03720027
037300                 88  ASC-LINE-LEVEL-TRBL         VALUE 'L'        03730027
037400                                                       'S'        03740027
037500                                                       'X'.       03750027
037600             15  ASC-CONFIRM-REQUIRED-IND        PIC X(01).       03760027
037700                 88  ASC-CONFIRM-REQUIRED        VALUE 'C'.       03770027
037800                 88  ASC-NO-CONFIRM-REQUIRED     VALUE 'N'.       03780027
037900             15  ASC-DONE-PROCESSING-SW          PIC X(01).       03790027
038000                 88  ASC-DONE-PROCESSING         VALUE 'D'.       03800027
038100                 88  ASC-NOT-DONE-PROCESSING     VALUE 'N'.       03810027
038200             15  ASC-TRBL-RSN-CDE-SW             PIC X(01).       03820027
038300                 88  ASC-TRBL-RSN-CDE-ERROR      VALUE 'Y'.       03830027
038400                 88  ASC-TRBL-RSN-CDE-OK         VALUE 'N'.       03840027
038500             15  ASC-RSN-CDE-ENTERED-SW          PIC X(01).       03850027
038600                 88  ASC-RSN-CDE-ENTERED         VALUE  'Y'.      03860027
038700                 88  ASC-RSN-CDE-NOT-ENTERED     VALUE  'N'.      03870027
038800             15  ASC-RSN-DESC-ENTERED-SW         PIC X(01).       03880027
038900                 88  ASC-RSN-DESC-ENTERED        VALUE  'Y'.      03890027
039000                 88  ASC-RSN-DESC-NOT-ENTERED    VALUE  'N'.      03900027
039100             15  ASC-TRB-ENTRY-SW                PIC X(01).       03910027
039200                 88  ASC-TRB-ENTRY-WRITTEN       VALUE  'Y'.      03920027
039300                 88  ASC-TRB-ENTRY-NOT-WRITTEN   VALUE  'N'.      03930027
039400             15  ASC-INT-APPL-FORMAT-IND         PIC X(01).       03940027
039500             15  ASC-USE-SELECTION-QUEUE-IND     PIC X(01).       03950027
039600                 88  ASC-USE-SELECTION-QUEUE     VALUE 'Y'.       03960027
039700             15  ASC-SEL-QUEUE-NAME-IN       PIC X(08).           03970027
039800             15  ASC-SEL-QUEUE-NAME.                              03980027
039900                 20  ASC-SEL-TERM-ID             PIC  X(04).      03990027
040000                 20  ASC-SEL-TASK-NUMBER         PIC S9(05)       04000027
040100                                                       COMP-3.    04010027
040200                 20  ASC-SEL-SEQ                 PIC  9(01).      04020027
040300             15  ASC-TRB-QUEUE-NAME-IN           PIC  X(08).      04030027
040400             15  ASC-TRB-QUEUE-NAME.                              04040027
040500                 20  ASC-TRB-TERM-ID             PIC  X(04).      04050027
040600                 20  ASC-TRB-TASK-NUMBER         PIC S9(05)       04060027
040700                                                      COMP-3.     04070027
040800                 20  ASC-TRB-SEQ                  PIC  9(01).     04080027
040900             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05)  COMP-3.    04090027
041000             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04100027
041100                                           PIC S9(09)  COMP-3.    04110027
041200             15  ASC-SEL-SUB               PIC S9(04)  COMP.      04120027
041300             15  ASC-SEL-ITEM              PIC S9(04)  COMP.      04130027
041400                                                                  04140027
041500             15  ASC-HOLD-INTER-APPL       PIC  X(200).           04150027
041600             15  ASC-STORE-TYPE-SW                   PIC  X(01).  04160027
041700                 88  ASC-NOT-DC-STORE-TYPE           VALUE 'N'.   04170027
041800                 88  ASC-DC-STORE-TYPE               VALUE 'D'.   04180027
041900         10  FILLER                        PIC  X(200).           04190027
042000/                                                                 04200027
042100*                                                                 04210027
042200*                                                                 04220027
042300/                                                                 04230027
042400*----------------------------------------------------------------*04240027
042500*    ABEND PROCESSING COPYBOOK.                                  *04250027
042600*----------------------------------------------------------------*04260027
042700                                                                  04270027
042800     COPY DPWS013.                                                04280032
042900                                                                  04290027
043000*                                                                 04300027
043100/                                                                 04310027
043200*----------------------------------------------------------------*04320027
043300*    TROUBLE HOLD RECORD.                                        *04330027
043400*----------------------------------------------------------------*04340027
043500                                                                  04350027
043600     COPY TMWS003.                                                04360032
043700                                                                  04370027
043800/                                                                 04380027
043900*----------------------------------------------------------------*04390027
044000*  WORK AREA PASSED IN CALL TO DPKUT500                          *04400027
044100*----------------------------------------------------------------*04410027
044200     COPY DPWS500.                                                04420032
044300/                                                                 04430027
044400                                                                  04440027
044500*    DB2 AREA FOR PURCHASE ITEM TABLE                             04450027
044600                                                                  04460027
044700     EXEC SQL                                                     04470027
044800          INCLUDE TPURITM                                         04480027
044900     END-EXEC.                                                    04490027
045000                                                                  04500027
045100*    DB2 AREA FOR RECEIVER TABLE                                  04510027
045200     EXEC SQL                                                     04520027
045300          INCLUDE TRECEIV                                         04530027
045400     END-EXEC.                                                    04540027
045500                                                                  04550027
045600******************************************************************04560027
045700*    DB2 DCLGEN FOR RECEIVER DISTRIBUTION TABLE                   04570027
045800******************************************************************04580027
045900     EXEC SQL                                                     04590027
046000          INCLUDE TRECDIS                                         04600027
046100     END-EXEC.                                                    04610027
046200                                                                  04620027
046300*    DB2 AREA FOR TCOCNTL TABLE                                   04630027
046400     EXEC SQL                                                     04640027
046500          INCLUDE TCOCNTL                                         04650027
046600     END-EXEC.                                                    04660027
046700                                                                  04670027
046800*    DB2 AREA FOR RECEIPT ITEM TABLE                              04680027
046900     EXEC SQL                                                     04690027
047000          INCLUDE TRECITM                                         04700027
047100     END-EXEC.                                                    04710027
047200                                                                  04720027
047300*    DB2 AREA FOR TROUBLE NOTIFICATION                            04730027
047400     EXEC SQL                                                     04740027
047500          INCLUDE TTRBNTF                                         04750027
047600     END-EXEC.                                                    04760027
047700                                                                  04770027
047800*    DB2 AREA FOR TROUBLE DETAIL                                  04780027
047900     EXEC SQL                                                     04790027
048000          INCLUDE TTRBDTL                                         04800027
048100     END-EXEC.                                                    04810027
048200                                                                  04820027
048300*    DB2 AREA FOR TROUBLE REASON                                  04830027
048400     EXEC SQL                                                     04840027
048500          INCLUDE TTRBRSN                                         04850027
048600     END-EXEC.                                                    04860027
048700                                                                  04870027
048800*---------------------------------------------------------------* 04880027
048900*    DB2 AREA FOR PO AGREEMENT TABLE                            * 04890027
049000*---------------------------------------------------------------* 04900027
049100     EXEC SQL                                                     04910027
049200          INCLUDE TPOAGMT                                         04920027
049300     END-EXEC.                                                    04930027
049400                                                                  04940027
049500*----------------------------------------------------------------*04950027
049600*    INVENTORY PARAMETERS TABLE                                  *04960027
049700*----------------------------------------------------------------*04970027
049800     EXEC SQL                                                     04980027
049900          INCLUDE XLT00025                                        04990045
050000     END-EXEC.                                                    05000041
050100                                                                  05010027
050200*----------------------------------------------------------------*05020027
050300*    XLT_LOC TABLE                                               *05030034
050400*----------------------------------------------------------------*05040027
050500     EXEC SQL                                                     05050027
050600          INCLUDE XLT00010                                        05060034
050700     END-EXEC.                                                    05070027
050800                                                                  05080027
050900*----------------------------------------------------------------*05090037
051000*    PARAMETER TABLE                                             *05100037
051100*----------------------------------------------------------------*05110037
051200     EXEC SQL                                                     05120037
051300          INCLUDE TKRPRPM                                         05130037
051400     END-EXEC.                                                    05140037
051500                                                                  05150037
051510*----------------------------------------------------------------*05151055
051520*    INTEGRATION PARM TABLE - WST_INTGRTN_TYP                    *05152055
051530*----------------------------------------------------------------*05153055
051540     EXEC SQL                                                     05154055
051550          INCLUDE WST00008                                        05155055
051560     END-EXEC.                                                    05156055
051570                                                                  05157055
051580*----------------------------------------------------------------*05158055
051590*    INTEGRATION PARM ATTRIBUTE DEFINITION - WST_ATTR_DEFN       *05159055
051591*----------------------------------------------------------------*05159155
051592     EXEC SQL                                                     05159255
051593          INCLUDE WST00009                                        05159355
051594     END-EXEC.                                                    05159455
051595                                                                  05159555
051596*----------------------------------------------------------------*05159655
051597*    INTEGRATION PARM ATTRIBUTE ELEMENT - WST_ATTR_ELEM          *05159755
051598*----------------------------------------------------------------*05159855
051599     EXEC SQL                                                     05159955
051600          INCLUDE WST00010                                        05160055
051601     END-EXEC.                                                    05160155
051602                                                                  05160255
051603*----------------------------------------------------------------*05160355
051610*    DB2 AREA FOR COMMUNICATIONS                                  05161027
051620*----------------------------------------------------------------*05162055
051700     EXEC SQL                                                     05170027
051800          INCLUDE SQLCA                                           05180027
051900     END-EXEC.                                                    05190027
052000                                                                  05200037
052100******************************************************************05210027
052200*    DB2 CURSOR DEFINITION FOR RETRIEVAL OF RECEIVER DISTRIBUTION 05220027
052300******************************************************************05230027
052400     EXEC SQL                                                     05240027
052500          DECLARE RECDIS-CURSOR CURSOR FOR                        05250027
052600           SELECT ORD_LNE_NBR, OPER_UNT_ID, FCLTY_ID              05260027
052700             FROM TRECDIS                                         05270027
052800            WHERE ORD_NBR        = :DK-PO-NBR                     05280027
052900              AND REC_SEQ_NBR    = :DK-REC-SEQ-NBR                05290027
053000              AND STR_NBR        = :DK-STR-NBR                    05300027
053100              AND ORD_LNE_NBR BETWEEN :DK-PO-LINE-NBR-LOW         05310027
053200                                 AND  :DK-PO-LINE-NBR-HIGH        05320027
053300         ORDER BY ORD_LNE_NBR                                     05330027
053400     END-EXEC.                                                    05340027
053500                                                                  05350027
053600 LINKAGE SECTION.                                                 05360027
053700                                                                  05370027
053800 01  DFHCOMMAREA.                                                 05380027
053900     05  FILLER                         OCCURS  1 TO 4072 TIMES   05390027
054000                                        DEPENDING ON EIBCALEN.    05400027
054100         10  FILLER                     PIC X.                    05410027
054200                                                                  05420027
054300                                                                  05430027
054400 PROCEDURE DIVISION.                                              05440027
054500**-------------------------------------------------------------** 05450027
054600** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 05460027
054700** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 05470027
054800** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 05480027
054900**                                                             ** 05490027
055000** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 05500027
055100** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 05510027
055200**-------------------------------------------------------------** 05520027
055300 0000-MAIN-MODULE.                                                05530027
055400                                                                  05540027
055500     INITIALIZE DP030-CICS-API-FIELDS.                            05550027
055600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05560027
055700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05570027
055800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05580027
055900                                                                  05590027
056000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05600027
056100     MOVE LENGTH OF RC277AI        TO DP030-MAP-LENGTH (1).       05610027
056200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05620027
056300     PERFORM 0001-CALL-CICS-ARCH-API.                             05630027
056400                                                                  05640027
056500     PERFORM 1000-CONTROL-PROCESSING                              05650027
056600                                                                  05660027
056700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05670027
056800     PERFORM 0001-CALL-CICS-ARCH-API.                             05680027
056900                                                                  05690027
057000 0001-CALL-CICS-ARCH-API.                                         05700027
057100                                                                  05710027
057210     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05721059
057300                                    DFHCOMMAREA                   05730059
057400                                    DP030-CICS-API-FIELDS         05740059
057500                                    DP020-STANDARD-COMMAREA       05750059
057600                                    RC277AI.                      05760059
057700                                                                  05770027
057800     IF  DP030-RC-CALL-SUCCESSFUL                                 05780027
057900         CONTINUE                                                 05790027
058000     ELSE                                                         05800027
058100         SET DP013-NO-ROLLBACK                                    05810027
058200             DP013-XCTL-DISPLAY-RESTART                           05820027
058300             DP013-CICS-ABEND      TO TRUE                        05830027
058400         MOVE 'BEFORE 0000-MAIN-MODULE'                           05840027
058500                                   TO DP013-PARAGRAPH             05850027
058520         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN CODE O05852059
058530-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05853059
058800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05880027
058900         PERFORM DP013-0000-PROCESS-ABEND                         05890027
059000     END-IF.                                                      05900027
059100/                                                                 05910027
059200*----------------------------------------------------------------*05920027
059300*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *05930027
059400*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *05940027
059500*----------------------------------------------------------------*05950027
059600                                                                  05960027
059700 1000-CONTROL-PROCESSING.                                         05970027
059800                                                                  05980027
059900     EVALUATE TRUE                                                05990027
060000         WHEN DP020-NEXT-ACT-INITIAL                              06000027
060100              PERFORM 9400-DELETE-TRB-QUEUE                       06010027
060200              PERFORM 1100-FIND-OBJECT-KEYS                       06020027
060300              IF  PS-ERROR                                        06030027
060400                  CONTINUE                                        06040027
060500              ELSE                                                06050027
060600                  PERFORM 1200-MOVE-AND-EDIT-COMMAREA             06060027
060700                  IF  PS-ERROR                                    06070027
060800                      CONTINUE                                    06080027
060900                  ELSE                                            06090027
061000                      PERFORM 9400-DELETE-TRB-QUEUE               06100027
061100                      PERFORM 4000-BUILD-INITIAL-PANEL            06110027
061200                      PERFORM 3200-RESET-ATTRIBUTES               06120027
061300                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        06130027
061400                      SET DP030-SET-CURSOR-APPL-1 TO TRUE         06140027
061500                      MOVE -1          TO  ATRBRSNL               06150027
061600                      IF  SQLCODE = +100                          06160027
061700                          SET DP020-NEXT-ACT-APPL-ERROR TO TRUE   06170027
061800                          MOVE PC-TSYMSG-00148                    06180027
061900                                       TO  DP020-MSG-NUMBER       06190027
062000                          SET DP020-MSG-FATAL TO TRUE             06200027
062100                      END-IF                                      06210027
062200                  END-IF                                          06220027
062300              END-IF                                              06230027
062400                                                                  06240027
062500         WHEN DP020-NEXT-ACT-READ-MAP                             06250027
062600              IF RC017-TROUBLE-UPDATED                            06260027
062700                  PERFORM 2000-PROCESS-PANEL                      06270027
062800              ELSE                                                06280027
062900                  PERFORM 9400-DELETE-TRB-QUEUE                   06290027
063000                  PERFORM 2000-PROCESS-PANEL                      06300027
063100              END-IF                                              06310027
063200                                                                  06320027
063300         WHEN DP020-NEXT-ACT-RETURN                               06330027
063400              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                06340027
063500              PERFORM 9600-READ-TRB-QUEUE                         06350027
063600              IF TM003-UPDATE                                     06360027
063700                              OR RC017-TROUBLE-UPDATED            06370027
063800                      SET RC017-TROUBLE-UPDATED TO TRUE           06380027
063900                      PERFORM 3210-RESET-ATTRIBUTES               06390027
064000              END-IF                                              06400027
064100                                                                  06410027
064200         WHEN OTHER                                               06420027
064300              SET DP013-LOGIC-ABEND TO TRUE                       06430027
064400              SET DP013-NO-ROLLBACK TO TRUE                       06440027
064500              MOVE '1000-CONTROL-PROCESSING'                      06450027
064600                                   TO  DP013-PARAGRAPH            06460027
064700              MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'  06470027
064800                                   TO  DP013-MESSAGE-TEXT(1)      06480027
064900              MOVE DP020-NEXT-APPL-ACTIVITY                       06490027
065000                                   TO  DP013-MESSAGE-TEXT(2)      06500027
065100              PERFORM DP013-0000-PROCESS-ABEND                    06510027
065200     END-EVALUATE.                                                06520027
065300                                                                  06530027
065400*----------------------------------------------------------------*06540027
065500*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *06550027
065600*  INTER-APPLICATION FORMAT CODE.                                *06560027
065700*----------------------------------------------------------------*06570027
065800                                                                  06580027
065900 1100-FIND-OBJECT-KEYS.                                           06590027
066000                                                                  06600027
066100     INITIALIZE ASC-SPECIFIC-COMMAREA.                            06610027
066200     MOVE EIBTRMID         TO ASC-TRB-TERM-ID                     06620027
066300                              ASC-SEL-TERM-ID.                    06630027
066400     MOVE DP020-SRC-TASK-NUMBER                                   06640027
066500                           TO ASC-TRB-TASK-NUMBER                 06650027
066600                              ASC-SEL-TASK-NUMBER.                06660027
066700     MOVE PC-TRB-QUEUE-SEQ                                        06670027
066800                           TO ASC-TRB-SEQ.                        06680027
066900     MOVE PC-SEL-QUEUE-SEQ                                        06690027
067000                           TO ASC-SEL-SEQ.                        06700027
067100                                                                  06710027
067200      MOVE RC017-PO-NBR    TO  ASC-KEY-PO-NBR                     06720027
067300                               DK-PO-NBR                          06730027
067400      MOVE RC017-REC-SEQ-NBR                                      06740027
067500                           TO  ASC-KEY-REC-SEQ-NBR                06750027
067600                               DK-REC-SEQ-NBR                     06760027
067700      MOVE RC017-OPER-UNT-ID                                      06770027
067800                           TO  ASC-KEY-OPER-UNT-ID                06780027
067900      MOVE RC017-FCLTY-ID                                         06790027
068000                           TO  ASC-KEY-FCLTY-ID                   06800027
068100      MOVE RC017-STR-NBR   TO  DK-STR-NBR                         06810027
068200      IF (ASC-KEY-OPER-UNT-ID NOT GREATER THAN ZERO               06820027
068300      OR  ASC-KEY-FCLTY-ID    NOT GREATER THAN ZERO)              06830027
068400          MOVE PC-TSYMSG-00148 TO  DP020-MSG-NUMBER               06840027
068500          SET DP020-MSG-FATAL                                     06850027
068600              DP020-NEXT-ACT-APPL-ERROR                           06860027
068700                           TO TRUE                                06870027
068800      END-IF.                                                     06880027
068900                                                                  06890027
069000                                                                  06900027
069100*----------------------------------------------------------------*06910027
069200* ENTRY IS FROM A LIST.  GET THE MESSAGE NUMBER FROM THE TEMP    *06920027
069300* STORAGE QUEUE PASSED FROM THE LIST.                            *06930027
069400*----------------------------------------------------------------*06940027
069500                                                                  06950027
069600 1120-PREPARE-LIST-ENTRY.                                         06960027
069700                                                                  06970027
069800     MOVE RC013-MAX-ITEMS          TO ASC-SEL-SUB.                06980027
069900     MOVE ZERO                     TO ASC-SEL-ITEM.               06990027
070000     PERFORM 2110-GET-NEXT-LINE.                                  07000027
070100/                                                                 07010027
070200*----------------------------------------------------------------*07020027
070300* MOVE THE INTER-APPL COMMAREA TO A HOLD AREA AND PERFORM EDITS  *07030027
070400* ON DATA PASSED IN THE COMMAREA.                                *07040027
070500*----------------------------------------------------------------*07050027
070600                                                                  07060027
070700 1200-MOVE-AND-EDIT-COMMAREA.                                     07070027
070800                                                                  07080027
070900     MOVE INTER-APPL-COMM-AREA TO  ASC-HOLD-INTER-APPL.           07090027
071000                                                                  07100027
071100     IF ASC-KEY-OPER-UNT-ID EQUAL ZEROES                          07110027
071200         OR ASC-KEY-FCLTY-ID EQUAL ZEROES                         07120027
071300             SET DP020-NEXT-ACT-APPL-ERROR                        07130027
071400                 PS-ERROR                  TO  TRUE               07140027
071500             MOVE PC-TSYMSG-00815                                 07150027
071600                              TO  DP020-MSG-NUMBER                07160027
071700             SET DP020-MSG-FATAL TO TRUE                          07170027
071800     ELSE                                                         07180027
071900         IF ASC-KEY-PO-NBR EQUAL ZEROES                           07190027
072000             OR ASC-KEY-REC-SEQ-NBR EQUAL ZEROES                  07200027
072100                 SET DP020-NEXT-ACT-APPL-ERROR                    07210027
072200                     PS-ERROR                  TO  TRUE           07220027
072300                 MOVE PC-PO-AND-RCVR-REQUIRED-MSG                 07230027
072400                                  TO  DP020-MSG-MESSAGE           07240027
072500                 SET DP020-MSG-FATAL TO TRUE                      07250027
072600         END-IF                                                   07260027
072700     END-IF.                                                      07270027
072800                                                                  07280027
072900     IF  PS-NO-ERROR                                              07290027
073000         SET PS-RECEIVER-FOUND               TO TRUE              07300027
073100         PERFORM 3040-SELECT-TRECEIV                              07310027
073200         IF  PS-NO-RECEIVER-FOUND                                 07320027
073300             SET DP020-NEXT-ACT-APPL-ERROR                        07330027
073400                 PS-ERROR                    TO  TRUE             07340027
073500             MOVE PC-TSYMSG-00050            TO  DP020-MSG-MESSAGE07350027
073600             SET DP020-MSG-FATAL             TO TRUE              07360027
073700         END-IF                                                   07370027
073800     END-IF.                                                      07380027
073900                                                                  07390027
074000     IF  PS-NO-ERROR                                              07400027
074100         IF RC017-STR-NBR > 0                                     07410027
074200             SET PS-RECDIS-FOUND               TO TRUE            07420027
074300             IF  RC017-PO-LNE-NBR > 0                             07430027
074400                 MOVE RC017-PO-LNE-NBR    TO  DK-PO-LINE-NBR-LOW  07440027
074500                                              DK-PO-LINE-NBR-HIGH 07450027
074600             ELSE                                                 07460027
074700                 MOVE PC-0                TO  DK-PO-LINE-NBR-LOW  07470027
074800                 MOVE PC-9999             TO  DK-PO-LINE-NBR-HIGH 07480027
074900             END-IF                                               07490027
075000             PERFORM 3105-OPEN-TRECDIS                            07500027
075100                THRU 3105-OPEN-TRECDIS-EXIT                       07510027
075200             IF  PS-NO-RECDIS-FOUND                               07520027
075300                 SET DP020-NEXT-ACT-APPL-ERROR                    07530027
075400                     PS-ERROR              TO  TRUE               07540027
075500                 MOVE PC-TSYMSG-00050      TO  DP020-MSG-MESSAGE  07550027
075600                 SET DP020-MSG-FATAL       TO TRUE                07560027
075700             END-IF                                               07570027
075800         END-IF                                                   07580027
075900     END-IF.                                                      07590027
076000                                                                  07600027
076100     IF  PS-NO-ERROR                                              07610027
076200         IF  RECEIV-FS-POST-TMST = PC-DB2-DUMMY-DATE              07620027
076300             SET DP020-NEXT-ACT-APPL-ERROR                        07630027
076400                 PS-ERROR                    TO  TRUE             07640027
076500             MOVE PC-TSYMSG-01183            TO  DP020-MSG-MESSAGE07650027
076600             SET DP020-MSG-FATAL             TO TRUE              07660027
076700         END-IF                                                   07670027
076800     END-IF.                                                      07680027
076900                                                                  07690027
077000     IF  PS-NO-ERROR                                              07700027
077100         IF  RECEIV-AP-PRC-CDE NOT = PC-SPACE                     07710027
077200             SET DP020-NEXT-ACT-APPL-ERROR                        07720027
077300                 PS-ERROR                    TO  TRUE             07730027
077400             MOVE PC-TSYMSG-01184            TO  DP020-MSG-MESSAGE07740027
077500             SET DP020-MSG-FATAL             TO TRUE              07750027
077600         END-IF                                                   07760027
077700     END-IF.                                                      07770027
077800                                                                  07780027
077900     IF DP020-SRC-AID = DP016-PF17                                07790027
078000         CONTINUE                                                 07800027
078100     ELSE                                                         07810027
078200         IF  PS-NO-ERROR                                          07820027
078300             PERFORM 3045-SELECT-TCOCNTL                          07830027
078400             IF  PV-VFY-DATE-JULIAN = PV-COMP-DATE-JULIAN         07840027
078500             OR  PV-VFY-DATE-JULIAN > PV-COMP-DATE-JULIAN         07850027
078600                 CONTINUE                                         07860027
078700             ELSE                                                 07870027
078800                 SET DP020-NEXT-ACT-APPL-ERROR                    07880027
078900                     PS-ERROR              TO  TRUE               07890027
079000                 MOVE PC-TSYMSG-01185      TO  DP020-MSG-NUMBER   07900027
079100                 MOVE PV-INPUT-DATE        TO  DP020-MSG-TEXT     07910027
079200                 SET DP020-MSG-FATAL       TO TRUE                07920027
079300             END-IF                                               07930027
079400         END-IF                                                   07940027
079500     END-IF.                                                      07950027
079600     IF  PS-NO-ERROR                                              07960027
079700         IF RC017-STR-NBR > 0                                     07970027
079800             PERFORM 3100-CHECK-INVENTORY-TIMING                  07980027
079900             IF  PS-CANT-UPDATE                                   07990027
080000                 SET DP020-NEXT-ACT-APPL-ERROR                    08000027
080100                     PS-ERROR             TO  TRUE                08010027
080200                     MOVE PC-TSYMSG-01182  TO  DP020-MSG-MESSAGE  08020027
080300                     SET DP020-MSG-FATAL      TO TRUE             08030027
080400                     PERFORM 3106-WRITE-AUDIT-ROW                 08040027
080500                        THRU 3106-WRITE-AUDIT-ROW-EXIT            08050027
080600                     IF  PS-RECDIS-STORE-NOT-FOUND                08060027
080700                         MOVE PC-TSYMSG-00050                     08070027
080800                                     TO  DP020-MSG-MESSAGE        08080027
080900                     END-IF                                       08090027
081000                                                                  08100027
081100             END-IF                                               08110027
081200         END-IF                                                   08120027
081300     END-IF.                                                      08130027
081400                                                                  08140027
081500     IF  PS-NO-ERROR                                              08150027
081600         INITIALIZE PV-DB2-COUNT                                  08160027
081700         MOVE 4              TO DK-AGRMT-TYP-ID                   08170027
081800         MOVE 4              TO DK-TYP-CDE                        08180027
081900         PERFORM 3110-CHECK-FOR-PACK-BY-STORE                     08190027
082000         IF PV-DB2-COUNT > +0                                     08200027
082100             SET             RC017-PACK-BY-STORE TO TRUE          08210027
082200         ELSE                                                     08220027
082300             SET             RC017-NOT-PACK-BY-STORE TO TRUE      08230027
082400         END-IF                                                   08240027
082500     END-IF.                                                      08250027
082600     IF  PS-NO-ERROR                                              08260027
082700         PERFORM 1250-GET-FISCAL-PERIODS                          08270027
082800         IF PV-TODAYS-FISCAL-PERIOD NOT =                         08280047
082900                                     PV-VERIFY-FISCAL-PERIOD      08290047
083000             SET DP020-NEXT-ACT-APPL-ERROR                        08300027
083100                 PS-ERROR              TO  TRUE                   08310027
083200             MOVE PC-TSYMSG-01445      TO  DP020-MSG-NUMBER       08320027
083300             SET DP020-MSG-FATAL       TO TRUE                    08330027
083400         END-IF                                                   08340027
083500     END-IF.                                                      08350027
083600/                                                                 08360027
083700 1250-GET-FISCAL-PERIODS.                                         08370027
083800******************************************************************08380027
083900*    THIS PARAGRAPH RETREIVES THE FISCAL PERIODS OF THE CURRENT   08390027
084000*    DATE AND THE RECEIVER VERIFIED DATE.                         08400027
084100******************************************************************08410027
084200                                                                  08420027
084300     MOVE PV-CURRENT-TIMESTAMP       TO PV-WORK-TMST.             08430049
084400     MOVE PV-WK-CCYY                 TO PV-LK-DTE-CCYY.           08440027
084500     MOVE PV-WK-MO                   TO PV-LK-DTE-MO              08450027
084600     MOVE PV-WK-DA                   TO PV-LK-DTE-DD              08460027
084700                                                                  08470027
084800     INITIALIZE  DPG51 DPG52                                      08480030
084900                 DPG53 DPG54                                      08490030
085000                 DPG55 DPG56.                                     08500030
085100                                                                  08510030
085200     MOVE PV-LK-DTE-ISO              TO DPG52-LK-DATE-INPUT.      08520027
085300                                                                  08530027
085400     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     08540027
085500     SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                     08550027
085600     SET DPG52-LK-DTE-ISO            TO TRUE.                     08560027
085700                                                                  08570027
085800*    CALL 'DPKUT500' USING DPG51 DPG52                            08580029
085900*                          DPG53 DPG54                            08590029
086000*                          DPG55 DPG56.                           08600029
086100     MOVE '1250-GET-FISCAL-PERIODS'                               08610029
086200       TO PV-FROM-PARAGRAPH.                                      08620029
086300     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          08630029
086400                                                                  08640027
086500     MOVE DPG56-FISCAL-PERIOD-NBR    TO PV-TODAYS-FISCAL-PERIOD.  08650027
086600                                                                  08660027
086700     MOVE RECEIV-VERFYD-TMST         TO PV-WORK-TMST.             08670049
086800     MOVE PV-WK-CCYY                 TO PV-LK-DTE-CCYY.           08680027
086900     MOVE PV-WK-MO                   TO PV-LK-DTE-MO              08690027
087000     MOVE PV-WK-DA                   TO PV-LK-DTE-DD              08700027
087100                                                                  08710030
087200     INITIALIZE  DPG51 DPG52                                      08720030
087300                 DPG53 DPG54                                      08730030
087400                 DPG55 DPG56.                                     08740030
087500                                                                  08750027
087600     MOVE PV-LK-DTE-ISO              TO DPG52-LK-DATE-INPUT.      08760027
087700                                                                  08770027
087800     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     08780027
087900     SET DPG51-FISCAL-454-CALENDAR   TO TRUE.                     08790027
088000     SET DPG52-LK-DTE-ISO            TO TRUE.                     08800027
088100                                                                  08810027
088200*    CALL 'DPKUT500' USING DPG51 DPG52                            08820029
088300*                          DPG53 DPG54                            08830029
088400*                          DPG55 DPG56.                           08840029
088500     MOVE '1250-GET-FISCAL-PERIODS'                               08850029
088600       TO PV-FROM-PARAGRAPH.                                      08860029
088700     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          08870029
088800                                                                  08880027
088900     MOVE DPG56-FISCAL-PERIOD-NBR    TO PV-VERIFY-FISCAL-PERIOD.  08890027
089000                                                                  08900027
089100                                                                  08910027
089200 3100-CHECK-INVENTORY-TIMING.                                     08920027
089300     SET PS-CAN-UPDATE                  TO TRUE.                  08930027
089400     PERFORM 4013-GET-STORE-TYPE.                                 08940027
089500     PERFORM 4200A-READ-DC-FLUSH-PARM.                            08950039
089600     IF PS-DC-FLUSH-YES                                           08960039
089700         PERFORM 4200-READ-INV-PARM                               08970037
089800         IF PS-INV-STORE-FOUND                                    08980037
089900             PERFORM 2175-FMT-CUTOFF-DTS-FOR-CMPARE               08990037
090000             PERFORM 2176-COMPARE-DATES                           09000037
090100         ELSE                                                     09010037
090200             CONTINUE                                             09020037
090300         END-IF                                                   09030039
090400     END-IF.                                                      09040037
090500 3100-EXIT.                                                       09050027
090600     EXIT.                                                        09060027
090700 3105-OPEN-TRECDIS.                                               09070027
090800***** OPEN-CURSOR.                                                09080027
090900                                                                  09090027
091000     EXEC SQL                                                     09100027
091100          OPEN RECDIS-CURSOR                                      09110027
091200     END-EXEC                                                     09120027
091300                                                                  09130027
091400     EVALUATE TRUE                                                09140027
091500         WHEN SQLCODE = ZERO                                      09150027
091600              CONTINUE                                            09160027
091700         WHEN SQLCODE = -904                                      09170027
091800         WHEN SQLCODE = -911                                      09180027
091900         WHEN SQLCODE = -913                                      09190027
092000             PERFORM 9900-SOFT-ABORT                              09200027
092100         WHEN SQLWARN0 NOT = SPACES                               09210027
092200         WHEN SQLCODE      NOT = ZERO                             09220027
092300              MOVE '3105-OPEN-RECDIS'                             09230027
092400                             TO DP013-PARAGRAPH                   09240027
092500              MOVE 'UNSUCCESSFUL RECDIS CURSOR OPEN'              09250027
092600                             TO DP013-MESSAGE-TEXT (1)            09260027
092700              MOVE SQLCA         TO DP013-SQLCA                   09270027
092800              MOVE 'TRECDIS' TO DP013-DB2-TABLE-NAME (1)          09280027
092900              SET DP013-XCTL-DISPLAY-RESTART                      09290027
093000                  DP013-DB2-ABEND                                 09300027
093100                             TO TRUE                              09310027
093200                                                                  09320027
093300              PERFORM DP013-0000-PROCESS-ABEND                    09330027
093400     END-EVALUATE.                                                09340027
093500***** FETCH-RECDIS.                                               09350027
093600                                                                  09360027
093700     EXEC SQL                                                     09370027
093800          FETCH  RECDIS-CURSOR                                    09380027
093900           INTO :RECDIS-ORD-LNE-NBR,                              09390027
094000                :RECDIS-OPER-UNT-ID,                              09400027
094100                :RECDIS-FCLTY-ID                                  09410027
094200     END-EXEC.                                                    09420027
094300                                                                  09430027
094400     EVALUATE TRUE                                                09440027
094500         WHEN SQLCODE = ZERO                                      09450027
094600              CONTINUE                                            09460027
094700         WHEN SQLCODE = +100                                      09470027
094800                  SET PS-NO-RECDIS-FOUND        TO TRUE           09480027
094900                  SET PS-RECDIS-STORE-NOT-FOUND TO TRUE           09490027
095000         WHEN SQLCODE = -904                                      09500027
095100         WHEN SQLCODE = -911                                      09510027
095200         WHEN SQLCODE = -913                                      09520027
095300             PERFORM 9900-SOFT-ABORT                              09530027
095400         WHEN SQLWARN0 NOT = SPACES                               09540027
095500         WHEN SQLCODE  NOT = ZERO                                 09550027
095600              MOVE '3105-WRTAUDIT-ROW-FETCH-RECDIS'               09560027
095700                                 TO DP013-PARAGRAPH               09570027
095800              MOVE 'UNSUCCESSFUL FETCH OF RECDIS CURSOR'          09580027
095900                                 TO DP013-MESSAGE-TEXT (1)        09590027
096000              MOVE SQLCA         TO DP013-SQLCA                   09600027
096100              MOVE 'TRECDIS'     TO DP013-DB2-TABLE-NAME (1)      09610027
096200              SET DP013-DB2-ABEND                                 09620027
096300                  DP013-XCTL-DISPLAY-RESTART                      09630027
096400                                 TO TRUE                          09640027
096500                                                                  09650027
096600              PERFORM DP013-0000-PROCESS-ABEND                    09660027
096700     END-EVALUATE.                                                09670027
096800                                                                  09680027
096900***** CLOSE-CURSOR.                                               09690027
097000                                                                  09700027
097100     EXEC SQL                                                     09710027
097200          CLOSE RECDIS-CURSOR                                     09720027
097300     END-EXEC.                                                    09730027
097400                                                                  09740027
097500     EVALUATE TRUE                                                09750027
097600         WHEN SQLCODE = ZERO                                      09760027
097700              CONTINUE                                            09770027
097800         WHEN SQLCODE = -904                                      09780027
097900         WHEN SQLCODE = -911                                      09790027
098000         WHEN SQLCODE = -913                                      09800027
098100             PERFORM 9900-SOFT-ABORT                              09810027
098200         WHEN SQLWARN0 NOT = SPACES                               09820027
098300         WHEN SQLCODE  NOT = ZERO                                 09830027
098400              MOVE '3105-WRITE-AUDIT-ROW-CLOSE-CSR'               09840027
098500                                 TO DP013-PARAGRAPH               09850027
098600              MOVE 'UNSUCCESSFUL RECDIS CURSOR CLOSE'             09860027
098700                                 TO DP013-MESSAGE-TEXT (1)        09870027
098800              MOVE SQLCA         TO DP013-SQLCA                   09880027
098900              MOVE 'TRECDIS '    TO DP013-DB2-TABLE-NAME (1)      09890027
099000              SET DP013-DB2-ABEND                                 09900027
099100                  DP013-XCTL-DISPLAY-RESTART                      09910027
099200                                 TO TRUE                          09920027
099300                                                                  09930027
099400              PERFORM DP013-0000-PROCESS-ABEND                    09940027
099500     END-EVALUATE.                                                09950027
099600 3105-OPEN-TRECDIS-EXIT.                                          09960027
099700     EXIT.                                                        09970027
099800                                                                  09980027
099900                                                                  09990027
100000 3106-WRITE-AUDIT-ROW.                                            10000027
100100***** ADD-TO-RECD-AUDIT-BEFORE.                                   10010027
100200     IF PS-RECDIS-STORE-FOUND THEN                                10020027
100300         MOVE 'D'                  TO RC031-TABLE-TO-AUDIT        10030027
100400         MOVE 'B'                  TO RC031-AUD-TYP-CDE           10040027
100500         MOVE 'T'                  TO RC031-AUD-FUNC-CDE          10050027
100600         MOVE DK-PO-NBR            TO RC031-PO-NBR                10060027
100700         MOVE RECDIS-ORD-LNE-NBR                                  10070027
100800                                   TO RC031-PO-LNE-NBR            10080027
100900         MOVE DK-REC-SEQ-NBR                                      10090027
101000                                   TO RC031-REC-SEQ-NBR           10100027
101100         MOVE RECDIS-OPER-UNT-ID                                  10110027
101200                                   TO RC031-OPER-UNT-ID           10120027
101300         MOVE RECDIS-FCLTY-ID      TO RC031-FCLTY-ID              10130027
101400         MOVE DK-STR-NBR           TO RC031-STR-NBR               10140027
101500         MOVE DP020-USERID         TO RC031-UPD-UID               10150027
101600         MOVE PC-CURRENT-PROGRAM-NAME TO RC031-UPD-PGM-ID         10160027
101700         MOVE PV-CURRENT-TIMESTAMP TO RC031-UPD-TMST              10170027
101800         MOVE ZEROES               TO RC031-NOTIF-NBR             10180027
101900         MOVE ZEROES               TO RC031-ADJ-CYC-NBR           10190027
102000         EXEC CICS                                                10200027
102100             LINK PROGRAM  (PC-AUDIT-RTN)                         10210027
102200                  COMMAREA (RC031-FIELDS)                         10220027
102300                  LENGTH   (PC-AUDIT-RTN-LENGTH)                  10230027
102400         END-EXEC                                                 10240027
102500         EVALUATE TRUE                                            10250027
102600             WHEN RC031-CALL-SUCCESSFUL                           10260027
102700                 CONTINUE                                         10270027
102800                                                                  10280027
102900             WHEN OTHER                                           10290027
103000                  MOVE 'ADD-TO-RECD-AUDIT-BEFORE'                 10300027
103100                                    TO DP013-PARAGRAPH            10310027
103200                  MOVE 'UNSUCCESSFUL CALL TO AUDIT RTN'           10320027
103300                                TO DP013-MESSAGE-TEXT (1)         10330027
103400                  MOVE RC031-RETURN-DESC                          10340027
103500                                TO DP013-MESSAGE-TEXT (2)         10350027
103600                  MOVE RC031-SQLCA      TO DP013-SQLCA            10360027
103700                  SET DP013-DB2-ABEND                             10370027
103800                      DP013-XCTL-DISPLAY-RESTART                  10380027
103900                                    TO TRUE                       10390027
104000                  PERFORM DP013-0000-PROCESS-ABEND                10400027
104100         END-EVALUATE                                             10410027
104200     END-IF.                                                      10420027
104300 3106-WRITE-AUDIT-ROW-EXIT.                                       10430027
104400     EXIT.                                                        10440027
104500                                                                  10450027
104600 2176-COMPARE-DATES.                                              10460027
104700     IF ASC-DC-STORE-TYPE                                         10470027
104800          IF ((PV-VERIFY-DTE-YYYYMMDD < PV-ACTL-CTOFF-YYYYMMDD    10480027
104900          OR  PV-VERIFY-DTE-YYYYMMDD = PV-ACTL-CTOFF-YYYYMMDD)    10490027
105000          AND PV-CURRENT-DTE-YYYYMMDD > PV-ACTL-CTOFF-YYYYMMDD)   10500027
105100              SET PS-CANT-UPDATE TO TRUE                          10510027
105200          END-IF                                                  10520027
105300      END-IF.                                                     10530027
105400     IF ASC-NOT-DC-STORE-TYPE                                     10540027
105500         IF ((PV-RECEIPT-DTE-YYYYMMDD < PV-ACTL-CTOFF-YYYYMMDD    10550027
105600         OR  PV-RECEIPT-DTE-YYYYMMDD  =   PV-ACTL-CTOFF-YYYYMMDD) 10560027
105700         AND PV-CURRENT-DTE-YYYYMMDD > PV-ACTL-CTOFF-YYYYMMDD)    10570027
105800              SET PS-CANT-UPDATE TO TRUE                          10580027
105900          END-IF                                                  10590027
106000      END-IF.                                                     10600027
106100 2176-EXIT.                                                       10610027
106200     EXIT.                                                        10620027
106300/                                                                 10630027
106400*----------------------------------------------------------------*10640027
106500*    CHECK FOR PACK BY STORE ORDER                               *10650027
106600*----------------------------------------------------------------*10660027
106700 3110-CHECK-FOR-PACK-BY-STORE.                                    10670027
106800                                                                  10680027
106900         EXEC SQL                                                 10690027
107000              SELECT COUNT(*)                                     10700027
107100                INTO :PV-DB2-COUNT                                10710027
107200                FROM TPOAGMT                                      10720027
107300               WHERE PO_NBR         = :DK-PO-NBR                  10730027
107400                 AND AGRMT_TYP_ID   = :DK-AGRMT-TYP-ID            10740027
107500                 AND VER_STATUS_CDE = 'A'                         10750027
107600                 AND TYP_CDE        = :DK-TYP-CDE                 10760027
107700         END-EXEC                                                 10770027
107800                                                                  10780027
107900                                                                  10790027
108000     EVALUATE TRUE                                                10800027
108100         WHEN SQLCODE = ZERO                                      10810027
108200              CONTINUE                                            10820027
108300         WHEN SQLCODE = +100                                      10830027
108400              CONTINUE                                            10840027
108500         WHEN SQLCODE = -904                                      10850027
108600         WHEN SQLCODE = -913                                      10860027
108700              PERFORM 9900-SOFT-ABORT                             10870027
108800         WHEN SQLWARN0 NOT = SPACES                               10880027
108900         WHEN SQLCODE NOT EQUAL ZERO                              10890027
109000              MOVE '3110-CHECK-FOR-PACK-BY-STORE'                 10900027
109100                                   TO DP013-PARAGRAPH             10910027
109200              MOVE 'UNSUCCESSFUL SELECT PURCHASE AGREEMENT'       10920027
109300                                   TO DP013-MESSAGE-TEXT (1)      10930027
109400              MOVE SQLCA           TO DP013-SQLCA                 10940027
109500              MOVE 'TPOAGMT'       TO DP013-DB2-TABLE-NAME (1)    10950027
109600              SET DP013-DB2-ABEND                                 10960027
109700                 DP013-XCTL-DISPLAY-RESTART                       10970027
109800                                   TO TRUE                        10980027
109900              PERFORM DP013-0000-PROCESS-ABEND                    10990027
110000     END-EVALUATE.                                                11000027
110100                                                                  11010027
110200*----------------------------------------------------------------*11020027
110300*    CHECK TO SEE IF THE RECEIVER EXISTS.  FETCH THE RECEIVER    *11030027
110400*    STATUS CODE TO DETERMINE IF THE RECEIVER HAS BEEN VERIFIED. *11040027
110500*----------------------------------------------------------------*11050027
110600                                                                  11060027
110700 1300-COUNT-TRECEIV.                                              11070027
110800                                                                  11080027
110900     INITIALIZE DCLTRECEIV.                                       11090027
111000                                                                  11100027
111100     EXEC SQL                                                     11110027
111200         SELECT                                                   11120027
111300                 COUNT (*)                                        11130027
111400         INTO                                                     11140027
111500                :PV-DB2-COUNT                                     11150027
111600         FROM                                                     11160027
111700                 TRECEIV                                          11170027
111800         WHERE                                                    11180027
111900                 OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID       11190027
112000          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          11200027
112100          AND    ORD_NBR            =  :ASC-KEY-PO-NBR            11210027
112200          AND    REC_SEQ_NBR        =  :ASC-KEY-REC-SEQ-NBR       11220027
112300          AND    VER_STATUS_CDE     =  :PC-ACTIVE-STATUS          11230027
112400     END-EXEC.                                                    11240027
112500                                                                  11250027
112600     EVALUATE TRUE                                                11260027
112700         WHEN SQLCODE = ZERO                                      11270027
112800         WHEN SQLCODE = -305                                      11280027
112900         WHEN SQLCODE = +100                                      11290027
113000              CONTINUE                                            11300027
113100         WHEN SQLCODE = -904                                      11310027
113200         WHEN SQLCODE = -913                                      11320027
113300              PERFORM 9900-SOFT-ABORT                             11330027
113400         WHEN SQLWARN0 NOT = SPACES                               11340027
113500         WHEN SQLCODE NOT EQUAL ZERO                              11350027
113600              MOVE '1300-COUNT-TRECEIV'                           11360027
113700                                   TO DP013-PARAGRAPH             11370027
113800              MOVE 'SELECT RECEIVER INFORMATION'                  11380027
113900                                   TO DP013-MESSAGE-TEXT (1)      11390027
114000              MOVE SQLCA           TO DP013-SQLCA                 11400027
114100              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    11410027
114200              SET DP013-DB2-ABEND                                 11420027
114300                 DP013-XCTL-DISPLAY-RESTART                       11430027
114400                                   TO TRUE                        11440027
114500              PERFORM DP013-0000-PROCESS-ABEND                    11450027
114600     END-EVALUATE.                                                11460027
114700/                                                                 11470027
114800*----------------------------------------------------------------*11480027
114900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *11490027
115000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *11500027
115100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *11510027
115200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *11520027
115300* FUNCTION KEYS CAN GET THIS FAR.                                *11530027
115400*----------------------------------------------------------------*11540027
115500                                                                  11550027
115600 2000-PROCESS-PANEL.                                              11560027
115700                                                                  11570027
115800     EVALUATE TRUE                                                11580027
115900                                                                  11590027
116000         WHEN DP020-SRC-AID = DP016-CLEAR                         11600027
116100              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 11610027
116200              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  11620027
116300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                11630027
116400                                                                  11640027
116500         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     11650027
116600              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 11660027
116700              IF TM003-UPDATE                                     11670027
116800                              OR RC017-TROUBLE-UPDATED            11680027
116900                      SET RC017-TROUBLE-UPDATED TO TRUE           11690027
117000                      PERFORM 3210-RESET-ATTRIBUTES               11700027
117100                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        11710027
117200                      MOVE -1              TO  ATRBRSNL           11720027
117300              ELSE                                                11730027
117400                  SET DP030-DONT-ERASE                            11740027
117500                      DP030-SEND-DATAONLY (PC-APPL-MAP)           11750027
117600                                       TO TRUE                    11760027
117700                  INITIALIZE ASC-SCREEN-ENTERABLE-FIELDS          11770027
117800                  IF  ASC-USE-SELECTION-QUEUE                     11780027
117900                      MOVE RC013-MAX-ITEMS TO ASC-SEL-SUB         11790027
118000                      MOVE ZERO            TO ASC-SEL-ITEM        11800027
118100                      PERFORM 2110-GET-NEXT-LINE                  11810027
118200                  END-IF                                          11820027
118300                  PERFORM 4000-BUILD-INITIAL-PANEL                11830027
118400                  PERFORM 3200-RESET-ATTRIBUTES                   11840027
118500                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            11850027
118600              END-IF                                              11860027
118700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             11870027
118800              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 11880027
118900              IF  ASC-USE-SELECTION-QUEUE                         11890027
119000                  PERFORM 2110-GET-NEXT-LINE                      11900027
119100                  PERFORM 4000-BUILD-INITIAL-PANEL                11910027
119200                  PERFORM 3200-RESET-ATTRIBUTES                   11920027
119300                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            11930027
119400              ELSE                                                11940027
119500*                 --- BOTTOM OF LIST ---                          11950027
119600                  MOVE PC-TSYMSG-00070                            11960027
119700                                   TO DP020-MSG-NUMBER            11970027
119800                  SET DP020-MSG-INFORMATIONAL                     11980027
119900                                   TO TRUE                        11990027
120000              END-IF                                              12000027
120100                                                                  12010027
120200         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             12020027
120300              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 12030027
120400              IF  ASC-USE-SELECTION-QUEUE                         12040027
120500                  PERFORM 2120-GET-PREV-LINE                      12050027
120600                  PERFORM 4000-BUILD-INITIAL-PANEL                12060027
120700                  PERFORM 3200-RESET-ATTRIBUTES                   12070027
120800                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            12080027
120900              ELSE                                                12090027
121000*                 --- TOP OF LIST ---                             12100027
121100                  MOVE PC-TSYMSG-00069                            12110027
121200                                   TO DP020-MSG-NUMBER            12120027
121300                  SET DP020-MSG-INFORMATIONAL                     12130027
121400                                   TO TRUE                        12140027
121500              END-IF                                              12150027
121600                                                                  12160027
121700         WHEN OTHER                                               12170027
121800              PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                12180027
121900              PERFORM 3000-EDIT-DATA-IN-COMMAREA                  12190027
122000              IF  PS-NO-ERROR                                     12200027
122100                  SET DP030-CONTINUE-GO                           12210027
122200                                   TO TRUE                        12220027
122300                  PERFORM 2100-CHECK-FUNCTION-KEY                 12230027
122400              ELSE                                                12240027
122500                  PERFORM 4400-MOVE-COMMAREA-TO-SCREEN            12250027
122600                  SET DP030-OVERRIDE-GO                           12260027
122700                                   TO TRUE                        12270027
122800              END-IF                                              12280027
122900     END-EVALUATE.                                                12290027
123000                                                                  12300027
123100*----------------------------------------------------------------*12310027
123200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *12320027
123300* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *12330027
123400* FROM THE CICS ARCHITECTURE API.                                *12340027
123500*----------------------------------------------------------------*12350027
123600                                                                  12360027
123700 2100-CHECK-FUNCTION-KEY.                                         12370027
123800                                                                  12380027
123900     EVALUATE TRUE                                                12390027
124000         WHEN DP020-SRC-AID = DP016-ENTER                         12400027
124100              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 12410027
124200              IF TM003-UPDATE                                     12420027
124300                              OR RC017-TROUBLE-UPDATED            12430027
124400                      SET RC017-TROUBLE-UPDATED TO TRUE           12440027
124500                      PERFORM 3210-RESET-ATTRIBUTES               12450027
124600              END-IF                                              12460027
124700              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                12470027
124800                                                                  12480027
124900         WHEN DP020-SRC-AID = DP016-PF17                          12490027
125000                  PERFORM 5000-BEGIN-CREATE-PROCESS               12500027
125100                  IF  PS-NO-ERROR                                 12510027
125200                      CONTINUE                                    12520027
125300                  ELSE                                            12530027
125400                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12540027
125500                  END-IF                                          12550027
125600                                                                  12560027
125700         WHEN DP020-SRC-AID = DP016-PF18                          12570027
125800              SET ASC-NO-CONFIRM-REQUIRED TO TRUE                 12580027
125900              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                12590027
126000                                                                  12600027
126100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              12610027
126200              SET ASC-NO-CONFIRM-REQUIRED                         12620027
126300                  DP030-CONTINUE-GO TO TRUE                       12630027
126400*             MUST CONFIRM BEFORE UPDATE                          12640027
126500              MOVE PC-TSYMSG-00004 TO DP020-MSG-NUMBER            12650027
126600              SET DP020-MSG-INFORMATIONAL                         12660027
126700                  ASC-CONFIRM-REQUIRED TO TRUE                    12670027
126800                                                                  12680027
126900         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    12690027
127000              IF  ASC-NO-CONFIRM-REQUIRED                         12700027
127100                  MOVE PC-TSYMSG-00016 TO DP020-MSG-NUMBER        12710027
127200                  SET PS-ERROR                                    12720027
127300                      DP020-MSG-FATAL  TO TRUE                    12730027
127400              ELSE                                                12740027
127500                  SET DP030-CONTINUE-GO TO TRUE                   12750027
127600                  PERFORM 5000-BEGIN-CREATE-PROCESS               12760027
127700                  IF  PS-NO-ERROR                                 12770027
127800                      CONTINUE                                    12780027
127900*                     UPDATE SUCCESSFUL                           12790027
128000                  ELSE                                            12800027
128100                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        12810027
128200                  END-IF                                          12820027
128300              END-IF                                              12830027
128400                                                                  12840027
128500         WHEN OTHER                                               12850027
128600              SET DP013-NO-ROLLBACK                               12860027
128700                  DP013-XCTL-DISPLAY-RESTART                      12870027
128800                  DP013-CICS-ABEND  TO TRUE                       12880027
128900              MOVE '2000-PROCESS-PANEL'                           12890027
129000                                   TO DP013-PARAGRAPH             12900027
129100              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'     12910027
129200                                   TO DP013-MESSAGE-TEXT (1)      12920027
129300              PERFORM DP013-0000-PROCESS-ABEND                    12930027
129400     END-EVALUATE.                                                12940027
129500                                                                  12950027
129600*----------------------------------------------------------------*12960027
129700*    RETRIEVE THE NEXT KEY FOR PROCESSING.                       *12970027
129800*----------------------------------------------------------------*12980027
129900                                                                  12990027
130000 2110-GET-NEXT-LINE.                                              13000027
130100                                                                  13010027
130200     ADD +1                        TO  ASC-SEL-SUB.               13020027
130300     IF  ASC-SEL-SUB > RC013-MAX-ITEMS                            13030027
130400         ADD +1                    TO  ASC-SEL-ITEM               13040027
130500         MOVE +1                   TO  ASC-SEL-SUB                13050027
130600     END-IF.                                                      13060027
130700                                                                  13070027
130800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                13080027
130900         PERFORM 9100-READ-SEL-QUEUE                              13090027
131000         IF  RC013-ITEM (ASC-SEL-SUB) > ZERO                      13100027
131100             MOVE RC013-PO-NBR(ASC-SEL-SUB)                       13110027
131200                                   TO  ASC-KEY-PO-NBR             13120027
131300             MOVE RC013-PKSL-LNE-NBR-N(ASC-SEL-SUB)               13130027
131400                                   TO  ASC-KEY-PO-LNE-NBR         13140027
131500             MOVE RC013-REC-SEQ-NBR(ASC-SEL-SUB)                  13150027
131600                                   TO  ASC-KEY-REC-SEQ-NBR        13160027
131700             SET RC013-INQ (ASC-SEL-SUB)                          13170027
131800                                   TO  TRUE                       13180027
131900             PERFORM 9200-REWRITE-SEL-QUEUE                       13190027
132000         ELSE                                                     13200027
132100             SUBTRACT +1 FROM ASC-SEL-SUB                         13210027
132200*            --- BOTTOM OF LIST ---                               13220027
132300             MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER           13230027
132400             SET DP020-MSG-INFORMATIONAL                          13240027
132500                                   TO  TRUE                       13250027
132600         END-IF                                                   13260027
132700     ELSE                                                         13270027
132800         SUBTRACT +1 FROM ASC-SEL-ITEM                            13280027
132900         MOVE RC013-MAX-ITEMS      TO  ASC-SEL-SUB                13290027
133000         MOVE PC-TSYMSG-00070      TO  DP020-MSG-NUMBER           13300027
133100         SET DP020-MSG-INFORMATIONAL                              13310027
133200                                   TO  TRUE                       13320027
133300     END-IF.                                                      13330027
133400                                                                  13340027
133500*----------------------------------------------------------------*13350027
133600*  GET THE MESSAGE NUMBER (KEY) OF THE PREVIOUS SELECTED         *13360027
133700*  OBJECT FROM THE SELECTED-ITEMS TEMP. STORAGE QUEUE.           *13370027
133800*----------------------------------------------------------------*13380027
133900                                                                  13390027
134000 2120-GET-PREV-LINE.                                              13400027
134100                                                                  13410027
134200     SUBTRACT +1 FROM ASC-SEL-SUB.                                13420027
134300     IF  ASC-SEL-SUB < +1                                         13430027
134400         SUBTRACT +1 FROM ASC-SEL-ITEM                            13440027
134500         MOVE RC013-MAX-ITEMS      TO ASC-SEL-SUB                 13450027
134600     END-IF.                                                      13460027
134700                                                                  13470027
134800     IF  ASC-SEL-ITEM > ZERO                                      13480027
134900         PERFORM 9100-READ-SEL-QUEUE                              13490027
135000         MOVE RC013-PO-NBR(ASC-SEL-SUB)                           13500027
135100                                   TO  ASC-KEY-PO-NBR             13510027
135200         MOVE RC013-PKSL-LNE-NBR-N(ASC-SEL-SUB)                   13520027
135300                                   TO  ASC-KEY-PO-LNE-NBR         13530027
135400         MOVE RC013-REC-SEQ-NBR(ASC-SEL-SUB)                      13540027
135500                                   TO  ASC-KEY-REC-SEQ-NBR        13550027
135600         SET RC013-INQ (ASC-SEL-SUB)                              13560027
135700                                   TO  TRUE                       13570027
135800     ELSE                                                         13580027
135900         MOVE +1                   TO ASC-SEL-ITEM                13590027
136000                                      ASC-SEL-SUB                 13600027
136100*        --- TOP OF LIST ---                                      13610027
136200         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13620027
136300         SET DP020-MSG-INFORMATIONAL                              13630027
136400                                   TO TRUE                        13640027
136500     END-IF.                                                      13650027
136600/                                                                 13660027
136700*----------------------------------------------------------------*13670027
136800* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *13680027
136900* IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *13690027
137000* THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *13700027
137100*----------------------------------------------------------------*13710027
137200                                                                  13720027
137300 2200-MOVE-SCREEN-TO-COMMAREA.                                    13730027
137400                                                                  13740027
137500     IF  ATRBRSNL > ZERO                                          13750027
137600         MOVE ATRBRSNI             TO  ASC-TRBL-RSN-CDE-X         13760027
137700         SET ASC-RSN-CDE-ENTERED    TO  TRUE                      13770027
137800     ELSE                                                         13780027
137900         IF  ATRBRSNF = DP015-ERASE-EOF                           13790027
138000             SET ASC-TRBL-RSN-CDE-OK                              13800027
138100                                   TO  TRUE                       13810027
138200             MOVE ZEROES           TO  ASC-TRBL-RSN-CDE           13820027
138300         END-IF                                                   13830027
138400     END-IF.                                                      13840027
138500                                                                  13850027
138600     IF  ATEXT1L > ZERO                                           13860027
138700         MOVE ATEXT1I              TO  ASC-TEXT1                  13870027
138800     ELSE                                                         13880027
138900         IF  ATEXT1F  = DP015-ERASE-EOF                           13890027
139000             MOVE SPACE            TO  ASC-TEXT1                  13900027
139100         END-IF                                                   13910027
139200     END-IF.                                                      13920027
139300                                                                  13930027
139400     IF  ATEXT2L > ZERO                                           13940027
139500         MOVE ATEXT2I              TO  ASC-TEXT2                  13950027
139600     ELSE                                                         13960027
139700         IF  ATEXT2F  = DP015-ERASE-EOF                           13970027
139800             MOVE SPACE            TO  ASC-TEXT2                  13980027
139900         END-IF                                                   13990027
140000     END-IF.                                                      14000027
140100                                                                  14010027
140200     IF  ATEXT3L > ZERO                                           14020027
140300         MOVE ATEXT3I              TO  ASC-TEXT3                  14030027
140400     ELSE                                                         14040027
140500         IF  ATEXT3F  = DP015-ERASE-EOF                           14050027
140600             MOVE SPACE            TO  ASC-TEXT3                  14060027
140700         END-IF                                                   14070027
140800     END-IF.                                                      14080027
140900                                                                  14090027
141000     IF  ATEXT4L > ZERO                                           14100027
141100         MOVE ATEXT4I              TO  ASC-TEXT4                  14110027
141200     ELSE                                                         14120027
141300         IF  ATEXT4F  = DP015-ERASE-EOF                           14130027
141400             MOVE SPACE            TO  ASC-TEXT4                  14140027
141500         END-IF                                                   14150027
141600     END-IF.                                                      14160027
141700                                                                  14170027
141800     IF  ATEXT5L > ZERO                                           14180027
141900         MOVE ATEXT5I              TO  ASC-TEXT5                  14190027
142000     ELSE                                                         14200027
142100         IF  ATEXT5F  = DP015-ERASE-EOF                           14210027
142200             MOVE SPACE            TO  ASC-TEXT5                  14220027
142300         END-IF                                                   14230027
142400     END-IF.                                                      14240027
142500/                                                                 14250027
142600*----------------------------------------------------------------*14260027
142700* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR  *14270027
142800* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN        *14280027
142900* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                        *14290027
143000*----------------------------------------------------------------*14300027
143100                                                                  14310027
143200 3000-EDIT-DATA-IN-COMMAREA.                                      14320027
143300                                                                  14330027
143400     PERFORM 3200-RESET-ATTRIBUTES.                               14340027
143500                                                                  14350027
143600     IF (ASC-RSN-CDE-ENTERED                                      14360027
143700     OR  ASC-TRBL-RSN-CDE-ERROR)                                  14370027
143800         PERFORM 3010-VALIDATE-REASON-CODE                        14380027
143900     END-IF.                                                      14390027
144000                                                                  14400027
144100     IF  ASC-TEXT1 NOT GREATER THAN SPACES                        14410027
144200         SET PS-ERROR                                             14420027
144300             DP020-MSG-FATAL       TO  TRUE                       14430027
144400         MOVE PC-TSYMSG-01522      TO  DP020-MSG-NUMBER           14440027
144500         MOVE DP015-UNP-ALP-BRT-OFF                               14450027
144600                                   TO  ATEXT1A                    14460027
144700         MOVE DP015-RED            TO  ATEXT1C                    14470027
144800         MOVE DP015-REVERSE        TO  ATEXT1H                    14480027
144900         MOVE -1                   TO  ATEXT1L                    14490027
145000     END-IF.                                                      14500027
145100                                                                  14510027
145200     IF  PS-ERROR                                                 14520027
145300         CONTINUE                                                 14530027
145400     ELSE                                                         14540027
145500         IF (ASC-TRBL-RSN-CDE GREATER THAN SPACES                 14550027
145600         AND ASC-TRBL-LONG-DESC GREATER THAN SPACES)              14560027
145700             CONTINUE                                             14570027
145800         ELSE                                                     14580027
145900             SET PS-ERROR          TO  TRUE                       14590027
146000             SET DP020-MSG-FATAL   TO  TRUE                       14600027
146100             MOVE PC-TSYMSG-00005  TO  DP020-MSG-NUMBER           14610027
146200             MOVE DP015-UNP-ALP-BRT-OFF                           14620027
146300                                   TO  ATRBRSNA                   14630027
146400             MOVE DP015-RED        TO  ATRBRSNC                   14640027
146500             MOVE DP015-REVERSE    TO  ATRBRSNH                   14650027
146600             MOVE -1               TO  ATRBRSNL                   14660027
146700         END-IF                                                   14670027
146800     END-IF.                                                      14680027
146900                                                                  14690027
147000                                                                  14700027
147100     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      14710027
147200     IF  NOT PS-ERROR                                             14720027
147300         MOVE -1                   TO  ATRBRSNL                   14730027
147400     END-IF.                                                      14740027
147500/                                                                 14750027
147600*----------------------------------------------------------------*14760027
147700*    FIRST, ENSURE THE REASON CODE ENTERED IS NUMERIC.  NEXT,    *14770027
147800*    SEE IF IT EXISTS ON THE TTRBRSN TABLE.                      *14780027
147900*----------------------------------------------------------------*14790027
148000                                                                  14800027
148100 3010-VALIDATE-REASON-CODE.                                       14810027
148200                                                                  14820027
148300     MOVE ASC-TRBL-RSN-CDE-X       TO  DP010I-UNEDITED-FIELD.     14830027
148400     MOVE PC-4                     TO  DP010I-MAXIMUM-DIGITS.     14840027
148500     MOVE ZERO                     TO  DP010I-MAXIMUM-DECIMALS.   14850027
148600     SET DP010I-NEGATIVE-NOT-ALLOWED                              14860027
148700                                   TO  TRUE.                      14870027
148800     CALL DP010I-NUMERIC-EDIT-ROUTINE                             14880059
148810          USING DP010I-NUMERIC-EDIT-AREA.                         14881059
148900                                                                  14890027
149000     IF  DP010I-ERROR-DETECTED                                    14900027
149100         SET DP020-MSG-FATAL                                      14910027
149200             ASC-TRBL-RSN-CDE-ERROR                               14920027
149300             PS-ERROR              TO  TRUE                       14930027
149400         MOVE PC-TSYMSG-00008      TO  DP020-MSG-NUMBER           14940027
149500         MOVE DP015-UNP-ALP-BRT-OFF                               14950027
149600                                   TO  ATRBRSNA                   14960027
149700         MOVE DP015-RED            TO  ATRBRSNC                   14970027
149800         MOVE DP015-REVERSE        TO  ATRBRSNH                   14980027
149900         MOVE -1                   TO  ATRBRSNL                   14990027
150000     ELSE                                                         15000027
150100         MOVE DP010I-NUMERIC-FIELD TO  ASC-TRBL-RSN-CDE           15010027
150200                                       PV-REASON-CHECKER          15020027
150300         MOVE PV-REASON-CHECKER    TO  TRBRSN-TRBL-RSN-CDE        15030027
150400     END-IF.                                                      15040027
150500     IF PS-ERROR                                                  15050027
150600         CONTINUE                                                 15060027
150700     ELSE                                                         15070027
150800         IF  PV-VERIFIED-ADJUSTMENT                               15080027
150900             PERFORM 3011-SELECT-TTRBRSN-BY-CODE                  15090027
151000                 CONTINUE                                         15100027
151100         ELSE                                                     15110027
151200             SET DP020-MSG-FATAL                                  15120027
151300                 ASC-TRBL-RSN-CDE-ERROR                           15130027
151400                  PS-ERROR         TO TRUE                        15140027
151500             MOVE PC-TSYMSG-01187 TO  DP020-MSG-NUMBER            15150027
151600             MOVE DP015-UNP-ALP-BRT-OFF                           15160027
151700                                   TO  ATRBRSNA                   15170027
151800             MOVE DP015-RED       TO  ATRBRSNC                    15180027
151900             MOVE DP015-REVERSE   TO  ATRBRSNH                    15190027
152000             MOVE -1              TO  ATRBRSNL                    15200027
152100         END-IF                                                   15210027
152200     END-IF.                                                      15220027
152300/                                                                 15230027
152400 3011-SELECT-TTRBRSN-BY-CODE.                                     15240027
152500                                                                  15250027
152600     EXEC SQL                                                     15260027
152700          SELECT                                                  15270027
152800                 TRBL_SHT_DESC                                    15280027
152900               , TRBL_LONG_DESC                                   15290027
153000               , ALLOW_CRE_BY_IND                                 15300027
153100               , TRBL_LVL_IND                                     15310027
153200         INTO                                                     15320027
153300                :ASC-TRBL-SHT-DESC                                15330027
153400               ,:ASC-TRBL-LONG-DESC                               15340027
153500               ,:TRBRSN-ALLOW-CRE-BY-IND                          15350027
153600               ,:ASC-TRBL-LVL-IND                                 15360027
153700         FROM                                                     15370027
153800                 TTRBRSN                                          15380027
153900         WHERE                                                    15390027
154000                 TRBL_RSN_CDE       =  :TRBRSN-TRBL-RSN-CDE       15400027
154100     END-EXEC.                                                    15410027
154200                                                                  15420027
154300     EVALUATE TRUE                                                15430027
154400         WHEN SQLCODE = ZERO                                      15440027
154500              SET ASC-TRBL-RSN-CDE-OK TO TRUE                     15450027
154510              PERFORM 3015-SELECT-TRBL-CMNT-LINES                 15451055
154520                                                                  15452055
154600         WHEN SQLCODE = +100                                      15460027
154700              SET ASC-TRBL-RSN-CDE-ERROR                          15470027
154800                  PS-ERROR         TO TRUE                        15480027
154900              MOVE PC-TSYMSG-01187 TO  DP020-MSG-NUMBER           15490027
155000              MOVE DP015-UNP-ALP-BRT-OFF                          15500027
155100                                   TO  ATRBRSNA                   15510027
155200              MOVE DP015-RED       TO  ATRBRSNC                   15520027
155300              MOVE DP015-REVERSE   TO  ATRBRSNH                   15530027
155400              MOVE -1              TO  ATRBRSNL                   15540027
155500         WHEN SQLCODE = -904                                      15550027
155600         WHEN SQLCODE = -913                                      15560027
155700              PERFORM 9900-SOFT-ABORT                             15570027
155800         WHEN SQLWARN0 NOT = SPACES                               15580027
155900         WHEN SQLCODE NOT EQUAL ZERO                              15590027
156000              MOVE '3011-SELECT-TTRBRSN-BY-CODE'                  15600027
156100                                   TO DP013-PARAGRAPH             15610027
156200              MOVE 'SELECT TTRBRSN BY TROUBLE CODE'               15620027
156300                                   TO DP013-MESSAGE-TEXT (1)      15630027
156400              MOVE SQLCA           TO DP013-SQLCA                 15640027
156500              MOVE 'TTRBRSN'       TO DP013-DB2-TABLE-NAME (1)    15650027
156600              SET DP013-DB2-ABEND                                 15660027
156700                 DP013-XCTL-DISPLAY-RESTART                       15670027
156800                                   TO TRUE                        15680027
156900              PERFORM DP013-0000-PROCESS-ABEND                    15690027
157000     END-EVALUATE.                                                15700027
157001                                                                  15700155
157002                                                                  15700255
157003*----------------------------------------------------------------*15700355
157004* CHECK TO SEE IF TROUBLE CODE IS SET UP WITH DEFAULT COMMENT    *15700455
157005* LINES                                                          *15700555
157006* ADDED:  07/07/2021 DMH                                         *15700655
157007*----------------------------------------------------------------*15700755
157010 3015-SELECT-TRBL-CMNT-LINES.                                     15701055
157020                                                                  15702055
157021     MOVE SPACES  TO  PV-TRBL-CMNT-TEXT1                          15702155
157022                      PV-TRBL-CMNT-TEXT2                          15702255
157023                      PV-TRBL-CMNT-TEXT3                          15702355
157024                      PV-TRBL-CMNT-TEXT4                          15702455
157025                      PV-TRBL-CMNT-TEXT5.                         15702555
157026                                                                  15702655
157027     MOVE TRBRSN-TRBL-RSN-CDE  TO  WST00010-ATTR-ELEM-NBR.        15702756
157028                                                                  15702856
157030     EXEC SQL                                                     15703055
157050          SELECT E.ATTR_ELEM_TXT                                  15705055
157060               , F.ATTR_ELEM_TXT                                  15706055
157070               , G.ATTR_ELEM_TXT                                  15707055
157071               , H.ATTR_ELEM_TXT                                  15707155
157080               , I.ATTR_ELEM_TXT                                  15708055
158402           INTO  :PV-TRBL-CMNT-TEXT1                              15840255
158403               , :PV-TRBL-CMNT-TEXT2                              15840355
158404               , :PV-TRBL-CMNT-TEXT3                              15840455
158405               , :PV-TRBL-CMNT-TEXT4                              15840555
158406               , :PV-TRBL-CMNT-TEXT5                              15840655
158408            FROM WST_INTGRTN_TYP  A                               15840855
158409               , WST_ATTR_DEFN    B                               15840955
158410               , WST_ATTR_ELEM    C                               15841055
158411               , WST_ATTR_ELEM    D                               15841155
158412               , WST_ATTR_ELEM    E                               15841255
158413               , WST_ATTR_ELEM    F                               15841355
158414               , WST_ATTR_ELEM    G                               15841455
158415               , WST_ATTR_ELEM    H                               15841555
158416               , WST_ATTR_ELEM    I                               15841655
158417           WHERE                                                  15841755
158418                 A.INTGRTN_TYP_CDE   = 'RCTMVECMNT'               15841855
158419             AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE          15841955
158420             AND B.ATTR_DEFN_SEQ_NBR = 1                          15842055
158421             AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE          15842155
158422             AND C.ATTR_DEFN_SEQ_NBR = 1                          15842255
158423             AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE          15842355
158424             AND D.ATTR_DEFN_SEQ_NBR = 2                          15842455
158425             AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE          15842555
158426             AND E.ATTR_DEFN_SEQ_NBR = 3                          15842655
158427             AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE          15842755
158428             AND F.ATTR_DEFN_SEQ_NBR = 4                          15842855
158429             AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE          15842955
158430             AND G.ATTR_DEFN_SEQ_NBR = 5                          15843055
158431             AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE          15843155
158432             AND H.ATTR_DEFN_SEQ_NBR = 6                          15843255
158433             AND B.INTGRTN_TYP_CDE   = I.INTGRTN_TYP_CDE          15843355
158434             AND I.ATTR_DEFN_SEQ_NBR = 7                          15843455
158435             AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR        15843555
158436             AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR        15843655
158437             AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR        15843755
158438             AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR        15843855
158439             AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR        15843955
158440             AND C.ATTR_ELEM_SEQ_NBR = I.ATTR_ELEM_SEQ_NBR        15844055
158441             AND C.ATTR_ELEM_NBR     = :WST00010-ATTR-ELEM-NBR    15844156
158442             AND D.ATTR_ELEM_TXT     = 'AC'                       15844255
158443            WITH UR                                               15844357
158444     END-EXEC.                                                    15844455
158445                                                                  15844555
158446     EVALUATE TRUE                                                15844655
158447         WHEN SQLCODE = ZERO                                      15844755
158448              IF  PV-TRBL-CMNT-TEXT1 = '*'                        15844855
158449                  MOVE SPACES  TO  PV-TRBL-CMNT-TEXT1             15844955
158450              END-IF                                              15845055
158451              IF  PV-TRBL-CMNT-TEXT2 = '*'                        15845155
158452                  MOVE SPACES  TO  PV-TRBL-CMNT-TEXT2             15845255
158453              END-IF                                              15845355
158454              IF  PV-TRBL-CMNT-TEXT3 = '*'                        15845455
158455                  MOVE SPACES  TO  PV-TRBL-CMNT-TEXT3             15845555
158456              END-IF                                              15845655
158457              IF  PV-TRBL-CMNT-TEXT4 = '*'                        15845755
158458                  MOVE SPACES  TO  PV-TRBL-CMNT-TEXT4             15845855
158459              END-IF                                              15845955
158460              IF  PV-TRBL-CMNT-TEXT5 = '*'                        15846055
158461                  MOVE SPACES  TO  PV-TRBL-CMNT-TEXT5             15846155
158462              END-IF                                              15846255
158463                                                                  15846355
158464              IF  PV-TRBL-CMNT-TEXT1  > SPACES  AND               15846455
158465                  ASC-TEXT1       NOT > SPACES                    15846555
158466                  MOVE  PV-TRBL-CMNT-TEXT1  TO ASC-TEXT1          15846655
158467              END-IF                                              15846755
158468              IF  PV-TRBL-CMNT-TEXT2  > SPACES  AND               15846855
158469                  ASC-TEXT2       NOT > SPACES                    15846955
158470                  MOVE  PV-TRBL-CMNT-TEXT2  TO ASC-TEXT2          15847055
158471              END-IF                                              15847155
158472              IF  PV-TRBL-CMNT-TEXT3  > SPACES  AND               15847255
158473                  ASC-TEXT3       NOT > SPACES                    15847355
158474                  MOVE  PV-TRBL-CMNT-TEXT3  TO ASC-TEXT3          15847455
158475              END-IF                                              15847555
158476              IF  PV-TRBL-CMNT-TEXT4  > SPACES  AND               15847655
158477                  ASC-TEXT4       NOT > SPACES                    15847755
158478                  MOVE  PV-TRBL-CMNT-TEXT4  TO ASC-TEXT4          15847855
158479              END-IF                                              15847955
158480              IF  PV-TRBL-CMNT-TEXT5  > SPACES  AND               15848055
158481                  ASC-TEXT5       NOT > SPACES                    15848155
158482                  MOVE  PV-TRBL-CMNT-TEXT5  TO ASC-TEXT5          15848255
158483              END-IF                                              15848355
158484                                                                  15848455
158485         WHEN SQLCODE = +100                                      15848555
158486         WHEN SQLCODE = -305                                      15848655
158487              MOVE SPACES  TO  PV-TRBL-CMNT-TEXT1                 15848755
158488                               PV-TRBL-CMNT-TEXT2                 15848855
158489                               PV-TRBL-CMNT-TEXT3                 15848955
158490                               PV-TRBL-CMNT-TEXT4                 15849055
158491                               PV-TRBL-CMNT-TEXT5                 15849155
158492                                                                  15849255
158493         WHEN SQLCODE = -904                                      15849355
158494         WHEN SQLCODE = -913                                      15849455
158495              PERFORM 9900-SOFT-ABORT                             15849555
158496         WHEN SQLWARN0 NOT = SPACES                               15849655
158497         WHEN SQLCODE NOT EQUAL ZERO                              15849755
158498              MOVE '3015-SELECT-TRBL-CMNT-LINES'                  15849855
158499                                   TO DP013-PARAGRAPH             15849955
158500              MOVE 'SELECT TROUBLE COMMENT LINES  '               15850055
158501                                   TO DP013-MESSAGE-TEXT (1)      15850155
158502              MOVE SQLCA           TO DP013-SQLCA                 15850255
158503              MOVE 'WST00008'      TO DP013-DB2-TABLE-NAME (1)    15850355
158504              MOVE 'WST00009'      TO DP013-DB2-TABLE-NAME (2)    15850455
158505              MOVE 'WST00010'      TO DP013-DB2-TABLE-NAME (3)    15850555
158506              SET DP013-DB2-ABEND                                 15850655
158507                 DP013-XCTL-DISPLAY-RESTART                       15850755
158508                                   TO TRUE                        15850855
158509              PERFORM DP013-0000-PROCESS-ABEND                    15850955
158510     END-EVALUATE.                                                15851055
158511                                                                  15851155
158512                                                                  15851255
158513*----------------------------------------------------------------*15851355
158514*    FIRST, SET UP THE HOST VARIABLE. NEXT, SEE IF WE GET A      *15851455
158515*    UNIQUE HIT ON THE TTRBRSN TABLE.                            *15851555
158516*----------------------------------------------------------------*15851655
158517                                                                  15851755
158518 3020-GET-REASON-CODE.                                            15851855
158519                                                                  15851955
158520     MOVE  ASC-TRBL-LONG-DESC      TO  PV-TRBL-LONG-DESC-LOW      15852055
158521                                       PV-TRBL-LONG-DESC-HIGH.    15852155
158522     INSPECT PV-TRBL-LONG-DESC-LOW  CONVERTING '*' TO ' '.        15852255
158523     INSPECT PV-TRBL-LONG-DESC-HIGH CONVERTING '*' TO '9'.        15852355
158524     PERFORM 3021-SELECT-TTRBRSN-BY-DESC.                         15852455
158525                                                                  15852555
158530 3021-SELECT-TTRBRSN-BY-DESC.                                     15853027
158600                                                                  15860027
158700     EXEC SQL                                                     15870027
158800          SELECT                                                  15880027
158900                 TRBL_RSN_CDE                                     15890027
159000               , TRBL_SHT_DESC                                    15900027
159100               , TRBL_LONG_DESC                                   15910027
159200               , TRBL_LVL_IND                                     15920027
159300         INTO                                                     15930027
159400                :TRBRSN-TRBL-RSN-CDE                              15940027
159500               ,:ASC-TRBL-SHT-DESC                                15950027
159600               ,:ASC-TRBL-LONG-DESC                               15960027
159700               ,:ASC-TRBL-LVL-IND                                 15970027
159800         FROM                                                     15980027
159900                 TTRBRSN                                          15990027
160000         WHERE                                                    16000027
160100                 TRBL_LONG_DESC  BETWEEN :PV-TRBL-LONG-DESC-LOW   16010027
160200                                  AND   :PV-TRBL-LONG-DESC-HIGH   16020027
160300          AND    ALLOW_CRE_BY_IND   =  :PC-S                      16030027
160400     END-EXEC.                                                    16040027
160500                                                                  16050027
160600     EVALUATE TRUE                                                16060027
160700         WHEN SQLCODE = ZERO                                      16070027
160800              SET ASC-RSN-CDE-ENTERED   TO TRUE                   16080027
160900              MOVE TRBRSN-TRBL-RSN-CDE TO ASC-TRBL-RSN-CDE        16090027
161000         WHEN SQLCODE = +100                                      16100027
161100              SET PS-ERROR         TO TRUE                        16110027
161200              MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER            16120027
161300         WHEN SQLCODE = -811                                      16130027
161400              SET PS-ERROR         TO TRUE                        16140027
161500              MOVE 'NNNNN-N-REASON TEXT NOT UNIQUE ENOUGH'        16150027
161600                                   TO DP020-MSG-MESSAGE           16160027
161700         WHEN SQLCODE = -904                                      16170027
161800         WHEN SQLCODE = -913                                      16180027
161900              PERFORM 9900-SOFT-ABORT                             16190027
162000         WHEN SQLWARN0 NOT = SPACES                               16200027
162100         WHEN SQLCODE NOT EQUAL ZERO                              16210027
162200              MOVE '3021-SELECT-TTRBRSN-BY-DESC'                  16220027
162300                                   TO DP013-PARAGRAPH             16230027
162400              MOVE 'SELECT TTRBRSN BY SHORT DESCRIPTION'          16240027
162500                                   TO DP013-MESSAGE-TEXT (1)      16250027
162600              MOVE SQLCA           TO DP013-SQLCA                 16260027
162700              MOVE 'TTRBRSN'       TO DP013-DB2-TABLE-NAME (1)    16270027
162800              SET DP013-DB2-ABEND                                 16280027
162900                 DP013-XCTL-DISPLAY-RESTART                       16290027
163000                                   TO TRUE                        16300027
163100              PERFORM DP013-0000-PROCESS-ABEND                    16310027
163200     END-EVALUATE.                                                16320027
163300/                                                                 16330027
163400/                                                                 16340027
163500*----------------------------------------------------------------*16350027
163600*    CHECK TO SEE IF THE RECEIVER EXISTS.  FETCH THE RECEIVER    *16360027
163700*    STATUS CODE TO DETERMINE IF THE RECEIVER HAS BEEN VERIFIED. *16370027
163800*----------------------------------------------------------------*16380027
163900                                                                  16390027
164000 3040-SELECT-TRECEIV.                                             16400027
164100                                                                  16410027
164200     INITIALIZE DCLTRECEIV.                                       16420027
164300                                                                  16430027
164400     EXEC SQL                                                     16440027
164500         SELECT                                                   16450027
164600                 OPER_UNT_ID                                      16460027
164700               , STATUS_CDE                                       16470027
164800               , REC_TMST                                         16480027
164900               , FS_POST_TMST                                     16490027
165000               , AP_PRC_CDE                                       16500027
165100               , VERFYD_TMST                                      16510027
165200               , CURR_OPER_UNT_ID                                 16520027
165300         INTO                                                     16530027
165400                :RECEIV-OPER-UNT-ID                               16540027
165500              , :RECEIV-STATUS-CDE                                16550027
165600              , :RECEIV-REC-TMST                                  16560027
165700              , :RECEIV-FS-POST-TMST                              16570027
165800              , :RECEIV-AP-PRC-CDE                                16580027
165900              , :RECEIV-VERFYD-TMST                               16590027
166000              , :RECEIV-CURR-OPER-UNT-ID                          16600027
166100         FROM                                                     16610027
166200                 TRECEIV                                          16620027
166300         WHERE                                                    16630027
166400                 OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID       16640027
166500          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          16650027
166600          AND    ORD_NBR            =  :ASC-KEY-PO-NBR            16660027
166700          AND    REC_SEQ_NBR        =  :ASC-KEY-REC-SEQ-NBR       16670027
166800          AND    VER_STATUS_CDE     =  :PC-ACTIVE-STATUS          16680027
166900          AND    STATUS_CDE         =  :PC-VERIFIED-STATUS        16690027
167000     END-EXEC.                                                    16700027
167100                                                                  16710027
167200     EVALUATE TRUE                                                16720027
167300         WHEN SQLCODE = ZERO                                      16730027
167400              CONTINUE                                            16740027
167500         WHEN SQLCODE = +100                                      16750027
167600              SET PS-ERROR               TO TRUE                  16760027
167700              SET PS-NO-RECEIVER-FOUND   TO TRUE                  16770027
167800         WHEN SQLCODE = -904                                      16780027
167900         WHEN SQLCODE = -913                                      16790027
168000              PERFORM 9900-SOFT-ABORT                             16800027
168100         WHEN SQLWARN0 NOT = SPACES                               16810027
168200         WHEN SQLCODE NOT EQUAL ZERO                              16820027
168300              MOVE '3040-SELECT-TRECEIV'                          16830027
168400                                   TO DP013-PARAGRAPH             16840027
168500              MOVE 'SELECT RECEIVER INFORMATION'                  16850027
168600                                   TO DP013-MESSAGE-TEXT (1)      16860027
168700              MOVE SQLCA           TO DP013-SQLCA                 16870027
168800              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (1)    16880027
168900              SET DP013-DB2-ABEND                                 16890027
169000                 DP013-XCTL-DISPLAY-RESTART                       16900027
169100                                   TO TRUE                        16910027
169200              PERFORM DP013-0000-PROCESS-ABEND                    16920027
169300     END-EVALUATE.                                                16930027
169400/                                                                 16940027
169500*----------------------------------------------------------------*16950027
169600*    FIND THE DAYS ALLOWED AFTER VERIFICATION TO ADJUST THE      *16960027
169700*    QUANTITY.                                                   *16970027
169800*----------------------------------------------------------------*16980027
169900                                                                  16990027
170000 3045-SELECT-TCOCNTL.                                             17000027
170100                                                                  17010027
170200     INITIALIZE DCLTCOCNTL.                                       17020027
170300                                                                  17030027
170400     EXEC SQL                                                     17040027
170500         SELECT                                                   17050027
170600                 DAYS_ALWD_ADJ_QTY                                17060027
170700                ,CURRENT TIMESTAMP                                17070027
170800         INTO                                                     17080027
170900                :COCNTL-DAYS-ALWD-ADJ-QTY                         17090027
171000               ,:PV-CURRENT-TIMESTAMP                             17100027
171100         FROM                                                     17110027
171200                 TCOCNTL                                          17120027
171300         WHERE                                                    17130027
171400                 OPER_UNT_ID        =  :RECEIV-CURR-OPER-UNT-ID   17140027
171500          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          17150027
171600     END-EXEC.                                                    17160027
171700                                                                  17170027
171800     EVALUATE TRUE                                                17180050
171900         WHEN SQLCODE = ZERO                                      17190027
172000             PERFORM 3047-GET-DATE-RANGE                          17200027
172100         WHEN SQLCODE = +100                                      17210027
172200*             CONTINUE                                            17220054
172300             PERFORM 3046-SELECT-TCOCNTL-CORP                     17230052
172400         WHEN SQLCODE = -904                                      17240027
172500         WHEN SQLCODE = -913                                      17250027
172600              PERFORM 9900-SOFT-ABORT                             17260027
172700         WHEN SQLWARN0 NOT = SPACES                               17270027
172800         WHEN SQLCODE NOT EQUAL ZERO                              17280027
172900              MOVE '3045-SELECT-TCOCNTL'                          17290027
173000                                   TO DP013-PARAGRAPH             17300027
173100              MOVE 'SELECT COCNTL INFORMATION'                    17310027
173200                                   TO DP013-MESSAGE-TEXT (1)      17320027
173300              MOVE SQLCA           TO DP013-SQLCA                 17330027
173400              MOVE 'TCOCNTL'       TO DP013-DB2-TABLE-NAME (1)    17340027
173500              SET DP013-DB2-ABEND                                 17350027
173600                 DP013-XCTL-DISPLAY-RESTART                       17360027
173700                                   TO TRUE                        17370027
173800              PERFORM DP013-0000-PROCESS-ABEND                    17380027
173900     END-EVALUATE.                                                17390027
174000/                                                                 17400027
174100*----------------------------------------------------------------*17410050
174200*    FIND THE DAYS ALLOWED AFTER VERIFICATION TO ADJUST THE      *17420050
174300*    QUANTITY USING STORE 90.                                    *17430050
174400*----------------------------------------------------------------*17440050
174500                                                                  17450050
174600 3046-SELECT-TCOCNTL-CORP.                                        17460050
174700                                                                  17470050
174800     INITIALIZE DCLTCOCNTL.                                       17480050
174900                                                                  17490050
175000     EXEC SQL                                                     17500050
175100         SELECT                                                   17510050
175200                 DAYS_ALWD_ADJ_QTY                                17520050
175300                ,CURRENT TIMESTAMP                                17530050
175400         INTO                                                     17540050
175500                :COCNTL-DAYS-ALWD-ADJ-QTY                         17550050
175600               ,:PV-CURRENT-TIMESTAMP                             17560050
175700         FROM                                                     17570050
175800                 TCOCNTL                                          17580050
175900         WHERE                                                    17590050
176000                 OPER_UNT_ID        =  :PC-CORP                   17600053
176100          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          17610050
176200     END-EXEC.                                                    17620050
176300                                                                  17630050
176400     EVALUATE TRUE                                                17640050
176500         WHEN SQLCODE = ZERO                                      17650050
176600             PERFORM 3047-GET-DATE-RANGE                          17660050
176700         WHEN SQLCODE = +100                                      17670050
176800              CONTINUE                                            17680050
176900         WHEN SQLCODE = -904                                      17690050
177000         WHEN SQLCODE = -913                                      17700050
177100              PERFORM 9900-SOFT-ABORT                             17710050
177200         WHEN SQLWARN0 NOT = SPACES                               17720050
177300         WHEN SQLCODE NOT EQUAL ZERO                              17730050
177400              MOVE '3046-SELECT-TCOCNTL-CORP'                     17740050
177500                                   TO DP013-PARAGRAPH             17750050
177600              MOVE 'SELECT COCNTL INFORMATION'                    17760050
177700                                   TO DP013-MESSAGE-TEXT (1)      17770050
177800              MOVE SQLCA           TO DP013-SQLCA                 17780050
177900              MOVE 'TCOCNTL'       TO DP013-DB2-TABLE-NAME (1)    17790050
178000              SET DP013-DB2-ABEND                                 17800050
178100                 DP013-XCTL-DISPLAY-RESTART                       17810050
178200                                   TO TRUE                        17820050
178300              PERFORM DP013-0000-PROCESS-ABEND                    17830050
178400     END-EVALUATE.                                                17840050
178500/                                                                 17850050
178600 3047-GET-DATE-RANGE.                                             17860027
178700******************************************************************17870027
178800*    THIS PARAGRAPH CALCULATES IF THE RECEIVER CAN BE VERIFIED    17880027
178900*    BASED ON THE THE NUMBER OF DAYS FOUND IN THE                 17890027
179000*    DAYS-ALWD-ADJ-QTY OF COCNTL TABLE.  THIS NUMBER IS SUBTRACTED17900027
179100*    FROM THE CURRENT DATE.  IF THE VERIFY DATE IS GREATER THAN   17910027
179200*    THE COMPUTED DATE THAN THE RECEIVER CAN BE ADJUSTED.         17920027
179300******************************************************************17930027
179400                                                                  17940027
179500                                                                  17950027
179600     MOVE PV-CURRENT-TIMESTAMP       TO PV-WORK-TMST.             17960027
179700     MOVE PV-WK-CCYY                 TO PV-LK-DTE-CCYY.           17970027
179800     MOVE PV-WK-MO                   TO PV-LK-DTE-MO              17980027
179900     MOVE PV-WK-DA                   TO PV-LK-DTE-DD              17990027
180000                                                                  18000031
180100     INITIALIZE  DPG51 DPG52                                      18010031
180200                 DPG53 DPG54                                      18020031
180300                 DPG55 DPG56.                                     18030031
180400                                                                  18040027
180500     MOVE PV-LK-DTE-ISO              TO DPG52-LK-DATE-INPUT.      18050027
180600                                                                  18060027
180700     MOVE COCNTL-DAYS-ALWD-ADJ-QTY   TO DPG51-INCR-DECR-DAYS-9.   18070027
180800                                                                  18080027
180900     SET DPG51-DECREMENT-DATE        TO TRUE.                     18090027
181000     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     18100027
181100     SET DPG52-LK-DTE-ISO            TO TRUE.                     18110027
181200                                                                  18120027
181300*    CALL 'DPKUT500' USING DPG51 DPG52                            18130029
181400*                          DPG53 DPG54                            18140029
181500*                          DPG55 DPG56.                           18150029
181600     MOVE '3047-GET-DATE-RANGE'                                   18160029
181700       TO PV-FROM-PARAGRAPH.                                      18170029
181800     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          18180029
181900                                                                  18190027
182000     MOVE DPG55-JULIAN-DATE-CCYYDDD  TO PV-COMP-DATE-JULIAN.      18200027
182100     MOVE DPG55-GREG-CC-DATE-FMT     TO PV-INPUT-DATE             18210027
182200                                                                  18220027
182300     MOVE RECEIV-VERFYD-TMST         TO PV-WORK-TMST.             18230027
182400     MOVE PV-WK-CCYY                 TO PV-LK-DTE-CCYY.           18240027
182500     MOVE PV-WK-MO                   TO PV-LK-DTE-MO              18250027
182600     MOVE PV-WK-DA                   TO PV-LK-DTE-DD              18260027
182700                                                                  18270030
182800     INITIALIZE  DPG51 DPG52                                      18280030
182900                 DPG53 DPG54                                      18290030
183000                 DPG55 DPG56.                                     18300030
183100                                                                  18310027
183200     MOVE PV-LK-DTE-ISO              TO DPG52-LK-DATE-INPUT.      18320027
183300                                                                  18330027
183400     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     18340027
183500     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     18350027
183600     SET DPG52-LK-DTE-ISO            TO TRUE.                     18360027
183700                                                                  18370027
183800*    CALL 'DPKUT500' USING DPG51 DPG52                            18380029
183900*                          DPG53 DPG54                            18390029
184000*                          DPG55 DPG56.                           18400029
184100     MOVE '3047-GET-DATE-RANGE'                                   18410029
184200       TO PV-FROM-PARAGRAPH.                                      18420029
184300     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          18430029
184400                                                                  18440027
184500     MOVE DPG55-JULIAN-DATE-CCYYDDD  TO PV-VFY-DATE-JULIAN.       18450027
184600                                                                  18460027
184700/                                                                 18470027
184800*----------------------------------------------------------------*18480027
184900*    CHECK TO SEE IF THE SPECIFIED LINE EXISTS FOR THIS PO.      *18490027
185000*----------------------------------------------------------------*18500027
185100                                                                  18510027
185200 3050-FETCH-TPURITM.                                              18520027
185300                                                                  18530027
185400     INITIALIZE PV-DB2-COUNT.                                     18540027
185500                                                                  18550027
185600     EXEC SQL                                                     18560027
185700         SELECT                                                   18570027
185800                 COUNT(*)                                         18580027
185900         INTO                                                     18590027
186000                :PV-DB2-COUNT                                     18600027
186100         FROM                                                     18610027
186200                 TPURITM                                          18620027
186300         WHERE                                                    18630027
186400                 PO_NBR             =  :ASC-KEY-PO-NBR            18640027
186500          AND    APP_PO_LNE_NBR     =  :ASC-KEY-PO-LNE-NBR        18650027
186600     END-EXEC.                                                    18660027
186700                                                                  18670027
186800     EVALUATE TRUE                                                18680027
186900         WHEN SQLCODE = ZERO                                      18690027
187000         WHEN SQLCODE = +100                                      18700027
187100         WHEN SQLCODE = -305                                      18710027
187200              CONTINUE                                            18720027
187300         WHEN SQLCODE = -904                                      18730027
187400         WHEN SQLCODE = -913                                      18740027
187500              PERFORM 9900-SOFT-ABORT                             18750027
187600         WHEN SQLWARN0 NOT = SPACES                               18760027
187700         WHEN SQLCODE NOT EQUAL ZERO                              18770027
187800              MOVE '3050-FETCH-TPURITM'                           18780027
187900                                   TO DP013-PARAGRAPH             18790027
188000              MOVE 'SELECT PURCHASE ORDER LINE INFORMATION'       18800027
188100                                   TO DP013-MESSAGE-TEXT (1)      18810027
188200              MOVE SQLCA           TO DP013-SQLCA                 18820027
188300              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    18830027
188400              SET DP013-DB2-ABEND                                 18840027
188500                 DP013-XCTL-DISPLAY-RESTART                       18850027
188600                                   TO TRUE                        18860027
188700              PERFORM DP013-0000-PROCESS-ABEND                    18870027
188800     END-EVALUATE.                                                18880027
188900/                                                                 18890027
189000*----------------------------------------------------------------*18900027
189100*    FETCH THE RECEIPT ITEM FOR A SPECIFIED PO LINE TO CHECK     *18910027
189200*    IF IT HAS BEEN VERIFIED.                                    *18920027
189300*----------------------------------------------------------------*18930027
189400                                                                  18940027
189500 3060-FETCH-TRECITM.                                              18950027
189600                                                                  18960027
189700     INITIALIZE DCLTRECITM.                                       18970027
189800                                                                  18980027
189900     EXEC SQL                                                     18990027
190000         SELECT                                                   19000027
190100                 STATUS_CDE                                       19010027
190200         INTO                                                     19020027
190300                :RECITM-STATUS-CDE                                19030027
190400         FROM                                                     19040027
190500                 TRECITM                                          19050027
190600         WHERE                                                    19060027
190700                 OPER_UNT_ID        =  :ASC-KEY-OPER-UNT-ID       19070027
190800          AND    FCLTY_ID           =  :ASC-KEY-FCLTY-ID          19080027
190900          AND    ORD_NBR            =  :ASC-KEY-PO-NBR            19090027
191000          AND    ORD_LNE_NBR        =  :ASC-KEY-PO-LNE-NBR        19100027
191100          AND    REC_SEQ_NBR        =  :ASC-KEY-REC-SEQ-NBR       19110027
191200          AND    VER_STATUS_CDE     =  :PC-ACTIVE-STATUS          19120027
191300     END-EXEC.                                                    19130027
191400                                                                  19140027
191500     EVALUATE TRUE                                                19150027
191600         WHEN SQLCODE = ZERO                                      19160027
191700         WHEN SQLCODE = +100                                      19170027
191800              CONTINUE                                            19180027
191900         WHEN SQLCODE = -904                                      19190027
192000         WHEN SQLCODE = -913                                      19200027
192100              PERFORM 9900-SOFT-ABORT                             19210027
192200         WHEN SQLWARN0 NOT = SPACES                               19220027
192300         WHEN SQLCODE NOT EQUAL ZERO                              19230027
192400              MOVE '3060-FETCH-TRECITM'                           19240027
192500                                   TO DP013-PARAGRAPH             19250027
192600              MOVE 'SELECT RECEIPT ITEM INFORMATION'              19260027
192700                                   TO DP013-MESSAGE-TEXT (1)      19270027
192800              MOVE SQLCA           TO DP013-SQLCA                 19280027
192900              MOVE 'TRECITM'       TO DP013-DB2-TABLE-NAME (1)    19290027
193000              SET DP013-DB2-ABEND                                 19300027
193100                 DP013-XCTL-DISPLAY-RESTART                       19310027
193200                                   TO TRUE                        19320027
193300              PERFORM DP013-0000-PROCESS-ABEND                    19330027
193400     END-EVALUATE.                                                19340027
193500/                                                                 19350027
193600*----------------------------------------------------------------*19360027
193700*    RESET THE DATA ENTERABLE FIELDS ATTRIBUTE, HIGHLIGHT, AND   *19370027
193800*    COLOR BYTES.                                                *19380027
193900*----------------------------------------------------------------*19390027
194000                                                                  19400027
194100 3200-RESET-ATTRIBUTES.                                           19410027
194200                                                                  19420027
194300     MOVE DP015-UNP-ALP-NOR-OFF    TO ATRBRSNA                    19430027
194400                                      ATEXT1A                     19440027
194500                                      ATEXT2A                     19450027
194600                                      ATEXT3A                     19460027
194700                                      ATEXT4A                     19470027
194800                                      ATEXT5A.                    19480027
194900                                                                  19490027
195000     MOVE DP015-GREEN              TO ATRBRSNC                    19500027
195100                                      ATEXT1C                     19510027
195200                                      ATEXT2C                     19520027
195300                                      ATEXT3C                     19530027
195400                                      ATEXT4C                     19540027
195500                                      ATEXT5C.                    19550027
195600                                                                  19560027
195700     MOVE DP015-UNDERLINE          TO ATRBRSNH                    19570027
195800                                      ATRBDESH                    19580027
195900                                      ATEXT1H                     19590027
196000                                      ATEXT2H                     19600027
196100                                      ATEXT3H                     19610027
196200                                      ATEXT4H                     19620027
196300                                      ATEXT5H.                    19630027
196400                                                                  19640027
196500 3210-RESET-ATTRIBUTES.                                           19650027
196600                                                                  19660027
196700     MOVE DP015-ASK-NOR-OFF        TO ATRBRSNA                    19670027
196800                                      ATRBDESA                    19680027
196900                                      ATEXT1A                     19690027
197000                                      ATEXT2A                     19700027
197100                                      ATEXT3A                     19710027
197200                                      ATEXT4A                     19720027
197300                                      ATEXT5A.                    19730027
197400                                                                  19740027
197500     MOVE DP015-BLUE               TO ATRBRSNC                    19750027
197600                                      ATRBDESC                    19760027
197700                                      ATEXT1C                     19770027
197800                                      ATEXT2C                     19780027
197900                                      ATEXT3C                     19790027
198000                                      ATEXT4C                     19800027
198100                                      ATEXT5C.                    19810027
198200                                                                  19820027
198300     MOVE DP015-HL-OFF             TO ATRBRSNH                    19830027
198400                                      ATRBDESH                    19840027
198500                                      ATEXT1H                     19850027
198600                                      ATEXT2H                     19860027
198700                                      ATEXT3H                     19870027
198800                                      ATEXT4H                     19880027
198900                                      ATEXT5H.                    19890027
199000/                                                                 19900027
199100*----------------------------------------------------------------*19910027
199200*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *19920027
199300*    ENTRY.                                                      *19930027
199400*----------------------------------------------------------------*19940027
199500                                                                  19950027
199600 4000-BUILD-INITIAL-PANEL.                                        19960027
199700                                                                  19970027
199800     INITIALIZE ASC-SCREEN-ENTERABLE-FIELDS.                      19980027
199900     PERFORM 4100-GET-FACILITY-NAME.                              19990027
200000                                                                  20000027
200100     SET DP030-SET-CURSOR-APPL-1   TO  TRUE.                      20010027
200200/                                                                 20020027
200300*----------------------------------------------------------------*20030027
200400*    GET THE FACILITY NAME FOR THE SCREEN.                       *20040027
200500*----------------------------------------------------------------*20050027
200600                                                                  20060027
200700 4100-GET-FACILITY-NAME.                                          20070027
200800                                                                  20080027
200900     EXEC SQL                                                     20090027
201000          SELECT                                                  20100027
201100                 LOC_NM                                           20110034
201200         INTO                                                     20120027
201300                :ASC-FCLTY-NME                                    20130027
201400         FROM                                                     20140027
201500                 XLT_LOC                                          20150034
201600         WHERE                                                    20160027
201700                 LOC_NBR            =  :ASC-KEY-OPER-UNT-ID       20170034
201800     END-EXEC.                                                    20180027
201900                                                                  20190027
202000     EVALUATE TRUE                                                20200027
202100         WHEN SQLCODE = ZERO                                      20210027
202200              CONTINUE                                            20220027
202300         WHEN SQLCODE = +100                                      20230027
202400              MOVE 'FACILITY NOT FOUND' TO ASC-FCLTY-NME          20240027
202500         WHEN SQLCODE = -904                                      20250027
202600         WHEN SQLCODE = -913                                      20260027
202700              PERFORM 9900-SOFT-ABORT                             20270027
202800         WHEN SQLWARN0 NOT = SPACES                               20280027
202900         WHEN SQLCODE NOT EQUAL ZERO                              20290027
203000              MOVE '4100-GET-FACILITY-NAME'                       20300027
203100                                   TO DP013-PARAGRAPH             20310027
203200              MOVE 'SELECT TTRBRSN BY SHORT DESCRIPTION'          20320027
203300                                   TO DP013-MESSAGE-TEXT (1)      20330027
203400              MOVE SQLCA           TO DP013-SQLCA                 20340027
203500              MOVE 'XLT_LOC'       TO DP013-DB2-TABLE-NAME (1)    20350034
203600              SET DP013-DB2-ABEND                                 20360027
203700                 DP013-XCTL-DISPLAY-RESTART                       20370027
203800                                   TO TRUE                        20380027
203900              PERFORM DP013-0000-PROCESS-ABEND                    20390027
204000     END-EVALUATE.                                                20400027
204100                                                                  20410027
204200******************************************************************20420037
204300*  CHECK TKRPRPM TO SEE IF THE DC'S NEED TO BE FLUSHED.           20430037
204400******************************************************************20440037
204500 4200A-READ-DC-FLUSH-PARM.                                        20450037
204600                                                                  20460037
204700     EXEC SQL                                                     20470037
204800          SELECT  FUNC_TXT                                        20480037
204900          INTO   :KRPRPM-FUNC-TXT                                 20490037
205000          FROM  TKRPRPM                                           20500037
205100          WHERE LOC_ID            =  90                           20510037
205200            AND SYS_PRC_FUNC_CDE  =  'FLUSH'                      20520037
205300            AND FUNC_PRC_STAT_CDE =  'AC'                         20530037
205400     END-EXEC.                                                    20540037
205500                                                                  20550037
205600     EVALUATE TRUE                                                20560037
205700         WHEN SQLCODE = +0                                        20570037
205800            IF KRPRPM-FUNC-TXT = 'N'                              20580037
205900                SET PS-DC-FLUSH-NO  TO TRUE                       20590037
206000            ELSE                                                  20600037
206100                SET PS-DC-FLUSH-YES TO TRUE                       20610037
206200            END-IF                                                20620037
206300         WHEN OTHER                                               20630037
206400                SET PS-DC-FLUSH-NO  TO TRUE                       20640037
206500     END-EVALUATE.                                                20650037
206600                                                                  20660037
206700 4200-READ-INV-PARM.                                              20670036
206800                                                                  20680027
206900         EXEC SQL                                                 20690027
207000             SELECT                                               20700027
207100                    MAX (INV_DTE)                                 20710036
207200             INTO                                                 20720027
207300                    :XLT00025-INV-DTE :PV-NULL                    20730036
207400             FROM                                                 20740027
207500                    XLT_MDSE_INV_PARM                             20750044
207600             WHERE                                                20760027
207700                    LOC_NBR           =  :DK-STORE                20770040
207800               AND  ACTV_IND          =  'Y'                      20780042
207900               AND  LOC_INV_STAT_CDE  =  'IN'                     20790040
208000         END-EXEC.                                                20800027
208100                                                                  20810027
208200         EVALUATE TRUE                                            20820027
208300             WHEN SQLCODE = ZERO                                  20830027
208400                IF PV-NULL = -1                                   20840027
208500                    SET PS-INV-STORE-NOT-FOUND TO TRUE            20850027
208600                ELSE                                              20860027
208700                    SET PS-INV-STORE-FOUND TO TRUE                20870027
208800                    MOVE XLT00025-INV-DTE TO                      20880036
208900                         PV-DB2-INV-FORMAT                        20890027
209000                END-IF                                            20900027
209100             WHEN SQLCODE = +100 OR PV-NULL = -1                  20910027
209200                  SET PS-INV-STORE-NOT-FOUND TO TRUE              20920027
209300             WHEN SQLCODE = -904                                  20930027
209400             WHEN SQLCODE = -913                                  20940027
209500                  PERFORM 9900-SOFT-ABORT                         20950027
209600             WHEN SQLWARN0 NOT = SPACES                           20960027
209700             WHEN SQLCODE NOT EQUAL ZERO                          20970027
209800                 MOVE '4200-READ-INV-PARM - 1'                    20980036
209900                                   TO DP013-PARAGRAPH             20990027
210000                 MOVE 'SELECT STORE NAME'                         21000027
210100                                   TO DP013-MESSAGE-TEXT (1)      21010027
210200                 MOVE SQLCA        TO DP013-SQLCA                 21020027
210300                 MOVE 'XLT_MDSE_INV_PARM'                         21030036
210400                                   TO DP013-DB2-TABLE-NAME (1)    21040036
210500                 SET DP013-DB2-ABEND                              21050027
210600                     DP013-XCTL-DISPLAY-RESTART                   21060027
210700                                   TO TRUE                        21070027
210800                 PERFORM DP013-0000-PROCESS-ABEND                 21080027
210900         END-EVALUATE.                                            21090027
211000                                                                  21100027
211100     IF  SQLCODE EQUAL ZERO  AND PS-INV-STORE-FOUND               21110027
211200         EXEC SQL                                                 21120027
211300             SELECT                                               21130027
211400                    DC_CTOFF_DTE                                  21140036
211500             INTO                                                 21150027
211600                    :XLT00025-DC-CTOFF-DTE                        21160036
211700             FROM                                                 21170027
211800                    XLT_MDSE_INV_PARM                             21180044
211900             WHERE                                                21190027
212000                    LOC_NBR           =  :DK-STORE                21200040
212100               AND  ACTV_IND          =  'Y'                      21210041
212200               AND  LOC_INV_STAT_CDE  =  'IN'                     21220040
212300               AND  INV_DTE = :PV-DB2-INV-FORMAT                  21230043
212400         END-EXEC                                                 21240027
212500                                                                  21250027
212600         EVALUATE TRUE                                            21260027
212700             WHEN SQLCODE = ZERO                                  21270027
212800             WHEN SQLCODE = +100                                  21280027
212900                 CONTINUE                                         21290027
213000             WHEN SQLCODE = -904                                  21300027
213100             WHEN SQLCODE = -913                                  21310027
213200                  PERFORM 9900-SOFT-ABORT                         21320027
213300             WHEN SQLWARN0 NOT = SPACES                           21330027
213400             WHEN SQLCODE NOT EQUAL ZERO                          21340027
213500                 MOVE '4200-READ-INV-PARM - 2'                    21350036
213600                                   TO DP013-PARAGRAPH             21360027
213700                 MOVE 'SELECT STORE NAME'                         21370027
213800                                   TO DP013-MESSAGE-TEXT (1)      21380027
213900                 MOVE SQLCA        TO DP013-SQLCA                 21390027
214000                 MOVE 'XLT_MDSE_INV_PARM'                         21400036
214100                                   TO DP013-DB2-TABLE-NAME (1)    21410036
214200                 SET DP013-DB2-ABEND                              21420027
214300                     DP013-XCTL-DISPLAY-RESTART                   21430027
214400                                   TO TRUE                        21440027
214500                 PERFORM DP013-0000-PROCESS-ABEND                 21450027
214600         END-EVALUATE                                             21460027
214700     END-IF.                                                      21470027
214800                                                                  21480027
214900*----------------------------------------------------------------*21490027
215000*    GET THE STORE TYPE.                                         *21500027
215100*----------------------------------------------------------------*21510027
215200 4013-GET-STORE-TYPE.                                             21520027
215300                                                                  21530027
215400     EXEC SQL                                                     21540027
215500          SELECT                                                  21550027
215600                 LOC_TYP_CDE                                      21560034
215700                ,LOC_NBR                                          21570034
215800           INTO                                                   21580027
215900                :XLT00010-LOC-TYP-CDE                             21590034
216000               ,:XLT00010-LOC-NBR                                 21600034
216100           FROM                                                   21610027
216200                 XLT_LOC                                          21620034
216300          WHERE                                                   21630027
216400                 LOC_NBR          =  :RECEIV-OPER-UNT-ID          21640035
216500     END-EXEC.                                                    21650027
216600                                                                  21660027
216700     EVALUATE TRUE                                                21670027
216800         WHEN SQLCODE = ZERO                                      21680027
216900              MOVE RC017-STR-NBR   TO DK-STR-NBR-N                21690027
217000                                      DK-STORE                    21700033
217100              IF  XLT00010-LOC-TYP-CDE EQUAL PC-DC                21710034
217200                  SET ASC-DC-STORE-TYPE                           21720027
217300                               TO  TRUE                           21730027
217400              ELSE                                                21740027
217500                  SET ASC-NOT-DC-STORE-TYPE                       21750027
217600                               TO  TRUE                           21760027
217700              END-IF                                              21770027
217800         WHEN SQLWARN0 NOT = SPACES                               21780027
217900         WHEN SQLCODE < ZERO                                      21790027
218000         WHEN SQLCODE > ZERO                                      21800027
218100             MOVE '4030-GET-STORE-TYPE'                           21810027
218200                               TO DP013-PARAGRAPH                 21820027
218300             MOVE 'GET STORE TYPE'                                21830027
218400                               TO DP013-MESSAGE-TEXT (1)          21840027
218500             MOVE SQLCA        TO DP013-SQLCA                     21850027
218600             MOVE 'XLT_LOC '   TO DP013-DB2-TABLE-NAME (1)        21860034
218700             SET DP013-DB2-ABEND                                  21870027
218800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21880027
218900             PERFORM DP013-0000-PROCESS-ABEND                     21890027
219000     END-EVALUATE.                                                21900027
219100                                                                  21910027
219200*----------------------------------------------------------------*21920027
219300*    FORMAT THE CUTOFF DATES.                                    *21930027
219400*----------------------------------------------------------------*21940027
219500                                                                  21950027
219600 2175-FMT-CUTOFF-DTS-FOR-CMPARE.                                  21960027
219700                                                                  21970030
219800     INITIALIZE  DPG51 DPG52                                      21980030
219900                 DPG53 DPG54                                      21990030
220000                 DPG55 DPG56.                                     22000030
220100                                                                  22010030
220200     PERFORM DP017-0000-GET-CURR-DATE-TIME.                       22020027
220300     MOVE DP017-CURRENT-DATE-YMD      TO DPG51-SYSTEM-DATE.       22030027
220400     SET  DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                    22040027
220500     SET  DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                    22050027
220600     MOVE ZERO                      TO DPG51-INCR-DECR-DAYS-9     22060027
220700                                       DPG51-INCR-DECR-BUS-DAYS-9.22070027
220800     SET  DPG52-LK-DTE-ISO-FMT        TO TRUE.                    22080027
220900                                                                  22090027
221000*    *------------------------------------------------------------22100027
221100*    * FORMAT THE CUTOFF DATE DATE FROM XLT_MDSE_INV_PARM         22110036
221200*    *------------------------------------------------------------22120027
221300     MOVE XLT00025-DC-CTOFF-DTE TO DPG52-LK-DATE-INPUT.           22130036
221400     MOVE '2175-FMT-CUTOFF-DTS-FOR-CMPARE'                        22140029
221500       TO PV-FROM-PARAGRAPH.                                      22150029
221600     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          22160027
221700     MOVE DPG55-DB2-ISO-DATE TO PV-ACTL-CTOFF-YYYYMMDD.           22170027
221800                                                                  22180027
221900*    *------------------------------------------------------------22190027
222000*    * FORMAT THE VERIFY DATE FORM TRECEIV.                       22200027
222100*    *------------------------------------------------------------22210027
222200     MOVE RECEIV-VERFYD-TMST  TO      PV-WORK-TMST.               22220027
222300     MOVE PV-WORK-TMST-1      TO      DPG52-LK-DATE-INPUT.        22230027
222400     MOVE '2175-FMT-CUTOFF-DTS-FOR-CMPARE'                        22240029
222500       TO PV-FROM-PARAGRAPH.                                      22250029
222600     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          22260027
222700     MOVE DPG55-DB2-ISO-DATE TO PV-VERIFY-DTE-YYYYMMDD.           22270027
222800                                                                  22280027
222900*    *------------------------------------------------------------22290027
223000*    * FORMAT THE RECEIPT DATE FORM TRECEIV.                      22300027
223100*    *------------------------------------------------------------22310027
223200     MOVE RECEIV-REC-TMST     TO      PV-WORK-TMST.               22320027
223300     MOVE PV-WORK-TMST-1      TO      DPG52-LK-DATE-INPUT.        22330027
223400     MOVE '2175-FMT-CUTOFF-DTS-FOR-CMPARE'                        22340029
223500       TO PV-FROM-PARAGRAPH.                                      22350029
223600     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          22360027
223700     MOVE DPG55-DB2-ISO-DATE TO PV-RECEIPT-DTE-YYYYMMDD.          22370027
223800                                                                  22380027
223900*    *------------------------------------------------------------22390027
224000*    * FORMAT THE CURRENT SYSTEM DATE.                            22400027
224100*    *------------------------------------------------------------22410027
224200     MOVE DP017-EDITED-DATE-YYYYMMDD TO DPG52-LK-DATE-INPUT.      22420027
224300     MOVE '2175-FMT-CUTOFF-DTS-FOR-CMPARE'                        22430029
224400       TO PV-FROM-PARAGRAPH.                                      22440029
224500     PERFORM 2180-CALL-CALENDAR-ROUTINE.                          22450027
224600     MOVE DPG55-DB2-ISO-DATE TO PV-CURRENT-DTE-YYYYMMDD.          22460027
224700                                                                  22470027
224800                                                                  22480027
224900 2180-CALL-CALENDAR-ROUTINE.                                      22490027
225000                                                                  22500030
225100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                22510030
225200                                             DPG52                22520030
225300                                             DPG53                22530030
225400                                             DPG54                22540030
225500                                             DPG55                22550030
225600                                             DPG56.               22560030
225700     EVALUATE TRUE                                                22570027
225800         WHEN DPG54-SEVERE-ERROR                                  22580027
225900         WHEN DPG54-DATE-INVALID                                  22590027
226000             MOVE PV-FROM-PARAGRAPH                               22600029
226100                                   TO  DP013-PARAGRAPH            22610027
226200             MOVE 'ERROR DETECTED BY CALENDAR ROUTINE:'           22620027
226300                                   TO  DP013-MESSAGE-TEXT (1)     22630027
226400             MOVE DPG54-ERROR-MESSAGE                             22640027
226500                                   TO  DP013-MESSAGE-TEXT (2)     22650027
226600             SET DP013-LOGIC-ABEND TO  TRUE                       22660027
226700             PERFORM DP013-0000-PROCESS-ABEND                     22670027
226800     END-EVALUATE.                                                22680027
226900                                                                  22690027
227000/                                                                 22700027
227100*----------------------------------------------------------------*22710027
227200*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *22720027
227300*----------------------------------------------------------------*22730027
227400                                                                  22740027
227500 4400-MOVE-COMMAREA-TO-SCREEN.                                    22750027
227600                                                                  22760027
227700     IF  PS-SOFT-ABORT                                            22770027
227800         MOVE PC-TSYMSG-00551      TO  DP020-MSG-NUMBER           22780027
227900     END-IF.                                                      22790027
228000                                                                  22800027
228100     MOVE ASC-TRB-QUEUE-NAME       TO  RC017-TRB-QUEUE-NAME.      22810027
228200     MOVE ASC-KEY-FCLTY-ID         TO  AFCLTYO.                   22820027
228300     MOVE ASC-FCLTY-NME            TO  AFCNAMEO.                  22830027
228400                                                                  22840027
228500     MOVE ASC-KEY-PO-NBR           TO  PV-PO-NBR.                 22850027
228600     MOVE ASC-KEY-REC-SEQ-NBR      TO  PV-REC-SEQ-NBR.            22860027
228700     MOVE PV-DISPLAY-PO            TO  APORECO.                   22870027
228800     MOVE ASC-KEY-OPER-UNT-ID      TO  AOPIDO.                    22880027
228900                                                                  22890027
229000     MOVE ASC-TRBL-RSN-CDE         TO  ATRBRSNO.                  22900027
229100     MOVE ASC-TRBL-LONG-DESC       TO  ATRBDESO.                  22910027
229200                                                                  22920027
229300     MOVE ASC-TEXT1                TO  ATEXT1O.                   22930027
229400     MOVE ASC-TEXT2                TO  ATEXT2O.                   22940027
229500     MOVE ASC-TEXT3                TO  ATEXT3O.                   22950027
229600     MOVE ASC-TEXT4                TO  ATEXT4O.                   22960027
229700     MOVE ASC-TEXT5                TO  ATEXT5O.                   22970027
229800/                                                                 22980027
229900*----------------------------------------------------------------*22990027
230000*    FIRST, PREPARE AND INSERT THE NOTIFICATION ROW, NEXT        *23000027
230100*    PREPARE AND INSERT THE TROUBLE DETAIL ROW.                  *23010027
230200*----------------------------------------------------------------*23020027
230300                                                                  23030027
230400 5000-BEGIN-CREATE-PROCESS.                                       23040027
230500                                                                  23050027
230600     INITIALIZE TM003-TRB-QUEUE-WORK-AREA.                        23060027
230700                                                                  23070027
230800     MOVE ASC-TRB-QUEUE-NAME       TO  RC017-TRB-QUEUE-NAME.      23080027
230900     MOVE ASC-KEY-NOTIF-NBR        TO  TM003-NOTIF-NBR.           23090027
231000     MOVE ASC-KEY-OPER-UNT-ID      TO  TM003-OPER-UNT-ID.         23100027
231100     MOVE ASC-KEY-FCLTY-ID         TO  TM003-FCLTY-ID.            23110027
231200                                                                  23120027
231300     MOVE ASC-KEY-PO-NBR           TO  TM003-PO-NBR.              23130027
231400                                                                  23140027
231500     MOVE ASC-KEY-REC-SEQ-NBR      TO  TM003-REC-SEQ-NBR.         23150027
231600     MOVE ASC-TRBL-RSN-CDE         TO  TM003-TRBL-RSN-CDE.        23160027
231700                                                                  23170027
231800     MOVE DP020-USERID             TO  TM003-CRE-UID              23180027
231900                                       TM003-NOTIF-UID.           23190027
232000                                                                  23200027
232100     STRING ASC-TEXT1                                             23210027
232200            ASC-TEXT2                                             23220027
232300            ASC-TEXT3                                             23230027
232400            ASC-TEXT4                                             23240027
232500            ASC-TEXT5 DELIMITED BY SIZE                           23250027
232600                                 INTO  TM003-FREEFORM-TEXT.       23260027
232700                                                                  23270027
232800     PERFORM 9300-WRITE-TRB-QUEUE.                                23280027
232900                                                                  23290027
233000 5070-FORMAT-ERROR.                                               23300027
233100                                                                  23310027
233200     SET PS-ERROR                                                 23320027
233300         DP020-MSG-FATAL           TO  TRUE.                      23330027
233400     STRING 'NNNNN-E-'                                            23340027
233500            TM500-RETURN-MSG                                      23350027
233600            '-'                                                   23360027
233700            TM500-RETURN-CODE                                     23370027
233800            ', SQLCODE='                                          23380027
233900            TM500-SQLCODE DELIMITED BY SIZE                       23390027
234000                                 INTO  DP020-MSG-MESSAGE.         23400027
234100/                                                                 23410027
234200*----------------------------------------------------------------*23420027
234300* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *23430027
234400* OBJECT WAS UPDATED.                                            *23440027
234500*----------------------------------------------------------------*23450027
234600                                                                  23460027
234700 9000-UPDATE-SELECTION-QUEUE.                                     23470027
234800                                                                  23480027
234900     PERFORM 9100-READ-SEL-QUEUE.                                 23490027
235000     SET RC013-UPD (ASC-SEL-SUB) TO TRUE.                         23500027
235100     PERFORM 9200-REWRITE-SEL-QUEUE.                              23510027
235200/                                                                 23520027
235300*----------------------------------------------------------------*23530027
235400* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23540027
235500*----------------------------------------------------------------*23550027
235600                                                                  23560027
235700 9100-READ-SEL-QUEUE.                                             23570027
235800                                                                  23580027
235900     EXEC CICS                                                    23590027
236000         READQ TS                                                 23600027
236100             QUEUE (ASC-SEL-QUEUE-NAME)                           23610027
236200             INTO  (RC013-DC-SELECT-RECORD)                       23620027
236300             ITEM  (ASC-SEL-ITEM)                                 23630027
236400             RESP  (PV-CICS-RESPONSE)                             23640027
236500     END-EXEC.                                                    23650027
236600                                                                  23660027
236700     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   23670027
236800         CONTINUE                                                 23680027
236900     ELSE                                                         23690027
237000         SET DP013-LOGIC-ABEND                                    23700027
237100             DP013-NO-ROLLBACK     TO TRUE                        23710027
237200         MOVE '9100-READ-SEL-QUEUE'                               23720027
237300                                   TO DP013-PARAGRAPH             23730027
237400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   23740027
237500                                   TO DP013-MESSAGE-TEXT (1)      23750027
237600         PERFORM DP013-0000-PROCESS-ABEND                         23760027
237700     END-IF.                                                      23770027
237800                                                                  23780027
237900*----------------------------------------------------------------*23790027
238000* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *23800027
238100*----------------------------------------------------------------*23810027
238200                                                                  23820027
238300 9200-REWRITE-SEL-QUEUE.                                          23830027
238400                                                                  23840027
238500     EXEC CICS                                                    23850027
238600          WRITEQ TS                                               23860027
238700              QUEUE  (ASC-SEL-QUEUE-NAME)                         23870027
238800              FROM   (RC013-DC-SELECT-RECORD)                     23880027
238900              ITEM   (ASC-SEL-ITEM)                               23890027
239000              RESP   (PV-CICS-RESPONSE)                           23900027
239100     END-EXEC.                                                    23910027
239200                                                                  23920027
239300     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               23930027
239400         SET DP013-CICS-ABEND                                     23940027
239500             DP013-NO-ROLLBACK     TO TRUE                        23950027
239600         MOVE '9200-REWRITE-SEL-QUEUE'                            23960027
239700                                   TO DP013-PARAGRAPH             23970027
239800         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   23980027
239900                                   TO DP013-MESSAGE-TEXT (1)      23990027
240000         PERFORM DP013-0000-PROCESS-ABEND                         24000027
240100     END-IF.                                                      24010027
240200/                                                                 24020027
240300 9300-WRITE-TRB-QUEUE.                                            24030027
240400                                                                  24040027
240500     ADD  +1                       TO PV-TRB-QUEUE-ITEM.          24050027
240600                                                                  24060027
240700     EXEC CICS                                                    24070027
240800          WRITEQ TS                                               24080027
240900              QUEUE  (ASC-TRB-QUEUE-NAME)                         24090027
241000              FROM   (TM003-TRB-QUEUE-WORK-AREA)                  24100027
241100              ITEM   (PV-TRB-QUEUE-ITEM)                          24110027
241200              RESP   (PV-CICS-RESPONSE)                           24120027
241300     END-EXEC.                                                    24130027
241400                                                                  24140027
241500     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               24150027
241600         SET DP013-CICS-ABEND                                     24160027
241700             DP013-NO-ROLLBACK     TO TRUE                        24170027
241800         MOVE '9300-WRITE-TRB-QUEUE  '                            24180027
241900                                   TO DP013-PARAGRAPH             24190027
242000         MOVE 'ATTEMPTING TO WRITE THE TROUBLE QUEUE          '   24200027
242100                                   TO DP013-MESSAGE-TEXT (1)      24210027
242200         PERFORM DP013-0000-PROCESS-ABEND                         24220027
242300     END-IF.                                                      24230027
242400 9400-DELETE-TRB-QUEUE.                                           24240027
242500                                                                  24250027
242600     EXEC CICS                                                    24260027
242700         DELETEQ TS                                               24270027
242800             QUEUE (ASC-TRB-QUEUE-NAME)                           24280027
242900             RESP  (PV-CICS-RESP)                                 24290027
243000     END-EXEC.                                                    24300027
243100                                                                  24310027
243200     IF (PV-CICS-RESP = DFHRESP(NORMAL)                           24320027
243300     OR  PV-CICS-RESP = DFHRESP(QIDERR))                          24330027
243400         CONTINUE                                                 24340027
243500     ELSE                                                         24350027
243600         SET DP013-CICS-ABEND      TO TRUE                        24360027
243700         SET DP013-NO-ROLLBACK     TO TRUE                        24370027
243800                                                                  24380027
243900         MOVE '9400-DELETE-TRB-QUEUE'                             24390027
244000                                   TO DP013-PARAGRAPH             24400027
244100         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    24410027
244200                                   TO DP013-MESSAGE-TEXT (1)      24420027
244300         PERFORM DP013-0000-PROCESS-ABEND                         24430027
244400     END-IF.                                                      24440027
244500                                                                  24450027
244600******************************************************************24460027
244700* READ AN ITEM FROM THE INPUT TROUBLE RECORD                     *24470027
244800* TEMP STORAGE QUEUE.                                            *24480027
244900******************************************************************24490027
245000 9600-READ-TRB-QUEUE.                                             24500027
245100     ADD  +1                       TO PV-TRB-QUEUE-ITEM.          24510027
245200                                                                  24520027
245300     EXEC CICS                                                    24530027
245400         READQ TS                                                 24540027
245500             QUEUE (ASC-TRB-QUEUE-NAME)                           24550027
245600             INTO  (TM003-TRB-QUEUE-WORK-AREA)                    24560027
245700             ITEM   (PV-TRB-QUEUE-ITEM)                           24570027
245800             RESP  (PV-CICS-RESP)                                 24580027
245900     END-EXEC.                                                    24590027
246000                                                                  24600027
246100     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        24610027
246200         CONTINUE                                                 24620027
246300     ELSE                                                         24630027
246400         SET DP013-LOGIC-ABEND                                    24640027
246500             DP013-NO-ROLLBACK   TO TRUE                          24650027
246600         MOVE '9600-READ-TRB-QUEUE'                               24660027
246700                                 TO DP013-PARAGRAPH               24670027
246800         MOVE 'ATTEMPTING TO READ TO LIST SELECTIONS TS QUEUE'    24680027
246900                                 TO DP013-MESSAGE-TEXT (1)        24690027
247000         PERFORM DP013-0000-PROCESS-ABEND                         24700027
247100     END-IF.                                                      24710027
247200                                                                  24720027
247300/                                                                 24730027
247400*----------------------------------------------------------------*24740027
247500*    THE DB2 RESOURCE IS NOT AVAILABLE, SET THE ERROR MESSAGE    *24750027
247600*    AND THE ERROR SWITCHES.                                     *24760027
247700*----------------------------------------------------------------*24770027
247800                                                                  24780027
247900 9900-SOFT-ABORT.                                                 24790027
248000                                                                  24800027
248100     SET PS-ERROR                                                 24810027
248200         PS-SOFT-ABORT           TO  TRUE.                        24820027
248300     SET DP020-MSG-FATAL         TO  TRUE.                        24830027
248400     MOVE PC-TSYMSG-00551        TO  DP020-MSG-NUMBER.            24840027
248500/                                                                 24850027
248600*----------------------------------------------------------------*24860027
248700*    DATE/TIME SUBROUTINE.                                       *24870027
248800*----------------------------------------------------------------*24880027
248900                                                                  24890027
249000     COPY DPPD017.                                                24900032
249100/                                                                 24910027
249200*----------------------------------------------------------------*24920027
249300*    ABEND PROCESSOR MODULE                                      *24930027
249400*----------------------------------------------------------------*24940027
249500                                                                  24950027
249600     COPY DPPD013.                                                24960032
