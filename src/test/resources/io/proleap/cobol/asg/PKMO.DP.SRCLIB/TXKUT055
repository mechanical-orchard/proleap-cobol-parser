000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.               TXKUT055.                              00020000
000300 AUTHOR.                   CHUCK HERO.                            00030000
000400 INSTALLATION.             KOHLS DEPARTMENT STORES.               00040000
000500 DATE-WRITTEN.             MARCH 2009.                            00050000
000600 DATE-COMPILED.                                                   00060000
000610                                                                  00070000
000700*----------------------------------------------------------------*00080000
000800*  PROGRAM NARRATIVE:                                            *00090000
000900*     THIS PROGRAM CREATES A SKU FORMATTED FILE FROM THE ITEM    *00100000
000910*     UPDATE FILE BY LOCATION.                                   *00110000
000910*     IT IS A COPY OF TXKUT917, MODIFIED TO PRODUCE AN OUTPUT    *00120000
000910*     FILE FORMATTED FOR THE STORE SKU TABLE, IN SQL SERVER.     *00130000
001000*                                                                *00140000
001100*  CHANGES: NAME              -  DATE                            *00150000
001200*       DESCRIPTION                                              *00160000
001300*----------------------------------------------------------------*00170000
001400 ENVIRONMENT DIVISION.                                            00180000
001600                                                                  00190000
001700 CONFIGURATION SECTION.                                           00200000
001800                                                                  00210000
001900 SOURCE-COMPUTER.    IBM-3090.                                    00220000
002000 OBJECT-COMPUTER.    IBM-3090.                                    00230000
002100                                                                  00240000
002200                                                                  00250000
002300 INPUT-OUTPUT SECTION.                                            00260000
002400                                                                  00270000
002500 FILE-CONTROL.                                                    00280000
002600                                                                  00290000
002710     SELECT EP-CONTROL-FILE            ASSIGN TO INP01.           00300000
002730     SELECT ITEM-LOC-FILE              ASSIGN TO INP02.           00310000
002800     SELECT TAX-SKU-OUTPUT-FILE        ASSIGN TO OUT01.           00320000
003000                                                                  00330000
003100 DATA DIVISION.                                                   00340000
003200                                                                  00350000
003300 FILE SECTION.                                                    00360000
003400                                                                  00370000
003910 FD  EP-CONTROL-FILE                                              00380000
003920     RECORDING MODE IS F                                          00390000
003930     BLOCK CONTAINS 0                                             00400000
003940     LABEL RECORDS ARE STANDARD.                                  00410000
003950 01  EP-CONTROL-RECORD              PIC X(80).                    00420000
004000                                                                  00430000
004052 FD  ITEM-LOC-FILE                                                00440000
004053     RECORDING MODE IS F                                          00450000
004054     BLOCK CONTAINS 0                                             00460000
004055     LABEL RECORDS ARE STANDARD.                                  00470000
004056 01  ITEM-LOC-RECORD                  PIC X(20).                  00480000
004060                                                                  00490000
004100 FD  TAX-SKU-OUTPUT-FILE                                          00500000
004200     RECORDING MODE IS F                                          00510000
004300     BLOCK CONTAINS 0                                             00520000
004400     LABEL RECORDS ARE STANDARD.                                  00530000
004500 01  TAX-SKU-OUTPUT-RECORD            PIC X(170).                 00540000
004700                                                                  00550000
004800 WORKING-STORAGE SECTION.                                         00560000
004801                                                                  00570000
005300 01  PC-PROGRAM-CONSTANTS.                                        00580000
005700     05  PC-PROGRAM-NAME               PIC X(08)   VALUE          00590000
005800         'TXKUT055'.                                              00600000
005900     05  PC-ABEND-MSSG                 PIC X(12)   VALUE          00610000
006000         '** ABEND ** '.                                          00620000
006300     05  PC-DB-ATTEMPTING-MSSG         PIC X(14)   VALUE          00630000
006400         'ATTEMPTING TO '.                                        00640000
006500     05  PC-STR-GRP-TYP-CDE            PIC 9(05)   VALUE  05000.  00650000
007000                                                                  00660000
007100 01  PS-PROCESS-SWITCHES.                                         00670000
007500     05  PS-END-OF-CONTROL-FILE-SW     PIC X(01)   VALUE 'N'.     00680000
007600         88  PS-END-OF-CONTROL-FILE                VALUE 'Y'.     00690000
007610     05  PS-END-OF-ITEM-LOC-FILE-SW    PIC X(01)   VALUE 'N'.     00700000
007620         88  PS-END-OF-ITEM-LOC-FILE               VALUE 'Y'.     00710000
007700                                                                  00720000
007710 01  PV-PROGRAM-VARIABLES.                                        00730000
007730     05  PV-PARAGRAPH-NAME             PIC X(50)   VALUE SPACES.  00740000
007751     05  PV-NEW-DTE                    PIC X(10)   VALUE SPACES.  00750000
007780     05  PV-RECS-READ                  PIC S9(09)  COMP           00760000
007790                                                   VALUE ZEROS.   00770000
007791     05  PV-RECS-WRITTEN               PIC S9(09)  COMP           00780000
007792                                                   VALUE ZEROS.   00790000
007793     05  PV-INTR-UPC                   PIC  9(12)  COMP-3         00800000
007794                                                   VALUE ZEROS.   00810000
007795*    05  PV-INTR-UNSIGNED REDEFINES PV-INTR-UPC PIC 9(09) COMP.   00820000
007798                                                                  00830000
010131     05  PV-TAX-PARM-CDE.                                         00840000
010132         10  PV-TAX-PARM-CDE-1     PIC X(01)  VALUE '0'.          00850000
010133         10  PV-TAX-PARM-CDE-2     PIC X(01)  VALUE SPACES.       00860000
007798                                                                  00870000
007799 01  ABEND-CODE                        PIC S9(04)  COMP           00880000
007800                                                   VALUE ZEROS.   00890000
007801     88  ABEND-4003-INVALID-CC-DATE                VALUE +4003.   00900000
007808                                                                  00910000
008800*----------------------------------------------------------------*00920000
008900*    COPYBOOK FOR DPKUT500                                        00930000
009000*----------------------------------------------------------------*00940000
009100     COPY DPWS500.                                                00950000
009101                                                                  00960000
009110*----------------------------------------------------------------*00970000
009120*    COPYBOOK FOR CONTROL CARD EPCC112                            00980000
009130*----------------------------------------------------------------*00990000
009140     COPY EPWS112.                                                01000000
009141                                                                  01010000
009142*----------------------------------------------------------------*01020000
009143*    COPYBOOK FOR SKU FILE OUTPUT                                 01030000
009144*----------------------------------------------------------------*01040000
009145     COPY EPRD219.                                                01050000
009146                                                                  01060000
009190*----------------------------------------------------------------*01070000
009200*    COPYBOOK FOR INPUT RECORD LAYOUT                             01080000
009201*----------------------------------------------------------------*01090000
009202     COPY TXRD915.                                                01100000
009203                                                                  01110000
014410******************************************************************01120000
014500 PROCEDURE DIVISION.                                              01130000
014600******************************************************************01140000
014900                                                                  01150000
015000     PERFORM  1000-INITIALIZE.                                    01160000
015010                                                                  01170000
015020     PERFORM  1100-VALIDATE-DATE.                                 01180000
015030                                                                  01190000
015120     PERFORM  7000-READ-ITEM-LOC-FILE.                            01200000
015130                                                                  01210000
015400     PERFORM  2000-PROCESS                                        01220000
015500         UNTIL PS-END-OF-ITEM-LOC-FILE.                           01230000
015510                                                                  01240000
015801     DISPLAY 'PROGRAM NAME = '          PC-PROGRAM-NAME           01250000
015802     DISPLAY 'TOTAL RECORDS READ = '    PV-RECS-READ              01260000
015803     DISPLAY 'TOTAL RECORDS WRITTEN = ' PV-RECS-WRITTEN           01270000
015804                                                                  01280000
015810     CLOSE EP-CONTROL-FILE                                        01290000
015830           ITEM-LOC-FILE                                          01300000
015900           TAX-SKU-OUTPUT-FILE.                                   01310000
016000                                                                  01320000
016100     GOBACK.                                                      01330000
016110                                                                  01340000
016200*----------------------------------------------------------------*01350000
016300*   1000-INITIALIZE - OPEN THE TAX EXTRACT CURSOR                 01360000
016400*----------------------------------------------------------------*01370000
016500 1000-INITIALIZE.                                                 01380000
016600                                                                  01390000
016610     OPEN INPUT  EP-CONTROL-FILE                                  01400000
016612                 ITEM-LOC-FILE                                    01410000
016614          OUTPUT TAX-SKU-OUTPUT-FILE.                             01420000
016615                                                                  01430000
016616     READ EP-CONTROL-FILE INTO CC-EPCC112-CONTROL-CARD            01440000
016621         AT END SET PS-END-OF-CONTROL-FILE  TO TRUE.              01450000
016622                                                                  01460000
016630*----------------------------------------------------------------*01470000
016631* 1100-VALIDATE-DATE CHECKS CONTROL CARD DATE FOR VALID DATE      01480000
016632*----------------------------------------------------------------*01490000
016633 1100-VALIDATE-DATE.                                              01500000
016634                                                                  01510000
016635     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         01520000
016636     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01530000
016637     SET DPG52-LK-DTE-ISO-FMT        TO TRUE.                     01540000
016638                                                                  01550000
016641     MOVE CC-EPCC112-TOMORROW-DATE TO DPG52-LK-DATE-INPUT.        01560000
016642                                                                  01570000
016643     CALL DP500-KOHLS-CALENDAR-ROUTINE                            01580000
016644          USING DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01590000
016645                                                                  01600000
016646     EVALUATE TRUE                                                01610000
016647         WHEN DPG54-NO-ERROR                                      01620000
016648             CONTINUE                                             01630000
016649         WHEN OTHER                                               01640000
016650             DISPLAY '** ABEND **'                                01650000
016651             DISPLAY PC-PROGRAM-NAME          ' - INVALID '       01660000
016652                       'PROCESS DATE PROVIDED '                   01670000
016653             DISPLAY PC-PROGRAM-NAME          ' - INVALID '       01680000
016654             DISPLAY 'DATE :  ' CC-EPCC112-TOMORROW-DATE          01690000
016656             SET ABEND-4003-INVALID-CC-DATE TO TRUE               01700000
016657             CALL 'ILBOABN0' USING ABEND-CODE                     01710000
016658     END-EVALUATE.                                                01720000
016659                                                                  01730000
025210*----------------------------------------------------------------*01740000
025300* 2000-PROCESS  - CHECK RECORD FOR TAX PARM CODE OF '1' AND       01750000
025310*       RECORD TYPE OF 'N' - SKIPS THESE, ALL OTHERS ARE          01760000
025320*       FORMATTED IN PLU FORMAT AND WRITTEN OUT.                  01770000
025400*----------------------------------------------------------------*01780000
025500 2000-PROCESS.                                                    01790000
026102                                                                  01800000
026103     IF ((TX915-TX-PARM-CDE = '1') AND                            01810000
026104       (TX915-REC-TYPE = 'N'))                                    01820000
026105       CONTINUE                                                   01830000
026106     ELSE                                                         01840000
026107       INITIALIZE EP219-XST-SKU-RECORD                            01850000
026109       SET  EP219-FILE-CHANGE          TO TRUE                    01860000
026111       MOVE PC-STR-GRP-TYP-CDE       TO EP219-STR-GRP-TYP-CDE     01870000
026112       MOVE TX915-LOC-NBR            TO EP219-STR-GRP-ID          01880000
026114       MOVE CC-EPCC112-TOMORROW-DATE TO EP219-PRICG-EFFECT-DTE    01890000
026115       SET  EP219-APPLY-NIGHTLY        TO TRUE                    01900000
026118                                                                  01910000
026116       SET  EP219-RECORD-UPDATE        TO TRUE                    01920000
026118*-------                                                          01930000
026122       SET  EP219-SKU-NBR-YES          TO TRUE                    01940000
026123       MOVE TX915-SKU-NBR            TO EP219-SKU-NBR             01950000
026118*-------                                                          01960000
026117       SET  EP219-INTR-UPC-ID-YES      TO TRUE                    01970000
026119       MOVE TX915-INTR-UPC-ID        TO PV-INTR-UPC               01980000
026120       MOVE PV-INTR-UPC              TO EP219-INTR-UPC-ID         01990000
026121*-------                                                          02000000
026124       SET  EP219-MDSE-TX-CDE-YES      TO TRUE                    02010000
026130       MOVE TX915-TX-PARM-CDE        TO PV-TAX-PARM-CDE-2         02020000
026130       MOVE PV-TAX-PARM-CDE          TO EP219-MDSE-TX-CDE         02030000
026121*-------                                                          02040000
026124       SET  EP219-SKU-DESC-NO          TO TRUE                    02050000
003800       SET  EP219-E-BUS-ITM-IND-NO     TO TRUE                    02060000
004200       SET  EP219-E-BUS-PRD-GP-NBR-NO  TO TRUE                    02070000
004600       SET  EP219-NRF-CLOR-DESC-NO     TO TRUE                    02080000
005000       SET  EP219-SIZE-DESC-NO         TO TRUE                    02090000
005400       SET  EP219-TAX-PRD-CDE-NO       TO TRUE                    02100000
006200       SET  EP219-MKDN-SGN-CDE-NO      TO TRUE                    02110000
006600       SET  EP219-STYL-ID-NO           TO TRUE                    02120000
007000       SET  EP219-DMY-SKU-IND-NO       TO TRUE                    02130000
026349                                                                  02140000
026347       PERFORM  8000-WRITE-TAX-FILE                               02150000
026348     END-IF.                                                      02160000
026349                                                                  02170000
026352     PERFORM  7000-READ-ITEM-LOC-FILE.                            02180000
026353                                                                  02190000
026354*----------------------------------------------------------------*02200000
026355* 7000-READ-ITEM-LOC-FILE                                         02210000
026356*----------------------------------------------------------------*02220000
026357 7000-READ-ITEM-LOC-FILE.                                         02230000
026358                                                                  02240000
026359     READ ITEM-LOC-FILE INTO TX915-TAX-ITEM-RECORD                02250000
026360         AT END SET PS-END-OF-ITEM-LOC-FILE TO TRUE               02260000
026361         NOT AT END ADD +1 TO PV-RECS-READ.                       02270000
026363                                                                  02280000
026370*----------------------------------------------------------------*02290000
026400* 8000-WRITE-TAX-FILE                                             02300000
026500*----------------------------------------------------------------*02310000
026600 8000-WRITE-TAX-FILE.                                             02320000
026700                                                                  02330000
026800     WRITE TAX-SKU-OUTPUT-RECORD FROM EP219-XST-SKU-RECORD.       02340000
026900                                                                  02350000
026910     ADD +1 TO PV-RECS-WRITTEN.                                   02360000
026920                                                                  02370000
027010*********************  END OF PROGRAM  ***************************02380000
