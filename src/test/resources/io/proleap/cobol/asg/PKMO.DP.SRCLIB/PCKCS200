000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    PCKCS200.                                         00020000
000300 AUTHOR.        MARY SARDINA.                                     00030000
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
000500 DATE-WRITTEN.  MAY 1996.                                         00050000
000600 DATE-COMPILED.                                                   00060000
000700******************************************************************00070000
000800******************************************************************00080000
000900*    TRANSACTION - E200   COMMAREA - RCWS289 COPYBOOK            *00090000
001000**   4/2004 PROGRAM HAS BEEN CHANGED TO BE A TRAFFICKING         *00100000
001100**   PROGRAM. BASED ON THE RCVR TYPE, THE PROGRAM WILL START THE *00110000
001200**   APPROPRIATE TRANSACTION. PCKCS760 (E760) IS THE NEW         *00120000
001300**   VERIF PROGRAM FOR NON PACK BY STRORE ORDERS. PCKCS761(E761) *00130000
001400**   WILL VERIFY PACK BY STORE ORDERS.                           *00140000
001500**   THIS PROGRAM IS STARTED BY ONE OF THE FOLLOWING PROGRAMS:    00150000
001600**                                                                00160000
001700**        PCKCS107 DISTRIBUTION COMPLETE AL PACK TO LIGHT         00170000
001800**        PCKCS722 DISTRIBUTION COMPLETE PCC PACK TO LIGHT        00180000
001900**        RCKCS291 SWEEPER PROGRAM                                00190000
002000**        RCKCS297 RC CONFIRM/VERIFY BY LINE                      00200000
002100**        RCKCS815 RCVR CHECK-IN LIST F22-UNLOAD TRAILER          00210000
002200**        RCKUT125 CONFIRMATION MODULE                            00220000
002300**        SUKUT707 TRIGGERED FROM CHECK-IN SCAN                   00230000
002400******************************************************************00240000
002500*                                                                 00250000
002600 ENVIRONMENT DIVISION.                                            00260000
002700*                                                                 00270000
002800 CONFIGURATION SECTION.                                           00280000
002900*                                                                 00290000
003000 SOURCE-COMPUTER.        IBM-3090.                                00300000
003100 OBJECT-COMPUTER.        IBM-3090.                                00310000
003200*                                                                 00320000
003300******************************************************************00330000
003400 DATA DIVISION.                                                   00340000
003500******************************************************************00350000
003600*                                                                 00360000
003700******************************************************************00370000
003800 WORKING-STORAGE SECTION.                                         00380000
003900******************************************************************00390000
004000                                                                  00400000
004100 01  DK-DB2-KEYS.                                                 00410000
004200     05  DK-ORD-NBR              PIC S9(9) VALUE ZERO COMP SYNC.  00420000
004300     05  DK-REC-SEQ-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00430000
004400     05  DK-ORD-LNE-NBR          PIC S9(9) VALUE ZERO COMP SYNC.  00440000
004500     05  DK-CURR-OPER-UNT-ID     PIC S9(4) VALUE ZERO COMP SYNC.  00450000
004510     05  DK-LOC-ID               PIC S9(4) VALUE ZERO COMP SYNC.  00451003
004600                                                                  00460000
004700******************************************************************00470000
004800* PS PROGRAM SWITCHES                                            *00480000
004900******************************************************************00490000
005000 01  PS-PROGRAM-SWITCHES.                                         00500000
005100     05  PS-AUTO-VE-SW                  PIC  X(01)  VALUE 'Y'.    00510000
005200         88  PS-AUTO-VE-YES                         VALUE 'Y'.    00520000
005300         88  PS-AUTO-VE-NO                          VALUE 'N'.    00530000
005400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00540000
005500         88  PS-NO-ERROR                            VALUE 'Y'.    00550000
005600         88  PS-ERROR                               VALUE 'N'.    00560000
005700     05  PS-DATA-OK-SW                  PIC  X(01)  VALUE 'Y'.    00570000
005800         88  PS-DATA-OK                             VALUE 'Y'.    00580000
005900         88  PS-DATA-NOT-OK                         VALUE 'N'.    00590000
005910     05  PS-DISPLAY-CSSL-SW             PIC  X(01)  VALUE 'N'.    00591003
005920         88  PS-DISPLAY-CSSL-YES                    VALUE 'Y'.    00592003
005930         88  PS-DISPLAY-CSSL-NO                     VALUE 'N'.    00593003
006000******************************************************************00600000
006100* COMMAREA PASSED TO THE PROGRAM FROM PCKS107 AND RCKCS291       *00610000
006200******************************************************************00620000
006300                                                                  00630000
006400     COPY RCWS289.                                                00640000
006500                                                                  00650000
006600***************************************************************** 00660000
006700*   RCWS040 - IS THE LAYOUT THAT IS USED TO PASS INFO TO THE    * 00670000
006800*             AUTOVERIFY (AUTOVE) ELIGIBILITY MODULE (RCKUT127).* 00680000
006900***************************************************************** 00690000
007000     COPY RCWS040.                                                00700000
007100                                                                  00710000
007200******************************************************************00720000
007300* PV PROGRAM VARIABLES                                           *00730000
007400******************************************************************00740000
007500 01  PV-PROGRAM-VARIABLES.                                        00750000
007600     05  PV-CICS-MSG-AREA-2              PIC  X(100) VALUE SPACE. 00760000
007700     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00770000
007800                                                     COMP SYNC.   00780000
007900     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +12    00790000
008000                                                     COMP SYNC.   00800000
008100     05  PV-WRK-ORD-SEQ-NBR              PIC  S9(4)  COMP         00810000
008200                                                     VALUE ZEROS. 00820000
008300     05  PV-FCLTY-ID                     PIC  S9(4)  COMP         00830000
008400                                                     VALUE +1.    00840000
008500     05  PV-TASK-X.                                               00850000
008600         10  PV-TASK                     PIC   9(7)  VALUE ZERO.  00860000
008700     05  PV-CLENG                        PIC   9(4)  COMP         00870000
008800                                                     VALUE ZEROS. 00880000
008900     05  PV-STATUS-CDE                   PIC   X(02)              00890000
009000                                                     VALUE SPACES.00900000
009100     05  PV-CURRENT-TIMESTAMP            PIC  X(26)  VALUE SPACES.00910000
009200     05  PV-CICS-MSG-AREA                PIC  X(95)  VALUE SPACE. 00920000
009300                                                                  00930000
009400     05  PV-ODD-UNT-QTY-DISPLAY          PIC  9(08)  VALUE ZEROES.00940000
009500     05  PV-ORD-NBR-DISPLAY              PIC  9(08)  VALUE ZEROES.00950000
009600     05  PV-REC-SEQ-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.00960000
009700     05  PV-ORD-LNE-NBR-DISPLAY          PIC  9(04)  VALUE ZEROES.00970000
009800     05  PV-OPER-UNT-ID-DISPLAY          PIC  9(04)  VALUE ZEROES.00980000
009900     05  PV-STORE-NBR-DISPLAY            PIC  9(04)  VALUE ZEROES.00990000
010000     05  PV-FCLTY-ID-DISPLAY             PIC  9(04)  VALUE ZEROES.01000000
010100     05  PV-ID-NBR-DISPLAY               PIC  X(04)  VALUE SPACES.01010000
010200     05  PV-RECITM-PREPK-DISPLAY         PIC  9(04)  VALUE ZEROES.01020000
010300     05  PV-DEPT-NBR-PIC9                PIC  9(03)  VALUE ZEROES.01030000
010400                                                                  01040000
010500     05  PV-NULL-IND                     PIC S9(04)  VALUE +0     01050000
010600                                                     COMP SYNC.   01060000
010700     05  PV-ERROR-ORD-NBR                PIC  9(08)  VALUE ZEROS. 01070000
010800     05  PV-ERROR-RCVR-SEQ-NBR           PIC  9(04)  VALUE ZEROS. 01080000
010900     05  PV-ERROR-ORD-LNE-NBR            PIC  9(04)  VALUE ZEROS. 01090000
011000     05  PV-ERROR-STR-NBR                PIC  9(04)  VALUE ZEROS. 01100000
011100     05  PV-ERROR-OPER-UNT-ID            PIC  9(04)  VALUE ZEROS. 01110000
011110     05  PV-ERROR-CURR-OPER-UNT-ID       PIC  9(04)  VALUE ZEROS. 01111000
011200     05  PV-ERROR-STATUS                 PIC  X(01)  VALUE SPACE. 01120000
011300     05  PV-ERROR-SOURCE                 PIC  X(02)  VALUE SPACE. 01130000
011400                                                                  01140000
011500******************************************************************01150000
011600* PC PROGRAM CONSTANTS                                           *01160000
011700******************************************************************01170000
011800 01  PC-PROGRAM-CONSTANTS.                                        01180000
011900     05  PC-FA-HANDLER-PGM          PIC  X(08)  VALUE 'SUKUT705'. 01190000
012000     05  PC-ZERO                      PIC S9(09) VALUE ZERO       01200000
012100                                                    COMP.         01210000
012200     05  PV-DB2-COUNT                 PIC S9(9)  VALUE +0         01220000
012300                                                    COMP-3.       01230000
012400     05  PV-COUNT-DISPLAY             PIC  9(9)  VALUE ZERO.      01240000
012500     05  PC-DPKUT038                  PIC  X(08) VALUE            01250000
012600         'DPKUT038'.                                              01260000
012700     05  PC-CURRENT-JOB-NAME          PIC  X(04) VALUE            01270000
012800         'CICS'.                                                  01280000
012900     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08) VALUE 'PCKCS200'.01290000
013000     05  PC-CURRENT-OPERATING-COMPANY PIC  X(02)  VALUE '03'.     01300000
013100     05  PC-SYSTEM-CODE               PIC  X(02)  VALUE 'PC'.     01310000
013200     05  PC-DISPLAY-PO                PIC  9(8)   VALUE ZEROS.    01320000
013300     05  PC-DISPLAY-RCVR              PIC  9(8)   VALUE ZEROS.    01330000
013400     05  PC-DISPLAY-LINE              PIC  9(8)   VALUE ZEROS.    01340000
013500     05  PC-DISPLAY-OPER              PIC  9(4)   VALUE ZEROS.    01350000
013600     05  PC-DISPLAY-SQL-CODE          PIC  9999-  VALUE ZEROS.    01360000
013700     05  PC-DISPLAY-CICS-RESP         PIC  999999999-             01370000
013800                                                  VALUE ZEROS.    01380000
013810     05  PC-START-TRAN-ID             PIC  X(4)   VALUE SPACES.   01381000
013900*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       01390000
014000     COPY DPWS013.                                                01400000
014100     EJECT                                                        01410000
014200*                                                                 01420000
014300*  AUDIT MODULE LAYOUT                                            01430000
014400     COPY RCWS031.                                                01440000
014500                                                                  01450000
014600*---------------------------------------------------------------* 01460000
014700*    DB2 AREA FOR RECEIPT HEADER TABLE                          * 01470000
014800*---------------------------------------------------------------* 01480000
014900     EXEC SQL                                                     01490000
015000          INCLUDE TRECEIV                                         01500000
015100     END-EXEC.                                                    01510000
015101                                                                  01510101
015110*---------------------------------------------------------------* 01511001
015120*    DB2 AREA FOR PARM TABLE                                    * 01512001
015130*---------------------------------------------------------------* 01513001
015140     EXEC SQL                                                     01514001
015150          INCLUDE TKRPRPM                                         01515001
015160     END-EXEC.                                                    01516001
015200*---------------------------------------------------------------* 01520000
015300*   DB2 COMMUNICATIONS AREA                                       01530000
015400*                                                                 01540000
015500      EXEC SQL                                                    01550000
015600          INCLUDE SQLCA                                           01560000
015700      END-EXEC.                                                   01570000
015800*                                                                 01580000
015900*   DB2 COMMUNICATIONS AREA2                                      01590000
016000*                                                                 01600000
016100     COPY SQLCA2.                                                 01610000
016200 EJECT                                                            01620000
016300                                                                  01630000
016400***************************************************************** 01640000
016500 EJECT                                                            01650000
016600 LINKAGE SECTION.                                                 01660000
016700                                                                  01670000
016800     EJECT                                                        01680000
016900                                                                  01690000
017000******************************************************************01700000
017100 PROCEDURE DIVISION.                                              01710000
017200******************************************************************01720000
017300*                                                                 01730000
017400******************************************************************01740000
017500* 0000-MAIN-MODULE  - HIGHEST LEVEL CONTROL ROUTINE.             *01750000
017600******************************************************************01760000
017700 0000-MAIN-MODULE.                                                01770000
017800                                                                  01780000
017900     MOVE EIBTASKN               TO PV-TASK.                      01790003
018000     STRING ' PCKCS200 STARTED - TASK = ' PV-TASK-X               01800000
018100         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA.                 01810003
018200     PERFORM 9990-WRITE-CICS.                                     01820003
018300                                                                  01830000
018500     MOVE LENGTH RC289-COMMAREA-FOR-E200 TO                       01850000
018600                                     PV-COMMAREA-LENGTH.          01860000
018700                                                                  01870000
018800     EXEC CICS                                                    01880000
018900         RETRIEVE                                                 01890000
019000         INTO(RC289-COMMAREA-FOR-E200)                            01900000
019100         LENGTH(PV-COMMAREA-LENGTH)                               01910000
019200         RESP(PV-CICS-RESPONSE)                                   01920000
019300     END-EXEC.                                                    01930000
019400                                                                  01940000
019500     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       01950000
019600         MOVE RC289-ORD-NBR        TO DK-ORD-NBR                  01960000
019700         MOVE RC289-RCVR-SEQ-NBR   TO DK-REC-SEQ-NBR              01970000
019800         MOVE RC289-ORD-LNE-NBR    TO DK-ORD-LNE-NBR              01980000
019900         PERFORM 2900-GET-TRECEIV-OPER-UNT-ID                     01990000
019910         PERFORM 1050-CHECK-CSSL-DISPLAY                          01991003
020000         IF  RC289-AUTOVE-PO-IND = SPACE                          02000000
020100             PERFORM 3000-CHECK-AUTOVRFD                          02010000
020200         ELSE                                                     02020000
020300* DMH 6/9/04 BEGIN                                                02030000
020400             IF  RC289-PBS                                        02040000
020500                 PERFORM 3000-CHECK-AUTOVRFD                      02050000
020600             END-IF                                               02060000
020700* DMH 6/9/04 END                                                  02070000
020800             MOVE RC040-AUTO-VE-SW  TO PS-AUTO-VE-SW              02080000
020900         END-IF                                                   02090000
021000                                                                  02100000
021010         IF  PS-DISPLAY-CSSL-YES                                  02101003
021200             MOVE RC289-ORD-NBR      TO PV-ORD-NBR-DISPLAY        02120003
021300             MOVE RC289-RCVR-SEQ-NBR TO PV-REC-SEQ-NBR-DISPLAY    02130003
021400             MOVE RC289-ORD-LNE-NBR  TO PV-ORD-LNE-NBR-DISPLAY    02140003
021500             STRING   ' PCKCS200 '                                02150003
021600                      PV-ORD-NBR-DISPLAY '-'                      02160003
021700                      PV-REC-SEQ-NBR-DISPLAY '-'                  02170003
021800                      PV-ORD-LNE-NBR-DISPLAY                      02180003
021900                      '  PKG TYPE='                               02190003
022000                      RC289-PACKAGE-TYPE-CDE                      02200003
022100                      '  TRECEIV PBS='                            02210003
022200                      RECEIV-PACK-BY-ST-IND                       02220003
022300                      '  AUTOVE PO='                              02230003
022400                      RC289-AUTOVE-PO-IND                         02240003
022500                      DELIMITED BY SIZE                           02250003
022600                                      INTO PV-CICS-MSG-AREA-2     02260003
022700             PERFORM 9999-WRITE-TO-CSSL                           02270003
022800         END-IF                                                   02280003
022900                                                                  02290000
023000         IF  RC289-AUTOVE-PO-YES                                  02300000
023100             IF  RC289-PACKAGE-TYPE-CDE = SPACE                   02310000
023200                 IF  RECEIV-PACK-BY-ST-IND = 'Y'                  02320000
023300                     SET RC289-PBS  TO TRUE                       02330000
023400                 ELSE                                             02340000
023500                     MOVE RECEIV-PKGNG-CDE                        02350000
023510                       TO RC289-PACKAGE-TYPE-CDE                  02351000
023600                 END-IF                                           02360000
023700             END-IF                                               02370000
023800             IF  RC289-PBS                                        02380000
023900                 PERFORM 2000-START-PCKCS780                      02390000
024400             ELSE                                                 02440000
024500                 PERFORM 2400-START-PCKCS770                      02450000
025000             END-IF                                               02500000
025100         ELSE                                                     02510000
025200             PERFORM 2400-START-PCKCS770                          02520000
025700         END-IF                                                   02570000
025710     END-IF.                                                      02571000
025800                                                                  02580000
025900     EXEC CICS                                                    02590000
026000         RETURN                                                   02600000
026100     END-EXEC.                                                    02610000
026200                                                                  02620000
026300     GOBACK.                                                      02630000
026400     EJECT                                                        02640000
026410*----------------------------------------------------------------*02641003
026420* DETERMINE PROGRAM SHOULD DISPLAY ENTRIES IN CSSL LOG           *02642003
026440*----------------------------------------------------------------*02644003
026450 1050-CHECK-CSSL-DISPLAY.                                         02645003
026460                                                                  02646003
026470     MOVE RECEIV-CURR-OPER-UNT-ID TO DK-LOC-ID.                   02647003
026480                                                                  02648003
026490     EXEC SQL                                                     02649003
026491          SELECT  FUNC_TXT                                        02649103
026492            INTO :KRPRPM-FUNC-TXT                                 02649203
026493            FROM  TKRPRPM                                         02649303
026494           WHERE  LOC_ID            = :DK-LOC-ID                  02649403
026495             AND  INTFC_SYS_CDE     = 'KHL'                       02649503
026496             AND  SYS_PRC_FUNC_CDE  = 'PC200D'                    02649603
026497     END-EXEC.                                                    02649703
026498                                                                  02649803
026499     EVALUATE TRUE                                                02649903
026500                                                                  02650003
026501         WHEN SQLCODE = +0                                        02650103
026502              IF  KRPRPM-FUNC-TXT  = 'Y'                          02650203
026503                  SET  PS-DISPLAY-CSSL-YES  TO  TRUE              02650303
026504              ELSE                                                02650403
026505                  SET  PS-DISPLAY-CSSL-NO   TO  TRUE              02650503
026506              END-IF                                              02650603
026507                                                                  02650703
026508         WHEN SQLCODE = +100                                      02650803
026509              SET  PS-DISPLAY-CSSL-NO       TO  TRUE              02650903
026510                                                                  02651003
026511         WHEN OTHER                                               02651103
026541              MOVE '1050-CHECK-CSSL-DISPLAY'                      02654103
026542                               TO DP013-PARAGRAPH                 02654203
026543              MOVE 'SELECT TKRPRPM'                               02654303
026544                               TO DP013-MESSAGE-TEXT (1)          02654403
026545              MOVE DK-LOC-ID   TO PV-ERROR-CURR-OPER-UNT-ID       02654503
026547              STRING ' LOC ID: '          DELIMITED BY SIZE       02654703
026548                   PV-ERROR-CURR-OPER-UNT-ID                      02654803
026549                                          DELIMITED BY SIZE       02654903
026550                             INTO DP013-MESSAGE-TEXT (2)          02655003
026551              MOVE 'TKRPRPM '  TO DP013-DB2-TABLE-NAME (1)        02655103
026552              MOVE SQLCA       TO DP013-SQLCA                     02655203
026553              SET DP013-DB2-ABEND                                 02655303
026554                               TO TRUE                            02655403
026555              PERFORM Z999-ABEND                                  02655503
026556     END-EVALUATE.                                                02655603
026560*                                                                 02656000
026600*----------------------------------------------------------------*02660000
026700*    CONTROL THE CALL TO PCKCS780.  THIS PARAGRAPH WILL GET THE  *02670000
026800*    TRAN ID BASED ON THE DC NUMBER (CURR OPER UNIT ID) FROM THE *02680000
026900*    PARM TABLE AND WILL THEN START THE PCKCS780 PROGRAM WITH    *02690000
027000*    THE TRAN ID FROM THE PARM TABLE.                            *02700000
027100*----------------------------------------------------------------*02710000
027200 2000-START-PCKCS780.                                             02720000
027300                                                                  02730000
027400     PERFORM 2100-GET-AVPBST-PARM.                                02740000
027401                                                                  02740100
027402     EXEC CICS                                                    02740200
027403          START TRANSID (PC-START-TRAN-ID)                        02740300
027404                FROM (RC289-COMMAREA-FOR-E200)                    02740400
027405     END-EXEC.                                                    02740500
027410                                                                  02741000
027500*                                                                 02750000
027510*----------------------------------------------------------------*02751000
027520*    MAKE CALL TO PARM TABLE TO GET THE TRAN ID FOR PCKCS780     *02752000
027530*    BASED ON THE CURRENT OPER UNIT ID FROM TRECEIV FOR THE      *02753000
027540*    RECEIVER.                                                   *02754000
027550*    IF FOR SOME REASON, AN ENTRY IS NOT FOUND IN THE PARM       *02755000
027560*    FOR THE CURRENT OPER UNIT ID, THEN TRAN ID E780 WILL BE     *02756000
027570*    USED.                                                       *02757000
027580*----------------------------------------------------------------*02758000
027600 2100-GET-AVPBST-PARM.                                            02760000
027700                                                                  02770000
027800     MOVE RECEIV-CURR-OPER-UNT-ID TO DK-CURR-OPER-UNT-ID.         02780000
027900                                                                  02790000
028000     EXEC SQL                                                     02800000
028100          SELECT FUNC_TXT                                         02810000
028200          INTO  :KRPRPM-FUNC-TXT                                  02820002
028300          FROM   TKRPRPM                                          02830000
028400          WHERE  SYS_PRC_FUNC_CDE  = 'AVPBST'                     02840000
028500            AND  INTFC_SYS_CDE     = 'KHL'                        02850000
028600            AND  FUNC_PRC_STAT_CDE = 'AC'                         02860000
028800            AND  LOC_ID            =  :DK-CURR-OPER-UNT-ID        02880000
028900     END-EXEC.                                                    02890000
028901                                                                  02890100
028910     EVALUATE TRUE                                                02891000
028920         WHEN SQLCODE = ZERO                                      02892000
028940              MOVE KRPRPM-FUNC-TXT TO PC-START-TRAN-ID            02894000
028970         WHEN SQLCODE = +100                                      02897000
028980              MOVE 'E780' TO PC-START-TRAN-ID                     02898000
028990         WHEN SQLWARN0 NOT = SPACE                                02899000
028991         WHEN SQLCODE NOT = ZERO                                  02899100
028992              MOVE '2100-GET-AVPBST-PARM'                         02899200
028993                               TO DP013-PARAGRAPH                 02899300
028994              MOVE 'SELECT TKRPRPM'                               02899400
028995                               TO DP013-MESSAGE-TEXT (1)          02899500
028996              MOVE DK-CURR-OPER-UNT-ID                            02899600
028997                               TO PV-ERROR-CURR-OPER-UNT-ID       02899700
029000              STRING ' LOC ID: '          DELIMITED BY SIZE       02900000
029001                   PV-ERROR-CURR-OPER-UNT-ID                      02900100
029002                                          DELIMITED BY SIZE       02900200
029004                             INTO DP013-MESSAGE-TEXT (2)          02900400
029005              MOVE 'TKRPRPM '  TO DP013-DB2-TABLE-NAME (1)        02900500
029006              MOVE SQLCA       TO DP013-SQLCA                     02900600
029007              SET DP013-DB2-ABEND                                 02900700
029008                               TO TRUE                            02900800
029009              PERFORM Z999-ABEND                                  02900900
029010     END-EVALUATE.                                                02901000
029020*----------------------------------------------------------------*02902000
029100*    CONTROL THE CALL TO PCKCS770.  THIS PARAGRAPH WILL GET THE  *02910000
029200*    TRAN ID BASED ON THE DC NUMBER (CURR OPER UNIT ID) FROM THE *02920000
029300*    PARM TABLE AND WILL THEN START THE PCKCS770 PROGRAM WITH    *02930000
029400*    THE TRAN ID FROM THE PARM TABLE.                            *02940000
029500*----------------------------------------------------------------*02950000
029600 2400-START-PCKCS770.                                             02960000
029700                                                                  02970000
029800     PERFORM 2500-GET-AVNPBT-PARM.                                02980000
029801                                                                  02980100
029802     EXEC CICS                                                    02980200
029803          START TRANSID (PC-START-TRAN-ID)                        02980300
029804                FROM (RC289-COMMAREA-FOR-E200)                    02980400
029805     END-EXEC.                                                    02980500
029806                                                                  02980600
029807*                                                                 02980700
029808*----------------------------------------------------------------*02980800
029809*    MAKE CALL TO PARM TABLE TO GET THE TRAN ID FOR PCKCS770     *02980900
029810*    BASED ON THE CURRENT OPER UNIT ID FROM TRECEIV FOR THE      *02981000
029811*    RECEIVER.                                                   *02981100
029812*    IF FOR SOME REASON, AN ENTRY IS NOT FOUND IN THE PARM       *02981200
029813*    FOR THE CURRENT OPER UNIT ID, THEN TRAN ID E770 WILL BE     *02981300
029814*    USED.                                                       *02981400
029815*----------------------------------------------------------------*02981500
029816 2500-GET-AVNPBT-PARM.                                            02981600
029820                                                                  02982000
029830     MOVE RECEIV-CURR-OPER-UNT-ID TO DK-CURR-OPER-UNT-ID.         02983000
029840                                                                  02984000
029850     EXEC SQL                                                     02985000
029860          SELECT FUNC_TXT                                         02986000
029870          INTO  :KRPRPM-FUNC-TXT                                  02987002
029880          FROM   TKRPRPM                                          02988000
029890          WHERE  SYS_PRC_FUNC_CDE  = 'AVNPBT'                     02989000
029891            AND  INTFC_SYS_CDE     = 'KHL'                        02989100
029892            AND  FUNC_PRC_STAT_CDE = 'AC'                         02989200
029893            AND  LOC_ID            =  :DK-CURR-OPER-UNT-ID        02989300
029894     END-EXEC.                                                    02989400
029895                                                                  02989500
029896     EVALUATE TRUE                                                02989600
029897         WHEN SQLCODE = ZERO                                      02989700
029898              MOVE KRPRPM-FUNC-TXT TO PC-START-TRAN-ID            02989800
029899         WHEN SQLCODE = +100                                      02989900
029900              MOVE 'E770' TO PC-START-TRAN-ID                     02990000
029901         WHEN SQLWARN0 NOT = SPACE                                02990100
029902         WHEN SQLCODE NOT = ZERO                                  02990200
029903              MOVE '2500-GET-AVNPBT-PARM'                         02990300
029904                               TO DP013-PARAGRAPH                 02990400
029905              MOVE 'SELECT TKRPRPM'                               02990500
029906                               TO DP013-MESSAGE-TEXT (1)          02990600
029907              MOVE DK-CURR-OPER-UNT-ID                            02990700
029908                               TO PV-ERROR-CURR-OPER-UNT-ID       02990800
029909              STRING ' LOC ID: '          DELIMITED BY SIZE       02990900
029910                   PV-ERROR-CURR-OPER-UNT-ID                      02991000
029911                                          DELIMITED BY SIZE       02991100
029912                             INTO DP013-MESSAGE-TEXT (2)          02991200
029913              MOVE 'TKRPRPM '  TO DP013-DB2-TABLE-NAME (1)        02991300
029914              MOVE SQLCA       TO DP013-SQLCA                     02991400
029915              SET DP013-DB2-ABEND                                 02991500
029916                               TO TRUE                            02991600
029917              PERFORM Z999-ABEND                                  02991700
029918     END-EVALUATE.                                                02991800
029920*                                                                 02992000
030000*----------------------------------------------------------------*03000000
030100*    SELECT THE OPERATING UNIT ID THAT IS ASSOCIATED WITH THE    *03010000
030200*    RECEIVER WE ARE ATTEMPTING TO VERIFY.                       *03020000
030300*----------------------------------------------------------------*03030000
030400 2900-GET-TRECEIV-OPER-UNT-ID.                                    03040000
030500     INITIALIZE DCLTRECEIV.                                       03050000
030600                                                                  03060000
030700         EXEC SQL                                                 03070000
030800              SELECT                                              03080000
030900                 OPER_UNT_ID                                      03090000
031000                ,CURR_OPER_UNT_ID                                 03100000
031100                ,PACK_BY_ST_IND                                   03110000
031200                ,PKGNG_CDE                                        03120000
031300            INTO                                                  03130000
031400                 :RECEIV-OPER-UNT-ID                              03140000
031500                ,:RECEIV-CURR-OPER-UNT-ID                         03150000
031600                ,:RECEIV-PACK-BY-ST-IND                           03160000
031700                ,:RECEIV-PKGNG-CDE                                03170000
031800              FROM  TRECEIV                                       03180000
031900              WHERE                                               03190000
032000                     ORD_NBR          =  :DK-ORD-NBR              03200000
032100              AND    REC_SEQ_NBR      =  :DK-REC-SEQ-NBR          03210000
032200              AND    VER_STATUS_CDE   =  'A'                      03220000
032300              WITH UR                                             03230000
032400         END-EXEC                                                 03240000
032500                                                                  03250000
032600         EVALUATE TRUE                                            03260000
032700             WHEN SQLCODE = ZERO                                  03270000
032800                  SET PS-DATA-OK    TO  TRUE                      03280000
032900                  IF  RECEIV-PACK-BY-ST-IND  = 'Y'                03290000
033000                      SET  RC289-PBS  TO TRUE                     03300000
033100                  END-IF                                          03310000
033200             WHEN SQLCODE = +100                                  03320000
033300                  SET PS-DATA-NOT-OK  TO  TRUE                    03330000
033400             WHEN SQLWARN0 NOT = SPACE                            03340000
033500             WHEN SQLCODE NOT = ZERO                              03350000
033600                  MOVE '2900-GET-TRECEIV-OPER-UNT-ID'             03360000
033700                                   TO DP013-PARAGRAPH             03370000
033800                  MOVE 'SELECT TRECEIV'                           03380000
033900                                   TO DP013-MESSAGE-TEXT (1)      03390000
034000                  MOVE DK-ORD-NBR    TO PV-ERROR-ORD-NBR          03400000
034100                  MOVE DK-REC-SEQ-NBR                             03410000
034200                                   TO PV-ERROR-RCVR-SEQ-NBR       03420000
034300                  STRING ' RCVR: '            DELIMITED BY SIZE   03430000
034400                       PV-ERROR-ORD-NBR       DELIMITED BY SIZE   03440000
034500                       '-'                    DELIMITED BY SIZE   03450000
034600                       PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE   03460000
034700                                 INTO DP013-MESSAGE-TEXT (2)      03470000
034800                  MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)    03480000
034900                  MOVE SQLCA       TO DP013-SQLCA                 03490000
035000                  SET DP013-DB2-ABEND                             03500000
035100                                   TO TRUE                        03510000
035200                  PERFORM Z999-ABEND                              03520000
035300         END-EVALUATE.                                            03530000
035400/                                                                 03540000
035500 3000-CHECK-AUTOVRFD.                                             03550000
035600                                                                  03560000
035700     INITIALIZE RC040-FIELDS.                                     03570000
035800     MOVE RECEIV-OPER-UNT-ID  TO RC040-SIGNON-LOCATION.           03580000
035900     MOVE DK-ORD-NBR          TO RC040-PO-NBR.                    03590000
036000     MOVE DK-REC-SEQ-NBR      TO RC040-PO-RCVR.                   03600000
036100     MOVE SPACES              TO RC040-USER-ID.                   03610000
036200     MOVE 'PCKCS200'          TO RC040-CALLING-PROGRAM.           03620000
036300                                                                  03630000
036400     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  03640000
036500                                        RC040-COMMAREA            03650000
036600                                        RC040-FIELDS.             03660000
036700                                                                  03670000
036800     EVALUATE TRUE                                                03680000
036900         WHEN RC040-SUCCESSFUL                                    03690000
037000                 MOVE RC040-AUTO-VE-SW TO PS-AUTO-VE-SW           03700000
037100                                          RC289-AUTOVE-PO-IND     03710000
037200         WHEN OTHER                                               03720000
037300             MOVE '3000-CHECK-AUTOVRFD'                           03730000
037400                                     TO DP013-PARAGRAPH           03740000
037500             MOVE DK-ORD-NBR         TO PV-ERROR-ORD-NBR          03750000
037600             MOVE DK-REC-SEQ-NBR     TO PV-ERROR-RCVR-SEQ-NBR     03760000
037700             MOVE RECEIV-OPER-UNT-ID TO PV-ERROR-OPER-UNT-ID      03770000
037800             STRING ' OPER: '            DELIMITED BY SIZE        03780000
037900                  PV-ERROR-OPER-UNT-ID   DELIMITED BY SIZE        03790000
038000                    ' RCVR: '            DELIMITED BY SIZE        03800000
038100                  PV-ERROR-ORD-NBR       DELIMITED BY SIZE        03810000
038200                  '-'                    DELIMITED BY SIZE        03820000
038300                  PV-ERROR-RCVR-SEQ-NBR  DELIMITED BY SIZE        03830000
038400                  ' IND: '               DELIMITED BY SIZE        03840000
038500                  RC040-SUCCESS-IND      DELIMITED BY SIZE        03850000
038600                                   INTO DP013-MESSAGE-TEXT (1)    03860000
038700             SET DP013-XCTL-DISPLAY-RESTART                       03870000
038800                 DP013-DB2-ABEND     TO TRUE                      03880000
038900                                                                  03890000
039000             PERFORM Z999-ABEND                                   03900000
039100     END-EVALUATE.                                                03910000
039200                                                                  03920000
039300/                                                                 03930000
039400 9990-WRITE-CICS.                                                 03940000
039500*!                                                                03950000
039600     MOVE LENGTH OF PV-CICS-MSG-AREA TO PV-CLENG.                 03960000
039700*!                                                                03970000
039800     EXEC CICS WRITEQ TD QUEUE('CSMT') FROM(PV-CICS-MSG-AREA)     03980000
039900          LENGTH(PV-CLENG) NOHANDLE                               03990000
040000     END-EXEC.                                                    04000000
040100                                                                  04010000
040200     MOVE SPACES TO PV-CICS-MSG-AREA.                             04020000
040300*                                                                 04030000
040400 9999-WRITE-TO-CSSL.                                              04040000
040500                                                                  04050000
040600     MOVE LENGTH OF PV-CICS-MSG-AREA-2  TO PV-COMMAREA-LENGTH.    04060000
040700                                                                  04070000
040800     EXEC CICS                                                    04080000
040900          WRITEQ TD                                               04090000
041000           QUEUE   ('CSSL')                                       04100000
041100            FROM   (PV-CICS-MSG-AREA-2)                           04110000
041200          LENGTH   (PV-COMMAREA-LENGTH)                           04120000
041300            RESP   (PV-CICS-RESPONSE)                             04130000
041400     END-EXEC.                                                    04140000
041500                                                                  04150000
041600******************************************************************04160000
041700*   STANDARD ABEND ROUTINE                                        04170000
041800* ==> PROCESSES:                                                  04180000
041900*   - ISSUES THE ABEND.                                           04190000
042000******************************************************************04200000
042100 Z999-ABEND.                                                      04210000
042200     MOVE PC-CURRENT-PROGRAM-NAME     TO DP013-PROGRAM.           04220000
042300     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          04230000
042400     INITIALIZE DP013-SRC-TASK-NUMBER                             04240000
042500                DP013-STACK.                                      04250000
042600     SET DP013-LINK-RETURN TO TRUE.                               04260000
042700     SET DP013-ROLLBACK    TO TRUE.                               04270000
042800                                                                  04280000
042900     EXEC CICS                                                    04290000
043000         LINK                                                     04300000
043100             PROGRAM  (DP013-NAME)                                04310000
043200             COMMAREA (DP013-PARAMETERS)                          04320000
043300             LENGTH   (DP013-LENGTH)                              04330000
043400     END-EXEC.                                                    04340000
043500                                                                  04350000
043600                                                                  04360000
043700     EXEC CICS                                                    04370000
043800         RETURN                                                   04380000
043900     END-EXEC.                                                    04390000
044000                                                                  04400000
