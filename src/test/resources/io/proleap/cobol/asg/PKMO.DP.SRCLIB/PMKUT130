      ******************************************************************00010005
       IDENTIFICATION DIVISION.                                         00020005
      ******************************************************************00030005
                                                                        00040005
       PROGRAM-ID.      PMKUT130.                                       00050042
       AUTHOR.          COLLEEN CUMMINGS.                               00060005
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00070005
       DATE-WRITTEN.    JULY 2004.                                      00080005
       DATE-COMPILED.                                                   00090005
                                                                        00100005
      ******************************************************************00110005
      * THIS PROGRAM WAS COPIED FROM PMKUT107 FOR A FILE NEEDED         00120005
      * FOR MARKETING. ADDED LOOKUP TO TPPCPRC FOR PRICE HISTORY.       00130005
      * NEW PROMO EXCEPTION REPORTING - BLOW TO SKU/STORE AND LOOK UP  *00140005
      * SKU INFO.                                                      *00150005
      ******************************************************************00160005
      **  HISTORY LOG:                                                 *00170005
      ******************************************************************00180005
      * DATE:         03/15/2005                                       *00190048
      * WR/IR#:       WR27018                                          *00200048
      * PROGRAMMER:   KELLY WIESNER                                    *00210048
      * DESCRIPTION:  CHANGED PROGRAM TO USE THE PRCHG TABLES FOR NEW  *00220048
      *               PERM                                             *00230048
      ******************************************************************00240005
      * DATE:         08/15/2005                                       *00250050
      * WR/IR#:       P000XXXXXX                                       *00260050
      * PROGRAMMER:   COLLEEN CUMMINGS                                 *00270050
      * DESCRIPTION:  MISSING JOIN OF E.PRCHG_ID = D.PRCHG_ID IN:      *00280050
      *               H500-CHECK-FUTURE-PERM-CHANGES.                  *00290050
      ******************************************************************00300050
                                                                        00310005
      ******************************************************************00320005
       ENVIRONMENT DIVISION.                                            00330005
      ******************************************************************00340005
                                                                        00350005
       CONFIGURATION SECTION.                                           00360005
                                                                        00370005
       SOURCE-COMPUTER. IBM-3090.                                       00380005
       OBJECT-COMPUTER. IBM-3090.                                       00390005
                                                                        00400005
       INPUT-OUTPUT SECTION.                                            00410005
                                                                        00420005
       FILE-CONTROL.                                                    00430005
                                                                        00440005
           SELECT PRICING-FILE                                          00450005
               ASSIGN                       TO INP01.                   00460005
                                                                        00470005
           SELECT EXPLODED-FILE                                         00480005
               ASSIGN                       TO OUT01.                   00490005
                                                                        00500005
      ******************************************************************00510005
       DATA DIVISION.                                                   00520005
      ******************************************************************00530005
                                                                        00540005
       FILE SECTION.                                                    00550005
                                                                        00560005
       FD  PRICING-FILE                                                 00570005
           RECORDING MODE F                                             00580005
           BLOCK CONTAINS 0 RECORDS                                     00590005
           LABEL RECORDS ARE STANDARD.                                  00600005
       01  PRICING-REC                   PIC X(400).                    00610016
                                                                        00620005
       FD  EXPLODED-FILE                                                00630005
           RECORDING MODE F                                             00640005
           BLOCK CONTAINS 0 RECORDS                                     00650005
           LABEL RECORDS ARE STANDARD.                                  00660005
       01  EXPLODED-REC                  PIC X(500).                    00670018
                                                                        00680005
       WORKING-STORAGE SECTION.                                         00690005
                                                                        00700005
      ******************************************************************00710005
      * PC PROGRAM CONSTANTS                                            00720005
      ******************************************************************00730005
       01  PC-PROGRAM-CONSTANTS.                                        00740005
           05  PC-PROGRAM-NAME              PIC X(08)      VALUE        00750005
                                                           'PMKUT130'.  00760042
           05  PC-EXCL-LIMIT                PIC 9(05)      VALUE 50000. 00770005
                                                                        00780005
      ******************************************************************00790005
      * PV PROGRAM VARIABLES                                            00800005
      ******************************************************************00810005
       01  PV-PROGRAM-VARIABLES.                                        00820005
           05  PV-PARAGRAPH-NAME            PIC X(40) VALUE SPACES.     00830005
           05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     00840005
           05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     00850005
           05  PV-CPU-TIME                  PIC  9(08) VALUE 0.         00860015
           05  PV-RUN-DATE                  PIC X(10) VALUE SPACES.     00870005
           05  PV-RUN-DATE-RDF REDEFINES PV-RUN-DATE.                   00880005
               10  PV-RUN-DATE-CC           PIC X(02).                  00890005
               10  PV-RUN-DATE-YY           PIC X(02).                  00900005
               10  PV-RUN-DATE-D1           PIC X(01).                  00910005
               10  PV-RUN-DATE-MM           PIC X(02).                  00920005
               10  PV-RUN-DATE-D2           PIC X(01).                  00930005
               10  PV-RUN-DATE-DD           PIC X(02).                  00940005
           05  PV-RUN-DATE-SHORT            PIC 9(06).                  00950005
           05  PV-RUN-DATE-SHORT-RDF REDEFINES PV-RUN-DATE-SHORT.       00960005
               10  PV-RUN-DATE-SHORT-YY     PIC X(02).                  00970005
               10  PV-RUN-DATE-SHORT-MM     PIC X(02).                  00980005
               10  PV-RUN-DATE-SHORT-DD     PIC X(02).                  00990005
           05  PV-FIRST-RCVD-DTE-NUM        PIC 9(06) VALUE 0.          01000005
           05  PV-FIRST-RCVD-RDF REDEFINES PV-FIRST-RCVD-DTE-NUM.       01010005
               10  PV-FIRST-RCVD-RDF-YY     PIC 9(02).                  01020005
               10  PV-FIRST-RCVD-RDF-MM     PIC 9(02).                  01030005
               10  PV-FIRST-RCVD-RDF-DD     PIC 9(02).                  01040005
           05  PV-FIRST-RCVD-DTE.                                       01050005
               10  PV-FIRST-RCVD-DTE-CC     PIC X(02) VALUE SPACES.     01060005
               10  PV-FIRST-RCVD-DTE-YY     PIC X(02) VALUE SPACES.     01070005
               10  PV-FIRST-RCVD-DTE-D1     PIC X(01) VALUE '-'.        01080005
               10  PV-FIRST-RCVD-DTE-MM     PIC X(02) VALUE SPACES.     01090005
               10  PV-FIRST-RCVD-DTE-D2     PIC X(01) VALUE '-'.        01100005
               10  PV-FIRST-RCVD-DTE-DD     PIC X(02) VALUE SPACES.     01110005
           05  PV-STR-NBR-5                 PIC X(05) VALUE SPACES.     01120005
           05  PV-STR-NBR-RDF REDEFINES PV-STR-NBR-5.                   01130005
               10  PV-STR-NBR-EXTRA-2       PIC X(02).                  01140005
               10  PV-STR-NBR-3             PIC X(03).                  01150005
           05  PV-STR-NBR-NUM               PIC S9(04) COMP.            01160005
           05  PV-STR-NBR-INSERT            PIC S9(04) COMP.            01170005
           05  PV-STR-NBR                   PIC S9(04) COMP.            01180005
           05  PV-STR-INSERT-COUNT          PIC 9(04) VALUE 0.          01190005
           05  PV-BEG-TMST                  PIC X(26) VALUE SPACES.     01200005
           05  PV-BEG-TMST-RDF REDEFINES PV-BEG-TMST.                   01210005
               10  PV-BEG-TMST-CC           PIC X(02).                  01220023
               10  PV-BEG-TMST-Y1           PIC X(01).                  01230029
               10  PV-BEG-TMST-Y2           PIC X(01).                  01240029
               10  PV-BEG-TMST-DASH1        PIC X(01).                  01250023
               10  PV-BEG-TMST-MM           PIC X(02).                  01260023
               10  PV-BEG-TMST-DASH2        PIC X(01).                  01270023
               10  PV-BEG-TMST-DD           PIC X(02).                  01280023
               10  PV-BEG-TMST-HYPHEN       PIC X(01).                  01290005
               10  PV-BEG-TMST-TIME.                                    01300023
                   15  PV-BEG-TMST-HH       PIC X(02).                  01310023
                   15  PV-BEG-TMST-DOT1     PIC X(01).                  01320023
                   15  PV-BEG-TMST-MI       PIC X(02).                  01330023
               10  PV-BEG-TMST-DOT2         PIC X(01).                  01340005
               10  PV-BEG-TMST-SS           PIC X(02).                  01350005
               10  PV-BEG-TMST-DB2-EXTRA    PIC X(07).                  01360005
           05  PV-END-TMST                  PIC X(26) VALUE SPACES.     01370005
           05  PV-END-TMST-RDF REDEFINES PV-END-TMST.                   01380005
               10  PV-END-TMST-DATE         PIC X(10).                  01390027
               10  PV-END-TMST-DATE-RDF REDEFINES PV-END-TMST-DATE.     01400027
                   15  PV-END-TMST-CC       PIC X(02).                  01410025
                   15  PV-END-TMST-Y1       PIC X(01).                  01420029
                   15  PV-END-TMST-Y2       PIC X(01).                  01430030
                   15  PV-END-TMST-DASH1    PIC X(01).                  01440025
                   15  PV-END-TMST-MM       PIC X(02).                  01450025
                   15  PV-END-TMST-DASH2    PIC X(01).                  01460025
                   15  PV-END-TMST-DD       PIC X(02).                  01470025
               10  PV-END-TMST-HYPHEN       PIC X(01).                  01480028
               10  PV-END-TMST-TIME.                                    01490023
                   15  PV-END-TMST-HH       PIC X(02).                  01500023
                   15  PV-END-TMST-DOT1     PIC X(01).                  01510023
                   15  PV-END-TMST-MI       PIC X(02).                  01520023
               10  PV-END-TMST-DOT2         PIC X(01).                  01530005
               10  PV-END-TMST-SS           PIC X(02).                  01540005
               10  PV-END-TMST-DB2-EXTRA    PIC X(07).                  01550005
           05  PV-DEPT-NBR                  PIC S9(04)V COMP-3 VALUE 0. 01560005
           05  PV-MAJ-CL-NBR                PIC S9(04)V COMP-3 VALUE 0. 01570005
           05  PV-SUB-CL-NBR                PIC S9(04)V COMP-3 VALUE 0. 01580005
           05  PV-VS-ID                     PIC S9(09) COMP VALUE 0.    01590005
           05  PV-SKU-NBR                   PIC S9(08)V COMP-3 VALUE 0. 01600005
           05  PV-SKU-NBR2                  PIC S9(08)V COMP-3 VALUE 0. 01610005
           05  PV-PRIC-PT                   PIC 9(7)V9(2) VALUE 0.      01620005
           05  PV-RECS-DIV                  PIC S9(09)  VALUE 0.        01630005
           05  PV-RECS-REM                  PIC S9(09)  VALUE 0.        01640005
           05  PV-STATUS-CDE                PIC 9(03) VALUE 0.          01650037
           05  PV-STATUS-CDE-RDF REDEFINES PV-STATUS-CDE.               01660037
               10 PV-STATUS-CDE-1           PIC X(1).                   01670038
               10 PV-STATUS-CDE-23          PIC X(2).                   01680038
           05  PV-NULL-INDICATORS.                                      01690005
               10  PV-MEITGP-NBR-NI         PIC S9(04) COMP VALUE 0.    01700005
               10  PV-GP-RTL-QTY-NI         PIC S9(04) COMP VALUE 0.    01710006
               10  PV-GP-RTL-AMT-NI         PIC S9(04) COMP VALUE 0.    01720006
           05  PV-EXCL-SUB                  PIC 9(04) VALUE 0.          01730005
           05  PV-MAX-EXCL                  PIC 9(04) VALUE 0.          01740005
      *    CHANGE PC-EXCL-LIMIT TO MATCH ANY CHANGE IN SIZE HERE        01750005
           05  PT-EXCLUSION-TABLE                                       01760005
               OCCURS 50000 TIMES.                                      01770005
               10  PT-MDSE-SELN-ID          PIC 9(10).                  01780005
               10  PT-MDSE-SELN-LNE-ID      PIC 9(10).                  01790005
               10  PT-SKU-NBR               PIC 9(08).                  01800005
                                                                        01810005
      ******************************************************************01820005
      * PS PROGRAM SWITCHES                                            *01830005
      ******************************************************************01840005
       01  PS-PROGRAM-SWITCHES.                                         01850005
           05  PS-END-OF-PRICING-FILE-SW       PIC X(01)     VALUE 'N'. 01860005
               88  PS-END-OF-PRICING-FILE                    VALUE 'Y'. 01870005
           05  PS-PRICING-INPUT-FOUND-SW       PIC X(01)     VALUE 'N'. 01880005
               88  PS-PRICING-INPUT-FOUND                    VALUE 'Y'. 01890005
           05  PS-END-OF-STYLE-CSR-SW          PIC X(01)     VALUE 'N'. 01900005
               88  PS-END-OF-STYLE-CSR                       VALUE 'Y'. 01910005
           05  PS-END-OF-SCL-CSR-SW            PIC X(01)     VALUE 'N'. 01920005
               88  PS-END-OF-SCL-CSR                         VALUE 'Y'. 01930005
           05  PS-END-OF-MCL-CSR-SW            PIC X(01)     VALUE 'N'. 01940005
               88  PS-END-OF-MCL-CSR                         VALUE 'Y'. 01950005
           05  PS-END-OF-DEPT-CSR-SW           PIC X(01)     VALUE 'N'. 01960005
               88  PS-END-OF-DEPT-CSR                        VALUE 'Y'. 01970005
           05  PS-SKU-FOUND-SW                 PIC X(01)     VALUE 'N'. 01980005
               88  PS-SKU-FOUND                              VALUE 'N'. 01990005
               88  PS-SKU-NOT-FOUND                          VALUE 'Y'. 02000005
           05  PS-SKU-CLEARANCED-SW            PIC X(01)     VALUE 'N'. 02010005
               88  PS-SKU-CLEARANCED                         VALUE 'Y'. 02020005
               88  PS-SKU-NOT-CLEARANCED                     VALUE 'N'. 02030005
      ******************************************************************02040005
      * PA PROGRAM ACCUMULATORS                                        *02050005
      ******************************************************************02060005
       01  PA-PROGRAM-ACCUMULATORS.                                     02070005
           05  PA-RECS-WRITTEN               PIC S9(13) COMP-3 VALUE 0. 02080005
           05  PA-READ-COUNTER               PIC S9(11) COMP-3 VALUE 0. 02090005
                                                                        02100005
      ******************************************************************02110005
      *    EXCEPTION PRICING EXTRACT INPUT RECORD                       02120005
      ******************************************************************02130005
           COPY PMRD124.                                                02140017
                                                                        02150005
      ******************************************************************02160005
      *    OUTPUT RECORD - EXPLODED BY SKU/STORE                        02170005
      ******************************************************************02180005
           COPY PMRD125.                                                02190017
                                                                        02200005
      ******************************************************************02210005
      *    VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004      02220005
      ******************************************************************02230005
           COPY DPWS004.                                                02240005
                                                                        02250005
      ******************************************************************02260005
      *    TABLE INCLUDES                                               02270005
      ******************************************************************02280005
           EXEC SQL INCLUDE TMITGPL END-EXEC.                           02290021
           EXEC SQL INCLUDE TUPC END-EXEC.                              02300021
           EXEC SQL INCLUDE TUPCSKU END-EXEC.                           02310005
           EXEC SQL INCLUDE TPPCPRC END-EXEC.                           02320005
           EXEC SQL INCLUDE TSKXREF END-EXEC.                           02330005
           EXEC SQL INCLUDE TPLNSHP END-EXEC.                           02340005
      *    XST_SKU_LOC:                                                 02350005
           EXEC SQL INCLUDE XST00008 END-EXEC.                          02360005
      *    XST_SKU:                                                     02370005
           EXEC SQL INCLUDE XST00010 END-EXEC.                          02380005
      *    XST_VND_STYL:                                                02390005
           EXEC SQL INCLUDE XST00013 END-EXEC.                          02400005
      *    XST_STR_GP_MBSHP                                             02410032
           EXEC SQL INCLUDE XST00023 END-EXEC.                          02420032
      *    XST_PRCHG                                                    02430043
           EXEC SQL INCLUDE XST00063 END-EXEC.                          02440043
      *    XST_STR_GP_PRCHG                                             02450043
           EXEC SQL INCLUDE XST00064 END-EXEC.                          02460043
      *    XST_PRCHG_MDSE                                               02470043
           EXEC SQL INCLUDE XST00065 END-EXEC.                          02480043
                                                                        02490005
      ******************************************************************02500005
      *    SQL COMMUNICATIONS AREA DCLGEN                               02510005
      ******************************************************************02520005
           EXEC SQL                                                     02530005
               INCLUDE SQLCA                                            02540005
           END-EXEC.                                                    02550005
                                                                        02560005
      ******************************************************************02570005
      *    EXTENSION TO THE SQL COMMUNICATIONS AREA FOR EDITING        *02580005
      *    SQL CODES FOR DISPLAY                                       *02590005
      ******************************************************************02600005
           COPY SQLCA2.                                                 02610005
                                                                        02620005
      ******************************************************************02630005
      *    DEPT-CSR                                                     02640005
      ******************************************************************02650005
           EXEC SQL                                                     02660005
                DECLARE DEPT-CSR CURSOR                                 02670005
                FOR SELECT                                              02680005
                      A.MAJ_CL_NBR                                      02690005
                     ,A.SUB_CL_NBR                                      02700005
                     ,A.VS_ID                                           02710005
                     ,A.VS_NBR                                          02720005
                     ,B.INTR_UPC_ID                                     02730005
                     ,B.SKU_NBR                                         02740005
                     ,E.RTL_AMT                                         02750005
                     ,E.MEITGP_NBR                                      02760005
                     ,E.STATUS_CDE                                      02770005
                 FROM XST_VND_STYL A                                    02780005
                     ,XST_SKU B                                         02790005
                     ,TUPC    C                                         02800005
                     ,TUPCSKU D                                         02810005
                     ,TPPCPRC E                                         02820005
                WHERE A.STYL_ID = B.STYL_ID                             02830005
                  AND B.INTR_UPC_ID = C.INTR_UPC_ID                     02840005
                  AND C.UPC_TYP_CDE = 'I'                               02850012
                  AND C.UPC_NBR     = D.UPC_NBR                         02860005
                  AND D.ITEM_NBR    = E.TSK_ITM_NBR                     02870005
                  AND E.STATUS_CDE NOT IN (30,98)                       02880010
                  AND E.END_TMST  >= :PV-END-TMST                       02890051
                  AND E.STRT_TMST <= :PV-END-TMST                       02910005
                  AND A.DEPT_NBR = :PV-DEPT-NBR                         02920005
                  AND E.STR_NBR = 0                                     02930008
                WITH UR                                                 02940005
           END-EXEC.                                                    02950005
                                                                        02960005
      ******************************************************************02970005
      *    MCL-CSR                                                      02980005
      ******************************************************************02990005
           EXEC SQL                                                     03000005
                DECLARE MCL-CSR CURSOR                                  03010005
                FOR SELECT                                              03020005
                      A.SUB_CL_NBR                                      03030005
                     ,A.VS_ID                                           03040005
                     ,A.VS_NBR                                          03050005
                     ,B.INTR_UPC_ID                                     03060005
                     ,B.SKU_NBR                                         03070005
                     ,E.RTL_AMT                                         03080005
                     ,E.MEITGP_NBR                                      03090005
                     ,E.STATUS_CDE                                      03100005
                 FROM XST_VND_STYL A                                    03110005
                     ,XST_SKU B                                         03120005
                     ,TUPC    C                                         03130005
                     ,TUPCSKU D                                         03140005
                     ,TPPCPRC E                                         03150005
                WHERE A.STYL_ID = B.STYL_ID                             03160005
                  AND B.INTR_UPC_ID = C.INTR_UPC_ID                     03170005
                  AND C.UPC_TYP_CDE = 'I'                               03180012
                  AND C.UPC_NBR     = D.UPC_NBR                         03190005
                  AND D.ITEM_NBR    = E.TSK_ITM_NBR                     03200005
                  AND E.STATUS_CDE NOT IN (30,98)                       03210010
                  AND E.END_TMST  >= :PV-END-TMST                       03220051
                  AND E.STRT_TMST <= :PV-END-TMST                       03240005
                  AND A.DEPT_NBR = :PV-DEPT-NBR                         03250005
                  AND A.MAJ_CL_NBR = :PV-MAJ-CL-NBR                     03260005
                  AND E.STR_NBR = 0                                     03270008
                WITH UR                                                 03280005
           END-EXEC.                                                    03290005
                                                                        03300005
      ******************************************************************03310005
      *    SCL-CSR                                                      03320005
      ******************************************************************03330005
           EXEC SQL                                                     03340005
                DECLARE SCL-CSR CURSOR                                  03350005
                FOR SELECT                                              03360005
                      A.VS_ID                                           03370005
                     ,A.VS_NBR                                          03380005
                     ,B.INTR_UPC_ID                                     03390005
                     ,B.SKU_NBR                                         03400005
                     ,E.RTL_AMT                                         03410005
                     ,E.MEITGP_NBR                                      03420005
                     ,E.STATUS_CDE                                      03430005
                 FROM XST_VND_STYL A                                    03440005
                     ,XST_SKU B                                         03450005
                     ,TUPC    C                                         03460005
                     ,TUPCSKU D                                         03470005
                     ,TPPCPRC E                                         03480005
                WHERE A.STYL_ID = B.STYL_ID                             03490005
                  AND B.INTR_UPC_ID = C.INTR_UPC_ID                     03500005
                  AND C.UPC_TYP_CDE = 'I'                               03510012
                  AND C.UPC_NBR     = D.UPC_NBR                         03520005
                  AND D.ITEM_NBR    = E.TSK_ITM_NBR                     03530005
                  AND E.STATUS_CDE NOT IN (30,98)                       03540010
                  AND E.END_TMST  >= :PV-END-TMST                       03550051
                  AND E.STRT_TMST <= :PV-END-TMST                       03570005
                  AND A.DEPT_NBR = :PV-DEPT-NBR                         03580005
                  AND A.MAJ_CL_NBR = :PV-MAJ-CL-NBR                     03590005
                  AND A.SUB_CL_NBR = :PV-SUB-CL-NBR                     03600005
                  AND E.STR_NBR = 0                                     03610008
                WITH UR                                                 03620005
           END-EXEC.                                                    03630005
                                                                        03640005
      ******************************************************************03650005
      *    STYLE-CSR                                                    03660005
      ******************************************************************03670005
           EXEC SQL                                                     03680005
                DECLARE STYLE-CSR CURSOR                                03690005
                FOR SELECT                                              03700005
                      A.VS_NBR                                          03710005
                     ,B.INTR_UPC_ID                                     03720005
                     ,B.SKU_NBR                                         03730005
                     ,E.RTL_AMT                                         03740005
                     ,E.MEITGP_NBR                                      03750005
                     ,E.STATUS_CDE                                      03760005
                 FROM XST_VND_STYL A                                    03770005
                     ,XST_SKU B                                         03780005
                     ,TUPC    C                                         03790005
                     ,TUPCSKU D                                         03800005
                     ,TPPCPRC E                                         03810005
                WHERE A.STYL_ID = B.STYL_ID                             03820005
                  AND B.INTR_UPC_ID = C.INTR_UPC_ID                     03830005
                  AND C.UPC_TYP_CDE = 'I'                               03840012
                  AND C.UPC_NBR     = D.UPC_NBR                         03850005
                  AND D.ITEM_NBR    = E.TSK_ITM_NBR                     03860005
                  AND E.STATUS_CDE NOT IN (30,98)                       03870010
                  AND E.END_TMST  >= :PV-END-TMST                       03880051
                  AND E.STRT_TMST <= :PV-END-TMST                       03900005
                  AND A.DEPT_NBR = :PV-DEPT-NBR                         03910005
                  AND A.MAJ_CL_NBR = :PV-MAJ-CL-NBR                     03920005
                  AND A.SUB_CL_NBR = :PV-SUB-CL-NBR                     03930005
                  AND A.VS_ID = :PV-VS-ID                               03940005
                  AND E.STR_NBR = 0                                     03950008
                WITH UR                                                 03960005
           END-EXEC.                                                    03970005
                                                                        03980005
      ******************************************************************03990005
      * AC ABEND CODES                                                 *04000005
      ******************************************************************04010005
                                                                        04020005
       01  ABEND-CODE                       PIC S9(04)   COMP VALUE +0. 04030005
           88  ABEND-4001-WRITE-ERROR                    VALUE +4001.   04040005
           88  ABEND-4002-READ-ERROR                     VALUE +4002.   04050005
           88  ABEND-4003-CTRL-CARD-ERROR                VALUE +4003.   04060005
           88  ABEND-4004-TABLE-ERROR                    VALUE +4004.   04070005
           88  ABEND-4005-OPEN-ERROR                     VALUE +4005.   04080005
           88  ABEND-4006-CLOSE-ERROR                    VALUE +4006.   04090005
           88  ABEND-4007-SEQUENCE-ERROR                 VALUE +4007.   04100005
           88  ABEND-4008-DATA-ERROR                     VALUE +4008.   04110005
           88  ABEND-4009-KEY-DATA-ERROR                 VALUE +4009.   04120005
           88  ABEND-4013-DB2-ERROR                      VALUE +4013.   04130005
           88  ABEND-4019-DATE-ROUTINE-ERROR             VALUE +4019.   04140005
           88  ABEND-4444-FORCED-ABEND                   VALUE +4444.   04150005
                                                                        04162005
       PROCEDURE DIVISION.                                              04170005
                                                                        04180005
      ******************************************************************04190005
      * MAIN PROCESSING                                                 04200005
      ******************************************************************04210005
       A100-PROGRAM-MAINLINE.                                           04220005
                                                                        04230005
           PERFORM B100-INITIALIZE                                      04240005
           PERFORM B200-READ-PRICING-FILE                               04250005
                                                                        04260005
           IF PS-END-OF-PRICING-FILE                                    04270005
               DISPLAY ' '                                              04280005
               DISPLAY '*** EMPTY INPUT FILE. ***'                      04290005
               DISPLAY ' '                                              04300005
           ELSE                                                         04310005
               PERFORM B300-PROCESS-PRICING-FILE                        04320005
                   UNTIL PS-END-OF-PRICING-FILE                         04330005
           END-IF                                                       04340005
                                                                        04350005
           PERFORM B900-EOJ-ROUTINE                                     04360005
                                                                        04370005
           GOBACK.                                                      04380005
                                                                        04390005
      ******************************************************************04400005
      * OPEN FILES                                                      04410005
      ******************************************************************04420005
       B100-INITIALIZE.                                                 04430005
                                                                        04440005
           OPEN INPUT PRICING-FILE.                                     04450005
           OPEN OUTPUT EXPLODED-FILE.                                   04460005
                                                                        04470005
      ******************************************************************04480005
      * READ IN THE PRICING EXTRACT FILE                                04490005
      ******************************************************************04500005
       B200-READ-PRICING-FILE.                                          04510005
                                                                        04520005
           READ PRICING-FILE                                            04530005
               INTO PM124-EXCPT-PRCG-EXT                                04540017
               AT END                                                   04550005
                   SET PS-END-OF-PRICING-FILE TO TRUE.                  04560005
                                                                        04570005
      ******************************************************************04580005
      * PROCESS THE PRICING EXTRACT FILE                                04590005
      ******************************************************************04600005
       B300-PROCESS-PRICING-FILE.                                       04610005
                                                                        04620005
      *    CONVERT FROM ORACLE TO DB2 DATE/TIME                         04630005
           MOVE PM124-STRT-TMST(1:2)  TO PV-BEG-TMST-CC                 04640023
           MOVE PM124-STRT-TMST(3:1)  TO PV-BEG-TMST-Y1                 04650029
           MOVE PM124-STRT-TMST(4:1)  TO PV-BEG-TMST-Y2                 04660029
           MOVE PM124-STRT-TMST(5:1)  TO PV-BEG-TMST-DASH1              04670023
           MOVE PM124-STRT-TMST(6:2)  TO PV-BEG-TMST-MM                 04680023
           MOVE PM124-STRT-TMST(8:1)  TO PV-BEG-TMST-DASH2              04690023
           MOVE PM124-STRT-TMST(9:2)  TO PV-BEG-TMST-DD                 04700023
           MOVE '-'                   TO PV-BEG-TMST-HYPHEN             04710005
           MOVE PM124-STRT-TMST(12:2) TO PV-BEG-TMST-HH                 04720017
           MOVE '.'                   TO PV-BEG-TMST-DOT1               04730005
           MOVE PM124-STRT-TMST(15:2) TO PV-BEG-TMST-MI                 04740017
           MOVE '.'                   TO PV-BEG-TMST-DOT2               04750005
           MOVE PM124-STRT-TMST(18:2) TO PV-BEG-TMST-SS                 04760017
           MOVE '.000000'             TO PV-BEG-TMST-DB2-EXTRA          04770005
                                                                        04780005
           MOVE PM124-END-TMST(1:2)   TO PV-END-TMST-CC                 04790023
           MOVE PM124-END-TMST(3:1)   TO PV-END-TMST-Y1                 04800029
           MOVE PM124-END-TMST(4:1)   TO PV-END-TMST-Y2                 04810030
           MOVE PM124-END-TMST(5:1)   TO PV-END-TMST-DASH1              04820023
           MOVE PM124-END-TMST(6:2)   TO PV-END-TMST-MM                 04830023
           MOVE PM124-END-TMST(8:1)   TO PV-END-TMST-DASH2              04840023
           MOVE PM124-END-TMST(9:2)   TO PV-END-TMST-DD                 04850023
           MOVE '-'                   TO PV-END-TMST-HYPHEN             04860005
           MOVE PM124-END-TMST(12:2)  TO PV-END-TMST-HH                 04870017
           MOVE '.'                   TO PV-END-TMST-DOT1               04880005
           MOVE PM124-END-TMST(15:2)  TO PV-END-TMST-MI                 04890017
           MOVE '.'                   TO PV-END-TMST-DOT2               04900005
           MOVE PM124-END-TMST(18:2)  TO PV-END-TMST-SS                 04910017
           MOVE '.000000'             TO PV-END-TMST-DB2-EXTRA          04920005
                                                                        04930005
           MOVE 'N' TO PS-END-OF-STYLE-CSR-SW                           04940005
           MOVE 'N' TO PS-END-OF-SCL-CSR-SW                             04950005
           MOVE 'N' TO PS-END-OF-MCL-CSR-SW                             04960005
           MOVE 'N' TO PS-END-OF-DEPT-CSR-SW                            04970005
                                                                        04980005
           MOVE 0   TO PV-SKU-NBR                                       04990040
           MOVE 0   TO PV-VS-ID                                         05000040
           MOVE 0   TO PV-SUB-CL-NBR                                    05010040
           MOVE 0   TO PV-MAJ-CL-NBR                                    05020040
           MOVE 0   TO PV-DEPT-NBR                                      05030040
                                                                        05040005
           IF PM124-MDSE-HIER-CDE = 'SKU'                               05050017
               MOVE PM124-SKU-NBR TO PV-SKU-NBR                         05060017
                                                                        05070005
      *        0 = EXCLUSION, 1 = INCLUSION                             05080005
               IF PM124-REC-TYP-CDE = 0                                 05090017
      *            ADD EXCLUDED SKU TO EXCL TABLE                       05100005
                   ADD +1 TO PV-MAX-EXCL                                05110005
                   IF PV-MAX-EXCL < PC-EXCL-LIMIT                       05120005
                       MOVE PM124-MDSE-SELN-ID                          05130017
                           TO PT-MDSE-SELN-ID (PV-MAX-EXCL)             05140005
                       MOVE PM124-MDSE-SELN-LNE-ID                      05150017
                           TO PT-MDSE-SELN-LNE-ID (PV-MAX-EXCL)         05160005
                       MOVE PM124-SKU-NBR                               05170017
                           TO PT-SKU-NBR (PV-MAX-EXCL)                  05180005
                   ELSE                                                 05190005
                       MOVE 'B300-PROCESS-PRICING' TO PV-PARAGRAPH-NAME 05200005
                       MOVE 'TOO MANY EXCLUSIONS ' TO PV-OPERATION-MSG-105210005
                       PERFORM Z900-SQL-ABEND                           05220005
                   END-IF                                               05230005
               ELSE                                                     05240005
      *            LOOK FOR THE SKU IN THE EXCLUSION LIST               05250005
                   PERFORM WITH TEST BEFORE                             05260005
                       VARYING PV-EXCL-SUB FROM +1 BY +1                05270005
                       UNTIL (PV-EXCL-SUB > PV-MAX-EXCL) OR             05280005
                         ( PT-SKU-NBR(PV-EXCL-SUB) = PM124-SKU-NBR AND  05290017
                           PT-MDSE-SELN-ID(PV-EXCL-SUB) =               05300005
                               PM124-MDSE-SELN-ID AND                   05310017
                           PT-MDSE-SELN-LNE-ID(PV-EXCL-SUB) =           05320005
                               PM124-MDSE-SELN-LNE-ID )                 05330017
                   END-PERFORM                                          05340005
                                                                        05350005
      *            IF SKU WASN'T FOUND IN THE EXCLUSION LIST, PROCESS IT05360005
                   IF PV-EXCL-SUB > PV-MAX-EXCL                         05370005
                       PERFORM C100-SELECT-SKU                          05380005
                       IF PS-SKU-FOUND                                  05390005
                          PERFORM C300-PROCESS-SKU                      05400005
                       END-IF                                           05410005
                   END-IF                                               05420005
               END-IF                                                   05430005
           ELSE                                                         05440005
               IF PM124-MDSE-HIER-CDE = 'STY'                           05450017
      *            PROCESS STYLE-CSR                                    05460005
                   MOVE PM124-VS-ID      TO PV-VS-ID                    05470017
                   MOVE PM124-SUB-CL-NBR TO PV-SUB-CL-NBR               05480017
                   MOVE PM124-MAJ-CL-NBR TO PV-MAJ-CL-NBR               05490017
                   MOVE PM124-DEPT-NBR   TO PV-DEPT-NBR                 05500017
                                                                        05510005
                   PERFORM D100-OPEN-STYLE-CSR                          05520005
                   PERFORM D200-FETCH-STYLE-CSR                         05530005
                   IF NOT PS-END-OF-STYLE-CSR                           05540005
                       PERFORM D300-PROCESS-STYLE-CSR                   05550005
                         UNTIL PS-END-OF-STYLE-CSR                      05560005
                   END-IF                                               05570005
                   PERFORM D400-CLOSE-STYLE-CSR                         05580005
               ELSE                                                     05590005
                   IF PM124-MDSE-HIER-CDE = 'SCL'                       05600017
      *                PROCESS SCL-CSR                                  05610005
                       MOVE PM124-SUB-CL-NBR TO PV-SUB-CL-NBR           05620017
                       MOVE PM124-MAJ-CL-NBR TO PV-MAJ-CL-NBR           05630017
                       MOVE PM124-DEPT-NBR   TO PV-DEPT-NBR             05640017
                                                                        05650005
                       PERFORM E100-OPEN-SCL-CSR                        05660005
                       PERFORM E200-FETCH-SCL-CSR                       05670005
                       IF NOT PS-END-OF-SCL-CSR                         05680005
                           PERFORM E300-PROCESS-SCL-CSR                 05690005
                             UNTIL PS-END-OF-SCL-CSR                    05700005
                       END-IF                                           05710005
                       PERFORM E400-CLOSE-SCL-CSR                       05720005
                   ELSE                                                 05730005
                       IF PM124-MDSE-HIER-CDE = 'MCL'                   05740017
      *                    PROCESS MCL-CSR                              05750005
                           MOVE PM124-MAJ-CL-NBR TO PV-MAJ-CL-NBR       05760017
                           MOVE PM124-DEPT-NBR   TO PV-DEPT-NBR         05770017
                                                                        05780005
                           PERFORM F100-OPEN-MCL-CSR                    05790005
                           PERFORM F200-FETCH-MCL-CSR                   05800005
                           IF NOT PS-END-OF-MCL-CSR                     05810005
                               PERFORM F300-PROCESS-MCL-CSR             05820005
                                 UNTIL PS-END-OF-MCL-CSR                05830005
                           END-IF                                       05840005
                           PERFORM F400-CLOSE-MCL-CSR                   05850005
                       ELSE                                             05860005
      *                    PROCESS DEPT-CSR                             05870005
                           MOVE PM124-DEPT-NBR   TO PV-DEPT-NBR         05880017
                                                                        05890005
                           PERFORM G100-OPEN-DEPT-CSR                   05900005
                           PERFORM G200-FETCH-DEPT-CSR                  05910005
                           IF NOT PS-END-OF-DEPT-CSR                    05920005
                               PERFORM G300-PROCESS-DEPT-CSR            05930005
                                 UNTIL PS-END-OF-DEPT-CSR               05940005
                           END-IF                                       05950005
                           PERFORM G400-CLOSE-DEPT-CSR                  05960005
                       END-IF                                           05970005
                   END-IF                                               05980005
               END-IF                                                   05990005
           END-IF                                                       06000005
                                                                        06010005
           ADD +1 TO PA-READ-COUNTER.                                   06020005
                                                                        06030005
      *    DISPLAY PROGRESS                                             06040005
           DIVIDE PA-READ-COUNTER BY 10000                              06050005
               GIVING PV-RECS-DIV                                       06060005
               REMAINDER PV-RECS-REM                                    06070005
           IF PV-RECS-REM = 0                                           06080005
               DISPLAY PA-READ-COUNTER ' INPUT RECORDS PROCESSED'       06090005
               ACCEPT PV-CPU-TIME FROM TIME                             06100015
               DISPLAY 'TIMESTAMP: ' PV-CPU-TIME                        06110015
           END-IF                                                       06120005
                                                                        06130005
           PERFORM B200-READ-PRICING-FILE.                              06140005
                                                                        06150005
      ******************************************************************06160005
      * CLEAN UP                                                        06170005
      ******************************************************************06180005
       B900-EOJ-ROUTINE.                                                06190005
                                                                        06200005
           CLOSE PRICING-FILE                                           06210005
                 EXPLODED-FILE.                                         06220005
                                                                        06230005
           DISPLAY ' '                                                  06240005
           DISPLAY 'TOTAL NUMBER OF RECORDS WRITTEN: ' PA-RECS-WRITTEN  06250005
           DISPLAY ' '.                                                 06260005
                                                                        06270005
      ******************************************************************06280005
      * RETRIEVE THE INPUT SKU'S INFO                                   06290005
      ******************************************************************06300005
       C100-SELECT-SKU.                                                 06310005
                                                                        06320005
           EXEC SQL                                                     06330005
               SELECT A.DEPT_NBR                                        06340005
                     ,A.MAJ_CL_NBR                                      06350005
                     ,A.SUB_CL_NBR                                      06360005
                     ,A.VS_ID                                           06370005
                     ,A.VS_NBR                                          06380005
                     ,B.INTR_UPC_ID                                     06390005
                     ,E.RTL_AMT                                         06400005
                     ,E.MEITGP_NBR                                      06410005
                     ,E.STATUS_CDE                                      06420005
                 INTO :XST00013-DEPT-NBR                                06430005
                     ,:XST00013-MAJ-CL-NBR                              06440005
                     ,:XST00013-SUB-CL-NBR                              06450005
                     ,:XST00013-VS-ID                                   06460005
                     ,:XST00013-VS-NBR                                  06470005
                     ,:XST00010-INTR-UPC-ID                             06480005
                     ,:PPCPRC-RTL-AMT                                   06490005
                     ,:PPCPRC-MEITGP-NBR:PV-MEITGP-NBR-NI               06500005
                     ,:PPCPRC-STATUS-CDE                                06510005
                 FROM XST_VND_STYL A                                    06520005
                     ,XST_SKU B                                         06530005
                     ,TUPC    C                                         06540005
                     ,TUPCSKU D                                         06550005
                     ,TPPCPRC E                                         06560005
                WHERE A.STYL_ID = B.STYL_ID                             06570005
                  AND B.INTR_UPC_ID = C.INTR_UPC_ID                     06580005
                  AND C.UPC_TYP_CDE = 'I'                               06590012
                  AND C.UPC_NBR     = D.UPC_NBR                         06600005
                  AND D.ITEM_NBR    = E.TSK_ITM_NBR                     06610005
                  AND E.STATUS_CDE NOT IN (30,98)                       06620010
                  AND E.STRT_TMST <= :PV-END-TMST                       06630012
                  AND E.END_TMST  >= :PV-END-TMST                       06640051
                  AND B.SKU_NBR = :PV-SKU-NBR                           06660005
                  AND E.STR_NBR = 0                                     06670008
                WITH UR                                                 06680005
           END-EXEC.                                                    06690005
                                                                        06700005
           EVALUATE TRUE                                                06710005
               WHEN SQLCODE = 0                                         06720005
                   IF PV-GP-RTL-QTY-NI < 0                              06730005
                       MOVE 0 TO PPCPRC-MEITGP-NBR                      06740005
                   END-IF                                               06750005
                   IF PV-GP-RTL-AMT-NI < 0                              06760005
                       MOVE 0 TO XST00008-GP-RTL-AMT                    06770005
                   END-IF                                               06780005
                   SET PS-SKU-FOUND            TO TRUE                  06790005
               WHEN SQLCODE = +100                                      06800005
                   MOVE 'C100-PROCESS-SKU'     TO PV-PARAGRAPH-NAME     06810005
                   MOVE 'SKU NOT FOUND: '      TO PV-OPERATION-MSG-1    06820005
                   MOVE PV-SKU-NBR             TO PV-OPERATION-MSG-2    06830005
      *            PERFORM Z900-SQL-ABEND                               06840005
                   SET PS-SKU-NOT-FOUND        TO TRUE                  06850005
               WHEN OTHER                                               06860005
                   MOVE 'C100-PROCESS-SKU'     TO PV-PARAGRAPH-NAME     06870005
                   MOVE 'ERROR ON SKU SELECT ' TO PV-OPERATION-MSG-1    06880005
                   MOVE PV-SKU-NBR             TO PV-OPERATION-MSG-2    06890005
                   PERFORM Z900-SQL-ABEND                               06900005
           END-EVALUATE.                                                06910005
                                                                        06920005
      ******************************************************************06930005
      * PROCESS THE SKU                                                 06940005
      ******************************************************************06950005
       C300-PROCESS-SKU.                                                06960005
                                                                        06970005
      *    ONLY GET HERE FOR INCLUSIONS, SO JUST WRITE IT OUT.          06980005
           MOVE PM124-SKU-NBR          TO PM125-SKU-NBR                 06990018
           MOVE PM124-STR-NBR          TO PM125-LOC-NBR                 07000018
           MOVE PM124-PROMO-INTFC-ID   TO PM125-PROMO-INTFC-ID          07010018
           MOVE PM124-MDSE-SELN-ID     TO PM125-MDSE-SELN-ID            07020018
           MOVE PM124-MDSE-SELN-LNE-ID TO PM125-MDSE-SELN-LNE-ID        07030018
           MOVE PM124-AD-EVNT-ID       TO PM125-AD-EVNT-ID              07040018
           MOVE PM124-PROMO-ID         TO PM125-PROMO-ID                07050018
                                                                        07060023
           IF PV-BEG-TMST-Y1 = 0                                        07070029
               MOVE SPACES             TO  PM125-PROMO-STRT-DATE-Y1     07080040
           ELSE                                                         07090029
               MOVE PV-BEG-TMST-Y1     TO  PM125-PROMO-STRT-DATE-Y1     07100040
           END-IF.                                                      07110029
           MOVE PV-BEG-TMST-Y2         TO PM125-PROMO-STRT-DATE-Y2.     07120029
           MOVE PV-BEG-TMST-MM         TO PM125-PROMO-STRT-DATE-MM.     07130023
           MOVE PV-BEG-TMST-DD         TO PM125-PROMO-STRT-DATE-DD.     07140023
           MOVE PV-BEG-TMST-TIME       TO PM125-PROMO-STRT-TIME.        07150023
           IF PV-END-TMST-Y1 = 0                                        07160029
               MOVE SPACES             TO  PM125-PROMO-END-DATE-Y1      07170040
           ELSE                                                         07180029
               MOVE PV-END-TMST-Y1     TO  PM125-PROMO-END-DATE-Y1      07190040
           END-IF.                                                      07200029
           MOVE PV-END-TMST-Y2         TO PM125-PROMO-END-DATE-Y2.      07210029
           MOVE PV-END-TMST-MM         TO PM125-PROMO-END-DATE-MM.      07220023
           MOVE PV-END-TMST-DD         TO PM125-PROMO-END-DATE-DD.      07230023
           MOVE PV-END-TMST-TIME       TO PM125-PROMO-END-TIME.         07240023
                                                                        07250023
           MOVE PM124-PROMO-ITM-ID     TO PM125-PROMO-ITM-ID            07260018
           MOVE PM124-AD-EVNT-NM       TO PM125-AD-EVNT-NM              07270018
           MOVE PM124-PROMO-NM         TO PM125-PROMO-NM                07280018
           MOVE PM124-PROMO-ABBR-NM    TO PM125-PROMO-ABBR-NM           07290018
           MOVE PM124-PROMO-ITM-DESC   TO PM125-PROMO-ITM-DESC          07300018
           MOVE PM124-MDSE-SELN-DESC   TO PM125-MDSE-SELN-DESC          07310018
           MOVE PM124-AD-PG-NBR        TO PM125-AD-PG-NBR               07320040
           MOVE PM124-AD-PG-SEQ-NBR    TO PM125-AD-PG-SEQ-NBR           07330040
           MOVE PM124-AD-SP-CDE        TO PM125-AD-SP-CDE               07340040
                                                                        07350005
           MOVE XST00013-DEPT-NBR      TO PM125-DEPT-NBR                07360018
           MOVE XST00013-MAJ-CL-NBR    TO PM125-MAJ-CL-NBR              07370018
           MOVE XST00013-SUB-CL-NBR    TO PM125-SUB-CL-NBR              07380018
           MOVE XST00013-VS-ID         TO PM125-VS-ID                   07390018
           MOVE XST00013-VS-NBR        TO PM125-VS-NBR                  07400018
                                                                        07410005
           MOVE PM125-SKU-NBR          TO PV-SKU-NBR2                   07420018
           MOVE PM125-LOC-NBR          TO PV-STR-NBR                    07430018
           PERFORM H500-CHECK-FUTURE-PERM-CHANGES                       07440005
                                                                        07450005
           IF PS-SKU-NOT-CLEARANCED                                     07460005
             PERFORM H100-MOVE-PROMO-PRICE-FIELDS                       07470005
                                                                        07480005
             MOVE PPCPRC-RTL-AMT TO PM125-UNT-RTL-AMT                   07490018
             IF PPCPRC-MEITGP-NBR > 0                                   07500021
                 PERFORM H700-RETRIEVE-RETAIL-GROUP                     07510021
             ELSE                                                       07520021
                 MOVE ZEROES TO PM125-GP-RTL-QTY                        07530021
                                PM125-GP-RTL-AMT                        07540021
             END-IF                                                     07550022
             MOVE PPCPRC-STATUS-CDE TO PV-STATUS-CDE                    07560033
             MOVE PV-STATUS-CDE-23  TO PM125-LOC-SKU-STAT-CDE           07570033
                                                                        07580005
             MOVE 1 TO PM125-MDSE-HIER-LVL-CDE                          07590018
                                                                        07600005
             PERFORM W100-WRITE-EXPLODED-FILE                           07610005
           ELSE                                                         07620005
             SET PS-SKU-NOT-CLEARANCED TO TRUE                          07630005
           END-IF.                                                      07640005
                                                                        07650005
      ******************************************************************07660005
      * OPEN THE STYLE CURSOR                                           07670005
      ******************************************************************07680005
       D100-OPEN-STYLE-CSR.                                             07690005
                                                                        07700005
           EXEC SQL                                                     07710005
               OPEN STYLE-CSR                                           07720005
           END-EXEC.                                                    07730005
                                                                        07740005
           EVALUATE TRUE                                                07750005
               WHEN SQLCODE = +0                                        07760005
                   CONTINUE                                             07770005
               WHEN OTHER                                               07780005
                   MOVE 'D100-OPEN-STYLE-CSR           '                07790005
                                     TO PV-PARAGRAPH-NAME               07800005
                   MOVE 'OPEN ERROR ON STYLE-CSR     '                  07810005
                                     TO PV-OPERATION-MSG-1              07820005
                   PERFORM Z900-SQL-ABEND                               07830005
           END-EVALUATE.                                                07840005
                                                                        07850005
      ******************************************************************07860005
      * FETCH THE STYLE CURSOR                                          07870005
      ******************************************************************07880005
       D200-FETCH-STYLE-CSR.                                            07890005
                                                                        07900005
           EXEC SQL                                                     07910005
               FETCH STYLE-CSR                                          07920005
                INTO :XST00013-VS-NBR                                   07930005
                    ,:XST00010-INTR-UPC-ID                              07940005
                    ,:XST00010-SKU-NBR                                  07950005
                    ,:PPCPRC-RTL-AMT                                    07960005
                    ,:PPCPRC-MEITGP-NBR:PV-MEITGP-NBR-NI                07970005
                    ,:PPCPRC-STATUS-CDE                                 07980005
           END-EXEC.                                                    07990005
                                                                        08000005
           EVALUATE TRUE                                                08010005
               WHEN SQLCODE = +0                                        08020005
                   IF PV-GP-RTL-QTY-NI < 0                              08030005
                       MOVE 0 TO PPCPRC-MEITGP-NBR                      08040005
                   END-IF                                               08050005
                   IF PV-GP-RTL-AMT-NI < 0                              08060005
                       MOVE 0 TO XST00008-GP-RTL-AMT                    08070005
                   END-IF                                               08080005
               WHEN SQLCODE = +100                                      08090005
                   SET PS-END-OF-STYLE-CSR TO TRUE                      08100005
               WHEN OTHER                                               08110005
                   MOVE 'D200-FETCH-STYLE-CSR          '                08120005
                                     TO PV-PARAGRAPH-NAME               08130005
                   MOVE 'FETCH ERROR ON STYLE-CSR    '                  08140005
                                     TO PV-OPERATION-MSG-1              08150005
                   PERFORM Z900-SQL-ABEND                               08160005
           END-EVALUATE.                                                08170005
                                                                        08180005
      ******************************************************************08190005
      * PROCESS THE STYLE CURSOR                                        08200005
      ******************************************************************08210005
       D300-PROCESS-STYLE-CSR.                                          08220005
                                                                        08230005
           IF PM124-REC-TYP-CDE = 0                                     08240017
      *        ADD EXCLUDED SKU TO EXCL TABLE                           08250005
               ADD +1 TO PV-MAX-EXCL                                    08260005
               IF PV-MAX-EXCL < PC-EXCL-LIMIT                           08270005
                   MOVE PM124-MDSE-SELN-ID                              08280017
                       TO PT-MDSE-SELN-ID (PV-MAX-EXCL)                 08290005
                   MOVE PM124-MDSE-SELN-LNE-ID                          08300017
                       TO PT-MDSE-SELN-LNE-ID (PV-MAX-EXCL)             08310005
                   MOVE XST00010-SKU-NBR                                08320005
                       TO PT-SKU-NBR (PV-MAX-EXCL)                      08330005
               ELSE                                                     08340005
                   MOVE 'D300-PROCESS-STYLE'   TO PV-PARAGRAPH-NAME     08350040
                   MOVE 'TOO MANY EXCLUSIONS ' TO PV-OPERATION-MSG-1    08360005
                   PERFORM Z900-SQL-ABEND                               08370005
               END-IF                                                   08380005
           ELSE                                                         08390005
      *        LOOK FOR THE SKU IN THE EXCLUSION LIST                   08400005
               PERFORM WITH TEST BEFORE                                 08410005
                   VARYING PV-EXCL-SUB FROM +1 BY +1                    08420005
                   UNTIL (PV-EXCL-SUB > PV-MAX-EXCL) OR                 08430005
                     ( PT-SKU-NBR(PV-EXCL-SUB) = XST00010-SKU-NBR AND   08440005
                       PT-MDSE-SELN-ID(PV-EXCL-SUB) =                   08450005
                           PM124-MDSE-SELN-ID AND                       08460017
                       PT-MDSE-SELN-LNE-ID(PV-EXCL-SUB) =               08470005
                           PM124-MDSE-SELN-LNE-ID )                     08480017
               END-PERFORM                                              08490005
                                                                        08500005
      *        IF SKU WASN'T FOUND IN THE EXCLUSION LIST, WRITE IT      08510005
               IF PV-EXCL-SUB > PV-MAX-EXCL                             08520005
                   MOVE XST00010-SKU-NBR       TO PM125-SKU-NBR         08530040
                   MOVE PM124-STR-NBR          TO PM125-LOC-NBR         08540040
                   MOVE PM124-PROMO-INTFC-ID   TO PM125-PROMO-INTFC-ID  08550040
                   MOVE PM124-MDSE-SELN-ID     TO PM125-MDSE-SELN-ID    08560040
                   MOVE PM124-MDSE-SELN-LNE-ID TO PM125-MDSE-SELN-LNE-ID08570018
                   MOVE PM124-AD-EVNT-ID       TO PM125-AD-EVNT-ID      08580040
                   MOVE PM124-PROMO-ID         TO PM125-PROMO-ID        08590040
                   MOVE PM124-PROMO-ITM-ID     TO PM125-PROMO-ITM-ID    08600040
                   MOVE PM124-AD-EVNT-NM       TO PM125-AD-EVNT-NM      08610040
                   MOVE PM124-PROMO-NM         TO PM125-PROMO-NM        08620040
                   MOVE PM124-PROMO-ABBR-NM    TO PM125-PROMO-ABBR-NM   08630040
                   MOVE PM124-PROMO-ITM-DESC   TO PM125-PROMO-ITM-DESC  08640040
                   MOVE PM124-MDSE-SELN-DESC   TO PM125-MDSE-SELN-DESC  08650040
                   MOVE PM124-AD-PG-NBR        TO PM125-AD-PG-NBR       08660040
                   MOVE PM124-AD-PG-SEQ-NBR    TO PM125-AD-PG-SEQ-NBR   08670040
                   MOVE PM124-AD-SP-CDE        TO PM125-AD-SP-CDE       08680040
                                                                        08690026
                   IF PV-BEG-TMST-Y1 = 0                                08700030
                       MOVE SPACES       TO  PM125-PROMO-STRT-DATE-Y1   08710040
                   ELSE                                                 08720030
                       MOVE PV-BEG-TMST-Y1                              08730030
                                         TO  PM125-PROMO-STRT-DATE-Y1   08740040
                   END-IF                                               08750030
                   MOVE PV-BEG-TMST-Y2   TO PM125-PROMO-STRT-DATE-Y2    08760030
                   MOVE PV-BEG-TMST-MM   TO PM125-PROMO-STRT-DATE-MM    08770030
                   MOVE PV-BEG-TMST-DD   TO PM125-PROMO-STRT-DATE-DD    08780030
                   MOVE PV-BEG-TMST-TIME TO PM125-PROMO-STRT-TIME       08790030
                   IF PV-END-TMST-Y1 = 0                                08800030
                       MOVE SPACES       TO  PM125-PROMO-END-DATE-Y1    08810040
                   ELSE                                                 08820030
                       MOVE PV-END-TMST-Y1                              08830030
                                         TO  PM125-PROMO-END-DATE-Y1    08840040
                   END-IF                                               08850030
                   MOVE PV-END-TMST-Y2   TO PM125-PROMO-END-DATE-Y2     08860030
                   MOVE PV-END-TMST-MM   TO PM125-PROMO-END-DATE-MM     08870030
                   MOVE PV-END-TMST-DD   TO PM125-PROMO-END-DATE-DD     08880030
                   MOVE PV-END-TMST-TIME TO PM125-PROMO-END-TIME        08890030
                                                                        08900030
                   MOVE PM124-DEPT-NBR   TO PM125-DEPT-NBR              08910040
                   MOVE PM124-MAJ-CL-NBR TO PM125-MAJ-CL-NBR            08920018
                   MOVE PM124-SUB-CL-NBR TO PM125-SUB-CL-NBR            08930018
                   MOVE PM124-VS-ID      TO PM125-VS-ID                 08940040
                   MOVE XST00013-VS-NBR  TO PM125-VS-NBR                08950040
                                                                        08960005
                   MOVE PM125-SKU-NBR    TO PV-SKU-NBR2                 08970040
                   MOVE PM125-LOC-NBR    TO PV-STR-NBR                  08980040
                   PERFORM H500-CHECK-FUTURE-PERM-CHANGES               08990005
                                                                        09000005
                   IF PS-SKU-NOT-CLEARANCED                             09010005
                     PERFORM H100-MOVE-PROMO-PRICE-FIELDS               09020005
                                                                        09030005
                     MOVE PPCPRC-RTL-AMT TO PM125-UNT-RTL-AMT           09040018
                     IF PPCPRC-MEITGP-NBR > 0                           09050021
                         PERFORM H700-RETRIEVE-RETAIL-GROUP             09060021
                     ELSE                                               09070021
                         MOVE ZEROES TO PM125-GP-RTL-QTY                09080021
                                        PM125-GP-RTL-AMT                09090021
                     END-IF                                             09100021
                     MOVE PPCPRC-STATUS-CDE TO PV-STATUS-CDE            09110033
                     MOVE PV-STATUS-CDE-23  TO PM125-LOC-SKU-STAT-CDE   09120040
                                                                        09130005
                     MOVE XST00010-SKU-NBR  TO PV-SKU-NBR               09140040
                                                                        09150005
                     MOVE 2                 TO PM125-MDSE-HIER-LVL-CDE  09160040
                                                                        09170005
                     PERFORM W100-WRITE-EXPLODED-FILE                   09180005
                   ELSE                                                 09190005
                     SET PS-SKU-NOT-CLEARANCED TO TRUE                  09200005
                   END-IF                                               09210005
               END-IF                                                   09220005
           END-IF                                                       09230005
                                                                        09240005
           PERFORM D200-FETCH-STYLE-CSR.                                09250005
                                                                        09260005
      ******************************************************************09270005
      * CLOSE THE STYLE CURSOR                                          09280005
      ******************************************************************09290005
       D400-CLOSE-STYLE-CSR.                                            09300005
                                                                        09310005
           EXEC SQL                                                     09320005
               CLOSE STYLE-CSR                                          09330005
           END-EXEC.                                                    09340005
                                                                        09350005
           EVALUATE TRUE                                                09360005
               WHEN SQLCODE = +0                                        09370005
                   CONTINUE                                             09380005
               WHEN OTHER                                               09390005
                   MOVE 'D400-CLOSE-STYLE-CSR           '               09400005
                                     TO PV-PARAGRAPH-NAME               09410005
                   MOVE 'CLOSE ERROR ON STYLE-CSR     '                 09420005
                                     TO PV-OPERATION-MSG-1              09430005
                   PERFORM Z900-SQL-ABEND                               09440005
           END-EVALUATE.                                                09450005
                                                                        09460005
      ******************************************************************09470005
      * OPEN THE SUBCLASS CURSOR                                        09480005
      ******************************************************************09490005
       E100-OPEN-SCL-CSR.                                               09500005
                                                                        09510005
           EXEC SQL                                                     09520005
               OPEN SCL-CSR                                             09530005
           END-EXEC.                                                    09540005
                                                                        09550005
           EVALUATE TRUE                                                09560005
               WHEN SQLCODE = +0                                        09570005
                   CONTINUE                                             09580005
               WHEN OTHER                                               09590005
                   MOVE 'E100-OPEN-SCL-CSR             '                09600005
                                     TO PV-PARAGRAPH-NAME               09610005
                   MOVE 'OPEN ERROR ON SCL-CSR       '                  09620005
                                     TO PV-OPERATION-MSG-1              09630005
                   PERFORM Z900-SQL-ABEND                               09640005
           END-EVALUATE.                                                09650005
                                                                        09660005
      ******************************************************************09670005
      * FETCH THE SUBCLASS CURSOR                                       09680005
      ******************************************************************09690005
       E200-FETCH-SCL-CSR.                                              09700005
                                                                        09710005
           EXEC SQL                                                     09720005
               FETCH SCL-CSR                                            09730005
                INTO :XST00013-VS-ID                                    09740005
                    ,:XST00013-VS-NBR                                   09750005
                    ,:XST00010-INTR-UPC-ID                              09760005
                    ,:XST00010-SKU-NBR                                  09770005
                    ,:PPCPRC-RTL-AMT                                    09780005
                    ,:PPCPRC-MEITGP-NBR:PV-MEITGP-NBR-NI                09790005
                    ,:PPCPRC-STATUS-CDE                                 09800005
           END-EXEC.                                                    09810005
                                                                        09820005
           EVALUATE TRUE                                                09830005
               WHEN SQLCODE = +0                                        09840005
                   IF PV-GP-RTL-QTY-NI < 0                              09850005
                       MOVE 0 TO PPCPRC-MEITGP-NBR                      09860005
                   END-IF                                               09870005
                   IF PV-GP-RTL-AMT-NI < 0                              09880005
                       MOVE 0 TO XST00008-GP-RTL-AMT                    09890005
                   END-IF                                               09900005
               WHEN SQLCODE = +100                                      09910005
                   SET PS-END-OF-SCL-CSR TO TRUE                        09920005
               WHEN OTHER                                               09930005
                   MOVE 'E200-FETCH-SCL-CSR            '                09940005
                                     TO PV-PARAGRAPH-NAME               09950005
                   MOVE 'FETCH ERROR ON SCL-CSR      '                  09960005
                                     TO PV-OPERATION-MSG-1              09970005
                   PERFORM Z900-SQL-ABEND                               09980005
           END-EVALUATE.                                                09990005
                                                                        10000005
      ******************************************************************10010005
      * PROCESS THE SUBCLASS CURSOR                                     10020005
      ******************************************************************10030005
       E300-PROCESS-SCL-CSR.                                            10040005
                                                                        10050005
           IF PM124-REC-TYP-CDE = 0                                     10060017
      *        ADD EXCLUDED SKUS TO EXCL TABLE                          10070005
               ADD +1 TO PV-MAX-EXCL                                    10080005
               IF PV-MAX-EXCL < PC-EXCL-LIMIT                           10090005
                   MOVE PM124-MDSE-SELN-ID                              10100017
                       TO PT-MDSE-SELN-ID (PV-MAX-EXCL)                 10110005
                   MOVE PM124-MDSE-SELN-LNE-ID                          10120017
                       TO PT-MDSE-SELN-LNE-ID (PV-MAX-EXCL)             10130005
                   MOVE XST00010-SKU-NBR                                10140005
                       TO PT-SKU-NBR (PV-MAX-EXCL)                      10150005
               ELSE                                                     10160005
                   MOVE 'E300-PROCESS-SCL-CSR' TO PV-PARAGRAPH-NAME     10170005
                   MOVE 'TOO MANY EXCLUSIONS ' TO PV-OPERATION-MSG-1    10180005
                   PERFORM Z900-SQL-ABEND                               10190005
               END-IF                                                   10200005
           ELSE                                                         10210005
      *        LOOK FOR THE SKU IN THE EXCLUSION LIST                   10220005
               PERFORM WITH TEST BEFORE                                 10230005
                   VARYING PV-EXCL-SUB FROM +1 BY +1                    10240005
                   UNTIL (PV-EXCL-SUB > PV-MAX-EXCL) OR                 10250005
                     ( PT-SKU-NBR(PV-EXCL-SUB) = XST00010-SKU-NBR AND   10260005
                       PT-MDSE-SELN-ID(PV-EXCL-SUB) =                   10270005
                           PM124-MDSE-SELN-ID AND                       10280017
                       PT-MDSE-SELN-LNE-ID(PV-EXCL-SUB) =               10290005
                           PM124-MDSE-SELN-LNE-ID )                     10300017
               END-PERFORM                                              10310005
                                                                        10320005
      *        IF SKU WASN'T FOUND IN THE EXCLUSION LIST, WRITE IT      10330005
               IF PV-EXCL-SUB > PV-MAX-EXCL                             10340005
                   MOVE XST00010-SKU-NBR       TO PM125-SKU-NBR         10350040
                   MOVE PM124-STR-NBR          TO PM125-LOC-NBR         10360040
                   MOVE PM124-PROMO-INTFC-ID   TO PM125-PROMO-INTFC-ID  10370040
                   MOVE PM124-MDSE-SELN-ID     TO PM125-MDSE-SELN-ID    10380040
                   MOVE PM124-MDSE-SELN-LNE-ID TO PM125-MDSE-SELN-LNE-ID10390018
                   MOVE PM124-AD-EVNT-ID       TO PM125-AD-EVNT-ID      10400040
                   MOVE PM124-PROMO-ID         TO PM125-PROMO-ID        10410040
                   MOVE PM124-PROMO-ITM-ID     TO PM125-PROMO-ITM-ID    10420040
                   MOVE PM124-AD-EVNT-NM       TO PM125-AD-EVNT-NM      10430040
                   MOVE PM124-PROMO-NM         TO PM125-PROMO-NM        10440040
                   MOVE PM124-PROMO-ABBR-NM    TO PM125-PROMO-ABBR-NM   10450040
                   MOVE PM124-PROMO-ITM-DESC   TO PM125-PROMO-ITM-DESC  10460040
                   MOVE PM124-MDSE-SELN-DESC   TO PM125-MDSE-SELN-DESC  10470040
                   MOVE PM124-AD-PG-NBR        TO PM125-AD-PG-NBR       10480040
                   MOVE PM124-AD-PG-SEQ-NBR    TO PM125-AD-PG-SEQ-NBR   10490040
                   MOVE PM124-AD-SP-CDE        TO PM125-AD-SP-CDE       10500040
                                                                        10510026
                   IF PV-BEG-TMST-Y1 = 0                                10520030
                       MOVE SPACES       TO  PM125-PROMO-STRT-DATE-Y1   10530040
                   ELSE                                                 10540030
                       MOVE PV-BEG-TMST-Y1                              10550030
                                         TO  PM125-PROMO-STRT-DATE-Y1   10560040
                   END-IF                                               10570030
                   MOVE PV-BEG-TMST-Y2   TO PM125-PROMO-STRT-DATE-Y2    10580030
                   MOVE PV-BEG-TMST-MM   TO PM125-PROMO-STRT-DATE-MM    10590030
                   MOVE PV-BEG-TMST-DD   TO PM125-PROMO-STRT-DATE-DD    10600030
                   MOVE PV-BEG-TMST-TIME TO PM125-PROMO-STRT-TIME       10610030
                   IF PV-END-TMST-Y1 = 0                                10620030
                       MOVE SPACES       TO  PM125-PROMO-END-DATE-Y1    10630040
                   ELSE                                                 10640030
                       MOVE PV-END-TMST-Y1                              10650030
                                         TO  PM125-PROMO-END-DATE-Y1    10660040
                   END-IF                                               10670030
                   MOVE PV-END-TMST-Y2   TO PM125-PROMO-END-DATE-Y2     10680030
                   MOVE PV-END-TMST-MM   TO PM125-PROMO-END-DATE-MM     10690030
                   MOVE PV-END-TMST-DD   TO PM125-PROMO-END-DATE-DD     10700030
                   MOVE PV-END-TMST-TIME TO PM125-PROMO-END-TIME        10710030
                                                                        10720030
                   MOVE PM124-DEPT-NBR   TO PM125-DEPT-NBR              10730040
                   MOVE PM124-MAJ-CL-NBR TO PM125-MAJ-CL-NBR            10740018
                   MOVE PM124-SUB-CL-NBR TO PM125-SUB-CL-NBR            10750018
                   MOVE XST00013-VS-ID   TO PM125-VS-ID                 10760040
                   MOVE XST00013-VS-NBR  TO PM125-VS-NBR                10770040
                                                                        10780005
                   MOVE PM125-SKU-NBR    TO PV-SKU-NBR2                 10790040
                   MOVE PM125-LOC-NBR    TO PV-STR-NBR                  10800040
                   PERFORM H500-CHECK-FUTURE-PERM-CHANGES               10810005
                                                                        10820005
                   IF PS-SKU-NOT-CLEARANCED                             10830005
                     PERFORM H100-MOVE-PROMO-PRICE-FIELDS               10840005
                                                                        10850005
                     MOVE PPCPRC-RTL-AMT TO PM125-UNT-RTL-AMT           10860018
                     IF PPCPRC-MEITGP-NBR > 0                           10870021
                         PERFORM H700-RETRIEVE-RETAIL-GROUP             10880021
                     ELSE                                               10890021
                         MOVE ZEROES TO PM125-GP-RTL-QTY                10900021
                                        PM125-GP-RTL-AMT                10910021
                     END-IF                                             10920021
                     MOVE PPCPRC-STATUS-CDE TO PV-STATUS-CDE            10930033
                     MOVE PV-STATUS-CDE-23  TO PM125-LOC-SKU-STAT-CDE   10940040
                                                                        10950005
                     MOVE XST00010-SKU-NBR  TO PV-SKU-NBR               10960040
                                                                        10970005
                     MOVE 3                 TO PM125-MDSE-HIER-LVL-CDE  10980040
                                                                        10990005
                     PERFORM W100-WRITE-EXPLODED-FILE                   11000005
                   ELSE                                                 11010005
                     SET PS-SKU-NOT-CLEARANCED TO TRUE                  11020005
                   END-IF                                               11030005
               END-IF                                                   11040005
           END-IF                                                       11050005
                                                                        11060005
           PERFORM E200-FETCH-SCL-CSR.                                  11070005
                                                                        11080005
      ******************************************************************11090005
      * CLOSE THE SUBCLASS CURSOR                                       11100005
      ******************************************************************11110005
       E400-CLOSE-SCL-CSR.                                              11120005
                                                                        11130005
           EXEC SQL                                                     11140005
               CLOSE SCL-CSR                                            11150005
           END-EXEC.                                                    11160005
                                                                        11170005
           EVALUATE TRUE                                                11180005
               WHEN SQLCODE = +0                                        11190005
                   CONTINUE                                             11200005
               WHEN OTHER                                               11210005
                   MOVE 'E400-CLOSE-SCL-CSR             '               11220005
                                     TO PV-PARAGRAPH-NAME               11230005
                   MOVE 'CLOSE ERROR ON SCL-CSR       '                 11240005
                                     TO PV-OPERATION-MSG-1              11250005
                   PERFORM Z900-SQL-ABEND                               11260005
           END-EVALUATE.                                                11270005
                                                                        11280005
      ******************************************************************11290005
      * OPEN THE MAJOR CLASS CURSOR                                     11300005
      ******************************************************************11310005
       F100-OPEN-MCL-CSR.                                               11320005
                                                                        11330005
           EXEC SQL                                                     11340005
               OPEN MCL-CSR                                             11350005
           END-EXEC.                                                    11360005
                                                                        11370005
           EVALUATE TRUE                                                11380005
               WHEN SQLCODE = +0                                        11390005
                   CONTINUE                                             11400005
               WHEN OTHER                                               11410005
                   MOVE 'F100-OPEN-MCL-CSR             '                11420005
                                     TO PV-PARAGRAPH-NAME               11430005
                   MOVE 'OPEN ERROR ON MCL-CSR       '                  11440005
                                     TO PV-OPERATION-MSG-1              11450005
                   PERFORM Z900-SQL-ABEND                               11460005
           END-EVALUATE.                                                11470005
                                                                        11480005
      ******************************************************************11490005
      * FETCH THE MAJOR CLASS CURSOR                                    11500005
      ******************************************************************11510005
       F200-FETCH-MCL-CSR.                                              11520005
                                                                        11530005
           EXEC SQL                                                     11540005
               FETCH MCL-CSR                                            11550005
                INTO :XST00013-SUB-CL-NBR                               11560005
                    ,:XST00013-VS-ID                                    11570005
                    ,:XST00013-VS-NBR                                   11580005
                    ,:XST00010-INTR-UPC-ID                              11590005
                    ,:XST00010-SKU-NBR                                  11600005
                    ,:PPCPRC-RTL-AMT                                    11610005
                    ,:PPCPRC-MEITGP-NBR:PV-MEITGP-NBR-NI                11620005
                    ,:PPCPRC-STATUS-CDE                                 11630005
           END-EXEC.                                                    11640005
                                                                        11650005
           EVALUATE TRUE                                                11660005
               WHEN SQLCODE = +0                                        11670005
                   IF PV-GP-RTL-QTY-NI < 0                              11680005
                       MOVE 0 TO PPCPRC-MEITGP-NBR                      11690005
                   END-IF                                               11700005
                   IF PV-GP-RTL-AMT-NI < 0                              11710005
                       MOVE 0 TO XST00008-GP-RTL-AMT                    11720005
                   END-IF                                               11730005
               WHEN SQLCODE = +100                                      11740005
                   SET PS-END-OF-MCL-CSR TO TRUE                        11750005
               WHEN OTHER                                               11760005
                   MOVE 'F200-FETCH-MCL-CSR            '                11770005
                                     TO PV-PARAGRAPH-NAME               11780005
                   MOVE 'FETCH ERROR ON MCL-CSR      '                  11790005
                                     TO PV-OPERATION-MSG-1              11800005
                   PERFORM Z900-SQL-ABEND                               11810005
           END-EVALUATE.                                                11820005
                                                                        11830005
      ******************************************************************11840005
      * PROCESS THE MAJOR CLASS CURSOR                                  11850005
      ******************************************************************11860005
       F300-PROCESS-MCL-CSR.                                            11870005
                                                                        11880005
           IF PM124-REC-TYP-CDE = 0                                     11890017
      *        ADD EXCLUDED SKUS TO EXCL TABLE                          11900005
               ADD +1 TO PV-MAX-EXCL                                    11910005
               IF PV-MAX-EXCL < PC-EXCL-LIMIT                           11920005
                   MOVE PM124-MDSE-SELN-ID                              11930017
                       TO PT-MDSE-SELN-ID (PV-MAX-EXCL)                 11940005
                   MOVE PM124-MDSE-SELN-LNE-ID                          11950017
                       TO PT-MDSE-SELN-LNE-ID (PV-MAX-EXCL)             11960005
                   MOVE XST00010-SKU-NBR                                11970005
                       TO PT-SKU-NBR (PV-MAX-EXCL)                      11980005
               ELSE                                                     11990005
                   MOVE 'F300-PROCESS-MCL-CSR' TO PV-PARAGRAPH-NAME     12000005
                   MOVE 'TOO MANY EXCLUSIONS ' TO PV-OPERATION-MSG-1    12010005
                   PERFORM Z900-SQL-ABEND                               12020005
               END-IF                                                   12030005
           ELSE                                                         12040005
      *        LOOK FOR THE SKU IN THE EXCLUSION LIST                   12050005
               PERFORM WITH TEST BEFORE                                 12060005
                   VARYING PV-EXCL-SUB FROM +1 BY +1                    12070005
                   UNTIL (PV-EXCL-SUB > PV-MAX-EXCL) OR                 12080005
                     ( PT-SKU-NBR(PV-EXCL-SUB) = XST00010-SKU-NBR AND   12090005
                       PT-MDSE-SELN-ID(PV-EXCL-SUB) =                   12100005
                           PM124-MDSE-SELN-ID AND                       12110017
                       PT-MDSE-SELN-LNE-ID(PV-EXCL-SUB) =               12120005
                           PM124-MDSE-SELN-LNE-ID )                     12130017
               END-PERFORM                                              12140005
                                                                        12150005
      *        IF SKU WASN'T FOUND IN THE EXCLUSION LIST, WRITE IT      12160005
               IF PV-EXCL-SUB > PV-MAX-EXCL                             12170005
                   MOVE XST00010-SKU-NBR       TO PM125-SKU-NBR         12180040
                   MOVE PM124-STR-NBR          TO PM125-LOC-NBR         12190040
                   MOVE PM124-PROMO-INTFC-ID   TO PM125-PROMO-INTFC-ID  12200040
                   MOVE PM124-MDSE-SELN-ID     TO PM125-MDSE-SELN-ID    12210040
                   MOVE PM124-MDSE-SELN-LNE-ID TO PM125-MDSE-SELN-LNE-ID12220018
                   MOVE PM124-AD-EVNT-ID       TO PM125-AD-EVNT-ID      12230040
                   MOVE PM124-PROMO-ID         TO PM125-PROMO-ID        12240040
                   MOVE PM124-PROMO-ITM-ID     TO PM125-PROMO-ITM-ID    12250040
                   MOVE PM124-AD-EVNT-NM       TO PM125-AD-EVNT-NM      12260040
                   MOVE PM124-PROMO-NM         TO PM125-PROMO-NM        12270040
                   MOVE PM124-PROMO-ABBR-NM    TO PM125-PROMO-ABBR-NM   12280040
                   MOVE PM124-PROMO-ITM-DESC   TO PM125-PROMO-ITM-DESC  12290040
                   MOVE PM124-MDSE-SELN-DESC   TO PM125-MDSE-SELN-DESC  12300040
                   MOVE PM124-AD-PG-NBR        TO PM125-AD-PG-NBR       12310040
                   MOVE PM124-AD-PG-SEQ-NBR    TO PM125-AD-PG-SEQ-NBR   12320040
                   MOVE PM124-AD-SP-CDE        TO PM125-AD-SP-CDE       12330040
                                                                        12340030
                   IF PV-BEG-TMST-Y1 = 0                                12350030
                       MOVE SPACES       TO  PM125-PROMO-STRT-DATE-Y1   12360040
                   ELSE                                                 12370030
                       MOVE PV-BEG-TMST-Y1                              12380030
                                         TO  PM125-PROMO-STRT-DATE-Y1   12390040
                   END-IF                                               12400030
                   MOVE PV-BEG-TMST-Y2   TO PM125-PROMO-STRT-DATE-Y2    12410030
                   MOVE PV-BEG-TMST-MM   TO PM125-PROMO-STRT-DATE-MM    12420030
                   MOVE PV-BEG-TMST-DD   TO PM125-PROMO-STRT-DATE-DD    12430030
                   MOVE PV-BEG-TMST-TIME TO PM125-PROMO-STRT-TIME       12440030
                   IF PV-END-TMST-Y1 = 0                                12450030
                       MOVE SPACES       TO  PM125-PROMO-END-DATE-Y1    12460040
                   ELSE                                                 12470030
                       MOVE PV-END-TMST-Y1                              12480030
                                         TO  PM125-PROMO-END-DATE-Y1    12490040
                   END-IF                                               12500030
                   MOVE PV-END-TMST-Y2   TO PM125-PROMO-END-DATE-Y2     12510030
                   MOVE PV-END-TMST-MM   TO PM125-PROMO-END-DATE-MM     12520030
                   MOVE PV-END-TMST-DD   TO PM125-PROMO-END-DATE-DD     12530030
                   MOVE PV-END-TMST-TIME TO PM125-PROMO-END-TIME        12540030
                                                                        12550026
                   MOVE PM124-DEPT-NBR      TO PM125-DEPT-NBR           12560040
                   MOVE PM124-MAJ-CL-NBR    TO PM125-MAJ-CL-NBR         12570040
                   MOVE XST00013-SUB-CL-NBR TO PM125-SUB-CL-NBR         12580018
                   MOVE XST00013-VS-ID      TO PM125-VS-ID              12590040
                   MOVE XST00013-VS-NBR     TO PM125-VS-NBR             12600040
                                                                        12610005
                   MOVE PM125-SKU-NBR       TO PV-SKU-NBR2              12620040
                   MOVE PM125-LOC-NBR       TO PV-STR-NBR               12630040
                   PERFORM H500-CHECK-FUTURE-PERM-CHANGES               12640005
                                                                        12650005
                   IF PS-SKU-NOT-CLEARANCED                             12660005
                     PERFORM H100-MOVE-PROMO-PRICE-FIELDS               12670005
                                                                        12680005
                     MOVE PPCPRC-RTL-AMT TO PM125-UNT-RTL-AMT           12690018
                     IF PPCPRC-MEITGP-NBR > 0                           12700021
                         PERFORM H700-RETRIEVE-RETAIL-GROUP             12710021
                     ELSE                                               12720021
                         MOVE ZEROES TO PM125-GP-RTL-QTY                12730021
                                        PM125-GP-RTL-AMT                12740021
                     END-IF                                             12750021
                     MOVE PPCPRC-STATUS-CDE TO PV-STATUS-CDE            12760033
                     MOVE PV-STATUS-CDE-23  TO PM125-LOC-SKU-STAT-CDE   12770040
                                                                        12780005
                     MOVE XST00010-SKU-NBR  TO PV-SKU-NBR               12790040
                                                                        12800005
                     MOVE 4                 TO PM125-MDSE-HIER-LVL-CDE  12810040
                                                                        12820005
                     PERFORM W100-WRITE-EXPLODED-FILE                   12830005
                   ELSE                                                 12840005
                     SET PS-SKU-NOT-CLEARANCED TO TRUE                  12850005
                   END-IF                                               12860005
               END-IF                                                   12870005
           END-IF                                                       12880005
                                                                        12890005
           PERFORM F200-FETCH-MCL-CSR.                                  12900005
                                                                        12910005
      ******************************************************************12920005
      * CLOSE THE MAJOR CLASS CURSOR                                    12930005
      ******************************************************************12940005
       F400-CLOSE-MCL-CSR.                                              12950005
                                                                        12960005
           EXEC SQL                                                     12970005
               CLOSE MCL-CSR                                            12980005
           END-EXEC.                                                    12990005
                                                                        13000005
           EVALUATE TRUE                                                13010005
               WHEN SQLCODE = +0                                        13020005
                   CONTINUE                                             13030005
               WHEN OTHER                                               13040005
                   MOVE 'F400-CLOSE-MCL-CSR             '               13050005
                                     TO PV-PARAGRAPH-NAME               13060005
                   MOVE 'CLOSE ERROR ON MCL-CSR       '                 13070005
                                     TO PV-OPERATION-MSG-1              13080005
                   PERFORM Z900-SQL-ABEND                               13090005
           END-EVALUATE.                                                13100005
                                                                        13110005
      ******************************************************************13120005
      * OPEN THE DEPT CURSOR                                            13130005
      ******************************************************************13140005
       G100-OPEN-DEPT-CSR.                                              13150005
                                                                        13160005
      *    ACCEPT PV-CPU-TIME FROM TIME                                 13170005
      *    DISPLAY ' '                                                  13180005
      *    DISPLAY 'START CURSOR OPEN: ' PV-CPU-TIME                    13190005
                                                                        13200005
           EXEC SQL                                                     13210005
               OPEN DEPT-CSR                                            13220005
           END-EXEC.                                                    13230005
                                                                        13240005
           EVALUATE TRUE                                                13250005
               WHEN SQLCODE = +0                                        13260005
                   CONTINUE                                             13270005
      *            ACCEPT PV-CPU-TIME FROM TIME                         13280005
      *            DISPLAY 'DEPT CURSOR OPENED: ' PV-CPU-TIME           13290005
               WHEN OTHER                                               13300005
                   MOVE 'G100-OPEN-DEPT-CSR            '                13310005
                                     TO PV-PARAGRAPH-NAME               13320005
                   MOVE 'OPEN ERROR ON DEPT-CSR      '                  13330005
                                     TO PV-OPERATION-MSG-1              13340005
                   PERFORM Z900-SQL-ABEND                               13350005
           END-EVALUATE.                                                13360005
                                                                        13370005
      ******************************************************************13380005
      * FETCH THE DEPT CURSOR                                           13390005
      ******************************************************************13400005
       G200-FETCH-DEPT-CSR.                                             13410005
                                                                        13420005
           EXEC SQL                                                     13430005
               FETCH DEPT-CSR                                           13440005
                INTO :XST00013-MAJ-CL-NBR                               13450005
                    ,:XST00013-SUB-CL-NBR                               13460005
                    ,:XST00013-VS-ID                                    13470005
                    ,:XST00013-VS-NBR                                   13480005
                    ,:XST00010-INTR-UPC-ID                              13490005
                    ,:XST00010-SKU-NBR                                  13500005
                    ,:PPCPRC-RTL-AMT                                    13510005
                    ,:PPCPRC-MEITGP-NBR:PV-MEITGP-NBR-NI                13520005
                    ,:PPCPRC-STATUS-CDE                                 13530005
           END-EXEC.                                                    13540005
                                                                        13550005
           EVALUATE TRUE                                                13560005
               WHEN SQLCODE = +0                                        13570005
                   IF PV-GP-RTL-QTY-NI < 0                              13580005
                       MOVE 0 TO PPCPRC-MEITGP-NBR                      13590005
                   END-IF                                               13600005
                   IF PV-GP-RTL-AMT-NI < 0                              13610005
                       MOVE 0 TO XST00008-GP-RTL-AMT                    13620005
                   END-IF                                               13630005
               WHEN SQLCODE = +100                                      13640005
                   SET PS-END-OF-DEPT-CSR TO TRUE                       13650005
               WHEN OTHER                                               13660005
                   MOVE 'G200-FETCH-DEPT-CSR           '                13670005
                                     TO PV-PARAGRAPH-NAME               13680005
                   MOVE 'FETCH ERROR ON DEPT-CSR     '                  13690005
                                     TO PV-OPERATION-MSG-1              13700005
                   PERFORM Z900-SQL-ABEND                               13710005
           END-EVALUATE.                                                13720005
                                                                        13730005
      ******************************************************************13740005
      * PROCESS THE DEPT CURSOR                                         13750005
      ******************************************************************13760005
       G300-PROCESS-DEPT-CSR.                                           13770005
                                                                        13780005
           IF PM124-REC-TYP-CDE = 0                                     13790017
      *        SHOULDN'T EVER FALL IN HERE (FOR NOW AT LEAST)...        13800005
      *         SINCE EXCLUSIONS CAN'T BE DONE AT DEPT LEVEL            13810005
                                                                        13820005
      *        ADD EXCLUDED SKUS TO EXCL TABLE                          13830005
               ADD +1 TO PV-MAX-EXCL                                    13840005
               IF PV-MAX-EXCL < PC-EXCL-LIMIT                           13850005
                   MOVE PM124-MDSE-SELN-ID                              13860017
                       TO PT-MDSE-SELN-ID (PV-MAX-EXCL)                 13870005
                   MOVE PM124-MDSE-SELN-LNE-ID                          13880017
                       TO PT-MDSE-SELN-LNE-ID (PV-MAX-EXCL)             13890005
                   MOVE XST00010-SKU-NBR                                13900005
                       TO PT-SKU-NBR (PV-MAX-EXCL)                      13910005
               ELSE                                                     13920005
                   MOVE 'G300-PROCESS-DEPT-CSR' TO PV-PARAGRAPH-NAME    13930005
                   MOVE 'TOO MANY EXCLUSIONS ' TO PV-OPERATION-MSG-1    13940005
                   PERFORM Z900-SQL-ABEND                               13950005
               END-IF                                                   13960005
           ELSE                                                         13970005
      *        LOOK FOR THE SKU IN THE EXCLUSION LIST                   13980005
               PERFORM WITH TEST BEFORE                                 13990005
                   VARYING PV-EXCL-SUB FROM +1 BY +1                    14000005
                   UNTIL (PV-EXCL-SUB > PV-MAX-EXCL) OR                 14010005
                     ( PT-SKU-NBR(PV-EXCL-SUB) = XST00010-SKU-NBR AND   14020005
                       PT-MDSE-SELN-ID(PV-EXCL-SUB) =                   14030005
                           PM124-MDSE-SELN-ID AND                       14040017
                       PT-MDSE-SELN-LNE-ID(PV-EXCL-SUB) =               14050005
                           PM124-MDSE-SELN-LNE-ID )                     14060017
               END-PERFORM                                              14070005
                                                                        14080005
      *        IF SKU WASN'T FOUND IN THE EXCLUSION LIST, WRITE IT      14090005
               IF PV-EXCL-SUB > PV-MAX-EXCL                             14100005
                   MOVE XST00010-SKU-NBR       TO PM125-SKU-NBR         14110040
                   MOVE PM124-STR-NBR          TO PM125-LOC-NBR         14120040
                   MOVE PM124-PROMO-INTFC-ID   TO PM125-PROMO-INTFC-ID  14130040
                   MOVE PM124-MDSE-SELN-ID     TO PM125-MDSE-SELN-ID    14140040
                   MOVE PM124-MDSE-SELN-LNE-ID TO PM125-MDSE-SELN-LNE-ID14150018
                   MOVE PM124-AD-EVNT-ID       TO PM125-AD-EVNT-ID      14160040
                   MOVE PM124-PROMO-ID         TO PM125-PROMO-ID        14170040
                   MOVE PM124-PROMO-ITM-ID     TO PM125-PROMO-ITM-ID    14180040
                   MOVE PM124-AD-EVNT-NM       TO PM125-AD-EVNT-NM      14190040
                   MOVE PM124-PROMO-NM         TO PM125-PROMO-NM        14200040
                   MOVE PM124-PROMO-ABBR-NM    TO PM125-PROMO-ABBR-NM   14210040
                   MOVE PM124-PROMO-ITM-DESC   TO PM125-PROMO-ITM-DESC  14220040
                   MOVE PM124-MDSE-SELN-DESC   TO PM125-MDSE-SELN-DESC  14230040
                   MOVE PM124-AD-PG-NBR        TO PM125-AD-PG-NBR       14240040
                   MOVE PM124-AD-PG-SEQ-NBR    TO PM125-AD-PG-SEQ-NBR   14250040
                   MOVE PM124-AD-SP-CDE        TO PM125-AD-SP-CDE       14260040
                                                                        14270026
                   IF PV-BEG-TMST-Y1 = 0                                14280030
                       MOVE SPACES       TO  PM125-PROMO-STRT-DATE-Y1   14290040
                   ELSE                                                 14300030
                       MOVE PV-BEG-TMST-Y1                              14310030
                                         TO  PM125-PROMO-STRT-DATE-Y1   14320040
                   END-IF                                               14330030
                   MOVE PV-BEG-TMST-Y2   TO PM125-PROMO-STRT-DATE-Y2    14340030
                   MOVE PV-BEG-TMST-MM   TO PM125-PROMO-STRT-DATE-MM    14350030
                   MOVE PV-BEG-TMST-DD   TO PM125-PROMO-STRT-DATE-DD    14360030
                   MOVE PV-BEG-TMST-TIME TO PM125-PROMO-STRT-TIME       14370030
                   IF PV-END-TMST-Y1 = 0                                14380030
                       MOVE SPACES TO  PM125-PROMO-END-DATE-Y1          14390030
                   ELSE                                                 14400030
                       MOVE PV-END-TMST-Y1                              14410030
                                   TO  PM125-PROMO-END-DATE-Y1          14420040
                   END-IF                                               14430030
                   MOVE PV-END-TMST-Y2   TO PM125-PROMO-END-DATE-Y2     14440030
                   MOVE PV-END-TMST-MM   TO PM125-PROMO-END-DATE-MM     14450030
                   MOVE PV-END-TMST-DD   TO PM125-PROMO-END-DATE-DD     14460030
                   MOVE PV-END-TMST-TIME TO PM125-PROMO-END-TIME        14470030
                                                                        14480030
                   MOVE PM124-DEPT-NBR      TO PM125-DEPT-NBR           14490040
                   MOVE XST00013-MAJ-CL-NBR TO PM125-MAJ-CL-NBR         14500018
                   MOVE XST00013-SUB-CL-NBR TO PM125-SUB-CL-NBR         14510018
                   MOVE XST00013-VS-ID      TO PM125-VS-ID              14520040
                   MOVE XST00013-VS-NBR     TO PM125-VS-NBR             14530040
                                                                        14540005
                   MOVE PM125-SKU-NBR       TO PV-SKU-NBR2              14550040
                   MOVE PM125-LOC-NBR       TO PV-STR-NBR               14560040
                   PERFORM H500-CHECK-FUTURE-PERM-CHANGES               14570005
                                                                        14580005
                   IF PS-SKU-NOT-CLEARANCED                             14590005
                     PERFORM H100-MOVE-PROMO-PRICE-FIELDS               14600005
                                                                        14610005
                     MOVE PPCPRC-RTL-AMT TO PM125-UNT-RTL-AMT           14620018
                     IF PPCPRC-MEITGP-NBR > 0                           14630021
                         PERFORM H700-RETRIEVE-RETAIL-GROUP             14640021
                     ELSE                                               14650021
                         MOVE ZEROES TO PM125-GP-RTL-QTY                14660021
                                        PM125-GP-RTL-AMT                14670021
                     END-IF                                             14680021
                     MOVE PPCPRC-STATUS-CDE TO PV-STATUS-CDE            14690040
                     MOVE PV-STATUS-CDE-23  TO PM125-LOC-SKU-STAT-CDE   14700040
                                                                        14710005
                     MOVE XST00010-SKU-NBR  TO PV-SKU-NBR               14720040
                                                                        14730005
                     MOVE 5                 TO PM125-MDSE-HIER-LVL-CDE  14740040
                                                                        14750005
                     PERFORM W100-WRITE-EXPLODED-FILE                   14760005
                   ELSE                                                 14770005
                     SET PS-SKU-NOT-CLEARANCED TO TRUE                  14780005
                   END-IF                                               14790005
               END-IF                                                   14800005
           END-IF                                                       14810005
                                                                        14820005
           PERFORM G200-FETCH-DEPT-CSR.                                 14830005
                                                                        14840005
      ******************************************************************14850005
      * CLOSE THE DEPT CURSOR                                           14860005
      ******************************************************************14870005
       G400-CLOSE-DEPT-CSR.                                             14880005
                                                                        14890005
           EXEC SQL                                                     14900005
               CLOSE DEPT-CSR                                           14910005
           END-EXEC.                                                    14920005
                                                                        14930005
           EVALUATE TRUE                                                14940005
               WHEN SQLCODE = +0                                        14950005
                   CONTINUE                                             14960005
               WHEN OTHER                                               14970005
                   MOVE 'G400-CLOSE-DEPT-CSR          '                 14980005
                                     TO PV-PARAGRAPH-NAME               14990005
                   MOVE 'CLOSE ERROR ON DEPT-CSR      '                 15000005
                                     TO PV-OPERATION-MSG-1              15010005
                   PERFORM Z900-SQL-ABEND                               15020005
           END-EVALUATE.                                                15030005
                                                                        15040005
      ******************************************************************15050005
      * MOVE OUT THE PROMO PRICING FIELDS                               15060005
      ******************************************************************15070005
       H100-MOVE-PROMO-PRICE-FIELDS.                                    15080005
                                                                        15090005
           MOVE PM124-PRICG-TYP-CDE TO PM125-PROMO-PRICG-TYP-CDE        15100018
                                                                        15110005
           IF PM124-PRICG-TYP-CDE(1:1) = 'G'                            15120017
               MOVE 0 TO PM125-PROMO-PRIC-PT-AMT                        15130018
               MOVE 0 TO PM125-PROMO-PRICG-AMT                          15140018
                                                                        15150005
               MOVE PM124-GROUP-QTY TO PM125-PROMO-GP-QTY               15160018
               MOVE PM124-PRICG-AMT TO PM125-PROMO-GP-AMT               15170018
           ELSE                                                         15180005
               IF PM124-PRICG-TYP-CDE = 'SPO'                           15190017
      *            CALCULATE THE PRICE POINT FROM THE PERCENT           15200005
      *            TRUNCATE, NOT ROUND!                                 15210005
                   COMPUTE PV-PRIC-PT = PPCPRC-RTL-AMT -                15220005
                       ((PM124-PRICG-AMT / 100) * PPCPRC-RTL-AMT)       15230017
                   MOVE PV-PRIC-PT      TO PM125-PROMO-PRIC-PT-AMT      15240018
               ELSE                                                     15250005
                   MOVE PM124-PRICG-AMT TO PM125-PROMO-PRIC-PT-AMT      15260018
               END-IF                                                   15270005
                                                                        15280005
               MOVE PM124-PRICG-AMT TO PM125-PROMO-PRICG-AMT            15290018
                                                                        15300005
               MOVE 0 TO PM125-PROMO-GP-QTY                             15310018
               MOVE 0 TO PM125-PROMO-GP-AMT                             15320018
           END-IF.                                                      15330005
                                                                        15340005
      ******************************************************************15350005
      * CHECK FUTURE PERM CHANGES                                       15360005
      ******************************************************************15370005
       H500-CHECK-FUTURE-PERM-CHANGES.                                  15380005
                                                                        15390005
           EXEC SQL                                                     15400005
               SELECT F.EVNT_CTG_CDE,                                   15410043
                      D.UNT_RTL_AMT                                     15420043
                 INTO :XST00063-EVNT-CTG-CDE                            15430043
                     ,:XST00065-UNT-RTL-AMT                             15440043
                 FROM XST_PRCHG_MDSE D,                                 15450043
                      XST_STR_GP_PRCHG E,                               15460043
                      XST_PRCHG F,                                      15470043
                      XST_STR_GP_MBSHP M                                15480043
                WHERE M.STR_NBR            = :PV-STR-NBR                15490005
                  AND M.EFF_BEG_DTE       <= :PV-END-TMST-DATE          15500005
                  AND (M.EFF_END_DTE      >= :PV-END-TMST-DATE          15510005
                   OR  M.EFF_END_DTE IS NULL)                           15520005
                  AND E.PRCHG_EFF_DTE     <= :PV-END-TMST-DATE          15530044
                  AND E.PRCHG_EFF_DTE     >= CURRENT DATE               15540047
                  AND E.STR_GP_TYP_CDE    = M.STR_GP_TYP_CDE            15550043
                  AND E.STR_GP_ID         = M.STR_GP_ID                 15560043
                  AND D.SKU_NBR           = :PV-SKU-NBR2                15570045
                  AND F.PRCHG_ID          = E.PRCHG_ID                  15580043
                  AND E.PRCHG_ID          = D.PRCHG_ID                  15590050
                  AND E.STR_GP_TYP_CDE    = D.STR_GP_TYP_CDE            15600043
                  AND E.STR_GP_ID         = D.STR_GP_ID                 15610043
                  AND F.PRCHG_ST_CDE      = 'APR'                       15620043
                  AND F.EVNT_CTG_CDE      IN ('ACT', 'CLR')             15630043
                  AND D.LAST_ACTN_CDE     <> 'D'                        15640005
                 WITH UR                                                15650005
           END-EXEC.                                                    15660005
                                                                        15670005
           EVALUATE TRUE                                                15680005
               WHEN SQLCODE = 0                                         15690005
                   IF XST00063-EVNT-CTG-CDE = 'CLR'                     15700043
      *SKU IS GOING TO BE CLEARANCED - DON'T INCLUDE IN OUTPUT FILE     15710005
                     SET PS-SKU-CLEARANCED TO TRUE                      15720005
                   ELSE                                                 15730005
      *USE XST0065-UNT-RTL-AMT TO CALC PRICE POINT                      15740043
                     MOVE XST00065-UNT-RTL-AMT TO PPCPRC-RTL-AMT        15750043
                   END-IF                                               15760005
                                                                        15770005
               WHEN SQLCODE = +100                                      15780005
                   CONTINUE                                             15790005
                                                                        15800005
               WHEN OTHER                                               15810005
                   DISPLAY '********************************'           15820005
                   DISPLAY 'PV-SKU-NBR2      = ' PV-SKU-NBR2            15830005
                   DISPLAY 'PV-STR-NBR       = ' PV-STR-NBR             15840005
                   DISPLAY 'PV-END-TMST-DATE = ' PV-END-TMST-DATE       15850005
                   MOVE 'H500-CHECK-FUTURE-PERM'  TO PV-PARAGRAPH-NAME  15860005
                   MOVE 'ERROR ON XST_PRCHG ' TO PV-OPERATION-MSG-1     15870043
                   PERFORM Z900-SQL-ABEND                               15880005
           END-EVALUATE.                                                15890005
                                                                        15900005
      ******************************************************************15910005
      * RETRIEVE GROUP PRICE FIELDS                                     15920005
      ******************************************************************15930005
       H600-RETRIEVE-GROUP-PRICE.                                       15940005
                                                                        15950005
           EXEC SQL                                                     15960005
               SELECT F.EVNT_CTG_CDE,                                   15970043
                      D.UNT_RTL_AMT                                     15980043
                 INTO :XST00063-EVNT-CTG-CDE                            15990043
                     ,:XST00065-UNT-RTL-AMT                             16000043
                 FROM XST_PRCHG_MDSE D,                                 16010043
                      XST_STR_GP_PRCHG E,                               16020043
                      XST_PRCHG F,                                      16030043
                      XST_STR_GP_MBSHP M                                16040005
                WHERE M.STR_NBR            = :PV-STR-NBR                16050005
                  AND M.EFF_BEG_DTE       <= :PV-END-TMST-DATE          16060005
                  AND (M.EFF_END_DTE      >= :PV-END-TMST-DATE          16070005
                   OR  M.EFF_END_DTE IS NULL)                           16080005
                  AND E.PRCHG_EFF_DTE     <= :PV-END-TMST-DATE          16090044
                  AND E.STR_GP_TYP_CDE    = M.STR_GP_TYP_CDE            16100043
                  AND E.STR_GP_ID         = M.STR_GP_ID                 16110043
                  AND D.SKU_NBR           = :PV-SKU-NBR2                16120045
                  AND F.PRCHG_ID          = E.PRCHG_ID                  16130043
                  AND E.PRCHG_ID          = D.PRCHG_ID                  16140049
                  AND E.STR_GP_TYP_CDE    = D.STR_GP_TYP_CDE            16150043
                  AND E.STR_GP_ID         = D.STR_GP_ID                 16160043
                  AND F.PRCHG_ST_CDE      = 'APR'                       16170043
                  AND F.EVNT_CTG_CDE      IN ('ACT', 'CLR')             16180043
                  AND D.LAST_ACTN_CDE     <> 'D'                        16190005
                 WITH UR                                                16200005
           END-EXEC.                                                    16210005
                                                                        16220005
           EVALUATE TRUE                                                16230005
               WHEN SQLCODE = 0                                         16240005
                   IF XST00063-EVNT-CTG-CDE = 'CLR'                     16250043
      *SKU IS GOING TO BE CLEARANCED - DON'T INCLUDE IN OUTPUT FILE     16260005
                     SET PS-SKU-CLEARANCED TO TRUE                      16270005
                   ELSE                                                 16280005
      *USE XST0065-UNT-RTL-AMT TO CALC PRICE POINT                      16290043
                     MOVE XST00065-UNT-RTL-AMT TO PPCPRC-RTL-AMT        16300043
                   END-IF                                               16310005
                                                                        16320005
               WHEN SQLCODE = +100                                      16330005
                   CONTINUE                                             16340005
                                                                        16350005
               WHEN OTHER                                               16360005
                   DISPLAY '********************************'           16370005
                   DISPLAY 'PV-SKU-NBR2      = ' PV-SKU-NBR2            16380005
                   DISPLAY 'PV-STR-NBR       = ' PV-STR-NBR             16390005
                   DISPLAY 'PV-END-TMST-DATE = ' PV-END-TMST-DATE       16400005
                   MOVE 'H600-CHECK-FUTURE-PERM'  TO PV-PARAGRAPH-NAME  16410044
                   MOVE 'ERROR ON XST_PRCHG ' TO PV-OPERATION-MSG-1     16420044
                   PERFORM Z900-SQL-ABEND                               16430005
           END-EVALUATE.                                                16440005
                                                                        16450005
      ******************************************************************16460020
      * RETRIEVE GROUP PRICING                                          16470020
      ******************************************************************16480020
       H700-RETRIEVE-RETAIL-GROUP.                                      16490021
                                                                        16500020
           EXEC SQL                                                     16510020
               SELECT MITGPL_QTY                                        16520020
                     ,GP_AMT                                            16530020
                 INTO :MITGPL-MITGPL-QTY                                16540020
                     ,:MITGPL-GP-AMT                                    16550020
                 FROM TMITGPL                                           16560020
                WHERE MEITGP_NBR = :PPCPRC-MEITGP-NBR                   16570021
                  AND OPERCO_NBR = '03'                                 16580020
                WITH UR                                                 16590020
           END-EXEC.                                                    16600020
                                                                        16610020
           EVALUATE TRUE                                                16620020
               WHEN SQLCODE = 0                                         16630020
                   MOVE MITGPL-MITGPL-QTY TO PM125-GP-RTL-QTY           16640021
                   MOVE MITGPL-GP-AMT TO PM125-GP-RTL-AMT               16650021
                                                                        16660020
               WHEN SQLCODE = +100                                      16670020
                   MOVE ZEROES TO PM125-GP-RTL-QTY                      16680021
                                  PM125-GP-RTL-AMT                      16690021
               WHEN OTHER                                               16700020
                   MOVE 'H700-RETRIEVE-RETAIL-GROUP' TO                 16710021
                        PV-PARAGRAPH-NAME                               16720021
                   MOVE 'ERROR ON TMITGPL SELECT' TO PV-OPERATION-MSG-1 16730020
                   PERFORM Z900-SQL-ABEND                               16740020
           END-EVALUATE.                                                16750020
                                                                        16760020
      ******************************************************************16770005
      * WRITE THE EXPLODED FILE                                         16780005
      ******************************************************************16790005
       W100-WRITE-EXPLODED-FILE.                                        16800005
                                                                        16810005
           WRITE EXPLODED-REC FROM PM125-EXCPT-PRCG-EXT-SKU.            16820018
           ADD +1 TO PA-RECS-WRITTEN.                                   16830005
                                                                        16840005
      ******************************************************************16850005
      * SQL ABEND / EL ABENDO DEL SQL                                   16860005
      ******************************************************************16870005
       Z900-SQL-ABEND.                                                  16880005
                                                                        16890005
           DISPLAY 'Z900-SQL-ABEND'.                                    16900005
           DISPLAY '**  ABEND     **'.                                  16910005
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.              16920005
           DISPLAY '**  PARAGRAPH **  = ' PV-PARAGRAPH-NAME.            16930005
           DISPLAY '**  OPERATION **  = ' PV-OPERATION-MSG-1.           16940005
           DISPLAY '**            **  = ' PV-OPERATION-MSG-2.           16950005
                                                                        16960005
      ******************************************************************16970005
      * THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *16980005
      * MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *16990005
      * 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *17000005
      * FORMAT.                                                        *17010005
      ******************************************************************17020005
           COPY DPPD004.                                                17030005
                                                                        17040005
           SET ABEND-4013-DB2-ERROR TO TRUE.                            17050005
           CALL 'ILBOABN0' USING ABEND-CODE.                            17060005
