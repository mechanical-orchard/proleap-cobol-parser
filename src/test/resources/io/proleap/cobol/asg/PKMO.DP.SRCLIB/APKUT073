000100*-----------------------*                                         00010018
000200 IDENTIFICATION DIVISION.                                         00020018
000300*-----------------------*                                         00030018
000400 PROGRAM-ID.    APKUT073.                                         00040018
000500 AUTHOR.        MIKE BESKE.                                       00050018
000600 DATE-WRITTEN.  JUNE 1998.                                        00060018
000700                                                                  00070018
000800*---------------------------------------------------------------* 00080018
000900*                       COBOL 2 WITH SQL                        * 00090018
001000*                                                               * 00100018
001100*           COMPILE IMPORT ACTIVITY AND AGING DATA              * 00110018
001200*                                                               * 00120018
001300* THE PURPOSE OF THIS PROGRAM IS TO SUMMARIZE THE PERIOD'S DEBIT* 00130018
001400* AND CREDIT ACTIVITY BY PO/ACCOUNT AND MATCH IT UP WITH THE    * 00140018
001500* AGED BALANCES FOR THE SAME PO/ACCOUNT TO CREATE THE FINAL     * 00150018
001600* ACTIVITY RECORDS TO BE LOADED INTO THE REPORTING DB2 TABLE,   * 00160018
001700* TIMPBAL.  THIS TABLE WILL THEN BE USED TO GENERATE THE IMPORT * 00170018
001800* ACCOUNT ACTIVITY AND REPORT.                                  * 00180018
001900*                                                               * 00190018
002000*                                                               * 00200018
002100*---------------------------------------------------------------* 00210018
002200*                                                               * 00220018
002300* DB2 TABLES:                                                   * 00230018
002400*  1. AP CONTROL TABLE                  (TAPCNTL)               * 00240018
002500*                                                               * 00250018
002600* INPUT:                                                        * 00260018
002700*                                                               * 00270018
002800*  1. TRANSPORTATION ACTIVITY           (APRD045)               * 00280018
002900*  2. AGED IMPORT COSTS                 (APRD068)               * 00290018
003000*  3. NEW MERCHANDISE INVOICE ACTIVITY  (APRD069)               * 00300018
003100*                                                               * 00310018
003200* OUTPUT:                                                       * 00320018
003300*                                                               * 00330018
003400*  1. PO/ACCOUNT ACTIVITY               (APRD068)               * 00340018
003500*                                                               * 00350018
003600*---------------------------------------------------------------* 00360018
003700*  CHANGES:                                                     * 00370018
003800*                                                               * 00380018
003900*  JUNE 1999                                                    * 00390018
004000*       CHANGE THE INPUT COPYBOOK FROM APTRAN TO APRD045        * 00400018
004100*  MADE BY: JILL JUEL                                           * 00410018
004200*                                                               * 00420018
004300*  AUG 6, 1999                                                  * 00430018
004400*       CHANGE THE SIGN ON THE 'CR' RECORDS IN PARAGRAPH        * 00440018
004500*       D300-COMBINE-AP045-REC.                                 * 00450018
004600*  MADE BY: JILL JUEL                                           * 00460018
004700*                                                               * 00470018
004800*  SEPT 15, 2000                                                * 00480018
004900*       CHANGED PARAGRAPH D200.  THE ADD STATEMENT NOW USES     * 00490018
005000*       THE NET COST FIELD INSTEAD OF THE GROSS COST FIELD.     * 00500018
005100*  MADE BY: ROBIN BERNOSKI                WR#:  20704           * 00510018
005200*                                                               * 00520018
005300*  JULY 24, 2001                                                  00530018
005400*       INCREASED THE RECORD SIZE OF AJ-TRANSACTION-FILE FROM   * 00540018
005500*       400 TO 500. THIS CHANGE WAS MADE BECAUSE COPYBOOK       * 00550018
005600*       APRD045 WAS INCREASED TO 500. ALSO RENAMED ALL 'PJ'     * 00560018
005700*       REFERENCES TO 'AJ' FOR CLARITY.                         * 00570018
005800*  MADE BY: ALEXIS KEIKER                 WR#:  22467           * 00580018
005900*                                                               * 00590018
006000*  05/16/2002                                                   * 00600019
006100*    CHANGE MADE:  NI-SKU CHANGES.  RECOMPILE FROM PRODUCTION   * 00610019
006200*    TO INCORPORATE CHANGES TO COPYBOOK APRD045.                * 00620019
006300*  MADE BY:  KEVIN CATLIN                   WR/IR #: 21278      * 00630019
006400*                                                               * 00640019
006500*   DATE  09/17/2003                                            * 00650020
006600*       CHANGE MADE: RECOMPILE FROM PRODUCTION TO PICK UP       * 00660020
006700*       CHANGE TO COPYBOOK APRD045.                             * 00670020
006800*       MADE BY: MIKE BESKE              WR/IR #: WR21316       * 00680020
006900*                                                               * 00690020
007000*---------------------------------------------------------------* 00700018
007100 EJECT                                                            00710018
007200                                                                  00720018
007300 ENVIRONMENT DIVISION.                                            00730018
007400 CONFIGURATION SECTION.                                           00740018
007500 SOURCE-COMPUTER. IBM-3090.                                       00750018
007600 OBJECT-COMPUTER. IBM-3090.                                       00760018
007700                                                                  00770018
007800                                                                  00780018
007900 INPUT-OUTPUT SECTION.                                            00790018
008000 FILE-CONTROL.                                                    00800018
008100                                                                  00810018
008200     SELECT AJ-TRANSACTION-FILE        ASSIGN TO UT-S-INP01.      00820018
008300     SELECT AGED-IMPORT-COSTS-FILE     ASSIGN TO UT-S-INP02.      00830018
008400     SELECT NEW-MERCH-INVC-ACT-FILE    ASSIGN TO UT-S-INP03.      00840018
008500     SELECT PO-ACCOUNT-ACT-FILE        ASSIGN TO UT-S-OUT01.      00850018
008600                                                                  00860018
008700 DATA DIVISION.                                                   00870018
008800 FILE SECTION.                                                    00880018
008900                                                                  00890018
009000 FD  AJ-TRANSACTION-FILE                                          00900018
009100     RECORDING MODE IS F                                          00910018
009200     BLOCK CONTAINS 0 CHARACTERS                                  00920018
009300     LABEL RECORDS ARE STANDARD                                   00930018
009400     DATA RECORD IS AJ-TRANSACTION-RECORD.                        00940018
009500                                                                  00950018
009600*01  AJ-TRANSACTION-RECORD        PIC X(172).                     00960018
009700 01  AJ-TRANSACTION-RECORD        PIC X(500).                     00970018
009800                                                                  00980018
009900 FD  AGED-IMPORT-COSTS-FILE                                       00990018
010000     RECORDING MODE IS F                                          01000018
010100     BLOCK CONTAINS 0 CHARACTERS                                  01010018
010200     LABEL RECORDS ARE STANDARD                                   01020018
010300     DATA RECORD IS AGED-IMPORT-COSTS-RECORD.                     01030018
010400                                                                  01040018
010500 01  AGED-IMPORT-COSTS-RECORD     PIC X(100).                     01050018
010600                                                                  01060018
010700 FD  NEW-MERCH-INVC-ACT-FILE                                      01070018
010800     RECORDING MODE IS F                                          01080018
010900     BLOCK CONTAINS 0 CHARACTERS                                  01090018
011000     LABEL RECORDS ARE STANDARD                                   01100018
011100     DATA RECORD IS NEW-MERCH-INVC-ACT-RECORD.                    01110018
011200                                                                  01120018
011300 01  NEW-MERCH-INVC-ACT-RECORD    PIC X(75).                      01130018
011400                                                                  01140018
011500 FD  PO-ACCOUNT-ACT-FILE                                          01150018
011600     RECORDING MODE IS F                                          01160018
011700     BLOCK CONTAINS 0 CHARACTERS                                  01170018
011800     LABEL RECORDS ARE STANDARD                                   01180018
011900     DATA RECORD IS PO-ACCOUNT-ACT-RECORD.                        01190018
012000                                                                  01200018
012100 01  PO-ACCOUNT-ACT-RECORD        PIC X(100).                     01210018
012200                                                                  01220018
012300 EJECT                                                            01230018
012400 WORKING-STORAGE SECTION.                                         01240018
012500                                                                  01250018
012600 01  PC-PROGRAM-CONSTANTS.                                        01260018
012700     05  PC-WS-PROGRAM           PIC  X(40)  VALUE                01270018
012800         '**** WORKING STORAGE ** APKUT073 ****'.                 01280018
012900                                                                  01290018
013000 01  PV-PROGRAM-VARIABLES.                                        01300018
013100     05  PV-CURRENT-PARAGRAPH    PIC  X(35).                      01310018
013200     05  PV-NULL-IND             PIC S9(4)     VALUE ZERO         01320018
013300                                               COMP SYNC.         01330018
013400     05  PV-SAVE-PO-NBR-COMP     PIC S9(09)    VALUE ZEROS        01340018
013500                                               COMP.              01350018
013600*    05  PV-APTRAN-PO-ACCT.                                       01360018
013700*        10  PV-TR-PONUMB        PIC  9(09)    VALUE ZEROS.       01370018
013800*        10  PV-TR-EXPNO         PIC  X(07)    VALUE SPACES.      01380018
013900*    05  SV-APTRAN-PO-ACCT.                                       01390018
014000*        10  SV-TR-PONUMB        PIC  9(09)    VALUE ZEROS.       01400018
014100*        10  SV-TR-EXPNO         PIC  X(07)    VALUE SPACES.      01410018
014200     05  PV-AP045-PO-ACCT.                                        01420018
014300         10  PV-PO-NBR           PIC  9(09)    VALUE ZEROS.       01430018
014400         10  PV-GL-ACCT-NBR      PIC  X(07)    VALUE '0000000'.   01440018
014500*        10  PV-GL-NBR REDEFINES PV-GL-ACCT-NBR.                  01450018
014600*            15  FILLER          PIC  X(01).                      01460018
014700*            15  PV-GL-ACCT      PIC  X(06).                      01470018
014800     05  SV-AP045-PO-ACCT.                                        01480018
014900         10  SV-PO-NBR           PIC  9(09)    VALUE ZEROS.       01490018
015000         10  SV-GL-ACCT-NBR      PIC  X(07)    VALUE '0000000'.   01500018
015100*        10  SV-GL-NBR REDEFINES SV-GL-ACCT-NBR.                  01510018
015200*            15  FILLER          PIC  X(01).                      01520018
015300*            15  SV-GL-ACCT      PIC  X(06).                      01530018
015400     05  PV-CH-ACTVTY-AMT        PIC S9(11)V99 COMP-3.            01540018
015500     05  PV-CR-ACTVTY-AMT        PIC S9(11)V99 COMP-3.            01550018
015600     05  PV-NET-COST-AMT         PIC S9(09)V99 COMP-3.            01560018
015700     05  PV-VENDOR-NBR           PIC  X(09)    VALUE SPACES.      01570018
015800     05  PV-VENDOR-NAME          PIC  X(30)    VALUE SPACES.      01580018
015900     05  PV-ALW-CHRG-CDE         PIC  X(03)    VALUE SPACES.      01590018
016000     05  PV-ALC-RPT-CUTOFF-DATE  PIC  X(10)    VALUE SPACES.      01600018
016100     05  PV-ALC-RPT-CUTOFF-DTE.                                   01610018
016200         10  PV-ALC-RPT-CUTOFF-CC PIC 99.                         01620018
016300         10  PV-ALC-RPT-CUTOFF-YY PIC 99.                         01630018
016400         10  FILLER               PIC X.                          01640018
016500         10  PV-ALC-RPT-CUTOFF-MM PIC 99.                         01650018
016600         10  FILLER               PIC X.                          01660018
016700         10  PV-ALC-RPT-CUTOFF-DD PIC 99.                         01670018
016800                                                                  01680018
016900     05  PV-RCV-RPT-CUTOFF-DATE  PIC  X(10)    VALUE SPACES.      01690018
017000     05  PV-RCV-RPT-CUTOFF-DTE.                                   01700018
017100         10  PV-RVC-RPT-CUTOFF-CC PIC 99.                         01710018
017200         10  PV-RVC-RPT-CUTOFF-YY PIC 99.                         01720018
017300         10  FILLER               PIC X.                          01730018
017400         10  PV-RVC-RPT-CUTOFF-MM PIC 99.                         01740018
017500         10  FILLER               PIC X.                          01750018
017600         10  PV-RVC-RPT-CUTOFF-DD PIC 99.                         01760018
017700                                                                  01770018
017800     05  PV-PERIOD-END-DTE       PIC  X(10)    VALUE SPACES.      01780018
017900     05  PV-AP045-COUNT          PIC S9(9)     VALUE ZEROS        01790018
018000                                               COMP.              01800018
018100     05  PV-AP068-COUNT          PIC S9(9)     VALUE ZEROS        01810018
018200                                               COMP.              01820018
018300     05  PV-AP069-COUNT          PIC S9(9)     VALUE ZEROS        01830018
018400                                               COMP.              01840018
018500     05  PV-POACCT-COUNT         PIC S9(9)     VALUE ZEROS        01850018
018600                                               COMP.              01860018
018700     05  PV-NO-RECEIPTS-COUNT    PIC S9(9)     VALUE ZEROS        01870018
018800                                               COMP.              01880018
018900     05  PV-POSTING-COUNT        PIC S9(9)     VALUE ZEROS        01890018
019000                                               COMP.              01900018
019100                                                                  01910018
019200 01  PS-FIRST-TIME-SW            PIC X(01)   VALUE ' '.           01920018
019300     88  PS-FIRST-TIME                       VALUE 'Y'.           01930018
019400     88  PS-NOT-FIRST-TIME                   VALUE ' '.           01940018
019500                                                                  01950018
019600 01  PS-PROGRAM-SWITCHES.                                         01960018
019700     05  PS-END-AP045-SW         PIC  X(01)  VALUE ' '.           01970018
019800         88  PS-END-AP045                    VALUE 'Y'.           01980018
019900     05  PS-END-AP068-SW         PIC  X(01)  VALUE ' '.           01990018
020000         88  PS-END-AP068                    VALUE 'Y'.           02000018
020100     05  PS-END-AP069-SW         PIC  X(01)  VALUE ' '.           02010018
020200         88  PS-END-AP069                    VALUE 'Y'.           02020018
020300                                                                  02030018
020400 01  RUN-TIME.                                                    02040018
020500     05  R-HR                    PIC 99.                          02050018
020600     05  R-MIN                   PIC 99.                          02060018
020700     05  R-SEC                   PIC 99.                          02070018
020800     05  R-TH                    PIC 99.                          02080018
020900*                                                                 02090018
021000 01  DATE-IN.                                                     02100018
021100     05 DATE-IN-YY               PIC XX.                          02110018
021200     05 DATE-IN-MM               PIC XX.                          02120018
021300     05 DATE-IN-DD               PIC XX.                          02130018
021400                                                                  02140018
021500/                                                                 02150018
021600*                                                                 02160018
021700*    APRD045-TRANSACTION-FILE.                                    02170018
021800*                                                                 02180018
021900     COPY APRD045.                                                02190018
022000/                                                                 02200018
022100*                                                                 02210018
022200*    AGED-IMPORT-COSTS-RECORD.                                    02220018
022300*                                                                 02230018
022400     COPY APRD068.                                                02240018
022500/                                                                 02250018
022600*                                                                 02260018
022700*    NEW-MERCHANDISE-INVOICE-ACTIVITY-RECORD.                     02270018
022800*                                                                 02280018
022900     COPY APRD069.                                                02290018
023000/                                                                 02300018
023100*                                                                 02310018
023200*    PO-ACCOUNT-ACTIVITY-RECORD.                                  02320018
023300*                                                                 02330018
023400     COPY APRD068 REPLACING 'AP068-' BY 'WS068-'.                 02340020
023500/                                                                 02350018
023600*                                                                 02360018
023700*    TAPCNTL DCLGEN                                               02370018
023800*                                                                 02380018
023900     EXEC SQL                                                     02390018
024000         INCLUDE TAPCNTL                                          02400018
024100     END-EXEC.                                                    02410018
024200/                                                                 02420018
024300*                                                                 02430018
024400*    SQL COMMUNICATIONS AREA DCLGEN                               02440018
024500*                                                                 02450018
024600     EXEC SQL                                                     02460018
024700         INCLUDE SQLCA                                            02470018
024800     END-EXEC.                                                    02480018
024900/                                                                 02490018
025000*---------------------------------------------------------------- 02500018
025100*  ABEND DATA AREAS                                               02510018
025200*---------------------------------------------------------------- 02520018
025300 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          02530018
025400                                             COMP SYNC.           02540018
025500     88  AC-DB2-ERROR                        VALUE +4013.         02550018
025600                                                                  02560018
025700                                                                  02570018
025800 01  ABEND-AREAS.                                                 02580018
025900     05  AA-ABEND-LIT            PIC  X(40)  VALUE                02590018
026000             '*****       ABEND'.                                 02600018
026100     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                02610018
026200             '*****   PROGRAM: APKUT049'.                         02620018
026300     05  AA-PARAGRAPH-LIT.                                        02630018
026400         10  FILLER              PIC  X(17)  VALUE                02640018
026500             '***** PARAGRAPH: '.                                 02650018
026600         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        02660018
026700     05  AA-MESSAGE-LINE.                                         02670018
026800         10  FILLER              PIC  X(06)  VALUE '*****'.       02680018
026900         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        02690018
027000     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                02700018
027100             '*****    DB2 ERROR'.                                02710018
027200     05  AA-DB2-OPERATION-LIT.                                    02720018
027300         10  FILLER              PIC  X(17)  VALUE                02730018
027400             '***** OPERATION: '.                                 02740018
027500         10  AA-DB2-OPERATION.                                    02750018
027600             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        02760018
027700             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        02770018
027800     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        02780018
027900     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        02790018
028000     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        02800018
028100                                                                  02810018
028200/                                                                 02820018
028300*---------------------------------------------------------------- 02830018
028400*  SQLCA FORMATTED MESSAGE AREA                                   02840018
028500*---------------------------------------------------------------- 02850018
028600     COPY DPWS004.                                                02860018
028700*                                                                 02870018
028800/                                                                 02880018
028900 01  FILLER                      PIC  X(35)  VALUE                02890018
029000     '**** END OF W/S ** APKUT073 ****'.                          02900018
029100 EJECT                                                            02910018
029200 PROCEDURE DIVISION.                                              02920018
029300                                                                  02930018
029400     PERFORM A100-MAINLINE.                                       02940018
029500     GOBACK.                                                      02950018
029600                                                                  02960018
029700 EJECT                                                            02970018
029800 A100-MAINLINE.                                                   02980018
029900                                                                  02990018
030000     PERFORM B100-INITIALIZE.                                     03000018
030100                                                                  03010018
030200     PERFORM B200-PROCESS-FILES                                   03020018
030300         UNTIL PS-END-AP068                                       03030018
030400           AND PS-END-AP069                                       03040018
030500           AND PS-END-AP045.                                      03050018
030600                                                                  03060018
030700     PERFORM B300-END-OF-PROGRAM.                                 03070018
030800                                                                  03080018
030900 EJECT                                                            03090018
031000*---------------------------------------------------------------- 03100018
031100*    INITIALIZATION PROCESSING.                                   03110018
031200*---------------------------------------------------------------- 03120018
031300 B100-INITIALIZE.                                                 03130018
031400                                                                  03140018
031500     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              03150018
031600                                                                  03160018
031700     ACCEPT RUN-TIME FROM TIME.                                   03170018
031800     ACCEPT DATE-IN  FROM DATE.                                   03180018
031900                                                                  03190018
032000     DISPLAY ' RUN-DATE = ' DATE-IN '   RUN-TIME = ' RUN-TIME.    03200018
032100                                                                  03210018
032200     OPEN INPUT  AGED-IMPORT-COSTS-FILE                           03220018
032300                 NEW-MERCH-INVC-ACT-FILE                          03230018
032400                 AJ-TRANSACTION-FILE                              03240018
032500     OPEN OUTPUT PO-ACCOUNT-ACT-FILE.                             03250018
032600                                                                  03260018
032700     INITIALIZE DCLTAPCNTL.                                       03270018
032800                                                                  03280018
032900     PERFORM S100-SELECT-TAPCNTL.                                 03290018
033000                                                                  03300018
033100     INITIALIZE PV-CH-ACTVTY-AMT PV-CR-ACTVTY-AMT WS068-RECORD.   03310018
033200                                                                  03320018
033300     PERFORM R100-READ-AP068.                                     03330018
033400     PERFORM R200-READ-AP069.                                     03340018
033500     PERFORM R300-READ-AP045.                                     03350018
033600                                                                  03360018
033700 EJECT                                                            03370018
033800*---------------------------------------------------------------- 03380018
033900*    CONTROLS THE PROCESSING OF THE 3 INPUT FILES BASED ON HOW    03390018
034000*    THE PO/ACCOUNT NUMBERS COMPARE TO EACH OTHER.  THE AP068     03400018
034100*    FILE WILL HAVE 0 OR 1 RECORD FOR EACH PO/ACCOUNT COMBINATION.03410018
034200*    THE AP069 FILE WILL HAVE 0 OR 1 RECORD FOR EACH PO/ACCOUNT.  03420018
034300*    THE AP045 FILE COULD HAVE 0 TO MANY RECORDS FOR ANY GIVEN    03430018
034400*    PO/ACCOUNT COMBINATION.  THE PURPOSE IS TO CREATE A SINGLE   03440018
034500*    OUTPUT (AP068) RECORD FOR EACH PO/ACCOUNT COMBO, COMBINING   03450018
034600*    MATCHED RECORDS AS NECCESSARY.  THIS IS A SOMEWHAT COMPLEX   03460018
034700*    TRIPLE BUMP PROCESS.                                         03470018
034800*---------------------------------------------------------------- 03480018
034900 B200-PROCESS-FILES.                                              03490018
035000     IF AP068-PO-ACCT = AP069-PO-ACCT                             03500018
035100        IF PV-AP045-PO-ACCT = AP068-PO-ACCT                       03510018
035200           PERFORM C100-PROCESS-MATCHED-AP045                     03520018
035300                   UNTIL PV-AP045-PO-ACCT > AP068-PO-ACCT         03530018
035400        ELSE                                                      03540018
035500           IF PV-AP045-PO-ACCT < AP068-PO-ACCT                    03550018
035600              SET PS-FIRST-TIME TO TRUE                           03560018
035700              PERFORM C200-PROCESS-UNMATCHED-AP045                03570018
035800                      UNTIL PV-AP045-PO-ACCT >= AP068-PO-ACCT     03580018
035900                            OR PS-END-AP045                       03590018
036000              IF PV-AP045-PO-ACCT NOT = SV-AP045-PO-ACCT          03600018
036100                 PERFORM W300-WRITE-AP045-ACTIVITY                03610018
036200              END-IF                                              03620018
036300              IF PV-AP045-PO-ACCT = AP068-PO-ACCT                 03630018
036400                 PERFORM C100-PROCESS-MATCHED-AP045               03640018
036500                         UNTIL PV-AP045-PO-ACCT > AP068-PO-ACCT   03650018
036600                               OR PS-END-AP045                    03660018
036700              END-IF                                              03670018
036800           END-IF                                                 03680018
036900        END-IF                                                    03690018
037000        IF PS-END-AP068 AND PS-END-AP069 AND PS-END-AP045         03700018
037100           NEXT SENTENCE                                          03710018
037200        ELSE                                                      03720018
037300           PERFORM D100-PROCESS-AP068-REC                         03730018
037400           PERFORM D200-PROCESS-AP069-REC                         03740018
037500           PERFORM W100-WRITE-AP068-ACTIVITY                      03750018
037600           IF NOT PS-END-AP068                                    03760018
037700              PERFORM R100-READ-AP068                             03770018
037800           END-IF                                                 03780018
037900           IF NOT PS-END-AP069                                    03790018
038000              PERFORM R200-READ-AP069                             03800018
038100           END-IF                                                 03810018
038200        END-IF                                                    03820018
038300     ELSE                                                         03830018
038400        IF AP068-PO-ACCT > AP069-PO-ACCT                          03840018
038500           IF PV-AP045-PO-ACCT = AP069-PO-ACCT                    03850018
038600              PERFORM C100-PROCESS-MATCHED-AP045                  03860018
038700                      UNTIL PV-AP045-PO-ACCT > AP069-PO-ACCT      03870018
038800              PERFORM D200-PROCESS-AP069-REC                      03880018
038900              PERFORM W200-WRITE-AP069-ACTIVITY                   03890018
039000              IF NOT PS-END-AP069                                 03900018
039100                 PERFORM R200-READ-AP069                          03910018
039200              END-IF                                              03920018
039300           ELSE                                                   03930018
039400              IF PV-AP045-PO-ACCT < AP069-PO-ACCT                 03940018
039500                 SET PS-FIRST-TIME TO TRUE                        03950018
039600                 PERFORM C200-PROCESS-UNMATCHED-AP045             03960018
039700                         UNTIL PV-AP045-PO-ACCT >= AP069-PO-ACCT  03970018
039800                               OR PS-END-AP045                    03980018
039900                 IF PV-AP045-PO-ACCT NOT = SV-AP045-PO-ACCT       03990018
040000                    PERFORM W300-WRITE-AP045-ACTIVITY             04000018
040100                 END-IF                                           04010018
040200                 IF PV-AP045-PO-ACCT = AP069-PO-ACCT              04020018
040300                    PERFORM C100-PROCESS-MATCHED-AP045            04030018
040400                            UNTIL PV-AP045-PO-ACCT >              04040018
040500                                  AP069-PO-ACCT                   04050018
040600                                  OR PS-END-AP045                 04060018
040700                    PERFORM D200-PROCESS-AP069-REC                04070018
040800                    PERFORM W200-WRITE-AP069-ACTIVITY             04080018
040900                    IF NOT PS-END-AP069                           04090018
041000                       PERFORM R200-READ-AP069                    04100018
041100                    END-IF                                        04110018
041200                 END-IF                                           04120018
041300              ELSE                                                04130018
041400                 PERFORM D200-PROCESS-AP069-REC                   04140018
041500                 PERFORM W200-WRITE-AP069-ACTIVITY                04150018
041600                 IF NOT PS-END-AP069                              04160018
041700                    PERFORM R200-READ-AP069                       04170018
041800                 END-IF                                           04180018
041900              END-IF                                              04190018
042000           END-IF                                                 04200018
042100        ELSE                                                      04210018
042200            IF AP068-PO-ACCT < AP069-PO-ACCT                      04220018
042300               IF PV-AP045-PO-ACCT = AP068-PO-ACCT                04230018
042400                  PERFORM C100-PROCESS-MATCHED-AP045              04240018
042500                          UNTIL PV-AP045-PO-ACCT > AP068-PO-ACCT  04250018
042600                  PERFORM D100-PROCESS-AP068-REC                  04260018
042700                  PERFORM W100-WRITE-AP068-ACTIVITY               04270018
042800                  IF NOT PS-END-AP068                             04280018
042900                     PERFORM R100-READ-AP068                      04290018
043000                  END-IF                                          04300018
043100               ELSE                                               04310018
043200                  IF PV-AP045-PO-ACCT < AP068-PO-ACCT             04320018
043300                     SET PS-FIRST-TIME TO TRUE                    04330018
043400                     PERFORM C200-PROCESS-UNMATCHED-AP045         04340018
043500                             UNTIL PV-AP045-PO-ACCT >=            04350018
043600                                   AP068-PO-ACCT                  04360018
043700                                   OR PS-END-AP045                04370018
043800                     IF PV-AP045-PO-ACCT NOT = SV-AP045-PO-ACCT   04380018
043900                        PERFORM W300-WRITE-AP045-ACTIVITY         04390018
044000                     END-IF                                       04400018
044100                     IF PV-AP045-PO-ACCT = AP068-PO-ACCT          04410018
044200                        PERFORM C100-PROCESS-MATCHED-AP045        04420018
044300                                UNTIL PV-AP045-PO-ACCT >          04430018
044400                                      AP068-PO-ACCT               04440018
044500                                      OR PS-END-AP045             04450018
044600                        PERFORM D100-PROCESS-AP068-REC            04460018
044700                        PERFORM W100-WRITE-AP068-ACTIVITY         04470018
044800                        IF NOT PS-END-AP068                       04480018
044900                           PERFORM R100-READ-AP068                04490018
045000                        END-IF                                    04500018
045100                     END-IF                                       04510018
045200                  ELSE                                            04520018
045300                     PERFORM D100-PROCESS-AP068-REC               04530018
045400                     PERFORM W100-WRITE-AP068-ACTIVITY            04540018
045500                     IF NOT PS-END-AP068                          04550018
045600                        PERFORM R100-READ-AP068                   04560018
045700                     END-IF                                       04570018
045800                  END-IF                                          04580018
045900               END-IF                                             04590018
046000            END-IF                                                04600018
046100         END-IF                                                   04610018
046200     END-IF.                                                      04620018
046300                                                                  04630018
046400                                                                  04640018
046500 EJECT                                                            04650018
046600*---------------------------------------------------------------- 04660018
046700*  END OF PROGRAM - DISPLAYS COUNTERS AND CLOSES FILES.           04670018
046800*---------------------------------------------------------------- 04680018
046900 B300-END-OF-PROGRAM.                                             04690018
047000                                                                  04700018
047100     DISPLAY 'PROGRAM APKUT073 RECORD COUNTS'.                    04710018
047200     DISPLAY '****************************'.                      04720018
047300     DISPLAY 'NBR OF AP068 RECS READ    = ' PV-AP068-COUNT.       04730018
047400     DISPLAY 'NBR OF AP069 RECS READ    = ' PV-AP069-COUNT.       04740018
047500     DISPLAY 'NBR OF AP045 RECS READ    = ' PV-AP045-COUNT.       04750018
047600     DISPLAY 'NBR OF AP068 RECS WRITTEN = ' PV-POACCT-COUNT.      04760018
047700     DISPLAY '****************************'.                      04770018
047800     DISPLAY '** PROGRAM APKUT073 ENDS NORMALLY **'.              04780018
047900                                                                  04790018
048000     CLOSE AJ-TRANSACTION-FILE                                    04800018
048100           AGED-IMPORT-COSTS-FILE                                 04810018
048200           NEW-MERCH-INVC-ACT-FILE                                04820018
048300           PO-ACCOUNT-ACT-FILE.                                   04830018
048400                                                                  04840018
048500 EJECT                                                            04850018
048600*---------------------------------------------------------------- 04860018
048700*  PROCESSES THE AP045 RECORD(S) THAT HAVE MATCHING AP068 AND/OR  04870018
048800*  AP069 RECORDS.                                                 04880018
048900*---------------------------------------------------------------- 04890018
049000 C100-PROCESS-MATCHED-AP045.                                      04900018
049100                                                                  04910018
049200     PERFORM D300-COMBINE-AP045-REC.                              04920018
049300                                                                  04930018
049400     IF NOT PS-END-AP045                                          04940018
049500        PERFORM R300-READ-AP045                                   04950018
049600     END-IF.                                                      04960018
049700                                                                  04970018
049800 EJECT                                                            04980018
049900*---------------------------------------------------------------- 04990018
050000*  PROCESSES THE AP045 RECORD(S) THAT DO NOT HAVE MATCHING AP068  05000018
050100*  AND/OR AP069 RECORDS.                                          05010018
050200*---------------------------------------------------------------- 05020018
050300 C200-PROCESS-UNMATCHED-AP045.                                    05030018
050400                                                                  05040018
050500     IF PS-FIRST-TIME                                             05050018
050600        SET PS-NOT-FIRST-TIME TO TRUE                             05060018
050700        MOVE AP045-PO-NBR      TO SV-PO-NBR                       05070018
050800*       MOVE AP045-GL-ACCT-NBR TO SV-GL-ACCT                      05080018
050900        MOVE AP045-GL-ACCT-NBR TO SV-GL-ACCT-NBR                  05090018
051000     END-IF.                                                      05100018
051100                                                                  05110018
051200     IF PV-AP045-PO-ACCT NOT = SV-AP045-PO-ACCT                   05120018
051300        PERFORM W300-WRITE-AP045-ACTIVITY                         05130018
051400        MOVE AP045-PO-NBR      TO SV-PO-NBR                       05140018
051500*       MOVE AP045-GL-ACCT-NBR TO SV-GL-ACCT                      05150018
051600        MOVE AP045-GL-ACCT-NBR TO SV-GL-ACCT-NBR                  05160018
051700     END-IF.                                                      05170018
051800                                                                  05180018
051900     PERFORM D300-COMBINE-AP045-REC.                              05190018
052000                                                                  05200018
052100     IF NOT PS-END-AP045                                          05210018
052200        PERFORM R300-READ-AP045                                   05220018
052300     END-IF.                                                      05230018
052400                                                                  05240018
052500 EJECT                                                            05250018
052600*---------------------------------------------------------------- 05260018
052700*  MOVES THE AP068 RECORD INTO THE MATCHING RECORD LAYOUT THAT    05270018
052800* WILL BE USED TO COMBINE MATCHED RECORDS INTO A SINGLE RECORD.   05280018
052900*---------------------------------------------------------------- 05290018
053000 D100-PROCESS-AP068-REC.                                          05300018
053100                                                                  05310018
053200     MOVE AP068-RECORD TO WS068-RECORD.                           05320018
053300                                                                  05330018
053400 EJECT                                                            05340018
053500*---------------------------------------------------------------- 05350018
053600*  ADDS THE GROSS COST AMOUNT TO THE COMBINED RECORD LAYOUT THAT  05360018
053700*  WILL BE USED TO COMBINE THE MATCHED RECORDS INTO A SINGLE      05370018
053800*  RECORD.                                                        05380018
053900*---------------------------------------------------------------- 05390018
054000 D200-PROCESS-AP069-REC.                                          05400018
054100                                                                  05410018
054200     ADD AP069-NET-COST-AMT   TO WS068-DR-ACTVTY-AMT.             05420018
054300                                                                  05430018
054400 EJECT                                                            05440018
054500*---------------------------------------------------------------- 05450018
054600*  ADDS THE AP045 AMOUNT INTO THE APPROPRIATE AMOUNT FIELD        05460018
054700*  DEPENDING ON THE AP045 DOCUMENT TYPE.                          05470018
054800*---------------------------------------------------------------- 05480018
054900 D300-COMBINE-AP045-REC.                                          05490018
055000                                                                  05500018
055100     IF AP045-PSTG-TYP-CDE = 'CH'                                 05510018
055200        ADD AP045-NET-COST-AMT TO PV-CH-ACTVTY-AMT                05520018
055300     END-IF.                                                      05530018
055400                                                                  05540018
055500     IF AP045-PSTG-TYP-CDE = 'CR'                                 05550018
055600        COMPUTE PV-NET-COST-AMT = AP045-NET-COST-AMT * -1         05560018
055700        ADD PV-NET-COST-AMT TO PV-CR-ACTVTY-AMT                   05570018
055800     END-IF.                                                      05580018
055900                                                                  05590018
056000 EJECT                                                            05600018
056100*---------------------------------------------------------------- 05610018
056200*  READS THE AGED IMPORT COSTS FILE  (AP068).                     05620018
056300*---------------------------------------------------------------- 05630018
056400 R100-READ-AP068.                                                 05640018
056500                                                                  05650018
056600     READ AGED-IMPORT-COSTS-FILE INTO AP068-RECORD                05660018
056700         AT END                                                   05670018
056800             MOVE ALL '9' TO AP068-RECORD                         05680018
056900             SET PS-END-AP068 TO TRUE.                            05690018
057000                                                                  05700018
057100     IF NOT PS-END-AP068                                          05710018
057200        ADD +1 TO PV-AP068-COUNT                                  05720018
057300     END-IF.                                                      05730018
057400                                                                  05740018
057500 EJECT                                                            05750018
057600*---------------------------------------------------------------- 05760018
057700*  READS THE NEW MERCH INVC ACT FILE  (AP069).                    05770018
057800*---------------------------------------------------------------- 05780018
057900 R200-READ-AP069.                                                 05790018
058000                                                                  05800018
058100     READ NEW-MERCH-INVC-ACT-FILE INTO AP069-INVOICE-EXTRACT      05810018
058200         AT END                                                   05820018
058300             MOVE ALL '9' TO AP069-INVOICE-EXTRACT                05830018
058400             SET PS-END-AP069 TO TRUE.                            05840018
058500                                                                  05850018
058600     IF NOT PS-END-AP069                                          05860018
058700        ADD +1 TO PV-AP069-COUNT                                  05870018
058800     END-IF.                                                      05880018
058900                                                                  05890018
059000 EJECT                                                            05900018
059100*---------------------------------------------------------------- 05910018
059200*  READS THE AJ TRANSACTION FILE  (AP045).                        05920018
059300*---------------------------------------------------------------- 05930018
059400 R300-READ-AP045.                                                 05940018
059500                                                                  05950018
059600     READ AJ-TRANSACTION-FILE INTO AP045-TRANSACTION-FILE         05960018
059700         AT END                                                   05970018
059800             MOVE ALL '9' TO AP045-TRANSACTION-FILE               05980018
059900             SET PS-END-AP045 TO TRUE.                            05990018
060000                                                                  06000018
060100     MOVE AP045-PO-NBR      TO PV-PO-NBR.                         06010018
060200*    MOVE AP045-GL-ACCT-NBR TO PV-GL-ACCT.                        06020018
060300     MOVE AP045-GL-ACCT-NBR TO PV-GL-ACCT-NBR.                    06030018
060400                                                                  06040018
060500     IF NOT PS-END-AP045                                          06050018
060600        ADD +1 TO PV-AP045-COUNT                                  06060018
060700     END-IF.                                                      06070018
060800                                                                  06080018
060900 EJECT                                                            06090018
061000*---------------------------------------------------------------- 06100018
061100*  SELECT THE CURR_WK_END_DTE TO BE USED WHEN WRITING OUTPUT      06110018
061200*  RECORDS THAT ARE BASED ON ONLY THE AP045 FILE.                 06120018
061300*---------------------------------------------------------------- 06130018
061400 S100-SELECT-TAPCNTL.                                             06140018
061500                                                                  06150018
061600     MOVE 'S100-SELECT-TAPCNTL' TO PV-CURRENT-PARAGRAPH.          06160018
061700                                                                  06170018
061800     EXEC SQL                                                     06180018
061900         SELECT CURR_WK_END_DTE                                   06190018
062000         INTO   :PV-PERIOD-END-DTE                                06200018
062100         FROM TAPCNTL                                             06210018
062200     END-EXEC.                                                    06220018
062300                                                                  06230018
062400     EVALUATE TRUE                                                06240018
062500         WHEN SQLCODE = ZERO                                      06250018
062600              CONTINUE                                            06260018
062700                                                                  06270018
062800         WHEN SQLWARN0 NOT = SPACES                               06280018
062900         WHEN SQLCODE  NOT = ZERO                                 06290018
063000         MOVE PV-CURRENT-PARAGRAPH                                06300018
063100                            TO AA-PARAGRAPH-NAME                  06310018
063200         MOVE 'UNSUCCESSFUL SELECT OF PAYMENT CONTROL TBL'        06320018
063300                            TO AA-DB2-OPERATION                   06330018
063400         MOVE 'TAPCNTL'     TO AA-DB2-TABLE-1                     06340018
063500         MOVE SPACES        TO AA-DB2-TABLE-2                     06350018
063600                                                                  06360018
063700         PERFORM Z999-DB2-ABEND                                   06370018
063800     END-EVALUATE.                                                06380018
063900                                                                  06390018
064000 EJECT                                                            06400018
064100*---------------------------------------------------------------- 06410018
064200*  WRITES OUT THE SINGLE COMBINED RECORD FROM EITHER ALL THREE    06420018
064300*  INPUT FILES HAVING MATCHED KEYS OR THE AP068 AND AP045 RECORDS 06430018
064400*  HAVING MATCHED KEYS OR AN UNMATCHED AP068 RECORD.              06440018
064500*---------------------------------------------------------------- 06450018
064600 W100-WRITE-AP068-ACTIVITY.                                       06460018
064700                                                                  06470018
064800     ADD PV-CH-ACTVTY-AMT TO WS068-DR-ACTVTY-AMT.                 06480018
064900     ADD PV-CR-ACTVTY-AMT TO WS068-CR-ACTVTY-AMT.                 06490018
065000                                                                  06500018
065100     WRITE PO-ACCOUNT-ACT-RECORD FROM WS068-RECORD.               06510018
065200                                                                  06520018
065300     ADD 1                TO PV-POACCT-COUNT.                     06530018
065400                                                                  06540018
065500     INITIALIZE PV-CH-ACTVTY-AMT PV-CR-ACTVTY-AMT WS068-RECORD.   06550018
065600                                                                  06560018
065700 EJECT                                                            06570018
065800*---------------------------------------------------------------- 06580018
065900*  WRITES OUT THE SINGLE COMBINED RECORD FROM THE AP069 AND AP045 06590018
066000*  RECORDS HAVING MATCHED KEYS OR AN UNMATCHED AP069 RECORD.      06600018
066100*---------------------------------------------------------------- 06610018
066200 W200-WRITE-AP069-ACTIVITY.                                       06620018
066300                                                                  06630018
066400     MOVE AP069-PO-NBR       TO WS068-PO-NBR.                     06640018
066500     MOVE AP069-GL-ACCT-NBR  TO WS068-GL-ACCT-NBR.                06650018
066600     MOVE AP069-PERD-END-DTE TO WS068-PERIOD-END-DTE.             06660018
066700     ADD PV-CH-ACTVTY-AMT    TO WS068-DR-ACTVTY-AMT.              06670018
066800     ADD PV-CR-ACTVTY-AMT    TO WS068-CR-ACTVTY-AMT.              06680018
066900                                                                  06690018
067000     WRITE PO-ACCOUNT-ACT-RECORD FROM WS068-RECORD.               06700018
067100                                                                  06710018
067200     ADD 1                   TO PV-POACCT-COUNT.                  06720018
067300                                                                  06730018
067400     INITIALIZE PV-CH-ACTVTY-AMT PV-CR-ACTVTY-AMT WS068-RECORD.   06740018
067500                                                                  06750018
067600 EJECT                                                            06760018
067700*---------------------------------------------------------------- 06770018
067800*  WRITES OUT THE SINGLE COMBINED RECORD FROM ONLY AP045 RECORD(S)06780018
067900*  THERE ARE NO MATCHING AP068 OR AP069 RECORDS.                  06790018
068000*---------------------------------------------------------------- 06800018
068100 W300-WRITE-AP045-ACTIVITY.                                       06810018
068200                                                                  06820018
068300     MOVE SV-PO-NBR          TO WS068-PO-NBR.                     06830018
068400     MOVE SV-GL-ACCT-NBR     TO WS068-GL-ACCT-NBR.                06840018
068500     MOVE PV-PERIOD-END-DTE  TO WS068-PERIOD-END-DTE.             06850018
068600     ADD PV-CH-ACTVTY-AMT    TO WS068-DR-ACTVTY-AMT.              06860018
068700     ADD PV-CR-ACTVTY-AMT    TO WS068-CR-ACTVTY-AMT.              06870018
068800                                                                  06880018
068900     WRITE PO-ACCOUNT-ACT-RECORD FROM WS068-RECORD.               06890018
069000                                                                  06900018
069100     ADD 1                   TO PV-POACCT-COUNT.                  06910018
069200                                                                  06920018
069300     INITIALIZE PV-CH-ACTVTY-AMT PV-CR-ACTVTY-AMT WS068-RECORD.   06930018
069400                                                                  06940018
069500 EJECT                                                            06950018
069600*---------------------------------------------------------------- 06960018
069700*    ABEND ROUTINE FOR DB2 ERRORS.                                06970018
069800*---------------------------------------------------------------- 06980018
069900 Z999-DB2-ABEND.                                                  06990018
070000                                                                  07000018
070100     CLOSE AJ-TRANSACTION-FILE                                    07010018
070200           AGED-IMPORT-COSTS-FILE                                 07020018
070300           NEW-MERCH-INVC-ACT-FILE                                07030018
070400           PO-ACCOUNT-ACT-FILE.                                   07040018
070500                                                                  07050018
070600     DISPLAY AA-ABEND-LIT.                                        07060018
070700     DISPLAY AA-DB2-ERROR-LIT.                                    07070018
070800     DISPLAY AA-PROGRAM-LIT.                                      07080018
070900     DISPLAY AA-PARAGRAPH-LIT.                                    07090018
071000     DISPLAY AA-DB2-OPERATION-LIT.                                07100018
071100     DISPLAY AA-DB2-TABLE-1.                                      07110018
071200     DISPLAY AA-DB2-TABLE-2.                                      07120018
071300     DISPLAY AA-DB2-TABLE-3.                                      07130018
071400     SET AC-DB2-ERROR TO TRUE.                                    07140018
071500                                                                  07150018
071600     COPY DPPD004.                                                07160018
071700                                                                  07170018
071800     CALL 'ILBOABN0' USING ABEND-CODE.                            07180018
