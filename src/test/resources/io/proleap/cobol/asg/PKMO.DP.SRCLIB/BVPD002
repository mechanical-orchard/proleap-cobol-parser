      * THIS COPY CODE NEEDS BVWS002 TO FUNCTION.                       00058801
      * ALSO, THE CALLING PROGRAM NEEDS TO HAVE THE FOLLOWING TABLES    00058900
      * IMT_DEPT_BRND_VND                                               00059001
      * MLT_WKLY_SUM                                                    00060001
      * MLT_PARTN_CNTL                                                  00070001
      *                                                                 00141000
      * A DEPT, A PROCESS DATE AND A STARTING AND ENDING FISCAL DATE CAN00142003
      * BE PASSED TO THIS MODULE ALONG WITH A MAX OF 10 BRANDS.         00143025
      * IT WILL OPEN A CURSOR ON THE IMT_DEPT_BRND_VND TABLE AND FOR    00144003
      * EACH RECORD(BRND VND KEY), IT WILL SELECT THE SUM OF RECEIPT    00145003
      * GROSS COST AMT FROM WEEKLY SUM TABLE USING THE FISCAL WEEK DATES00146003
      *                                                                 00147003
      * THE OUTPUT FROM THIS MODULE IS A TABLE WHICH WOULD HAVE THE     00148003
      * FOLLOWING LAYOUT:                                               00149003
      *                                                                 00149103
      * DEPT-BRND-ENT ID-RCPT GR CST-PERCENTAGE                         00150003
      ******************************************************************00388000
       BV002-LOOKUP-MAIN.                                               00389002
                                                                        00390000
            INITIALIZE BV002-PV-WORK-AREA.                              00391001
            INITIALIZE BV002-PV-OUTPUT-AREA.                            00391101
            MOVE SPACES TO BV002-PV-RETURN-MSG-1                        00391202
                           BV002-PV-RETURN-MSG-2.                       00391302
            PERFORM BV002-VALIDATE.                                     00391402
            PERFORM BV002-OPEN-CSR.                                     00391504
            SET BV002-EQUAL-PRORATE-YES TO TRUE.                        00391622
            PERFORM BV002-FETCH-CSR                                     00391703
              UNTIL BV002-END-OF-CSR.                                   00550004
            PERFORM BV002-CLOSE-CSR.                                    00551004
            MOVE BV002-PV-IDX TO BV002-PV-HOLD-IDX.                     00551115
            MOVE ZEROS TO BV002-PV-IDX                                  00551220
                          BV002-PV-PERCENT-SO-FAR.                      00551321
            PERFORM BV002-PERCENT-CALC BV002-PV-HOLD-IDX TIMES.         00552015
      ******************************************************************00560000
      * PROCESS BRAND VENDOR LOOKUP FOR A BRAND.                        00570000
      ******************************************************************00580000
      * PROCESS BRAND VENDOR LOOKUP FOR A BRAND DEPARTMENT              00740000
      ******************************************************************00750000
      ******************************************************************03120000
      * OPEN THE CURSOR                                                 03130003
      ******************************************************************03140000
       BV002-OPEN-CSR.                                                  03150003
                                                                        03156010
           MOVE BV002-PV-PRO-DTE-IN                                     03157011
             TO BV002-PV-PRO-DTE-IN-WRK.                                03158013
                                                                        03159011
           MOVE BV002-PV-DEPT-IN                                        03159111
             TO BV002-PV-DEPT-IN-WRK.                                   03159213
                                                                        03159311
JOHN       MOVE BV002-PV-FSC-WK-ST-IN                                   03159419
JOHN         TO BV002-PV-FSC-WK-ST-IN-WRK.                              03159519
JOHN                                                                    03159619
JOHN       MOVE BV002-PV-FSC-WK-ED-IN                                   03159719
JOHN         TO BV002-PV-FSC-WK-ED-IN-WRK.                              03159819
JOHN                                                                    03159919
PK9934*    MOVE BV002-PV-LBL-SEQ-IN1                                    03160028
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK1.                               03160128
PK9934*                                                                 03160228
PK9934*    MOVE BV002-PV-LBL-SEQ-IN2                                    03160328
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK2.                               03160428
PK9934*                                                                 03160528
PK9934*    MOVE BV002-PV-LBL-SEQ-IN3                                    03160628
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK3.                               03160728
PK9934*                                                                 03160828
PK9934*    MOVE BV002-PV-LBL-SEQ-IN4                                    03160928
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK4.                               03161028
PK9934*                                                                 03161128
PK9934*    MOVE BV002-PV-LBL-SEQ-IN5                                    03161228
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK5.                               03161328
PK9934*                                                                 03161428
PK9934*    MOVE BV002-PV-LBL-SEQ-IN6                                    03161528
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK6.                               03161628
PK9934*                                                                 03161728
PK9934*    MOVE BV002-PV-LBL-SEQ-IN7                                    03161828
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK7.                               03161928
PK9934*                                                                 03162028
PK9934*    MOVE BV002-PV-LBL-SEQ-IN8                                    03162128
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK8.                               03162228
PK9934*                                                                 03162328
PK9934*    MOVE BV002-PV-LBL-SEQ-IN9                                    03162428
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK9.                               03162528
PK9934*                                                                 03162628
PK9934*    MOVE BV002-PV-LBL-SEQ-IN10                                   03162728
PK9934*      TO BV002-PV-LBL-SEQ-IN-WRK10.                              03162828
PK9934*                                                                 03163028
PK9934     MOVE BV002-PV-EXP-TYP-NBR-IN                                 03163128
PK9934       TO BV002-PV-EXP-TYP-NBR-WRK.                               03163228
                                                                        03163327
           EXEC SQL                                                     03164027
              OPEN IMT_BRND_VND                                         03170003
           END-EXEC                                                     03180000
                                                                        03190000
           EVALUATE TRUE                                                03200000
              WHEN SQLCODE = 0                                          03210000
                   CONTINUE                                             03220000
              WHEN OTHER                                                03230000
                   SET BV002-PV-SQL-ERROR TO TRUE                       03240004
                   MOVE SQLCODE TO BV002-PV-SQLCODE-OUT                 03270008
                   STRING 'CURSOR OPEN FAILED     '                     03290004
                                                 DELIMITED BY SIZE      03300000
                          'IN BV002-OPEN-CSR     '                      03310004
                                                 DELIMITED BY SIZE      03320000
                     INTO BV002-PV-RETURN-MSG-1                         03330004
           END-EVALUATE.                                                03340000
      ******************************************************************03350000
      ******************************************************************04500000
      * FETCH A RECORD FOR THE BRAND CURSOR                             04510000
      ******************************************************************04520000
       BV002-FETCH-CSR.                                                 04530003
           EXEC SQL                                                     04540000
              FETCH IMT_BRND_VND                                        04550003
               INTO :IMT00017-DEPT-BRND-VND-ID                          04560003
                   ,:IMT00017-DEPT-NBR                                  04570003
                   ,:IMT00017-ENT-ID                                    04580003
                   ,:IMT00017-LBL-SEQ-NBR                               04581003
           END-EXEC                                                     04590000
                                                                        04600000
           EVALUATE TRUE                                                04610000
              WHEN SQLCODE = 0                                          04620000
                   PERFORM BV002-PROCESS-GROSS-COST                     04630003
              WHEN SQLCODE = +100                                       04640000
                   SET BV002-END-OF-CSR TO TRUE                         04650003
              WHEN OTHER                                                04660000
                   SET BV002-PV-SQL-ERROR TO TRUE                       04670004
                   MOVE SQLCODE TO BV002-PV-SQLCODE-OUT                 04700004
                   STRING 'FAIL CURSOR FETCH '                          04720004
                                                 DELIMITED BY SIZE      04730000
                          'IN FETCH-CSR'                                04740004
                                                 DELIMITED BY SIZE      04750000
                     INTO BV002-PV-RETURN-MSG-1                         04760004
           END-EVALUATE.                                                04770000
      ******************************************************************06120000
      * CLOSE THE BRAND CURSOR                                          06130000
      ******************************************************************06140000
       BV002-CLOSE-CSR.                                                 06150003
           EXEC SQL                                                     06160000
              CLOSE IMT_BRND_VND                                        06170003
           END-EXEC                                                     06180000
                                                                        06190000
           EVALUATE TRUE                                                06200000
              WHEN SQLCODE = 0                                          06210000
                   CONTINUE                                             06220000
              WHEN OTHER                                                06230000
                   SET BV002-PV-SQL-ERROR TO TRUE                       06240008
                   MOVE SQLCODE TO BV002-PV-SQLCODE-OUT                 06270004
                   STRING 'FAIL CURSOR CLOSE '                          06290004
                                                 DELIMITED BY SIZE      06300000
                          'IN CLOSE-CSR'                                06310004
                                                 DELIMITED BY SIZE      06320000
                     INTO BV002-PV-RETURN-MSG-1                         06330004
           END-EVALUATE.                                                06340000
      ******************************************************************06350000
      *    LOAD THE OUTPUT TABLE WITH ALL RELATIONSHIPS OF THE SPECIFIED06360003
      *    TYPE.                                                        06370003
      ******************************************************************06380003
       BV002-PROCESS-GROSS-COST.                                        06390003
                                                                        06410003
           EXEC SQL                                                     06430003
JOHN          SELECT  VALUE(SUM(RCPT_GRO_COST_AMT),0)                   06440017
               INTO :BV002-PV-RCPT-GRO-CST-AMT                          06480003
               FROM MLT_WKLY_SUM WS,                                    06520003
                    MLT_PARTN_CNTL PC                                   06521003
              WHERE WS.ML_LO_MDSE_LVL_ID = :IMT00017-DEPT-BRND-VND-ID   06530003
                AND WS.DEPT_NBR   = :IMT00017-DEPT-NBR                  06540003
                AND PC.FSCL_DTE BETWEEN :BV002-PV-FSC-WK-ST-IN-WRK      06550013
                AND :BV002-PV-FSC-WK-ED-IN-WRK                          06560013
                AND PC.TBL_TM_LVL_CDE = 'W'                             06570003
                AND PC.PARTN_NBR = WS.PARTN_NBR                         06571003
           END-EXEC                                                     06572003
                                                                        06680003
           EVALUATE TRUE                                                06690003
              WHEN SQLCODE = 0                                          06700004
                   PERFORM BV002-LOAD-TABLE                             06700120
              WHEN SQLCODE = +100                                       06701004
                   MOVE ZEROS TO BV002-PV-RCPT-GRO-CST-AMT              06701120
                   PERFORM BV002-LOAD-TABLE                             06702020
              WHEN OTHER                                                06750003
                   SET BV002-PV-SQL-ERROR      TO TRUE                  06760008
                   MOVE SQLCODE TO BV002-PV-SQLCODE-OUT                 06790008
JOHN               DISPLAY 'SQLCODE ' BV002-PV-SQLCODE-OUT              06800017
JOHN               DISPLAY 'IMT00017-DEPT-BRND-VND-ID '                 06801018
JOHN                        IMT00017-DEPT-BRND-VND-ID                   06802018
JOHN               DISPLAY 'BV002-PV-FSC-WK-ST-IN-WRK '                 06803017
JOHN                        BV002-PV-FSC-WK-ST-IN-WRK                   06804017
JOHN               DISPLAY 'BV002-PV-FSC-WK-ED-IN-WRK '                 06805017
JOHN                        BV002-PV-FSC-WK-ED-IN-WRK                   06806017
                   STRING 'FAIL GROSS COST LOOKUP '                     06810004
                                                 DELIMITED BY SIZE      06820003
                          'IN BV002-PROCESS-GROSS-COST'                 06830004
                                                 DELIMITED BY SIZE      06840003
                     INTO BV002-PV-RETURN-MSG-1                         06850004
           END-EVALUATE.                                                06860003
      ******************************************************************07480000
      *    LOAD THE OUTPUT TABLE WITH ALL RELATIONSHIPS OF THE SPECIFIED07490000
      *    TYPE.                                                        07500000
      ******************************************************************07510000
       BV002-LOAD-TABLE.                                                07520003
           ADD 1 TO BV002-PV-IDX.                                       07530003
                                                                        07540000
           MOVE IMT00017-DEPT-NBR                                       07550003
             TO BV002-RT-DEPT-OUT(BV002-PV-IDX).                        07560003
                                                                        07570000
           MOVE IMT00017-LBL-SEQ-NBR                                    07580003
             TO BV002-RT-BRND-OUT(BV002-PV-IDX).                        07590003
                                                                        07600000
           MOVE IMT00017-ENT-ID                                         07610003
             TO BV002-RT-ENT-ID-OUT(BV002-PV-IDX).                      07620003
                                                                        07630000
           MOVE BV002-PV-RCPT-GRO-CST-AMT                               07640003
             TO BV002-RT-RCPT-GR-CST-OUT(BV002-PV-IDX).                 07650003
                                                                        07660000
            ADD BV002-PV-RCPT-GRO-CST-AMT                               07670003
             TO BV002-PV-TOTAL-GROSS-COST.                              07680003
                                                                        07690003
           IF BV002-PV-RCPT-GRO-CST-AMT NOT EQUAL ZERO                  07700022
              SET BV002-EQUAL-PRORATE-NO TO TRUE                        07710022
           END-IF.                                                      07720022
                                                                        07730022
      ******************************************************************07910000
      * CHECK THAT THE ENT ID MEETS INITIAL REQUIREMENTS                07920000
      ******************************************************************07930000
       BV002-PERCENT-CALC.                                              07940003
            ADD 1 TO BV002-PV-IDX.                                      07941215
                                                                        07942003
      *  IF LAST ENTRY OF INTERNAL TABLE, CALC % AS 100 - (SUM OF REST) 07942123
            IF BV002-PV-IDX EQUAL BV002-PV-HOLD-IDX                     07942222
               COMPUTE BV002-RT-PERCENTAGE(BV002-PV-IDX) =              07942322
                   100 - BV002-PV-PERCENT-SO-FAR                        07942422
            ELSE                                                        07942723
      *  EQUAL PRORATION                                                07942823
               IF BV002-EQUAL-PRORATE-YES                               07942923
                  COMPUTE BV002-RT-PERCENTAGE(BV002-PV-IDX) =           07943023
                       100 / BV002-PV-HOLD-IDX                          07943123
                  ADD BV002-RT-PERCENTAGE(BV002-PV-IDX)                 07943223
                   TO BV002-PV-PERCENT-SO-FAR                           07943323
               ELSE                                                     07943523
                  IF BV002-RT-RCPT-GR-CST-OUT(BV002-PV-IDX) EQUAL ZERO  07943723
                  OR BV002-PV-TOTAL-GROSS-COST EQUAL ZERO               07943823
                     MOVE ZEROS TO BV002-RT-PERCENTAGE(BV002-PV-IDX)    07944023
                  ELSE                                                  07945023
                     COMPUTE BV002-RT-PERCENTAGE(BV002-PV-IDX) =        07947323
                             (BV002-RT-RCPT-GR-CST-OUT(BV002-PV-IDX) /  07947423
                             BV002-PV-TOTAL-GROSS-COST) * 100           07948023
                     ADD BV002-RT-PERCENTAGE(BV002-PV-IDX)              07948123
                      TO BV002-PV-PERCENT-SO-FAR                        07948223
                  END-IF                                                07949023
               END-IF                                                   07950023
            END-IF.                                                     07960023
      ******************************************************************08330000
      * CHECK THAT THE DATE FIELD MEETS INITIAL REQUIREMENTS            08340000
      * IF NO DATE IS PROVIDED, SET TO CURRENT DATE.                    08350000
      ******************************************************************08360000
       BV002-VALIDATE.                                                  08370002
            IF BV002-PV-DEPT-IN = ZEROS                                 08380012
               STRING 'BAD DEPT '         DELIMITED BY SIZE             08400002
                      BV002-PV-DEPT-IN-X DELIMITED BY SIZE              08410014
                 INTO BV002-PV-RETURN-MSG-1                             08420002
               SET BV002-BAD-DEPT TO TRUE                               08430026
            ELSE                                                        08570002
               IF BV002-PV-PRO-DTE-IN-YR NOT NUMERIC OR                 08580002
                  BV002-PV-PRO-DTE-IN-MN NOT NUMERIC OR                 08590002
                  BV002-PV-PRO-DTE-IN-DY NOT NUMERIC                    08600002
                  STRING 'BAD PROCESS DATE ' DELIMITED BY SIZE          08610002
                         BV002-PV-PRO-DTE-IN DELIMITED BY SIZE          08620002
                    INTO BV002-PV-RETURN-MSG-1                          08630002
                  SET BV002-BAD-PROCESS-DT TO TRUE                      08640026
               ELSE                                                     08670002
                  IF BV002-PV-FSC-WK-ST-IN-YR NOT NUMERIC OR            08671002
                     BV002-PV-FSC-WK-ST-IN-MN NOT NUMERIC OR            08672002
                     BV002-PV-FSC-WK-ST-IN-DY NOT NUMERIC               08673002
                     STRING 'BAD START FSC DTE ' DELIMITED BY SIZE      08674002
                            BV002-PV-FSC-WK-ST-IN DELIMITED BY SIZE     08675002
                       INTO BV002-PV-RETURN-MSG-1                       08676002
                     SET BV002-BAD-FSC-WK TO TRUE                       08677004
                  ELSE                                                  08678002
                     IF BV002-PV-FSC-WK-ED-IN-YR NOT NUMERIC OR         08679002
                        BV002-PV-FSC-WK-ED-IN-MN NOT NUMERIC OR         08679102
                        BV002-PV-FSC-WK-ED-IN-DY NOT NUMERIC            08679202
                        STRING 'BAD END FSC DATE ' DELIMITED BY SIZE    08679302
                               BV002-PV-FSC-WK-ED-IN DELIMITED BY SIZE  08679402
                          INTO BV002-PV-RETURN-MSG-1                    08679502
                        SET BV002-BAD-FSC-WK TO TRUE                    08679604
                     END-IF                                             08679702
                  END-IF                                                08679802
               END-IF                                                   08679902
            END-IF.                                                     08680002
