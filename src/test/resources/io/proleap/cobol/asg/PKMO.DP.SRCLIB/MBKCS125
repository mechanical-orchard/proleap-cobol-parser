00001 *************************                                         02/05/92
00002  IDENTIFICATION DIVISION.                                         MBKCS125
00003 *************************                                            LV028
00004  PROGRAM-ID.    MBKCS125.                                            CL**1
00005  AUTHOR.        MIKE FURLICK.                                        CL**1
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**1
00007  DATE-WRITTEN.  9-03-91.                                             CL**1
00008  DATE-COMPILED.                                                      CL**1
00009                                                                      CL**1
00010 *****************************************************************    CL**1
00011 *    R125 - APPLICATION SYSTEM LIST                                  CL**1
00012 *                                                                    CL**1
00013 *    THIS PROGRAM GENERATES A LIST OF THE APPLICATION SYSTEMS        CL**1
00014 *    THE ME MERCHANDISE APPLICATION SYSTEMS TABLE (TAPLSYS).         CL**1
00015 *                                                                    CL**1
00016 *    THE OPERATOR MAY INVOKE THE APPLICATION SYSTEM ADD, DELETE,     CL**1
00017 *    OR UPDATE, SCREENS BY PRESSING THE APPROPRIATE PFKEY.           CL**1
00018 *    EXCEPT FOR THE ADD SCREEN, AT LEAST ONE LIST ITEM MUST BE       CL**1
00019 *    SELECTED TO PASS CONTROL.                                       CL**1
00020 *                                                                    CL**1
00021 *****************************************************************    CL**1
262978* CHANGED 10/22/2021    BY JIM HUNTER      WR: CHG0262978                 
262978* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE             
262978* MAKING THE CALL DYNAMIC VS STATIC.                                      
262978******************************************************************        
00022                                                                      CL**1
00023 *                                                                    CL**1
00024 *                                                                    CL**1
00025 *                                                                    CL**1
00026  ENVIRONMENT DIVISION.                                               CL**1
00027 *                                                                    CL**1
00028 *                                                                    CL**1
00029 *                                                                    CL**1
00030  DATA DIVISION.                                                      CL**1
00031 *                                                                    CL**1
00032 *                                                                    CL**1
00033  WORKING-STORAGE SECTION.                                            CL**1
00034 *                                                                    CL**1
00035  01  PC-PROGRAM-CONSTANTS.                                           CL**1
00036      05  PC-NAVIGATOR-TRAN-ID           PIC X(04)    VALUE 'Z008'.   CL**1
00037      05  PC-MAXIMUM-COMMAREA-LENGTH     PIC S9(04)   VALUE +4072     CL**1
00038                                                      COMP SYNC.      CL**1
00039      05  PC-CURRENT-MAP-NAME            PIC X(08)    VALUE           CL**1
00040      'MB125A  '.                                                     CL**1
00041      05  PC-CURRENT-MAPSET-NAME         PIC X(08)    VALUE           CL**1
00042      'MBKM125 '.                                                     CL**1
00043      05  PC-CURRENT-PROGRAM-NAME        PIC X(08)    VALUE           CL**1
00044      'MBKCS125'.                                                     CL**1
00045      05  PC-BEGINNING                   PIC X(01)    VALUE 'B'.      CL**1
00046      05  PC-ENDING                      PIC X(01)    VALUE 'E'.      CL**1
00047      05  PC-SELECTED                    PIC X(01)    VALUE 'S'.      CL**1
00048      05  PC-ITEMS-PER-PANEL             PIC S9(04)   VALUE +13       CL*18
00049                                                      COMP SYNC.      CL**1
00050      05  PC-ITEMS-PER-BLOCK             PIC S9(04)   VALUE +28       CL**1
00051                                                      COMP SYNC.      CL**1
00052      05  PC-MAX-ITEMS-TO-BE-READ        PIC S9(04)   VALUE +100      CL**1
00053                                                      COMP SYNC.      CL**1
00054      05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)   VALUE +2        CL**1
00055                                                      COMP SYNC.      CL**1
00056      05  PC-MAX-APLSYS-CODES            PIC S9(03)   VALUE +200      CL**1
00057                                                      COMP-3.         CL**1
00058      05  PC-MAX-ITEMS                   PIC S9(09)   VALUE           CL**1
00059                                                      +1000000        CL**1
00060                                                      COMP-3.         CL**1
00061      05  PC-BLOCK-LENGTH                PIC S9(04)   VALUE +1314     CL**1
00062                                                      COMP SYNC.      CL**1
00063      05  PC-FIELD-LENGTH                PIC S9(04)   VALUE +5        CL**1
00064                                                      COMP SYNC.      CL**1
00065      05  PC-ERASE-EOF-COMP              PIC S9(04)   VALUE +128      CL**1
00066                                                      COMP SYNC.      CL**1
00067      05  FILLER REDEFINES PC-ERASE-EOF-COMP.                         CL**1
00068          10  FILLER                     PIC X(01).                   CL**1
00069          10  PC-ERASE-EOF               PIC X(01).                   CL**1
00070      05  PC-MAX-RETRIES                 PIC S9(3)    VALUE 3         CL**1
00071                                                      COMP-3.         CL**1
00072      05  PC-COMPANY                     PIC X(2)     VALUE '03'.     CL**1
00073 *                                                                    CL**1
00074  01  PC-TSYMSG-NUMBERS.                                              CL**1
00075      05  PC-TSYMSG-00005                PIC 9(5)    VALUE 00005.     CL**1
00076      05  PC-TSYMSG-00008                PIC 9(5)    VALUE 00008.     CL**1
00077      05  PC-TSYMSG-00045                PIC 9(5)    VALUE 00045.     CL*12
00078      05  PC-TSYMSG-00050                PIC 9(5)    VALUE 00050.     CL*12
00079      05  PC-TSYMSG-00051                PIC 9(5)    VALUE 00051.     CL**1
00080      05  PC-TSYMSG-00052                PIC 9(5)    VALUE 00052.     CL**1
00081      05  PC-TSYMSG-00053                PIC 9(5)    VALUE 00053.     CL**1
00082      05  PC-TSYMSG-00054                PIC 9(5)    VALUE 00054.     CL**1
00083      05  PC-TSYMSG-00055                PIC 9(5)    VALUE 00055.     CL**1
00084      05  PC-TSYMSG-00057                PIC 9(5)    VALUE 00057.     CL**1
00085      05  PC-TSYMSG-00069                PIC 9(5)    VALUE 00069.     CL**1
00086      05  PC-TSYMSG-00070                PIC 9(5)    VALUE 00070.     CL**1
00087      05  PC-TSYMSG-00101                PIC 9(5)    VALUE 00101.     CL**9
00088      05  PC-TSYMSG-00207                PIC 9(5)    VALUE 00207.     CL*23
00089 *                                                                    CL**1
00090  01  PM-PROGRAM-MESSAGES.                                            CL**1
00091      05  PM-PROGRAM-MESSAGE-9           PIC X(78)    VALUE           CL**1
00092      'ERROR TRYING TO REWRITE  TEMP STORAGE QUEUE - RESP '.          CL**1
00093      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-9.                      CL**1
00094          10  FILLER                     PIC X(51).                   CL**1
00095          10  PM-RESP-9                  PIC Z(03)9-.                 CL**1
00096          10  FILLER                     PIC X(22).                   CL**1
00097      05  PM-PROGRAM-MESSAGE-10          PIC X(78)    VALUE           CL**1
00098      'ERROR TRYING TO WRITE TO TEMP STORAGE QUEUE - RESP '.          CL**1
00099      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-10.                     CL**1
00100          10  FILLER                     PIC X(51).                   CL**1
00101          10  PM-RESP-10                 PIC Z(03)9-.                 CL**1
00102          10  FILLER                     PIC X(22).                   CL**1
00103      05  PM-PROGRAM-MESSAGE-11          PIC X(78)    VALUE           CL**1
00104      'LOGIC ERROR IN TRYING TO WRITE TO TEMP STORAGE QUEUE - BLOCK   CL**1
00105 -    '     '.                                                        CL**1
00106      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-11.                     CL**1
00107          10  FILLER                     PIC X(61).                   CL**1
00108          10  PM-BLOCK-NUMBER            PIC Z(03)9-.                 CL**1
00109          10  FILLER                     PIC X(12).                   CL**1
00110      05  PM-PROGRAM-MESSAGE-12          PIC X(78)    VALUE           CL**1
00111      'INVALID NEXT APPLICATION ACTIVITY RECEIVED'.                   CL**1
00112      05  PM-PROGRAM-MESSAGE-23          PIC X(78)    VALUE           CL**1
00113      'ERROR TRYING TO DELETE TEMP STORAGE QUEUE - RESP '.            CL**1
00114      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-23.                     CL**1
00115          10  FILLER                     PIC X(49).                   CL**1
00116          10  PM-RESP-23                 PIC Z(03)9-.                 CL**1
00117          10  FILLER                     PIC X(24).                   CL**1
00118      05  PM-PROGRAM-MESSAGE-24          PIC X(78)    VALUE           CL**1
00119      'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE - RESP '.         CL**1
00120      05  FILLER REDEFINES PM-PROGRAM-MESSAGE-24.                     CL**1
00121          10  FILLER                     PIC X(52).                   CL**1
00122          10  PM-RESP-24                 PIC Z(03)9-.                 CL**1
00123          10  FILLER                     PIC X(21).                   CL**1
00124      05  PM-PROGRAM-MESSAGE-28          PIC X(78)    VALUE           CL**1
00125      'ERROR OCCURRED DURING TS QUEUE PROCESSING'.                    CL**1
00126 *                                                                    CL**1
00127  01  PS-PROGRAM-SUBSCRIPTS.                                          CL**1
00128      05  PS-SUB                         PIC S9(04)   VALUE +0        CL**1
00129                                                      COMP SYNC.      CL**1
00130      05  PS-AS-SUB1                     PIC S9(04)   VALUE +0        CL*12
00131                                                      COMP SYNC.      CL**1
00132      05  PS-AS-SUB2                     PIC S9(04)   VALUE +0        CL*12
00133                                                      COMP SYNC.      CL**1
00134      05  PS-ITEM-SUB                    PIC S9(09)   VALUE +0        CL**1
00135                                                      COMP-3.         CL**1
00136                                                                      CL**1
00137  01  PS-PROGRAM-SWITCHES.                                            CL**1
00138      05  PS-MAP-SEND-TYPE               PIC X(01)    VALUE '1'.      CL**1
00139          88  PS-SEND-MAP-N-DATA-FRSET                VALUE '1'.      CL**1
00140          88  PS-SEND-MAP-N-DATA-FRSET-CPOSN          VALUE '2'.      CL**1
00141          88  PS-SEND-DATA-ONLY-FRSET                 VALUE '3'.      CL**1
00142          88  PS-SEND-DATA-ONLY                       VALUE '4'.      CL**1
00143          88  PS-SEND-DATA-ONLY-ERASEAUP              VALUE '5'.      CL**1
00144          88  PS-SEND-MAP-ONLY-FRSET                  VALUE '6'.      CL**1
00145      05  PS-ERROR-SW                    PIC X(01)    VALUE 'N'.      CL**1
00146          88  PS-ERROR                                VALUE 'Y'.      CL**1
00147          88  PS-NO-ERROR                             VALUE 'N'.      CL**1
00148      05  PS-INTER-APPL-VALID-SW         PIC X(01)    VALUE 'N'.      CL**1
00149          88  PS-INTER-APPL-VALID                     VALUE 'Y'.      CL**1
00150          88  PS-INTER-APPL-NOT-VALID                 VALUE 'N'.      CL**1
00151      05  PS-SAME-ITEMS-DISPLAYED-SW     PIC X(01)    VALUE 'N'.      CL**1
00152          88  PS-SAME-ITEMS-DISPLAYED                 VALUE 'Y'.      CL**1
00153          88  PS-DIFFERENT-ITEMS-DISPLAYED            VALUE 'N'.      CL**1
00154      05  PS-CURSOR-POSITIONED-SW        PIC X(01)    VALUE 'N'.      CL**1
00155          88  PS-CURSOR-POSITIONED                    VALUE 'Y'.      CL**1
00156          88  PS-CURSOR-NOT-POSITIONED                VALUE 'N'.      CL**1
00157      05  PS-VALID-SELECTIONS-SW         PIC X(01)    VALUE 'Y'.      CL**1
00158          88  PS-VALID-SELECTIONS                     VALUE 'Y'.      CL**1
00159          88  PS-INVALID-SELECTIONS                   VALUE 'N'.      CL**1
00160      05  PS-VALID-BEG-ITEM-SW           PIC X(01)    VALUE 'N'.      CL**1
00161          88  PS-VALID-BEG-ITEM                       VALUE 'Y'.      CL**1
00162          88  PS-INVALID-BEG-ITEM                     VALUE 'N'.      CL**1
00163      05  PS-TOP-ITEM-IN-ARRAY-SW        PIC X(01)    VALUE 'N'.      CL**1
00164          88  PS-TOP-ITEM-IN-ARRAY                    VALUE 'Y'.      CL**1
00165          88  PS-TOP-ITEM-NOT-IN-ARRAY                VALUE 'N'.      CL**1
00166      05  PS-BOTTOM-ITEM-IN-ARRAY-SW     PIC X(01)    VALUE 'N'.      CL**1
00167          88  PS-BOTTOM-ITEM-IN-ARRAY                 VALUE 'Y'.      CL**1
00168          88  PS-BOTTOM-ITEM-NOT-IN-ARRAY             VALUE 'N'.      CL**1
00169      05  PS-TOP-ITEM-IN-TEMP-SW         PIC X(01)    VALUE 'N'.      CL**1
00170          88  PS-TOP-ITEM-IN-TEMP                     VALUE 'Y'.      CL**1
00171          88  PS-TOP-ITEM-NOT-IN-TEMP                 VALUE 'N'.      CL**1
00172      05  PS-BOTTOM-ITEM-IN-TEMP-SW      PIC X(01)    VALUE 'N'.      CL**1
00173          88  PS-BOTTOM-ITEM-IN-TEMP                  VALUE 'Y'.      CL**1
00174          88  PS-BOTTOM-ITEM-NOT-IN-TEMP              VALUE 'N'.      CL**1
00175      05  PS-LAST-BLOCK-IN-ARRAY-SW      PIC X(01)    VALUE 'N'.      CL**1
00176          88  PS-LAST-BLOCK-IN-ARRAY                  VALUE 'Y'.      CL**1
00177          88  PS-LAST-BLOCK-NOT-IN-ARRAY              VALUE 'N'.      CL**1
00178      05  PS-SELECTION-FOUND-SW          PIC X(01)    VALUE 'N'.      CL**1
00179          88  PS-SELECTION-FOUND                      VALUE 'Y'.      CL**1
00180          88  PS-NO-SELECTION-FOUND                   VALUE 'N'.      CL**1
00181      05  PS-WARNING-SW                  PIC X(01)    VALUE 'N'.      CL**1
00182          88  PS-WARNING                              VALUE 'Y'.      CL**1
00183          88  PS-NO-WARNING                           VALUE 'N'.      CL**1
00184      05  PS-INFORMATIONAL-SW            PIC X(01)    VALUE 'N'.      CL**1
00185          88  PS-INFORMATIONAL                        VALUE 'Y'.      CL**1
00186          88  PS-NOT-INFORMATIONAL                    VALUE 'N'.      CL**1
00187      05  PS-PROCESSING-SW               PIC X(01)    VALUE 'N'.      CL**1
00188          88  PS-CONTINUE                             VALUE 'Y'.      CL*16
00189          88  PS-DONT-PROCESS                         VALUE 'N'.      CL*16
00190      05  PS-PROCESS-ITEM-SW             PIC X(01)    VALUE 'N'.      CL*12
00191          88  PS-END-OF-ITEMS                         VALUE 'Y'.      CL*16
00192          88  PS-NOT-END                              VALUE 'N'.      CL*16
00193      EJECT                                                           CL**1
00194  01  PV-PROGRAM-VARIABLES.                                           CL**1
00195      05  PV-CICS-RESPONSE               PIC S9(04)   VALUE +0        CL**1
00196                                                      COMP SYNC.      CL**1
00197      05  PV-HIGHEST-ITEM-TO-BE-READ     PIC S9(09)   VALUE +0        CL**1
00198                                                      COMP-3.         CL**1
00199      05  PV-ENDING-ITEM-ON-PANEL        PIC S9(09)   VALUE +0        CL**1
00200                                                      COMP-3.         CL**1
00201      05  PV-ITEM-IN-USE                 PIC S9(09)   VALUE +0        CL**1
00202                                                      COMP-3.         CL**1
00203      05  PV-TOP-ITEM                    PIC S9(09)   VALUE +0        CL**1
00204                                                      COMP-3.         CL**1
00205      05  PV-BOTTOM-ITEM                 PIC S9(09)   VALUE +0        CL**1
00206                                                      COMP-3.         CL**1
00207      05  PV-MAX-ITEMS-TO-BE-READ        PIC S9(09)   VALUE +0        CL**1
00208                                                      COMP-3.         CL**1
00209      05  PV-FIRST-ITEM-IN-ARRAY         PIC S9(09)   VALUE +0        CL**1
00210                                                      COMP-3.         CL**1
00211      05  PV-LAST-ITEM-IN-ARRAY          PIC S9(09)   VALUE +0        CL**1
00212                                                      COMP-3.         CL**1
00213      05  PV-LAST-ITEM-IN-TEMP           PIC S9(09)   VALUE +0        CL**1
00214                                                      COMP-3.         CL**1
00215      05  PV-BEGINNING-ITEM              PIC S9(09)   VALUE +0        CL**1
00216                                                      COMP-3.         CL**1
00217      05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)   VALUE +0        CL**1
00218                                                      COMP-3.         CL**1
00219      05  PV-BLOCK-NUMBER                PIC S9(04)   VALUE +0        CL**1
00220                                                      COMP SYNC.      CL**1
00221      05  PV-RESP                        PIC S9(04)   VALUE +0        CL**1
00222                                                      COMP SYNC.      CL**1
00223      05  PV-ITEM                        PIC S9(04)   VALUE +0        CL**1
00224                                                      COMP SYNC.      CL**1
00225      05  PV-AS-ITEM                     PIC S9(04)   VALUE +0        CL*12
00226                                                      COMP SYNC.      CL**1
00227      05  PV-SAVE-ITEM                   PIC S9(04)   VALUE +0        CL*12
00228                                                      COMP SYNC.      CL*12
00229      05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)   VALUE +0        CL**1
00230                                                      COMP SYNC.      CL**1
00231      05  PV-LIST-ITEM-NUMBER            PIC S9(04)   VALUE +0        CL**1
00232                                                      COMP SYNC.      CL**1
00233      05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)   VALUE +0        CL**1
00234                                                      COMP SYNC.      CL**1
00235      05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**1
00236                                                      COMP SYNC.      CL**1
00237      05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)   VALUE +0        CL**1
00238                                                      COMP SYNC.      CL**1
00239      05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)   VALUE +0        CL**1
00240                                                      COMP SYNC.      CL**1
00241      05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)   VALUE +0        CL**1
00242                                                      COMP SYNC.      CL**1
00243      05  PV-START-OF-SELECTED-RANGE     PIC S9(04)   VALUE +0        CL**1
00244                                                      COMP SYNC.      CL**1
00245      05  PV-END-OF-SELECTED-RANGE       PIC S9(04)   VALUE +0        CL**1
00246                                                      COMP SYNC.      CL**1
00247      05  PV-ITEMS-READ                  PIC S9(04)   VALUE +0        CL**9
00248                                                      COMP SYNC.      CL**9
00249      05  PV-MESSAGE                     PIC X(78)    VALUE SPACES.   CL**1
00250      05  PV-SQL-SUB                     PIC S9(4)    COMP.           CL**1
00251      05  PV-RETRY-COUNTER               PIC S9(3)    COMP-3.         CL**1
00252      05  PV-BEGITMI.                                                 CL**1
00253          10  PV-BEGITMI-N               PIC 9(5).                    CL**1
00254      05  PV-DISPLAY5                    PIC ZZZZ9.                   CL**1
00255      05  PV-BG-QUEUE-NAME.                                           CL**1
00256          10  PV-BG-TERM-ID              PIC X(4).                    CL**1
00257          10  PV-BG-TASK-NUMBER          PIC S9(7)    COMP-3.         CL**1
00258 *                                                                    CL**1
00259  01  PV-TEMP-WORK-AREA.                                              CL**1
00260      05  PV-BLOCK-MODIFIED              PIC X.                       CL**1
00261      05  PV-TW-ITEM-ENTRIES OCCURS 28 TIMES                          CL**1
00262                             INDEXED BY PV-TW-IDX.                    CL**1
00263          10  PV-TW-LIST-ITEM-NUMBER     PIC S9(9)    COMP-3.         CL**1
00264          10  PV-TW-SELECTED-SW          PIC X.                       CL**1
00265              88  PV-TW-SELECT                        VALUE 'S'.      CL**1
00266              88  PV-TW-DESELECT                      VALUE ' '.      CL*12
00267          10  PV-TW-APLSYS-CODE          PIC XX.                      CL**1
00268          10  PV-TW-PRNT-APLSYS-CODE     PIC XX.                      CL**1
00269          10  PV-TW-MDSE-IND             PIC X.                       CL**1
00270          10  PV-TW-APLSYS-DESC          PIC X(25).                   CL**1
00271 *                                                                    CL**1
00272  EJECT                                                               CL**1
00273 *****************************************************************    CL**1
00274 *    STANDARD COMMAREA.                                              CL**1
00275 *****************************************************************    CL**1
00276                                                                      CL**1
00277      COPY DPWS020.                                                   CL*28
00278      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**1
00279                                                                      CL**1
00280 *****************************************************************    CL**1
00281 *    INTER-APPLICATION COMMAREA.                                     CL**1
00282 *****************************************************************    CL**1
00283                                                                      CL**1
00284          10  INTER-APPL-COMM-AREA       PIC X(200).                  CL**1
00285      COPY MBWS005.                                                   CL*28
00286 *****************************************************************    CL**1
00287 *    SPECIFIC COMMMAREA FOR MBKCS120.                                CL**1
00288 *****************************************************************    CL**1
00289          10  MB125-SPECIFIC-COMMAREA.                                CL**1
00290              15  MB125-APPL-CURSOR-POSITION          PIC S9(04)      CL**1
00291                                                      COMP.           CL**1
00292              15  MB125-BLOCK-ENTRIES OCCURS 2 TIMES.                 CL**1
00293                  20  MB125-BLOCK-MODIFIED-SW         PIC X(01).      CL**1
00294                      88  MB125-BLOCK-NOT-MODIFIED    VALUE 'N'.      CL**1
00295                      88  MB125-BLOCK-MODIFIED        VALUE 'Y'.      CL**1
00296                  20  MB125-ITEM-ARRAY.                               CL**1
00297                      25  MB125-ITEM-ENTRIES OCCURS 28 TIMES.         CL**1
00298                          30  MB125-LIST-ITEM-NUMBER                  CL**1
00299                                                      PIC S9(09)      CL**1
00300                                                          COMP-3.     CL**1
00301                          30  MB125-SELECTED-SW       PIC X(01).      CL**1
00302                              88  MB125-NO-SELECT     VALUE ' '.      CL**1
00303                              88  MB125-SELECT        VALUE 'S'.      CL**1
00304                              88  MB125-BEGIN         VALUE 'B'.      CL**1
00305                              88  MB125-END           VALUE 'E'.      CL**1
00306                          30  MB125-APLSYS-CODE       PIC XX.         CL**1
00307                          30  MB125-PRNT-APLSYS-CODE  PIC XX.         CL**1
00308                          30  MB125-MDSE-IND          PIC X.          CL**1
00309                          30  MB125-APLSYS-DESC       PIC X(25).      CL**1
00310 *                                                                    CL**1
00311              15  MB125-BLK-SUB                       PIC S9(04)      CL**1
00312                                                          COMP        CL**1
00313                                                          SYNC.       CL**1
00314              15  MB125-ITEM-SUB                      PIC S9(04)      CL**1
00315                                                          COMP        CL**1
00316                                                          SYNC.       CL**1
00317              15  MB125-NUMBER-OF-ITEMS-READ          PIC S9(09)      CL**1
00318                                                          COMP-3.     CL**1
00319              15  MB125-NUMBER-OF-SELECTED-ITEMS      PIC S9(09)      CL**1
00320                                                          COMP-3.     CL**1
00321              15  MB125-ITEM-AT-TOP-OF-PANEL          PIC S9(09)      CL**1
00322                                                          COMP-3.     CL**1
00323              15  MB125-ITEM-AT-BOT-OF-PANEL          PIC S9(09)      CL**1
00324                                                          COMP-3.     CL**1
00325              15  MB125-HIGHEST-BLOCK-WRITTEN         PIC S9(04)      CL**1
00326                                                          COMP        CL**1
00327                                                          SYNC.       CL**1
00328              15  MB125-START-OF-SELECTED-RANGE       PIC S9(09)      CL**1
00329                                                          COMP-3.     CL**1
00330              15  MB125-END-OF-SELECTED-RANGE         PIC S9(09)      CL**1
00331                                                          COMP-3.     CL**1
00332              15  MB125-ITEMS-LEFT-INDICATOR          PIC X.          CL**1
00333                  88  MB125-ITEMS-LEFT-ON-DB            VALUE 'Y'.    CL**1
00334                  88  MB125-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.    CL**1
00335              15  MB125-TEMP-QUEUE-UPDATE-SW          PIC X.          CL*12
00336                  88  MB125-UPDATE-TSQ                  VALUE 'Y'.    CL*16
00337                  88  MB125-DONT-UPDATE-TSQ             VALUE 'N'.    CL*16
00338              15  MB125-TEMP-QUEUE-NAME.                              CL**1
00339                  20  MB125-TERM-ID                   PIC X(4).       CL**1
00340                  20  MB125-TASK-NUMBER               PIC S9(7)       CL**1
00341                                                          COMP-3.     CL**1
00342              15  MB125-LAST-APLSYS-CODE              PIC X(3).       CL**1
00343              15  MB125-LIST-QUEUE-NAME               PIC X(8).       CL**1
00344              15  MB125-SAVE-INTER-APPL-COMMAREA      PIC X(200).     CL**1
00345 *                                                                    CL**1
00346      EJECT                                                           CL**1
00347 *****************************************************************    CL**1
00348 *    APPLICATION SYSTEM TS QUEUE RECORD LAYOUT.                      CL**1
00349 *****************************************************************    CL**1
00350  01 APLSYS-LIST-RECORD.                                              CL**3
00351      COPY MBWS125.                                                   CL*28
00352                                                                      CL**1
00353 *                                                                    CL**1
00354      EJECT                                                           CL**1
00355 *****************************************************************    CL**1
00356 *    ABEND PROCESSING COPYBOOK.                                      CL**1
00357 *****************************************************************    CL**1
00358                                                                      CL**1
00359      COPY DPWS013.                                                   CL**1
00360                                                                      CL**1
00361      EJECT                                                           CL**1
00362 *****************************************************************    CL**1
00363 *    ATTRIBUTE SETTINGS COPYBOOK.                                    CL**1
00364 *****************************************************************    CL**1
00365                                                                      CL**1
00366      COPY DPWS015.                                                   CL**1
00367                                                                      CL**1
00368 *****************************************************************    CL**1
00369 *    CURRENT DATE AND TIME COPYBOOK.                                 CL**1
00370 *****************************************************************    CL**1
00371                                                                      CL**1
00372      COPY DPWS017.                                                   CL**1
00373                                                                      CL**1
00374 *****************************************************************    CL**1
00375 *    TOGGLE FUNCTION KEY LINES COPYBOOK.                             CL**1
00376 *****************************************************************    CL**1
00377                                                                      CL**1
00378      COPY DPWS009.                                                   CL**1
                                                                        MBKCS101
      *****************************************************************         
      *    SYSTEM MESSAGE FIELDS                                                
      *****************************************************************         
                                                                                
           COPY DPWS006.                                                        
                                                                                
00380 *****************************************************************    CL**1
00381 *    FUNCTION KEYS COPYBOOK.                                         CL**1
00382 *****************************************************************    CL**1
00383                                                                      CL**1
00384      COPY DPWS016.                                                   CL**1
00385                                                                      CL**1
00386 *****************************************************************    CL**1
00387 *    DPKUT045 COPYBOOK.                                              CL**1
00388 *****************************************************************    CL**1
00389                                                                      CL**1
00390      COPY DPWS045.                                                   CL**1
00391                                                                      CL**1
00392 *****************************************************************    CL**1
00393 *    NUMERIC EDIT LAYOUT.                                            CL**1
00394 *****************************************************************    CL**1
00395                                                                      CL**1
00396      COPY DPWS010I.                                                  CL**1
00397                                                                      CL**1
00398 *****************************************************************    CL**1
00399 *    MESSAGE RECORD LAYOUT                                           CL**1
00400 *****************************************************************    CL**1
00401                                                                      CL**1
00402      COPY DPRD507I.                                                  CL**1
00403                                                                      CL**1
00404 *****************************************************************    CL**1
00405 *    STANDARD ATTENTION IDENTIFIER LIST                              CL**1
00406 *****************************************************************    CL**1
00407                                                                      CL**1
00408      COPY DFHAID.                                                    CL**1
00409                                                                      CL**1
00410 *****************************************************************    CL**1
00411 *    STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST           CL**1
00412 *****************************************************************    CL**1
00413                                                                      CL**1
00414      COPY DFHBMSCA.                                                  CL**1
00415                                                                      CL**1
00416 *****************************************************************    CL**1
00417 *    MAP LAYOUT                                                      CL**1
00418 *****************************************************************    CL**1
00419                                                                      CL**1
00420      COPY MBKM125.                                                   CL**1
00421  01  MD-MAP-DATA-AREA  REDEFINES MB125AO PIC X(1350).                CL*18
00422 *                                                                    CL**1
00423  01  MBKM125-OCCURS-LAYOUT  REDEFINES  MD-MAP-DATA-AREA.             CL**1
00424      05  FILLER                PIC X(134).                           CL**1
00425      05  MBKM125-SCROLL-AREA OCCURS 13 TIMES.                        CL*18
00426          10  MBKM125-SELECTL   PIC S9(4) COMP.                       CL**1
00427          10  MBKM125-SELECTA   PIC X.                                CL**1
00428          10  MBKM125-SELECTC   PIC X.                                CL**1
00429          10  MBKM125-SELECTH   PIC X.                                CL**1
00430          10  MBKM125-SELECTI   PIC X.                                CL**1
00431 *                                                                    CL**1
00432          10  FILLER            PIC X(5).                             CL**1
00433          10  MBKM125-APLSYS-CODE                                     CL**1
00434                                PIC XX.                               CL**1
00435 *                                                                    CL**1
00436          10  FILLER            PIC X(5).                             CL**1
00437          10  MBKM125-APLSYS-DESC                                     CL**1
00438                                PIC X(25).                            CL**1
00439 *                                                                    CL*19
00440          10  FILLER            PIC X(5).                             CL*19
00441          10  MBKM125-PRNT-APLSYS-CODE                                CL*19
00442                                PIC XX.                               CL*19
00443 *                                                                    CL**4
00444          10  FILLER            PIC X(5).                             CL**4
00445          10  MBKM125-MDSE-IND  PIC X.                                CL**4
00446  EJECT                                                               CL**1
00447 *                                                                    CL**1
00448 *    DB2 AREA FOR TAPLSYS                                            CL**1
00449 *                                                                    CL**1
00450      EXEC SQL                                                        CL**1
00451           INCLUDE TAPLSYS                                            CL**1
00452      END-EXEC.                                                       CL**1
00453 *                                                                    CL**1
00454 *    DB2 AREA FOR COMMUNICATIONS                                     CL**1
00455 *                                                                    CL**1
00456      EXEC SQL                                                        CL**1
00457           INCLUDE SQLCA                                              CL**1
00458      END-EXEC.                                                       CL**1
00459 *                                                                    CL**1
00460 *    CURSOR DECLARE FOR TAPLSYS                                      CL**1
00461 *                                                                    CL**1
00462      EXEC SQL                                                        CL**1
00463           DECLARE APLSYS-LIST CURSOR                                 CL**1
00464           FOR SELECT                                                 CL**1
00465               APLSYS_CDE,                                            CL**1
00466               PRNT_APLSYS_CDE,                                       CL**1
00467               MDSE_IND,                                              CL**1
00468               APLSYS_DESC                                            CL**1
00469           FROM TAPLSYS                                               CL**1
00470               WHERE OPERCO_NBR      =  :PC-COMPANY                   CL**5
00471                 AND APLSYS_CDE      >  :APLSYS-CDE                   CL**5
00472           ORDER BY  APLSYS_CDE                                       CL**1
00473      END-EXEC.                                                       CL**1
00474 *                                                                    CL**1
00475  EJECT                                                               CL**1
00476  LINKAGE SECTION.                                                    CL**1
00477                                                                      CL**1
00478  01  DFHCOMMAREA.                                                    CL**1
00479      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**1
00480                                         DEPENDING ON EIBCALEN.       CL**1
00481          10  FILLER                     PIC X.                       CL**1
00482                                                                      CL**1
00483 *                                                                    CL**1
00484 *                                                                    CL**1
00485 *                                                                    CL**1
00486  PROCEDURE DIVISION.                                                 CL**1
00487                                                                      CL**1
00488                                                                      CL**1
00489  A100-MAIN-MODULE.                                                   CL**1
00490                                                                      CL**1
00491 ******************************************************************   CL**1
00492 *    PROCESS THIS TRANSACTION IF THE COMMAREA IS VALID.              CL**1
00493 ******************************************************************   CL**1
00494                                                                      CL**1
00495      PERFORM DP015-0000-CHECK-COMMAREA.                              CL**1
00496                                                                      CL**1
00497      IF DP020-SRC-RETURN-W-TRAN-ID                                   CL**1
00498          PERFORM B100-CONTROL-PROCESSING                             CL**1
00499      END-IF.                                                         CL**1
00500                                                                      CL**1
00501      PERFORM DP003-0000-RETURN-TO-CICS.                              CL**1
00502  EJECT                                                               CL**1
00503 ******************************************************************   CL**1
00504 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT       CL**1
00505 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                       CL**1
00506 *                                                                    CL**1
00507 *    PERFORMED BY A100-MAIN-MODULE.                                  CL**1
00508 ******************************************************************   CL**1
00509 *                                                                    CL**1
00510  B100-CONTROL-PROCESSING.                                            CL**1
00511 *                                                                    CL**1
00512      SET PS-CONTINUE           TO  TRUE.                             CL*16
00513      MOVE LENGTH OF MB125-BLOCK-ENTRIES (1)                          CL**1
00514                                TO  PC-BLOCK-LENGTH.                  CL**1
00515      EVALUATE TRUE                                                   CL**1
00516          WHEN DP020-NEXT-ACT-INITIAL                                 CL**1
00517              INITIALIZE MB125-SPECIFIC-COMMAREA                      CL**1
00518              SET PS-CONTINUE                                         CL*16
00519                                TO  TRUE                              CL**1
00520              SET PS-SEND-MAP-N-DATA-FRSET                            CL**1
00521                                TO  TRUE                              CL**1
00522              SET DP020-NEXT-ACT-READ-MAP                             CL**1
00523                                TO  TRUE                              CL**1
00524              PERFORM D100-SETUP-INIT-PANEL                           CL**1
00525 *                                                                    CL**1
00526          WHEN DP020-NEXT-ACT-READ-MAP                                CL**1
00527              PERFORM C300-PROCESS-PANEL                              CL**1
00528 *                                                                    CL**1
00529          WHEN DP020-NEXT-ACT-RETURN                                  CL**1
00530              SET PS-SEND-MAP-N-DATA-FRSET                            CL**1
00531                                TO  TRUE                              CL**1
00532              PERFORM C400-REFRESH-PANEL-FROM-TEMP                    CL**1
00533 *                                                                    CL**1
00534          WHEN DP020-NEXT-ACT-ERROR                                   CL**1
00535              MOVE DP020-MSG-MESSAGE TO PV-MESSAGE                    CL**1
00536              IF DP020-NAV-MNEMONIC = SPACES                          CL**1
00537                  MOVE SPACES   TO  ANAVCMDO                          CL**1
00538                  MOVE DP015-UNDERLINE                                CL**1
00539                                TO  ANAVCMDH                          CL**1
00540                  MOVE DP015-GREEN                                    CL**1
00541                                TO  ANAVCMDC                          CL**1
00542              ELSE                                                    CL**1
00543                  MOVE DP015-REVERSE                                  CL**1
00544                                TO  ANAVCMDH                          CL**1
00545                  MOVE DP015-RED                                      CL**1
00546                                TO  ANAVCMDC                          CL**1
00547              END-IF                                                  CL**1
00548 *                                                                    CL**1
00549              PERFORM E100-EDIT-SELECTIONS                            CL**1
00550              MOVE -1           TO  ANAVCMDL                          CL**1
00551              MOVE PV-MESSAGE   TO  DP020-MSG-MESSAGE                 CL**1
00552                                                                      CL**1
00553              SET DP020-MSG-FATAL                                     CL**1
00554                                TO  TRUE                              CL**1
00555              SET PS-SEND-DATA-ONLY-FRSET                             CL**1
00556                                TO  TRUE                              CL**1
00557              SET PS-SAME-ITEMS-DISPLAYED                             CL**1
00558                                TO  TRUE                              CL**1
00559              SET PS-CURSOR-POSITIONED                                CL**1
00560                                TO  TRUE                              CL**1
00561              PERFORM G100-DISPLAY-PANEL                              CL**1
00562 *                                                                    CL**1
00563          WHEN OTHER                                                  CL**1
00564              SET DP013-LOGIC-ABEND TO TRUE                           CL**1
00565              SET DP013-NO-ROLLBACK TO TRUE                           CL**1
00566              MOVE 'B100-CONTROL-PROCESSING'                          CL**1
00567                                TO  DP013-PARAGRAPH                   CL**1
00568              MOVE PM-PROGRAM-MESSAGE-12                              CL**1
00569                                TO  DP013-MESSAGE-TEXT(1)             CL**1
00570              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
00571      END-EVALUATE.                                                   CL**1
00572 *                                                                    CL**1
00573  EJECT                                                               CL**1
00574 ******************************************************************   CL**1
00575 *    RECEIVE THE MAP AND PERFORM THE APPROPRIATE PARAGRAPH BASED     CL**1
00576 *    ON WHAT FUNCTION KEY WAS SELECTED.                              CL**1
00577 *                                                                    CL**1
00578 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00579 ******************************************************************   CL**1
00580 *                                                                    CL**1
00581  C300-PROCESS-PANEL.                                                 CL**1
00582 *                                                                    CL**1
00583      PERFORM DP007-0000-GET-PANEL.                                   CL**1
00584      SET PS-SEND-DATA-ONLY-FRSET                                     CL**1
00585                                TO TRUE.                              CL**1
00586      EVALUATE TRUE                                                   CL**1
00587 *                                                                    CL**1
00588          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**1
00589              SET PS-SEND-MAP-N-DATA-FRSET TO TRUE                    CL**1
00590              SET PS-SAME-ITEMS-DISPLAYED  TO TRUE                    CL**1
00591              PERFORM E100-EDIT-SELECTIONS                            CL**1
00592              PERFORM G100-DISPLAY-PANEL                              CL**1
00593 *                                                                    CL**1
00594          WHEN DP020-SRC-AID = DP016-PF5                              CL**1
00595              MOVE SPACES       TO  ANAVCMDO                          CL*26
00596                                    ANAVKEYO                          CL*26
00597              PERFORM Z050-DELETE-TEMP-STORAGE                        CL**1
00598              PERFORM D100-SETUP-INIT-PANEL                           CL**1
00599 *                                                                    CL**1
00600          WHEN DP020-SRC-AID = DP016-PA2                              CL**1
00601              PERFORM DP009-0000-LOAD-FK-LINES                        CL**1
00602              PERFORM DP017-0000-GET-CURR-DATE-TIME                   CL**1
00603              SET PS-SEND-DATA-ONLY                                   CL**1
00604                                TO  TRUE                              CL**1
00605              MOVE -1           TO  ANAVCMDL                          CL**1
00606              PERFORM DP008-0000-WRITE-PANEL                          CL**1
00607 *                                                                    CL**1
00608          WHEN OTHER                                                  CL**1
00609              PERFORM D200-RECORD-SELECTIONS                          CL**1
00610              IF PS-VALID-SELECTIONS                                  CL**1
00611                  PERFORM D300-CHECK-FUNCTION-KEY                     CL**1
00612              ELSE                                                    CL**1
00613                  SET PS-SAME-ITEMS-DISPLAYED TO TRUE                 CL**1
00614                  PERFORM G100-DISPLAY-PANEL                          CL**1
00615              END-IF                                                  CL**1
00616      END-EVALUATE.                                                   CL**1
00617 *                                                                    CL**1
00618  EJECT                                                               CL**1
00619 ******************************************************************   CL**1
00620 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**1
00621 *    SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.          CL**1
00622 *    EDIT THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL     CL**1
00623 *    TO THE USER.  ALSO, RESTORE THE REQUESTED UPC AND SKU NBRS.     CL**1
00624 *                                                                    CL**1
00625 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00626 ******************************************************************   CL**1
00627 *                                                                    CL**1
00628  C400-REFRESH-PANEL-FROM-TEMP.                                       CL**1
00629 *                                                                    CL**1
00630      IF (MB125-DONT-UPDATE-TSQ                                       CL*27
00631      OR  MB005-LIST-QUEUE-NAME EQUAL SPACES)                         CL*27
00632          MOVE MB125-SAVE-INTER-APPL-COMMAREA                         CL*12
00633                                TO  MB005-INTER-APPL-COMMAREA         CL*12
00634      ELSE                                                            CL*12
00635          MOVE ZERO             TO  PV-SAVE-ITEM                      CL*12
00636                                    PV-AS-ITEM                        CL*12
00637          SET PS-NOT-END        TO  TRUE                              CL*16
00638          PERFORM C500-UPDATE-TSQ                                     CL*12
00639                  UNTIL PS-END-OF-ITEMS                               CL*16
00640          PERFORM X900-DELETE-LIST-QUEUE                              CL*24
00641          MOVE SPACES           TO  MB005-LIST-QUEUE-NAME             CL*24
00642      END-IF.                                                         CL*12
00643 *                                                                    CL*12
00644      PERFORM D400-REFRESH-BLOCK-ARRAY.                               CL**1
00645      PERFORM E100-EDIT-SELECTIONS.                                   CL**1
00646 *                                                                    CL**1
00647      SET PS-DIFFERENT-ITEMS-DISPLAYED TO TRUE.                       CL**1
00648      MOVE MB125-LIST-QUEUE-NAME                                      CL**1
00649                                TO  MB005-LIST-QUEUE-NAME.            CL**1
00650 *                                                                    CL**1
00651      PERFORM G100-DISPLAY-PANEL.                                     CL**1
00652 *                                                                    CL*12
00653  EJECT                                                               CL*12
00654 *                                                                    CL*12
00655 ******************************************************************   CL*12
00656 *    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.          CL*12
00657 *    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER      CL*12
00658 *    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN        CL*12
00659 *    THE TEMP QUEUE.                                                 CL*12
00660 *                                                                    CL*12
00661 *    PERFORMED BY C400                                               CL*12
00662 ******************************************************************   CL*12
00663 *                                                                    CL*12
00664  C500-UPDATE-TSQ.                                                    CL*12
00665 *                                                                    CL*12
00666      ADD 1                     TO  PV-AS-ITEM.                       CL*13
00667      PERFORM X600-READ-LIST-QUEUE.                                   CL*12
00668      IF  PV-RESP EQUAL DFHRESP(NORMAL)                               CL*12
00669          SET MBWS125-IDX       TO  1                                 CL*12
00670          PERFORM C600-PROCESS-ITEMS                                  CL*12
00671              UNTIL MBWS125-APLSYS-CODE (MBWS125-IDX) EQUAL SPACE     CL*12
00672              OR MBWS125-IDX GREATER THAN MBWS125-MAX-APLSYS-CODES    CL*12
00673          PERFORM X550-WRITE-TS-QUEUE                                 CL*12
00674      ELSE                                                            CL*12
00675          SET PS-END-OF-ITEMS   TO  TRUE                              CL*17
00676      END-IF.                                                         CL*17
00677 *                                                                    CL*12
00678  EJECT                                                               CL*12
00679 *                                                                    CL*12
00680 ******************************************************************   CL*12
00681 *    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.    CL*12
00682 *    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE    CL*12
00683 *    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.               CL*12
00684 *                                                                    CL*12
00685 *    PERFORMED BY C500                                               CL*12
00686 ******************************************************************   CL*12
00687 *                                                                    CL*12
00688  C600-PROCESS-ITEMS.                                                 CL*12
00689 *                                                                    CL*12
00690      COMPUTE PV-ITEM = 1 + ((MBWS125-ITEM (MBWS125-IDX) - 1)         CL*12
00691                      / PC-ITEMS-PER-BLOCK).                          CL*12
00692 *                                                                    CL*12
00693      IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                              CL*12
00694          IF  PV-SAVE-ITEM NOT EQUAL ZERO                             CL*12
00695              PERFORM X550-WRITE-TS-QUEUE                             CL*12
00696          END-IF                                                      CL*12
00697          MOVE PV-ITEM          TO  PV-SAVE-ITEM                      CL*12
00698 *                                                                    CL*12
00699          PERFORM X300-READ-TS-QUEUE                                  CL*15
00700          IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                       CL*12
00701              SET PS-END-OF-ITEMS TO TRUE                             CL*16
00702          END-IF                                                      CL*12
00703      END-IF.                                                         CL*12
00704 *                                                                    CL*12
00705      IF  PS-NOT-END                                                  CL*16
00706          COMPUTE PS-SUB = (MBWS125-ITEM (MBWS125-IDX)                CL*12
00707                         - PV-TW-LIST-ITEM-NUMBER (1)) + 1            CL*12
00708          SET PV-TW-DESELECT (PS-SUB)                                 CL*12
00709                                TO  TRUE                              CL*12
00710          SUBTRACT 1          FROM  MB005-NUMBER-PROCESSED-ITEMS      CL*12
00711                                    MB125-NUMBER-OF-SELECTED-ITEMS    CL*12
00712          IF  MB005-NUMBER-PROCESSED-ITEMS EQUAL ZERO                 CL*12
00713              SET PS-END-OF-ITEMS TO TRUE                             CL*16
00714              SET MBWS125-IDX   TO  MBWS125-MAX-APLSYS-CODES          CL*12
00715          END-IF                                                      CL*12
00716          SET MBWS125-IDX    UP BY  1                                 CL*12
00717      END-IF.                                                         CL*12
00718 *                                                                    CL*12
00719  EJECT                                                               CL**1
00720 *                                                                    CL**1
00721 ******************************************************************   CL**1
00722 *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                            CL**1
00723 *    INITIALIZE ALL COUNTERS AND FLAGS.                              CL**1
00724 *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.      CL**1
00725 *    DISPLAY THE PANEL TO USER.                                      CL**1
00726 *                                                                    CL**1
00727 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00728 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00729 ******************************************************************   CL**1
00730 *                                                                    CL**1
00731  D100-SETUP-INIT-PANEL.                                              CL**1
00732 *                                                                    CL**1
00733      INITIALIZE                  MB125-BLOCK-ENTRIES (1).            CL**1
00734      INITIALIZE                  MB125-BLOCK-ENTRIES (2).            CL**1
00735      MOVE SPACES             TO  MB125-LIST-QUEUE-NAME.              CL**1
00736      MOVE +1                 TO  MB125-BLK-SUB.                      CL**1
00737      MOVE PC-ITEMS-PER-PANEL TO  PV-HIGHEST-ITEM-TO-BE-READ.         CL**1
00738      SET MB125-ITEMS-LEFT-ON-DB                                      CL**1
00739                              TO  TRUE.                               CL**1
00740 *                                                                    CL**1
00741      MOVE +0                 TO  MB125-ITEM-SUB                      CL**1
00742                                  MB125-NUMBER-OF-ITEMS-READ          CL**1
00743                                  MB125-NUMBER-OF-SELECTED-ITEMS      CL**1
00744                                  MB125-HIGHEST-BLOCK-WRITTEN         CL**1
00745                                  MB125-START-OF-SELECTED-RANGE       CL**1
00746                                  MB125-END-OF-SELECTED-RANGE.        CL**1
00747 *                                                                    CL**1
00748      MOVE SPACES             TO  MB125-LAST-APLSYS-CODE.             CL**1
00749      PERFORM L100-OPEN-CURSOR.                                       CL**1
00750 *                                                                    CL**1
00751      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**1
00752      SET PS-DIFFERENT-ITEMS-DISPLAYED                                CL**1
00753                              TO  TRUE.                               CL**1
00754 *                                                                    CL**1
00755      MOVE +1                 TO  MB125-ITEM-AT-TOP-OF-PANEL.         CL**1
00756 *                                                                    CL**1
00757      PERFORM G100-DISPLAY-PANEL.                                     CL**1
00758 *                                                                    CL**1
00759  EJECT                                                               CL**1
00760 ******************************************************************   CL**1
00761 *    IF THE USER HIT THE DESELECT KEY, OR A KEY WHICH INVOLVES       CL**1
00762 *    LEAVING THIS TRANSACTION AND GOING TO ANOTHER, SET A FLAG       CL**1
00763 *    INDICATING THAT ALL SELECTIONS ARE VALID.  IF ANY OTHER KEY     CL**1
00764 *    IS HIT, MOVE THE SELECTIONS MADE TO THE COMMAREA, AND EDIT      CL**1
00765 *    THOSE SELECTIONS.                                               CL**1
00766 *                                                                    CL**1
00767 *    IF THE USER ENTERED SOMETHING IN THE COMMAND LINE OR HIT        CL**1
00768 *    AN INVALID FUNCTION KEY, DO NOT EDIT THE SELECTIONS.            CL**1
00769 *                                                                    CL**1
00770 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00771 ******************************************************************   CL**1
00772 *                                                                    CL**1
00773  D200-RECORD-SELECTIONS.                                             CL**1
00774 *                                                                    CL**1
00775      IF (DP020-FK-DESELECT(DP020-SRC-AID))   OR                      CL**1
00776         (DP020-FK-SELECT-ALL(DP020-SRC-AID)) OR                      CL**1
00777         (DP020-FK-GO-TO-TRAN(DP020-SRC-AID)) OR                      CL**1
00778         (DP020-FK-RETURN(DP020-SRC-AID))                             CL**1
00779          SET PS-VALID-SELECTIONS TO TRUE                             CL**1
00780      ELSE                                                            CL**1
00781 *                                                                    CL**1
00782          PERFORM E200-MOVE-SELECTS-TO-COMMAREA                       CL**1
00783          IF (DP020-SRC-AID          = DP016-ENTER) AND               CL**1
00784             (DP020-NAV-MNEMONIC NOT = SPACES)      AND               CL**1
00785             (DP020-NAV-MNEMONIC NOT = LOW-VALUES)                    CL**1
00786              SET PS-VALID-SELECTIONS TO TRUE                         CL**1
00787          ELSE                                                        CL**1
00788 *                                                                    CL**1
00789 *            IF (DP020-FK-FIRST-PAGE(DP020-SRC-AID)) OR              CL*22
00790 *               (DP020-FK-PREV-PAGE(DP020-SRC-AID))  OR              CL*22
00791 *               (DP020-FK-NEXT-PAGE(DP020-SRC-AID))  OR              CL*22
00792 *               (DP020-FK-EDIT-GOTO(DP020-SRC-AID))  OR              CL*22
00793 *               (DP020-SRC-AID = DP016-ENTER)                        CL*22
00794                  PERFORM E100-EDIT-SELECTIONS                        CL**1
00795 *            ELSE                                                    CL*22
00796 *                SET PS-VALID-SELECTIONS TO TRUE                     CL*26
00797 *            END-IF                                                  CL*22
00798          END-IF                                                      CL**1
00799      END-IF.                                                         CL**1
00800  EJECT                                                               CL**1
00801 ******************************************************************   CL**1
00802 *    PERFORM THE APPROPRIATE PARAGRAPH BASED ON WHICH FUNCTION       CL**1
00803 *    KEY HAD BEEN SELECTED BY THE USER.                              CL**1
00804 *                                                                    CL**1
00805 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00806 ******************************************************************   CL**1
00807 *                                                                    CL**1
00808  D300-CHECK-FUNCTION-KEY.                                            CL**1
00809 *                                                                    CL**1
00810      EVALUATE TRUE                                                   CL**1
00811 *                                                                    CL**1
00812          WHEN DP020-FK-GO-TO-TRAN(DP020-SRC-AID)                     CL**1
00813               PERFORM E300-NAVIGATE                                  CL**1
00814 *                                                                    CL**1
00815 *    FOR THE ADD FUNCTION (PF13) NO SELECTED ITEMS REQUIRED.         CL**1
00816 *                                                                    CL**1
00817          WHEN DP020-FK-EDIT-GOTO(DP020-SRC-AID)                      CL**1
00818            IF PS-CONTINUE                                            CL*16
00819               IF  DP020-SRC-AID = DP016-PF13                         CL**1
00820                   MOVE SPACES  TO  MB005-LIST-QUEUE-NAME             CL**1
00821                   PERFORM E300-NAVIGATE                              CL**1
00822               ELSE                                                   CL**1
00823                   IF  MB125-NUMBER-OF-SELECTED-ITEMS > ZERO          CL**1
00824                       SET PS-CONTINUE                                CL*16
00825                                TO  TRUE                              CL**1
00826                       PERFORM X100-PREPARE-LIST-QUEUE                CL**1
00827                       IF  PS-CONTINUE                                CL*16
00828                           PERFORM E300-NAVIGATE                      CL**1
00829                       ELSE                                           CL**1
00830 *                                                                    CL**1
00831                           SET DP013-LOGIC-ABEND TO TRUE              CL**1
00832                           SET DP013-NO-ROLLBACK TO TRUE              CL**1
00833                           MOVE 'D300-CHECK-FUNCTION-KEY'             CL**1
00834                                TO  DP013-PARAGRAPH                   CL**1
00835                           MOVE PM-PROGRAM-MESSAGE-28                 CL**1
00836                                TO  DP013-MESSAGE-TEXT(1)             CL**1
00837                           PERFORM DP013-0000-PROCESS-ABEND           CL**1
00838                       END-IF                                         CL**1
00839                   ELSE                                               CL**1
00840 *                                                                    CL**1
00841                       MOVE PC-TSYMSG-00057                           CL**1
00842                                TO  DP020-MSG-NUMBER                  CL**1
00843                       SET DP020-MSG-WARNING                          CL**1
00844                                TO TRUE                               CL**1
00845                       PERFORM G100-DISPLAY-PANEL                     CL**1
00846                   END-IF                                             CL**1
00847               END-IF                                                 CL**1
00848            ELSE                                                      CL*14
00849               PERFORM G100-DISPLAY-PANEL                             CL*14
00850            END-IF                                                    CL*14
00851 *                                                                    CL**1
00852          WHEN DP020-FK-RETURN(DP020-SRC-AID)                         CL**1
00853               PERFORM X900-DELETE-LIST-QUEUE                         CL**1
00854               PERFORM E300-NAVIGATE                                  CL**1
00855 *                                                                    CL**1
00856          WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                     CL**1
00857               PERFORM E400-DISPLAY-TOP-OF-LIST                       CL**1
00858 *                                                                    CL**1
00859          WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                      CL**1
00860               PERFORM E500-BROWSE-BACKWARD                           CL**1
00861 *                                                                    CL**1
00862          WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                      CL**1
00863               PERFORM E600-BROWSE-FORWARD                            CL**1
00864 *                                                                    CL**1
00865          WHEN DP020-FK-DESELECT(DP020-SRC-AID)                       CL**1
00866               PERFORM E700-DESELECT-ALL-ITEMS                        CL**1
00867 *                                                                    CL**1
00868          WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                     CL**1
00869               PERFORM E900-SELECT-ALL-ITEMS                          CL**1
00870 *                                                                    CL**1
00871          WHEN DP020-SRC-AID = DP016-ENTER                            CL**1
00872              IF (DP020-NAV-MNEMONIC = LOW-VALUES) OR                 CL**1
00873                 (DP020-NAV-MNEMONIC = SPACES)                        CL**1
00874                  PERFORM E800-CHECK-FOR-JUMP-BROWSE                  CL**1
00875              ELSE                                                    CL**1
00876                  PERFORM E300-NAVIGATE                               CL**1
00877              END-IF                                                  CL**1
00878 *                                                                    CL**1
00879          WHEN OTHER                                                  CL**1
00880              MOVE PC-TSYMSG-00045                                    CL*12
00881                                TO  DP020-MSG-NUMBER                  CL*12
00882              SET DP020-MSG-FATAL                                     CL*12
00883                                TO  TRUE                              CL*12
00884              PERFORM G100-DISPLAY-PANEL                              CL*12
00885 *                                                                    CL**1
00886      END-EVALUATE.                                                   CL**1
00887  EJECT                                                               CL**1
00888 ******************************************************************   CL**1
00889 *    WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,    CL**1
00890 *    READ TEMPORARY STORAGE FILLING IN BOTH BLOCKS IN THE ARRAY      CL**1
00891 *    WITH THE ITEMS THAT WERE AT THE TOP OF THE LIST WHEN WE         CL**1
00892 *    HAD LEFT PREVIOUSLY.                                            CL**1
00893 *                                                                    CL**1
00894 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
00895 ******************************************************************   CL**1
00896 *                                                                    CL**1
00897  D400-REFRESH-BLOCK-ARRAY.                                           CL**1
00898 *                                                                    CL**1
00899      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
00900          1 + ((MB125-LIST-ITEM-NUMBER(1 1) - 1) /                    CL**1
00901                PC-ITEMS-PER-BLOCK).                                  CL**1
00902                                                                      CL**1
00903      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**1
00904      MOVE +1                   TO MB125-BLK-SUB.                     CL**1
00905                                                                      CL**1
00906      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
00907                                                                      CL**1
00908      ADD +1 TO PV-BLOCK-NUMBER.                                      CL**1
00909                                                                      CL**1
00910      IF (PV-BLOCK-NUMBER < MB125-HIGHEST-BLOCK-WRITTEN) OR           CL**1
00911         (PV-BLOCK-NUMBER = MB125-HIGHEST-BLOCK-WRITTEN)              CL**1
00912          ADD +1 TO MB125-BLK-SUB                                     CL**1
00913                                                                      CL**1
00914          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
00915      END-IF.                                                         CL**1
00916 *                                                                    CL**1
00917  EJECT                                                               CL**1
00918 ******************************************************************   CL**1
00919 *    EDIT EACH SELECTION ENTRY.  IF EACH ENTRY IS CONSIDERED         CL**1
00920 *    VALID, CHECK IF A BEGINNING AND ENDING ENTRY WAS ENTERED,       CL**1
00921 *    AND CHECK THE FOLLOWING.                                        CL**1
00922 *                                                                    CL**1
00923 *    1) IF THERE IS A BEGINNING RANGE, THERE MUST BE AN ENDING.      CL**1
00924 *    2) IF THERE IS A ENDING RANGE, THERE MUST BE AN BEGINNING.      CL**1
00925 *    3) BEGINNING RANGE MUST PRECEDE ENDING RANGE.                   CL**1
00926 *                                                                    CL**1
00927 *    IF A VALID BEGINNING AND ENDING RANGE HAVE BEEN SELECTED,       CL**1
00928 *    MARK ALL ITEMS IN THAT RANGE AS BEING SELECTED.                 CL**1
00929 *                                                                    CL**1
00930 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
00931 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
00932 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
00933 *    PERFORMED BY D200-RECORD-SELECTIONS.                            CL**1
00934 ******************************************************************   CL**1
00935 *                                                                    CL**1
00936  E100-EDIT-SELECTIONS.                                               CL**1
00937 *                                                                    CL**1
00938      SET PS-VALID-SELECTIONS TO TRUE.                                CL**1
00939                                                                      CL**1
00940      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
00941          (MB125-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
00942      MOVE MB125-ITEM-AT-TOP-OF-PANEL                                 CL**1
00943                                TO  PV-ITEM-IN-USE.                   CL**1
00944      MOVE +1                   TO  PS-SUB.                           CL**1
00945 *                                                                    CL**1
00946      PERFORM F100-EDIT                                               CL**1
00947          UNTIL (PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL)            CL**1
00948             OR (PV-ITEM-IN-USE > MB125-NUMBER-OF-ITEMS-READ).        CL**1
00949 *                                                                    CL**1
00950      IF  PS-VALID-SELECTIONS                                         CL**1
00951          IF  MB125-START-OF-SELECTED-RANGE GREATER ZERO              CL**1
00952              IF  MB125-END-OF-SELECTED-RANGE GREATER                 CL**1
00953                  MB125-START-OF-SELECTED-RANGE                       CL**1
00954                  PERFORM F200-MARK-RANGE-AS-SELECTED                 CL**1
00955              ELSE                                                    CL**1
00956 *                                                                    CL**1
00957                  IF  MB125-END-OF-SELECTED-RANGE = +0                CL**1
00958                      SET PS-CURSOR-POSITIONED                        CL**1
00959                                TO  TRUE                              CL**1
00960                      SET PS-WARNING                                  CL**1
00961                                TO  TRUE                              CL**1
00962                      MOVE PC-TSYMSG-00051                            CL**1
00963                                TO  DP020-MSG-NUMBER                  CL**1
00964                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**1
00965                          SET DP020-MSG-WARNING TO TRUE               CL**1
00966                      END-IF                                          CL**1
00967                  ELSE                                                CL**1
00968 *                                                                    CL**1
00969                      SET PS-CURSOR-POSITIONED                        CL**1
00970                                TO  TRUE                              CL**1
00971                      SET PS-INVALID-SELECTIONS                       CL**1
00972                                TO  TRUE                              CL**1
00973                      SET DP020-MSG-FATAL                             CL**1
00974                                TO  TRUE                              CL**1
00975                      MOVE PC-TSYMSG-00052                            CL**1
00976                                TO  DP020-MSG-NUMBER                  CL**1
00977                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**1
00978                          MOVE MB125-ITEM-AT-TOP-OF-PANEL             CL**1
00979                                TO  PV-ITEM-IN-USE                    CL**1
00980                          MOVE +1                                     CL**1
00981                                TO  PS-SUB                            CL**1
00982 *                                                                    CL**1
00983                          PERFORM                                     CL**1
00984                              UNTIL (PV-ITEM-IN-USE >                 CL**1
00985                                     PV-ENDING-ITEM-ON-PANEL)         CL**1
00986                                 OR (PV-ITEM-IN-USE >                 CL**1
00987                                     MB125-NUMBER-OF-ITEMS-READ)      CL**1
00988 *                                                                    CL**1
00989                              PERFORM K100-SET-SUBSCRIPTS             CL**1
00990                              IF (MB125-BEGIN(MB125-BLK-SUB           CL**1
00991                                              MB125-ITEM-SUB))        CL**1
00992                              OR (MB125-END(MB125-BLK-SUB             CL**1
00993                                            MB125-ITEM-SUB))          CL**1
00994                                  MOVE -1                             CL**1
00995                                     TO  MBKM125-SELECTL(PS-SUB)      CL*14
00996                                  MOVE PV-ENDING-ITEM-ON-PANEL        CL**1
00997                                     TO  PV-ITEM-IN-USE               CL**1
00998                              END-IF                                  CL**1
00999                              ADD +1 TO  PS-SUB                       CL**1
01000                              ADD +1 TO  PV-ITEM-IN-USE               CL**1
01001                          END-PERFORM                                 CL**1
01002 *                                                                    CL**1
01003                      END-IF                                          CL**1
01004                  END-IF                                              CL**1
01005              END-IF                                                  CL**1
01006          ELSE                                                        CL**1
01007 *                                                                    CL**1
01008              IF MB125-END-OF-SELECTED-RANGE > +0                     CL**1
01009                  SET PS-CURSOR-POSITIONED TO TRUE                    CL**1
01010                  SET PS-WARNING           TO TRUE                    CL**1
01011                  MOVE PC-TSYMSG-00053                                CL**1
01012                                TO  DP020-MSG-NUMBER                  CL**1
01013                  IF NOT DP020-NEXT-ACT-ERROR                         CL**1
01014                      SET DP020-MSG-WARNING TO TRUE                   CL**1
01015                  END-IF                                              CL**1
01016              END-IF                                                  CL**1
01017          END-IF                                                      CL**1
01018      END-IF.                                                         CL**1
01019 *                                                                    CL*14
01020      IF  DP020-MSG-SEVERITY-IND GREATER THAN SPACES                  CL*14
01021          SET PS-DONT-PROCESS   TO  TRUE                              CL*16
01022      END-IF.                                                         CL*14
01023 *                                                                    CL*14
01024  EJECT                                                               CL**1
01025 ******************************************************************   CL**1
01026 *    MOVE THE SELECTIONS MADE FROM THE CURRENT PAGE INTO             CL**1
01027 *    THE COMMAREA.                                                   CL**1
01028 *                                                                    CL**1
01029 *    PERFORMED BY D200-RECORD-SELECTIONS.                            CL**1
01030 ******************************************************************   CL**1
01031 *                                                                    CL**1
01032  E200-MOVE-SELECTS-TO-COMMAREA.                                      CL**1
01033 *                                                                    CL**1
01034      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
01035          (MB125-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
01036                                                                      CL**1
01037      MOVE +1                         TO PS-SUB.                      CL**1
01038      MOVE MB125-ITEM-AT-TOP-OF-PANEL TO PV-ITEM-IN-USE.              CL**1
01039                                                                      CL**1
01040      PERFORM F300-CHECK-SELECTIONS                                   CL**1
01041          UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.             CL**1
01042  EJECT                                                               CL**1
01043 ******************************************************************   CL**1
01044 *    IF THE USER HITS A KEY THAT REQUIRES US TO GO TO ANOTHER        CL**1
01045 *    TRANSACTION, WRITE OUT THE LAST 2 BLOCKS FROM THE ARRAY TO      CL**1
01046 *    TEMPORARY STORAGE, SET UP THE INTER APPLICATION COMMAREA,       CL**1
01047 *    AND START THE NAVIGATOR.                                        CL**1
01048 *                                                                    CL**1
01049 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01050 ******************************************************************   CL**1
01051 *                                                                    CL**1
01052  E300-NAVIGATE.                                                      CL**1
01053 *                                                                    CL**1
01054      MOVE +1 TO MB125-BLK-SUB.                                       CL**1
01055      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01056 *                                                                    CL**1
01057      ADD +1 TO MB125-BLK-SUB.                                        CL**1
01058      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
01059 *                                                                    CL**1
01060      MOVE MB005-INTER-APPL-COMMAREA                                  CL**1
01061                                TO  MB125-SAVE-INTER-APPL-COMMAREA.   CL**1
01062      SET DP020-MB-APPL-SYS-LIST TO TRUE.                             CL*21
01063      PERFORM DP015-1000-START-NAVIGATOR.                             CL**1
01064  EJECT                                                               CL**1
01065 ******************************************************************   CL**1
01066 *    IF THE USER HITS THE 1ST PAGE KEY, COMPUTE THE TOP ITEM         CL**1
01067 *    NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM              CL**1
01068 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
01069 *    TO BE READ.                                                     CL**1
01070 *                                                                    CL**1
01071 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01072 ******************************************************************   CL**1
01073 *                                                                    CL**1
01074  E400-DISPLAY-TOP-OF-LIST.                                           CL**1
01075 *                                                                    CL**1
01076      IF  MB125-NUMBER-OF-ITEMS-READ > +0                             CL**1
01077          MOVE +1 TO PV-TOP-ITEM                                      CL**1
01078          PERFORM F500-BROWSE                                         CL**1
01079      ELSE                                                            CL**1
01080          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01081          PERFORM G100-DISPLAY-PANEL                                  CL**1
01082      END-IF.                                                         CL**1
01083  EJECT                                                               CL**1
01084 ******************************************************************   CL**1
01085 *    IF THE USER HITS THE PAGE BACKARD KEY, COMPUTE THE TOP          CL**1
01086 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**1
01087 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
01088 *    TO BE READ.                                                     CL**1
01089 *                                                                    CL**1
01090 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01091 ******************************************************************   CL**1
01092 *                                                                    CL**1
01093  E500-BROWSE-BACKWARD.                                               CL**1
01094 *                                                                    CL**1
01095      IF  MB125-NUMBER-OF-ITEMS-READ > +0                             CL**1
01096          COMPUTE PV-TOP-ITEM =                                       CL**1
01097              MB125-ITEM-AT-TOP-OF-PANEL - PC-ITEMS-PER-PANEL         CL**1
01098          PERFORM F500-BROWSE                                         CL**1
01099      ELSE                                                            CL**1
01100          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01101          PERFORM G100-DISPLAY-PANEL                                  CL**1
01102      END-IF.                                                         CL**1
01103 *                                                                    CL**1
01104  EJECT                                                               CL**1
01105 ******************************************************************   CL**1
01106 *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP          CL**1
01107 *    ITEM NUMBER FOR THE NEW PAGE AND DETERMINE IF THIS ITEM         CL**1
01108 *    IS CURRENTLY IN THE ARRAY, OR IN TEMPORARY STORAGE OR NEEDS     CL**1
01109 *    TO BE READ.                                                     CL**1
01110 *                                                                    CL**1
01111 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01112 ******************************************************************   CL**1
01113 *                                                                    CL**1
01114  E600-BROWSE-FORWARD.                                                CL**1
01115 *                                                                    CL**1
01116      IF  MB125-NUMBER-OF-ITEMS-READ > +0                             CL**1
01117          COMPUTE PV-TOP-ITEM =                                       CL**1
01118              MB125-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL         CL**1
01119          PERFORM F500-BROWSE                                         CL**1
01120      ELSE                                                            CL**1
01121          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01122          PERFORM G100-DISPLAY-PANEL                                  CL**1
01123      END-IF.                                                         CL**1
01124 *                                                                    CL**1
01125  EJECT                                                               CL**1
01126 ******************************************************************   CL**1
01127 *    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION          CL**1
01128 *    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.             CL**1
01129 *                                                                    CL**1
01130 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01131 ******************************************************************   CL**1
01132 *                                                                    CL**1
01133  E700-DESELECT-ALL-ITEMS.                                            CL**1
01134 *                                                                    CL**1
01135      IF  MB125-NUMBER-OF-ITEMS-READ > +0                             CL**1
01136          MOVE +1               TO  MB125-BLK-SUB                     CL**1
01137                                                                      CL**1
01138          PERFORM F600-CLEAR-SELECTED-INDS                            CL**1
01139              VARYING MB125-ITEM-SUB FROM 1 BY 1                      CL**1
01140              UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01141                                                                      CL**1
01142          ADD +1                TO  MB125-BLK-SUB                     CL**1
01143                                                                      CL**1
01144          PERFORM F600-CLEAR-SELECTED-INDS                            CL**1
01145              VARYING MB125-ITEM-SUB FROM 1 BY 1                      CL**1
01146              UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01147                                                                      CL**1
01148          MOVE MB125-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER     CL**1
01149                                                                      CL**1
01150          COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                           CL**1
01151              1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK)    CL**1
01152                                                                      CL**1
01153          IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                    CL**1
01154             (MB125-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)   CL**1
01155              MOVE +1 TO MB125-BLK-SUB                                CL**1
01156                                                                      CL**1
01157              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01158                                                                      CL**1
01159              MOVE +1 TO PV-BLOCK-NUMBER                              CL**1
01160                                                                      CL**1
01161              COMPUTE PV-PREV-BLOCK-IN-ARRAY =                        CL**1
01162                  PV-FIRST-BLOCK-IN-ARRAY - 1                         CL**1
01163                                                                      CL**1
01164              PERFORM                                                 CL**1
01165                  UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY      CL**1
01166                                                                      CL**1
01167                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01168                                                                      CL**1
01169                  PERFORM F600-CLEAR-SELECTED-INDS                    CL**1
01170                      VARYING MB125-ITEM-SUB FROM 1 BY 1              CL**1
01171                      UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01172                                                                      CL**1
01173                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01174                                                                      CL**1
01175                  ADD +1 TO PV-BLOCK-NUMBER                           CL**1
01176                                                                      CL**1
01177              END-PERFORM                                             CL**1
01178                                                                      CL**1
01179              COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                        CL**1
01180                  PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY    CL**1
01181                                                                      CL**1
01182              PERFORM                                                 CL**1
01183                  UNTIL PV-NEXT-BLOCK-IN-ARRAY >                      CL**1
01184                        MB125-HIGHEST-BLOCK-WRITTEN                   CL**1
01185                                                                      CL**1
01186                  MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      CL**1
01187                                                                      CL**1
01188                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01189                                                                      CL**1
01190                  PERFORM F600-CLEAR-SELECTED-INDS                    CL**1
01191                      VARYING MB125-ITEM-SUB FROM 1 BY 1              CL**1
01192                      UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01193                                                                      CL**1
01194                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01195                                                                      CL**1
01196                  ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                    CL**1
01197                                                                      CL**1
01198              END-PERFORM                                             CL**1
01199                                                                      CL**1
01200              MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER         CL**1
01201                                                                      CL**1
01202              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01203          END-IF                                                      CL**1
01204                                                                      CL**1
01205      END-IF.                                                         CL**1
01206                                                                      CL**1
01207      MOVE +0 TO MB125-NUMBER-OF-SELECTED-ITEMS.                      CL**1
01208      MOVE +0 TO MB125-START-OF-SELECTED-RANGE.                       CL**1
01209      MOVE +0 TO MB125-END-OF-SELECTED-RANGE.                         CL**1
01210                                                                      CL**1
01211      SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                            CL**1
01212                                                                      CL**1
01213      PERFORM G100-DISPLAY-PANEL.                                     CL**1
01214  EJECT                                                               CL**1
01215 ******************************************************************   CL**1
01216 *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO        CL**1
01217 *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.       CL**1
01218 *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST      CL**1
01219 *    RATHER THAN HITTING PF8 TO PAGE FORWARD TO THAT POINT.          CL**1
01220 *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT         CL**1
01221 *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.              CL**1
01222 *                                                                    CL**1
01223 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01224 ******************************************************************   CL**1
01225 *                                                                    CL**1
01226  E800-CHECK-FOR-JUMP-BROWSE.                                         CL**1
01227 *                                                                    CL**1
01228      SET PS-VALID-BEG-ITEM TO TRUE.                                  CL**1
01229                                                                      CL**1
01230      IF (ABEGITMA                   = PC-ERASE-EOF) OR               CL**8
01231         (MB125-NUMBER-OF-ITEMS-READ = +0)                            CL**1
01232          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01233          PERFORM G100-DISPLAY-PANEL                                  CL**1
01234      ELSE                                                            CL**1
01235 *                                                                    CL**1
01236          MOVE ABEGITMI         TO  DP010I-UNEDITED-FIELD             CL**8
01237          MOVE PC-FIELD-LENGTH  TO  DP010I-MAXIMUM-DIGITS             CL**1
01238          MOVE +0               TO  DP010I-MAXIMUM-DECIMALS           CL**1
01239          SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                     CL**1
262978         CALL DP010I-NUMERIC-EDIT-ROUTINE                                 
262978              USING DP010I-NUMERIC-EDIT-AREA                              
01241 *                                                                    CL**1
01242          IF  NOT DP010I-ERROR-DETECTED                               CL**1
01243              MOVE DP010I-NUMERIC-FIELD                               CL**1
01244                                TO  PV-BEGITMI-N                      CL**1
01245              MOVE PV-BEGITMI-N TO  PV-BEGINNING-ITEM                 CL**1
01246 *                                                                    CL**1
01247              IF (PV-BEGINNING-ITEM >  0)          AND                CL**1
01248                 (PV-BEGINNING-ITEM <  PC-MAX-ITEMS)                  CL**1
01249                  MOVE PV-BEGINNING-ITEM TO PV-TOP-ITEM               CL**1
01250                                                                      CL**1
01251                  COMPUTE PV-MAX-ITEMS-TO-BE-READ =                   CL**1
01252                      ((MB125-NUMBER-OF-ITEMS-READ +                  CL**1
01253                        PC-MAX-ITEMS-TO-BE-READ)   -                  CL**1
01254                        PC-ITEMS-PER-PANEL)        + 1                CL**1
01255 *                                                                    CL**1
01256                  IF PV-TOP-ITEM > PV-MAX-ITEMS-TO-BE-READ            CL**1
01257                      MOVE PV-MAX-ITEMS-TO-BE-READ                    CL**1
01258                                TO  PV-TOP-ITEM                       CL**1
01259                      MOVE -1   TO  ABEGITML                          CL**8
01260 *                                                                    CL**1
01261                      IF MB125-NO-ITEMS-LEFT-ON-DB                    CL**1
01262                          MOVE PC-TSYMSG-00070                        CL*23
01263                                TO  DP020-MSG-NUMBER                  CL**1
01264                      ELSE                                            CL**1
01265                          MOVE PC-TSYMSG-00207                        CL*23
01266                                TO  DP020-MSG-NUMBER                  CL**1
01267                      END-IF                                          CL**1
01268 *                                                                    CL**1
01269                      SET PS-CURSOR-POSITIONED                        CL**1
01270                                TO  TRUE                              CL**1
01271                      SET DP020-MSG-INFORMATIONAL                     CL**1
01272                                TO  TRUE                              CL**1
01273                  END-IF                                              CL**1
01274                  PERFORM F500-BROWSE                                 CL**1
01275              ELSE                                                    CL**1
01276                  MOVE PC-TSYMSG-00101                                CL**9
01277                                TO  DP020-MSG-NUMBER                  CL**9
01278                  MOVE -1       TO  ABEGITML                          CL**8
01279                  MOVE DP015-REVERSE                                  CL**1
01280                                TO  ABEGITMH                          CL**8
01281                  MOVE DP015-RED                                      CL**1
01282                                TO  ABEGITMC                          CL**8
01283                  MOVE DP015-UNP-NUM-BRT-MDT                          CL**1
01284                                TO  ABEGITMA                          CL**8
01285                  SET PS-CURSOR-POSITIONED                            CL**1
01286                                TO  TRUE                              CL**1
01287                  SET DP020-MSG-FATAL                                 CL**1
01288                                TO  TRUE                              CL**1
01289                  SET PS-INVALID-BEG-ITEM                             CL**1
01290                                TO  TRUE                              CL**1
01291              END-IF                                                  CL**1
01292 *                                                                    CL**1
01293          ELSE                                                        CL**1
01294              MOVE PC-TSYMSG-00008                                    CL**1
01295                                TO  DP020-MSG-NUMBER                  CL**1
01296              MOVE -1           TO  ABEGITML                          CL**8
01297              MOVE DP015-REVERSE                                      CL**1
01298                                TO  ABEGITMH                          CL**8
01299              MOVE DP015-RED    TO  ABEGITMC                          CL**8
01300              MOVE DP015-UNP-NUM-BRT-MDT                              CL**1
01301                                TO  ABEGITMA                          CL**8
01302              SET PS-CURSOR-POSITIONED                                CL**1
01303                                TO  TRUE                              CL**1
01304              SET DP020-MSG-FATAL                                     CL**1
01305                                TO  TRUE                              CL**1
01306              SET PS-INVALID-BEG-ITEM                                 CL**1
01307                                TO  TRUE                              CL**1
01308          END-IF                                                      CL**1
01309      END-IF.                                                         CL**1
01310 *                                                                    CL**1
01311      IF  PS-INVALID-BEG-ITEM                                         CL**1
01312          SET PS-SAME-ITEMS-DISPLAYED TO TRUE                         CL**1
01313          PERFORM DP017-0000-GET-CURR-DATE-TIME                       CL**1
01314          PERFORM I200-FORMAT-LIST-LINES                              CL**1
01315          PERFORM I300-FORMAT-NR-SELECTED                             CL**1
01316          PERFORM DP005-0000-FORMAT-MSG-LINES                         CL**1
01317          PERFORM DP008-0000-WRITE-PANEL                              CL**1
01318      END-IF.                                                         CL**1
01319 *                                                                    CL**1
01320  EJECT                                                               CL**1
01321 ******************************************************************   CL**1
01322 *    IF THE USER HITS THE SELECT KEY, SET THE SELECTION SWITCH       CL**1
01323 *    FOR ALL ITEMS.                                                  CL**1
01324 *                                                                    CL**1
01325 *    PERFORMED BY D300-CHECK-FUNCTION-KEY.                           CL**1
01326 ******************************************************************   CL**1
01327 *                                                                    CL**1
01328  E900-SELECT-ALL-ITEMS.                                              CL**1
01329 *                                                                    CL**1
01330      IF  MB125-NUMBER-OF-ITEMS-READ > +0                             CL**1
01331          MOVE +1 TO MB125-BLK-SUB                                    CL**1
01332                                                                      CL**1
01333          PERFORM F700-SET-SELECTED-INDS                              CL**1
01334              VARYING MB125-ITEM-SUB FROM 1 BY 1                      CL**1
01335              UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01336                                                                      CL**1
01337          ADD +1 TO MB125-BLK-SUB                                     CL**1
01338                                                                      CL**1
01339          PERFORM F700-SET-SELECTED-INDS                              CL**1
01340              VARYING MB125-ITEM-SUB FROM 1 BY 1                      CL**1
01341              UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK               CL**1
01342                                                                      CL**1
01343          MOVE MB125-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER     CL**1
01344                                                                      CL**1
01345          COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                           CL**1
01346              1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK)    CL**1
01347                                                                      CL**1
01348          IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                    CL**1
01349             (MB125-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)   CL**1
01350              MOVE +1 TO MB125-BLK-SUB                                CL**1
01351                                                                      CL**1
01352              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01353                                                                      CL**1
01354              MOVE +1 TO PV-BLOCK-NUMBER                              CL**1
01355                                                                      CL**1
01356              COMPUTE PV-PREV-BLOCK-IN-ARRAY =                        CL**1
01357                  PV-FIRST-BLOCK-IN-ARRAY - 1                         CL**1
01358                                                                      CL**1
01359              PERFORM                                                 CL**1
01360                  UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY      CL**1
01361                                                                      CL**1
01362                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01363                                                                      CL**1
01364                  PERFORM F700-SET-SELECTED-INDS                      CL**1
01365                      VARYING MB125-ITEM-SUB FROM 1 BY 1              CL**1
01366                      UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01367                                                                      CL**1
01368                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01369                                                                      CL**1
01370                  ADD +1 TO PV-BLOCK-NUMBER                           CL**1
01371                                                                      CL**1
01372              END-PERFORM                                             CL**1
01373                                                                      CL**1
01374              COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                        CL**1
01375                  PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY    CL**1
01376                                                                      CL**1
01377              PERFORM                                                 CL**1
01378                  UNTIL PV-NEXT-BLOCK-IN-ARRAY >                      CL**1
01379                        MB125-HIGHEST-BLOCK-WRITTEN                   CL**1
01380                                                                      CL**1
01381                  MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER      CL**1
01382                                                                      CL**1
01383                  PERFORM Z100-READ-TEMP-STORAGE                      CL**1
01384                                                                      CL**1
01385                  PERFORM F700-SET-SELECTED-INDS                      CL**1
01386                      VARYING MB125-ITEM-SUB FROM 1 BY 1              CL**1
01387                      UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK       CL**1
01388                                                                      CL**1
01389                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
01390                                                                      CL**1
01391                  ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                    CL**1
01392                                                                      CL**1
01393              END-PERFORM                                             CL**1
01394                                                                      CL**1
01395              MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER         CL**1
01396                                                                      CL**1
01397              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01398          END-IF                                                      CL**1
01399                                                                      CL**1
01400      END-IF.                                                         CL**1
01401                                                                      CL**1
01402      MOVE MB125-NUMBER-OF-ITEMS-READ TO                              CL**1
01403                        MB125-NUMBER-OF-SELECTED-ITEMS.               CL**1
01404                                                                      CL**1
01405      SET PS-SAME-ITEMS-DISPLAYED TO TRUE.                            CL**1
01406                                                                      CL**1
01407      PERFORM G100-DISPLAY-PANEL.                                     CL**1
01408 *                                                                    CL**1
01409  EJECT                                                               CL**1
01410 ******************************************************************   CL**1
01411 *    EDIT THE SELECTION ENTRIES.                                     CL**1
01412 *                                                                    CL**1
01413 *    1) VALID ENTRIES ARE 'S' 'B' OR 'E'.                            CL**1
01414 *    2) THERE CAN ONLY BE 1 BEGINNING AND 1 ENDING RANGE.            CL**1
01415 *                                                                    CL**1
01416 *    PERFORMED BY E100-EDIT-SELECTIONS.                              CL**1
01417 ******************************************************************   CL**1
01418 *                                                                    CL**1
01419  F100-EDIT.                                                          CL**1
01420 *                                                                    CL**1
01421      PERFORM K100-SET-SUBSCRIPTS.                                    CL**1
01422                                                                      CL**1
01423      IF NOT (MB125-NO-SELECT(MB125-BLK-SUB MB125-ITEM-SUB)) AND      CL**1
01424         NOT (MB125-SELECT(MB125-BLK-SUB MB125-ITEM-SUB))             CL**1
01425 *                                                                    CL**1
01426          IF  MB125-BEGIN(MB125-BLK-SUB MB125-ITEM-SUB)               CL**1
01427              IF  MB125-START-OF-SELECTED-RANGE                       CL**1
01428                  NOT EQUAL PV-ITEM-IN-USE                            CL**1
01429 *                                                                    CL**1
01430                  IF  MB125-START-OF-SELECTED-RANGE = +0              CL**1
01431                      MOVE PV-ITEM-IN-USE                             CL**1
01432                                TO  MB125-START-OF-SELECTED-RANGE     CL**1
01433                  ELSE                                                CL**1
01434                      IF PS-VALID-SELECTIONS                          CL**1
01435                          MOVE PC-TSYMSG-00054                        CL**1
01436                                TO  DP020-MSG-NUMBER                  CL**1
01437                          IF  NOT DP020-NEXT-ACT-ERROR                CL**1
01438                              MOVE -1                                 CL**1
01439                                TO  MBKM125-SELECTL(PS-SUB)           CL**1
01440                          END-IF                                      CL**1
01441                      END-IF                                          CL**1
01442 *                                                                    CL**1
01443                      SET DP020-MSG-FATAL                             CL**1
01444                                TO  TRUE                              CL**1
01445                      SET PS-INVALID-SELECTIONS                       CL**1
01446                                TO  TRUE                              CL**1
01447                      SET PS-CURSOR-POSITIONED                        CL**1
01448                                TO  TRUE                              CL**1
01449                  END-IF                                              CL**1
01450              END-IF                                                  CL**1
01451          ELSE                                                        CL**1
01452 *                                                                    CL**1
01453              IF  MB125-END(MB125-BLK-SUB MB125-ITEM-SUB)             CL**1
01454                  IF  MB125-END-OF-SELECTED-RANGE                     CL**1
01455                      NOT EQUAL PV-ITEM-IN-USE                        CL**1
01456 *                                                                    CL**1
01457                      IF MB125-END-OF-SELECTED-RANGE = +0             CL**1
01458                          MOVE PV-ITEM-IN-USE                         CL**1
01459                                TO  MB125-END-OF-SELECTED-RANGE       CL**1
01460                      ELSE                                            CL**1
01461 *                                                                    CL**1
01462                          IF  PS-VALID-SELECTIONS                     CL**1
01463                              MOVE PC-TSYMSG-00055                    CL**1
01464                                TO  DP020-MSG-NUMBER                  CL**9
01465                                                                      CL**1
01466                              IF  NOT DP020-NEXT-ACT-ERROR            CL**1
01467                                  MOVE -1                             CL**1
01468                                     TO  MBKM125-SELECTL(PS-SUB)      CL**1
01469                              END-IF                                  CL**1
01470                          END-IF                                      CL**1
01471                          SET PS-INVALID-SELECTIONS                   CL**1
01472                                     TO  TRUE                         CL**1
01473                          SET PS-CURSOR-POSITIONED                    CL**1
01474                                     TO  TRUE                         CL**1
01475                          SET DP020-MSG-FATAL                         CL**1
01476                                     TO  TRUE                         CL**1
01477                      END-IF                                          CL**1
01478                  END-IF                                              CL**1
01479              ELSE                                                    CL**1
01480 *                                                                    CL**1
01481                  IF  PS-VALID-SELECTIONS                             CL**1
01482                      MOVE PC-TSYMSG-00005                            CL**1
01483                                TO  DP020-MSG-NUMBER                  CL**1
01484                      IF  NOT DP020-NEXT-ACT-ERROR                    CL**1
01485                          MOVE -1                                     CL**1
01486                                TO  MBKM125-SELECTL(PS-SUB)           CL**1
01487                      END-IF                                          CL**1
01488                  END-IF                                              CL**1
01489                  SET PS-INVALID-SELECTIONS                           CL**1
01490                                TO  TRUE                              CL**1
01491                  SET PS-CURSOR-POSITIONED                            CL**1
01492                                TO  TRUE                              CL**1
01493                  SET DP020-MSG-FATAL                                 CL**1
01494                                TO  TRUE                              CL**1
01495                  MOVE DP015-RED                                      CL**1
01496                                TO  MBKM125-SELECTC(PS-SUB)           CL**1
01497                  MOVE DP015-REVERSE                                  CL**1
01498                                TO  MBKM125-SELECTH(PS-SUB)           CL*11
01499              END-IF                                                  CL**1
01500          END-IF                                                      CL**1
01501      END-IF.                                                         CL**1
01502                                                                      CL**1
01503      ADD +1                    TO  PV-ITEM-IN-USE.                   CL**1
01504      ADD +1                    TO  PS-SUB.                           CL**1
01505  EJECT                                                               CL**1
01506 ******************************************************************   CL**1
01507 *    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE        CL**1
01508 *    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS        CL**1
01509 *    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.                 CL**1
01510 *                                                                    CL**1
01511 *    PERFORMED BY E100-EDIT-SELECTIONS.                              CL**1
01512 ******************************************************************   CL**1
01513 *                                                                    CL**1
01514  F200-MARK-RANGE-AS-SELECTED.                                        CL**1
01515 *                                                                    CL**1
01516      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
01517      PERFORM G200-MARK-SELECTED-INDS                                 CL**1
01518          VARYING MB125-ITEM-SUB FROM 1 BY 1                          CL**1
01519          UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK.                  CL**1
01520 *                                                                    CL**1
01521      ADD +1 TO MB125-BLK-SUB.                                        CL**1
01522      PERFORM G200-MARK-SELECTED-INDS                                 CL**1
01523          VARYING MB125-ITEM-SUB FROM 1 BY 1                          CL**1
01524          UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK.                  CL**1
01525 *                                                                    CL**1
01526      MOVE MB125-LIST-ITEM-NUMBER(1 1)                                CL**1
01527                                TO  PV-LIST-ITEM-NUMBER.              CL**1
01528      COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                               CL**1
01529          1 + ((PV-LIST-ITEM-NUMBER - 1) /                            CL**1
01530                PC-ITEMS-PER-BLOCK).                                  CL**1
01531 *                                                                    CL**1
01532      MOVE MB125-START-OF-SELECTED-RANGE                              CL**1
01533                                TO  PV-START-OF-SELECTED-RANGE.       CL**1
01534      COMPUTE PV-FIRST-BLOCK-IN-RANGE =                               CL**1
01535          1 + ((PV-START-OF-SELECTED-RANGE - 1) /                     CL**1
01536                PC-ITEMS-PER-BLOCK).                                  CL**1
01537 *                                                                    CL**1
01538      MOVE MB125-END-OF-SELECTED-RANGE                                CL**1
01539                                TO  PV-END-OF-SELECTED-RANGE.         CL**1
01540      COMPUTE PV-LAST-BLOCK-IN-RANGE =                                CL**1
01541          1 + ((PV-END-OF-SELECTED-RANGE - 1) /                       CL**1
01542                PC-ITEMS-PER-BLOCK).                                  CL**1
01543      COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                                CL**1
01544          PV-FIRST-BLOCK-IN-ARRAY + 1.                                CL**1
01545 *                                                                    CL**1
01546      IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR       CL**1
01547         (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)           CL**1
01548          MOVE +1               TO  MB125-BLK-SUB                     CL**1
01549          PERFORM Z150-WRITE-TEMP-STORAGE                             CL**1
01550          COMPUTE PV-PREV-BLOCK-IN-ARRAY =                            CL**1
01551              PV-FIRST-BLOCK-IN-ARRAY - 1                             CL**1
01552 *                                                                    CL**1
01553          PERFORM                                                     CL**1
01554              UNTIL PV-FIRST-BLOCK-IN-RANGE >                         CL**1
01555                    PV-PREV-BLOCK-IN-ARRAY                            CL**1
01556              MOVE PV-FIRST-BLOCK-IN-RANGE                            CL**1
01557                                TO  PV-BLOCK-NUMBER                   CL**1
01558              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01559              PERFORM G200-MARK-SELECTED-INDS                         CL**1
01560                  VARYING MB125-ITEM-SUB FROM 1 BY 1                  CL**1
01561                  UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK           CL**1
01562              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01563              ADD +1            TO PV-FIRST-BLOCK-IN-RANGE            CL**1
01564          END-PERFORM                                                 CL**1
01565 *                                                                    CL**1
01566          COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                            CL**1
01567              PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY        CL**1
01568          PERFORM                                                     CL**1
01569              UNTIL PV-NEXT-BLOCK-IN-ARRAY >                          CL**1
01570                    PV-LAST-BLOCK-IN-RANGE                            CL**1
01571              MOVE PV-NEXT-BLOCK-IN-ARRAY                             CL**1
01572                                TO  PV-BLOCK-NUMBER                   CL**1
01573              PERFORM Z100-READ-TEMP-STORAGE                          CL**1
01574              PERFORM G200-MARK-SELECTED-INDS                         CL**1
01575                  VARYING MB125-ITEM-SUB FROM 1 BY 1                  CL**1
01576                  UNTIL MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK           CL**1
01577              PERFORM Z150-WRITE-TEMP-STORAGE                         CL**1
01578              ADD +1            TO  PV-NEXT-BLOCK-IN-ARRAY            CL**1
01579          END-PERFORM                                                 CL**1
01580 *                                                                    CL**1
01581          MOVE PV-FIRST-BLOCK-IN-ARRAY                                CL**1
01582                                TO  PV-BLOCK-NUMBER                   CL**1
01583          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
01584      END-IF.                                                         CL**1
01585                                                                      CL**1
01586      MOVE +0                   TO  MB125-START-OF-SELECTED-RANGE     CL**1
01587                                    MB125-END-OF-SELECTED-RANGE.      CL**1
01588  EJECT                                                               CL**1
01589 ******************************************************************   CL**1
01590 *    CHECK EACH ENTRY TO DETERMINE IF THE SELECTION CRITERIA IN      CL**1
01591 *    THE MAP DIFFERS FROM THAT IN THE ARRAY.  IF THEY DO DIFFER,     CL**1
01592 *    AND THE ARRAY ENTRY SHOWS THAT THE ITEM WAS PREVIOUSLY          CL**1
01593 *    SELECTED, SUBTRACT 1 FROM THE SELECTED COUNTER.  IF THEY DO     CL**1
01594 *    DIFFER, AND THE ARRAY ENTRY SHOWS THAT THIS ITEM WAS MARKED     CL**1
01595 *    AS EITHER THE BEGINNING OR ENDING SELECTION POINT, ZERO OUT     CL**1
01596 *    THE STARTING RANGE AND/OR ENDING RANGE.  IF THE ENTRY ON        CL**1
01597 *    THE MAP SHOWS THAT THIS ITEM WAS SELECTED, ADD 1 TO THE         CL**1
01598 *    SELECTED COUNTER.                                               CL**1
01599 *                                                                    CL**1
01600 *    PERFORMED BY E200-MOVE-SELECTS-TO-COMMAREA.                     CL**1
01601 ******************************************************************   CL**1
01602 *                                                                    CL**1
01603  F300-CHECK-SELECTIONS.                                              CL**1
01604 *                                                                    CL**1
01605      IF (PV-ITEM-IN-USE < MB125-NUMBER-OF-ITEMS-READ) OR             CL**1
01606         (PV-ITEM-IN-USE = MB125-NUMBER-OF-ITEMS-READ)                CL**1
01607          PERFORM K100-SET-SUBSCRIPTS                                 CL**1
01608 *                                                                    CL**1
01609          IF  MB125-SELECTED-SW(MB125-BLK-SUB MB125-ITEM-SUB)         CL**1
01610              NOT EQUAL MBKM125-SELECTI(PS-SUB)                       CL**1
01611              SET MB125-BLOCK-MODIFIED(MB125-BLK-SUB)                 CL**1
01612                                TO  TRUE                              CL**1
01613              IF  MB125-SELECT(MB125-BLK-SUB MB125-ITEM-SUB)          CL**1
01614                  SUBTRACT +1 FROM MB125-NUMBER-OF-SELECTED-ITEMS     CL**1
01615              ELSE                                                    CL**1
01616 *                                                                    CL**1
01617                  IF  MB125-BEGIN(MB125-BLK-SUB MB125-ITEM-SUB)       CL**1
01618                      IF  MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB        CL**1
01619                                                MB125-ITEM-SUB) =     CL**1
01620                          MB125-START-OF-SELECTED-RANGE               CL**1
01621                          MOVE +0                                     CL**1
01622                                TO  MB125-START-OF-SELECTED-RANGE     CL**1
01623                      END-IF                                          CL**1
01624                  ELSE                                                CL**1
01625 *                                                                    CL**1
01626                      IF  MB125-END(MB125-BLK-SUB MB125-ITEM-SUB)     CL**1
01627                          IF  MB125-LIST-ITEM-NUMBER                  CL**1
01628                                  (MB125-BLK-SUB MB125-ITEM-SUB)      CL**1
01629                          =  MB125-END-OF-SELECTED-RANGE              CL**1
01630                              MOVE +0                                 CL**1
01631                                TO MB125-END-OF-SELECTED-RANGE        CL**1
01632                          END-IF                                      CL**1
01633                      END-IF                                          CL**1
01634                  END-IF                                              CL**1
01635              END-IF                                                  CL**1
01636 *                                                                    CL**1
01637              IF MBKM125-SELECTI(PS-SUB) = PC-SELECTED                CL**1
01638                  ADD +1        TO MB125-NUMBER-OF-SELECTED-ITEMS     CL**1
01639              END-IF                                                  CL**1
01640 *                                                                    CL**1
01641              IF (MBKM125-SELECTA(PS-SUB) = PC-ERASE-EOF) OR          CL**1
01642                 (MBKM125-SELECTI(PS-SUB) = SPACES)                   CL**1
01643                  MOVE SPACES   TO                                    CL**1
01644                       MB125-SELECTED-SW(MB125-BLK-SUB                CL**1
01645                                         MB125-ITEM-SUB)              CL**1
01646              ELSE                                                    CL**1
01647                  MOVE MBKM125-SELECTI(PS-SUB) TO                     CL**1
01648                       MB125-SELECTED-SW(MB125-BLK-SUB                CL**1
01649                                         MB125-ITEM-SUB)              CL**1
01650              END-IF                                                  CL**1
01651          END-IF                                                      CL**1
01652      END-IF.                                                         CL**1
01653 *                                                                    CL**1
01654      ADD +1                    TO  PV-ITEM-IN-USE.                   CL**1
01655      ADD +1                    TO  PS-SUB.                           CL**1
01656 *                                                                    CL**1
01657  EJECT                                                               CL**1
01658 ******************************************************************   CL**1
01659 *    CALCULATE THE NEW TOP AND BOTTOM ITEM NUMBERS BASED ON WHERE    CL**1
01660 *    THE USER SPECIFIED TO GO ON THE LIST AND DETERMINE WHERE        CL**1
01661 *    THESE ITEMS CAN BE FOUND (I.E. ARRAY, TEMPORARY STORAGE).       CL**1
01662 *                                                                    CL**1
01663 *    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                          CL**1
01664 *    PERFORMED BY E500-BROWSE-BACKWARD.                              CL**1
01665 *    PERFORMED BY E600-BROWSE-FORWARD.                               CL**1
01666 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
01667 ******************************************************************   CL**1
01668 *                                                                    CL**1
01669  F500-BROWSE.                                                        CL**1
01670 *                                                                    CL**1
01671      IF  PV-TOP-ITEM < +1                                            CL**1
01672          MOVE +1               TO  PV-TOP-ITEM                       CL**1
01673          IF  PS-CURSOR-NOT-POSITIONED                                CL**1
01674              MOVE PC-TSYMSG-00069                                    CL**1
01675                                TO  DP020-MSG-NUMBER                  CL**1
01676              SET DP020-MSG-INFORMATIONAL                             CL**1
01677                                TO  TRUE                              CL**1
01678              SET PS-INFORMATIONAL                                    CL**1
01679                                TO  TRUE                              CL**1
01680              SET PS-CURSOR-POSITIONED                                CL**1
01681                                TO  TRUE                              CL**1
01682          END-IF                                                      CL**1
01683      END-IF.                                                         CL**1
01684 *                                                                    CL**1
01685      IF  MB125-NO-ITEMS-LEFT-ON-DB                                   CL**1
01686          IF  PV-TOP-ITEM > MB125-NUMBER-OF-ITEMS-READ                CL**1
01687              IF  DP020-SRC-AID EQUAL DP016-ENTER                     CL*25
01688                  MOVE MB125-NUMBER-OF-ITEMS-READ                     CL*25
01689                                TO  PV-TOP-ITEM                       CL**1
01690              ELSE                                                    CL*25
01691                  MOVE MB125-ITEM-AT-TOP-OF-PANEL                     CL*25
01692                                TO  PV-TOP-ITEM                       CL*25
01693              END-IF                                                  CL*25
01694 *                                                                    CL*25
01695              IF  PS-CURSOR-NOT-POSITIONED                            CL**1
01696                  MOVE -1       TO  ANAVCMDL                          CL**1
01697                  SET DP020-MSG-INFORMATIONAL                         CL**1
01698                                TO  TRUE                              CL**1
01699                  SET PS-CURSOR-POSITIONED                            CL**1
01700                                TO  TRUE                              CL**1
01701                  MOVE PC-TSYMSG-00070                                CL*23
01702                                TO  DP020-MSG-NUMBER                  CL**1
01703                  SET PS-INFORMATIONAL                                CL*23
01704                                TO  TRUE                              CL**1
01705              END-IF                                                  CL**1
01706          END-IF                                                      CL**1
01707      END-IF.                                                         CL**1
01708 *                                                                    CL**1
01709      COMPUTE PV-BOTTOM-ITEM =                                        CL**1
01710          (PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1.                     CL**1
01711                                                                      CL**1
01712      IF  MB125-NO-ITEMS-LEFT-ON-DB                                   CL**1
01713          IF  PV-BOTTOM-ITEM > MB125-NUMBER-OF-ITEMS-READ             CL**1
01714              MOVE MB125-NUMBER-OF-ITEMS-READ                         CL**1
01715                                TO  PV-BOTTOM-ITEM                    CL**1
01716              IF  PS-CURSOR-NOT-POSITIONED                            CL**1
01717                  IF  PV-TOP-ITEM NOT = +1                            CL**1
01718                      MOVE PC-TSYMSG-00070                            CL*23
01719                                TO  DP020-MSG-NUMBER                  CL**1
01720                      SET PS-INFORMATIONAL                            CL*23
01721                                TO  TRUE                              CL**1
01722                      SET DP020-MSG-INFORMATIONAL                     CL*23
01723                                TO  TRUE                              CL**1
01724                      SET PS-CURSOR-POSITIONED                        CL*23
01725                                TO  TRUE                              CL**1
01726                  END-IF                                              CL**1
01727              END-IF                                                  CL**1
01728          END-IF                                                      CL**1
01729      END-IF.                                                         CL**1
01730 *                                                                    CL**1
01731      PERFORM G300-DETERMINE-WHAT-IS-WHERE.                           CL**1
01732                                                                      CL**1
01733      IF  PS-TOP-ITEM-IN-ARRAY                                        CL**1
01734          IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**1
01735              IF  PS-BOTTOM-ITEM-IN-TEMP                              CL**1
01736                  PERFORM G500-SCROLL-FORWARD                         CL**1
01737              ELSE                                                    CL**1
01738                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**1
01739                      PERFORM G500-SCROLL-FORWARD                     CL**1
01740                  END-IF                                              CL**1
01741                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**1
01742              END-IF                                                  CL**1
01743          END-IF                                                      CL**1
01744      ELSE                                                            CL**1
01745 *                                                                    CL**1
01746          IF  PS-BOTTOM-ITEM-IN-ARRAY                                 CL**1
01747              PERFORM G600-SCROLL-BACKWARD                            CL**1
01748          ELSE                                                        CL**1
01749              IF  PS-TOP-ITEM-IN-TEMP                                 CL**1
01750                  PERFORM G700-GET-TOP-ITEMS-BLOCK                    CL**1
01751                  PERFORM G300-DETERMINE-WHAT-IS-WHERE                CL**1
01752                  IF  PS-BOTTOM-ITEM-NOT-IN-ARRAY                     CL**1
01753                      PERFORM G400-READ-ITEMS-INTO-ARRAY              CL**1
01754                  END-IF                                              CL**1
01755              ELSE                                                    CL**1
01756                  IF  PS-LAST-BLOCK-NOT-IN-ARRAY                      CL**1
01757                      PERFORM G800-GET-LAST-BLOCK-IN-TEMP             CL**1
01758                  END-IF                                              CL**1
01759                  PERFORM G400-READ-ITEMS-INTO-ARRAY                  CL**1
01760              END-IF                                                  CL**1
01761          END-IF                                                      CL**1
01762      END-IF.                                                         CL**1
01763 *                                                                    CL**1
01764      IF  PV-TOP-ITEM = MB125-ITEM-AT-TOP-OF-PANEL                    CL**1
01765          SET PS-SAME-ITEMS-DISPLAYED                                 CL**1
01766                                TO  TRUE                              CL**1
01767      ELSE                                                            CL**1
01768          SET PS-DIFFERENT-ITEMS-DISPLAYED                            CL**1
01769                                TO  TRUE                              CL**1
01770          MOVE PV-TOP-ITEM      TO  MB125-ITEM-AT-TOP-OF-PANEL        CL**1
01771      END-IF.                                                         CL**1
01772 *                                                                    CL**1
01773      PERFORM G100-DISPLAY-PANEL.                                     CL**1
01774 *                                                                    CL**1
01775  EJECT                                                               CL**1
01776 ******************************************************************   CL**1
01777 *    MARK EACH ITEM AS BEING NOT SELECTED.                           CL**1
01778 *                                                                    CL**1
01779 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
01780 ******************************************************************   CL**1
01781 *                                                                    CL**1
01782  F600-CLEAR-SELECTED-INDS.                                           CL**1
01783 *                                                                    CL**1
01784      IF  MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB MB125-ITEM-SUB)        CL**1
01785              NOT EQUAL ZERO                                          CL**1
01786          IF  NOT MB125-NO-SELECT(MB125-BLK-SUB MB125-ITEM-SUB)       CL**1
01787              SET MB125-NO-SELECT(MB125-BLK-SUB MB125-ITEM-SUB)       CL**1
01788                                TO  TRUE                              CL**1
01789              SET MB125-BLOCK-MODIFIED(MB125-BLK-SUB)                 CL**1
01790                                TO  TRUE                              CL**1
01791          END-IF                                                      CL**1
01792      END-IF.                                                         CL**1
01793 *                                                                    CL**1
01794  EJECT                                                               CL**1
01795 ******************************************************************   CL**1
01796 *    MARK EACH ITEM AS BEING SELECTED.                               CL**1
01797 *                                                                    CL**1
01798 *    PERFORMED BY E900-SELECT-ALL-ITEMS.                             CL**1
01799 ******************************************************************   CL**1
01800 *                                                                    CL**1
01801  F700-SET-SELECTED-INDS.                                             CL**1
01802 *                                                                    CL**1
01803      IF  MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB MB125-ITEM-SUB)        CL**1
01804              NOT EQUAL ZERO                                          CL**1
01805          IF  NOT MB125-SELECT(MB125-BLK-SUB MB125-ITEM-SUB)          CL**1
01806              SET MB125-SELECT(MB125-BLK-SUB MB125-ITEM-SUB)          CL**1
01807                                TO  TRUE                              CL**1
01808              SET MB125-BLOCK-MODIFIED(MB125-BLK-SUB)                 CL**1
01809                                TO  TRUE                              CL**1
01810          END-IF                                                      CL**1
01811      END-IF.                                                         CL**1
01812 *                                                                    CL**1
01813  EJECT                                                               CL**1
01814 ******************************************************************   CL**1
01815 *    FILL THE MAP WITH THE NECESSARY DATA AND WRITE IT OUT.          CL**1
01816 *                                                                    CL**1
01817 *    PERFORMED BY B100-CONTROL-PROCESSING.                           CL**1
01818 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
01819 *    PERFORMED BY C400-REFRESH-PANEL-FROM-TEMP.                      CL**1
01820 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
01821 *    PERFORMED BY E400-DISPLAY-TOP-OF-LIST.                          CL**1
01822 *    PERFORMED BY E500-BROWSE-BACKWARD.                              CL**1
01823 *    PERFORMED BY E600-BROWSE-FORWARD.                               CL**1
01824 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
01825 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
01826 *    PERFORMED BY F500-BROWSE.                                       CL**1
01827 ******************************************************************   CL**1
01828 *                                                                    CL**1
01829  G100-DISPLAY-PANEL.                                                 CL**1
01830 *                                                                    CL**1
01831      PERFORM DP017-0000-GET-CURR-DATE-TIME.                          CL**1
01832      MOVE DP017-EDITED-TIME-HMS                                      CL*10
01833                                TO  ATIMEO.                           CL*10
01834                                                                      CL**1
01835      IF PS-SEND-MAP-N-DATA-FRSET                                     CL**1
01836          PERFORM DP002-0000-FORMAT-TITLE-LINES                       CL**1
01837          PERFORM DP009-0000-LOAD-FK-LINES                            CL**1
01838      END-IF.                                                         CL**1
01839                                                                      CL**1
01840      PERFORM H200-FORMAT-PANEL-BODY.                                 CL**1
01841      MOVE PC-COMPANY           TO  AOPERCOO.                         CL**8
01842 *                                                                    CL**1
01843      PERFORM DP005-0000-FORMAT-MSG-LINES.                            CL**1
01844                                                                      CL**1
01845      PERFORM DP008-0000-WRITE-PANEL.                                 CL**1
01846  EJECT                                                               CL**1
01847 ******************************************************************   CL**1
01848 *    MARK EACH ITEM THAT FALLS WITHIN THE BEGINNING AND ENDING       CL**1
01849 *    RANGE AS BEING SELECTED.                                        CL**1
01850 *                                                                    CL**1
01851 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
01852 ******************************************************************   CL**1
01853 *                                                                    CL**1
01854  G200-MARK-SELECTED-INDS.                                            CL**1
01855 *                                                                    CL**1
01856      IF (MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB                        CL**1
01857                                 MB125-ITEM-SUB) >                    CL**1
01858          MB125-START-OF-SELECTED-RANGE)                              CL**1
01859      OR (MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB                        CL**1
01860                                 MB125-ITEM-SUB) =                    CL**1
01861          MB125-START-OF-SELECTED-RANGE)                              CL**1
01862 *                                                                    CL**1
01863          IF (MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB                    CL**1
01864                                     MB125-ITEM-SUB) <                CL**1
01865              MB125-END-OF-SELECTED-RANGE)                            CL**1
01866          OR (MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB                    CL**1
01867                                     MB125-ITEM-SUB) =                CL**1
01868              MB125-END-OF-SELECTED-RANGE)                            CL**1
01869 *                                                                    CL**1
01870              IF NOT MB125-SELECT(MB125-BLK-SUB MB125-ITEM-SUB)       CL**1
01871                  SET MB125-SELECT(MB125-BLK-SUB                      CL**1
01872                                   MB125-ITEM-SUB)                    CL**1
01873                                TO  TRUE                              CL**1
01874                  SET MB125-BLOCK-MODIFIED(MB125-BLK-SUB)             CL**1
01875                                TO  TRUE                              CL**1
01876                  ADD +1        TO MB125-NUMBER-OF-SELECTED-ITEMS     CL**1
01877              END-IF                                                  CL**1
01878          END-IF                                                      CL**1
01879      END-IF.                                                         CL**1
01880  EJECT                                                               CL**1
01881 ******************************************************************   CL**1
01882 *    DETERMINE WHETHER THE TOP ITEM AND BOTTOM ITEM CAN BE FOUND     CL**1
01883 *    IN THE ARRAY, IN TEMPORARY STORAGE, OR NEITHER.                 CL**1
01884 *                                                                    CL**1
01885 *    PERFORMED BY F500-BROWSE.                                       CL**1
01886 ******************************************************************   CL**1
01887 *                                                                    CL**1
01888  G300-DETERMINE-WHAT-IS-WHERE.                                       CL**1
01889 *                                                                    CL**1
01890      MOVE MB125-LIST-ITEM-NUMBER(1 1)                                CL**1
01891                                TO  PV-FIRST-ITEM-IN-ARRAY.           CL**1
01892      COMPUTE PV-LAST-ITEM-IN-ARRAY =                                 CL**1
01893          (PV-FIRST-ITEM-IN-ARRAY +                                   CL**1
01894          (PC-MAX-BLOCKS-IN-ARRAY * PC-ITEMS-PER-BLOCK)) - 1.         CL**1
01895      IF  PV-LAST-ITEM-IN-ARRAY > MB125-NUMBER-OF-ITEMS-READ          CL**1
01896          MOVE MB125-NUMBER-OF-ITEMS-READ                             CL**1
01897                                TO  PV-LAST-ITEM-IN-ARRAY             CL**1
01898      END-IF.                                                         CL**1
01899 *                                                                    CL**1
01900      COMPUTE PV-LAST-ITEM-IN-TEMP =                                  CL**1
01901          MB125-HIGHEST-BLOCK-WRITTEN * PC-ITEMS-PER-BLOCK.           CL**1
01902      IF  PV-LAST-ITEM-IN-TEMP > MB125-NUMBER-OF-ITEMS-READ           CL**1
01903          MOVE MB125-NUMBER-OF-ITEMS-READ                             CL**1
01904                                TO  PV-LAST-ITEM-IN-TEMP              CL**1
01905      END-IF.                                                         CL**1
01906 *                                                                    CL**1
01907      IF (PV-TOP-ITEM > PV-FIRST-ITEM-IN-ARRAY)                       CL**1
01908      OR (PV-TOP-ITEM = PV-FIRST-ITEM-IN-ARRAY)                       CL**1
01909          IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-ARRAY)                    CL**1
01910          OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-ARRAY)                    CL**1
01911              SET PS-TOP-ITEM-IN-ARRAY                                CL**1
01912                                TO  TRUE                              CL**1
01913          ELSE                                                        CL**1
01914              SET PS-TOP-ITEM-NOT-IN-ARRAY                            CL**1
01915                                TO  TRUE                              CL**1
01916          END-IF                                                      CL**1
01917      ELSE                                                            CL**1
01918          SET PS-TOP-ITEM-NOT-IN-ARRAY                                CL**1
01919                                TO  TRUE                              CL**1
01920      END-IF.                                                         CL**1
01921 *                                                                    CL**1
01922      IF (PV-BOTTOM-ITEM > PV-FIRST-ITEM-IN-ARRAY)                    CL**1
01923      OR (PV-BOTTOM-ITEM = PV-FIRST-ITEM-IN-ARRAY)                    CL**1
01924          IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-ARRAY)                 CL**1
01925          OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-ARRAY)                 CL**1
01926              SET PS-BOTTOM-ITEM-IN-ARRAY                             CL**1
01927                                TO  TRUE                              CL**1
01928          ELSE                                                        CL**1
01929              SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                         CL**1
01930                                TO  TRUE                              CL**1
01931          END-IF                                                      CL**1
01932      ELSE                                                            CL**1
01933          SET PS-BOTTOM-ITEM-NOT-IN-ARRAY                             CL**1
01934                                TO  TRUE                              CL**1
01935      END-IF.                                                         CL**1
01936 *                                                                    CL**1
01937      IF (PV-TOP-ITEM < PV-LAST-ITEM-IN-TEMP)                         CL**1
01938      OR (PV-TOP-ITEM = PV-LAST-ITEM-IN-TEMP)                         CL**1
01939          SET PS-TOP-ITEM-IN-TEMP                                     CL**1
01940                                TO  TRUE                              CL**1
01941      ELSE                                                            CL**1
01942          SET PS-TOP-ITEM-NOT-IN-TEMP                                 CL**1
01943                                TO  TRUE                              CL**1
01944      END-IF.                                                         CL**1
01945 *                                                                    CL**1
01946      IF (PV-BOTTOM-ITEM < PV-LAST-ITEM-IN-TEMP)                      CL**1
01947      OR (PV-BOTTOM-ITEM = PV-LAST-ITEM-IN-TEMP)                      CL**1
01948          SET PS-BOTTOM-ITEM-IN-TEMP                                  CL**1
01949                                TO  TRUE                              CL**1
01950      ELSE                                                            CL**1
01951          SET PS-BOTTOM-ITEM-NOT-IN-TEMP                              CL**1
01952                                TO  TRUE                              CL**1
01953      END-IF.                                                         CL**1
01954 *                                                                    CL**1
01955      IF PV-LAST-ITEM-IN-TEMP > PV-LAST-ITEM-IN-ARRAY                 CL**1
01956          SET PS-LAST-BLOCK-NOT-IN-ARRAY                              CL**1
01957                                TO  TRUE                              CL**1
01958      ELSE                                                            CL**1
01959          SET PS-LAST-BLOCK-IN-ARRAY                                  CL**1
01960                                TO  TRUE                              CL**1
01961      END-IF.                                                         CL**1
01962 *                                                                    CL**1
01963  EJECT                                                               CL**1
01964 ******************************************************************   CL**1
01965 *    DETERMINE THE SPOT IN THE ARRAY WHERE THE LAST ITEM FROM        CL**1
01966 *    THE DATA BASE WAS ADDED SO WE KNOW WHERE TO ADD THE NEW         CL**1
01967 *    ITEMS.  USE THE SAVED UPC KEY TO START THE BROWSE.  H600        CL**1
01968 *    MUST BE PERFORMED TO POSITION TO THE FIRST UPC TO PROCESS.      CL**1
01969 *                                                                    CL**1
01970 *    PERFORMED BY F500-BROWSE.                                       CL**1
01971 ******************************************************************   CL**1
01972 *                                                                    CL**1
01973  G400-READ-ITEMS-INTO-ARRAY.                                         CL**1
01974 *                                                                    CL**1
01975      COMPUTE PS-ITEM-SUB =                                           CL**1
01976          (MB125-NUMBER-OF-ITEMS-READ -                               CL**1
01977           MB125-LIST-ITEM-NUMBER(1 1)) + 1.                          CL**1
01978                                                                      CL**1
01979      MOVE PS-ITEM-SUB TO MB125-ITEM-SUB.                             CL**1
01980                                                                      CL**1
01981      IF  MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK                         CL**1
01982          SUBTRACT PC-ITEMS-PER-BLOCK                                 CL**1
01983                              FROM  MB125-ITEM-SUB                    CL**1
01984          MOVE PC-MAX-BLOCKS-IN-ARRAY                                 CL**1
01985                                TO  MB125-BLK-SUB                     CL**1
01986      ELSE                                                            CL**1
01987          MOVE +1               TO  MB125-BLK-SUB                     CL**1
01988      END-IF.                                                         CL**1
01989 *                                                                    CL**1
01990      MOVE PV-BOTTOM-ITEM       TO  PV-HIGHEST-ITEM-TO-BE-READ.       CL**1
01991 *                                                                    CL**1
01992      PERFORM L100-OPEN-CURSOR.                                       CL**1
01993      PERFORM H100-READ-ITEMS-FROM-DB.                                CL**1
01994      IF  PV-ITEMS-READ EQUAL ZERO                                    CL*10
01995          MOVE MB125-ITEM-AT-TOP-OF-PANEL                             CL**9
01996                                TO  PV-TOP-ITEM                       CL**9
01997      END-IF.                                                         CL**9
01998 *                                                                    CL**1
01999      IF  MB125-NO-ITEMS-LEFT-ON-DB                                   CL**1
02000          IF  PV-TOP-ITEM > MB125-NUMBER-OF-ITEMS-READ                CL**1
02001              MOVE MB125-NUMBER-OF-ITEMS-READ                         CL**1
02002                                TO  PV-TOP-ITEM                       CL**1
02003          END-IF                                                      CL**1
02004          MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER                  CL*23
02005          SET DP020-MSG-INFORMATIONAL                                 CL*23
02006                                TO  TRUE                              CL**1
02007          SET PS-INFORMATIONAL  TO  TRUE                              CL*23
02008      END-IF.                                                         CL**1
02009 *                                                                    CL**1
02010  EJECT                                                               CL**1
02011 ******************************************************************   CL**1
02012 *    IF THE TOP ITEM WE NEED IS IN THE ARRAY, BUT THE BOTTOM         CL**1
02013 *    ITEM WE NEED IS IN TEMPORARY STORAGE OR HAS NOT BEEN READ       CL**1
02014 *    YET, WRITE OUT THE 1ST BLOCK IN THE ARRAY TO TEMPORARY          CL**1
02015 *    STORAGE.  MOVE THE 2ND BLOCK IN THE ARRAY TO THE 1ST BLOCK      CL**1
02016 *    AND READ THE BLOCK NEEDED INTO THE 2ND BLOCK OF THE ARRAY.      CL**1
02017 *    THE TOP ITEM WILL BE LOCATED IN THE 1ST BLOCK, AND THE          CL**1
02018 *    BOTTOM ITEM WILL EITHER BE LOCATED IN THE 2ND BLOCK OR          CL**1
02019 *    WILL BE PLACED IN THE 2ND BLOCK.                                CL**1
02020 *                                                                    CL**1
02021 *    PERFORMED BY F500-BROWSE.                                       CL**1
02022 ******************************************************************   CL**1
02023 *                                                                    CL**1
02024  G500-SCROLL-FORWARD.                                                CL**1
02025 *                                                                    CL**1
02026      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02027      SET MB125-BLOCK-MODIFIED (1)                                    CL**1
02028                                TO  TRUE.                             CL**1
02029      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02030 *                                                                    CL**1
02031      MOVE MB125-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY) TO             CL**1
02032           MB125-BLOCK-ENTRIES(MB125-BLK-SUB).                        CL**1
02033 *                                                                    CL**1
02034      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
02035          1 + ((PV-BOTTOM-ITEM - 1) / PC-ITEMS-PER-BLOCK).            CL**1
02036 *                                                                    CL**1
02037      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**1
02038      ADD +1                    TO  MB125-BLK-SUB.                    CL**1
02039      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02040 *                                                                    CL**1
02041  EJECT                                                               CL**1
02042 ******************************************************************   CL**1
02043 *    IF TOP ITEM WE NEED IS NOT IN THE ARRAY, BUT THE BOTTOM         CL**1
02044 *    ITEM IS, WRITE BOTH BLOCKS TO TEMPORARY STORAGE.  MOVE          CL**1
02045 *    THE 1ST BLOCK IN THE ARRAY TO THE 2ND BLOCK OF THE ARRAY.       CL**1
02046 *    READ THE BLOCK THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK    CL**1
02047 *    OF THE ARRAY.                                                   CL**1
02048 *                                                                    CL**1
02049 *    PERFORMED BY F500-BROWSE.                                       CL**1
02050 ******************************************************************   CL**1
02051 *                                                                    CL**1
02052  G600-SCROLL-BACKWARD.                                               CL**1
02053 *                                                                    CL**1
02054      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02055      SET MB125-BLOCK-MODIFIED (1)                                    CL**1
02056                                TO  TRUE.                             CL**1
02057      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02058 *                                                                    CL**1
02059      ADD +1 TO MB125-BLK-SUB.                                        CL**1
02060      SET MB125-BLOCK-MODIFIED (2)                                    CL**1
02061                                TO  TRUE.                             CL**1
02062      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02063                                                                      CL**1
02064      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02065      MOVE MB125-BLOCK-ENTRIES(MB125-BLK-SUB) TO                      CL**1
02066           MB125-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY).               CL**1
02067 *                                                                    CL**1
02068      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
02069          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**1
02070 *                                                                    CL**1
02071      MOVE PV-TEMP-BLOCK-NUMBER TO PV-BLOCK-NUMBER.                   CL**1
02072      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02073 *                                                                    CL**1
02074  EJECT                                                               CL**1
02075 ******************************************************************   CL**1
02076 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**1
02077 *    ARRAY, BUT THE TOP ITEM IS IN TEMPORARY STORAGE, WRITE BOTH     CL**1
02078 *    BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ THE BLOCK       CL**1
02079 *    THAT CONTAINS THE TOP ITEM INTO THE 1ST BLOCK OF THE ARRAY.     CL**1
02080 *    IF THERE IS ANOTHER BLOCK IN TEMPORARY STORAGE FOLLOWING        CL**1
02081 *    THE ONE JUST READ, READ THAT ONE INTO THE 2ND BLOCK OF THE      CL**1
02082 *    ARRAY, OTHERWISE INITIALIZE THE 2ND BLOCK OF THE ARRAY.         CL**1
02083 *                                                                    CL**1
02084 *    PERFORMED BY F500-BROWSE.                                       CL**1
02085 ******************************************************************   CL**1
02086 *                                                                    CL**1
02087  G700-GET-TOP-ITEMS-BLOCK.                                           CL**1
02088 *                                                                    CL**1
02089      SET MB125-BLOCK-MODIFIED (1)                                    CL**1
02090                                TO  TRUE.                             CL**1
02091      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02092      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02093 *                                                                    CL**1
02094      SET MB125-BLOCK-MODIFIED (2)                                    CL**1
02095                                TO  TRUE.                             CL**1
02096      ADD +1                    TO  MB125-BLK-SUB.                    CL**1
02097      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02098 *                                                                    CL**1
02099      COMPUTE PV-TEMP-BLOCK-NUMBER =                                  CL**1
02100          1 + ((PV-TOP-ITEM - 1) / PC-ITEMS-PER-BLOCK).               CL**1
02101 *                                                                    CL**1
02102      MOVE PV-TEMP-BLOCK-NUMBER TO  PV-BLOCK-NUMBER.                  CL**1
02103      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02104 *                                                                    CL**1
02105      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02106                                                                      CL**1
02107      ADD +1                    TO  PV-BLOCK-NUMBER.                  CL**1
02108      ADD +1                    TO  MB125-BLK-SUB.                    CL**1
02109 *                                                                    CL**1
02110      IF (PV-BLOCK-NUMBER < MB125-HIGHEST-BLOCK-WRITTEN) OR           CL**1
02111         (PV-BLOCK-NUMBER = MB125-HIGHEST-BLOCK-WRITTEN)              CL**1
02112          PERFORM Z100-READ-TEMP-STORAGE                              CL**1
02113      ELSE                                                            CL**1
02114          PERFORM I100-INITIALIZE-BLOCK                               CL**1
02115      END-IF.                                                         CL**1
02116 *                                                                    CL**1
02117  EJECT                                                               CL**1
02118 ******************************************************************   CL**1
02119 *    IF BOTH THE TOP AND BOTTOM ITEMS WE NEED ARE NOT IN THE         CL**1
02120 *    ARRAY AND BOTH ITEMS ARE NOT IN TEMPORARY STORAGE (THE          CL**1
02121 *    ITEMS HAVE NOT BEEN READ FROM THE DATA BASE YET), AND THE       CL**1
02122 *    LAST ITEM READ FROM THE DATA BASE IS IN TEMPORARY STORAGE,      CL**1
02123 *    WRITE BOTH BLOCKS IN THE ARRAY TO TEMPORARY STORAGE.  READ      CL**1
02124 *    THE HIGHEST BLOCK IN TEMPORARY STORAGE INTO THE 1ST BLOCK       CL**1
02125 *    OF THE ARRAY, AND INITIALIZE THE 2ND BLOCK IN THE ARRAY.        CL**1
02126 *    THE 2ND BLOCK WILL BE USED FOR THE NEW ITEMS TO BE READ.        CL**1
02127 *    THE 1ST BLOCK WILL NOW CONTAIN THE ITEMS THAT WERE LAST         CL**1
02128 *    READ FROM THE DATA BASE.                                        CL**1
02129 *                                                                    CL**1
02130 *    PERFORMED BY F500-BROWSE.                                       CL**1
02131 ******************************************************************   CL**1
02132 *                                                                    CL**1
02133  G800-GET-LAST-BLOCK-IN-TEMP.                                        CL**1
02134 *                                                                    CL**1
02135      SET MB125-BLOCK-MODIFIED (1)                                    CL**1
02136                                TO  TRUE.                             CL**1
02137      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02138      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02139      SET MB125-BLOCK-MODIFIED (2)                                    CL**1
02140                                TO  TRUE.                             CL**1
02141      ADD +1                    TO  MB125-BLK-SUB.                    CL**1
02142      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02143 *                                                                    CL**1
02144      MOVE MB125-HIGHEST-BLOCK-WRITTEN                                CL**1
02145                                TO  PV-BLOCK-NUMBER.                  CL**1
02146      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02147      PERFORM Z100-READ-TEMP-STORAGE.                                 CL**1
02148 *                                                                    CL**1
02149      ADD +1                    TO  MB125-BLK-SUB.                    CL**1
02150      PERFORM I100-INITIALIZE-BLOCK.                                  CL**1
02151 *                                                                    CL**1
02152  EJECT                                                               CL**1
02153 ******************************************************************   CL**1
02154 *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE        CL**1
02155 *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,         CL**1
02156 *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND      CL**1
02157 *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE         CL**1
02158 *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                       CL**1
02159 *                                                                    CL**1
02160 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
02161 *    PERFORMED BY G400-READ-ITEMS-INTO-ARRAY.                        CL**1
02162 ******************************************************************   CL**1
02163 *                                                                    CL**1
02164  H100-READ-ITEMS-FROM-DB.                                            CL**1
02165 *                                                                    CL**1
02166      PERFORM                                                         CL**1
02167          UNTIL (MB125-NO-ITEMS-LEFT-ON-DB)   OR                      CL**1
02168                (MB125-NUMBER-OF-ITEMS-READ =                         CL**1
02169                 PV-HIGHEST-ITEM-TO-BE-READ)                          CL**1
02170 *                                                                    CL**1
02171          IF MB125-ITEM-SUB < PC-ITEMS-PER-BLOCK                      CL**1
02172              ADD +1            TO  MB125-ITEM-SUB                    CL**1
02173          ELSE                                                        CL**1
02174              ADD +1            TO  MB125-BLK-SUB                     CL**1
02175              MOVE +1           TO  MB125-ITEM-SUB                    CL**1
02176 *                                                                    CL**1
02177              IF MB125-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY               CL**1
02178                  MOVE +1       TO  MB125-BLK-SUB                     CL**1
02179                  SET MB125-BLOCK-MODIFIED (1)                        CL**1
02180                                TO  TRUE                              CL**1
02181                  PERFORM Z150-WRITE-TEMP-STORAGE                     CL**1
02182                  MOVE MB125-BLOCK-ENTRIES(PC-MAX-BLOCKS-IN-ARRAY)    CL**1
02183                  TO   MB125-BLOCK-ENTRIES(MB125-BLK-SUB)             CL**1
02184                  ADD +1        TO  MB125-BLK-SUB                     CL**1
02185                  PERFORM I100-INITIALIZE-BLOCK                       CL**1
02186              END-IF                                                  CL**1
02187          END-IF                                                      CL**1
02188 *                                                                    CL**1
02189          PERFORM L200-FETCH                                          CL**1
02190          IF  MB125-ITEMS-LEFT-ON-DB                                  CL**1
02191              SET MB125-BLOCK-MODIFIED (MB125-BLK-SUB)                CL*20
02192                                TO  TRUE                              CL*20
02193              ADD 1             TO  MB125-NUMBER-OF-ITEMS-READ        CL**1
02194                                    PV-ITEMS-READ                     CL**9
02195              MOVE MB125-NUMBER-OF-ITEMS-READ                         CL**1
02196                                TO  MB125-LIST-ITEM-NUMBER            CL**1
02197                                        (MB125-BLK-SUB                CL**1
02198                                         MB125-ITEM-SUB)              CL**1
02199              MOVE APLSYS-CDE   TO MB125-APLSYS-CODE                  CL**1
02200                                        (MB125-BLK-SUB                CL**1
02201                                         MB125-ITEM-SUB)              CL**1
02202              MOVE APLSYS-PRNT-APLSYS-CDE                             CL**1
02203                                TO MB125-PRNT-APLSYS-CODE             CL**1
02204                                        (MB125-BLK-SUB                CL**1
02205                                         MB125-ITEM-SUB)              CL**1
02206              MOVE APLSYS-MDSE-IND                                    CL**1
02207                                TO MB125-MDSE-IND                     CL**1
02208                                        (MB125-BLK-SUB                CL**1
02209                                         MB125-ITEM-SUB)              CL**1
02210              MOVE APLSYS-DESC  TO  MB125-APLSYS-DESC                 CL**1
02211                                        (MB125-BLK-SUB                CL**1
02212                                         MB125-ITEM-SUB)              CL**1
02213          END-IF                                                      CL**1
02214      END-PERFORM.                                                    CL**1
02215 *                                                                    CL**1
02216      MOVE APLSYS-CDE           TO  MB125-LAST-APLSYS-CODE.           CL**1
02217 *                                                                    CL**1
02218  EJECT                                                               CL**1
02219 *                                                                    CL**1
02220 ******************************************************************   CL**1
02221 *    FORMAT THE MAP AND DETERMINE THE CURSOR POSITION.               CL**1
02222 *                                                                    CL**1
02223 *    PERFORMED BY G100-DISPLAY-PANEL.                                CL**1
02224 ******************************************************************   CL**1
02225 *                                                                    CL**1
02226  H200-FORMAT-PANEL-BODY.                                             CL**1
02227 *                                                                    CL**1
02228      PERFORM I700-FORMAT-FROM-TO-LINE.                               CL**1
02229      PERFORM I200-FORMAT-LIST-LINES.                                 CL**1
02230      PERFORM I300-FORMAT-NR-SELECTED.                                CL**1
02231                                                                      CL**1
02232      IF NOT DP020-NEXT-ACT-ERROR                                     CL**1
02233          PERFORM I800-SET-CURSOR-POSITION                            CL**1
02234      END-IF.                                                         CL**1
02235 *                                                                    CL**1
02236  EJECT                                                               CL**1
02237 ******************************************************************   CL**1
02238 *    INITIALIZE A BLOCK IN THE ARRAY.                                CL**1
02239 *                                                                    CL**1
02240 *    PERFORMED BY D100-SETUP-INIT-PANEL.                             CL**1
02241 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02242 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02243 *    PERFORMED BY H100-READ-ITEMS-FROM-DB.                           CL**1
02244 ******************************************************************   CL**1
02245 *                                                                    CL**1
02246  I100-INITIALIZE-BLOCK.                                              CL**1
02247 *                                                                    CL**1
02248      INITIALIZE  MB125-BLOCK-ENTRIES (MB125-BLK-SUB).                CL**1
02249      SET MB125-BLOCK-NOT-MODIFIED(MB125-BLK-SUB) TO TRUE.            CL**1
02250  EJECT                                                               CL**1
02251 ******************************************************************   CL**1
02252 *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.        CL**1
02253 *                                                                    CL**1
02254 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
02255 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02256 ******************************************************************   CL**1
02257 *                                                                    CL**1
02258  I200-FORMAT-LIST-LINES.                                             CL**1
02259 *                                                                    CL**1
02260      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
02261          (MB125-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
02262 *                                                                    CL**1
02263      MOVE MB125-ITEM-AT-TOP-OF-PANEL                                 CL**1
02264                                TO  PV-ITEM-IN-USE.                   CL**1
02265      MOVE +1                   TO  PS-SUB.                           CL**1
02266 *                                                                    CL**1
02267      PERFORM J100-PROCESS-ITEMS                                      CL**1
02268          UNTIL PV-ITEM-IN-USE > PV-ENDING-ITEM-ON-PANEL.             CL**1
02269 *                                                                    CL**1
02270  EJECT                                                               CL**1
02271 ******************************************************************   CL**1
02272 *    FORMAT THE FIELD WHICH WILL SHOW THE NUMBER OF ITEMS THAT       CL**1
02273 *    WERE SELECTED BY THE USER.                                      CL**1
02274 *                                                                    CL**1
02275 *    PERFORMED BY E800-CHECK-FOR-JUMP-BROWSE.                        CL**1
02276 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02277 ******************************************************************   CL**1
02278 *                                                                    CL**1
02279  I300-FORMAT-NR-SELECTED.                                            CL**1
02280 *                                                                    CL**1
02281      MOVE MB125-NUMBER-OF-SELECTED-ITEMS                             CL**1
02282                                TO  PV-DISPLAY5.                      CL**1
02283      MOVE PV-DISPLAY5          TO  TOTSELO.                          CL**1
02284  EJECT                                                               CL**1
02285 ******************************************************************   CL**1
02286 *    FORMAT THE LINE THAT WILL SHOW THE TOTAL NUMBER OF ITEMS WE     CL**1
02287 *    HAVE ON OUR LIST AND SHOW THE NUMBERS ASSOCIATED WITH THE       CL**1
02288 *    FIRST AND LAST ITEMS ON CURRENT PAGE.  THIS WILL HELP THE       CL**1
02289 *    USER DETERMINE HOW FAR THEY ARE INTO THE LIST.                  CL**1
02290 *                                                                    CL**1
02291 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02292 ******************************************************************   CL**1
02293 *                                                                    CL**1
02294  I700-FORMAT-FROM-TO-LINE.                                           CL**1
02295 *                                                                    CL**1
02296      MOVE MB125-ITEM-AT-TOP-OF-PANEL                                 CL**1
02297                                TO  PV-DISPLAY5.                      CL**1
02298      MOVE PV-DISPLAY5          TO  ABEGITMO.                         CL**8
02299 *                                                                    CL**1
02300      MOVE DP015-GREEN          TO  ABEGITMC.                         CL**8
02301      MOVE DP015-UNDERLINE      TO  ABEGITMH.                         CL**8
02302      MOVE DP015-UNP-NUM-BRT-MDT                                      CL**1
02303                                TO  ABEGITMA.                         CL**8
02304 *                                                                    CL**1
02305      COMPUTE PV-ENDING-ITEM-ON-PANEL =                               CL**1
02306          (MB125-ITEM-AT-TOP-OF-PANEL + PC-ITEMS-PER-PANEL) - 1.      CL**1
02307 *                                                                    CL**1
02308      IF PV-ENDING-ITEM-ON-PANEL < MB125-NUMBER-OF-ITEMS-READ         CL**1
02309          MOVE PV-ENDING-ITEM-ON-PANEL                                CL**1
02310                                TO  PV-DISPLAY5                       CL**1
02311      ELSE                                                            CL**1
02312          MOVE MB125-NUMBER-OF-ITEMS-READ                             CL**1
02313                                TO  PV-DISPLAY5                       CL**1
02314      END-IF.                                                         CL**1
02315      MOVE PV-DISPLAY5          TO  ATOITMO.                          CL**8
02316 *                                                                    CL**1
02317      MOVE MB125-NUMBER-OF-ITEMS-READ                                 CL**1
02318                                TO  PV-DISPLAY5.                      CL**1
02319      MOVE PV-DISPLAY5          TO  ATOTITMO.                         CL**8
02320 *                                                                    CL**1
02321  EJECT                                                               CL**1
02322 ******************************************************************   CL**1
02323 *    IF NO ITEMS WERE READ FROM THE DATA BASE, POINT THE CURSOR      CL**1
02324 *    TO THE COMMAND LINE, OTHERWISE POINT THE CURSOR TO ONE OF       CL**1
02325 *    THE SELECTION ENTRIES.                                          CL**1
02326 *                                                                    CL**1
02327 *    PERFORMED BY H200-FORMAT-PANEL-BODY.                            CL**1
02328 ******************************************************************   CL**1
02329 *                                                                    CL**1
02330  I800-SET-CURSOR-POSITION.                                           CL**1
02331 *                                                                    CL**1
02332      IF MB125-NUMBER-OF-ITEMS-READ = +0                              CL**1
02333      AND DP020-MSG-NUMBER NOT NUMERIC                                CL**1
02334          MOVE -1               TO  ANAVCMDL                          CL**1
02335          MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER                  CL**1
02336          SET DP020-MSG-WARNING TO  TRUE                              CL**1
02337      ELSE                                                            CL**1
02338 *                                                                    CL**1
02339          IF (PS-CURSOR-NOT-POSITIONED) OR                            CL**1
02340             (PS-WARNING)               OR                            CL**1
02341             (PS-INFORMATIONAL)                                       CL**1
02342              PERFORM J200-FIND-LAST-SELECTION                        CL**1
02343          END-IF                                                      CL**1
02344      END-IF.                                                         CL**1
02345 *                                                                    CL**1
02346  EJECT                                                               CL**1
02347 ******************************************************************   CL**1
02348 *    PROCESS EACH ITEM IN THE ARRAY AND MOVE IT TO THE MAP.          CL**1
02349 *    FILL THE MAP UNTIL WE HAVE REACHED THE MAXIMUM NUMBER OF        CL**1
02350 *    MAP ENTRIES.                                                    CL**1
02351 *                                                                    CL**1
02352 *    PERFORMED BY I200-FORMAT-LIST-LINES.                            CL**1
02353 ******************************************************************   CL**1
02354 *                                                                    CL**1
02355  J100-PROCESS-ITEMS.                                                 CL**1
02356 *                                                                    CL**1
02357      IF (PV-ITEM-IN-USE < MB125-NUMBER-OF-ITEMS-READ) OR             CL**1
02358         (PV-ITEM-IN-USE = MB125-NUMBER-OF-ITEMS-READ)                CL**1
02359          PERFORM K100-SET-SUBSCRIPTS                                 CL**1
02360          MOVE DP015-UNP-ALP-BRT-MDT                                  CL**1
02361                                TO  MBKM125-SELECTA(PS-SUB)           CL**1
02362 *                                                                    CL**1
02363          IF (MB125-SELECT(MB125-BLK-SUB MB125-ITEM-SUB))             CL**1
02364          OR (MB125-NO-SELECT(MB125-BLK-SUB MB125-ITEM-SUB))          CL**1
02365              MOVE DP015-UNDERLINE TO MBKM125-SELECTH(PS-SUB)         CL**9
02366              MOVE DP015-GREEN     TO MBKM125-SELECTC(PS-SUB)         CL**1
02367          ELSE                                                        CL**1
02368 *                                                                    CL**1
02369              IF (MB125-BEGIN(MB125-BLK-SUB MB125-ITEM-SUB))          CL**1
02370              OR (MB125-END(MB125-BLK-SUB MB125-ITEM-SUB))            CL**1
02371                  MOVE DP015-UNDERLINE   TO MBKM125-SELECTH(PS-SUB)   CL**9
02372                  MOVE DP015-GREEN       TO MBKM125-SELECTC(PS-SUB)   CL**1
02373                  IF (DP020-MSG-NUMBER  =    PC-TSYMSG-00051          CL**1
02374                                          OR PC-TSYMSG-00053          CL**1
02375                     )                                                CL**1
02376 *                    UNPAIRED RANGE CHARACTER, SET WARNING           CL**1
02377 *                    ATTRIBUTES FOR RANGE CHARACTER:                 CL**1
02378                      MOVE DP015-REVERSE TO MBKM125-SELECTH(PS-SUB)   CL**9
02379                      MOVE DP015-YELLOW  TO MBKM125-SELECTC(PS-SUB)   CL**1
02380                  END-IF                                              CL**1
02381 *                                                                    CL**1
02382                  IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00054         CL**1
02383                      AND MB125-BEGIN( MB125-BLK-SUB                  CL**1
02384                                       MB125-ITEM-SUB   )             CL**1
02385                     )                                                CL**1
02386 *                    TWO OR MORE START-OF-RANGE CHARACTERS, SET      CL**1
02387 *                    ATTRIBUTES FOR START-OF-RANGE CHARACTERS:       CL**1
02388                      MOVE DP015-REVERSE TO MBKM125-SELECTH(PS-SUB)   CL**9
02389                      MOVE DP015-RED     TO MBKM125-SELECTC(PS-SUB)   CL**1
02390                  END-IF                                              CL**1
02391 *                                                                    CL**1
02392                  IF (    DP020-MSG-NUMBER  = PC-TSYMSG-00055         CL**1
02393                      AND MB125-END( MB125-BLK-SUB                    CL**1
02394                                     MB125-ITEM-SUB   )               CL**1
02395                     )                                                CL**1
02396 *                    TWO OR MORE END-OF-RANGE CHARACTERS, SET        CL**1
02397 *                    ATTRIBUTES FOR END-OF-RANGE CHARACTERS:         CL**1
02398                      MOVE DP015-REVERSE TO MBKM125-SELECTH(PS-SUB)   CL**9
02399                      MOVE DP015-RED     TO MBKM125-SELECTC(PS-SUB)   CL**1
02400                  END-IF                                              CL**1
02401 *                                                                    CL**1
02402                  IF  DP020-MSG-NUMBER  =  PC-TSYMSG-00052            CL**1
02403 *                    END-OF-RANGE PRECEDES START OF RANGE, SET       CL**1
02404 *                    ATTRIBUTES OF RANGE CHARACTERS:                 CL**1
02405                      MOVE DP015-REVERSE TO MBKM125-SELECTH(PS-SUB)   CL**9
02406                      MOVE DP015-RED     TO MBKM125-SELECTC(PS-SUB)   CL**1
02407                  END-IF                                              CL**1
02408              END-IF                                                  CL**1
02409                                                                      CL**1
02410          END-IF                                                      CL**1
02411                                                                      CL**1
02412          MOVE MB125-SELECTED-SW(MB125-BLK-SUB MB125-ITEM-SUB)        CL**1
02413                                TO  MBKM125-SELECTI(PS-SUB)           CL**1
02414 *                                                                    CL**1
02415          IF (PS-SEND-MAP-N-DATA-FRSET)                               CL**1
02416          OR (PS-DIFFERENT-ITEMS-DISPLAYED)                           CL**1
02417              MOVE MB125-APLSYS-CODE (MB125-BLK-SUB MB125-ITEM-SUB)   CL**1
02418                                TO  MBKM125-APLSYS-CODE (PS-SUB)      CL**1
02419 *                                                                    CL**1
02420              MOVE MB125-PRNT-APLSYS-CODE                             CL**4
02421                                     (MB125-BLK-SUB MB125-ITEM-SUB)   CL**4
02422                                TO  MBKM125-PRNT-APLSYS-CODE          CL**4
02423                                                        (PS-SUB)      CL**4
02424 *                                                                    CL**4
02425              MOVE MB125-APLSYS-DESC (MB125-BLK-SUB MB125-ITEM-SUB)   CL**2
02426                                TO  MBKM125-APLSYS-DESC (PS-SUB)      CL**2
02427 *                                                                    CL**4
02428              MOVE MB125-MDSE-IND    (MB125-BLK-SUB MB125-ITEM-SUB)   CL**4
02429                                TO  MBKM125-MDSE-IND    (PS-SUB)      CL**4
02430 *                                                                    CL**1
02431          END-IF                                                      CL**1
02432                                                                      CL**1
02433      ELSE                                                            CL**1
02434                                                                      CL**1
02435          IF (PS-SEND-MAP-N-DATA-FRSET)     OR                        CL**1
02436             (PS-DIFFERENT-ITEMS-DISPLAYED)                           CL**1
02437              MOVE SPACES       TO  MBKM125-APLSYS-CODE (PS-SUB)      CL**1
02438                                    MBKM125-PRNT-APLSYS-CODE          CL**4
02439                                                        (PS-SUB)      CL**4
02440                                    MBKM125-MDSE-IND    (PS-SUB)      CL**4
02441                                    MBKM125-APLSYS-DESC (PS-SUB)      CL**4
02442                                    MBKM125-SELECTI  (PS-SUB)         CL**1
02443              MOVE DP015-ASK-DRK-OFF                                  CL**1
02444                                TO  MBKM125-SELECTA(PS-SUB)           CL**1
02445          END-IF                                                      CL**1
02446                                                                      CL**1
02447      END-IF.                                                         CL**1
02448                                                                      CL**1
02449      ADD +1 TO PV-ITEM-IN-USE.                                       CL**1
02450      ADD +1 TO PS-SUB.                                               CL**1
02451  EJECT                                                               CL**1
02452 ******************************************************************   CL**1
02453 *    FIND THE LAST SELECTION ENTRY IN THE MAP THAT IS NOT            CL**1
02454 *    SPACES OR LOW VALUES AND POINT THE CURSOR TO THIS ENTRY.        CL**1
02455 *    IF ALL ENTRIES ARE SPACES OR LOW VALUES, POINT THE CURSOR       CL**1
02456 *    TO THE 1ST SELECTION ENTRY IN THE MAP.                          CL**1
02457 *                                                                    CL**1
02458 *    PERFORMED BY I800-SET-CURSOR-POSITION.                          CL**1
02459 ******************************************************************   CL**1
02460 *                                                                    CL**1
02461  J200-FIND-LAST-SELECTION.                                           CL**1
02462 *                                                                    CL**1
02463      MOVE PC-ITEMS-PER-PANEL TO PS-SUB.                              CL**1
02464                                                                      CL**1
02465      SET PS-NO-SELECTION-FOUND TO TRUE.                              CL**1
02466                                                                      CL**1
02467      PERFORM                                                         CL**1
02468          UNTIL (PS-SUB = +1)                                         CL**1
02469             OR (PS-SELECTION-FOUND)                                  CL**1
02470 *                                                                    CL**1
02471          IF (MBKM125-SELECTI(PS-SUB) NOT EQUAL SPACES                CL**1
02472          AND MBKM125-SELECTI(PS-SUB) NOT EQUAL LOW-VALUE)            CL**1
02473              SET PS-SELECTION-FOUND                                  CL**1
02474                                TO  TRUE                              CL**1
02475          ELSE                                                        CL**1
02476              SUBTRACT +1     FROM  PS-SUB                            CL**1
02477          END-IF                                                      CL**1
02478      END-PERFORM.                                                    CL**1
02479                                                                      CL**1
02480      MOVE -1                 TO  MBKM125-SELECTL(PS-SUB).            CL**1
02481 *                                                                    CL**1
02482  EJECT                                                               CL**1
02483 ******************************************************************   CL**1
02484 *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM     CL**1
02485 *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL    CL**1
02486 *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                      CL**1
02487 *                                                                    CL**1
02488 *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS       CL**1
02489 *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT        CL**1
02490 *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION      CL**1
02491 *    US IN THE 2ND BLOCK OF THE ARRAY.                               CL**1
02492 *                                                                    CL**1
02493 *    PERFORMED BY E100-EDIT-SELECTIONS.                              CL**1
02494 *    PERFORMED BY F100-EDIT.                                         CL**1
02495 *    PERFORMED BY F300-CHECK-SELECTIONS.                             CL**1
02496 *    PERFORMED BY J100-PROCESS-ITEMS.                                CL**1
02497 ******************************************************************   CL**1
02498 *                                                                    CL**1
02499  K100-SET-SUBSCRIPTS.                                                CL**1
02500 *                                                                    CL**1
02501      COMPUTE PS-ITEM-SUB =                                           CL**1
02502          (PV-ITEM-IN-USE - MB125-LIST-ITEM-NUMBER(1 1)) + 1.         CL**1
02503                                                                      CL**1
02504      MOVE PS-ITEM-SUB TO MB125-ITEM-SUB.                             CL**1
02505                                                                      CL**1
02506      IF MB125-ITEM-SUB > PC-ITEMS-PER-BLOCK                          CL**1
02507          SUBTRACT PC-ITEMS-PER-BLOCK FROM MB125-ITEM-SUB             CL**1
02508                                                                      CL**1
02509          MOVE PC-MAX-BLOCKS-IN-ARRAY TO MB125-BLK-SUB                CL**1
02510      ELSE                                                            CL**1
02511          MOVE +1                     TO MB125-BLK-SUB                CL**1
02512      END-IF.                                                         CL**1
02513 *                                                                    CL**1
02514  EJECT                                                               CL**1
02515 ******************************************************************   CL**1
02516 *    OPEN THE APPLICATION SYSTEM LIST CURSOR.                        CL**3
02517 *                                                                    CL**1
02518 *    PERFORMED BY D100                                               CL**1
02519 ******************************************************************   CL**1
02520 *                                                                    CL**1
02521  L100-OPEN-CURSOR.                                                   CL**1
02522 *                                                                    CL**1
02523      MOVE MB125-LAST-APLSYS-CODE                                     CL**1
02524                                TO APLSYS-CDE.                        CL**1
02525      PERFORM                                                         CL**1
02526          WITH TEST AFTER                                             CL**1
02527          VARYING PV-SQL-SUB                                          CL**1
02528          FROM 1 BY 1                                                 CL**1
02529          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
02530             OR SQLCODE = 0                                           CL**1
02531             OR SQLCODE = +100                                        CL**1
02532 *                                                                    CL**1
02533          EXEC SQL                                                    CL**1
02534               OPEN APLSYS-LIST                                       CL**1
02535          END-EXEC                                                    CL**1
02536 *                                                                    CL**1
02537          EVALUATE TRUE                                               CL**1
02538              WHEN SQLCODE = -904                                     CL**1
02539              WHEN SQLCODE = -913                                     CL**1
02540              WHEN SQLCODE = ZERO                                     CL**1
02541              WHEN SQLCODE = +100                                     CL**1
02542                   CONTINUE                                           CL**1
02543              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
02544              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
02545                   MOVE 'L100-OPEN-CURSOR'                            CL**1
02546                                TO  DP013-PARAGRAPH                   CL**1
02547                   MOVE 'OPEN APLSYS-LIST CURSOR'                     CL**1
02548                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02549                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
02550                   SET DP013-DB2-ABEND                                CL**1
02551                                TO  TRUE                              CL**1
02552                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
02553          END-EVALUATE                                                CL**1
02554      END-PERFORM.                                                    CL**1
02555 *                                                                    CL**1
02556      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
02557          MOVE 'L100-OPEN-CURSOR'                                     CL**1
02558                                TO  DP013-PARAGRAPH                   CL**1
02559          MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'                 CL**1
02560                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02561          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
02562          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
02563          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02564      END-IF.                                                         CL**1
02565 *                                                                    CL**1
02566  EJECT                                                               CL**1
02567 ******************************************************************   CL**1
02568 *    FETCH THE ROWS FROM TMDSEBG.                                    CL**1
02569 *                                                                    CL**1
02570 *    PERFORMED BY H100                                               CL**1
02571 ******************************************************************   CL**1
02572 *                                                                    CL**1
02573  L200-FETCH.                                                         CL**1
02574 *                                                                    CL**1
02575      PERFORM                                                         CL**1
02576          WITH TEST AFTER                                             CL**1
02577          VARYING PV-SQL-SUB                                          CL**1
02578          FROM 1 BY 1                                                 CL**1
02579          UNTIL PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                CL**1
02580             OR SQLCODE = 0                                           CL**1
02581             OR SQLCODE = +100                                        CL**1
02582 *                                                                    CL**1
02583          EXEC SQL                                                    CL**1
02584               FETCH APLSYS-LIST                                      CL**1
02585               INTO                                                   CL**1
02586                     :APLSYS-CDE,                                     CL**1
02587                     :APLSYS-PRNT-APLSYS-CDE,                         CL**1
02588                     :APLSYS-MDSE-IND,                                CL**1
02589                     :APLSYS-DESC                                     CL**1
02590          END-EXEC                                                    CL**1
02591 *                                                                    CL**1
02592          EVALUATE TRUE                                               CL**1
02593              WHEN SQLCODE = -904                                     CL**1
02594              WHEN SQLCODE = -913                                     CL**1
02595              WHEN SQLCODE = ZERO                                     CL**1
02596              WHEN SQLCODE = +100                                     CL**1
02597                   CONTINUE                                           CL**1
02598              WHEN SQLWARN0 NOT EQUAL SPACE                           CL**1
02599              WHEN SQLCODE NOT EQUAL ZERO                             CL**1
02600                   MOVE 'L200-FETCH'                                  CL**1
02601                                TO  DP013-PARAGRAPH                   CL**1
02602                   MOVE 'FETCH APLSYS-LIST CURSOR'                    CL**1
02603                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02604                   MOVE SQLCA   TO  DP013-SQLCA                       CL**1
02605                   SET DP013-DB2-ABEND                                CL**1
02606                                TO  TRUE                              CL**1
02607                   PERFORM DP013-0000-PROCESS-ABEND                   CL**1
02608          END-EVALUATE                                                CL**1
02609      END-PERFORM.                                                    CL**1
02610 *                                                                    CL**1
02611      IF  PV-SQL-SUB GREATER THAN PC-MAX-RETRIES                      CL**1
02612          MOVE 'L200-FETCH'                                           CL**1
02613                                TO  DP013-PARAGRAPH                   CL**1
02614          MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'                CL**1
02615                                TO  DP013-MESSAGE-TEXT (1)            CL**1
02616          MOVE SQLCA            TO  DP013-SQLCA                       CL**1
02617          SET DP013-DB2-ABEND   TO  TRUE                              CL**1
02618          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02619      END-IF.                                                         CL**1
02620 *                                                                    CL**1
02621      IF  SQLCODE EQUAL +100                                          CL**1
02622          SET MB125-NO-ITEMS-LEFT-ON-DB                               CL**1
02623                                TO  TRUE                              CL**1
02624      END-IF.                                                         CL**1
02625 *                                                                    CL**1
02626  EJECT                                                               CL**1
02627 ******************************************************************   CL**1
02628 *    PREPARE THE TEMPORARY STORAGE QUEUE.  MOVE ALL SELECTED         CL**1
02629 *    APLSYS FROM EITHER TEMP STORAGE OR THE ARRAY IN THE COMM        CL**3
02630 *    AREA TO THE LIST TS QUEUE RECORD(S).                            CL**1
02631 *                                                                    CL**1
02632 *    PERFORMED BY D300                                               CL**1
02633 ******************************************************************   CL**1
02634 *                                                                    CL**1
02635  X100-PREPARE-LIST-QUEUE.                                            CL**1
02636 *                                                                    CL**1
02637      MOVE +1                   TO  MB125-BLK-SUB.                    CL**1
02638      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02639      ADD +1                    TO  MB125-BLK-SUB.                    CL**1
02640      PERFORM Z150-WRITE-TEMP-STORAGE.                                CL**1
02641 *                                                                    CL**1
02642      IF  MB125-HIGHEST-BLOCK-WRITTEN = ZERO                          CL**1
02643          MOVE EIBTRMID         TO  PV-BG-TERM-ID                     CL**1
02644          MOVE EIBTASKN         TO  PV-BG-TASK-NUMBER                 CL**1
02645      ELSE                                                            CL**1
02646          MOVE MB125-TERM-ID    TO  PV-BG-TERM-ID                     CL**1
02647          MOVE MB125-TASK-NUMBER                                      CL**1
02648                                TO  PV-BG-TASK-NUMBER                 CL**1
02649      END-IF.                                                         CL**1
02650      SUBTRACT 1              FROM  PV-BG-TASK-NUMBER.                CL**1
02651 *                                                                    CL**1
02652      MOVE PV-BG-QUEUE-NAME     TO  MB005-LIST-QUEUE-NAME             CL**1
02653                                    MB125-LIST-QUEUE-NAME.            CL**1
02654      MOVE LENGTH OF APLSYS-LIST-RECORD                               CL**2
02655                                TO  MB005-LIST-QUEUE-LENGTH.          CL**1
02656      PERFORM X900-DELETE-LIST-QUEUE.                                 CL**1
02657 *                                                                    CL**1
02658      SET MBWS125-IDX           TO  1.                                CL**1
02659      INITIALIZE APLSYS-LIST-RECORD.                                  CL**3
02660      PERFORM X200-PROCESS-TS-QUEUE                                   CL**1
02661              VARYING PV-ITEM                                         CL**1
02662              FROM 1 BY 1                                             CL**1
02663              UNTIL PV-ITEM GREATER MB125-HIGHEST-BLOCK-WRITTEN.      CL**1
02664 *                                                                    CL**1
02665      PERFORM X500-WRITE-LIST-QUEUE.                                  CL**1
02666 *                                                                    CL**1
02667  EJECT                                                               CL**1
02668 ******************************************************************   CL**1
02669 *    READ A TS QUEUE RECORD, MOVE SELECTED RECORDS TO THE            CL**1
02670 *    APPLICATIONS SYSTEM LIST QUEUE RECORD.                          CL**3
02671 *                                                                    CL**1
02672 *    PERFORMED BY X100                                               CL**1
02673 ******************************************************************   CL**1
02674 *                                                                    CL**1
02675  X200-PROCESS-TS-QUEUE.                                              CL**1
02676 *                                                                    CL**1
02677      PERFORM X300-READ-TS-QUEUE.                                     CL*15
02678      IF  PV-RESP EQUAL DFHRESP(NORMAL)                               CL**1
02679          PERFORM                                                     CL**1
02680          VARYING PV-TW-IDX                                           CL**1
02681          FROM 1 BY 1                                                 CL**1
02682          UNTIL PV-TW-IDX GREATER THAN PC-ITEMS-PER-BLOCK             CL**1
02683            OR  PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX) EQUAL ZERO         CL**1
02684 *                                                                    CL**1
02685              IF  PV-TW-SELECT (PV-TW-IDX)                            CL**1
02686                  MOVE PV-TW-APLSYS-CODE (PV-TW-IDX)                  CL**1
02687                                TO  MBWS125-APLSYS-CODE               CL**1
02688                                         (MBWS125-IDX)                CL**1
02689                                    MBWS125-LAST-APLSYS-CODE          CL**1
02690                  MOVE PV-TW-LIST-ITEM-NUMBER (PV-TW-IDX)             CL*12
02691                                TO  MBWS125-ITEM (MBWS125-IDX)        CL*12
02692                  IF  MBWS125-IDX EQUAL 1                             CL**1
02693                      MOVE MBWS125-LAST-APLSYS-CODE                   CL**1
02694                                TO  MBWS125-FIRST-APLSYS-CODE         CL**1
02695                  END-IF                                              CL**1
02696                  SET MBWS125-IDX UP BY 1                             CL**1
02697                  IF  MBWS125-IDX GREATER PC-MAX-APLSYS-CODES         CL**2
02698                      PERFORM X500-WRITE-LIST-QUEUE                   CL**1
02699                  END-IF                                              CL**1
02700              END-IF                                                  CL**1
02701 *                                                                    CL**1
02702          END-PERFORM                                                 CL**1
02703      END-IF.                                                         CL**1
02704 *                                                                    CL*12
02705  EJECT                                                               CL*12
02706 ******************************************************************   CL*12
02707 *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.    CL*12
02708 *                                                                    CL*12
02709 *    PERFORMED BY C500, X200                                         CL*12
02710 ******************************************************************   CL*12
02711 *                                                                    CL*12
02712  X300-READ-TS-QUEUE.                                                 CL*15
02713 *                                                                    CL*12
02714      EXEC CICS                                                       CL*12
02715          READQ TS                                                    CL*12
02716          QUEUE(MB125-TEMP-QUEUE-NAME)                                CL*12
02717          INTO(PV-TEMP-WORK-AREA)                                     CL*12
02718          LENGTH(PC-BLOCK-LENGTH)                                     CL*12
02719          ITEM(PV-ITEM)                                               CL*12
02720          RESP(PV-RESP)                                               CL*12
02721      END-EXEC.                                                       CL*12
02722 *                                                                    CL**1
02723  EJECT                                                               CL**1
02724 ******************************************************************   CL**1
02725 *    WRITE THE SKU LIST QUEUE RECORD.                                CL**1
02726 *                                                                    CL**1
02727 *    PERFORMED BY X100                                               CL**1
02728 ******************************************************************   CL**1
02729 *                                                                    CL**1
02730  X500-WRITE-LIST-QUEUE.                                              CL**1
02731 *                                                                    CL**1
02732      IF  MBWS125-IDX GREATER THAN 1                                  CL**1
02733          MOVE PC-MAX-APLSYS-CODES                                    CL**1
02734                                TO  MBWS125-MAX-APLSYS-CODES          CL**1
02735          MOVE MB125-NUMBER-OF-SELECTED-ITEMS                         CL**1
02736                                TO  MBWS125-SELECTED-APLSYS-CODES     CL**3
02737 *                                                                    CL**6
02738          IF  DP020-SRC-AID EQUAL DP016-PF15                          CL**6
02739              SET MBWS125-UPDATE  TO  TRUE                            CL**6
02740          ELSE                                                        CL**6
02741              SET MBWS125-DELETE  TO  TRUE                            CL**6
02742          END-IF                                                      CL**6
02743 *                                                                    CL**1
02744          EXEC CICS                                                   CL**1
02745               WRITEQ TS                                              CL**1
02746               QUEUE(MB005-LIST-QUEUE-NAME)                           CL**1
02747               FROM(APLSYS-LIST-RECORD)                               CL**1
02748               LENGTH(MB005-LIST-QUEUE-LENGTH)                        CL**1
02749               ITEM(PV-AS-ITEM)                                       CL*12
02750               RESP(PV-RESP)                                          CL**1
02751          END-EXEC                                                    CL**1
02752 *                                                                    CL**1
02753          IF  PV-RESP NOT EQUAL DFHRESP(NORMAL)                       CL**1
02754              SET PS-DONT-PROCESS                                     CL*16
02755                                TO  TRUE                              CL**1
02756          END-IF                                                      CL**1
02757 *                                                                    CL**1
02758          INITIALIZE APLSYS-LIST-RECORD                               CL**1
02759          SET MBWS125-IDX       TO  1                                 CL**1
02760      END-IF.                                                         CL**1
02761 *                                                                    CL*12
02762  EJECT                                                               CL*12
02763 ******************************************************************   CL*12
02764 *    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.                 CL*12
02765 *                                                                    CL*12
02766 *    PERFORMED BY C500, C600                                         CL*12
02767 ******************************************************************   CL*12
02768 *                                                                    CL*12
02769  X550-WRITE-TS-QUEUE.                                                CL*12
02770 *                                                                    CL*12
02771      EXEC CICS                                                       CL*12
02772          WRITEQ TS                                                   CL*12
02773          REWRITE                                                     CL*12
02774          QUEUE(MB125-TEMP-QUEUE-NAME)                                CL*12
02775          FROM(PV-TEMP-WORK-AREA)                                     CL*12
02776          LENGTH(PC-BLOCK-LENGTH)                                     CL*12
02777          ITEM(PV-SAVE-ITEM)                                          CL*12
02778          RESP(PV-RESP)                                               CL*12
02779      END-EXEC.                                                       CL*12
02780 *                                                                    CL*12
02781  EJECT                                                               CL*12
02782 ******************************************************************   CL*12
02783 *    READ THE LIST QUEUE RECORD.                                     CL*12
02784 *                                                                    CL*12
02785 *    PERFORMED BY C500                                               CL*12
02786 ******************************************************************   CL*12
02787 *                                                                    CL*12
02788  X600-READ-LIST-QUEUE.                                               CL*12
02789 *                                                                    CL*12
02790      EXEC CICS                                                       CL*12
02791           READQ TS                                                   CL*12
02792           QUEUE(MB005-LIST-QUEUE-NAME)                               CL*12
02793           INTO(APLSYS-LIST-RECORD)                                   CL*12
02794           LENGTH(MB005-LIST-QUEUE-LENGTH)                            CL*12
02795           ITEM(PV-AS-ITEM)                                           CL*12
02796           RESP(PV-RESP)                                              CL*12
02797      END-EXEC.                                                       CL*12
02798 *                                                                    CL**1
02799  EJECT                                                               CL**1
02800 ******************************************************************   CL**1
02801 *    DELETE THE SKU LIST TEMP STORAGE QUEUE.                         CL**1
02802 *                                                                    CL**1
02803 *    PERFORMED BY X100                                               CL**1
02804 ******************************************************************   CL**1
02805 *                                                                    CL**1
02806  X900-DELETE-LIST-QUEUE.                                             CL**1
02807 *                                                                    CL**1
02808      EXEC CICS                                                       CL**1
02809          DELETEQ TS                                                  CL**1
02810          QUEUE(MB005-LIST-QUEUE-NAME)                                CL**1
02811          RESP(PV-RESP)                                               CL**1
02812      END-EXEC.                                                       CL**1
02813  EJECT                                                               CL**1
02814 *                                                                    CL**1
02815 ******************************************************************   CL**1
02816 *    DELETE THE TEMPORARY STORAGE QUEUE.                             CL**1
02817 *                                                                    CL**1
02818 *    PERFORMED BY C300-PROCESS-PANEL.                                CL**1
02819 ******************************************************************   CL**1
02820 *                                                                    CL**1
02821  Z050-DELETE-TEMP-STORAGE.                                           CL**1
02822 *                                                                    CL**1
02823      EXEC CICS                                                       CL**1
02824          DELETEQ TS                                                  CL**1
02825          QUEUE(MB125-TEMP-QUEUE-NAME)                                CL**1
02826          RESP(PV-RESP)                                               CL**1
02827      END-EXEC.                                                       CL**1
02828                                                                      CL**1
02829      IF (PV-RESP NOT = DFHRESP(NORMAL)) AND                          CL**1
02830         (PV-RESP NOT = DFHRESP(QIDERR))                              CL**1
02831          MOVE PV-RESP TO PM-RESP-23                                  CL**1
02832                                                                      CL**1
02833          SET DP013-LOGIC-ABEND TO TRUE                               CL**1
02834          SET DP013-NO-ROLLBACK TO TRUE                               CL**1
02835                                                                      CL**1
02836          MOVE 'Z050-DELETE-TEMP-STORAGE' TO DP013-PARAGRAPH          CL**1
02837          MOVE PM-PROGRAM-MESSAGE-23      TO DP013-MESSAGE-TEXT(1)    CL**1
02838                                                                      CL**1
02839          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02840      END-IF.                                                         CL**1
02841                                                                      CL**1
02842      MOVE +0 TO MB125-HIGHEST-BLOCK-WRITTEN.                         CL**1
02843  EJECT                                                               CL**1
02844 ******************************************************************   CL**1
02845 *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.             CL**1
02846 *                                                                    CL**1
02847 *    PERFORMED BY D400-REFRESH-BLOCK-ARRAY.                          CL**1
02848 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
02849 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
02850 *    PERFORMED BY G500-SCROLL-FORWARD.                               CL**1
02851 *    PERFORMED BY G600-SCROLL-BACKWARD.                              CL**1
02852 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02853 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02854 ******************************************************************   CL**1
02855 *                                                                    CL**1
02856  Z100-READ-TEMP-STORAGE.                                             CL**1
02857 *                                                                    CL**1
02858      EXEC CICS                                                       CL**1
02859          READQ TS                                                    CL**1
02860          QUEUE(MB125-TEMP-QUEUE-NAME)                                CL**1
02861          INTO(MB125-BLOCK-ENTRIES(MB125-BLK-SUB))                    CL**1
02862          LENGTH(PC-BLOCK-LENGTH)                                     CL**1
02863          ITEM(PV-BLOCK-NUMBER)                                       CL**1
02864          RESP(PV-RESP)                                               CL**1
02865      END-EXEC.                                                       CL**1
02866 *                                                                    CL**1
02867      IF PV-RESP NOT = DFHRESP(NORMAL)                                CL**1
02868          MOVE PV-RESP          TO  PM-RESP-24                        CL**1
02869          EXEC CICS                                                   CL**1
02870               DELETEQ TS                                             CL**1
02871               QUEUE(MB125-TEMP-QUEUE-NAME)                           CL**1
02872               RESP(PV-RESP)                                          CL**1
02873          END-EXEC                                                    CL**1
02874          SET DP013-LOGIC-ABEND TO  TRUE                              CL**1
02875          SET DP013-NO-ROLLBACK TO  TRUE                              CL**1
02876          MOVE 'Z100-READ-TEMP-STORAGE'                               CL**1
02877                                TO  DP013-PARAGRAPH                   CL**1
02878          MOVE PM-PROGRAM-MESSAGE-24                                  CL**1
02879                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02880          PERFORM DP013-0000-PROCESS-ABEND                            CL**1
02881      END-IF.                                                         CL**1
02882                                                                      CL**1
02883      SET MB125-BLOCK-NOT-MODIFIED(MB125-BLK-SUB) TO TRUE.            CL**1
02884  EJECT                                                               CL**1
02885 ******************************************************************   CL**1
02886 *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.          CL**1
02887 *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.        CL**1
02888 *                                                                    CL**1
02889 *    PERFORMED BY E300-NAVIGATE.                                     CL**1
02890 *    PERFORMED BY E700-DESELECT-ALL-ITEMS.                           CL**1
02891 *    PERFORMED BY F200-MARK-RANGE-AS-SELECTED.                       CL**1
02892 *    PERFORMED BY G500-SCROLL-FORWARD.                               CL**1
02893 *    PERFORMED BY G600-SCROLL-BACKWARD.                              CL**1
02894 *    PERFORMED BY G700-GET-TOP-ITEMS-BLOCK.                          CL**1
02895 *    PERFORMED BY G800-GET-LAST-BLOCK-IN-TEMP.                       CL**1
02896 *    PERFORMED BY H100-READ-ITEMS-FROM-DB.                           CL**1
02897 ******************************************************************   CL**1
02898 *                                                                    CL**1
02899  Z150-WRITE-TEMP-STORAGE.                                            CL**1
02900 *                                                                    CL**1
02901      IF MB125-HIGHEST-BLOCK-WRITTEN = +0                             CL**1
02902          MOVE EIBTASKN         TO  DP020-SRC-TASK-NUMBER             CL**1
02903          MOVE EIBTASKN         TO  MB125-TASK-NUMBER                 CL**1
02904          MOVE EIBTRMID         TO  MB125-TERM-ID                     CL**1
02905      END-IF.                                                         CL**1
02906 *                                                                    CL**1
02907      MOVE MB125-LIST-ITEM-NUMBER(MB125-BLK-SUB 1)                    CL**1
02908                                TO  PV-LIST-ITEM-NUMBER.              CL**1
02909      COMPUTE PV-BLOCK-NUMBER =                                       CL**1
02910          1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-BLOCK).       CL**1
02911 *                                                                    CL**1
02912      IF (PV-BLOCK-NUMBER < MB125-HIGHEST-BLOCK-WRITTEN)              CL**1
02913      OR (PV-BLOCK-NUMBER = MB125-HIGHEST-BLOCK-WRITTEN)              CL**1
02914          IF  MB125-BLOCK-MODIFIED(MB125-BLK-SUB)                     CL**1
02915              EXEC CICS                                               CL**1
02916                  WRITEQ TS                                           CL**1
02917                  QUEUE(MB125-TEMP-QUEUE-NAME)                        CL**1
02918                  FROM(MB125-BLOCK-ENTRIES(MB125-BLK-SUB))            CL**1
02919                  LENGTH(PC-BLOCK-LENGTH)                             CL**1
02920                  ITEM(PV-BLOCK-NUMBER)                               CL**1
02921                  REWRITE                                             CL**1
02922                  RESP(PV-RESP)                                       CL**1
02923              END-EXEC                                                CL**1
02924 *                                                                    CL**1
02925              IF  PV-RESP NOT = DFHRESP(NORMAL)                       CL**1
02926                  MOVE PV-RESP  TO  PM-RESP-9                         CL**1
02927                  EXEC CICS                                           CL**1
02928                      DELETEQ TS                                      CL**1
02929                      QUEUE(MB125-TEMP-QUEUE-NAME)                    CL**1
02930                      RESP(PV-RESP)                                   CL**1
02931                  END-EXEC                                            CL**1
02932 *                                                                    CL**1
02933                  SET DP013-LOGIC-ABEND                               CL**1
02934                                TO  TRUE                              CL**1
02935                  SET DP013-NO-ROLLBACK                               CL**1
02936                                TO  TRUE                              CL**1
02937                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**1
02938                                TO  DP013-PARAGRAPH                   CL**1
02939                  MOVE PM-PROGRAM-MESSAGE-9                           CL**1
02940                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02941                  PERFORM DP013-0000-PROCESS-ABEND                    CL**1
02942              END-IF                                                  CL**1
02943          END-IF                                                      CL**1
02944      ELSE                                                            CL**1
02945 *                                                                    CL**1
02946          COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                          CL**1
02947              MB125-HIGHEST-BLOCK-WRITTEN + 1                         CL**1
02948          IF  PV-BLOCK-NUMBER = PV-HIGHEST-BLOCK-WRITTEN              CL**1
02949              EXEC CICS                                               CL**1
02950                  WRITEQ TS                                           CL**1
02951                  QUEUE(MB125-TEMP-QUEUE-NAME)                        CL**1
02952                  FROM(MB125-BLOCK-ENTRIES(MB125-BLK-SUB))            CL**1
02953                  LENGTH(PC-BLOCK-LENGTH)                             CL**1
02954                  ITEM(PV-BLOCK-NUMBER)                               CL**1
02955                  RESP(PV-RESP)                                       CL**1
02956              END-EXEC                                                CL**1
02957 *                                                                    CL**1
02958              IF  PV-RESP NOT = DFHRESP(NORMAL)                       CL**1
02959                  MOVE PV-RESP  TO  PM-RESP-10                        CL**1
02960                  EXEC CICS                                           CL**1
02961                      DELETEQ TS                                      CL**1
02962                      QUEUE(MB125-TEMP-QUEUE-NAME)                    CL**1
02963                      RESP(PV-RESP)                                   CL**1
02964                  END-EXEC                                            CL**1
02965 *                                                                    CL**1
02966                  SET DP013-LOGIC-ABEND                               CL**1
02967                                TO  TRUE                              CL**1
02968                  SET DP013-NO-ROLLBACK                               CL**1
02969                                TO  TRUE                              CL**1
02970                  MOVE 'Z150-WRITE-TEMP-STORAGE'                      CL**1
02971                                TO  DP013-PARAGRAPH                   CL**1
02972                  MOVE PM-PROGRAM-MESSAGE-10                          CL**1
02973                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02974                  PERFORM DP013-0000-PROCESS-ABEND                    CL**1
02975              END-IF                                                  CL**1
02976              ADD +1            TO  MB125-HIGHEST-BLOCK-WRITTEN       CL**1
02977          ELSE                                                        CL**1
02978              SET DP013-LOGIC-ABEND                                   CL**1
02979                                TO  TRUE                              CL**1
02980              SET DP013-NO-ROLLBACK                                   CL**1
02981                                TO  TRUE                              CL**1
02982              MOVE 'Z150-WRITE-TEMP-STORAGE'                          CL**1
02983                                TO  DP013-PARAGRAPH                   CL**1
02984              MOVE PV-BLOCK-NUMBER                                    CL**1
02985                                TO  PM-BLOCK-NUMBER                   CL**1
02986              MOVE PM-PROGRAM-MESSAGE-11                              CL**1
02987                                TO  DP013-MESSAGE-TEXT(1)             CL**1
02988              PERFORM DP013-0000-PROCESS-ABEND                        CL**1
02989          END-IF                                                      CL**1
02990      END-IF.                                                         CL**1
02991                                                                      CL**1
02992      SET MB125-BLOCK-NOT-MODIFIED(MB125-BLK-SUB) TO TRUE.            CL**1
02993 *                                                                    CL**1
02994  EJECT                                                               CL**1
02995 ******************************************************************   CL**1
02996 *    FILL IN SCREEN HEADER MODULE                                    CL**1
02997 ******************************************************************   CL**1
02998                                                                      CL**1
02999      COPY DPPD002.                                                   CL**1
03000  EJECT                                                               CL**1
03001 ******************************************************************   CL**1
03002 *    RETURN TO CICS MODULE                                           CL**1
03003 ******************************************************************   CL**1
03004                                                                      CL**1
03005      COPY DPPD003.                                                   CL**1
03006  EJECT                                                               CL**1
03007 ******************************************************************   CL**1
03008 *    FORMAT MESSAGE LINES MODULE                                     CL**1
03009 ******************************************************************   CL**1
03010                                                                      CL**1
03011      COPY DPPD005.                                                   CL**1
03012  EJECT                                                               CL**1
03013 ******************************************************************   CL**1
03014 *    GET PANEL MODULE                                                CL**1
03015 ******************************************************************   CL**1
03016                                                                      CL**1
03017      COPY DPPD007.                                                   CL**1
03018  EJECT                                                               CL**1
03019 ******************************************************************   CL**1
03020 *    WRITE PANEL MODULE                                              CL**1
03021 ******************************************************************   CL**1
03022                                                                      CL**1
03023      COPY DPPD008.                                                   CL**1
03024  EJECT                                                               CL**1
03025 ******************************************************************   CL**1
03026 *    TOGGLE THE FUNCTION KEY LINE MODULE                             CL**1
03027 ******************************************************************   CL**1
03028                                                                      CL**1
03029      COPY DPPD009.                                                   CL**1
03030  EJECT                                                               CL**1
03031 ******************************************************************   CL**1
03032 *    ABEND PROCESSOR MODULE                                          CL**1
03033 ******************************************************************   CL**1
03034                                                                      CL**1
03035      COPY DPPD013.                                                   CL**1
03036  EJECT                                                               CL**1
03037 ******************************************************************   CL**1
03038 *    CHECK COMMUNICATION AREA MODULE                                 CL**1
03039 ******************************************************************   CL**1
03040                                                                      CL**1
03041      COPY DPPD015.                                                   CL**1
03042  EJECT                                                               CL**1
03043 ******************************************************************   CL**1
03044 *    UPDATE TIME AND DATE MODULE                                     CL**1
03045 ******************************************************************   CL**1
03046                                                                      CL**1
03047      COPY DPPD017.                                                   CL**1
03048  EJECT                                                               CL**1
