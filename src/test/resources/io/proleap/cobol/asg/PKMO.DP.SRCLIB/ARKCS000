000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.                ARKCS000.                             00050000
000600 AUTHOR.                    RICK TULLOCH.                         00060000
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070000
000800 DATE-WRITTEN.              10-20-86.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  CICS PROGRAM - ARKCS000 - A000                                *00120000
001300*                                                                *00130000
001400*      ACCOUNTS RECEIVABLE SYSTEM - EMPLOYEE DISCOUNT MAIN MENU  *00140000
001500*                                                                *00150000
001600*      THIS PROGRAM FACILITATES THE FLOW OF CONTROL IN THE       *00160000
001700*  ACCOUNTS RECEIVABLE EMPLOYEE DISCOUNT SUBSYSTEM.  PROGRAM     *00170000
001800*  CONTROL WILL BE PASSED TO THE PROGRAM FACILITATING THE        *00180000
001900*  REQUESTED FUNCTION UPON THE ENTRY OF A VALID SELECTION        *00190000
002000*  NUMBER, AND ACCOUNT NUMBER OR DEPARTMENT NUMBER (IF REQUIRED  *00200000
002100*  BY THE SELECTION).  PF3 WILL TERMINATE THE EMPLOYEE DISCOUNT  *00210000
002200*  SYSTEM AND RETURN PROGRAM CONTROL TO CICS.                    *00220000
002300*                                                                *00230000
002400*    SEL   DESCRIPTION                        PROGRAM            *00240000
002500*     #                                                          *00250000
002600*                                                                *00260000
002700*     1    EMPLOYEE ACCOUNT LIST              ARKCS001           *00270000
002800*              OPT: ACCOUNT NUMBER                               *00280000
003100*     2    EMPLOYEE ACCOUNT MAINTENANCE       ARKCS002           *00310000
003200*              REQ: ACTION, ACCOUNT NUMBER                       *00320000
004800*                                                                *00480000
004900*       IF ANY SYSTEM ERRORS ARE DETECTED, THAT THE PROGRAM CAN  *00490000
005000*  NOT RESOLVE, THE EMPLOYEE DISCOUNT SYSTEM WILL BE TERMINATED. *00500000
005100*  THE CURRENT ACTION WILL BE ABORTED, AN ERROR MESSAGE WILL BE  *00510000
005200*  DISPLAYED ON THE SCREEN, AND PROGRAM CONTROL WILL BE RETURNED *00520000
005300*  TO CICS.                                                      *00530000
005400*                                                                *00540000
005500*       THIS PROGRAM CAN BE ENTERED VIA ANY OTHER TRANSACTION    *00550000
005600*  IN THE EMPLOYEE DISCOUNT SYSTEM, EITHER THROUGH A PF KEY      *00560000
005700*  RETURN TO THE MAIN MENU, OR THROUGH A DIRECT ENTRY ATTEMPT    *00570000
005800*  INTO A SUBORDINATE TRANSACTION, WHICH YIELDS AN XCTL TO THE   *00580000
005900*  MAIN MENU, FOR A CONSISTENT SYSTEM ENTRY POINT.               *00590000
006000******************************************************************00600000
006100* 07/26/95 - TCM -  WR NO. 3430                                  *00610000
006200*    - CHANGE CC-VALID-CRS-ACCOUNT-PREFIX VALIDITY FROM 017,     *00620000
006300*      018, 019, 020 TO 000 THROUGH 999                          *00630000
006310******************************************************************00631000
006320* 04/12/04 - BDH - WR#:23834                                     *00632000
006330*    - REMOVED OPTIONS 2 AND 4 THRU 11.  THESE OPTIONS ARE NO    *00633000
006340*      LONGER USED OR NO LONGER USED FROM THIS MENU.             *00634000
006400******************************************************************00640000
006410* 08/28/15 - COGNIZANT - WR#: CHG0125054                         *00641099
006420*    - CHANGES TO ENTER THE ACCOUNT NUMBER AS MANDATORY FIELD    *00642099
006430*      AND TO DISPLAY THE ERROR MESSAGE WHEN ACCOUNT NUMBER IS   *00643099
006431*      NOT ENTERED IN SCREEN.                                    *00643199
006432*    - CHANGES TO INCLUDE THE NEW FUNCTIONS TO CHECK WHETHER     *00643299
006433*      THE USER HAVE ACCESS TO PROTEGRITY DATA ELEMENT ACCESS FOR*00643399
006434*      ACCOUNT NUMBER AND SS NUMBER TO UNPROTECT.                *00643499
006435******************************************************************00643599
006436* DATE  09/01/2021                                               *00643699
006437*            - CHANGE CALL OF DPKUT100 TO                        *00643799
006438*              CALL DP010I-NUMERIC-EDIT-ROUTINE                  *00643899
006439*              MAKING THE CALL DYNAMIC VS STATIC                 *00643999
006440*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053       *00644099
006600******************************************************************00660000
006700 ENVIRONMENT DIVISION.                                            00670000
006800******************************************************************00680000
006900                                                                  00690000
007000******************************************************************00700000
007100 DATA DIVISION.                                                   00710000
007200******************************************************************00720000
007400 WORKING-STORAGE SECTION.                                         00740000
010000*                                                                 01000000
010100*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01010000
010200*                                                                 01020000
010400     COPY DPWS010I.                                               01040000
010500                                                                  01050000
010600*                                                                 01060099
010700*  SECURITY SUBROUTINE.                                           01070099
010800*                                                                 01080099
010900     COPY DPWS008.                                                01090099
011000                                                                  01100099
011110*                                                                 01111000
011120*  STANDARD ATTENTION IDENTIFIER LIST                             01112000
011130*                                                                 01113000
011140     COPY DFHAID.                                                 01114000
011150                                                                  01115000
011200*                                                                 01120000
011300*  STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST          01130000
011400*                                                                 01140000
011600     COPY DFHBMSCA.                                               01160000
011700                                                                  01170000
011800*                                                                 01180000
011900*  DSECT FOR THE ARKM000 MAPSET                                   01190000
012000*                                                                 01200000
012200     COPY ARKM000.                                                01220000
012210                                                                  01221000
012400 01 PS-PROGRAM-SWITCHES.                                          01240000
012500    05 PS-EDIT-ERROR-IND       PIC X(1)     VALUE 'N'.            01250000
012600       88 PS-NO-EDIT-ERROR                  VALUE 'N'.            01260000
012700       88 PS-EDIT-ERROR                     VALUE 'Y'.            01270000
012800    05 PS-EMPLOYEE-ACCOUNT-IND PIC X(1)     VALUE 'N'.            01280000
012900       88 PS-EMPLOYEE-ACCOUNT-FOUND         VALUE 'Y'.            01290000
013000       88 PS-EMPLOYEE-ACCOUNT-NOT-FOUND     VALUE 'N'.            01300000
014000    05 PS-CHECK-DIGIT-COMPUTE-IND                                 01400000
014100                              PIC X(1)     VALUE '1'.             01410000
014200       88 PS-MULTIPLY-DIGIT-BY-1           VALUE '1'.             01420000
014300       88 PS-MULTIPLY-DIGIT-BY-2           VALUE '2'.             01430000
014400                                                                  01440000
014500 01 PC-PROGRAM-CONSTANTS.                                         01450000
014600    05 PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'ARKCS000'.     01460000
014700    05 PC-LEAVE-SYSTEM-MESSAGE PIC X(160)   VALUE                 01470000
014800       'EMPLOYEE DISCOUNT SYSTEM TERMINATED'.                     01480000
014900    05 PC-LEAVE-SYSTEM-LENGTH  PIC S9(4)    VALUE +160            01490000
015000                               COMP SYNC.                         01500000
015100    05 PC-TRANSFER-DOWN-LENGTH PIC S9(4)    VALUE +29             01510089
015200                               COMP SYNC.                         01520000
015300    05 PC-COMMON-AREA-LENGTH   PIC S9(4)    VALUE +29             01530085
015400                                 COMP SYNC.                       01540000
015500    05 PC-MAXIMUM-ACCOUNT-DIGITS                                  01550000
015600                               PIC S9(4)    VALUE +9              01560000
015700                               COMP SYNC.                         01570000
015800    05 PC-MAXIMUM-DIGIT-AMOUNT PIC 9(1)     VALUE 9.              01580000
015900    05 PC-MOD-10               PIC 9(2)     VALUE 10.             01590000
016000    05 PC-EOF-KEYED-COMP       PIC S9(4)    VALUE +128            01600000
016100                               COMP SYNC.                         01610000
016200    05 FILLER                  REDEFINES PC-EOF-KEYED-COMP.       01620000
016300       10 FILLER              PIC X(1).                           01630000
016400       10 PC-EOF-KEYED        PIC X(1).                           01640000
016410    05 PC-FUNCTION-CLRSSN      PIC X(8)     VALUE 'ARCLRSSN'.     01641094
016420    05 PC-FUNCTION-CLRACT      PIC X(8)     VALUE 'ARCLRACT'.     01642094
016500                                                                  01650000
016600 01 PV-PROGRAM-VARIABLES.                                         01660000
016700    05 PV-TRANSFER-PROGRAM-NAME                                   01670000
016800                               PIC X(8)     VALUE SPACES.         01680000
016900    05 PV-LEAVE-SYSTEM-MESSAGE PIC X(160)   VALUE SPACES.         01690000
017000    05 PV-CICS-RESPONSE        PIC S9(9)    VALUE ZERO            01700000
017100                               COMP SYNC.                         01710000
017120    05 PV-DISPLAY-KEY          PIC X(10)    VALUE SPACES.         01712000
017200                                                                  01720000
017300 01 CC-COMPUTE-CHECK-DIGIT-AREA.                                  01730000
017400    05 CC-ACCOUNT-NUMBER       PIC 9(10)    VALUE ZERO.           01740000
017500    05 FILLER                  REDEFINES CC-ACCOUNT-NUMBER.       01750000
017600       10 CC-ACCOUNT-NUMBER-PREFIX                                01760000
017700                               PIC 9(3).                          01770000
017800           88 CC-VALID-CRS-ACCOUNT-PREFIX  VALUE 000              01780000
017900                                           THROUGH 999.           01790000
018000           88 CC-VALID-KOHLS-ACCOUNT-PREFIX                       01800000
018100                                              VALUE 000.          01810000
018200       10 CC-ACCOUNT-NUMBER-SUFFIX                                01820000
018300                                PIC 9(7).                         01830000
018400    05 FILLER                  REDEFINES CC-ACCOUNT-NUMBER.       01840000
018500       10 CC-ACCOUNT-DIGIT    OCCURS 9 TIMES                      01850000
018600                               INDEXED BY CC-DIGIT-INDEX          01860000
018700                               PIC 9(1).                          01870000
018800       10 CC-ACCOUNT-CHECK-DIGIT                                  01880000
018900                               PIC 9(1).                          01890000
019000    05 CC-ACCOUNT-DIGIT-MOD-10 PIC 9(2)     VALUE ZERO.           01900000
019100    05 CC-MOD-10-DIGIT-SUM     PIC 9(1)     VALUE ZERO.           01910000
019200    05 CC-COMPUTED-CHECK-DIGIT PIC 9(1)     VALUE ZERO.           01920000
019300                                                                  01930000
019400 01 SE-SYSTEM-ERROR-MESSAGE.                                      01940000
019500    05 FILLER                  PIC X(43)    VALUE                 01950000
019600       'A SYSTEM ERROR HAS OCCURRED - CONTACT DP - '.             01960000
019700    05 FILLER                  PIC X(33)    VALUE                 01970000
019800       'PROGRAM ARKCS000       EIBRESP = '.                       01980000
019900    05 SE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.           01990000
020000    05 FILLER                  PIC X(5)     VALUE SPACES.         02000000
020100    05 FILLER                  PIC X(14)    VALUE                 02010000
020200       'ATTEMPTING TO '.                                          02020000
020300    05 SE-ATTEMPTED-ACTION     PIC X(61)    VALUE SPACES.         02030000
020400                                                                  02040000
020520 01 VE-VSAM-ERROR-MESSAGE.                                        02052000
020600    05 FILLER                  PIC X(41)    VALUE                 02060000
020700       'A VSAM ERROR HAS OCCURRED - CONTACT DP - '.               02070000
020800    05 FILLER                  PIC X(31)    VALUE                 02080000
020900       'PROGRAM ARKCS000      DDNAME = '.                         02090000
021000    05 VE-FILE-DDNAME          PIC X(8)     VALUE SPACES.         02100000
021100    05 FILLER                  PIC X(5)     VALUE SPACES.         02110000
021200    05 FILLER                  PIC X(14)    VALUE                 02120000
021300       'ATTEMPTING TO '.                                          02130000
021400    05 VE-ATTEMPTED-ACTION     PIC X(46)    VALUE SPACES.         02140000
021500    05 FILLER                  PIC X(11)    VALUE ' EIBRESP = '.  02150000
021700    05 VE-CICS-RESPONSE        PIC 9(4)     VALUE ZERO.           02170000
021800                                                                  02180000
021900 01 ST-SYSTEM-TIME-AREA.                                          02190000
022000    05 ST-ABSTIME              PIC S9(18)   VALUE ZERO            02200000
022100                               COMP SYNC.                         02210000
022200    05 ST-TIME-EDIT.                                              02220000
022300       10  ST-TIME-HHMM        PIC X(5)     VALUE SPACES.         02230000
022400       10  FILLER              PIC X(3)     VALUE SPACES.         02240000
022500                                                                  02250000
022600 01 CA-COMMON-AREA.                                               02260000
022700    05 CA-COMMON-DATA.                                            02270000
022800       10 CA-TRANSACTION-STATUS                                   02280000
022900                              PIC X(1)     VALUE SPACES.          02290000
023000          88 CA-INITIALIZE-SCREEN         VALUE 'S'.              02300000
023100          88 CA-PROCESS-SCREEN            VALUE 'R'.              02310000
023200       10 CA-LAST-PROGRAM-NAME                                    02320000
023300                              PIC X(8)     VALUE SPACES.          02330000
023400       10 CA-LAST-ACTION-STATUS                                   02340000
023500                             PIC X(1)     VALUE SPACES.           02350000
023600          88 CA-RESET-LAST-ACTION-STATUS  VALUE ' '.              02360000
023700          88 CA-LAST-ACTION-SUCCESSFUL    VALUE 'S'.              02370000
023800          88 CA-LAST-ACTION-ABORTED       VALUE 'A'.              02380000
023900       10 CA-SELECTION-X      PIC X(2).                           02390000
024000          88 CA-VALID-SELECTION           VALUE '01', '02'.       02400000
024100*         88 CA-VALID-SELECTION           VALUE '01'.             02410000
024900          88 CA-EMPLOYEE-ACCOUNT-MAINT    VALUE '02'.             02490000
025400       10 CA-SELECTION        REDEFINES CA-SELECTION-X            02540000
025500                              PIC 9(2).                           02550000
025600       10 CA-ACTION           PIC X(1)     VALUE SPACES.          02560000
026500       10 CA-ACCOUNT-NUMBER-X PIC X(10)    VALUE SPACES.          02650000
026600       10 CA-ACCOUNT-NUMBER   REDEFINES CA-ACCOUNT-NUMBER-X       02660000
026700                              PIC 9(10).                          02670000
026800       10 CA-DEPARTMENT-X     PIC X(3)     VALUE SPACES.          02680000
026900       10 CA-DEPARTMENT       REDEFINES CA-DEPARTMENT-X           02690000
027000                               PIC 9(3).                          02700000
027010       10 CA-ACCT-ACCESS      PIC X(1)     VALUE SPACES.          02701068
027020          88 CA-ACCT-ACCESS-YES            VALUE 'Y'.             02702068
027030          88 CA-ACCT-ACCESS-NO             VALUE 'N'.             02703068
027040       10 CA-SSN-ACCESS       PIC X(1)     VALUE SPACES.          02704068
027050          88 CA-SSN-ACCESS-YES             VALUE 'Y'.             02705068
027060          88 CA-SSN-ACCESS-NO              VALUE 'N'.             02706068
027070       10 CA-TOKEN-ACCT-IND   PIC X(1)     VALUE SPACES.          02707085
027080          88 CA-TOKEN-ACCT-YES             VALUE 'Y'.             02708085
027090          88 CA-TOKEN-ACCT-NO              VALUE 'N'.             02709085
027100                                                                  02710000
027200 01 PM-PROGRAM-MESSAGE-DATA.                                      02720000
027210*1                                                                02721000
027300    05 FILLER                  PIC X(53)    VALUE                 02730000
027400       '                                                     '.   02740000
027410*2                                                                02741000
027500    05 FILLER                  PIC X(53)    VALUE                 02750000
027600       'UNKNOWN PF KEY ENTERED                               '.   02760000
027610*3                                                                02761000
027700    05 FILLER                  PIC X(53)    VALUE                 02770000
027800       'LAST ACTION ABORTED                                  '.   02780000
028010*4                                                                02801000
028100    05 FILLER                  PIC X(53)    VALUE                 02810000
028200       'EMPLOYEE ACCOUNT CHANGED                             '.   02820000
028210*5                                                                02821000
028300    05 FILLER                  PIC X(53)    VALUE                 02830000
028400       'EMPLOYEE ACCOUNT DELETED                             '.   02840000
029610*6                                                                02961000
029700    05 FILLER                  PIC X(53)    VALUE                 02970000
029800       'PROGRAM NOT AVAILABLE - CONTACT DP                   '.   02980000
029810*7                                                                02981000
029900    05 FILLER                  PIC X(53)    VALUE                 02990000
030000*      'SELECTION MUST BE 1 - 11                             '.   03000000
030100       'SELECTION MUST BE 1                                  '.   03010000
030410*8                                                                03041000
030500    05 FILLER                  PIC X(53)    VALUE                 03050000
030600       'ACTION NOT ALLOWED FOR THIS SELECTION                '.   03060000
030610*9                                                                03061000
030700    05 FILLER                  PIC X(53)    VALUE                 03070000
030800       'ACCOUNT NUMBER MUST BE NUMERIC                       '.   03080000
030810*10                                                               03081000
030900    05 FILLER                  PIC X(53)    VALUE                 03090000
031000       'ACCOUNT NUMBER IS REQUIRED FOR THIS SELECTION        '.   03100000
031010*11                                                               03101000
031100    05 FILLER                  PIC X(53)    VALUE                 03110000
031200       'ACCOUNT NUMBER CANNOT BE ZERO FOR THIS SELECTION     '.   03120000
031210*12                                                               03121000
031300    05 FILLER                  PIC X(53)    VALUE                 03130000
031400       'ACCOUNT NUMBER PREFIX MUST BE 017 - 020              '.   03140000
031410*13                                                               03141000
031500    05 FILLER                  PIC X(53)    VALUE                 03150000
031600       'ACCOUNT NUMBER PREFIX MUST BE 000                    '.   03160000
031610*14                                                               03161000
031700    05 FILLER                  PIC X(53)    VALUE                 03170000
031800       'ACCOUNT NUMBER DOES NOT HAVE A VALID CHECK DIGIT     '.   03180000
031810*15                                                               03181000
031900    05 FILLER                  PIC X(53)    VALUE                 03190000
032000       'ACCOUNT NUMBER CANNOT EXIST FOR AN ADD ACTION        '.   03200000
034300                                                                  03430000
034400 01 PM-PROGRAM-MESSAGE-TABLE    REDEFINES                         03440000
034500                                   PM-PROGRAM-MESSAGE-DATA.       03450000
034600    05 PM-PROGRAM-MESSAGE      OCCURS 15 TIMES                    03460000
034700                               INDEXED BY PM-MESSAGE-INDEX        03470000
034800                               PIC X(53).                         03480000
034900                                                                  03490000
035000 01 PN-PROGRAM-NAME-DATA.                                         03500000
035100    05 FILLER                  PIC X(8)     VALUE 'ARKCS001'.     03510000
035300    05 FILLER                  PIC X(8)     VALUE 'ARKCS002'.     03530000
036200                                                                  03620000
036300 01 PN-PROGRAM-NAME-TABLE       REDEFINES PN-PROGRAM-NAME-DATA.   03630000
036410    05 PN-PROGRAM-NAME         OCCURS 02 TIMES                    03641000
036500                               INDEXED BY PN-NAME-INDEX           03650000
036600                               PIC X(8).                          03660000
036700                                                                  03670000
037610******************************************************************03761000
037700 LINKAGE SECTION.                                                 03770000
037800******************************************************************03780000
038000 01 DFHCOMMAREA.                                                  03800000
038100    05 LS-COMMON-DATA.                                            03810000
038200       10 LS-TRANSACTION-STATUS PIC X(1).                         03820000
038400          88 LS-INITIALIZE-SCREEN         VALUE 'S'.              03840000
038500          88 LS-PROCESS-SCREEN            VALUE 'R'.              03850000
038600       10 LS-LAST-PROGRAM-NAME  PIC X(8).                         03860000
038800       10 LS-LAST-ACTION-STATUS PIC X(1).                         03880000
039000       10 LS-SELECTION-X        PIC X(2).                         03900000
039100          88 LS-EMPLOYEE-ACCOUNT-MAINT    VALUE '02'.             03910000
039600       10 LS-SELECTION        REDEFINES LS-SELECTION-X            03960000
039700                                PIC 9(2).                         03970000
039800       10 LS-ACTION             PIC X(1).                         03980000
039900       10 LS-ACCOUNT-NUMBER-X   PIC X(10).                        03990000
040000       10 LS-ACCOUNT-NUMBER   REDEFINES LS-ACCOUNT-NUMBER-X       04000000
040100                                PIC 9(10).                        04010000
040200       10 LS-DEPARTMENT-X       PIC X(3).                         04020000
040300       10 LS-DEPARTMENT       REDEFINES LS-DEPARTMENT-X           04030000
040400                                PIC 9(3).                         04040000
040410       10 LS-ACCT-ACCESS      PIC X(1).                           04041069
040420          88 LS-ACCT-ACCESS-YES            VALUE 'Y'.             04042069
040430          88 LS-ACCT-ACCESS-NO             VALUE 'N'.             04043069
040440       10 LS-SSN-ACCESS       PIC X(1).                           04044069
040450          88 LS-SSN-ACCESS-YES             VALUE 'Y'.             04045069
040460          88 LS-SSN-ACCESS-NO              VALUE 'N'.             04046069
040470       10 LS-TOKEN-ACCT-IND   PIC X(1).                           04047085
040480          88 LS-TOKEN-ACCT-YES             VALUE 'Y'.             04048085
040490          88 LS-TOKEN-ACCT-NO              VALUE 'N'.             04049085
040500                                                                  04050000
040600******************************************************************04060000
040700 PROCEDURE DIVISION.                                              04070000
040800******************************************************************04080000
041000 0000-MAINLINE.                                                   04100000
041100     EVALUATE TRUE                                                04110000
041200         WHEN EIBCALEN = 0                                        04120000
041300         WHEN LS-INITIALIZE-SCREEN                                04130000
041400             PERFORM 1000-INITIALIZE                              04140000
041500         WHEN EIBAID = DFHPF3                                     04150000
041600             MOVE PC-LEAVE-SYSTEM-MESSAGE TO                      04160000
041700                       PV-LEAVE-SYSTEM-MESSAGE                    04170000
041800             PERFORM 9910-RETURN-TO-ARCH                          04180000
041900         WHEN EIBAID = DFHCLEAR                                   04190000
042000             PERFORM 5000-SEND-MAP-AND-DATA                       04200000
042100         WHEN OTHER                                               04210000
042200             PERFORM 2000-PROCESS-SCREEN-FIELDS                   04220000
042300     END-EVALUATE.                                                04230000
042400                                                                  04240000
042500     GOBACK.                                                      04250000
042600                                                                  04260000
043726******************************************************************04372600
043727*  INITIALIZE SCREEN FIELDS AND THE COMMON AREA FOR PROCESSING.  *04372700
043730*  IF THE SYSTEM IS NOT BEING ENTERED FOR THE FIRST TIME         *04373000
043740*  (EIBCALEN NOT = ZERO), RETAIN THE COMMON AREA VARIABLES FROM  *04374000
043750*  THE LINKAGE SECTION, AND DISPLAY ANY APPLICABLE MESSAGES TO   *04375000
043760*  INDICATE SUCCESS OR FAILURE OF THE LAST ACTION.  SEND THE     *04376000
043770*  MAP AND THE INITIAL DATA, AND RETURN CONTROL TO THIS          *04377000
043780*  TRANSACTION.                                                  *04378000
043790******************************************************************04379000
043791 1000-INITIALIZE.                                                 04379100
043800     MOVE LOW-VALUES TO AR000AI.                                  04380000
043900                                                                  04390000
044000     SET PM-MESSAGE-INDEX TO 1.                                   04400000
044100     IF EIBCALEN = 0                                              04410000
044200         INITIALIZE CA-COMMON-AREA                                04420000
044300                    ASELI                                         04430000
044500                    AACCTI                                        04450000
044600         PERFORM 1100-CHK-ACCT-ACCESS                             04460070
044610         PERFORM 1200-CHK-SSN-ACCESS                              04461070
044700     ELSE                                                         04470000
044800         INITIALIZE CA-SELECTION-X                                04480000
044900                    ASELI                                         04490000
045300                    CA-ACCOUNT-NUMBER-X                           04530099
045400                    CA-TOKEN-ACCT-IND                             04540099
046000         MOVE LS-LAST-PROGRAM-NAME TO CA-LAST-PROGRAM-NAME        04600000
046100         MOVE LS-LAST-ACTION-STATUS TO CA-LAST-ACTION-STATUS      04610000
046200         EVALUATE TRUE ALSO TRUE                                  04620000
046300             WHEN CA-LAST-ACTION-ABORTED ALSO NOT                 04630000
046400                                     LS-EMPLOYEE-ACCOUNT-MAINT    04640000
046500                 SET PM-MESSAGE-INDEX TO 3                        04650000
048400         END-EVALUATE                                             04840000
048410         MOVE LS-ACCT-ACCESS TO CA-ACCT-ACCESS                    04841089
048420         MOVE LS-SSN-ACCESS  TO CA-SSN-ACCESS                     04842089
048500     END-IF.                                                      04850000
048600                                                                  04860000
048700     SET CA-PROCESS-SCREEN                      TO TRUE.          04870000
048800     SET CA-RESET-LAST-ACTION-STATUS            TO TRUE.          04880000
048900     MOVE PM-PROGRAM-MESSAGE (PM-MESSAGE-INDEX) TO AMSGO.         04890000
049000     PERFORM 6000-UPDATE-SCREEN-HEADER.                           04900000
049100     MOVE -1                                    TO ASELL.         04910000
049200                                                                  04920000
049300     EXEC CICS                                                    04930000
049400         SEND                                                     04940000
049500             MAP('AR000A')                                        04950000
049600             MAPSET('ARKM000')                                    04960000
049700             ERASE                                                04970000
049800             CURSOR                                               04980000
049900             FORMFEED                                             04990000
050000             RESP(PV-CICS-RESPONSE)                               05000000
050100     END-EXEC.                                                    05010000
050200                                                                  05020000
050300     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    05030000
050400         MOVE 'SEND THE INITIAL MAP' TO SE-ATTEMPTED-ACTION       05040000
050500         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                05050000
050600         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  05060000
050700         PERFORM 9900-LEAVE-SYSTEM                                05070000
050800     END-IF.                                                      05080000
050900                                                                  05090000
051000     EXEC CICS                                                    05100000
051100         RETURN                                                   05110000
051200             TRANSID('A000')                                      05120000
051300             COMMAREA(CA-COMMON-AREA)                             05130000
051400             LENGTH(PC-COMMON-AREA-LENGTH)                        05140000
051500             RESP(PV-CICS-RESPONSE)                               05150000
051600     END-EXEC.                                                    05160000
051700                                                                  05170000
051800     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    05180000
051900         MOVE 'RETURN AFTER THE INITIAL MAP SEND' TO              05190000
052000                   SE-ATTEMPTED-ACTION                            05200000
052100         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                05210000
052200         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  05220000
052300         PERFORM 9900-LEAVE-SYSTEM                                05230000
052400     END-IF.                                                      05240000
052500*1000-EXIT.                                                       05250000
052600                                                                  05260000
052610******************************************************************05261000
052620*  CHECK WHETHER THE USER HAS ACCESS TO SEE THE CLEAR ACCOUNT NBR*05262069
052630*  IF NOT MASKED VALUE WILL BE DISPLAYED                         *05263069
052660******************************************************************05266000
052670 1100-CHK-ACCT-ACCESS.                                            05267069
052680                                                                  05268000
052690     INITIALIZE DP008-SECURITY-COMMAREA.                          05269000
052692     SET DP008-RSRC-TYPE-FUNC     TO TRUE.                        05269200
052693     MOVE PC-FUNCTION-CLRACT      TO DP008-RESOURCE-NAME.         05269369
052694     SET DP008-ACCESS-TYPE-USE    TO TRUE.                        05269400
052695                                                                  05269500
052696     EXEC CICS LINK                                               05269600
052697               PROGRAM  (DP008-SECURITY-SUBROUTINE)               05269700
052698               COMMAREA (DP008-SECURITY-COMMAREA)                 05269800
052699               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          05269900
052700     END-EXEC.                                                    05270000
052701                                                                  05270100
052702     IF DP008-CALL-SUCCESSFUL                                     05270200
052704        IF  DP008-ACCESS-ALLOWED                                  05270400
052705           SET CA-ACCT-ACCESS-YES TO TRUE                         05270569
052706        ELSE                                                      05270600
052707           SET CA-ACCT-ACCESS-NO  TO TRUE                         05270769
052708        END-IF                                                    05270800
052709     ELSE                                                         05270900
052710        MOVE 'ARKCS000 - PROTEGRITY ACCT ACCESS CHK FAILED' TO    05271099
052711             PV-LEAVE-SYSTEM-MESSAGE                              05271100
052712        PERFORM 9900-LEAVE-SYSTEM                                 05271200
052713     END-IF.                                                      05271300
052727*                                                                 05272767
052728******************************************************************05272869
052729*  CHECK WHETHER THE USER HAS ACCESS TO SEE THE CLEAR SSN        *05272969
052730*  IF NOT MASKED VALUE WILL BE DISPLAYED                         *05273099
052731******************************************************************05273169
052732 1200-CHK-SSN-ACCESS.                                             05273270
052733                                                                  05273369
052734     INITIALIZE DP008-SECURITY-COMMAREA.                          05273469
052735     SET DP008-RSRC-TYPE-FUNC     TO TRUE.                        05273569
052736     MOVE PC-FUNCTION-CLRSSN      TO DP008-RESOURCE-NAME.         05273669
052737     SET DP008-ACCESS-TYPE-USE    TO TRUE.                        05273769
052738                                                                  05273869
052739     EXEC CICS LINK                                               05273969
052740               PROGRAM  (DP008-SECURITY-SUBROUTINE)               05274069
052741               COMMAREA (DP008-SECURITY-COMMAREA)                 05274169
052742               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          05274269
052743     END-EXEC.                                                    05274369
052744                                                                  05274469
052745     IF DP008-CALL-SUCCESSFUL                                     05274569
052747        IF  DP008-ACCESS-ALLOWED                                  05274769
052748           SET CA-SSN-ACCESS-YES TO TRUE                          05274869
052749        ELSE                                                      05274969
052750           SET CA-SSN-ACCESS-NO  TO TRUE                          05275069
052751        END-IF                                                    05275169
052752     ELSE                                                         05275269
052753        MOVE 'ARKCS000 - PROTEGRITY SSN ACCESS CHK FAILED' TO     05275399
052754             PV-LEAVE-SYSTEM-MESSAGE                              05275469
052755        PERFORM 9900-LEAVE-SYSTEM                                 05275569
052756     END-IF.                                                      05275669
052770*                                                                 05277069
052780******************************************************************05278069
052800*  PROCESS INFORMATION ENTERED ON THE SCREEN, BY RECEIVING THE   *05280000
052900*  CURRENT MAP, EDITING THE INFORMATION ENTERED, AND EITHER      *05290000
053000*  DISPLAYING ERRORS, OR PASSING CONTROL TO THE NEXT PROGRAM.    *05300000
053100******************************************************************05310000
053300 2000-PROCESS-SCREEN-FIELDS.                                      05330000
053400     MOVE LOW-VALUES TO AR000AI.                                  05340000
053500                                                                  05350000
053600     PERFORM 2100-RECEIVE-MAP.                                    05360000
053700                                                                  05370000
053800     MOVE DFHUNDLN   TO ASELH                                     05380000
054000                        AACCTH.                                   05400000
054200     IF EIBAID NOT = DFHENTER                                     05420000
054300         SET PS-EDIT-ERROR TO TRUE                                05430000
054400         SET PM-MESSAGE-INDEX TO 2                                05440000
054500         MOVE -1 TO ASELL                                         05450000
054600     ELSE                                                         05460000
054700         SET PS-NO-EDIT-ERROR TO TRUE                             05470000
054800         SET PM-MESSAGE-INDEX TO 1                                05480000
054900         PERFORM 2200-EDIT-SCREEN-FIELDS                          05490000
055000     END-IF.                                                      05500000
055100                                                                  05510000
055200     IF PS-NO-EDIT-ERROR                                          05520000
055300         SET PN-NAME-INDEX TO CA-SELECTION                        05530000
055400         MOVE PN-PROGRAM-NAME (PN-NAME-INDEX) TO                  05540000
055500                   PV-TRANSFER-PROGRAM-NAME                       05550000
055600         PERFORM 9000-TRANS-TO-SELECTED-PROG                      05560000
055700     END-IF.                                                      05570000
055800                                                                  05580000
055900     PERFORM 6000-UPDATE-SCREEN-HEADER.                           05590000
056000     MOVE PM-PROGRAM-MESSAGE (PM-MESSAGE-INDEX) TO AMSGO.         05600000
056100                                                                  05610000
056200     EXEC CICS                                                    05620000
056300         SEND                                                     05630000
056400             MAP('AR000A')                                        05640000
056500             MAPSET('ARKM000')                                    05650000
056600             DATAONLY                                             05660000
056700             CURSOR                                               05670000
056800             FORMFEED                                             05680000
056900             RESP(PV-CICS-RESPONSE)                               05690000
057000     END-EXEC.                                                    05700000
057100                                                                  05710000
057200     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    05720000
057300         MOVE 'SEND THE DATA AFTER EDITING' TO SE-ATTEMPTED-ACTION05730000
057500         MOVE PV-CICS-RESPONSE              TO SE-CICS-RESPONSE   05750000
057600         MOVE SE-SYSTEM-ERROR-MESSAGE   TO PV-LEAVE-SYSTEM-MESSAGE05760000
057700         PERFORM 9900-LEAVE-SYSTEM                                05770000
057800     END-IF.                                                      05780000
057900                                                                  05790000
058000     EXEC CICS                                                    05800000
058100         RETURN                                                   05810000
058200             TRANSID('A000')                                      05820000
058300             COMMAREA(CA-COMMON-AREA)                             05830000
058400             LENGTH(PC-COMMON-AREA-LENGTH)                        05840000
058500             RESP(PV-CICS-RESPONSE)                               05850000
058600     END-EXEC.                                                    05860000
058700                                                                  05870000
058800     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    05880000
058900         MOVE 'RETURN AFTER THE EDITED MAP SEND' TO               05890000
059000                                         SE-ATTEMPTED-ACTION      05900000
059100         MOVE PV-CICS-RESPONSE        TO SE-CICS-RESPONSE         05910000
059200         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  05920000
059300         PERFORM 9900-LEAVE-SYSTEM                                05930000
059400     END-IF.                                                      05940000
059500*2000-EXIT.                                                       05950000
059600                                                                  05960000
059700******************************************************************05970000
059800*  RECEIVE THE CURRENT MAP.  THE MAPFAIL CONDITION WILL BE       *05980000
059900*  RAISED IF NO DATA WAS ENTERED ON THE SCREEN, AND THUS NO      *05990000
060000*  SCREEN FIELDS SHOULD BE MOVED TO THE COMMON AREA.             *06000000
060100******************************************************************06010000
060300 2100-RECEIVE-MAP.                                                06030000
060400     MOVE DFHCOMMAREA               TO CA-COMMON-AREA.            06040000
060500                                                                  06050000
060600     EXEC CICS                                                    06060000
060700         RECEIVE                                                  06070000
060800             MAP('AR000A')                                        06080000
060900             MAPSET('ARKM000')                                    06090000
061000             RESP(PV-CICS-RESPONSE)                               06100000
061100     END-EXEC.                                                    06110000
061200                                                                  06120000
061300     EVALUATE PV-CICS-RESPONSE                                    06130000
061400         WHEN DFHRESP(NORMAL)                                     06140000
061500             PERFORM 2110-RECEIVE-SCREEN-FIELDS                   06150000
061600         WHEN DFHRESP(MAPFAIL)                                    06160000
061700             CONTINUE                                             06170000
061800         WHEN OTHER                                               06180000
061900             MOVE 'RECEIVE THE MAP'       TO SE-ATTEMPTED-ACTION  06190000
062000             MOVE PV-CICS-RESPONSE        TO SE-CICS-RESPONSE     06200000
062100             MOVE SE-SYSTEM-ERROR-MESSAGE TO                      06210000
062200                                           PV-LEAVE-SYSTEM-MESSAGE06220000
062300             PERFORM 9900-LEAVE-SYSTEM                            06230000
062400     END-EVALUATE.                                                06240000
062500*2100-EXIT.                                                       06250000
062600                                                                  06260000
062700******************************************************************06270000
062800*  RECEIVE SCREEN FIELDS, AND MOVE THEM TO THE COMMON AREA.  A   *06280000
062900*  FIELD LENGTH GREATER THAN ZERO INDICATES INFORMATION WAS      *06290000
063000*  ENTERED, AND A FIELD ATTRIBUTE OF HEX '80' INDICATES THAT     *06300000
063100*  EOF WAS KEYED, AND THE DEFAULT VALUE HAS TO BE MOVED TO THE   *06310000
063200*  COMMON AREA.                                                  *06320000
063300******************************************************************06330000
063500 2110-RECEIVE-SCREEN-FIELDS.                                      06350000
063600     IF ASELL > ZERO                                              06360000
063700         MOVE ASELI TO CA-SELECTION-X                             06370000
063800     ELSE                                                         06380000
063900         IF ASELA = PC-EOF-KEYED                                  06390000
064000             INITIALIZE CA-SELECTION-X                            06400000
064100         END-IF                                                   06410000
064200     END-IF.                                                      06420000
064300                                                                  06430000
065100                                                                  06510000
065200     IF AACCTL > ZERO                                             06520000
065300         MOVE AACCTI TO CA-ACCOUNT-NUMBER-X                       06530000
065400     ELSE                                                         06540000
065500         IF AACCTA = PC-EOF-KEYED                                 06550000
065600             INITIALIZE CA-ACCOUNT-NUMBER-X                       06560000
065700         END-IF                                                   06570000
065800     END-IF.                                                      06580000
065900                                                                  06590000
066700*2110-EXIT.                                                       06670000
066800                                                                  06680000
066900******************************************************************06690000
067000*  EDIT SCREEN FIELDS, USING REVERSE VIDEO TO HIGHLIGHT ERRORS,  *06700000
067100*  AND POSITIONING THE CURSOR AT THE FIRST ERROR ENCOUNTERED,    *06710000
067200*  WITH AN ASSOCIATED MESSAGE APPEARING AT THE BOTTOM OF THE     *06720000
067300*  SCREEN.  ANY NUMERIC FIELDS THAT USE THE NUMERIC EDIT         *06730000
067400*  ROUTINE, AND PROVE TO BE NUMERIC, WILL BE MOVED TO THE MAP    *06740000
067500*  OUTPUT AREA TO BE REDISPLAYED IN EDITED FORMAT.               *06750000
067600******************************************************************06760000
067800 2200-EDIT-SCREEN-FIELDS.                                         06780000
068000*                                                                 06800000
068100*  THE SELECTION NUMBER MUST BE NUMERIC AND VALID.                06810000
068200*                                                                 06820000
068400     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    06840000
068500     MOVE 2                          TO DP010I-MAXIMUM-DIGITS.    06850000
068600     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  06860000
068700     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     06870000
068810     CALL DP010I-NUMERIC-EDIT-ROUTINE                             06881099
068820                         USING DP010I-NUMERIC-EDIT-AREA           06882099
068900                                                                  06890000
069000     IF DP010I-ERROR-DETECTED                                     06900000
069100         MOVE DFHREVRS               TO ASELH                     06910000
069200         SET PS-EDIT-ERROR           TO TRUE                      06920000
069300         SET PM-MESSAGE-INDEX        TO 14                        06930000
069400         MOVE -1                     TO ASELL                     06940000
069500     ELSE                                                         06950000
069600         IF CA-SELECTION-X NOT = SPACES                           06960000
069700             MOVE DP010I-NUMERIC-FIELD TO CA-SELECTION            06970000
069800             MOVE CA-SELECTION-X     TO ASELO                     06980000
069900         END-IF                                                   06990000
070000     END-IF.                                                      07000000
070100                                                                  07010000
070200     IF NOT CA-VALID-SELECTION                                    07020000
070300         MOVE DFHREVRS               TO ASELH                     07030000
070400         IF PS-NO-EDIT-ERROR                                      07040000
070500             SET PS-EDIT-ERROR       TO TRUE                      07050000
070600             SET PM-MESSAGE-INDEX    TO 7                         07060000
070700             MOVE -1                 TO ASELL                     07070000
070800         END-IF                                                   07080000
070900     END-IF.                                                      07090000
071000                                                                  07100000
074900*                                                                 07490000
075000*  THE ACCOUNT NUMBER MUST BE NUMERIC, IF ENTERED.  IF THE        07500000
075100*  ACCOUNT NUMBER IS REQUIRED, IT CANNOT EQUAL ZERO, MUST HAVE    07510000
075200*  A VALID CRS OR KOHLS ACCOUNT PREFIX (DEPENDING ON THE          07520000
075300*  SELECTION), AND MUST CHECK DIGIT (MOD 10).  BASED ON THE       07530000
075400*  SELECTION, THE ACCOUNT NUMBER IS USED IN A LOOKUP ON THE       07540000
075500*  APPROPRIATE FILE, AND MUST EXIST OR NOT EXIST, WHICH EVER      07550000
075600*  IS APPROPRIATE FOR THE SELECTION/ACTION.                       07560000
075800                                                                  07580000
075900     MOVE CA-ACCOUNT-NUMBER-X        TO DP010I-UNEDITED-FIELD.    07590000
076000     MOVE 10                         TO DP010I-MAXIMUM-DIGITS.    07600000
076100     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  07610000
076200     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     07620000
076310     CALL DP010I-NUMERIC-EDIT-ROUTINE                             07631099
076320                         USING DP010I-NUMERIC-EDIT-AREA           07632099
076400                                                                  07640000
076500     IF DP010I-ERROR-DETECTED                                     07650000
076600         MOVE DFHREVRS               TO AACCTH                    07660000
076700         IF PS-NO-EDIT-ERROR                                      07670000
076800             SET PS-EDIT-ERROR       TO TRUE                      07680000
076900             SET PM-MESSAGE-INDEX    TO 9                         07690000
077000             MOVE -1                 TO AACCTL                    07700000
077100         END-IF                                                   07710000
077200     ELSE                                                         07720000
077300         IF CA-ACCOUNT-NUMBER-X NOT = SPACES                      07730000
077400             MOVE DP010I-NUMERIC-FIELD TO CA-ACCOUNT-NUMBER       07740000
077500                                          CC-ACCOUNT-NUMBER       07750000
077600             MOVE CA-ACCOUNT-NUMBER-X  TO AACCTO                  07760000
077700             PERFORM 2210-CHECK-DIGIT-ACCOUNT                     07770000
077800         END-IF                                                   07780000
077900     END-IF.                                                      07790000
078000                                                                  07800000
078100     EVALUATE TRUE                                                07810000
078400         WHEN CA-ACCOUNT-NUMBER-X = SPACES                        07840000
078500             MOVE DFHREVRS TO AACCTH                              07850000
078600             IF PS-NO-EDIT-ERROR AND CA-SELECTION = 1             07860000
078700                 SET PS-EDIT-ERROR TO TRUE                        07870000
078800                 SET PM-MESSAGE-INDEX TO 10                       07880000
078900                 MOVE -1 TO AACCTL                                07890000
079000             END-IF                                               07900000
079100         WHEN CA-ACCOUNT-NUMBER = ZERO                            07910000
079200             MOVE DFHREVRS TO AACCTH                              07920000
079300             IF PS-NO-EDIT-ERROR                                  07930000
079400                 SET PS-EDIT-ERROR TO TRUE                        07940000
079500                 SET PM-MESSAGE-INDEX TO 11                       07950000
079600                 MOVE -1 TO AACCTL                                07960000
079700             END-IF                                               07970000
081500         WHEN CC-ACCOUNT-CHECK-DIGIT NOT =                        08150000
081600                             CC-COMPUTED-CHECK-DIGIT              08160000
081700             MOVE DFHREVRS TO AACCTH                              08170000
081800             IF PS-NO-EDIT-ERROR                                  08180000
081900                 SET PS-EDIT-ERROR TO TRUE                        08190000
082000                 SET PM-MESSAGE-INDEX TO 14                       08200000
082100                 MOVE -1 TO AACCTL                                08210000
082200             END-IF                                               08220000
085700     END-EVALUATE.                                                08570000
085800                                                                  08580000
093200*2200-EXIT.                                                       09320000
093300                                                                  09330000
093400******************************************************************09340000
093500*  CHECK DIGIT THE ACCOUNT NUMBER.  USE A MOD 10 CHECK, WHERE    *09350000
093600*  THE FINAL DIGIT IS THE CHECK DIGIT.  COMPUTE WHAT THE CHECK   *09360000
093700*  DIGIT SHOULD BE FOR THE GIVEN ACCOUNT NUMBER.                 *09370000
093800******************************************************************09380000
094000 2210-CHECK-DIGIT-ACCOUNT.                                        09400000
094100     SET PS-MULTIPLY-DIGIT-BY-2 TO TRUE.                          09410000
094200     INITIALIZE CC-MOD-10-DIGIT-SUM.                              09420000
094300                                                                  09430000
094400     PERFORM                                                      09440000
094500             VARYING CC-DIGIT-INDEX                               09450000
094600             FROM 1 BY 1                                          09460000
094700             UNTIL CC-DIGIT-INDEX > PC-MAXIMUM-ACCOUNT-DIGITS     09470000
094800         IF PS-MULTIPLY-DIGIT-BY-2                                09480000
094900             COMPUTE CC-ACCOUNT-DIGIT-MOD-10 =                    09490000
095000                       (CC-ACCOUNT-DIGIT (CC-DIGIT-INDEX) * 2)    09500000
095100             IF CC-ACCOUNT-DIGIT-MOD-10 > PC-MAXIMUM-DIGIT-AMOUNT 09510000
095200                 SUBTRACT PC-MAXIMUM-DIGIT-AMOUNT FROM            09520000
095300                           CC-ACCOUNT-DIGIT-MOD-10                09530000
095400             END-IF                                               09540000
095500             ADD CC-ACCOUNT-DIGIT-MOD-10 TO CC-MOD-10-DIGIT-SUM   09550000
095600             SET PS-MULTIPLY-DIGIT-BY-1 TO TRUE                   09560000
095700         ELSE                                                     09570000
095800             ADD CC-ACCOUNT-DIGIT (CC-DIGIT-INDEX) TO             09580000
095900                       CC-MOD-10-DIGIT-SUM                        09590000
096000             SET PS-MULTIPLY-DIGIT-BY-2 TO TRUE                   09600000
096100         END-IF                                                   09610000
096200     END-PERFORM.                                                 09620000
096300                                                                  09630000
096400     COMPUTE CC-COMPUTED-CHECK-DIGIT =                            09640000
096500               (PC-MOD-10 - CC-MOD-10-DIGIT-SUM).                 09650000
096600*2210-EXIT.                                                       09660000
096700                                                                  09670000
096800******************************************************************09680000
096900*  IN THE CASE THAT THE CLEAR KEY IS PRESSED, RE-SEND THE MAP    *09690000
097000*  AND DATA FROM THE LAST PASS THROUGH THE PROGRAM.              *09700000
097100******************************************************************09710000
097300 5000-SEND-MAP-AND-DATA.                                          09730000
097400     MOVE DFHCOMMAREA TO CA-COMMON-AREA.                          09740000
097500     MOVE LOW-VALUES TO AR000AI.                                  09750000
097600                                                                  09760000
097700     PERFORM 6000-UPDATE-SCREEN-HEADER.                           09770000
097800     MOVE CA-SELECTION-X TO ASELI.                                09780000
098000     MOVE CA-ACCOUNT-NUMBER-X TO AACCTI.                          09800000
098200     MOVE PM-PROGRAM-MESSAGE (1) TO AMSGO.                        09820000
098300     MOVE -1 TO ASELL.                                            09830000
098400                                                                  09840000
098500     EXEC CICS                                                    09850000
098600         SEND                                                     09860000
098700             MAP('AR000A')                                        09870000
098800             MAPSET('ARKM000')                                    09880000
098900             ERASE                                                09890000
099000             CURSOR                                               09900000
099100             FORMFEED                                             09910000
099200             RESP(PV-CICS-RESPONSE)                               09920000
099300     END-EXEC.                                                    09930000
099400                                                                  09940000
099500     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    09950000
099600         MOVE 'SEND THE DATA AFTER CLEARING' TO                   09960000
099700                   SE-ATTEMPTED-ACTION                            09970000
099800         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                09980000
099900         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  09990000
100000         PERFORM 9900-LEAVE-SYSTEM                                10000000
100100     END-IF.                                                      10010000
100200                                                                  10020000
100300     EXEC CICS                                                    10030000
100400         RETURN                                                   10040000
100500             TRANSID('A000')                                      10050000
100600             COMMAREA(CA-COMMON-AREA)                             10060000
100700             LENGTH(PC-COMMON-AREA-LENGTH)                        10070000
100800             RESP(PV-CICS-RESPONSE)                               10080000
100900     END-EXEC.                                                    10090000
101000                                                                  10100000
101100     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    10110000
101200         MOVE 'RETURN AFTER THE CLEARED MAP SEND' TO              10120000
101300                   SE-ATTEMPTED-ACTION                            10130000
101400         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                10140000
101500         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  10150000
101600         PERFORM 9900-LEAVE-SYSTEM                                10160000
101700     END-IF.                                                      10170000
101800*5000-EXIT.                                                       10180000
101900                                                                  10190000
102000******************************************************************10200000
102100*  FILL IN THE SCREEN HEADER WITH THE DATE, TIME, AND TERMINAL   *10210000
102200*  NUMBER.                                                       *10220000
102300******************************************************************10230000
102500 6000-UPDATE-SCREEN-HEADER.                                       10250000
102600     EXEC CICS                                                    10260000
102700         ASKTIME                                                  10270000
102800             ABSTIME(ST-ABSTIME)                                  10280000
102900     END-EXEC.                                                    10290000
103000                                                                  10300000
103100     EXEC CICS                                                    10310000
103200         FORMATTIME                                               10320000
103300             ABSTIME(ST-ABSTIME)                                  10330000
103400             MMDDYY(ADATEO)                                       10340000
103500             DATESEP                                              10350000
103600             TIME(ST-TIME-EDIT)                                   10360000
103700             TIMESEP                                              10370000
103800     END-EXEC.                                                    10380000
103900                                                                  10390000
104000     MOVE ST-TIME-HHMM TO ATIMEO.                                 10400000
104100     MOVE EIBTRMID TO ATERMO.                                     10410000
104200*6000-EXIT.                                                       10420000
117121                                                                  11712100
117130******************************************************************11713000
117200*  TRANSFER CONTROL TO THE REQUESTED PROGRAM.  IF THE PROGRAM    *11720000
117300*  IS NOT AVAILABLE, DISPLAY AN ERROR MESSAGE, AND DO NOT        *11730000
117400*  TRANSFER CONTROL.                                             *11740000
117500******************************************************************11750000
117700 9000-TRANS-TO-SELECTED-PROG.                                     11770000
117800     SET CA-INITIALIZE-SCREEN     TO TRUE.                        11780000
117900     MOVE PC-CURRENT-PROGRAM-NAME TO CA-LAST-PROGRAM-NAME.        11790000
118000                                                                  11800000
118100     EXEC CICS                                                    11810000
118200         XCTL                                                     11820000
118300             PROGRAM(PV-TRANSFER-PROGRAM-NAME)                    11830000
118400             COMMAREA(CA-COMMON-AREA)                             11840000
118500             LENGTH(PC-TRANSFER-DOWN-LENGTH)                      11850000
118600             RESP(PV-CICS-RESPONSE)                               11860000
118700     END-EXEC.                                                    11870000
118800                                                                  11880000
118900     IF PV-CICS-RESPONSE = DFHRESP(PGMIDERR)                      11890000
119000         SET PM-MESSAGE-INDEX TO 13                               11900000
119100         MOVE DFHREVRS TO ASELH                                   11910000
119200         MOVE -1 TO ASELL                                         11920000
119300         SET CA-PROCESS-SCREEN TO TRUE                            11930000
119400     ELSE                                                         11940000
119500         STRING 'XCTL TO '               DELIMITED BY SIZE        11950000
119600                PV-TRANSFER-PROGRAM-NAME DELIMITED BY SIZE        11960000
119700             INTO SE-ATTEMPTED-ACTION                             11970000
119800         MOVE PV-CICS-RESPONSE TO SE-CICS-RESPONSE                11980000
119900         MOVE SE-SYSTEM-ERROR-MESSAGE TO PV-LEAVE-SYSTEM-MESSAGE  11990000
120000         PERFORM 9900-LEAVE-SYSTEM                                12000000
120100     END-IF.                                                      12010000
120200*9000-EXIT.                                                       12020000
120300                                                                  12030000
120400******************************************************************12040000
120500*  EXIT THE ACCOUNTS RECEIVABLE EMPLOYEE DISCOUNT SYSTEM,        *12050000
120600*  DISPLAYING A REASON FOR THE PROGRAM ABEND, OR A NORMAL        *12060000
120700*  TERMINATION MESSAGE.                                          *12070000
120800******************************************************************12080000
121000 9900-LEAVE-SYSTEM.                                               12100000
121100     EXEC CICS                                                    12110000
121200         SEND                                                     12120000
121300             FROM(PV-LEAVE-SYSTEM-MESSAGE)                        12130000
121400             LENGTH(PC-LEAVE-SYSTEM-LENGTH)                       12140000
121500             ERASE                                                12150000
121600     END-EXEC.                                                    12160000
121700                                                                  12170000
121800     EXEC CICS                                                    12180000
121900         RETURN                                                   12190000
122000     END-EXEC.                                                    12200000
122100*9900-EXIT.                                                       12210000
122200     EJECT                                                        12220000
122300******************************************************************12230000
122400*  EXIT THE ACCOUNTS RECEIVABLE EMPLOYEE DISCOUNT SYSTEM         *12240000
122500*  DISPLAYING A NORMAL TERMINATION MESSAGE AND STARTING THE CICS *12250000
122600*  ARCHITECTURE NAVIGATOR TO RETURN TO LAST CICS ARCHITECTURE    *12260000
122700*  TRANSACTION OR MENU.                                          *12270000
122800******************************************************************12280000
123000 9910-RETURN-TO-ARCH.                                             12300000
123100                                                                  12310000
123200     EXEC CICS                                                    12320000
123300         SEND                                                     12330000
123400             FROM(PV-LEAVE-SYSTEM-MESSAGE)                        12340000
123500             LENGTH(PC-LEAVE-SYSTEM-LENGTH)                       12350000
123600             ERASE                                                12360000
123700     END-EXEC.                                                    12370000
123800                                                                  12380000
123900     EXEC CICS                                                    12390000
124000         START                                                    12400000
124100              TRANSID ('MENU')                                    12410000
124200              TERMID  (EIBTRMID)                                  12420000
124300     END-EXEC.                                                    12430000
124400                                                                  12440000
124500     EXEC CICS                                                    12450000
124600         RETURN                                                   12460000
124700     END-EXEC.                                                    12470000
124800                                                                  12480000
124900*9910-RETURN-TO-ARCH-EXIT.                                        12490000
125000                                                                  12500000
