000100******************************************************************00010028
000200 IDENTIFICATION DIVISION.                                         00020028
000300******************************************************************00030028
000400                                                                  00040028
000500 PROGRAM-ID.             ARKUP017.                                00050028
000600 AUTHOR.                 AMY REILAND.                             00060028
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070028
000800 DATE-WRITTEN            12-05-95.                                00080028
000900 DATE-COMPILED.                                                   00090028
001000******************************************************************00100028
001100* THIS PROGRAM WILL EVALUATE THE SELECT SYSTEM DATE PASSED FROM   00110028
001200* THE TANDEM.  THE PROGRAM WILL DETERMINE THE TYPE OF DATE:       00120028
001300* SATURDAY, SATURDAY MONTH ENDING, AND/OR BILLING DATE.           00130028
001400* THE BILLING CYCLE WILL ALSO BE PASSED ON THE INPUT FILE IF IT   00140028
001500* IS A BILLING DAY. IF NOT A BILLING DAY, BILLING CYCLE WILL BE 0.00150028
001600* RETURN CODES WILL BE SET BASED ON WHAT TYPE OF DAY IS PROCESSED.00160028
001700*                                                                 00170028
001800*     4050 - NON-BILLING DATE, NOT SATURDAY                       00180028
001900*     4051 - NON-BILLING DATE, SATURDAY MONTH-END                 00190028
002000*     4052 - NON-BILLING DATE, SATURDAY, NOT MONTH END            00200028
002100*     4060 - BILLING DATE, NOT SATURDAY                           00210028
002200*     4061 - BILLING DATE, SATURDAY MONTH-END                     00220028
002300*     4062 - BILLING DATE, SATURDAY, NOT MONTH END                00230028
002400*                                                                 00240028
002500* THE PROGRAM WILL ALSO DETERMINE IF A DAY OF PROCESSING WAS      00250028
002600* MISSED.  A CONTROL CARD WILL KEEP THE LAST DATE WHICH WAS       00260028
002700* PROCESSED BY THE PROGRAM.  THIS CONTROL CARD WILL BE COMPARED   00270028
002800* WITH THE DATE FROM THE TANDEM.  IF THEY ARE NOT 1 DAY APART,    00280028
002900* THE PROGRAM WILL ABEND AND INDICATE THAT THE PREVIOUS DAY WAS   00290028
003000* NOT PROCESSED.                                                  00300028
003100******************************************************************00310028
003200* CHANGE HISTORY                                                  00320028
003300* AR CONVERSION   10/14/2011  First Data WILL send the files after00330028
003400*                             Midnight. So the posting date will  00340028
003500*                             always be 1 day prior to the actual 00350028
003600*                             day of receiving the files.         00360028
003700*                             FD will not transmit their files on 00370028
003800*                             Sundays unless the day before Sunday00380028
003900*                             (Saturday) falls on Month end. In   00390028
004000*                             above case, there won't be any files00400028
004100*                             received on Monday.                 00410028
004200*----------------------------------------------------------------*00420028
004300*  IF CALENDAR MONTH-END IS NOT A SATURDAY, THERE WON'T BE ANY    00430028
004400*  TRANSMISSION ON SUNDAY.                                        00440028
004500*  IF CALENDAR MONTH-END IS A SATURDAY, THERE WON'T BE ANY        00450028
004600*  TRANSMISSION ON MONDAY.                                        00460028
004700*----------------------------------------------------------------*00470028
004800******************************************************************00480028
004900 ENVIRONMENT DIVISION.                                            00490028
005000******************************************************************00500028
005100                                                                  00510028
005200 CONFIGURATION SECTION.                                           00520028
005300                                                                  00530028
005400 SOURCE-COMPUTER.        IBM-3090.                                00540028
005500 OBJECT-COMPUTER.        IBM-3090.                                00550028
005600                                                                  00560028
005700 INPUT-OUTPUT SECTION.                                            00570028
005800                                                                  00580028
005900 FILE-CONTROL.                                                    00590028
006000                                                                  00600028
006100      SELECT SDF-SYSTEM-DATE-FILE          ASSIGN TO INP01.       00610028
006200      SELECT CDF-CONTROL-DATE-FILE         ASSIGN TO UPD01.       00620028
006300                                                                  00630028
006400******************************************************************00640028
006500 DATA DIVISION.                                                   00650028
006600******************************************************************00660028
006700                                                                  00670028
006800 FILE SECTION.                                                    00680028
006900 FD  SDF-SYSTEM-DATE-FILE                                         00690028
007000     LABEL RECORDS ARE STANDARD                                   00700028
007100     BLOCK CONTAINS 0 RECORDS                                     00710028
007200     RECORDING MODE IS F                                          00720028
007300     RECORD CONTAINS 80  CHARACTERS                               00730028
007400     DATA RECORD IS SDF-SYSTEM-DATE-RECORD.                       00740028
007500                                                                  00750028
007600 01  SDF-SYSTEM-DATE-RECORD          PIC X(80).                   00760028
007700                                                                  00770028
007800 FD  CDF-CONTROL-DATE-FILE                                        00780028
007900     LABEL RECORDS ARE STANDARD                                   00790028
008000     BLOCK CONTAINS 0 RECORDS                                     00800028
008100     RECORDING MODE IS F                                          00810028
008200     RECORD CONTAINS 80  CHARACTERS                               00820028
008300     DATA RECORD IS CDF-CONTROL-DATE-RECORD.                      00830028
008400                                                                  00840028
008500 01  CDF-CONTROL-DATE-RECORD         PIC X(80).                   00850028
008600                                                                  00860028
008700********************************************************          00870028
008800 WORKING-STORAGE SECTION.                                         00880028
008900********************************************************          00890028
009000 01 PC-PROGRAM-CONSTANTS.                                         00900028
009100    05 PC-PROGRAM-NAME               PIC  X(08) VALUE 'ARKUP017'. 00910028
009200    05 PC-SATURDAY                   PIC  X(03) VALUE 'SAT'.      00920028
009300    05 PC-SUNDAY                     PIC  X(03) VALUE 'SUN'.      00930028
009400    05 PC-MONDAY                     PIC  X(03) VALUE 'MON'.      00940028
009500    05 PC-FORWARD-1-DAY              PIC  9(01) VALUE 1.          00950028
009600    05 PC-FORWARD-2-DAYS             PIC  9(01) VALUE 2.          00960028
009700    05 WS-SYSTEM-DATE                PIC  9(08) VALUE 0.          00970028
009800                                                                  00980028
009900 01 PV-PROGRAM-VARIABLES.                                         00990028
010000    05 ABEND-CODE                    PIC S9(04) VALUE +0          01000028
010100                                              COMP SYNC.          01010028
010200    05 PV-ISO-DATE-FORMAT            PIC X(10).                   01020028
010300                                                                  01030028
010400 01 PS-PROGRAM-SWITCHES.                                          01040028
010500    05 PS-BILLING-IND                PIC  X(01)    VALUE 'N'.     01050028
010600       88 PS-BILLING                               VALUE 'Y'.     01060028
010700       88 PS-NOT-A-BILLING                         VALUE 'N'.     01070028
010800    05 PS-END-OF-MONTH-IND           PIC  X(01)    VALUE 'N'.     01080028
010900       88 PS-END-OF-MONTH                          VALUE 'Y'.     01090028
011000       88 PS-NOT-END-OF-MONTH                      VALUE 'N'.     01100028
011100    05 PS-SATURDAY-IND               PIC  X(01)    VALUE 'N'.     01110028
011200       88 PS-SATURDAY                              VALUE 'Y'.     01120028
011300       88 PS-NOT-SATURDAY                          VALUE 'N'.     01130028
011400    05 PS-SUNDAY-IND                 PIC  X(01)    VALUE 'N'.     01140028
011500       88 PS-SUNDAY                                VALUE 'Y'.     01150028
011600       88 PS-NOT-SUNDAY                            VALUE 'N'.     01160028
011700    05 PS-MONDAY-IND                 PIC  X(01)    VALUE 'N'.     01170028
011800       88 PS-MONDAY                                VALUE 'Y'.     01180028
011900       88 PS-NOT-MONDAY                            VALUE 'N'.     01190028
012000                                                                  01200028
012100*** CONTROL DATE AREA                                             01210028
012200 01 WS-CONTROL-DATE-AREA.                                         01220028
012300    05 WS-CONTROL-DATE.                                           01230028
012400       10  WS-CONTROL-CC             PIC  9(02)      VALUE ZEROS. 01240028
012500       10  WS-CONTROL-YY             PIC  9(02)      VALUE ZEROS. 01250028
012600       10  WS-CONTROL-MM             PIC  9(02)      VALUE ZEROS. 01260028
012700       10  WS-CONTROL-DD             PIC  9(02)      VALUE ZEROS. 01270028
012800    05 WS-EOM-IND                    PIC  X(01)      VALUE ZEROS. 01280028
012900    05 FILLER                        PIC  X(71)      VALUE SPACES.01290028
013000                                                                  01300028
013100*** SYSTEM DATE RECORD                                            01310028
013200     COPY ARRD009.                                                01320028
013300                                                                  01330028
013400     COPY DPWS500.                                                01340028
013500****                                                              01350028
013600********************************************************          01360028
013700 PROCEDURE DIVISION.                                              01370028
013800********************************************************          01380028
013900 0000-MAIN.                                                       01390028
014000     PERFORM 1000-INITIALIZATION.                                 01400028
014100                                                                  01410028
014200     PERFORM 2000-DETERMINE-RETURN-CODE.                          01420028
014300                                                                  01430028
014400     PERFORM 3000-UPDATE-CONTROL-FILE.                            01440028
014500                                                                  01450028
014600     PERFORM 5000-FINISH.                                         01460028
014700                                                                  01470028
014800     STOP RUN.                                                    01480028
014900                                                                  01490028
015000*0000-EXIT.                                                       01500028
015100                                                                  01510028
015200 1000-INITIALIZATION.                                             01520028
015300                                                                  01530028
015400     OPEN INPUT SDF-SYSTEM-DATE-FILE                              01540028
015500                CDF-CONTROL-DATE-FILE.                            01550028
015600                                                                  01560028
015700*-------------------------------------------------------------    01570028
015800* READ SELECT SYSTEM DATE FILE, CALL DATE ROUTINE TO VALIDATE     01580028
015900*-------------------------------------------------------------    01590028
016000     READ SDF-SYSTEM-DATE-FILE                                    01600028
016100         INTO AR009-SYSTEM-DATE-RECORD                            01610028
016200         AT END                                                   01620028
016300             DISPLAY '** ABEND **'                                01630028
016400             DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME              01640028
016500             DISPLAY '** PARA = 1000-INITIALIZATION'              01650028
016600             DISPLAY '** INPUT SYSTEM DATE FILE IS EMPTY **'      01660028
016700             MOVE +4003         TO ABEND-CODE                     01670028
016800             CALL 'ILBOABN0'   USING ABEND-CODE                   01680028
016900     END-READ.                                                    01690028
017000                                                                  01700028
017100     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              01710028
017200     ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          01720028
017300     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     01730028
017400     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     01740028
017500     SET DPG52-LK-DTE-ISO            TO TRUE.                     01750028
017600     MOVE AR009-SYSTEM-DATE          TO DPG52-LK-DATE-INPUT.      01760028
017700                                                                  01770028
017800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    01780028
017900                                             DPG54 DPG55 DPG56.   01790028
018000     IF DPG54-DATE-INVALID                                        01800028
018100         DISPLAY '** ABEND **'                                    01810028
018200         DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME                  01820028
018300         DISPLAY '** PARA = 1000-INITIALIZATION'                  01830028
018400         DISPLAY '** INVALID SELECT SYSTEM DATE ('                01840028
018500             AR009-SYSTEM-DATE ') **'                             01850028
018600         MOVE +4003  TO   ABEND-CODE                              01860028
018700         CALL 'ILBOABN0'   USING ABEND-CODE                       01870028
018800     END-IF.                                                      01880028
018900*-------------------------------------------------------------    01890028
019000* FORMAT THE SELECT SYSTEM DATE INTO ISO FORMAT CCYY-MM-DD        01900028
019100*-------------------------------------------------------------    01910028
019200     STRING                                                       01920028
019300        AR009-SYSTEM-CC                                           01930028
019400        AR009-SYSTEM-YY                                           01940028
019500        '-'                                                       01950028
019600        AR009-SYSTEM-MM                                           01960028
019700        '-'                                                       01970028
019800        AR009-SYSTEM-DD                                           01980028
019900        DELIMITED BY SIZE                                         01990028
020000        INTO PV-ISO-DATE-FORMAT                                   02000028
020100     END-STRING.                                                  02010028
020200                                                                  02020028
020300*-------------------------------------------------------------    02030028
020400* CHECK TO SEE IF THE BILLING CYCLE # FROM THE INUT FILE IS       02040028
020500* NUMERIC AND NOT GREATER THAN 90                                 02050028
020600*-------------------------------------------------------------    02060028
020700     IF  (AR009-BILLING-CYCLE NOT NUMERIC                         02070028
020800       OR AR009-BILLING-CYCLE > 90)                               02080028
020900         DISPLAY '** ABEND **'                                    02090028
021000         DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME                  02100028
021100         DISPLAY '** PARA = 1000-INITIALIZATION'                  02110028
021200         DISPLAY '** INVALID BILLING CYCLE INPUT ('               02120028
021300             AR009-BILLING-CYCLE ') **'                           02130028
021400         MOVE +4003  TO   ABEND-CODE                              02140028
021500         CALL 'ILBOABN0'   USING ABEND-CODE                       02150028
021600     END-IF.                                                      02160028
021700                                                                  02170028
021800     DISPLAY 'ARKUP017 - SYSTEM DATE FILE INPUT: ('               02180028
021900             AR009-SYSTEM-DATE AR009-BILLING-CYCLE ')'.           02190028
022000                                                                  02200028
022100*-------------------------------------------------------------    02210028
022200* READ THE CONTROL DATE CARD PKMO.CONTROL(ARCC002)                02220028
022300*-------------------------------------------------------------    02230028
022400     READ CDF-CONTROL-DATE-FILE                                   02240028
022500         INTO WS-CONTROL-DATE-AREA                                02250028
022600         AT END                                                   02260028
022700             DISPLAY '** ABEND **'                                02270028
022800             DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME              02280028
022900             DISPLAY '** PARA = 1000-INITIALIZATION'              02290028
023000             DISPLAY '** INPUT CONTROL FILE IS EMPTY **'          02300028
023100             MOVE +4003         TO ABEND-CODE                     02310028
023200             CALL 'ILBOABN0'   USING ABEND-CODE                   02320028
023300     END-READ.                                                    02330028
023400                                                                  02340028
023500*-------------------------------------------------------------    02350028
023600* VALIDATE THE CONTROL CARD DATE                                  02360028
023700*-------------------------------------------------------------    02370028
023800     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02380028
023900     ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          02390028
024000     SET DPG51-ACTUAL-CALENDAR-ONLY  TO TRUE.                     02400028
024100     SET DPG51-DO-NOT-INCR-DECR-DATE TO TRUE.                     02410028
024200     SET DPG52-LK-DTE-ISO            TO TRUE.                     02420028
024300     MOVE WS-CONTROL-DATE            TO DPG52-LK-DATE-INPUT.      02430028
024400                                                                  02440028
024500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    02450028
024600                                             DPG54 DPG55 DPG56.   02460028
024700     IF DPG54-DATE-INVALID                                        02470028
024800         DISPLAY '** ABEND **'                                    02480028
024900         DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME                  02490028
025000         DISPLAY '** PARA = 1000-INITIALIZATION'                  02500028
025100         DISPLAY '** INVALID CONTROL CARD DATE ('                 02510028
025200             WS-CONTROL-DATE ') **'                               02520028
025300         MOVE +4003  TO   ABEND-CODE                              02530028
025400         CALL 'ILBOABN0'   USING ABEND-CODE                       02540028
025500     END-IF.                                                      02550028
025600                                                                  02560028
025700     DISPLAY 'ARKUP017 - CONTROL DATE INPUT: ('                   02570028
025800               WS-CONTROL-DATE ')'.                               02580028
025900                                                                  02590028
026000*-------------------------------------------------------------    02600028
026100*  THE SYSTEM DATE FILE SHOULD HAVE A DATE GREATER THAN THE       02610028
026200*  CONTROL FILE.  THE CONTROL FILE SHOULD BE THE PREVIOUS DAYS    02620028
026300*  DATE.                                                          02630028
026400*-------------------------------------------------------------    02640028
026500     IF AR009-SYSTEM-DATE <= WS-CONTROL-DATE                      02650028
026600         DISPLAY '** ABEND **'                                    02660028
026700         DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME                  02670028
026800         DISPLAY '** PARA = 1000-INITIALIZATION'                  02680028
026900         DISPLAY '** SYSTEM DATE IS <= CONTROL DATE **'           02690028
027000         MOVE +4003         TO ABEND-CODE                         02700028
027100         CALL 'ILBOABN0'   USING ABEND-CODE                       02710028
027200     END-IF.                                                      02720028
027300                                                                  02730028
027400*-------------------------------------------------------------    02740028
027500*  THE SYSTEM DATE FILE SHOULD BE ONLY 1 DAY GREATER THAN THE     02750028
027600*  CONTROL DATE.  ONE DAY IS ADDED TO THE CONTROL DATE AND        02760028
027700*  COMPARED TO THE INPUT SELECT SYSTEM DATE.                      02770028
027800*  First Data won't send any files on Sundays. Only exception     02780028
027900*  is if the previous day(Saturday) is calendar MONTH-END.        02790028
028000*                                                                 02800028
028100*  For example: 03/31/2012 is a Saturday which falls on a calendar02810028
028200*  month-end. So FD will send a file on Sunday which is 04/01/201202820028
028300*  Instead on 04/02/2012, FD will not send any file.              02830028
028400*                                                                 02840028
028500*  The reverse is also true. For example 04/28/2012 is a fiscal   02850028
028600*  end BUT not a calendar month end. So on 04/29/2012 we will NOT 02860028
028700*  receive a file from FD being a Sunday. The next file received  02870028
028800*  on 04/30/2012 will have a posting date of 04/29/2012 and so    02880028
028900*  System won't recognize that it is a MONTH-END file. So 1 day   02890028
029000*  will be decremented from posting date and month end check      02900028
029100*  will be performed.                                             02910028
029200*-------------------------------------------------------------    02920028
029300     SET PS-NOT-A-BILLING                                         02930028
029400         PS-NOT-END-OF-MONTH                                      02940028
029500         PS-NOT-SATURDAY                                          02950028
029600         PS-NOT-SUNDAY                                            02960028
029700         PS-NOT-MONDAY   TO TRUE.                                 02970028
029800                                                                  02980028
029900     MOVE AR009-SYSTEM-DATE TO WS-SYSTEM-DATE.                    02990028
030000     PERFORM 2100-DETERMINE-IF-MONTH-END.                         03000028
030100     PERFORM 2200-DETERMINE-THE-DAY.                              03010028
030200                                                                  03020028
030300* The following will take care of 04/28/2012 scenario.            03030028
030400* PS-SUNDAY will be set to true for files received on Monday.     03040028
030500                                                                  03050028
030600     IF (AR009-SYSTEM-DD > 20 AND AR009-SYSTEM-DD < 32 OR         03060028
030700         AR009-SYSTEM-DD > 00 AND AR009-SYSTEM-DD < 07 )          03070028
030800     AND PS-SUNDAY                                                03080028
030900     AND PS-NOT-END-OF-MONTH                                      03090028
031000         PERFORM 1500-DECREMENT-SYSDATE-1                         03100028
031100         PERFORM 2100-DETERMINE-IF-MONTH-END                      03110028
031200     END-IF.                                                      03120028
031300                                                                  03130028
031400     MOVE WS-SYSTEM-DATE   TO AR009-SYSTEM-DATE.                  03140028
031500     PERFORM 1050-ADD-TO-CONTROL-DATE.                            03150028
031600                                                                  03160028
031700     IF AR009-SYSTEM-DATE NOT = DPG55-DB2-ISO-DATE                03170028
031800         DISPLAY '** ABEND **'                                    03180028
031900         DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME                  03190028
032000         DISPLAY '** PARA = 1000-INITIALIZATION'                  03200028
032100         IF PS-SUNDAY OR                                          03210028
032200            (WS-EOM-IND = "M" AND PS-MONDAY)                      03220028
032300            DISPLAY '** SYSTEM DATE IS NOT 2 DAYS GREATER'        03230028
032400                    ' THAN CONTROL DATE **'                       03240028
032500         ELSE                                                     03250028
032600            DISPLAY '** SYSTEM DATE IS NOT 1 DAY GREATER'         03260028
032700                    ' THAN CONTROL DATE **'                       03270028
032800         END-IF                                                   03280028
032900         MOVE +4003         TO ABEND-CODE                         03290028
033000         CALL 'ILBOABN0'   USING ABEND-CODE                       03300028
033100     END-IF.                                                      03310028
033200                                                                  03320028
033300     CLOSE  CDF-CONTROL-DATE-FILE.                                03330028
033400*1000-EXIT.  EXIT.                                                03340028
033500*-----------------------------------------------------------------03350028
033600* ADD 1 DAY TO CONTROL DATE TO SEE IF IT IS EQUAL TO SYSTEM DATE *03360028
033700*-----------------------------------------------------------------03370028
033800 1050-ADD-TO-CONTROL-DATE.                                        03380028
033900     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              03390028
034000     ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          03400028
034100     SET DPG51-ACTUAL-CALENDAR-ONLY TO TRUE.                      03410028
034200     SET DPG51-INCREMENT-DATE       TO TRUE.                      03420028
034300     SET DPG52-LK-DTE-ISO           TO TRUE.                      03430028
034400** PS-SUNDAY will be true if files received on Mondays and        03440028
034500** PS-MONDAY will be true if files received on Tuesdays.          03450028
034600** For files received on Mondays and not End-of-Month OR          03460028
034700** for files received on Tuesdays after End-of-Month (this will   03470028
034800** happen only when calendar month-end falls on a Saturday),      03480028
034900** there will be 2 days diff between Control card & posting date. 03490028
035000     IF PS-SUNDAY OR                                              03500028
035100        (WS-EOM-IND = "M" AND PS-MONDAY)                          03510028
035200        MOVE PC-FORWARD-2-DAYS      TO DPG51-INCR-DECR-DAYS-9     03520028
035300     ELSE                                                         03530028
035400        MOVE PC-FORWARD-1-DAY       TO DPG51-INCR-DECR-DAYS-9     03540028
035500     END-IF                                                       03550028
035600     MOVE WS-CONTROL-DATE           TO DPG52-LK-DATE-INPUT.       03560028
035700                                                                  03570028
035800     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03580028
035900                                             DPG54 DPG55 DPG56.   03590028
036000     IF (DPG54-NO-ERROR       OR                                  03600028
036100         DPG54-WARNING-ERROR) AND                                 03610028
036200         DPG54-DATE-VALID                                         03620028
036300         CONTINUE                                                 03630028
036400     ELSE                                                         03640028
036500         IF DPG54-DATE-INVALID                                    03650028
036600             DISPLAY '** ABEND **'                                03660028
036700             DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME              03670028
036800             DISPLAY '** PARA = 1050-ADD-TO-CONTROL-DATE'         03680028
036900             DISPLAY '** BAD RESPONSE FROM DATE ROUTINE **'       03690028
037000             MOVE  +4008  TO ABEND-CODE                           03700028
037100             CALL 'ILBOABN0'   USING ABEND-CODE                   03710028
037200         END-IF                                                   03720028
037300     END-IF.                                                      03730028
037400*1050-EXIT.  EXIT.                                                03740028
037500*                                                                 03750028
037600* As there won't be any files received on Sunday,we have to ensure03760028
037700* that Monday's file is indeed End-of-Month file. Since EOM is    03770028
037800* based on fiscal calendar, it should be a Saturday. So decrement 03780028
037900* 1 day from Sunday's date and then check if it is fiscal EOM.    03790028
038000*                                                                 03800028
038100 1500-DECREMENT-SYSDATE-1.                                        03810028
038200*                                                                 03820028
038300* CALCULATE 1 DAY AGO                                             03830028
038400     INITIALIZE DPG51, DPG52, DPG53, DPG54, DPG55, DPG56.         03840028
038500     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   03850028
038600     SET  DPG51-DECREMENT-DATE         TO TRUE.                   03860028
038700     SET  DPG52-LK-DTE-ISO             TO TRUE.                   03870028
038800     MOVE 1                            TO DPG51-INCR-DECR-DAYS-9. 03880028
038900     MOVE AR009-SYSTEM-DATE            TO DPG52-LK-DATE-INPUT.    03890028
039000                                                                  03900028
039100     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03910028
039200                                             DPG54 DPG55 DPG56.   03920028
039300     IF (DPG54-NO-ERROR       OR                                  03930028
039400         DPG54-WARNING-ERROR) AND                                 03940028
039500         DPG54-DATE-VALID                                         03950028
039600         CONTINUE                                                 03960028
039700     ELSE                                                         03970028
039800         IF DPG54-DATE-INVALID                                    03980028
039900             DISPLAY '** ABEND ***'                               03990028
040000             DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME              04000028
040100             DISPLAY '** PARA = 1500-DECREMENT-SYSDATE-1 **'      04010028
040200             DISPLAY '** BAD RESPONSE FROM DATE ROUTINE **'       04020028
040300             MOVE  +4028  TO ABEND-CODE                           04030028
040400             CALL 'ILBOABN0'   USING ABEND-CODE                   04040028
040500         END-IF                                                   04050028
040600     END-IF.                                                      04060028
040700     IF DPG55-ALPHA-WEEK-DAY-ABBR3 = PC-SATURDAY                  04070028
040800        MOVE DPG55-DB2-ISO-DATE      TO AR009-SYSTEM-DATE         04080028
040900        MOVE DPG55-DB2-ISO-DATE-FMT  TO PV-ISO-DATE-FORMAT        04090028
041000     END-IF.                                                      04100028
041100*1500-EXIT.  EXIT.                                                04110028
041200                                                                  04120028
041300                                                                  04130028
041400*-------------------------------------------------------------    04140028
041500* DETERMINE WHAT RETURN CODE WILL BE SENT TO THE JOB BASED ON THE*04150028
041600* SELECT SYSTEM DATE AND CYCLE SENT TO THE PROGRAM.              *04160028
041700*-------------------------------------------------------------    04170028
041800 2000-DETERMINE-RETURN-CODE.                                      04180028
041900*    SET PS-NOT-A-BILLING                                         04190028
042000*        PS-NOT-END-OF-MONTH                                      04200028
042100*        PS-NOT-SATURDAY TO TRUE.                                 04210028
042200*    PERFORM 2100-DETERMINE-IF-MONTH-END.                         04220028
042300*    PERFORM 2200-DETERMINE-IF-SATURDAY.                          04230028
042400     IF (AR009-BILLING-CYCLE > ZERO                               04240028
042500     AND AR009-BILLING-CYCLE < 91)                                04250028
042600         SET PS-BILLING TO TRUE                                   04260028
042700     END-IF.                                                      04270028
042800                                                                  04280028
042900     IF PS-END-OF-MONTH                                           04290028
043000         IF PS-SATURDAY OR PS-SUNDAY                              04300028
043100             IF PS-BILLING                                        04310028
043200                 MOVE 4061 TO RETURN-CODE                         04320028
043300             ELSE                                                 04330028
043400                 MOVE 4051 TO RETURN-CODE                         04340028
043500             END-IF                                               04350028
043600         ELSE                                                     04360028
043700             DISPLAY '** ABEND **'                                04370028
043800             DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME              04380028
043900             DISPLAY '** PARA = 2000-DETERMINE-RETURN-CODES'      04390028
044000             DISPLAY '** MONTH END DATE WAS NOT CONSIDERED A'     04400028
044100                 ' SATURDAY **'                                   04410028
044200             MOVE +4003         TO ABEND-CODE                     04420028
044300             CALL 'ILBOABN0'   USING ABEND-CODE                   04430028
044400         END-IF                                                   04440028
044500     ELSE                                                         04450028
044600         IF PS-SATURDAY OR PS-SUNDAY                              04460028
044700             IF PS-BILLING                                        04470028
044800                 MOVE 4062 TO RETURN-CODE                         04480028
044900             ELSE                                                 04490028
045000                 MOVE 4052 TO RETURN-CODE                         04500028
045100             END-IF                                               04510028
045200         ELSE                                                     04520028
045300             IF PS-BILLING                                        04530028
045400                 MOVE 4060 TO RETURN-CODE                         04540028
045500             ELSE                                                 04550028
045600                 MOVE 4050 TO RETURN-CODE                         04560028
045700             END-IF                                               04570028
045800         END-IF                                                   04580028
045900     END-IF.                                                      04590028
046000                                                                  04600028
046100*2000-EXIT.  EXIT.                                                04610028
046200                                                                  04620028
046300*-------------------------------------------------------------    04630028
046400* DETERMINE IF THE DATE ENTERED IS A MONTH END DATE.             *04640028
046500* KOHL'S USES FISCAL MONTH END AND SO THE MONTH END WILL ALTERNATE04650028
046600* WITH 4 WEEKS-5 WEEKS-4 WEEKS. FOR EX, 2012 FISCAL MONTH-ENDS ARE04660028
046700* 01/28, 02/25, 03/31, 04/28, 05/26, 06/30, 07/28, 08/25, 09/29,  04670028
046800* 10/27, 11/24, 12/29.                                            04680028
046900*-------------------------------------------------------------    04690028
047000 2100-DETERMINE-IF-MONTH-END.                                     04700028
047100                                                                  04710028
047200     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              04720028
047300     ACCEPT DPG51-SYSTEM-DATE FROM DATE.                          04730028
047400     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      04740028
047500     SET DPG52-LK-DTE-ISO           TO TRUE.                      04750028
047600     MOVE 0                         TO DPG51-INCR-DECR-DAYS-9.    04760028
047700     MOVE AR009-SYSTEM-DATE         TO DPG52-LK-DATE-INPUT.       04770028
047800                                                                  04780028
047900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    04790028
048000                                             DPG54 DPG55 DPG56.   04800028
048100     IF (DPG54-NO-ERROR       OR                                  04810028
048200         DPG54-WARNING-ERROR) AND                                 04820028
048300         DPG54-DATE-VALID                                         04830028
048400         CONTINUE                                                 04840028
048500     ELSE                                                         04850028
048600         IF DPG54-DATE-INVALID                                    04860028
048700             DISPLAY '** ABEND ***'                               04870028
048800             DISPLAY '** PROGRAM = ' PC-PROGRAM-NAME              04880028
048900             DISPLAY '** PARA = 2100-DETERMINE-IF-MONTH-END'      04890028
049000             DISPLAY '** BAD RESPONSE FROM DATE ROUTINE **'       04900028
049100             MOVE  +4008  TO ABEND-CODE                           04910028
049200             CALL 'ILBOABN0'   USING ABEND-CODE                   04920028
049300         END-IF                                                   04930028
049400     END-IF.                                                      04940028
049500     IF DPG56-LAST-FP-DB2-ISO-FMT = PV-ISO-DATE-FORMAT            04950028
049600         SET PS-END-OF-MONTH TO TRUE                              04960028
049700     END-IF.                                                      04970028
049800                                                                  04980028
049900*2100-EXIT.  EXIT.                                                04990028
050000                                                                  05000028
050100*-------------------------------------------------------------    05010028
050200* DETERMINE IF THE DATE ENTERED IS A SATURDAY DATE.              *05020028
      * No files will be received on Sundays as FD does not process on *        
      * Saturdays. Only exception is if the calendar month-end falls on*        
      * a Saturday. If a file is sent on Sunday, no files will be recvd*        
      * on Tuesdays.                                                   *        
050300*-------------------------------------------------------------    05030028
050400*2200-DETERMINE-IF-SATURDAY.                                      05040028
050500 2200-DETERMINE-THE-DAY.                                          05050028
050600                                                                  05060028
050700     DISPLAY "DAY IS " DPG55-ALPHA-WEEK-DAY-ABBR3.                05070028
050800     IF DPG55-ALPHA-WEEK-DAY-ABBR3 = PC-SATURDAY                  05080028
050900         SET PS-SATURDAY     TO TRUE                              05090028
051000         MOVE "M"            TO WS-EOM-IND                        05100028
051100     ELSE                                                         05110028
051200        IF DPG55-ALPHA-WEEK-DAY-ABBR3 = PC-SUNDAY                 05120028
051300           SET PS-SUNDAY     TO TRUE                              05130028
051400        ELSE                                                      05140028
051500           IF DPG55-ALPHA-WEEK-DAY-ABBR3 = PC-MONDAY              05150028
051600              SET PS-MONDAY  TO TRUE                              05160028
051700           END-IF                                                 05170028
051800        END-IF                                                    05180028
051900     END-IF.                                                      05190028
052000                                                                  05200028
052100*2200-EXIT.  EXIT.                                                05210028
052200                                                                  05220028
052300 3000-UPDATE-CONTROL-FILE.                                        05230028
052400                                                                  05240028
052500     OPEN OUTPUT  CDF-CONTROL-DATE-FILE.                          05250028
052600     MOVE AR009-SYSTEM-DATE       TO WS-CONTROL-DATE.             05260028
052700     IF (WS-EOM-IND = "M" AND PS-MONDAY)                          05270028
052800        MOVE SPACES       TO  WS-EOM-IND                          05280028
052900     END-IF.                                                      05290028
053000                                                                  05300028
053100     WRITE CDF-CONTROL-DATE-RECORD                                05310028
053200         FROM WS-CONTROL-DATE-AREA.                               05320028
053300                                                                  05330028
053400*3000-EXIT.  EXIT.                                                05340028
053500                                                                  05350028
053600 5000-FINISH.                                                     05360028
053700                                                                  05370028
053800     CLOSE SDF-SYSTEM-DATE-FILE                                   05380028
053900           CDF-CONTROL-DATE-FILE.                                 05390028
054000                                                                  05400028
054100*5000-EXIT.  EXIT.                                                05410028
054200                                                                  05420028
