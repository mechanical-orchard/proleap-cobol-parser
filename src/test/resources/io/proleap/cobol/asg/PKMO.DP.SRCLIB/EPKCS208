000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.                EPKCS208.                             00050000
000600 AUTHOR.                    JEFF BOLWERK.                         00060000
000700 INSTALLATION.              KOHLS DEPARTMENT STORES.              00070000
000800 DATE-WRITTEN.              01-20-98.                             00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*               CICS PROGRAM - EPKCS208 - S208                   *00120000
001300*                                                                *00130000
001400*       STORED VALUE CARD AUTHORIZATION MESSAGE RETRIEVAL        *00140000
001500*                                                                *00150000
001600*       THIS TRANSACTION WILL RETREIVE STORE VALUE CARD          *00160000
001700*   (KMRC & GIFT CARD) AUTHORIZATION REQUEST MESSAGE FROM        *00170000
001800*   THE REQUEST QUEUE AND PASS THEM ON TO THE AUTHORIZATION      *00180000
001900*   PROGRAM.                                                     *00190000
002000*                                                                *00200000
002100******************************************************************00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300******************************************************************00230000
002400                                                                  00240000
002500******************************************************************00250000
002600 DATA DIVISION.                                                   00260000
002700******************************************************************00270000
002800                                                                  00280000
002900 WORKING-STORAGE SECTION.                                         00290000
003000                                                                  00300000
003100*                                                                 00310000
003200*  WORKING-STORAGE VARIABLES REQUIRED FOR THE USE OF THE          00320000
003300*  AUTHORIZATION log messages routine (eppd000).                  00330000
003400*                                                                 00340000
003500                                                                  00350000
003600     COPY EPWS000.                                                00360000
003700                                                                  00370000
003800*                                                                 00380000
003900*    ABEND PROCESSING COPYBOOK.                                   00390000
004000*                                                                 00400000
004100     COPY DPWS013.                                                00410000
004200                                                                  00420000
004300*                                                                 00430000
004400*    MQ Series API control blocks                                 00440000
004500*                                                                 00450000
004600 01  MQM-OBJECT-DESCRIPTOR.                                       00460000
004700     COPY CMQODV.                                                 00470000
004800                                                                  00480000
004900 01  MQM-MESSAGE-DESCRIPTOR.                                      00490000
005000     COPY CMQMDV.                                                 00500000
005100                                                                  00510000
005200 01  MQM-GET-MESSAGE-OPTIONS.                                     00520000
005300     COPY CMQGMOV.                                                00530000
005400                                                                  00540000
005500 01  MQM-PUT-MESSAGE-OPTIONS.                                     00550000
005600     COPY CMQPMOV.                                                00560000
005700                                                                  00570000
005800*                                                                 00580000
005900*    MQV contains constants (for filling in the control blocks)   00590000
006000*    and return codes (for testing the result of a call)          00600000
006100*                                                                 00610000
006200 01  MQM-CONSTANTS.                                               00620000
006300     COPY CMQV.                                                   00630000
006400*                                                                 00640000
006500 01  PS-PROGRAM-SWITCHES.                                         00650000
006600     05  PS-PROGRAM-CONTINUE-SW  PIC X(1)     VALUE ' '.          00660000
006700         88  PS-PC-PROGRAM-CONTINUE           VALUE 'C'.          00670000
006800         88  PS-PC-PROGRAM-END                VALUE 'E'.          00680000
006900     05  PS-DEBITCARD-REQUEST-IND                                 00690000
007000                                 PIC X(1)     VALUE ' '.          00700000
007100         88  PS-VALID-DEBITCARD-REQUEST       VALUE 'V'.          00710000
007200         88  PS-NON-DEBITCARD-REQUEST         VALUE 'N'.          00720000
007300     05  PS-VALID-STORE-IND      PIC X(1)     VALUE ' '.          00730000
007400         88  PS-VALID-STORE-NUMBER            VALUE 'Y'.          00740000
007500         88  PS-INVALID-STORE-NUMBER          VALUE 'N'.          00750000
007600     05  PS-STORE-MONITOR-IND    PIC X(1)     VALUE ' '.          00760000
007700         88  PS-STORE-MONITOR-ON              VALUE 'Y'.          00770000
007800         88  PS-STORE-MONITOR-OFF             VALUE 'N'.          00780000
007900                                                                  00790000
008000 01  PC-PROGRAM-CONSTANTS.                                        00800000
008100     05  PC-CURRENT-PROGRAM-NAME PIC X(8)     VALUE 'EPKCS208'.   00810000
008200     05  PC-ALPHA-AUTH-REPLACEMENT-CHAR                           00820000
008300                                 PIC X(1)     VALUE '9'.          00830000
008400     05  PC-ONE                  PIC S9(1)    VALUE  +1.          00840000
008500     05  PC-AUTH-INQ-MESSAGE-LENGTH                               00850000
008600                                 PIC S9(04)   VALUE +420          00860000
008700                                 COMP SYNC.                       00870000
008800     05  PC-TCOS-HDR-LENGTH      PIC S9(4)    VALUE +8            00880000
008900                                 COMP SYNC.                       00890000
009000     05  PC-STORES-IV-RESP-FORMAT-COMP                            00900000
009100                                 PIC S9(4)    VALUE +145          00910000
009200                                 COMP SYNC.                       00920000
009300     05  FILLER                  REDEFINES                        00930000
009400                                   PC-STORES-IV-RESP-FORMAT-COMP. 00940000
009500         10  FILLER              PIC X(1).                        00950000
009600         10  PC-STORES-IV-RESPONSE-FORMAT                         00960000
009700                                 PIC X(1).                        00970000
009800     05  PC-AUTH-RESP-MSG-TYPE-8201-CMP                           00980000
009900                                 PIC S9(5)    VALUE +33281        00990000
010000                                 COMP-3.                          01000000
010100     05  PC-F-FILL               PIC X(1)     VALUE 'F'.          01010000
010200     05  PC-STORED-VALUE-AUTH-TRAN-ID                             01020000
010300                                 PIC X(04)   VALUE 'S209'.        01030000
010400     05  PC-STORED-VALUE-AUTH-PROGRAM                             01040000
010500                                 PIC X(08)   VALUE 'EPKCS209'.    01050000
010600     05  PC-GIFT-CARD            PIC X(01)   VALUE ''.           01060000
010700*                   MQ SERIES CONSTANTS                           01070000
010800     05  PC-MQCONN               PIC X(8)    VALUE 'CSQCCONN'.    01080000
010900     05  PC-MQOPEN               PIC X(8)    VALUE 'CSQCOPEN'.    01090000
011000     05  PC-MQGET                PIC X(8)    VALUE 'CSQCGET'.     01100000
011100     05  PC-MQPUT1               PIC X(8)    VALUE 'CSQCPUT1'.    01110000
011200     05  PC-MQCLOSE              PIC X(8)    VALUE 'CSQCCLOS'.    01120000
011300     05  PC-MQDISC               PIC X(8)    VALUE 'CSQCDISC'.    01130000
011400     05  PC-QMGR-NAME            PIC X(4)    VALUE SPACES.        01140000
011500         88  PC-PROD-QMGR-NAME               VALUE 'QKSP'.        01150000
011600         88  PC-TEST-QMGR-NAME               VALUE 'QKST'.        01160000
011700         88  PC-QA-QMGR-NAME                 VALUE 'QKSQ'.        01170000
011800     05  PC-DEBITCARD-AUTH-QNAME PIC X(19)   VALUE                01180000
011900                                        'EP.DEBITCARD.AUTH.Q'.    01190000
012000     05  PC-AUTH-Q-NAME          PIC  X(9)  VALUE 'EP.AUTH.Q'.    01200000
012100*                 WAIT TIME OF 40 MINUTES                         01210000
012200     05  PC-MQGET-WAIT-TIME      PIC S9(9)   VALUE 2400000        01220000
012300                                             BINARY.              01230000
012400                                                                  01240000
012500 01  PV-PROGRAM-VARIABLES.                                        01250000
012600     05  PV-AUTH-INQ-MESSAGE-AREA.                                01260000
012700         10  PV-AI-MQ-MESSAGE-DESCRIPTOR                          01270000
012800                                 PIC X(324)   VALUE SPACES.       01280000
012900         10  PV-AI-AUTH-REQUEST-MESSAGE                           01290000
013000                                 PIC X(96)    VALUE SPACES.       01300000
013100                                                                  01310000
013200     05  PV-CICS-RESPONSE         PIC S9(9)   VALUE ZERO          01320000
013300                                  COMP SYNC.                      01330000
013400     05  PV-CICS-RESPONSE-DISP    PIC ZZZZZ9999-.                 01340000
013500                                                                  01350000
013600     05  PV-CREDIT-INQUIRY-IN-LENGTH                              01360000
013700                                  PIC S9(4)   VALUE +100          01370000
013800                                  COMP SYNC.                      01380000
013900     05  PV-INQUIRY-OUT-LENGTH-DISP                               01390000
014000                                  PIC 99-     VALUE ZEROS.        01400000
014100     05  PV-MESSAGE-TYPE-COMP     PIC S9(4)   VALUE ZEROS         01410000
014200                                  COMP SYNC.                      01420000
014300     05  PV-MESSAGE-TYPE-BCD     REDEFINES PV-MESSAGE-TYPE-COMP   01430000
014400                                  PIC X(2).                       01440000
014500     05  PV-TERMINAL-NUMBER-COMP  PIC S9(2)   VALUE ZEROS         01450000
014600                                  COMP SYNC.                      01460000
014700     05  PV-TERMINAL-NUMBER-BCD  REDEFINES                        01470000
014800                                      PV-TERMINAL-NUMBER-COMP     01480000
014900                                  PIC X(2).                       01490000
015000     05  PV-TERMINAL-NUMBER       PIC 9(4)    VALUE ZEROS.        01500000
015100                                                                  01510000
015200     05  PV-TRANS-NUMBER-COMP     PIC S9(2)   VALUE ZEROS         01520000
015300                                  COMP SYNC.                      01530000
015400     05  PV-TRANS-NUMBER-BCD     REDEFINES                        01540000
015500                                      PV-TRANS-NUMBER-COMP        01550000
015600                                  PIC X(2).                       01560000
015700     05  PV-TRANS-NUMBER          PIC 9(4)    VALUE ZEROS.        01570000
015800     05  PV-AUTH-CHAR-SUBSCRIPT   PIC S9(4)   VALUE ZEROS         01580000
015900                                                COMP SYNC.        01590000
016000                                                                  01600000
016100     05  PV-KOHLS-RESPONSE-CODE   PIC 9(2)    VALUE ZEROS.        01610000
016200         88  PV-KRC-APPROVAL                  VALUE ZEROS.        01620000
016300         88  PV-KRC-ACCOUNT-NUMBER-ERROR      VALUE 02.           01630000
016400         88  PV-KRC-STORE-NUMBER-ERROR        VALUE 02.           01640000
016500         88  PV-KRC-MISC-EDIT-ERROR           VALUE 02.           01650000
016600         88  PV-KRC-SOFT-REF                  VALUE 01.           01660000
016700         88  PV-KRC-HARD-DENIAL               VALUE 07.           01670000
016800         88  PV-KRC-REQUIRE-CALL              VALUE 08.           01680000
016900         88  PV-KRC-OFFLINE                   VALUE 09.           01690000
017000     05  PV-KOHLS-RESPONSE-CODE-1                                 01700000
017100                                  PIC 9(1)    VALUE ZEROS.        01710000
017200     05  PV-AUTH-RESP-FIELD-DETAIL.                               01720000
017300         10  PV-AUTH-RESP-SRC-FLI                                 01730000
017400                                  PIC X(1)    VALUE ''.          01740000
017500         10  PV-AUTH-RESP-SRC-FIELD-CODE                          01750000
017600                                  PIC X(1)    VALUE ''.          01760000
017700         10  PV-AUTH-RESP-SRC    PIC S9(4)    VALUE +0002         01770000
017800                                 COMP.                            01780000
017900             88  PV-AUTH-RESP-SRC-INTENDED    VALUE +0002.        01790000
018000             88  PV-AUTH-RESP-SRC-NOT-INTENDED                    01800000
018100                                              VALUE +0001.        01810000
018200         10  PV-AUTH-RESP-FLI    PIC X(1)     VALUE ''.          01820000
018300         10  PV-AUTH-RESP-FIELD-CODE                              01830000
018400                                 PIC X(1)     VALUE ''.          01840000
018500         10  PV-AUTH-RESP-APPROVAL-NUMBER                         01850000
018600                                 PIC X(3)     VALUE HIGH-VALUES.  01860000
018700         10  PV-AUTH-RESP-RESPONSE-CODE                           01870000
018800                                 PIC X(1)     VALUE ZEROS.        01880000
018900         10  PV-AUTH-RESP-RESPONSE-CODE-N                         01890000
019000                                 REDEFINES                        01900000
019100                                     PV-AUTH-RESP-RESPONSE-CODE   01910000
019200                                  PIC 9(1).                       01920000
019300     05  PV-CURRENT-TIME.                                         01930000
019400         10  PV-ST-HOUR           PIC  9(02) VALUE ZEROS.         01940000
019500         10  PV-ST-MINUTES        PIC  9(02) VALUE ZEROS.         01950000
019600         10  PV-ST-SECONDS        PIC  9(02) VALUE ZEROS.         01960000
019700     05  FILLER       REDEFINES   PV-CURRENT-TIME.                01970000
019800         10  PV-COMPARE-TIME      PIC  9(04).                     01980000
019900         10  FILLER               PIC  9(02).                     01990000
020000                                                                  02000000
020100                                                                  02010000
020200*                     MQ SERIES VARIABLES.                        02020000
020300     05  PV-GET-MESSAGE-BUFFER      PIC X(96)        VALUE SPACES.02030000
020400     05  PV-GET-MSG-BUFFER-LENGTH   PIC S9(9) BINARY VALUE 96.    02040000
020500     05  PV-GET-DATA-LENGTH         PIC S9(9) BINARY VALUE 0.     02050000
020600     05  PV-PUT-MESSAGE-BUFFER      PIC X(96)        VALUE SPACES.02060000
020700     05  PV-PUT-MSG-BUFFER-LENGTH   PIC S9(9) BINARY VALUE 96.    02070000
020800     05  PV-CONNECT-HANDLE          PIC S9(9) BINARY VALUE 0.     02080000
020900     05  PV-GETQ-HANDLE             PIC S9(9) BINARY VALUE 0.     02090000
021000     05  PV-OPEN-OPTIONS            PIC S9(9) BINARY VALUE 0.     02100000
021100     05  PV-COMPLETION-CODE         PIC S9(9) BINARY VALUE 0.     02110000
021200     05  PV-REASON                  PIC S9(9) BINARY VALUE 0.     02120000
021300     05  PV-CONNECT-REASON          PIC S9(9) BINARY VALUE 0.     02130000
021400     05  PV-DISPLAY-REASON          PIC S9(9)        VALUE 0.     02140000
021500     05  PV-DISPLAY-COMP-CODE       PIC S9(9)        VALUE 0.     02150000
021600     05  PV-REPLY-TO-QMGR-NAME.                                   02160000
021700         10  FILLER                 PIC X(03) VALUE SPACES.       02170000
021800         10  PV-RQ-STORE-NMBR       PIC X(04) VALUE ZEROS.        02180000
021900         10  PV-RQ-SERVER-ID        PIC X(01) VALUE SPACE.        02190000
022000             88  PV-RQ-SERV-ID-PRIMARY        VALUE 'A'.          02200000
022100             88  PV-RQ-SERV-ID-SECONDARY      VALUE 'B'.          02210000
022200         10  FILLER                 PIC X(40) VALUE SPACES.       02220000
022300                                                                  02230000
022400 01  LM-LOG-MESSAGE.                                              02240000
022500     05  LM-MESSAGE-NUMBER            PIC X(02) VALUE '99'.       02250000
022600     05  LM-LOG-DISPLAY-MESSAGE.                                  02260000
022700         10  FILLER                   PIC X(19) VALUE             02270000
022800                                        'KMRC/GC INQ - STR: '.    02280000
022900         10  LM-DM-STORE-NBR          PIC X(4)  VALUE SPACES.     02290000
023000         10  FILLER                   PIC X(2)  VALUE SPACES.     02300000
023100         10  FILLER                   PIC X(6)  VALUE 'TERM: '.   02310000
023200         10  LM-DM-TERM-NBR           PIC X(7)  VALUE SPACES.     02320000
023300         10  FILLER                   PIC X(2)  VALUE SPACES.     02330000
023400         10  FILLER                   PIC X(6)  VALUE 'TRAN: '.   02340000
023500         10  LM-DM-TRAN-NBR           PIC X(7)  VALUE SPACES.     02350000
023600         10  FILLER                   PIC X(53) VALUE SPACES.     02360000
023700                                                                  02370000
023800 01  PE-PROGRAM-ERROR-MESSAGES.                                   02380000
023900*                    MQ CALL ERROR MESSAGES                       02390000
024000     05  PE-MQ-ERROR-NUMBER           PIC X(02) VALUE '01'.       02400000
024100     05  PE-MQ-ERROR-MESSAGE.                                     02410000
024200         10  FILLER                   PIC X(19) VALUE             02420000
024300                                'MQ ERROR FOR CALL: '.            02430000
024400         10  PE-MQ-CALL-TYPE          PIC X(7)  VALUE SPACES.     02440000
024500             88  PE-MQ-CONNECT                  VALUE 'MQCONN '.  02450000
024600             88  PE-MQ-OPEN                     VALUE 'MQOPEN '.  02460000
024700             88  PE-MQ-GET                      VALUE 'MQGET  '.  02470000
024800             88  PE-MQ-PUT1                     VALUE 'MQPUT1 '.  02480000
024900             88  PE-MQ-CLOSE                    VALUE 'MQCLOSE'.  02490000
025000             88  PE-MQ-DISCONNECT               VALUE 'MQDISCN'.  02500000
025100         10  FILLER                   PIC X(02) VALUE SPACES.     02510000
025200         10  FILLER                   PIC X(11) VALUE             02520000
025300                                        'COMP CODE: '.            02530000
025400         10  PE-MQ-COMPLETION-CODE    PIC 9(04) VALUE ZEROS.      02540000
025500         10  FILLER                   PIC X(02) VALUE SPACES.     02550000
025600         10  FILLER                   PIC X(13) VALUE             02560000
025700                                      'REASON CODE: '.            02570000
025800         10  PE-MQ-REASON-CODE        PIC 9(04) VALUE ZEROS.      02580000
025900                                                                  02590000
026000*                REGISTER PROGRAMMING ERROR MESSAGE               02600000
026100     05  PE-REG-PROG-ERROR-NUMBER     PIC X(02) VALUE '02'.       02610000
026200     05  PE-REGISTER-PROGRAM-ERROR.                               02620000
026300         10  FILLER                   PIC X(29) VALUE             02630000
026400                      'REGISTER PROGRAMMING ERROR - '.            02640000
026500         10  FILLER                   PIC X(02) VALUE SPACES.     02650000
026600         10  FILLER                   PIC X(07) VALUE             02660000
026700                                            'STORE: '.            02670000
026800         10  PE-RP-STORE-NUMBER       PIC 9(04) VALUE ZEROS.      02680000
026900         10  FILLER                   PIC X(02) VALUE SPACES.     02690000
027000         10  FILLER                   PIC X(06) VALUE             02700000
027100                                             'TERM: '.            02710000
027200         10  PE-RP-TERMINAL-NUMBER    PIC 9(04) VALUE ZEROS.      02720000
027300                                                                  02730000
027400*                   PROGRAM START ERROR MESSAGE                   02740000
027500     05  PE-PROG-START-ERROR-NUMBER   PIC X(02) VALUE '03'.       02750000
027600     05  PE-PROGRAM-START-ERROR.                                  02760000
027700         10  FILLER                   PIC X(03) VALUE ' - '.      02770000
027800         10  FILLER                   PIC X(09) VALUE             02780000
027900                                                   'PROGRAM ('.   02790000
028000         10  PE-PS-START-PGM-NAME     PIC X(08) VALUE SPACES.     02800000
028100         10  FILLER                   PIC X(14) VALUE             02810000
028200                                              ') START FAILED'.   02820000
028300         10  FILLER                   PIC X(14) VALUE             02830000
028400                                              ' / CICS RESP: '.   02840000
028500         10  PE-PS-CICS-RESP-CODE     PIC ZZZ9-.                  02850000
028600                                                                  02860000
028700 01  CI-CREDIT-INQUIRY-MSG-AREA.                                  02870000
028800     05  CI-POS-INQ-REMOTE-AUTH-MSG                               02880000
028900                                 PIC X(96)    VALUE LOW-VALUES.   02890000
029000     05  CI-STD-INQUIRY-MESSAGE  REDEFINES                        02900000
029100                                     CI-POS-INQ-REMOTE-AUTH-MSG.  02910000
029200         10  CI-STD-TCOS-HEADER.                                  02920000
029300             15  CI-STD-DESTINATION-SYSTEM-ID                     02930000
029400                                 PIC X(3).                        02940000
029500             15  CI-STD-SOURCE-SYSTEM-ID                          02950000
029600                                 PIC X(3).                        02960000
029700             15  CI-STD-FUNCTION-CODE                             02970000
029800                                 PIC X(1).                        02980000
029900             15  CI-STD-STATUS-CODE                               02990000
030000                                 PIC X(1).                        03000000
030100             15  CI-STD-MESSAGE-LENGTH-IND                        03010000
030200                                 PIC S9(4)                        03020000
030300                                 COMP.                            03030000
030400                 88  CI-STD-VALID-CRS-INQUIRY-MLI                 03040000
030500                                              VALUE +46, +50.     03050000
030600             15  CI-STD-MESSAGE-TYPE-CODE                         03060000
030700                                 PIC X(2).                        03070000
030800         10  CI-STD-FIXED-MESSAGE-FIELDS.                         03080000
030900             15  CI-STD-SEQUENTIAL-BUFFER-NMBR                    03090000
031000                                 PIC X(4).                        03100000
031100             15  CI-STD-SYSTEM-ID-NUMBER                          03110000
031200                                 PIC X(2).                        03120000
031300             15  CI-STD-STORE-NUMBER                              03130000
031400                                 PIC X(4).                        03140000
031500             15  CI-STD-TERMINAL-NUMBER                           03150000
031600                                 PIC X(2).                        03160000
031700             15  CI-STD-MODEL-ID PIC X(2).                        03170000
031800             15  CI-STD-TERMINAL-TYPE                             03180000
031900                                 PIC X(1).                        03190000
032000             15  CI-STD-TRANSACTION-CLASS                         03200000
032100                                 PIC X(1).                        03210000
032200             15  CI-STD-TRANSACTION-NUMBER                        03220000
032300                                 PIC X(4).                        03230000
032400             15  CI-STD-TRANSACTION-TYPE                          03240000
032500                                 PIC X(2).                        03250000
032600         10  CI-STD-VARIABLE-MESSAGE-FIELDS                       03260000
032700                                 PIC X(62).                       03270000
032800                                                                  03280000
032900 01  CR-CREDIT-RESPONSE-MSG-AREA.                                 03290000
033000     05  CR-STORE-NUMBER         PIC X(4).                        03300000
033100     05  CR-FUNCTION-CODE        PIC X(1).                        03310000
033200     05  CR-POS-INQ-REMOTE-AUTH-MSG                               03320000
033300                                 PIC X(91)    VALUE LOW-VALUES.   03330000
033400     05  CR-STD-RESPONSE-MESSAGE REDEFINES                        03340000
033500                                     CR-POS-INQ-REMOTE-AUTH-MSG.  03350000
033600         10  CR-STD-TCOS-HEADER.                                  03360000
033700             15  CR-STD-DESTINATION-SYSTEM-ID                     03370000
033800                                 PIC X(3).                        03380000
033900             15  CR-STD-SOURCE-SYSTEM-ID                          03390000
034000                                 PIC X(3).                        03400000
034100             15  CR-STD-FUNCTION-CODE                             03410000
034200                                 PIC X(1).                        03420000
034300             15  CR-STD-STATUS-CODE                               03430000
034400                                 PIC X(1).                        03440000
034500             15  CR-STD-MESSAGE-LENGTH-IND                        03450000
034600                                 PIC S9(4)                        03460000
034700                                 COMP.                            03470000
034800                 88  CR-STD-CRS-RESPONSE-MLI  VALUE +36.          03480000
034900             15  CR-STD-MESSAGE-TYPE-CODE                         03490000
035000                                 PIC X(2).                        03500000
035100         10  CR-STD-FIXED-MESSAGE-FIELDS.                         03510000
035200             15  CR-STD-SEQUENTIAL-BUFFER-NMBR                    03520000
035300                                 PIC X(4).                        03530000
035400             15  CR-STD-SYSTEM-ID-NUMBER                          03540000
035500                                 PIC X(2).                        03550000
035600             15  CR-STD-STORE-NUMBER                              03560000
035700                                 PIC X(4).                        03570000
035800             15  CR-STD-TERMINAL-NUMBER                           03580000
035900                                 PIC X(2).                        03590000
036000             15  CR-STD-MODEL-ID PIC X(2).                        03600000
036100             15  CR-STD-TERMINAL-TYPE                             03610000
036200                                 PIC X(1).                        03620000
036300             15  CR-STD-TRANSACTION-CLASS                         03630000
036400                                 PIC X(1).                        03640000
036500             15  CR-STD-TRANSACTION-NUMBER                        03650000
036600                                 PIC X(4).                        03660000
036700             15  CR-STD-TRANSACTION-TYPE                          03670000
036800                                 PIC X(2).                        03680000
036900         10  CR-STD-VARIABLE-MESSAGE-FIELDS                       03690000
037000                                 PIC X(57).                       03700000
037100                                                                  03710000
037200 LINKAGE SECTION.                                                 03720000
037300                                                                  03730000
037400******************************************************************03740000
037500 PROCEDURE DIVISION.                                              03750000
037600******************************************************************03760000
037700                                                                  03770000
037800 0000-MAINLINE.                                                   03780000
037900                                                                  03790000
038000     PERFORM 1000-INITIALIZE.                                     03800000
038100                                                                  03810000
038200     PERFORM 2000-PROCESS-AUTH-REQUESTS                           03820000
038300         UNTIL PS-PC-PROGRAM-END.                                 03830000
038400                                                                  03840000
038500     PERFORM 9500-CLOSE-DEBITCARD-AUTH-Q.                         03850000
038600     PERFORM 9600-DISCONNECT-FROM-Q-MNGR.                         03860000
038700                                                                  03870000
038800     PERFORM 9999-RETURN-TO-NATIVE-CICS.                          03880000
038900                                                                  03890000
039000******************************************************************03900000
039100*  INITIALIZE FOR ALL CREDIT INQUIRY/RESPONSE PROCESSING.        *03910000
039200*  FORMAT THE CURRENT DATE AND TIME, ESTABLISH ADDRESSING TO THE *03920000
039300*  INNOVATIVE STORE TABLE, AND DETERMINE THE CURRENT SYSTEM ID   *03930000
039400*  (FOR SYSTEM DEPENDENT PROCESSING), AND THE FULL LOGICAL UNIT  *03940000
039500*  NAME FOR THE LINE ON WHICH THIS TRANSACTION IS RUNNING.       *03950000
039600******************************************************************03960000
039700                                                                  03970000
039800 1000-INITIALIZE.                                                 03980000
039900     PERFORM EP000-0000-INITIALIZE.                               03990000
040000     IF EP000-PV-KOHLS-PROD-SYSTEM                                04000000
040100         SET PC-PROD-QMGR-NAME  TO  TRUE                          04010000
040200     ELSE                                                         04020000
040300        IF EP000-PV-KOHLS-QA-SYSTEM                               04030000
040400            SET PC-QA-QMGR-NAME  TO  TRUE                         04040000
040500        ELSE                                                      04050000
040600            SET PC-TEST-QMGR-NAME  TO  TRUE                       04060000
040700        END-IF                                                    04070000
040800     END-IF.                                                      04080000
040900     MOVE EP000-DT-CURRENT-TIME  TO  PV-CURRENT-TIME.             04090000
041000                                                                  04100000
041100     SET PS-PC-PROGRAM-CONTINUE  TO  TRUE.                        04110000
041200                                                                  04120000
041300     PERFORM 9200-CONNECT-TO-Q-MNGR.                              04130000
041400     PERFORM 9300-OPEN-DEBITCARD-AUTH-Q.                          04140000
041500                                                                  04150000
041600     PERFORM 9400-MQGET-AUTH-REQUEST.                             04160000
041700                                                                  04170000
041800******************************************************************04180000
041900*                                                                *04190000
042000******************************************************************04200000
042100 1500-MESSAGE-MONITORING.                                         04210000
042200                                                                  04220000
042300     PERFORM EP000-3000-FORMAT-CURRENT-DATE.                      04230000
042400     MOVE EP000-DT-CURRENT-TIME  TO  PV-CURRENT-TIME.             04240000
042500                                                                  04250000
042600     MOVE LM-MESSAGE-NUMBER  TO  EP000-SL-PI-MESSAGE-NUMBER.      04260000
042700                                                                  04270000
042800     MOVE PV-RQ-STORE-NMBR  TO  LM-DM-STORE-NBR.                  04280000
042900     MOVE CI-STD-TERMINAL-NUMBER  TO  PV-TERMINAL-NUMBER-COMP.    04290000
043000     MOVE PV-TERMINAL-NUMBER-BCD  TO  PV-TERMINAL-NUMBER.         04300000
043100     MOVE PV-TERMINAL-NUMBER  TO  LM-DM-TERM-NBR.                 04310000
043200                                                                  04320000
043300     MOVE CI-STD-TRANSACTION-NUMBER                               04330000
043400             TO PV-TRANS-NUMBER-BCD.                              04340000
043500     MOVE PV-TRANS-NUMBER-COMP  TO  PV-TRANS-NUMBER.              04350000
043600     MOVE PV-TRANS-NUMBER  TO  LM-DM-TRAN-NBR.                    04360000
043700     SET EP000-SL-INFORMATION  TO  TRUE.                          04370000
043800                                                                  04380000
043900     MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER.                   04390000
044000     MOVE LM-LOG-DISPLAY-MESSAGE                                  04400000
044100             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      04410000
044200                     (EP000-MESSAGE-LINE-COUNTER).                04420000
044300     ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER.                    04430000
044400     MOVE CI-CREDIT-INQUIRY-MSG-AREA                              04440000
044500             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      04450000
044600                     (EP000-MESSAGE-LINE-COUNTER).                04460000
044700     PERFORM EP000-1000-POST-MESSAGE.                             04470000
044800                                                                  04480000
044900***************************************************************** 04490000
045000*  PROCESS AN AUTHORIZATION REQUEST.  DETERMINE IF THERE ARE     *04500000
045100*  REGISTER PROGRAMMING ERRORS. FIND THE MERCHANT NUMBER FOR THE *04510000
045200*  STORE AND CARD TYPE REQUESTING AUTHORIZATION. FORMAT A        *04520000
045300*  DEBITCARD REQUEST MESSAGE, FIND THE NEXT AVAILABLE            *04530000
045400*  COMMUNICATION LINE, AND SEND THE MESSAGE.                     *04540000
045500*  LOG ALL COMMUNICATION PROBLEMS/RESTORATION IN THE STORE TABLE *04550000
045600*  AND ON THE ALERT MESSAGE CONSOLE.                             *04560000
045700******************************************************************04570000
045800 2000-PROCESS-AUTH-REQUESTS.                                      04580000
045900                                                                  04590000
046000     MOVE MQM-MESSAGE-DESCRIPTOR                                  04600000
046100         TO PV-AI-MQ-MESSAGE-DESCRIPTOR.                          04610000
046200     MOVE PV-AI-AUTH-REQUEST-MESSAGE                              04620000
046300         TO  CI-POS-INQ-REMOTE-AUTH-MSG.                          04630000
046400                                                                  04640000
046500     PERFORM 8000-START-AUTHORIZATION-PGM.                        04650000
046600                                                                  04660000
046700*    PERFORM 1500-MESSAGE-MONITORING.                             04670000
046800                                                                  04680000
046900     PERFORM 9400-MQGET-AUTH-REQUEST.                             04690000
047000                                                                  04700000
047100******************************************************************04710000
047200*  THIS PRARAGRAPH SENDS A FORMATTED DEBITCARD ISO MESSAGE TO    *04720000
047300*  THE RESPONSE PROGRAM.  THIS IS USED TO RETURN EDIT ERROR      *04730000
047400*  AND OFF-LINE TO HOST RESPONSES.                               *04740000
047500******************************************************************04750000
047600 8000-START-AUTHORIZATION-PGM.                                    04760000
047700                                                                  04770000
047800     EXEC CICS                                                    04780000
047900         START                                                    04790000
048000             TRANSID (PC-STORED-VALUE-AUTH-TRAN-ID)               04800000
048100             FROM    (PV-AUTH-INQ-MESSAGE-AREA)                   04810000
048200             LENGTH  (PC-AUTH-INQ-MESSAGE-LENGTH)                 04820000
048300             RESP    (PV-CICS-RESPONSE)                           04830000
048400     END-EXEC.                                                    04840000
048500                                                                  04850000
048600     IF PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                    04860000
048700         INITIALIZE EP000-SL-SYSTEM-LOG-MESSAGE                   04870000
048800         MOVE PC-STORED-VALUE-AUTH-PROGRAM                        04880000
048900                               TO PE-PS-START-PGM-NAME            04890000
049000         MOVE PE-PROG-START-ERROR-NUMBER                          04900000
049100                               TO EP000-SL-PI-MESSAGE-NUMBER      04910000
049200         MOVE PV-CICS-RESPONSE TO PE-PS-CICS-RESP-CODE            04920000
049300         SET EP000-SL-ERROR TO TRUE                               04930000
049400         MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                04940000
049500         MOVE PE-PROGRAM-START-ERROR                              04950000
049600             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      04960000
049700                     (EP000-MESSAGE-LINE-COUNTER)                 04970000
049800         ADD PC-ONE TO EP000-MESSAGE-LINE-COUNTER                 04980000
049900         MOVE CR-CREDIT-RESPONSE-MSG-AREA                         04990000
050000             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      05000000
050100                     (EP000-MESSAGE-LINE-COUNTER)                 05010000
050200         PERFORM EP000-1000-POST-MESSAGE                          05020000
050300         SET PV-KRC-OFFLINE                                       05030000
050400             PV-AUTH-RESP-SRC-NOT-INTENDED TO TRUE                05040000
050500         PERFORM 8300-BUILD-SEND-FORMATTED-RESP                   05050000
050600     END-IF.                                                      05060000
050700                                                                  05070000
050800******************************************************************05080000
050900*  BUILD AND SEND A CREDIT AUTHORIZATION RESPONSE MESSAGE IF     *05090000
051000*  START OF AUTHORIZATION PROGRAM FAILS.  THIS WILL BE AN        *05100000
051100*  OFF-LINE RESPONSE.                                            *05110000
051200******************************************************************05120000
051300 8300-BUILD-SEND-FORMATTED-RESP.                                  05130000
051400                                                                  05140000
051500     MOVE LOW-VALUES TO CR-CREDIT-RESPONSE-MSG-AREA.              05150000
051600                                                                  05160000
051700     INITIALIZE CR-STORE-NUMBER.                                  05170000
051800     MOVE PC-STORES-IV-RESPONSE-FORMAT TO CR-FUNCTION-CODE.       05180000
051900     MOVE CI-STD-DESTINATION-SYSTEM-ID TO                         05190000
052000               CR-STD-SOURCE-SYSTEM-ID.                           05200000
052100     MOVE CI-STD-SOURCE-SYSTEM-ID TO                              05210000
052200               CR-STD-DESTINATION-SYSTEM-ID.                      05220000
052300     MOVE CI-STD-FUNCTION-CODE TO CR-STD-FUNCTION-CODE.           05230000
052400     MOVE CI-STD-STATUS-CODE TO CR-STD-STATUS-CODE.               05240000
052500     SET CR-STD-CRS-RESPONSE-MLI TO TRUE.                         05250000
052600     MOVE PC-AUTH-RESP-MSG-TYPE-8201-CMP TO PV-MESSAGE-TYPE-COMP. 05260000
052700     MOVE PV-MESSAGE-TYPE-BCD TO CR-STD-MESSAGE-TYPE-CODE.        05270000
052800     MOVE CI-STD-FIXED-MESSAGE-FIELDS TO                          05280000
052900               CR-STD-FIXED-MESSAGE-FIELDS.                       05290000
053000     MOVE EP000-PV-CURRENT-STORE-NUMBER TO CR-STORE-NUMBER.       05300000
053100                                                                  05310000
053200     MOVE LOW-VALUES TO PV-AUTH-RESP-APPROVAL-NUMBER.             05320000
053300     MOVE PV-KOHLS-RESPONSE-CODE TO PV-KOHLS-RESPONSE-CODE-1.     05330000
053400     MOVE PV-KOHLS-RESPONSE-CODE-1 TO                             05340000
053500               PV-AUTH-RESP-RESPONSE-CODE-N.                      05350000
053600*                                                                 05360000
053700     MOVE PV-AUTH-RESP-FIELD-DETAIL TO                            05370000
053800               CR-STD-VARIABLE-MESSAGE-FIELDS.                    05380000
053900                                                                  05390000
054000     PERFORM 9700-MQPUT1-AUTH-RESPONSE.                           05400000
054100                                                                  05410000
054200* -------------------------------------------------------------- *05420000
054300*    Connect to the queue manager                                 05430000
054400* -------------------------------------------------------------- *05440000
054500 9200-CONNECT-TO-Q-MNGR.                                          05450000
054600                                                                  05460000
054700     CALL PC-MQCONN USING PC-QMGR-NAME                            05470000
054800                         PV-CONNECT-HANDLE                        05480000
054900                         PV-COMPLETION-CODE                       05490000
055000                         PV-REASON.                               05500000
055100*                                                                 05510000
055200*    If connection fails display error message and exit.          05520000
055300*                                                                 05530000
055400     MOVE PV-REASON TO PV-CONNECT-REASON.                         05540000
055500     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   05550000
055600         SET PE-MQ-CONNECT TO TRUE                                05560000
055700         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE          05570000
055800         MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE       05580000
055900         MOVE PV-REASON TO PV-DISPLAY-REASON                      05590000
056000         MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE              05600000
056100*                                                                 05610000
056200         MOVE PE-MQ-ERROR-NUMBER TO EP000-SL-PI-MESSAGE-NUMBER    05620000
056300         SET EP000-SL-ERROR  TO  TRUE                             05630000
056400         MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                05640000
056500         MOVE PE-MQ-ERROR-MESSAGE                                 05650000
056600             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      05660000
056700                     (EP000-MESSAGE-LINE-COUNTER)                 05670000
056800         PERFORM EP000-1000-POST-MESSAGE                          05680000
056900         PERFORM 9999-RETURN-TO-NATIVE-CICS                       05690000
057000     END-IF.                                                      05700000
057100                                                                  05710000
057200* -------------------------------------------------------------- *05720000
057300*    Open the queue for input                                     05730000
057400* -------------------------------------------------------------- *05740000
057500 9300-OPEN-DEBITCARD-AUTH-Q.                                      05750000
057600                                                                  05760000
057700     COMPUTE PV-OPEN-OPTIONS = MQOO-INPUT-SHARED +                05770000
057800                               MQOO-FAIL-IF-QUIESCING.            05780000
057900     MOVE PC-DEBITCARD-AUTH-QNAME TO MQOD-OBJECTNAME.             05790000
058000     MOVE PC-QMGR-NAME        TO  MQOD-OBJECTQMGRNAME.            05800000
058100*                                                                 05810000
058200     CALL PC-MQOPEN USING PV-CONNECT-HANDLE                       05820000
058300                         MQM-OBJECT-DESCRIPTOR                    05830000
058400                         PV-OPEN-OPTIONS                          05840000
058500                         PV-GETQ-HANDLE                           05850000
058600                         PV-COMPLETION-CODE                       05860000
058700                         PV-REASON.                               05870000
058800*                                                                 05880000
058900*    If open fails log error message and exit.                    05890000
059000*                                                                 05900000
059100     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   05910000
059200         SET PE-MQ-OPEN TO TRUE                                   05920000
059300         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE          05930000
059400         MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE       05940000
059500         MOVE PV-REASON TO PV-DISPLAY-REASON                      05950000
059600         MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE              05960000
059700*                                                                 05970000
059800         MOVE PE-MQ-ERROR-NUMBER TO EP000-SL-PI-MESSAGE-NUMBER    05980000
059900         SET EP000-SL-ERROR  TO  TRUE                             05990000
060000         MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                06000000
060100         MOVE PE-MQ-ERROR-MESSAGE                                 06010000
060200             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      06020000
060300                     (EP000-MESSAGE-LINE-COUNTER)                 06030000
060400         PERFORM EP000-1000-POST-MESSAGE                          06040000
060500         PERFORM 9600-DISCONNECT-FROM-Q-MNGR                      06050000
060600         PERFORM 9999-RETURN-TO-NATIVE-CICS                       06060000
060700     END-IF.                                                      06070000
060800                                                                  06080000
060900* -------------------------------------------------------------- *06090000
061000*  MQ GET THE AUTHORIZATION MESSAGE FROM EP.DEBITCARD.MC.AUTH.Q   06100000
061100* -------------------------------------------------------------- *06110000
061200 9400-MQGET-AUTH-REQUEST.                                         06120000
061300*                                                                 06130000
061400*    Setup MQGMO-OPTIONS                                          06140000
061500*                                                                 06150000
061600     COMPUTE MQGMO-OPTIONS = MQGMO-WAIT +                         06160000
061700                             MQGMO-NO-SYNCPOINT +                 06170000
061800                             MQGMO-FAIL-IF-QUIESCING.             06180000
061900                                                                  06190000
062000     MOVE PC-MQGET-WAIT-TIME  TO  MQGMO-WAITINTERVAL.             06200000
062100*                                                                 06210000
062200*    The message ID and Correl ID                                 06220000
062300*    are blanked before each MQGET.                               06230000
062400*                                                                 06240000
062500     MOVE SPACES    TO PV-GET-MESSAGE-BUFFER.                     06250000
062600     MOVE MQMI-NONE TO MQMD-MSGID.                                06260000
062700     MOVE MQCI-NONE TO MQMD-CORRELID.                             06270000
062800*                                                                 06280000
062900     CALL  PC-MQGET  USING PV-CONNECT-HANDLE                      06290000
063000                           PV-GETQ-HANDLE                         06300000
063100                           MQMD                                   06310000
063200                           MQGMO                                  06320000
063300                           PV-GET-MSG-BUFFER-LENGTH               06330000
063400                           PV-GET-MESSAGE-BUFFER                  06340000
063500                           PV-GET-DATA-LENGTH                     06350000
063600                           PV-COMPLETION-CODE                     06360000
063700                           PV-REASON.                             06370000
063800                                                                  06380000
063900*                                                                 06390000
064000*        If get failed, display the error message                 06400000
064100*        and terminate the program.                               06410000
064200*                                                                 06420000
064300     IF (PV-COMPLETION-CODE = MQCC-FAILED)                        06430000
064400         IF (PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)               06440000
064500             SET PE-MQ-GET TO TRUE                                06450000
064600             MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE      06460000
064700             MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE   06470000
064800             MOVE PV-REASON TO PV-DISPLAY-REASON                  06480000
064900             MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE          06490000
065000*                                                                 06500000
065100             MOVE PE-MQ-ERROR-NUMBER TO                           06510000
065200                                     EP000-SL-PI-MESSAGE-NUMBER   06520000
065300             SET EP000-SL-ERROR  TO  TRUE                         06530000
065400             MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            06540000
065500             MOVE PE-MQ-ERROR-MESSAGE                             06550000
065600                 TO  EP000-MD-SYSTEM-LOG-MESSAGE                  06560000
065700                         (EP000-MESSAGE-LINE-COUNTER)             06570000
065800             PERFORM EP000-1000-POST-MESSAGE                      06580000
065900         END-IF                                                   06590000
066000         PERFORM 9500-CLOSE-DEBITCARD-AUTH-Q                      06600000
066100         PERFORM 9600-DISCONNECT-FROM-Q-MNGR                      06610000
066200         PERFORM 9999-RETURN-TO-NATIVE-CICS                       06620000
066300     END-IF.                                                      06630000
066400                                                                  06640000
066500     MOVE PV-GET-MESSAGE-BUFFER  TO  CI-CREDIT-INQUIRY-MSG-AREA   06650000
066600                                     PV-AI-AUTH-REQUEST-MESSAGE.  06660000
066700                                                                  06670000
066800* -------------------------------------------------------------- *06680000
066900*    CLOSE THE DEBITCARD AUTH QUEUE                               06690000
067000* -------------------------------------------------------------- *06700000
067100 9500-CLOSE-DEBITCARD-AUTH-Q.                                     06710000
067200                                                                  06720000
067300     CALL PC-MQCLOSE USING PV-CONNECT-HANDLE                      06730000
067400                          PV-GETQ-HANDLE                          06740000
067500                          MQCO-NONE                               06750000
067600                          PV-COMPLETION-CODE                      06760000
067700                          PV-REASON.                              06770000
067800     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   06780000
067900         SET PE-MQ-CLOSE TO TRUE                                  06790000
068000         MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE          06800000
068100         MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE       06810000
068200         MOVE PV-REASON TO PV-DISPLAY-REASON                      06820000
068300         MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE              06830000
068400*                                                                 06840000
068500         MOVE PE-MQ-ERROR-NUMBER TO  EP000-SL-PI-MESSAGE-NUMBER   06850000
068600         SET EP000-SL-ERROR  TO  TRUE                             06860000
068700         MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER                06870000
068800         MOVE PE-MQ-ERROR-MESSAGE                                 06880000
068900             TO  EP000-MD-SYSTEM-LOG-MESSAGE                      06890000
069000                     (EP000-MESSAGE-LINE-COUNTER)                 06900000
069100         PERFORM EP000-1000-POST-MESSAGE                          06910000
069200         PERFORM 9600-DISCONNECT-FROM-Q-MNGR                      06920000
069300         PERFORM 9999-RETURN-TO-NATIVE-CICS                       06930000
069400     END-IF.                                                      06940000
069500                                                                  06950000
069600*----------------------------------------------------------------*06960000
069700*  DISCONNECT FROM THE MQ MANAGER                                *06970000
069800*----------------------------------------------------------------*06980000
069900 9600-DISCONNECT-FROM-Q-MNGR.                                     06990000
070000                                                                  07000000
070100*    Disconnect from the queue manager                            07010000
070200                                                                  07020000
070300     IF PV-CONNECT-REASON IS NOT EQUAL TO MQRC-ALREADY-CONNECTED  07030000
070400         CALL PC-MQDISC USING PV-CONNECT-HANDLE                   07040000
070500                              PV-COMPLETION-CODE                  07050000
070600                              PV-REASON                           07060000
070700         IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN               07070000
070800             SET PE-MQ-DISCONNECT TO TRUE                         07080000
070900             MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE      07090000
071000             MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE   07100000
071100             MOVE PV-REASON      TO PV-DISPLAY-REASON             07110000
071200             MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE          07120000
071300*                                                                 07130000
071400             MOVE PE-MQ-ERROR-NUMBER TO                           07140000
071500                                     EP000-SL-PI-MESSAGE-NUMBER   07150000
071600             SET EP000-SL-ERROR  TO  TRUE                         07160000
071700             MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            07170000
071800             MOVE PE-MQ-ERROR-MESSAGE                             07180000
071900                 TO  EP000-MD-SYSTEM-LOG-MESSAGE                  07190000
072000                         (EP000-MESSAGE-LINE-COUNTER)             07200000
072100             PERFORM EP000-1000-POST-MESSAGE                      07210000
072200             PERFORM 9999-RETURN-TO-NATIVE-CICS                   07220000
072300         END-IF                                                   07230000
072400     END-IF.                                                      07240000
072500                                                                  07250000
072600*----------------------------------------------------------------*07260000
072700*  MQ PUT THE OFF-LINE RESPONSE MESSAGE TO THE REQUESTING        *07270000
072800*  STORES EP.AUTH.Q                                              *07280000
072900*----------------------------------------------------------------*07290000
073000 9700-MQPUT1-AUTH-RESPONSE.                                       07300000
073100*                                                                 07310000
073200*    Setup MQMD - MESSAGE DESCRIPTOR                              07320000
073300*                                                                 07330000
073400     MOVE PC-CURRENT-PROGRAM-NAME  TO  MQMD-USERIDENTIFIER.       07340000
073500*                                                                 07350000
073600*    Setup MQOD - OBJECT DESCRIPTOR                               07360000
073700*                                                                 07370000
073800     MOVE MQOT-Q  TO  MQOD-OBJECTTYPE.                            07380000
073900     MOVE PC-AUTH-Q-NAME  TO  MQOD-OBJECTNAME.                    07390000
074000                                                                  07400000
074100     MOVE LOW-VALUES  TO  PV-PUT-MESSAGE-BUFFER.                  07410000
074200     MOVE CR-STD-RESPONSE-MESSAGE  TO  PV-PUT-MESSAGE-BUFFER.     07420000
074300     MOVE CR-STD-MESSAGE-LENGTH-IND                               07430000
074400         TO  PV-PUT-MSG-BUFFER-LENGTH.                            07440000
074500     ADD PC-TCOS-HDR-LENGTH  TO  PV-PUT-MSG-BUFFER-LENGTH.        07450000
074600                                                                  07460000
074700     MOVE MQMD-REPLYTOQMGR  TO  MQOD-OBJECTQMGRNAME.              07470000
074800                                                                  07480000
074900*                                                                 07490000
075000*    Setup MQPMO-OPTIONS                                          07500000
075100*                                                                 07510000
075200     COMPUTE MQPMO-OPTIONS = MQPMO-NO-SYNCPOINT                   07520000
075300                           + MQPMO-SET-IDENTITY-CONTEXT           07530000
075400                           + MQPMO-FAIL-IF-QUIESCING.             07540000
075500                                                                  07550000
075600*                                                                 07560000
075700     CALL PC-MQPUT1 USING PV-CONNECT-HANDLE                       07570000
075800                          MQM-OBJECT-DESCRIPTOR                   07580000
075900                          MQM-MESSAGE-DESCRIPTOR                  07590000
076000                          MQM-PUT-MESSAGE-OPTIONS                 07600000
076100                          PV-PUT-MSG-BUFFER-LENGTH                07610000
076200                          PV-PUT-MESSAGE-BUFFER                   07620000
076300                          PV-COMPLETION-CODE                      07630000
076400                          PV-REASON.                              07640000
076500*                                                                 07650000
076600*        If get failed, display the error message                 07660000
076700*        and terminate the program.                               07670000
076800*                                                                 07680000
076900     IF (PV-COMPLETION-CODE = MQCC-FAILED)                        07690000
077000         IF (PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)               07700000
077100             SET PE-MQ-PUT1 TO TRUE                               07710000
077200             MOVE PV-COMPLETION-CODE TO PV-DISPLAY-COMP-CODE      07720000
077300             MOVE PV-DISPLAY-COMP-CODE TO PE-MQ-COMPLETION-CODE   07730000
077400             MOVE PV-REASON TO PV-DISPLAY-REASON                  07740000
077500             MOVE PV-DISPLAY-REASON TO PE-MQ-REASON-CODE          07750000
077600*                                                                 07760000
077700             MOVE PE-MQ-ERROR-NUMBER TO EP000-SL-PI-MESSAGE-NUMBER07770000
077800             SET EP000-SL-ERROR  TO  TRUE                         07780000
077900             MOVE PC-ONE TO EP000-MESSAGE-LINE-COUNTER            07790000
078000             MOVE PE-MQ-ERROR-MESSAGE                             07800000
078100                 TO  EP000-MD-SYSTEM-LOG-MESSAGE                  07810000
078200                         (EP000-MESSAGE-LINE-COUNTER)             07820000
078300             PERFORM EP000-1000-POST-MESSAGE                      07830000
078400         END-IF                                                   07840000
078500         PERFORM 9600-DISCONNECT-FROM-Q-MNGR                      07850000
078600         PERFORM 9999-RETURN-TO-NATIVE-CICS                       07860000
078700     END-IF.                                                      07870000
078800                                                                  07880000
078900*                                                                 07890000
079000*----------------------------------------------------------------*07900000
079100*    TERMINATE THE TASK.                                          07910000
079200*----------------------------------------------------------------*07920000
079300 9999-RETURN-TO-NATIVE-CICS.                                      07930000
079400                                                                  07940000
079500     EXEC CICS                                                    07950000
079600         RETURN                                                   07960000
079700     END-EXEC.                                                    07970000
079800                                                                  07980000
079900*                                                                 07990000
080000*----------------------------------------------------------------*08000000
080100*  LOG ALERT/ERROR ROUTINE.                                       08010000
080200*                                                                 08020000
080300     COPY EPPD000.                                                08030000
080400                                                                  08040000
080500*----------------------------------------------------------------*08050000
080600*    ABEND PROCESSOR MODULE                                      *08060000
080700*                                                                 08070000
080800     COPY DPPD014.                                                08080000
080900                                                                  08090000
