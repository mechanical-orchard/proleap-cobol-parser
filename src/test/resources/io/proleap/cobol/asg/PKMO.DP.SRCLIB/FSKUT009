000100***************************************************************** 00010014
000200 IDENTIFICATION DIVISION.                                         00020014
000300***************************************************************** 00030014
000400                                                                  00040014
000500 PROGRAM-ID.             FSKUT009.                                00050014
000600 AUTHOR.                 BOB FORD.                                00060014
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070014
000800 DATE-WRITTEN            06-15-2004.                              00080014
000900 DATE-COMPILED.                                                   00090014
001000                                                                  00100014
001100***************************************************************** 00110014
001200*  THIS PROGRAM CREATES THE DATE PORTION OF THE 'WHERE' CLAUSE  * 00120014
001300*  FOR THE UNLOAD OF TSKSTOO.                                   * 00130014
001400***************************************************************** 00140014
001500* CHANGED 07/06/2004 BY BOB FORD                                  00150014
001600*   WR# 26355                                                     00160014
001700*         NEW PROGRAM                                             00170014
001800***************************************************************** 00180014
001900* CHANGED 07/28/2004 BY BOB FORD                                  00190014
002000*   WR# 26355                                                     00200014
002100*         PROGRAM CHANGED TO CREATE 2 FILES USED AS 'WHERE'       00210014
002200*         CLAUSES IN UNLOADS.  FIRST FILE WILL UNLOAD TSKSTOO     00220014
002300*         FOR CURRENT-WEEK ORDERS, THE SECOND FILE WILL UNLOAD    00230014
002400*         TSTSTOO FOR FUTURE 4 WEEKS OF ORDERS.  ADDED READ OF    00240014
002500*         TDTATTR TO GET CORRECT DATES.                           00250014
002510***************************************************************** 00251025
002520* CHANGED 08/02/2005 BY JIM LEIKNESS                              00252025
002530*   WR# 28420                                                     00253025
002540*         PROGRAM CHANGED TO ACCEPT SYSTEM DATE FROM CONTROL      00254025
002550*         CARD.  THE PROGRAM NOW SELECTS THE FISCAL BOW DATE      00255025
002560*         FROM THE SYSTEM DATE AND THEN CREATES THE UNLOAD        00256025
002570*         CARDS (CURRENT WEEK AND FUTURE 4) FROM THAT.            00257025
002600***************************************************************** 00260014
002700 ENVIRONMENT DIVISION.                                            00270014
002800***************************************************************** 00280014
002900                                                                  00290014
003000 CONFIGURATION SECTION.                                           00300014
003100                                                                  00310014
003200 SOURCE-COMPUTER.        IBM-3090.                                00320014
003300 OBJECT-COMPUTER.        IBM-3090.                                00330014
003400                                                                  00340014
003500 INPUT-OUTPUT SECTION.                                            00350014
003600                                                                  00360014
003700 FILE-CONTROL.                                                    00370014
003800*                                                                 00380014
003900     SELECT CONTROL-CARD-FILE     ASSIGN   TO  INP01.             00390015
003901*                                                                 00390115
003910     SELECT DATE-CARD-FILE1       ASSIGN   TO  OUT01.             00391015
004000*                                                                 00400014
004100     SELECT DATE-CARD-FILE2       ASSIGN   TO  OUT02.             00410014
004200*                                                                 00420014
004300***************************************************************** 00430014
004400 DATA DIVISION.                                                   00440014
004500***************************************************************** 00450014
004600*                                                                 00460014
004700 FILE SECTION.                                                    00470014
004800*                                                                 00480014
004900 FD  CONTROL-CARD-FILE                                            00490015
005000     LABEL RECORDS ARE STANDARD                                   00500014
005100     RECORDING MODE IS F                                          00510014
005200     RECORD CONTAINS 80 CHARACTERS                                00520014
005300     BLOCK CONTAINS 0 RECORDS.                                    00530014
005400 01  CONTROL-CARD-RECORD             PIC  X(80).                  00540015
005500*                                                                 00550014
005510 FD  DATE-CARD-FILE1                                              00551015
005520     LABEL RECORDS ARE STANDARD                                   00552015
005530     RECORDING MODE IS F                                          00553015
005540     RECORD CONTAINS 80 CHARACTERS                                00554015
005550     BLOCK CONTAINS 0 RECORDS.                                    00555015
005560 01  DATE-CARD-REC1                  PIC  X(80).                  00556015
005570*                                                                 00557015
005600 FD  DATE-CARD-FILE2                                              00560014
005700     LABEL RECORDS ARE STANDARD                                   00570014
005800     RECORDING MODE IS F                                          00580014
005900     RECORD CONTAINS 80 CHARACTERS                                00590014
006000     BLOCK CONTAINS 0 RECORDS.                                    00600014
006100 01  DATE-CARD-REC2                  PIC  X(80).                  00610014
006200*                                                                 00620014
006300 WORKING-STORAGE SECTION.                                         00630014
006400*                                                                 00640014
006500 01  FILLER.                                                      00650014
006600     05  FILLER                      PIC  X(36)    VALUE          00660014
006700         ' ***** WORKING STORAGE PGM=FSKUT009 '.                  00670014
006800 EJECT                                                            00680014
006900*                                                                 00690014
007000 01  PROGRAM-SWITCHES.                                            00700014
007100     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     00710014
007200         88  PS-END-OF-CURSOR                      VALUE 'Y'.     00720014
007300*                                                                 00730014
007400 01  CC-DATE.                                                     00740016
007500     05  CC-PRCG-DATE              PIC X(10).                     00750023
007720     05  FILLER                    PIC X(70).                     00772024
007800                                                                  00780014
007900 01  PC-CONSTANTS.                                                00790014
008000     05  PC-N                      PIC X(01)  VALUE 'N'.          00800023
008100     05  PC-PROGRAM-NAME           PIC X(8)   VALUE 'FSKUT009'.   00810023
008200     05  PC-PUNCTUATION            PIC X(2)   VALUE ', '.         00820023
008300 EJECT                                                            00830014
008400*                                                                 00840014
008500 01  PV-MISC-FIELDS.                                              00850014
008600     05  PV-ABEND-MESSAGE          PIC X(50)        VALUE SPACE.  00860014
008700     05  PV-PARA-NAME              PIC X(25)        VALUE SPACE.  00870014
008800     05  ABEND-CODE                PIC S9(04)       VALUE +4003   00880014
008900                                                    COMP SYNC.    00890014
009000     05  PV-PRCG-DTE               PIC X(10)        VALUE SPACE.  00900022
009010     05  PV-FSCL-BOW-DATE          PIC X(10)        VALUE SPACE.  00901021
009100     05  PV-FUTURE-DTE-1           PIC X(10)        VALUE SPACE.  00910014
009200     05  PV-FUTURE-DTE-2           PIC X(10)        VALUE SPACE.  00920014
009300     05  PV-FUTURE-DTE-3           PIC X(10)        VALUE SPACE.  00930014
009400     05  PV-FUTURE-DTE-4           PIC X(10)        VALUE SPACE.  00940014
009500*                                                                 00950014
009600 01  OUTPUT-REC1.                                                 00960014
009700     05 FILLER                      PIC X(18) VALUE SPACE.        00970014
009800     05 FILLER                      PIC X(21) VALUE               00980014
009900                                    'AND FSCL_BOW_DTE <= '''.     00990014
010000     05 OR-PRCG-DTE                 PIC X(10).                    01000014
010100     05 FILLER                      PIC X(1)  VALUE ''''.         01010014
010200     05 FILLER                      PIC X(20) VALUE SPACE.        01020014
010300*                                                                 01030014
010400 01  OUTPUT-REC2.                                                 01040014
010500     05 FILLER                      PIC X(18) VALUE SPACE.        01050014
010600     05 FILLER                      PIC X(23) VALUE               01060014
010700                                    '  AND FSCL_BOW_DTE IN ('.    01070014
010800     05 FILLER                      PIC X(39) VALUE SPACE.        01080014
010900*                                                                 01090014
011000 01  OUTPUT-REC3.                                                 01100014
011100     05 FILLER                      PIC X(36) VALUE SPACE.        01110014
011200     05 OR3-PUNCTUATION             PIC X(02) VALUE SPACE.        01120014
011300     05 FILLER                      PIC X(1)  VALUE ''''.         01130014
011400     05 OR3-PRCG-DTE                PIC X(10).                    01140014
011500     05 FILLER                      PIC X(1)  VALUE ''''.         01150014
011600     05 FILLER                      PIC X(30) VALUE SPACE.        01160014
011700*                                                                 01170014
011800 01  OUTPUT-REC4.                                                 01180014
011900     05 FILLER                      PIC X(41) VALUE SPACE.        01190014
012000     05 FILLER                      PIC X(1)  VALUE ')'.          01200014
012100     05 FILLER                      PIC X(38) VALUE SPACE.        01210014
012200*                                                                 01220014
012300     COPY DPWS500.                                                01230014
012400*                                                                 01240014
012500*                                                                 01250014
012600* DB2 COMMUNICATION AREA                                          01260014
012700*                                                                 01270014
012800     EXEC SQL                                                     01280014
012900         INCLUDE SQLCA                                            01290014
013000     END-EXEC.                                                    01300014
013100*                                                                 01310014
013200     EXEC SQL                                                     01320014
013300         INCLUDE TDTATTR                                          01330014
013400     END-EXEC.                                                    01340014
013500*                                                                 01350014
013600* DB2 COMMUNICATION AREA2                                         01360014
013700*                                                                 01370014
013800     COPY SQLCA2.                                                 01380014
013900******************************************************************01390014
014000*  DB2 ERROR MESSAGES FORMAT AREA.                                01400014
014100******************************************************************01410014
014200     COPY DPWS004.                                                01420014
014300                                                                  01430014
014400 EJECT                                                            01440014
014500*                                                                 01450014
014600***************************************************************** 01460014
014700*PROCEDURE DIVISION.                                              01470014
014800***************************************************************** 01480014
014900 PROCEDURE DIVISION.                                              01490014
015000*                                                                 01500014
015100 A000-MAINLINE-PROCESSING.                                        01510014
015200*                                                                 01520014
015300     PERFORM A100-INITIALIZATION.                                 01530014
015600*                                                                 01560014
015700     PERFORM C000-CREATE-OUTPUT-RECORD1.                          01570014
015800*                                                                 01580014
015900     PERFORM C100-CREATE-OUTPUT-RECORD2.                          01590014
016000*                                                                 01600014
016100     MOVE SPACES          TO OR3-PUNCTUATION.                     01610014
016200     MOVE PV-FUTURE-DTE-1 TO OR3-PRCG-DTE.                        01620014
016300     PERFORM C200-CREATE-OUTPUT-RECORD3.                          01630014
016400     MOVE PC-PUNCTUATION  TO OR3-PUNCTUATION.                     01640014
016500     MOVE PV-FUTURE-DTE-2 TO OR3-PRCG-DTE.                        01650014
016600     PERFORM C200-CREATE-OUTPUT-RECORD3.                          01660014
016700     MOVE PV-FUTURE-DTE-3 TO OR3-PRCG-DTE.                        01670014
016800     PERFORM C200-CREATE-OUTPUT-RECORD3.                          01680014
016900     MOVE PV-FUTURE-DTE-4 TO OR3-PRCG-DTE.                        01690014
017000     PERFORM C200-CREATE-OUTPUT-RECORD3.                          01700014
017100     PERFORM C300-CREATE-OUTPUT-RECORD4.                          01710014
017200*                                                                 01720014
017300     PERFORM Y100-END-ROUTINE.                                    01730014
017400*                                                                 01740014
017500     GOBACK.                                                      01750014
017600*                                                                 01760014
017700 EJECT                                                            01770014
017800******************************************************************01780014
017900** OPEN THE SYSTEM FILE AND ACCEPT CONTROL CARDS.                 01790014
018000** CALL CALENDAR ROUTINES TO RETRIEVE VALUES NEEDED IN PROGRAM    01800014
018100******************************************************************01810014
018200 A100-INITIALIZATION.                                             01820014
018300*                                                                 01830014
018400     OPEN  OUTPUT DATE-CARD-FILE1                                 01840014
018500           OUTPUT DATE-CARD-FILE2                                 01850014
018600     INITIALIZE OUTPUT-REC1                                       01860014
018700                OUTPUT-REC2                                       01870014
018800                OUTPUT-REC3.                                      01880014
018810                                                                  01881015
018900     ACCEPT CC-DATE.                                              01890015
019000     DISPLAY 'RUN DATE  = ' CC-PRCG-DATE.                         01900017
019001     MOVE CC-PRCG-DATE  TO PV-PRCG-DTE.                           01900123
019014                                                                  01901421
019015     PERFORM B000-SELECT-BOW-DTE.                                 01901521
019016                                                                  01901621
019017     DISPLAY 'BOW-DTE   = ' PV-FSCL-BOW-DATE.                     01901717
019200                                                                  01920018
019210     PERFORM B100-SELECT-FUTURE-DTES.                             01921018
019300*                                                                 01930014
019400 EJECT                                                            01940014
019500******************************************************************01950014
019600*                                                                *01960014
019700******************************************************************01970014
019800 B000-SELECT-BOW-DTE.                                             01980017
019900*                                                                 01990014
020000     EXEC SQL                                                     02000014
020100       SELECT                                                     02010014
020200            FSCL_WK_BEG_DTE                                       02020017
020600         INTO                                                     02060014
020700            :PV-FSCL-BOW-DATE                                     02070017
021100         FROM  TDTATTR                                            02110014
021200        WHERE  KY_DTE  = :PV-PRCG-DTE                             02120021
021300     END-EXEC.                                                    02130014
021400*                                                                 02140014
021500     EVALUATE TRUE                                                02150014
021600         WHEN SQLCODE = ZERO                                      02160014
021700            CONTINUE                                              02170014
021800         WHEN SQLWARN0 NOT = SPACE                                02180014
021900         WHEN SQLCODE NOT = ZERO                                  02190014
022000             MOVE 'B000-SELECT-BOW-DTE'                           02200017
022100                                      TO PV-PARA-NAME             02210014
022200             PERFORM Z998-SQL-ERROR                               02220014
022300     END-EVALUATE.                                                02230014
022400                                                                  02240014
022410******************************************************************02241017
022420*                                                                *02242017
022430******************************************************************02243017
022440 B100-SELECT-FUTURE-DTES.                                         02244017
022450*                                                                 02245017
022460     EXEC SQL                                                     02246017
022470       SELECT                                                     02247017
022480            (KY_DTE + 7 DAYS)                                     02248017
022490          , (KY_DTE + 14 DAYS)                                    02249017
022491          , (KY_DTE + 21 DAYS)                                    02249117
022492          , (KY_DTE + 28 DAYS)                                    02249217
022493         INTO                                                     02249317
022494            :PV-FUTURE-DTE-1                                      02249417
022495          , :PV-FUTURE-DTE-2                                      02249517
022496          , :PV-FUTURE-DTE-3                                      02249617
022497          , :PV-FUTURE-DTE-4                                      02249717
022498         FROM  TDTATTR                                            02249817
022499        WHERE  KY_DTE    = :PV-FSCL-BOW-DATE                      02249917
022500     END-EXEC.                                                    02250017
022501*                                                                 02250117
022502     EVALUATE TRUE                                                02250217
022503         WHEN SQLCODE = ZERO                                      02250317
022504            CONTINUE                                              02250417
022505         WHEN SQLWARN0 NOT = SPACE                                02250517
022506         WHEN SQLCODE NOT = ZERO                                  02250617
022507             MOVE 'B000-SELECT-BOW-DTES'                          02250717
022508                                      TO PV-PARA-NAME             02250817
022509             PERFORM Z998-SQL-ERROR                               02250917
022510     END-EVALUATE.                                                02251017
022511                                                                  02251117
022520******************************************************************02252017
022600*   FORMAT DATA & WRITE OUT RECORDS                               02260014
022700******************************************************************02270014
022800 C000-CREATE-OUTPUT-RECORD1.                                      02280014
022900     MOVE '*C000-CREATE-OUTPUT-RECORD1      *' TO PV-PARA-NAME.   02290014
023000*                                                                 02300014
023100     MOVE PV-FSCL-BOW-DATE       TO OR-PRCG-DTE                   02310014
023200*                                                                 02320014
023300     WRITE DATE-CARD-REC1 FROM OUTPUT-REC1.                       02330014
023400     DISPLAY 'DATE CARD1 = ' OUTPUT-REC1.                         02340014
023500                                                                  02350014
023600*                                                                 02360014
023700 C100-CREATE-OUTPUT-RECORD2.                                      02370014
023800     MOVE '*C100-CREATE-OUTPUT-RECORD2      *' TO PV-PARA-NAME.   02380014
023900*                                                                 02390014
024000     WRITE DATE-CARD-REC2 FROM OUTPUT-REC2.                       02400014
024100     DISPLAY 'DATE CARD2 = ' OUTPUT-REC2.                         02410014
024200                                                                  02420014
024300*                                                                 02430014
024400 C200-CREATE-OUTPUT-RECORD3.                                      02440014
024500     MOVE '*C200-CREATE-OUTPUT-RECORD3      *' TO PV-PARA-NAME.   02450014
024600*                                                                 02460014
024700     WRITE DATE-CARD-REC2 FROM OUTPUT-REC3.                       02470014
024800     DISPLAY 'DATE CARD3 = ' OUTPUT-REC3.                         02480014
024900*                                                                 02490014
025000 C300-CREATE-OUTPUT-RECORD4.                                      02500014
025100     MOVE '*C300-CREATE-OUTPUT-RECORD4      *' TO PV-PARA-NAME.   02510014
025200*                                                                 02520014
025300     WRITE DATE-CARD-REC2 FROM OUTPUT-REC4.                       02530014
025400     DISPLAY 'DATE CARD4 = ' OUTPUT-REC4.                         02540014
025500                                                                  02550014
025600*                                                                 02560014
025700******************************************************************02570014
025800*   CLOSES FILES AND DISPLAYS MESSAGES.                          *02580014
025900******************************************************************02590014
026000 Y100-END-ROUTINE.                                                02600014
026100*                                                                 02610014
026200     CLOSE  DATE-CARD-FILE1.                                      02620014
026300     CLOSE  DATE-CARD-FILE2.                                      02630014
026605                                                                  02660523
026606     DISPLAY '*******************************************'        02660623
026607     DISPLAY '**  FSKUT009 COMPLETE **'.                          02660723
026610*                                                                 02661014
026700 EJECT                                                            02670014
026800******************************************************************02680014
026900* ABEND ROUTINE FOR BAD SQL CALLS                                *02690014
027000******************************************************************02700014
027100 Z998-SQL-ERROR.                                                  02710014
027200     DISPLAY '** PARAGRAPH **      = ' PV-PARA-NAME.              02720014
027300*                                                                 02730014
027400     MOVE SQLCODE    TO SQLCODE2.                                 02740014
027500     MOVE SQLERRD(3) TO SQLERRD3.                                 02750014
027600     DISPLAY '** ABEND **       ** = SQL ERROR'.                  02760014
027700     DISPLAY '** PROGRAM **        = FSKUT009'.                   02770014
027800     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  02780014
027900     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  02790014
028000     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   02800014
028100     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  02810014
028200                                                                  02820014
028300     EXEC SQL                                                     02830014
028400          COMMIT                                                  02840014
028500     END-EXEC.                                                    02850014
028600*                                                                 02860014
028700     MOVE +4013                      TO ABEND-CODE.               02870014
028800     CALL 'ILBOABN0' USING ABEND-CODE.                            02880014
028900                                                                  02890014
029000*                                                                 02900014
029100***************************************************************** 02910014
