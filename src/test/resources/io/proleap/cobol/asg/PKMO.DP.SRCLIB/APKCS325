000100*-----------------------*                                         00010048
000200 IDENTIFICATION DIVISION.                                         00020048
000300*-----------------------*                                         00030048
000400 PROGRAM-ID.    APKCS325.                                         00040048
000500 AUTHOR.        PAT DOYLE.                                        00050048
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060048
000700 DATE-WRITTEN.  05/25/94.                                         00070048
000800 DATE-COMPILED.                                                   00080048
000900                                                                  00090048
001000*---------------------------------------------------------------* 00100048
001100*    A325 - INVOICE LIST PROGRAM.                               * 00110048
001200*                                                               * 00120048
001300*    THIS PROGRAM GENERATES A LIST OF INVOICES DEPENDING ON     * 00130048
001400*    THE CRITERIA PASSED FROM THE CRITERIA SPEC SCREEN.  THE    * 00140048
001500*    FOLLOWING ARE THE POSSIBILITIES FOR THE LIST:              * 00150048
001600*    1)  PO NUMBER ENTERED                                      * 00160048
001700*        - LISTS INVOICES FOR THAT PURCHASE ORDER.              * 00170048
001800*    2)  INVOICE STATUS AND INVOICE DATE ENTERED                * 00180048
001900*        - LISTS INVOICES WITH THE ENTERED INVOICE STATUS AND   * 00190048
002000*          INVOICE DATE.                                        * 00200048
002100*    3)  VENDOR NUMBER ENTERED                                  * 00210048
002200*        - LISTS ALL INVOICES FOR THE VENDOR.                   * 00220048
002300*    4)  INVOICE NUMBER ENTERED                                 * 00230048
002400*        - LISTS ALL INVOICES WITH THIS NUMBER.                 * 00240048
002500*    5)  STORE NUMBER ENTERED                                   * 00250049
002600*        - LISTS ALL INVOICES WITH THIS STORE NUMBER.           * 00260049
002700*        - IF A STORE NUMBER IS NOT ENTERED, STORE 000 WILL BE  * 00270049
002800*          USED AS A LOW NUMBER AND STORE 999 WILL BE USED AS   * 00280049
002900*          A HIGH NUMBER.  THIS MEANS THAT ALL STORES WILL BE   * 00290049
003000*          RETRIEVED.                                           * 00300049
003100*    ANY OTHER COMBINATIONS WILL RESULT IN AN ERROR MESSAGE     * 00310048
003200*    BEING PASSED BACK TO THE CRITERIA SPEC SCREEN.             * 00320048
003300*                                                               * 00330048
003400*    ITEMS CAN BE SELECTED FROM THIS LIST TO PASS TO ANOTHER    * 00340048
003500*    SCREEN.  (FOR THE ADD SCREEN, NO SELECTION IS NECESSARY.)  * 00350048
003600*                                                               * 00360048
003700*---------------------------------------------------------------* 00370048
003800*                                                               * 00380048
003900* CHANGE LOG:                                                   * 00390048
004000*                                                               * 00400048
004100* 10/13/94    BMW  ADDED THE PO NUMBER TO THE WHERE CLAUSE OF   * 00410048
004200*                  THE CALC_CSR                                 * 00420048
004300*                                                               * 00430048
004400* 01/10/94    BMW  REMOVED "PIECES" FIELD FROM LIST AND ADDED   * 00440048
004500*                  "ENTR DTE".  ALSO SHORTENED PO NUMBER FROM   * 00450048
004600*                  9 CHARS TO 7.                                * 00460048
004700*                                                               * 00470048
004800* 03/08/95    MKK  CHANGED CURSORS TO IMPROVE EFFICIENCY:       * 00480048
004900*                  IN THE PO-NBR-CSR, USED THE PURCHS PO NUMBER * 00490048
005000*                  INSTEAD OF THE PAYREQ PO NUMBER FOR COMPARI- * 00500048
005100*                  SONS IN THE COMPARE CRITERIA AND REMOVED     * 00510048
005200*                  ALL CRITERIA SPECIFYING THE PO NUMBER NOT    * 00520048
005300*                  NULL.                                        * 00530048
005400*                                                               * 00540048
005500* 03/15/95  P.KEBER  CHANGED NEXT-ACT-RETURN LOGIC TO REBUILD   * 00550048
005600*                    THE SCREEN FROM THE COMMAREA.              * 00560048
005700*                                                               * 00570048
005800* 07/26/95    MKK  CHANGED CURSORS TO IMPROVE EFFICIENCY.         00580048
005900*             FOR PO-NBR-CSR, INVC-STAT-DTE-CSR, VENDOR-NBR-CSR,  00590048
006000*             AND INVC-NBR-CSR:                                   00600048
006100*             - REMOVED MDINVC TABLE FROM JOIN SINCE THE COLUMN   00610048
006200*               RETRIEVED (TOT_INVC_PC_QTY) IS NOT REFERENCED.    00620048
006300*             - PUT THE RETRIEVAL OF ENT_NAME_DESC FROM ENTNME    00630048
006400*               INTO A SEPARATE SELECT (PARA 4311) SINCE THE      00640048
006500*               VENDOR NAME IS THE SAME FOR AN ENTIRE PO.         00650048
006600*             FOR 3O-NBR-CSR, INVC-STAT-DTE-CSR, AND INVC-NBR-CSR:00660048
006700*             - REMOVED PURCHS TABLE FROM JOIN SINCE ITS PURPOSE  00670048
006800*               WAS TO CONNECT TO THE ENTNME TABLE.  (VENDOR-NBR- 00680048
006900*               CSR STILL NEEDS PURCHS TO CONNECT TO TEXTENT.)    00690048
007000*             FOR CALC-CSR:                                       00700048
007100*             - REMOVED THE NET AMOUNT CALCULATION FROM DB2.      00710048
007200*               INSTEAD, FIELDS ARE RETRIEVED FROM ALCHRG AND THE 00720048
007300*               CALCULATION USING INVOIC-GRO-COST-AMT IS DONE IN  00730048
007400*               COBOL (PARA 4336)                                 00740048
007500*             THE TABLE MDINVC WAS REMOVED ENTIRELY SINCE IT IS   00750048
007600*             NO LONGER REFERENCED.                               00760048
007700*                                                                 00770048
007800* 07/31/95    MKK -CHANGED ASC-KEY-PO-NBR FROM COMP-3 TO A COMP   00780048
007900*                  FIELD TO MATCH WITH DB2 AND IMPROVE EFFICIENCY 00790048
008000*                 -ADDED SELECTION CRITERIA 'PAYT_REQ_SEQ_NBR > 0'00800048
008100*                  TO PO-NBR-CSR, VENDOR-NBR-CSR, AND INVC-NBR-CSR00810048
008200*                  TO FORCE AN INDEX USING 2 MATCHED COLUMNS TO   00820048
008300*                  IMPROVE EFFICIENCY                             00830048
008400*                 -CHANGED WHERE VENDOR NAME IS BEING RETRIEVED TO00840048
008500*                  AFTER FIRST FETCH SO THAT PO NBR WILL BE VALID 00850048
008600*                  IN THE FETCH (PARA 4311)                       00860048
008700*                                                                 00870048
008800* 09/06/95    MKK -INVC-NBR-CSR AND INVC-STAT-DTE-CSR WERE        00880048
008900*                  CHANGED TO INCLUDE TENTNME-ENT-NAME-DESC       00890048
009000*                  SINCE INVOICE NUMBERS MAY BE DUPLICATED        00900048
009100*                  UNDER DIFFERENT VENDORS.                       00910048
009200*                                                                 00920048
009300* 07/10/96    MJW -ADDED WARNING MESSAGE FOR BULK/STORE           00930048
009400*                  COMBINATION.                                   00940048
009500*                                                                 00950048
009600*  5/23/97    CJK   CHANGED RETURN LOGIC TO PERFORM PARA          00960048
009700*                    4400-MOVE-COMMAREA-TO-SCREEN PRIOR TO PARA   00970048
009800*                    3000-EDIT-DATA-IN-COMMAREA. THIS CAUSED AN   00980048
009900*                    INVALID DATA ERROR THAT WAS INCORRECT.       00990048
010000*                    THIS MAY ALSO FIX TSQUE ITEMERR CICS ABENDS. 01000048
010100*                   ADDED LOGIC TO USE INVOICE TYPE CODE IF IT'S  01010048
010200*                    ENTERED FROM THE SELECTION SCREEN.           01020048
010300*                                                                 01030048
010400*  8/25/97    CJK -ADDED 2075-REFRESH-ASC-KEY TO FIX EXISTING PRB 01040048
010500*   WR4164          AFTER SELECTING\PROCESSING A LINE, KEY FIELDS 01050048
010600*                   WEREN'T SET BACK TO ORIGINAL VALUE.           01060048
010700*                   MODIFIED LOGIC TO HANDLE EXPENSE INVOICES.    01070048
010800*                   FIXED SOME EXISTING PROBLEMS.                 01080048
010900*            6-17 -MODIFIED CURSORS TO GET INVOICE VENDOR DATA,   01090048
011000*                   INSTEAD OF PO VENDOR DATA.                    01100048
011100*                                                                 01110048
011200* 03/01/00    RAB -PERFORMANCE TUNING. MODIFIED INVC-STAT-DTE-CSR,01120048
011300*   WR20704         VENDOR-NBR-CSR AND INVC-NBR-CSR. REMOVED THE  01130048
011400*                   TPURCHS TABLE FROM ALL OF THE CURSORS WHILE   01140048
011500*                   ALSO INCLUDING THE ENT-NAME-DESC TO THE       01150048
011600*                   VENDOR-NBR-CSR.                               01160048
011700*                                                                 01170048
011800* 09/10/01    AAK - ADDED STORE NUMBER TO BE USED AS CRITERIA     01180051
011900*   WR22496         TO GET INVOICES.  THIS WAY A USER WILL BE     01190051
012000*                   ABLE TO LOOK AT ONE STORE'S INVOICES INSTEAD  01200051
012100*                   OF GOING THROUGH EVERY STORE.                 01210051
012200*                                                                 01220052
012300* 05/16/01    MAB - REMOVED ALL REFERENCES OF TPAYREQ AS PART OF  01230053
012400*   WR23500         THE ARK PO PHASE I RETEK PROJECT.             01240053
012500*                                                                 01250053
012600* 09/09/02  ARK PO PROJECT, PHASE 2.  REPLACED PAYT_REQ_SEQ_NBR   01260064
012700*           IN CALC-CSR WHERE CONDITION WITH PO_NBR AND INVC_ID.  01270055
012800*      BY:  KEVIN CATLIN                     WR:  23500           01280055
012900*                                                                 01290055
013000* 10/02/03  REPLACED TPURCHS FROM ERROR DISPLAY MESSAGES. ADDED A 01300075
013100*           NEW CURSOR THAT WILL RETURN A LIST OF INVOICES VIA A  01310075
013200*           PO NUMBER/INVOICE STATUS COMBINATION: PO-INVC-STAT-CSR01320075
013300*      BY:  MIKE BESKE                       WR:  WR25024         01330075
013400*                                                                 01340075
013500* 04/22/04  INCREASED THE SIZE OF THE STORE NUMBER SCREEN OUTPUT  01350078
013600*           VARIABLE MR-STR-NBR-N TO 4 DIGITS.  DECREASED THE SIZE01360078
013700*           OF THE MR-VENDOR SCREEN OUTPUT VARIABLE FROM 9 TO 8.  01370078
013800*           THIS WAS DONE SO THE STORE NUMBER INCREASE COULD FIT  01380078
013900*           ON THE CROWDED LIST SCREEN.  THIS IS PART OF THE      01390078
014000*           STORE CONSTRAINTS PROJECT.   INCREASED THE VALUE OF   01400078
014100*           DK-STR-NBR-HIGH FROM +999 TO +9999.                   01410078
014200*      BY:  MIKE BESKE                       WR:  WR25805         01420078
014300*                                                                 01430078
014400* DATE  03/11/2007                                                01440098
014500*     CHANGE MADE: MATCH BY DC MODIFICATIONS                      01450096
014600*     REMOVED ALL CODE AND REFERENCES TO THE FOLLOWING TINVOIC    01460096
014700*     COLUMNS: ENTR_MTHD_CDE AND DETL_ENTR_IND.  THESE ARE NOT    01470096
014800*     GOING TO BE DISPLAYED ON THE ONLINE SCREEN TO MAKE ROOM     01480096
014900*     FOR DC_NBR AND MTCH_LVL_CDE.  THESE NEW COLUMNS WERE ADDED  01490097
015000*     TO ALL OF THE CURSORS.  NEW CODE WAS CREATED TO PROCESS     01500096
015100*     THE NEW COLUMNS SO THAT THEIR VALUES ARE DISPLAYED ONTO     01510096
015200*     THE ONLINE SCREEN.                                          01520096
015300*     MADE BY: MIKE BESKE              WR/IR #: WR21578           01530096
015301*                                                                 01530199
015310* DATE  11/04/2014                                                01531099
015320*     CHANGE MADE: PO EXTENDED DIGIT CHANGES.                     01532099
015330*     EXTENDED PO# FROM 7 TO 8.                                   01533099
015391*     MADE BY: COGNIZANT               WR/IR #: CHG0094517        01539199
015392*                                                                 01539299
015393* DATE  09/01/2021                                                01539399
015394*            - CHANGE CALL OF 'DPKUT100' TO                     * 01539499
015395*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 01539599
015396*              MAKING THE CALL DYNAMIC VS STATIC                * 01539699
015397*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        01539799
015398*                                                                 01539899
015399* DATE  10/21/2022                                                01539999
015400*     ADD COPYBOOK DPWS930                                        01540099
015401*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API    01540199
015402*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864        01540299
015410*-----------------------------------------------------------------01541078
015500     EJECT                                                        01550078
015600 ENVIRONMENT DIVISION.                                            01560078
015700                                                                  01570078
015800 DATA DIVISION.                                                   01580078
015900                                                                  01590078
016000 WORKING-STORAGE SECTION.                                         01600078
016100                                                                  01610078
016200 01  DK-DB2-KEYS.                                                 01620078
016300     15  DK-MESSAGE-TEXT                PIC  X(70)  VALUE SPACE.  01630078
016400     15  DK-MESSAGE-BYTE                REDEFINES DK-MESSAGE-TEXT 01640078
016500                                        OCCURS 70 TIMES           01650078
016600                                        PIC  X(01).               01660078
016700     15  DK-MESSAGE-NUMBER              PIC S9(05)  VALUE ZERO    01670078
016800                                                    COMP-3.       01680078
016900     15  DK-SYSTEM-ID                   PIC  X(02)  VALUE SPACE.  01690078
017000     15  DK-REVIEW-IND                  PIC  X(01)  VALUE SPACE.  01700078
017100     15  DK-INVC-TYP-CDE-LOW            PIC  X(02)                01710078
017200                                               VALUE LOW-VALUES.  01720078
017300     15  DK-INVC-TYP-CDE-HIGH           PIC  X(02)                01730078
017400                                               VALUE HIGH-VALUES. 01740078
017500     15  DK-STR-NBR-LOW                 PIC S9(04)  VALUE +0      01750078
017600                                                    COMP.         01760078
017700     15  DK-STR-NBR-HIGH                PIC S9(04)  VALUE +9999   01770078
017800                                                    COMP.         01780078
017900     15  DK-DC-NBR-LOW                  PIC S9(04)  VALUE +0      01790092
018000                                                    COMP.         01800092
018100     15  DK-DC-NBR-HIGH                 PIC S9(04)  VALUE +9999   01810092
018200                                                    COMP.         01820092
018300                                                                  01830078
018400 01  PC-PROGRAM-CONSTANTS.                                        01840078
018500     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01850078
018600                                                    'AP325A  '.   01860078
018700     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01870078
018800                                                    'APKM325 '.   01880078
018900     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01890078
019000                                                    'APKCS325'.   01900078
019100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      01910078
019200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      01920078
019300     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +14     01930078
019400                                                    COMP SYNC.    01940078
019500     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01950078
019600                                                    COMP SYNC.    01960078
019700     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01970078
019800                                                    +1000000      01980078
019900                                                    COMP-3.       01990078
020000     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      02000078
020100                                                    COMP SYNC.    02010078
020200     05  PC-SHORT-DESC-CODE             PIC  X(02)  VALUE '04'.   02020078
020300     05  PC-LONG-DESC-CODE              PIC  X(02)  VALUE '01'.   02030078
020400     05  PC-STATUS-CDE-ACTIVE           PIC  X(01)  VALUE 'A'.    02040078
020500     05  PC-TYP-CDE-CHARGE              PIC  X(01)  VALUE 'C'.    02050078
020600     05  PC-INQ                         PIC  X(01)  VALUE 'I'.    02060078
020700     05  PC-UPD                         PIC  X(01)  VALUE 'U'.    02070078
020800     05  PC-DEL                         PIC  X(01)  VALUE 'D'.    02080078
020900     05  PC-ERR                         PIC  X(01)  VALUE 'E'.    02090078
021000     05  PC-TSYMSG-NUMBERS.                                       02100078
021100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  02110078
021200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  02120078
021300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  02130078
021400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  02140078
021500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  02150078
021600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  02160078
021700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  02170078
021800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  02180078
021900         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  02190078
022000         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  02200078
022100         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  02210078
022200         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  02220078
022300         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  02230078
022400         10  PC-TSYMSG-00482            PIC  9(05)  VALUE 00482.  02240078
022500         10  PC-TSYMSG-00830            PIC  9(05)  VALUE 00830.  02250078
022600         10  PC-TSYMSG-00831            PIC  9(05)  VALUE 00831.  02260078
022700         10  PC-TSYMSG-01308            PIC  9(05)  VALUE 01308.  02270078
022800                                                                  02280078
022900 01  PS-PROGRAM-SWITCHES.                                         02290078
023000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02300078
023100         88  PS-NO-ERROR                            VALUE 'Y'.    02310078
023200         88  PS-ERROR                               VALUE 'N'.    02320078
023300     05  PS-ERROR-DB2-SW                PIC  X(01)  VALUE 'Y'.    02330078
023400         88  PS-NO-ERROR-DB2                        VALUE 'Y'.    02340078
023500         88  PS-ERROR-DB2                           VALUE 'N'.    02350078
023600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02360078
023700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02370078
023800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02380078
023900     05  PS-END-OF-CALC-CSR-SW          PIC  X(01)  VALUE 'N'.    02390078
024000         88  PS-END-OF-CALC-CSR                     VALUE 'Y'.    02400078
024100         88  PS-NOT-END-OF-CALC-CSR                 VALUE 'N'.    02410078
024200     05  PS-FIRST-FETCH-SW              PIC  X(01)  VALUE 'N'.    02420078
024300         88  PS-FIRST-FETCH                         VALUE 'Y'.    02430078
024400         88  PS-NOT-FIRST-FETCH                     VALUE 'N'.    02440078
024500     05  PS-BULK-SW                     PIC  X(01)  VALUE 'N'.    02450078
024600         88  PS-BULK                                VALUE 'Y'.    02460078
024700         88  PS-NO-BULK                             VALUE 'N'.    02470078
024800     05  PS-DC-SW                       PIC  X(01)  VALUE 'N'.    02480092
024900         88  PS-DC                                  VALUE 'Y'.    02490092
025000         88  PS-NO-DC                               VALUE 'N'.    02500092
025100     05  PS-BY-STORE-SW                 PIC  X(01)  VALUE 'N'.    02510078
025200         88  PS-BY-STORE                            VALUE 'Y'.    02520078
025300         88  PS-NO-BY-STORE                         VALUE 'N'.    02530078
025400                                                                  02540078
025500 01  PV-PROGRAM-VARIABLES.                                        02550078
025600     05  PV-SUB                         PIC S9(04)  VALUE +0      02560078
025700                                                    COMP SYNC.    02570078
025800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02580078
025900                                                    COMP SYNC.    02590078
026000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02600078
026100                                                    COMP-3.       02610078
026200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      02620078
026300                                                    COMP-3.       02630078
026400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      02640078
026500                                                    COMP-3.       02650078
026600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02660078
026700                                                    COMP-3.       02670078
026800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02680078
026900                                                    COMP-3.       02690078
027000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02700078
027100                                                    COMP-3.       02710078
027200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02720078
027300                                                    COMP-3.       02730078
027400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02740078
027500                                                    COMP SYNC.    02750078
027600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02760078
027700                                                    COMP SYNC.    02770078
027800     05  PV-ITEM                        PIC S9(04)  VALUE +0      02780078
027900                                                    COMP SYNC.    02790078
028000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      02800078
028100                                                    COMP SYNC.    02810078
028200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      02820078
028300                                                    COMP SYNC.    02830078
028400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02840078
028500                                                    COMP SYNC.    02850078
028600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02860078
028700                                                    COMP SYNC.    02870078
028800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      02880078
028900                                                    COMP SYNC.    02890078
029000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02900078
029100                                                    COMP SYNC.    02910078
029200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      02920078
029300                                                    COMP SYNC.    02930078
029400     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02940078
029500                                                    COMP SYNC.    02950078
029600     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02960078
029700                                                    COMP SYNC.    02970078
029800     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02980078
029900                                                    COMP SYNC.    02990078
030000     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      03000078
030100                                                    COMP SYNC.    03010078
030200     05  PV-DUMMY-NBR                   PIC S9(04)  VALUE +0      03020078
030300                                                    COMP SYNC.    03030078
030400     05  PV-STR-NBR                     PIC S9(04)  VALUE +0.     03040078
030500     05  PV-DC-NBR                      PIC S9(04)  VALUE +0.     03050092
030600     05  PV-SUM-AL-CHRG                 PIC S9(11)V9(2)           03060092
030700                                                      COMP-3      03070092
030800                                                      VALUE +0.   03080092
030900     05  PV-SUM-AL-CHRG-ROUND           PIC S9(11)V9(2)           03090092
031000                                                      COMP-3      03100092
031100                                                      VALUE +0.   03110092
031200     05  PV-NET-INVC-AMT                PIC S9(09)V99 COMP-3      03120092
031300                                                      VALUE +0.   03130092
031400     05  PV-DATE-FORMAT-DB2.                                      03140092
031500         10  PV-DATE-DB2-CC             PIC X(02)   VALUE SPACES. 03150092
031600         10  PV-DATE-DB2-YY             PIC X(02)   VALUE SPACES. 03160092
031700         10  FILLER                     PIC X(01)   VALUE SPACES. 03170092
031800         10  PV-DATE-DB2-MM             PIC X(02)   VALUE SPACES. 03180092
031900         10  FILLER                     PIC X(01)   VALUE SPACES. 03190092
032000         10  PV-DATE-DB2-DD             PIC X(02)   VALUE SPACES. 03200092
032100     05  PV-DATE-FORMAT.                                          03210092
032200         10  PV-DATE-MM                 PIC X(02)   VALUE SPACES. 03220092
032300         10  PV-DATE-DD                 PIC X(02)   VALUE SPACES. 03230092
032400         10  PV-DATE-YY                 PIC X(02)   VALUE SPACES. 03240092
032500*----------------------------------------------------------------*03250092
032600*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.    *03260092
032700*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE            *03270092
032800*   APPLICATION-SPECIFIC COMMAREA.                               *03280092
032900*----------------------------------------------------------------*03290092
033000 01  LQW-LIST-QUEUE-WORK-AREA.                                    03300092
033100     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  03310092
033200     05  LQW-ITEM-ENTRIES               OCCURS 14 TIMES           03320092
033300                                        INDEXED BY LQW-IDX.       03330092
033400         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       03340092
033500         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               03350092
033600         10  LQW-SELECTED-SW            PIC  X(01).               03360092
033700             88  LQW-SELECT                         VALUE 'S'.    03370092
033800             88  LQW-DESELECT                       VALUE ' '.    03380092
033900         10  LQW-ACTION                 PIC  X(01).               03390092
034000         10  LQW-INVC-NBR               PIC  X(22).               03400092
034100         10  LQW-INVC-DTE               PIC  X(10).               03410092
034200         10  LQW-PO-NBR                 PIC S9(09)  COMP.         03420092
034300         10  LQW-VENDOR                 PIC  X(10).               03430092
034400         10  LQW-STR-NBR                PIC S9(04)  COMP.         03440092
034500         10  LQW-DC-NBR                 PIC S9(04)  COMP.         03450092
034600         10  LQW-MTCH-LVL-CDE           PIC  X(01).               03460092
034700         10  LQW-INVC-TYPE              PIC  X(02).               03470092
034800         10  LQW-STATUS                 PIC  X(02).               03480092
034900         10  LQW-INVC-AMT               PIC S9(09)V99             03490092
035000                                                    COMP-3.       03500092
035100         10  LQW-ENTR-DTE               PIC  X(10).               03510092
035200     EJECT                                                        03520092
035300*---------------------------------------------------------------* 03530092
035400*  RECORD LAYOUT FOR THE INVOICE SELECTION TEMP STORAGE QUEUE.  * 03540092
035500*---------------------------------------------------------------* 03550092
035600                                                                  03560092
035700     COPY APWS301.                                                03570092
035800                                                                  03580092
035900     EJECT                                                        03590092
036000*---------------------------------------------------------------* 03600092
036100*    MAP LAYOUT                                                 * 03610092
036200*---------------------------------------------------------------* 03620092
036300                                                                  03630092
036400     COPY APKM325.                                                03640092
036500                                                                  03650092
036600 01  MR-OCCURS-LAYOUT                   REDEFINES  AP325AO.       03660092
036700     05  FILLER                         PIC X(42).                03670092
036800     05  MR-SCROLL-AREA                 OCCURS 14 TIMES.          03680092
036900         10  MR-SELECTL                 PIC S9(04) COMP.          03690092
037000         10  MR-SELECTA                 PIC  X(01).               03700092
037100         10  MR-SELECTC                 PIC  X(01).               03710092
037200         10  MR-SELECTH                 PIC  X(01).               03720092
037300         10  MR-SELECTI                 PIC  X(01).               03730092
037400                                                                  03740092
037500         10  MR-ACTIONL                 PIC S9(04) COMP.          03750092
037600         10  MR-ACTIONA                 PIC  X(01).               03760092
037700         10  MR-ACTIONC                 PIC  X(01).               03770092
037800         10  MR-ACTIONH                 PIC  X(01).               03780092
037900         10  MR-ACTION                  PIC  X(01).               03790092
038000                                                                  03800092
038100         10  MR-INVC-NBRL               PIC S9(04) COMP.          03810092
038200         10  MR-INVC-NBRA               PIC  X(01).               03820092
038300         10  MR-INVC-NBRC               PIC  X(01).               03830092
038400         10  MR-INVC-NBRH               PIC  X(01).               03840092
038500         10  MR-INVC-NBR                PIC  X(10).               03850092
038600                                                                  03860092
038700         10  MR-INVC-DTEL               PIC S9(04) COMP.          03870092
038800         10  MR-INVC-DTEA               PIC  X(01).               03880092
038900         10  MR-INVC-DTEC               PIC  X(01).               03890092
039000         10  MR-INVC-DTEH               PIC  X(01).               03900092
039100         10  MR-INVC-DTE                PIC  X(06).               03910092
039200                                                                  03920092
039300         10  MR-PO-NBRL                 PIC S9(04) COMP.          03930092
039400         10  MR-PO-NBRA                 PIC  X(01).               03940092
039500         10  MR-PO-NBRC                 PIC  X(01).               03950092
039600         10  MR-PO-NBRH                 PIC  X(01).               03960092
039700         10  MR-PO-NBR-X.                                         03970092
039800             15  MR-PO-NBR-N            PIC  ZZZZZZZ9.            03980099
039900                                                                  03990092
040000         10  MR-VENDORL                 PIC S9(04) COMP.          04000092
040100         10  MR-VENDORA                 PIC  X(01).               04010092
040200         10  MR-VENDORC                 PIC  X(01).               04020092
040300         10  MR-VENDORH                 PIC  X(01).               04030092
040400         10  MR-VENDOR                  PIC  X(10).               04040092
040500                                                                  04050092
040600         10  MR-STR-NBRL                PIC S9(04) COMP.          04060092
040700         10  MR-STR-NBRA                PIC  X(01).               04070092
040800         10  MR-STR-NBRC                PIC  X(01).               04080092
040900         10  MR-STR-NBRH                PIC  X(01).               04090092
041000         10  MR-STR-NBR-X.                                        04100092
041100             15  MR-STR-NBR-N           PIC  9(04).               04110092
041200                                                                  04120092
041300         10  MR-DC-NBRL                 PIC S9(04) COMP.          04130092
041400         10  MR-DC-NBRA                 PIC  X(01).               04140092
041500         10  MR-DC-NBRC                 PIC  X(01).               04150092
041600         10  MR-DC-NBRH                 PIC  X(01).               04160092
041700         10  MR-DC-NBR-X.                                         04170092
041800             15  MR-DC-NBR-N            PIC  9(04).               04180092
041900                                                                  04190092
042000         10  MR-MTCH-LVL-CDEL           PIC S9(04) COMP.          04200092
042100         10  MR-MTCH-LVL-CDEA           PIC  X(01).               04210092
042200         10  MR-MTCH-LVL-CDEC           PIC  X(01).               04220092
042300         10  MR-MTCH-LVL-CDEH           PIC  X(01).               04230092
042400         10  MR-MTCH-LVL-CDE            PIC  X(01).               04240092
042500                                                                  04250092
042600         10  MR-INVC-TYPEL              PIC S9(04) COMP.          04260092
042700         10  MR-INVC-TYPEA              PIC  X(01).               04270092
042800         10  MR-INVC-TYPEC              PIC  X(01).               04280092
042900         10  MR-INVC-TYPEH              PIC  X(01).               04290092
043000         10  MR-INVC-TYPE               PIC  X(02).               04300092
043100                                                                  04310092
043200         10  MR-STATUSL                 PIC S9(04) COMP.          04320092
043300         10  MR-STATUSA                 PIC  X(01).               04330092
043400         10  MR-STATUSC                 PIC  X(01).               04340092
043500         10  MR-STATUSH                 PIC  X(01).               04350092
043600         10  MR-STATUS                  PIC  X(02).               04360092
043700                                                                  04370092
043800         10  MR-INVC-AMTL               PIC S9(04) COMP.          04380092
043900         10  MR-INVC-AMTA               PIC  X(01).               04390092
044000         10  MR-INVC-AMTC               PIC  X(01).               04400092
044100         10  MR-INVC-AMTH               PIC  X(01).               04410092
044200         10  MR-INVC-AMT-X.                                       04420092
044300             15  MR-INVC-AMT-N          PIC  ZZZ,ZZ9.99.          04430099
044400                                                                  04440092
044500         10  MR-ENTR-DTEL               PIC S9(04) COMP.          04450092
044600         10  MR-ENTR-DTEA               PIC  X(01).               04460092
044700         10  MR-ENTR-DTEC               PIC  X(01).               04470092
044800         10  MR-ENTR-DTEH               PIC  X(01).               04480092
044900         10  MR-ENTR-DTE                PIC  X(06).               04490092
045000     EJECT                                                        04500092
045100*---------------------------------------------------------------* 04510092
045200*    ATTRIBUTE SETTINGS COPYBOOK.                               * 04520092
045300*---------------------------------------------------------------* 04530092
045400                                                                  04540092
045500     COPY DPWS015.                                                04550092
045600                                                                  04560092
045700*---------------------------------------------------------------* 04570092
045800*    FUNCTION KEYS COPYBOOK.                                    * 04580092
045900*---------------------------------------------------------------* 04590092
046000                                                                  04600092
046100     COPY DPWS016.                                                04610092
046200                                                                  04620092
046300*---------------------------------------------------------------* 04630092
046400*    NUMERIC EDIT LAYOUT.                                       * 04640092
046500*---------------------------------------------------------------* 04650092
046600                                                                  04660092
046700     COPY DPWS010I.                                               04670092
046800 EJECT                                                            04680092
046900*---------------------------------------------------------------* 04690092
047000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 04700092
047100*---------------------------------------------------------------* 04710092
047200                                                                  04720092
047300     COPY DPWS030.                                                04730092
047310     COPY DPWS930.                                                04731099
047400 EJECT                                                            04740092
047500*---------------------------------------------------------------* 04750092
047600*    STANDARD COMMAREA.                                         * 04760092
047700*---------------------------------------------------------------* 04770092
047800                                                                  04780092
047900     COPY DPWS020.                                                04790092
048000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04800092
048100                                                                  04810092
048200*---------------------------------------------------------------* 04820092
048300* INTER-APPLICATION COMMAREA.                                   * 04830092
048400*---------------------------------------------------------------* 04840092
048500                                                                  04850092
048600         10  INTER-APPL-COMM-AREA       PIC X(200).               04860092
048700     COPY APWS300.                                                04870092
048800                                                                  04880092
048900*---------------------------------------------------------------* 04890092
049000*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04900092
049100*---------------------------------------------------------------* 04910092
049200         10  ASC-SPECIFIC-COMMAREA.                               04920092
049300             15  ASC-LIST-KEYS.                                   04930092
049400                 20  ASC-KEY-PO-NBR                  PIC S9(09)   04940092
049500                                                     COMP.        04950092
049600                 20  ASC-KEY-INVC-STATUS             PIC  X(02).  04960092
049700                 20  ASC-KEY-INVC-DTE                PIC  X(10).  04970092
049800                 20  ASC-KEY-VENDOR-NBR              PIC  X(09).  04980092
049900                 20  ASC-KEY-INVC-NBR                PIC  X(22).  04990092
050000                 20  ASC-KEY-STR-NBR                 PIC S9(04)   05000092
050100                                                     COMP.        05010092
050200                 20  ASC-KEY-DC-NBR                  PIC S9(04)   05020092
050300                                                     COMP.        05030092
050400                 20  ASC-KEY-INVC-TYP-CDE            PIC  X(02).  05040092
050500                     88  ASC-VALID-ADD-TYP                        05050092
050600                                         VALUE 'EI', 'MI', '  '.  05060092
050700                     88  ASC-VALID-INVC-TYP                       05070092
050800                                         VALUE 'EI', 'MI', '  ',  05080092
050900                                               'RI', 'WO'.        05090092
051000                     88  ASC-EXPENSE-INVC           VALUE 'EI'.   05100092
051100                     88  ASC-MDSE-INVC              VALUE 'MI'.   05110092
051200             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                05120092
051300                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  05130092
051400                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   05140092
051500                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   05150092
051600                                                                  05160092
051700                 20  ASC-ITEM-ARRAY.                              05170092
051800                     25  ASC-ITEM-ENTRIES OCCURS 14 TIMES.        05180092
051900                         30  ASC-LIST-ITEM-NUMBER                 05190092
052000                                                     PIC S9(09)   05200092
052100                                                     COMP-3.      05210092
052200                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05220092
052300                             88  ASC-VALID-SELECT    VALUE ' '    05230092
052400                                                           'S'    05240092
052500                                                           'B'    05250092
052600                                                           'E'.   05260092
052700                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05270092
052800                             88  ASC-TEMP-SELECT     VALUE 'S'.   05280092
052900                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05290092
053000                             88  ASC-TEMP-END        VALUE 'E'.   05300092
053100                         30  ASC-SELECTED-SW         PIC  X(01).  05310092
053200                             88  ASC-NO-SELECT       VALUE ' '.   05320092
053300                             88  ASC-SELECT          VALUE 'S'.   05330092
053400                             88  ASC-BEGIN           VALUE 'B'.   05340092
053500                             88  ASC-END             VALUE 'E'.   05350092
053600                         30  ASC-ACTION              PIC  X(01).  05360092
053700                         30  ASC-INVC-NBR            PIC  X(22).  05370092
053800                         30  ASC-INVC-DTE            PIC  X(10).  05380092
053900                         30  ASC-PO-NBR              PIC S9(09)   05390092
054000                                                          COMP.   05400092
054100                         30  ASC-VENDOR              PIC  X(10).  05410092
054200                         30  ASC-STR-NBR             PIC S9(04)   05420092
054300                                                          COMP.   05430092
054400                         30  ASC-DC-NBR              PIC S9(04)   05440092
054500                                                          COMP.   05450092
054600                         30  ASC-MTCH-LVL-CDE        PIC  X(01).  05460092
054700                         30  ASC-INVC-TYPE           PIC  X(02).  05470092
054800                         30  ASC-STATUS              PIC  X(02).  05480092
054900                         30  ASC-INVC-AMT          PIC S9(09)V99  05490092
055000                                                          COMP-3. 05500092
055100                         30  ASC-CRE-DTE             PIC  X(10).  05510092
055200                                                                  05520092
055300             15  ASC-BLK-SUB                         PIC S9(04)   05530092
055400                                                          COMP    05540092
055500                                                          SYNC.   05550092
055600             15  ASC-ITEM-SUB                        PIC S9(04)   05560092
055700                                                          COMP    05570092
055800                                                          SYNC.   05580092
055900             15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   05590092
056000                                                          COMP-3. 05600092
056100             15  ASC-NUMBER-OF-SELECTED-ITEMS        PIC S9(09)   05610092
056200                                                          COMP-3. 05620092
056300             15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   05630092
056400                                                          COMP-3. 05640092
056500             15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   05650092
056600                                                          COMP-3. 05660092
056700             15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   05670092
056800                                                          COMP-3. 05680092
056900             15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   05690092
057000                                                          COMP    05700092
057100                                                          SYNC.   05710092
057200             15  ASC-START-OF-SELECTED-RANGE         PIC S9(09)   05720092
057300                                                          COMP-3. 05730092
057400             15  ASC-END-OF-SELECTED-RANGE           PIC S9(09)   05740092
057500                                                          COMP-3. 05750092
057600             15  ASC-ITEMS-LEFT-INDICATOR            PIC  X(01).  05760092
057700                 88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05770092
057800                 88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05780092
057900             15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  05790092
058000                 88  ASC-UPDATE-TSQ                  VALUE 'Y'.   05800092
058100                 88  ASC-NO-TSQ-UPDATE               VALUE ' '.   05810092
058200             15  ASC-LIST-QUEUE-NAME.                             05820092
058300                 20  ASC-LIST-TERM-ID                PIC  X(04).  05830092
058400                 20  ASC-LIST-TASK-NUMBER            PIC S9(05)   05840092
058500                                                          COMP-3. 05850092
058600                 20  ASC-LIST-SEQ                    PIC  9(01).  05860092
058700             15  ASC-SEL-QUEUE-NAME.                              05870092
058800                 20  ASC-SEL-TERM-ID                 PIC  X(04).  05880092
058900                 20  ASC-SEL-TASK-NUMBER             PIC S9(05)   05890092
059000                                                          COMP-3. 05900092
059100                 20  ASC-SEL-SEQ                     PIC  9(01).  05910092
059200                                                                  05920092
059300             15  ASC-CURSOR-SW                       PIC  X(01).  05930092
059400                 88  ASC-PO-NBR-CSR                  VALUE '1'.   05940092
059500                 88  ASC-INVC-STAT-DTE-CSR           VALUE '2'.   05950092
059600                 88  ASC-VENDOR-NBR-CSR              VALUE '3'.   05960092
059700                 88  ASC-INVC-NBR-CSR                VALUE '4'.   05970092
059800                 88  ASC-PO-INVC-STAT-CSR            VALUE '5'.   05980092
059900                                                                  05990092
060000             15  ASC-START-ITEM-REQUEST.                          06000092
060100                 20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  06010092
060200     EJECT                                                        06020092
060300*---------------------------------------------------------------* 06030092
060400*    ABEND PROCESSING COPYBOOK.                                 * 06040092
060500*---------------------------------------------------------------* 06050092
060600                                                                  06060092
060700     COPY DPWS013.                                                06070092
060800                                                                  06080092
060900 EJECT                                                            06090092
061000*---------------------------------------------------------------* 06100092
061100*    DB2 AREA FOR INVOICE TABLE                                 * 06110092
061200*---------------------------------------------------------------* 06120092
061300     EXEC SQL                                                     06130092
061400          INCLUDE TINVOIC                                         06140092
061500     END-EXEC.                                                    06150092
061600                                                                  06160092
061700*---------------------------------------------------------------* 06170092
061800*    DB2 AREA FOR EXTERNAL ENTERPRISE TABLE                     * 06180092
061900*---------------------------------------------------------------* 06190092
062000     EXEC SQL                                                     06200092
062100          INCLUDE TEXTENT                                         06210092
062200     END-EXEC.                                                    06220092
062300                                                                  06230092
062400*---------------------------------------------------------------* 06240092
062500*    DB2 AREA FOR EXTERNAL ENTERPRISE NAME TABLE                * 06250092
062600*---------------------------------------------------------------* 06260092
062700     EXEC SQL                                                     06270092
062800          INCLUDE TENTNME                                         06280092
062900     END-EXEC.                                                    06290092
063000                                                                  06300092
063100*---------------------------------------------------------------* 06310092
063200*    DB2 AREA FOR PAYMENT REQUEST ITEM TABLE                    * 06320092
063300*---------------------------------------------------------------* 06330092
063400*---------------------------------------------------------------* 06340092
063500*    DB2 AREA FOR ALLOWANCE/CHARGE TABLE                        * 06350092
063600*---------------------------------------------------------------* 06360092
063700     EXEC SQL                                                     06370092
063800          INCLUDE TALCHRG                                         06380092
063900     END-EXEC.                                                    06390092
064000                                                                  06400092
064100*---------------------------------------------------------------* 06410092
064200*    DB2 AREA FOR COMMUNICATIONS                                * 06420092
064300*---------------------------------------------------------------* 06430092
064400     EXEC SQL                                                     06440092
064500          INCLUDE SQLCA                                           06450092
064600     END-EXEC.                                                    06460092
064700                                                                  06470092
064800*---------------------------------------------------------------* 06480092
064900*    CURSOR WHEN PO NUMBER AND INVOICE STATUS ARE PROVIDED      * 06490092
065000*---------------------------------------------------------------* 06500092
065100                                                                  06510092
065200     EXEC SQL                                                     06520092
065300          DECLARE PO-INVC-STAT-CSR CURSOR                         06530092
065400          FOR SELECT                                              06540092
065500                I.INVC_ID                                         06550092
065600              , I.INVC_DTE                                        06560092
065700              , I.PO_NBR                                          06570092
065800              , I.CRE_DTE                                         06580092
065900              , I.STR_NBR                                         06590092
066000              , I.INVC_TYP_CDE                                    06600092
066100              , I.STATUS_CDE                                      06610092
066200              , I.GRO_COST_AMT                                    06620092
066300              , N.ENT_NAME_DESC                                   06630092
066400              , I.DC_NBR                                          06640092
066500              , I.MTCH_LVL_CDE                                    06650092
066600          FROM  TINVOIC I                                         06660092
066700              , TEXTENT X                                         06670092
066800              , TENTNME N                                         06680092
066900          WHERE I.PO_NBR           = :ASC-KEY-PO-NBR              06690092
067000            AND I.STATUS_CDE       = :ASC-KEY-INVC-STATUS         06700092
067100            AND I.RMIT_VND_ID      = X.DUN_NBR                    06710092
067200            AND X.ENT_ID           = N.ENT_ID                     06720092
067300            AND N.TYPE_CDE        = :PC-LONG-DESC-CODE            06730092
067400          ORDER BY                                                06740092
067500                I.INVC_ID                                         06750092
067600     END-EXEC.                                                    06760092
067700                                                                  06770092
067800*---------------------------------------------------------------* 06780092
067900*    CURSOR WHEN PO NUMBER IS PROVIDED                          * 06790092
068000*---------------------------------------------------------------* 06800092
068100                                                                  06810092
068200     EXEC SQL                                                     06820092
068300          DECLARE PO-NBR-CSR CURSOR                               06830092
068400          FOR SELECT                                              06840092
068500                I.INVC_ID                                         06850092
068600              , I.INVC_DTE                                        06860092
068700              , I.PO_NBR                                          06870092
068800              , I.CRE_DTE                                         06880092
068900              , I.STR_NBR                                         06890092
069000              , I.INVC_TYP_CDE                                    06900094
069100              , I.STATUS_CDE                                      06910092
069200              , I.GRO_COST_AMT                                    06920092
069300              , N.ENT_NAME_DESC                                   06930092
069400              , I.DC_NBR                                          06940092
069500              , I.MTCH_LVL_CDE                                    06950092
069600          FROM  TINVOIC I                                         06960092
069700              , TEXTENT X                                         06970092
069800              , TENTNME N                                         06980092
069900          WHERE I.PO_NBR           = :ASC-KEY-PO-NBR              06990092
070000            AND I.RMIT_VND_ID      = X.DUN_NBR                    07000092
070100            AND X.ENT_ID           = N.ENT_ID                     07010092
070200            AND N.TYPE_CDE        = :PC-LONG-DESC-CODE            07020092
070300            AND I.INVC_TYP_CDE BETWEEN :DK-INVC-TYP-CDE-LOW       07030092
070400                                   AND :DK-INVC-TYP-CDE-HIGH      07040092
070500            AND I.STR_NBR      BETWEEN :DK-STR-NBR-LOW            07050092
070600                                   AND :DK-STR-NBR-HIGH           07060092
070700            AND I.DC_NBR       BETWEEN :DK-DC-NBR-LOW             07070092
070800                                   AND :DK-DC-NBR-HIGH            07080092
070900          ORDER BY                                                07090092
071000                I.INVC_ID                                         07100092
071100     END-EXEC.                                                    07110092
071200                                                                  07120092
071300*---------------------------------------------------------------* 07130092
071400*    CURSOR WHEN INVOICE STATUS AND INVOICE DATE ARE PROVIDED   * 07140092
071500*---------------------------------------------------------------* 07150092
071600                                                                  07160092
071700     EXEC SQL                                                     07170092
071800          DECLARE INVC-STAT-DTE-CSR CURSOR                        07180092
071900          FOR SELECT                                              07190092
072000                I.INVC_ID                                         07200092
072100              , I.INVC_DTE                                        07210092
072200              , I.PO_NBR                                          07220092
072300              , I.CRE_DTE                                         07230092
072400              , I.STR_NBR                                         07240092
072500              , I.INVC_TYP_CDE                                    07250092
072600              , I.STATUS_CDE                                      07260092
072700              , I.GRO_COST_AMT                                    07270092
072800              , N.ENT_NAME_DESC                                   07280092
072900              , I.DC_NBR                                          07290092
073000              , I.MTCH_LVL_CDE                                    07300092
073100          FROM  TINVOIC I                                         07310092
073200              , TEXTENT X                                         07320092
073300              , TENTNME N                                         07330092
073400          WHERE I.INVC_DTE        <= :ASC-KEY-INVC-DTE            07340092
073500            AND I.STATUS_CDE       = :ASC-KEY-INVC-STATUS         07350092
073600            AND X.DUN_NBR          = I.RMIT_VND_ID                07360092
073700            AND X.ENT_ID           = N.ENT_ID                     07370092
073800            AND N.TYPE_CDE        = :PC-LONG-DESC-CODE            07380092
073900            AND I.INVC_TYP_CDE BETWEEN :DK-INVC-TYP-CDE-LOW       07390092
074000                                   AND :DK-INVC-TYP-CDE-HIGH      07400092
074100          ORDER BY                                                07410092
074200                I.INVC_ID                                         07420092
074300     END-EXEC.                                                    07430092
074400                                                                  07440092
074500*---------------------------------------------------------------* 07450092
074600*    CURSOR WHEN VENDOR NUMBER IS PROVIDED                      * 07460092
074700*---------------------------------------------------------------* 07470092
074800                                                                  07480092
074900     EXEC SQL                                                     07490092
075000          DECLARE VENDOR-NBR-CSR CURSOR                           07500092
075100          FOR SELECT                                              07510092
075200                I.INVC_ID                                         07520092
075300              , I.INVC_DTE                                        07530092
075400              , I.PO_NBR                                          07540092
075500              , I.CRE_DTE                                         07550092
075600              , I.STR_NBR                                         07560092
075700              , I.INVC_TYP_CDE                                    07570092
075800              , I.STATUS_CDE                                      07580092
075900              , I.GRO_COST_AMT                                    07590092
076000              , I.RMIT_VND_ID                                     07600092
076100              , N.ENT_NAME_DESC                                   07610092
076200              , I.DC_NBR                                          07620092
076300              , I.MTCH_LVL_CDE                                    07630092
076400          FROM  TINVOIC I                                         07640092
076500              , TEXTENT X                                         07650092
076600              , TENTNME N                                         07660092
076700          WHERE X.DUN_NBR          =   :ASC-KEY-VENDOR-NBR        07670092
076800            AND I.RMIT_VND_ID      =    X.DUN_NBR                 07680092
076900            AND X.ENT_ID           =    N.ENT_ID                  07690092
077000            AND N.TYPE_CDE         =   :PC-LONG-DESC-CODE         07700092
077100            AND I.INVC_TYP_CDE BETWEEN :DK-INVC-TYP-CDE-LOW       07710092
077200                                   AND :DK-INVC-TYP-CDE-HIGH      07720092
077300          ORDER BY                                                07730092
077400                I.INVC_ID                                         07740092
077500     END-EXEC.                                                    07750092
077600                                                                  07760092
077700*---------------------------------------------------------------* 07770092
077800*    CURSOR WHEN INVOICE NUMBER IS PROVIDED                     * 07780092
077900*---------------------------------------------------------------* 07790092
078000                                                                  07800092
078100     EXEC SQL                                                     07810092
078200          DECLARE INVC-NBR-CSR CURSOR                             07820092
078300          FOR SELECT                                              07830092
078400                I.INVC_ID                                         07840092
078500              , I.INVC_DTE                                        07850092
078600              , I.PO_NBR                                          07860092
078700              , I.CRE_DTE                                         07870092
078800              , I.STR_NBR                                         07880092
078900              , I.INVC_TYP_CDE                                    07890092
079000              , I.STATUS_CDE                                      07900092
079100              , I.GRO_COST_AMT                                    07910092
079200              , N.ENT_NAME_DESC                                   07920092
079300              , I.DC_NBR                                          07930092
079400              , I.MTCH_LVL_CDE                                    07940092
079500          FROM  TINVOIC I                                         07950092
079600              , TENTNME N                                         07960092
079700              , TEXTENT X                                         07970092
079800          WHERE I.INVC_ID          = :ASC-KEY-INVC-NBR            07980092
079900            AND I.RMIT_VND_ID      = X.DUN_NBR                    07990092
080000            AND X.ENT_ID           = N.ENT_ID                     08000092
080100            AND N.TYPE_CDE        = :PC-LONG-DESC-CODE            08010092
080200            AND I.INVC_TYP_CDE BETWEEN :DK-INVC-TYP-CDE-LOW       08020092
080300                                   AND :DK-INVC-TYP-CDE-HIGH      08030092
080400          ORDER BY                                                08040092
080500                I.INVC_ID                                         08050092
080600     END-EXEC.                                                    08060092
080700                                                                  08070092
080800*---------------------------------------------------------------* 08080092
080900*    CURSOR TO OBTAIN CHARGES AND DISCOUNTS FOR AN INVOICE      * 08090092
081000*                                                               * 08100092
081100*    NOTES: - I.GRO_COST_AMT AND A.ALW_CHRG_PCT MUST BE MULTI-  * 08110092
081200*             PLIED BEFORE DIVIDING BY 100 OR AN OVERFLOW ERROR * 08120092
081300*             OCCURS.                                           * 08130092
081400*           - SINCE THE DECIMAL FUNCTION DOES NOT ROUND, 0.005  * 08140092
081500*             MUST BE ADDED TO THE DIVISION RESULT TO DO THE    * 08150092
081600*             ROUNDING.                                         * 08160092
081700*           - THEN THE RESULTS MAY BE SUMMED WITHOUT CAUSING    * 08170092
081800*             AN OVERFLOW ERROR.                                * 08180092
081900*           - ALSO, SINCE THE SUM FUNCTION PRODUCES A SINGLE    * 08190092
082000*             NUMBER AND SPECIFYING THE SELECTION OF            * 08200092
082100*             A.ALW_CHRG_TYP_CDE MAY RESULT IN MULTIPLE CODES   * 08210092
082200*             RETRIEVED, THE GROUP BY CLAUSE IS NEEDED.  THIS   * 08220092
082300*             ALLOWS FOR A ONE TO ONE RELATIONSHIP BETWEEN      * 08230092
082400*             THE SUM AND THE CODE RETRIEVED.                   * 08240092
082500*    CHANGED 7/20/94, NOT TO DIVIDE BY 100 SINCE DEFINITION     * 08250092
082600*             OF ALLOWANCE % HAS CHANGED TO V9(4) - PAT DOYLE.  * 08260092
082700*             FORMER CALCULATION:                               * 08270092
082800*               SUM(DECIMAL                                     * 08280092
082900*                  (((I.GRO_COST_AMT * A.ALW_CHRG_PCT)          * 08290092
083000*                  /100 + 0.005),13,2)                          * 08300092
083100*                  + A.ALW_CHRG_AMT)                            * 08310092
083200*---------------------------------------------------------------* 08320092
083300                                                                  08330092
083400     EXEC SQL                                                     08340092
083500          DECLARE CALC-CSR CURSOR                                 08350092
083600          FOR SELECT                                              08360092
083700                ALW_CHRG_TYP_CDE                                  08370092
083800               ,ALW_CHRG_PCT                                      08380092
083900               ,ALW_CHRG_AMT                                      08390092
084000          FROM  TALCHRG                                           08400092
084100          WHERE PO_NBR  = :INVOIC-PO-NBR                          08410092
084200            AND INVC_ID = :INVOIC-INVC-ID                         08420092
084300     END-EXEC.                                                    08430092
084400                                                                  08440092
084500*---------------------------------------------------------------* 08450092
084600 EJECT                                                            08460092
084700 LINKAGE SECTION.                                                 08470092
084800                                                                  08480092
084900 01  DFHCOMMAREA.                                                 08490092
085000     05  FILLER                         OCCURS  1 TO 4072 TIMES   08500092
085100                                        DEPENDING ON EIBCALEN.    08510092
085200         10  FILLER                     PIC X.                    08520092
085300                                                                  08530092
085400 EJECT                                                            08540092
085500 PROCEDURE DIVISION.                                              08550092
085600                                                                  08560092
085700*----------------------------------------------------------------*08570092
085800*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM.  *08580092
085900*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM   *08590092
086000*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT.  *08600092
086100*----------------------------------------------------------------*08610092
086200                                                                  08620092
086300 0000-MAIN-MODULE.                                                08630092
086400                                                                  08640092
086500     INITIALIZE DP030-CICS-API-FIELDS.                            08650092
086600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       08660092
086700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          08670092
086800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         08680092
086900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       08690092
087000     MOVE LENGTH OF AP325AI        TO DP030-MAP-LENGTH (1).       08700092
087100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     08710092
087200     PERFORM 0001-CALL-CICS-ARCH-API.                             08720092
087300                                                                  08730092
087400     PERFORM 1000-CONTROL-PROCESSING                              08740092
087500                                                                  08750092
087600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     08760092
087700     PERFORM 0001-CALL-CICS-ARCH-API.                             08770092
087800                                                                  08780092
087900*----------------------------------------------------------------*08790092
088000*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *08800092
088100*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *08810092
088200*----------------------------------------------------------------*08820092
088300                                                                  08830092
088400 0001-CALL-CICS-ARCH-API.                                         08840092
088500                                                                  08850092
088600     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      08860099
088700                                    DFHCOMMAREA                   08870099
088800                                    DP030-CICS-API-FIELDS         08880099
088900                                    DP020-STANDARD-COMMAREA       08890099
089000                                    AP325AI.                      08900099
089100                                                                  08910092
089200     IF  DP030-RC-CALL-SUCCESSFUL                                 08920092
089300         CONTINUE                                                 08930092
089400     ELSE                                                         08940092
089500         SET DP013-NO-ROLLBACK                                    08950092
089600             DP013-XCTL-DISPLAY-RESTART                           08960092
089700             DP013-CICS-ABEND      TO TRUE                        08970092
089800         MOVE '0001-CALL-CICS-ARCH-API'                           08980092
089900                                   TO DP013-PARAGRAPH             08990092
090110         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09011099
090120-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09012099
090200         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09020092
090300         PERFORM DP013-0000-PROCESS-ABEND                         09030092
090400     END-IF.                                                      09040092
090500                                                                  09050092
090600*----------------------------------------------------------------*09060092
090700* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09070092
090800* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09080092
090900*                                                                *09090092
091000* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *09100092
091100*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *09110092
091200*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *09120092
091300*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *09130092
091400*----------------------------------------------------------------*09140092
091500                                                                  09150092
091600 1000-CONTROL-PROCESSING.                                         09160092
091700                                                                  09170092
091800     EVALUATE TRUE                                                09180092
091900         WHEN DP020-NEXT-ACT-INITIAL                              09190092
092000             INITIALIZE ASC-SPECIFIC-COMMAREA                     09200092
092100             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09210092
092200                                      ASC-SEL-TERM-ID             09220092
092300             MOVE DP020-SRC-TASK-NUMBER                           09230092
092400                                   TO ASC-LIST-TASK-NUMBER        09240092
092500                                      ASC-SEL-TASK-NUMBER         09250092
092600             MOVE PC-LIST-QUEUE-SEQ                               09260092
092700                                   TO ASC-LIST-SEQ                09270092
092800             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 09280092
092900             PERFORM 1100-PROCESS-INTER-APPL-COMM                 09290092
093000             IF  PS-COMMAREA-NOT-VALID                            09300092
093100*                -- THIS WILL RETURN TO CALLING APPLICATION       09310092
093200*                -- WHEN API IS CALLED                            09320092
093300                 SET DP020-NEXT-ACT-APPL-ERROR                    09330092
093400                                   TO TRUE                        09340092
093500             ELSE                                                 09350092
093600                 PERFORM 4000-BUILD-INITIAL-PANEL                 09360092
093700             END-IF                                               09370092
093800                                                                  09380092
093900         WHEN DP020-NEXT-ACT-READ-MAP                             09390092
094000             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09400092
094100                                   TO PV-TOP-ITEM                 09410092
094200             PERFORM 2000-PROCESS-PANEL                           09420092
094300                                                                  09430092
094400         WHEN DP020-NEXT-ACT-RETURN                               09440092
094500             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        09450092
094600                                   TO PV-TOP-ITEM                 09460092
094700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09470092
094800             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 09480092
094900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09490092
095000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09500092
095100                                                                  09510092
095200         WHEN OTHER                                               09520092
095300             SET DP013-LOGIC-ABEND TO TRUE                        09530092
095400             SET DP013-NO-ROLLBACK TO TRUE                        09540092
095500             MOVE '1000-CONTROL-PROCESSING'                       09550092
095600                                   TO DP013-PARAGRAPH             09560092
095700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    09570092
095800                                   TO DP013-MESSAGE-TEXT(1)       09580092
095900             PERFORM DP013-0000-PROCESS-ABEND                     09590092
096000     END-EVALUATE.                                                09600092
096100                                                                  09610092
096200 EJECT                                                            09620092
096300*----------------------------------------------------------------*09630092
096400* EDIT DATA IN INTER-APPL COMMAREA.                              *09640092
096500*----------------------------------------------------------------*09650092
096600                                                                  09660092
096700 1100-PROCESS-INTER-APPL-COMM.                                    09670092
096800                                                                  09680092
096900     SET PS-COMMAREA-VALID         TO TRUE.                       09690092
097000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     09700092
097100                                                                  09710092
097200     EVALUATE TRUE                                                09720092
097300                                                                  09730092
097400     WHEN AP300-PO-NBR       > ZERO   AND                         09740092
097500          AP300-INVC-STATUS  > SPACES AND                         09750092
097600          AP300-INVC-ID      = SPACES AND                         09760092
097700          AP300-DUN-NBR      = SPACES AND                         09770092
097800          AP300-STORE-NBR    = ZEROES AND                         09780092
097900          AP300-DC-NBR       = ZEROES AND                         09790093
098000          AP300-SELCTN-DTE   = SPACES AND                         09800092
098100          AP300-INVC-TYP-CDE = SPACES                             09810092
098200         MOVE AP300-PO-NBR        TO ASC-KEY-PO-NBR               09820092
098300         MOVE AP300-INVC-STATUS   TO ASC-KEY-INVC-STATUS          09830092
098400         SET ASC-PO-INVC-STAT-CSR TO TRUE                         09840092
098500                                                                  09850092
098600     WHEN AP300-PO-NBR > ZERO                                     09860092
098700         IF AP300-INVC-ID     > SPACES OR                         09870092
098800            AP300-DUN-NBR     > SPACES OR                         09880092
098900            AP300-INVC-STATUS > SPACES OR                         09890092
099000            AP300-SELCTN-DTE  > SPACES                            09900092
099100*            -- INVALID COMBINATION OF FIELDS --                  09910092
099200             MOVE PC-TSYMSG-00831  TO DP020-MSG-NUMBER            09920092
099300             SET DP020-MSG-FATAL   TO TRUE                        09930092
099400             SET PS-COMMAREA-NOT-VALID                            09940092
099500                                   TO TRUE                        09950092
099600         ELSE                                                     09960092
099700             MOVE AP300-PO-NBR     TO ASC-KEY-PO-NBR              09970092
099800             SET ASC-PO-NBR-CSR    TO TRUE                        09980092
099900             IF AP300-INVC-TYP-CDE > SPACES                       09990092
100000                 MOVE AP300-INVC-TYP-CDE                          10000092
100100                                 TO DK-INVC-TYP-CDE-LOW           10010092
100200                                    DK-INVC-TYP-CDE-HIGH          10020092
100300             END-IF                                               10030092
100400             IF AP300-STORE-NBR > ZERO                            10040092
100500                 MOVE AP300-STORE-NBR                             10050092
100600                                 TO DK-STR-NBR-LOW                10060092
100700                                    DK-STR-NBR-HIGH               10070092
100800             END-IF                                               10080092
100900             IF AP300-DC-NBR > ZERO                               10090093
101000                 MOVE AP300-DC-NBR                                10100093
101100                                 TO DK-DC-NBR-LOW                 10110093
101200                                    DK-DC-NBR-HIGH                10120093
101300             END-IF                                               10130093
101400             MOVE AP300-INVC-TYP-CDE                              10140092
101500                                 TO ASC-KEY-INVC-TYP-CDE          10150092
101600             MOVE AP300-STORE-NBR                                 10160092
101700                                 TO ASC-KEY-STR-NBR               10170092
101800             MOVE AP300-DC-NBR   TO ASC-KEY-DC-NBR                10180093
101900         END-IF                                                   10190093
102000                                                                  10200093
102100     WHEN AP300-DUN-NBR > SPACES                                  10210093
102200         IF AP300-INVC-ID     > SPACES OR                         10220093
102300            AP300-INVC-STATUS > SPACES OR                         10230093
102400            AP300-SELCTN-DTE  > SPACES                            10240093
102500*            -- INVALID COMBINATION OF FIELDS --                  10250093
102600             MOVE PC-TSYMSG-00831  TO DP020-MSG-NUMBER            10260093
102700             SET DP020-MSG-FATAL   TO TRUE                        10270093
102800             SET PS-COMMAREA-NOT-VALID                            10280093
102900                                   TO TRUE                        10290093
103000         ELSE                                                     10300093
103100             MOVE AP300-DUN-NBR    TO ASC-KEY-VENDOR-NBR          10310093
103200             SET ASC-VENDOR-NBR-CSR                               10320093
103300                                   TO TRUE                        10330093
103400             IF AP300-INVC-TYP-CDE > SPACES                       10340093
103500                 MOVE AP300-INVC-TYP-CDE                          10350093
103600                                 TO DK-INVC-TYP-CDE-LOW           10360093
103700                                    DK-INVC-TYP-CDE-HIGH          10370093
103800             END-IF                                               10380093
103900             MOVE AP300-INVC-TYP-CDE                              10390093
104000                                 TO ASC-KEY-INVC-TYP-CDE          10400093
104100         END-IF                                                   10410093
104200                                                                  10420093
104300     WHEN AP300-INVC-ID > SPACES                                  10430093
104400         IF AP300-INVC-STATUS > SPACES OR                         10440093
104500            AP300-SELCTN-DTE  > SPACES                            10450093
104600*            -- INVALID COMBINATION OF FIELDS --                  10460093
104700             MOVE PC-TSYMSG-00831  TO DP020-MSG-NUMBER            10470093
104800             SET DP020-MSG-FATAL   TO TRUE                        10480093
104900             SET PS-COMMAREA-NOT-VALID                            10490093
105000                                   TO TRUE                        10500093
105100         ELSE                                                     10510093
105200             MOVE AP300-INVC-ID    TO ASC-KEY-INVC-NBR            10520093
105300             SET ASC-INVC-NBR-CSR  TO TRUE                        10530093
105400             IF AP300-INVC-TYP-CDE > SPACES                       10540093
105500                 MOVE AP300-INVC-TYP-CDE                          10550093
105600                                 TO DK-INVC-TYP-CDE-LOW           10560093
105700                                    DK-INVC-TYP-CDE-HIGH          10570093
105800             END-IF                                               10580093
105900             MOVE AP300-INVC-TYP-CDE                              10590093
106000                                 TO ASC-KEY-INVC-TYP-CDE          10600093
106100         END-IF                                                   10610093
106200                                                                  10620093
106300     WHEN AP300-INVC-STATUS > SPACES AND                          10630093
106400          AP300-SELCTN-DTE  > SPACES                              10640093
106500         MOVE AP300-INVC-STATUS  TO ASC-KEY-INVC-STATUS           10650093
106600         MOVE AP300-SELCTN-DTE   TO ASC-KEY-INVC-DTE              10660093
106700         SET ASC-INVC-STAT-DTE-CSR                                10670093
106800                                 TO TRUE                          10680093
106900         IF AP300-INVC-TYP-CDE > SPACES                           10690093
107000             MOVE AP300-INVC-TYP-CDE                              10700093
107100                                 TO DK-INVC-TYP-CDE-LOW           10710093
107200                                    DK-INVC-TYP-CDE-HIGH          10720093
107300         END-IF                                                   10730093
107400         MOVE AP300-INVC-TYP-CDE TO ASC-KEY-INVC-TYP-CDE          10740093
107500                                                                  10750093
107600     WHEN ( AP300-INVC-STATUS > SPACES AND                        10760093
107700            AP300-SELCTN-DTE  = SPACES)                           10770093
107800       OR ( AP300-INVC-STATUS = SPACES AND                        10780093
107900            AP300-SELCTN-DTE  > SPACES)                           10790093
108000*            -- BOTH STATUS & SELECTION DATE REQUIRED --          10800093
108100         MOVE PC-TSYMSG-00830    TO DP020-MSG-NUMBER              10810093
108200         SET DP020-MSG-FATAL     TO TRUE                          10820093
108300         SET PS-COMMAREA-NOT-VALID                                10830093
108400                                 TO TRUE                          10840093
108500                                                                  10850093
108600     WHEN OTHER                                                   10860093
108700*        -- ENTRY OF A FIELD REQUIRED --                          10870093
108800         MOVE PC-TSYMSG-00330      TO DP020-MSG-NUMBER            10880093
108900         SET DP020-MSG-FATAL       TO TRUE                        10890093
109000         SET PS-COMMAREA-NOT-VALID TO TRUE                        10900093
109100                                                                  10910093
109200     END-EVALUATE.                                                10920093
109300                                                                  10930093
109400 EJECT                                                            10940093
109500*----------------------------------------------------------------*10950093
109600* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10960093
109700* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10970093
109800* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10980093
109900* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10990093
110000* FUNCTION KEYS CAN GET THIS FAR.                                *11000093
110100*----------------------------------------------------------------*11010093
110200                                                                  11020093
110300 2000-PROCESS-PANEL.                                              11030093
110400                                                                  11040093
110500     EVALUATE TRUE                                                11050093
110600         WHEN DP020-SRC-AID = DP016-CLEAR                         11060093
110700             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    11070093
110800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11080093
110900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11090093
111000                                                                  11100093
111100* ADDED TO ALLOW ADDING NEW 'MI' INVOICES                         11110093
111200         WHEN DP020-SRC-AID = DP016-PF13                          11120093
111300             INITIALIZE AP300-INTER-APPL-COMMAREA                 11130093
111400             MOVE ASC-KEY-PO-NBR TO AP300-PO-NBR                  11140093
111500*            MOVE 'MI'           TO AP300-INVC-TYP-CDE            11150093
111600                                                                  11160093
111700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    11170093
111800             PERFORM 2050-DELETE-LIST-QUEUE                       11180093
111900             PERFORM 2075-REFRESH-ASC-KEY                         11190093
112000             PERFORM 4000-BUILD-INITIAL-PANEL                     11200093
112100                                                                  11210093
112200         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    11220093
112300             PERFORM 2140-DESELECT-ALL-ITEMS                      11230093
112400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11240093
112500                                                                  11250093
112600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  11260093
112700             PERFORM 2150-SELECT-ALL-ITEMS                        11270093
112800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11280093
112900                                                                  11290093
113000         WHEN OTHER                                               11300093
113100             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 11310093
113200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   11320093
113300             IF  PS-NO-ERROR                                      11330093
113400                 SET DP030-CONTINUE-GO                            11340093
113500                                 TO TRUE                          11350093
113600                 PERFORM 2100-CHECK-FUNCTION-KEY                  11360093
113700             ELSE                                                 11370093
113800                 SET DP030-OVERRIDE-GO                            11380093
113900                                 TO TRUE                          11390093
114000             END-IF                                               11400093
114100     END-EVALUATE.                                                11410093
114200 EJECT                                                            11420093
114300                                                                  11430093
114400*----------------------------------------------------------------*11440093
114500*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *11450093
114600*----------------------------------------------------------------*11460093
114700                                                                  11470093
114800 2050-DELETE-LIST-QUEUE.                                          11480093
114900                                                                  11490093
115000     EXEC CICS                                                    11500093
115100         DELETEQ TS                                               11510093
115200             QUEUE (ASC-LIST-QUEUE-NAME)                          11520093
115300             RESP  (PV-CICS-RESP)                                 11530093
115400     END-EXEC.                                                    11540093
115500                                                                  11550093
115600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       11560093
115700        (PV-CICS-RESP = DFHRESP(QIDERR))                          11570093
115800         CONTINUE                                                 11580093
115900     ELSE                                                         11590093
116000         SET DP013-CICS-ABEND      TO TRUE                        11600093
116100         SET DP013-NO-ROLLBACK     TO TRUE                        11610093
116200                                                                  11620093
116300         MOVE '2050-DELETE-LIST-QUEUE'                            11630093
116400                                   TO DP013-PARAGRAPH             11640093
116500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    11650093
116600                                   TO DP013-MESSAGE-TEXT (1)      11660093
116700         PERFORM DP013-0000-PROCESS-ABEND                         11670093
116800     END-IF.                                                      11680093
116900                                                                  11690093
117000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  11700093
117100 EJECT                                                            11710093
117200                                                                  11720093
117300*----------------------------------------------------------------*11730093
117400* REFRESH THE ASC-KEY- FIELDS TO THE INITIAL ENTRY CONTENTS.     *11740093
117500*----------------------------------------------------------------*11750093
117600                                                                  11760093
117700 2075-REFRESH-ASC-KEY.                                            11770093
117800                                                                  11780093
117900     INITIALIZE  ASC-KEY-STR-NBR                                  11790093
118000                                                                  11800093
118100     EVALUATE TRUE                                                11810093
118200                                                                  11820093
118300         WHEN ASC-PO-NBR-CSR                                      11830093
118400             INITIALIZE ASC-KEY-INVC-STATUS                       11840093
118500                        ASC-KEY-INVC-DTE                          11850093
118600                        ASC-KEY-VENDOR-NBR                        11860093
118700                        ASC-KEY-VENDOR-NBR                        11870093
118800                        ASC-KEY-DC-NBR                            11880093
118900                                                                  11890093
119000         WHEN ASC-PO-INVC-STAT-CSR                                11900093
119100             INITIALIZE ASC-KEY-INVC-DTE                          11910093
119200                        ASC-KEY-VENDOR-NBR                        11920093
119300                        ASC-KEY-INVC-NBR                          11930093
119400                        ASC-KEY-INVC-TYP-CDE                      11940093
119500                        ASC-KEY-DC-NBR                            11950093
119600                                                                  11960093
119700         WHEN ASC-VENDOR-NBR-CSR                                  11970093
119800             INITIALIZE ASC-KEY-PO-NBR                            11980093
119900                        ASC-KEY-INVC-STATUS                       11990093
120000                        ASC-KEY-INVC-DTE                          12000093
120100                        ASC-KEY-INVC-NBR                          12010093
120200                        ASC-KEY-STR-NBR                           12020093
120300                        ASC-KEY-DC-NBR                            12030093
120400                                                                  12040093
120500         WHEN ASC-INVC-NBR-CSR                                    12050093
120600             INITIALIZE ASC-KEY-PO-NBR                            12060093
120700                        ASC-KEY-INVC-STATUS                       12070093
120800                        ASC-KEY-INVC-DTE                          12080093
120900                        ASC-KEY-VENDOR-NBR                        12090093
121000                        ASC-KEY-STR-NBR                           12100093
121100                        ASC-KEY-DC-NBR                            12110093
121200                                                                  12120093
121300         WHEN ASC-INVC-STAT-DTE-CSR                               12130093
121400             INITIALIZE ASC-KEY-PO-NBR                            12140093
121500                        ASC-KEY-VENDOR-NBR                        12150093
121600                        ASC-KEY-INVC-NBR                          12160093
121700                        ASC-KEY-STR-NBR                           12170093
121800                        ASC-KEY-STR-NBR                           12180093
121900                        ASC-KEY-DC-NBR                            12190093
122000                                                                  12200093
122100         WHEN OTHER                                               12210093
122200*                -- INVALID COMBINATION OF FIELDS --              12220093
122300             MOVE PC-TSYMSG-00831  TO DP020-MSG-NUMBER            12230093
122400             SET DP020-MSG-FATAL   TO TRUE                        12240093
122500             SET PS-COMMAREA-NOT-VALID                            12250093
122600                                   TO TRUE                        12260093
122700                                                                  12270093
122800     END-EVALUATE.                                                12280093
122900                                                                  12290093
123000*----------------------------------------------------------------*12300093
123100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*12310093
123200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *12320093
123300* CICS ARCHITECTURE API.                                         *12330093
123400*----------------------------------------------------------------*12340093
123500                                                                  12350093
123600 2100-CHECK-FUNCTION-KEY.                                         12360093
123700                                                                  12370093
123800     EVALUATE TRUE                                                12380093
123900         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 12390093
124000             INITIALIZE AP300-INTER-APPL-COMMAREA                 12400093
124100             IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO              12410093
124200                 PERFORM 5000-PREPARE-SEL-QUEUE                   12420093
124300             END-IF                                               12430093
124400             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    12440093
124500                                TO AP300-NUMBER-OF-SELECTED-ITEMS 12450093
124600             MOVE ASC-KEY-PO-NBR                                  12460093
124700                                TO AP300-PO-NBR                   12470093
124800             MOVE ASC-KEY-INVC-NBR                                12480093
124900                                TO AP300-INVC-ID                  12490093
125000             MOVE ASC-KEY-VENDOR-NBR                              12500093
125100                                TO AP300-DUN-NBR                  12510093
125200             MOVE ASC-KEY-INVC-STATUS                             12520093
125300                                TO AP300-INVC-STATUS              12530093
125400             MOVE ASC-KEY-INVC-DTE                                12540093
125500                                TO AP300-SELCTN-DTE               12550093
125600             MOVE ASC-KEY-STR-NBR                                 12560093
125700                                TO AP300-STORE-NBR                12570093
125800             MOVE ASC-KEY-DC-NBR                                  12580093
125900                                TO AP300-DC-NBR                   12590093
126000                                                                  12600093
126100         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  12610093
126200             MOVE +1               TO PV-TOP-ITEM                 12620093
126300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12630093
126400                                                                  12640093
126500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   12650093
126600             PERFORM 2110-BROWSE-BACKWARD                         12660093
126700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12670093
126800                                                                  12680093
126900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   12690093
127000             PERFORM 2120-BROWSE-FORWARD                          12700093
127100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 12710093
127200                                                                  12720093
127300         WHEN DP020-SRC-AID = DP016-ENTER                         12730093
127400             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   12740093
127500             IF  PS-ERROR                                         12750093
127600                 CONTINUE                                         12760093
127700             ELSE                                                 12770093
127800                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             12780093
127900             END-IF                                               12790093
128000                                                                  12800093
128100         WHEN OTHER                                               12810093
128200             SET DP013-NO-ROLLBACK                                12820093
128300                 DP013-XCTL-DISPLAY-RESTART                       12830093
128400                 DP013-CICS-ABEND  TO TRUE                        12840093
128500             MOVE '2100-CHECK-FUNCTION-KEY'                       12850093
128600                                   TO DP013-PARAGRAPH             12860093
128700             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      12870093
128800                                   TO DP013-MESSAGE-TEXT (1)      12880093
128900             PERFORM DP013-0000-PROCESS-ABEND                     12890093
129000     END-EVALUATE.                                                12900093
129100                                                                  12910093
129200*----------------------------------------------------------------*12920093
129300*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *12930093
129400*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *12940093
129500*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *12950093
129600*    MESSAGE.                                                    *12960093
129700*----------------------------------------------------------------*12970093
129800                                                                  12980093
129900 2110-BROWSE-BACKWARD.                                            12990093
130000                                                                  13000093
130100     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    13010093
130200         GIVING PV-TOP-ITEM.                                      13020093
130300                                                                  13030093
130400     IF  ((PV-TOP-ITEM < +1)                                      13040093
130500       OR (PV-TOP-ITEM = +1))                                     13050093
130600         MOVE +1                   TO PV-TOP-ITEM                 13060093
130700*        -- TOP OF LIST --                                        13070093
130800         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            13080093
130900         SET DP020-MSG-INFORMATIONAL TO TRUE                      13090093
131000     END-IF.                                                      13100093
131100                                                                  13110093
131200 EJECT                                                            13120093
131300*----------------------------------------------------------------*13130093
131400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *13140093
131500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *13150093
131600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *13160093
131700*----------------------------------------------------------------*13170093
131800                                                                  13180093
131900 2120-BROWSE-FORWARD.                                             13190093
132000                                                                  13200093
132100     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              13210093
132200         GIVING PV-TOP-ITEM.                                      13220093
132300     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   13230093
132400         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13240093
132500                                   TO PV-TOP-ITEM                 13250093
132600*        -- BOTTOM OF LIST --                                     13260093
132700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            13270093
132800         SET DP020-MSG-INFORMATIONAL                              13280093
132900                                   TO TRUE                        13290093
133000     ELSE                                                         13300093
133100         COMPUTE PV-BOTTOM-ITEM =                                 13310093
133200             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 13320093
133300         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            13330093
133400*            -- BOTTOM OF LIST --                                 13340093
133500             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            13350093
133600             SET DP020-MSG-INFORMATIONAL                          13360093
133700                                   TO TRUE                        13370093
133800         END-IF                                                   13380093
133900     END-IF.                                                      13390093
134000 EJECT                                                            13400093
134100                                                                  13410093
134200*----------------------------------------------------------------*13420093
134300*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *13430093
134400*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *13440093
134500*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *13450093
134600*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *13460093
134700*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *13470093
134800*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *13480093
134900*----------------------------------------------------------------*13490093
135000                                                                  13500093
135100 2130-CHECK-FOR-JUMP-BROWSE.                                      13510093
135200                                                                  13520093
135300     SET PS-NO-ERROR               TO TRUE.                       13530093
135400     IF (ASC-START-ITEM-REQUEST = SPACE)                          13540093
135500         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            13550093
135600                                   TO PV-TOP-ITEM                 13560093
135700     ELSE                                                         13570093
135800         MOVE ASC-START-ITEM-REQUEST                              13580093
135900                                   TO DP010I-UNEDITED-FIELD       13590093
136000         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       13600093
136100         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     13610093
136200         SET DP010I-NEGATIVE-NOT-ALLOWED                          13620093
136300                                   TO TRUE                        13630093
136410         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13641099
136420                         USING DP010I-NUMERIC-EDIT-AREA           13642099
136500                                                                  13650093
136600         IF  NOT DP010I-ERROR-DETECTED                            13660093
136700             MOVE DP010I-NUMERIC-FIELD                            13670093
136800                                   TO  ASC-START-ITEM-REQUEST-N   13680093
136900             IF  ASC-START-ITEM-REQUEST-N > ZERO                  13690093
137000                 IF  ASC-START-ITEM-REQUEST-N >                   13700093
137100                                          ASC-NUMBER-OF-ITEMS-READ13710093
137200                     MOVE SPACE TO ASC-START-ITEM-REQUEST         13720093
137300                     COMPUTE PV-TOP-ITEM =                        13730093
137400                             ASC-NUMBER-OF-ITEMS-READ             13740093
137500                             - PC-ITEMS-PER-PANEL + 1             13750093
137600                     IF  PV-TOP-ITEM < +1                         13760093
137700                         MOVE +1   TO PV-TOP-ITEM                 13770093
137800*                        -- BOTTOM OF LIST --                     13780093
137900                         MOVE PC-TSYMSG-00070                     13790093
138000                                   TO DP020-MSG-NUMBER            13800093
138100                         SET DP020-MSG-INFORMATIONAL              13810093
138200                                   TO TRUE                        13820093
138300                     END-IF                                       13830093
138400                 ELSE                                             13840093
138500                     MOVE ASC-START-ITEM-REQUEST-N                13850093
138600                                   TO PV-TOP-ITEM                 13860093
138700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      13870093
138800                     COMPUTE PV-BOTTOM-ITEM =                     13880093
138900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     13890093
139000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ13900093
139100*                        -- BOTTOM OF LIST --                     13910093
139200                         MOVE PC-TSYMSG-00070                     13920093
139300                                   TO DP020-MSG-NUMBER            13930093
139400                         SET DP020-MSG-INFORMATIONAL              13940093
139500                                   TO TRUE                        13950093
139600                     END-IF                                       13960093
139700                 END-IF                                           13970093
139800             ELSE                                                 13980093
139900*                --- VALUE OUT OF RANGE ----                      13990093
140000                 MOVE PC-TSYMSG-00101                             14000093
140100                                   TO DP020-MSG-NUMBER            14010093
140200                 MOVE -1           TO ASTRTITL                    14020093
140300                 SET DP030-SET-CURSOR-APPL-1                      14030093
140400                                   TO TRUE                        14040093
140500                 MOVE DP015-REVERSE                               14050093
140600                                   TO ASTRTITH                    14060093
140700                 MOVE DP015-RED    TO ASTRTITC                    14070093
140800                 MOVE DP015-UNP-NUM-BRT-MDT                       14080093
140900                                   TO ASTRTITA                    14090093
141000                 SET DP020-MSG-FATAL                              14100093
141100                                   TO TRUE                        14110093
141200                 SET PS-ERROR      TO TRUE                        14120093
141300             END-IF                                               14130093
141400                                                                  14140093
141500         ELSE                                                     14150093
141600*            -- MUST BE NUMERIC --                                14160093
141700             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            14170093
141800             MOVE -1               TO ASTRTITL                    14180093
141900             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14190093
142000             MOVE DP015-REVERSE    TO ASTRTITH                    14200093
142100             MOVE DP015-RED        TO ASTRTITC                    14210093
142200             MOVE DP015-UNP-NUM-BRT-MDT                           14220093
142300                                   TO ASTRTITA                    14230093
142400             SET DP020-MSG-FATAL   TO TRUE                        14240093
142500             SET PS-ERROR          TO TRUE                        14250093
142600         END-IF                                                   14260093
142700     END-IF.                                                      14270093
142800 EJECT                                                            14280093
142900                                                                  14290093
143000*----------------------------------------------------------------*14300093
143100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *14310093
143200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *14320093
143300*----------------------------------------------------------------*14330093
143400                                                                  14340093
143500 2140-DESELECT-ALL-ITEMS.                                         14350093
143600                                                                  14360093
143700     MOVE +1                       TO ASC-BLK-SUB.                14370093
143800                                                                  14380093
143900     PERFORM 2141-CLEAR-SELECTED-INDS                             14390093
144000         VARYING ASC-ITEM-SUB                                     14400093
144100         FROM 1 BY 1                                              14410093
144200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14420093
144300                                                                  14430093
144400     ADD +1                        TO ASC-BLK-SUB.                14440093
144500                                                                  14450093
144600     PERFORM 2141-CLEAR-SELECTED-INDS                             14460093
144700         VARYING ASC-ITEM-SUB                                     14470093
144800         FROM 1 BY 1                                              14480093
144900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14490093
145000                                                                  14500093
145100     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14510093
145200                                   TO PV-LIST-ITEM-NUMBER.        14520093
145300                                                                  14530093
145400     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14540093
145500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14550093
145600                                                                  14560093
145700     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14570093
145800        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      14580093
145900         MOVE +1                   TO ASC-BLK-SUB                 14590093
146000                                                                  14600093
146100         PERFORM 5100-WRITE-TEMP-STORAGE                          14610093
146200                                                                  14620093
146300         MOVE +1                   TO PV-BLOCK-NUMBER             14630093
146400                                                                  14640093
146500         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14650093
146600             PV-FIRST-BLOCK-IN-ARRAY - 1                          14660093
146700                                                                  14670093
146800         PERFORM                                                  14680093
146900             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14690093
147000                                                                  14700093
147100             PERFORM 4410-READ-TEMP-STORAGE                       14710093
147200                                                                  14720093
147300             PERFORM 2141-CLEAR-SELECTED-INDS                     14730093
147400                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 14740093
147500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14750093
147600                                                                  14760093
147700             PERFORM 5100-WRITE-TEMP-STORAGE                      14770093
147800                                                                  14780093
147900             ADD +1                TO PV-BLOCK-NUMBER             14790093
148000                                                                  14800093
148100         END-PERFORM                                              14810093
148200                                                                  14820093
148300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14830093
148400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14840093
148500                                                                  14850093
148600         PERFORM                                                  14860093
148700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14870093
148800                   ASC-HIGHEST-BLOCK-WRITTEN                      14880093
148900                                                                  14890093
149000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14900093
149100                                   TO PV-BLOCK-NUMBER             14910093
149200                                                                  14920093
149300             PERFORM 4410-READ-TEMP-STORAGE                       14930093
149400                                                                  14940093
149500             PERFORM 2141-CLEAR-SELECTED-INDS                     14950093
149600                 VARYING ASC-ITEM-SUB                             14960093
149700                 FROM 1 BY 1                                      14970093
149800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14980093
149900                                                                  14990093
150000             PERFORM 5100-WRITE-TEMP-STORAGE                      15000093
150100                                                                  15010093
150200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15020093
150300                                                                  15030093
150400         END-PERFORM                                              15040093
150500                                                                  15050093
150600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15060093
150700                                   TO PV-BLOCK-NUMBER             15070093
150800                                                                  15080093
150900         PERFORM 4410-READ-TEMP-STORAGE                           15090093
151000     END-IF.                                                      15100093
151100                                                                  15110093
151200                                                                  15120093
151300     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 15130093
151400     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.15140093
151500     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  15150093
151600                                                                  15160093
151700     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15170093
151800                                                                  15180093
151900 EJECT                                                            15190093
152000*----------------------------------------------------------------*15200093
152100*    MARK EACH ITEM AS BEING NOT SELECTED.                       *15210093
152200*----------------------------------------------------------------*15220093
152300                                                                  15230093
152400 2141-CLEAR-SELECTED-INDS.                                        15240093
152500                                                                  15250093
152600     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15260093
152700             NOT EQUAL ZERO                                       15270093
152800         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15280093
152900             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          15290093
153000                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    15300093
153100                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15310093
153200                                   TO TRUE                        15320093
153300         END-IF                                                   15330093
153400     END-IF.                                                      15340093
153500                                                                  15350093
153600 EJECT                                                            15360093
153700*----------------------------------------------------------------*15370093
153800*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *15380093
153900*  FOR ALL ITEMS.                                                *15390093
154000*----------------------------------------------------------------*15400093
154100                                                                  15410093
154200 2150-SELECT-ALL-ITEMS.                                           15420093
154300                                                                  15430093
154400     MOVE +1                       TO ASC-BLK-SUB.                15440093
154500                                                                  15450093
154600     PERFORM 2151-SET-SELECTED-INDS                               15460093
154700         VARYING ASC-ITEM-SUB                                     15470093
154800         FROM 1 BY 1                                              15480093
154900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15490093
155000                                                                  15500093
155100     ADD +1                        TO ASC-BLK-SUB.                15510093
155200                                                                  15520093
155300     PERFORM 2151-SET-SELECTED-INDS                               15530093
155400         VARYING ASC-ITEM-SUB                                     15540093
155500         FROM 1 BY 1                                              15550093
155600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15560093
155700                                                                  15570093
155800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15580093
155900                                   TO PV-LIST-ITEM-NUMBER.        15590093
156000                                                                  15600093
156100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15610093
156200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    15620093
156300                                                                  15630093
156400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     15640093
156500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    15650093
156600         MOVE +1                   TO ASC-BLK-SUB                 15660093
156700                                                                  15670093
156800         PERFORM 5100-WRITE-TEMP-STORAGE                          15680093
156900                                                                  15690093
157000         MOVE +1                   TO PV-BLOCK-NUMBER             15700093
157100                                                                  15710093
157200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15720093
157300             PV-FIRST-BLOCK-IN-ARRAY - 1                          15730093
157400                                                                  15740093
157500         PERFORM                                                  15750093
157600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       15760093
157700                                                                  15770093
157800             PERFORM 4410-READ-TEMP-STORAGE                       15780093
157900                                                                  15790093
158000             PERFORM 2151-SET-SELECTED-INDS                       15800093
158100                 VARYING ASC-ITEM-SUB                             15810093
158200                 FROM 1 BY 1                                      15820093
158300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15830093
158400                                                                  15840093
158500             PERFORM 5100-WRITE-TEMP-STORAGE                      15850093
158600                                                                  15860093
158700             ADD +1                TO PV-BLOCK-NUMBER             15870093
158800                                                                  15880093
158900         END-PERFORM                                              15890093
159000                                                                  15900093
159100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15910093
159200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15920093
159300                                                                  15930093
159400         PERFORM                                                  15940093
159500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15950093
159600                   ASC-HIGHEST-BLOCK-WRITTEN                      15960093
159700                                                                  15970093
159800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15980093
159900                                   TO PV-BLOCK-NUMBER             15990093
160000                                                                  16000093
160100             PERFORM 4410-READ-TEMP-STORAGE                       16010093
160200                                                                  16020093
160300             PERFORM 2151-SET-SELECTED-INDS                       16030093
160400                 VARYING ASC-ITEM-SUB                             16040093
160500                 FROM 1 BY 1                                      16050093
160600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16060093
160700                                                                  16070093
160800             PERFORM 5100-WRITE-TEMP-STORAGE                      16080093
160900                                                                  16090093
161000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16100093
161100                                                                  16110093
161200         END-PERFORM                                              16120093
161300                                                                  16130093
161400         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16140093
161500                                   TO PV-BLOCK-NUMBER             16150093
161600                                                                  16160093
161700         PERFORM 4410-READ-TEMP-STORAGE                           16170093
161800     END-IF.                                                      16180093
161900                                                                  16190093
162000                                                                  16200093
162100     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             16210093
162200                       ASC-NUMBER-OF-SELECTED-ITEMS.              16220093
162300                                                                  16230093
162400     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        16240093
162500                                                                  16250093
162600 EJECT                                                            16260093
162700*----------------------------------------------------------------*16270093
162800*    MARK EACH ITEM AS BEING SELECTED.                           *16280093
162900*----------------------------------------------------------------*16290093
163000                                                                  16300093
163100 2151-SET-SELECTED-INDS.                                          16310093
163200                                                                  16320093
163300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           16330093
163400             NOT EQUAL ZERO                                       16340093
163500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16350093
163600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             16360093
163700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        16370093
163800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  16380093
163900                               TO  TRUE                           16390093
164000         END-IF                                                   16400093
164100     END-IF.                                                      16410093
164200                                                                  16420093
164300*----------------------------------------------------------------*16430093
164400*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *16440093
164500*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *16450093
164600*----------------------------------------------------------------*16460093
164700                                                                  16470093
164800 2200-MOVE-SCREEN-TO-COMMAREA.                                    16480093
164900                                                                  16490093
165000     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16500093
165100     MOVE +1                       TO PV-SUB.                     16510093
165200                                                                  16520093
165300     PERFORM 3100-SET-SUBSCRIPTS.                                 16530093
165400     IF  ASTRTITL > ZERO                                          16540093
165500         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          16550093
165600     ELSE                                                         16560093
165700         IF  ASTRTITF = DP015-ERASE-EOF                           16570093
165800             INITIALIZE ASC-START-ITEM-REQUEST                    16580093
165900         END-IF                                                   16590093
166000     END-IF.                                                      16600093
166100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          16610093
166200         VARYING PV-SUB                                           16620093
166300         FROM 1 BY 1                                              16630093
166400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      16640093
166500                                                                  16650093
166600*----------------------------------------------------------------*16660093
166700*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *16670093
166800*----------------------------------------------------------------*16680093
166900                                                                  16690093
167000 2210-MOVE-LINES-TO-COMMAREA.                                     16700093
167100                                                                  16710093
167200     IF  MR-SELECTL (PV-SUB) > ZERO                               16720093
167300         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             16730093
167400         MOVE MR-SELECTI (PV-SUB)                                 16740093
167500                                   TO ASC-TEMP-SELECTED-SW        16750093
167600                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16760093
167700     ELSE                                                         16770093
167800         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                16780093
167900                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     16790093
168000                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        16800093
168100                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      16810093
168200         END-IF                                                   16820093
168300     END-IF.                                                      16830093
168400     ADD +1                        TO ASC-ITEM-SUB.               16840093
168500     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        16850093
168600         ADD +1                    TO ASC-BLK-SUB                 16860093
168700         MOVE +1                   TO ASC-ITEM-SUB                16870093
168800     END-IF.                                                      16880093
168900                                                                  16890093
169000*----------------------------------------------------------------*16900093
169100*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *16910093
169200*  COMMAREA (EDITING IS NOT DONE AGAINST THE SCREEN DIRECTLY).   *16920093
169300*----------------------------------------------------------------*16930093
169400                                                                  16940093
169500 3000-EDIT-DATA-IN-COMMAREA.                                      16950093
169600                                                                  16960093
169700     SET PS-NO-ERROR               TO TRUE.                       16970093
169800     PERFORM 3200-RESET-ATTRIBUTES.                               16980093
169900     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     16990093
170000**                                                                17000093
170100* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              17010093
170200* EDITING IS DONE FROM THE BOTTOM UP.                             17020093
170300**                                                                17030093
170400     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       17040093
170500         ASC-ITEMS-DISPLAYED - 1.                                 17050093
170600     PERFORM 3100-SET-SUBSCRIPTS.                                 17060093
170700     PERFORM 3300-EDIT-SELECTIONS                                 17070093
170800         VARYING PV-SUB                                           17080093
170900         FROM PV-SUB BY -1                                        17090093
171000         UNTIL PV-SUB < +1                                        17100093
171100                                                                  17110093
171200     IF  PS-NO-ERROR                                              17120093
171300         PERFORM 3400-CHECK-RANGE-SEQUENCE                        17130093
171400     END-IF.                                                      17140093
171500                                                                  17150093
171600     IF  ((PS-NO-ERROR)                                           17160093
171700       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   17170093
171800       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    17180093
171900             PERFORM 3500-MARK-RANGE-AS-SELECTED                  17190093
172000     END-IF.                                                      17200093
172100 EJECT                                                            17210093
172200                                                                  17220093
172300*----------------------------------------------------------------*17230093
172400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17240093
172500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17250093
172600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17260093
172700*                                                                *17270093
172800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17280093
172900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17290093
173000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17300093
173100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *17310093
173200*----------------------------------------------------------------*17320093
173300                                                                  17330093
173400 3100-SET-SUBSCRIPTS.                                             17340093
173500                                                                  17350093
173600     COMPUTE ASC-ITEM-SUB =                                       17360093
173700         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17370093
173800                                                                  17380093
173900     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17390093
174000         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17400093
174100                                                                  17410093
174200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               17420093
174300     ELSE                                                         17430093
174400         MOVE +1                     TO ASC-BLK-SUB               17440093
174500     END-IF.                                                      17450093
174600*----------------------------------------------------------------*17460093
174700*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *17470093
174800*----------------------------------------------------------------*17480093
174900                                                                  17490093
175000 3200-RESET-ATTRIBUTES.                                           17500093
175100                                                                  17510093
175200     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   17520093
175300     MOVE DP015-GREEN              TO ASTRTITC.                   17530093
175400     MOVE DP015-UNDERLINE          TO ASTRTITH.                   17540093
175500                                                                  17550093
175600     PERFORM                                                      17560093
175700         VARYING PV-SUB                                           17570093
175800         FROM 1 BY 1                                              17580093
175900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        17590093
176000         MOVE DP015-UNP-ALP-NOR-OFF                               17600093
176100                                   TO MR-SELECTA (PV-SUB)         17610093
176200         MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)         17620093
176300         MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)         17630093
176400     END-PERFORM.                                                 17640093
176500                                                                  17650093
176600*----------------------------------------------------------------*17660093
176700*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *17670093
176800*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *17680093
176900*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITED OR      *17690093
177000*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *17700093
177100*----------------------------------------------------------------*17710093
177200                                                                  17720093
177300 3300-EDIT-SELECTIONS.                                            17730093
177400                                                                  17740093
177500     EVALUATE TRUE                                                17750093
177600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17760093
177700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         17770093
177800                 CONTINUE                                         17780093
177900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17790093
178000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17800093
178100                 EVALUATE TRUE                                    17810093
178200                     WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)    17820093
178300                         MOVE ZERO                                17830093
178400                                TO ASC-START-OF-SELECTED-RANGE    17840093
178500                     WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)      17850093
178600                         MOVE ZERO                                17860093
178700                                TO ASC-END-OF-SELECTED-RANGE      17870093
178800                 END-EVALUATE                                     17880093
178900                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   17890093
179000                 MOVE ASC-TEMP-SELECTED-SW                        17900093
179100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17910093
179200                                TO ASC-SELECTED-SW                17920093
179300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  17930093
179400             END-IF                                               17940093
179500         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17950093
179600                 = SPACE                                          17960093
179700             EVALUATE TRUE                                        17970093
179800                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       17980093
179900                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS17990093
180000                     MOVE SPACE TO ASC-SELECTED-SW                18000093
180100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18010093
180200                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        18020093
180300                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    18030093
180400                     MOVE SPACE TO ASC-SELECTED-SW                18040093
180500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18050093
180600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          18060093
180700                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      18070093
180800                     MOVE SPACE TO ASC-SELECTED-SW                18080093
180900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18090093
181000             END-EVALUATE                                         18100093
181100         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           18110093
181200             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18120093
181300                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18130093
181400             END-IF                                               18140093
181500             PERFORM 3310-EDIT-RANGE                              18150093
181600         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             18160093
181700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18170093
181800                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    18180093
181900             END-IF                                               18190093
182000             PERFORM 3310-EDIT-RANGE                              18200093
182100         WHEN OTHER                                               18210093
182200*            -- INVALID VALUE --                                  18220093
182300             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           18230093
182400             SET DP020-MSG-FATAL    TO TRUE                       18240093
182500             MOVE -1                TO MR-SELECTL (PV-SUB)        18250093
182600             SET DP030-SET-CURSOR-APPL-1                          18260093
182700                                    TO TRUE                       18270093
182800             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        18280093
182900             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        18290093
183000             SET PS-ERROR TO TRUE                                 18300093
183100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            18310093
183200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     18320093
183300                 MOVE SPACE         TO ASC-SELECTED-SW            18330093
183400                                        (ASC-BLK-SUB ASC-ITEM-SUB)18340093
183500             END-IF                                               18350093
183600     END-EVALUATE.                                                18360093
183700                                                                  18370093
183800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 18380093
183900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               18390093
184000     IF  ASC-ITEM-SUB < 1                                         18400093
184100         SUBTRACT +1 FROM ASC-BLK-SUB                             18410093
184200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                18420093
184300     END-IF.                                                      18430093
184400                                                                  18440093
184500*----------------------------------------------------------------*18450093
184600*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *18460093
184700*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *18470093
184800*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *18480093
184900*  THE ENDING.                                                   *18490093
185000*----------------------------------------------------------------*18500093
185100                                                                  18510093
185200 3310-EDIT-RANGE.                                                 18520093
185300                                                                  18530093
185400     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                18540093
185500         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   18550093
185600             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)18560093
185700                                   TO ASC-SELECTED-SW             18570093
185800                                        (ASC-BLK-SUB ASC-ITEM-SUB)18580093
185900             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 18590093
186000         ELSE                                                     18600093
186100             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     18610093
186200                 CONTINUE                                         18620093
186300             ELSE                                                 18630093
186400*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        18640093
186500                 MOVE PC-TSYMSG-00054                             18650093
186600                                   TO DP020-MSG-NUMBER            18660093
186700                 SET DP020-MSG-FATAL                              18670093
186800                                   TO TRUE                        18680093
186900                 MOVE -1           TO MR-SELECTL (PV-SUB)         18690093
187000                 SET DP030-SET-CURSOR-APPL-1                      18700093
187100                                   TO TRUE                        18710093
187200                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         18720093
187300                 MOVE DP015-UNDERLINE                             18730093
187400                                   TO MR-SELECTH (PV-SUB)         18740093
187500                 SET PS-ERROR      TO TRUE                        18750093
187600             END-IF                                               18760093
187700         END-IF                                                   18770093
187800     ELSE                                                         18780093
187900         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     18790093
188000             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18800093
188100                                   TO ASC-SELECTED-SW             18810093
188200                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18820093
188300             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18830093
188400         ELSE                                                     18840093
188500             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18850093
188600                 CONTINUE                                         18860093
188700             ELSE                                                 18870093
188800*                -- ONLY ONE END-OF-RANGE ALLOWED --              18880093
188900                 MOVE PC-TSYMSG-00055                             18890093
189000                                   TO DP020-MSG-NUMBER            18900093
189100                 SET DP020-MSG-FATAL                              18910093
189200                                   TO TRUE                        18920093
189300                 MOVE -1           TO MR-SELECTL (PV-SUB)         18930093
189400                 SET DP030-SET-CURSOR-APPL-1                      18940093
189500                                   TO TRUE                        18950093
189600                 SET PS-ERROR      TO TRUE                        18960093
189700             END-IF                                               18970093
189800         END-IF                                                   18980093
189900     END-IF.                                                      18990093
190000                                                                  19000093
190100*----------------------------------------------------------------*19010093
190200*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *19020093
190300*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *19030093
190400*----------------------------------------------------------------*19040093
190500                                                                  19050093
190600 3400-CHECK-RANGE-SEQUENCE.                                       19060093
190700                                                                  19070093
190800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       19080093
190900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      19090093
191000       AND  ASC-START-OF-SELECTED-RANGE >                         19100093
191100                                         ASC-END-OF-SELECTED-RANGE19110093
191200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                19120093
191300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 19130093
191400         SET DP020-MSG-FATAL TO TRUE                              19140093
191500         SET PS-ERROR TO TRUE                                     19150093
191600         PERFORM 3410-POSITION-AT-ERROR                           19160093
191700     END-IF.                                                      19170093
191800                                                                  19180093
191900*----------------------------------------------------------------*19190093
192000*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *19200093
192100*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *19210093
192200*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *19220093
192300*----------------------------------------------------------------*19230093
192400                                                                  19240093
192500 3410-POSITION-AT-ERROR.                                          19250093
192600                                                                  19260093
192700     SET DP030-SET-CURSOR-APPL-1                                  19270093
192800                                   TO TRUE.                       19280093
192900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 19290093
193000                    - PV-TOP-ITEM + 1.                            19300093
193100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19310093
193200         CONTINUE                                                 19320093
193300     ELSE                                                         19330093
193400         MOVE -1                   TO MR-SELECTL (PV-SUB)         19340093
193500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19350093
193600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19360093
193700     END-IF.                                                      19370093
193800                                                                  19380093
193900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   19390093
194000                    - PV-TOP-ITEM + 1.                            19400093
194100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      19410093
194200         CONTINUE                                                 19420093
194300     ELSE                                                         19430093
194400         MOVE -1                   TO MR-SELECTL (PV-SUB)         19440093
194500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         19450093
194600         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         19460093
194700     END-IF.                                                      19470093
194800 EJECT                                                            19480093
194900                                                                  19490093
195000*----------------------------------------------------------------*19500093
195100*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *19510093
195200*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *19520093
195300*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *19530093
195400*----------------------------------------------------------------*19540093
195500                                                                  19550093
195600 3500-MARK-RANGE-AS-SELECTED.                                     19560093
195700                                                                  19570093
195800     MOVE +1                       TO  ASC-BLK-SUB.               19580093
195900     PERFORM 3510-MARK-SELECTED-INDS                              19590093
196000         VARYING ASC-ITEM-SUB                                     19600093
196100         FROM 1 BY 1                                              19610093
196200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19620093
196300                                                                  19630093
196400     ADD +1                        TO ASC-BLK-SUB.                19640093
196500     PERFORM 3510-MARK-SELECTED-INDS                              19650093
196600         VARYING ASC-ITEM-SUB                                     19660093
196700         FROM 1 BY 1                                              19670093
196800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 19680093
196900                                                                  19690093
197000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               19700093
197100                                   TO  PV-LIST-ITEM-NUMBER.       19710093
197200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            19720093
197300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         19730093
197400               PC-ITEMS-PER-PANEL).                               19740093
197500                                                                  19750093
197600     MOVE ASC-START-OF-SELECTED-RANGE                             19760093
197700                                   TO PV-START-OF-SELECTED-RANGE. 19770093
197800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19780093
197900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19790093
198000               PC-ITEMS-PER-PANEL).                               19800093
198100                                                                  19810093
198200     MOVE ASC-END-OF-SELECTED-RANGE                               19820093
198300                                   TO  PV-END-OF-SELECTED-RANGE.  19830093
198400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19840093
198500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19850093
198600               PC-ITEMS-PER-PANEL).                               19860093
198700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19870093
198800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19880093
198900                                                                  19890093
199000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19900093
199100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19910093
199200         MOVE +1                   TO ASC-BLK-SUB                 19920093
199300         PERFORM 5100-WRITE-TEMP-STORAGE                          19930093
199400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19940093
199500             PV-FIRST-BLOCK-IN-ARRAY - 1                          19950093
199600                                                                  19960093
199700         PERFORM                                                  19970093
199800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19980093
199900                   PV-PREV-BLOCK-IN-ARRAY                         19990093
200000             MOVE PV-FIRST-BLOCK-IN-RANGE                         20000093
200100                                   TO PV-BLOCK-NUMBER             20010093
200200             PERFORM 4410-READ-TEMP-STORAGE                       20020093
200300             PERFORM 3510-MARK-SELECTED-INDS                      20030093
200400                 VARYING ASC-ITEM-SUB                             20040093
200500                 FROM 1 BY 1                                      20050093
200600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20060093
200700             PERFORM 5100-WRITE-TEMP-STORAGE                      20070093
200800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     20080093
200900         END-PERFORM                                              20090093
201000                                                                  20100093
201100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         20110093
201200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     20120093
201300         PERFORM                                                  20130093
201400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       20140093
201500                   PV-LAST-BLOCK-IN-RANGE                         20150093
201600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          20160093
201700                                   TO PV-BLOCK-NUMBER             20170093
201800             PERFORM 4410-READ-TEMP-STORAGE                       20180093
201900             PERFORM 3510-MARK-SELECTED-INDS                      20190093
202000                 VARYING ASC-ITEM-SUB                             20200093
202100                 FROM 1 BY 1                                      20210093
202200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          20220093
202300             PERFORM 5100-WRITE-TEMP-STORAGE                      20230093
202400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      20240093
202500         END-PERFORM                                              20250093
202600                                                                  20260093
202700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             20270093
202800                                   TO PV-BLOCK-NUMBER             20280093
202900         PERFORM 4410-READ-TEMP-STORAGE                           20290093
203000     END-IF.                                                      20300093
203100                                                                  20310093
203200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 20320093
203300                                      ASC-END-OF-SELECTED-RANGE.  20330093
203400                                                                  20340093
203500 EJECT                                                            20350093
203600*----------------------------------------------------------------*20360093
203700* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *20370093
203800*----------------------------------------------------------------*20380093
203900                                                                  20390093
204000 3510-MARK-SELECTED-INDS.                                         20400093
204100                                                                  20410093
204200     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20420093
204300                                ASC-ITEM-SUB) >                   20430093
204400         ASC-START-OF-SELECTED-RANGE)                             20440093
204500     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         20450093
204600                                ASC-ITEM-SUB) =                   20460093
204700         ASC-START-OF-SELECTED-RANGE)                             20470093
204800                                                                  20480093
204900         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20490093
205000                                    ASC-ITEM-SUB) <               20500093
205100             ASC-END-OF-SELECTED-RANGE)                           20510093
205200         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     20520093
205300                                    ASC-ITEM-SUB) =               20530093
205400             ASC-END-OF-SELECTED-RANGE)                           20540093
205500                                                                  20550093
205600             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          20560093
205700                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   20570093
205800                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   20580093
205900                               TO TRUE                            20590093
206000                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              20600093
206100                               TO TRUE                            20610093
206200                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    20620093
206300             END-IF                                               20630093
206400         END-IF                                                   20640093
206500     END-IF.                                                      20650093
206600                                                                  20660093
206700 EJECT                                                            20670093
206800*----------------------------------------------------------------*20680093
206900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *20690093
207000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *20700093
207100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *20710093
207200*    DISPLAY THE PANEL TO USER.                                  *20720093
207300*----------------------------------------------------------------*20730093
207400                                                                  20740093
207500 4000-BUILD-INITIAL-PANEL.                                        20750093
207600                                                                  20760093
207700     INITIALIZE                 ASC-BLOCK-ENTRIES (1)             20770093
207800                                ASC-BLOCK-ENTRIES (2).            20780093
207900     MOVE +1                 TO ASC-BLK-SUB.                      20790093
208000     SET ASC-ITEMS-LEFT-ON-DB                                     20800093
208100                             TO TRUE.                             20810093
208200                                                                  20820093
208300     MOVE +0                 TO ASC-ITEM-SUB                      20830093
208400                                ASC-NUMBER-OF-ITEMS-READ          20840093
208500                                ASC-NUMBER-OF-SELECTED-ITEMS      20850093
208600                                ASC-HIGHEST-BLOCK-WRITTEN         20860093
208700                                ASC-START-OF-SELECTED-RANGE       20870093
208800                                ASC-END-OF-SELECTED-RANGE         20880093
208900                                ASC-ITEM-AT-TOP-OF-PANEL.         20890093
209000                                                                  20900093
209100     PERFORM 4010-OPEN-CURSOR.                                    20910093
209200                                                                  20920093
209300     IF PS-NO-ERROR-DB2                                           20930093
209400         PERFORM 4300-READ-ITEMS-FROM-DB                          20940093
209500     END-IF.                                                      20950093
209600                                                                  20960093
209700     IF PS-NO-ERROR-DB2                                           20970093
209800         IF ASC-PO-NBR-CSR                                        20980093
209900            IF PS-BULK AND PS-BY-STORE                            20990093
210000               MOVE PC-TSYMSG-01308  TO DP020-MSG-NUMBER          21000093
210100               SET DP020-MSG-WARNING TO TRUE                      21010093
210200            END-IF                                                21020093
210300         END-IF                                                   21030093
210400     END-IF.                                                      21040093
210500                                                                  21050093
210600     IF PS-NO-ERROR-DB2                                           21060093
210700         PERFORM 4020-CLOSE-CURSOR                                21070093
210800     END-IF.                                                      21080093
210900                                                                  21090093
211000     MOVE +1                   TO  PV-TOP-ITEM.                   21100093
211100     IF PS-ERROR-DB2                                              21110093
211200         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    21120093
211300     ELSE                                                         21130093
211400         IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                      21140093
211500             SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                21150093
211600             SET DP020-MSG-FATAL   TO  TRUE                       21160093
211700*            -- NO LIST ITEMS WERE FOUND FOR CRITERIA SPECIFIED   21170093
211800             MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER           21180093
211900         ELSE                                                     21190093
212000             MOVE -1               TO MR-SELECTL (1)              21200093
212100             SET DP030-SET-CURSOR-APPL-1                          21210093
212200                                   TO TRUE                        21220093
212300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 21230093
212400         END-IF                                                   21240093
212500     END-IF.                                                      21250093
212600 EJECT                                                            21260093
212700*----------------------------------------------------------------*21270093
212800* OPEN THE CURSOR.                                               *21280093
212900*   IN THIS PARTICULAR APPLICATION ONE OF 4 DIFFERENT CURSORS    *21290093
213000*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *21300093
213100*   USER.                                                        *21310093
213200*----------------------------------------------------------------*21320093
213300                                                                  21330093
213400 4010-OPEN-CURSOR.                                                21340093
213500                                                                  21350093
213600     INITIALIZE DP013-DB2-INFO.                                   21360093
213700                                                                  21370093
213800     EVALUATE TRUE                                                21380093
213900                                                                  21390093
214000         WHEN ASC-PO-NBR-CSR                                      21400093
214100             MOVE 'OPEN PO NUMBER CURSOR'                         21410093
214200                                 TO DP013-MESSAGE-TEXT (1)        21420093
214300             EXEC SQL                                             21430093
214400                  OPEN PO-NBR-CSR                                 21440093
214500             END-EXEC                                             21450093
214600                                                                  21460093
214700         WHEN ASC-PO-INVC-STAT-CSR                                21470093
214800             MOVE 'OPEN PO/INVOICE STATUS CURSOR'                 21480093
214900                                 TO DP013-MESSAGE-TEXT (1)        21490093
215000             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      21500093
215100             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      21510093
215200             EXEC SQL                                             21520093
215300                  OPEN PO-INVC-STAT-CSR                           21530093
215400             END-EXEC                                             21540093
215500                                                                  21550093
215600         WHEN ASC-INVC-STAT-DTE-CSR                               21560093
215700             MOVE 'OPEN INVC STATUS/DATE CURSOR'                  21570093
215800                                 TO DP013-MESSAGE-TEXT (1)        21580093
215900             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      21590093
216000             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      21600093
216100             EXEC SQL                                             21610093
216200                  OPEN INVC-STAT-DTE-CSR                          21620093
216300             END-EXEC                                             21630093
216400                                                                  21640093
216500         WHEN ASC-VENDOR-NBR-CSR                                  21650093
216600             MOVE 'OPEN VENDOR NUMBER CURSOR'                     21660093
216700                                 TO DP013-MESSAGE-TEXT (1)        21670093
216800             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      21680093
216900             MOVE 'TEXTENT'      TO DP013-DB2-TABLE-NAME (4)      21690093
217000             EXEC SQL                                             21700093
217100                  OPEN VENDOR-NBR-CSR                             21710093
217200             END-EXEC                                             21720093
217300                                                                  21730093
217400         WHEN ASC-INVC-NBR-CSR                                    21740093
217500             MOVE 'OPEN INVOICE NUMBER CURSOR'                    21750093
217600                                 TO DP013-MESSAGE-TEXT (1)        21760093
217700             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      21770093
217800             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      21780093
217900             EXEC SQL                                             21790093
218000                  OPEN INVC-NBR-CSR                               21800093
218100             END-EXEC                                             21810093
218200                                                                  21820093
218300     END-EVALUATE.                                                21830093
218400                                                                  21840093
218500     EVALUATE TRUE                                                21850093
218600         WHEN SQLCODE = ZERO                                      21860093
218700              CONTINUE                                            21870093
218800                                                                  21880093
218900         WHEN SQLCODE = -904                                      21890093
219000         WHEN SQLCODE = -913                                      21900093
219100             MOVE '4010-OPEN-CURSOR'                              21910093
219200                                 TO DP013-PARAGRAPH               21920093
219300             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (1)      21930093
219400             MOVE SPACES         TO DP013-DB2-TABLE-NAME (2)      21940093
219500             MOVE SQLCA          TO DP013-SQLCA                   21950093
219600             SET DP013-LINK-RETURN                                21960093
219700                 DP013-DB2-ABEND                                  21970093
219800                 DP013-ROLLBACK  TO TRUE                          21980093
219900             PERFORM DP013-0000-PROCESS-ABEND                     21990093
220000             MOVE 'TINVOIC'      TO DP020-MSG-TEXT                22000093
220100             SET DP020-MSG-FATAL TO TRUE                          22010093
220200*            --- CONFLICT FOR DATABASE ---                        22020093
220300             MOVE PC-TSYMSG-00482                                 22030093
220400                                 TO DP020-MSG-NUMBER              22040093
220500             SET PS-ERROR-DB2    TO TRUE                          22050093
220600                                                                  22060093
220700         WHEN OTHER                                               22070093
220800             MOVE '4010-OPEN-CURSOR'                              22080093
220900                                 TO DP013-PARAGRAPH               22090093
221000             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (1)      22100093
221100             MOVE SPACES         TO DP013-DB2-TABLE-NAME (2)      22110093
221200             MOVE SQLCA          TO DP013-SQLCA                   22120093
221300             SET DP013-DB2-ABEND                                  22130093
221400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22140093
221500             PERFORM DP013-0000-PROCESS-ABEND                     22150093
221600     END-EVALUATE.                                                22160093
221700                                                                  22170093
221800 EJECT                                                            22180093
221900*----------------------------------------------------------------*22190093
222000* CLOSE THE CURSOR.                                              *22200093
222100*   IN THIS PARTICULAR APPLICATION ONE OF 4 DIFFERENT CURSORS    *22210093
222200*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *22220093
222300*   USER.                                                        *22230093
222400*----------------------------------------------------------------*22240093
222500                                                                  22250093
222600 4020-CLOSE-CURSOR.                                               22260093
222700                                                                  22270093
222800     INITIALIZE DP013-DB2-INFO.                                   22280093
222900                                                                  22290093
223000     EVALUATE TRUE                                                22300093
223100                                                                  22310093
223200         WHEN ASC-PO-NBR-CSR                                      22320093
223300             MOVE 'CLOSE PO NUMBER CURSOR'                        22330093
223400                                 TO DP013-MESSAGE-TEXT (1)        22340093
223500             EXEC SQL                                             22350093
223600                  CLOSE PO-NBR-CSR                                22360093
223700             END-EXEC                                             22370093
223800                                                                  22380093
223900         WHEN ASC-PO-INVC-STAT-CSR                                22390093
224000             MOVE 'CLOSE PO/INVOICE STATUS CURSOR'                22400093
224100                                 TO DP013-MESSAGE-TEXT (1)        22410093
224200             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      22420093
224300             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      22430093
224400             EXEC SQL                                             22440093
224500                  CLOSE PO-INVC-STAT-CSR                          22450093
224600             END-EXEC                                             22460093
224700                                                                  22470093
224800         WHEN ASC-INVC-STAT-DTE-CSR                               22480093
224900             MOVE 'CLOSE INVC STATUS/DATE CURSOR'                 22490093
225000                                 TO DP013-MESSAGE-TEXT (1)        22500093
225100             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      22510093
225200             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      22520093
225300             EXEC SQL                                             22530093
225400                  CLOSE INVC-STAT-DTE-CSR                         22540093
225500             END-EXEC                                             22550093
225600                                                                  22560093
225700         WHEN ASC-VENDOR-NBR-CSR                                  22570093
225800             MOVE 'CLOSE VENDOR NUMBER CURSOR'                    22580093
225900                                 TO DP013-MESSAGE-TEXT (1)        22590093
226000             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      22600093
226100             MOVE 'TEXTENT'      TO DP013-DB2-TABLE-NAME (4)      22610093
226200             EXEC SQL                                             22620093
226300                  CLOSE VENDOR-NBR-CSR                            22630093
226400             END-EXEC                                             22640093
226500                                                                  22650093
226600         WHEN ASC-INVC-NBR-CSR                                    22660093
226700             MOVE 'CLOSE INVOICE NUMBER CURSOR'                   22670093
226800                                 TO DP013-MESSAGE-TEXT (1)        22680093
226900             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      22690093
227000             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      22700093
227100             EXEC SQL                                             22710093
227200                  CLOSE INVC-NBR-CSR                              22720093
227300             END-EXEC                                             22730093
227400                                                                  22740093
227500     END-EVALUATE.                                                22750093
227600                                                                  22760093
227700     EVALUATE TRUE                                                22770093
227800         WHEN SQLCODE = ZERO                                      22780093
227900         WHEN SQLCODE = -904                                      22790093
228000         WHEN SQLCODE = -913                                      22800093
228100             CONTINUE                                             22810093
228200                                                                  22820093
228300         WHEN OTHER                                               22830093
228400             MOVE '4020-CLOSE-CURSOR'                             22840093
228500                                 TO DP013-PARAGRAPH               22850093
228600             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (1)      22860093
228700             MOVE SPACES         TO DP013-DB2-TABLE-NAME (2)      22870093
228800             MOVE SQLCA          TO DP013-SQLCA                   22880093
228900             SET DP013-DB2-ABEND                                  22890093
229000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22900093
229100             PERFORM DP013-0000-PROCESS-ABEND                     22910093
229200     END-EVALUATE.                                                22920093
229300                                                                  22930093
229400 EJECT                                                            22940093
229500*                                                                 22950093
229600*----------------------------------------------------------------*22960093
229700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *22970093
229800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *22980093
229900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *22990093
230000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *23000093
230100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *23010093
230200*                                                                *23020093
230300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *23030093
230400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *23040093
230500*    UPON INITIALIZATION.                                        *23050093
230600*----------------------------------------------------------------*23060093
230700                                                                  23070093
230800 4300-READ-ITEMS-FROM-DB.                                         23080093
230900                                                                  23090093
231000     SET PS-FIRST-FETCH   TO TRUE.                                23100093
231100     SET PS-NO-BULK       TO TRUE.                                23110093
231200     SET PS-NO-BY-STORE   TO TRUE.                                23120093
231300                                                                  23130093
231400     PERFORM                                                      23140093
231500         VARYING PV-READ-COUNT                                    23150093
231600         FROM 1 BY 1                                              23160093
231700         UNTIL PV-READ-COUNT > PC-MAX-ITEMS                       23170093
231800            OR ASC-NO-ITEMS-LEFT-ON-DB                            23180093
231900            OR PS-ERROR-DB2                                       23190093
232000                                                                  23200093
232100         PERFORM 4310-FETCH                                       23210093
232200                                                                  23220093
232300         IF  ASC-VENDOR-NBR-CSR AND PS-FIRST-FETCH                23230093
232400             PERFORM 4311-GET-VENDOR-NAME                         23240093
232500             SET  PS-NOT-FIRST-FETCH TO TRUE                      23250093
232600         END-IF                                                   23260093
232700                                                                  23270093
232800         IF  ASC-ITEMS-LEFT-ON-DB AND                             23280093
232900             PS-NO-ERROR-DB2                                      23290093
233000             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                23300093
233100                 ADD +1            TO ASC-ITEM-SUB                23310093
233200             ELSE                                                 23320093
233300                 ADD +1            TO ASC-BLK-SUB                 23330093
233400                 MOVE +1           TO ASC-ITEM-SUB                23340093
233500                                                                  23350093
233600                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         23360093
233700                     MOVE +1       TO ASC-BLK-SUB                 23370093
233800                     SET ASC-BLOCK-MODIFIED (1)                   23380093
233900                                   TO TRUE                        23390093
234000                     PERFORM 5100-WRITE-TEMP-STORAGE              23400093
234100                     MOVE ASC-BLOCK-ENTRIES                       23410093
234200                               (PC-MAX-BLOCKS-IN-ARRAY)           23420093
234300                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 23430093
234400                     ADD +1        TO ASC-BLK-SUB                 23440093
234500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   23450093
234600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      23460093
234700                                   TO TRUE                        23470093
234800                 END-IF                                           23480093
234900             END-IF                                               23490093
235000             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    23500093
235100             MOVE ASC-NUMBER-OF-ITEMS-READ                        23510093
235200                                   TO ASC-LIST-ITEM-NUMBER        23520093
235300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23530093
235400             MOVE INVOIC-INVC-ID   TO ASC-INVC-NBR                23540093
235500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23550093
235600             MOVE INVOIC-INVC-DTE  TO ASC-INVC-DTE                23560093
235700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23570093
235800             MOVE INVOIC-PO-NBR    TO ASC-PO-NBR                  23580093
235900                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23590093
236000             MOVE ENTNME-ENT-NAME-DESC                            23600093
236100                                   TO ASC-VENDOR                  23610093
236200                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23620093
236300             MOVE INVOIC-STR-NBR   TO ASC-STR-NBR                 23630093
236400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23640093
236500             MOVE INVOIC-INVC-TYP-CDE                             23650093
236600                                   TO ASC-INVC-TYPE               23660093
236700                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23670093
236800             MOVE INVOIC-STATUS-CDE                               23680093
236900                                   TO ASC-STATUS                  23690093
237000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23700093
237100             MOVE INVOIC-CRE-DTE                                  23710093
237200                                   TO ASC-CRE-DTE                 23720093
237300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23730093
237400             MOVE INVOIC-DC-NBR    TO ASC-DC-NBR                  23740093
237500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23750093
237600             MOVE INVOIC-MTCH-LVL-CDE                             23760093
237700                                    TO ASC-MTCH-LVL-CDE           23770093
237800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 23780093
237900             IF PS-NO-ERROR-DB2                                   23790093
238000                 PERFORM 4330-CALC-INVOICE-AMT                    23800093
238100             END-IF                                               23810093
238200         END-IF                                                   23820093
238300     END-PERFORM.                                                 23830093
238400                                                                  23840093
238500     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO AND                      23850093
238600         PS-NO-ERROR-DB2                                          23860093
238700         MOVE +1               TO ASC-BLK-SUB                     23870093
238800         PERFORM 5100-WRITE-TEMP-STORAGE                          23880093
238900         ADD +1                TO ASC-BLK-SUB                     23890093
239000         PERFORM 5100-WRITE-TEMP-STORAGE                          23900093
239100                                                                  23910093
239200         MOVE 1                TO ASC-BLK-SUB                     23920093
239300                                  PV-BLOCK-NUMBER                 23930093
239400         PERFORM 4410-READ-TEMP-STORAGE                           23940093
239500         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23950093
239600             MOVE 2            TO ASC-BLK-SUB                     23960093
239700                                  PV-BLOCK-NUMBER                 23970093
239800             PERFORM 4410-READ-TEMP-STORAGE                       23980093
239900         END-IF                                                   23990093
240000     END-IF.                                                      24000093
240100 EJECT                                                            24010093
240200*----------------------------------------------------------------*24020093
240300*    FETCH THE CURSOR.                                           *24030093
240400*----------------------------------------------------------------*24040093
240500                                                                  24050093
240600 4310-FETCH.                                                      24060093
240700                                                                  24070093
240800     INITIALIZE DP013-DB2-INFO.                                   24080093
240900                                                                  24090093
241000     EVALUATE TRUE                                                24100093
241100                                                                  24110093
241200         WHEN ASC-PO-NBR-CSR                                      24120093
241300             MOVE 'FETCH PO NUMBER CURSOR'                        24130093
241400                                 TO DP013-MESSAGE-TEXT (1)        24140093
241500             EXEC SQL                                             24150093
241600                  FETCH PO-NBR-CSR                                24160093
241700                  INTO  :INVOIC-INVC-ID                           24170093
241800                      , :INVOIC-INVC-DTE                          24180093
241900                      , :INVOIC-PO-NBR                            24190093
242000                      , :INVOIC-CRE-DTE                           24200093
242100                      , :INVOIC-STR-NBR                           24210093
242200                      , :INVOIC-INVC-TYP-CDE                      24220093
242300                      , :INVOIC-STATUS-CDE                        24230093
242400                      , :INVOIC-GRO-COST-AMT                      24240093
242500                      , :ENTNME-ENT-NAME-DESC                     24250093
242600                      , :INVOIC-DC-NBR                            24260093
242700                      , :INVOIC-MTCH-LVL-CDE                      24270093
242800             END-EXEC                                             24280093
242900                                                                  24290093
243000         WHEN ASC-PO-INVC-STAT-CSR                                24300093
243100             MOVE 'FETCH PO/INVOICE STATUS CURSOR'                24310093
243200                                 TO DP013-MESSAGE-TEXT (1)        24320093
243300             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      24330093
243400             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      24340093
243500             EXEC SQL                                             24350093
243600                  FETCH PO-INVC-STAT-CSR                          24360093
243700                  INTO  :INVOIC-INVC-ID                           24370093
243800                      , :INVOIC-INVC-DTE                          24380093
243900                      , :INVOIC-PO-NBR                            24390093
244000                      , :INVOIC-CRE-DTE                           24400093
244100                      , :INVOIC-STR-NBR                           24410093
244200                      , :INVOIC-INVC-TYP-CDE                      24420093
244300                      , :INVOIC-STATUS-CDE                        24430093
244400                      , :INVOIC-GRO-COST-AMT                      24440093
244500                      , :ENTNME-ENT-NAME-DESC                     24450093
244600                      , :INVOIC-DC-NBR                            24460093
244700                      , :INVOIC-MTCH-LVL-CDE                      24470093
244800             END-EXEC                                             24480093
244900                                                                  24490093
245000         WHEN ASC-INVC-STAT-DTE-CSR                               24500093
245100             MOVE 'FETCH INVC STATUS/DATE CURSOR'                 24510093
245200                                 TO DP013-MESSAGE-TEXT (1)        24520093
245300             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      24530093
245400             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      24540093
245500             EXEC SQL                                             24550093
245600                  FETCH INVC-STAT-DTE-CSR                         24560093
245700                  INTO  :INVOIC-INVC-ID                           24570093
245800                      , :INVOIC-INVC-DTE                          24580093
245900                      , :INVOIC-PO-NBR                            24590093
246000                      , :INVOIC-CRE-DTE                           24600093
246100                      , :INVOIC-STR-NBR                           24610093
246200                      , :INVOIC-INVC-TYP-CDE                      24620093
246300                      , :INVOIC-STATUS-CDE                        24630093
246400                      , :INVOIC-GRO-COST-AMT                      24640093
246500                      , :ENTNME-ENT-NAME-DESC                     24650093
246600                      , :INVOIC-DC-NBR                            24660093
246700                      , :INVOIC-MTCH-LVL-CDE                      24670093
246800             END-EXEC                                             24680093
246900                                                                  24690093
247000         WHEN ASC-VENDOR-NBR-CSR                                  24700093
247100             MOVE 'FETCH VENDOR NUMBER CURSOR'                    24710093
247200                                 TO DP013-MESSAGE-TEXT (1)        24720093
247300             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      24730093
247400             MOVE 'TEXTENT'      TO DP013-DB2-TABLE-NAME (4)      24740093
247500             EXEC SQL                                             24750093
247600                  FETCH VENDOR-NBR-CSR                            24760093
247700                  INTO  :INVOIC-INVC-ID                           24770093
247800                      , :INVOIC-INVC-DTE                          24780093
247900                      , :INVOIC-PO-NBR                            24790093
248000                      , :INVOIC-CRE-DTE                           24800093
248100                      , :INVOIC-STR-NBR                           24810093
248200                      , :INVOIC-INVC-TYP-CDE                      24820093
248300                      , :INVOIC-STATUS-CDE                        24830093
248400                      , :INVOIC-GRO-COST-AMT                      24840093
248500                      , :INVOIC-RMIT-VND-ID                       24850093
248600                      , :INVOIC-DC-NBR                            24860093
248700                      , :INVOIC-MTCH-LVL-CDE                      24870093
248800             END-EXEC                                             24880093
248900                                                                  24890093
249000         WHEN ASC-INVC-NBR-CSR                                    24900093
249100             MOVE 'FETCH INVOICE NUMBER CURSOR'                   24910093
249200                                 TO DP013-MESSAGE-TEXT (1)        24920093
249300             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (3)      24930093
249400             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (4)      24940093
249500             EXEC SQL                                             24950093
249600                  FETCH INVC-NBR-CSR                              24960093
249700                  INTO  :INVOIC-INVC-ID                           24970093
249800                      , :INVOIC-INVC-DTE                          24980093
249900                      , :INVOIC-PO-NBR                            24990093
250000                      , :INVOIC-CRE-DTE                           25000093
250100                      , :INVOIC-STR-NBR                           25010093
250200                      , :INVOIC-INVC-TYP-CDE                      25020093
250300                      , :INVOIC-STATUS-CDE                        25030093
250400                      , :INVOIC-GRO-COST-AMT                      25040093
250500                      , :ENTNME-ENT-NAME-DESC                     25050093
250600                      , :INVOIC-DC-NBR                            25060093
250700                      , :INVOIC-MTCH-LVL-CDE                      25070093
250800             END-EXEC                                             25080093
250900                                                                  25090093
251000     END-EVALUATE.                                                25100093
251100                                                                  25110093
251200     EVALUATE TRUE                                                25120093
251300         WHEN SQLCODE = ZERO                                      25130093
251400              IF ASC-PO-NBR-CSR                                   25140093
251500                AND INVOIC-INVC-TYP-CDE NOT = 'EI'                25150093
251600                 IF (INVOIC-STR-NBR = +0) AND                     25160093
251700                    (INVOIC-STATUS-CDE = 'EN' OR 'IB' OR          25170093
251800                                         'OB' OR 'RC')            25180093
251900                     SET PS-BULK     TO TRUE                      25190093
252000                 END-IF                                           25200093
252100                 IF (INVOIC-STR-NBR NOT = +0) AND                 25210093
252200                    (INVOIC-STATUS-CDE = 'EN' OR 'IB' OR          25220093
252300                                         'OB' OR 'RC')            25230093
252400                     SET PS-BY-STORE TO TRUE                      25240093
252500                 END-IF                                           25250093
252600              END-IF                                              25260093
252700                                                                  25270093
252800         WHEN SQLCODE = +100                                      25280093
252900             SET ASC-NO-ITEMS-LEFT-ON-DB                          25290093
253000                                   TO TRUE                        25300093
253100                                                                  25310093
253200         WHEN SQLCODE = -904                                      25320093
253300         WHEN SQLCODE = -913                                      25330093
253400             MOVE '4310-FETCH'   TO DP013-PARAGRAPH               25340093
253500             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (1)      25350093
253600             MOVE SPACES         TO DP013-DB2-TABLE-NAME (2)      25360093
253700             MOVE SQLCA          TO DP013-SQLCA                   25370093
253800             SET DP013-LINK-RETURN                                25380093
253900                 DP013-DB2-ABEND                                  25390093
254000                 DP013-ROLLBACK  TO TRUE                          25400093
254100             PERFORM DP013-0000-PROCESS-ABEND                     25410093
254200             MOVE 'TINVOIC'      TO DP020-MSG-TEXT                25420093
254300             SET DP020-MSG-FATAL TO TRUE                          25430093
254400*            --- CONFLICT FOR DATABASE ---                        25440093
254500             MOVE PC-TSYMSG-00482                                 25450093
254600                                 TO DP020-MSG-NUMBER              25460093
254700             SET PS-ERROR-DB2    TO TRUE                          25470093
254800                                                                  25480093
254900         WHEN OTHER                                               25490093
255000             MOVE '4310-FETCH'   TO DP013-PARAGRAPH               25500093
255100             MOVE 'TINVOIC'      TO DP013-DB2-TABLE-NAME (1)      25510093
255200             MOVE SPACES         TO DP013-DB2-TABLE-NAME (2)      25520093
255300             MOVE SQLCA          TO DP013-SQLCA                   25530093
255400             SET DP013-DB2-ABEND                                  25540093
255500                 DP013-XCTL-DISPLAY-RESTART TO TRUE               25550093
255600             PERFORM DP013-0000-PROCESS-ABEND                     25560093
255700     END-EVALUATE.                                                25570093
255800                                                                  25580093
255900 EJECT                                                            25590093
256000*----------------------------------------------------------------*25600093
256100*   RETIREVES THE VENDOR NAME FOR THE PO REQUESTED.              *25610093
256200*----------------------------------------------------------------*25620093
256300 4311-GET-VENDOR-NAME.                                            25630093
256400                                                                  25640093
256500     EXEC SQL                                                     25650093
256600         SELECT N.ENT_NAME_DESC                                   25660093
256700             INTO :ENTNME-ENT-NAME-DESC                           25670093
256800             FROM TEXTENT X                                       25680093
256900                 ,TENTNME N                                       25690093
257000         WHERE X.DUN_NBR          = :INVOIC-RMIT-VND-ID           25700093
257100           AND N.TYPE_CDE         = :PC-LONG-DESC-CODE            25710093
257200           AND X.ENT_ID           = N.ENT_ID                      25720093
257300     END-EXEC.                                                    25730093
257400                                                                  25740093
257500     EVALUATE TRUE                                                25750093
257600         WHEN SQLCODE = +0                                        25760093
257700             CONTINUE                                             25770093
257800                                                                  25780093
257900         WHEN SQLCODE = +100                                      25790093
258000             MOVE 'NOT FOUND'      TO ENTNME-ENT-NAME-DESC        25800093
258100                                                                  25810093
258200         WHEN SQLCODE = -904                                      25820093
258300         WHEN SQLCODE = -913                                      25830093
258400             MOVE '4311-GET-VENDOR-NAME'                          25840093
258500                                 TO DP013-PARAGRAPH               25850093
258600             MOVE 'SELECT VENDOR NAME'                            25860093
258700                                 TO DP013-MESSAGE-TEXT (1)        25870093
258800             MOVE 'TEXTENT'      TO DP013-DB2-TABLE-NAME (1)      25880093
258900             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (2)      25890093
259000             MOVE SQLCA          TO DP013-SQLCA                   25900093
259100             SET DP013-LINK-RETURN                                25910093
259200                 DP013-DB2-ABEND                                  25920093
259300                 DP013-ROLLBACK  TO TRUE                          25930093
259400             PERFORM DP013-0000-PROCESS-ABEND                     25940093
259500             MOVE 'TEXTENT TENTNME'      TO DP020-MSG-TEXT        25950093
259600             SET DP020-MSG-FATAL TO TRUE                          25960093
259700*            --- CONFLICT FOR DATABASE ---                        25970093
259800             MOVE PC-TSYMSG-00482                                 25980093
259900                                 TO DP020-MSG-NUMBER              25990093
260000             SET PS-ERROR-DB2    TO TRUE                          26000093
260100                                                                  26010093
260200         WHEN OTHER                                               26020093
260300             MOVE '4311-GET-VENDOR-NAME'                          26030093
260400                                 TO DP013-PARAGRAPH               26040093
260500             MOVE 'SELECT VENDOR NAME'                            26050093
260600                                 TO DP013-MESSAGE-TEXT (1)        26060093
260700             MOVE 'TEXTENT'      TO DP013-DB2-TABLE-NAME (1)      26070093
260800             MOVE 'TENTNME'      TO DP013-DB2-TABLE-NAME (2)      26080093
260900             MOVE SQLCA          TO DP013-SQLCA                   26090093
261000             SET DP013-DB2-ABEND                                  26100093
261100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               26110093
261200             PERFORM DP013-0000-PROCESS-ABEND                     26120093
261300                                                                  26130093
261400     END-EVALUATE.                                                26140093
261500                                                                  26150093
261600 EJECT                                                            26160093
261700*----------------------------------------------------------------*26170093
261800* CALCULATE THE NET INVOICE AMOUNT.  THE CALCULATION IS AS       *26180093
261900* FOLLOWS:  NET INVC AMT = (INVC MDSE TOTAL +                    *26190093
262000*                           CHARGE AMOUNT -                      *26200093
262100*                           DISCOUNT AMOUNT)                     *26210093
262200* INVC MDSE TOTAL IS THE GRO-COST-AMT.  FOR THE REST OF THE CALC,*26220093
262300* A CURSOR WILL BE USED TO OBTAIN THE CHARGE AND DISCOUNT AMOUNTS*26230093
262400*----------------------------------------------------------------*26240093
262500                                                                  26250093
262600 4330-CALC-INVOICE-AMT.                                           26260093
262700                                                                  26270093
262800     MOVE INVOIC-GRO-COST-AMT      TO PV-NET-INVC-AMT.            26280093
262900     SET PS-NOT-END-OF-CALC-CSR    TO TRUE.                       26290093
263000     PERFORM 4332-OPEN-CALC-CSR.                                  26300093
263100                                                                  26310093
263200     PERFORM UNTIL PS-END-OF-CALC-CSR                             26320093
263300                OR PS-ERROR-DB2                                   26330093
263400         PERFORM 4336-FETCH-CALC-CSR                              26340093
263500         IF ALCHRG-ALW-CHRG-TYP-CDE = PC-TYP-CDE-CHARGE           26350093
263600             ADD PV-SUM-AL-CHRG  TO PV-NET-INVC-AMT               26360093
263700         ELSE                                                     26370093
263800             SUBTRACT PV-SUM-AL-CHRG FROM PV-NET-INVC-AMT         26380093
263900         END-IF                                                   26390093
264000     END-PERFORM.                                                 26400093
264100     MOVE PV-NET-INVC-AMT TO ASC-INVC-AMT                         26410093
264200                                   (ASC-BLK-SUB ASC-ITEM-SUB).    26420093
264300                                                                  26430093
264400     IF PS-NO-ERROR-DB2                                           26440093
264500         PERFORM 4334-CLOSE-CALC-CSR                              26450093
264600     END-IF.                                                      26460093
264700                                                                  26470093
264800*----------------------------------------------------------------*26480093
264900* OPEN THE CALC CURSOR.                                          *26490093
265000*----------------------------------------------------------------*26500093
265100                                                                  26510093
265200 4332-OPEN-CALC-CSR.                                              26520093
265300                                                                  26530093
265400     EXEC SQL                                                     26540093
265500          OPEN CALC-CSR                                           26550093
265600     END-EXEC.                                                    26560093
265700                                                                  26570093
265800     EVALUATE TRUE                                                26580093
265900         WHEN SQLCODE = ZERO                                      26590093
266000              CONTINUE                                            26600093
266100                                                                  26610093
266200         WHEN SQLCODE = -904                                      26620093
266300         WHEN SQLCODE = -913                                      26630093
266400             MOVE '4332-OPEN-CALC-CSR'                            26640093
266500                                 TO DP013-PARAGRAPH               26650093
266600             MOVE 'OPEN CURSOR TO CALC NET AMT'                   26660093
266700                                 TO DP013-MESSAGE-TEXT (1)        26670093
266800             MOVE 'TALCHRG'      TO DP013-DB2-TABLE-NAME (1)      26680093
266900             MOVE SQLCA          TO DP013-SQLCA                   26690093
267000             SET DP013-LINK-RETURN                                26700093
267100                 DP013-DB2-ABEND                                  26710093
267200                 DP013-ROLLBACK  TO TRUE                          26720093
267300             PERFORM DP013-0000-PROCESS-ABEND                     26730093
267400             MOVE 'TALCHRG'      TO DP020-MSG-TEXT                26740093
267500             SET DP020-MSG-FATAL TO TRUE                          26750093
267600*            --- CONFLICT FOR DATABASE ---                        26760093
267700             MOVE PC-TSYMSG-00482                                 26770093
267800                                 TO DP020-MSG-NUMBER              26780093
267900             SET PS-ERROR-DB2    TO TRUE                          26790093
268000                                                                  26800093
268100         WHEN OTHER                                               26810093
268200             MOVE '4332-OPEN-CALC-CSR'                            26820093
268300                                 TO DP013-PARAGRAPH               26830093
268400             MOVE 'OPEN CURSOR TO CALC NET AMT'                   26840093
268500                                 TO DP013-MESSAGE-TEXT (1)        26850093
268600             MOVE 'TALCHRG'      TO DP013-DB2-TABLE-NAME (1)      26860093
268700             MOVE SQLCA          TO DP013-SQLCA                   26870093
268800             SET DP013-DB2-ABEND                                  26880093
268900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               26890093
269000             PERFORM DP013-0000-PROCESS-ABEND                     26900093
269100     END-EVALUATE.                                                26910093
269200                                                                  26920093
269300*----------------------------------------------------------------*26930093
269400* CLOSE THE CALC CURSOR.                                         *26940093
269500*----------------------------------------------------------------*26950093
269600                                                                  26960093
269700 4334-CLOSE-CALC-CSR.                                             26970093
269800                                                                  26980093
269900     EXEC SQL                                                     26990093
270000          CLOSE CALC-CSR                                          27000093
270100     END-EXEC.                                                    27010093
270200                                                                  27020093
270300     EVALUATE TRUE                                                27030093
270400         WHEN SQLCODE = ZERO                                      27040093
270500         WHEN SQLCODE = -904                                      27050093
270600         WHEN SQLCODE = -913                                      27060093
270700              CONTINUE                                            27070093
270800                                                                  27080093
270900         WHEN OTHER                                               27090093
271000             MOVE '4334-CLOSE-CALC-CSR'                           27100093
271100                                 TO DP013-PARAGRAPH               27110093
271200             MOVE 'CLOSE CURSOR TO CALC NET AMT'                  27120093
271300                                 TO DP013-MESSAGE-TEXT (1)        27130093
271400             MOVE 'TALCHRG'      TO DP013-DB2-TABLE-NAME (1)      27140093
271500             MOVE SQLCA          TO DP013-SQLCA                   27150093
271600             SET DP013-DB2-ABEND                                  27160093
271700                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27170093
271800             PERFORM DP013-0000-PROCESS-ABEND                     27180093
271900     END-EVALUATE.                                                27190093
272000                                                                  27200093
272100*----------------------------------------------------------------*27210093
272200* FETCH THE CALC CURSOR.                                         *27220093
272300*----------------------------------------------------------------*27230093
272400                                                                  27240093
272500 4336-FETCH-CALC-CSR.                                             27250093
272600                                                                  27260093
272700     EXEC SQL                                                     27270093
272800          FETCH CALC-CSR                                          27280093
272900          INTO  :ALCHRG-ALW-CHRG-TYP-CDE                          27290093
273000              , :ALCHRG-ALW-CHRG-PCT                              27300093
273100              , :ALCHRG-ALW-CHRG-AMT                              27310093
273200     END-EXEC                                                     27320093
273300                                                                  27330093
273400     EVALUATE TRUE                                                27340093
273500         WHEN SQLCODE = ZERO                                      27350093
273600              COMPUTE PV-SUM-AL-CHRG ROUNDED                      27360093
273700                  = (ALCHRG-ALW-CHRG-PCT * INVOIC-GRO-COST-AMT)   27370093
273800                  + ALCHRG-ALW-CHRG-AMT                           27380093
273900                                                                  27390093
274000         WHEN SQLCODE = +100                                      27400093
274100             MOVE ZERO              TO PV-SUM-AL-CHRG             27410093
274200             MOVE PC-TYP-CDE-CHARGE TO ALCHRG-ALW-CHRG-TYP-CDE    27420093
274300             SET PS-END-OF-CALC-CSR TO TRUE                       27430093
274400                                                                  27440093
274500         WHEN SQLCODE = -904                                      27450093
274600         WHEN SQLCODE = -913                                      27460093
274700             MOVE '4336-FETCH-CALC-CSR'                           27470093
274800                                 TO DP013-PARAGRAPH               27480093
274900             MOVE 'FETCH NET AMT CALC CURSOR'                     27490093
275000                                 TO DP013-MESSAGE-TEXT (1)        27500093
275100             MOVE 'TALCHRG'      TO DP013-DB2-TABLE-NAME (1)      27510093
275200             MOVE SQLCA          TO DP013-SQLCA                   27520093
275300             SET DP013-LINK-RETURN                                27530093
275400                 DP013-DB2-ABEND                                  27540093
275500                 DP013-ROLLBACK  TO TRUE                          27550093
275600             PERFORM DP013-0000-PROCESS-ABEND                     27560093
275700             MOVE 'TALCHRG'      TO DP020-MSG-TEXT                27570093
275800             SET DP020-MSG-FATAL TO TRUE                          27580093
275900*            --- CONFLICT FOR DATABASE ---                        27590093
276000             MOVE PC-TSYMSG-00482                                 27600093
276100                                 TO DP020-MSG-NUMBER              27610093
276200             SET PS-ERROR-DB2    TO TRUE                          27620093
276300                                                                  27630093
276400         WHEN OTHER                                               27640093
276500             MOVE '4336-FETCH-CALC-CSR'                           27650093
276600                                 TO DP013-PARAGRAPH               27660093
276700             MOVE 'FETCH NET AMT CALC CURSOR'                     27670093
276800                                 TO DP013-MESSAGE-TEXT (1)        27680093
276900             MOVE 'TALCHRG'      TO DP013-DB2-TABLE-NAME (1)      27690093
277000             MOVE SQLCA          TO DP013-SQLCA                   27700093
277100             SET DP013-DB2-ABEND                                  27710093
277200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               27720093
277300             PERFORM DP013-0000-PROCESS-ABEND                     27730093
277400     END-EVALUATE.                                                27740093
277500                                                                  27750093
277600*----------------------------------------------------------------*27760093
277700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *27770093
277800*----------------------------------------------------------------*27780093
277900                                                                  27790093
278000 4400-MOVE-COMMAREA-TO-SCREEN.                                    27800093
278100                                                                  27810093
278200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             27820093
278300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          27830093
278400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          27840093
278500             MOVE +1    TO ASC-BLK-SUB                            27850093
278600             PERFORM 5100-WRITE-TEMP-STORAGE                      27860093
278700             ADD +1     TO ASC-BLK-SUB                            27870093
278800             PERFORM 5100-WRITE-TEMP-STORAGE                      27880093
278900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             27890093
279000                 GIVING PV-BLOCK-NUMBER                           27900093
279100                 REMAINDER PV-REMAINDER                           27910093
279200             IF  PV-REMAINDER > ZERO                              27920093
279300                 ADD +1 TO PV-BLOCK-NUMBER                        27930093
279400             END-IF                                               27940093
279500             MOVE +1    TO ASC-BLK-SUB                            27950093
279600             PERFORM 4410-READ-TEMP-STORAGE                       27960093
279700             ADD +1     TO ASC-BLK-SUB                            27970093
279800                           PV-BLOCK-NUMBER                        27980093
279900             PERFORM 4410-READ-TEMP-STORAGE                       27990093
280000     END-IF.                                                      28000093
280100     MOVE +1            TO ASC-BLK-SUB.                           28010093
280200     COMPUTE ASC-ITEM-SUB =                                       28020093
280300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              28030093
280400         + PC-ITEMS-PER-PANEL).                                   28040093
280500                                                                  28050093
280600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        28060093
280700         ADD +1         TO ASC-BLK-SUB                            28070093
280800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            28080093
280900     END-IF.                                                      28090093
281000                                                                  28100093
281100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           28110093
281200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                28120093
281300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        28130093
281400     PERFORM 4420-FORMAT-LIST-LINES                               28140093
281500         VARYING PV-SUB                                           28150093
281600         FROM PC-ITEMS-PER-PANEL BY -1                            28160093
281700         UNTIL PV-SUB < +1.                                       28170093
281800                                                                  28180093
281900     COMPUTE ASC-ITEMS-DISPLAYED =                                28190093
282000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          28200093
282100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    28210093
282200                                      ASTRTITO.                   28220093
282300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    28230093
282400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    28240093
282500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            28250093
282600                                   TO ASELITO.                    28260093
282700                                                                  28270093
282800     IF  DP020-MSG-NUMBER-X = SPACE                               28280093
282900         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  28290093
283000*            --- MORE ITEMS TO DISPLAY ----                       28300093
283100             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            28310093
283200             SET DP020-MSG-INFORMATIONAL TO TRUE                  28320093
283300         END-IF                                                   28330093
283400     END-IF.                                                      28340093
283500                                                                  28350093
283600*----------------------------------------------------------------*28360093
283700*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *28370093
283800*----------------------------------------------------------------*28380093
283900                                                                  28390093
284000 4410-READ-TEMP-STORAGE.                                          28400093
284100                                                                  28410093
284200     EXEC CICS                                                    28420093
284300         READQ TS                                                 28430093
284400             QUEUE (ASC-LIST-QUEUE-NAME)                          28440093
284500             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28450093
284600             ITEM  (PV-BLOCK-NUMBER)                              28460093
284700             RESP  (PV-CICS-RESP)                                 28470093
284800     END-EXEC.                                                    28480093
284900                                                                  28490093
285000     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       28500093
285100       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     28510093
285200         CONTINUE                                                 28520093
285300     ELSE                                                         28530093
285400         SET DP013-CICS-ABEND     TO TRUE                         28540093
285500         SET DP013-NO-ROLLBACK    TO TRUE                         28550093
285600         MOVE '4410-READ-TEMP-STORAGE'                            28560093
285700                                  TO DP013-PARAGRAPH              28570093
285800         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      28580093
285900                                  TO DP013-MESSAGE-TEXT(1)        28590093
286000         PERFORM DP013-0000-PROCESS-ABEND                         28600093
286100     END-IF.                                                      28610093
286200                                                                  28620093
286300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             28630093
286400                                                                  28640093
286500     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         28650093
286600         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               28660093
286700     END-IF.                                                      28670093
286800 EJECT                                                            28680093
286900                                                                  28690093
287000*----------------------------------------------------------------*28700093
287100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *28710093
287200*----------------------------------------------------------------*28720093
287300                                                                  28730093
287400 4420-FORMAT-LIST-LINES.                                          28740093
287500                                                                  28750093
287600     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      28760093
287700         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                28770093
287800         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA      (PV-SUB)      28780093
287900         MOVE SPACE              TO MR-SELECTI      (PV-SUB)      28790093
288000                                    MR-ACTION       (PV-SUB)      28800093
288100                                    MR-INVC-NBR     (PV-SUB)      28810093
288200                                    MR-INVC-DTE     (PV-SUB)      28820093
288300                                    MR-PO-NBR-X     (PV-SUB)      28830093
288400                                    MR-VENDOR       (PV-SUB)      28840093
288500                                    MR-STR-NBR-X    (PV-SUB)      28850093
288600                                    MR-DC-NBR-X     (PV-SUB)      28860093
288700                                    MR-MTCH-LVL-CDE (PV-SUB)      28870093
288800                                    MR-INVC-TYPE    (PV-SUB)      28880093
288900                                    MR-STATUS       (PV-SUB)      28890093
289000                                    MR-INVC-AMT-X   (PV-SUB)      28900093
289100                                    MR-ENTR-DTE     (PV-SUB)      28910093
289200     ELSE                                                         28920093
289300         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      28930093
289400                                                   > SPACE        28940093
289500             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 28950093
289600                                 TO MR-SELECTI (PV-SUB)           28960093
289700         ELSE                                                     28970093
289800             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      28980093
289900                                 TO MR-SELECTI (PV-SUB)           28990093
290000         END-IF                                                   29000093
290100                                                                  29010093
290200         IF  DP030-SET-CURSOR-TRAILER                             29020093
290300             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)29030093
290400                 > SPACE)                                         29040093
290500               OR (PV-SUB = 1))                                   29050093
290600                SET DP030-SET-CURSOR-APPL-1 TO TRUE               29060093
290700                MOVE -1          TO MR-SELECTL (PV-SUB)           29070093
290800             END-IF                                               29080093
290900         END-IF                                                   29090093
291000                                                                  29100093
291100         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           29110093
291200             MOVE ASC-ACTION        (ASC-BLK-SUB ASC-ITEM-SUB)    29120093
291300                                 TO MR-ACTION         (PV-SUB)    29130093
291400             MOVE ASC-INVC-NBR      (ASC-BLK-SUB ASC-ITEM-SUB)    29140093
291500                                 TO MR-INVC-NBR       (PV-SUB)    29150093
291600             MOVE ASC-INVC-DTE      (ASC-BLK-SUB ASC-ITEM-SUB)    29160093
291700                                 TO PV-DATE-FORMAT-DB2            29170093
291800             MOVE PV-DATE-DB2-MM TO PV-DATE-MM                    29180093
291900             MOVE PV-DATE-DB2-DD TO PV-DATE-DD                    29190093
292000             MOVE PV-DATE-DB2-YY TO PV-DATE-YY                    29200093
292100             MOVE PV-DATE-FORMAT TO MR-INVC-DTE       (PV-SUB)    29210093
292200             MOVE ASC-PO-NBR        (ASC-BLK-SUB ASC-ITEM-SUB)    29220093
292300                                 TO MR-PO-NBR-N       (PV-SUB)    29230093
292400             MOVE ASC-VENDOR        (ASC-BLK-SUB ASC-ITEM-SUB)    29240093
292500                                 TO MR-VENDOR         (PV-SUB)    29250093
292600             MOVE ASC-STR-NBR       (ASC-BLK-SUB ASC-ITEM-SUB)    29260093
292700                                 TO PV-STR-NBR                    29270093
292800             MOVE PV-STR-NBR     TO MR-STR-NBR-N      (PV-SUB)    29280093
292900             MOVE ASC-DC-NBR        (ASC-BLK-SUB ASC-ITEM-SUB)    29290093
293000                                 TO PV-DC-NBR                     29300093
293100             MOVE PV-DC-NBR      TO MR-DC-NBR-N       (PV-SUB)    29310093
293200             MOVE ASC-MTCH-LVL-CDE  (ASC-BLK-SUB ASC-ITEM-SUB)    29320093
293300                                 TO MR-MTCH-LVL-CDE   (PV-SUB)    29330093
293400             MOVE ASC-INVC-TYPE     (ASC-BLK-SUB ASC-ITEM-SUB)    29340093
293500                                 TO MR-INVC-TYPE      (PV-SUB)    29350093
293600             MOVE ASC-STATUS        (ASC-BLK-SUB ASC-ITEM-SUB)    29360093
293700                                 TO MR-STATUS         (PV-SUB)    29370093
293800             MOVE ASC-INVC-AMT      (ASC-BLK-SUB ASC-ITEM-SUB)    29380093
293900                                 TO MR-INVC-AMT-N     (PV-SUB)    29390093
294000             MOVE ASC-CRE-DTE       (ASC-BLK-SUB ASC-ITEM-SUB)    29400093
294100                                 TO PV-DATE-FORMAT-DB2            29410093
294200             MOVE PV-DATE-DB2-MM TO PV-DATE-MM                    29420093
294300             MOVE PV-DATE-DB2-DD TO PV-DATE-DD                    29430093
294400             MOVE PV-DATE-DB2-YY TO PV-DATE-YY                    29440093
294500             MOVE PV-DATE-FORMAT TO MR-ENTR-DTE       (PV-SUB)    29450093
294600         END-IF                                                   29460093
294700     END-IF.                                                      29470093
294800     SUBTRACT +1 FROM ASC-ITEM-SUB                                29480093
294900     IF  ASC-ITEM-SUB < + 1                                       29490093
295000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  29500093
295100         MOVE +1                 TO ASC-BLK-SUB                   29510093
295200     END-IF.                                                      29520093
295300                                                                  29530093
295400*----------------------------------------------------------------*29540093
295500*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *29550093
295600*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *29560093
295700*  ISSUE A WARNING.                                              *29570093
295800*----------------------------------------------------------------*29580093
295900                                                                  29590093
296000 4430-CHECK-FOR-BEGIN-AND-END.                                    29600093
296100                                                                  29610093
296200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       29620093
296300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     29630093
296400*            -- NO END-OF-RANGE SPECFIED ---                      29640093
296500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            29650093
296600             SET DP020-MSG-WARNING TO TRUE                        29660093
296700             PERFORM 4431-POSITION-AT-WARNING                     29670093
296800         END-IF                                                   29680093
296900     ELSE                                                         29690093
297000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     29700093
297100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                29710093
297200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            29720093
297300             SET DP020-MSG-WARNING TO TRUE                        29730093
297400             PERFORM 4431-POSITION-AT-WARNING                     29740093
297500         END-IF                                                   29750093
297600     END-IF.                                                      29760093
297700                                                                  29770093
297800*----------------------------------------------------------------*29780093
297900*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *29790093
298000*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *29800093
298100*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *29810093
298200*  POSITION THE CURSOR THERE.                                    *29820093
298300*----------------------------------------------------------------*29830093
298400                                                                  29840093
298500 4431-POSITION-AT-WARNING.                                        29850093
298600                                                                  29860093
298700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 29870093
298800                    - PV-TOP-ITEM + 1.                            29880093
298900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      29890093
299000         CONTINUE                                                 29900093
299100     ELSE                                                         29910093
299200         SET DP030-SET-CURSOR-APPL-1                              29920093
299300                                   TO TRUE                        29930093
299400         MOVE -1                   TO MR-SELECTL (PV-SUB)         29940093
299500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         29950093
299600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         29960093
299700     END-IF.                                                      29970093
299800                                                                  29980093
299900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   29990093
300000                    - PV-TOP-ITEM + 1.                            30000093
300100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30010093
300200         CONTINUE                                                 30020093
300300     ELSE                                                         30030093
300400         SET DP030-SET-CURSOR-APPL-1                              30040093
300500                                   TO TRUE                        30050093
300600         MOVE -1                   TO MR-SELECTL (PV-SUB)         30060093
300700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30070093
300800         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30080093
300900     END-IF.                                                      30090093
301000 EJECT                                                            30100093
301100                                                                  30110093
301200*----------------------------------------------------------------*30120093
301300* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *30130093
301400* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *30140093
301500* FOR THE SELECTED ITEMS QUEUE.                                  *30150093
301600*                                                                *30160093
301700* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *30170093
301800* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *30180093
301900* THE ARRAY IS FULL.                                             *30190093
302000*----------------------------------------------------------------*30200093
302100                                                                  30210093
302200 5000-PREPARE-SEL-QUEUE.                                          30220093
302300                                                                  30230093
302400     MOVE +1                   TO  ASC-BLK-SUB.                   30240093
302500     PERFORM 5100-WRITE-TEMP-STORAGE.                             30250093
302600     ADD +1                    TO  ASC-BLK-SUB.                   30260093
302700     PERFORM 5100-WRITE-TEMP-STORAGE.                             30270093
302800                                                                  30280093
302900     MOVE ASC-SEL-QUEUE-NAME   TO  AP300-SEL-QUEUE-NAME.          30290093
303000     PERFORM 6010-DELETE-SEL-QUEUE.                               30300093
303100                                                                  30310093
303200     SET ASC-UPDATE-TSQ        TO  TRUE.                          30320093
303300                                                                  30330093
303400     SET AP301-IDX             TO  1.                             30340093
303500     MOVE ZERO                 TO AP300-NUMBER-OF-TS-ITEMS.       30350093
303600     INITIALIZE AP301-SELECTED-ITEM-ARRAY.                        30360093
303700                                                                  30370093
303800     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           30380093
303900             VARYING PV-ITEM                                      30390093
304000             FROM 1 BY 1                                          30400093
304100             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     30410093
304200                                                                  30420093
304300     IF  AP301-IDX > 1                                            30430093
304400         PERFORM 5205-WRITE-SEL-QUEUE                             30440093
304500         ADD +1                TO AP300-NUMBER-OF-TS-ITEMS        30450093
304600     END-IF.                                                      30460093
304700 EJECT                                                            30470093
304800                                                                  30480093
304900*----------------------------------------------------------------*30490093
305000*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *30500093
305100*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *30510093
305200*----------------------------------------------------------------*30520093
305300                                                                  30530093
305400 5100-WRITE-TEMP-STORAGE.                                         30540093
305500                                                                  30550093
305600     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     30560093
305700                                   TO PV-LIST-ITEM-NUMBER.        30570093
305800     COMPUTE PV-BLOCK-NUMBER =                                    30580093
305900         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    30590093
306000                                                                  30600093
306100     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             30610093
306200     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             30620093
306300         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      30630093
306400             PERFORM 5105-REWRITE-ASC-LISTQ                       30640093
306500         END-IF                                                   30650093
306600     ELSE                                                         30660093
306700         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       30670093
306800         ASC-HIGHEST-BLOCK-WRITTEN + 1                            30680093
306900         PERFORM 5110-WRITE-ASC-LISTQ                             30690093
307000         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   30700093
307100     END-IF.                                                      30710093
307200                                                                  30720093
307300     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             30730093
307400                                                                  30740093
307500*----------------------------------------------------------------*30750093
307600*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *30760093
307700*  SPECIFIC COMMAREA.                                            *30770093
307800*----------------------------------------------------------------*30780093
307900                                                                  30790093
308000 5105-REWRITE-ASC-LISTQ.                                          30800093
308100                                                                  30810093
308200     EXEC CICS                                                    30820093
308300         WRITEQ TS                                                30830093
308400             QUEUE (ASC-LIST-QUEUE-NAME)                          30840093
308500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               30850093
308600             ITEM  (PV-BLOCK-NUMBER)                              30860093
308700             REWRITE                                              30870093
308800             RESP  (PV-CICS-RESP)                                 30880093
308900     END-EXEC.                                                    30890093
309000                                                                  30900093
309100     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           30910093
309200         CONTINUE                                                 30920093
309300     ELSE                                                         30930093
309400         SET DP013-CICS-ABEND            TO TRUE                  30940093
309500         SET DP013-NO-ROLLBACK           TO TRUE                  30950093
309600         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       30960093
309700         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     30970093
309800                                         TO DP013-MESSAGE-TEXT(1) 30980093
309900         PERFORM DP013-0000-PROCESS-ABEND                         30990093
310000     END-IF.                                                      31000093
310100                                                                  31010093
310200*----------------------------------------------------------------*31020093
310300*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *31030093
310400*  SPECIFIC COMMAREA.                                            *31040093
310500*----------------------------------------------------------------*31050093
310600                                                                  31060093
310700 5110-WRITE-ASC-LISTQ.                                            31070093
310800                                                                  31080093
310900     EXEC CICS                                                    31090093
311000         WRITEQ TS                                                31100093
311100             QUEUE (ASC-LIST-QUEUE-NAME)                          31110093
311200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31120093
311300             ITEM  (PV-BLOCK-NUMBER)                              31130093
311400             RESP  (PV-CICS-RESP)                                 31140093
311500     END-EXEC.                                                    31150093
311600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      31160093
311700         SET DP013-CICS-ABEND      TO TRUE                        31170093
311800         SET DP013-NO-ROLLBACK     TO TRUE                        31180093
311900         MOVE '5110-WRITE-ASC-LISTQ'                              31190093
312000                                   TO DP013-PARAGRAPH             31200093
312100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           31210093
312200                                   TO DP013-MESSAGE-TEXT(1)       31220093
312300         PERFORM DP013-0000-PROCESS-ABEND                         31230093
312400     END-IF.                                                      31240093
312500 EJECT                                                            31250093
312600                                                                  31260093
312700*----------------------------------------------------------------*31270093
312800* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *31280093
312900* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *31290093
313000*----------------------------------------------------------------*31300093
313100                                                                  31310093
313200 5200-FILL-SEL-QUEUE-RECORD.                                      31320093
313300                                                                  31330093
313400     PERFORM 6112-READ-LIST-QUEUE.                                31340093
313500                                                                  31350093
313600     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       31360093
313700         PERFORM                                                  31370093
313800         VARYING LQW-IDX                                          31380093
313900         FROM 1 BY 1                                              31390093
314000         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            31400093
314100           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          31410093
314200                                                                  31420093
314300             IF  LQW-SELECT (LQW-IDX)                             31430093
314400                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              31440093
314500                                   TO AP301-ITEM      (AP301-IDX) 31450093
314600                 MOVE LQW-PO-NBR           (LQW-IDX)              31460093
314700                                   TO AP301-PO-NBR    (AP301-IDX) 31470093
314800                                      ASC-KEY-PO-NBR              31480093
314900                 MOVE LQW-INVC-NBR         (LQW-IDX)              31490093
315000                                   TO AP301-INVC-ID   (AP301-IDX) 31500093
315100                                      ASC-KEY-INVC-NBR            31510093
315200                 MOVE LQW-STR-NBR          (LQW-IDX)              31520093
315300                                   TO AP301-STORE-NBR (AP301-IDX) 31530093
315400                                      ASC-KEY-STR-NBR             31540093
315500                 MOVE SPACE        TO AP301-ACTION-SW (AP301-IDX) 31550093
315600                 SET AP301-IDX UP BY 1                            31560093
315700                 IF  AP301-IDX > AP301-MAX-ITEMS                  31570093
315800                     PERFORM 5205-WRITE-SEL-QUEUE                 31580093
315900                     ADD +1        TO AP300-NUMBER-OF-TS-ITEMS    31590093
316000                     INITIALIZE AP301-SELECTED-ITEM-ARRAY         31600093
316100                     SET AP301-IDX TO  1                          31610093
316200                 END-IF                                           31620093
316300             END-IF                                               31630093
316400         END-PERFORM                                              31640093
316500     END-IF.                                                      31650093
316600                                                                  31660093
316700*----------------------------------------------------------------*31670093
316800*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *31680093
316900*----------------------------------------------------------------*31690093
317000                                                                  31700093
317100 5205-WRITE-SEL-QUEUE.                                            31710093
317200                                                                  31720093
317300     EXEC CICS                                                    31730093
317400          WRITEQ TS                                               31740093
317500              QUEUE (ASC-SEL-QUEUE-NAME)                          31750093
317600              FROM  (AP301-INVC-LIST-TS-RCRD)                     31760093
317700              ITEM  (PV-SEL-QUEUE-ITEM)                           31770093
317800              RESP  (PV-CICS-RESP)                                31780093
317900     END-EXEC.                                                    31790093
318000                                                                  31800093
318100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31810093
318200         CONTINUE                                                 31820093
318300     ELSE                                                         31830093
318400         SET DP013-CICS-ABEND      TO TRUE                        31840093
318500         SET DP013-NO-ROLLBACK     TO TRUE                        31850093
318600         MOVE '5205-WRITE-SEL-QUEUE'                              31860093
318700                                   TO DP013-PARAGRAPH             31870093
318800         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          31880093
318900                                   TO DP013-MESSAGE-TEXT(1)       31890093
319000         PERFORM DP013-0000-PROCESS-ABEND                         31900093
319100     END-IF.                                                      31910093
319200 EJECT                                                            31920093
319300                                                                  31930093
319400*----------------------------------------------------------------*31940093
319500*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *31950093
319600*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *31960093
319700*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *31970093
319800*  THE USER.                                                     *31980093
319900*----------------------------------------------------------------*31990093
320000                                                                  32000093
320100 6000-REFRESH-PANEL-FROM-TEMP.                                    32010093
320200                                                                  32020093
320300     IF  ASC-UPDATE-TSQ AND                                       32030093
320400         ASC-NUMBER-OF-SELECTED-ITEMS > 0                         32040093
320500         SET ASC-NO-TSQ-UPDATE TO TRUE                            32050093
320600         MOVE ZERO                 TO PV-SAVE-ITEM                32060093
320700                                      PV-SEL-QUEUE-ITEM           32070093
320800         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        32080093
320900                                   TO PV-HOLD-SELECTED-ITEMS      32090093
321000         PERFORM 6100-UPDATE-TSQ                                  32100093
321100             UNTIL PV-ITEMS-PROCESSED >                           32110093
321200                                     PV-HOLD-SELECTED-ITEMS       32120093
321300         PERFORM 6010-DELETE-SEL-QUEUE                            32130093
321400         INITIALIZE ASC-BLOCK-ENTRIES (1)                         32140093
321500                    ASC-BLOCK-ENTRIES (2)                         32150093
321600     END-IF.                                                      32160093
321700                                                                  32170093
321800*----------------------------------------------------------------*32180093
321900*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *32190093
322000*----------------------------------------------------------------*32200093
322100                                                                  32210093
322200 6010-DELETE-SEL-QUEUE.                                           32220093
322300                                                                  32230093
322400     EXEC CICS                                                    32240093
322500         DELETEQ TS                                               32250093
322600             QUEUE (ASC-SEL-QUEUE-NAME)                           32260093
322700             RESP  (PV-CICS-RESP)                                 32270093
322800     END-EXEC.                                                    32280093
322900                                                                  32290093
323000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      32300093
323100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         32310093
323200         CONTINUE                                                 32320093
323300     ELSE                                                         32330093
323400         SET DP013-CICS-ABEND TO TRUE                             32340093
323500         SET DP013-NO-ROLLBACK TO TRUE                            32350093
323600         MOVE '6010-DELETE-SEL-QUEUE'                             32360093
323700                        TO DP013-PARAGRAPH                        32370093
323800         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         32380093
323900                        TO DP013-MESSAGE-TEXT (1)                 32390093
324000         PERFORM DP013-0000-PROCESS-ABEND                         32400093
324100     END-IF.                                                      32410093
324200                                                                  32420093
324300*----------------------------------------------------------------*32430093
324400*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *32440093
324500*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *32450093
324600*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *32460093
324700*    THE TEMP QUEUE.                                             *32470093
324800*----------------------------------------------------------------*32480093
324900                                                                  32490093
325000 6100-UPDATE-TSQ.                                                 32500093
325100                                                                  32510093
325200     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             32520093
325300     PERFORM 6105-READ-SEL-QUEUE.                                 32530093
325400     PERFORM                                                      32540093
325500         VARYING AP301-IDX                                        32550093
325600         FROM 1 BY 1                                              32560093
325700         UNTIL ((PV-ITEMS-PROCESSED >                             32570093
325800                              PV-HOLD-SELECTED-ITEMS)             32580093
325900         OR (AP301-IDX GREATER THAN AP301-MAX-ITEMS))             32590093
326000         IF  AP301-ACTION-SW (AP301-IDX) > SPACE                  32600093
326100             PERFORM 6110-PROCESS-ITEMS                           32610093
326200         END-IF                                                   32620093
326300         ADD +1                TO PV-ITEMS-PROCESSED              32630093
326400     END-PERFORM.                                                 32640093
326500     PERFORM 6111-WRITE-LIST-QUEUE.                               32650093
326600                                                                  32660093
326700*----------------------------------------------------------------*32670093
326800*    READ THE LIST QUEUE RECORD.                                 *32680093
326900*----------------------------------------------------------------*32690093
327000                                                                  32700093
327100 6105-READ-SEL-QUEUE.                                             32710093
327200                                                                  32720093
327300     EXEC CICS                                                    32730093
327400          READQ TS                                                32740093
327500              QUEUE (ASC-SEL-QUEUE-NAME)                          32750093
327600              INTO  (AP301-INVC-LIST-TS-RCRD)                     32760093
327700              ITEM  (PV-SEL-QUEUE-ITEM)                           32770093
327800              RESP  (PV-CICS-RESP)                                32780093
327900     END-EXEC.                                                    32790093
328000                                                                  32800093
328100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32810093
328200         CONTINUE                                                 32820093
328300     ELSE                                                         32830093
328400         SET DP013-CICS-ABEND      TO  TRUE                       32840093
328500         SET DP013-NO-ROLLBACK     TO  TRUE                       32850093
328600         MOVE '6105-READ-SEL-QUEUE'                               32860093
328700                                   TO  DP013-PARAGRAPH            32870093
328800         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           32880093
328900                                   TO  DP013-MESSAGE-TEXT(1)      32890093
329000         PERFORM DP013-0000-PROCESS-ABEND                         32900093
329100     END-IF.                                                      32910093
329200 EJECT                                                            32920093
329300                                                                  32930093
329400*----------------------------------------------------------------*32940093
329500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*32950093
329600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*32960093
329700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *32970093
329800*----------------------------------------------------------------*32980093
329900                                                                  32990093
330000 6110-PROCESS-ITEMS.                                              33000093
330100                                                                  33010093
330200     COMPUTE PV-ITEM = 1 + ((AP301-ITEM (AP301-IDX) - 1)          33020093
330300                     / PC-ITEMS-PER-PANEL).                       33030093
330400                                                                  33040093
330500     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           33050093
330600         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          33060093
330700             PERFORM 6111-WRITE-LIST-QUEUE                        33070093
330800         END-IF                                                   33080093
330900         MOVE PV-ITEM          TO PV-SAVE-ITEM                    33090093
331000                                                                  33100093
331100         PERFORM 6112-READ-LIST-QUEUE                             33110093
331200         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               33120093
331300             CONTINUE                                             33130093
331400         END-IF                                                   33140093
331500     END-IF.                                                      33150093
331600                                                                  33160093
331700     COMPUTE PV-SUB = (AP301-ITEM (AP301-IDX)                     33170093
331800                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              33180093
331900     SET LQW-DESELECT (PV-SUB) TO    TRUE                         33190093
332000     MOVE LQW-SELECTED-SW (PV-SUB)                                33200093
332100                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  33210093
332200                                                                  33220093
332300     EVALUATE TRUE                                                33230093
332400         WHEN AP301-INQ (AP301-IDX)                               33240093
332500              MOVE PC-INQ    TO LQW-ACTION (PV-SUB)               33250093
332600                                                                  33260093
332700         WHEN AP301-UPD (AP301-IDX)                               33270093
332800              MOVE PC-UPD    TO LQW-ACTION (PV-SUB)               33280093
332900                                                                  33290093
333000         WHEN AP301-DEL (AP301-IDX)                               33300093
333100              MOVE PC-DEL    TO LQW-ACTION (PV-SUB)               33310093
333200                                                                  33320093
333300         WHEN AP301-ERR (AP301-IDX)                               33330093
333400              MOVE PC-ERR    TO LQW-ACTION (PV-SUB)               33340093
333500     END-EVALUATE.                                                33350093
333600                                                                  33360093
333700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                33370093
333800                                                                  33380093
333900*----------------------------------------------------------------*33390093
334000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *33400093
334100*----------------------------------------------------------------*33410093
334200                                                                  33420093
334300 6111-WRITE-LIST-QUEUE.                                           33430093
334400                                                                  33440093
334500     EXEC CICS                                                    33450093
334600         WRITEQ TS                                                33460093
334700             QUEUE (ASC-LIST-QUEUE-NAME)                          33470093
334800             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     33480093
334900             ITEM  (PV-SAVE-ITEM)                                 33490093
335000             REWRITE                                              33500093
335100             RESP  (PV-CICS-RESP)                                 33510093
335200     END-EXEC.                                                    33520093
335300                                                                  33530093
335400     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33540093
335500         CONTINUE                                                 33550093
335600     ELSE                                                         33560093
335700         SET DP013-CICS-ABEND  TO  TRUE                           33570093
335800         SET DP013-NO-ROLLBACK TO  TRUE                           33580093
335900         MOVE '6111-WRITE-LIST-QUEUE'                             33590093
336000                               TO  DP013-PARAGRAPH                33600093
336100         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  33610093
336200                               TO  DP013-MESSAGE-TEXT(1)          33620093
336300         PERFORM DP013-0000-PROCESS-ABEND                         33630093
336400     END-IF.                                                      33640093
336500                                                                  33650093
336600 EJECT                                                            33660093
336700*----------------------------------------------------------------*33670093
336800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*33680093
336900*----------------------------------------------------------------*33690093
337000                                                                  33700093
337100 6112-READ-LIST-QUEUE.                                            33710093
337200                                                                  33720093
337300     EXEC CICS                                                    33730093
337400         READQ TS                                                 33740093
337500             QUEUE (ASC-LIST-QUEUE-NAME)                          33750093
337600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     33760093
337700             ITEM  (PV-ITEM)                                      33770093
337800             RESP  (PV-CICS-RESP)                                 33780093
337900     END-EXEC.                                                    33790093
338000                                                                  33800093
338100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33810093
338200         CONTINUE                                                 33820093
338300     ELSE                                                         33830093
338400         SET DP013-CICS-ABEND        TO TRUE                      33840093
338500         SET DP013-NO-ROLLBACK       TO TRUE                      33850093
338600         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           33860093
338700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    33870093
338800                                     TO DP013-MESSAGE-TEXT(1)     33880093
338900         PERFORM DP013-0000-PROCESS-ABEND                         33890093
339000     END-IF.                                                      33900093
339100                                                                  33910093
339200 EJECT                                                            33920093
339300*----------------------------------------------------------------*33930093
339400*    ABEND PROCESSOR MODULE                                      *33940093
339500*----------------------------------------------------------------*33950093
339600                                                                  33960093
339700     COPY DPPD013.                                                33970093
