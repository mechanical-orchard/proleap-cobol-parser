000100******************************************************************00010002
000200******************************************************************00020002
000300 IDENTIFICATION DIVISION.                                         00030002
000400******************************************************************00040002
000500******************************************************************00050002
000600                                                                  00060002
000700 PROGRAM-ID.     BPKUT445.                                        00070065
000800 AUTHOR.         COGNIZANT.                                       00080012
000900 INSTALLATION.   KOHLS DEPARTMENT STORES.                         00090002
001000 DATE-WRITTEN.   04/28/2010.                                      00100012
001100 DATE-COMPILED.                                                   00110002
001200                                                                  00120002
001300******************************************************************00130002
001400*                                                                 00140002
001500*               EP EOP/SHRINK EXTRACT PROGRAM                     00150012
001600*                                                                 00160002
001700******************************************************************00170002
001800                                                                  00180002
001900******************************************************************00190002
002000*  CHANGES:                                                       00200002
002100*                                                                 00210002
002200*  04/28/2010     SREELATHA PELLETI                               00220038
002300*     -  CHANGED THE PROGRAM FOR EP UPGRADE PROCESS.              00230038
002400*        CHANGED TO PICKUP EOP/BOP COST & RETAIL AMOUNTS FROM     00240038
002500*        CHANNEL. THIS IS FOR OTHINV_CC,CT,DC,DT & OTHINV STAGING 00250038
002600*        TABLES BASED ON THE OUTPUT LAYOUT BPRD150.               00260038
002700*                                                                 00270057
002800*  12/14/2011     COGNIZANT    CRQ# 16360                         00280057
002900*     -  MODIFY EXTRACT DATE LOGIC TO HAVE THE MONTH BEGIN DATE   00290057
003000*        AS START DATE AND LAST WEEKEND DATE AS END DATE.         00300057
BOPISS*                                                                 00301062
BOPISS*  04/28/2014     COGNIZANT    PRB0047059                         00302063
BOPISS*     -  MODIFIED THE CODE TO EXTRACT SINGLE RECORD WITH PROPER   00303062
BOPISS*        COST & DOLLAR FOR DEPT TOTAL & CLASS TOTAL INSTEAD OF    00304062
BOPISS*        3 RECORDS.                                               00305062
BOPISS*     -  MODIFIED CODE TO SEND PROPER COST AMT FOR CLASS CHANNEL  00306062
BOPISS*        INSTEAD OF SENDING 0 COST AMT.                           00306162
BOPISS*     -  ADDED CODE TO SEND EXTRACT RECORD FOR DEPT CHANNEL.      00307062
11752A*                                                                 00307165
11752A*  06/09/2017     J SELWITSCHKA                                   00308064
11752A*     -  CHANGES FOR EP UPGRADE.                                  00309064
11752A*        MODIFY EXTRACT DATE LOGIC TO HAVE THE WEEK BEGIN DATE    00309164
11752A*        AS START DATE INSTEAD OF THE MONTH BEGIN DATE.           00309264
11752A*                                                                 00309365
11752A*  06/22/2017     J SELWITSCHKA                                   00309465
11752A*     - NEW VERSION BPKUT445 IS A COPY OF BPKUT441 WITH EP        00309565
11752A*       UPGRADE CHANGES. CREATED BECAUSE EP UPGRADE VERSION       00309665
11752A*       WILL BE RUNNING IN PARALLEL WITH OLD VERSION.             00309765
11752A*                                                                 00309865
003100******************************************************************00310002
003200                                                                  00320002
003300******************************************************************00330002
003400******************************************************************00340002
003500 ENVIRONMENT DIVISION.                                            00350002
003600******************************************************************00360002
003700******************************************************************00370002
003800                                                                  00380002
003900******************************************************************00390002
004000 CONFIGURATION SECTION.                                           00400002
004100******************************************************************00410002
004200                                                                  00420002
004300 SOURCE-COMPUTER.        IBM-3090.                                00430002
004400 OBJECT-COMPUTER.        IBM-3090.                                00440002
004500                                                                  00450002
004600******************************************************************00460002
004700 INPUT-OUTPUT SECTION.                                            00470002
004800******************************************************************00480002
004900                                                                  00490002
005000 FILE-CONTROL.                                                    00500002
005100                                                                  00510002
005200     SELECT INV-BOP-FILE                                          00520041
005300         ASSIGN TO OUT01.                                         00530002
005400                                                                  00540002
005500     SELECT INV-EOP-FILE                                          00550041
005600         ASSIGN TO OUT02.                                         00560041
005700                                                                  00570041
005800******************************************************************00580002
005900******************************************************************00590002
006000 DATA DIVISION.                                                   00600002
006100******************************************************************00610002
006200******************************************************************00620002
006300                                                                  00630002
006400******************************************************************00640002
006500 FILE SECTION.                                                    00650002
006600******************************************************************00660002
006700                                                                  00670002
006800 FD  INV-BOP-FILE                                                 00680041
006900     RECORDING MODE IS F                                          00690002
007000     LABEL RECORDS ARE STANDARD                                   00700002
007100     BLOCK CONTAINS 0 RECORDS.                                    00710002
007200                                                                  00720002
007300 01  BP150-OUTPUT-BOP-RECORD          PIC X(700).                 00730041
007400                                                                  00740002
007500 FD  INV-EOP-FILE                                                 00750041
007600     RECORDING MODE IS F                                          00760041
007700     LABEL RECORDS ARE STANDARD                                   00770041
007800     BLOCK CONTAINS 0 RECORDS.                                    00780041
007900                                                                  00790041
008000 01  BP150-OUTPUT-EOP-RECORD          PIC X(700).                 00800041
008100                                                                  00810041
008200 EJECT                                                            00820002
008300******************************************************************00830002
008400 WORKING-STORAGE SECTION.                                         00840002
008500******************************************************************00850002
008600                                                                  00860002
008700 01  PS-PROGRAM-SWITCHES.                                         00870002
008800     05  PS-END-OF-EOP-CURSOR-SW      PIC X      VALUE 'N'.       00880002
008900         88  PS-END-OF-EOP-CLS-CSR               VALUE 'Y'.       00890002
009000     05  PS-END-OF-EOP-DPT-CURSOR-SW  PIC X      VALUE 'N'.       00900002
009100         88  PS-END-OF-EOP-DPT-CSR               VALUE 'Y'.       00910002
009200     05  PS-END-OF-BOP-CURSOR-SW      PIC X      VALUE 'N'.       00920002
009300         88  PS-END-OF-BOP-CLS-CSR               VALUE 'Y'.       00930002
009400     05  PS-END-OF-BOP-DPT-CURSOR-SW  PIC X      VALUE 'N'.       00940002
009500         88  PS-END-OF-BOP-DPT-CSR               VALUE 'Y'.       00950002
009600                                                                  00960002
009700 01  PC-PROGRAM-CONSTANTS.                                        00970002
009800     05  PC-1                         PIC 9(01)  VALUE 1.         00980002
009900     05  PC-PHYSSTR                   PIC X(07)  VALUE 'PHYSSTR'. 00990002
010000     05  PC-VIRTSTR                   PIC X(07)  VALUE 'VIRTSTR'. 01000002
010100     05  PC-PHYSSTR-IND               PIC X(01)  VALUE 'P'.       01010002
010200     05  PC-VIRTSTR-IND               PIC X(01)  VALUE 'V'.       01020002
010300     05  PC-TOTALCO                   PIC X(07)  VALUE 'TOTALCO'. 01030015
010400     05  PC-TOTALCO-IND               PIC X(01)  VALUE 'A'.       01040015
010500                                                                  01050015
010600                                                                  01060002
010700 01  PV-PROGRAM-VARIABLES.                                        01070002
11752A*    05  PV-EXTRACT-MN-BEG-DTE        PIC X(10) VALUE SPACE.      01080064
11752A     05  PV-EXTRACT-WK-BEG-DTE        PIC X(10) VALUE SPACE.      01081064
010900     05  PV-EXTRACT-START-DATE        PIC X(10) VALUE SPACE.      01090002
011000     05  PV-EOPDLR-EXTRACT-START-DATE PIC X(10) VALUE SPACE.      01100053
011100     05  PV-EXTRACT-END-DATE          PIC X(10) VALUE SPACE.      01110002
011200     05  PV-FSCL-WK-END-DTE           PIC X(10) VALUE SPACE.      01120002
011300     05  PV-EXTRACT-START-DATE-BOP    PIC X(10) VALUE SPACE.      01130002
011400     05  PV-EXTRACT-END-DATE-BOP      PIC X(10) VALUE SPACE.      01140002
011500     05  PV-CHANNEL                   PIC X(01) VALUE SPACE.      01150002
011600     05  PV-SEASON                    PIC X(01) VALUE SPACE.      01160002
011700     05  PV-YEAR-WEEK.                                            01170002
011800         10  PV-YEAR                  PIC X(04) VALUE SPACE.      01180002
011900         10  PV-WEEK-NBR              PIC X(02) VALUE SPACE.      01190002
012000     05  PV-WEEK-OF-PERIOD            PIC 9(02) VALUE 99.         01200002
012100     05  PV-WEEKS-IN-PERIOD           PIC 9(02) VALUE 1.          01210002
012200     05  PV-NEXT-PERIOD-SEASON        PIC X(01) VALUE SPACE.      01220002
012300         88  PV-BOP-NOT-NEEDED                  VALUE SPACE.      01230002
012400         88  PV-BOP-NEEDED                      VALUE 'F' 'S'.    01240002
012500     05  PV-NEXT-PERIOD-YEAR          PIC X(04) VALUE SPACE.      01250002
012600     05  PV-NEXT-PERIOD-FIRST-WEEK    PIC X(02) VALUE SPACE.      01260002
012700     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      01270002
012800     05  PV-DB2-OPER-ATTEMPTED        PIC X(30) VALUE SPACE.      01280002
012900     05  PV-ABEND-CODE                PIC S9(04) COMP VALUE ZERO. 01290002
013000         88  PV-DB2-ERROR                             VALUE +4013.01300002
013100         88  PV-CALENDAR-ROUTINE-ERROR                VALUE +4019.01310002
BOPISS     05  PV-END-INV-RTL-AMT-CLS-BOP   PIC S9(11)V9(2) COMP-3.     01311060
BOPISS     05  PV-END-INV-RTL-AMT-DPT-BOP   PIC S9(11)V9(2) COMP-3.     01312061
013200                                                                  01320002
013300                                                                  01330002
013400                                                                  01340002
013500****************************************************************  01350002
013600* RECORD LAYOUT FOR CONTROL CARD FILE.                            01360002
013700****************************************************************  01370002
013800                                                                  01380002
013900 01  CC-CONTROL-CARD.                                             01390002
014000     05  CC-EXTRACT-START-DATE        PIC X(10).                  01400002
014100     05  FILLER                       PIC X(01).                  01410002
014200     05  CC-EXTRACT-END-DATE          PIC X(10).                  01420002
014300 EJECT                                                            01430002
014400******************************************************************01440002
014500*  COPYBOOK FOR THE CALENDAR ROUTINE                              01450002
014600******************************************************************01460002
014700                                                                  01470002
014800     COPY DPWS500.                                                01480002
014900 EJECT                                                            01490002
015000******************************************************************01500013
015100*  COPYBOOK FOR THE EP OUTPUT FILE FORMAT                         01510013
015200******************************************************************01520013
015300                                                                  01530013
11752A*    COPY BPRD150.                                                01540066
11752A     COPY BPRD151.                                                01541066
015500 EJECT                                                            01550013
015600****************************************************************  01560002
015700* MERCHANDISE LEDGER CONTROL TABLE                                01570002
015800****************************************************************  01580002
015900                                                                  01590002
016000     EXEC SQL                                                     01600002
016100         INCLUDE TMLCNTL                                          01610002
016200     END-EXEC.                                                    01620002
016300                                                                  01630002
016400****************************************************************  01640002
016500* DATE ATTRIBUTE TABLE                                            01650002
016600****************************************************************  01660002
016700                                                                  01670002
016800     EXEC SQL                                                     01680002
016900         INCLUDE TDTATTR                                          01690002
017000     END-EXEC.                                                    01700002
017100                                                                  01710002
017200****************************************************************  01720002
017300* MERCHANDISE LEDGER WEEKLY MAJOR CLASS TABLE                     01730002
017400****************************************************************  01740002
017500                                                                  01750002
017600     EXEC SQL                                                     01760002
017700         INCLUDE TWKMCLC                                          01770002
017800     END-EXEC.                                                    01780002
017900                                                                  01790002
018000****************************************************************  01800002
018100* MERCHANDISE LEDGER WEEKLY DEPT TABLE                            01810002
018200****************************************************************  01820002
018300                                                                  01830002
018400     EXEC SQL                                                     01840002
018500         INCLUDE TWKDPTC                                          01850002
018600     END-EXEC.                                                    01860002
018700                                                                  01870002
018800****************************************************************  01880002
018900*  COMMUNICATION AREAS FOR DB2                                    01890002
019000****************************************************************  01900002
019100                                                                  01910002
019200     EXEC SQL                                                     01920002
019300         INCLUDE SQLCA                                            01930002
019400     END-EXEC.                                                    01940002
019500                                                                  01950002
019600******************************************************************01960002
019700* DB2 COMMUNICATION AREA 2                                        01970002
019800******************************************************************01980002
019900                                                                  01990002
020000     COPY SQLCA2.                                                 02000002
020100 EJECT                                                            02010002
020200****************************************************************  02020002
020300*  WEEKLY MAJOR CLASS EOP CST EXTRACT CURSOR                      02030051
020400****************************************************************  02040002
020500                                                                  02050002
020600     EXEC SQL                                                     02060002
020700        DECLARE EOP-CLS-CSR CURSOR FOR                            02070002
020800            SELECT                                                02080002
020900                DEPT_NBR                                          02090002
021000               ,MAJ_CL_NBR                                        02100002
021100               ,END_INV_COST_AMT                                  02110020
BOPISS               ,END_INV_RTL_AMT                                   02111060
021200               ,FSCL_WK_END_DTE                                   02120002
021300            FROM                                                  02130002
021400                TWKMCLC                                           02140002
021500            WHERE FSCL_WK_END_DTE BETWEEN :PV-EXTRACT-START-DATE  02150008
021600              AND                         :PV-EXTRACT-END-DATE    02160008
021700              AND CHNL_CDE              = :PV-CHANNEL             02170008
021800            ORDER BY DEPT_NBR, MAJ_CL_NBR, FSCL_WK_NBR            02180002
021900            WITH UR                                               02190024
022000     END-EXEC.                                                    02200002
022100*                                                                 02210007
022200                                                                  02220002
022300****************************************************************  02230051
022400*  WEEKLY MAJOR CLASS EOP DLR EXTRACT CURSOR                      02240051
022500****************************************************************  02250051
022600                                                                  02260051
022700     EXEC SQL                                                     02270051
022800        DECLARE EOP-DLR-CLS-CSR CURSOR FOR                        02280051
022900            SELECT                                                02290051
023000                DEPT_NBR                                          02300051
023100               ,MAJ_CL_NBR                                        02310051
023200               ,END_INV_RTL_AMT                                   02320051
023300               ,FSCL_WK_END_DTE                                   02330051
023400            FROM                                                  02340051
023500                TWKMCLC                                           02350051
023600            WHERE FSCL_WK_END_DTE BETWEEN                         02360051
023700                                  :PV-EOPDLR-EXTRACT-START-DATE   02370051
023800              AND                 :PV-EXTRACT-END-DATE            02380051
023900              AND CHNL_CDE      = :PV-CHANNEL                     02390051
024000            ORDER BY DEPT_NBR, MAJ_CL_NBR, FSCL_WK_NBR            02400051
024100            WITH UR                                               02410051
024200     END-EXEC.                                                    02420051
024300*                                                                 02430051
024400                                                                  02440051
024500****************************************************************  02450051
024600*  WEEKLY DEPT EOP CST EXTRACT CURSOR                             02460051
024700****************************************************************  02470002
024800                                                                  02480002
024900     EXEC SQL                                                     02490002
025000        DECLARE EOP-DPT-CSR CURSOR FOR                            02500002
025100            SELECT                                                02510002
025200                DEPT_NBR                                          02520002
025300               ,END_INV_COST_AMT                                  02530027
BOPISS               ,END_INV_RTL_AMT                                   02531061
025400               ,FSCL_WK_END_DTE                                   02540002
025500            FROM                                                  02550002
025600                TWKDPTC                                           02560002
025700            WHERE FSCL_WK_END_DTE BETWEEN :PV-EXTRACT-START-DATE  02570002
025800              AND                         :PV-EXTRACT-END-DATE    02580002
025900              AND CHNL_CDE              = :PV-CHANNEL             02590002
026000            ORDER BY DEPT_NBR, FSCL_WK_NBR                        02600002
026100            WITH UR                                               02610024
026200     END-EXEC.                                                    02620002
026300                                                                  02630002
026400****************************************************************  02640051
026500*  WEEKLY DEPT EOP DLR EXTRACT CURSOR                             02650051
026600****************************************************************  02660051
026700                                                                  02670051
026800     EXEC SQL                                                     02680051
026900        DECLARE EOP-DLR-DPT-CSR CURSOR FOR                        02690051
027000            SELECT                                                02700051
027100                DEPT_NBR                                          02710051
027200               ,END_INV_RTL_AMT                                   02720051
027300               ,FSCL_WK_END_DTE                                   02730051
027400            FROM                                                  02740051
027500                TWKDPTC                                           02750051
027600            WHERE FSCL_WK_END_DTE BETWEEN                         02760051
027700                                  :PV-EOPDLR-EXTRACT-START-DATE   02770051
027800              AND                 :PV-EXTRACT-END-DATE            02780051
027900              AND CHNL_CDE      = :PV-CHANNEL                     02790051
028000            ORDER BY DEPT_NBR, FSCL_WK_NBR                        02800051
028100            WITH UR                                               02810051
028200     END-EXEC.                                                    02820051
028300                                                                  02830051
028400****************************************************************  02840051
028500*  WEEKLY MAJOR CLASS BOP EXTRACT CURSOR                          02850002
028600****************************************************************  02860002
028700*                                                                 02870013
028800     EXEC SQL                                                     02880013
028900        DECLARE BOP-CLS-CSR CURSOR FOR                            02890013
029000            SELECT                                                02900013
029100                DEPT_NBR                                          02910013
029200               ,MAJ_CL_NBR                                        02920013
029300               ,END_INV_RTL_AMT                                   02930013
029400               ,END_INV_COST_AMT                                  02940013
029500               ,FSCL_WK_END_DTE                                   02950013
029600            FROM                                                  02960013
029700                TWKMCLC                                           02970013
029800            WHERE FSCL_WK_END_DTE BETWEEN                         02980013
029900                  :PV-EXTRACT-START-DATE-BOP                      02990013
030000              AND :PV-EXTRACT-END-DATE-BOP                        03000013
030100              AND CHNL_CDE              = :PV-CHANNEL             03010013
030200            ORDER BY DEPT_NBR, MAJ_CL_NBR, FSCL_WK_NBR            03020013
030300            WITH UR                                               03030024
030400     END-EXEC.                                                    03040013
030500*                                                                 03050013
030600****************************************************************  03060002
030700*  WEEKLY DEPT BOP EXTRACT CURSOR                                 03070002
030800****************************************************************  03080002
030900*                                                                 03090013
031000     EXEC SQL                                                     03100013
031100        DECLARE BOP-DPT-CSR CURSOR FOR                            03110013
031200            SELECT                                                03120013
031300                DEPT_NBR                                          03130013
031400               ,END_INV_COST_AMT                                  03140013
031500               ,FSCL_WK_END_DTE                                   03150013
031600            FROM                                                  03160013
031700                TWKDPTC                                           03170013
031800            WHERE FSCL_WK_END_DTE BETWEEN                         03180013
031900                  :PV-EXTRACT-START-DATE-BOP                      03190013
032000              AND :PV-EXTRACT-END-DATE-BOP                        03200013
032100              AND CHNL_CDE              = :PV-CHANNEL             03210013
032200            ORDER BY DEPT_NBR, FSCL_WK_NBR                        03220013
032300            WITH UR                                               03230024
032400     END-EXEC.                                                    03240013
032500  EJECT                                                           03250002
032600******************************************************************03260002
032700******************************************************************03270002
032800 PROCEDURE DIVISION.                                              03280002
032900******************************************************************03290002
033000******************************************************************03300002
033100                                                                  03310002
033200 0000-MAINLINE.                                                   03320002
033300                                                                  03330002
033400     PERFORM 1000-INITIALIZE.                                     03340002
033500                                                                  03350002
033600     PERFORM 2000-EOP-CLASS                                       03360002
033700                                                                  03370002
033800     PERFORM 3000-EOP-DEPT                                        03380002
033900                                                                  03390002
034000     PERFORM 4000-BOP-CLASS                                       03400028
034100                                                                  03410002
034200     PERFORM 5000-BOP-DEPT                                        03420028
034300                                                                  03430002
034400     CLOSE INV-EOP-FILE                                           03440041
034500           INV-BOP-FILE.                                          03450042
034600     STOP RUN.                                                    03460002
034700 EJECT                                                            03470002
034800******************************************************************03480002
034900*                                                                 03490002
035000*  OPEN INPUT AND OUTPUT FILES AND DETERMINE THE PROCESSING DATES 03500002
035100*                                                                 03510002
035200******************************************************************03520002
035300 1000-INITIALIZE.                                                 03530002
035400     OPEN OUTPUT INV-BOP-FILE                                     03540041
035500                 INV-EOP-FILE.                                    03550042
035600     INITIALIZE BP150-RECORD.                                     03560013
035700     INITIALIZE BP150-ACTUAL-INVBAL-BOP-CT                        03570043
035800     INITIALIZE BP150-ACTUAL-INVBAL-EOP-CT                        03580043
035900     INITIALIZE BP150-ACTUAL-RECEIPTS.                            03590022
036000     PERFORM 1100-SET-EXTRACT-DATES.                              03600002
036100                                                                  03610002
036200     PERFORM 1400-SET-BOP-DATES.                                  03620028
036300                                                                  03630002
036400                                                                  03640002
036500******************************************************************03650002
036600*                                                                 03660002
036700* IF THERE ARE DATES ON THE CONTROL CARD, WE WILL USE THEM IN OUR 03670002
036800* PROCESSING (OVERRIDE).  IF NOT, WE WILL EXTRACT THE PROCESSING  03680002
036900* DATES FROM THE MERCHANDISE LEDGER CONTROL TABLE                 03690002
037000*                                                                 03700002
037100******************************************************************03710002
037200 1100-SET-EXTRACT-DATES.                                          03720002
037300                                                                  03730002
037400     ACCEPT CC-CONTROL-CARD.                                      03740002
037500                                                                  03750002
037600     IF CC-EXTRACT-START-DATE = SPACE                             03760002
037700         PERFORM 1200-USE-ML-CNTL-DATES                           03770002
037800     ELSE                                                         03780002
037900         DISPLAY '***********************************************'03790002
038000         DISPLAY '** OVERRIDE DATE USED: ' CC-CONTROL-CARD '**'   03800002
038100         DISPLAY '***********************************************'03810002
038200         PERFORM 1300-USE-OVERRIDE-DATE                           03820002
038300     END-IF.                                                      03830002
038400                                                                  03840002
038500     DISPLAY 'BPKUT445 - EXTRACT DATES'.                          03850065
038600     DISPLAY 'BPKUT445 - BEGIN DATE ' PV-EXTRACT-START-DATE.      03860065
038700     DISPLAY 'BPKUT445 - END DATE   ' PV-EXTRACT-END-DATE.        03870065
038800                                                                  03880002
038900     PERFORM 1500-CHECK-FOR-END-OF-PERIOD.                        03890002
039000                                                                  03900002
039100******************************************************************03910002
039200*                                                                 03920002
039300* IF THERE ARE NO DATES ON THE CONTROL CARD,                      03930002
039400*    EXTRACT THE PROCESSING DATES FROM THE MERCHANDISE            03940002
039500*    LEDGER CONTROL TABLE                                         03950002
039600*                                                                 03960002
039700******************************************************************03970002
039800 1200-USE-ML-CNTL-DATES.                                          03980002
039900                                                                  03990003
040000     EXEC SQL                                                     04000002
040100          SELECT                                                  04010002
11752A*                FSCL_MN_BEG_DTE                                  04020064
11752A                 FSCL_WK_BEG_DTE                                  04021064
040300                ,MXPSTG_FSCL_WK_DTE                               04030002
040400            INTO                                                  04040002
11752A*                :DTATTR-FSCL-MN-BEG-DTE                          04050064
11752A                 :DTATTR-FSCL-WK-BEG-DTE                          04051064
040600                ,:MLCNTL-MXPSTG-FSCL-WK-DTE                       04060002
040700            FROM                                                  04070002
040800                 TMLCNTL                                          04080002
040900                ,TDTATTR                                          04090002
041000            WHERE                                                 04100002
041100                 KY_DTE = OPN_FSCL_WK_DTE                         04110002
041200     END-EXEC.                                                    04120002
041300                                                                  04130002
041400     EVALUATE TRUE                                                04140002
041500         WHEN SQLCODE = ZERO                                      04150002
11752A*            MOVE DTATTR-FSCL-MN-BEG-DTE TO                       04160064
11752A*                 PV-EXTRACT-MN-BEG-DTE                           04160164
11752A             MOVE DTATTR-FSCL-WK-BEG-DTE TO                       04161064
11752A                  PV-EXTRACT-WK-BEG-DTE                           04170064
041800             MOVE MLCNTL-MXPSTG-FSCL-WK-DTE TO                    04180002
041900                  PV-EXTRACT-END-DATE                             04190002
042000         WHEN OTHER                                               04200002
042100             MOVE '1200-USE-ML-CNTL-DATES' TO PV-PARAGRAPH-NAME   04210002
042200             MOVE 'SELECT ROW FROM TMLCNTL'                       04220002
042300                                          TO PV-DB2-OPER-ATTEMPTED04230002
042400             PERFORM 9000-SQL-ABEND                               04240002
042500     END-EVALUATE.                                                04250002
042600                                                                  04260002
042700     EXEC SQL                                                     04270002
042800          SELECT                                                  04280002
042900                 FSCL_WK_END_DTE                                  04290002
043000            INTO                                                  04300002
043100                 :DTATTR-FSCL-WK-END-DTE                          04310002
043200            FROM                                                  04320002
043300                 TDTATTR                                          04330002
043400            WHERE                                                 04340002
11752A*                 KY_DTE = :PV-EXTRACT-MN-BEG-DTE                 04350064
11752A                  KY_DTE = :PV-EXTRACT-WK-BEG-DTE                 04351064
043600     END-EXEC.                                                    04360002
043700                                                                  04370002
043800     EVALUATE TRUE                                                04380002
043900         WHEN SQLCODE = ZERO                                      04390002
044000             MOVE DTATTR-FSCL-WK-END-DTE TO                       04400002
044100                  PV-EXTRACT-START-DATE                           04410002
044200             MOVE DTATTR-FSCL-WK-END-DTE TO                       04420056
044300                  PV-EOPDLR-EXTRACT-START-DATE                    04430051
044400         WHEN OTHER                                               04440002
044500             MOVE '1200-USE-ML-CNTL-DATES' TO PV-PARAGRAPH-NAME   04450002
044600             MOVE 'SELECT ROW FROM TMLCNTL PART 2'                04460002
044700                                          TO PV-DB2-OPER-ATTEMPTED04470002
044800             PERFORM 9000-SQL-ABEND                               04480002
044900     END-EVALUATE.                                                04490002
045000                                                                  04500002
045100******************************************************************04510002
045200*                                                                 04520002
045300* IF THERE ARE DATES ON THE CONTROL CARD, WE WILL USE THEM IN OUR 04530002
045400* PROCESSING (OVERRIDE).                                          04540002
045500*                                                                 04550002
045600******************************************************************04560002
045700 1300-USE-OVERRIDE-DATE.                                          04570002
045800     MOVE CC-EXTRACT-START-DATE TO PV-EXTRACT-START-DATE.         04580002
045900     MOVE CC-EXTRACT-START-DATE TO PV-EOPDLR-EXTRACT-START-DATE.  04590059
046000     MOVE CC-EXTRACT-END-DATE   TO PV-EXTRACT-END-DATE.           04600002
046100                                                                  04610002
046200                                                                  04620002
046300******************************************************************04630002
046400*                                                                 04640002
046500* SET BEGINNING OF PERIOD DATES.                                  04650002
046600*                                                                 04660002
046700******************************************************************04670002
046800 1400-SET-BOP-DATES.                                              04680002
046900                                                                  04690003
047000     EXEC SQL                                                     04700002
047100          SELECT                                                  04710002
047200              PFW_END_DTE                                         04720002
047300          INTO                                                    04730002
047400              :DTATTR-PFW-END-DTE                                 04740002
047500          FROM                                                    04750002
047600              TDTATTR                                             04760002
047700          WHERE                                                   04770002
047800              KY_DTE = :PV-EXTRACT-START-DATE                     04780002
047900     END-EXEC.                                                    04790002
048000                                                                  04800002
048100     EVALUATE TRUE                                                04810002
048200         WHEN SQLCODE = ZERO                                      04820002
048300             MOVE DTATTR-PFW-END-DTE TO PV-EXTRACT-START-DATE-BOP 04830002
048400         WHEN OTHER                                               04840002
048500             DISPLAY '** PV-EXTRACT-START-DTE: '                  04850003
048600                PV-EXTRACT-START-DATE                             04860004
048700             DISPLAY '** DTATTR-KY-DTE:  ' DTATTR-KY-DTE          04870003
048800             MOVE    '1400-SET-BOP-DATES'                         04880002
048900                                          TO PV-PARAGRAPH-NAME    04890002
049000             MOVE    'SELECT ROW FROM TDTATTR'                    04900002
049100                                          TO PV-DB2-OPER-ATTEMPTED04910002
049200             PERFORM 9000-SQL-ABEND                               04920002
049300     END-EVALUATE.                                                04930002
049400                                                                  04940002
049500     EXEC SQL                                                     04950002
049600          SELECT                                                  04960002
049700              PFW_END_DTE                                         04970002
049800          INTO                                                    04980002
049900              :DTATTR-PFW-END-DTE                                 04990002
050000          FROM                                                    05000002
050100              TDTATTR                                             05010002
050200          WHERE                                                   05020002
050300              KY_DTE = :PV-EXTRACT-END-DATE                       05030002
050400     END-EXEC.                                                    05040002
050500                                                                  05050002
050600     EVALUATE TRUE                                                05060002
050700         WHEN SQLCODE = ZERO                                      05070002
050800             MOVE DTATTR-PFW-END-DTE TO PV-EXTRACT-END-DATE-BOP   05080002
050900         WHEN OTHER                                               05090002
051000             DISPLAY '** PV-EXTRACT-END-DTE: '                    05100003
051100                PV-EXTRACT-END-DATE                               05110004
051200             DISPLAY '** DTATTR-KY-DTE: ' DTATTR-KY-DTE           05120002
051300             MOVE    '1400-SET-BOP-DATES'                         05130002
051400                                          TO PV-PARAGRAPH-NAME    05140002
051500             MOVE    'SELECT ROW FROM TDTATTR'                    05150002
051600                                          TO PV-DB2-OPER-ATTEMPTED05160002
051700             PERFORM 9000-SQL-ABEND                               05170002
051800     END-EVALUATE.                                                05180002
051900                                                                  05190003
052000******************************************************************05200002
052100*                                                                 05210002
052200*    DETERMINE IS DATA FROM THIS RUN INCLUDES THE END OF PERIOD   05220002
052300*    WEEK.  IF YES THEN GET THE SEASON, YEAR, AND WEEK OF THE     05230002
052400*    NEXT PERIOD FOR THE BOP_DLR OF OWP.                          05240002
052500*                                                                 05250002
052600******************************************************************05260002
052700 1500-CHECK-FOR-END-OF-PERIOD.                                    05270002
052800                                                                  05280002
052900     INITIALIZE DPG51                                             05290002
053000                DPG52                                             05300002
053100                DPG53                                             05310002
053200                DPG54                                             05320002
053300                DPG55                                             05330002
053400                DPG56.                                            05340002
053500                                                                  05350002
053600     MOVE PV-EXTRACT-END-DATE      TO DPG52-LK-DATE-INPUT.        05360002
053700     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       05370002
053800     SET DPG52-LK-DTE-ISO-FMT      TO TRUE.                       05380002
053900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                05390002
054000                                             DPG52                05400002
054100                                             DPG53                05410002
054200                                             DPG54                05420002
054300                                             DPG55                05430002
054400                                             DPG56.               05440002
054500                                                                  05450002
054600     EVALUATE TRUE                                                05460002
054700         WHEN DPG54-NO-ERROR                                      05470002
054800            MOVE DPG56-FISCAL-PERIOD-WEEK TO PV-WEEK-OF-PERIOD    05480002
054900            MOVE DPG56-NBR-FISCAL-PERIOD-WEEKS                    05490002
055000                                          TO PV-WEEKS-IN-PERIOD   05500002
055100         WHEN (DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID)          05510002
055200             DISPLAY '** ABEND ** IN BPKUT445'                    05520065
055300             DISPLAY '1500-CHECK-FOR-END-OF-PERIOD'               05530002
055400             DISPLAY 'DATE USED AS INPUT ' PV-EXTRACT-END-DATE    05540002
055500             DISPLAY 'ERROR CALLING THE CALENDAR ROUTINE'         05550002
055600             DISPLAY 'DATE TODAY = ' DPG52-DB2-ISO-DATE           05560002
055700             SET PV-CALENDAR-ROUTINE-ERROR TO TRUE                05570002
055800             PERFORM 9999-ABEND.                                  05580002
055900                                                                  05590002
056000     IF PV-WEEK-OF-PERIOD EQUAL PV-WEEKS-IN-PERIOD                05600002
056100        MOVE DPG56-FISCAL-WEEK-NBR    TO PV-WEEK-NBR              05610002
056200        MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-YEAR                  05620002
056300        PERFORM 1600-GET-NEXT-WEEK-INFO.                          05630002
056400     EJECT                                                        05640002
056500******************************************************************05650002
056600*   THIS RUN OF PROGRAM IS FOR A PERIOD END WEEK.  DETERMINE THE  05660002
056700*   INFORMATION NEEDED FOR THE FIRST WEEK OF NEXT PERIOD.         05670002
056800******************************************************************05680002
056900 1600-GET-NEXT-WEEK-INFO.                                         05690002
057000     INITIALIZE DPG51                                             05700002
057100                DPG52                                             05710002
057200                DPG53                                             05720002
057300                DPG54                                             05730002
057400                DPG55                                             05740002
057500                DPG56.                                            05750002
057600                                                                  05760002
057700     MOVE PV-YEAR-WEEK             TO DPG52-LK-DATE-INPUT.        05770002
057800     SET DPG51-FISCAL-454-CALENDAR TO TRUE.                       05780002
057900     SET DPG52-LK-DTE-FISC-WEEK-CC TO TRUE.                       05790002
058000     SET DPG51-INCREMENT-DATE TO TRUE.                            05800002
058100     MOVE PC-1                TO DPG51-INCR-DECR-FISCAL-WEEK-9.   05810002
058200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                05820002
058300                                             DPG52                05830002
058400                                             DPG53                05840002
058500                                             DPG54                05850002
058600                                             DPG55                05860002
058700                                             DPG56.               05870002
058800                                                                  05880002
058900     EVALUATE TRUE                                                05890002
059000         WHEN DPG54-NO-ERROR                                      05900002
059100            MOVE DPG56-FISCAL-WEEK-NBR    TO                      05910002
059200                                         PV-NEXT-PERIOD-FIRST-WEEK05920002
059300            MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-NEXT-PERIOD-YEAR  05930002
059400            MOVE DPG56-CURR-FISCAL-SEASON TO PV-NEXT-PERIOD-SEASON05940002
059500            DISPLAY 'BPKUT445 - NEXT WEEK INFO'                   05950065
059600            DISPLAY 'BPKUT445 - SEASON  ' PV-NEXT-PERIOD-SEASON   05960065
059700            DISPLAY 'BPKUT445 - YEAR    ' PV-NEXT-PERIOD-YEAR     05970065
059800            DISPLAY 'BPKUT445 - WEEK    '                         05980065
059900                                         PV-NEXT-PERIOD-FIRST-WEEK05990002
060000         WHEN (DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID)          06000002
060100            DISPLAY '** ABEND ** IN BPKUT445'                     06010065
060200            DISPLAY '1600-GET-NEXT-WEEK-INFO'                     06020002
060300            DISPLAY 'DATE USED AS INPUT ' DPG52-LK-DATE-INPUT     06030002
060400            DISPLAY 'ERROR CALLING THE CALENDAR ROUTINE'          06040002
060500            DISPLAY 'DATE TODAY = ' DPG52-DB2-ISO-DATE            06050002
060600            SET PV-CALENDAR-ROUTINE-ERROR TO TRUE                 06060002
060700            PERFORM 9999-ABEND.                                   06070002
060800 EJECT                                                            06080002
060900******************************************************************06090002
061000*   PROCESS FROM WEEKLY MAJOR CLASS CHANNEL TABLE FOR EP BY       06100013
061100*   CHANNEL.                                                      06110013
061200******************************************************************06120002
061300 2000-EOP-CLASS.                                                  06130002
061400                                                                  06140002
061500******************************************************************06150002
061600* PROCESS ALL PHYSSTR DATA                                        06160002
061700******************************************************************06170002
061800     MOVE PC-PHYSSTR-IND TO PV-CHANNEL.                           06180002
061900                                                                  06190002
062000     EXEC SQL                                                     06200002
062100         OPEN EOP-CLS-CSR                                         06210002
062200     END-EXEC.                                                    06220002
062300                                                                  06230002
062400     PERFORM 2100-EOP-CLS-PROCESS                                 06240002
062500             UNTIL PS-END-OF-EOP-CLS-CSR.                         06250002
062600                                                                  06260002
062700     EXEC SQL                                                     06270002
062800        CLOSE EOP-CLS-CSR                                         06280002
062900     END-EXEC.                                                    06290002
063000                                                                  06300002
063100     MOVE 'N' TO PS-END-OF-EOP-CURSOR-SW.                         06310002
063200                                                                  06320002
063300     EXEC SQL                                                     06330051
063400         OPEN EOP-DLR-CLS-CSR                                     06340051
063500     END-EXEC.                                                    06350051
063600                                                                  06360051
063700     PERFORM 2300-EOP-DLR-CLS-PROCESS                             06370051
063800             UNTIL PS-END-OF-EOP-CLS-CSR.                         06380051
063900                                                                  06390051
064000     EXEC SQL                                                     06400051
064100        CLOSE EOP-DLR-CLS-CSR                                     06410051
064200     END-EXEC.                                                    06420051
064300                                                                  06430051
064400     MOVE 'N' TO PS-END-OF-EOP-CURSOR-SW.                         06440051
064500                                                                  06450051
064600******************************************************************06460002
064700* PROCESS ALL VIRTSTR DATA                                        06470002
064800******************************************************************06480002
064900     MOVE PC-VIRTSTR-IND TO PV-CHANNEL.                           06490002
065000                                                                  06500002
065100     EXEC SQL                                                     06510002
065200         OPEN EOP-CLS-CSR                                         06520002
065300     END-EXEC.                                                    06530002
065400                                                                  06540002
065500     PERFORM 2100-EOP-CLS-PROCESS                                 06550002
065600             UNTIL PS-END-OF-EOP-CLS-CSR.                         06560002
065700                                                                  06570002
065800     EXEC SQL                                                     06580002
065900        CLOSE EOP-CLS-CSR                                         06590002
066000     END-EXEC.                                                    06600002
066100                                                                  06610051
066200     MOVE 'N' TO PS-END-OF-EOP-CURSOR-SW.                         06620018
066300                                                                  06630018
066400     EXEC SQL                                                     06640051
066500         OPEN EOP-DLR-CLS-CSR                                     06650051
066600     END-EXEC.                                                    06660051
066700                                                                  06670051
066800     PERFORM 2300-EOP-DLR-CLS-PROCESS                             06680051
066900             UNTIL PS-END-OF-EOP-CLS-CSR.                         06690051
067000                                                                  06700051
067100     EXEC SQL                                                     06710051
067200        CLOSE EOP-DLR-CLS-CSR                                     06720051
067300     END-EXEC.                                                    06730051
067400                                                                  06740051
067500     MOVE 'N' TO PS-END-OF-EOP-CURSOR-SW.                         06750051
067600                                                                  06760051
067700******************************************************************06770018
067800* PROCESS ALL TOTALCO DATA                                        06780018
067900******************************************************************06790018
068000     MOVE PC-TOTALCO-IND TO PV-CHANNEL                            06800018
068100                                                                  06810018
068200     EXEC SQL                                                     06820018
068300         OPEN EOP-CLS-CSR                                         06830018
068400     END-EXEC.                                                    06840018
068500                                                                  06850018
068600     PERFORM 2100-EOP-CLS-PROCESS                                 06860018
068700             UNTIL PS-END-OF-EOP-CLS-CSR.                         06870018
068800                                                                  06880018
068900     EXEC SQL                                                     06890018
069000        CLOSE EOP-CLS-CSR                                         06900018
069100     END-EXEC.                                                    06910018
069200                                                                  06920018
069300     MOVE 'N' TO PS-END-OF-EOP-CURSOR-SW.                         06930018
069400                                                                  06940002
069500     EXEC SQL                                                     06950051
069600         OPEN EOP-DLR-CLS-CSR                                     06960051
069700     END-EXEC.                                                    06970051
069800                                                                  06980051
069900     PERFORM 2300-EOP-DLR-CLS-PROCESS                             06990051
070000             UNTIL PS-END-OF-EOP-CLS-CSR.                         07000051
070100                                                                  07010051
070200     EXEC SQL                                                     07020051
070300        CLOSE EOP-DLR-CLS-CSR                                     07030051
070400     END-EXEC.                                                    07040051
070500                                                                  07050051
070600     MOVE 'N' TO PS-END-OF-EOP-CURSOR-SW.                         07060051
070700                                                                  07070051
070800******************************************************************07080002
070900*                                                                 07090002
071000* FETCH AND PROCESS                                               07100013
071100******************************************************************07110002
071200 2100-EOP-CLS-PROCESS.                                            07120002
071300     EXEC SQL                                                     07130002
071400         FETCH EOP-CLS-CSR                                        07140002
071500         INTO  :WKMCLC-DEPT-NBR                                   07150002
071600              ,:WKMCLC-MAJ-CL-NBR                                 07160002
071700              ,:WKMCLC-END-INV-COST-AMT                           07170020
BOPISS              ,:PV-END-INV-RTL-AMT-CLS-BOP                        07171060
071800              ,:WKMCLC-FSCL-WK-END-DTE                            07180002
071900     END-EXEC.                                                    07190002
072000                                                                  07200002
072100     EVALUATE SQLCODE                                             07210002
072200         WHEN ZERO                                                07220002
072300             PERFORM 2200-FORMAT-CLASS-EOP-RECORD                 07230002
072400         WHEN +100                                                07240002
072500             SET PS-END-OF-EOP-CLS-CSR TO TRUE                    07250002
072600         WHEN OTHER                                               07260002
072700             MOVE '2100-EOP-CLS-PROCESS' TO                       07270002
072800                  PV-PARAGRAPH-NAME                               07280002
072900             PERFORM 9000-SQL-ABEND                               07290002
073000     END-EVALUATE.                                                07300002
073100                                                                  07310002
073200                                                                  07320002
073300******************************************************************07330002
073400*  FORMAT THE EOP CLASS RECORD BASED ON OUTPUT FILE LAYOUT        07340013
073500*                                                                 07350002
073600******************************************************************07360002
073700 2200-FORMAT-CLASS-EOP-RECORD.                                    07370002
073800     INITIALIZE BP150-RECORD.                                     07380013
073900     INITIALIZE BP150-ACTUAL-INVBAL-EOP-CT.                       07390041
074000     INITIALIZE BP150-ACTUAL-INVBAL-BOP-CT.                       07400041
074100     INITIALIZE BP150-ACTUAL-RECEIPTS.                            07410041
074200     IF PV-CHANNEL = 'P'                                          07420041
074300             MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME7      07430041
074400                                   ,BP150-ORGANIZATION-NAME8      07440041
074500     ELSE  IF PV-CHANNEL = 'V'                                    07450018
074600             MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME7      07460041
074700                                   ,BP150-ORGANIZATION-NAME8      07470041
074800           ELSE                                                   07480018
074900             MOVE PC-TOTALCO     TO BP150-ORGANIZATION-NAME7      07490041
075000                                   ,BP150-ORGANIZATION-NAME8      07500041
075100           END-IF                                                 07510018
075200     END-IF.                                                      07520018
075300     MOVE WKMCLC-DEPT-NBR        TO BP150-DEPARTMENT-NBR7         07530041
075400                                   ,BP150-DEPARTMENT-NBR8         07540041
075500     MOVE WKMCLC-MAJ-CL-NBR      TO BP150-CLASS-NBR7              07550041
075600                                   ,BP150-CLASS-NBR8              07560041
075700     MOVE WKMCLC-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           07570002
075800                                                                  07580002
075900     PERFORM 6000-GET-EOP-DATE-ATTRIBUTES.                        07590002
076000                                                                  07600002
076100     MOVE PV-SEASON              TO BP150-SEASON7                 07610041
076200                                   ,BP150-SEASON8                 07620041
076300     MOVE PV-YEAR                TO BP150-YEAR7                   07630041
076400                                   ,BP150-YEAR8                   07640041
076500     MOVE PV-WEEK-NBR            TO BP150-WEEK-NBR7               07650041
076600                                   ,BP150-WEEK-NBR8               07660041
076700                                                                  07670028
076800** EOP-CST                                                        07680028
076900     DIVIDE WKMCLC-END-INV-COST-AMT BY 1000                       07690028
077000                                  GIVING BP150-EOP-CST.           07700041
077100** EOP-DLR                                                        07710047
077200     MOVE ZEROES                  TO BP150-EOP-DLR                07720041
077300     MOVE PV-WEEK-NBR   TO BP150-WEEK-NBR8                        07730050
077400     MOVE PV-SEASON     TO BP150-SEASON8                          07740050
077500     MOVE PV-YEAR       TO BP150-YEAR8                            07750050
077600     PERFORM 8000-WRITE-EOP-OUTPUT.                               07760041
077700                                                                  07770028
BOPISS*    IF PV-CHANNEL = PC-TOTALCO-IND                               07780060
077900        IF PV-WEEK-OF-PERIOD = PV-WEEKS-IN-PERIOD                 07790028
078000           IF  PV-BOP-NEEDED                                      07800028
078100               MOVE PV-NEXT-PERIOD-FIRST-WEEK TO BP150-WEEK-NBR7  07810041
078200               MOVE PV-NEXT-PERIOD-SEASON     TO BP150-SEASON7    07820041
078300               MOVE PV-NEXT-PERIOD-YEAR       TO BP150-YEAR7      07830041
078400** BOP-CST                                                        07840034
078500               DIVIDE WKMCLC-END-INV-COST-AMT BY 1000             07850034
078600                                  GIVING BP150-BOP-CST            07860041
078700** BOP-DLR                                                        07870047
BOPISS*              MOVE ZEROES                  TO BP150-BOP-DLR      07880060
BOPISS*              PERFORM 7000-WRITE-BOP-OUTPUT                      07890060
BOPISS               DIVIDE PV-END-INV-RTL-AMT-CLS-BOP BY 1000          07891060
BOPISS                                  GIVING BP150-BOP-DLR            07892060
079000** THIS WRITE IS NOT DUPLICATE ONE IS FOR MTD AND ONE IS FOR OWP  07900041
079100               PERFORM 7000-WRITE-BOP-OUTPUT.                     07910041
079200                                                                  07920002
079300 EJECT                                                            07930002
079400******************************************************************07940051
079500*                                                                 07950051
079600* FETCH AND PROCESS                                               07960051
079700******************************************************************07970051
079800 2300-EOP-DLR-CLS-PROCESS.                                        07980051
079900     EXEC SQL                                                     07990051
080000         FETCH EOP-DLR-CLS-CSR                                    08000051
080100         INTO  :WKMCLC-DEPT-NBR                                   08010051
080200              ,:WKMCLC-MAJ-CL-NBR                                 08020051
080300              ,:WKMCLC-END-INV-RTL-AMT                            08030051
080400              ,:WKMCLC-FSCL-WK-END-DTE                            08040051
080500     END-EXEC.                                                    08050051
080600                                                                  08060051
080700     EVALUATE SQLCODE                                             08070051
080800         WHEN ZERO                                                08080051
080900             PERFORM 2400-FORMAT-CLASSEOPDLR-RECORD               08090054
081000         WHEN +100                                                08100051
081100             SET PS-END-OF-EOP-CLS-CSR TO TRUE                    08110051
081200         WHEN OTHER                                               08120051
081300             MOVE '2300-EOP-DLR-CLS-PROCESS' TO                   08130051
081400                  PV-PARAGRAPH-NAME                               08140051
081500             PERFORM 9000-SQL-ABEND                               08150051
081600     END-EVALUATE.                                                08160051
081700                                                                  08170051
081800                                                                  08180051
081900******************************************************************08190051
082000*  FORMAT THE EOP CLASS RECORD BASED ON OUTPUT FILE LAYOUT        08200051
082100*                                                                 08210051
082200******************************************************************08220051
082300 2400-FORMAT-CLASSEOPDLR-RECORD.                                  08230054
082400     INITIALIZE BP150-RECORD.                                     08240051
082500     INITIALIZE BP150-ACTUAL-INVBAL-EOP-CT.                       08250051
082600     INITIALIZE BP150-ACTUAL-INVBAL-BOP-CT.                       08260051
082700     INITIALIZE BP150-ACTUAL-RECEIPTS.                            08270051
082800     IF PV-CHANNEL = 'P'                                          08280051
082900             MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME7      08290051
083000                                   ,BP150-ORGANIZATION-NAME8      08300051
083100     ELSE  IF PV-CHANNEL = 'V'                                    08310051
083200             MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME7      08320051
083300                                   ,BP150-ORGANIZATION-NAME8      08330051
083400           ELSE                                                   08340051
083500             MOVE PC-TOTALCO     TO BP150-ORGANIZATION-NAME7      08350051
083600                                   ,BP150-ORGANIZATION-NAME8      08360051
083700           END-IF                                                 08370051
083800     END-IF.                                                      08380051
083900     MOVE WKMCLC-DEPT-NBR        TO BP150-DEPARTMENT-NBR7         08390051
084000                                   ,BP150-DEPARTMENT-NBR8         08400051
084100     MOVE WKMCLC-MAJ-CL-NBR      TO BP150-CLASS-NBR7              08410051
084200                                   ,BP150-CLASS-NBR8              08420051
084300     MOVE WKMCLC-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           08430051
084400                                                                  08440051
084500     PERFORM 6000-GET-EOP-DATE-ATTRIBUTES.                        08450051
084600                                                                  08460051
084700     MOVE PV-SEASON              TO BP150-SEASON7                 08470051
084800                                   ,BP150-SEASON8                 08480051
084900     MOVE PV-YEAR                TO BP150-YEAR7                   08490051
085000                                   ,BP150-YEAR8                   08500051
085100     MOVE PV-WEEK-NBR            TO BP150-WEEK-NBR7               08510051
085200                                   ,BP150-WEEK-NBR8               08520051
085300                                                                  08530051
085400* EOP-DLR                                                         08540051
085500     DIVIDE WKMCLC-END-INV-RTL-AMT BY 1000                        08550054
085600                              GIVING BP150-EOP-DLR                08560054
085700* EOP-CST                                                         08570051
085800     MOVE ZEROES              TO BP150-EOP-CST                    08580054
085900     IF PV-CHANNEL NOT = PC-TOTALCO-IND                           08590054
086000        PERFORM 8000-WRITE-EOP-OUTPUT.                            08600060
BOPISS*       IF PV-WEEK-OF-PERIOD = PV-WEEKS-IN-PERIOD                 08610060
BOPISS*          IF  PV-BOP-NEEDED                                      08620060
BOPISS*              MOVE PV-NEXT-PERIOD-FIRST-WEEK  TO BP150-WEEK-NBR7 08630060
BOPISS*              MOVE PV-NEXT-PERIOD-SEASON      TO BP150-SEASON7   08640060
BOPISS*              MOVE PV-NEXT-PERIOD-YEAR        TO BP150-YEAR7     08650060
086600* BOP-DLR                                                         08660051
BOPISS*              DIVIDE WKMCLC-END-INV-RTL-AMT BY 1000              08670060
BOPISS*                                 GIVING BP150-BOP-DLR            08680060
086900* BOP-CST                                                         08690051
BOPISS*              MOVE ZEROES        TO BP150-BOP-CST                08700060
BOPISS*              PERFORM 7000-WRITE-BOP-OUTPUT                      08710060
BOPISS*          ELSE                                                   08720060
BOPISS*              CONTINUE                                           08730060
BOPISS*       ELSE                                                      08740060
BOPISS*         CONTINUE.                                               08750060
BOPISS*    ELSE                                                         08760060
BOPISS*       IF PV-WEEK-OF-PERIOD = PV-WEEKS-IN-PERIOD                 08770060
BOPISS*          IF  PV-BOP-NEEDED                                      08780060
BOPISS*              MOVE PV-NEXT-PERIOD-FIRST-WEEK TO BP150-WEEK-NBR7  08790060
BOPISS*              MOVE PV-NEXT-PERIOD-SEASON     TO BP150-SEASON7    08800060
BOPISS*              MOVE PV-NEXT-PERIOD-YEAR       TO BP150-YEAR7      08810060
088200* BOP-DLR                                                         08820051
BOPISS*              DIVIDE WKMCLC-END-INV-RTL-AMT BY 1000              08830060
BOPISS*                                 GIVING BP150-BOP-DLR            08840060
088500* BOP-CST                                                         08850051
BOPISS*              MOVE ZEROES        TO BP150-BOP-CST                08860060
BOPISS*              PERFORM 7000-WRITE-BOP-OUTPUT.                     08870060
088800                                                                  08880051
088900 EJECT                                                            08890051
089000******************************************************************08900051
089100*                                                                 08910002
089200* PROCESS EOP WEEKLY DEPARTMENT CHANNEL TABLE FOR EP.             08920013
089300******************************************************************08930002
089400 3000-EOP-DEPT.                                                   08940002
089500                                                                  08950002
089600******************************************************************08960002
089700* PROCESS ALL PHYSSTR DATA                                        08970002
089800******************************************************************08980002
089900     MOVE PC-PHYSSTR-IND TO PV-CHANNEL.                           08990002
090000                                                                  09000002
090100     EXEC SQL                                                     09010002
090200         OPEN EOP-DPT-CSR                                         09020002
090300     END-EXEC.                                                    09030002
090400                                                                  09040002
090500     PERFORM 3100-EOP-DPT-PROCESS                                 09050002
090600             UNTIL PS-END-OF-EOP-DPT-CSR.                         09060002
090700                                                                  09070002
090800     EXEC SQL                                                     09080002
090900        CLOSE EOP-DPT-CSR                                         09090002
091000     END-EXEC.                                                    09100002
091100                                                                  09110002
091200     MOVE 'N' TO PS-END-OF-EOP-DPT-CURSOR-SW.                     09120002
091300                                                                  09130002
091400     EXEC SQL                                                     09140051
091500         OPEN EOP-DLR-DPT-CSR                                     09150051
091600     END-EXEC.                                                    09160051
091700                                                                  09170051
091800     PERFORM 3300-EOP-DLR-DPT-PROCESS                             09180051
091900             UNTIL PS-END-OF-EOP-DPT-CSR.                         09190051
092000                                                                  09200051
092100     EXEC SQL                                                     09210051
092200        CLOSE EOP-DLR-DPT-CSR                                     09220051
092300     END-EXEC.                                                    09230051
092400                                                                  09240051
092500     MOVE 'N' TO PS-END-OF-EOP-DPT-CURSOR-SW.                     09250051
092600                                                                  09260051
092700******************************************************************09270002
092800* PROCESS ALL VIRTSTR DATA                                        09280002
092900******************************************************************09290002
093000     MOVE PC-VIRTSTR-IND TO PV-CHANNEL.                           09300002
093100                                                                  09310002
093200     EXEC SQL                                                     09320002
093300         OPEN EOP-DPT-CSR                                         09330002
093400     END-EXEC.                                                    09340002
093500                                                                  09350002
093600     PERFORM 3100-EOP-DPT-PROCESS                                 09360002
093700             UNTIL PS-END-OF-EOP-DPT-CSR.                         09370002
093800                                                                  09380002
093900     EXEC SQL                                                     09390002
094000        CLOSE EOP-DPT-CSR                                         09400002
094100     END-EXEC.                                                    09410002
094200                                                                  09420051
094300     MOVE 'N' TO PS-END-OF-EOP-DPT-CURSOR-SW.                     09430018
094400                                                                  09440018
094500     EXEC SQL                                                     09450051
094600         OPEN EOP-DLR-DPT-CSR                                     09460051
094700     END-EXEC.                                                    09470051
094800                                                                  09480051
094900     PERFORM 3300-EOP-DLR-DPT-PROCESS                             09490051
095000             UNTIL PS-END-OF-EOP-DPT-CSR.                         09500051
095100                                                                  09510051
095200     EXEC SQL                                                     09520051
095300        CLOSE EOP-DLR-DPT-CSR                                     09530051
095400     END-EXEC.                                                    09540051
095500                                                                  09550051
095600     MOVE 'N' TO PS-END-OF-EOP-DPT-CURSOR-SW.                     09560051
095700                                                                  09570051
095800******************************************************************09580018
095900* PROCESS ALL TOTALCO DATA                                        09590018
096000******************************************************************09600018
096100     MOVE PC-TOTALCO-IND TO PV-CHANNEL.                           09610018
096200                                                                  09620018
096300     EXEC SQL                                                     09630018
096400         OPEN EOP-DPT-CSR                                         09640018
096500     END-EXEC.                                                    09650018
096600                                                                  09660018
096700     PERFORM 3100-EOP-DPT-PROCESS                                 09670018
096800             UNTIL PS-END-OF-EOP-DPT-CSR.                         09680018
096900                                                                  09690018
097000     EXEC SQL                                                     09700018
097100        CLOSE EOP-DPT-CSR                                         09710018
097200     END-EXEC.                                                    09720018
097300                                                                  09730018
097400     MOVE 'N' TO PS-END-OF-EOP-DPT-CURSOR-SW.                     09740018
097500                                                                  09750002
097600     EXEC SQL                                                     09760051
097700         OPEN EOP-DLR-DPT-CSR                                     09770051
097800     END-EXEC.                                                    09780051
097900                                                                  09790051
098000     PERFORM 3300-EOP-DLR-DPT-PROCESS                             09800051
098100             UNTIL PS-END-OF-EOP-DPT-CSR.                         09810051
098200                                                                  09820051
098300     EXEC SQL                                                     09830051
098400        CLOSE EOP-DLR-DPT-CSR                                     09840051
098500     END-EXEC.                                                    09850051
098600                                                                  09860051
098700     MOVE 'N' TO PS-END-OF-EOP-DPT-CURSOR-SW.                     09870051
098800                                                                  09880002
098900                                                                  09890002
099000******************************************************************09900002
099100*                                                                 09910002
099200*FETCH AND PROCESS EOP DEPARTMENT CHANNEL TABLE                   09920013
099300******************************************************************09930002
099400 3100-EOP-DPT-PROCESS.                                            09940002
099500     EXEC SQL                                                     09950002
099600         FETCH EOP-DPT-CSR                                        09960002
099700         INTO  :WKDPTC-DEPT-NBR                                   09970002
099800              ,:WKDPTC-END-INV-COST-AMT                           09980027
BOPISS              ,:PV-END-INV-RTL-AMT-DPT-BOP                        09981061
099900              ,:WKDPTC-FSCL-WK-END-DTE                            09990002
100000     END-EXEC.                                                    10000002
100100                                                                  10010002
100200     EVALUATE SQLCODE                                             10020002
100300         WHEN ZERO                                                10030002
100400             PERFORM 3200-FORMAT-DPT-EOP-RECORD                   10040002
100500         WHEN +100                                                10050002
100600             SET PS-END-OF-EOP-DPT-CSR TO TRUE                    10060002
100700         WHEN OTHER                                               10070002
100800             MOVE '3200-EOP-DPT-PROCESS' TO                       10080002
100900                  PV-PARAGRAPH-NAME                               10090002
101000             PERFORM 9000-SQL-ABEND                               10100002
101100     END-EVALUATE.                                                10110002
101200                                                                  10120002
101300                                                                  10130002
101400******************************************************************10140002
101500*                                                                 10150002
101600*   FORMAT EOP DEPARTMENT RECORDS FROM CHANNEL TABLE              10160035
101700******************************************************************10170002
101800 3200-FORMAT-DPT-EOP-RECORD.                                      10180002
101900     INITIALIZE BP150-RECORD.                                     10190013
102000     INITIALIZE BP150-ACTUAL-INVBAL-BOP-CT.                       10200041
102100     INITIALIZE BP150-ACTUAL-INVBAL-EOP-CT.                       10210041
102200     INITIALIZE BP150-ACTUAL-RECEIPTS.                            10220041
102300     IF PV-CHANNEL = 'P'                                          10230041
102400             MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME7      10240041
102500                                   ,BP150-ORGANIZATION-NAME8      10250041
102600     ELSE  IF PV-CHANNEL = 'V'                                    10260041
102700             MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME7      10270041
102800                                   ,BP150-ORGANIZATION-NAME8      10280041
102900           ELSE                                                   10290041
103000             MOVE PC-TOTALCO     TO BP150-ORGANIZATION-NAME7      10300041
103100                                   ,BP150-ORGANIZATION-NAME8      10310041
103200           END-IF                                                 10320041
103300     END-IF.                                                      10330034
103400     MOVE WKDPTC-DEPT-NBR        TO BP150-DEPARTMENT-NBR7         10340044
103500                                   ,BP150-DEPARTMENT-NBR8.        10350041
103600     MOVE 'DP'                   TO BP150-CLASS-NBR7              10360044
103700                                   ,BP150-CLASS-NBR8.             10370041
103800     MOVE WKDPTC-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           10380002
103900                                                                  10390002
104000     PERFORM 6000-GET-EOP-DATE-ATTRIBUTES.                        10400002
104100                                                                  10410002
104200     MOVE PV-SEASON   TO BP150-SEASON7                            10420044
104300                        ,BP150-SEASON8.                           10430041
104400     MOVE PV-YEAR     TO BP150-YEAR7                              10440044
104500                        ,BP150-YEAR8.                             10450041
104600     MOVE PV-WEEK-NBR TO BP150-WEEK-NBR7                          10460044
104700                        ,BP150-WEEK-NBR8.                         10470041
104800                                                                  10480002
104900** EOP-CST                                                        10490029
105000     DIVIDE WKDPTC-END-INV-COST-AMT BY 1000                       10500029
105100                                    GIVING BP150-EOP-CST.         10510041
105200** EOP-DLR                                                        10520047
105300     MOVE ZEROES      TO BP150-EOP-DLR                            10530041
105400     PERFORM 8000-WRITE-EOP-OUTPUT.                               10540041
BOPISS*    IF PV-CHANNEL = PC-TOTALCO-IND                               10550061
105600        IF PV-BOP-NEEDED                                          10560029
105700           IF PV-WEEK-OF-PERIOD = PV-WEEKS-IN-PERIOD              10570029
105800               MOVE PV-NEXT-PERIOD-FIRST-WEEK TO BP150-WEEK-NBR7  10580041
105900               MOVE PV-NEXT-PERIOD-SEASON     TO BP150-SEASON7    10590041
106000               MOVE PV-NEXT-PERIOD-YEAR       TO BP150-YEAR7      10600041
106100** BOP-CST                                                        10610034
106200               DIVIDE WKDPTC-END-INV-COST-AMT BY 1000             10620034
106300                                    GIVING BP150-BOP-CST          10630041
106400** BOP-DLR                                                        10640047
BOPISS*              MOVE ZEROES      TO BP150-BOP-DLR                  10650061
BOPISS*              PERFORM 7000-WRITE-BOP-OUTPUT                      10660061
BOPISS               DIVIDE PV-END-INV-RTL-AMT-DPT-BOP BY 1000          10661061
BOPISS                                    GIVING BP150-BOP-DLR          10662061
106700** WRITE IS NOT DUPLICATE ONE FOR MTD AND ONE FOR OWP             10670041
106800               PERFORM 7000-WRITE-BOP-OUTPUT.                     10680052
106900 EJECT                                                            10690002
107000******************************************************************10700052
107100*                                                                 10710052
107200*FETCH AND PROCESS EOP DEPARTMENT CHANNEL TABLE                   10720052
107300******************************************************************10730052
107400 3300-EOP-DLR-DPT-PROCESS.                                        10740052
107500     EXEC SQL                                                     10750052
107600         FETCH EOP-DLR-DPT-CSR                                    10760052
107700         INTO  :WKDPTC-DEPT-NBR                                   10770052
107800              ,:WKDPTC-END-INV-RTL-AMT                            10780052
107900              ,:WKDPTC-FSCL-WK-END-DTE                            10790052
108000     END-EXEC.                                                    10800052
108100                                                                  10810052
108200     EVALUATE SQLCODE                                             10820052
108300         WHEN ZERO                                                10830052
108400             PERFORM 3400-FORMAT-DPT-EOP-DLR-RECORD               10840052
108500         WHEN +100                                                10850052
108600             SET PS-END-OF-EOP-DPT-CSR TO TRUE                    10860052
108700         WHEN OTHER                                               10870052
108800             MOVE '3200-EOP-DPT-PROCESS' TO                       10880052
108900                  PV-PARAGRAPH-NAME                               10890052
109000             PERFORM 9000-SQL-ABEND                               10900052
109100     END-EVALUATE.                                                10910052
109200                                                                  10920052
109300                                                                  10930052
109400******************************************************************10940052
109500*                                                                 10950052
109600*   FORMAT EOP DEPARTMENT RECORDS FROM CHANNEL TABLE              10960052
109700******************************************************************10970052
109800 3400-FORMAT-DPT-EOP-DLR-RECORD.                                  10980052
109900     INITIALIZE BP150-RECORD.                                     10990052
110000     INITIALIZE BP150-ACTUAL-INVBAL-BOP-CT.                       11000052
110100     INITIALIZE BP150-ACTUAL-INVBAL-EOP-CT.                       11010052
110200     INITIALIZE BP150-ACTUAL-RECEIPTS.                            11020052
110300     IF PV-CHANNEL = 'P'                                          11030052
110400             MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME7      11040052
110500                                   ,BP150-ORGANIZATION-NAME8      11050052
110600     ELSE  IF PV-CHANNEL = 'V'                                    11060052
110700             MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME7      11070052
110800                                   ,BP150-ORGANIZATION-NAME8      11080052
110900           ELSE                                                   11090052
111000             MOVE PC-TOTALCO     TO BP150-ORGANIZATION-NAME7      11100052
111100                                   ,BP150-ORGANIZATION-NAME8      11110052
111200           END-IF                                                 11120052
111300     END-IF.                                                      11130052
111400     MOVE WKDPTC-DEPT-NBR        TO BP150-DEPARTMENT-NBR7         11140052
111500                                   ,BP150-DEPARTMENT-NBR8.        11150052
111600     MOVE 'DP'                   TO BP150-CLASS-NBR7              11160052
111700                                   ,BP150-CLASS-NBR8.             11170052
111800     MOVE WKDPTC-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           11180052
111900                                                                  11190052
112000     PERFORM 6000-GET-EOP-DATE-ATTRIBUTES.                        11200052
112100                                                                  11210052
112200     MOVE PV-SEASON   TO BP150-SEASON7                            11220052
112300                        ,BP150-SEASON8.                           11230052
112400     MOVE PV-YEAR     TO BP150-YEAR7                              11240052
112500                        ,BP150-YEAR8.                             11250052
112600     MOVE PV-WEEK-NBR TO BP150-WEEK-NBR7                          11260052
112700                        ,BP150-WEEK-NBR8.                         11270052
112800                                                                  11280052
BOPISS*    IF PV-CHANNEL = PC-TOTALCO-IND                               11290061
BOPISS*       IF PV-BOP-NEEDED                                          11300061
BOPISS*          IF PV-WEEK-OF-PERIOD = PV-WEEKS-IN-PERIOD              11310061
BOPISS*              MOVE PV-NEXT-PERIOD-FIRST-WEEK TO BP150-WEEK-NBR7  11320061
BOPISS*              MOVE PV-NEXT-PERIOD-SEASON     TO BP150-SEASON7    11330061
BOPISS*              MOVE PV-NEXT-PERIOD-YEAR       TO BP150-YEAR7      11340061
113500** BOP-DLR                                                        11350052
BOPISS*              DIVIDE WKDPTC-END-INV-RTL-AMT BY 1000              11360061
BOPISS*                                   GIVING BP150-BOP-DLR          11370061
113800** BOP-CST                                                        11380052
BOPISS*              MOVE ZEROES      TO BP150-BOP-CST                  11390061
BOPISS*              PERFORM 7000-WRITE-BOP-OUTPUT.                     11400061
114100 EJECT                                                            11410052
114200******************************************************************11420052
114300*                                                                 11430052
114400*  BOP MAJOR CLASS DATA PROCESS                                   11440052
114500******************************************************************11450052
114600 4000-BOP-CLASS.                                                  11460052
114700                                                                  11470052
114800******************************************************************11480052
114900* PROCESS ALL PHYSSTR DATA                                        11490052
115000******************************************************************11500052
115100     MOVE PC-PHYSSTR-IND TO PV-CHANNEL.                           11510002
115200                                                                  11520002
115300     EXEC SQL                                                     11530002
115400         OPEN BOP-CLS-CSR                                         11540002
115500     END-EXEC.                                                    11550002
115600                                                                  11560002
115700     PERFORM 4100-BOP-CLS-PROCESS                                 11570002
115800             UNTIL PS-END-OF-BOP-CLS-CSR.                         11580002
115900                                                                  11590002
116000     EXEC SQL                                                     11600002
116100        CLOSE BOP-CLS-CSR                                         11610002
116200     END-EXEC.                                                    11620002
116300                                                                  11630002
116400     MOVE 'N' TO PS-END-OF-BOP-CURSOR-SW.                         11640002
116500                                                                  11650002
116600******************************************************************11660002
116700* PROCESS ALL VIRTSTR DATA                                        11670002
116800******************************************************************11680002
116900     MOVE PC-VIRTSTR-IND TO PV-CHANNEL.                           11690002
117000                                                                  11700002
117100     EXEC SQL                                                     11710002
117200         OPEN BOP-CLS-CSR                                         11720002
117300     END-EXEC.                                                    11730002
117400                                                                  11740002
117500     PERFORM 4100-BOP-CLS-PROCESS                                 11750002
117600             UNTIL PS-END-OF-BOP-CLS-CSR.                         11760002
117700                                                                  11770002
117800     EXEC SQL                                                     11780002
117900        CLOSE BOP-CLS-CSR                                         11790002
118000     END-EXEC.                                                    11800002
118100                                                                  11810002
118200     MOVE 'N' TO PS-END-OF-BOP-CURSOR-SW.                         11820002
118300                                                                  11830002
118400******************************************************************11840002
118500* PROCESS ALL TOTALCO DATA                                        11850002
118600******************************************************************11860002
118700     MOVE PC-TOTALCO-IND TO PV-CHANNEL                            11870002
118800                                                                  11880002
118900     EXEC SQL                                                     11890002
119000         OPEN BOP-CLS-CSR                                         11900002
119100     END-EXEC.                                                    11910002
119200                                                                  11920002
119300     PERFORM 4100-BOP-CLS-PROCESS                                 11930002
119400             UNTIL PS-END-OF-BOP-CLS-CSR.                         11940002
119500                                                                  11950002
119600     EXEC SQL                                                     11960002
119700        CLOSE BOP-CLS-CSR                                         11970002
119800     END-EXEC.                                                    11980002
119900                                                                  11990002
120000     MOVE 'N' TO PS-END-OF-BOP-CURSOR-SW.                         12000002
120100                                                                  12010002
120200                                                                  12020002
120300******************************************************************12030002
120400*                                                                 12040002
120500* BEGIN BOP CLASS PROCESS                                         12050002
120600******************************************************************12060002
120700 4100-BOP-CLS-PROCESS.                                            12070002
120800     EXEC SQL                                                     12080002
120900         FETCH BOP-CLS-CSR                                        12090002
121000         INTO  :WKMCLC-DEPT-NBR                                   12100002
121100              ,:WKMCLC-MAJ-CL-NBR                                 12110002
121200              ,:WKMCLC-END-INV-RTL-AMT                            12120029
121300              ,:WKMCLC-END-INV-COST-AMT                           12130029
121400              ,:WKMCLC-FSCL-WK-END-DTE                            12140002
121500     END-EXEC.                                                    12150002
121600                                                                  12160002
121700     EVALUATE SQLCODE                                             12170002
121800         WHEN ZERO                                                12180002
121900             PERFORM 4200-FORMAT-BOP-RECORD                       12190002
122000         WHEN +100                                                12200002
122100             SET PS-END-OF-BOP-CLS-CSR TO TRUE                    12210002
122200         WHEN OTHER                                               12220002
122300             MOVE '4100-BOP-CLS-PROCESS' TO                       12230002
122400                  PV-PARAGRAPH-NAME                               12240002
122500             PERFORM 9000-SQL-ABEND                               12250002
122600     END-EVALUATE.                                                12260002
122700                                                                  12270002
122800                                                                  12280002
122900******************************************************************12290002
123000*                                                                 12300002
123100* PROCESS BOP CLASS RECORDS                                       12310034
123200******************************************************************12320002
123300 4200-FORMAT-BOP-RECORD.                                          12330002
123400     INITIALIZE BP150-RECORD.                                     12340029
123500     INITIALIZE BP150-ACTUAL-INVBAL-BOP-CT                        12350041
123600     INITIALIZE BP150-ACTUAL-RECEIPTS.                            12360029
123700     IF PV-CHANNEL = 'P'                                          12370029
123800             MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME7      12380041
123900     ELSE  IF PV-CHANNEL = 'V'                                    12390029
124000             MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME7      12400041
124100           ELSE                                                   12410029
124200             MOVE PC-TOTALCO     TO BP150-ORGANIZATION-NAME7      12420041
124300           END-IF                                                 12430029
124400     END-IF.                                                      12440029
124500     MOVE WKMCLC-DEPT-NBR        TO BP150-DEPARTMENT-NBR7         12450046
124600     MOVE WKMCLC-MAJ-CL-NBR      TO BP150-CLASS-NBR7              12460046
124700     MOVE WKMCLC-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           12470041
124800                                                                  12480002
124900     PERFORM 6100-GET-BOP-DATE-ATTRIBUTES.                        12490002
125000                                                                  12500002
125100     MOVE PV-SEASON   TO BP150-SEASON7                            12510041
125200     MOVE PV-YEAR     TO BP150-YEAR7                              12520041
125300     MOVE PV-WEEK-NBR TO BP150-WEEK-NBR7                          12530041
125400                                                                  12540002
125500     IF PV-CHANNEL = PC-TOTALCO-IND                               12550002
125600*** BOP-CST                                                       12560034
125700        DIVIDE WKMCLC-END-INV-COST-AMT  BY 1000                   12570034
125800                                    GIVING BP150-BOP-CST          12580041
125900*** EOP/BOP-DLR/CST                                               12590034
126000        MOVE ZEROES TO BP150-BOP-DLR                              12600041
126100     ELSE                                                         12610002
126200*** BOP-CST                                                       12620034
126300        DIVIDE WKMCLC-END-INV-COST-AMT  BY 1000                   12630034
126400                                    GIVING BP150-BOP-CST          12640041
126500*** BOP-DLR                                                       12650034
126600        DIVIDE WKMCLC-END-INV-RTL-AMT  BY 1000                    12660034
126700                                    GIVING BP150-BOP-DLR          12670041
126800*** EOP-CST/DLR                                                   12680034
126900     END-IF.                                                      12690002
127000        PERFORM 7000-WRITE-BOP-OUTPUT.                            12700041
127100                                                                  12710002
127200                                                                  12720002
127300 EJECT                                                            12730002
127400******************************************************************12740002
127500*                                                                 12750002
127600*   BOP DEPARTMENT PROCESS                                        12760035
127700******************************************************************12770002
127800 5000-BOP-DEPT.                                                   12780002
127900                                                                  12790002
128000******************************************************************12800002
128100* PROCESS ALL PHYSSTR DATA                                        12810002
128200******************************************************************12820002
128300     MOVE PC-PHYSSTR-IND TO PV-CHANNEL.                           12830002
128400                                                                  12840002
128500     EXEC SQL                                                     12850002
128600         OPEN BOP-DPT-CSR                                         12860002
128700     END-EXEC.                                                    12870002
128800                                                                  12880002
128900     PERFORM 5100-BOP-DPT-PROCESS                                 12890002
129000             UNTIL PS-END-OF-BOP-DPT-CSR.                         12900002
129100                                                                  12910002
129200     EXEC SQL                                                     12920002
129300        CLOSE BOP-DPT-CSR                                         12930002
129400     END-EXEC.                                                    12940002
129500                                                                  12950002
129600     MOVE 'N' TO PS-END-OF-BOP-DPT-CURSOR-SW.                     12960002
129700                                                                  12970002
129800******************************************************************12980002
129900* PROCESS ALL VIRTSTR DATA                                        12990002
130000******************************************************************13000002
130100     MOVE PC-VIRTSTR-IND TO PV-CHANNEL.                           13010002
130200                                                                  13020002
130300     EXEC SQL                                                     13030002
130400         OPEN BOP-DPT-CSR                                         13040002
130500     END-EXEC.                                                    13050002
130600                                                                  13060002
130700     PERFORM 5100-BOP-DPT-PROCESS                                 13070002
130800             UNTIL PS-END-OF-BOP-DPT-CSR.                         13080002
130900                                                                  13090002
131000     EXEC SQL                                                     13100002
131100        CLOSE BOP-DPT-CSR                                         13110002
131200     END-EXEC.                                                    13120002
131300                                                                  13130002
131400     MOVE 'N' TO PS-END-OF-BOP-DPT-CURSOR-SW.                     13140002
131500                                                                  13150002
131600******************************************************************13160002
131700* PROCESS ALL TOTALCO DATA                                        13170002
131800******************************************************************13180002
131900     MOVE PC-TOTALCO-IND TO PV-CHANNEL.                           13190002
132000                                                                  13200002
132100     EXEC SQL                                                     13210002
132200         OPEN BOP-DPT-CSR                                         13220002
132300     END-EXEC.                                                    13230002
132400                                                                  13240002
132500     PERFORM 5100-BOP-DPT-PROCESS                                 13250002
132600             UNTIL PS-END-OF-BOP-DPT-CSR.                         13260002
132700                                                                  13270002
132800     EXEC SQL                                                     13280002
132900        CLOSE BOP-DPT-CSR                                         13290002
133000     END-EXEC.                                                    13300002
133100                                                                  13310002
133200     MOVE 'N' TO PS-END-OF-BOP-DPT-CURSOR-SW.                     13320002
133300                                                                  13330002
133400                                                                  13340002
133500******************************************************************13350002
133600*                                                                 13360002
133700* BOP DEPARTMENT PROCESS                                          13370034
133800******************************************************************13380002
133900 5100-BOP-DPT-PROCESS.                                            13390002
134000     EXEC SQL                                                     13400002
134100         FETCH BOP-DPT-CSR                                        13410002
134200         INTO  :WKDPTC-DEPT-NBR                                   13420002
134300              ,:WKDPTC-END-INV-COST-AMT                           13430002
134400              ,:WKDPTC-FSCL-WK-END-DTE                            13440002
134500     END-EXEC.                                                    13450002
134600                                                                  13460002
134700     EVALUATE SQLCODE                                             13470002
134800         WHEN ZERO                                                13480002
134900             PERFORM 5200-FORMAT-BOP-RECORD                       13490002
135000         WHEN +100                                                13500002
135100             SET PS-END-OF-BOP-DPT-CSR TO TRUE                    13510002
135200         WHEN OTHER                                               13520002
135300             MOVE '5100-BOP-DPT-PROCESS' TO                       13530002
135400                  PV-PARAGRAPH-NAME                               13540002
135500             PERFORM 9000-SQL-ABEND                               13550002
135600     END-EVALUATE.                                                13560002
135700                                                                  13570002
135800                                                                  13580002
135900******************************************************************13590002
136000*                                                                 13600002
136100*   FORMAT BOP DEPARTMENT                                         13610034
136200******************************************************************13620002
136300 5200-FORMAT-BOP-RECORD.                                          13630002
136400     INITIALIZE BP150-RECORD.                                     13640029
136500     INITIALIZE BP150-ACTUAL-INVBAL-BOP-CT.                       13650041
136600     INITIALIZE BP150-ACTUAL-RECEIPTS.                            13660029
136700     IF PV-CHANNEL = 'P'                                          13670029
136800             MOVE PC-PHYSSTR     TO BP150-ORGANIZATION-NAME7      13680041
136900     ELSE IF PV-CHANNEL = 'V'                                     13690041
137000             MOVE PC-VIRTSTR     TO BP150-ORGANIZATION-NAME7      13700041
137100           ELSE                                                   13710029
137200             MOVE PC-TOTALCO     TO BP150-ORGANIZATION-NAME7      13720041
137300           END-IF                                                 13730029
137400     END-IF.                                                      13740029
137500     MOVE WKDPTC-DEPT-NBR        TO BP150-DEPARTMENT-NBR7.        13750041
137600     MOVE 'DP'                   TO BP150-CLASS-NBR7.             13760041
137700     MOVE WKDPTC-FSCL-WK-END-DTE TO PV-FSCL-WK-END-DTE.           13770041
137800                                                                  13780002
137900     PERFORM 6100-GET-BOP-DATE-ATTRIBUTES.                        13790002
138000                                                                  13800002
138100     MOVE PV-SEASON   TO BP150-SEASON7.                           13810041
138200     MOVE PV-YEAR     TO BP150-YEAR7.                             13820041
138300     MOVE PV-WEEK-NBR TO BP150-WEEK-NBR7.                         13830041
138400** BOP-CST                                                        13840034
138500     DIVIDE WKDPTC-END-INV-COST-AMT BY 1000                       13850029
138600                                    GIVING BP150-BOP-CST.         13860041
138700** BOP-DLR                                                        13870048
138800     MOVE ZEROES      TO BP150-BOP-DLR.                           13880041
138900                                                                  13890002
139000     PERFORM 7000-WRITE-BOP-OUTPUT.                               13900041
139100                                                                  13910002
139200 EJECT                                                            13920002
139300******************************************************************13930002
139400*                                                                *13940002
139500* USING THE FSCL-WK-END-DTE, GET THE SEASON DESCRIPTION, FISCAL  *13950002
139600* YEAR # AND FISCAL WEEK # FROM THE DATE ATTRIBUTE TABLE FOR     *13960002
139700* CREATING THE TIME MEMBER FOR THE FORMATTED AIM FILE.           *13970002
139800*                                                                *13980002
139900******************************************************************13990002
140000 6000-GET-EOP-DATE-ATTRIBUTES.                                    14000002
140100                                                                  14010002
140200     INITIALIZE DPG51                                             14020002
140300                DPG52                                             14030002
140400                DPG53                                             14040002
140500                DPG54                                             14050002
140600                DPG55                                             14060002
140700                DPG56.                                            14070002
140800                                                                  14080002
140900     MOVE PV-FSCL-WK-END-DTE        TO DPG52-LK-DATE-INPUT.       14090002
141000     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      14100002
141100     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      14110002
141200     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                14120002
141300                                             DPG52                14130002
141400                                             DPG53                14140002
141500                                             DPG54                14150002
141600                                             DPG55                14160002
141700                                             DPG56.               14170002
141800     EVALUATE TRUE                                                14180002
141900         WHEN DPG54-NO-ERROR                                      14190002
142000             MOVE DPG56-FISCAL-WEEK-NBR    TO PV-WEEK-NBR         14200002
142100             MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-YEAR             14210002
142200             MOVE DPG56-CURR-FISCAL-SEASON TO PV-SEASON           14220002
142300             MOVE DPG56-FISCAL-PERIOD-WEEK TO PV-WEEK-OF-PERIOD   14230002
142400             MOVE DPG56-NBR-FISCAL-PERIOD-WEEKS                   14240002
142500                                           TO PV-WEEKS-IN-PERIOD  14250002
142600                                                                  14260002
142700         WHEN (DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID)          14270002
142800             DISPLAY '** ABEND ** IN BPKUT445'                    14280065
142900             DISPLAY '6000-GET-EOP-DATE-ATTRIBUTES'               14290002
143000             DISPLAY 'DATE USED AS INPUT ' PV-FSCL-WK-END-DTE     14300002
143100             DISPLAY 'ERROR CALLING THE CALENDAR ROUTINE'         14310002
143200             DISPLAY 'DATE TODAY = ' DPG52-DB2-ISO-DATE           14320002
143300             SET PV-CALENDAR-ROUTINE-ERROR TO TRUE                14330002
143400             PERFORM 9999-ABEND                                   14340002
143500     END-EVALUATE.                                                14350002
143600                                                                  14360002
143700                                                                  14370002
143800******************************************************************14380002
143900*                                                                 14390002
144000*  GET BOP DATE                                                   14400002
144100******************************************************************14410002
144200 6100-GET-BOP-DATE-ATTRIBUTES.                                    14420002
144300                                                                  14430002
144400     INITIALIZE DPG51                                             14440002
144500                DPG52                                             14450002
144600                DPG53                                             14460002
144700                DPG54                                             14470002
144800                DPG55                                             14480002
144900                DPG56.                                            14490002
145000                                                                  14500002
145100     MOVE PV-FSCL-WK-END-DTE        TO DPG52-LK-DATE-INPUT.       14510002
145200     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      14520002
145300     SET DPG51-INCREMENT-DATE       TO TRUE.                      14530002
145400     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      14540002
145500     MOVE 7                         TO DPG51-INCR-DECR-DAYS-9.    14550002
145600     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51                14560002
145700                                             DPG52                14570002
145800                                             DPG53                14580002
145900                                             DPG54                14590002
146000                                             DPG55                14600002
146100                                             DPG56.               14610002
146200     EVALUATE TRUE                                                14620002
146300         WHEN DPG54-NO-ERROR                                      14630002
146400             MOVE DPG56-FISCAL-WEEK-NBR    TO PV-WEEK-NBR         14640002
146500             MOVE DPG56-FISCAL-YEAR-CCYY   TO PV-YEAR             14650002
146600             MOVE DPG56-CURR-FISCAL-SEASON TO PV-SEASON           14660002
146700                                                                  14670002
146800         WHEN (DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID)          14680002
146900             DISPLAY '** ABEND ** IN BPKUT445'                    14690065
147000             DISPLAY '6100-GET-BOP-DATE-ATTRIBUTES'               14700002
147100             DISPLAY 'DATE USED AS INPUT ' PV-FSCL-WK-END-DTE     14710002
147200             DISPLAY 'ERROR CALLING THE CALENDAR ROUTINE'         14720002
147300             DISPLAY 'RESULTING DATE = ' DPG52-DB2-ISO-DATE       14730002
147400             SET PV-CALENDAR-ROUTINE-ERROR TO TRUE                14740002
147500             PERFORM 9999-ABEND                                   14750002
147600     END-EVALUATE.                                                14760002
147700                                                                  14770002
147800 EJECT                                                            14780002
147900******************************************************************14790002
148000* WRITE BOP RECORD TO OUPUT FILE.                                 14800041
148100******************************************************************14810002
148200 7000-WRITE-BOP-OUTPUT.                                           14820041
148300        INITIALIZE BP150-OUTPUT-BOP-RECORD.                       14830041
148400        WRITE BP150-OUTPUT-BOP-RECORD FROM                        14840041
148500                                    BP150-ACTUAL-INVBAL-BOP-CT.   14850045
148600******************************************************************14860041
148700* WRITE EOP RECORD TO OUPUT FILE.                                 14870041
148800******************************************************************14880041
148900 8000-WRITE-EOP-OUTPUT.                                           14890041
149000        INITIALIZE BP150-OUTPUT-EOP-RECORD.                       14900041
149100        WRITE BP150-OUTPUT-EOP-RECORD FROM                        14910041
149200                                    BP150-ACTUAL-INVBAL-EOP-CT.   14920045
149300                                                                  14930041
149400******************************************************************14940002
149500*                                                                *14950002
149600*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL   *14960002
149700*                  ERROR OR WARNING CODE OCCURS                  *14970002
149800*                                                                *14980002
149900******************************************************************14990002
150000 9000-SQL-ABEND.                                                  15000002
150100                                                                  15010002
150200     MOVE SQLCODE        TO  SQLCODE2.                            15020002
150300     MOVE SQLERRD(3)     TO  SQLERRD3.                            15030002
150400                                                                  15040002
150500     DISPLAY '***************************'                        15050002
150600     DISPLAY '**       ABEND           **'                        15060002
150700     DISPLAY '**  IN PROGRAM BPKUT445  **'                        15070065
150800     DISPLAY '***************************'                        15080002
150900     DISPLAY '** PARAGRAPH **      = ' PV-PARAGRAPH-NAME          15090002
151000     DISPLAY '** OPERATION **      = ' PV-DB2-OPER-ATTEMPTED      15100002
151100     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  15110002
151200     DISPLAY '** SQLCODE **        = ' SQLCODE2.                  15120002
151300                                                                  15130002
151400     SET PV-DB2-ERROR   TO TRUE.                                  15140002
151500     PERFORM 9999-ABEND.                                          15150002
151600                                                                  15160002
151700 9999-ABEND.                                                      15170002
151800     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         15180002
