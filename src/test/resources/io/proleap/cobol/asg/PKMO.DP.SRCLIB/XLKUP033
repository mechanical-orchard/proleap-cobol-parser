000100 IDENTIFICATION DIVISION.                                                 
000200 PROGRAM-ID.    XLKUP033.                                                 
000300 AUTHOR.        PAUL OMAN.                                                
000400                                                                          
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  DECEMBER 2003.                                            
000700 DATE-COMPILED.                                                           
000800                                                                          
000900 ENVIRONMENT DIVISION.                                                    
001000 CONFIGURATION SECTION.                                                   
001100 SOURCE-COMPUTER. IBM-3090.                                               
001200 OBJECT-COMPUTER. IBM-3090.                                               
001300                                                                          
002000****************************************************************          
002100*                                                              *          
002101*  NOTE: THERE IS A BATCH VERSION OF THIS PROGRAM CALLED       *          
002102*        XLKUP046.  ANY CHANGES MADE TO THIS PROGRAM           *          
002103*        SHOULD ALSO BE MADE IN THE BATCH VERSION.             *          
002104*                                                              *          
002200*  MODULE IS USED TO WRITE DATA TO THE EAI EXPORT TABLES       *          
002300*  WITHIN THE LOGISTICS DOMAIN. CALLING PROGRAMS USE COPYBOOK  *          
002400*  XLWS072 TO PASS DATA TO THIS MODULE.                        *          
002500*      THIS PROGRAM THEN INSERTS ROWS INTO PCT_BUS_EVNT_EXPRT  *          
002600*  (PCT00011) OR SUT_BUS_EVNT_EXPRT (SUT00037).  THEN IF THERE *          
002700*  IS DETAIL TO INSERT, IT INSERTS INTO PCT_BUS_EVNT_DTL       *          
002800*  (PCT00012) OR SUT_BUS_EVNT_DTL (SUT00038) DEPENDING ON THE  *          
002900*  COPYBOOK NAME PASSED. THE TWO COPYBOOKS THAT ARE CURRENTLY  *          
003000*  PASSED ARE PCWS242 AND SUWS050.                             *          
003010*                                                              *          
003100*  DB2 ACCESS:                                                 *          
003200*     NOTE: THERE ARE TWO SETS OF IDENTICAL TABLES THAT        *          
003300*           ARE ACCESSED IN THIS PROGRAM AND THEY ARE          *          
003400*           LISTED BELOW.  THE XL072-APP-ID-EXPORT-CDE         *          
003500*           DETERMINES WHAT SET TO ACCESS.                     *          
003600*                                                              *          
003700*     PCT_BUS_EVNT (PCT00008) TABLE                            *          
003800*     SUT_BUS_EVNT (SUT00034) TABLE                            *          
003900*                SELECTS                                       *          
004000*                                                              *          
004100*     PCT_BUS_EVNT_MPNG (PCT00010) TABLE                       *          
004200*     SUT_BUS_EVNT_MPNG (SUT00036) TABLE                       *          
004300*                FETCHES                                       *          
004400*                                                              *          
004500*     PCT_BUS_EVNT_EXPRT (PCT00011) TABLE                      *          
004600*     SUT_BUS_EVNT_EXPRT (SUT00037) TABLE                      *          
004700*                INSERTS                                       *          
004800*                                                              *          
004900*     PCT_BUS_EVNT_DTL (PCT00012) TABLE                        *          
005000*     SUT_BUS_EVNT_DTL (SUT00038) TABLE                        *          
005100*                INSERTS                                       *          
005200*                                                              *          
005400****************************************************************          
005500*                                                              *          
005600*     USED BY CICS PROGRAMS.                                   *          
005700*                                                              *          
005800*  COPYBOOK: XLWS072                                           *          
005900*            SUWS050                                           *          
006000*            PCWS242                                           *          
006100*                                                              *          
006300****************************************************************          
006400                                                                          
006500 DATA DIVISION.                                                           
006600 WORKING-STORAGE SECTION.                                                 
006700                                                                          
006800 01  PV-CHARACTER-FIELDS.                                                 
006900     05  PV-CURRENT-DATE          PIC X(10)  VALUE SPACES.                
007000     05  PV-CURRENT-TIMESTAMP     PIC X(26)  VALUE SPACES.                
007100     05  PV-CURRENT-TIME          PIC X(08)  VALUE SPACES.                
007200     05  PV-EVNT-OBJ-TXT          PIC X(40)  VALUE SPACES.                
007300     05  PV-EVNT-OBJ-ACTN-TXT     PIC X(40)  VALUE SPACES.                
007400     05  PV-EVNT-KEY-TXT          PIC X(40)  VALUE SPACES.                
007500     05  PV-TEXT.                                                         
007600         10  PV-TEXT-BYTE OCCURS 4000 TIMES                               
007700                                  PIC X(01).                              
007800                                                                          
007900 01  PV-COMP-FIELDS.                                                      
008000     05  PV-RETRY-COUNTER         PIC S9(04) VALUE 0 COMP.                
008100     05  PV-ASSOCIATE-COUNT       PIC S9(09) VALUE 0 COMP.                
008200     05  PV-SET-SEQ-NBR           PIC S9(09) VALUE 0 COMP.                
008300     05  PV-NULL                  PIC S9(04) VALUE -1 COMP.               
008400     05  PV-REF-ID-NULL           PIC S9(04) VALUE  0 COMP.               
008500     05  PV-EVNT-KY-1-NBR-NULL    PIC S9(04) VALUE  0 COMP.               
008600     05  PV-EVNT-KY-2-NBR-NULL    PIC S9(04) VALUE  0 COMP.               
008700     05  PV-EVNT-KY-3-NBR-NULL    PIC S9(04) VALUE  0 COMP.               
008800     05  PV-EVNT-KY-4-NBR-NULL    PIC S9(04) VALUE  0 COMP.               
008900     05  PV-EVNT-KY-5-NBR-NULL    PIC S9(04) VALUE  0 COMP.               
009000     05  PV-EVNT-KY-1-TXT-NULL    PIC S9(04) VALUE  0 COMP.               
009100     05  PV-EVNT-KY-2-TXT-NULL    PIC S9(04) VALUE  0 COMP.               
009200     05  PV-EVNT-KY-3-TXT-NULL    PIC S9(04) VALUE  0 COMP.               
009300     05  PV-EVNT-KY-4-TXT-NULL    PIC S9(04) VALUE  0 COMP.               
009400     05  PV-EVNT-KY-5-TXT-NULL    PIC S9(04) VALUE  0 COMP.               
009500     05  PV-EVNT-KY-1-TMST-NULL   PIC S9(04) VALUE  0 COMP.               
009600     05  PV-EVNT-KY-2-TMST-NULL   PIC S9(04) VALUE  0 COMP.               
009700     05  PV-EVNT-KY-3-TMST-NULL   PIC S9(04) VALUE  0 COMP.               
009800     05  PV-EVNT-KY-4-TMST-NULL   PIC S9(04) VALUE  0 COMP.               
009900     05  PV-EVNT-KY-5-TMST-NULL   PIC S9(04) VALUE  0 COMP.               
010000     05  PV-TEXT-SUB              PIC S9(08) VALUE  0 COMP.               
010100                                                                          
010200 01  PS-SWITCHES.                                                         
010300     05  PS-ERROR-TYPE-SW             PIC X(01)  VALUE 'N'.               
010400         88  PS-REQUIRED-ERROR                   VALUE 'Y'.               
010500         88  PS-EXTRA-INPUT                      VALUE 'N'.               
010600     05  PS-ASSIGNMENT-SW             PIC X(01)  VALUE 'N'.               
010700         88  PS-ASSIGNMENT-FOUND                 VALUE 'Y'.               
010800         88  PS-ASSIGNMENT-NOT-FOUND             VALUE 'N'.               
010900     05  PS-KEYS-MATCH-SW             PIC X(01)  VALUE 'N'.               
011000         88  PS-KEYS-MATCH                       VALUE 'Y'.               
011100         88  PS-KEYS-DONT-MATCH                  VALUE 'N'.               
011200     05  PS-ASSOCIATE-UPDATE-SW       PIC X(01)  VALUE 'N'.               
011300         88  PS-ASSOCIATE-UPDATED                VALUE 'Y'.               
011400         88  PS-ASSOCIATE-NOT-UPDATED            VALUE 'N'.               
011500     05  PS-ASSIGNMENT-UPDATE-SW      PIC X(01)  VALUE 'N'.               
011600         88  PS-ASSIGNMENT-UPDATED               VALUE 'Y'.               
011700         88  PS-ASSIGNMENT-NOT-UPDATED           VALUE 'N'.               
011800     05  PS-END-OF-CURSOR-SW          PIC X(01)  VALUE 'N'.               
011900         88  PS-END-OF-CURSOR                    VALUE 'Y'.               
012000         88  PS-NOT-END-OF-CURSOR                VALUE 'N'.               
012100                                                                          
012200 01  PC-CONSTANTS.                                                        
012300     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.               
012400     05  PC-C                        PIC X      VALUE 'C'.                
012410     05  PC-X                        PIC X      VALUE 'X'.                
012500     05  PC-N                        PIC X      VALUE 'N'.                
012600     05  PC-ASTERISK-LINE            PIC X(40)  VALUE ALL '*'.            
012700     05  PC-FIVE-BLANKS              PIC X(05)  VALUE '     '.            
012800     05  PC-TEN-BLANKS               PIC X(10)  VALUE SPACES.             
012900                                                                          
013000     05  PC-KY-1-NBR                 PIC X(40)  VALUE                     
013100         'EVNT_KY_1_NBR                           '.                      
013200     05  PC-KY-2-NBR                 PIC X(40)  VALUE                     
013300         'EVNT_KY_2_NBR                           '.                      
013400     05  PC-KY-3-NBR                 PIC X(40)  VALUE                     
013500         'EVNT_KY_3_NBR                           '.                      
013600     05  PC-KY-4-NBR                 PIC X(40)  VALUE                     
013700         'EVNT_KY_4_NBR                           '.                      
013800     05  PC-KY-5-NBR                 PIC X(40)  VALUE                     
013900         'EVNT_KY_5_NBR                           '.                      
014000                                                                          
014100     05  PC-KY-1-TMST                PIC X(40)  VALUE                     
014200         'EVNT_KY_1_TMST                          '.                      
014300     05  PC-KY-2-TMST                PIC X(40)  VALUE                     
014400         'EVNT_KY_2_TMST                          '.                      
014500     05  PC-KY-3-TMST                PIC X(40)  VALUE                     
014600         'EVNT_KY_3_TMST                          '.                      
014700     05  PC-KY-4-TMST                PIC X(40)  VALUE                     
014800         'EVNT_KY_4_TMST                          '.                      
014900     05  PC-KY-5-TMST                PIC X(40)  VALUE                     
015000         'EVNT_KY_5_TMST                          '.                      
015100                                                                          
015200     05  PC-KY-1-TXT                 PIC X(40)  VALUE                     
015300         'EVNT_KY_1_TXT                           '.                      
015400     05  PC-KY-2-TXT                 PIC X(40)  VALUE                     
015500         'EVNT_KY_2_TXT                           '.                      
015600     05  PC-KY-3-TXT                 PIC X(40)  VALUE                     
015700         'EVNT_KY_3_TXT                           '.                      
015800     05  PC-KY-4-TXT                 PIC X(40)  VALUE                     
015900         'EVNT_KY_4_TXT                           '.                      
016000     05  PC-KY-5-TXT                 PIC X(40)  VALUE                     
016100         'EVNT_KY_5_TXT                           '.                      
016200                                                                          
016300****************************************************************          
016400*    PCT00008 - PCT_BUS_EVNT                                   *          
016500*    PCT00010 - PCT_BUS_EVNT_MPNG                              *          
016600*    PCT00011 - PCT_BUS_EVNT_EXPRT                             *          
016700*    PCT00012 - PCT_BUS_EVNT_DTL                               *          
016800*                                                              *          
016900*    SUT00034 - SUT_BUS_EVNT                                   *          
017000*    SUT00036 - SUT_BUS_EVNT_MPNG                              *          
017100*    SUT00037 - SUT_BUS_EVNT_EXPRT                             *          
017200*    SUT00038 - SUT_BUS_EVNT_DTL                               *          
017300*                                                              *          
017400****************************************************************          
017500                                                                          
017600     EXEC SQL                                                             
017700         INCLUDE PCT00008                                                 
017800     END-EXEC.                                                            
017900                                                                          
018000     EXEC SQL                                                             
018100         INCLUDE PCT00010                                                 
018200     END-EXEC.                                                            
018300                                                                          
018400     EXEC SQL                                                             
018500         INCLUDE PCT00011                                                 
018600     END-EXEC.                                                            
018700                                                                          
018800                                                                          
018900     EXEC SQL                                                             
019000         INCLUDE PCT00012                                                 
019100     END-EXEC.                                                            
019200                                                                          
019300     EXEC SQL                                                             
019400         INCLUDE SUT00034                                                 
019500     END-EXEC.                                                            
019600                                                                          
019700     EXEC SQL                                                             
019800         INCLUDE SUT00036                                                 
019900     END-EXEC.                                                            
020000                                                                          
020100     EXEC SQL                                                             
020200         INCLUDE SUT00037                                                 
020300     END-EXEC.                                                            
020400                                                                          
020500     EXEC SQL                                                             
020600         INCLUDE SUT00038                                                 
020700     END-EXEC.                                                            
020800                                                                          
020900     EXEC SQL                                                             
021000          INCLUDE SQLCA                                                   
021100     END-EXEC.                                                            
021200                                                                          
021300 01  PV-TABLE-KEYS.                                                       
021400     05  PV-TABLE-SUB             PIC S9(4)  VALUE 0 COMP.                
021500     05  PV-TABLE-SUB-COMMAREA    PIC S9(4)  VALUE 0 COMP.                
021600     05  PV-TABLE-MAX             PIC S9(4)  VALUE 0 COMP.                
021700     05  PV-TABLE-KEY-VALUE OCCURS 50 TIMES                               
021800                                  PIC X(40).                              
021900     05  PV-KEY-VALUES OCCURS 50 TIMES.                                   
022000         10  PV-TABLE-KEY-NAME    PIC X(40).                              
022100         10  PV-EXISTS-COMMAREA   PIC X(01).                              
022200             88  PV-PRESENT-IN-COMMAREA       VALUE 'Y'.                  
022300             88  PV-NOT-PRESENT-IN-COMMAREA   VALUE 'N'.                  
022400         10  PV-EXISTS-DB2-TABLE  PIC X(01).                              
022500             88  PV-PRESENT-IN-DB2-TABLE      VALUE 'Y'.                  
022600             88  PV-NOT-PRESENT-IN-DB2-TABLE  VALUE 'N'.                  
022700                                                                          
022800     EXEC SQL                                                             
022900        DECLARE PCT-MAPPING-CSR CURSOR FOR                                
023000         SELECT                                                           
023100                MPNG.EVNT_OBJ_TXT                                         
023200               ,MPNG.EVNT_OBJ_ACTN_TXT                                    
023300               ,MPNG.EVNT_KY_TXT                                          
023400               ,MPNG.ATTR_DESC                                            
023500               ,MPNG.CRE_TMST                                             
023600               ,MPNG.CRE_BY_USR_ID                                        
023700                                                                          
023800          FROM  PCT_BUS_EVNT_MPNG  MPNG                                   
023900                                                                          
024000         WHERE  MPNG.EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT                 
024100           AND  MPNG.EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT            
024200      ORDER BY  MPNG.EVNT_OBJ_TXT                                         
024300               ,MPNG.EVNT_OBJ_ACTN_TXT                                    
024400               ,MPNG.EVNT_KY_TXT                                          
024500     END-EXEC.                                                            
024600                                                                          
024700     EXEC SQL                                                             
024800        DECLARE SUT-MAPPING-CSR CURSOR FOR                                
024900         SELECT                                                           
025000                MPNG.EVNT_OBJ_TXT                                         
025100               ,MPNG.EVNT_OBJ_ACTN_TXT                                    
025200               ,MPNG.EVNT_KY_TXT                                          
025300               ,MPNG.ATTR_DESC                                            
025400               ,MPNG.CRE_TMST                                             
025500               ,MPNG.CRE_BY_USR_ID                                        
025600                                                                          
025700          FROM  SUT_BUS_EVNT_MPNG  MPNG                                   
025800                                                                          
025900         WHERE  MPNG.EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT                 
026000           AND  MPNG.EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT            
026100      ORDER BY  MPNG.EVNT_OBJ_TXT                                         
026200               ,MPNG.EVNT_OBJ_ACTN_TXT                                    
026300               ,MPNG.EVNT_KY_TXT                                          
026400     END-EXEC.                                                            
026500                                                                          
026600 LINKAGE SECTION.                                                         
026700     COPY XLWS072.                                                        
026800                                                                          
026900     COPY PCWS242.                                                        
027000                                                                          
027100     COPY SUWS050.                                                        
027200                                                                          
027300                                                                          
027400 PROCEDURE DIVISION USING XL072-EAI-EXPORT-COMMAREA.                      
027500                                                                          
027600     SET XL072-SUCCESSFUL  TO TRUE.                                       
027700                                                                          
027800     EVALUATE TRUE                                                        
027900         WHEN XL072-VALID-APP-ID                                          
028000              PERFORM 1000-VALIDATE-INPUT-FIELDS                          
028100                                                                          
028200         WHEN OTHER                                                       
028300              SET XL072-APP-ID-CODE-MISSING TO TRUE                       
028400                                                                          
028500     END-EVALUATE.                                                        
028600                                                                          
028700     GOBACK.                                                              
028800                                                                          
028900                                                                          
029000****************************************************************          
029100*    VALIDATE THAT ALL INPUT FIELDS ARE PRESENT.               *          
029200*        THIS VARIES DEPENDING ON THE TYPE OF PROCESSING CODE  *          
029300*        THAT IS BEING REQUESTED.                              *          
029400*                                                              *          
029500*        STOP PROCESSING AND RETURN IF THERE ARE ANY ERRORS.   *          
029600*                                                              *          
029700****************************************************************          
029800                                                                          
029900 1000-VALIDATE-INPUT-FIELDS.                                              
030000                                                                          
030100     EVALUATE TRUE                                                        
030200         WHEN XL072-VALID-COPYBOOK                                        
030300              EVALUATE TRUE                                               
030400                  WHEN XL072-CRE-BY-USR-ID = SPACES                       
030500                       SET XL072-CRE-BY-FIELDS-MISSING TO TRUE            
030600                                                                          
030700                  WHEN XL072-CRE-PGM-NM = SPACES                          
030800                       SET XL072-CRE-BY-FIELDS-MISSING TO TRUE            
030900                                                                          
031000                  WHEN OTHER                                              
031100                       CONTINUE                                           
031200                                                                          
031300              END-EVALUATE                                                
031400                                                                          
031500         WHEN OTHER                                                       
031600              SET XL072-COPYBOOK-NM-MISSING TO TRUE                       
031700                                                                          
031800     END-EVALUATE.                                                        
031900                                                                          
032000     IF XL072-SUCCESSFUL                                                  
032100        IF XL072-COMMIT-UPDATE OR                                         
032200           XL072-DO-NOT-COMMIT-UPDATE                                     
032300           PERFORM 8400-GET-TIMESTAMP                                     
032400           PERFORM 2000-VALIDATE-INPUT-VALUES                             
032500        ELSE                                                              
032600           SET XL072-COMMIT-CODE-INVALID TO TRUE                          
032700        END-IF                                                            
032800                                                                          
032900     END-IF.                                                              
033000                                                                          
033100****************************************************************          
033200*    CURRENTLY TWO APPLICATION CODES ARE VALID:                *          
033300*        PC - PCWS242 COPYBOOK                                 *          
033400*        SU - SUWS050 COPYBOOK                                 *          
033500*        THESE COPYBOOKS REDEFINE XL072-DTL-TXT IN THE XLWS072 *          
033600*            COPYBOOK.                                         *          
033700*                                                              *          
033900****************************************************************          
034000                                                                          
034100 2000-VALIDATE-INPUT-VALUES.                                              
034200                                                                          
034300     EVALUATE TRUE                                                        
034400         WHEN XL072-PC-APP-ID                                             
034500*             **************************************************          
034600*             *                                                *          
034700*             *                                                *          
034800*             **************************************************          
034900              MOVE XL072-EVNT-OBJ-TXT      TO PV-EVNT-OBJ-TXT             
035000              MOVE XL072-EVNT-OBJ-ACTN-TXT TO PV-EVNT-OBJ-ACTN-TXT        
035100                                                                          
035200         WHEN XL072-SU-APP-ID                                             
035300*             **************************************************          
035400*             *                                                *          
035500*             *                                                *          
035600*             **************************************************          
035700              MOVE XL072-EVNT-OBJ-TXT      TO PV-EVNT-OBJ-TXT             
035800              MOVE XL072-EVNT-OBJ-ACTN-TXT TO PV-EVNT-OBJ-ACTN-TXT        
035900                                                                          
036000                                                                          
036100     END-EVALUATE.                                                        
036200                                                                          
036300     PERFORM 3000-SELECT-BUSINESS-EVENT.                                  
036400                                                                          
036500     IF XL072-SUCCESSFUL                                                  
036600        PERFORM 4000-PROCESS-MAPPING                                      
036700     END-IF.                                                              
036800                                                                          
036900     IF XL072-SUCCESSFUL                                                  
037000        IF XL072-COMMIT-UPDATE                                            
037100           PERFORM 8000-SYNCPOINT                                         
037200        END-IF                                                            
037300     END-IF.                                                              
037400                                                                          
037500                                                                          
037600****************************************************************          
037700*    DEPENDING ON THE APPLICATION CODE, THE APPROPRIATE SET    *          
037800*        OF TABLES ARE READ (PCT OR SUT).                      *          
037900*                                                              *          
038000****************************************************************          
038100                                                                          
038200 3000-SELECT-BUSINESS-EVENT.                                              
038300                                                                          
038400     PERFORM                                                              
038500         WITH TEST AFTER                                                  
038600         VARYING PV-RETRY-COUNTER                                         
038700         FROM 1 BY 1                                                      
038800         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
038900            OR SQLCODE = ZERO                                             
039000            OR SQLCODE = +100                                             
039100                                                                          
039200         IF XL072-PC-APP-ID                                               
039300            EXEC SQL                                                      
039400                SELECT                                                    
039500                       EVNT_TYP_CDE                                       
039600                      ,CNFRMN_REQD_CDE                                    
039700                      ,CRE_TMST                                           
039800                      ,CRE_BY_USR_ID                                      
039900                      ,NOTES_TXT                                          
040000                 INTO                                                     
040100                       :PCT00008-EVNT-TYP-CDE                             
040200                      ,:PCT00008-CNFRMN-REQD-CDE                          
040300                      ,:PCT00008-CRE-TMST                                 
040400                      ,:PCT00008-CRE-BY-USR-ID                            
040500                      ,:PCT00008-NOTES-TXT                                
040600                                                                          
040700                 FROM  PCT_BUS_EVNT                                       
040800                WHERE  EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT               
040900                  AND  EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT          
041000            END-EXEC                                                      
041100         ELSE                                                             
041200            EXEC SQL                                                      
041300                SELECT                                                    
041400                       EVNT_TYP_CDE                                       
041500                      ,CNFRMN_REQD_CDE                                    
041600                      ,CRE_TMST                                           
041700                      ,CRE_BY_USR_ID                                      
041800                      ,NOTES_TXT                                          
041900                 INTO                                                     
042000                       :SUT00034-EVNT-TYP-CDE                             
042100                      ,:SUT00034-CNFRMN-REQD-CDE                          
042200                      ,:SUT00034-CRE-TMST                                 
042300                      ,:SUT00034-CRE-BY-USR-ID                            
042400                      ,:SUT00034-NOTES-TXT                                
042500                                                                          
042600                 FROM  SUT_BUS_EVNT                                       
042700                WHERE  EVNT_OBJ_TXT      = :PV-EVNT-OBJ-TXT               
042800                  AND  EVNT_OBJ_ACTN_TXT = :PV-EVNT-OBJ-ACTN-TXT          
042900            END-EXEC                                                      
043000         END-IF                                                           
043100                                                                          
043200         EVALUATE TRUE                                                    
043300             WHEN SQLCODE = ZERO                                          
043400                  SET PS-ASSIGNMENT-FOUND TO TRUE                         
043500                                                                          
043600             WHEN SQLCODE = +100                                          
043700                  SET PS-ASSIGNMENT-NOT-FOUND TO TRUE                     
043800                  SET XL072-INVALID-BUS-EVNT  TO TRUE                     
043900                                                                          
044000             WHEN SQLCODE = -904                                          
044100             WHEN SQLCODE = -913                                          
044200             WHEN SQLCODE = -911                                          
044300                  CONTINUE                                                
044400                                                                          
044500             WHEN SQLWARN0 NOT = SPACES                                   
044600             WHEN SQLCODE NOT = ZERO                                      
044700                  MOVE +4             TO PV-RETRY-COUNTER                 
044800         END-EVALUATE                                                     
044900     END-PERFORM.                                                         
045000                                                                          
045100     IF SQLCODE = ZERO OR                                                 
045200        SQLCODE = +100                                                    
045300        CONTINUE                                                          
045400     ELSE                                                                 
045500        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
045600           SET XL072-SQL-ERROR TO TRUE                                    
045700           MOVE SQLCODE        TO XL072-EAI-DB-SQLCODE                    
045800           MOVE '3000-'        TO XL072-SQL-ERROR-PARA                    
045900           MOVE SQLCA          TO XL072-SQLCA                             
046000        END-IF                                                            
046100     END-IF.                                                              
046200                                                                          
046300                                                                          
046400****************************************************************          
046500*    THE MAPPING TABLES ARE USED TO VALIDATE WHETHER THE RIGHT *          
046600*        FIELDS HAVE BEEN PASSED IN THE COMMAREA.  THERE ARE   *          
046700*        TWO SETS OF ERRORS                                    *          
046800*                                                              *          
046900*                                                              *          
047000*    FIRST, ALL OF THE KEY FIELDS THAT AREN'T ZERO OR SPACES   *          
047100*           IN THE COMMAREA ARE LOADED INTO A TABLE IN         *          
047200*           SEQUENCE IN WHICH THEY WILL BE FETCHED FROM THE    *          
047300*           MAPPING TABLE.                                     *          
047400*                                                              *          
047500*    SECOND, THE APPROPRIATE MAPPING TABLE IS READ.  FOR EACH  *          
047600*            ROW READ, THE EVNT_KY_TXT FIELD IS COMPARED       *          
047700*            AGAINST THE TABLE LOADED FROM THE COMMAREA TO     *          
047800*            SEE IF THAT ROW WAS PASSED.                       *          
047900*                                                              *          
048200****************************************************************          
048300                                                                          
048400 4000-PROCESS-MAPPING.                                                    
048500                                                                          
048600     PERFORM 4100-TABLE-COMMAREA-KEY-FIELDS.                              
048700                                                                          
048800     MOVE 0   TO PV-TABLE-SUB.                                            
048900     SET PS-NOT-END-OF-CURSOR TO TRUE.                                    
049000                                                                          
049100     PERFORM 4200-OPEN-MAPPING-CURSOR.                                    
049200     PERFORM 4400-FETCH-MAPPING-DATA.                                     
049300                                                                          
049400     PERFORM UNTIL (PS-END-OF-CURSOR)                                     
049500                                                                          
049600         PERFORM 4400-FETCH-MAPPING-DATA                                  
049700                                                                          
049800     END-PERFORM.                                                         
049900                                                                          
050000     PERFORM 4600-CLOSE-MAPPING-CURSOR.                                   
050100                                                                          
050200     IF XL072-SUCCESSFUL                                                  
050300        PERFORM 5100-FORMAT-EVNT-EXPRT                                    
050400        PERFORM 5200-INSERT-EXPORT-TABLE                                  
050500                                                                          
050600        IF XL072-SUCCESSFUL                                               
050700           IF XL072-COPYBOOK-NOT-USED                                     
050800              CONTINUE                                                    
050900           ELSE                                                           
051000              PERFORM 5300-FORMAT-EVNT-DTL                                
051100              PERFORM 5400-INSERT-DETAIL-TEXT                             
051200           END-IF                                                         
051300        END-IF                                                            
051400     END-IF.                                                              
051500                                                                          
051600                                                                          
051700****************************************************************          
051800*    LOAD ALL OF THE KEY VALUES FROM THE COMMAREA INTO A       *          
051900*    TABLE IN THE SAME SEQUENCE IN WHICH THEY WILL BE FETCHED. *          
052000*                                                              *          
052200*                                                              *          
052300*    AS YOU FETCH EACH ROW FROM THE MAPPING TABLE, COMPARE     *          
052400*    TO THE NEXT ENTRY IN THE TABLE.  IF IT DOESN'T MATCH,     *          
052500*    THERE IS AN ERROR.                                        *          
052600*                                                              *          
052700****************************************************************          
052800                                                                          
052900 4100-TABLE-COMMAREA-KEY-FIELDS.                                          
053000                                                                          
053100     INITIALIZE PV-TABLE-KEYS.                                            
053200                                                                          
053300     MOVE 0   TO PV-TABLE-SUB.                                            
053400     MOVE 50  TO PV-TABLE-MAX.                                            
053500                                                                          
053600     IF XL072-EVNT-KY-1-NBR = 0                                           
053700        MOVE PV-NULL TO PV-EVNT-KY-1-NBR-NULL                             
053800     ELSE                                                                 
053900        ADD 1 TO PV-TABLE-SUB                                             
054000        MOVE 0 TO PV-EVNT-KY-1-NBR-NULL                                   
054100        MOVE PC-KY-1-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
054200                                                                          
054300     IF XL072-EVNT-KY-1-TMST = SPACES                                     
054400        MOVE PV-NULL TO PV-EVNT-KY-1-TMST-NULL                            
054500     ELSE                                                                 
054600        ADD 1 TO PV-TABLE-SUB                                             
054700        MOVE 0 TO PV-EVNT-KY-1-TMST-NULL                                  
054800        MOVE PC-KY-1-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).           
054900                                                                          
055000     IF XL072-EVNT-KY-1-TXT = SPACES                                      
055100        MOVE PV-NULL TO PV-EVNT-KY-1-TXT-NULL                             
055200     ELSE                                                                 
055300        ADD 1 TO PV-TABLE-SUB                                             
055400        MOVE 0 TO PV-EVNT-KY-1-TXT-NULL                                   
055500        MOVE PC-KY-1-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
055600                                                                          
055700     IF XL072-EVNT-KY-2-NBR = 0                                           
055800        MOVE PV-NULL TO PV-EVNT-KY-2-NBR-NULL                             
055900     ELSE                                                                 
056000        ADD 1 TO PV-TABLE-SUB                                             
056100        MOVE 0 TO PV-EVNT-KY-2-NBR-NULL                                   
056200        MOVE PC-KY-2-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
056300                                                                          
056400     IF XL072-EVNT-KY-2-TMST = SPACES                                     
056500        MOVE PV-NULL TO PV-EVNT-KY-2-TMST-NULL                            
056600     ELSE                                                                 
056700        ADD 1 TO PV-TABLE-SUB                                             
056800        MOVE 0 TO PV-EVNT-KY-2-TMST-NULL                                  
056900        MOVE PC-KY-2-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).           
057000                                                                          
057100     IF XL072-EVNT-KY-2-TXT = SPACES                                      
057200        MOVE PV-NULL TO PV-EVNT-KY-2-TXT-NULL                             
057300     ELSE                                                                 
057400        ADD 1 TO PV-TABLE-SUB                                             
057500        MOVE 0 TO PV-EVNT-KY-2-TXT-NULL                                   
057600        MOVE PC-KY-2-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
057700                                                                          
057800     IF XL072-EVNT-KY-3-NBR = 0                                           
057900        MOVE PV-NULL TO PV-EVNT-KY-3-NBR-NULL                             
058000     ELSE                                                                 
058100        ADD 1 TO PV-TABLE-SUB                                             
058200        MOVE 0 TO PV-EVNT-KY-3-NBR-NULL                                   
058300        MOVE PC-KY-3-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
058400                                                                          
058500     IF XL072-EVNT-KY-3-TMST = SPACES                                     
058600        MOVE PV-NULL TO PV-EVNT-KY-3-TMST-NULL                            
058700     ELSE                                                                 
058800        ADD 1 TO PV-TABLE-SUB                                             
058900        MOVE 0 TO PV-EVNT-KY-3-TMST-NULL                                  
059000        MOVE PC-KY-3-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).           
059100                                                                          
059200     IF XL072-EVNT-KY-3-TXT = SPACES                                      
059300        MOVE PV-NULL TO PV-EVNT-KY-3-TXT-NULL                             
059400     ELSE                                                                 
059500        ADD 1 TO PV-TABLE-SUB                                             
059600        MOVE 0 TO PV-EVNT-KY-3-TXT-NULL                                   
059700        MOVE PC-KY-3-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
059800                                                                          
059900     IF XL072-EVNT-KY-4-NBR = 0                                           
060000        MOVE PV-NULL TO PV-EVNT-KY-4-NBR-NULL                             
060100     ELSE                                                                 
060200        ADD 1 TO PV-TABLE-SUB                                             
060300        MOVE 0 TO PV-EVNT-KY-4-NBR-NULL                                   
060400        MOVE PC-KY-4-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
060500                                                                          
060600     IF XL072-EVNT-KY-4-TMST = SPACES                                     
060700        MOVE PV-NULL TO PV-EVNT-KY-4-TMST-NULL                            
060800     ELSE                                                                 
060900        ADD 1 TO PV-TABLE-SUB                                             
061000        MOVE 0 TO PV-EVNT-KY-4-TMST-NULL                                  
061100        MOVE PC-KY-4-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).           
061200                                                                          
061300     IF XL072-EVNT-KY-4-TXT = SPACES                                      
061400        MOVE PV-NULL TO PV-EVNT-KY-4-TXT-NULL                             
061500     ELSE                                                                 
061600        ADD 1 TO PV-TABLE-SUB                                             
061700        MOVE 0 TO PV-EVNT-KY-4-TXT-NULL                                   
061800        MOVE PC-KY-4-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
061900                                                                          
062000     IF XL072-EVNT-KY-5-NBR = 0                                           
062100        MOVE PV-NULL TO PV-EVNT-KY-5-NBR-NULL                             
062200     ELSE                                                                 
062300        ADD 1 TO PV-TABLE-SUB                                             
062400        MOVE 0 TO PV-EVNT-KY-5-NBR-NULL                                   
062500        MOVE PC-KY-5-NBR TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
062600                                                                          
062700     IF XL072-EVNT-KY-5-TMST = SPACES                                     
062800        MOVE PV-NULL TO PV-EVNT-KY-5-TMST-NULL                            
062900     ELSE                                                                 
063000        ADD 1 TO PV-TABLE-SUB                                             
063100        MOVE 0 TO PV-EVNT-KY-5-TMST-NULL                                  
063200        MOVE PC-KY-5-TMST TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).           
063300                                                                          
063400     IF XL072-EVNT-KY-5-TXT = SPACES                                      
063500        MOVE PV-NULL TO PV-EVNT-KY-5-TXT-NULL                             
063600     ELSE                                                                 
063700        ADD 1 TO PV-TABLE-SUB                                             
063800        MOVE 0 TO PV-EVNT-KY-5-TXT-NULL                                   
063900        MOVE PC-KY-5-TXT TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB).            
064000                                                                          
064100                                                                          
064300****************************************************************          
064400*                                                              *          
064500*                                                              *          
064600****************************************************************          
064700                                                                          
064800 4200-OPEN-MAPPING-CURSOR.                                                
064900                                                                          
065000     PERFORM                                                              
065100         WITH TEST AFTER                                                  
065200         VARYING PV-RETRY-COUNTER                                         
065300         FROM 1 BY 1                                                      
065400         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
065500            OR SQLCODE = ZERO                                             
065600            OR SQLCODE = +100                                             
065700                                                                          
065800         EVALUATE TRUE                                                    
065900             WHEN XL072-PC-APP-ID                                         
066000                  EXEC SQL                                                
066100                       OPEN  PCT-MAPPING-CSR                              
066200                  END-EXEC                                                
066300                                                                          
066400             WHEN XL072-SU-APP-ID                                         
066500                  EXEC SQL                                                
066600                       OPEN  SUT-MAPPING-CSR                              
066700                  END-EXEC                                                
066800                                                                          
066900         END-EVALUATE                                                     
067000                                                                          
067100         EVALUATE TRUE                                                    
067200             WHEN SQLCODE = ZERO                                          
067300                  CONTINUE                                                
067400                                                                          
067500             WHEN SQLCODE = -904                                          
067600             WHEN SQLCODE = -913                                          
067700             WHEN SQLCODE = -911                                          
067800                                                                          
067900             WHEN SQLCODE = +100                                          
068000                  MOVE 0 TO PV-ASSOCIATE-COUNT                            
068100                                                                          
068200             WHEN SQLWARN0 NOT = SPACES                                   
068300             WHEN SQLCODE NOT = ZERO                                      
068400                  MOVE +4             TO PV-RETRY-COUNTER                 
068500         END-EVALUATE                                                     
068600     END-PERFORM.                                                         
068700                                                                          
068800     IF SQLCODE = ZERO OR                                                 
068900        SQLCODE = +100                                                    
069000        CONTINUE                                                          
069100     ELSE                                                                 
069200        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
069300           SET XL072-SQL-ERROR TO TRUE                                    
069400           MOVE SQLCODE        TO XL072-EAI-DB-SQLCODE                    
069500           MOVE '4200-'        TO XL072-SQL-ERROR-PARA                    
069600           MOVE SQLCA          TO XL072-SQLCA                             
069700        END-IF                                                            
069800     END-IF.                                                              
069900                                                                          
070000****************************************************************          
070100*                                                              *          
070200*                                                              *          
070300****************************************************************          
070400                                                                          
070500 4400-FETCH-MAPPING-DATA.                                                 
070600                                                                          
070700     PERFORM                                                              
070800         WITH TEST AFTER                                                  
070900         VARYING PV-RETRY-COUNTER                                         
071000         FROM 1 BY 1                                                      
071100         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
071200            OR SQLCODE = ZERO                                             
071300            OR SQLCODE = +100                                             
071400                                                                          
071500         EVALUATE TRUE                                                    
071600             WHEN XL072-PC-APP-ID                                         
071700                  EXEC SQL                                                
071800                      FETCH  PCT-MAPPING-CSR                              
071900                                                                          
072000                       INTO  :PCT00010-EVNT-OBJ-TXT                       
072100                            ,:PCT00010-EVNT-OBJ-ACTN-TXT                  
072200                            ,:PCT00010-EVNT-KY-TXT                        
072300                            ,:PCT00010-ATTR-DESC                          
072400                            ,:PCT00010-CRE-TMST                           
072500                            ,:PCT00010-CRE-BY-USR-ID                      
072600                                                                          
072700                  END-EXEC                                                
072800                                                                          
072900             WHEN XL072-SU-APP-ID                                         
073000                  EXEC SQL                                                
073100                      FETCH  SUT-MAPPING-CSR                              
073200                                                                          
073300                       INTO  :SUT00036-EVNT-OBJ-TXT                       
073400                            ,:SUT00036-EVNT-OBJ-ACTN-TXT                  
073500                            ,:SUT00036-EVNT-KY-TXT                        
073600                            ,:SUT00036-ATTR-DESC                          
073700                            ,:SUT00036-CRE-TMST                           
073800                            ,:SUT00036-CRE-BY-USR-ID                      
073900                                                                          
074000                  END-EXEC                                                
074100                                                                          
074200         END-EVALUATE                                                     
074300                                                                          
074400         EVALUATE TRUE                                                    
074500             WHEN SQLCODE = ZERO                                          
074600**??              PERFORM 4800-INTERPRET-MAPPING                          
074700                                                                          
074800                                                                          
074900             WHEN SQLCODE = -904                                          
075000             WHEN SQLCODE = -911                                          
075100             WHEN SQLCODE = -913                                          
075200                  CONTINUE                                                
075300                                                                          
075400             WHEN SQLCODE = +100                                          
075500                  SET PS-END-OF-CURSOR TO TRUE                            
075600**??              PERFORM 4800-INTERPRET-MAPPING                          
075700                                                                          
075800             WHEN SQLWARN0 NOT = SPACES                                   
075900             WHEN SQLCODE NOT = ZERO                                      
076000                  MOVE +4             TO PV-RETRY-COUNTER                 
076100         END-EVALUATE                                                     
076200     END-PERFORM.                                                         
076300                                                                          
076400     IF SQLCODE = ZERO OR                                                 
076500        SQLCODE = +100                                                    
076600        CONTINUE                                                          
076700     ELSE                                                                 
076800        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
076900           MOVE SQLCODE TO XL072-EAI-DB-SQLCODE                           
077000           SET XL072-SQL-ERROR      TO TRUE                               
077100           MOVE '4400-'        TO XL072-SQL-ERROR-PARA                    
077200           MOVE SQLCA          TO XL072-SQLCA                             
077300        END-IF                                                            
077400     END-IF.                                                              
077500                                                                          
077600****************************************************************          
077700*                                                              *          
077800*                                                              *          
077900****************************************************************          
078000                                                                          
078100 4600-CLOSE-MAPPING-CURSOR.                                               
078200                                                                          
078300     PERFORM                                                              
078400         WITH TEST AFTER                                                  
078500         VARYING PV-RETRY-COUNTER                                         
078600         FROM 1 BY 1                                                      
078700         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
078800            OR SQLCODE = ZERO                                             
078900            OR SQLCODE = +100                                             
079000                                                                          
079100         EVALUATE TRUE                                                    
079200             WHEN XL072-PC-APP-ID                                         
079300                  EXEC SQL                                                
079400                       CLOSE PCT-MAPPING-CSR                              
079500                  END-EXEC                                                
079600                                                                          
079700             WHEN XL072-SU-APP-ID                                         
079800                  EXEC SQL                                                
079900                       CLOSE SUT-MAPPING-CSR                              
080000                  END-EXEC                                                
080100                                                                          
080200         END-EVALUATE                                                     
080300                                                                          
080400         EVALUATE TRUE                                                    
080500             WHEN SQLCODE = ZERO                                          
080600                  CONTINUE                                                
080700                                                                          
080800             WHEN SQLCODE = -904                                          
080900             WHEN SQLCODE = -913                                          
081000             WHEN SQLCODE = -911                                          
081100                                                                          
081200             WHEN SQLCODE = +100                                          
081300                  MOVE 0 TO PV-ASSOCIATE-COUNT                            
081400                                                                          
081500             WHEN SQLWARN0 NOT = SPACES                                   
081600             WHEN SQLCODE NOT = ZERO                                      
081700                  MOVE +4             TO PV-RETRY-COUNTER                 
081800         END-EVALUATE                                                     
081900     END-PERFORM.                                                         
082000                                                                          
082100     IF SQLCODE = ZERO OR                                                 
082200        SQLCODE = +100                                                    
082300        CONTINUE                                                          
082400     ELSE                                                                 
082500        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
082600           SET XL072-SQL-ERROR TO TRUE                                    
082700           MOVE SQLCODE        TO XL072-EAI-DB-SQLCODE                    
082800           MOVE '4600-'        TO XL072-SQL-ERROR-PARA                    
082900           MOVE SQLCA          TO XL072-SQLCA                             
083000        END-IF                                                            
083100     END-IF.                                                              
083200                                                                          
083300****************************************************************          
083400*    ROUTINE COMPARES THE MAPPING KEY TXT VALUE FROM THE       *          
083500*    PCT00010 OR SUT00037 TABLE TO WHETHER A VALUE WAS PASSED  *          
083600*    IN THE COMMAREA FROM THE CALLING PROGRAM.                 *          
083700*                                                              *          
083800*    FOR EXAMPLE, IF THE CALLING PROGRAM FILLS IN A VALUE FOR  *          
083900*        XL072-EVNT-KY-1-NBR                                   *          
084000*        XL072-EVNT-KY-1-TMST                                  *          
084100*        XL072-EVNT-KY-2-NBR    AND                            *          
084200*        THE PCT00010 TABLE HAS ROWS CONTAINING THE FOLLOWING  *          
084300*            VALUES IN THE EVNT_KY_TXT COLUMN.                 *          
084400*              EVNT-KY-1-NBR                                   *          
084500*              EVNT-KY-1-TXT                                   *          
084600*              EVNT-KY-2-NBR                                   *          
084700*            THERE IS AN ERROR ON THE INPUT BECAUSE THE        *          
084800*                  XL072-EVNT-KY-1-TXT  WASN'T FILLED IN AND   *          
084900*                  IS REQUIRED.                                *          
085000*            THERE ALSO IS AN ERROR BECAUSE THE                *          
085100*                  XL072-EVNT-KY-1-TMST WAS FILLED IN AND      *          
085200*                  SHOULD NOT HAVE BEEN.                       *          
085300*                                                              *          
085500****************************************************************          
085600                                                                          
085700 4800-INTERPRET-MAPPING.                                                  
085800                                                                          
085900     IF PV-TABLE-KEY-VALUE (PV-TABLE-SUB) = ALL '9'                       
086000        CONTINUE                                                          
086100     ELSE                                                                 
086200        ADD 1 TO PV-TABLE-SUB                                             
086300        IF PV-TABLE-KEY-VALUE (PV-TABLE-SUB) = SPACES                     
086400           MOVE ALL '9' TO PV-TABLE-KEY-VALUE (PV-TABLE-SUB)              
086500        END-IF                                                            
086600     END-IF.                                                              
086700                                                                          
086800     IF XL072-PC-APP-ID                                                   
086900        IF PS-END-OF-CURSOR                                               
087000           MOVE ALL '9' TO  PCT00010-EVNT-KY-TXT                          
087100        END-IF                                                            
087200        EVALUATE TRUE                                                     
087300            WHEN PCT00010-EVNT-KY-TXT = PV-TABLE-KEY-VALUE                
087400                                              (PV-TABLE-SUB)              
087500                                                                          
087600                 SET PS-KEYS-MATCH TO TRUE                                
087700                                                                          
087800            WHEN PCT00010-EVNT-KY-TXT > PV-TABLE-KEY-VALUE                
087900                                              (PV-TABLE-SUB)              
088000                 SET PS-KEYS-DONT-MATCH TO TRUE                           
088100                 SET PS-EXTRA-INPUT     TO TRUE                           
088200                 MOVE PV-TABLE-KEY-VALUE (PV-TABLE-SUB) TO                
088300                                               PV-EVNT-KEY-TXT            
088400                                                                          
088500            WHEN PCT00010-EVNT-KY-TXT < PV-TABLE-KEY-VALUE                
088600                                              (PV-TABLE-SUB)              
088700                 SET PS-KEYS-DONT-MATCH TO TRUE                           
088800                 SET PS-REQUIRED-ERROR  TO TRUE                           
088900                 MOVE PCT00010-EVNT-KY-TXT TO PV-EVNT-KEY-TXT             
089000                                                                          
089100        END-EVALUATE                                                      
089200                                                                          
089300     ELSE                                                                 
089400        IF PS-END-OF-CURSOR                                               
089500           MOVE ALL '9' TO  SUT00036-EVNT-KY-TXT                          
089600        END-IF                                                            
089700        EVALUATE TRUE                                                     
089800            WHEN SUT00036-EVNT-KY-TXT = PV-TABLE-KEY-VALUE                
089900                                              (PV-TABLE-SUB)              
090000                 SET PS-KEYS-MATCH TO TRUE                                
090100                                                                          
090200            WHEN SUT00036-EVNT-KY-TXT > PV-TABLE-KEY-VALUE                
090300                                              (PV-TABLE-SUB)              
090400                 SET PS-KEYS-DONT-MATCH TO TRUE                           
090500                 SET PS-EXTRA-INPUT     TO TRUE                           
090600                 MOVE PV-TABLE-KEY-VALUE (PV-TABLE-SUB) TO                
090700                                               PV-EVNT-KEY-TXT            
090800                                                                          
090900            WHEN SUT00036-EVNT-KY-TXT < PV-TABLE-KEY-VALUE                
091000                                              (PV-TABLE-SUB)              
091100**??             SET PS-KEYS-DONT-MATCH TO TRUE                           
091200**??             SET PS-REQUIRED-ERROR  TO TRUE                           
091300                 MOVE SUT00036-EVNT-KY-TXT TO PV-EVNT-KEY-TXT             
091400                                                                          
091500        END-EVALUATE                                                      
091600                                                                          
091700     END-IF.                                                              
091800                                                                          
091900****************************************************************          
092000*    IF A FIELD IN THE COMMAREA IS ENTERED AND NOT REQUIRED    *          
092100*       OR A FIELD IN THE COMMARA ISN'T ENTERED AND IS         *          
092200*       REQUIRED, THE PS-KEYS-DONT-MATCH SWITCH IS SET.        *          
092300*                                                              *          
092400*       THE PV-EVNT-KEY-TXT FIELD CONTAINS THE FIELD THAT IS   *          
092500*       ERROR (EVNT_KY_1_NBR, EVNT_KY_1_TXT, OR EVNT_KY_1_TMST *          
092600*       THIS FIELD IS THEN INTERPRETED TO SET THE APPROPRIATE  *          
092700*       ERROR CODE.                                            *          
092800*                                                              *          
092900****************************************************************          
093000                                                                          
093100     IF PS-KEYS-DONT-MATCH                                                
093200        EVALUATE TRUE                                                     
093300            WHEN PV-EVNT-KEY-TXT (11:4) = 'NBR '                          
093400                 EVALUATE TRUE                                            
093500                     WHEN PV-EVNT-KEY-TXT (9:1) = '1'                     
093600                          IF PS-REQUIRED-ERROR                            
093700                             SET XL072-KY1-NBR-REQD  TO TRUE              
093800                          ELSE                                            
093900                             SET XL072-KY1-NBR-INVALID TO TRUE            
094000                          END-IF                                          
094100                                                                          
094200                     WHEN PV-EVNT-KEY-TXT (9:1) = '2'                     
094300                          IF PS-REQUIRED-ERROR                            
094400                             SET XL072-KY2-NBR-REQD  TO TRUE              
094500                          ELSE                                            
094600                             SET XL072-KY2-NBR-INVALID TO TRUE            
094700                          END-IF                                          
094800                                                                          
094900                     WHEN PV-EVNT-KEY-TXT (9:1) = '3'                     
095000                          IF PS-REQUIRED-ERROR                            
095100                             SET XL072-KY3-NBR-REQD  TO TRUE              
095200                          ELSE                                            
095300                             SET XL072-KY3-NBR-INVALID TO TRUE            
095400                          END-IF                                          
095500                                                                          
095600                     WHEN PV-EVNT-KEY-TXT (9:1) = '4'                     
095700                          IF PS-REQUIRED-ERROR                            
095800                             SET XL072-KY4-NBR-REQD  TO TRUE              
095900                          ELSE                                            
096000                             SET XL072-KY4-NBR-INVALID TO TRUE            
096100                          END-IF                                          
096200                                                                          
096300                     WHEN PV-EVNT-KEY-TXT (9:1) = '5'                     
096400                          IF PS-REQUIRED-ERROR                            
096500                             SET XL072-KY5-NBR-REQD  TO TRUE              
096600                          ELSE                                            
096700                             SET XL072-KY5-NBR-INVALID TO TRUE            
096800                          END-IF                                          
096900                                                                          
097000                     WHEN OTHER                                           
097100                          SET XL072-INVALID-KEY-VALUE TO TRUE             
097200                                                                          
097300                 END-EVALUATE                                             
097400                                                                          
097500            WHEN PV-EVNT-KEY-TXT (11:4) = 'TMST'                          
097600                 EVALUATE TRUE                                            
097700                     WHEN PV-EVNT-KEY-TXT (9:1) = '1'                     
097800                          IF PS-REQUIRED-ERROR                            
097900                             SET XL072-KY1-TMST-REQD TO TRUE              
098000                          ELSE                                            
098100                             SET XL072-KY1-TMST-INVALID TO TRUE           
098200                          END-IF                                          
098300                                                                          
098400                     WHEN PV-EVNT-KEY-TXT (9:1) = '2'                     
098500                          IF PS-REQUIRED-ERROR                            
098600                             SET XL072-KY2-TMST-REQD TO TRUE              
098700                          ELSE                                            
098800                             SET XL072-KY2-TMST-INVALID TO TRUE           
098900                          END-IF                                          
099000                                                                          
099100                     WHEN PV-EVNT-KEY-TXT (9:1) = '3'                     
099200                          IF PS-REQUIRED-ERROR                            
099300                             SET XL072-KY3-TMST-REQD TO TRUE              
099400                          ELSE                                            
099500                             SET XL072-KY3-TMST-INVALID TO TRUE           
099600                          END-IF                                          
099700                                                                          
099800                     WHEN PV-EVNT-KEY-TXT (9:1) = '4'                     
099900                          IF PS-REQUIRED-ERROR                            
100000                             SET XL072-KY4-TMST-REQD TO TRUE              
100100                          ELSE                                            
100200                             SET XL072-KY4-TMST-INVALID TO TRUE           
100300                          END-IF                                          
100400                                                                          
100500                     WHEN PV-EVNT-KEY-TXT (9:1) = '5'                     
100600                          IF PS-REQUIRED-ERROR                            
100700                             SET XL072-KY5-TMST-REQD TO TRUE              
100800                          ELSE                                            
100900                             SET XL072-KY5-TMST-INVALID TO TRUE           
101000                          END-IF                                          
101100                                                                          
101200                     WHEN OTHER                                           
101300                          SET XL072-INVALID-KEY-VALUE TO TRUE             
101400                                                                          
101500                 END-EVALUATE                                             
101600                                                                          
101700            WHEN PV-EVNT-KEY-TXT (11:4) = 'TXT '                          
101800                 EVALUATE TRUE                                            
101900                     WHEN PV-EVNT-KEY-TXT (9:1) = '1'                     
102000                          IF PS-REQUIRED-ERROR                            
102100                             SET XL072-KY1-TXT-REQD TO TRUE               
102200                          ELSE                                            
102300                             SET XL072-KY1-TXT-INVALID TO TRUE            
102400                          END-IF                                          
102500                                                                          
102600                     WHEN PV-EVNT-KEY-TXT (9:1) = '2'                     
102700                          IF PS-REQUIRED-ERROR                            
102800                             SET XL072-KY2-TXT-REQD TO TRUE               
102900                          ELSE                                            
103000                             SET XL072-KY2-TXT-INVALID TO TRUE            
103100                          END-IF                                          
103200                                                                          
103300                     WHEN PV-EVNT-KEY-TXT (9:1) = '3'                     
103400                          IF PS-REQUIRED-ERROR                            
103500                             SET XL072-KY3-TXT-REQD TO TRUE               
103600                          ELSE                                            
103700                             SET XL072-KY3-TXT-INVALID TO TRUE            
103800                          END-IF                                          
103900                                                                          
104000                     WHEN PV-EVNT-KEY-TXT (9:1) = '4'                     
104100                          IF PS-REQUIRED-ERROR                            
104200                             SET XL072-KY4-TXT-REQD TO TRUE               
104300                          ELSE                                            
104400                             SET XL072-KY4-TXT-INVALID TO TRUE            
104500                          END-IF                                          
104600                                                                          
104700                     WHEN PV-EVNT-KEY-TXT (9:1) = '5'                     
104800                          IF PS-REQUIRED-ERROR                            
104900                             SET XL072-KY5-TXT-REQD TO TRUE               
105000                          ELSE                                            
105100                             SET XL072-KY5-TXT-INVALID TO TRUE            
105200                          END-IF                                          
105300                                                                          
105400                     WHEN OTHER                                           
105500                          SET XL072-INVALID-KEY-VALUE TO TRUE             
105600                                                                          
105700                 END-EVALUATE                                             
105800                                                                          
105900            WHEN OTHER                                                    
106000                 SET XL072-INVALID-KEY-VALUE TO TRUE                      
106100     END-EVALUATE.                                                        
106200                                                                          
106300     IF XL072-SUCCESSFUL                                                  
106400        CONTINUE                                                          
106500     ELSE                                                                 
106600        SET PS-END-OF-CURSOR TO TRUE                                      
106700     END-IF.                                                              
106800                                                                          
106900****************************************************************          
107100*                                                              *          
107200*                                                              *          
107300****************************************************************          
107400                                                                          
107500 5100-FORMAT-EVNT-EXPRT.                                                  
107600                                                                          
107700     EVALUATE TRUE                                                        
107800         WHEN XL072-PC-APP-ID                                             
107900              INITIALIZE DCLPCT00011                                      
108000              MOVE PV-EVNT-OBJ-TXT      TO PCT00011-EVNT-OBJ-TXT          
108100              MOVE PV-EVNT-OBJ-ACTN-TXT TO                                
108200                               PCT00011-EVNT-OBJ-ACTN-TXT                 
108300              MOVE PV-CURRENT-TIMESTAMP TO PCT00011-CRE-TMST              
108400                                                                          
108500              MOVE XL072-CRE-BY-USR-ID  TO PCT00011-CRE-BY-USR-ID         
108600              MOVE XL072-CRE-PGM-NM     TO PCT00011-CRE-BY-PGM-NM         
108700                                                                          
108800              PERFORM 5150-FORMAT-NULL-COLUMNS                            
108810              IF PCT00011-EVNT-OBJ-TXT = 'SHIPPING'                       
108811               IF (PCT00011-EVNT-OBJ-ACTN-TXT =                           
108812                        'DOOR SUMMARY'                OR                  
108813                  PCT00011-EVNT-OBJ-ACTN-TXT =                            
108814                        'ADD MASTER'                  OR                  
108815                  PCT00011-EVNT-OBJ-ACTN-TXT =                            
108816                        'ADD CHILD TO MASTER'         OR                  
108817                  PCT00011-EVNT-OBJ-ACTN-TXT =                            
108818                        'ADD MASTER TO MASTER'        OR                  
108819                  PCT00011-EVNT-OBJ-ACTN-TXT =                            
108820                        'REMOVE CHILD FROM MASTER'    OR                  
108821                  PCT00011-EVNT-OBJ-ACTN-TXT =                            
108822                        'REMOVE MASTER FROM MASTER'   OR                  
108823                  PCT00011-EVNT-OBJ-ACTN-TXT =                            
108824                        'REASSIGN TO MASTER')                             
108827                    MOVE PC-C TO PCT00011-EXPRT-STAT-CDE                  
108830                 ELSE                                                     
108840                    MOVE PC-X TO PCT00011-EXPRT-STAT-CDE                  
109010                 END-IF                                                   
109011              ELSE                                                        
109012                 MOVE PC-C TO PCT00011-EXPRT-STAT-CDE                     
109013              END-IF                                                      
109100              MOVE PV-CURRENT-TIMESTAMP TO PCT00011-LAST-UPD-TMST         
109200                                                                          
109300         WHEN XL072-SU-APP-ID                                             
109400              INITIALIZE DCLSUT00037                                      
109500                                                                          
109600              MOVE PV-EVNT-OBJ-TXT TO SUT00037-EVNT-OBJ-TXT               
109700              MOVE PV-EVNT-OBJ-ACTN-TXT TO                                
109800                               SUT00037-EVNT-OBJ-ACTN-TXT                 
109900              MOVE PV-CURRENT-TIMESTAMP TO SUT00037-CRE-TMST              
110000                                                                          
110100              MOVE XL072-CRE-BY-USR-ID  TO SUT00037-CRE-BY-USR-ID         
110200              MOVE XL072-CRE-PGM-NM     TO SUT00037-CRE-BY-PGM-NM         
110300                                                                          
110400              PERFORM 5150-FORMAT-NULL-COLUMNS                            
110500                                                                          
110600              MOVE PC-C          TO SUT00037-EXPRT-STAT-CDE               
110700              MOVE PV-CURRENT-TIMESTAMP TO SUT00037-LAST-UPD-TMST         
110800                                                                          
110900     END-EVALUATE.                                                        
111000                                                                          
111100                                                                          
111200 5150-FORMAT-NULL-COLUMNS.                                                
111300                                                                          
111400     IF XL072-REF-ID = SPACES                                             
111500        MOVE PV-NULL TO PV-REF-ID-NULL                                    
111600     ELSE                                                                 
111700        MOVE 0 TO PV-REF-ID-NULL                                          
111800        MOVE XL072-REF-ID TO PCT00011-REF-ID                              
111900        MOVE XL072-REF-ID TO SUT00037-REF-ID.                             
112000                                                                          
112100     IF XL072-EVNT-KY-1-NBR = 0                                           
112200        MOVE PV-NULL TO PV-EVNT-KY-1-NBR-NULL                             
112300     ELSE                                                                 
112400        MOVE 0 TO PV-EVNT-KY-1-NBR-NULL                                   
112500        MOVE XL072-EVNT-KY-1-NBR TO PCT00011-EVNT-KY-1-NBR                
112600        MOVE XL072-EVNT-KY-1-NBR TO SUT00037-EVNT-KY-1-NBR.               
112700                                                                          
112800     IF XL072-EVNT-KY-2-NBR = 0                                           
112900        MOVE PV-NULL TO PV-EVNT-KY-2-NBR-NULL                             
113000     ELSE                                                                 
113100        MOVE 0 TO PV-EVNT-KY-2-NBR-NULL                                   
113200        MOVE XL072-EVNT-KY-2-NBR TO PCT00011-EVNT-KY-2-NBR                
113300        MOVE XL072-EVNT-KY-2-NBR TO SUT00037-EVNT-KY-2-NBR.               
113400                                                                          
113500     IF XL072-EVNT-KY-3-NBR = 0                                           
113600        MOVE PV-NULL TO PV-EVNT-KY-3-NBR-NULL                             
113700     ELSE                                                                 
113800        MOVE 0 TO PV-EVNT-KY-3-NBR-NULL                                   
113900        MOVE XL072-EVNT-KY-3-NBR TO PCT00011-EVNT-KY-3-NBR                
114000        MOVE XL072-EVNT-KY-3-NBR TO SUT00037-EVNT-KY-3-NBR.               
114100                                                                          
114200     IF XL072-EVNT-KY-4-NBR = 0                                           
114300        MOVE PV-NULL TO PV-EVNT-KY-4-NBR-NULL                             
114400     ELSE                                                                 
114500        MOVE 0 TO PV-EVNT-KY-4-NBR-NULL                                   
114600        MOVE XL072-EVNT-KY-4-NBR TO PCT00011-EVNT-KY-4-NBR                
114700        MOVE XL072-EVNT-KY-4-NBR TO SUT00037-EVNT-KY-4-NBR.               
114800                                                                          
114900     IF XL072-EVNT-KY-5-NBR = 0                                           
115000        MOVE PV-NULL TO PV-EVNT-KY-5-NBR-NULL                             
115100     ELSE                                                                 
115200        MOVE 0 TO PV-EVNT-KY-5-NBR-NULL                                   
115300        MOVE XL072-EVNT-KY-5-NBR TO PCT00011-EVNT-KY-5-NBR                
115400        MOVE XL072-EVNT-KY-5-NBR TO SUT00037-EVNT-KY-5-NBR.               
115500                                                                          
115600     IF XL072-EVNT-KY-1-TXT = SPACES                                      
115700        MOVE PV-NULL TO PV-EVNT-KY-1-TXT-NULL                             
115800     ELSE                                                                 
115900        MOVE 0 TO PV-EVNT-KY-1-TXT-NULL                                   
116000        MOVE XL072-EVNT-KY-1-TXT TO PCT00011-EVNT-KY-1-TXT                
116100        MOVE XL072-EVNT-KY-1-TXT TO SUT00037-EVNT-KY-1-TXT.               
116200                                                                          
116300     IF XL072-EVNT-KY-2-TXT = SPACES                                      
116400        MOVE PV-NULL TO PV-EVNT-KY-2-TXT-NULL                             
116500     ELSE                                                                 
116600        MOVE 0 TO PV-EVNT-KY-2-TXT-NULL                                   
116700        MOVE XL072-EVNT-KY-2-TXT TO PCT00011-EVNT-KY-2-TXT                
116800        MOVE XL072-EVNT-KY-2-TXT TO SUT00037-EVNT-KY-2-TXT.               
116900                                                                          
117000     IF XL072-EVNT-KY-3-TXT = SPACES                                      
117100        MOVE PV-NULL TO PV-EVNT-KY-3-TXT-NULL                             
117200     ELSE                                                                 
117300        MOVE 0 TO PV-EVNT-KY-3-TXT-NULL                                   
117400        MOVE XL072-EVNT-KY-3-TXT TO PCT00011-EVNT-KY-3-TXT                
117500        MOVE XL072-EVNT-KY-3-TXT TO SUT00037-EVNT-KY-3-TXT.               
117600                                                                          
117700     IF XL072-EVNT-KY-4-TXT = SPACES                                      
117800        MOVE PV-NULL TO PV-EVNT-KY-4-TXT-NULL                             
117900     ELSE                                                                 
118000        MOVE 0 TO PV-EVNT-KY-4-TXT-NULL                                   
118100        MOVE XL072-EVNT-KY-4-TXT TO PCT00011-EVNT-KY-4-TXT                
118200        MOVE XL072-EVNT-KY-4-TXT TO SUT00037-EVNT-KY-4-TXT.               
118300                                                                          
118400     IF XL072-EVNT-KY-5-TXT = SPACES                                      
118500        MOVE PV-NULL TO PV-EVNT-KY-5-TXT-NULL                             
118600     ELSE                                                                 
118700        MOVE 0 TO PV-EVNT-KY-5-TXT-NULL                                   
118800        MOVE XL072-EVNT-KY-5-TXT TO PCT00011-EVNT-KY-5-TXT                
118900        MOVE XL072-EVNT-KY-5-TXT TO SUT00037-EVNT-KY-5-TXT.               
119000                                                                          
119100     IF XL072-EVNT-KY-1-TMST = SPACES                                     
119200        MOVE PV-NULL TO PV-EVNT-KY-1-TMST-NULL                            
119300     ELSE                                                                 
119400        MOVE 0 TO PV-EVNT-KY-1-TMST-NULL                                  
119500        MOVE XL072-EVNT-KY-1-TMST TO PCT00011-EVNT-KY-1-TMST              
119600        MOVE XL072-EVNT-KY-1-TMST TO SUT00037-EVNT-KY-1-TMST.             
119700                                                                          
119800     IF XL072-EVNT-KY-2-TMST = SPACES                                     
119900        MOVE PV-NULL TO PV-EVNT-KY-2-TMST-NULL                            
120000     ELSE                                                                 
120100        MOVE 0 TO PV-EVNT-KY-2-TMST-NULL                                  
120200        MOVE XL072-EVNT-KY-2-TMST TO PCT00011-EVNT-KY-2-TMST              
120300        MOVE XL072-EVNT-KY-2-TMST TO SUT00037-EVNT-KY-2-TMST.             
120400                                                                          
120500     IF XL072-EVNT-KY-3-TMST = SPACES                                     
120600        MOVE PV-NULL TO PV-EVNT-KY-3-TMST-NULL                            
120700     ELSE                                                                 
120800        MOVE 0 TO PV-EVNT-KY-3-TMST-NULL                                  
120900        MOVE XL072-EVNT-KY-3-TMST TO PCT00011-EVNT-KY-3-TMST              
121000        MOVE XL072-EVNT-KY-3-TMST TO SUT00037-EVNT-KY-3-TMST.             
121100                                                                          
121200     IF XL072-EVNT-KY-4-TMST = SPACES                                     
121300        MOVE PV-NULL TO PV-EVNT-KY-4-TMST-NULL                            
121400     ELSE                                                                 
121500        MOVE 0 TO PV-EVNT-KY-4-TMST-NULL                                  
121600        MOVE XL072-EVNT-KY-4-TMST TO PCT00011-EVNT-KY-4-TMST              
121700        MOVE XL072-EVNT-KY-4-TMST TO SUT00037-EVNT-KY-4-TMST.             
121800                                                                          
121900     IF XL072-EVNT-KY-5-TMST = SPACES                                     
122000        MOVE PV-NULL TO PV-EVNT-KY-5-TMST-NULL                            
122100     ELSE                                                                 
122200        MOVE 0 TO PV-EVNT-KY-5-TMST-NULL                                  
122300        MOVE XL072-EVNT-KY-5-TMST TO PCT00011-EVNT-KY-5-TMST              
122400        MOVE XL072-EVNT-KY-5-TMST TO SUT00037-EVNT-KY-5-TMST.             
122500                                                                          
122600                                                                          
122700 5200-INSERT-EXPORT-TABLE.                                                
122800                                                                          
122900     PERFORM                                                              
123000         WITH TEST AFTER                                                  
123100         VARYING PV-RETRY-COUNTER                                         
123200         FROM 1 BY 1                                                      
123300         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
123400            OR SQLCODE = ZERO                                             
123500                                                                          
123600         EVALUATE TRUE                                                    
123700             WHEN XL072-PC-APP-ID                                         
123800                  EXEC SQL                                                
123900                     INSERT INTO PCT_BUS_EVNT_EXPRT                       
124000                           (EVNT_OBJ_TXT                                  
124100                           ,EVNT_OBJ_ACTN_TXT                             
124200                           ,CRE_TMST                                      
124300                           ,CRE_BY_USR_ID                                 
124400                           ,CRE_BY_PGM_NM                                 
124500                           ,REF_ID                                        
124600                           ,EVNT_KY_1_NBR                                 
124700                           ,EVNT_KY_2_NBR                                 
124800                           ,EVNT_KY_3_NBR                                 
124900                           ,EVNT_KY_4_NBR                                 
125000                           ,EVNT_KY_5_NBR                                 
125100                           ,EVNT_KY_1_TXT                                 
125200                           ,EVNT_KY_2_TXT                                 
125300                           ,EVNT_KY_3_TXT                                 
125400                           ,EVNT_KY_4_TXT                                 
125500                           ,EVNT_KY_5_TXT                                 
125600                           ,EVNT_KY_1_TMST                                
125700                           ,EVNT_KY_2_TMST                                
125800                           ,EVNT_KY_3_TMST                                
125900                           ,EVNT_KY_4_TMST                                
126000                           ,EVNT_KY_5_TMST                                
126100                           ,EXPRT_STAT_CDE                                
126200                           ,LAST_UPD_TMST                                 
126300                           ,EVNT_PRTY_NBR)                                
126400                                                                          
126500                    VALUES (:PCT00011-EVNT-OBJ-TXT                        
126600                           ,:PCT00011-EVNT-OBJ-ACTN-TXT                   
126700                           ,:PCT00011-CRE-TMST                            
126800                           ,:PCT00011-CRE-BY-USR-ID                       
126900                           ,:PCT00011-CRE-BY-PGM-NM                       
127000                           ,:PCT00011-REF-ID                              
127100                                     :PV-REF-ID-NULL                      
127200                           ,:PCT00011-EVNT-KY-1-NBR                       
127300                                     :PV-EVNT-KY-1-NBR-NULL               
127400                           ,:PCT00011-EVNT-KY-2-NBR                       
127500                                     :PV-EVNT-KY-2-NBR-NULL               
127600                           ,:PCT00011-EVNT-KY-3-NBR                       
127700                                     :PV-EVNT-KY-3-NBR-NULL               
127800                           ,:PCT00011-EVNT-KY-4-NBR                       
127900                                     :PV-EVNT-KY-4-NBR-NULL               
128000                           ,:PCT00011-EVNT-KY-5-NBR                       
128100                                     :PV-EVNT-KY-5-NBR-NULL               
128200                           ,:PCT00011-EVNT-KY-1-TXT                       
128300                                     :PV-EVNT-KY-1-TXT-NULL               
128400                           ,:PCT00011-EVNT-KY-2-TXT                       
128500                                     :PV-EVNT-KY-2-TXT-NULL               
128600                           ,:PCT00011-EVNT-KY-3-TXT                       
128700                                     :PV-EVNT-KY-3-TXT-NULL               
128800                           ,:PCT00011-EVNT-KY-4-TXT                       
128900                                     :PV-EVNT-KY-4-TXT-NULL               
129000                           ,:PCT00011-EVNT-KY-5-TXT                       
129100                                     :PV-EVNT-KY-5-TXT-NULL               
129200                           ,:PCT00011-EVNT-KY-1-TMST                      
129300                                     :PV-EVNT-KY-1-TMST-NULL              
129400                           ,:PCT00011-EVNT-KY-2-TMST                      
129500                                     :PV-EVNT-KY-2-TMST-NULL              
129600                           ,:PCT00011-EVNT-KY-3-TMST                      
129700                                     :PV-EVNT-KY-3-TMST-NULL              
129800                           ,:PCT00011-EVNT-KY-4-TMST                      
129900                                     :PV-EVNT-KY-4-TMST-NULL              
130000                           ,:PCT00011-EVNT-KY-5-TMST                      
130100                                     :PV-EVNT-KY-5-TMST-NULL              
130200                           ,:PCT00011-EXPRT-STAT-CDE                      
130300                           ,:PCT00011-LAST-UPD-TMST                       
130400                           ,:PCT00011-EVNT-PRTY-NBR)                      
130500                  END-EXEC                                                
130600                                                                          
130700             WHEN XL072-SU-APP-ID                                         
130800                  EXEC SQL                                                
130900                     INSERT INTO SUT_BUS_EVNT_EXPRT                       
131000                           (EVNT_OBJ_TXT                                  
131100                           ,EVNT_OBJ_ACTN_TXT                             
131200                           ,CRE_TMST                                      
131300                           ,CRE_BY_USR_ID                                 
131400                           ,CRE_BY_PGM_NM                                 
131500                           ,REF_ID                                        
131600                           ,EVNT_KY_1_NBR                                 
131700                           ,EVNT_KY_2_NBR                                 
131800                           ,EVNT_KY_3_NBR                                 
131900                           ,EVNT_KY_4_NBR                                 
132000                           ,EVNT_KY_5_NBR                                 
132100                           ,EVNT_KY_1_TXT                                 
132200                           ,EVNT_KY_2_TXT                                 
132300                           ,EVNT_KY_3_TXT                                 
132400                           ,EVNT_KY_4_TXT                                 
132500                           ,EVNT_KY_5_TXT                                 
132600                           ,EVNT_KY_1_TMST                                
132700                           ,EVNT_KY_2_TMST                                
132800                           ,EVNT_KY_3_TMST                                
132900                           ,EVNT_KY_4_TMST                                
133000                           ,EVNT_KY_5_TMST                                
133100                           ,EXPRT_STAT_CDE                                
133200                           ,LAST_UPD_TMST                                 
133300                           ,EVNT_PRTY_NBR)                                
133400                                                                          
133500                    VALUES (:SUT00037-EVNT-OBJ-TXT                        
133600                           ,:SUT00037-EVNT-OBJ-ACTN-TXT                   
133700                           ,:SUT00037-CRE-TMST                            
133800                           ,:SUT00037-CRE-BY-USR-ID                       
133900                           ,:SUT00037-CRE-BY-PGM-NM                       
134000                           ,:SUT00037-REF-ID                              
134100                                     :PV-REF-ID-NULL                      
134200                           ,:SUT00037-EVNT-KY-1-NBR                       
134300                                     :PV-EVNT-KY-1-NBR-NULL               
134400                           ,:SUT00037-EVNT-KY-2-NBR                       
134500                                     :PV-EVNT-KY-2-NBR-NULL               
134600                           ,:SUT00037-EVNT-KY-3-NBR                       
134700                                     :PV-EVNT-KY-3-NBR-NULL               
134800                           ,:SUT00037-EVNT-KY-4-NBR                       
134900                                     :PV-EVNT-KY-4-NBR-NULL               
135000                           ,:SUT00037-EVNT-KY-5-NBR                       
135100                                     :PV-EVNT-KY-5-NBR-NULL               
135200                           ,:SUT00037-EVNT-KY-1-TXT                       
135300                                     :PV-EVNT-KY-1-TXT-NULL               
135400                           ,:SUT00037-EVNT-KY-2-TXT                       
135500                                     :PV-EVNT-KY-2-TXT-NULL               
135600                           ,:SUT00037-EVNT-KY-3-TXT                       
135700                                     :PV-EVNT-KY-3-TXT-NULL               
135800                           ,:SUT00037-EVNT-KY-4-TXT                       
135900                                     :PV-EVNT-KY-4-TXT-NULL               
136000                           ,:SUT00037-EVNT-KY-5-TXT                       
136100                                     :PV-EVNT-KY-5-TXT-NULL               
136200                           ,:SUT00037-EVNT-KY-1-TMST                      
136300                                     :PV-EVNT-KY-1-TMST-NULL              
136400                           ,:SUT00037-EVNT-KY-2-TMST                      
136500                                     :PV-EVNT-KY-2-TMST-NULL              
136600                           ,:SUT00037-EVNT-KY-3-TMST                      
136700                                     :PV-EVNT-KY-3-TMST-NULL              
136800                           ,:SUT00037-EVNT-KY-4-TMST                      
136900                                     :PV-EVNT-KY-4-TMST-NULL              
137000                           ,:SUT00037-EVNT-KY-5-TMST                      
137100                                     :PV-EVNT-KY-5-TMST-NULL              
137200                           ,:SUT00037-EXPRT-STAT-CDE                      
137300                           ,:SUT00037-LAST-UPD-TMST                       
137400                           ,:SUT00037-EVNT-PRTY-NBR)                      
137500                                                                          
137600                  END-EXEC                                                
137700                                                                          
137800         END-EVALUATE                                                     
137900                                                                          
138000         EVALUATE TRUE                                                    
138100             WHEN SQLCODE = ZERO                                          
138200                  EXEC SQL SET :PV-SET-SEQ-NBR =                          
138300                                IDENTITY_VAL_LOCAL ()                     
138400                  END-EXEC                                                
138500                                                                          
138600                  IF SQLCODE = 0                                          
138700                     CONTINUE                                             
138800                  ELSE                                                    
138900                     SET XL072-SQL-ERROR      TO TRUE                     
139000                     MOVE SQLCODE TO XL072-EAI-DB-SQLCODE                 
139100                     MOVE '5200-'        TO XL072-SQL-ERROR-PARA          
139200                     MOVE SQLCA          TO XL072-SQLCA                   
139300                  END-IF                                                  
139400                                                                          
139500             WHEN SQLCODE = -904                                          
139600             WHEN SQLCODE = -913                                          
139700             WHEN SQLCODE = -911                                          
139800                 CONTINUE                                                 
139900             WHEN SQLWARN0 NOT = SPACES                                   
140000             WHEN SQLCODE NOT = ZERO                                      
140100                  MOVE +4             TO PV-RETRY-COUNTER                 
140200                                                                          
140300         END-EVALUATE                                                     
140400     END-PERFORM.                                                         
140500                                                                          
140600     IF SQLCODE = 0                                                       
140700        CONTINUE                                                          
140800     ELSE                                                                 
140900        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
141000           SET XL072-SQL-ERROR      TO TRUE                               
141100           MOVE SQLCODE TO XL072-EAI-DB-SQLCODE                           
141200           MOVE '5200-'        TO XL072-SQL-ERROR-PARA                    
141300           MOVE SQLCA          TO XL072-SQLCA                             
141400        END-IF                                                            
141500     END-IF.                                                              
141600                                                                          
141700****************************************************************          
141800*                                                              *          
141900*                                                              *          
142000*                                                              *          
142100****************************************************************          
142200                                                                          
142300 5300-FORMAT-EVNT-DTL.                                                    
142400                                                                          
142500     EVALUATE TRUE                                                        
142600         WHEN XL072-PC-APP-ID                                             
142700              INITIALIZE DCLPCT00012                                      
142800              MOVE PV-SET-SEQ-NBR TO PCT00012-EVNT-EXPRT-ID               
142900              MOVE 1 TO PCT00012-EVNT-DTL-SEQ-NBR                         
143000*             MOVE 1000          TO PCT00012-DTL-TXT-LEN                  
143100              MOVE XL072-DTL-TXT (3:1000) TO                              
143200                                         PCT00012-DTL-TXT-TEXT            
143300*             FIND THE TRUE LENGTH OF THE STRING                          
143400              INITIALIZE PV-TEXT                                          
143500              MOVE PCT00012-DTL-TXT-TEXT  TO PV-TEXT                      
143600              PERFORM VARYING PV-TEXT-SUB FROM 4000 BY -1                 
143700                     UNTIL PV-TEXT-BYTE (PV-TEXT-SUB)                     
143800                           NOT = SPACE                                    
143900                 MOVE PV-TEXT-SUB         TO                              
144000                                    PCT00012-DTL-TXT-LEN                  
144100              END-PERFORM                                                 
144200                                                                          
144300         WHEN XL072-SU-APP-ID                                             
144400              INITIALIZE DCLSUT00038                                      
144500              MOVE PV-SET-SEQ-NBR TO SUT00038-EVNT-EXPRT-ID               
144600              MOVE 1 TO SUT00038-EVNT-DTL-SEQ-NBR                         
144700*             MOVE 1000          TO SUT00038-DTL-TXT-LEN                  
144800              MOVE XL072-DTL-TXT (3:1000) TO                              
144900                                    SUT00038-DTL-TXT-TEXT                 
145000*             FIND THE TRUE LENGTH OF THE STRING                          
145100              INITIALIZE PV-TEXT                                          
145200              MOVE SUT00038-DTL-TXT-TEXT  TO PV-TEXT                      
145300                                                                          
145400              PERFORM VARYING PV-TEXT-SUB FROM 4000 BY -1                 
145500                     UNTIL PV-TEXT-BYTE (PV-TEXT-SUB)                     
145600                           NOT = SPACE                                    
145700                 MOVE PV-TEXT-SUB         TO                              
145800                                    SUT00038-DTL-TXT-LEN                  
145900              END-PERFORM                                                 
146000                                                                          
146100     END-EVALUATE.                                                        
146200                                                                          
146300****************************************************************          
146400*                                                              *          
146500*                                                              *          
146600*                                                              *          
146700****************************************************************          
146800                                                                          
146900 5400-INSERT-DETAIL-TEXT.                                                 
147000                                                                          
147100     PERFORM                                                              
147200         WITH TEST AFTER                                                  
147300         VARYING PV-RETRY-COUNTER                                         
147400         FROM 1 BY 1                                                      
147500         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
147600            OR SQLCODE = ZERO                                             
147700                                                                          
147800         EVALUATE TRUE                                                    
147900             WHEN XL072-PC-APP-ID                                         
148000                  EXEC SQL                                                
148100                     INSERT INTO PCT_BUS_EVNT_DTL                         
148200                           (EVNT_EXPRT_ID                                 
148300                           ,DTL_TXT)                                      
148400                                                                          
148500                    VALUES (:PCT00012-EVNT-EXPRT-ID                       
148600                           ,:PCT00012-DTL-TXT)                            
148700                  END-EXEC                                                
148800                                                                          
148900             WHEN XL072-SU-APP-ID                                         
149000                  EXEC SQL                                                
149100                     INSERT INTO SUT_BUS_EVNT_DTL                         
149200                           (EVNT_EXPRT_ID                                 
149300                           ,DTL_TXT)                                      
149400                                                                          
149500                    VALUES (:SUT00038-EVNT-EXPRT-ID                       
149600                           ,:SUT00038-DTL-TXT)                            
149700                  END-EXEC                                                
149800                                                                          
149900         END-EVALUATE                                                     
150000                                                                          
150100         EVALUATE TRUE                                                    
150200             WHEN SQLCODE = ZERO                                          
150300             WHEN SQLCODE = -904                                          
150400             WHEN SQLCODE = -913                                          
150500             WHEN SQLCODE = -911                                          
150600                 CONTINUE                                                 
150700             WHEN SQLWARN0 NOT = SPACES                                   
150800             WHEN SQLCODE NOT = ZERO                                      
150900                  MOVE +4             TO PV-RETRY-COUNTER                 
151000         END-EVALUATE                                                     
151100     END-PERFORM.                                                         
151200                                                                          
151300     IF SQLCODE = 0                                                       
151400        CONTINUE                                                          
151500     ELSE                                                                 
151600        IF PV-RETRY-COUNTER > PC-MAX-RETRIES                              
151700           SET XL072-SQL-ERROR      TO TRUE                               
151800           MOVE SQLCODE TO XL072-EAI-DB-SQLCODE                           
151900           MOVE '5400-'        TO XL072-SQL-ERROR-PARA                    
152000           MOVE SQLCA          TO XL072-SQLCA                             
152100        END-IF                                                            
152200     END-IF.                                                              
152300                                                                          
152400                                                                          
152500******************************************************************        
152600*                                                                *        
152700******************************************************************        
152800 8000-SYNCPOINT.                                                          
152900                                                                          
153000     EXEC CICS                                                            
153100          SYNCPOINT                                                       
153200     END-EXEC.                                                            
153300                                                                          
153400                                                                          
153500****************************************************************          
153600*                                                              *          
153700*                                                              *          
153800****************************************************************          
153900                                                                          
154000 8400-GET-TIMESTAMP.                                                      
154100                                                                          
154200     EXEC SQL                                                             
154300          SET   :PV-CURRENT-TIMESTAMP  = CURRENT TIMESTAMP                
154400                                                                          
154500     END-EXEC.                                                            
154600                                                                          
154700     EVALUATE TRUE                                                        
154800         WHEN SQLCODE = ZERO                                              
154900              CONTINUE                                                    
155000                                                                          
155100         WHEN OTHER                                                       
155200              SET XL072-SQL-ERROR TO TRUE                                 
155300              MOVE SQLCODE        TO XL072-EAI-DB-SQLCODE                 
155400              MOVE '8400-'        TO XL072-SQL-ERROR-PARA                 
155500              MOVE SQLCA          TO XL072-SQLCA                          
155600                                                                          
155700      END-EVALUATE.                                                       
155800                                                                          
155900                                                                          
