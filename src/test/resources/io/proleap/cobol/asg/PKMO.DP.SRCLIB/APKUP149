000100*-----------------------*                                         00010007
000200 IDENTIFICATION DIVISION.                                         00020007
000300*-----------------------*                                         00030007
000400 PROGRAM-ID.    APKUP149.                                         00040007
000500 AUTHOR.        JILL JUEL.                                        00050007
000600 DATE-WRITTEN.  AUGUST 1999.                                      00060007
000700                                                                  00070007
000800*---------------------------------------------------------------* 00080007
000900*                       COBOL 2 WITH SQL                        * 00090007
001000*                                                               * 00100007
001100*         PURGE ADJUSTMENT JOURNAL DATA OVER ONE YEAR OLD       * 00110007
001200*                                                               * 00120007
001300*  THE PURPOSE OF THIS PROGRAM IS TO PURGE OLD DATA FROM THE    * 00130007
001400*  ADJUSTMENT JOURNAL DATABASE. IT WILL CALCULATE THE POSTING   * 00140007
001500*  PERIOD TO BE PURGED BASED ON THE PERIOD WE ARE IN THE        * 00150007
001600*  PROCESS OF CLOSING.  THIS PERIOD/YEAR WILL BE OBTAINED FROM  * 00160007
001700*  THE TAPCNTL TABLE, AND THEN THE YEAR WILL BE ADJUSTED SO     * 00170007
001800*  THAT WE WILL PURGE THE SAME MONTH FROM THE PERVIOUS YEAR.    * 00180007
001900*  A COUNT WILL BE SEELCTED FIRST, SO WE CAN DISPLAY HOW MANY   * 00190007
002000*  ADJUSTMENTS ARE BEING PURGED, AND THEN ONE DELETE STATEMENT  * 00200007
002100*  WILL PERFORM THE CLEANUP.  NOTE THAT THE DELETE RULES        * 00210007
002200*  BETWEEN THE TABLES THAT MAKE UP THE ADJUSTMENT JOURNAL       * 00220007
002300*  DATABASE IS 'DELETE CASCADE', SO ISSUING A DELETE COMMAND    * 00230007
002400*  AGAINST THE HEADER TABLE WILL CAUSE ROWS TO ALSO BE DELETED  * 00240007
002500*  FROM THE DISTRIBUTION AND PEOPLESOFT INTERFACE TABLES.       * 00250007
002600*                                                               * 00260007
002700*---------------------------------------------------------------* 00270007
002800*                                                               * 00280007
002900* DB2 TABLES:                                                   * 00290007
003100*  1. ADJUSTMENT JOURNAL TABLE          (TADJRNL)               * 00310032
003100*  2. ADJUSTMENT INTERFACE              (TAJPSINT)              * 00310132
003100*  3. ADJUSTMENT DISTRIBUTION LINES     (TADJDIS)               * 00311032
003100*  4. CHECKPOINT CONTROL                (TCKRSTCNTL)            * 00312032
003100*  5. CHECKPOINT INFORMATION            (TCKRSTINF)             * 00313064
003200*                                                               * 00320007
003300*---------------------------------------------------------------* 00330007
003400* CHANGES:                                                      * 00340007
003500* DATE: 01-08-2001                                              * 00350007
003600* INCREASED THE LENGTH OF THE ADJUSTMENT JOURNAL COUNT          * 00360007
003700* VARIABLE FROM 5 BYTES LONG TO 6 BYTES LONG.                   * 00370007
003800* MADE BY: MARK BURNSIDE             WR/IR: 20704               * 00380007
003900*                                                               * 00390007
004000* DATE: 02-12-2001                                              * 00400007
004100* ADDED SQL LOCK TABLE STATEMENTS IN B100- PARAGRAPH FOR        * 00410007
004200* DB2 TABLES TADJRNL, TADJDIS, AND TAJPSINT.  THIS SHOULD       * 00420007
004300* PREVENT -904 SQL RETURN CODES DUE TO EXCEEDING THE MAXIMUM    * 00430007
004400* ALLOWABLE PAGE LOCK LIMIT BY MANUALLY LOCKING THE TABLES.     * 00440007
004500* MADE BY: MARK BURNSIDE             PITS#: 391620              * 00450007
004600*                                                               * 00460010
004700* DATE: 10-10-2002                                              * 00470010
004800* ADDED THE KOHLS CALENDAR ROUTINE SO THAT THE FISCAL YEAR AND  * 00480010
004900* PERIOD NEEDED TO DELETE ROWS FROM THE ADJUSTMENT SYSTEM CAN   * 00490010
005000* BE CALCULATED 25 PERIODS PRIOR TO THE PREVIOUS FISCAL DATA    * 00500010
005100* STORED ON TAPCNTL.                                            * 00510010
005200* MADE BY: MIKE BESKE                  WR#: 24190               * 00520010
005210*                                                               * 00521015
005220* DATE: 06-28-2006                                              * 00522015
005230* MODIFED THE KOHLS CALENDAR ROUTINE SO THAT THE FISAL YEAR AND * 00523016
005240* PERIOD NEEDED TO DELETE ROWS FROM THE ADJUSTMENT SYSTEM CAN   * 00524015
005250* BE CALCULATED 39 PERIODS PRIOR TO THE PREVIOUS FISCAL DATA    * 00525015
005260* STORED ON TAPCNTL.                                            * 00526015
005270* MADE BY: MICHELE RINDFLEISCH         WR#: WR30042             * 00527017
005210*                                                               * 00528018
005220* DATE: 04-15-2020                                              * 00529018
005230* SPLIT PROGRAM INTO 2 PIECES.  APKUT150 WILL SELECT THE ROWS TO* 00529118
005240* BE DELETED AND CREATE A FILE.  THIS PROGRAM WILL READ IN THE  * 00529218
005250* FILE AND DO THE DELETES.  THE EXISTING PROGRAM DID CASCADE    * 00529318
005260* DELETES, WHICH FILLED UP THE DB2 LOGS                         * 00529418
005270* MADE BY: JEAN KURK                   WR#: CHG000000           * 00529518
005300*---------------------------------------------------------------* 00530007
005400 EJECT                                                            00540007
005500                                                                  00550007
005600 ENVIRONMENT DIVISION.                                            00560007
005700 CONFIGURATION SECTION.                                           00570007
005800 SOURCE-COMPUTER. IBM-3090.                                       00580007
005900 OBJECT-COMPUTER. IBM-3090.                                       00590007
006000                                                                  00600007
006100 INPUT-OUTPUT SECTION.                                            00610007
006200 FILE-CONTROL.                                                    00620007
005500                                                                  00621018
005600     SELECT COMMIT-CARD-FILE                                      00622018
005700         ASSIGN TO INP01.                                         00623018
005701                                                                  00624018
005702     SELECT DELETE-REC-FILE                                       00625018
005703         ASSIGN TO INP02.                                         00626057
006300                                                                  00630007
006400 DATA DIVISION.                                                   00640007
006500 FILE SECTION.                                                    00650007
007000                                                                  00651018
009600 FD  COMMIT-CARD-FILE                                             00652018
009700     RECORDING MODE IS F                                          00653018
009800     BLOCK CONTAINS 0 RECORDS                                     00654018
009900     LABEL RECORDS ARE STANDARD.                                  00655018
010000                                                                  00656018
010200 01  COMMIT-CARD-RECORD              PIC X(80).                   00657018
010000                                                                  00657118
009600 FD  DELETE-REC-FILE                                              00657218
009700     RECORDING MODE IS F                                          00657318
009800     BLOCK CONTAINS 0 RECORDS                                     00657418
009900     LABEL RECORDS ARE STANDARD.                                  00657518
010000                                                                  00657618
010200 01  DELETE-REC-RECORD               PIC X(50).                   00657718
006600                                                                  00660007
006700 WORKING-STORAGE SECTION.                                         00670007
006800                                                                  00680007
006900 01  PV-PROGRAM-VARIABLES.                                        00690007
007000     05  PV-CURRENT-PARAGRAPH        PIC  X(35).                  00700007
008000     05  PV-SQLERRD3                 PIC S9(09)  VALUE ZERO       00701037
008100                                                   COMP-3.        00702027
031000     05  PV-CKPT-STAT-CODE           PIC  X(01)  VALUE SPACE.     00703037
024500     05  PC-PROGRAM-NAME             PIC  X(08)  VALUE 'APKUP149'.00704042
025300     05  PC-IN-PROCESS-CODE          PIC  X(01)  VALUE '9'.       00705037
025400     05  PC-RUN-COMPLETE-CODE        PIC  X(01)  VALUE '0'.       00706037
007100                                                                  00710007
007200 01  PV-PROGRAM-SWITCHES.                                         00720011
016900     05  PS-END-OF-INPUT-FILE        PIC  X(01) VALUE 'N'.        00751019
017500         88  PS-END-OF-INPUT-NO                 VALUE 'N'.        00752019
017500         88  PS-END-OF-INPUT-YES                VALUE 'Y'.        00753019
016900     05  PS-END-OF-CARD-FILE         PIC  X(01) VALUE 'N'.        00754019
017500         88  PS-END-OF-CARD-NO                  VALUE 'N'.        00755019
017500         88  PS-END-OF-CARD-YES                 VALUE 'Y'.        00756019
033090     05  PS-RUN-TYPE-SW              PIC  X(01) VALUE ' '.        00757032
033100         88  NORMAL-RUN                         VALUE '0'.        00758032
033200         88  RESTART-RUN                        VALUE '9'.        00759032
007600                                                                  00760007
007700 01  PV-PROGRAM-COUNTERS.                                         00770011
007800     05  PV-COMMIT-COUNT-ADJRNL      PIC S9(09) COMP-3 VALUE +0.  00780066
007800     05  PV-COMMIT-COUNT-ADJDIS      PIC S9(09) COMP-3 VALUE +0.  00780166
007800     05  PV-COMMIT-COUNT-AJPSNT      PIC S9(09) COMP-3 VALUE +0.  00780266
007800     05  PV-ADJDIS-COUNT             PIC S9(09) COMP-3 VALUE +0.  00781065
007800     05  PV-AJPSNT-COUNT             PIC S9(09) COMP-3 VALUE +0.  00782065
007800     05  PV-ADJRNL-COUNT             PIC S9(09) COMP-3 VALUE +0.  00783065
007800     05  PV-ADJDIS-ERROR             PIC S9(09) COMP-3 VALUE +0.  00784065
007800     05  PV-AJPSNT-ERROR             PIC S9(09) COMP-3 VALUE +0.  00785065
007800     05  PV-ADJRNL-ERROR             PIC S9(09) COMP-3 VALUE +0.  00786065
007900     05  PRT-COUNT                   PIC  9(09) VALUE ZERO.       00790065
007600                                                                  00791025
033700 01  CKPT-RESTART-INFO.                                           00792032
033800     05  CR-PSTG-FYR-NBR             PIC X(4)   VALUE SPACE.      00793032
033900     05  CR-PSTG-FMN-NBR             PIC X(2)   VALUE SPACE.      00794032
034000     05  CR-VND-NBR                  PIC X(9)   VALUE SPACE.      00795032
034100     05  CR-DOC-NBR                  PIC X(16)  VALUE SPACE.      00796032
034200     05  CR-DOC-DTE                  PIC X(10)  VALUE SPACE.      00797032
034300     05  CR-AP-TRN-CDE               PIC X(2)   VALUE SPACE.      00798032
007800     05  CR-ADJDIS-COUNT             PIC 9(09)  VALUE 0.          00798165
007800     05  CR-AJPSNT-COUNT             PIC 9(09)  VALUE 0.          00798265
007800     05  CR-ADJRNL-COUNT             PIC 9(09)  VALUE 0.          00798365
007800     05  CR-ADJDIS-ERROR             PIC 9(09)  VALUE 0.          00798465
007800     05  CR-AJPSNT-ERROR             PIC 9(09)  VALUE 0.          00798565
007800     05  CR-ADJRNL-ERROR             PIC 9(09)  VALUE 0.          00798665
034400                                                                  00799032
008000                                                                  00800011
012100******************************************************************01081019
012200* RECORD LAYOUT FOR INPUT CARD - COMMIT COUNT                     01082019
012300******************************************************************01083019
012400 01  CC-CONTROL-CARD.                                             01084019
012600     05  CC-COMMIT-CNT           PIC 9(06)    VALUE ZERO.         01086019
012900     05  FILLER                  PIC X(74)    VALUE SPACE.        01089019
010800                                                                  01089119
010900*--------------------------------------------------------------*  01089232
011000*    FILE LAYOUT FOR OUTPUT RECORD                                01089332
011100*--------------------------------------------------------------*  01089432
011200     COPY APRD560.                                                01089532
011300                                                                  01089632
012200*--------------------------------------------------------------*  01220007
012300*    TADJRNL DCLGEN                                               01230007
012400*--------------------------------------------------------------*  01240007
012500     EXEC SQL                                                     01250007
012600         INCLUDE TADJRNL                                          01260007
012700     END-EXEC.                                                    01270007
012900                                                                  01290007
011400*--------------------------------------------------------------*  01291020
011500*    TADJDIS DCLGEN                                               01292020
011600*--------------------------------------------------------------*  01293020
011700     EXEC SQL                                                     01294020
011800         INCLUDE TADJDIS                                          01295020
011900     END-EXEC.                                                    01296020
012100                                                                  01298020
012200*--------------------------------------------------------------*  01299020
012300*    TAPJSINT DCLGEN                                              01299120
012400*--------------------------------------------------------------*  01299220
012500     EXEC SQL                                                     01299320
012600         INCLUDE TAJPSINT                                         01299420
012700     END-EXEC.                                                    01299520
012900                                                                  01299720
012200*--------------------------------------------------------------*  01299832
012300*    TCKRSTCNTL DCLGEN                                            01299932
012400*--------------------------------------------------------------*  01300032
041300         EXEC SQL                                                 01300332
041400             INCLUDE TCKRSTCN                                     01300432
041500         END-EXEC.                                                01300532
041600                                                                  01300632
012200*--------------------------------------------------------------*  01300732
012300*    TCKRSTINF DCLGEN                                             01300832
012400*--------------------------------------------------------------*  01300932
042000         EXEC SQL                                                 01301332
042100             INCLUDE TCKRSTIN                                     01301432
042200         END-EXEC.                                                01301532
041600                                                                  01301632
013000*--------------------------------------------------------------*  01302007
013100*  COMMUNICATIONS AREA2 FOR DB2                                *  01310007
013200*--------------------------------------------------------------*  01320007
013300     COPY SQLCA2.                                                 01330007
013400*--------------------------------------------------------------*  01340007
013500*    SQL COMMUNICATIONS AREA DCLGEN                               01350007
013600*--------------------------------------------------------------*  01360007
013700     EXEC SQL                                                     01370007
013800         INCLUDE SQLCA                                            01380007
013900     END-EXEC.                                                    01390007
014000 EJECT                                                            01400007
014100                                                                  01410007
014200*---------------------------------------------------------------- 01420007
014300*  ABEND DATA AREAS                                               01430007
014400*---------------------------------------------------------------- 01440007
014500 01  ABEND-CODE                  PIC S9(04)  VALUE ZEROS          01450007
014600                                             COMP SYNC.           01460007
014700     88  AC-DB2-ERROR                        VALUE +4013.         01470007
014800     88  AC-UNSUCCESSFUL-SELECT              VALUE +4015.         01480007
014900     88  AC-DATE-ERROR                       VALUE +4019.         01490009
015000                                                                  01500007
015100                                                                  01510007
015200 01  ABEND-AREAS.                                                 01520007
015300     05  AA-ABEND-LIT            PIC  X(40)  VALUE                01530007
015400             '*****       ABEND'.                                 01540007
015500     05  AA-PROGRAM-LIT          PIC  X(40)  VALUE                01550007
015600             '*****   PROGRAM: APKUT049'.                         01560007
015700     05  AA-PARAGRAPH-LIT.                                        01570007
015800         10  FILLER              PIC  X(17)  VALUE                01580007
015900             '***** PARAGRAPH: '.                                 01590007
016000         10  AA-PARAGRAPH-NAME   PIC  X(35)  VALUE SPACES.        01600007
016100     05  AA-MESSAGE-LINE.                                         01610007
016200         10  FILLER              PIC  X(06)  VALUE '*****'.       01620007
016300         10  AA-MESSAGE          PIC  X(127) VALUE SPACES.        01630007
016400     05  AA-DB2-ERROR-LIT        PIC  X(40)  VALUE                01640007
016500             '*****    DB2 ERROR'.                                01650007
016600     05  AA-DB2-OPERATION-LIT.                                    01660007
016700         10  FILLER              PIC  X(17)  VALUE                01670007
016800             '***** OPERATION: '.                                 01680007
016900         10  AA-DB2-OPERATION.                                    01690007
017000             15  AA-DB2-OP-1     PIC  X(25)  VALUE SPACES.        01700007
017100             15  AA-DB2-OP-2     PIC  X(25)  VALUE SPACES.        01710007
017200     05  AA-DB2-TABLE-1          PIC  X(08)  VALUE SPACES.        01720007
017300     05  AA-DB2-TABLE-2          PIC  X(08)  VALUE SPACES.        01730007
017400     05  AA-DB2-TABLE-3          PIC  X(08)  VALUE SPACES.        01740007
017500                                                                  01750007
017600*---------------------------------------------------------------- 01760007
017700*  SQLCA FORMATTED MESSAGE AREA                                   01770007
017800*---------------------------------------------------------------- 01780007
017900     COPY DPWS004.                                                01790007
018000 EJECT                                                            01800007
018100**********************                                            01810007
018200 PROCEDURE DIVISION.                                              01820007
018300**********************                                            01830007
018400 A100-MAINLINE-ROUTINE.                                           01840007
018500                                                                  01850007
018600     PERFORM B100-INITIALIZE.                                     01860007
018700                                                                  01870007
123200     PERFORM B200-PROCESS-INPUT-DATA                              01881019
123201        UNTIL PS-END-OF-INPUT-YES.                                01882019
018900                                                                  01890007
019000     PERFORM B300-END-OF-PROGRAM.                                 01900007
019100     GOBACK.                                                      01910007
019200                                                                  01920007
019300 EJECT                                                            01930007
019400*---------------------------------------------------------------- 01940007
019500*    INITIALIZATION PROCESSING.                                   01950007
019600*---------------------------------------------------------------- 01960007
019700 B100-INITIALIZE.                                                 01970007
019800                                                                  01980007
019900     DISPLAY ' '.                                                 01990007
020000     DISPLAY '*****************  APKUP149  *******************'.  02000007
020100     MOVE 'B100-INITIALIZE' TO PV-CURRENT-PARAGRAPH.              02010007
020200                                                                  02020007
123214     OPEN INPUT  COMMIT-CARD-FILE                                 02020118
123215                 DELETE-REC-FILE.                                 02020218
067900                                                                  02029019
068000     READ COMMIT-CARD-FILE INTO CC-CONTROL-CARD                   02029119
068100        AT END                                                    02029219
068200           SET PS-END-OF-CARD-YES TO TRUE.                        02029319
068300                                                                  02029419
068400     CLOSE COMMIT-CARD-FILE.                                      02029520
068300                                                                  02029619
068600     IF PS-END-OF-CARD-YES                                        02029719
024400        MOVE PV-CURRENT-PARAGRAPH     TO AA-PARAGRAPH-NAME        02029819
024500        MOVE 'NO COMMIT COUNT FILE'   TO AA-MESSAGE               02029919
024600        PERFORM Z999-ABEND                                        02030019
069100     END-IF.                                                      02030519
069200                                                                  02030619
021100     PERFORM S200-LOCK-TABLES.                                    02111019
069200                                                                  02112019
060000     PERFORM R400-GET-CHECKPOINT-CNTL.                            02113032
060100     MOVE PV-CKPT-STAT-CODE TO PS-RUN-TYPE-SW.                    02114032
060200                                                                  02115032
060300     IF RESTART-RUN                                               02116032
060400         PERFORM R200-CHECKPOINT-RESTART                          02117032
M60500     ELSE                                                         02118032
100600         MOVE PC-IN-PROCESS-CODE      TO PV-CKPT-STAT-CODE        02118236
100700         PERFORM R600-UPDATE-TCKRSTCNTL                           02118336
100700         PERFORM U400-COMMIT                                      02118447
060600         PERFORM R300-READ-DELETE-FILE                            02119032
060700     END-IF.                                                      02120032
060800                                                                  02130032
022700 EJECT                                                            02270007
022800*---------------------------------------------------------------- 02280007
022900*  MAIN PROCESSING: READ IN THE RECORDS FROM THE FILE CREATED     02290019
023000*                   IN APKUT150.  DELETE ANY ROWS FROM TADJDIS,   02300019
023100*                   TAJPSINT AND TADJRNL TABLES                   02310019
023300*---------------------------------------------------------------- 02330007
023400 B200-PROCESS-INPUT-DATA.                                         02340024
023500     MOVE 'B200-PROCESS-INPUT-DATA' TO PV-CURRENT-PARAGRAPH.      02350024
023600                                                                  02360007
291206     PERFORM U300-DELETE-TADJDIS.                                 02402019
291204     IF PV-COMMIT-COUNT-ADJDIS >= CC-COMMIT-CNT                   02402166
291204        PERFORM R700-UPDATE-TCKRSTINF                             02402266
291204        PERFORM U400-COMMIT                                       02402366
291204        PERFORM S200-LOCK-TABLES                                  02402466
291204     END-IF.                                                      02402566
024800                                                                  02402666
291206     PERFORM U200-DELETE-TAJPSINT.                                02402720
291204     IF PV-COMMIT-COUNT-AJPSNT >= CC-COMMIT-CNT                   02402866
291204        PERFORM R700-UPDATE-TCKRSTINF                             02402966
291204        PERFORM U400-COMMIT                                       02403066
291204        PERFORM S200-LOCK-TABLES                                  02403166
291204     END-IF.                                                      02403266
024800                                                                  02403366
291206     PERFORM U100-DELETE-TADJRNL.                                 02404019
291204     IF PV-COMMIT-COUNT-ADJRNL >= CC-COMMIT-CNT                   02405066
291204        PERFORM R700-UPDATE-TCKRSTINF                             02406066
291204        PERFORM U400-COMMIT                                       02407066
291204        PERFORM S200-LOCK-TABLES                                  02408066
291204     END-IF.                                                      02409066
291204                                                                  02516019
291201     PERFORM R300-READ-DELETE-FILE.                               02517032
291204                                                                  02520019
025900*---------------------------------------------------------------- 02590009
026000*  END OF PROGRAM - DISPLAYS COUNTERS AND CLOSES FILES.           02600009
026100*---------------------------------------------------------------- 02610009
026200 B300-END-OF-PROGRAM.                                             02620009
026300     MOVE 'B300-END-OF-PROGRAM ' TO PV-CURRENT-PARAGRAPH.         02620136
026500                                                                  02620218
064800     MOVE PC-RUN-COMPLETE-CODE TO PV-CKPT-STAT-CODE.              02620336
064900     PERFORM R600-UPDATE-TCKRSTCNTL.                              02620436
123215     PERFORM U400-COMMIT.                                         02622036
123215     CLOSE DELETE-REC-FILE.                                       02622136
026500                                                                  02623018
026400     DISPLAY ' '.                                                 02640012
026600     IF PV-ADJRNL-COUNT > 0                                       02660022
026700        MOVE CC-COMMIT-CNT TO PRT-COUNT                           02670031
026800        DISPLAY 'COMMIT COUNT SET TO ' PRT-COUNT                  02680022
026900        DISPLAY ' '                                               02690014
026700        MOVE PV-ADJRNL-COUNT TO PRT-COUNT                         02690122
026800        DISPLAY 'NBR OF ROWS DELETED TADJRNL =  ' PRT-COUNT       02690222
026700        MOVE PV-ADJDIS-COUNT TO PRT-COUNT                         02691022
026800        DISPLAY 'NBR OF ROWS DELETED TADJDIS =  ' PRT-COUNT       02692022
026700        MOVE PV-AJPSNT-COUNT TO PRT-COUNT                         02694022
026800        DISPLAY 'NBR OF ROWS DELETED TAJPSINT = ' PRT-COUNT       02695022
026900        DISPLAY ' '                                               02696030
026700        MOVE PV-ADJRNL-ERROR TO PRT-COUNT                         02697030
026800        DISPLAY 'ERRORS FROM TADJRNL =          ' PRT-COUNT       02698030
026700        MOVE PV-ADJDIS-ERROR TO PRT-COUNT                         02699130
026800        DISPLAY 'ERRORS FROM TADJDIS =          ' PRT-COUNT       02699230
026700        MOVE PV-AJPSNT-ERROR TO PRT-COUNT                         02699430
026800        DISPLAY 'ERRORS FROM TAJPSINT =         ' PRT-COUNT       02699530
027000     ELSE                                                         02700022
026800        DISPLAY 'NO ROWS FOUND TO DELETE'                         02700122
027000     END-IF.                                                      02702022
027100                                                                  02710012
027400     DISPLAY ' '.                                                 02740009
027500     DISPLAY '******************************************'.        02750009
027600     DISPLAY '***** PROGRAM APKUP149 ENDS NORMALLY *****'.        02760009
027700     DISPLAY '******************************************'.        02770009
027800                                                                  02780009
027900 EJECT                                                            02790009
023300*---------------------------------------------------------------- 03431019
023300* TABLE LOCKS ARE ONLY EFFECTIVE UNTIL A COMMIT IS PROCESSED      03431119
023300* NEED TO REISSUE THE LOCK AFTER EACH COMMIT                      03431219
023300*---------------------------------------------------------------- 03431319
023400 S200-LOCK-TABLES.                                                03432019
023500     MOVE 'S200-LOCK-TABLES' TO PV-CURRENT-PARAGRAPH.             03433019
023600                                                                  03434019
021200     EXEC SQL                                                     03435019
021300         LOCK TABLE TADJRNL IN EXCLUSIVE MODE                     03436019
021400     END-EXEC.                                                    03437019
021500                                                                  03438019
021600     EXEC SQL                                                     03439019
021700         LOCK TABLE TADJDIS IN EXCLUSIVE MODE                     03439119
021800     END-EXEC.                                                    03439219
021900                                                                  03439319
022000     EXEC SQL                                                     03439419
022100         LOCK TABLE TAJPSINT IN EXCLUSIVE MODE                    03439519
022200     END-EXEC.                                                    03439619
022300                                                                  03439719
037500 EJECT                                                            03750011
037600*---------------------------------------------------------------- 03760011
037700* DELETES ROWS FROM THE ADJUSTMENT JOURNAL WITH THE KEY FROM THE  03770020
037800* INPUT RECORD                                                    03780020
037900*---------------------------------------------------------------- 03790011
038000 U100-DELETE-TADJRNL.                                             03800011
038100     MOVE 'U100-DELETE-TADJRNL' TO PV-CURRENT-PARAGRAPH.          03810011
038200                                                                  03820011
038300     EXEC SQL                                                     03830011
038400         DELETE FROM TADJRNL                                      03840011
038500          WHERE PSTG_FYR_NBR = :AP560-PSTG-FYR-NBR                03850019
038600            AND PSTG_FMN_NBR = :AP560-PSTG-FMN-NBR                03860019
038600            AND VND_NBR      = :AP560-VND-NBR                     03861019
038600            AND DOC_NBR      = :AP560-DOC-NBR                     03862019
038600            AND DOC_DTE      = :AP560-DOC-DTE                     03863019
038600            AND AP_TRN_CDE   = :AP560-AP-TRN-CDE                  03864019
038700     END-EXEC.                                                    03870011
038800                                                                  03880011
038900     EVALUATE TRUE                                                03890011
039000         WHEN SQLCODE = ZERO                                      03900011
027200             MOVE SQLERRD(3)            TO PV-SQLERRD3            03911027
027300             ADD PV-SQLERRD3            TO PV-ADJRNL-COUNT        03912027
027300             ADD PV-SQLERRD3            TO PV-COMMIT-COUNT-ADJRNL 03913066
039200         WHEN OTHER                                               03920011
104700             DISPLAY '** ERROR DELETING TADJRNL ROW **'           03920263
104800             DISPLAY '   PSTG-FYR-NBR    = '                      03920362
104800                                      AP560-PSTG-FYR-NBR          03920463
104800             DISPLAY '   PSTG-FMN-NBR    = '                      03920562
104800                                      AP560-PSTG-FMN-NBR          03920663
104800             DISPLAY '   PSTG-VND-NBR    = '                      03920762
104800                                      AP560-VND-NBR               03920863
104800             DISPLAY '   PSTG-DOC-NBR    = '                      03920962
104800                                      AP560-DOC-NBR               03921063
104800             DISPLAY '   PSTG-DOC-DTE    = '                      03921162
104800                                      AP560-DOC-DTE               03921263
104800             DISPLAY '   PSTG-AP-TRN-CDE = '                      03921362
104800                                      AP560-AP-TRN-CDE            03921463
104900             DISPLAY '  '                                         03921563
027300             ADD 1                      TO PV-ADJRNL-ERROR        03922061
039300             SET AC-DB2-ERROR TO TRUE                             03930011
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      03940011
039500             MOVE 'UNSUCCESSFUL DELETE' TO AA-DB2-OPERATION       03950011
039600             MOVE 'TADJRNL'             TO AA-DB2-TABLE-1         03960011
039700             MOVE SPACES                TO AA-DB2-TABLE-2         03970011
039800             MOVE SPACES                TO AA-DB2-TABLE-3         03980011
039900             PERFORM Z998-DB2-ABEND                               03990011
040000     END-EVALUATE.                                                04000011
037500 EJECT                                                            04001020
037600*---------------------------------------------------------------- 04002020
037700* DELETES ROWS FROM THE ADJSTMNT INTERFACE WITH THE KEY FROM THE  04003027
037800* INPUT RECORD - SOME MAY NOT HAVE A ROW ON THIS TABLE            04004061
037900*---------------------------------------------------------------- 04005020
038000 U200-DELETE-TAJPSINT.                                            04006021
038100     MOVE 'U200-DELETE-TAJPSINT' TO PV-CURRENT-PARAGRAPH.         04007027
038200                                                                  04008020
038300     EXEC SQL                                                     04009020
038400         DELETE FROM TAJPSINT                                     04009121
038600          WHERE VND_NBR      = :AP560-VND-NBR                     04009428
038600            AND DOC_NBR      = :AP560-DOC-NBR                     04009520
038600            AND DOC_DTE      = :AP560-DOC-DTE                     04009620
038600            AND AP_TRN_CDE   = :AP560-AP-TRN-CDE                  04009720
038700     END-EXEC.                                                    04009820
038800                                                                  04009920
038900     EVALUATE TRUE                                                04010020
039000         WHEN SQLCODE = ZERO                                      04010120
027200             MOVE SQLERRD(3)            TO PV-SQLERRD3            04010427
027300             ADD PV-SQLERRD3            TO PV-AJPSNT-COUNT        04010527
027300             ADD PV-SQLERRD3            TO PV-COMMIT-COUNT-AJPSNT 04010666
039000         WHEN SQLCODE = +100                                      04010766
027200             CONTINUE                                             04010866
039200         WHEN OTHER                                               04010966
104700             DISPLAY '** ERROR DELETING TAJPSINT ROW **'          04011066
104800             DISPLAY '   PSTG-FYR-NBR    = '                      04011166
104800                                      AP560-PSTG-FYR-NBR          04011266
104800             DISPLAY '   PSTG-FMN-NBR    = '                      04011366
104800                                      AP560-PSTG-FMN-NBR          04011466
104800             DISPLAY '   PSTG-VND-NBR    = '                      04011566
104800                                      AP560-VND-NBR               04011666
104800             DISPLAY '   PSTG-DOC-NBR    = '                      04011766
104800                                      AP560-DOC-NBR               04011866
104800             DISPLAY '   PSTG-DOC-DTE    = '                      04011966
104800                                      AP560-DOC-DTE               04012066
104800             DISPLAY '   PSTG-AP-TRN-CDE = '                      04012166
104800                                      AP560-AP-TRN-CDE            04012266
104900             DISPLAY '  '                                         04012366
027300             ADD 1                      TO PV-AJPSNT-ERROR        04012466
039300             SET AC-DB2-ERROR TO TRUE                             04012566
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      04012666
039500             MOVE 'UNSUCCESSFUL DELETE' TO AA-DB2-OPERATION       04012766
039600             MOVE 'TAJPSINT'            TO AA-DB2-TABLE-1         04012866
039700             MOVE SPACES                TO AA-DB2-TABLE-2         04012966
039800             MOVE SPACES                TO AA-DB2-TABLE-3         04013066
039900             PERFORM Z998-DB2-ABEND                               04013166
040000     END-EVALUATE.                                                04013266
040100 EJECT                                                            04013366
037600*---------------------------------------------------------------- 04013466
037700* DELETES ROWS FROM THE DISTRIBUTION LINES WITH THE KEY FROM THE  04014027
037800* INPUT RECORD                                                    04015021
037900*---------------------------------------------------------------- 04016021
038000 U300-DELETE-TADJDIS.                                             04017027
038100     MOVE 'U300-DELETE-TADJDIS' TO PV-CURRENT-PARAGRAPH.          04018027
038200                                                                  04019021
038300     EXEC SQL                                                     04019121
038400         DELETE FROM TADJDIS                                      04019227
038600          WHERE VND_NBR      = :AP560-VND-NBR                     04019529
038600            AND DOC_NBR      = :AP560-DOC-NBR                     04019621
038600            AND DOC_DTE      = :AP560-DOC-DTE                     04019721
038600            AND AP_TRN_CDE   = :AP560-AP-TRN-CDE                  04019821
038700     END-EXEC.                                                    04019921
038800                                                                  04020021
038900     EVALUATE TRUE                                                04020121
039000         WHEN SQLCODE = ZERO                                      04020221
027200             MOVE SQLERRD(3)            TO PV-SQLERRD3            04020427
027300             ADD PV-SQLERRD3            TO PV-ADJDIS-COUNT        04020527
027300             ADD PV-SQLERRD3            TO PV-COMMIT-COUNT-ADJDIS 04020666
039000         WHEN SQLCODE = +100                                      04020766
027300             ADD 1                      TO PV-ADJDIS-ERROR        04020838
104700             DISPLAY '** NO TADJDIS ROW TO DELETE **'             04020963
104800             DISPLAY '   PSTG-FYR-NBR    = '                      04021062
104800                                      AP560-PSTG-FYR-NBR          04021163
104800             DISPLAY '   PSTG-FMN-NBR    = '                      04021262
104800                                      AP560-PSTG-FMN-NBR          04021363
104800             DISPLAY '   PSTG-VND-NBR    = '                      04021462
104800                                      AP560-VND-NBR               04021563
104800             DISPLAY '   PSTG-DOC-NBR    = '                      04021662
104800                                      AP560-DOC-NBR               04021763
104800             DISPLAY '   PSTG-DOC-DTE    = '                      04021862
104800                                      AP560-DOC-DTE               04021963
104800             DISPLAY '   PSTG-AP-TRN-CDE = '                      04022062
104800                                      AP560-AP-TRN-CDE            04022163
104900             DISPLAY '  '                                         04022263
039200         WHEN OTHER                                               04022321
104700             DISPLAY '** ERROR DELETING TADJDIS ROW **'           04022563
104800             DISPLAY '   PSTG-FYR-NBR    = '                      04022662
104800                                      AP560-PSTG-FYR-NBR          04022763
104800             DISPLAY '   PSTG-FMN-NBR    = '                      04022862
104800                                      AP560-PSTG-FMN-NBR          04022963
104800             DISPLAY '   PSTG-VND-NBR    = '                      04023062
104800                                      AP560-VND-NBR               04023163
104800             DISPLAY '   PSTG-DOC-NBR    = '                      04023262
104800                                      AP560-DOC-NBR               04023363
104800             DISPLAY '   PSTG-DOC-DTE    = '                      04023462
104800                                      AP560-DOC-DTE               04023563
104800             DISPLAY '   PSTG-AP-TRN-CDE = '                      04023662
104800                                      AP560-AP-TRN-CDE            04023763
104900             DISPLAY '  '                                         04023863
027300             ADD 1                      TO PV-ADJDIS-ERROR        04023930
039300             SET AC-DB2-ERROR TO TRUE                             04024021
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      04024121
039500             MOVE 'UNSUCCESSFUL DELETE' TO AA-DB2-OPERATION       04024221
039600             MOVE 'TADJDIS'             TO AA-DB2-TABLE-1         04024321
039700             MOVE SPACES                TO AA-DB2-TABLE-2         04024421
039800             MOVE SPACES                TO AA-DB2-TABLE-3         04024521
039900             PERFORM Z998-DB2-ABEND                               04024621
040000     END-EVALUATE.                                                04024721
040100 EJECT                                                            04024821
037600*---------------------------------------------------------------- 04024926
037700* DOES A COMMIT, BASED ON THE NUMBER OF RECORDS THAT IS CONTAINED 04025026
037800* IN THE INPUT CONTROL CARD                                       04025126
037900*---------------------------------------------------------------- 04025226
038000 U400-COMMIT.                                                     04025326
038100     MOVE 'U400-COMMIT' TO PV-CURRENT-PARAGRAPH.                  04025427
038200                                                                  04025526
038300     EXEC SQL                                                     04025626
038400         COMMIT                                                   04025726
038700     END-EXEC.                                                    04025826
038800                                                                  04025926
038900     EVALUATE TRUE                                                04026026
039000         WHEN SQLCODE = ZERO                                      04026126
039100             CONTINUE                                             04026226
039200         WHEN OTHER                                               04026326
039300             SET AC-DB2-ERROR TO TRUE                             04026426
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      04026526
039500             MOVE 'UNSUCCESSFUL COMMIT' TO AA-DB2-OPERATION       04026626
039600             MOVE 'TADJRNL'             TO AA-DB2-TABLE-1         04026726
039700             MOVE 'TAJJDIS'             TO AA-DB2-TABLE-2         04026826
039800             MOVE 'TAJPSINT'            TO AA-DB2-TABLE-3         04026926
039900             PERFORM Z998-DB2-ABEND                               04027026
040000     END-EVALUATE.                                                04027126
040100                                                                  04027232
022300     MOVE 0 TO PV-COMMIT-COUNT-ADJRNL.                            04027366
022300     MOVE 0 TO PV-COMMIT-COUNT-ADJDIS.                            04027466
022300     MOVE 0 TO PV-COMMIT-COUNT-AJPSNT.                            04027566
040100                                                                  04027666
103000*----------------------------------------------------------------*04027766
103100*    GET THE RESTART INFO                                        *04027866
103200*----------------------------------------------------------------*04027966
103300 R200-CHECKPOINT-RESTART.                                         04028066
103500     MOVE 'R200-CHECKPOINT-RESTART' TO PV-CURRENT-PARAGRAPH.      04028166
103600                                                                  04028266
103700     PERFORM R500-GET-CHECKPOINT-INFO.                            04028366
103800                                                                  04028466
103900     MOVE TCKRSTINF-WORK-STRG-DESC-TEXT TO CKPT-RESTART-INFO.     04028566
007800     MOVE CR-ADJDIS-COUNT               TO PV-ADJDIS-COUNT.       04028666
007800     MOVE CR-AJPSNT-COUNT               TO PV-AJPSNT-COUNT.       04028766
007800     MOVE CR-ADJRNL-COUNT               TO PV-ADJRNL-COUNT.       04028866
007800     MOVE CR-ADJDIS-ERROR               TO PV-ADJDIS-ERROR.       04028966
007800     MOVE CR-AJPSNT-ERROR               TO PV-AJPSNT-ERROR.       04029066
007800     MOVE CR-ADJRNL-ERROR               TO PV-ADJRNL-ERROR.       04029166
104000                                                                  04029266
104000* FIND THE LAST RECORD TO BE PROCESSED IN THE ABORTED RUN         04029366
104100     PERFORM R300-READ-DELETE-FILE                                04029466
104200        WITH TEST AFTER                                           04029566
104300             UNTIL PS-END-OF-INPUT-YES                            04029666
104400               OR (AP560-PSTG-FYR-NBR = CR-PSTG-FYR-NBR           04029766
104000                   AND AP560-PSTG-FMN-NBR = CR-PSTG-FMN-NBR       04029866
104000                   AND AP560-VND-NBR = CR-VND-NBR                 04029966
104000                   AND AP560-DOC-NBR = CR-DOC-NBR                 04030066
104000                   AND AP560-DOC-DTE = CR-DOC-DTE                 04030166
104000                   AND AP560-AP-TRN-CDE = CR-AP-TRN-CDE).         04030266
104000* GET THE FIRST RECORD TO BE PROCESSED IN THE RESTART RUN         04030366
104100     PERFORM R300-READ-DELETE-FILE.                               04030466
104500                                                                  04030566
104600     DISPLAY '***********************************************'.   04030666
104700     DISPLAY '** APKUP149 CHECKPOINT RESTART **'.                 04030766
104800     DISPLAY '** PSTG-FYR-NBR    = '  AP560-PSTG-FYR-NBR.         04030866
104800     DISPLAY '** PSTG-FMN-NBR    = '  AP560-PSTG-FMN-NBR.         04030966
104800     DISPLAY '** PSTG-VND-NBR    = '  AP560-VND-NBR.              04031066
104800     DISPLAY '** PSTG-DOC-NBR    = '  AP560-DOC-NBR.              04031166
104800     DISPLAY '** PSTG-DOC-DTE    = '  AP560-DOC-DTE.              04031266
104800     DISPLAY '** PSTG-AP-TRN-CDE = '  AP560-AP-TRN-CDE.           04031366
104900     DISPLAY '***********************************************'.   04031466
105000                                                                  04031566
105700     MOVE CR-ADJDIS-COUNT         TO PV-ADJDIS-COUNT.             04031666
105800     MOVE CR-AJPSNT-COUNT         TO PV-AJPSNT-COUNT.             04031766
105900     MOVE CR-ADJDIS-COUNT         TO PV-ADJDIS-COUNT.             04031866
106000     MOVE CR-ADJDIS-ERROR         TO PV-ADJDIS-ERROR.             04031966
106000     MOVE CR-AJPSNT-ERROR         TO PV-AJPSNT-ERROR.             04032066
106000     MOVE CR-ADJRNL-ERROR         TO PV-ADJRNL-ERROR.             04032166
106200                                                                  04032266
113400*---------------------------------------------------------------- 04032366
113500*    READ THE FILE OF RECORDS TO BE DELETED                       04032466
113600*---------------------------------------------------------------- 04032566
113700 R300-READ-DELETE-FILE.                                           04032666
113900     MOVE 'R300-READ-EXTRACT-FILE' TO                             04032766
114000                             PV-CURRENT-PARAGRAPH.                04032866
114100                                                                  04032966
291201     READ DELETE-REC-FILE INTO AP560-TADJRNL-RECORD               04033066
291202        AT END                                                    04033166
291203           SET PS-END-OF-INPUT-YES TO TRUE.                       04034066
291204                                                                  04034649
115000*----------------------------------------------------------------*04034749
115100*    SELECT CHECKPOINT RESTART CONTROL INFO.                     *04034849
115200*----------------------------------------------------------------*04034949
115300 R400-GET-CHECKPOINT-CNTL.                                        04035049
115500     MOVE 'R400-GET-CHECKPOINT-CNTL' TO PV-CURRENT-PARAGRAPH.     04035149
115600                                                                  04035249
116200     EXEC SQL                                                     04035349
116300         SELECT CKPT_STAT_CODE                                    04035449
116400           INTO :PV-CKPT-STAT-CODE                                04035549
116500           FROM TCKRSTCNTL                                        04035649
116600          WHERE PLAN_NAME = :PC-PROGRAM-NAME                      04035749
116700     END-EXEC.                                                    04035849
116800                                                                  04035949
116900     EVALUATE TRUE                                                04036049
117000         WHEN SQLCODE = ZERO                                      04036149
117100         WHEN SQLCODE = -904                                      04036249
117200         WHEN SQLCODE = -913                                      04036349
117300             CONTINUE                                             04036449
117500         WHEN SQLWARN0 NOT = SPACES                               04036549
117600         WHEN SQLCODE  NOT = ZERO                                 04036649
039300             SET AC-DB2-ERROR TO TRUE                             04036749
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      04036849
039500             MOVE 'UNSUCCESSFUL READ'   TO AA-DB2-OPERATION       04036949
039600             MOVE 'TCKRSTCNTL'          TO AA-DB2-TABLE-1         04037049
039700             MOVE SPACES                TO AA-DB2-TABLE-2         04037149
039800             MOVE SPACES                TO AA-DB2-TABLE-3         04037249
039900             PERFORM Z998-DB2-ABEND                               04037349
118700     END-EVALUATE.                                                04037449
118900                                                                  04037549
120200*----------------------------------------------------------------*04037649
120300*    SELECT CHECKPOINT RESTART WORKING STORAGE DESCRIPTION INFO  *04037749
120400*----------------------------------------------------------------*04037849
120500 R500-GET-CHECKPOINT-INFO.                                        04037949
120700     MOVE 'R500-GET-CHECKPOINT-INFO' TO PV-CURRENT-PARAGRAPH.     04038049
120800                                                                  04038149
121400     EXEC SQL                                                     04038249
121500         SELECT WORK_STRG_DESC                                    04038349
121600           INTO :TCKRSTINF-WORK-STRG-DESC                         04038449
121700           FROM TCKRSTINF                                         04038549
121800          WHERE PLAN_NAME = :PC-PROGRAM-NAME                      04038649
121900     END-EXEC.                                                    04038749
122000                                                                  04038849
122100     EVALUATE TRUE                                                04038949
122200         WHEN SQLCODE = ZERO                                      04039049
122300         WHEN SQLCODE = -904                                      04039149
122400         WHEN SQLCODE = -913                                      04039249
122500             CONTINUE                                             04039349
122700         WHEN SQLWARN0 NOT = SPACES                               04039449
122800         WHEN SQLCODE  NOT = ZERO                                 04039549
039300             SET AC-DB2-ERROR TO TRUE                             04039649
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      04039749
039500             MOVE 'UNSUCCESSFUL READ'   TO AA-DB2-OPERATION       04039849
039600             MOVE 'TCKRSTINF'           TO AA-DB2-TABLE-1         04039949
039700             MOVE SPACES                TO AA-DB2-TABLE-2         04040049
039800             MOVE SPACES                TO AA-DB2-TABLE-3         04040149
039900             PERFORM Z998-DB2-ABEND                               04040249
123900     END-EVALUATE.                                                04040349
125400                                                                  04040449
166200*----------------------------------------------------------------*04040549
166300*    UPDATES THE CHECKPOINT RESTART CONTROL TABLE.  THE STATUS   *04040649
166400*    CODE IS SET TO '9' (RUN IN PROGRESS) OR '0' (RUN COMPLETE). *04040749
166500*----------------------------------------------------------------*04040849
166600 R600-UPDATE-TCKRSTCNTL.                                          04040949
166800     MOVE 'R600-UPDATE-TCKRSTCNTL' TO PV-CURRENT-PARAGRAPH.       04041049
166900                                                                  04041149
167500     EXEC SQL                                                     04041249
167600         UPDATE TCKRSTCNTL                                        04041349
167700            SET CKPT_STAT_CODE = :PV-CKPT-STAT-CODE               04041449
167800          WHERE PLAN_NAME      = :PC-PROGRAM-NAME                 04041549
167900     END-EXEC.                                                    04041649
168000                                                                  04041749
168100     EVALUATE TRUE                                                04041849
168200         WHEN SQLCODE = ZERO                                      04041949
168300         WHEN SQLCODE = -904                                      04042049
168400         WHEN SQLCODE = -913                                      04042149
168500             CONTINUE                                             04042249
168700         WHEN SQLWARN0 NOT = SPACES                               04042349
168800         WHEN SQLCODE  NOT = ZERO                                 04042449
039300             SET AC-DB2-ERROR TO TRUE                             04042549
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      04042649
039500             MOVE 'UNSUCCESSFUL UPDATE' TO AA-DB2-OPERATION       04042749
039600             MOVE 'TCKRSTCNTL'          TO AA-DB2-TABLE-1         04042849
039700             MOVE SPACES                TO AA-DB2-TABLE-2         04042949
039800             MOVE SPACES                TO AA-DB2-TABLE-3         04043049
039900             PERFORM Z998-DB2-ABEND                               04043149
169900     END-EVALUATE.                                                04043236
171400                                                                  04043336
171700*----------------------------------------------------------------*04043433
171800*    UPDATES THE CHECKPOINT RESTART INFO TABLE.  THE WORKING     *04043533
171900*    STORAGE DESCRIPTION FIELD IS UPDATED WITH THE CURRENT INPUT *04043633
172000*    FILE RECORD COUNTS AND THE FILE PROCESSOR INDICATOR.        *04043733
172100*----------------------------------------------------------------*04043833
172200 R700-UPDATE-TCKRSTINF.                                           04043936
172400     MOVE 'R700-UPDATE-TCKRSTINF' TO PV-CURRENT-PARAGRAPH.        04044036
172500                                                                  04044133
033800     MOVE AP560-PSTG-FYR-NBR      TO CR-PSTG-FYR-NBR.             04044233
033900     MOVE AP560-PSTG-FMN-NBR      TO CR-PSTG-FMN-NBR.             04044333
034000     MOVE AP560-VND-NBR           TO CR-VND-NBR.                  04044433
034100     MOVE AP560-DOC-NBR           TO CR-DOC-NBR.                  04044533
034200     MOVE AP560-DOC-DTE           TO CR-DOC-DTE.                  04044633
034300     MOVE AP560-AP-TRN-CDE        TO CR-AP-TRN-CDE.               04044733
007800     MOVE PV-ADJDIS-COUNT         TO CR-ADJDIS-COUNT.             04044833
007800     MOVE PV-AJPSNT-COUNT         TO CR-AJPSNT-COUNT.             04044933
007800     MOVE PV-ADJRNL-COUNT         TO CR-ADJRNL-COUNT.             04045033
007800     MOVE PV-ADJDIS-ERROR         TO CR-ADJDIS-ERROR.             04045133
007800     MOVE PV-AJPSNT-ERROR         TO CR-AJPSNT-ERROR.             04045233
007800     MOVE PV-ADJRNL-ERROR         TO CR-ADJRNL-ERROR.             04045333
173200     MOVE CKPT-RESTART-INFO   TO TCKRSTINF-WORK-STRG-DESC-TEXT.   04045433
173300     MOVE 97                  TO TCKRSTINF-WORK-STRG-DESC-LEN.    04045565
173400                                                                  04045633
174000     EXEC SQL                                                     04045733
174100         UPDATE TCKRSTINF                                         04045833
174200            SET WORK_STRG_DESC   = :TCKRSTINF-WORK-STRG-DESC      04045933
174300          WHERE PLAN_NAME        = :PC-PROGRAM-NAME               04046033
174400     END-EXEC.                                                    04046133
174500                                                                  04046233
174600     EVALUATE TRUE                                                04046333
174700         WHEN SQLCODE = ZERO                                      04046433
174800         WHEN SQLCODE = -904                                      04046533
174900         WHEN SQLCODE = -913                                      04046633
175000             CONTINUE                                             04046733
175200         WHEN SQLWARN0 NOT = SPACES                               04046833
175300         WHEN SQLCODE  NOT = ZERO                                 04046933
039300             SET AC-DB2-ERROR TO TRUE                             04047033
039400             MOVE PV-CURRENT-PARAGRAPH  TO AA-PARAGRAPH-NAME      04047133
039500             MOVE 'UNSUCCESSFUL UPDATE' TO AA-DB2-OPERATION       04047233
039600             MOVE 'TCKRSTINF'           TO AA-DB2-TABLE-1         04047333
039700             MOVE SPACES                TO AA-DB2-TABLE-2         04047433
039800             MOVE SPACES                TO AA-DB2-TABLE-3         04047533
039900             PERFORM Z998-DB2-ABEND                               04047633
176400     END-EVALUATE.                                                04047733
177900                                                                  04047833
040200*---------------------------------------------------------------- 04047933
040300*    ABEND ROUTINE FOR DB2 ERRORS.                                04048033
040400*---------------------------------------------------------------- 04049011
040500 Z998-DB2-ABEND.                                                  04050011
040600                                                                  04060011
040700     DISPLAY AA-ABEND-LIT.                                        04070011
040800     DISPLAY AA-DB2-ERROR-LIT.                                    04080011
040900     DISPLAY AA-PROGRAM-LIT.                                      04090011
041000     DISPLAY AA-PARAGRAPH-LIT.                                    04100011
041100     DISPLAY AA-DB2-OPERATION-LIT.                                04110011
041200     DISPLAY AA-DB2-TABLE-1.                                      04120011
041300     DISPLAY AA-DB2-TABLE-2.                                      04130011
041400     DISPLAY AA-DB2-TABLE-3.                                      04140011
041500     SET AC-DB2-ERROR TO TRUE.                                    04150011
041600                                                                  04160011
041700     COPY DPPD004.                                                04170011
041800                                                                  04180011
041900     CALL 'ILBOABN0' USING ABEND-CODE.                            04190011
042000                                                                  04200011
042100*---------------------------------------------------------------  04210011
042200*     ABEND ROUTINE                                               04220011
042300*---------------------------------------------------------------  04230011
042400 Z999-ABEND.                                                      04240011
042500     DISPLAY AA-ABEND-LIT.                                        04250011
042600     DISPLAY AA-PROGRAM-LIT.                                      04260011
042700     DISPLAY AA-PARAGRAPH-LIT.                                    04270011
042800     DISPLAY AA-MESSAGE-LINE.                                     04280011
042900     CALL 'ILBOABN0' USING ABEND-CODE.                            04290011
043000                                                                  04300011
