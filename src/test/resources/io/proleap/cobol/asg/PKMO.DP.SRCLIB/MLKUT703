000010 IDENTIFICATION DIVISION.                                                 
000020 PROGRAM-ID.         MLKUT703.                                            
000030 AUTHOR.             TESS BESTE.                                          
000040 INSTALLATION.       KOHLS DEPARTMENT STORES.                             
000050 DATE-WRITTEN.       05/28/98.                                            
000060 DATE-COMPILED.                                                           
000070                                                                          
000080******************************************************************        
000090* THIS PROGRAM WILL LOCK A TABLE, THEN CONTINUE LOOPING TO                
000100* MAINTAIN THE LOCK UNTIL THE JOB IS CANCELED.  IT IS PARTICULARLY        
000110* USEFUL FOR CAUSING A -911 (DEADLOCK) SO THAT RESTART/RETRY LOGIC        
000120* CAN BE TESTED.                                                          
000200*                                                                         
000275* CHANGE THE PROGRAM AS FOLLOWS BEFORE COMPILING AND EXECUTING IT:        
000276*    1) CHANGE THE CODE IN PARAGRAPH 1000-LOCK TO OBTAIN THE              
000277*       TYPE OF LOCK NEEDED - EXCLUSIVE OR SHARED.                        
000278*    2) CHANGE THE TABLE NAME THROUGHOUT THE PROGRAM TO THE NAME          
000279*       OF THE TABLE TO BE LOCKED.                                        
000283******************************************************************        
000284                                                                          
000290 ENVIRONMENT DIVISION.                                                    
000300 CONFIGURATION SECTION.                                                   
000310 INPUT-OUTPUT SECTION.                                                    
000320 FILE-CONTROL.                                                            
000370                                                                          
000380 DATA DIVISION.                                                           
000390 FILE SECTION.                                                            
000510                                                                          
000520 WORKING-STORAGE SECTION.                                                 
000530                                                                          
000540 01  PS-PROGRAM-SWITCHES.                                                 
000541     05  PS-END-OF-LOOP-SW            PIC X  VALUE 'N'.                   
000542         88  PS-END-OF-LOOP                  VALUE 'Y'.                   
000543 01  PV-PROGRAM-VARIABLES.                                                
000544     05  PV-DB2-OPER-ATTEMPTED        PIC X(30).                          
000545     05  PV-PARAGRAPH-NAME            PIC X(30).                          
000549 01  ABEND-CODE                       PIC S9(04) COMP                     
000550                                                 VALUE ZERO.              
000668                                                                          
000669******************************************************************        
000670*  DB2 ERROR MESSAGES FORMAT AREA.                                        
000671******************************************************************        
000672     COPY DPWS004.                                                        
000673                                                                          
000674******************************************************************        
000675*  USED FOR DB2 ERRORS                                                    
000676******************************************************************        
000677     EXEC SQL                                                             
000678         INCLUDE SQLCA                                                    
000679     END-EXEC.                                                            
000680                                                                          
000681******************************************************************        
000682*  M/L MONTH-TO-DATE MAJOR CLASS TABLE                                    
000683******************************************************************        
000684     EXEC SQL                                                             
000685         INCLUDE TMNMCL                                                   
000686     END-EXEC.                                                            
000687                                                                          
003420 LINKAGE SECTION.                                                         
003430                                                                          
003440 PROCEDURE DIVISION.                                                      
003450                                                                          
003460                                                                          
003470 A100-MAIN-MODULE.                                                        
003480                                                                          
003490     PERFORM 1000-LOCK.                                                   
003530     PERFORM 2000-PROCESS UNTIL PS-END-OF-LOOP.                           
003650                                                                          
003660     STOP RUN.                                                            
003670                                                                          
003680                                                                          
003803 1000-LOCK.                                                               
003804                                                                          
003805*    EXEC SQL                                                             
003806*        LOCK TABLE TMNMCL IN EXCLUSIVE MODE                              
003831*    END-EXEC.                                                            
003832     EXEC SQL                                                             
003833         LOCK TABLE TMNMCL IN SHARE MODE                                  
003834     END-EXEC.                                                            
003835                                                                          
003836     EVALUATE SQLCODE                                                     
003837         WHEN 0                                                           
003838             CONTINUE                                                     
003839         WHEN OTHER                                                       
003840             MOVE '1100-LOCK'            TO PV-PARAGRAPH-NAME             
003841             MOVE 'LOCK TABLE'           TO PV-DB2-OPER-ATTEMPTED         
003842             PERFORM 9999-SQL-ABEND                                       
003843     END-EVALUATE.                                                        
003844                                                                          
003845 2000-PROCESS.                                                            
003846                                                                          
003847                                                                          
003848 9999-SQL-ABEND.                                                          
003849                                                                          
003850     MOVE +4013 TO ABEND-CODE.                                            
003851     DISPLAY '** ABEND **         ** = SQLERROR'.                         
003852     DISPLAY '** PROGRAM          ** = MLKUT703'.                         
003853     DISPLAY '** PARAGRAPH        ** = ' PV-PARAGRAPH-NAME.               
003854     DISPLAY '** OPERATION        ** = ' PV-DB2-OPER-ATTEMPTED.           
003855                                                                          
003856*    THE FOLLOWING COPYBOOK UTILIZES THE DB2 ABEND MODULE                 
003857*    DSNTIAR TO CONVERT SQLCA INTO UNDERSTANDABLE VERBAGE.                
003858     COPY  DPPD004.                                                       
003860                                                                          
003900     CALL 'ILBOABN0'  USING ABEND-CODE.                                   
