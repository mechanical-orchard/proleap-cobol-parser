000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      SAKUT060.                                       00030000
000400 AUTHOR.          STEVEN NOWAK.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    05/01/09.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*                ***  SALES SUMMARY PROGRAM  ***                  00100000
001100*=================================================================00110000
001200*                                                                 00120000
001300*  E-COMMERCE HAS INTRODUCED NEW SERVICES, SUCH AS GIFT WRAPPING, 00130000
001400*  SHIPPING, ETC., WHICH NEED TO BE POSTED TO THE GENERAL LEDGER. 00140000
001500*  IN ADDITION, NON-MERCHANDISE CATEGORIES (KCK CARDS TENDERED,   00150000
001600*  SCANNING LAW PENALTY PAYMENTS, MANIFESTO PAYMENTS) DEFINED BY  00160000
001700*  SALES AUDIT ALSO NEED TO BE POSTED TO GENERAL LEDGER.  THIS    00170000
001800*  PROGRAM IS INTENDED TO GATHER THE CATEGORIES BY STORE TOTAL.   00180000
001900*  EACH STORE WILL HAVE A REGISTER 00 ROW FOR EACH CATERGORY      00190000
002000*  CODE. A RECORD WILL BE WRITTEN OUT FOR EACH STORE.             00200000
002100*                                                                 00210000
002200*  THIS PROGRAM WILL ALSO SUMMARIZE EXISTING TSASUM CATEGORIES.   00220000
002300*  THE CATEGORIES WILL BE SUMMED BY REGISTER, WRITING A SINGLE    00230000
002400*  ROW (00) FOR EACH CATEGORY FOR EACH STORE.                     00240000
002500*                                                                 00250000
002600*   INPUT: INP01 - CONTAINS POS DATE, WHICH IS USED AS THE        00260000
002700*                  PROCESS DATE.                                  00270000
002800*                                                                 00280000
002900*========================== CHANGE LOG ===========================00290000
003000*  AUTH      BY        DATE                 DESCRIPTION           00300000
003100*=================================================================00310000
003200* WR36527  S. NOWAK   05-01-09   CREATE PROGRAM                   00320000
003300*                                                                 00330000
003400*=================================================================00340000
003500* WR36454  J. HUNTER  05-23-09                                    00350000
003600* ALLOWING FOR THE TENDER ID TO BE 19 OR 30 DIGITS FOR THE        00360000
003700* 30 DIGIT GIFT CARDS / KMRC'S IN THE KKT PROCESSING.             00370000
003800******************************************************************00380000
003900* PKE3397  COGNIZANT  02-23-10                                    00390000
004000* APART FROM THE FOLLOWING SUB-CLASS 11, 12 AND 14 UNDER DEPT 830 00400000
004100* , OTHER SUB-CLASS FOR DEPT 830 WILL BE INCLUDED UNDER KKH       00410000
004200* CATEGORY (KKH-CURSOR AND KKHCOR-CURSOR).                        00420000
004300******************************************************************00430000
004400* WR38834  CHERI PARMLEY  08-17-10                                00440000
004500* CHANGE TO ADD BREAST CANCER AWARENESS MERCHANDISE (DEPT 836)    00450000
004600* COSA FILE.                                                      00460000
004700* CATEGORY (BRC-CURSOR AND BRCCOR-CURSOR).                        00470000
004800******************************************************************00480000
004900* CHG0053632 - COGNIZANT - JULY 2013                              00490000
005000*     BREAK OUT SHIP FROM STORE TRANSACTIONS (SFS) IN A MANNER    00500000
005100*     SIMILAR TO KKB TRANSACTIONS.                                00510000
005200******************************************************************00520000
005300* PROJECT 8446E - BARB SCHULTZ - FEBRUARY 2014                    00530000
005400*     BREAK OUT BOPUS (BPS) SIMILAR TO SFS TRANSACTIONS.          00540000
005500******************************************************************00550000
005600* CHG0104429 - COGNIZANT - MARCH 2015                             00560000
005700*     DETOKENIZE TENDER ID TO QUERY IT AGAINST SVT TABLE WHICH HAS00570000
005800*     CLEAR DATA AS PART OF COSA DATA SECURITY PROJECT            00580000
005900******************************************************************00590000
006000* CHG0142791 - BARB SCHULTZ - JUNE 2016                           00600000
006100*     ADD 'SUM_TYP_CDE' ROWS EQUAL TO 'C' FOR EVERY ROW THAT HAS  00610000
006200*     A 'D' AND IS AN OUTLET STORE EXCEPT FOR RGST_NBR = 0. THIS  00620000
006300*     WILL BE USED TO HAVE CO SALES IN SA ONLINE.                 00630000
006400******************************************************************00640000
006500* CHG0188487 - BARB SCHULTZ - JAN  2018                           00650000
006600*     ADDED BOSS (BOS) SIMILAR TO BPS TRANSACTIONS.               00660000
006610*     ALSO ADDEDD BPR (BOPUS RETURN), BSR (BOSS RETURN),          00661000
006620*     BOSCOR (BOSS CORRECTION), BPRCOR (BOPUS CORRECTION), AND    00662000
006630*     BPRCOR (BOPUS CORRECTION) CURSORS TO THE PROGRAM.           00663000
006640******************************************************************00664000
006650* XXXXXXXXXX - COGNIZANT    - NOV  2018                           00665000
006660*     ADDED 'DON' FOR CHARITABLE DONATIONS SIMILAR TO KKB.        00666000
006670******************************************************************00667000
006680* CHG0253070 - JIM HUNTER/GERMAN BANDA JANUARY 2021.              00668000
006690*     COMBINE 14 SALES CURSORS INTO 1 FOR EFFICIENCY.             00669000
006700*     COMBINE 14 CORRECTIONS CURSORS INTO 1 FOR EFFICIENCY.       00670000
006670******************************************************************00670111
261235* CHG0261235 - JIM HUNTER            SEPTEMBER 2021.              00670214
261235*     REMOVE OUTLET CURSOR AND ALL RELATED PROCESSING.            00670314
261235*     OUTLET STORES CLOSED IN LATE JULY, 2021.                    00670414
261235******************************************************************00672014
006730                                                                  00673000
006740 ENVIRONMENT DIVISION.                                            00674000
006750 CONFIGURATION SECTION.                                           00675000
006760                                                                  00676000
006770 SOURCE-COMPUTER.        IBM-3090.                                00677000
006780 OBJECT-COMPUTER.        IBM-3090.                                00678000
006790                                                                  00679000
006800 INPUT-OUTPUT SECTION.                                            00680000
006900 FILE-CONTROL.                                                    00690000
007000                                                                  00700000
007100     SELECT POS-DATE-CARD-FILE ASSIGN TO INP01.                   00710000
007200     SELECT TSASUM-FILE        ASSIGN TO OUT01.                   00720000
007300                                                                  00730000
007400 DATA DIVISION.                                                   00740000
007500 FILE SECTION.                                                    00750000
007600                                                                  00760000
007700 FD  POS-DATE-CARD-FILE                                           00770000
007800     RECORDING MODE IS F                                          00780000
007900     BLOCK CONTAINS 0 RECORDS                                     00790000
008000     LABEL RECORDS ARE STANDARD.                                  00800000
008100                                                                  00810000
008200 01  POS-DATE-CARD-RECORD             PIC  X(80).                 00820000
008300                                                                  00830000
008400 FD  TSASUM-FILE                                                  00840000
008500     RECORDING MODE IS F                                          00850000
008600     BLOCK CONTAINS 0 RECORDS                                     00860000
008700     LABEL RECORDS ARE STANDARD.                                  00870000
008800                                                                  00880000
008900 01  TSASUM-REC                       PIC  X(26).                 00890000
009000                                                                  00900000
009100                                                                  00910000
009200******************************************************************00920000
009300*                       WORKING STORAGE                           00930000
009400******************************************************************00940000
009500 WORKING-STORAGE SECTION.                                         00950000
009600                                                                  00960000
009700 01  W-START                          PIC  X(50)    VALUE         00970000
009800     ' *** WORKING STORAGE STARTS HERE FOR SAKUT060 *** '.        00980000
009900                                                                  00990000
010000******************************************************************01000000
010100*                          SWITCHES                               01010000
010200******************************************************************01020000
010300 01  PS-PROGRAM-SWITCHES.                                         01030000
010400     05  PS-END-OF-SUM-CURSOR-SW      PIC  X(01)    VALUE 'N'.    01040000
010500         88  PS-END-OF-SUM-CURSOR                   VALUE 'Y'.    01050000
010800     05  PS-END-OF-MULTI-CURSOR-SW    PIC  X(01)    VALUE 'N'.    01080000
010900         88  PS-END-OF-MULTI-CURSOR                 VALUE 'Y'.    01090000
011000     05  PS-END-OF-KKB-CURSOR-SW      PIC  X(01)    VALUE 'N'.    01100000
011100         88  PS-END-OF-KKB-CURSOR                   VALUE 'Y'.    01110000
011200     05  PS-END-OF-KKT-CURSOR-SW      PIC  X(01)    VALUE 'N'.    01120000
011300         88  PS-END-OF-KKT-CURSOR                   VALUE 'Y'.    01130000
011400     05  PS-END-OF-DKEYSUM-CURSOR-SW  PIC  X(01)    VALUE 'N'.    01140000
011500         88  PS-END-OF-DKEYSUM-CURSOR               VALUE 'Y'.    01150000
011600     05  PS-END-OF-SUMCOR-CURSOR-SW   PIC  X(01)    VALUE 'N'.    01160000
011700         88  PS-END-OF-SUMCOR-CURSOR                VALUE 'Y'.    01170000
011800     05  PS-END-OF-MULTICOR-CURSOR-SW PIC  X(01)    VALUE 'N'.    01180000
011900         88  PS-END-OF-MULTICOR-CURSOR              VALUE 'Y'.    01190000
012000     05  PS-END-OF-KKTCOR-CURSOR-SW   PIC  X(01)    VALUE 'N'.    01200000
012100         88  PS-END-OF-KKTCOR-CURSOR                VALUE 'Y'.    01210000
012200     05  PS-END-OF-CARD-FILE-SW       PIC  X(01)    VALUE 'N'.    01220000
012300         88  PS-END-OF-CARD-FILE                    VALUE 'Y'.    01230000
012400                                                                  01240000
012500     05  PS-FIRST-TIME-THRU-KKT-SW    PIC  X(01)    VALUE 'N'.    01250000
012600         88  PS-FIRST-TIME-THRU-KKT                 VALUE 'Y'.    01260000
012700         88  PS-NOT-FIRST-TIME-THRU-KKT             VALUE 'N'.    01270000
012800     05  PS-FIRST-TIME-THRU-KKTCOR-SW PIC  X(01)    VALUE 'N'.    01280000
012900         88  PS-FIRST-TIME-THRU-KKTCOR              VALUE 'Y'.    01290000
013000         88  PS-NOT-FIRST-TIME-THRU-KKTCOR          VALUE 'N'.    01300000
013100     05  PS-KCK-CARD-FOUND-SW         PIC  X(01)    VALUE 'N'.    01310000
013200         88  PS-KCK-CARD-FOUND                      VALUE 'Y'.    01320000
013300         88  PS-KCK-CARD-NOT-FOUND                  VALUE 'N'.    01330000
013400     05  PS-SALES-CORR-SW             PIC  X(01)    VALUE 'N'.    01340000
013500         88  PS-SALES-CORR-YES                      VALUE 'Y'.    01350000
013600         88  PS-SALES-CORR-NO                       VALUE 'N'.    01360000
013700     05  PS-UPDATE-ROW-SW             PIC  X(01)    VALUE 'N'.    01370000
013800         88  PS-UPDATE-ROW-YES                      VALUE 'Y'.    01380000
013900         88  PS-UPDATE-ROW-NO                       VALUE 'N'.    01390000
014000     05  PS-SUMCOR-UPDATE-SW          PIC  X(01)    VALUE 'N'.    01400000
014100         88  PS-SUMCOR-UPDATE-YES                   VALUE 'Y'.    01410000
014200         88  PS-SUMCOR-UPDATE-NO                    VALUE 'N'.    01420000
014300     05  PS-SUM-INSERT-SW             PIC  X(01)    VALUE 'N'.    01430000
014400         88  PS-SUM-INSERT-YES                      VALUE 'Y'.    01440000
014500         88  PS-SUM-INSERT-NO                       VALUE 'N'.    01450000
014600                                                                  01460000
014700                                                                  01470000
014800******************************************************************01480000
014900*                         CONSTANTS                               01490000
015000******************************************************************01500000
015100 01  PC-CONSTANTS.                                                01510000
015200     05  PC-CURRENT-PROGRAM-NAME      PIC  X(08)    VALUE         01520000
015300                                                  'SAKUT060'.     01530000
015400                                                                  01540000
015500     05  PC-ROW-NOT-FOUND             PIC S9(04)    VALUE +100    01550000
015600                                                    COMP SYNC.    01560000
015700                                                                  01570000
015800******************************************************************01580000
015900*                      ACCUMULATORS                               01590000
016000******************************************************************01600000
016100 01  PA-ACCULATORS.                                               01610000
016200     05  PV-SUM-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01620000
016400     05  PV-MULTI-CURSOR-CNT          PIC  9(07)    VALUE ZERO.   01640000
016500     05  PV-KKB-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01650000
016600     05  PV-DON-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01660000
016700     05  PV-BRC-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01670000
016800     05  PV-KKH-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01680000
016900     05  PV-KKU-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01690000
017000     05  PV-KKS-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01700000
017100     05  PV-KKT-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01710000
017200     05  PV-MAN-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01720000
017300     05  PV-PTG-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01730000
017400     05  PV-SPN-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01740000
017500     05  PV-SFS-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01750000
017600     05  PV-BPS-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01760000
017700     05  PV-BPR-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01770000
017800     05  PV-BOS-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01780000
017900     05  PV-BSR-CURSOR-CNT            PIC  9(07)    VALUE ZERO.   01790000
018000                                                                  01800000
018100     05  PV-DKEYSUM-CURSOR-CNT        PIC  9(07)    VALUE ZERO.   01810000
018200     05  PV-SUMCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01820000
018300     05  PV-MULTICOR-CURSOR-CNT       PIC  9(07)    VALUE ZERO.   01830000
018400     05  PV-KKBCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01840000
018500     05  PV-DONCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01850000
018600     05  PV-BRCCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01860000
018700     05  PV-KKHCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01870000
018800     05  PV-KKUCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01880000
018900     05  PV-KKSCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01890000
019000     05  PV-KKTCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01900000
019100     05  PV-MANCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01910000
019200     05  PV-PTGCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01920000
019300     05  PV-SPNCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01930000
019400     05  PV-SFSCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01940000
019500     05  PV-BPSCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01950000
019600     05  PV-BPRCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01960000
019700     05  PV-BOSCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01970000
019800     05  PV-BSRCOR-CURSOR-CNT         PIC  9(07)    VALUE ZERO.   01980000
019900                                                                  01990000
020000     05  PA-TSASUM-WRITTEN            PIC  9(07)    VALUE ZERO.   02000000
020100     05  PA-TSASUM-INSRT              PIC  9(07)    VALUE ZERO.   02010000
020200     05  PA-TSASUM-UPDT1              PIC  9(07)    VALUE ZERO.   02020000
020300     05  PA-TSASUM-UPDT2              PIC  9(07)    VALUE ZERO.   02030000
020400     05  PA-TSASUM-UPDT3              PIC  9(07)    VALUE ZERO.   02040000
020500                                                                  02050000
020600     05  WS-INSRT-CTG-AMT            PIC  9(11)V99 VALUE ZEROS.   02060000
020700     05  WS-INSRT-CTG-NBR            PIC  9(11)    VALUE ZEROS.   02070000
020800     05  WS-UPDT1-CTG-AMT            PIC  9(11)V99 VALUE ZEROS.   02080000
020900     05  WS-UPDT1-CTG-NBR            PIC  9(11)    VALUE ZEROS.   02090000
021000     05  WS-UPDT2-CTG-AMT            PIC  9(11)V99 VALUE ZEROS.   02100000
021100     05  WS-UPDT2-CTG-NBR            PIC  9(11)    VALUE ZEROS.   02110000
021200     05  WS-UPDT3-CTG-AMT            PIC  9(11)V99 VALUE ZEROS.   02120000
021300     05  WS-UPDT3-CTG-NBR            PIC  9(11)    VALUE ZEROS.   02130000
021400                                                                  02140000
021500******************************************************************02150000
021600*                       VARIABLES                                 02160000
021700******************************************************************02170000
021800 01  PV-VARIABLES.                                                02180000
021900     05  PV-SQL                       PIC S9(04)    VALUE ZEROS.  02190000
022000     05  PV-PARAGRAPH-NAME            PIC  X(30)    VALUE SPACES. 02200000
022100     05  PV-DB2-TABLE-NAME            PIC  X(12)    VALUE SPACES. 02210000
022200     05  PV-DB2-OPERATION             PIC  X(60)    VALUE SPACES. 02220000
022300     05  PV-NULL-IND                  PIC  S9(4)    VALUE ZERO    02230000
022400                                                    COMP SYNC.    02240000
022500     05  PV-OPERATION-MSG-1           PIC  X(40)    VALUE SPACES. 02250000
022600     05  PV-OPERATION-MSG-2           PIC  X(40)    VALUE SPACES. 02260000
022700                                                                  02270000
022800     05  PV-ABEND-PARTN-NBR           PIC  9(04)    VALUE ZEROS.  02280000
022900     05  PV-ABEND-STR-NBR             PIC  9(04)    VALUE ZEROS.  02290000
023000     05  PV-ABEND-SUM-CTG-CDE         PIC  X(03)    VALUE SPACES. 02300000
023100                                                                  02310000
023200 01  PV-DB2-VARIABLES.                                            02320000
023300     05  PV-DB2-PARTN-NBR             PIC S9(04)    COMP          02330000
023400                                                    VALUE ZERO.   02340000
023500     05  PV-DB2-SUM                   PIC S9(09)V99 COMP-3        02350000
023600                                                    VALUE ZERO.   02360000
023700     05  PV-DB2-SUM-UPDT2-TOT         PIC S9(09)V99 COMP-3        02370000
023800                                                    VALUE ZERO.   02380000
023900     05  PV-DB2-COUNT                 PIC S9(09)    COMP          02390000
024000                                                    VALUE ZERO.   02400000
024100     05  PV-DB2-COUNT-UPDT2-TOT       PIC S9(09)    COMP          02410000
024200                                                    VALUE ZERO.   02420000
024300     05  PV-HOLD-DKEY-STR-NBR         PIC S9(04)    COMP          02430000
024400                                                    VALUE ZERO.   02440000
024500     05  PV-SASUM-CTG-AMT             PIC  S9(7)V9(2) COMP-3.     02450000
024600     05  PV-SASUM-CTG-NBR-OF-ITM      PIC  S9(9) COMP.            02460000
024700 01  PV-MULTI-CATEGORY-COUNTS.                                    02470000
024800     05  PV-PREV-STR-NBR              PIC S9(04)    VALUE ZERO.   02480000
024900     05  PV-PREV-PARTN-NBR            PIC S9(04)    VALUE ZERO.   02490000
025000     05  PV-BOS-COUNT                 PIC S9(09)    VALUE ZERO.   02500000
025100     05  PV-BOS-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02510000
025200     05  PV-BPR-COUNT                 PIC S9(09)    VALUE ZERO.   02520000
025300     05  PV-BPR-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02530000
025400     05  PV-BPS-COUNT                 PIC S9(09)    VALUE ZERO.   02540000
025500     05  PV-BPS-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02550000
025600     05  PV-BRC-COUNT                 PIC S9(09)    VALUE ZERO.   02560000
025700     05  PV-BRC-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02570000
025800     05  PV-BSR-COUNT                 PIC S9(09)    VALUE ZERO.   02580000
025900     05  PV-BSR-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02590000
026000     05  PV-DON-COUNT                 PIC S9(09)    VALUE ZERO.   02600000
026100     05  PV-DON-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02610000
026200     05  PV-KKB-COUNT                 PIC S9(09)    VALUE ZERO.   02620000
026300     05  PV-KKB-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02630000
026400     05  PV-KKH-COUNT                 PIC S9(09)    VALUE ZERO.   02640000
026500     05  PV-KKH-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02650000
026600     05  PV-KKS-COUNT                 PIC S9(09)    VALUE ZERO.   02660000
026700     05  PV-KKS-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02670000
026800     05  PV-KKU-COUNT                 PIC S9(09)    VALUE ZERO.   02680000
026900     05  PV-KKU-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02690000
027000     05  PV-MAN-COUNT                 PIC S9(09)    VALUE ZERO.   02700000
027100     05  PV-MAN-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02710000
027200     05  PV-PTG-COUNT                 PIC S9(09)    VALUE ZERO.   02720000
027300     05  PV-PTG-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02730000
027400     05  PV-SFS-COUNT                 PIC S9(09)    VALUE ZERO.   02740000
027500     05  PV-SFS-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02750000
027600     05  PV-SPN-COUNT                 PIC S9(09)    VALUE ZERO.   02760000
027700     05  PV-SPN-DOLLARS-SUM           PIC S9(09)V99 VALUE ZERO.   02770000
027800     05  PV-BOSCOR-COUNT              PIC S9(09)    VALUE ZERO.   02780000
027900     05  PV-BOSCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02790000
028000     05  PV-BPRCOR-COUNT              PIC S9(09)    VALUE ZERO.   02800000
028100     05  PV-BPRCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02810000
028200     05  PV-BPSCOR-COUNT              PIC S9(09)    VALUE ZERO.   02820000
028300     05  PV-BPSCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02830000
028400     05  PV-BRCCOR-COUNT              PIC S9(09)    VALUE ZERO.   02840000
028500     05  PV-BRCCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02850000
028600     05  PV-BSRCOR-COUNT              PIC S9(09)    VALUE ZERO.   02860000
028700     05  PV-BSRCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02870000
028800     05  PV-DONCOR-COUNT              PIC S9(09)    VALUE ZERO.   02880000
028810     05  PV-DONCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02881000
028820     05  PV-KKBCOR-COUNT              PIC S9(09)    VALUE ZERO.   02882000
028821     05  PV-KKBCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02882100
028822     05  PV-KKHCOR-COUNT              PIC S9(09)    VALUE ZERO.   02882200
028823     05  PV-KKHCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02882300
028824     05  PV-KKSCOR-COUNT              PIC S9(09)    VALUE ZERO.   02882400
028825     05  PV-KKSCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02882500
028826     05  PV-KKUCOR-COUNT              PIC S9(09)    VALUE ZERO.   02882600
028827     05  PV-KKUCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02882700
028828     05  PV-MANCOR-COUNT              PIC S9(09)    VALUE ZERO.   02882800
028829     05  PV-MANCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02882900
028830     05  PV-PTGCOR-COUNT              PIC S9(09)    VALUE ZERO.   02883000
028831     05  PV-PTGCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02883100
028832     05  PV-SFSCOR-COUNT              PIC S9(09)    VALUE ZERO.   02883200
028833     05  PV-SFSCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02883300
028834     05  PV-SPNCOR-COUNT              PIC S9(09)    VALUE ZERO.   02883400
028835     05  PV-SPNCOR-DOLLARS-SUM        PIC S9(09)V99 VALUE ZERO.   02883500
028836                                                                  02883600
028837******************************************************************02883700
028838*                       WORK AREA                                 02883800
028839******************************************************************02883900
028840 01  PV-MISC-FIELDS.                                              02884000
028850     05  PV-EDIT-MASK                 PIC  ZZZ,ZZZ,ZZ9.           02885000
028860     05  PV-EDIT-MASK2                PIC  ZZ,ZZZ,ZZZ,ZZ9.99.     02886000
028870     05  PV-EDIT-TEST                 PIC  ZZ,ZZZ,ZZZ,ZZ9.99.     02887000
028880     05  PV-EDIT-TEST-2               PIC  ZZ,ZZZ,ZZZ,ZZ9.99.     02888000
028890     05  PV-EDIT-MASK-TEMP            PIC  ZZZ,ZZZ,ZZ9.99.        02889000
028900     05  PV-EDIT-MASK-TEMP-2          PIC  ZZZ,ZZZ,ZZ9.99.        02890000
029000     05  PV-DISP-COUNT                PIC  9(09).                 02900000
029100     05  PV-DISP-STORE                PIC  X(04).                 02910000
029200     05  PV-DISP-CTG-AMT              PIC  9(09).                 02920000
029300     05  PV-DISP-CTG-COUNT            PIC  9(09).                 02930000
029400     05  PV-DISP-CTG-COUNT-TOT        PIC  9(09).                 02940000
029410     05  PV-DISP-CTG-NBR-OF-ITM       PIC  9(09).                 02941000
029420                                                                  02942000
029430     05  PV-DUMMY                     PIC  X(01)    VALUE SPACE.  02943000
029440                                                                  02944000
029450     05  PV-HOLD-STR-NBR              PIC S9(04)    COMP          02945000
029460                                                    VALUE ZERO.   02946000
029470                                                                  02947000
029480     05  PV-HOLD-PARTN-NBR            PIC  9(04)    VALUE ZERO.   02948000
029490     05  PV-ZEROES                    PIC  X(02)    VALUE '00'.   02949000
029500                                                                  02950000
029600     05  PV-TNDR-ID-ALL.                                          02960000
029700         10  PV-TNDR-ID-ZEROES        PIC  X(02).                 02970000
029800         10  PV-TNDR-ID               PIC  X(10).                 02980000
029900     05  FILLER REDEFINES PV-TNDR-ID-ALL.                         02990000
030000         10  PV-TNDR-ID-NBR           PIC  9(12).                 03000000
030100     05  PV-STR-NBR                   PIC  9(04)    VALUE ZERO.   03010000
030200                                                                  03020000
030300     05  PV-TNDR-ID-NBR-DEC           PIC S9(12)V   COMP-3        03030000
030400                                                    VALUE ZERO.   03040000
030500                                                                  03050000
030600     05  PV-PARA-NAME                 PIC  X(30)    VALUE SPACE.  03060000
030700                                                                  03070000
030800******************************************************************03080000
030900*                       DATE/TIME                                 03090000
031000******************************************************************03100000
031100 01  PV-DATE-AND-TIME-FIELDS.                                     03110000
031200     05  PV-POS-CCYY-MM-DD            PIC  X(10)    VALUE SPACE.  03120000
031300     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      03130000
031400         10  PV-POS-CCYY              PIC  X(04).                 03140000
031500         10  FILLER                   PIC  X(01).                 03150000
031600         10  PV-POS-MM                PIC  X(02).                 03160000
031700         10  FILLER                   PIC  X(01).                 03170000
031800         10  PV-POS-DD                PIC  X(02).                 03180000
031900                                                                  03190000
032000     05  PV-CURR-DATE-CCYYMMDD.                                   03200000
032100         10  PV-CURR-DATE-CCYY        PIC  9(04).                 03210000
032200         10  PV-CURR-DATE-MM          PIC  9(02).                 03220000
032300         10  PV-CURR-DATE-DD          PIC  9(02).                 03230000
032400                                                                  03240000
032500     05  PV-CURR-TIME.                                            03250000
032600         10  PV-CURR-TIME-HH          PIC  9(02)    VALUE ZERO.   03260000
032700         10  PV-CURR-TIME-MM          PIC  9(02)    VALUE ZERO.   03270000
032800         10  PV-CURR-TIME-SSHH        PIC  9(04)    VALUE ZERO.   03280000
032900                                                                  03290000
033000     05  PV-POS-DATE-FORMATTED        PIC  X(10)    VALUE SPACE.  03300000
033100                                                                  03310000
033200     05  PV-SLS-DTE-MM-DD-CCYY.                                   03320000
033300         10  PV-SLS-DTE-MM            PIC  X(02)    VALUE SPACE.  03330000
033400         10  FILLER                   PIC  X(01)    VALUE '/'.    03340000
033500         10  PV-SLS-DTE-DD            PIC  X(02)    VALUE SPACE.  03350000
033600         10  FILLER                   PIC  X(01)    VALUE '/'.    03360000
033700         10  PV-SLS-DTE-CCYY          PIC  X(04)    VALUE SPACE.  03370000
033800                                                                  03380000
033900******************************************************************03390000
034000*               SYSTEM TIME AND DATE VARIABLES                    03400000
034100******************************************************************03410000
034200 01  SYS-DATE-TIME.                                               03420000
034300     05  SYS-DATE                     PIC  X(08)    VALUE SPACES. 03430000
034400     05  SYS-TIME                     PIC  X(08)    VALUE SPACES. 03440000
034500                                                                  03450000
034600 01  ST-BEG-TIME.                                                 03460000
034700     05  ST-BEG-HR                    PIC  9(02)    VALUE ZEROS.  03470000
034800     05  FILLER                       PIC  X(01)    VALUE ':'.    03480000
034900     05  ST-BEG-MN                    PIC  9(02)    VALUE ZEROS.  03490000
035000                                                                  03500000
035100 01  ST-END-TIME.                                                 03510000
035200     05  ST-END-HR                    PIC  9(02)    VALUE ZEROS.  03520000
035300     05  FILLER                       PIC  X(01)    VALUE ':'.    03530000
035400     05  ST-END-MN                    PIC  9(02)    VALUE ZEROS.  03540000
035500                                                                  03550000
035600 01  SD-EDIT-DATE.                                                03560000
035700     05  SD-MONTH                     PIC  9(02)    VALUE ZEROS.  03570000
035800     05  FILLER                       PIC  X(01)    VALUE '-'.    03580000
035900     05  SD-DAY                       PIC  9(02)    VALUE ZEROS.  03590000
036000     05  FILLER                       PIC  X(01)    VALUE '-'.    03600000
036100     05  SD-CENT                      PIC  9(02)    VALUE ZEROS.  03610000
036200     05  SD-YEAR                      PIC  9(02)    VALUE ZEROS.  03620000
036300                                                                  03630000
036400******************************************************************03640000
036500*                        ERROR HANDLING                           03650000
036600******************************************************************03660000
036700 01  ABEND-CODE                       PIC S9(04)    VALUE ZEROS   03670000
036800                                                    COMP SYNC.    03680000
036900     88  ABEND-4001-WRITE-ERROR                     VALUE +4001.  03690000
037000     88  ABEND-4002-READ-ERROR                      VALUE +4002.  03700000
037100     88  ABEND-4003-CTRL-CARD-ERROR                 VALUE +4003.  03710000
037200     88  ABEND-4004-TABLE-ERROR                     VALUE +4004.  03720000
037300     88  ABEND-4005-OPEN-ERROR                      VALUE +4005.  03730000
037400     88  ABEND-4006-CLOSE-ERROR                     VALUE +4006.  03740000
037500     88  ABEND-4007-SEQUENCE-ERROR                  VALUE +4007.  03750000
037600     88  ABEND-4008-DATA-ERROR                      VALUE +4008.  03760000
037700     88  ABEND-4009-KEY-DATA-ERROR                  VALUE +4009.  03770000
037800     88  ABEND-4013-DB2-ERROR                       VALUE +4013.  03780000
037900     88  ABEND-4019-CAL-SUB-ERROR                   VALUE +4019.  03790000
038000     88  ABEND-4444-FORCED-ABEND                    VALUE +4444.  03800000
038100                                                                  03810000
038200                                                                  03820000
038300***************************************************************** 03830000
038400* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    03840000
038500***************************************************************** 03850000
038600 01  CC-CONTROL-CARD.                                             03860000
038700     05  CC-CONTROL-CARD-DISPLAY.                                 03870000
038800         10  CC-CONTROL-NAME          PIC  X(14)    VALUE SPACE.  03880000
038900             88  CC-VALID-CONTROL-NAME              VALUE         03890000
039000                 'P.O.S. DATE = '.                                03900000
039100         10  CC-POS-DATE-MMDDYY       PIC  9(06)    VALUE ZERO.   03910000
039200     05  FILLER                       PIC  X(60)    VALUE SPACE.  03920000
039300                                                                  03930000
039400                                                                  03940000
039500******************************************************************03950000
039600*  TSASUM - TOTALS BY STORE REGISTER                              03960000
039700******************************************************************03970000
039800     COPY SARD008.                                                03980000
039900                                                                  03990000
040000***************************************************************** 04000000
040100*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             04010000
040200***************************************************************** 04020000
040300     COPY DPWS500.                                                04030000
040400                                                                  04040000
040500***************************************************************** 04050000
040600*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            04060000
040700***************************************************************** 04070000
040800     COPY DPWS004.                                                04080000
040900                                                                  04090000
041000******************************************************************04100000
041100* LAYOUT THAT DEFINES THE PARAMETERS NEEDED TO INVOKE PROTEGRITY  04110000
041200* MODULE                                                          04120000
041300******************************************************************04130000
041400     COPY PTYCCSIP.                                               04140000
041500                                                                  04150000
041600******************************************************************04160000
041700* LAYOUT THAT DEFINES THE WORKING VARIABLES TO INVOKE PROTEGRITY  04170000
041800* MODULE                                                          04180000
041900******************************************************************04190000
042000     COPY DPWS031.                                                04200000
042100                                                                  04210000
042200******************************************************************04220000
042300*  DB2 MESSAGE AREA                                               04230000
042400******************************************************************04240000
042500     COPY SQLCA2.                                                 04250000
042600                                                                  04260000
042700***************************************************************** 04270000
042800*  DB2 COMMUNICATION AREA.                                        04280000
042900***************************************************************** 04290000
043000     EXEC SQL                                                     04300000
043100          INCLUDE SQLCA                                           04310000
043200     END-EXEC.                                                    04320000
043300                                                                  04330000
043400***************************************************************** 04340000
043500*  DB2 TABLE TEPDKEY - PROCESSING DAY KEY TABLE                   04350000
043600***************************************************************** 04360000
043700     EXEC SQL                                                     04370000
043800          INCLUDE TEPDKEY                                         04380000
043900     END-EXEC.                                                    04390000
044000                                                                  04400000
044100***************************************************************** 04410000
044200*  DB2 TABLE SVT_CRD_PROD - STORED VALUE SYSTEM CARD              04420000
044300***************************************************************** 04430000
044400     EXEC SQL                                                     04440000
044500          INCLUDE SVT00000                                        04450000
044600     END-EXEC.                                                    04460000
044700                                                                  04470000
044800***************************************************************** 04480000
044900*  DB2 TABLE SVT_KOHLS_CRD_ACCT - STORED VALUE SYSTEM CONTROL TBL 04490000
045000***************************************************************** 04500000
045100     EXEC SQL                                                     04510000
045200          INCLUDE SVT00001                                        04520000
045300     END-EXEC.                                                    04530000
045400                                                                  04540000
045500***************************************************************** 04550000
045600*  DB2 TABLE TEPTRN - TRANSACTION TABLE                           04560000
045700***************************************************************** 04570000
045800     EXEC SQL                                                     04580000
045900          INCLUDE TEPTRN                                          04590000
046000     END-EXEC.                                                    04600000
046100                                                                  04610000
046200***************************************************************** 04620000
046300*  DB2 TABLE TEPITM - TRANSACTION ITEM TABLE                      04630000
046400***************************************************************** 04640000
046500     EXEC SQL                                                     04650000
046600          INCLUDE TEPITM                                          04660000
046700     END-EXEC.                                                    04670000
046800                                                                  04680000
046900***************************************************************** 04690000
047000*  DB2 TABLE TEPTND - TENDER TYPE TABLE                           04700000
047100***************************************************************** 04710000
047200     EXEC SQL                                                     04720000
047300          INCLUDE TEPTND                                          04730000
047400     END-EXEC.                                                    04740000
047500                                                                  04750000
047600***************************************************************** 04760000
047700*  DB2 TABLE TSASUM - TOTALS BY STORE REGISTER TABLE              04770000
047800***************************************************************** 04780000
047900     EXEC SQL                                                     04790000
048000          INCLUDE TSASUM                                          04800000
048100     END-EXEC.                                                    04810000
048200                                                                  04820000
048300***************************************************************** 04830000
048400*  DB2 TABLE TEPPART - PARTITION TABLE                            04840000
048500***************************************************************** 04850000
048600     EXEC SQL                                                     04860000
048700          INCLUDE TEPPART                                         04870000
048800     END-EXEC.                                                    04880000
048900                                                                  04890000
049000******************************************************************04900000
049100*  DB2 TABLE XST_LOC - STORE LOCATION TABLE                       04910000
049200******************************************************************04920000
049300     EXEC SQL                                                     04930000
049400          INCLUDE XST00001                                        04940000
049500     END-EXEC.                                                    04950000
049600                                                                  04960000
049700******************************************************************04970000
049800*  DB2 TABLE XST_TERR  CUST N SRVC TERR TBL                       04980000
049900******************************************************************04990000
050000     EXEC SQL                                                     05000000
050100          INCLUDE XST00007                                        05010000
050200     END-EXEC.                                                    05020000
050300******************************************************************05030000
050400*  DB2 TABLE XST_REGN_TERR  CUST N SRVC REGN TERR TBL             05040000
050500******************************************************************05050000
050600     EXEC SQL                                                     05060000
050700          INCLUDE XST00006                                        05070000
050800     END-EXEC.                                                    05080000
050900                                                                  05090000
051000******************************************************************05100000
051100*  DB2 TABLE XST_DIST_REGN  CUST N SRVC REGN DIST TBL             05110000
051200******************************************************************05120000
051300     EXEC SQL                                                     05130000
051400          INCLUDE XST00004                                        05140000
051500     END-EXEC.                                                    05150000
051600                                                                  05160000
051700******************************************************************05170000
051800*  DB2 TABLE XST_LOC_DIST   CUST N SRVC LOC DIST TBL              05180000
051900******************************************************************05190000
052000     EXEC SQL                                                     05200000
052100          INCLUDE XST00002                                        05210000
052200     END-EXEC.                                                    05220000
052300                                                                  05230000
052400***************************************************************** 05240000
052500*  SUM-CURSOR -- CURSOR TO SUM CTG_AMT GROUPED BY THE VARIOUS     05250000
052600*  CATEGORY CODES.                                                05260000
052700***************************************************************** 05270000
052800     EXEC SQL                                                     05280000
052900       DECLARE SUM-CURSOR CURSOR FOR                              05290000
053000            SELECT  SUM(CTG_AMT) AS PV-DB2-SUM                    05300000
053100                   ,SUM(CTG_NBR_OF_ITM) AS PV-DB2-COUNT           05310000
053200                   ,PARTN_NBR                                     05320000
053300                   ,STR_NBR                                       05330000
053400                   ,SUM_TYP_CDE                                   05340000
053500                   ,SUM_CTG_CDE                                   05350000
053600              FROM  TSASUM                                        05360000
053700             WHERE  PARTN_NBR           = :PV-DB2-PARTN-NBR       05370000
053800              AND   SUM_TYP_CDE         = 'D'                     05380000
053900          GROUP BY  PARTN_NBR, STR_NBR, SUM_CTG_CDE, SUM_TYP_CDE  05390000
054000           WITH UR                                                05400000
054100     END-EXEC.                                                    05410000
054200                                                                  05420000
058200                                                                  05820000
058300***CHG0253070 *************************************************** 05830000
058400*  MULTI-CURSOR -- COMBINING FOLLOWING CURSORS FOR EFFICIENCY:    05840000
058500*  KKB-CURSOR -- CURSOR TO SUM KCK BACK TO SCHOOL SALES.          05850000
058600*  DON-CURSOR -- CURSOR TO SUM CHARITABLE DONATIONS.              05860000
058700*  BRC-CURSOR -- CURSOR TO BREAST CANCER AWARENESS SALES.         05870000
058800*  KKH-CURSOR -- CURSOR TO SUM KCK HOLIDAY SALES.                 05880000
058900*  KKU-CURSOR -- CURSOR TO SUM SUMMER KCK SALES.                  05890000
059000*  KKS-CURSOR -- CURSOR TO SUM KCK SPRING SALES.                  05900000
059100*  MAN-CURSOR -- CURSOR TO SUM MANIFESTO RETURNS.                 05910000
059200*  PTG-CURSOR -- CURSOR TO SUM POSTAGE SALES.                     05920000
059210*  SFS-CURSOR -- CURSOR TO SUM SFS SHIP FROM STORE SALES.         05921000
059220*  BPS-CURSOR -- CURSOR TO SUM BPS STORE SALES                    05922000
059230*  BPR-CURSOR -- CURSOR TO SUM BPR STORE RETURNS                  05923000
059240*  BOS-CURSOR -- CURSOR TO SUM BOS STORE SALES                    05924000
059250*  BSR-CURSOR -- CURSOR TO SUM BOS STORE RETURNS                  05925000
059260*  SPN-CURSOR -- CURSOR TO SUM SCANNING PENALTIES.                05926000
059270***CHG0253070 *************************************************** 05927000
059280     EXEC SQL                                                     05928000
059290       DECLARE MULTI-CURSOR CURSOR FOR                            05929000
059300            SELECT  ITM.NET_CHRGD_AMT                             05930000
059400                   ,ITM.STR_NBR                                   05940000
059500                   ,ITM.DEPT_NBR                                  05950000
059600                   ,ITM.SUB_CL_NBR                                05960000
059700                   ,TRN.TRN_TYP_CDE                               05970000
059800                   ,TRN.OMNI_CHNL_FFLMT_TYP_CDE                   05980000
059810              FROM  TEPITM ITM                                    05981000
059820                   ,TEPTRN TRN                                    05982000
059830             WHERE  ITM.PARTN_NBR        = :PV-DB2-PARTN-NBR      05983000
059840              AND   TRN.PARTN_NBR        = :PV-DB2-PARTN-NBR      05984000
059850              AND   TRN.STR_NBR          = ITM.STR_NBR            05985000
059860              AND   TRN.RGST_ID          = ITM.RGST_ID            05986000
059870              AND   TRN.TRN_NBR          = ITM.TRN_NBR            05987000
059880              AND   TRN.STRT_TM          = ITM.STRT_TM            05988000
059890              AND   TRN.VOID_ABRT_CDE    = 'N'                    05989000
059900              AND   TRN.TRN_STAT_CDE     = 'Z'                    05990000
060000              AND   TRN.TRN_TYP_CDE     IN ('01','02','11','12',  06000000
060100                                            '22','23','24','25')  06010000
060200              AND   TRN.SLS_CORR_SEQ_NBR = ITM.SLS_CORR_SEQ_NBR   06020000
060300              AND   ITM.SLS_CORR_SEQ_NBR = 0                      06030000
060400              AND   LIV_RSLU_CDE        IN ('+', '-')             06040000
060500              AND ((DEPT_NBR IN('099','800','817','830','836',    06050000
060600                                '850'))                           06060000
060700               OR  (TRN.OMNI_CHNL_FFLMT_TYP_CDE   IS NOT NULL))   06070000
060800          ORDER BY  ITM.STR_NBR                                   06080000
060900           WITH UR                                                06090000
061000     END-EXEC.                                                    06100000
061100                                                                  06110000
061200***************************************************************** 06120000
061300***************************************************************** 06130000
061400*  KKT-CURSOR -- CURSOR TO SUM KCK GIFT CARDS TENDERED.           06140000
061500***************************************************************** 06150000
061600     EXEC SQL                                                     06160000
061700       DECLARE KKT-CURSOR CURSOR FOR                              06170000
061800            SELECT  TND.STR_NBR                                   06180000
061900                   ,TND.TNDR_ID                                   06190000
062000                   ,TND.TNDR_AMT                                  06200000
062100                   ,TND.TNDR_ID_LEN_NBR                           06210000
062200              FROM  TEPTND TND                                    06220000
062300                   ,TEPTRN TRN                                    06230000
062400             WHERE  TND.PARTN_NBR        = :PV-DB2-PARTN-NBR      06240000
062500              AND   TRN.PARTN_NBR        = :PV-DB2-PARTN-NBR      06250000
062600              AND   TRN.STR_NBR          = TND.STR_NBR            06260000
062700              AND   TRN.RGST_ID          = TND.RGST_ID            06270000
062800              AND   TRN.TRN_NBR          = TND.TRN_NBR            06280000
062900              AND   TRN.STRT_TM          = TND.STRT_TM            06290000
063000              AND   TRN.VOID_ABRT_CDE    = 'N'                    06300000
063100              AND   TRN.TRN_STAT_CDE     = 'Z'                    06310000
063200              AND   TRN.SLS_CORR_SEQ_NBR = TND.SLS_CORR_SEQ_NBR   06320000
063300              AND   TND.SLS_CORR_SEQ_NBR = 0                      06330000
063400              AND   TNDR_VOID_IND        = 'N'                    06340000
063500              AND   TNDR_TYP_CDE         = '13'                   06350000
063600              AND   TNDR_ID_ERR_CDE      = '0'                    06360000
063700              AND   TNDR_ID_LEN_NBR      >  5                     06370000
063800          ORDER BY  TND.STR_NBR                                   06380000
063900           WITH UR                                                06390000
064000     END-EXEC.                                                    06400000
064100***************************************************************** 06410000
064200*  DKEYSUM CURSOR -- CURSOR TO FIND CHANGES AFFECTING TSASUM      06420000
064300***************************************************************** 06430000
064400     EXEC SQL                                                     06440000
064500       DECLARE DKEYSUM-CURSOR CURSOR FOR                          06450000
064600        SELECT DISTINCT  DKY.STR_NBR                              06460000
064700                        ,DKY.SLS_DTE                              06470000
064800                        ,PRT.PARTN_NBR                            06480000
064900              FROM  TEPDKEY DKY                                   06490000
065000                   ,TEPPART PRT                                   06500000
065100             WHERE  DKY.PRCG_DTE         = :PV-POS-CCYY-MM-DD     06510000
065200              AND   DKY.SLS_DTE          = PRT.SLS_DTE            06520000
065300          ORDER BY  DKY.STR_NBR, DKY.SLS_DTE                      06530000
065400           WITH UR                                                06540000
065500     END-EXEC.                                                    06550000
065600                                                                  06560000
065700***************************************************************** 06570000
065800*  SUMCOR-CURSOR -- CURSOR TO SUM SALES CORRECTIONS PICKED UP BY  06580000
065900*  DKEYSUM-CURSOR.                                                06590000
066000***************************************************************** 06600000
066100     EXEC SQL                                                     06610000
066200       DECLARE SUMCOR-CURSOR CURSOR FOR                           06620000
066300            SELECT  SUM(CTG_AMT) AS PV-DB2-SUM                    06630000
066400                   ,SUM(CTG_NBR_OF_ITM) AS PV-DB2-COUNT           06640000
066500                   ,PARTN_NBR                                     06650000
066600                   ,STR_NBR                                       06660000
066700                   ,SUM_CTG_CDE                                   06670000
066800              FROM  TSASUM                                        06680000
066900             WHERE  PARTN_NBR           = :EPPART-PARTN-NBR       06690000
067000              AND   STR_NBR             = :PV-HOLD-DKEY-STR-NBR   06700000
067100              AND   RGST_ID             <> 0                      06710000
067200              AND   SUM_TYP_CDE         = 'S'                     06720000
067300          GROUP BY  PARTN_NBR, STR_NBR, SUM_CTG_CDE               06730000
067400           WITH UR                                                06740000
067500     END-EXEC.                                                    06750000
067600                                                                  06760000
067700***CHG0253070 *************************************************** 06770000
067800*  MULTICOR-CURSOR -- COMBINING FOLLOWING CURSORS FOR EFFICIENCY: 06780000
067900*  KKBCOR-CURSOR -- CURSOR TO SUM KCK BACK TO SCHOOL SALES.       06790000
068000*  DONCOR-CURSOR -- CURSOR TO SUM CHARITABLE DONATIONS.           06800000
068100*  BRCCOR-CURSOR -- CURSOR TO BREAST CANCER AWARENESS SALES.      06810000
068200*  KKHCOR-CURSOR -- CURSOR TO SUM KCK HOLIDAY SALES.              06820000
068300*  KKUCOR-CURSOR -- CURSOR TO SUM SUMMER KCK SALES.               06830000
068400*  KKSCOR-CURSOR -- CURSOR TO SUM KCK SPRING SALES.               06840000
068500*  MANCOR-CURSOR -- CURSOR TO SUM MANIFESTO RETURNS.              06850000
068600*  PTGCOR-CURSOR -- CURSOR TO SUM POSTAGE SALES.                  06860000
068700*  SFSCOR-CURSOR -- CURSOR TO SUM SFS SHIP FROM STORE SALES.      06870000
068800*  BPSCOR-CURSOR -- CURSOR TO SUM BPS STORE SALES                 06880000
068900*  BPRCOR-CURSOR -- CURSOR TO SUM BPR STORE RETURNS               06890000
069000*  BOSCOR-CURSOR -- CURSOR TO SUM BOS STORE SALES                 06900000
069100*  BSRCOR-CURSOR -- CURSOR TO SUM BOS STORE RETURNS               06910000
069200*  SPNCOR-CURSOR -- CURSOR TO SUM SCANNING PENALTIES.             06920000
069300***CHG0253070 *************************************************** 06930000
069400     EXEC SQL                                                     06940000
069500       DECLARE MULTICOR-CURSOR CURSOR FOR                         06950000
069600            SELECT  ITM.NET_CHRGD_AMT                             06960000
069700                   ,DKY.STR_NBR                                   06970000
069800                   ,ITM.DEPT_NBR                                  06980000
069900                   ,ITM.SUB_CL_NBR                                06990000
070000                   ,TRN.TRN_TYP_CDE                               07000000
070100                   ,TRN.OMNI_CHNL_FFLMT_TYP_CDE                   07010000
070200                   ,PRT.PARTN_NBR                                 07020000
070300              FROM  TEPITM ITM                                    07030000
070400                   ,TEPTRN TRN                                    07040000
070500                   ,TEPDKEY DKY                                   07050000
070600                   ,TEPPART PRT                                   07060000
070700             WHERE  DKY.PRCG_DTE          = :PV-POS-CCYY-MM-DD    07070000
070800              AND   PRT.SLS_DTE           = DKY.SLS_DTE           07080000
070900              AND   ITM.PARTN_NBR         = PRT.PARTN_NBR         07090000
071000              AND   TRN.PARTN_NBR         = PRT.PARTN_NBR         07100000
071100              AND   ITM.STR_NBR           = DKY.STR_NBR           07110000
071200              AND   TRN.STR_NBR           = DKY.STR_NBR           07120000
071300              AND   ITM.RGST_ID           = DKY.RGST_ID           07130000
071400              AND   TRN.RGST_ID           = DKY.RGST_ID           07140000
071500              AND   ITM.TRN_NBR           = DKY.TRN_NBR           07150000
071600              AND   TRN.TRN_NBR           = DKY.TRN_NBR           07160000
071700              AND   ITM.STRT_TM           = DKY.STRT_TM           07170000
071800              AND   ITM.SLS_CORR_SEQ_NBR  = DKY.SLS_CORR_SEQ_NBR  07180000
071900              AND   TRN.SLS_CORR_SEQ_NBR  = DKY.SLS_CORR_SEQ_NBR  07190000
072000              AND   TRN.VOID_ABRT_CDE     = 'N'                   07200000
072100              AND   TRN.TRN_STAT_CDE     IN ('V', 'L', 'R')       07210000
072200              AND   TRN.TRN_TYP_CDE      IN ('01','02','11','12', 07220000
072300                                             '22','23','24','25') 07230000
072400              AND   DKY.SLS_CORR_SEQ_NBR <> 0                     07240000
072500              AND   LIV_RSLU_CDE         IN ('+', '-')            07250000
072600              AND ((DEPT_NBR IN('099','800','817','830','836',    07260000
072700                                '850'))                           07270000
072800               OR  (TRN.OMNI_CHNL_FFLMT_TYP_CDE   IS NOT NULL))   07280000
072900          ORDER BY  DKY.STR_NBR, PRT.PARTN_NBR                    07290000
073000           WITH UR                                                07300000
073100     END-EXEC.                                                    07310000
073200                                                                  07320000
073300***************************************************************** 07330000
073400***************************************************************** 07340000
073500*  KKTCOR-CURSOR -- CURSOR TO SUM KCK GIFT CARDS TENDERED         07350000
073600*  SALES CORRECTIONS.                                             07360000
073700***************************************************************** 07370000
073800     EXEC SQL                                                     07380000
073900       DECLARE KKTCOR-CURSOR CURSOR FOR                           07390000
074000            SELECT  DKY.STR_NBR                                   07400000
074100                   ,TND.TNDR_ID                                   07410000
074200                   ,TND.TNDR_AMT                                  07420000
074300                   ,TND.TNDR_ID_LEN_NBR                           07430000
074400                   ,PRT.PARTN_NBR                                 07440000
074500              FROM  TEPTND TND                                    07450000
074600                   ,TEPTRN TRN                                    07460000
074700                   ,TEPDKEY DKY                                   07470000
074800                   ,TEPPART PRT                                   07480000
074900             WHERE  DKY.PRCG_DTE          = :PV-POS-CCYY-MM-DD    07490000
075000              AND   PRT.SLS_DTE           = DKY.SLS_DTE           07500000
075100              AND   TND.PARTN_NBR         = PRT.PARTN_NBR         07510000
075200              AND   TRN.PARTN_NBR         = PRT.PARTN_NBR         07520000
075300              AND   TND.STR_NBR           = DKY.STR_NBR           07530000
075400              AND   TRN.STR_NBR           = DKY.STR_NBR           07540000
075500              AND   TND.RGST_ID           = DKY.RGST_ID           07550000
075600              AND   TRN.RGST_ID           = DKY.RGST_ID           07560000
075700              AND   TND.TRN_NBR           = DKY.TRN_NBR           07570000
075800              AND   TRN.TRN_NBR           = DKY.TRN_NBR           07580000
075900              AND   TND.STRT_TM           = DKY.STRT_TM           07590000
076000              AND   TRN.STRT_TM           = DKY.STRT_TM           07600000
076100              AND   TRN.VOID_ABRT_CDE     = 'N'                   07610000
076200              AND   TRN.TRN_STAT_CDE      IN ('V', 'L', 'R')      07620000
076300              AND   TND.SLS_CORR_SEQ_NBR  = DKY.SLS_CORR_SEQ_NBR  07630000
076400              AND   TRN.SLS_CORR_SEQ_NBR  = DKY.SLS_CORR_SEQ_NBR  07640000
076500              AND   DKY.SLS_CORR_SEQ_NBR  <> 0                    07650000
076600              AND   TNDR_VOID_IND         = 'N'                   07660000
076700              AND   TNDR_TYP_CDE          = '13'                  07670000
076800              AND   TNDR_ID_ERR_CDE       = '0'                   07680000
076900              AND   TNDR_ID_LEN_NBR       >  5                    07690000
077000          ORDER BY  DKY.STR_NBR                                   07700000
077100                   ,PRT.PARTN_NBR                                 07710000
077200           WITH UR                                                07720000
077300     END-EXEC.                                                    07730000
077400                                                                  07740000
077500***************************************************************** 07750000
077600                                                                  07760000
077700 PROCEDURE DIVISION.                                              07770000
077800******************************************************************07780000
077900* MAINLINE                                                        07790000
078000******************************************************************07800000
078100 0000-MAINLINE-PARAGRAPH.                                         07810000
078200                                                                  07820000
078300     PERFORM A1000-INITIALIZE-PROGRAM.                            07830000
078400                                                                  07840000
078500     PERFORM B1000-OPEN-SUM-CURSOR.                               07850000
078600     PERFORM B2000-FETCH-SUM-CURSOR.                              07860000
078700     PERFORM B3000-PROCESS-SUM-CURSOR                             07870000
078800       UNTIL PS-END-OF-SUM-CURSOR.                                07880000
078900     PERFORM B4000-CLOSE-SUM-CURSOR.                              07890000
079000                                                                  07900000
079100     PERFORM C1000-OPEN-MULTI-CURSOR.                             07910000
079200     PERFORM C2000-FETCH-MULTI-CURSOR.                            07920000
079300     MOVE EPITM-STR-NBR TO PV-PREV-STR-NBR.                       07930000
079400     PERFORM C3000-PROCESS-MULTI-CURSOR                           07940000
079500       UNTIL  PS-END-OF-MULTI-CURSOR.                             07950000
079600*    WRITE OUT CATEGORY TOTALS FOR LAST STORE                     07960000
079700     PERFORM C3100-WRITE-MULTI-FOR-PREV-STR.                      07970000
079800     PERFORM C4000-CLOSE-MULTI-CURSOR.                            07980000
079900                                                                  07990000
080000                                                                  08000000
080100                                                                  08010000
080200     PERFORM F1000-OPEN-KKT-CURSOR.                               08020000
080300     PERFORM F2000-FETCH-KKT-CURSOR.                              08030000
080400     PERFORM F3000-PROCESS-KKT-CURSOR                             08040000
080500       UNTIL PS-END-OF-KKT-CURSOR.                                08050000
080600     PERFORM F4000-CLOSE-KKT-CURSOR.                              08060000
080700                                                                  08070000
080800     PERFORM K1000-OPEN-DKEYSUM-CURSOR.                           08080000
080900     PERFORM K2000-FETCH-DKEYSUM-CURSOR.                          08090000
081000     PERFORM K3000-PROCESS-DKEYSUM-CURSOR                         08100000
081100       UNTIL PS-END-OF-DKEYSUM-CURSOR.                            08110000
081200     PERFORM K4000-CLOSE-DKEYSUM-CURSOR.                          08120000
081300                                                                  08130000
081400     PERFORM L1000-OPEN-MULTICOR-CURSOR.                          08140000
081500     PERFORM L2000-FETCH-MULTICOR-CURSOR.                         08150000
081600     MOVE EPDKEY-STR-NBR    TO PV-PREV-STR-NBR.                   08160000
081700     MOVE EPPART-PARTN-NBR  TO PV-PREV-PARTN-NBR                  08170000
081800     PERFORM L3000-PROCESS-MULTICOR-CURSOR                        08180000
081900       UNTIL PS-END-OF-MULTICOR-CURSOR.                           08190000
082000     PERFORM L3100-WRITE-MULTICOR-PREV-STR.                       08200000
082100     PERFORM L4000-CLOSE-MULTICOR-CURSOR.                         08210000
082200                                                                  08220000
082300                                                                  08230000
082400     PERFORM O1000-OPEN-KKTCOR-CURSOR.                            08240000
082500     PERFORM O2000-FETCH-KKTCOR-CURSOR.                           08250000
082600     PERFORM O3000-PROCESS-KKTCOR-CURSOR                          08260000
082700       UNTIL PS-END-OF-KKTCOR-CURSOR.                             08270000
082800     PERFORM O4000-CLOSE-KKTCOR-CURSOR.                           08280000
082900                                                                  08290000
083600     PERFORM Z9900-END-PROC.                                      08360000
083700                                                                  08370000
083800     STOP RUN.                                                    08380000
083900                                                                  08390000
084000                                                                  08400000
084100***************************************************************** 08410000
084200* OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS,       08420000
084300* FIND PARTITION NUMBER, OPEN MASTER-CURSOR                       08430000
084400***************************************************************** 08440000
084500 A1000-INITIALIZE-PROGRAM.                                        08450000
084600                                                                  08460000
084700     OPEN INPUT  POS-DATE-CARD-FILE.                              08470000
084800     OPEN OUTPUT TSASUM-FILE.                                     08480000
084900                                                                  08490000
085000     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 08500000
085100     DISPLAY 'SYS-DATE-TIME ' SYS-DATE-TIME.                      08510000
085200     MOVE PC-CURRENT-PROGRAM-NAME TO DP031-PROGRAM-NAME.          08520000
085300                                                                  08530000
085400     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            08540000
085500     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            08550000
085600                                                                  08560000
085700     MOVE SYS-DATE (1:2) TO SD-CENT.                              08570000
085800     MOVE SYS-DATE (3:2) TO SD-YEAR.                              08580000
085900     MOVE SYS-DATE (5:2) TO SD-MONTH.                             08590000
086000     MOVE SYS-DATE (7:2) TO SD-DAY.                               08600000
086100                                                                  08610000
086200     PERFORM A1100-PROCESS-CONTROL-CARD.                          08620000
086300                                                                  08630000
086400     PERFORM A1200-SELECT-PARTITION-NBR.                          08640000
086500                                                                  08650000
086600     SET PS-FIRST-TIME-THRU-KKT                                   08660000
086700         PS-FIRST-TIME-THRU-KKTCOR                                08670000
086800         PS-KCK-CARD-FOUND                                        08680000
086900         PS-UPDATE-ROW-NO                                         08690000
087000         PS-SUM-INSERT-NO                                         08700000
087100         PS-SALES-CORR-NO          TO TRUE.                       08710000
087200                                                                  08720000
087300                                                                  08730000
087400***************************************************************** 08740000
087500* READ CONTROL CARD TO GET POS DATE IN MMDDYY FORMAT.  CALL       08750000
087600* DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD PROCESS DATE.      08760000
087700***************************************************************** 08770000
087800 A1100-PROCESS-CONTROL-CARD.                                      08780000
087900                                                                  08790000
088000     PERFORM A1110-READ-POS-DATE-CARD-FILE.                       08800000
088100                                                                  08810000
088200     CLOSE POS-DATE-CARD-FILE.                                    08820000
088300                                                                  08830000
088400     IF PS-END-OF-CARD-FILE                                       08840000
088500         MOVE 'A1100-PROCESS-CONTROL-CARD' TO PV-PARAGRAPH-NAME   08850000
088600         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  08860000
088700                                                                  08870000
088800         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   08880000
088900                                                                  08890000
089000         PERFORM Z9200-ABEND                                      08900000
089100     END-IF.                                                      08910000
089200                                                                  08920000
089300     DISPLAY PC-CURRENT-PROGRAM-NAME                              08930000
089400             ' - CONTROL CARD = (' CC-CONTROL-CARD-DISPLAY  ')'.  08940000
089500                                                                  08950000
089600     PERFORM A1115-CONVERT-INPUT-DATE.                            08960000
089700                                                                  08970000
089800                                                                  08980000
089900***************************************************************** 08990000
090000* READ DATE CONTROL CARD.                                         09000000
090100***************************************************************** 09010000
090200 A1110-READ-POS-DATE-CARD-FILE.                                   09020000
090300                                                                  09030000
090400     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 09040000
090500        AT END                                                    09050000
090600           SET PS-END-OF-CARD-FILE     TO TRUE.                   09060000
090700                                                                  09070000
090800                                                                  09080000
090900***************************************************************** 09090000
091000* CALL KOHLS CALENDAR ROUTINE:                                    09100000
091100*      PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).               09110000
091200*    RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT).    09120000
091300***************************************************************** 09130000
091400 A1115-CONVERT-INPUT-DATE.                                        09140000
091500                                                                  09150000
091600     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              09160000
091700                                                                  09170000
091800     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   09180000
091900     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   09190000
092000     SET  DPG52-LK-DTE-GREG            TO TRUE.                   09200000
092100                                                                  09210000
092200     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    09220000
092300                                                                  09230000
092400     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    09240000
092500                                             DPG54 DPG55 DPG56.   09250000
092600     EVALUATE TRUE                                                09260000
092700         WHEN DPG54-SEVERE-ERROR                                  09270000
092800         WHEN DPG54-DATE-INVALID                                  09280000
092900             MOVE 'A1115-CONVERT-INPUT-DATE'                      09290000
093000                                       TO PV-PARAGRAPH-NAME       09300000
093100             MOVE 'ERROR CONVERTING INPUT CARD DATE'              09310000
093200                                       TO PV-OPERATION-MSG-1      09320000
093300             SET ABEND-4019-CAL-SUB-ERROR                         09330000
093400                                       TO TRUE                    09340000
093500             MOVE DPG54-ERROR-MESSAGE                             09350000
093600                                       TO PV-OPERATION-MSG-2      09360000
093700             PERFORM Z9200-ABEND                                  09370000
093800     END-EVALUATE.                                                09380000
093900                                                                  09390000
094000     MOVE DPG55-GREG-CC-DATE-FMT       TO PV-POS-DATE-FORMATTED.  09400000
094100     MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-POS-CCYY-MM-DD.      09410000
094200                                                                  09420000
094300                                                                  09430000
094400***************************************************************** 09440000
094500* FIND PARTITION NUMBER THAT CORRESPONDS WITH CONTROL CARD DATE   09450000
094600***************************************************************** 09460000
094700 A1200-SELECT-PARTITION-NBR.                                      09470000
094800                                                                  09480000
094900     EXEC SQL                                                     09490000
095000          SELECT  PARTN_NBR                                       09500000
095100            INTO :PV-DB2-PARTN-NBR                                09510000
095200             FROM TEPPART                                         09520000
095300            WHERE SLS_DTE      = :PV-POS-CCYY-MM-DD               09530000
095400              AND STR_GP_CDE   = 'A'                              09540000
095500              AND DB_STRUC_CDE = 'O'                              09550000
095600          WITH UR                                                 09560000
095700     END-EXEC.                                                    09570000
095800                                                                  09580000
095900     EVALUATE TRUE                                                09590000
096000        WHEN SQLCODE = ZERO                                       09600000
096100            CONTINUE                                              09610000
096200                                                                  09620000
096300        WHEN SQLCODE NOT EQUAL ZERO                               09630000
096400            MOVE SQLCODE TO PV-SQL                                09640000
096500                                                                  09650000
096600            MOVE 'A1200-SELECT-PARTITION-NBR' TO PV-PARAGRAPH-NAME09660000
096700            MOVE 'TEPPART'                    TO PV-DB2-TABLE-NAME09670000
096800                                                                  09680000
096900            STRING 'ERROR ON SELECT OF TEPPART - SQLCODE = '      09690000
097000                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    09700000
097100            END-STRING                                            09710000
097200                                                                  09720000
097300            SET ABEND-4004-TABLE-ERROR TO TRUE                    09730000
097400            PERFORM Z9100-SQL-ABEND                               09740000
097500     END-EVALUATE.                                                09750000
097600                                                                  09760000
097700                                                                  09770000
097800***************************************************************** 09780000
097900* OPEN THE SUM-CURSOR                                             09790000
098000***************************************************************** 09800000
098100 B1000-OPEN-SUM-CURSOR.                                           09810000
098200                                                                  09820000
098300     EXEC SQL                                                     09830000
098400          OPEN SUM-CURSOR                                         09840000
098500     END-EXEC.                                                    09850000
098600                                                                  09860000
098700     EVALUATE TRUE                                                09870000
098800         WHEN SQLCODE = ZERO                                      09880000
098900            CONTINUE                                              09890000
099000                                                                  09900000
099100         WHEN SQLWARN0 NOT EQUAL SPACE                            09910000
099200         WHEN SQLCODE NOT EQUAL ZERO                              09920000
099300            MOVE SQLCODE TO PV-SQL                                09930000
099400                                                                  09940000
099500            MOVE 'B1000-OPEN-SUM-CURSOR' TO PV-PARAGRAPH-NAME     09950000
099600            MOVE 'TSASUM'                TO PV-DB2-TABLE-NAME     09960000
099700                                                                  09970000
099800            STRING 'ERROR ON OPEN OF SUM-CURSOR - SQLCODE = '     09980000
099900                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    09990000
100000            END-STRING                                            10000000
100100                                                                  10010000
100200            SET ABEND-4005-OPEN-ERROR TO TRUE                     10020000
100300            PERFORM Z9100-SQL-ABEND                               10030000
100400     END-EVALUATE.                                                10040000
100500                                                                  10050000
100600                                                                  10060000
100700***************************************************************** 10070000
100800* FETCH THE SUM CURSOR                                            10080000
100900***************************************************************** 10090000
101000 B2000-FETCH-SUM-CURSOR.                                          10100000
101100     EXEC SQL                                                     10110000
101200          FETCH SUM-CURSOR                                        10120000
101300           INTO :PV-DB2-SUM                                       10130000
101400               ,:PV-DB2-COUNT                                     10140000
101500               ,:SASUM-PARTN-NBR                                  10150000
101600               ,:SASUM-STR-NBR                                    10160000
101700               ,:SASUM-SUM-TYP-CDE                                10170000
101800               ,:SASUM-SUM-CTG-CDE                                10180000
101900     END-EXEC.                                                    10190000
102000                                                                  10200000
102100     EVALUATE TRUE                                                10210000
102200         WHEN SQLCODE = ZERO                                      10220000
102300            ADD 1 TO PV-SUM-CURSOR-CNT                            10230000
102400                                                                  10240000
102500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          10250000
102600            SET PS-END-OF-SUM-CURSOR TO TRUE                      10260000
102700                                                                  10270000
102800         WHEN SQLWARN0 NOT EQUAL SPACE                            10280000
102900         WHEN SQLCODE NOT EQUAL ZERO                              10290000
103000            MOVE PV-DB2-PARTN-NBR     TO PV-ABEND-PARTN-NBR       10300000
103100            MOVE SASUM-STR-NBR        TO PV-ABEND-STR-NBR         10310000
103200            MOVE SASUM-SUM-CTG-CDE    TO PV-ABEND-SUM-CTG-CDE     10320000
103300                                                                  10330000
103400            MOVE SQLCODE TO PV-SQL                                10340000
103500                                                                  10350000
103600            MOVE 'B2000-FETCH-SUM-CURSOR' TO PV-PARAGRAPH-NAME    10360000
103700            MOVE 'TSASUM'                 TO PV-DB2-TABLE-NAME    10370000
103800                                                                  10380000
103900            STRING 'ERROR ON FETCH OF SUM-CURSOR - SQLCODE = '    10390000
104000                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    10400000
104100            END-STRING                                            10410000
104200                                                                  10420000
104300            SET ABEND-4002-READ-ERROR TO TRUE                     10430000
104400                                                                  10440000
104500            PERFORM Z9100-SQL-ABEND                               10450000
104600     END-EVALUATE.                                                10460000
104700                                                                  10470000
104800                                                                  10480000
104900***************************************************************** 10490000
105000* FETCH THE SUM-CURSOR                                            10500000
105100* - PROCESS AND INSERT 00 REGISTER ROW FOR STORES                 10510000
105200***************************************************************** 10520000
105300 B3000-PROCESS-SUM-CURSOR.                                        10530000
105400                                                                  10540000
105500     MOVE 'B3000-PROCESS-SUM-CURSOR' TO PV-PARA-NAME.             10550000
105600                                                                  10560000
105700     MOVE 00               TO SASUM-RGST-ID.                      10570000
105800     MOVE PV-DB2-SUM       TO SASUM-CTG-AMT.                      10580000
105900     MOVE PV-DB2-COUNT     TO SASUM-CTG-NBR-OF-ITM.               10590000
106000     MOVE 'S'              TO SASUM-CTG-SRC-CDE.                  10600000
106100                                                                  10610000
106200     SET PS-SUM-INSERT-YES TO TRUE.                               10620000
106300                                                                  10630000
106400     PERFORM W2000-CHECK-TSASUM.                                  10640000
106500                                                                  10650000
106600     MOVE ZEROS TO PV-DB2-SUM                                     10660000
106700                   PV-DB2-COUNT.                                  10670000
106800                                                                  10680000
106900     PERFORM B2000-FETCH-SUM-CURSOR.                              10690000
107000                                                                  10700000
107100                                                                  10710000
107200***************************************************************** 10720000
107300* CLOSE THE SUM CURSOR                                            10730000
107400***************************************************************** 10740000
107500 B4000-CLOSE-SUM-CURSOR.                                          10750000
107600                                                                  10760000
107700     EXEC SQL                                                     10770000
107800          CLOSE SUM-CURSOR                                        10780000
107900     END-EXEC.                                                    10790000
108000                                                                  10800000
108100     EVALUATE TRUE                                                10810000
108200         WHEN SQLCODE = ZERO                                      10820000
108300            CONTINUE                                              10830000
108400                                                                  10840000
108500         WHEN SQLWARN0 NOT EQUAL SPACE                            10850000
108600         WHEN SQLCODE NOT EQUAL ZERO                              10860000
108700            MOVE SQLCODE TO PV-SQL                                10870000
108800                                                                  10880000
108900            MOVE 'B4000-CLOSE-SUM-CURSOR' TO PV-PARAGRAPH-NAME    10890000
109000            MOVE 'TSASUM'                 TO PV-DB2-TABLE-NAME    10900000
109100                                                                  10910000
109200            STRING 'ERROR ON CLOSE OF SUM-CURSOR - SQLCODE = '    10920000
109300                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    10930000
109400            END-STRING                                            10940000
109500                                                                  10950000
109600            SET ABEND-4006-CLOSE-ERROR TO TRUE                    10960000
109700            PERFORM Z9100-SQL-ABEND                               10970000
109800     END-EVALUATE.                                                10980000
109900                                                                  10990000
110000                                                                  11000000
110100***************************************************************** 11010000
110200* OPEN THE MULTI-CURSOR                                           11020000
110300***************************************************************** 11030000
110400 C1000-OPEN-MULTI-CURSOR.                                         11040000
110500     EXEC SQL                                                     11050000
110600          OPEN MULTI-CURSOR                                       11060000
110700     END-EXEC.                                                    11070000
110800                                                                  11080000
110900     EVALUATE TRUE                                                11090000
111000         WHEN SQLCODE = ZERO                                      11100000
111100            CONTINUE                                              11110000
111200                                                                  11120000
111300         WHEN SQLWARN0 NOT EQUAL SPACE                            11130000
111400         WHEN SQLCODE NOT EQUAL ZERO                              11140000
111500            MOVE SQLCODE TO PV-SQL                                11150000
111600                                                                  11160000
111700            MOVE 'C1000-OPEN-MULTI-CURSOR' TO PV-PARAGRAPH-NAME   11170000
111800            MOVE 'TEPITM'                  TO PV-DB2-TABLE-NAME   11180000
111900                                                                  11190000
112000            STRING 'ERROR ON OPEN OF MULTI-CURSOR - SQLCODE = '   11200000
112100                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    11210000
112200            END-STRING                                            11220000
112300                                                                  11230000
112400            SET ABEND-4005-OPEN-ERROR TO TRUE                     11240000
112500            PERFORM Z9100-SQL-ABEND                               11250000
112600     END-EVALUATE.                                                11260000
112700                                                                  11270000
112800                                                                  11280000
112900***************************************************************** 11290000
113000* FETCH THE MULTI CURSOR                                          11300000
113100***************************************************************** 11310000
113200 C2000-FETCH-MULTI-CURSOR.                                        11320000
113300     EXEC SQL                                                     11330000
113400          FETCH MULTI-CURSOR                                      11340000
113500           INTO :EPITM-NET-CHRGD-AMT                              11350000
113600              , :EPITM-STR-NBR                                    11360000
113700              , :EPITM-DEPT-NBR                                   11370000
113800              , :EPITM-SUB-CL-NBR                                 11380000
113900              , :EPTRN-TRN-TYP-CDE                                11390000
114000              , :EPTRN-OMNI-CHNL-FFLMT-TYP-CDE :PV-NULL-IND       11400000
114100     END-EXEC.                                                    11410000
114200                                                                  11420000
114300     EVALUATE TRUE                                                11430000
114400         WHEN SQLCODE = ZERO                                      11440000
114500            ADD 1 TO PV-MULTI-CURSOR-CNT                          11450000
114600            IF PV-NULL-IND = -1                                   11460000
114700                MOVE SPACES TO EPTRN-OMNI-CHNL-FFLMT-TYP-CDE      11470000
114800            END-IF                                                11480000
114900                                                                  11490000
115000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          11500000
115100            SET PS-END-OF-MULTI-CURSOR TO TRUE                    11510000
115200                                                                  11520000
115300         WHEN SQLWARN0 NOT EQUAL SPACE                            11530000
115400         WHEN SQLCODE NOT EQUAL ZERO                              11540000
115500            MOVE PV-DB2-PARTN-NBR    TO PV-ABEND-PARTN-NBR        11550000
115600            MOVE EPITM-STR-NBR       TO PV-ABEND-STR-NBR          11560000
115700                                                                  11570000
115800            MOVE SQLCODE TO PV-SQL                                11580000
115900                                                                  11590000
116000            MOVE 'C2000-FETCH-MULTI-CURSOR' TO PV-PARAGRAPH-NAME  11600000
116100            MOVE 'TEPITM'                 TO PV-DB2-TABLE-NAME    11610000
116200                                                                  11620000
116300            STRING 'ERROR ON FETCH OF MULTI-CURSOR - SQLCODE = '  11630000
116400                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    11640000
116500            END-STRING                                            11650000
116600                                                                  11660000
116700            SET ABEND-4002-READ-ERROR TO TRUE                     11670000
116800                                                                  11680000
116900            PERFORM Z9100-SQL-ABEND                               11690000
117000     END-EVALUATE.                                                11700000
117100                                                                  11710000
117200                                                                  11720000
117300***************************************************************** 11730000
117400*  PROCESS THE MULTI-CURSOR                                       11740000
117500*    - IF STORE BREAK, WRITE PREV STORE TOTALS AND RESET COUNTS   11750000
117600*    - DETERMINE CATEGORY BUCKET AND INCREMENT ITS COUNTS         11760000
117700*  FETCH NEXT ROW FROM THE MULTI-CURSOR                           11770000
117800***************************************************************** 11780000
117900 C3000-PROCESS-MULTI-CURSOR.                                      11790000
118000                                                                  11800000
118100     MOVE 'C3000-PROCESS-MULTI-CURSOR' TO PV-PARA-NAME.           11810000
118200     IF EPITM-STR-NBR NOT EQUAL PV-PREV-STR-NBR                   11820000
118300         PERFORM C3100-WRITE-MULTI-FOR-PREV-STR                   11830000
118400         PERFORM C3200-ZERO-OUT-MULTI-COUNTS                      11840000
118500         MOVE EPITM-STR-NBR TO PV-PREV-STR-NBR                    11850000
118600     END-IF.                                                      11860000
118700                                                                  11870000
118800**   BOS                                                          11880000
118900     IF (EPTRN-TRN-TYP-CDE = '01' OR                              11890000
119000         EPTRN-TRN-TYP-CDE = '02')                                11900000
119100     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BOS'                    11910000
119200         ADD +1                    TO  PV-BOS-COUNT               11920000
119300                                       PV-BOS-CURSOR-CNT          11930000
119400         ADD EPITM-NET-CHRGD-AMT   TO  PV-BOS-DOLLARS-SUM         11940000
119500     END-IF.                                                      11950000
119600                                                                  11960000
119700**   BPR                                                          11970000
119800     IF (EPTRN-TRN-TYP-CDE = '11' OR                              11980000
119900         EPTRN-TRN-TYP-CDE = '12')                                11990000
120000     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BPS'                    12000000
120100         ADD +1                    TO  PV-BPR-COUNT               12010000
120200                                       PV-BPR-CURSOR-CNT          12020000
120300         ADD EPITM-NET-CHRGD-AMT   TO  PV-BPR-DOLLARS-SUM         12030000
120400     END-IF.                                                      12040000
120500                                                                  12050000
120600**   BPS                                                          12060000
120700     IF (EPTRN-TRN-TYP-CDE = '01' OR                              12070000
120800         EPTRN-TRN-TYP-CDE = '02')                                12080000
120900     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BPS'                    12090000
121000         ADD +1                    TO  PV-BPS-COUNT               12100000
121100                                       PV-BPS-CURSOR-CNT          12110000
121200         ADD EPITM-NET-CHRGD-AMT   TO  PV-BPS-DOLLARS-SUM         12120000
121300     END-IF.                                                      12130000
121400                                                                  12140000
121500**   BRC                                                          12150000
121600     IF EPITM-DEPT-NBR  = '836'                                   12160000
121700         ADD +1                    TO  PV-BRC-COUNT               12170000
121800                                       PV-BRC-CURSOR-CNT          12180000
121900         ADD EPITM-NET-CHRGD-AMT   TO  PV-BRC-DOLLARS-SUM         12190000
122000     END-IF.                                                      12200000
122100                                                                  12210000
122200**   BSR                                                          12220000
122300     IF (EPTRN-TRN-TYP-CDE = '11' OR                              12230000
122400         EPTRN-TRN-TYP-CDE = '12')                                12240000
122500     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BOS'                    12250000
122600         ADD +1                    TO  PV-BSR-COUNT               12260000
122700                                       PV-BSR-CURSOR-CNT          12270000
122800         ADD EPITM-NET-CHRGD-AMT   TO  PV-BSR-DOLLARS-SUM         12280000
122900     END-IF.                                                      12290000
123000                                                                  12300000
123100**   DON                                                          12310000
123200     IF  EPITM-DEPT-NBR    = '817'                                12320000
123300     AND EPITM-SUB-CL-NBR  = '10'                                 12330000
123400         ADD +1                    TO  PV-DON-COUNT               12340000
123500                                       PV-DON-CURSOR-CNT          12350000
123600         ADD EPITM-NET-CHRGD-AMT   TO  PV-DON-DOLLARS-SUM         12360000
123700     END-IF.                                                      12370000
123800                                                                  12380000
123900**   KKB                                                          12390000
124000     IF  EPITM-DEPT-NBR    = '830'                                12400000
124100     AND EPITM-SUB-CL-NBR  = '12'                                 12410000
124200         ADD +1                    TO  PV-KKB-COUNT               12420000
124300                                       PV-KKB-CURSOR-CNT          12430000
124400         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKB-DOLLARS-SUM         12440000
124500     END-IF.                                                      12450000
124600                                                                  12460000
124700**   KKH                                                          12470000
124800     IF  EPITM-DEPT-NBR    = '830'                                12480000
124900     AND EPITM-SUB-CL-NBR  NOT = '11'                             12490000
125000     AND EPITM-SUB-CL-NBR  NOT = '12'                             12500000
125100     AND EPITM-SUB-CL-NBR  NOT = '14'                             12510000
125200         ADD +1                    TO  PV-KKH-COUNT               12520000
125300                                       PV-KKH-CURSOR-CNT          12530000
125400         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKH-DOLLARS-SUM         12540000
125500     END-IF.                                                      12550000
125600                                                                  12560000
125700**   KKS                                                          12570000
125800     IF  EPITM-DEPT-NBR    = '830'                                12580000
125900     AND EPITM-SUB-CL-NBR  = '11'                                 12590000
126000         ADD +1                    TO  PV-KKS-COUNT               12600000
126100                                       PV-KKS-CURSOR-CNT          12610000
126200         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKS-DOLLARS-SUM         12620000
126300     END-IF.                                                      12630000
126400                                                                  12640000
126500**   KKU                                                          12650000
126600     IF  EPITM-DEPT-NBR    = '830'                                12660000
126700     AND EPITM-SUB-CL-NBR  = '14'                                 12670000
126800         ADD +1                    TO  PV-KKU-COUNT               12680000
126900                                       PV-KKU-CURSOR-CNT          12690000
127000         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKU-DOLLARS-SUM         12700000
127100     END-IF.                                                      12710000
127200                                                                  12720000
127300**   MAN                                                          12730000
127400     IF  EPITM-DEPT-NBR    = '850'                                12740000
127500     AND EPITM-SUB-CL-NBR  = '90'                                 12750000
127600         ADD +1                    TO  PV-MAN-COUNT               12760000
127700                                       PV-MAN-CURSOR-CNT          12770000
127800         ADD EPITM-NET-CHRGD-AMT   TO  PV-MAN-DOLLARS-SUM         12780000
127900     END-IF.                                                      12790000
128000                                                                  12800000
128100**   PTG                                                          12810000
128200     IF  EPITM-DEPT-NBR    = '099'                                12820000
128300     AND EPITM-SUB-CL-NBR  = '80'                                 12830000
128400         ADD +1                    TO  PV-PTG-COUNT               12840000
128500                                       PV-PTG-CURSOR-CNT          12850000
128600         ADD EPITM-NET-CHRGD-AMT   TO  PV-PTG-DOLLARS-SUM         12860000
128700     END-IF.                                                      12870000
128800                                                                  12880000
128900**   SFS                                                          12890000
129000     IF (EPTRN-TRN-TYP-CDE = '01' OR                              12900000
129100         EPTRN-TRN-TYP-CDE = '02')                                12910000
129200     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'SFS'                    12920000
129300         ADD +1                    TO  PV-SFS-COUNT               12930000
129400                                       PV-SFS-CURSOR-CNT          12940000
129500         ADD EPITM-NET-CHRGD-AMT   TO  PV-SFS-DOLLARS-SUM         12950000
129600     END-IF.                                                      12960000
129700                                                                  12970000
129800**   SPN                                                          12980000
129900     IF  EPITM-DEPT-NBR    = '800'                                12990000
130000     AND EPITM-SUB-CL-NBR  = '11'                                 13000000
130100         ADD +1                    TO  PV-SPN-COUNT               13010000
130200                                       PV-SPN-CURSOR-CNT          13020000
130300         ADD EPITM-NET-CHRGD-AMT   TO  PV-SPN-DOLLARS-SUM         13030000
130400     END-IF.                                                      13040000
130500                                                                  13050000
130600                                                                  13060000
130700     PERFORM C2000-FETCH-MULTI-CURSOR.                            13070000
130800                                                                  13080000
130900                                                                  13090000
131000***************************************************************** 13100000
131100* WRITE THE MULTI-CURSOR CATEGORY ROWS                            13110000
131200* - SET VALUES IN FIELDS THAT DON'T CHANGE                        13120000
131300* - IF CATEGORY COUNT > 0, INSERT 00 REGISTER ROW FOR STORE       13130000
131400* - PV-DB2-SUM AND PV-DB2-COUNT ARE REQUIRED IN 'W' WRITE PARA'S. 13140000
131500***************************************************************** 13150000
131600 C3100-WRITE-MULTI-FOR-PREV-STR.                                  13160000
131700                                                                  13170000
131800     MOVE PV-DB2-PARTN-NBR        TO SASUM-PARTN-NBR.             13180000
131900     MOVE PV-PREV-STR-NBR         TO SASUM-STR-NBR.               13190000
132000     MOVE 00                      TO SASUM-RGST-ID.               13200000
132100     MOVE 'D'                     TO SASUM-SUM-TYP-CDE.           13210000
132200     MOVE 'S'                     TO SASUM-CTG-SRC-CDE.           13220000
132300     IF PV-BOS-COUNT > 0                                          13230000
132400         MOVE 'BOS'               TO SASUM-SUM-CTG-CDE            13240000
132500         MOVE PV-BOS-DOLLARS-SUM  TO SASUM-CTG-AMT                13250000
132600                                     PV-DB2-SUM                   13260000
132700         MOVE PV-BOS-COUNT        TO SASUM-CTG-NBR-OF-ITM         13270000
132800                                     PV-DB2-COUNT                 13280000
132900         SET PS-UPDATE-ROW-YES    TO TRUE                         13290000
133000         PERFORM W1000-CHECK-TSASUM                               13300000
133100     END-IF.                                                      13310000
133200                                                                  13320000
133300     IF PV-BPR-COUNT > 0                                          13330000
133400         MOVE 'BPR'               TO SASUM-SUM-CTG-CDE            13340000
133500         MOVE PV-BPR-DOLLARS-SUM  TO SASUM-CTG-AMT                13350000
133600                                     PV-DB2-SUM                   13360000
133700         MOVE PV-BPR-COUNT        TO SASUM-CTG-NBR-OF-ITM         13370000
133800                                     PV-DB2-COUNT                 13380000
133840                                                                  13384001
134100                                                                  13410000
134200         SET PS-SALES-CORR-YES    TO TRUE                         13420000
134300         PERFORM W2000-CHECK-TSASUM                               13430000
134400     END-IF.                                                      13440000
134500                                                                  13450000
134600     IF PV-BPS-COUNT > 0                                          13460000
134700         MOVE 'BPS'               TO SASUM-SUM-CTG-CDE            13470000
134800         MOVE PV-BPS-DOLLARS-SUM  TO SASUM-CTG-AMT                13480000
134900                                     PV-DB2-SUM                   13490000
135000         MOVE PV-BPS-COUNT        TO SASUM-CTG-NBR-OF-ITM         13500000
135100                                     PV-DB2-COUNT                 13510000
135200         SET PS-UPDATE-ROW-YES    TO TRUE                         13520000
135300         PERFORM W1000-CHECK-TSASUM                               13530000
135400     END-IF.                                                      13540000
135500                                                                  13550000
135600     IF PV-BRC-COUNT > 0                                          13560000
135700         MOVE 'BRC'               TO SASUM-SUM-CTG-CDE            13570000
135800         MOVE PV-BRC-DOLLARS-SUM  TO SASUM-CTG-AMT                13580000
135900                                     PV-DB2-SUM                   13590000
136000         MOVE PV-BRC-COUNT        TO SASUM-CTG-NBR-OF-ITM         13600000
136100                                     PV-DB2-COUNT                 13610000
136200         SET PS-UPDATE-ROW-YES    TO TRUE                         13620000
136300         PERFORM W1000-CHECK-TSASUM                               13630000
136400     END-IF.                                                      13640000
136500                                                                  13650000
136600     IF PV-BSR-COUNT > 0                                          13660000
136700         MOVE 'BSR'               TO SASUM-SUM-CTG-CDE            13670000
136800         MOVE PV-BSR-DOLLARS-SUM  TO SASUM-CTG-AMT                13680000
136900                                     PV-DB2-SUM                   13690000
137000         MOVE PV-BSR-COUNT        TO SASUM-CTG-NBR-OF-ITM         13700000
137100                                     PV-DB2-COUNT                 13710000
137200         SET PS-SALES-CORR-YES    TO TRUE                         13720000
137300         PERFORM W2000-CHECK-TSASUM                               13730000
137400     END-IF.                                                      13740000
137500                                                                  13750000
137600     IF PV-DON-COUNT > 0                                          13760000
137700         MOVE 'DON'               TO SASUM-SUM-CTG-CDE            13770000
137800         MOVE PV-DON-DOLLARS-SUM  TO SASUM-CTG-AMT                13780000
137900                                     PV-DB2-SUM                   13790000
138000         MOVE PV-DON-COUNT        TO SASUM-CTG-NBR-OF-ITM         13800000
138100                                     PV-DB2-COUNT                 13810000
138200         SET PS-UPDATE-ROW-YES    TO TRUE                         13820000
138300         PERFORM W1000-CHECK-TSASUM                               13830000
138400     END-IF.                                                      13840000
138500                                                                  13850000
138600     IF PV-KKB-COUNT > 0                                          13860000
138700         MOVE 'KKB'               TO SASUM-SUM-CTG-CDE            13870000
138800         MOVE PV-KKB-DOLLARS-SUM  TO SASUM-CTG-AMT                13880000
138900                                     PV-DB2-SUM                   13890000
139000         MOVE PV-KKB-COUNT        TO SASUM-CTG-NBR-OF-ITM         13900000
139100                                     PV-DB2-COUNT                 13910000
139200         SET PS-UPDATE-ROW-YES    TO TRUE                         13920000
139300         PERFORM W1000-CHECK-TSASUM                               13930000
139400     END-IF.                                                      13940000
139500                                                                  13950000
139600     IF PV-KKH-COUNT > 0                                          13960000
139700         MOVE 'KKH'               TO SASUM-SUM-CTG-CDE            13970000
139800         MOVE PV-KKH-DOLLARS-SUM  TO SASUM-CTG-AMT                13980000
139900                                     PV-DB2-SUM                   13990000
140000         MOVE PV-KKH-COUNT        TO SASUM-CTG-NBR-OF-ITM         14000000
140100                                     PV-DB2-COUNT                 14010000
140200         SET PS-UPDATE-ROW-YES    TO TRUE                         14020000
140300         PERFORM W1000-CHECK-TSASUM                               14030000
140400     END-IF.                                                      14040000
140500                                                                  14050000
140600     IF PV-KKS-COUNT > 0                                          14060000
140700         MOVE 'KKS'               TO SASUM-SUM-CTG-CDE            14070000
140800         MOVE PV-KKS-DOLLARS-SUM  TO SASUM-CTG-AMT                14080000
140900                                     PV-DB2-SUM                   14090000
141000         MOVE PV-KKS-COUNT        TO SASUM-CTG-NBR-OF-ITM         14100000
141100                                     PV-DB2-COUNT                 14110000
141200         SET PS-UPDATE-ROW-YES    TO TRUE                         14120000
141300         PERFORM W1000-CHECK-TSASUM                               14130000
141400     END-IF.                                                      14140000
141500                                                                  14150000
141600     IF PV-KKU-COUNT > 0                                          14160000
141700         MOVE 'KKU'               TO SASUM-SUM-CTG-CDE            14170000
141800         MOVE PV-KKU-DOLLARS-SUM  TO SASUM-CTG-AMT                14180000
141900                                     PV-DB2-SUM                   14190000
142000         MOVE PV-KKU-COUNT        TO SASUM-CTG-NBR-OF-ITM         14200000
142100                                     PV-DB2-COUNT                 14210000
142200         SET PS-UPDATE-ROW-YES    TO TRUE                         14220000
142300         PERFORM W1000-CHECK-TSASUM                               14230000
142400     END-IF.                                                      14240000
142500                                                                  14250000
142600     IF PV-MAN-COUNT > 0                                          14260000
142700         MOVE 'MAN'               TO SASUM-SUM-CTG-CDE            14270000
142800         MOVE PV-MAN-DOLLARS-SUM  TO SASUM-CTG-AMT                14280000
142900                                     PV-DB2-SUM                   14290000
143000         MOVE PV-MAN-COUNT        TO SASUM-CTG-NBR-OF-ITM         14300000
143100                                     PV-DB2-COUNT                 14310000
143200         SET PS-UPDATE-ROW-YES    TO TRUE                         14320000
143300         PERFORM W1000-CHECK-TSASUM                               14330000
143400     END-IF.                                                      14340000
143500                                                                  14350000
143600     IF PV-PTG-COUNT > 0                                          14360000
143700         MOVE 'PTG'               TO SASUM-SUM-CTG-CDE            14370000
143800         MOVE PV-PTG-DOLLARS-SUM  TO SASUM-CTG-AMT                14380000
143900                                     PV-DB2-SUM                   14390000
144000         MOVE PV-PTG-COUNT        TO SASUM-CTG-NBR-OF-ITM         14400000
144100                                     PV-DB2-COUNT                 14410000
144200         SET PS-UPDATE-ROW-YES    TO TRUE                         14420000
144300         PERFORM W1000-CHECK-TSASUM                               14430000
144400     END-IF.                                                      14440000
144500                                                                  14450000
144600     IF PV-SFS-COUNT > 0                                          14460000
144700         MOVE 'SFS'               TO SASUM-SUM-CTG-CDE            14470000
144800         MOVE PV-SFS-DOLLARS-SUM  TO SASUM-CTG-AMT                14480000
144900                                     PV-DB2-SUM                   14490000
145000         MOVE PV-SFS-COUNT        TO SASUM-CTG-NBR-OF-ITM         14500000
145100                                     PV-DB2-COUNT                 14510000
145200         SET PS-UPDATE-ROW-YES    TO TRUE                         14520000
145300         PERFORM W1000-CHECK-TSASUM                               14530000
145400     END-IF.                                                      14540000
145500                                                                  14550000
145600     IF PV-SPN-COUNT > 0                                          14560000
145700         MOVE 'SPN'               TO SASUM-SUM-CTG-CDE            14570000
145800         MOVE PV-SPN-DOLLARS-SUM  TO SASUM-CTG-AMT                14580000
145900                                     PV-DB2-SUM                   14590000
146000         MOVE PV-SPN-COUNT        TO SASUM-CTG-NBR-OF-ITM         14600000
146100                                     PV-DB2-COUNT                 14610000
146200         SET PS-UPDATE-ROW-YES    TO TRUE                         14620000
146300         PERFORM W1000-CHECK-TSASUM                               14630000
146400     END-IF.                                                      14640000
146500                                                                  14650000
146600                                                                  14660000
146700***************************************************************** 14670000
146800* ON A CHANGE IN STORE NUMBER RE-INITIALIZE THE CATEGORY COUNTS   14680000
146900***************************************************************** 14690000
147000 C3200-ZERO-OUT-MULTI-COUNTS.                                     14700000
147100                                                                  14710000
147200     MOVE ZEROES TO  PV-BOS-COUNT                                 14720000
147300                     PV-BOS-DOLLARS-SUM                           14730000
147400                     PV-BPR-COUNT                                 14740000
147500                     PV-BPR-DOLLARS-SUM                           14750000
147600                     PV-BPS-COUNT                                 14760000
147700                     PV-BPS-DOLLARS-SUM                           14770000
147800                     PV-BRC-COUNT                                 14780000
147900                     PV-BRC-DOLLARS-SUM                           14790000
148000                     PV-BSR-COUNT                                 14800000
148100                     PV-BSR-DOLLARS-SUM                           14810000
148200                     PV-DON-COUNT                                 14820000
148300                     PV-DON-DOLLARS-SUM                           14830000
148400                     PV-KKB-COUNT                                 14840000
148500                     PV-KKB-DOLLARS-SUM                           14850000
148600                     PV-KKH-COUNT                                 14860000
148700                     PV-KKH-DOLLARS-SUM                           14870000
148800                     PV-KKS-COUNT                                 14880000
148900                     PV-KKS-DOLLARS-SUM                           14890000
149000                     PV-KKU-COUNT                                 14900000
149100                     PV-KKU-DOLLARS-SUM                           14910000
149200                     PV-MAN-COUNT                                 14920000
149300                     PV-MAN-DOLLARS-SUM                           14930000
149400                     PV-PTG-COUNT                                 14940000
149500                     PV-PTG-DOLLARS-SUM                           14950000
149600                     PV-SFS-COUNT                                 14960000
149700                     PV-SFS-DOLLARS-SUM                           14970000
149800                     PV-SPN-COUNT                                 14980000
149900                     PV-SPN-DOLLARS-SUM.                          14990000
150000                                                                  15000000
150100***************************************************************** 15010000
150200                                                                  15020000
150300***************************************************************** 15030000
150400* CLOSE THE MULTI CURSOR                                          15040000
150500***************************************************************** 15050000
150600 C4000-CLOSE-MULTI-CURSOR.                                        15060000
150700                                                                  15070000
150800     EXEC SQL                                                     15080000
150900          CLOSE MULTI-CURSOR                                      15090000
151000     END-EXEC.                                                    15100000
151100                                                                  15110000
151200     EVALUATE TRUE                                                15120000
151300         WHEN SQLCODE = ZERO                                      15130000
151400            CONTINUE                                              15140000
151500                                                                  15150000
151600         WHEN SQLWARN0 NOT EQUAL SPACE                            15160000
151700         WHEN SQLCODE NOT EQUAL ZERO                              15170000
151800            MOVE SQLCODE TO PV-SQL                                15180000
151900                                                                  15190000
152000            MOVE 'C4000-CLOSE-MULTI-CURSOR' TO PV-PARAGRAPH-NAME  15200000
152100            MOVE 'TEPITM'                 TO PV-DB2-TABLE-NAME    15210000
152200                                                                  15220000
152300            STRING 'ERROR ON CLOSE OF MULTI-CURSOR - SQLCODE = '  15230000
152400                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    15240000
152500            END-STRING                                            15250000
152600                                                                  15260000
152700            SET ABEND-4006-CLOSE-ERROR TO TRUE                    15270000
152800            PERFORM Z9100-SQL-ABEND                               15280000
152900     END-EVALUATE.                                                15290000
153000                                                                  15300000
153100***************************************************************** 15310000
153200* OPEN THE KKT-CURSOR                                             15320000
153300***************************************************************** 15330000
153400 F1000-OPEN-KKT-CURSOR.                                           15340000
153500                                                                  15350000
153600     EXEC SQL                                                     15360000
153700          OPEN KKT-CURSOR                                         15370000
153800     END-EXEC.                                                    15380000
153900                                                                  15390000
154000     EVALUATE TRUE                                                15400000
154100         WHEN SQLCODE = ZERO                                      15410000
154200            CONTINUE                                              15420000
154300                                                                  15430000
154400         WHEN SQLWARN0 NOT EQUAL SPACE                            15440000
154500         WHEN SQLCODE NOT EQUAL ZERO                              15450000
154600            MOVE SQLCODE TO PV-SQL                                15460000
154700                                                                  15470000
154800            MOVE 'F1000-OPEN-KKT-CURSOR' TO PV-PARAGRAPH-NAME     15480000
154900            MOVE 'TEPTND'                TO PV-DB2-TABLE-NAME     15490000
155000                                                                  15500000
155100            STRING 'ERROR ON OPEN OF KKT-CURSOR - SQLCODE = '     15510000
155200                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    15520000
155300            END-STRING                                            15530000
155400                                                                  15540000
155500            SET ABEND-4005-OPEN-ERROR TO TRUE                     15550000
155600            PERFORM Z9100-SQL-ABEND                               15560000
155700     END-EVALUATE.                                                15570000
155800                                                                  15580000
155900                                                                  15590000
156000***************************************************************** 15600000
156100* FETCH THE KKT CURSOR                                            15610000
156200***************************************************************** 15620000
156300 F2000-FETCH-KKT-CURSOR.                                          15630000
156400                                                                  15640000
156500     EXEC SQL                                                     15650000
156600          FETCH KKT-CURSOR                                        15660000
156700           INTO :EPTND-STR-NBR                                    15670000
156800               ,:EPTND-TNDR-ID                                    15680000
156900               ,:EPTND-TNDR-AMT                                   15690000
157000               ,:EPTND-TNDR-ID-LEN-NBR                            15700000
157100     END-EXEC.                                                    15710000
157200                                                                  15720000
157300     EVALUATE TRUE                                                15730000
157400         WHEN SQLCODE = ZERO                                      15740000
157500             ADD 1 TO PV-KKT-CURSOR-CNT                           15750000
157600             MOVE EPTND-STR-NBR           TO PV-STR-NBR           15760000
157700             PERFORM O5000-DETOKENIZE-CARD-NUMBER                 15770013
157800                                                                  15780000
157900             IF (EPTND-TNDR-ID-LEN-NBR = 12                       15790000
158000                 OR EPTND-TNDR-ID-LEN-NBR = 13)                   15800000
158100                 MOVE PV-ZEROES           TO PV-TNDR-ID-ZEROES    15810000
158200                 MOVE EPTND-TNDR-ID(3:10) TO PV-TNDR-ID           15820000
158300             ELSE                                                 15830000
158400                IF EPTND-TNDR-ID-LEN-NBR = 16                     15840000
158500                    MOVE EPTND-TNDR-ID(5:12) TO PV-TNDR-ID-ALL    15850000
158600                ELSE                                              15860000
158700                   IF EPTND-TNDR-ID-LEN-NBR = 19                  15870000
158800                       MOVE EPTND-TNDR-ID(8:12) TO PV-TNDR-ID-ALL 15880000
158900                   ELSE                                           15890000
159000                      IF EPTND-TNDR-ID-LEN-NBR = 30               15900000
159100                          MOVE EPTND-TNDR-ID(19:12)               15910000
159200                                                TO PV-TNDR-ID-ALL 15920000
159300                      END-IF                                      15930000
159400                   END-IF                                         15940000
159500                END-IF                                            15950000
159600             END-IF                                               15960000
159700                                                                  15970000
159800             MOVE PV-TNDR-ID-NBR TO PV-TNDR-ID-NBR-DEC            15980000
159900                                                                  15990000
160000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          16000000
160100             SET PS-END-OF-KKT-CURSOR TO TRUE                     16010000
160200                                                                  16020000
160300             IF  EPTND-STR-NBR  NOT = ZEROES                      16030000
160400                 IF  PV-DB2-SUM NOT = ZEROES                      16040000
160500                     PERFORM F3100-PROCESS                        16050000
160600                 END-IF                                           16060000
160700             END-IF                                               16070000
160800                                                                  16080000
160900         WHEN SQLWARN0 NOT EQUAL SPACE                            16090000
161000         WHEN SQLCODE NOT EQUAL ZERO                              16100000
161100            MOVE PV-DB2-PARTN-NBR  TO PV-ABEND-PARTN-NBR          16110000
161200            MOVE EPTND-STR-NBR     TO PV-ABEND-STR-NBR            16120000
161300                                                                  16130000
161400            MOVE SQLCODE TO PV-SQL                                16140000
161500                                                                  16150000
161600            MOVE 'F2000-FETCH-KKT-CURSOR' TO PV-PARAGRAPH-NAME    16160000
161700            MOVE 'TEPTND'                 TO PV-DB2-TABLE-NAME    16170000
161800                                                                  16180000
161900            STRING 'ERROR ON FETCH OF KKT-CURSOR - SQLCODE = '    16190000
162000                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    16200000
162100            END-STRING                                            16210000
162200                                                                  16220000
162300            SET ABEND-4002-READ-ERROR TO TRUE                     16230000
162400                                                                  16240000
162500            PERFORM Z9100-SQL-ABEND                               16250000
162600     END-EVALUATE.                                                16260000
162700                                                                  16270000
162800                                                                  16280000
162900***************************************************************** 16290000
163000* FETCH THE KKT-CURSOR                                            16300000
163100* - PERFORM A ROUTINE THAT WILL DETERMINE IF THE GIFT CARD        16310000
163200*   FROM THE KKT-CURSOR IS A KCK GIFT CARD                        16320000
163300* - PROCESS AND INSERT 00 REGISTER ROW FOR STORES                 16330000
163400***************************************************************** 16340000
163500 F3000-PROCESS-KKT-CURSOR.                                        16350000
163600                                                                  16360000
163700     IF PS-FIRST-TIME-THRU-KKT                                    16370000
163800         MOVE EPTND-STR-NBR TO PV-HOLD-STR-NBR                    16380000
163900         MOVE ZEROES        TO PV-DB2-SUM                         16390000
164000                               PV-DB2-COUNT                       16400000
164100                                                                  16410000
164200         SET PS-NOT-FIRST-TIME-THRU-KKT TO TRUE                   16420000
164300     END-IF.                                                      16430000
164400                                                                  16440000
164500**  IF THE KCK CARD IS NOT FOUND IN THE STORED VALUE SYSTEM, DO   16450000
164600**  NOT INCLUDE THE CARD IN THE KKT TOTALS IN TSASUM.             16460000
164700                                                                  16470000
164800     IF  EPTND-STR-NBR NOT = ZEROES                               16480000
164900         IF  (EPTND-STR-NBR NOT = PV-HOLD-STR-NBR)                16490000
165000                                                                  16500000
165100             IF  PV-DB2-SUM NOT = ZEROES                          16510000
165200                 PERFORM F3100-PROCESS                            16520000
165300             ELSE                                                 16530000
165400                 MOVE EPTND-STR-NBR TO PV-HOLD-STR-NBR            16540000
165500             END-IF                                               16550000
165600         END-IF                                                   16560000
165700     END-IF.                                                      16570000
165800                                                                  16580000
165900                                                                  16590000
166000     PERFORM V1000-CHECK-FOR-KCK-CARD.                            16600000
166100                                                                  16610000
166200     MOVE ZERO  TO PV-TNDR-ID-NBR-DEC.                            16620000
166300     MOVE SPACE TO PV-TNDR-ID-ALL.                                16630000
166400                                                                  16640000
166500                                                                  16650000
166600     PERFORM F2000-FETCH-KKT-CURSOR.                              16660000
166700                                                                  16670000
166800                                                                  16680000
166900***************************************************************** 16690000
167000* PROCESS THE KKT-CURSOR                                          16700000
167100***************************************************************** 16710000
167200 F3100-PROCESS.                                                   16720000
167300                                                                  16730000
167400     MOVE PV-DB2-PARTN-NBR TO SASUM-PARTN-NBR.                    16740000
167500     MOVE PV-HOLD-STR-NBR  TO SASUM-STR-NBR.                      16750000
167600     MOVE 00               TO SASUM-RGST-ID.                      16760000
167700     MOVE 'D'              TO SASUM-SUM-TYP-CDE.                  16770000
167800     MOVE 'KKT'            TO SASUM-SUM-CTG-CDE.                  16780000
167900     MOVE PV-DB2-SUM       TO SASUM-CTG-AMT.                      16790000
168000     MOVE PV-DB2-COUNT     TO SASUM-CTG-NBR-OF-ITM.               16800000
168100     MOVE 'S'              TO SASUM-CTG-SRC-CDE.                  16810000
168200                                                                  16820000
168300     MOVE 'F3000-PROCESS-KKT-CURSOR'                              16830000
168400                           TO PV-PARA-NAME.                       16840000
168500                                                                  16850000
168600     SET PS-UPDATE-ROW-YES TO TRUE.                               16860000
168700                                                                  16870000
168800     PERFORM W1000-CHECK-TSASUM.                                  16880000
168900                                                                  16890000
169000     MOVE EPTND-STR-NBR    TO PV-HOLD-STR-NBR.                    16900000
169100     MOVE ZERO             TO PV-DB2-SUM                          16910000
169200                              PV-DB2-COUNT.                       16920000
169300                                                                  16930000
169400                                                                  16940000
169500***************************************************************** 16950000
169600* CLOSE THE KKT CURSOR                                            16960000
169700***************************************************************** 16970000
169800 F4000-CLOSE-KKT-CURSOR.                                          16980000
169900                                                                  16990000
170000     EXEC SQL                                                     17000000
170100          CLOSE KKT-CURSOR                                        17010000
170200     END-EXEC.                                                    17020000
170300                                                                  17030000
170400     EVALUATE TRUE                                                17040000
170500         WHEN SQLCODE = ZERO                                      17050000
170600            CONTINUE                                              17060000
170700                                                                  17070000
170800         WHEN SQLWARN0 NOT EQUAL SPACE                            17080000
170900         WHEN SQLCODE NOT EQUAL ZERO                              17090000
171000            MOVE SQLCODE TO PV-SQL                                17100000
171100                                                                  17110000
171200            MOVE 'F4000-CLOSE-KKT-CURSOR' TO PV-PARAGRAPH-NAME    17120000
171300            MOVE 'TEPTND'                 TO PV-DB2-TABLE-NAME    17130000
171400                                                                  17140000
171500            STRING 'ERROR ON CLOSE OF KKT-CURSOR - SQLCODE = '    17150000
171600                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    17160000
171700            END-STRING                                            17170000
171800                                                                  17180000
171900            SET ABEND-4006-CLOSE-ERROR TO TRUE                    17190000
172000            PERFORM Z9100-SQL-ABEND                               17200000
172100     END-EVALUATE.                                                17210000
172200                                                                  17220000
172300***************************************************************** 17230000
172400* OPEN THE DKEYSUM-CURSOR                                         17240000
172500***************************************************************** 17250000
172600 K1000-OPEN-DKEYSUM-CURSOR.                                       17260000
172700                                                                  17270000
172800     EXEC SQL                                                     17280000
172900          OPEN DKEYSUM-CURSOR                                     17290000
173000     END-EXEC.                                                    17300000
173100                                                                  17310000
173200     EVALUATE TRUE                                                17320000
173300         WHEN SQLCODE = ZERO                                      17330000
173400            CONTINUE                                              17340000
173500                                                                  17350000
173600         WHEN SQLWARN0 NOT EQUAL SPACE                            17360000
173700         WHEN SQLCODE NOT EQUAL ZERO                              17370000
173800            MOVE SQLCODE TO PV-SQL                                17380000
173900                                                                  17390000
174000            MOVE 'K1000-OPEN-DKEYSUM-CURSOR' TO PV-PARAGRAPH-NAME 17400000
174100            MOVE 'TEPDKEY'                   TO PV-DB2-TABLE-NAME 17410000
174200                                                                  17420000
174300            STRING 'ERROR ON OPEN OF DKEYSUM-CURSOR - SQLCODE = ' 17430000
174400                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    17440000
174500            END-STRING                                            17450000
174600                                                                  17460000
174700            SET ABEND-4005-OPEN-ERROR TO TRUE                     17470000
174800            PERFORM Z9100-SQL-ABEND                               17480000
174900     END-EVALUATE.                                                17490000
175000                                                                  17500000
175100                                                                  17510000
175200***************************************************************** 17520000
175300* FETCH THE DKEYSUM-CURSOR                                        17530000
175400***************************************************************** 17540000
175500 K2000-FETCH-DKEYSUM-CURSOR.                                      17550000
175600                                                                  17560000
175700     EXEC SQL                                                     17570000
175800          FETCH DKEYSUM-CURSOR                                    17580000
175900           INTO :EPDKEY-STR-NBR                                   17590000
176000               ,:EPDKEY-SLS-DTE                                   17600000
176100               ,:EPPART-PARTN-NBR                                 17610000
176200     END-EXEC.                                                    17620000
176300                                                                  17630000
176400     EVALUATE TRUE                                                17640000
176500         WHEN SQLCODE = ZERO                                      17650000
176600             ADD 1               TO PV-DKEYSUM-CURSOR-CNT         17660000
176700             MOVE EPDKEY-STR-NBR TO PV-HOLD-DKEY-STR-NBR          17670000
176800                                                                  17680000
176900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          17690000
177000             SET PS-END-OF-DKEYSUM-CURSOR TO TRUE                 17700000
177100                                                                  17710000
177200         WHEN SQLWARN0 NOT EQUAL SPACE                            17720000
177300         WHEN SQLCODE NOT EQUAL ZERO                              17730000
177400            MOVE PV-DB2-PARTN-NBR     TO PV-ABEND-PARTN-NBR       17740000
177500            MOVE EPDKEY-STR-NBR       TO PV-ABEND-STR-NBR         17750000
177600                                                                  17760000
177700            MOVE SQLCODE TO PV-SQL                                17770000
177800                                                                  17780000
177900            MOVE 'K2000-FETCH-DKEYSUM-CURSOR' TO PV-PARAGRAPH-NAME17790000
178000            MOVE 'TEPDKEY'                    TO PV-DB2-TABLE-NAME17800000
178100                                                                  17810000
178200            STRING 'ERROR ON FETCH OF DKEYSUM-CURSOR - SQLCODE = '17820000
178300                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    17830000
178400            END-STRING                                            17840000
178500                                                                  17850000
178600            SET ABEND-4002-READ-ERROR TO TRUE                     17860000
178700                                                                  17870000
178800            PERFORM Z9100-SQL-ABEND                               17880000
178900     END-EVALUATE.                                                17890000
179000                                                                  17900000
179100                                                                  17910000
179200***************************************************************** 17920000
179300* FETCH THE DKEYSUM-CURSOR                                        17930000
179400* - SUM THE CHANGED ROWS IN TSASUM AND INSERT/UPDATE TSASUM       17940000
179500***************************************************************** 17950000
179600 K3000-PROCESS-DKEYSUM-CURSOR.                                    17960000
179700                                                                  17970000
179800     PERFORM K3100-OPEN-SUMCOR-CURSOR.                            17980000
179900     PERFORM K3200-FETCH-SUMCOR-CURSOR.                           17990000
180000     PERFORM K3300-PROCESS-SUMCOR-CURSOR                          18000000
180100       UNTIL PS-END-OF-SUMCOR-CURSOR.                             18010000
180200     PERFORM K3400-CLOSE-SUMCOR-CURSOR.                           18020000
180300                                                                  18030000
180400     MOVE 'N' TO PS-END-OF-SUMCOR-CURSOR-SW.                      18040000
180500                                                                  18050000
180600     PERFORM K2000-FETCH-DKEYSUM-CURSOR.                          18060000
180700                                                                  18070000
180800                                                                  18080000
180900***************************************************************** 18090000
181000* OPEN THE SUMCOR-CURSOR                                          18100000
181100***************************************************************** 18110000
181200 K3100-OPEN-SUMCOR-CURSOR.                                        18120000
181300                                                                  18130000
181400     EXEC SQL                                                     18140000
181500          OPEN SUMCOR-CURSOR                                      18150000
181600     END-EXEC.                                                    18160000
181700                                                                  18170000
181800     EVALUATE TRUE                                                18180000
181900         WHEN SQLCODE = ZERO                                      18190000
182000            CONTINUE                                              18200000
182100                                                                  18210000
182200         WHEN SQLWARN0 NOT EQUAL SPACE                            18220000
182300         WHEN SQLCODE NOT EQUAL ZERO                              18230000
182400            MOVE SQLCODE TO PV-SQL                                18240000
182500                                                                  18250000
182600            MOVE 'K3100-OPEN-SUMCOR-CURSOR' TO PV-PARAGRAPH-NAME  18260000
182700            MOVE 'TSASUM'                   TO PV-DB2-TABLE-NAME  18270000
182800                                                                  18280000
182900            STRING 'ERROR ON OPEN OF SUMCOR-CURSOR - SQLCODE = '  18290000
183000                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    18300000
183100            END-STRING                                            18310000
183200                                                                  18320000
183300            SET ABEND-4005-OPEN-ERROR TO TRUE                     18330000
183400            PERFORM Z9100-SQL-ABEND                               18340000
183500     END-EVALUATE.                                                18350000
183600                                                                  18360000
183700                                                                  18370000
183800***************************************************************** 18380000
183900* FETCH THE SUMCOR-CURSOR                                         18390000
184000***************************************************************** 18400000
184100 K3200-FETCH-SUMCOR-CURSOR.                                       18410000
184200                                                                  18420000
184300     EXEC SQL                                                     18430000
184400          FETCH SUMCOR-CURSOR                                     18440000
184500           INTO :PV-DB2-SUM                                       18450000
184600               ,:PV-DB2-COUNT                                     18460000
184700               ,:SASUM-PARTN-NBR                                  18470000
184800               ,:SASUM-STR-NBR                                    18480000
184900               ,:SASUM-SUM-CTG-CDE                                18490000
185000     END-EXEC.                                                    18500000
185100                                                                  18510000
185200     EVALUATE TRUE                                                18520000
185300         WHEN SQLCODE = ZERO                                      18530000
185400            ADD 1 TO PV-SUMCOR-CURSOR-CNT                         18540000
185500                                                                  18550000
185600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          18560000
185700            SET PS-END-OF-SUMCOR-CURSOR TO TRUE                   18570000
185800                                                                  18580000
185900         WHEN SQLWARN0 NOT EQUAL SPACE                            18590000
186000         WHEN SQLCODE NOT EQUAL ZERO                              18600000
186100            MOVE PV-DB2-PARTN-NBR     TO PV-ABEND-PARTN-NBR       18610000
186200            MOVE SASUM-STR-NBR        TO PV-ABEND-STR-NBR         18620000
186300            MOVE SASUM-SUM-CTG-CDE    TO PV-ABEND-SUM-CTG-CDE     18630000
186400                                                                  18640000
186500            MOVE SQLCODE TO PV-SQL                                18650000
186600                                                                  18660000
186700            MOVE 'K3200-FETCH-SUMCOR-CURSOR' TO PV-PARAGRAPH-NAME 18670000
186800            MOVE 'TSASUM'                    TO PV-DB2-TABLE-NAME 18680000
186900                                                                  18690000
187000            STRING 'ERROR ON FETCH OF SUMCOR-CURSOR - SQLCODE = ' 18700000
187100                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    18710000
187200            END-STRING                                            18720000
187300                                                                  18730000
187400            SET ABEND-4002-READ-ERROR TO TRUE                     18740000
187500                                                                  18750000
187600            PERFORM Z9100-SQL-ABEND                               18760000
187700     END-EVALUATE.                                                18770000
187800                                                                  18780000
187900                                                                  18790000
188000***************************************************************** 18800000
188100* FETCH THE SUMCOR-CURSOR                                         18810000
188200* - PROCESS AND INSERT SALES CORRECTIONS FOR REGISTER 00 ROWS     18820000
188300***************************************************************** 18830000
188400 K3300-PROCESS-SUMCOR-CURSOR.                                     18840000
188500                                                                  18850000
188600     MOVE 'K3300-PROCESS-SUMCOR-CURSOR' TO PV-PARA-NAME.          18860000
188700                                                                  18870000
188800     MOVE 00                  TO SASUM-RGST-ID.                   18880000
188900     MOVE 'S'                 TO SASUM-SUM-TYP-CDE.               18890000
189000     MOVE PV-DB2-SUM          TO SASUM-CTG-AMT.                   18900000
189100     MOVE PV-DB2-COUNT        TO SASUM-CTG-NBR-OF-ITM.            18910000
189200     MOVE 'S'                 TO SASUM-CTG-SRC-CDE.               18920000
189300                                                                  18930000
189400     SET PS-SUMCOR-UPDATE-YES TO TRUE.                            18940000
189500                                                                  18950000
189600     PERFORM W2000-CHECK-TSASUM.                                  18960000
189700                                                                  18970000
189800     MOVE ZEROS TO PV-DB2-SUM                                     18980000
189900                   PV-DB2-COUNT.                                  18990000
190000                                                                  19000000
190100     PERFORM K3200-FETCH-SUMCOR-CURSOR.                           19010000
190200                                                                  19020000
190300                                                                  19030000
190400***************************************************************** 19040000
190500* CLOSE THE SUMCOR-CURSOR                                         19050000
190600***************************************************************** 19060000
190700 K3400-CLOSE-SUMCOR-CURSOR.                                       19070000
190800                                                                  19080000
190900     EXEC SQL                                                     19090000
191000          CLOSE SUMCOR-CURSOR                                     19100000
191100     END-EXEC.                                                    19110000
191200                                                                  19120000
191300     EVALUATE TRUE                                                19130000
191400         WHEN SQLCODE = ZERO                                      19140000
191500            CONTINUE                                              19150000
191600                                                                  19160000
191700         WHEN SQLWARN0 NOT EQUAL SPACE                            19170000
191800         WHEN SQLCODE NOT EQUAL ZERO                              19180000
191900            MOVE SQLCODE TO PV-SQL                                19190000
192000                                                                  19200000
192100            MOVE 'K3400-CLOSE-SUMCOR-CURSOR' TO PV-PARAGRAPH-NAME 19210000
192200            MOVE 'TSASUM'                    TO PV-DB2-TABLE-NAME 19220000
192300                                                                  19230000
192400            STRING 'ERROR ON CLOSE OF SUMCOR-CURSOR - SQLCODE = ' 19240000
192500                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    19250000
192600            END-STRING                                            19260000
192700                                                                  19270000
192800            SET ABEND-4006-CLOSE-ERROR TO TRUE                    19280000
192900            PERFORM Z9100-SQL-ABEND                               19290000
193000     END-EVALUATE.                                                19300000
193100                                                                  19310000
193200                                                                  19320000
193300***************************************************************** 19330000
193400* CLOSE THE DKEYSUM-CURSOR                                        19340000
193500***************************************************************** 19350000
193600 K4000-CLOSE-DKEYSUM-CURSOR.                                      19360000
193700                                                                  19370000
193800     EXEC SQL                                                     19380000
193900          CLOSE DKEYSUM-CURSOR                                    19390000
194000     END-EXEC.                                                    19400000
194100                                                                  19410000
194200     EVALUATE TRUE                                                19420000
194300         WHEN SQLCODE = ZERO                                      19430000
194400            CONTINUE                                              19440000
194500                                                                  19450000
194600         WHEN SQLWARN0 NOT EQUAL SPACE                            19460000
194700         WHEN SQLCODE NOT EQUAL ZERO                              19470000
194800            MOVE SQLCODE TO PV-SQL                                19480000
194900                                                                  19490000
195000            MOVE 'D4000-CLOSE-DKEYSUM-CURSOR' TO PV-PARAGRAPH-NAME19500000
195100            MOVE 'TEPDKEY'                    TO PV-DB2-TABLE-NAME19510000
195200                                                                  19520000
195300            STRING 'ERROR ON CLOSE OF DKEYSUM-CURSOR - SQLCODE = '19530000
195400                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    19540000
195500            END-STRING                                            19550000
195600                                                                  19560000
195700            SET ABEND-4006-CLOSE-ERROR TO TRUE                    19570000
195800            PERFORM Z9100-SQL-ABEND                               19580000
195900     END-EVALUATE.                                                19590000
196000                                                                  19600000
196100                                                                  19610000
196200***************************************************************** 19620000
196300* OPEN THE MULTICOR-CURSOR                                        19630000
196400***************************************************************** 19640000
196500 L1000-OPEN-MULTICOR-CURSOR.                                      19650000
196600                                                                  19660000
196700     EXEC SQL                                                     19670000
196800          OPEN MULTICOR-CURSOR                                    19680000
196900     END-EXEC.                                                    19690000
197000                                                                  19700000
197100     EVALUATE TRUE                                                19710000
197200         WHEN SQLCODE = ZERO                                      19720000
197300            CONTINUE                                              19730000
197400                                                                  19740000
197500         WHEN SQLWARN0 NOT EQUAL SPACE                            19750000
197600         WHEN SQLCODE NOT EQUAL ZERO                              19760000
197700            MOVE SQLCODE TO PV-SQL                                19770000
197800                                                                  19780000
197900            MOVE 'L1000-OPEN-MLTCOR-CURSOR' TO PV-PARAGRAPH-NAME  19790000
198000            MOVE 'TEPDKEY'                  TO PV-DB2-TABLE-NAME  19800000
198100                                                                  19810000
198200            STRING 'ERROR ON OPEN OF MLTCOR-CURSOR - SQLCODE = '  19820000
198300                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    19830000
198400            END-STRING                                            19840000
198500                                                                  19850000
198600            SET ABEND-4005-OPEN-ERROR TO TRUE                     19860000
198700            PERFORM Z9100-SQL-ABEND                               19870000
198800     END-EVALUATE.                                                19880000
198900                                                                  19890000
199000                                                                  19900000
199100***************************************************************** 19910000
199200* FETCH THE MULTICOR-CURSOR                                       19920000
199300***************************************************************** 19930000
199400 L2000-FETCH-MULTICOR-CURSOR.                                     19940000
199500                                                                  19950000
199600     EXEC SQL                                                     19960000
199700          FETCH MULTICOR-CURSOR                                   19970000
199800           INTO :EPITM-NET-CHRGD-AMT                              19980000
199900              , :EPDKEY-STR-NBR                                   19990000
200000              , :EPITM-DEPT-NBR                                   20000000
200100              , :EPITM-SUB-CL-NBR                                 20010000
200200              , :EPTRN-TRN-TYP-CDE                                20020000
200300              , :EPTRN-OMNI-CHNL-FFLMT-TYP-CDE :PV-NULL-IND       20030000
200400               ,:EPPART-PARTN-NBR                                 20040000
200500     END-EXEC.                                                    20050000
200600                                                                  20060000
200700     EVALUATE TRUE                                                20070000
200800         WHEN SQLCODE = ZERO                                      20080000
200900            ADD 1 TO PV-MULTICOR-CURSOR-CNT                       20090000
201000            IF PV-NULL-IND = -1                                   20100000
201100                MOVE SPACES TO EPTRN-OMNI-CHNL-FFLMT-TYP-CDE      20110000
201200            END-IF                                                20120000
201300                                                                  20130000
201400         WHEN SQLCODE = PC-ROW-NOT-FOUND                          20140000
201500            SET PS-END-OF-MULTICOR-CURSOR TO TRUE                 20150000
201600                                                                  20160000
201700         WHEN SQLWARN0 NOT EQUAL SPACE                            20170000
201800         WHEN SQLCODE NOT EQUAL ZERO                              20180000
201900            MOVE PV-DB2-PARTN-NBR     TO PV-ABEND-PARTN-NBR       20190000
202000            MOVE EPDKEY-STR-NBR       TO PV-ABEND-STR-NBR         20200000
202100                                                                  20210000
202200            MOVE SQLCODE TO PV-SQL                                20220000
202300                                                                  20230000
202400            MOVE 'L2000-FETCH-MLTCOR-CURSOR' TO PV-PARAGRAPH-NAME 20240000
202500            MOVE 'TEPDKEY'                   TO PV-DB2-TABLE-NAME 20250000
202600                                                                  20260000
202700            STRING 'ERROR ON FETCH OF MLTCOR-CURSOR - SQLCODE = ' 20270000
202800                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    20280000
202900            END-STRING                                            20290000
203000                                                                  20300000
203100            SET ABEND-4002-READ-ERROR TO TRUE                     20310000
203200                                                                  20320000
203300            PERFORM Z9100-SQL-ABEND                               20330000
203400     END-EVALUATE.                                                20340000
203500                                                                  20350000
203600                                                                  20360000
203700***************************************************************** 20370000
203800* PROCESS THE MULTICOR-CURSOR                                     20380000
203900* - PROCESS AND INSERT SALES CORRECTIONS FOR REGISTER 00 ROWS     20390000
204000***************************************************************** 20400000
204100 L3000-PROCESS-MULTICOR-CURSOR.                                   20410000
204200     MOVE 'L3000-PROCESS-MULTICOR-CURSOR' TO PV-PARA-NAME.        20420000
204300                                                                  20430000
204400     IF EPDKEY-STR-NBR NOT EQUAL PV-PREV-STR-NBR                  20440000
204500         PERFORM L3100-WRITE-MULTICOR-PREV-STR                    20450000
204600         PERFORM L3200-ZERO-OUT-MULTICOR-COUNT                    20460000
204700         MOVE EPDKEY-STR-NBR   TO PV-PREV-STR-NBR                 20470000
204800         MOVE EPPART-PARTN-NBR TO PV-PREV-PARTN-NBR               20480000
204900     ELSE                                                         20490000
205000        IF EPPART-PARTN-NBR NOT EQUAL PV-PREV-PARTN-NBR           20500000
205100          PERFORM L3100-WRITE-MULTICOR-PREV-STR                   20510000
205200          PERFORM L3200-ZERO-OUT-MULTICOR-COUNT                   20520000
205300          MOVE EPPART-PARTN-NBR TO PV-PREV-PARTN-NBR              20530000
205400     END-IF.                                                      20540000
205500                                                                  20550000
205600**   BOS                                                          20560000
205700     IF (EPTRN-TRN-TYP-CDE = '01' OR                              20570000
205800         EPTRN-TRN-TYP-CDE = '02')                                20580000
205900     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BOS'                    20590000
206000         ADD +1                    TO  PV-BOSCOR-COUNT            20600000
206100                                       PV-BOSCOR-CURSOR-CNT       20610000
206200         ADD EPITM-NET-CHRGD-AMT   TO  PV-BOSCOR-DOLLARS-SUM      20620000
206300     END-IF.                                                      20630000
206400                                                                  20640000
206500**   BPR                                                          20650000
206600     IF (EPTRN-TRN-TYP-CDE = '11' OR                              20660000
206700         EPTRN-TRN-TYP-CDE = '12')                                20670000
206800     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BPS'                    20680000
206900         ADD +1                    TO  PV-BPRCOR-COUNT            20690000
207000                                       PV-BPRCOR-CURSOR-CNT       20700000
207100         ADD EPITM-NET-CHRGD-AMT   TO  PV-BPRCOR-DOLLARS-SUM      20710000
207200     END-IF.                                                      20720000
207300                                                                  20730000
207400**   BPS                                                          20740000
207500     IF (EPTRN-TRN-TYP-CDE = '01' OR                              20750000
207600         EPTRN-TRN-TYP-CDE = '02')                                20760000
207700     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BPS'                    20770000
207800         ADD +1                    TO  PV-BPSCOR-COUNT            20780000
207900                                       PV-BPSCOR-CURSOR-CNT       20790000
208000         ADD EPITM-NET-CHRGD-AMT   TO  PV-BPSCOR-DOLLARS-SUM      20800000
208100     END-IF.                                                      20810000
208200                                                                  20820000
208300**   BRC                                                          20830000
208400     IF EPITM-DEPT-NBR  = '836'                                   20840000
208500         ADD +1                    TO  PV-BRCCOR-COUNT            20850000
208600                                       PV-BRCCOR-CURSOR-CNT       20860000
208700         ADD EPITM-NET-CHRGD-AMT   TO  PV-BRCCOR-DOLLARS-SUM      20870000
208800     END-IF.                                                      20880000
208900                                                                  20890000
209000**   BSR                                                          20900000
209100     IF (EPTRN-TRN-TYP-CDE = '11' OR                              20910000
209200         EPTRN-TRN-TYP-CDE = '12')                                20920000
209300     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'BOS'                    20930000
209400         ADD +1                    TO  PV-BSRCOR-COUNT            20940000
209500                                       PV-BSRCOR-CURSOR-CNT       20950000
209600         ADD EPITM-NET-CHRGD-AMT   TO  PV-BSRCOR-DOLLARS-SUM      20960000
209700     END-IF.                                                      20970000
209800                                                                  20980000
209900**   DON                                                          20990000
210000     IF  EPITM-DEPT-NBR    = '817'                                21000000
210100     AND EPITM-SUB-CL-NBR  = '10'                                 21010000
210200         ADD +1                    TO  PV-DONCOR-COUNT            21020000
210300                                       PV-DONCOR-CURSOR-CNT       21030000
210400         ADD EPITM-NET-CHRGD-AMT   TO  PV-DONCOR-DOLLARS-SUM      21040000
210500     END-IF.                                                      21050000
210600                                                                  21060000
210700**   KKB                                                          21070000
210800     IF  EPITM-DEPT-NBR    = '830'                                21080000
210900     AND EPITM-SUB-CL-NBR  = '12'                                 21090000
211000         ADD +1                    TO  PV-KKBCOR-COUNT            21100000
211100                                       PV-KKBCOR-CURSOR-CNT       21110000
211200         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKBCOR-DOLLARS-SUM      21120000
211300     END-IF.                                                      21130000
211400                                                                  21140000
211500**   KKH                                                          21150000
211600     IF  EPITM-DEPT-NBR    = '830'                                21160000
211700     AND EPITM-SUB-CL-NBR  NOT = '11'                             21170000
211800     AND EPITM-SUB-CL-NBR  NOT = '12'                             21180000
211900     AND EPITM-SUB-CL-NBR  NOT = '14'                             21190000
212000         ADD +1                    TO  PV-KKHCOR-COUNT            21200000
212100                                       PV-KKHCOR-CURSOR-CNT       21210000
212200         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKHCOR-DOLLARS-SUM      21220000
212300     END-IF.                                                      21230000
212400                                                                  21240000
212500**   KKS                                                          21250000
212600     IF  EPITM-DEPT-NBR    = '830'                                21260000
212700     AND EPITM-SUB-CL-NBR  = '11'                                 21270000
212800         ADD +1                    TO  PV-KKSCOR-COUNT            21280000
212900                                       PV-KKSCOR-CURSOR-CNT       21290000
213000         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKSCOR-DOLLARS-SUM      21300000
213100     END-IF.                                                      21310000
213200                                                                  21320000
213300**   KKU                                                          21330000
213400     IF  EPITM-DEPT-NBR    = '830'                                21340000
213500     AND EPITM-SUB-CL-NBR  = '14'                                 21350000
213600         ADD +1                    TO  PV-KKUCOR-COUNT            21360000
213700                                       PV-KKUCOR-CURSOR-CNT       21370000
213800         ADD EPITM-NET-CHRGD-AMT   TO  PV-KKUCOR-DOLLARS-SUM      21380000
213900     END-IF.                                                      21390000
214000                                                                  21400000
214100**   MAN                                                          21410000
214200     IF  EPITM-DEPT-NBR    = '850'                                21420000
214300     AND EPITM-SUB-CL-NBR  = '90'                                 21430000
214400         ADD +1                    TO  PV-MANCOR-COUNT            21440000
214500                                       PV-MANCOR-CURSOR-CNT       21450000
214600         ADD EPITM-NET-CHRGD-AMT   TO  PV-MANCOR-DOLLARS-SUM      21460000
214700     END-IF.                                                      21470000
214800                                                                  21480000
214900**   PTG                                                          21490000
215000     IF  EPITM-DEPT-NBR    = '099'                                21500000
215100     AND EPITM-SUB-CL-NBR  = '80'                                 21510000
215200         ADD +1                    TO  PV-PTGCOR-COUNT            21520000
215300                                       PV-PTGCOR-CURSOR-CNT       21530000
215400         ADD EPITM-NET-CHRGD-AMT   TO  PV-PTGCOR-DOLLARS-SUM      21540000
215500     END-IF.                                                      21550000
215600                                                                  21560000
215700**   SFS                                                          21570000
215800     IF (EPTRN-TRN-TYP-CDE = '01' OR                              21580000
215900         EPTRN-TRN-TYP-CDE = '02')                                21590000
216000     AND EPTRN-OMNI-CHNL-FFLMT-TYP-CDE = 'SFS'                    21600000
216100         ADD +1                    TO  PV-SFSCOR-COUNT            21610000
216200                                       PV-SFSCOR-CURSOR-CNT       21620000
216300         ADD EPITM-NET-CHRGD-AMT   TO  PV-SFSCOR-DOLLARS-SUM      21630000
216400     END-IF.                                                      21640000
216500                                                                  21650000
216600**   SPN                                                          21660000
216700     IF  EPITM-DEPT-NBR    = '800'                                21670000
216800     AND EPITM-SUB-CL-NBR  = '11'                                 21680000
216900         ADD +1                    TO  PV-SPNCOR-COUNT            21690000
217000                                       PV-SPNCOR-CURSOR-CNT       21700000
217100         ADD EPITM-NET-CHRGD-AMT   TO  PV-SPNCOR-DOLLARS-SUM      21710000
217200     END-IF.                                                      21720000
217300                                                                  21730000
217400                                                                  21740000
217500     PERFORM L2000-FETCH-MULTICOR-CURSOR.                         21750000
217600                                                                  21760000
217700***************************************************************** 21770000
217800* WRITE THE MULTI-CURSOR CATEGORY ROWS                            21780000
217900* - SET VALUES IN FIELDS THAT DON'T CHANGE                        21790000
218000* - IF CATEGORY COUNT > 0, INSERT 00 REGISTER ROW FOR STORE       21800000
218100* - PV-DB2-SUM AND PV-DB2-COUNT ARE REQUIRED IN 'W' WRITE PARA'S. 21810000
218200***************************************************************** 21820000
218300 L3100-WRITE-MULTICOR-PREV-STR.                                   21830000
218400                                                                  21840000
218500***  MOVE  PV-PREV-STR-NBR TO PV-DISP-STORE                       21850000
218600***  DISPLAY 'PV-DISP-STORE '  PV-DISP-STORE                      21860000
218700                                                                  21870000
218800     MOVE PV-PREV-PARTN-NBR       TO SASUM-PARTN-NBR.             21880000
218900     MOVE PV-PREV-STR-NBR         TO SASUM-STR-NBR.               21890000
219000     MOVE 00                      TO SASUM-RGST-ID.               21900000
219100     MOVE 'S'                     TO SASUM-SUM-TYP-CDE.           21910000
219200     MOVE 'S'                     TO SASUM-CTG-SRC-CDE.           21920000
219300                                                                  21930000
219400     IF PV-BOSCOR-COUNT > 0                                       21940000
219500         MOVE 'BOS'               TO SASUM-SUM-CTG-CDE            21950000
219600         MOVE PV-BOSCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             21960000
219700                                     PV-DB2-SUM                   21970000
219800         MOVE PV-BOSCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      21980000
219900                                     PV-DB2-COUNT                 21990000
220000         SET PS-SALES-CORR-YES    TO TRUE                         22000000
220100         PERFORM W2000-CHECK-TSASUM                               22010000
220200     END-IF.                                                      22020000
220300                                                                  22030000
220400     IF PV-BPRCOR-COUNT > 0                                       22040000
220500         MOVE 'BPR'               TO SASUM-SUM-CTG-CDE            22050000
220600         MOVE 'S'                 TO SASUM-SUM-TYP-CDE            22060006
220700         MOVE PV-BPRCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22070000
220800                                     PV-DB2-SUM                   22080000
220900         MOVE PV-BPRCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22090000
221000                                     PV-DB2-COUNT                 22100000
221100         SET PS-SALES-CORR-YES    TO TRUE                         22110000
221200         PERFORM W2000-CHECK-TSASUM                               22120000
221300     END-IF.                                                      22130000
221400                                                                  22140000
221500     IF PV-BPSCOR-COUNT > 0                                       22150000
221600         MOVE 'BPS'               TO SASUM-SUM-CTG-CDE            22160000
221700         MOVE PV-BPSCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22170000
221800                                     PV-DB2-SUM                   22180000
221900         MOVE PV-BPSCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22190000
222000                                     PV-DB2-COUNT                 22200000
222100         SET PS-SALES-CORR-YES    TO TRUE                         22210000
222200         PERFORM W2000-CHECK-TSASUM                               22220000
222300     END-IF.                                                      22230000
222400                                                                  22240000
222500     IF PV-BRCCOR-COUNT > 0                                       22250000
222600         MOVE 'BRC'               TO SASUM-SUM-CTG-CDE            22260000
222700         MOVE PV-BRCCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22270000
222800                                     PV-DB2-SUM                   22280000
222900         MOVE PV-BRCCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22290000
223000                                     PV-DB2-COUNT                 22300000
223100         SET PS-SALES-CORR-YES    TO TRUE                         22310000
223200         PERFORM W2000-CHECK-TSASUM                               22320000
223300     END-IF.                                                      22330000
223400                                                                  22340000
223500     IF PV-BSRCOR-COUNT > 0                                       22350000
223600         MOVE 'BSR'               TO SASUM-SUM-CTG-CDE            22360000
223700         MOVE PV-BSRCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22370000
223800                                     PV-DB2-SUM                   22380000
223900         MOVE PV-BSRCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22390000
224000                                     PV-DB2-COUNT                 22400000
224100         SET PS-SALES-CORR-YES    TO TRUE                         22410000
224200         PERFORM W2000-CHECK-TSASUM                               22420000
224300     END-IF.                                                      22430000
224400                                                                  22440000
224500     IF PV-DONCOR-COUNT > 0                                       22450000
224600         MOVE 'DON'               TO SASUM-SUM-CTG-CDE            22460000
224700         MOVE PV-DONCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22470000
224800                                     PV-DB2-SUM                   22480000
224900         MOVE PV-DONCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22490000
225000                                     PV-DB2-COUNT                 22500000
225100         SET PS-SALES-CORR-YES    TO TRUE                         22510000
225200         PERFORM W2000-CHECK-TSASUM                               22520000
225300     END-IF.                                                      22530000
225400                                                                  22540000
225500     IF PV-KKBCOR-COUNT > 0                                       22550000
225600         MOVE 'KKB'               TO SASUM-SUM-CTG-CDE            22560000
225700         MOVE PV-KKBCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22570000
225800                                     PV-DB2-SUM                   22580000
225900         MOVE PV-KKBCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22590000
226000                                     PV-DB2-COUNT                 22600000
226100         SET PS-SALES-CORR-YES    TO TRUE                         22610000
226200         PERFORM W2000-CHECK-TSASUM                               22620000
226300     END-IF.                                                      22630000
226400                                                                  22640000
226500     IF PV-KKHCOR-COUNT > 0                                       22650000
226600         MOVE 'KKH'               TO SASUM-SUM-CTG-CDE            22660000
226700         MOVE PV-KKHCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22670000
226800                                     PV-DB2-SUM                   22680000
226900         MOVE PV-KKHCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22690000
227000                                     PV-DB2-COUNT                 22700000
227100         SET PS-SALES-CORR-YES    TO TRUE                         22710000
227200         PERFORM W2000-CHECK-TSASUM                               22720000
227300     END-IF.                                                      22730000
227400                                                                  22740000
227500     IF PV-KKSCOR-COUNT > 0                                       22750000
227600         MOVE 'KKS'               TO SASUM-SUM-CTG-CDE            22760000
227700         MOVE PV-KKSCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22770000
227800                                     PV-DB2-SUM                   22780000
227900         MOVE PV-KKSCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22790000
228000                                     PV-DB2-COUNT                 22800000
228100         SET PS-SALES-CORR-YES    TO TRUE                         22810000
228200         PERFORM W2000-CHECK-TSASUM                               22820000
228300     END-IF.                                                      22830000
228400                                                                  22840000
228500     IF PV-KKUCOR-COUNT > 0                                       22850000
228600         MOVE 'KKU'               TO SASUM-SUM-CTG-CDE            22860000
228700         MOVE PV-KKU-DOLLARS-SUM  TO SASUM-CTG-AMT                22870000
228800                                     PV-DB2-SUM                   22880000
228900         MOVE PV-KKUCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22890000
229000                                     PV-DB2-COUNT                 22900000
229100         SET PS-SALES-CORR-YES    TO TRUE                         22910000
229200         PERFORM W2000-CHECK-TSASUM                               22920000
229300     END-IF.                                                      22930000
229400                                                                  22940000
229500     IF PV-MANCOR-COUNT > 0                                       22950000
229600         MOVE 'MAN'               TO SASUM-SUM-CTG-CDE            22960000
229700         MOVE PV-MANCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             22970000
229800                                     PV-DB2-SUM                   22980000
229900         MOVE PV-MANCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      22990000
230000                                     PV-DB2-COUNT                 23000000
230100         SET PS-SALES-CORR-YES    TO TRUE                         23010000
230200         PERFORM W2000-CHECK-TSASUM                               23020000
230300     END-IF.                                                      23030000
230400                                                                  23040000
230500     IF PV-PTGCOR-COUNT > 0                                       23050000
230600         MOVE 'PTG'               TO SASUM-SUM-CTG-CDE            23060000
230700         MOVE PV-PTGCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             23070000
230800                                     PV-DB2-SUM                   23080000
230900         MOVE PV-PTGCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      23090000
231000                                     PV-DB2-COUNT                 23100000
231100         SET PS-SALES-CORR-YES    TO TRUE                         23110000
231200         PERFORM W2000-CHECK-TSASUM                               23120000
231300     END-IF.                                                      23130000
231400                                                                  23140000
231500     IF PV-SFSCOR-COUNT > 0                                       23150000
231600         MOVE 'SFS'               TO SASUM-SUM-CTG-CDE            23160000
231700         MOVE PV-SFSCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             23170000
231800                                     PV-DB2-SUM                   23180000
231900         MOVE PV-SFSCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      23190000
232000                                     PV-DB2-COUNT                 23200000
232100         SET PS-SALES-CORR-YES    TO TRUE                         23210000
232200         PERFORM W2000-CHECK-TSASUM                               23220000
232300     END-IF.                                                      23230000
232400                                                                  23240000
232500     IF PV-SPNCOR-COUNT > 0                                       23250000
232600         MOVE 'SPN'               TO SASUM-SUM-CTG-CDE            23260000
232700         MOVE PV-SPNCOR-DOLLARS-SUM  TO SASUM-CTG-AMT             23270000
232800                                     PV-DB2-SUM                   23280000
232900         MOVE PV-SPNCOR-COUNT        TO SASUM-CTG-NBR-OF-ITM      23290000
233000                                     PV-DB2-COUNT                 23300000
233100         SET PS-SALES-CORR-YES    TO TRUE                         23310000
233200         PERFORM W2000-CHECK-TSASUM                               23320000
233300     END-IF.                                                      23330000
233400                                                                  23340000
233500                                                                  23350000
233600***************************************************************** 23360000
233700* ON A CHANGE IN STORE NUMBER RE-INITIALIZE THE CATEGORY COUNTS   23370000
233800***************************************************************** 23380000
233900 L3200-ZERO-OUT-MULTICOR-COUNT.                                   23390000
234000                                                                  23400000
234100     MOVE ZEROES TO  PV-BOSCOR-COUNT                              23410000
234200                     PV-BOSCOR-DOLLARS-SUM                        23420000
234300                     PV-BPRCOR-COUNT                              23430000
234400                     PV-BPRCOR-DOLLARS-SUM                        23440000
234500                     PV-BPSCOR-COUNT                              23450000
234600                     PV-BPSCOR-DOLLARS-SUM                        23460000
234700                     PV-BRCCOR-COUNT                              23470000
234800                     PV-BRCCOR-DOLLARS-SUM                        23480000
234900                     PV-BSRCOR-COUNT                              23490000
235000                     PV-BSRCOR-DOLLARS-SUM                        23500000
235100                     PV-DONCOR-COUNT                              23510000
235200                     PV-DONCOR-DOLLARS-SUM                        23520000
235300                     PV-KKBCOR-COUNT                              23530000
235400                     PV-KKBCOR-DOLLARS-SUM                        23540000
235500                     PV-KKHCOR-COUNT                              23550000
235600                     PV-KKHCOR-DOLLARS-SUM                        23560000
235700                     PV-KKSCOR-COUNT                              23570000
235800                     PV-KKSCOR-DOLLARS-SUM                        23580000
235900                     PV-KKUCOR-COUNT                              23590000
236000                     PV-KKUCOR-DOLLARS-SUM                        23600000
236100                     PV-MANCOR-COUNT                              23610000
236200                     PV-MANCOR-DOLLARS-SUM                        23620000
236300                     PV-PTGCOR-COUNT                              23630000
236400                     PV-PTGCOR-DOLLARS-SUM                        23640000
236500                     PV-SFSCOR-COUNT                              23650000
236600                     PV-SFSCOR-DOLLARS-SUM                        23660000
236700                     PV-SPNCOR-COUNT                              23670000
236800                     PV-SPNCOR-DOLLARS-SUM.                       23680000
236900                                                                  23690000
237000***************************************************************** 23700000
237100* CLOSE THE MULTICOR-CURSOR                                       23710000
237200***************************************************************** 23720000
237300 L4000-CLOSE-MULTICOR-CURSOR.                                     23730000
237400                                                                  23740000
237500     EXEC SQL                                                     23750000
237600          CLOSE MULTICOR-CURSOR                                   23760000
237700     END-EXEC.                                                    23770000
237800                                                                  23780000
237900     EVALUATE TRUE                                                23790000
238000         WHEN SQLCODE = ZERO                                      23800000
238100            CONTINUE                                              23810000
238200                                                                  23820000
238300         WHEN SQLWARN0 NOT EQUAL SPACE                            23830000
238400         WHEN SQLCODE NOT EQUAL ZERO                              23840000
238500            MOVE SQLCODE TO PV-SQL                                23850000
238600                                                                  23860000
238700            MOVE 'L4000-CLOSE-MLTCOR-CURSOR' TO PV-PARAGRAPH-NAME 23870000
238800            MOVE 'TEPDKEY'                   TO PV-DB2-TABLE-NAME 23880000
238900                                                                  23890000
239000            STRING 'ERROR ON CLOSE OF MLTCOR-CURSOR - SQLCODE = ' 23900000
239100                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    23910000
239200            END-STRING                                            23920000
239300                                                                  23930000
239400            SET ABEND-4006-CLOSE-ERROR TO TRUE                    23940000
239500            PERFORM Z9100-SQL-ABEND                               23950000
239600     END-EVALUATE.                                                23960000
239700***************************************************************** 23970000
239800* OPEN THE KKTCOR-CURSOR                                          23980000
239900***************************************************************** 23990000
240000 O1000-OPEN-KKTCOR-CURSOR.                                        24000000
240100                                                                  24010000
240200     EXEC SQL                                                     24020000
240300          OPEN KKTCOR-CURSOR                                      24030000
240400     END-EXEC.                                                    24040000
240500                                                                  24050000
240600     EVALUATE TRUE                                                24060000
240700         WHEN SQLCODE = ZERO                                      24070000
240800            CONTINUE                                              24080000
240900                                                                  24090000
241000         WHEN SQLWARN0 NOT EQUAL SPACE                            24100000
241100         WHEN SQLCODE NOT EQUAL ZERO                              24110000
241200            MOVE SQLCODE TO PV-SQL                                24120000
241300                                                                  24130000
241400            MOVE 'O1000-OPEN-KKTCOR-CURSOR' TO PV-PARAGRAPH-NAME  24140000
241500            MOVE 'TEPDKEY'                  TO PV-DB2-TABLE-NAME  24150000
241600                                                                  24160000
241700            STRING 'ERROR ON OPEN OF KKTCOR-CURSOR - SQLCODE = '  24170000
241800                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    24180000
241900            END-STRING                                            24190000
242000                                                                  24200000
242100            SET ABEND-4005-OPEN-ERROR TO TRUE                     24210000
242200            PERFORM Z9100-SQL-ABEND                               24220000
242300     END-EVALUATE.                                                24230000
242400                                                                  24240000
242500                                                                  24250000
242600***************************************************************** 24260000
242700* FETCH THE KKTCOR-CURSOR                                         24270000
242800***************************************************************** 24280000
242900 O2000-FETCH-KKTCOR-CURSOR.                                       24290000
243000                                                                  24300000
243100     EXEC SQL                                                     24310000
243200          FETCH KKTCOR-CURSOR                                     24320000
243300           INTO :EPDKEY-STR-NBR                                   24330000
243400               ,:EPTND-TNDR-ID                                    24340000
243500               ,:EPTND-TNDR-AMT                                   24350000
243600               ,:EPTND-TNDR-ID-LEN-NBR                            24360000
243700               ,:EPPART-PARTN-NBR                                 24370000
243800     END-EXEC.                                                    24380000
243900                                                                  24390000
244000     EVALUATE TRUE                                                24400000
244100         WHEN SQLCODE = ZERO                                      24410000
244200             ADD 1 TO PV-KKTCOR-CURSOR-CNT                        24420000
244300             MOVE EPDKEY-STR-NBR          TO PV-STR-NBR           24430000
244400             PERFORM O5000-DETOKENIZE-CARD-NUMBER                 24440013
244500                                                                  24450000
244600             IF (EPTND-TNDR-ID-LEN-NBR = 12                       24460000
244700                 OR EPTND-TNDR-ID-LEN-NBR = 13)                   24470000
244800                 MOVE PV-ZEROES           TO PV-TNDR-ID-ZEROES    24480000
244900                 MOVE EPTND-TNDR-ID(3:10) TO PV-TNDR-ID           24490000
245000             ELSE                                                 24500000
245100                IF EPTND-TNDR-ID-LEN-NBR = 16                     24510000
245200                    MOVE EPTND-TNDR-ID(5:12) TO PV-TNDR-ID-ALL    24520000
245300                ELSE                                              24530000
245400                   IF EPTND-TNDR-ID-LEN-NBR = 19                  24540000
245500                       MOVE EPTND-TNDR-ID(8:12) TO PV-TNDR-ID-ALL 24550000
245600                   ELSE                                           24560000
245700                      IF EPTND-TNDR-ID-LEN-NBR = 30               24570000
245800                          MOVE EPTND-TNDR-ID(19:12)               24580000
245900                                                TO PV-TNDR-ID-ALL 24590000
246000                      END-IF                                      24600000
246100                   END-IF                                         24610000
246200                END-IF                                            24620000
246300             END-IF                                               24630000
246400                                                                  24640000
246500             MOVE PV-TNDR-ID-NBR TO PV-TNDR-ID-NBR-DEC            24650000
246600                                                                  24660000
246700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          24670000
246800             SET PS-END-OF-KKTCOR-CURSOR TO TRUE                  24680000
246900                                                                  24690000
247000             IF  EPTND-STR-NBR  NOT = ZEROES                      24700000
247100                 IF  PV-DB2-SUM NOT = ZEROES                      24710000
247200                     PERFORM O3100-PROCESS                        24720000
247300                 END-IF                                           24730000
247400             END-IF                                               24740000
247500                                                                  24750000
247600         WHEN SQLWARN0 NOT EQUAL SPACE                            24760000
247700         WHEN SQLCODE NOT EQUAL ZERO                              24770000
247800            MOVE PV-DB2-PARTN-NBR     TO PV-ABEND-PARTN-NBR       24780000
247900            MOVE EPDKEY-STR-NBR       TO PV-ABEND-STR-NBR         24790000
248000                                                                  24800000
248100            MOVE SQLCODE TO PV-SQL                                24810000
248200                                                                  24820000
248300            MOVE 'O2000-FETCH-KKTCOR-CURSOR' TO PV-PARAGRAPH-NAME 24830000
248400            MOVE 'TEPDKEY'                   TO PV-DB2-TABLE-NAME 24840000
248500                                                                  24850000
248600            STRING 'ERROR ON FETCH OF KKTCOR-CURSOR - SQLCODE = ' 24860000
248700                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    24870000
248800            END-STRING                                            24880000
248900                                                                  24890000
249000            SET ABEND-4002-READ-ERROR TO TRUE                     24900000
249100                                                                  24910000
249200            PERFORM Z9100-SQL-ABEND                               24920000
249300     END-EVALUATE.                                                24930000
249400                                                                  24940000
249500                                                                  24950000
249600***************************************************************** 24960000
249700* FETCH THE KKTCOR-CURSOR                                         24970000
249800* - PERFORM A ROUTINE THAT WILL DETERMINE IF THE GIFT CARD        24980000
249900*   FROM THE KKT-CURSOR IS A KCK GIFT CARD                        24990000
250000* - PROCESS AND INSERT SALES CORRECTIONS FOR REGISTER 00 ROWS     25000000
250100***************************************************************** 25010000
250200 O3000-PROCESS-KKTCOR-CURSOR.                                     25020000
250300                                                                  25030000
250400     IF  PS-FIRST-TIME-THRU-KKTCOR                                25040000
250500         MOVE EPDKEY-STR-NBR      TO PV-HOLD-STR-NBR              25050000
250600         MOVE EPPART-PARTN-NBR    TO PV-HOLD-PARTN-NBR            25060000
250700         MOVE ZEROES              TO PV-DB2-SUM                   25070000
250800                                     PV-DB2-COUNT                 25080000
250900                                                                  25090000
251000         SET PS-NOT-FIRST-TIME-THRU-KKTCOR TO TRUE                25100000
251100     END-IF.                                                      25110000
251200                                                                  25120000
251300**  IF THE KCK CARD IS NOT FOUND IN THE STORED VALUE SYSTEM, DO   25130000
251400**  NOT INCLUDE THE CARD IN THE KKT SALES CORRECTION TOTALS IN    25140000
251500**  TSASUM.                                                       25150000
251600                                                                  25160000
251700     IF  EPDKEY-STR-NBR NOT = ZEROES                              25170000
251800         IF  (EPDKEY-STR-NBR   NOT = PV-HOLD-STR-NBR)             25180000
251900         OR  (EPPART-PARTN-NBR NOT = PV-HOLD-PARTN-NBR)           25190000
252000                                                                  25200000
252100             IF PV-DB2-SUM NOT = ZEROES                           25210000
252200                 PERFORM O3100-PROCESS                            25220000
252300             ELSE                                                 25230000
252400                 MOVE EPDKEY-STR-NBR    TO PV-HOLD-STR-NBR        25240000
252500                 MOVE EPPART-PARTN-NBR  TO PV-HOLD-PARTN-NBR      25250000
252600                                                                  25260000
252700             END-IF                                               25270000
252800         END-IF                                                   25280000
252900     END-IF.                                                      25290000
253000                                                                  25300000
253100                                                                  25310000
253200     PERFORM V1000-CHECK-FOR-KCK-CARD.                            25320000
253300                                                                  25330000
253400     MOVE ZERO  TO PV-TNDR-ID-NBR-DEC.                            25340000
253500     MOVE SPACE TO PV-TNDR-ID-ALL.                                25350000
253600                                                                  25360000
253700     PERFORM O2000-FETCH-KKTCOR-CURSOR.                           25370000
253800                                                                  25380000
253900                                                                  25390000
254000***************************************************************** 25400000
254100* PROCESS THE KKTCOR-CURSOR                                       25410000
254200***************************************************************** 25420000
254300 O3100-PROCESS.                                                   25430000
254400                                                                  25440000
254500     MOVE PV-HOLD-PARTN-NBR TO SASUM-PARTN-NBR.                   25450000
254600     MOVE PV-HOLD-STR-NBR   TO SASUM-STR-NBR.                     25460000
254700     MOVE 00                TO SASUM-RGST-ID.                     25470000
254800     MOVE 'S'               TO SASUM-SUM-TYP-CDE.                 25480000
254900     MOVE 'KKT'             TO SASUM-SUM-CTG-CDE.                 25490000
255000     MOVE PV-DB2-SUM        TO SASUM-CTG-AMT.                     25500000
255100     MOVE PV-DB2-COUNT      TO SASUM-CTG-NBR-OF-ITM.              25510000
255200     MOVE 'S'               TO SASUM-CTG-SRC-CDE.                 25520000
255300                                                                  25530000
255400     SET PS-SALES-CORR-YES  TO TRUE.                              25540000
255500                                                                  25550000
255600     DISPLAY 'KKT CORRECTION INSERT FOR: '.                       25560000
255700     DISPLAY 'PARTN - ' SASUM-PARTN-NBR.                          25570000
255800     DISPLAY 'STORE - ' SASUM-STR-NBR.                            25580000
255900     DISPLAY 'AMT   - ' SASUM-CTG-AMT.                            25590000
256000     DISPLAY 'COUNT - ' SASUM-CTG-NBR-OF-ITM.                     25600000
256100                                                                  25610000
256200     MOVE 'O3000-PROCESS-KKTCOR-CURSOR'                           25620000
256300                            TO PV-PARA-NAME.                      25630000
256400                                                                  25640000
256500     PERFORM W2000-CHECK-TSASUM.                                  25650000
256600                                                                  25660000
256700     MOVE EPDKEY-STR-NBR    TO PV-HOLD-STR-NBR.                   25670000
256800     MOVE EPPART-PARTN-NBR  TO PV-HOLD-PARTN-NBR.                 25680000
256900                                                                  25690000
257000     MOVE ZEROES            TO PV-DB2-SUM                         25700000
257100                               PV-DB2-COUNT.                      25710000
257200                                                                  25720000
257300                                                                  25730000
257400***************************************************************** 25740000
257500* CLOSE THE KKTCOR-CURSOR                                         25750000
257600***************************************************************** 25760000
257700 O4000-CLOSE-KKTCOR-CURSOR.                                       25770000
257800                                                                  25780000
257900     EXEC SQL                                                     25790000
258000          CLOSE KKTCOR-CURSOR                                     25800000
258100     END-EXEC.                                                    25810000
258200                                                                  25820000
258300     EVALUATE TRUE                                                25830000
258400         WHEN SQLCODE = ZERO                                      25840000
258500            CONTINUE                                              25850000
258600         WHEN SQLWARN0 NOT EQUAL SPACE                            25860000
258700         WHEN SQLCODE NOT EQUAL ZERO                              25870000
258800            MOVE SQLCODE TO PV-SQL                                25880000
258900                                                                  25890000
259000            MOVE 'O4000-CLOSE-KKTCOR-CURSOR' TO PV-PARAGRAPH-NAME 25900000
259100            MOVE 'TEPDKEY'                   TO PV-DB2-TABLE-NAME 25910000
259200                                                                  25920000
259300            STRING 'ERROR ON CLOSE OF KKTCOR-CURSOR - SQLCODE = ' 25930000
259400                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    25940000
259500            END-STRING                                            25950000
259600                                                                  25960000
259700            SET ABEND-4006-CLOSE-ERROR TO TRUE                    25970000
259800            PERFORM Z9100-SQL-ABEND                               25980000
259900     END-EVALUATE.                                                25990000
260000                                                                  26000000
260100***************************************************************** 26010000
260200* O5000-DETOKENIZE-CARD-NUMBER                                    26020000
260300***************************************************************** 26030000
260400 O5000-DETOKENIZE-CARD-NUMBER.                                    26040000
260500                                                                  26050000
260600     INITIALIZE CSI-PARAMETERS                                    26060000
260700                DP031-PROTEG-PGM-PARAMETERS.                      26070000
260800                                                                  26080000
260900     MOVE 'TNDR_ID'                 TO DP031-FIELD.               26090000
261000     SET CSI-DECRYPT-FUNCTION       TO TRUE.                      26100000
261100     SET DP031-ACCTNBR              TO TRUE.                      26110000
261200     MOVE EPTND-TNDR-ID             TO DP031-CIPHER-TEXT.         26120000
261300     MOVE EPTND-TNDR-ID-LEN-NBR     TO DP031-INPUT-LEN.           26130000
261400     PERFORM DP031-0000-PROTG-TOKEN-DETOKEN.                      26140000
261500     IF CSI-RETURN-CODE NOT = ZERO                                26150000
261600        DISPLAY 'ABEND IN THE FOLLOWING RECORD'                   26160000
261700        DISPLAY 'PARTITION NUMBER : ' PV-DB2-PARTN-NBR            26170000
261800        DISPLAY 'STORE NUMBER     : ' PV-STR-NBR                  26180000
261900        DISPLAY 'TOKENIZED TNDR ID: ' EPTND-TNDR-ID               26190000
262000        DISPLAY 'TENDER ID LENGTH : ' EPTND-TNDR-ID-LEN-NBR       26200000
262100        PERFORM DP031-9999-ABEND                                  26210000
262200     ELSE                                                         26220000
262300        MOVE DP031-CLEAR-TEXT       TO EPTND-TNDR-ID              26230000
262400     END-IF.                                                      26240000
274300                                                                  27430000
274400***************************************************************** 27440000
274500* - ACCESS THE OPERATIONAL STORED VALUE SYSTEM TABLES TO          27450000
274600*   DETERMINE IF THE GIFT CARD IS A KCK CARD                      27460000
274700* - IF THE KCK CARD DOES NOT EXIST, DO NOT INCLUDE IT IN          27470000
274800*   THE TSASUM TOTALS.  PROCESS THE NEXT CARD.                    27480000
274900***************************************************************** 27490000
275000 V1000-CHECK-FOR-KCK-CARD.                                        27500000
275100                                                                  27510000
275200     EXEC SQL                                                     27520000
275300          SELECT '1'                                              27530000
275400            INTO :PV-DUMMY                                        27540000
275500            FROM  SVT_CRD_PROD  NTL                               27550000
275600                 ,SVT_KOHLS_CRD_ACCT  TBL                         27560000
275700           WHERE  TBL.CRD_NBR         = :PV-TNDR-ID-NBR-DEC       27570000
275800            AND   TBL.CRD_TYP_CDE     = 2                         27580000
275900            AND   NTL.CRD_TYP_CDE     = TBL.CRD_TYP_CDE           27590000
276000            AND   TBL.CRD_PROD_YR     = NTL.CRD_PROD_YR           27600000
276100            AND   TBL.SHIPT_REQ_NBR   = NTL.SHIPT_REQ_NBR         27610000
276200            AND   NTL.CRD_STK_TYP_ID  = 'KCK     '                27620000
276300         WITH UR                                                  27630000
276400     END-EXEC.                                                    27640000
276500                                                                  27650000
276600     EVALUATE TRUE                                                27660000
276700         WHEN SQLCODE = ZERO                                      27670000
276800            ADD +1                TO PV-DB2-COUNT                 27680000
276900            ADD EPTND-TNDR-AMT    TO PV-DB2-SUM                   27690000
277000                                                                  27700000
277100            SET PS-KCK-CARD-FOUND TO TRUE                         27710000
277200                                                                  27720000
277300**  WHEN THE SQLCODE RETURNED IS +100, DO NOT INCLUDE THE         27730000
277400**  TRANSACTION IN THE TSASUM TABLES.  CONTINUE ON TO THE         27740000
277500**  NEXT CARD.                                                    27750000
277600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          27760000
277700            SET PS-KCK-CARD-NOT-FOUND TO TRUE                     27770000
277800                                                                  27780000
277900         WHEN SQLWARN0 NOT EQUAL SPACE                            27790000
278000         WHEN SQLCODE NOT EQUAL ZERO                              27800000
278100            MOVE SQLCODE TO PV-SQL                                27810000
278200                                                                  27820000
278300            MOVE 'V1000-CHECK-FOR-KCK-CARD' TO PV-PARAGRAPH-NAME  27830000
278400            MOVE 'SVT_CRD_PROD'             TO PV-DB2-TABLE-NAME  27840000
278500                                                                  27850000
278600            STRING 'ERROR ON SELECT OF KCK CARD - SQLCODE = '     27860000
278700                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    27870000
278800            END-STRING                                            27880000
278900                                                                  27890000
279000            SET ABEND-4013-DB2-ERROR TO TRUE                      27900000
279100            PERFORM Z9100-SQL-ABEND                               27910000
279200     END-EVALUATE.                                                27920000
279300                                                                  27930000
279400                                                                  27940000
279500                                                                  27950000
279600***************************************************************** 27960000
279700* CHECK THE EXISTANCE OF THE TSASUM RECORDS                       27970000
279800***************************************************************** 27980000
279900 W1000-CHECK-TSASUM.                                              27990000
280000                                                                  28000000
280100                                                                  28010000
280200     EXEC SQL                                                     28020000
280300       SELECT CTG_AMT                                             28030000
280400             ,CTG_NBR_OF_ITM                                      28040000
280500                                                                  28050000
280600         INTO  :SASUM-CTG-AMT                                     28060000
280700              ,:SASUM-CTG-NBR-OF-ITM                              28070000
280800                                                                  28080000
280900         FROM  TSASUM                                             28090000
281000                                                                  28100000
281100        WHERE PARTN_NBR      = :SASUM-PARTN-NBR                   28110000
281200          AND STR_NBR        = :SASUM-STR-NBR                     28120000
281300          AND RGST_ID        = :SASUM-RGST-ID                     28130000
281400          AND SUM_TYP_CDE    = :SASUM-SUM-TYP-CDE                 28140000
281500          AND SUM_CTG_CDE    = :SASUM-SUM-CTG-CDE                 28150000
281600          AND CTG_SRC_CDE    = :SASUM-CTG-SRC-CDE                 28160000
281700                                                                  28170000
281800       WITH UR                                                    28180000
281900     END-EXEC.                                                    28190000
282000                                                                  28200000
282100     EVALUATE TRUE                                                28210000
282200         WHEN SQLCODE = ZERO                                      28220000
282300             PERFORM W2300-WRITE-TSASUM-UPDATE02                  28230000
282400                                                                  28240000
282500         WHEN SQLCODE = PC-ROW-NOT-FOUND                          28250000
282600             IF  PS-UPDATE-ROW-YES                                28260000
282700                 PERFORM W2000-CHECK-TSASUM                       28270000
282800                 SET PS-UPDATE-ROW-NO TO TRUE                     28280000
282900             END-IF                                               28290000
283000                                                                  28300000
283100         WHEN OTHER                                               28310000
283200             DISPLAY '            '                               28320000
283300             DISPLAY 'PARTN-NBR = ' SASUM-PARTN-NBR               28330000
283400             DISPLAY 'STR-NBR   = ' SASUM-STR-NBR                 28340000
283500             DISPLAY 'RGST-ID   = ' SASUM-RGST-ID                 28350000
283600             DISPLAY 'SUM-TYP   = ' SASUM-SUM-TYP-CDE             28360000
283700             DISPLAY 'SUM-CTG   = ' SASUM-SUM-CTG-CDE             28370000
283800             DISPLAY 'CTG-SRC   = ' SASUM-CTG-SRC-CDE             28380000
283900                                                                  28390000
284000             MOVE SQLCODE TO PV-SQL                               28400000
284100                                                                  28410000
284200             MOVE 'W1000-CHECK-TSASUM' TO PV-PARAGRAPH-NAME       28420000
284300             MOVE 'TSASUM'             TO PV-DB2-TABLE-NAME       28430000
284400                                                                  28440000
284500             STRING 'ERROR ON SELECT OF TSASUM - SQLCODE = '      28450000
284600                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    28460000
284700             END-STRING                                           28470000
284800                                                                  28480000
284900             SET ABEND-4013-DB2-ERROR TO TRUE                     28490000
285000             PERFORM Z9100-SQL-ABEND                              28500000
285100                                                                  28510000
285200     END-EVALUATE.                                                28520000
285300                                                                  28530000
285400                                                                  28540000
285500***************************************************************** 28550000
285600* CHECK THE EXISTANCE OF THE TSASUM RECORDS                       28560000
285700***************************************************************** 28570000
285800 W2000-CHECK-TSASUM.                                              28580000
285900                                                                  28590000
286000     MOVE ZEROES TO PV-SASUM-CTG-AMT                              28600000
286100                    PV-SASUM-CTG-NBR-OF-ITM.                      28610000
286200                                                                  28620000
286300     EXEC SQL                                                     28630000
286400       SELECT PARTN_NBR                                           28640000
286500             ,STR_NBR                                             28650000
286600             ,CTG_AMT                                             28660000
286700             ,CTG_NBR_OF_ITM                                      28670000
286800                                                                  28680000
286900         INTO  :SASUM-PARTN-NBR                                   28690000
287000              ,:SASUM-STR-NBR                                     28700000
287100              ,:PV-SASUM-CTG-AMT                                  28710000
287200              ,:PV-SASUM-CTG-NBR-OF-ITM                           28720000
287300                                                                  28730000
287400         FROM  TSASUM                                             28740000
287500                                                                  28750000
287600        WHERE PARTN_NBR      = :SASUM-PARTN-NBR                   28760000
287700          AND STR_NBR        = :SASUM-STR-NBR                     28770000
287800          AND RGST_ID        = :SASUM-RGST-ID                     28780000
287900          AND SUM_TYP_CDE    = :SASUM-SUM-TYP-CDE                 28790000
288000          AND SUM_CTG_CDE    = :SASUM-SUM-CTG-CDE                 28800000
288100          AND CTG_AMT        = :SASUM-CTG-AMT                     28810000
288200          AND CTG_NBR_OF_ITM = :SASUM-CTG-NBR-OF-ITM              28820000
288300          AND CTG_SRC_CDE    = :SASUM-CTG-SRC-CDE                 28830000
288400                                                                  28840000
288500       WITH UR                                                    28850000
288600     END-EXEC.                                                    28860000
288700                                                                  28870000
288800     EVALUATE TRUE                                                28880000
288900         WHEN SQLCODE = PC-ROW-NOT-FOUND                          28890000
289000             PERFORM W2100-WRITE-TSASUM-INSERT                    28900000
289100                                                                  28910000
289200         WHEN SQLCODE = ZERO                                      28920000
289300             IF PS-SUMCOR-UPDATE-YES                              28930000
289400**               SUM CORRECTIONS WILL SET NEW VALUES              28940000
289500                      PERFORM W2200-WRITE-TSASUM-UPDATE01         28950000
289600                      SET PS-SUMCOR-UPDATE-NO TO TRUE             28960000
289700             ELSE                                                 28970000
289800               IF PS-SALES-CORR-YES                               28980000
289900**                 SALES CORRECTIONS WILL ADD TO EXISTING VALUES  28990000
290000                   PERFORM W2300-WRITE-TSASUM-UPDATE02            29000000
290100                  SET PS-SALES-CORR-NO TO TRUE                    29010000
290200                                                                  29020000
290300               ELSE                                               29030000
290400                 IF PS-SUM-INSERT-YES                             29040000
290500**                   SUM CURSOR WILL SET NEW VALUES - THIS IS THE 29050000
290600**                   FIX TO CORRECT THE PROBLEM OF A REGISTER     29060000
290700**                   INCORRECTLY PASSING A REGISTER ID OF ZERO.   29070000
290800                     PERFORM W2400-WRITE-TSASUM-UPDATE03          29080000
290900                     SET PS-SUM-INSERT-NO TO TRUE                 29090000
291000                 END-IF                                           29100000
291100               END-IF                                             29110000
291200             END-IF                                               29120000
291300                                                                  29130000
291400         WHEN OTHER                                               29140000
291500             DISPLAY '            '                               29150000
291600             DISPLAY 'PARTN-NBR = ' SASUM-PARTN-NBR               29160000
291700             DISPLAY 'STR-NBR   = ' SASUM-STR-NBR                 29170000
291800             DISPLAY 'RGST-ID   = ' SASUM-RGST-ID                 29180000
291900             DISPLAY 'SUM-TYP   = ' SASUM-SUM-TYP-CDE             29190000
292000             DISPLAY 'SUM-CTG   = ' SASUM-SUM-CTG-CDE             29200000
292100             DISPLAY 'CTG-SRC   = ' SASUM-CTG-SRC-CDE             29210000
292200                                                                  29220000
292300             MOVE SQLCODE TO PV-SQL                               29230000
292400                                                                  29240000
292500             MOVE 'W2000-CHECK-TSASUM' TO PV-PARAGRAPH-NAME       29250000
292600             MOVE 'TSASUM'             TO PV-DB2-TABLE-NAME       29260000
292700                                                                  29270000
292800             STRING 'ERROR ON SELECT OF TSASUM - SQLCODE = '      29280000
292900                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    29290000
293000             END-STRING                                           29300000
293100                                                                  29310000
293200             SET ABEND-4013-DB2-ERROR TO TRUE                     29320000
293300             PERFORM Z9100-SQL-ABEND                              29330000
293400                                                                  29340000
293500     END-EVALUATE.                                                29350000
293600                                                                  29360000
293700                                                                  29370000
293800***************************************************************** 29380000
293900* WRITE THE TSASUM INSERT RECORDS                                 29390000
294000***************************************************************** 29400000
294100 W2100-WRITE-TSASUM-INSERT.                                       29410000
294200                                                                  29420000
294300     MOVE SASUM-PARTN-NBR      TO SA008-PARTN-NBR.                29430000
294400     MOVE SASUM-STR-NBR        TO SA008-STR-NBR.                  29440000
294500     MOVE SASUM-RGST-ID        TO SA008-RGST-ID.                  29450000
294600     MOVE SASUM-SUM-TYP-CDE    TO SA008-SUM-TYP-CDE.              29460000
294700     MOVE SASUM-SUM-CTG-CDE    TO SA008-SUM-CTG-CDE.              29470000
294800     MOVE SASUM-CTG-AMT        TO SA008-CTG-AMT.                  29480000
294900     MOVE SASUM-CTG-NBR-OF-ITM TO SA008-CTG-NBR-OF-ITM.           29490000
295000     MOVE SASUM-CTG-SRC-CDE    TO SA008-CTG-SRC-CDE.              29500000
295100                                                                  29510000
295200     MOVE 'INSRT'              TO SA008-TYPE.                     29520000
295300                                                                  29530000
295400     WRITE TSASUM-REC FROM SA008-TSASUM-REC.                      29540000
295500                                                                  29550000
295600     ADD 1 TO PA-TSASUM-WRITTEN                                   29560000
295700              PA-TSASUM-INSRT.                                    29570000
295800                                                                  29580000
295900     ADD SASUM-CTG-AMT        TO WS-INSRT-CTG-AMT.                29590000
296000     ADD SASUM-CTG-NBR-OF-ITM TO WS-INSRT-CTG-NBR.                29600000
296100                                                                  29610000
296200                                                                  29620000
296300***************************************************************** 29630000
296400* WRITE THE TSASUM UPDATE RECORDS (SUM CORRECTIONS)               29640000
296500***************************************************************** 29650000
296600 W2200-WRITE-TSASUM-UPDATE01.                                     29660000
296700                                                                  29670000
296800     MOVE SASUM-PARTN-NBR      TO SA008-PARTN-NBR.                29680000
296900     MOVE SASUM-STR-NBR        TO SA008-STR-NBR.                  29690000
297000     MOVE SASUM-RGST-ID        TO SA008-RGST-ID.                  29700000
297100     MOVE SASUM-SUM-TYP-CDE    TO SA008-SUM-TYP-CDE.              29710000
297200     MOVE SASUM-SUM-CTG-CDE    TO SA008-SUM-CTG-CDE.              29720000
297300     MOVE SASUM-CTG-SRC-CDE    TO SA008-CTG-SRC-CDE.              29730000
297400                                                                  29740000
297500     MOVE PV-DB2-SUM           TO SA008-CTG-AMT.                  29750000
297600     MOVE PV-DB2-COUNT         TO SA008-CTG-NBR-OF-ITM.           29760000
297700                                                                  29770000
297800     MOVE 'UPDT1'              TO SA008-TYPE.                     29780000
297900                                                                  29790000
298000     WRITE TSASUM-REC FROM SA008-TSASUM-REC.                      29800000
298100                                                                  29810000
298200     ADD 1 TO PA-TSASUM-WRITTEN                                   29820000
298300              PA-TSASUM-UPDT1.                                    29830000
298400                                                                  29840000
298500     ADD SASUM-CTG-AMT        TO WS-UPDT1-CTG-AMT.                29850000
298600     ADD SASUM-CTG-NBR-OF-ITM TO WS-UPDT1-CTG-NBR.                29860000
298700                                                                  29870000
298800                                                                  29880000
298900***************************************************************** 29890000
299000* WRITE THE TSASUM UPDATE RECORDS (SALE CORRECTIONS)              29900000
299100***************************************************************** 29910000
299200 W2300-WRITE-TSASUM-UPDATE02.                                     29920000
299300                                                                  29930000
299400     MOVE SASUM-PARTN-NBR      TO SA008-PARTN-NBR.                29940000
299500     MOVE SASUM-STR-NBR        TO SA008-STR-NBR.                  29950000
299600     MOVE SASUM-RGST-ID        TO SA008-RGST-ID.                  29960000
299700     MOVE SASUM-SUM-TYP-CDE    TO SA008-SUM-TYP-CDE.              29970000
299800     MOVE SASUM-SUM-CTG-CDE    TO SA008-SUM-CTG-CDE.              29980000
299900     MOVE SASUM-CTG-SRC-CDE    TO SA008-CTG-SRC-CDE.              29990000
300000                                                                  30000000
300100*    MOVE SASUM-CTG-AMT        TO SA008-CTG-AMT.                  30010000
300200*    MOVE SASUM-CTG-NBR-OF-ITM TO SA008-CTG-NBR-OF-ITM.           30020000
300300*    SA008-CTG-AMT AND SA008-CTG-NBR-OF-ITM ARE NOT SET BEFORE    30030000
300400*    THIS PARA -  ABOVE 2 LINES WOULD BE NEEDED.                  30040000
300500*    SASUM AMTS SET INITIALLY IN SOURCE FETCHES WITH PV-DB2       30050000
300600*    VALUES AND IN PARA 1000- WITH EXISTING TSASUM VALUES?        30060000
300700*    DIFFERENT VALUES DEPENDING ON THE PATH TAKEN TO GET TO       30070000
300800*    THIS PARA!                                                   30080000
300900*    SAKUP002 JUST REPLACES THE TSASUM NUMBERS WITH THOSE         30090000
301000*    PASSED BY SAKUT060.  UPDT1 AND UPDT2 USE THE SAME UPDATE     30100000
301100*    SQL.                                                         30110000
301200*    UPDT2 AND UPDT3 COUNTS ARE EMPTY ON ALL RUNS CHECKED,        30120000
301300*    EXCEPT FOR RERUNS WHICH CAUSE MAJOR PROBLEMS WITH VERY       30130000
301400*    LARGE COUNTS!                                                30140000
301500                                                                  30150000
301600*    COMPUTE SA008-CTG-AMT                                        30160000
301700*                    = SA008-CTG-AMT + PV-DB2-SUM.                30170000
301800*    COMPUTE SA008-CTG-NBR-OF-ITM                                 30180000
301900*                    = SA008-CTG-NBR-OF-ITM + PV-DB2-COUNT.       30190000
302000*    REPLACED ABOVE 4 LINES WITH LINES BELOW TO GET INCREMENT     30200000
302100*    LIKE UPDT1 AND UPDT3.                                        30210000
302200     MOVE PV-DB2-SUM           TO SA008-CTG-AMT.                  30220000
302300     MOVE PV-DB2-COUNT         TO SA008-CTG-NBR-OF-ITM.           30230000
302400                                                                  30240000
302500     MOVE 'UPDT2'              TO SA008-TYPE.                     30250000
302600                                                                  30260000
302700     WRITE TSASUM-REC FROM SA008-TSASUM-REC.                      30270000
302800                                                                  30280000
302900     ADD 1 TO PA-TSASUM-WRITTEN                                   30290000
303000              PA-TSASUM-UPDT2.                                    30300000
303100                                                                  30310000
303200*    ADD SASUM-CTG-AMT        TO WS-UPDT2-CTG-AMT.                30320000
303300*    ADD SASUM-CTG-NBR-OF-ITM TO WS-UPDT2-CTG-NBR.                30330000
303400*    REPLACED ABOVE 2 LINES WITH LINES BELOW TO GET INCREMENT     30340000
303500*    TO MATCH WHAT UPDT1 AND UPDT3 DO.                            30350000
303600     ADD  PV-DB2-SUM              TO PV-DB2-SUM-UPDT2-TOT.        30360000
303700     MOVE PV-DB2-SUM-UPDT2-TOT    TO WS-UPDT2-CTG-AMT.            30370000
303800     ADD  PV-DB2-COUNT            TO PV-DB2-COUNT-UPDT2-TOT       30380000
303900     MOVE PV-DB2-COUNT-UPDT2-TOT  TO WS-UPDT2-CTG-NBR.            30390000
304000                                                                  30400000
304100***************************************************************** 30410000
304200* WRITE THE TSASUM UPDATE RECORDS (SUM INSERT)                    30420000
304300***************************************************************** 30430000
304400 W2400-WRITE-TSASUM-UPDATE03.                                     30440000
304500                                                                  30450000
304600     MOVE SASUM-PARTN-NBR      TO SA008-PARTN-NBR.                30460000
304700     MOVE SASUM-STR-NBR        TO SA008-STR-NBR.                  30470000
304800     MOVE SASUM-RGST-ID        TO SA008-RGST-ID.                  30480000
304900     MOVE SASUM-SUM-TYP-CDE    TO SA008-SUM-TYP-CDE.              30490000
305000     MOVE SASUM-SUM-CTG-CDE    TO SA008-SUM-CTG-CDE.              30500000
305100                                                                  30510000
305200     MOVE PV-DB2-SUM           TO SA008-CTG-AMT.                  30520000
305300     MOVE PV-DB2-COUNT         TO SA008-CTG-NBR-OF-ITM.           30530000
305400                                                                  30540000
305500     MOVE 'UPDT3'              TO SA008-TYPE.                     30550000
305600                                                                  30560000
305700     WRITE TSASUM-REC FROM SA008-TSASUM-REC.                      30570000
305800                                                                  30580000
305900     ADD 1 TO PA-TSASUM-WRITTEN                                   30590000
306000              PA-TSASUM-UPDT3.                                    30600000
306100                                                                  30610000
306200     ADD SASUM-CTG-AMT        TO WS-UPDT3-CTG-AMT.                30620000
306300     ADD SASUM-CTG-NBR-OF-ITM TO WS-UPDT3-CTG-NBR.                30630000
306400                                                                  30640000
306500                                                                  30650000
306600***************************************************************** 30660000
306700* ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    30670000
306800***************************************************************** 30680000
306900 Z9100-SQL-ABEND.                                                 30690000
307000                                                                  30700000
307100     MOVE SQLCODE    TO SQLCODE2.                                 30710000
307200     MOVE SQLERRD(3) TO SQLERRD3.                                 30720000
307300                                                                  30730000
307400     DISPLAY '** ABEND           ** = SQLABEND'.                  30740000
307500     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  30750000
307600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        30760000
307700     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.        30770000
307800     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION.         30780000
307900     DISPLAY '** PARTN NBR       ** = ' PV-ABEND-PARTN-NBR.       30790000
308000     DISPLAY '** STORE NBR       ** = ' PV-ABEND-STR-NBR.         30800000
308100     DISPLAY '** CTG CODE        ** = ' PV-ABEND-SUM-CTG-CDE.     30810000
308200     DISPLAY '** SQLCODE         ** = ' SQLCODE2.                 30820000
308300     DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3.                 30830000
308400     DISPLAY '** SQLERRM         ** = ' SQLERRM.                  30840000
308500     DISPLAY '** SQLERRMC        ** = ' SQLERRMC.                 30850000
308600                                                                  30860000
308700***************************************************************** 30870000
308800*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDDDD DIVISION STATE-   30880000
308900*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        30890000
309000* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     30900000
309100*  FORMAT.                                                        30910000
309200***************************************************************** 30920000
309300     COPY DPPD004.                                                30930000
309400                                                                  30940000
309500     CALL 'ILBOABN0' USING ABEND-CODE.                            30950000
309600                                                                  30960000
309700                                                                  30970000
309800******************************************************************30980000
309900*  ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                     30990000
310000******************************************************************31000000
310100 Z9200-ABEND.                                                     31010000
310200                                                                  31020000
310300     PERFORM Z9900-END-PROC.                                      31030000
310400                                                                  31040000
310500     DISPLAY '** ABEND           **'.                             31050000
310600     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  31060000
310700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        31070000
310800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       31080000
310900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       31090000
311000                                                                  31100000
311100     CALL 'ILBOABN0' USING ABEND-CODE.                            31110000
311200                                                                  31120000
311300                                                                  31130000
311400******************************************************************31140000
311500* PREFORMS TASK TERMINATION PROCESSING                            31150000
311600******************************************************************31160000
311700 Z9900-END-PROC.                                                  31170000
311800                                                                  31180000
311900     CLOSE TSASUM-FILE.                                           31190000
312000                                                                  31200000
312100     PERFORM Z9999-CONTROLS.                                      31210000
312200                                                                  31220000
312300                                                                  31230000
312400******************************************************************31240000
312500* DISPLAY CONTROLS FROM THE PROGRAM                               31250000
312600******************************************************************31260000
312700 Z9999-CONTROLS.                                                  31270000
312800                                                                  31280000
312900     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 31290000
313000                                                                  31300000
313100     MOVE SYS-TIME (1:2) TO ST-END-HR.                            31310000
313200     MOVE SYS-TIME (3:2) TO ST-END-MN.                            31320000
313300                                                                  31330000
313400     DISPLAY '                    '.                              31340000
313500     DISPLAY '**********************'.                            31350000
313600     DISPLAY '   SAKUT060 CONTROLS  '.                            31360000
313700     DISPLAY '**********************'.                            31370000
313800     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         31380000
313900     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          31390000
314000     DISPLAY 'END TIME  = ' ST-END-TIME.                          31400000
314100     DISPLAY '======================'.                            31410000
314200     DISPLAY 'CURSOR COUNTS:'.                                    31420000
314300     MOVE PV-SUM-CURSOR-CNT        TO PV-EDIT-MASK.               31430000
314400     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31440000
314500     DISPLAY 'SUM FETCHED........' PV-EDIT-MASK.                  31450000
314600                                                                  31460000
314700     MOVE PV-MULTI-CURSOR-CNT      TO PV-EDIT-MASK.               31470000
314800     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31480000
314900     DISPLAY 'MULTI FETCHED......' PV-EDIT-MASK.                  31490000
315000                                                                  31500000
315100     MOVE PV-KKB-CURSOR-CNT        TO PV-EDIT-MASK.               31510000
315200     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31520000
315300     DISPLAY 'KKB FETCHED........' PV-EDIT-MASK.                  31530000
315400                                                                  31540000
315500     MOVE PV-DON-CURSOR-CNT        TO PV-EDIT-MASK.               31550000
315600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31560000
315700     DISPLAY 'DON FETCHED........' PV-EDIT-MASK.                  31570000
315800                                                                  31580000
315900     MOVE PV-BRC-CURSOR-CNT        TO PV-EDIT-MASK.               31590000
316000     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31600000
316100     DISPLAY 'BRC FETCHED........' PV-EDIT-MASK.                  31610000
316200                                                                  31620000
316300     MOVE PV-KKH-CURSOR-CNT        TO PV-EDIT-MASK.               31630000
316400     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31640000
316500     DISPLAY 'KKH FETCHED........' PV-EDIT-MASK.                  31650000
316600                                                                  31660000
316700     MOVE PV-KKU-CURSOR-CNT        TO PV-EDIT-MASK.               31670000
316800     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31680000
316900     DISPLAY 'KKU FETCHED........' PV-EDIT-MASK.                  31690000
317000                                                                  31700000
317100     MOVE PV-KKS-CURSOR-CNT        TO PV-EDIT-MASK.               31710000
317200     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31720000
317300     DISPLAY 'KKS FETCHED........' PV-EDIT-MASK.                  31730000
317400                                                                  31740000
317500     MOVE PV-KKT-CURSOR-CNT        TO PV-EDIT-MASK.               31750000
317600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31760000
317700     DISPLAY 'KKT FETCHED........' PV-EDIT-MASK.                  31770000
317800                                                                  31780000
317900     MOVE PV-MAN-CURSOR-CNT        TO PV-EDIT-MASK.               31790000
318000     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31800000
318100     DISPLAY 'MAN FETCHED........' PV-EDIT-MASK.                  31810000
318200                                                                  31820000
318300     MOVE PV-PTG-CURSOR-CNT        TO PV-EDIT-MASK.               31830000
318400     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31840000
318500     DISPLAY 'PTG FETCHED........' PV-EDIT-MASK.                  31850000
318600                                                                  31860000
318700     MOVE PV-SPN-CURSOR-CNT        TO PV-EDIT-MASK.               31870000
318800     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31880000
318900     DISPLAY 'SPN FETCHED........' PV-EDIT-MASK.                  31890000
319000                                                                  31900000
319100     MOVE PV-SFS-CURSOR-CNT        TO PV-EDIT-MASK.               31910000
319200     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31920000
319300     DISPLAY 'SFS FETCHED........' PV-EDIT-MASK.                  31930000
319400                                                                  31940000
319500     MOVE PV-BPS-CURSOR-CNT        TO PV-EDIT-MASK.               31950000
319600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         31960000
319700     DISPLAY 'BPS FETCHED........' PV-EDIT-MASK.                  31970000
319800                                                                  31980000
319900     MOVE PV-BPR-CURSOR-CNT        TO PV-EDIT-MASK.               31990000
320000     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32000000
320100     DISPLAY 'BPR FETCHED........' PV-EDIT-MASK.                  32010000
320200                                                                  32020000
320300     MOVE PV-BOS-CURSOR-CNT        TO PV-EDIT-MASK.               32030000
320400     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32040000
320500     DISPLAY 'BOS FETCHED........' PV-EDIT-MASK.                  32050000
320600                                                                  32060000
320700     MOVE PV-BSR-CURSOR-CNT        TO PV-EDIT-MASK.               32070000
320800     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32080000
320900     DISPLAY 'BSR FETCHED........' PV-EDIT-MASK.                  32090000
321000                                                                  32100000
321100     DISPLAY '                                   '.               32110000
321200     MOVE PV-SUMCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32120000
321300     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32130000
321400     DISPLAY 'SUMCOR FETCHED.....' PV-EDIT-MASK.                  32140000
321500                                                                  32150000
321600     MOVE PV-MULTICOR-CURSOR-CNT   TO PV-EDIT-MASK.               32160000
321700     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32170000
321800     DISPLAY 'MULTICOR FETCHED...' PV-EDIT-MASK.                  32180000
321900                                                                  32190000
322000     MOVE PV-KKBCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32200000
322100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32210000
322200     DISPLAY 'KKBCOR FETCHED.....' PV-EDIT-MASK.                  32220000
322300                                                                  32230000
322400     MOVE PV-DONCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32240000
322500     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32250000
322600     DISPLAY 'DONCOR FETCHED.....' PV-EDIT-MASK.                  32260000
322700                                                                  32270000
322800     MOVE PV-BRCCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32280000
322900     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32290000
323000     DISPLAY 'BRCCOR FETCHED.....' PV-EDIT-MASK.                  32300000
323100                                                                  32310000
323200     MOVE PV-KKHCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32320000
323300     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32330000
323400     DISPLAY 'KKHCOR FETCHED.....' PV-EDIT-MASK.                  32340000
323500                                                                  32350000
323600     MOVE PV-KKUCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32360000
323700     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32370000
323800     DISPLAY 'KKUCOR FETCHED.....' PV-EDIT-MASK.                  32380000
323900                                                                  32390000
324000     MOVE PV-KKSCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32400000
324100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32410000
324200     DISPLAY 'KKSCOR FETCHED.....' PV-EDIT-MASK.                  32420000
324300                                                                  32430000
324400     MOVE PV-KKTCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32440000
324500     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32450000
324600     DISPLAY 'KKTCOR FETCHED.....' PV-EDIT-MASK.                  32460000
324700                                                                  32470000
324800     MOVE PV-MANCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32480000
324900     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32490000
325000     DISPLAY 'MANCOR FETCHED.....' PV-EDIT-MASK.                  32500000
325100                                                                  32510000
325200     MOVE PV-PTGCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32520000
325300     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32530000
325400     DISPLAY 'PTGCOR FETCHED.....' PV-EDIT-MASK.                  32540000
325500                                                                  32550000
325600     MOVE PV-SFSCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32560000
325700     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32570000
325800     DISPLAY 'SFSCOR FETCHED.....' PV-EDIT-MASK.                  32580000
325900                                                                  32590000
326000     MOVE PV-BPSCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32600000
326100     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32610000
326200     DISPLAY 'BPSCOR FETCHED.....' PV-EDIT-MASK.                  32620000
326300                                                                  32630000
326400     MOVE PV-BOSCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32640000
326500     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32650000
326600     DISPLAY 'BOSCOR FETCHED.....' PV-EDIT-MASK.                  32660000
326700                                                                  32670000
326800     MOVE PV-BPRCOR-CURSOR-CNT        TO PV-EDIT-MASK.            32680000
326900     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32690000
327000     DISPLAY 'BPRCOR FETCHED........' PV-EDIT-MASK.               32700000
327100                                                                  32710000
327200     MOVE PV-BSRCOR-CURSOR-CNT        TO PV-EDIT-MASK.            32720000
327300     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32730000
327400     DISPLAY 'BSRCOR FETCHED........' PV-EDIT-MASK.               32740000
327500                                                                  32750000
327600     MOVE PV-SPNCOR-CURSOR-CNT     TO PV-EDIT-MASK.               32760000
327700     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         32770000
327800     DISPLAY 'SPNCOR FETCHED.....' PV-EDIT-MASK.                  32780000
327900                                                                  32790000
328400     DISPLAY '                                        '.          32840000
328500     MOVE WS-INSRT-CTG-AMT         TO PV-EDIT-MASK2.              32850000
328600     INSPECT PV-EDIT-MASK2 REPLACING LEADING SPACE BY '.'.        32860000
328700     DISPLAY 'INSRT CTG AMT..................'                    32870000
328800         PV-EDIT-MASK2.                                           32880000
328900     MOVE WS-UPDT1-CTG-AMT         TO PV-EDIT-MASK2.              32890000
329000     INSPECT PV-EDIT-MASK2 REPLACING LEADING SPACE BY '.'.        32900000
329100     DISPLAY 'UPDT1 CTG AMT..................'                    32910000
329200         PV-EDIT-MASK2.                                           32920000
329300     MOVE WS-UPDT2-CTG-AMT         TO PV-EDIT-MASK2.              32930000
329400     INSPECT PV-EDIT-MASK2 REPLACING LEADING SPACE BY '.'.        32940000
329500     DISPLAY 'UPDT2 CTG AMT..................'                    32950000
329600         PV-EDIT-MASK2.                                           32960000
329700     MOVE WS-UPDT3-CTG-AMT         TO PV-EDIT-MASK2.              32970000
329800     INSPECT PV-EDIT-MASK2 REPLACING LEADING SPACE BY '.'.        32980000
329900     DISPLAY 'UPDT3 CTG AMT..................'                    32990000
330000         PV-EDIT-MASK2.                                           33000000
330100                                                                  33010000
330200     DISPLAY '                                        '.          33020000
330300     MOVE WS-INSRT-CTG-NBR         TO PV-EDIT-MASK.               33030000
330400     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33040000
330500     DISPLAY 'INSRT CTG NBR..................'                    33050000
330600         PV-EDIT-MASK.                                            33060000
330700     MOVE WS-UPDT1-CTG-NBR         TO PV-EDIT-MASK.               33070000
330800     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33080000
330900     DISPLAY 'UPDT1 CTG NBR..................'                    33090000
331000         PV-EDIT-MASK.                                            33100000
331100     MOVE WS-UPDT2-CTG-NBR         TO PV-EDIT-MASK.               33110000
331200     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33120000
331300     DISPLAY 'UPDT2 CTG NBR..................'                    33130000
331400         PV-EDIT-MASK.                                            33140000
331500     MOVE WS-UPDT3-CTG-NBR         TO PV-EDIT-MASK.               33150000
331600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33160000
331700     DISPLAY 'UPDT3 CTG NBR..................'                    33170000
331800         PV-EDIT-MASK.                                            33180000
331900                                                                  33190000
332000     DISPLAY '                                   '.               33200000
332100     MOVE PA-TSASUM-WRITTEN        TO PV-EDIT-MASK.               33210000
332200     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33220000
332300     DISPLAY 'TOTAL TSASUM RECS WRITTEN......' PV-EDIT-MASK.      33230000
332400                                                                  33240000
332500     MOVE PA-TSASUM-INSRT          TO PV-EDIT-MASK.               33250000
332600     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33260000
332700     DISPLAY '        NBR OF INSRT RECS......' PV-EDIT-MASK.      33270000
332800                                                                  33280000
332900     MOVE PA-TSASUM-UPDT1          TO PV-EDIT-MASK.               33290000
333000     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33300000
333100     DISPLAY '        NBR OF UPDT1 RECS......' PV-EDIT-MASK.      33310000
333200                                                                  33320000
333300     MOVE PA-TSASUM-UPDT2          TO PV-EDIT-MASK.               33330000
333400     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33340000
333500     DISPLAY '        NBR OF UPDT2 RECS......' PV-EDIT-MASK.      33350000
333600                                                                  33360000
333700     MOVE PA-TSASUM-UPDT3          TO PV-EDIT-MASK.               33370000
333800     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'.         33380000
333900     DISPLAY '        NBR OF UPDT3 RECS......' PV-EDIT-MASK.      33390000
334000                                                                  33400000
334100                                                                  33410000
334200******************************************************************33420000
334300*   COPY MEMBER DPPD031 CONTAINS STATEMENTS NEEDED TO INVOKE      33430000
334400*   PROTEGRITY MODULE FOR PROTECTION / UNPROTECTION               33440000
334500******************************************************************33450000
334600     COPY DPPD031.                                                33460000
334700*                                                                 33470000
