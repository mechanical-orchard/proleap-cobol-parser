000100 IDENTIFICATION DIVISION.                                         00010004
000200 PROGRAM-ID.             TRKUT150.                                00020004
000300 AUTHOR.                 COGNIZANT.                               00030004
000400 INSTALLATION.           KOHLS.                                   00040004
000500 DATE-WRITTEN            02/2020.                                 00050004
000600 DATE-COMPILED.                                                   00060004
000700                                                                  00070004
000800******************************************************************00080004
000900*  PURPOSE:                                                      *00090004
001000*  EXTRACT NEW AND UPDATED CONTAINER INFORMATION TO SEND TO      *00100004
001100*  TRANSINTERNATIONAL                                            *00110004
001200*                                                                *00120004
001300*  CONTROL CARD IS READ WHICH CONTAINS THE BEGIN TIMESTAMP.      *00130004
001400*  END TIMESTAMP RELATIVE TO THE BEGIN TIMESTAMP IS CALCULATED.  *00140004
001410*  THE RANGE OF TIMESTAMPS IS USED IN THE CURSOR FOR SELECTING   *00141004
001420*  THE APPROPRIATE CONTAINER INFO.                               *00142004
001430*                                                                *00143004
001440*  SELECTED CONTAINER DATA IS FORMATTED AND WRITTEN TO THE       *00144004
001450*  EXTRACT FILE.                                                 *00145004
001460*                                                                *00146004
001470*  NEW CONTROL CARD IS WRITTEN CONTAINING THE CALCULATED END     *00147004
001480*  TIMESTAMP.  THIS WILL BECOME THE BEGIN TIMESTAMP IN THE NEXT  *00148004
001490*  RUN.                                                          *00149004
001500******************************************************************00150004
001510* INPUT:                                                         *00151004
001520* 1. BEGIN TIMESTAMP CONTROL CARD                                *00152004
001530*                                                                *00153004
001540* OUTPUT:                                                        *00154004
001550* 1. CONTAINER EXTRACT FOR TRANSINTERNATIONAL  COPYBOOK TRRD200  *00155004
001560* 2. UPDATED TIMESTAMP CONTROL CARD                              *00156004
001570*                                                                *00157004
001580* DB2 TABLES:                                                    *00158004
001590* 1. TIMCNPO - PO TRACKING CONTAINER PO TABLE                    *00159004
001591* 2. TIMCNTK - CONTAINER TRACKING TABLE                          *00159104
001592*----------------------------------------------------------------*00159204
001593* CHANGE LOG:                                                    *00159304
001594*                                                                *00159404
001595* DATE  09/09/2020                                               *00159504
001596* CHANGE MADE:  INITIAL VERSION. TR RATES MGMT/EDI310 RETIREMENT *00159604
001597*               PROJECT.                                         *00159704
001598* MADE BY: COGNIZANT/NANCY EILBES      WR/IR #: CHG0248672       *00159806
001599*                                                                *00159904
001600* DATE  09/24/2020                                               *00160009
001601*     CHANGE MADE: MODIFIED THE CONTAINER_CSR TO EXCLUDE THOSE   *00160109
001602*     CONTAINERS WHERE THE CARRIER SCAC IS BLANK. IT WAS FOUND   *00160209
001603*     TI WAS UNABLE TO PROCESS THESE AND DON'T NEED THEM ON THE  *00160309
001604*     EXTRACT AS THEY ARE TYPICALLY FOR LD TYPE POS WHERE THEY   *00160409
001605*     WILL NOT SEE AN INVOICE FROM AN OCEAN OR AIR CARRIER.      *00160509
001606*     MADE BY: NANCY EILBES            WR/IR #: CHG0249223       *00160609
001607*                                                                *00160708
001608* DATE  10/05/2020                                               *00160811
001609*     CHANGE MADE: ADDED LOGIC IN B300 TO WRITE A NO DATA        *00160911
001610*     MESSAGE TO THE CONTAINER FILE WHEN THERE ARE NO NEW OR     *00161011
001611*     UPDATED CONTAINERS TO SEND.  THIS WILL PREVENT AN ERROR    *00161111
001612*     IN BIZLINK THAT WOULD OCCUR IF THE FILE WAS EMPTY.         *00161211
001614*     MADE BY: NANCY EILBES            WR/IR #: CHG0249644       *00161411
001615*                                                                *00161511
001620*----------------------------------------------------------------*00162011
001700 ENVIRONMENT DIVISION.                                            00170004
001800                                                                  00180004
001900 CONFIGURATION SECTION.                                           00190004
002000                                                                  00200004
002100 SOURCE-COMPUTER.        IBM-3090.                                00210004
002200 OBJECT-COMPUTER.        IBM-3090.                                00220004
002300                                                                  00230004
002400 INPUT-OUTPUT SECTION.                                            00240004
002500 FILE-CONTROL.                                                    00250004
002600                                                                  00260004
002700     SELECT BEG-DATE-FILE      ASSIGN TO INP01.                   00270004
002800                                                                  00280004
002900     SELECT CONTAINER-EXT-FILE ASSIGN TO OUT01.                   00290004
003000                                                                  00300004
003100     SELECT NEW-BEG-DATE-FILE  ASSIGN TO OUT02.                   00310004
003200                                                                  00320004
003300 DATA DIVISION.                                                   00330004
003400 FILE SECTION.                                                    00340004
003500                                                                  00350004
003600 FD  BEG-DATE-FILE                                                00360004
003700     RECORDING MODE IS F                                          00370004
003800     BLOCK CONTAINS 0 RECORDS                                     00380004
003900     LABEL RECORDS ARE OMITTED.                                   00390004
003910                                                                  00391004
003920 01  BEG-DATE-REC                PIC X(80).                       00392004
003930                                                                  00393004
003940 FD  CONTAINER-EXT-FILE                                           00394004
003950     RECORDING MODE IS F                                          00395004
003960     BLOCK CONTAINS 0 RECORDS                                     00396004
003970     LABEL RECORDS ARE OMITTED.                                   00397004
003980                                                                  00398004
003990 01  CONTAINER-EXT-REC           PIC X(136).                      00399004
004000                                                                  00400004
004100 FD  NEW-BEG-DATE-FILE                                            00410004
004200     RECORDING MODE IS F                                          00420004
004300     BLOCK CONTAINS 0 RECORDS                                     00430004
004400     LABEL RECORDS ARE OMITTED.                                   00440004
004500                                                                  00450004
004600 01  NEW-BEG-DATE-REC            PIC X(80).                       00460004
004700                                                                  00470004
004800 WORKING-STORAGE SECTION.                                         00480004
004900                                                                  00490004
005000 01  FILLER                            PIC X(50)  VALUE           00500004
005100     ' *** WORKING STORAGE STARTS HERE FOR TRKUT150 *** '.        00510004
005200                                                                  00520004
005300 01  AC-ABEND-CODE                      PIC S9(04) VALUE ZERO     00530004
005400                                                  COMP SYNC.      00540004
005500     88  AC-DB2-ERROR                             VALUE +4013.    00550004
005600                                                                  00560004
005700 01  PS-PROGRAM-SWITCHES.                                         00570004
005800     05  PS-END-OF-CONT-CSR-SW         PIC X(01)  VALUE 'N'.      00580004
005900         88  PS-END-OF-CONT-CSR                   VALUE 'Y'.      00590004
006000         88  PS-NOT-END-OF-CONT-CSR               VALUE 'N'.      00600004
006100     05  PS-END-OF-CONT-PO-CSR-SW      PIC X(01)  VALUE 'N'.      00610004
006200         88  PS-END-OF-CONT-PO-CSR                VALUE 'Y'.      00620004
006300         88  PS-NOT-END-OF-CONT-PO-CSR            VALUE 'N'.      00630004
006400     05  PS-END-OF-BEG-FILE-SW         PIC X(01)  VALUE 'N'.      00640004
006500         88  PS-END-OF-BEG-FILE                   VALUE 'Y'.      00650004
006600         88  PS-NOT-END-OF-BEG-FILE               VALUE 'N'.      00660004
006700                                                                  00670004
006800 01  PC-CONSTANTS.                                                00680004
006900     05  PC-PROGRAM-NAME               PIC  X(08) VALUE           00690004
007000                                                  'TRKUT150'.     00700004
007100     05  PC-DEFAULT-TMST               PIC  X(26) VALUE           00710004
007200                                    '0001-01-01-00.00.00.000000'. 00720004
007210     05  PC-NO-DATA-MSG-RECORD.                                   00721010
007211         10  PC-NO-DATA-MSG            PIC  X(36) VALUE           00721110
007220                          'NO CONTAINER DATA TO SEND TODAY     '. 00722010
007230         10  PC-NO-DATA-FILLER         PIC X(100) VALUE SPACES.   00723010
007300                                                                  00730004
007400 01  PV-PROGRAM-VARIABLES.                                        00740004
007500     05  PV-PARAGRAPH-NAME             PIC  X(30) VALUE SPACES.   00750004
007600     05  PV-DB2-OPERATION              PIC  X(30) VALUE SPACES.   00760004
007700     05  PV-OPERATION-MSG-1            PIC  X(40) VALUE SPACES.   00770004
007800     05  PV-OPERATION-MSG-2            PIC  X(40) VALUE SPACES.   00780004
007900     05  PV-FORMAT-DATE                PIC  X(10) VALUE SPACES.   00790004
008000     05 PV-DISP-DATE.                                             00800004
008100         10  PV-CCYY                   PIC  X(04) VALUE SPACES.   00810004
008200         10  PV-MM                     PIC  X(02) VALUE SPACES.   00820004
008300         10  PV-DD                     PIC  X(02) VALUE SPACES.   00830004
008400     05  PV-CONTNR-ID                  PIC  X(12) VALUE SPACES.   00840004
008500     05  PV-CONTNR-SEQ-NBR             PIC S9(4)  COMP            00850004
008600                                                  VALUE ZEROES.   00860004
008700     05  PV-BEG-DATE-TEMP.                                        00870004
008800         10 PV-BEG-TMST                PIC  X(26) VALUE SPACES.   00880004
008900         10 FILLER                     PIC  X(54) VALUE SPACES.   00890004
009000     05  PV-END-TMST                   PIC  X(26) VALUE SPACES.   00900004
009100     05  PV-CONT-CSR-CNT               PIC S9(07) VALUE ZERO      00910004
009200                                                  COMP-3.         00920004
009300     05  PV-CONT-PO-CSR-CNT            PIC S9(07) VALUE ZERO      00930004
009400                                                  COMP-3.         00940004
009500     05  PV-OUT-HDR-CNT                PIC S9(07) VALUE ZERO      00950004
009600                                                  COMP-3.         00960004
009700     05  PV-OUT-DTL-CNT                PIC S9(07) VALUE ZERO      00970004
009800                                                  COMP-3.         00980004
009900     05  PV-DISPLAY-CNT                PIC ZZZZZZ9.               00990004
010000                                                                  01000004
010100******************************************************************01010004
010200*  CONTAINER INFORMATION FILE LAYOUT - OUTPUT                     01020004
010300******************************************************************01030004
010400     COPY TRRD200.                                                01040004
010500                                                                  01050004
010600***************************************************************** 01060004
010700*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01070004
010800******************************************************************01080004
010900     COPY DPWS004.                                                01090004
011000                                                                  01100004
011100******************************************************************01110004
011200*  DB2 COMMUNICATION AREA.                                        01120004
011300******************************************************************01130004
011400     EXEC SQL                                                     01140004
011500          INCLUDE SQLCA                                           01150004
011600     END-EXEC.                                                    01160004
011700                                                                  01170004
011800******************************************************************01180004
011900*  DCLGEN FOR THE DB2 IMPORT CONTAINER TRACKING TABLE.           *01190004
012000******************************************************************01200004
012100     EXEC SQL                                                     01210004
012200         INCLUDE TIMCNTK                                          01220004
012300     END-EXEC.                                                    01230004
012400                                                                  01240004
012500******************************************************************01250004
012600*  DCLGEN FOR THE DB2 IMPORT CONTAINER PO TABLE.                 *01260004
012700******************************************************************01270004
012800     EXEC SQL                                                     01280004
012900         INCLUDE TIMCNPO                                          01290004
013000     END-EXEC.                                                    01300004
013100                                                                  01310004
013200******************************************************************01320004
013300*  CURSOR USED TO RETRIEVE A LIST OF THE CONTAINERS THAT WERE     01330004
013400*  ADDED OR UPDATED SINCE THE LAST RUN (BEGIN TMST)               01340008
013500******************************************************************01350004
013600                                                                  01360004
013700     EXEC SQL                                                     01370004
013800         DECLARE  CONTAINER_CSR CURSOR FOR                        01380004
013900          SELECT  DISTINCT                                        01390004
014000                  A.CONTNR_ID                                     01400004
014100                 ,A.CONTNR_SEQ_NBR                                01410004
014200            FROM  TIMCNTK A                                       01420004
014300                 ,TIMCNPO B                                       01430004
014400           WHERE  A.CONTNR_ID      = B.CONTNR_ID                  01440004
014500             AND  A.CONTNR_SEQ_NBR = B.CONTNR_SEQ_NBR             01450004
014510             AND  A.MOM_CARR_SCAC_ID <> ' '                       01451007
014600             AND ((A.CRE_TMST      BETWEEN :PV-BEG-TMST AND       01460004
014700                                           :PV-END-TMST)          01470004
014800              OR (A.LAST_UPD_TMST  BETWEEN :PV-BEG-TMST AND       01480004
014900                                           :PV-END-TMST)          01490004
015000              OR (B.CRE_TMST       BETWEEN :PV-BEG-TMST AND       01500004
015100                                           :PV-END-TMST)          01510004
015200              OR (B.LAST_UPD_TMST  BETWEEN :PV-BEG-TMST AND       01520004
015300                                           :PV-END-TMST))         01530004
015400     END-EXEC.                                                    01540004
015500                                                                  01550004
015600******************************************************************01560004
015700*  CURSOR USED TO RETRIEVE LIST OF THE RECORDS THAT WERE MATCHING 01570004
015800*   WITH CONTAINER ID AND SEQUENCE NUMBER OF CONTAINER-CSR CURSOR 01580004
015900******************************************************************01590004
016000                                                                  01600004
016100     EXEC SQL                                                     01610004
016200          DECLARE CONTAINER_PO_CSR CURSOR FOR                     01620004
016300           SELECT A.CONTNR_ID                                     01630004
016400                 ,A.PO_NBR                                        01640004
016500                 ,A.PO_CART_CNT                                   01650004
016600                 ,A.PO_UNT_QTY                                    01660004
016700                 ,A.PO_CBMT_QTY                                   01670004
016800                 ,A.PO_WT_KGRM_QTY                                01680004
016900                 ,A.MSTR_BOL_NBR                                  01690004
017000                 ,A.HSE_BOL_NBR                                   01700004
017100                 ,A.PO_RCVD_DELY_TMST                             01710004
017200            FROM  TIMCNPO A                                       01720004
017300           WHERE  A.CONTNR_ID      = :PV-CONTNR-ID                01730004
017400             AND  A.CONTNR_SEQ_NBR = :PV-CONTNR-SEQ-NBR           01740004
017500     END-EXEC.                                                    01750004
017600                                                                  01760004
017700 PROCEDURE DIVISION.                                              01770004
017800                                                                  01780004
017900 A000-MAINLINE-PARAGRAPH.                                         01790004
018000                                                                  01800004
018100     PERFORM B100-INITIALIZATION.                                 01810004
018200                                                                  01820004
018300     PERFORM B200-EXTRACT-CONTAINERS                              01830004
018400       UNTIL PS-END-OF-CONT-CSR.                                  01840004
018500                                                                  01850004
018600     PERFORM B300-END-OF-ROUTINE.                                 01860004
018700                                                                  01870004
018800     GOBACK.                                                      01880004
018900******************************************************************01890004
019000* B100-INITIALIZATION                                             01900004
019100******************************************************************01910004
019200 B100-INITIALIZATION.                                             01920004
019300                                                                  01930004
019400     OPEN INPUT  BEG-DATE-FILE                                    01940004
019500          OUTPUT CONTAINER-EXT-FILE                               01950004
019600                 NEW-BEG-DATE-FILE.                               01960004
019700                                                                  01970004
019800     PERFORM R100-READ-BEG-DATE-FILE.                             01980004
019900                                                                  01990004
020000     IF PS-END-OF-BEG-FILE                                        02000004
020100        DISPLAY 'NO BEGINNING DATE PROVIDED'                      02010004
020200        MOVE 'R100-READ-BEG-DATE-FILE'  TO PV-PARAGRAPH-NAME      02020004
020300        PERFORM Z100-ABEND                                        02030004
020400     END-IF.                                                      02040004
020500                                                                  02050004
020600     PERFORM S400-SELECT-DATE-RANGE.                              02060004
020700                                                                  02070004
020800     DISPLAY 'BEGINNING TIMESTAMP:  ' PV-BEG-TMST.                02080004
020900     DISPLAY 'END TIMESTAMP:        ' PV-END-TMST.                02090004
021000                                                                  02100004
021100     PERFORM X100-OPEN-CONTAINER-CSR.                             02110004
021200                                                                  02120004
021300     PERFORM S100-FETCH-CONTAINER-CSR.                            02130004
021400                                                                  02140004
021500     IF PS-END-OF-CONT-CSR                                        02150004
021600        DISPLAY 'NO DATA RETRIEVED FOR CONTAINER CURSOR'          02160004
021700     END-IF.                                                      02170004
021800                                                                  02180004
021900******************************************************************02190004
022000* B200-EXTRACT-CONTAINERS                                         02200004
022100******************************************************************02210004
022200 B200-EXTRACT-CONTAINERS.                                         02220004
022300                                                                  02230004
022400* PROCESS CONTAINER HEADER                                        02240004
022500     PERFORM S200-SELECT-CONTAINER-HDR.                           02250004
022600     PERFORM M100-MOVE-CONTAINER-FIELDS.                          02260004
022700     PERFORM W100-WRITE-CONTAINER-EXTRACT.                        02270004
022800                                                                  02280004
022900* PROCESS CONTAINER PO                                            02290004
023000     INITIALIZE  PV-CONT-PO-CSR-CNT.                              02300004
023100     PERFORM X200-OPEN-CONTAINER-PO-CSR.                          02310004
023200     SET PS-NOT-END-OF-CONT-PO-CSR  TO TRUE.                      02320004
023210     PERFORM S300-FETCH-CONTAINER-PO-CSR                          02321005
023300     PERFORM UNTIL PS-END-OF-CONT-PO-CSR                          02330004
023500        PERFORM M200-CONTAINER-PO-DTL                             02350004
023600        PERFORM W100-WRITE-CONTAINER-EXTRACT                      02360004
023610        PERFORM S300-FETCH-CONTAINER-PO-CSR                       02361005
023700     END-PERFORM.                                                 02370004
023800*    DISPLAY "NO. OF DETAIL REC FETCHED : " PV-CONT-PO-CSR-CNT.   02380004
023900     PERFORM Y200-CLOSE-CONTAINER-PO-CSR.                         02390004
024000                                                                  02400004
024100* FETCH NEXT CONTAINER NUMBER                                     02410004
024200     PERFORM S100-FETCH-CONTAINER-CSR.                            02420004
024300                                                                  02430004
024400******************************************************************02440004
024500* B300-END-OF-ROUTINE                                             02450004
024600******************************************************************02460004
024700 B300-END-OF-ROUTINE.                                             02470004
024800                                                                  02480004
024900     PERFORM Y100-CLOSE-CONTAINER-CSR.                            02490004
025000                                                                  02500004
025010     IF PV-OUT-HDR-CNT = 0                                        02501010
025020        WRITE CONTAINER-EXT-REC FROM PC-NO-DATA-MSG-RECORD        02502010
025021        DISPLAY '** NO CONTAINER DATA MESSAGE WRITTEN TO FILE **' 02502110
025030     END-IF.                                                      02503010
025040                                                                  02504010
025100     MOVE PV-END-TMST       TO PV-BEG-TMST.                       02510004
025200                                                                  02520004
025300     PERFORM W200-WRITE-BEG-DATE-FILE.                            02530004
025400                                                                  02540004
025500     DISPLAY '********************************************'       02550004
025600     DISPLAY '**                                        **'       02560004
025700     MOVE PV-CONT-CSR-CNT      TO PV-DISPLAY-CNT                  02570004
025800     DISPLAY 'NO. OF CONTAINERS FETCHED: ' PV-DISPLAY-CNT.        02580004
025900     MOVE PV-OUT-HDR-CNT       TO PV-DISPLAY-CNT                  02590004
026000     DISPLAY 'HEADER RECORDS WRITTEN:    ' PV-DISPLAY-CNT.        02600004
026100     MOVE PV-OUT-DTL-CNT       TO PV-DISPLAY-CNT                  02610004
026200     DISPLAY 'DETAIL RECORDS WRITTEN:    ' PV-DISPLAY-CNT.        02620004
026300     DISPLAY '**                                        **'       02630004
026400     DISPLAY '********************************************'.      02640004
026500                                                                  02650004
026600     CLOSE   BEG-DATE-FILE                                        02660004
026700             CONTAINER-EXT-FILE                                   02670004
026800             NEW-BEG-DATE-FILE.                                   02680004
026900                                                                  02690004
027000                                                                  02700004
027100******************************************************************02710004
027200* M100-MOVE-CONTAINER-FIELDS                                     *02720004
027300******************************************************************02730004
027400 M100-MOVE-CONTAINER-FIELDS.                                      02740004
027500                                                                  02750004
027600     INITIALIZE TR200-DATA-FIELDS.                                02760004
027700                                                                  02770004
027800     SET TR200-CONTNR-HDR TO TRUE.                                02780004
027900     MOVE IMCNTK-CONTNR-ID           TO TR200-CONTNR-ID.          02790004
028000     MOVE IMCNTK-MOM-TRIP-TYP-CDE    TO TR200-VESSEL-TYP.         02800004
028100     MOVE IMCNTK-MOM-IMPRT-VEH-NM    TO TR200-VESSEL-NAME.        02810004
028200     MOVE IMCNTK-MOM-IMPRT-TRIP-ID   TO TR200-VOYAGE.             02820004
028300     MOVE IMCNTK-MOM-CARR-SCAC-ID    TO TR200-CARR-SCAC-ID.       02830004
028400     MOVE IMCNTK-MOM-FOB-CDE         TO TR200-FOB-CDE.            02840004
028500     MOVE IMCNTK-MOM-DEST-POE-CDE    TO TR200-POE-CDE.            02850004
028600                                                                  02860004
028700     IF   IMCNTK-FDR-DPRTR-TMST      =  PC-DEFAULT-TMST           02870004
028800          MOVE IMCNTK-MOM-DPRTR-TMST TO PV-FORMAT-DATE            02880004
028900     ELSE                                                         02890004
029000          MOVE IMCNTK-FDR-DPRTR-TMST TO PV-FORMAT-DATE            02900004
029100     END-IF.                                                      02910004
029200                                                                  02920004
029300     UNSTRING PV-FORMAT-DATE DELIMITED BY '-'                     02930004
029400         INTO PV-CCYY, PV-MM, PV-DD.                              02940004
029500     MOVE PV-DISP-DATE               TO TR200-ACTL-DPRTR-DTE.     02950004
029600                                                                  02960004
029700     MOVE SPACES                     TO PV-FORMAT-DATE            02970004
029800                                        PV-DISP-DATE.             02980004
029900                                                                  02990004
030000     MOVE IMCNTK-MOM-POE-DELY-TMST   TO PV-FORMAT-DATE.           03000004
030100     UNSTRING PV-FORMAT-DATE DELIMITED BY '-'                     03010004
030200         INTO PV-CCYY, PV-MM, PV-DD.                              03020004
030300     MOVE PV-DISP-DATE               TO TR200-EST-ARR-DTE.        03030004
030400                                                                  03040004
030500     MOVE IMCNTK-CONSLR-SCAC-ID      TO TR200-CONSOL-SCAC-ID.     03050004
030600     MOVE IMCNTK-CART-CNT            TO TR200-TOTAL-CARTONS.      03060004
030700     MOVE IMCNTK-UNT-QTY             TO TR200-TOTAL-UNITS.        03070004
030800     MOVE IMCNTK-CBMT-QTY            TO TR200-TOTAL-CBMS.         03080004
030900     MOVE IMCNTK-WT-KGRM-QTY         TO TR200-TOTAL-KGRMS.        03090004
031000     MOVE IMCNTK-ORGN-SHPD-FR-CDE    TO TR200-SHPD-FROM-CDE.      03100004
031100     MOVE IMCNTK-ORGN-SHPD-TO-CDE    TO TR200-SHPD-TO-CDE.        03110004
031200     MOVE IMCNTK-SIZE-CDE            TO TR200-CONTNR-SIZE.        03120004
031300                                                                  03130004
031400     ADD +1  TO PV-OUT-HDR-CNT.                                   03140004
031500                                                                  03150004
031600******************************************************************03160004
031700* M200-CONTAINER-PO-DTL                                          *03170004
031800******************************************************************03180004
031900 M200-CONTAINER-PO-DTL.                                           03190004
032000                                                                  03200004
032100     INITIALIZE TR200-DATA-FIELDS                                 03210004
032200                PV-FORMAT-DATE                                    03220004
032300                PV-DISP-DATE.                                     03230004
032400                                                                  03240004
032500     SET TR200-CONTNR-PO-DTL         TO TRUE.                     03250004
032600     MOVE IMCNPO-CONTNR-ID           TO TR200-CONTNR-ID.          03260004
032700     MOVE IMCNPO-PO-NBR              TO TR200-PO-NBR.             03270004
032800     MOVE IMCNPO-PO-CART-CNT         TO TR200-PO-CARTONS.         03280004
032900     MOVE IMCNPO-PO-UNT-QTY          TO TR200-PO-UNITS.           03290004
033000     MOVE IMCNPO-PO-CBMT-QTY         TO TR200-PO-CBMS.            03300004
033100     MOVE IMCNPO-PO-WT-KGRM-QTY      TO TR200-PO-KGRMS.           03310004
033200     MOVE IMCNPO-MSTR-BOL-NBR        TO TR200-MSTR-BOL-NBR.       03320004
033300     MOVE IMCNPO-HSE-BOL-NBR         TO TR200-HSE-BOL-NBR.        03330004
033400                                                                  03340004
033500     MOVE IMCNPO-PO-RCVD-DELY-TMST   TO PV-FORMAT-DATE.           03350004
033600     UNSTRING PV-FORMAT-DATE DELIMITED BY '-'                     03360004
033700         INTO PV-CCYY, PV-MM, PV-DD.                              03370004
033800     MOVE PV-DISP-DATE               TO TR200-ACTL-DELY-DTE.      03380004
033900                                                                  03390004
034000     ADD +1                       TO PV-OUT-DTL-CNT.              03400004
034100                                                                  03410004
034200******************************************************************03420004
034300* R100-READ-BEG-DATE-FILE                                         03430004
034400******************************************************************03440004
034500 R100-READ-BEG-DATE-FILE.                                         03450004
034600                                                                  03460004
034700     READ BEG-DATE-FILE INTO PV-BEG-DATE-TEMP                     03470004
034800       AT END                                                     03480004
034900          SET PS-END-OF-BEG-FILE  TO TRUE.                        03490004
035000                                                                  03500004
035100******************************************************************03510004
035200* S100-FETCH-CONTAINER-CSR                                       *03520004
035300******************************************************************03530004
035400 S100-FETCH-CONTAINER-CSR.                                        03540004
035500                                                                  03550004
035600     EXEC SQL                                                     03560004
035700         FETCH CONTAINER_CSR                                      03570004
035800          INTO :PV-CONTNR-ID                                      03580004
035900             , :PV-CONTNR-SEQ-NBR                                 03590004
036000     END-EXEC.                                                    03600004
036100                                                                  03610004
036200     EVALUATE TRUE                                                03620004
036300         WHEN SQLCODE = ZERO                                      03630004
036400              ADD +1                     TO PV-CONT-CSR-CNT       03640004
036500*             DISPLAY "CONTAINER ID :     " PV-CONTNR-ID          03650004
036600*             DISPLAY "CONTAINER SEQ NO : " PV-CONTNR-SEQ-NBR     03660004
036700         WHEN SQLCODE = +100                                      03670004
036800              SET PS-END-OF-CONT-CSR     TO TRUE                  03680004
036900         WHEN OTHER                                               03690004
037000              MOVE 'S100-FETCH-CONTAINER-CSR'                     03700004
037100                                         TO PV-PARAGRAPH-NAME     03710004
037200              MOVE 'UNSUCCESSFUL FETCH'  TO PV-DB2-OPERATION      03720004
037300              PERFORM Z200-SQL-ABEND-ROUTINE                      03730004
037400     END-EVALUATE.                                                03740004
037500                                                                  03750004
037600******************************************************************03760004
037700* S200-SELECT-CONTAINER-HDR                                       03770004
037800******************************************************************03780004
037900 S200-SELECT-CONTAINER-HDR.                                       03790004
038000                                                                  03800004
038100     EXEC SQL                                                     03810004
038200          SELECT  A.CONTNR_ID                                     03820004
038300                 ,A.MOM_TRIP_TYP_CDE                              03830004
038400                 ,A.MOM_IMPRT_VEH_NM                              03840004
038500                 ,A.MOM_IMPRT_TRIP_ID                             03850004
038600                 ,A.MOM_CARR_SCAC_ID                              03860004
038700                 ,A.MOM_FOB_CDE                                   03870004
038800                 ,A.MOM_DEST_POE_CDE                              03880004
038900                 ,A.FDR_DPRTR_TMST                                03890004
039000                 ,A.MOM_POE_DELY_TMST                             03900004
039100                 ,A.CONSLR_SCAC_ID                                03910004
039200                 ,A.CART_CNT                                      03920004
039300                 ,A.UNT_QTY                                       03930004
039400                 ,A.CBMT_QTY                                      03940004
039500                 ,A.WT_KGRM_QTY                                   03950004
039600                 ,A.ORGN_SHPD_FR_CDE                              03960004
039700                 ,A.ORGN_SHPD_TO_CDE                              03970004
039800                 ,A.SIZE_CDE                                      03980004
039900                 ,A.MOM_DPRTR_TMST                                03990004
040000            INTO  :IMCNTK-CONTNR-ID                               04000004
040100                 ,:IMCNTK-MOM-TRIP-TYP-CDE                        04010004
040200                 ,:IMCNTK-MOM-IMPRT-VEH-NM                        04020004
040300                 ,:IMCNTK-MOM-IMPRT-TRIP-ID                       04030004
040400                 ,:IMCNTK-MOM-CARR-SCAC-ID                        04040004
040500                 ,:IMCNTK-MOM-FOB-CDE                             04050004
040600                 ,:IMCNTK-MOM-DEST-POE-CDE                        04060004
040700                 ,:IMCNTK-FDR-DPRTR-TMST                          04070004
040800                 ,:IMCNTK-MOM-POE-DELY-TMST                       04080004
040900                 ,:IMCNTK-CONSLR-SCAC-ID                          04090004
041000                 ,:IMCNTK-CART-CNT                                04100004
041100                 ,:IMCNTK-UNT-QTY                                 04110004
041200                 ,:IMCNTK-CBMT-QTY                                04120004
041300                 ,:IMCNTK-WT-KGRM-QTY                             04130004
041400                 ,:IMCNTK-ORGN-SHPD-FR-CDE                        04140004
041500                 ,:IMCNTK-ORGN-SHPD-TO-CDE                        04150004
041600                 ,:IMCNTK-SIZE-CDE                                04160004
041700                 ,:IMCNTK-MOM-DPRTR-TMST                          04170004
041800            FROM  TIMCNTK A                                       04180004
041900           WHERE  A.CONTNR_ID      = :PV-CONTNR-ID                04190004
042000             AND  A.CONTNR_SEQ_NBR = :PV-CONTNR-SEQ-NBR           04200004
042100     END-EXEC.                                                    04210004
042200                                                                  04220004
042300     EVALUATE TRUE                                                04230004
042400         WHEN SQLCODE = ZERO                                      04240004
042500         WHEN SQLCODE = -811                                      04250004
042600              CONTINUE                                            04260004
042700         WHEN OTHER                                               04270004
042800              MOVE 'S200-SELECT-CONTAINER-HDR'                    04280004
042900                                           TO PV-PARAGRAPH-NAME   04290004
043000              MOVE 'UNSUCCESSFUL SELECT'   TO PV-DB2-OPERATION    04300004
043100              PERFORM Z200-SQL-ABEND-ROUTINE                      04310004
043200     END-EVALUATE.                                                04320004
043300                                                                  04330004
043400******************************************************************04340004
043500* S300-FETCH-CONTAINER-PO-CSR                                    *04350004
043600******************************************************************04360004
043700 S300-FETCH-CONTAINER-PO-CSR.                                     04370004
043800     EXEC SQL                                                     04380004
043900         FETCH CONTAINER_PO_CSR                                   04390004
044000          INTO :IMCNPO-CONTNR-ID                                  04400004
044100             , :IMCNPO-PO-NBR                                     04410004
044200             , :IMCNPO-PO-CART-CNT                                04420004
044300             , :IMCNPO-PO-UNT-QTY                                 04430004
044400             , :IMCNPO-PO-CBMT-QTY                                04440004
044500             , :IMCNPO-PO-WT-KGRM-QTY                             04450004
044600             , :IMCNPO-MSTR-BOL-NBR                               04460004
044700             , :IMCNPO-HSE-BOL-NBR                                04470004
044800             , :IMCNPO-PO-RCVD-DELY-TMST                          04480004
044900     END-EXEC.                                                    04490004
045000     EVALUATE TRUE                                                04500004
045100         WHEN SQLCODE = ZERO                                      04510004
045200              ADD +1 TO PV-CONT-PO-CSR-CNT                        04520004
045300         WHEN SQLCODE = +100                                      04530004
045400              SET PS-END-OF-CONT-PO-CSR TO TRUE                   04540004
045500         WHEN OTHER                                               04550004
045600              MOVE 'S300-FETCH-CONTAINER-PO-CSR'                  04560004
045700                                        TO PV-PARAGRAPH-NAME      04570004
045800              MOVE 'UNSUCCESSFUL FETCH' TO PV-DB2-OPERATION       04580004
045900              PERFORM Z200-SQL-ABEND-ROUTINE                      04590004
046000     END-EVALUATE.                                                04600004
046100                                                                  04610004
046200******************************************************************04620004
046300* S400-SELECT-DATE-RANGE                                          04630004
046400******************************************************************04640004
046500 S400-SELECT-DATE-RANGE.                                          04650004
046600                                                                  04660004
046700     EXEC SQL                                                     04670004
046800          SELECT CURRENT TIMESTAMP                                04680004
046900            INTO :PV-END-TMST                                     04690004
047000            FROM SYSIBM.SYSDUMMY1                                 04700004
047100     END-EXEC.                                                    04710004
047200                                                                  04720004
047300     IF SQLCODE NOT EQUAL ZERO                                    04730004
047400        MOVE 'S400-SELECT-DATE-RANGE' TO PV-PARAGRAPH-NAME        04740004
047500        MOVE 'CANNOT GET CURRENT TIMESTAMP'                       04750004
047600                                      TO PV-DB2-OPERATION         04760004
047700        PERFORM Z200-SQL-ABEND-ROUTINE                            04770004
047800     END-IF.                                                      04780004
047900                                                                  04790004
048000******************************************************************04800004
048100* W100-WRITE-CONTAINER-EXTRACT                                   *04810004
048200******************************************************************04820004
048300 W100-WRITE-CONTAINER-EXTRACT.                                    04830004
048400                                                                  04840004
048500     WRITE CONTAINER-EXT-REC FROM TR200-RECORD.                   04850004
048600                                                                  04860004
048700******************************************************************04870004
048800* W200-WRITE-BEG-DATE-FILE                                        04880004
048900******************************************************************04890004
049000 W200-WRITE-BEG-DATE-FILE.                                        04900004
049100                                                                  04910004
049200     WRITE NEW-BEG-DATE-REC FROM PV-BEG-DATE-TEMP.                04920004
049300                                                                  04930004
049400******************************************************************04940004
049500* X100-OPEN-CONTAINER-CSR                                        *04950004
049600******************************************************************04960004
049700 X100-OPEN-CONTAINER-CSR.                                         04970004
049800                                                                  04980004
049900     EXEC SQL                                                     04990004
050000         OPEN CONTAINER_CSR                                       05000004
050100     END-EXEC.                                                    05010004
050200                                                                  05020004
050300     EVALUATE TRUE                                                05030004
050400       WHEN SQLCODE = ZERO                                        05040004
050500            CONTINUE                                              05050004
050600       WHEN SQLWARN0 NOT = SPACES                                 05060004
050700       WHEN SQLCODE  NOT = ZERO                                   05070004
050800              MOVE 'X100-OPEN-CONTAINER-CSR'                      05080004
050900                                           TO PV-PARAGRAPH-NAME   05090004
051000              MOVE 'UNSUCCESSFUL OPEN'     TO PV-DB2-OPERATION    05100004
051100              PERFORM Z200-SQL-ABEND-ROUTINE                      05110004
051200     END-EVALUATE.                                                05120004
051300                                                                  05130004
051400******************************************************************05140004
051500* X200-OPEN-CONTAINER-PO-CSR                                     *05150004
051600******************************************************************05160004
051700 X200-OPEN-CONTAINER-PO-CSR.                                      05170004
051800                                                                  05180004
051900     EXEC SQL                                                     05190004
052000         OPEN CONTAINER_PO_CSR                                    05200004
052100     END-EXEC.                                                    05210004
052200                                                                  05220004
052300     EVALUATE TRUE                                                05230004
052400       WHEN SQLCODE = ZERO                                        05240004
052500            CONTINUE                                              05250004
052600       WHEN SQLWARN0 NOT = SPACES                                 05260004
052700       WHEN SQLCODE  NOT = ZERO                                   05270004
052800            MOVE 'X200-OPEN-CONTAINER-PO-CSR'                     05280004
052900                                         TO PV-PARAGRAPH-NAME     05290004
053000            MOVE 'UNSUCCESSFUL OPEN'     TO PV-DB2-OPERATION      05300004
053100            PERFORM Z200-SQL-ABEND-ROUTINE                        05310004
053200     END-EVALUATE.                                                05320004
053300                                                                  05330004
053400******************************************************************05340004
053500* Y100-CLOSE-CONTAINER-CSR                                       *05350004
053600******************************************************************05360004
053700 Y100-CLOSE-CONTAINER-CSR.                                        05370004
053800                                                                  05380004
053900       EXEC SQL                                                   05390004
054000           CLOSE CONTAINER_CSR                                    05400004
054100       END-EXEC.                                                  05410004
054200                                                                  05420004
054300       EVALUATE TRUE                                              05430004
054400         WHEN SQLCODE = ZERO                                      05440004
054500           CONTINUE                                               05450004
054600         WHEN SQLWARN0 NOT = SPACES                               05460004
054700         WHEN SQLCODE  NOT = ZERO                                 05470004
054800              MOVE 'Y100-CLOSE-CONTAINER-CSR'                     05480004
054900                                           TO PV-PARAGRAPH-NAME   05490004
055000              MOVE 'UNSUCCESSFUL CLOSE'    TO PV-DB2-OPERATION    05500004
055100              PERFORM Z200-SQL-ABEND-ROUTINE                      05510004
055200       END-EVALUATE.                                              05520004
055300                                                                  05530004
055400******************************************************************05540004
055500* Y200-CLOSE-CONTAINER-PO-CSR                                    *05550004
055600******************************************************************05560004
055700 Y200-CLOSE-CONTAINER-PO-CSR.                                     05570004
055800                                                                  05580004
055900       EXEC SQL                                                   05590004
056000           CLOSE CONTAINER_PO_CSR                                 05600004
056100       END-EXEC.                                                  05610004
056200                                                                  05620004
056300       EVALUATE TRUE                                              05630004
056400         WHEN SQLCODE = ZERO                                      05640004
056500           CONTINUE                                               05650004
056600         WHEN SQLWARN0 NOT = SPACES                               05660004
056700         WHEN SQLCODE  NOT = ZERO                                 05670004
056800              MOVE 'Y200-CLOSE-CONTAINER-PO-CSR'                  05680004
056900                                           TO PV-PARAGRAPH-NAME   05690004
057000              MOVE 'UNSUCCESSFUL CLOSE'    TO PV-DB2-OPERATION    05700004
057100              PERFORM Z200-SQL-ABEND-ROUTINE                      05710004
057200       END-EVALUATE.                                              05720004
057300                                                                  05730004
057400                                                                  05740004
057500*                                                                 05750004
057600******************************************************************05760004
057700* Z100-ABEND.                                                    *05770004
057800*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                 *05780004
057900******************************************************************05790004
058000 Z100-ABEND.                                                      05800004
058100                                                                  05810004
058200     DISPLAY '** ABEND           **'.                             05820004
058300     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          05830004
058400     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        05840004
058500     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       05850004
058600     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       05860004
058700                                                                  05870004
058800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         05880004
058900                                                                  05890004
059000***************************************************************** 05900004
059100* Z200-SQL-ABEND-ROUTINE.                                         05910004
059200*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE        05920004
059300*     OCCURS.                                                     05930004
059400***************************************************************** 05940004
059500 Z200-SQL-ABEND-ROUTINE.                                          05950004
059600                                                                  05960004
059700     SET AC-DB2-ERROR      TO TRUE.                               05970004
059800                                                                  05980004
059900     DISPLAY '** ABEND     **'.                                   05990004
060000     DISPLAY '** PROGRAM   **' PC-PROGRAM-NAME.                   06000004
060100     DISPLAY '** PARAGRAPH **' PV-PARAGRAPH-NAME.                 06010004
060200     DISPLAY '** OPERATION **' PV-DB2-OPERATION.                  06020004
060300                                                                  06030004
060400     COPY DPPD004.                                                06040004
060500     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         06050004
060600                                                                  06060004
