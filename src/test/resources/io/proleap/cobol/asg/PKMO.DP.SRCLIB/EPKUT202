000100****************************************************************  00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300****************************************************************  00030000
000400 PROGRAM-ID.    EPKUT202.                                         00040009
000500 AUTHOR.        LARRY WEISS.                                      00050000
000600 DATE-WRITTEN.  NOVEMBER 7, 2007.                                 00060000
000700                                                                  00070000
000800*-------------------------------------------------------------    00080000
000900*     FULL FILE EXTRACT OF OFFERS FOR NEXT/FUTURE DAY             00090000
001000*         OFFER PROCESSING                                        00100000
001100*-------------------------------------------------------------    00110000
001200* THIS PROGRAM WILL READ DATA FROM THE OFFERS DATA FILE, THE      00120000
001300* OFFERS STORE GROUP FILE, AND THE XST_STR_GP_MBSHP TABLE.        00130000
001400* THIS DATA WILL BE WRITTEN TO ONE, TWO, THREE, OR FOUR OF        00140000
001500* THE FOLLOWING OUTPUT FILES DEPENDING ON THE LISTED RULES.       00150000
001600* THE OUTPUT FILES WHICH WILL BE USED TO FACILITATE THE LOAD OF   00160000
001700* THE XST_OFR TABLE, THE XST_OFR_SECT TABLE, THE XST_OFR_BWP      00170000
001800* TABLE, AND THE XST_OFR_MDSE TABLE ARE THE OFFER FILE, THE       00180000
001900* OFFER SECTION FILE, THE OFFER BWP FILE AND THE OFFER MDSE FILES 00190000
002000* REPECTIVELY.  THE STORE LIST FILE WILL BE CREATED AS REQUIRED.  00200000
002100*-------------------------------------------------------------    00210000
002200* HISTORY LOG:                                                    00220000
002400*-------------------------------------------------------------    00240000
002500* DATE:        21 JAN 2008                                        00250000
002600* WR/IR#:      WR#33714                                           00260004
002700* PROGRAMMER:  CHUCK HERO                                         00270000
002800* DESCRIPTION: INITIAL PROGRAM CREATION.                          00280000
003200*                                                                 00320000
003300*-------------------------------------------------------------    00330000
003400* DATE:                                                           00340000
003500* WR/IR#:                                                         00350000
003600* PROGRAMMER:                                                     00360000
003700* DESCRIPTION:                                                    00370000
003800*                                                                 00380000
003810*                                                                 00381000
003900****************************************************************  00390000
004000 ENVIRONMENT DIVISION.                                            00400000
004100****************************************************************  00410000
004200 CONFIGURATION SECTION.                                           00420000
004300 SOURCE-COMPUTER. IBM-3090.                                       00430000
004400 OBJECT-COMPUTER. IBM-3090.                                       00440000
004500                                                                  00450000
004600 INPUT-OUTPUT SECTION.                                            00460000
004700                                                                  00470000
004800 FILE-CONTROL.                                                    00480000
004900     SELECT OFFERS-DATA-FILE                                      00490000
005000       ASSIGN TO INP01.                                           00500000
005100                                                                  00510000
005200     SELECT OFFERS-STORE-GROUP-FILE                               00520000
005300       ASSIGN TO INP02.                                           00530000
005400                                                                  00540000
005500     SELECT OFFER-FILE                                            00550000
005600       ASSIGN TO OUT01.                                           00560000
005700                                                                  00570000
005800     SELECT OFFER-SECTION-FILE                                    00580000
005900       ASSIGN TO OUT02.                                           00590000
006000                                                                  00600000
006100     SELECT OFFER-BWP-FILE                                        00610000
006200       ASSIGN TO OUT03.                                           00620000
006300                                                                  00630000
006400     SELECT OFFER-MDSE-FILE                                       00640000
006500       ASSIGN TO OUT04.                                           00650000
006600                                                                  00660000
006700     SELECT STORE-LIST-FILE                                       00670000
006800       ASSIGN TO OUT05.                                           00680000
006900                                                                  00690000
007000****************************************************************  00700000
007100 DATA DIVISION.                                                   00710000
007200****************************************************************  00720000
007300 FILE SECTION.                                                    00730000
007400                                                                  00740000
007500 FD  OFFERS-DATA-FILE                                             00750000
007600     RECORDING MODE IS F                                          00760000
007700     LABEL RECORDS ARE STANDARD                                   00770000
007800     DATA RECORD IS OFFERS-DATA-RECORD.                           00780000
007900                                                                  00790000
008000 01  OFFERS-DATA-RECORD                            PIC X(176).    00800000
008100*  COPYBOOK IS EPRD205                                            00810000
008200                                                                  00820000
008300 FD  OFFERS-STORE-GROUP-FILE                                      00830000
008400     RECORDING MODE IS F                                          00840000
008500     LABEL RECORDS ARE STANDARD                                   00850000
008600     DATA RECORD IS OFFERS-STORE-GROUP-RECORD.                    00860000
008700                                                                  00870000
008800 01  OFFERS-STORE-GROUP-RECORD                     PIC X(50).     00880000
008900*  COPYBOOK IS EPRD206                                            00890000
009000                                                                  00900000
009100 FD  OFFER-FILE                                                   00910000
009200     RECORDING MODE IS F                                          00920000
009300     LABEL RECORDS ARE STANDARD                                   00930000
009400     DATA RECORD IS OFFER-RECORD.                                 00940000
009500                                                                  00950000
009600 01  OFFER-RECORD                                  PIC X(160).    00960000
009700*  COPYBOOK IS EPRD201                                            00970000
009800                                                                  00980000
009900 FD  OFFER-SECTION-FILE                                           00990000
010000     RECORDING MODE IS F                                          01000000
010100     LABEL RECORDS ARE STANDARD                                   01010000
010200     DATA RECORD IS OFFER-SECTION-RECORD.                         01020000
010300                                                                  01030000
010400 01  OFFER-SECTION-RECORD                          PIC X(120).    01040000
010500*  COPYBOOK IS EPRD202                                            01050000
010600                                                                  01060000
010700 FD  OFFER-BWP-FILE                                               01070000
010800     RECORDING MODE IS F                                          01080000
010900     LABEL RECORDS ARE STANDARD                                   01090000
011000     DATA RECORD IS OFFER-BWP-RECORD.                             01100000
011100                                                                  01110000
011200 01  OFFER-BWP-RECORD                              PIC X(110).    01120000
011300*  COPYBOOK IS EPRD203                                            01130000
011400                                                                  01140000
011500 FD  OFFER-MDSE-FILE                                              01150000
011600     RECORDING MODE IS F                                          01160000
011700     LABEL RECORDS ARE STANDARD                                   01170000
011800     DATA RECORD IS OFFER-MDSE-RECORD.                            01180000
011900                                                                  01190000
012000 01  OFFER-MDSE-RECORD                             PIC X(90).     01200000
012100*  COPYBOOK IS EPRD204                                            01210000
012200                                                                  01220000
012300 FD  STORE-LIST-FILE                                              01230000
012400     RECORDING MODE IS F                                          01240000
012500     LABEL RECORDS ARE STANDARD                                   01250000
012600     DATA RECORD IS STORE-LIST-RECORD.                            01260000
012700                                                                  01270000
012800 01  STORE-LIST-RECORD                             PIC X(50).     01280000
012900*  COPYBOOK IS EPRD206                                            01290000
013000                                                                  01300000
013100*-------------------------------------------------------------    01310000
013200 WORKING-STORAGE SECTION.                                         01320000
013300*-------------------------------------------------------------    01330000
013400 01  AC-ABEND-CODE                  PIC S9(04) VALUE ZERO         01340000
013500                                               COMP SYNC.         01350000
013600     88  AC-4050-SUCCESSFUL                    VALUE +4050.       01360000
013700     88  AC-4051-SUCCESS-NO-OFFERS-DATA        VALUE +4051.       01370000
013800     88  AC-4004-TABLE-OVERFLOW                VALUE +4004.       01380000
013900     88  AC-4008-INVALID-EMPTY-INPUT           VALUE +4008.       01390000
014000     88  AC-4013-DB2-ERROR                     VALUE +4013.       01400000
014100                                                                  01410000
014200*-------------------------------------------------------------    01420000
014300* PC- PROGRAM CONSTANTS                                           01430000
014400*-------------------------------------------------------------    01440000
014500 01  PC-PROGRAM-CONSTANTS.                                        01450000
014600     05  PC-PROGRAM-NAME            PIC  X(08) VALUE 'EPKUT202'.  01460000
014700     05  PC-MAX-RETRIES             PIC S9(04) VALUE +5 COMP.     01470000
014710     05  PC-STR-GP-TYP-CDE-1000     PIC 9(05) VALUE 1000.         01471001
014711     05  PC-STR-GP-TYP-CDE-5000     PIC 9(05) VALUE 5000.         01471104
014712     05  PC-STR-GP-TYP-CDE-2000     PIC 9(05) VALUE 2000.         01471219
014720     05  PC-NULL-VALUE              PIC X(01) VALUE '~'.          01472004
014730     05  PC-SLTR-NDX-MAX            PIC S9(04) VALUE +1000 COMP.  01473004
014740     05  PC-ESLR-IDX-MAX            PIC S9(04) VALUE +1000 COMP.  01474004
014800                                                                  01480000
014900*-------------------------------------------------------------    01490000
015000* PS- PROGRAM SWITCHES                                            01500000
015100*-------------------------------------------------------------    01510000
015200 01  PS-PROGRAM-SWITCHES.                                         01520000
015300     05  PS-OFFER-STORES-CSR-EOF-SW   PIC X(01) VALUE 'N'.        01530000
015400         88  PS-OFFER-STORES-CSR-EOF            VALUE 'Y'.        01540000
015500         88  PS-OFFER-STORES-CSR-NOT-EOF        VALUE 'N'.        01550000
015600     05  PS-OFFER-DATA-FILE-EMPTY-SW  PIC X(01) VALUE 'N'.        01560000
015700         88  PS-OFFERS-DATA-FILE-EMPTY          VALUE 'Y'.        01570000
015800         88  PS-OFFERS-DATA-FILE-NOT-EMPTY      VALUE 'N'.        01580000
015900     05  PS-OFFER-DATA-FILE-EMPTY-SW  PIC X(01) VALUE 'N'.        01590000
016000         88  PS-STR-GRP-FILE-EMPTY              VALUE 'Y'.        01600000
016100         88  PS-STR-GRP-FILE-NOT-EMPTY          VALUE 'N'.        01610000
016200     05  PS-OFR-HAS-EXCL-STR-GRPS-SW  PIC X(01) VALUE 'N'.        01620000
016300         88  PS-OFR-HAS-EXCL-STR-GRPS           VALUE 'Y'.        01630000
016400         88  PS-OFR-HAS-NO-EXCL-STR-GRPS        VALUE 'N'.        01640000
016410     05  PS-PAR-STR-GRP-SET-SW        PIC X(01) VALUE 'N'.        01641011
016420         88  PS-PAR-STR-GRP-SET                 VALUE 'Y'.        01642011
016430         88  PS-PAR-STR-GRP-NOT-SET             VALUE 'N'.        01643011
016500                                                                  01650000
016600*-------------------------------------------------------------    01660000
016700* PV- PROGRAM VARIABLES                                           01670000
016800*-------------------------------------------------------------    01680000
016900 01  PV-PROGRAM-VARIABLES.                                        01690000
017000     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACES.    01700000
017100     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACES.    01710000
017200     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACES.    01720000
017300     05  PV-DB2-OPERATION             PIC  X(10) VALUE SPACES.    01730001
017400     05  PV-SQL-SUB                   PIC S9(04) VALUE +0 COMP.   01740000
017500     05  PV-OFFERS-DATA-EOF-IND       PIC  X(01) VALUE 'N'.       01750000
017600         88  OFFERS-DATA-FILE-EOF                VALUE 'Y'.       01760000
017700         88  OFFERS-DATA-FILE-NOT-EOF            VALUE 'N'.       01770000
017800     05  PV-OFFERS-DATA-RECORD-IND    PIC  X(01) VALUE 'N'.       01780000
017900         88  UNPROCESSED-OFFERS-RECORD           VALUE 'Y'.       01790000
018000         88  PROCESSED-OFFERS-RECORD             VALUE 'N'.       01800000
018100     05  PV-STORE-GROUP-RECORD-IND    PIC  X(01) VALUE 'N'.       01810000
018200         88  UNPROCESSED-STORE-GROUP-RECORD      VALUE 'Y'.       01820000
018300         88  PROCESSED-STORE-GROUP-RECORD        VALUE 'N'.       01830000
018400     05  PV-STORE-GROUP-EOF-IND       PIC  X(01) VALUE 'N'.       01840000
018500         88  STORE-GROUP-FILE-EOF                VALUE 'Y'.       01850000
018600         88  STORE-GROUP-FILE-NOT-EOF            VALUE 'N'.       01860000
018700     05  INPUT-DATA-FILE-IND          PIC  X(01) VALUE 'N'.       01870000
018800         88  INPUT-DATA-FILES-EOF                VALUE 'Y'.       01880000
018900         88  INPUT-DATA-FILE-NOT-EOF             VALUE 'N'.       01890000
019000     05  PV-PROCESS-FILE-TYPE         PIC  X(03) VALUE SPACES.    01900000
019100         88  PV-PROCESS-FILE-FUL                 VALUE 'FUL'.     01910000
019200         88  PV-PROCESS-FILE-NEW                 VALUE 'NEW'.     01920000
019300         88  PV-PROCESS-FILE-CHG                 VALUE 'CHG'.     01930000
019910     05  PV-CHILD-STR-NBR             PIC  9(05) VALUE ZERO.      01991000
020000     05  PV-CHILD-STR-GP-ID           PIC  9(05) VALUE ZERO.      02000000
020100     05  PV-CHILD-STR-GP-TYP-CDE      PIC  9(05) VALUE ZERO.      02010000
020200     05  PV-PARENT-STR-GP-TYP-LVL     PIC  9(05) VALUE ZERO.      02020000
020210     05  PV-PARENT-STR-GP-ID          PIC  9(05) VALUE ZERO.      02021000
020220     05  PV-PARENT-STR-GP-TYP-CDE     PIC  9(05) VALUE ZERO.      02022000
020230     05  PV-HLD-PRNT-STR-GRP-TYP-CDE  PIC  9(05) VALUE ZERO.      02023000
020250     05  PV-HLD-PRNT-STR-GRP-ID       PIC  9(05) VALUE ZERO.      02025000
020260     05  PV-HLD-CHLD-STR-GRP-TYP-CDE  PIC  9(05) VALUE ZERO.      02026000
020280     05  PV-HLD-CHLD-STR-GRP-ID       PIC  9(05) VALUE ZERO.      02028000
020300     05  PV-HOLD-OFR-KEY.                                         02030000
020400         10 PV-HOLD-EVENT-ID          PIC  9(10) VALUE ZERO.      02040000
020500         10 PV-HOLD-OFFER-ID          PIC  9(10) VALUE ZERO.      02050000
020600         10 PV-HOLD-OFR-SECT-TYP-CDE  PIC  X(01) VALUE SPACE.     02060000
020610     05  PV-HLD-PRNT-STR-GP-TYP-LVL   PIC  9(05) VALUE ZERO.      02061000
020620     05  PV-HLD-PARENT-STR-GRP-ID     PIC  9(05) VALUE ZERO.      02062000
020630                                                                  02063000
020640* ------------------------------------------------------------    02064000
020650*  DATE - TIMESTAMP VARIABLES                                     02065000
020660* ------------------------------------------------------------    02066000
020670 01  PV-DATE-TIME-VARIABLES.                                      02067000
020680     05  PV-TIMESTAMP                  PIC X(26) VALUE SPACES.    02068000
020690     05  PV-CURRENT-TMST REDEFINES     PV-TIMESTAMP.              02069000
020691         10  PV-CURRENT-DATE.                                     02069100
020692             15 PV-CURR-YYYY           PIC 9(04).                 02069200
020693             15 FILLER                 PIC X(01).                 02069300
020694             15 PV-CURR-MO             PIC 9(02).                 02069400
020695             15 FILLER                 PIC X(01).                 02069500
020696             15 PV-CURR-DD             PIC 9(02).                 02069600
020697             15 FILLER                 PIC X(01).                 02069700
020698         10  PV-CURRENT-TIME.                                     02069800
020699             15 PV-CURR-HH             PIC 9(02).                 02069900
020700             15 FILLER                 PIC X(01).                 02070000
020701             15 PV-CURR-MM             PIC 9(02).                 02070100
020702             15 FILLER                 PIC X(01).                 02070200
020703             15 PV-CURR-SS             PIC 9(02).                 02070300
020704             15 FILLER                 PIC X(01).                 02070400
020705             15 PV-CURR-SSSSSS         PIC 9(06).                 02070500
020710                                                                  02071000
020800* ------------------------------------------------------------    02080000
020900*  COUNTERS                                                       02090000
021000* ------------------------------------------------------------    02100000
021100 01  PV-COUNTERS.                                                 02110000
021200     05  PV-OFFERS-DATA-RECS          PIC  9(05) VALUE ZERO.      02120000
021300     05  PV-OFFERS-STORE-GROUP-RECS   PIC  9(05) VALUE ZERO.      02130000
021400     05  PV-OFFER-OUT-COUNT           PIC  9(05) VALUE ZERO.      02140000
021500     05  PV-SECTION-OUT-COUNT         PIC  9(05) VALUE ZERO.      02150000
021600     05  PV-BWP-OUT-COUNT             PIC  9(05) VALUE ZERO.      02160000
021700     05  PV-MDSE-OUT-COUNT            PIC  9(05) VALUE ZERO.      02170000
021800     05  PV-STORE-LIST-OUT-COUNT      PIC  9(05) VALUE ZERO.      02180000
021801     05  PV-PARENT-COUNT              PIC  9(05) VALUE ZERO.      02180100
021810     05  PV-EXCP-STR-GP-COUNT         PIC  9(05) VALUE ZERO.      02181000
021820     05  PV-EXCP-STR-GP-PRNT-FND-CNT  PIC  9(05) VALUE ZERO.      02182000
021900                                                                  02190000
022000*-------------------------------------------------------------    02200000
022110*  THIS TABLE WILL HOLD THE DATA READ FROM THE INPUT STORE GROUP  02211004
022120*  FILE FOR A SINGLE OFFER.                                       02212004
022130*  ONCE THE TABLE IS LOADED WITH THE INCLUDED AND EXCLUDED        02213004
022140*  STORE GROUPS FOR AN OFFER, IT WILL BE THEN PROCESSED FURTHER   02214004
022150*  TO GROUP ALL THE EXCLUDED STORE GROUPS JUST AFTER THE INCLUDED 02215004
022160*  STORE GROUP.                                                   02216004
022170*  IE-IND = Y (IMPLIES THE STR-GP-TYP-CD & STR-GP-ID ARE INCLUDED 02217004
022180*  IE-IND = N (IMPLIES THE STR-GP-TYP-CD & STR-GP-ID ARE EXCLUDED 02218004
022200*-------------------------------------------------------------    02220000
022300 01  PV-STORE-LIST-TBL.                                           02230000
022400     05  PV-STR-LIST-TBL-RCD          OCCURS 1000 TIMES           02240004
022500                                      INDEXED BY PV-SLTR-NDX,     02250000
022510                                                 PV-SLTR-NDX2.    02251000
022600         10 PV-SLTR-ADD-DLT-FLG          PIC  X(01) VALUE SPACE.  02260000
022700             88 PV-SLTR-ADD                         VALUE 'A'.    02270000
022800             88 PV-SLTR-DELETE                      VALUE 'D'.    02280000
022900         10 PV-SLTR-OFR-KEY.                                      02290000
023000             15 PV-SLTR-EVENT-ID         PIC  9(10) VALUE ZERO.   02300000
023100             15 PV-SLTR-OFFER-ID         PIC  9(10) VALUE ZERO.   02310000
023200             15 PV-SLTR-OFR-SECT-TYP-CDE PIC  X(01) VALUE SPACE.  02320000
023300         10 PV-SLTR-STR-GRP-TYP-CDE      PIC  9(05) VALUE ZEROS.  02330000
023400         10 PV-SLTR-STR-GRP-ID           PIC  9(05) VALUE ZEROS.  02340000
023500         10 PV-SLTR-IE-IND               PIC  X(01) VALUE SPACE.  02350000
023600         10 PV-SLTR-STORE-NUMBER         PIC  9(05) VALUE ZEROS.  02360000
023700         10 PV-SLTR-FILLER               PIC  X(12) VALUE SPACES. 02370000
023800                                                                  02380000
023900*-------------------------------------------------------------    02390000
023910*  AFTER LOADING THE ABOVE TABLE                                  02391004
023920*  THE EXCLUDED STORE GROUPS ARE PAIRED WITH THE CORRECT INCLUDED 02392004
023930*  STORE GROUPS FOR A SINGLE OFFER.                               02393010
023940*                                                                 02394004
024000*  TABLE FOR CHILD / PARENT STORE GROUP LIST                      02400000
024100*   - FOR EXCEPTION STORE GROUP PROCESSING                        02410000
024200*-------------------------------------------------------------    02420000
024300 01  PV-PARENT-CHLD-STR-GRP-TBL.                                  02430004
024400     05  PV-EXCPT-STR-LIST-RCD      OCCURS 1000 TIMES             02440004
024500                                      INDEXED BY PV-ESLR-INDEX.   02450000
024600         10 PV-ESLR-CHLD-STR-GP-TYP-CDE PIC   9(05) VALUE ZEROS.  02460000
024700         10 PV-ESLR-CHLD-STR-GP-ID       PIC  9(05) VALUE ZEROS.  02470000
024800         10 PV-ESLR-PRNT-STR-GP-TYP-CDE PIC   9(05) VALUE ZEROS.  02480000
024900         10 PV-ESLR-PRNT-STR-GP-ID       PIC  9(05) VALUE ZEROS.  02490000
025000                                                                  02500000
025100*-------------------------------------------------------------    02510000
025200*  COPY BOOK FOR OFFERS DATA FILE                                 02520000
025300*-------------------------------------------------------------    02530000
025400     COPY EPRD205.                                                02540000
025410                                                                  02541000
025420*-------------------------------------------------------------    02542000
025430*  COPY BOOK FOR OFFERS STORE GROUP INPUT FILE                    02543000
025460*-------------------------------------------------------------    02546000
025471     COPY EPRD206 REPLACING EP206 BY PV206.                       02547100
025500                                                                  02550000
025600*-------------------------------------------------------------    02560000
025700*  COPY BOOK FOR OFFERS STORE LIST FILE                           02570000
026000*-------------------------------------------------------------    02600000
026100     COPY EPRD206.                                                02610000
027700                                                                  02770000
027800*-------------------------------------------------------------    02780000
027900*  COPY BOOK FOR OFFER FILE                                       02790000
028000*-------------------------------------------------------------    02800000
028100     COPY EPRD201.                                                02810000
028200                                                                  02820000
028300*-------------------------------------------------------------    02830000
028400*  COPY BOOK FOR OFFER SECTION FILE                               02840000
028500*-------------------------------------------------------------    02850000
028600     COPY EPRD202.                                                02860000
028700                                                                  02870000
028800*-------------------------------------------------------------    02880000
028900*  COPY BOOK FOR OFFER BWP FILE                                   02890000
029000*-------------------------------------------------------------    02900000
029100     COPY EPRD203.                                                02910000
029200                                                                  02920000
029300*-------------------------------------------------------------    02930000
029400*  COPY BOOK FOR OFFER MDSE FILE                                  02940000
029500*-------------------------------------------------------------    02950000
029600     COPY EPRD204.                                                02960000
029700                                                                  02970000
029800*-------------------------------------------------------------    02980000
029900*  VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        02990000
030000*-------------------------------------------------------------    03000000
030100     COPY DPWS004.                                                03010000
030200                                                                  03020000
030300*-------------------------------------------------------------    03030000
030400*  DB2 ABEND COPY BOOK                                            03040000
030500*-------------------------------------------------------------    03050000
030600     COPY SQLCA2.                                                 03060000
030700                                                                  03070000
030800*-------------------------------------------------------------    03080000
030900*  DB2 COMMUNICATIONS AREA                                        03090000
031000*-------------------------------------------------------------    03100000
031100     EXEC SQL                                                     03110000
031200         INCLUDE SQLCA                                            03120000
031300     END-EXEC.                                                    03130000
031400                                                                  03140000
031500*-------------------------------------------------------------    03150000
031600*  DB2 TABLE XST00023 STORE GROUP MEMBERSHIP                      03160000
031700*-------------------------------------------------------------    03170000
031800     EXEC SQL                                                     03180000
031900         INCLUDE XST00023                                         03190000
032000     END-EXEC.                                                    03200000
032100                                                                  03210000
032200*-------------------------------------------------------------    03220000
032300* DECLARE STORE GROUP MEMBERSHIP CURSOR                           03230000
032400*-------------------------------------------------------------    03240000
032500     EXEC SQL                                                     03250000
032600         DECLARE OFFER_STORES CURSOR FOR                          03260000
032700             SELECT STR_NBR                                       03270000
032800             FROM XST_STR_GP_MBSHP                                03280000
032900             WHERE STR_GP_TYP_CDE = :XST00023-STR-GP-TYP-CDE      03290000
033000               AND STR_GP_ID      = :XST00023-STR-GP-ID           03300000
033100             WITH UR                                              03310000
033200     END-EXEC.                                                    03320000
033300                                                                  03330000
033400****************************************************************  03340000
033500 PROCEDURE DIVISION.                                              03350000
033600****************************************************************  03360000
033700 0000-MAINLINE.                                                   03370000
033800                                                                  03380000
033900     PERFORM 1000-INITIALIZATION.                                 03390000
034000                                                                  03400000
034400     PERFORM 1100-PROCESS-OFFERS-FILE                             03440002
034500       UNTIL OFFERS-DATA-FILE-EOF.                                03450002
034600                                                                  03460000
034900     PERFORM 1300-PROCESS-STORE-GROUP-FILE                        03490002
035000       UNTIL STORE-GROUP-FILE-EOF.                                03500002
035100                                                                  03510000
035500     PERFORM 9999-WRAPUP.                                         03550002
035600                                                                  03560000
035700     GOBACK.                                                      03570000
035800                                                                  03580000
035900*0000-EXIT.                                                       03590000
036000****************************************************************  03600000
036100* 1000-INITIALIZATION.                                            03610000
036110*  - INTIALIZES VARIABLES                                         03611002
036111*  - OPEN OFFERS-DATA-FILE AND THE STORE-GROUP-FILE IN INPUT MODE 03611102
036112*  - OPENS OFFER-FILE, OFFER-SECT-FILE, OFFER-BWP-FILE,           03611202
036113*    OFFER-MDSE-FILE, STORE-LIST-FILE IN OUTPUT MODE              03611302
036120*  - READ OFFERS DATA FILE AND CHECK IF IT IS EMPTY               03612002
036130*  - READ THE STORE GROUP FILE AND CHECK IF IT IS EMPTY           03613002
036140*  - PERFORM A CHECK AND ABEND IF ONE OF THE INPUT FILE HAS DATA  03614002
036150*    AND THE OTHER IS EMPTY.                                      03615002
036200****************************************************************  03620000
036300 1000-INITIALIZATION.                                             03630000
036500                                                                  03650000
036510     PERFORM 9000-GET-DB2-TIMESTAMP.                              03651000
036520                                                                  03652000
036600     DISPLAY '****************************************'.          03660000
036700     DISPLAY '**          EPKUT202 STARTED          **'.          03670000
036710     DISPLAY '**                                    **'.          03671000
036720     DISPLAY '**     '    PV-CURRENT-TMST     '     **'.          03672000
036800     DISPLAY '****************************************'.          03680000
036900                                                                  03690000
037000     INITIALIZE EP205-OFFER-EXTRACT,                              03700000
037100                EP206-STORE-LIST-RCD,                             03710000
037110                PV206-STORE-LIST-RCD,                             03711000
037200                EP201-OFFER-XST-OFR-RECORD,                       03720000
037300                EP202-OFFER-XST-OFR-SECT-RCD,                     03730000
037400                EP203-OFFER-XST-BWP-RECORD,                       03740000
037500                EP204-OFFER-XST-OFR-MDSE-SET.                     03750000
037600                                                                  03760000
037700     SET  PS-OFFERS-DATA-FILE-NOT-EMPTY     TO TRUE.              03770006
037800     SET  PS-STR-GRP-FILE-NOT-EMPTY         TO TRUE.              03780006
037900     SET  PS-OFR-HAS-NO-EXCL-STR-GRPS       TO TRUE.              03790006
038000     SET  PV-SLTR-NDX                       TO +1.                03800006
038100                                                                  03810000
038200     OPEN INPUT OFFERS-DATA-FILE                                  03820002
038300                OFFERS-STORE-GROUP-FILE.                          03830002
038301                                                                  03830102
038302     OPEN OUTPUT OFFER-FILE,                                      03830202
038303                 OFFER-SECTION-FILE,                              03830302
038304                 OFFER-BWP-FILE,                                  03830402
038305                 OFFER-MDSE-FILE,                                 03830502
038306                 STORE-LIST-FILE.                                 03830602
038307                                                                  03830702
038310     PERFORM 8400-READ-OFFERS-DATA-FILE.                          03831002
038320                                                                  03832002
038330     IF OFFERS-DATA-FILE-EOF                                      03833002
038340        DISPLAY '  NO OFFERS DATA TO PROCESS '                    03834002
038350     END-IF.                                                      03835002
039600                                                                  03960000
039610     PERFORM 8100-READ-STORE-GROUP-LIST.                          03961002
039611                                                                  03961102
039612     IF STORE-GROUP-FILE-EOF                                      03961202
039613        DISPLAY '  NO STORE GROUP DATA TO PROCESS '               03961302
039614     END-IF.                                                      03961402
039615                                                                  03961502
039620     IF ((OFFERS-DATA-FILE-EOF AND STORE-GROUP-FILE-NOT-EOF)      03962002
039621     OR (OFFERS-DATA-FILE-NOT-EOF AND STORE-GROUP-FILE-EOF))      03962102
039640         SET AC-4008-INVALID-EMPTY-INPUT TO TRUE                  03964002
039650         MOVE 'OUT OF THE OFFERS FILE AND STRGRP FILE'            03965002
039660                                             TO PV-OPERATION-MSG-103966002
039670             MOVE ' ONE IS EMPTY AND THE OTHER IS NOT '           03967002
039680                                             TO PV-OPERATION-MSG-203968002
039681             MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME      03968102
039690             PERFORM 9800-ABEND                                   03969002
039694     END-IF.                                                      03969402
039695                                                                  03969502
039696     IF STORE-GROUP-FILE-NOT-EOF                                  03969602
039697       PERFORM 6000-INITIALIZE-STRGRP-TABLES                      03969702
039698     END-IF.                                                      03969802
039699                                                                  03969902
039700     IF OFFERS-DATA-FILE-NOT-EOF                                  03970000
040600        MOVE EP205-FILE-TYPE TO PV-PROCESS-FILE-TYPE              04060002
040610        ADD 1 TO PV-OFFERS-DATA-RECS                              04061002
040700     END-IF.                                                      04070002
042100                                                                  04210000
042200*1000-EXIT.                                                       04220000
042300****************************************************************  04230000
042400* 1100-PROCESS-OFFERS-FILE.                                       04240000
042410*  DEPENDING ON THE EP205-TABLE-TYPE , THE RECORD READ IS WRITEN  04241006
042420*  TO THE FOLLOWING FOUR DIFFERENT FILES                          04242006
042430*    - TABLE-TYPE = O ====> WRITE TO OFFER-FILE                   04243006
042440*    - TABLE-TYPE = S ====> WRITE TO OFFER-SECTION-FILE           04244006
042450*    - TABLE-TYPE = B ====> WRITE TO OFFER-BWP-FILE               04245006
042460*    - TABLE-TYPE = M ====> WRITE TO OFFER-MDSE-FILE              04246006
042500****************************************************************  04250000
042600 1100-PROCESS-OFFERS-FILE.                                        04260000
042700                                                                  04270000
042800     EVALUATE EP205-TABLE-TYPE                                    04280000
042900         WHEN 'O'                                                 04290000
043000             PERFORM 2000-PROCESS-OFFERS-RECORD                   04300000
043100         WHEN 'S'                                                 04310000
043200             PERFORM 2010-PROCESS-SECTION-RECORD                  04320000
043300         WHEN 'B'                                                 04330000
043400             PERFORM 2020-PROCESS-BWP-RECORD                      04340000
043500         WHEN 'M'                                                 04350000
043600             PERFORM 2030-PROCESS-MDSE-RECORD                     04360000
043700         WHEN OTHER                                               04370000
043800             CONTINUE                                             04380000
043900     END-EVALUATE.                                                04390000
044000                                                                  04400000
044010     PERFORM 8400-READ-OFFERS-DATA-FILE.                          04401002
044020                                                                  04402002
045100*1100-EXIT.                                                       04510000
046600****************************************************************  04660000
046700* 1300-PROCESS-STORE-GROUP-FILE.                                  04670000
046800*   THIS PARAGRAPH CONTROLS THE UPDATE AND OUTPUT OF THE          04680000
046900*     MODIFIED STORE-LIST-FILE.                                   04690000
047000****************************************************************  04700000
047100 1300-PROCESS-STORE-GROUP-FILE.                                   04710000
047200                                                                  04720000
047300     EVALUATE TRUE                                                04730000
047310                                                                  04731006
047400         WHEN PV-PROCESS-FILE-FUL                                 04740000
047401                                                                  04740106
047410             MOVE PV206-STORE-LIST-RCD TO EP206-STORE-LIST-RCD    04741000
047500             PERFORM 8300-WRITE-STORE-GROUP-LIST                  04750000
047510                                                                  04751006
047600         WHEN PV-PROCESS-FILE-NEW                                 04760000
047700         WHEN PV-PROCESS-FILE-CHG                                 04770000
047710                                                                  04771006
047800             PERFORM 2400-NEW-CHG-PROCESS                         04780000
047900     END-EVALUATE.                                                04790000
048000                                                                  04800000
048100     PERFORM 8100-READ-STORE-GROUP-LIST.                          04810000
048101                                                                  04810102
048110*        (OUTPUT LAST RECORDS FOR LAST OFFER)                     04811002
048111                                                                  04811102
048112     IF STORE-GROUP-FILE-EOF                                      04811202
048120         PERFORM 3400-PROCESS-STR-GRPS-FOR-OFR                    04812002
048130     END-IF.                                                      04813002
048200                                                                  04820000
048300*1300-EXIT.                                                       04830000
050300****************************************************************  05030000
050400* 2000-PROCESS-OFFERS-RECORD.                                     05040000
050500*   THIS ROUTINE UPDATES THE OFFERS OUT FILE.                     05050000
050600****************************************************************  05060000
050700 2000-PROCESS-OFFERS-RECORD.                                      05070000
050800                                                                  05080000
050900     PERFORM 3000-BLD-OFFER-RECORD.                               05090000
051000     PERFORM 3010-WRT-OFFER-RECORD.                               05100000
051200                                                                  05120000
051300     ADD +1  TO PV-OFFER-OUT-COUNT.                               05130004
051500                                                                  05150000
051600*2000-EXIT.                                                       05160000
051900****************************************************************  05190000
052000* 2010-PROCESS-SECTION-RECORD.                                    05200000
052100*   THIS ROUTINE UPDATES THE OFFERS SECTION FILE.                 05210000
052200****************************************************************  05220000
052300 2010-PROCESS-SECTION-RECORD.                                     05230000
052400                                                                  05240000
052500     PERFORM 3030-BLD-OFFER-SECTION-RECORD.                       05250000
052600     PERFORM 3040-WRT-OFFER-SECTION-RECORD.                       05260000
052800                                                                  05280000
052900     ADD +1 TO PV-SECTION-OUT-COUNT.                              05290004
053100                                                                  05310000
053200*2010-EXIT.                                                       05320000
053500****************************************************************  05350000
053600* 2020-PROCESS-BWP-RECORD                                         05360000
053700*   THIS ROUTINE UPDATES THE OFFER BWP FILE.                      05370000
053800****************************************************************  05380000
053900 2020-PROCESS-BWP-RECORD.                                         05390000
054000                                                                  05400000
054100     PERFORM 3060-BLD-OFFER-BWP-RECORD.                           05410000
054200     PERFORM 3070-WRT-OFFER-BWP-RECORD.                           05420000
054400                                                                  05440000
054500     ADD +1  TO PV-BWP-OUT-COUNT.                                 05450004
054700                                                                  05470000
054800*2020-EXIT.                                                       05480000
055100****************************************************************  05510000
055200* 2030-PROCESS-MDSE-RECORD.                                       05520000
055300*   THIS ROUTINE UPDATES THE OFFERS MDSE RECORD.                  05530000
055400****************************************************************  05540000
055500 2030-PROCESS-MDSE-RECORD.                                        05550000
055600                                                                  05560000
055700     PERFORM 3090-BLD-OFFER-MDSE-RECORD.                          05570000
055800     PERFORM 3100-WRT-OFFER-MDSE-RECORD.                          05580000
056000                                                                  05600000
056100     ADD +1  TO PV-MDSE-OUT-COUNT.                                05610004
056300                                                                  05630000
056400*2030-EXIT.                                                       05640000
056500***************************************************************** 05650000
056600* 2400-NEW-CHG-PROCESS                                            05660000
056700*   THIS PARAGRAPH CONTROLS THE PROCESS OF TABLING AN OFFER'S     05670000
056800*     STORE-LIST-FILE ENTRIES, FINDING THE CORRECT PARENT STORE   05680000
056900*     GROUPS, AND THEN WRITING THEM OUT IN THE CORRECT ORDER      05690000
057000***************************************************************** 05700000
057100 2400-NEW-CHG-PROCESS.                                            05710000
057200                                                                  05720000
057300     EVALUATE TRUE                                                05730000
057301                                                                  05730104
057310        WHEN PV-HOLD-EVENT-ID = ZEROS                             05731000
057311         AND PV-HOLD-OFFER-ID = ZEROS                             05731100
057312                                                                  05731204
057313           SET PS-PAR-STR-GRP-NOT-SET TO TRUE                     05731311
057320           MOVE 0  TO  PV-PARENT-COUNT                            05732000
057330           MOVE ZEROS           TO PV-HLD-PRNT-STR-GP-TYP-LVL     05733000
057340           MOVE PV206-OFFER-KEY TO PV-SLTR-OFR-KEY(PV-SLTR-NDX)   05734000
057350                                   PV-HOLD-OFR-KEY                05735000
057360           MOVE PV206-STORE-LIST-RCD                              05736000
057370                          TO PV-STR-LIST-TBL-RCD(PV-SLTR-NDX)     05737000
057371                                                                  05737104
057380           IF  PV206-IE-IND = 'N'                                 05738000
057390               SET PS-OFR-HAS-EXCL-STR-GRPS TO TRUE               05739000
057391           ELSE                                                   05739100
057392               PERFORM 2500-SET-PARENT-STR-GRP                    05739211
057395               ADD 1 TO PV-PARENT-COUNT                           05739500
057396           END-IF                                                 05739600
057397                                                                  05739704
057398           SET  PV-SLTR-NDX       UP BY +1                        05739804
057399                                                                  05739904
057400        WHEN PV206-OFFER-KEY = PV-HOLD-OFR-KEY                    05740000
057500                                                                  05750004
057700           MOVE PV206-STORE-LIST-RCD TO                           05770000
057800                             PV-STR-LIST-TBL-RCD(PV-SLTR-NDX)     05780000
057810                                                                  05781004
057900           EVALUATE PV206-IE-IND                                  05790000
057901                                                                  05790104
057902              WHEN 'Y'                                            05790200
057903                 PERFORM 2500-SET-PARENT-STR-GRP                  05790311
057907                 ADD  1  TO  PV-PARENT-COUNT                      05790700
057908                                                                  05790804
057910              WHEN 'N'                                            05791000
057920                                                                  05792004
058000                 SET PS-OFR-HAS-EXCL-STR-GRPS TO TRUE             05800000
058001                 MOVE PV-HLD-PRNT-STR-GP-TYP-LVL                  05800100
058002                                TO PV-PARENT-STR-GP-TYP-LVL       05800200
058005                 PERFORM 3500-LOAD-EXCL-STR-LIST-TBL              05800500
058006                 ADD  1  TO  PV-EXCP-STR-GP-COUNT                 05800600
058007                                                                  05800704
058100           END-EVALUATE                                           05810000
058110                                                                  05811004
058200           SET  PV-SLTR-NDX       UP BY +1                        05820004
058300                                                                  05830004
058600*--- NEXT OFFER:                                                  05860004
058700        WHEN PV206-OFFER-KEY NOT EQUAL PV-HOLD-OFR-KEY            05870000
058710                                                                  05871004
058800*--- PROCESS THE PREVIOUS OFFER'S STORE GROUP LIST                05880004
058900           PERFORM 3400-PROCESS-STR-GRPS-FOR-OFR                  05890000
059000*--- NOW DEAL WITH THIS OFFER'S 1ST STORE GROUP RCD . . .         05900004
059001           SET PS-PAR-STR-GRP-NOT-SET TO TRUE                     05900114
059002           MOVE 0  TO  PV-PARENT-COUNT                            05900200
059010           MOVE ZEROS           TO PV-HLD-PRNT-STR-GP-TYP-LVL     05901000
059100           MOVE PV206-OFFER-KEY TO PV-SLTR-OFR-KEY(PV-SLTR-NDX)   05910000
059200                                   PV-HOLD-OFR-KEY                05920000
059300           MOVE PV206-STORE-LIST-RCD                              05930000
059400                          TO PV-STR-LIST-TBL-RCD(PV-SLTR-NDX)     05940000
059410                                                                  05941004
059500           IF  PV206-IE-IND = 'N'                                 05950000
059600               SET PS-OFR-HAS-EXCL-STR-GRPS TO TRUE               05960000
059601           ELSE                                                   05960100
059602               PERFORM 2500-SET-PARENT-STR-GRP                    05960215
059630               ADD 1 TO PV-PARENT-COUNT                           05963000
059700           END-IF                                                 05970000
059710                                                                  05971004
059800           SET  PV-SLTR-NDX       UP BY +1                        05980004
059900                                                                  05990004
060000     END-EVALUATE.                                                06000000
062200                                                                  06220000
062300*2400-EXIT.                                                       06230000
062310***************************************************************** 06231011
062320* 2500-SET-PARENT-STR-GRP                                         06232011
062330*   THIS PARAGRAPH WOULD SET THE PARENT STORE GROUP AND WOULD     06233011
062340*   DISPLAY ERROR MESSAGE IF AN OFFER HAS INCLUSION AT DIFFERENT  06234011
062341*   LEVELS. AN OFFER CAN BE INCLUDED AT THE FOLLOWING LEVELS      06234120
062342*   1000  : COPRPORATE         ** PARENT LEVEL                    06234211
062343*   4000  : AD VERSION         **  ,,                             06234311
062344*   7000  : MARKET CLUSTER     **  ,,                             06234411
062345*   2000  : METRO                                                 06234511
062346*   5000  : STORE LEVEL.                                          06234611
062350***************************************************************** 06235011
062360 2500-SET-PARENT-STR-GRP.                                         06236011
062370                                                                  06237011
062380     EVALUATE TRUE                                                06238011
062390                                                                  06239011
062391        WHEN PS-PAR-STR-GRP-NOT-SET  AND                          06239111
062392            PV206-STR-GRP-TYP-CDE = PC-STR-GP-TYP-CDE-5000        06239219
062394              CONTINUE                                            06239411
062395                                                                  06239511
062396        WHEN PS-PAR-STR-GRP-NOT-SET  AND                          06239611
062397            PV206-STR-GRP-TYP-CDE NOT = PC-STR-GP-TYP-CDE-5000    06239719
062399                                                                  06239911
062400            MOVE PV206-STR-GRP-TYP-CDE                            06240011
062401                             TO PV-HLD-PRNT-STR-GP-TYP-LVL        06240111
062402            SET PS-PAR-STR-GRP-SET TO TRUE                        06240211
062403                                                                  06240311
062404        WHEN PS-PAR-STR-GRP-SET AND                               06240411
062405            PV206-STR-GRP-TYP-CDE  = PV-HLD-PRNT-STR-GP-TYP-LVL   06240511
062407                                                                  06240711
062408            CONTINUE                                              06240811
062409                                                                  06240911
062410        WHEN PS-PAR-STR-GRP-SET                                   06241011
062411         AND ( PV206-STR-GRP-TYP-CDE  = PC-STR-GP-TYP-CDE-5000    06241119
062412            OR PV206-STR-GRP-TYP-CDE  = PC-STR-GP-TYP-CDE-2000)   06241219
062414                                                                  06241411
062415             CONTINUE                                             06241511
062416                                                                  06241611
062417        WHEN PS-PAR-STR-GRP-SET AND                               06241711
062418            PV-HLD-PRNT-STR-GP-TYP-LVL = PC-STR-GP-TYP-CDE-1000   06241819
062420                                                                  06242011
062421             CONTINUE                                             06242111
062422                                                                  06242211
062423        WHEN PS-PAR-STR-GRP-SET                                   06242311
062424         AND PV206-STR-GRP-TYP-CDE > PV-HLD-PRNT-STR-GP-TYP-LVL   06242411
062425         AND PV-HLD-PRNT-STR-GP-TYP-LVL NOT =                     06242519
062426                                          PC-STR-GP-TYP-CDE-1000  06242619
062428                                                                  06242811
062429            MOVE PV206-STR-GRP-TYP-CDE                            06242911
062430                             TO PV-HLD-PRNT-STR-GP-TYP-LVL        06243011
062431                                                                  06243111
062432        WHEN OTHER                                                06243211
062433                                                                  06243311
062434             DISPLAY '  OFFER NOT ASSIGNED TO CORRECT STR GRP '   06243411
062435             DISPLAY PV206-OFFER-ID                               06243512
062436                                                                  06243611
062437     END-EVALUATE.                                                06243711
062440                                                                  06244011
062500*2500-EXIT.                                                       06250011
065900***************************************************************** 06590000
066000* 3000-BLD-OFFER-RECORD.                                          06600000
066100*   THIS ROUTINE CONSTRUCTS THE OUPUT OFFER RECORD FROM           06610000
066200*   INPUT DATA.                                                   06620000
066300***************************************************************** 06630000
066400 3000-BLD-OFFER-RECORD.                                           06640000
066500                                                                  06650000
066600     INITIALIZE EP201-OFFER-XST-OFR-RECORD.                       06660000
066700                                                                  06670000
066800     MOVE EP205-TRIGGER-TYPE  TO EP201-TRIGGER-TYPE.              06680004
066900                                                                  06690004
067000     MOVE EP205-FILE-TYPE     TO EP201-FILE-TYPE.                 06700004
067100                                                                  06710004
067110     MOVE EP205-STR-NBR       TO EP201-STR-NBR.                   06711004
067120                                                                  06712004
067200     MOVE EP205-EVENT-ID      TO EP201-EVENT-ID.                  06720004
067300                                                                  06730004
067400     MOVE EP205-OFFER-ID      TO EP201-OFFER-ID.                  06740004
067500                                                                  06750004
067600     MOVE EP205-PROMO-SCHM-CDE TO EP201-PROMO-SCHM-CDE.           06760004
067700                                                                  06770004
067800     MOVE EP205-EVENT-TYP-CODE TO EP201-EVENT-TYP-CODE.           06780004
067900                                                                  06790004
068000     MOVE EP205-EVENT-NAME     TO EP201-EVENT-NAME.               06800004
068100                                                                  06810004
068200     MOVE EP205-OFFER-NAME     TO EP201-OFFER-NAME.               06820004
068300                                                                  06830004
068400     MOVE EP205-DISC-LEVEL-CODE TO EP201-DISC-LEVEL-CODE.         06840004
068500                                                                  06850004
068600     MOVE EP205-OFFER-USAGE-TYPE-CODE TO                          06860004
068700                                      EP201-OFFER-USAGE-TYPE-CODE.06870004
068710                                                                  06871004
068800     MOVE EP205-BARCODE-TYPE-CODE  TO EP201-BARCODE-TYPE-CODE.    06880004
068900                                                                  06890004
069000     MOVE EP205-UNEARN-IND     TO EP201-UNEARN-IND.               06900004
069100                                                                  06910004
069200     MOVE EP205-OFR-TRGR-TYP-CDE TO EP201-OFR-TRGR-TYP-CDE.       06920004
069300                                                                  06930004
069400     MOVE EP205-BWP-ITM-APPL-CDE TO EP201-BWP-ITM-APPL-CDE.       06940004
069600                                                                  06960000
069700*3000-EXIT.                                                       06970000
070000***************************************************************** 07000000
070100* 3010-WRT-OFFER-RECORD.                                          07010000
070200*   THIS PARAGRAPH WRITES THE UPDATED OFFER RECORD TO THE         07020000
070300*     OUTPUT FILE.                                                07030000
070400***************************************************************** 07040000
070500 3010-WRT-OFFER-RECORD.                                           07050000
070600                                                                  07060000
070700     WRITE OFFER-RECORD                                           07070000
070800       FROM EP201-OFFER-XST-OFR-RECORD.                           07080000
070900                                                                  07090000
071000*3010-EXIT.                                                       07100000
072800***************************************************************** 07280000
072900* 3030-BLD-OFFER-SECTION-RECORD.                                  07290000
073000*   THIS ROUTINE CONSTRUCTS THE OFFER SECTION RECORD FROM         07300000
073100*     THE INPUT EPK205 RECORD.                                    07310000
073200***************************************************************** 07320000
073300 3030-BLD-OFFER-SECTION-RECORD.                                   07330000
073400                                                                  07340000
073500     INITIALIZE EP202-OFFER-XST-OFR-SECT-RCD.                     07350000
073600                                                                  07360000
073700     MOVE EP205-TRIGGER-TYPE  TO EP202-TRIGGER-TYPE.              07370004
073900                                                                  07390000
074000     MOVE EP205-FILE-TYPE     TO EP202-FILE-TYPE.                 07400004
074100                                                                  07410004
074210     MOVE EP205-STR-NBR       TO EP202-STR-NBR.                   07421004
074230                                                                  07423000
074300     MOVE EP205-EVENT-ID      TO EP202-EVENT-ID.                  07430004
074500                                                                  07450000
074600     MOVE EP205-OFFER-ID      TO EP202-OFFER-ID.                  07460004
074800                                                                  07480000
074900     MOVE EP205-OFR-SECT-TYP-CDE TO EP202-OFR-SECT-TYP-CDE.       07490004
075100                                                                  07510000
075200     MOVE EP205-EFF-BEG-DTE    TO EP202-EFF-BEG-DTE.              07520004
075400                                                                  07540000
075500     MOVE EP205-EFF-END-DTE    TO EP202-EFF-END-DTE.              07550004
075600                                                                  07560004
075800     MOVE EP205-REDMN-SUPVR-OVRRID-DTE     TO                     07580004
075900                              EP202-REDMN-SUPVR-OVRRID-DTE.       07590004
076000                                                                  07600000
076100     MOVE EP205-BWP-GET-CNCTR-CDE TO EP202-BWP-GET-CNCTR-CDE.     07610004
076300                                                                  07630000
076400     MOVE EP205-BWP-BUY-CNCTR-CDE TO EP202-BWP-BUY-CNCTR-CDE.     07640004
076600                                                                  07660000
076700     MOVE EP205-CUSTFACG-SHRT-DESC TO EP202-CUSTFACG-SHRT-DESC.   07670004
076900                                                                  07690000
077000     MOVE EP205-POS-BTN-TXT   TO EP202-POS-BTN-TXT.               07700004
077200                                                                  07720000
077300     MOVE EP205-VLD-POS-TNDR-CMP-TYP-CDE   TO                     07730004
077400                                  EP202-VLD-POS-TNDR-CMP-TYP-CDE. 07740004
077500                                                                  07750000
077600     IF EP205-POS-BTN-RLTV-SEQ-NBR-X(1:1) = '~'                   07760000
077700         MOVE SPACES TO EP202-POS-BTN-RLTV-SEQ-NBR-X              07770004
077900         MOVE PC-NULL-VALUE  TO EP202-POS-BTN-RLTV-SEQ-NBR-X      07790004
078100     ELSE                                                         07810000
078200         MOVE EP205-POS-BTN-RLTV-SEQ-NBR TO                       07820004
078300                                     EP202-POS-BTN-RLTV-SEQ-NBR   07830004
078400     END-IF.                                                      07840000
078500                                                                  07850000
078600     IF EP205-LMT-PER-TRN-QTY-X(1:1) = '~'                        07860000
078700         MOVE SPACES   TO EP202-LMT-PER-TRN-QTY-X                 07870004
078900         MOVE PC-NULL-VALUE  TO EP202-LMT-PER-TRN-QTY-X           07890004
079100     ELSE                                                         07910000
079200         MOVE EP205-LMT-PER-TRN-QTY  TO EP202-LMT-PER-TRN-QTY     07920004
079400     END-IF.                                                      07940000
079500                                                                  07950000
079600*3030-EXIT.                                                       07960000
079900****************************************************************  07990000
080000* 3040-WRT-OFFER-SECTION-RECORD.                                  08000000
080100*   THIS ROUTINE WRITES THE UPDATED OFFER SECTION RECORD TO       08010000
080200*     THE OUTPUT FILE.                                            08020000
080300****************************************************************  08030000
080400 3040-WRT-OFFER-SECTION-RECORD.                                   08040000
080500                                                                  08050000
080600     WRITE OFFER-SECTION-RECORD                                   08060000
080700       FROM EP202-OFFER-XST-OFR-SECT-RCD.                         08070000
080800                                                                  08080000
080900*3040-EXIT.                                                       08090000
082500****************************************************************  08250000
082600* 3060-BLD-OFFER-BWP-RECORD.                                      08260000
082700*   THIS ROUTINE CONSTRUCTS THE OFFER BWP RECORD FROM             08270000
082800*     THE INPUT EPK205 RECORD.                                    08280000
082900****************************************************************  08290000
083000 3060-BLD-OFFER-BWP-RECORD.                                       08300000
083100                                                                  08310000
083200     INITIALIZE EP203-OFFER-XST-BWP-RECORD.                       08320000
083300                                                                  08330000
083400     MOVE EP205-TRIGGER-TYPE   TO EP203-TRIGGER-TYPE.             08340004
083500                                                                  08350004
083600     MOVE EP205-FILE-TYPE      TO EP203-FILE-TYPE.                08360004
083710                                                                  08371000
083720     MOVE EP205-STR-NBR        TO EP203-STR-NBR.                  08372004
083740                                                                  08374000
083800     MOVE EP205-EVENT-ID       TO EP203-EVENT-ID.                 08380004
083900                                                                  08390004
084000     MOVE EP205-OFFER-ID       TO EP203-OFFER-ID.                 08400004
084100                                                                  08410004
084200     MOVE EP205-OFR-SECT-TYP-CDE   TO EP203-OFR-SECT-TYP-CDE.     08420004
084300                                                                  08430004
084400     MOVE EP205-OFR-SECT-BWP-ID    TO EP203-OFR-SECT-BWP-ID.      08440004
084500                                                                  08450004
084700     IF EP205-TIER-LVL-NBR-X = '~'                                08470000
084800         MOVE SPACES    TO EP203-TIER-LVL-NBR-X                   08480004
085000         MOVE PC-NULL-VALUE   TO EP203-TIER-LVL-NBR-X             08500004
085200     ELSE                                                         08520000
085300         MOVE EP205-TIER-LVL-NBR   TO EP203-TIER-LVL-NBR          08530004
085500     END-IF.                                                      08550000
085510                                                                  08551004
085600     MOVE EP205-BWP-SELN-TYP-CDE   TO EP203-BWP-SELN-TYP-CDE.     08560004
085700                                                                  08570004
085800     IF EP205-BWP-BUY-QTY-X = '~'                                 08580000
085900         MOVE SPACES     TO EP203-BWP-BUY-QTY-X                   08590004
086100         MOVE PC-NULL-VALUE  TO EP203-BWP-BUY-QTY-X               08610004
086300     ELSE                                                         08630000
086400         MOVE EP205-BWP-BUY-QTY   TO EP203-BWP-BUY-QTY            08640004
086600     END-IF.                                                      08660000
086610                                                                  08661004
086700     IF EP205-BWP-BUY-AMT-X = '~'                                 08670000
086800         MOVE SPACES     TO EP203-BWP-BUY-AMT-X                   08680004
087000         MOVE PC-NULL-VALUE TO EP203-BWP-BUY-AMT-X                08700004
087200     ELSE                                                         08720000
087300         MOVE EP205-BWP-BUY-AMT  TO EP203-BWP-BUY-AMT             08730004
087500     END-IF.                                                      08750000
087510                                                                  08751004
087600     IF EP205-BWP-BUY-TOL-AMT-X = '~'                             08760000
087700         MOVE SPACES     TO EP203-BWP-BUY-TOL-AMT-X               08770004
087900         MOVE PC-NULL-VALUE   TO EP203-BWP-BUY-TOL-AMT-X          08790004
088100     ELSE                                                         08810000
088200         MOVE EP205-BWP-BUY-TOL-AMT   TO EP203-BWP-BUY-TOL-AMT    08820004
088400     END-IF.                                                      08840000
088410                                                                  08841004
088500     IF EP205-BWP-GET-QTY-X = '~'                                 08850000
088600         MOVE SPACES       TO EP203-BWP-GET-QTY-X                 08860004
088800         MOVE PC-NULL-VALUE  TO EP203-BWP-GET-QTY-X               08880004
089000     ELSE                                                         08900000
089100         MOVE EP205-BWP-GET-QTY  TO EP203-BWP-GET-QTY             08910004
089300     END-IF.                                                      08930000
089310                                                                  08931004
089400     IF EP205-BWP-GET-PCT-OFF-PCT-X = '~'                         08940000
089500         MOVE SPACES    TO EP203-BWP-GET-PCT-OFF-PCT-X            08950004
089700         MOVE PC-NULL-VALUE TO EP203-BWP-GET-PCT-OFF-PCT-X        08970004
089900     ELSE                                                         08990000
090000         MOVE EP205-BWP-GET-PCT-OFF-PCT  TO                       09000004
090100                                     EP203-BWP-GET-PCT-OFF-PCT    09010004
090200     END-IF.                                                      09020000
090210                                                                  09021004
090300     IF EP205-BWP-GET-DOL-OFF-AMT-X = '~'                         09030000
090400         MOVE SPACES   TO EP203-BWP-GET-DOL-OFF-AMT-X             09040004
090500                                                                  09050004
090600         MOVE PC-NULL-VALUE  TO EP203-BWP-GET-DOL-OFF-AMT-X       09060004
090800     ELSE                                                         09080000
090900         MOVE EP205-BWP-GET-DOL-OFF-AMT TO                        09090004
091000                                      EP203-BWP-GET-DOL-OFF-AMT   09100004
091100     END-IF.                                                      09110000
091110                                                                  09111004
091200     MOVE EP205-BWP-GET-PRPT-AMT  TO EP203-BWP-GET-PRPT-AMT.      09120004
091300                                                                  09130004
091400     IF EP205-BWP-GET-PRPT-AMT-X = '~'                            09140000
091500         MOVE SPACES        TO EP203-BWP-GET-PRPT-AMT-X           09150004
091700         MOVE PC-NULL-VALUE TO EP203-BWP-GET-PRPT-AMT-X           09170004
091900     ELSE                                                         09190000
092000         MOVE EP205-BWP-GET-PRPT-AMT   TO EP203-BWP-GET-PRPT-AMT  09200004
092200     END-IF.                                                      09220000
092300                                                                  09230000
092400*3060-EXIT.                                                       09240000
092500 EJECT.                                                           09250000
092600                                                                  09260000
092700****************************************************************  09270000
092800* 3070-WRT-OFFER-BWP-RECORD.                                      09280000
092900*   THIS ROUTINE WRITES THE UPDATED OFFER BWP RECORD TO           09290000
093000*     THE OUTPUT FILE.                                            09300000
093100****************************************************************  09310000
093200 3070-WRT-OFFER-BWP-RECORD.                                       09320000
093300                                                                  09330000
093400     WRITE OFFER-BWP-RECORD                                       09340000
093500       FROM EP203-OFFER-XST-BWP-RECORD.                           09350000
093600                                                                  09360000
093700*3070-EXIT.                                                       09370000
093800 EJECT.                                                           09380000
093900                                                                  09390000
095300****************************************************************  09530000
095400* 3090-BLD-OFFER-MDSE-RECORD.                                     09540000
095500*   THIS ROUTINE CONSTRUCTS THE OFFER MDSE RECORD FROM            09550000
095600*     THE INPUT EPRD205 RECORD.                                   09560000
095700****************************************************************  09570000
095800 3090-BLD-OFFER-MDSE-RECORD.                                      09580000
095900                                                                  09590000
096000     INITIALIZE EP204-OFFER-XST-OFR-MDSE-SET.                     09600000
096100                                                                  09610000
096200     MOVE EP205-TRIGGER-TYPE   TO EP204-TRIGGER-TYPE.             09620004
096300                                                                  09630004
096400     MOVE EP205-FILE-TYPE      TO EP204-FILE-TYPE.                09640004
096510                                                                  09651000
096520     MOVE EP205-STR-NBR        TO EP204-STR-NBR.                  09652004
096540                                                                  09654000
096600     MOVE EP205-EVENT-ID       TO EP204-EVENT-ID.                 09660004
096700                                                                  09670004
096800     MOVE EP205-OFFER-ID       TO EP204-OFFER-ID.                 09680004
096900                                                                  09690004
097000     MOVE EP205-OFR-SECT-TYP-CDE  TO EP204-OFR-SECT-TYP-CDE.      09700004
097100                                                                  09710004
097200     MOVE EP205-OFR-SECT-BWP-ID-M TO EP204-OFR-SECT-BWP-ID.       09720004
097300                                                                  09730004
097400     MOVE EP205-MDSE-SET-ID    TO EP204-MDSE-SET-ID.              09740004
097500                                                                  09750004
097600     MOVE EP205-MDSE-HIER-CDE  TO EP204-MDSE-HIER-CDE.            09760004
097700                                                                  09770004
097800     IF EP205-DEPT-NBR-X = '~'                                    09780000
097900         MOVE SPACES     TO EP204-DEPT-NBR-X                      09790004
098100         MOVE PC-NULL-VALUE   TO EP204-DEPT-NBR-X                 09810004
098300     ELSE                                                         09830000
098400         MOVE EP205-DEPT-NBR  TO EP204-DEPT-NBR                   09840004
098600     END-IF.                                                      09860000
098610                                                                  09861004
098700     IF EP205-MAJ-CL-NBR-X = '~'                                  09870000
098800         MOVE SPACES      TO EP204-MAJ-CL-NBR-X                   09880004
099000         MOVE PC-NULL-VALUE  TO EP204-MAJ-CL-NBR-X                09900004
099200     ELSE                                                         09920000
099300         MOVE EP205-MAJ-CL-NBR  TO EP204-MAJ-CL-NBR               09930004
099500     END-IF.                                                      09950000
099510                                                                  09951004
099600     IF EP205-SUB-CL-NBR-X = '~'                                  09960000
099700         MOVE SPACES        TO EP204-SUB-CL-NBR-X                 09970004
099900         MOVE PC-NULL-VALUE  TO EP204-SUB-CL-NBR-X                09990004
100100     ELSE                                                         10010000
100200         MOVE EP205-SUB-CL-NBR   TO EP204-SUB-CL-NBR              10020004
100400     END-IF.                                                      10040000
100410                                                                  10041004
100500     IF EP205-STYL-ID-X = '~'                                     10050000
100600         MOVE SPACES     TO EP204-STYL-ID-X                       10060004
100800         MOVE PC-NULL-VALUE   TO EP204-STYL-ID-X                  10080004
101000     ELSE                                                         10100000
101100         MOVE EP205-STYL-ID   TO EP204-STYL-ID                    10110004
101300     END-IF.                                                      10130000
101310                                                                  10131004
101400     MOVE EP205-SKU-NBR    TO EP204-SKU-NBR.                      10140004
101500                                                                  10150004
101600     IF EP205-SKU-NBR-X = '~'                                     10160000
101700         MOVE SPACES   TO EP204-SKU-NBR-X                         10170004
101900         MOVE PC-NULL-VALUE    TO EP204-SKU-NBR-X                 10190004
102100     ELSE                                                         10210000
102200         MOVE EP205-SKU-NBR    TO EP204-SKU-NBR                   10220004
102400     END-IF.                                                      10240000
102410                                                                  10241004
102500     MOVE EP205-IE-IND          TO EP204-IE-IND.                  10250004
102600                                                                  10260004
102700     MOVE EP205-EMP-DISC-CDE    TO EP204-EMP-DISC-CDE.            10270004
102800                                                                  10280004
102900     MOVE EP205-DISC-ELIG-IND   TO EP204-DISC-ELIG-IND.           10290004
103000                                                                  10300004
103100     MOVE EP205-TKT-CLOR-CDE    TO EP204-TKT-CLOR-CDE.            10310004
103200                                                                  10320004
103400*3090-EXIT.                                                       10340000
103500 EJECT.                                                           10350000
103600                                                                  10360000
103700****************************************************************  10370000
103800* 3100-WRT-OFFER-MDSE-RECORD.                                     10380000
103900*   THIS ROUTINE WRITES THE UPDATED OFFER MDSE RECORD TO          10390000
104000*     THE OUTPUT FILE.                                            10400000
104100****************************************************************  10410000
104200 3100-WRT-OFFER-MDSE-RECORD.                                      10420000
104300                                                                  10430000
104400     WRITE OFFER-MDSE-RECORD                                      10440000
104500       FROM EP204-OFFER-XST-OFR-MDSE-SET.                         10450000
104600                                                                  10460000
104700*3100-EXIT.                                                       10470000
104800 EJECT.                                                           10480000
104900                                                                  10490000
106300****************************************************************  10630000
106400*  3400-PROCESS-STR-GRPS-FOR-OFR.                              *  10640000
106500*  PROCESS THE STORE GROUP LIST TABLE TO OUTPUT RECORDS        *  10650000
106600****************************************************************  10660000
106700 3400-PROCESS-STR-GRPS-FOR-OFR.                                   10670000
106800                                                                  10680000
106900     IF  PS-OFR-HAS-EXCL-STR-GRPS                                 10690000
107000         PERFORM 4000-EXCL-STR-GRP-PROCESS                        10700000
107100     ELSE                                                         10710000
107200         PERFORM 4100-NO-EXCL-STR-GRPS-PROCESS                    10720000
107300     END-IF.                                                      10730000
107400                                                                  10740000
107500     SET PV-SLTR-NDX    TO +1.                                    10750006
107600     SET PS-OFR-HAS-NO-EXCL-STR-GRPS TO TRUE.                     10760000
107700                                                                  10770000
107800*3400-EXIT.                                                       10780000
107900***************************************************************** 10790000
108000* 3500-LOAD-EXCL-STR-LIST-TBL.                                    10800000
108100*   THIS ROUTINE CALLS THE SELECT QUERY, AND POPULATES THE        10810000
108200*   EXCLUSION STORE GRP TABLE                                     10820000
108300***************************************************************** 10830000
108400 3500-LOAD-EXCL-STR-LIST-TBL.                                     10840000
108500                                                                  10850000
108600     MOVE PV206-STR-GRP-TYP-CDE      TO PV-CHILD-STR-GP-TYP-CDE.  10860000
108700     MOVE PV206-STR-GRP-ID           TO PV-CHILD-STR-GP-ID.       10870000
108800     MOVE PV-HLD-PRNT-STR-GP-TYP-LVL TO PV-PARENT-STR-GP-TYP-LVL  10880000
108810                                        PV-PARENT-STR-GP-TYP-CDE. 10881000
108900                                                                  10890000
108906     IF  PV-PARENT-STR-GP-TYP-LVL = PC-STR-GP-TYP-CDE-1000        10890604
108907                                                                  10890704
108910         MOVE PV-CHILD-STR-GP-TYP-CDE                             10891000
108920           TO PV-ESLR-CHLD-STR-GP-TYP-CDE(PV-ESLR-INDEX)          10892000
108930         MOVE PV-CHILD-STR-GP-ID                                  10893000
108940           TO PV-ESLR-CHLD-STR-GP-ID(PV-ESLR-INDEX)               10894000
108950         MOVE PV-PARENT-STR-GP-TYP-CDE                            10895000
108960           TO PV-ESLR-PRNT-STR-GP-TYP-CDE(PV-ESLR-INDEX)          10896000
108970         MOVE 1                                                   10897000
108980           TO PV-PARENT-STR-GP-ID                                 10898000
108990              PV-ESLR-PRNT-STR-GP-ID(PV-ESLR-INDEX)               10899000
108991         SET PV-ESLR-INDEX UP BY +1                               10899104
108992                                                                  10899204
108993     ELSE                                                         10899300
108994                                                                  10899404
109000*--- GET ONE DISTINCT STR NBR IN THE CHILD STORE GROUP            10900006
109100         MOVE PV-CHILD-STR-GP-ID      TO XST00023-STR-GP-ID       10910000
109200         MOVE PV-CHILD-STR-GP-TYP-CDE TO XST00023-STR-GP-TYP-CDE  10920000
109400         PERFORM 4200-GET-A-STR-IN-GRP                            10940000
110110         PERFORM 4300-GET-PARENT-STORE-GROUP-ID                   11011000
110120                                                                  11012004
110130     END-IF.                                                      11013000
110140                                                                  11014000
114400*3500-EXIT.                                                       11440000
119500****************************************************************  11950000
119600*  4000-EXCL-STR-GRP-PROCESS.                                  *  11960000
119700*  WRITE OUT THE STORE GROUP LIST, FOR AN OFFER, IN THE PROPER *  11970000
119800*  ORDER. THIS PROCESS ASSOCIATES EXCEPTION STORE GROUPS WITH  *  11980000
119900*  THEIR PARENT STORE GROUPS.                                  *  11990000
120000*  THIS IS PERFORMED FOR OFFERS WITH EXCEPTION STORE GROUPS,   *  12000000
120100*  FOR NEW OR CHG FILES. FUL FILES SKIP THE EXCEPTION PROCESS. *  12010000
120200****************************************************************  12020000
120300 4000-EXCL-STR-GRP-PROCESS.                                       12030000
120400                                                                  12040000
120510     PERFORM                                                      12051000
120600       VARYING PV-SLTR-NDX FROM 1 BY 1                            12060000
120700         UNTIL PV-SLTR-NDX     > PC-SLTR-NDX-MAX                  12070006
120800          OR   PV-SLTR-EVENT-ID(PV-SLTR-NDX) = ZEROS              12080000
120900                                                                  12090000
121000         IF PV-SLTR-IE-IND(PV-SLTR-NDX) = 'Y'                     12100000
121002            MOVE PV-STR-LIST-TBL-RCD(PV-SLTR-NDX)                 12100200
121003              TO EP206-STORE-LIST-RCD                             12100300
121005            PERFORM 8300-WRITE-STORE-GROUP-LIST                   12100500
121006            MOVE PV-SLTR-STR-GRP-TYP-CDE(PV-SLTR-NDX)             12100600
121007              TO PV-HLD-PRNT-STR-GRP-TYP-CDE                      12100700
121008            MOVE PV-SLTR-STR-GRP-ID(PV-SLTR-NDX)                  12100800
121009              TO PV-HLD-PRNT-STR-GRP-ID                           12100900
121010            PERFORM 4400-FIND-CHILD-STR-GPS                       12101000
121011         ELSE                                                     12101100
121014            CONTINUE                                              12101400
121106         END-IF                                                   12110600
121200                                                                  12120000
121300     END-PERFORM.                                                 12130000
121410                                                                  12141000
121500     PERFORM 6000-INITIALIZE-STRGRP-TABLES.                       12150000
121600                                                                  12160000
121700*4000-EXIT.                                                       12170000
121800****************************************************************  12180000
121900*  4100-NO-EXCL-STR-GRPS-PROCESS.                              *  12190000
122000*  WRITE OUT THE STORE GROUP LIST, FOR AN OFFER, IN ORDER      *  12200000
122100*  THIS IS PERFORMED FOR OFFERS WITHOUT EXCEPTION STORE GPS,   *  12210000
122200*  FOR NEW OR CHG FILES. FUL FILES SKIP THE EXCEPTION PROCESS. *  12220000
122300****************************************************************  12230000
122400 4100-NO-EXCL-STR-GRPS-PROCESS.                                   12240000
122500                                                                  12250000
122501     SET PV-SLTR-NDX TO +1                                        12250106
122600        PERFORM                                                   12260000
122700          VARYING PV-SLTR-NDX FROM 1 BY 1                         12270000
122800            UNTIL PV-SLTR-NDX > PC-SLTR-NDX-MAX                   12280006
122900             OR PV-SLTR-EVENT-ID(PV-SLTR-NDX) = ZEROS             12290000
123000                                                                  12300000
123100                MOVE PV-STR-LIST-TBL-RCD(PV-SLTR-NDX)             12310000
123200                                TO EP206-STORE-LIST-RCD           12320000
123201                PERFORM 8300-WRITE-STORE-GROUP-LIST               12320100
123500        END-PERFORM                                               12350000
123600                                                                  12360000
123700     PERFORM 6000-INITIALIZE-STRGRP-TABLES.                       12370000
123800                                                                  12380000
123900*4100-EXIT.                                                       12390000
123901****************************************************************  12390100
123902*  4200-GET-A-STR-IN-GRP.                                      *  12390200
123903*  SELECT A DISTINCT STORE IN THE CHILD STORE GROUP (TYP/ID)   *  12390300
123904*  THIS WILL BE USED TO SELECT THE PARENT STORE GRP.           *  12390400
123906****************************************************************  12390600
123907 4200-GET-A-STR-IN-GRP.                                           12390700
123909                                                                  12390900
123910     PERFORM                                                      12391000
123911         WITH TEST AFTER                                          12391100
123912         VARYING PV-SQL-SUB                                       12391200
123913         FROM 1 BY 1                                              12391300
123914         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                12391400
123915                   OR  SQLCODE = 0 )                              12391500
123916                                                                  12391600
123919         EXEC SQL                                                 12391904
123920             SELECT                                               12392004
123921                 MIN(STR_NBR)                                     12392104
123922             INTO                                                 12392204
123923                 :XST00023-STR-NBR                                12392304
123924             FROM                                                 12392404
123925                 XST_STR_GP_MBSHP                                 12392504
123926             WHERE                                                12392604
123927                 STR_GP_ID = :XST00023-STR-GP-ID                  12392704
123928              AND                                                 12392804
123929                 STR_GP_TYP_CDE = :XST00023-STR-GP-TYP-CDE        12392904
123930              AND                                                 12393004
123931                 EFF_END_DTE IS NULL                              12393104
123932             WITH UR                                              12393204
123933         END-EXEC                                                 12393304
123934                                                                  12393404
123935         EVALUATE TRUE                                            12393500
123936             WHEN SQLCODE = -904                                  12393600
123937             WHEN SQLCODE = -911                                  12393700
123938             WHEN SQLCODE = -913                                  12393800
123939               CONTINUE                                           12393900
123940            WHEN SQLCODE = 0                                      12394000
123941               MOVE XST00023-STR-NBR                              12394100
123942                 TO PV-CHILD-STR-NBR                              12394200
123944            WHEN OTHER                                            12394400
123945               MOVE 'ERROR ON SELECT OF STR IN CHILD STR GRP'     12394500
123946                                TO PV-OPERATION-MSG-1             12394601
123947               MOVE '4200-GET-A-STR-IN-GRP     ' TO               12394704
123948                                        PV-PARAGRAPH-NAME         12394804
123949               PERFORM 9900-SQL-ABEND-ROUTINE                     12394900
123950         END-EVALUATE                                             12395000
123951     END-PERFORM.                                                 12395100
123952                                                                  12395200
123953     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        12395300
123954         MOVE 'SELECT RETRIES EXCEEDED' TO  PV-DB2-OPERATION      12395400
123955         MOVE '4200-GET-A-STR-IN-GRP     ' TO                     12395504
123956                                        PV-PARAGRAPH-NAME         12395604
123957         PERFORM 9900-SQL-ABEND-ROUTINE                           12395700
123958     END-IF.                                                      12395800
123959                                                                  12395900
123960*4200-EXIT.                                                       12396000
123961****************************************************************  12396100
123962*  4300-GET-PARENT-STORE-GROUP-ID.                             *  12396200
123963*  SELECT THE PARENT STORE GRP ID FOR THE EXCEPTION STR GRP.   *  12396300
123964****************************************************************  12396400
123965 4300-GET-PARENT-STORE-GROUP-ID.                                  12396500
123966                                                                  12396600
123967     MOVE PV-PARENT-STR-GP-TYP-LVL   TO XST00023-STR-GP-TYP-CDE.  12396700
123968                                                                  12396800
123969     PERFORM                                                      12396900
123970         WITH TEST AFTER                                          12397000
123971         VARYING PV-SQL-SUB                                       12397100
123972         FROM 1 BY 1                                              12397200
123973         UNTIL ( PV-SQL-SUB GREATER PC-MAX-RETRIES                12397300
123974                   OR  SQLCODE = 0 )                              12397400
123975                                                                  12397500
123977         EXEC SQL                                                 12397704
123978            SELECT DISTINCT                                       12397805
123979                STR_GP_ID                                         12397905
123980               ,STR_GP_TYP_CDE                                    12398005
123981                                                                  12398104
123982            INTO                                                  12398205
123983               :XST00023-STR-GP-ID                                12398305
123984              ,:XST00023-STR-GP-TYP-CDE                           12398405
123985               FROM                                               12398505
123986                 XST_STR_GP_MBSHP XSGM                            12398605
123987               WHERE                                              12398705
123988                   XSGM.STR_GP_TYP_CDE = :XST00023-STR-GP-TYP-CDE 12398805
123989                 AND                                              12398905
123990                   XSGM.STR_NBR = :XST00023-STR-NBR               12399005
123991                 AND                                              12399105
123992                   XSGM.EFF_END_DTE IS NULL                       12399205
123993           WITH UR                                                12399305
123994         END-EXEC                                                 12399404
123996                                                                  12399600
123997         EVALUATE TRUE                                            12399700
123998             WHEN SQLCODE = -904                                  12399800
123999             WHEN SQLCODE = -911                                  12399900
124000             WHEN SQLCODE = -913                                  12400000
124001               CONTINUE                                           12400100
124002            WHEN SQLCODE = 0                                      12400200
124003               MOVE PV-CHILD-STR-GP-TYP-CDE                       12400300
124004                 TO PV-ESLR-CHLD-STR-GP-TYP-CDE(PV-ESLR-INDEX)    12400400
124005               MOVE PV-CHILD-STR-GP-ID                            12400500
124006                 TO PV-ESLR-CHLD-STR-GP-ID(PV-ESLR-INDEX)         12400600
124007               MOVE PV-PARENT-STR-GP-TYP-CDE                      12400700
124008                 TO PV-ESLR-PRNT-STR-GP-TYP-CDE(PV-ESLR-INDEX)    12400800
124009               MOVE XST00023-STR-GP-ID                            12400900
124010                 TO PV-PARENT-STR-GP-ID                           12401000
124011                    PV-ESLR-PRNT-STR-GP-ID(PV-ESLR-INDEX)         12401100
124014               SET PV-ESLR-INDEX UP BY 1                          12401417
124015               ADD 1 TO PV-EXCP-STR-GP-PRNT-FND-CNT               12401517
124016            WHEN OTHER                                            12401617
124017               MOVE 'ERROR ON SELECT OF STR GRP PARENT'           12401717
124018                                TO PV-DB2-OPERATION               12401817
124019               MOVE '4300-GET-PARENT-STORE-GROUP-ID' TO           12401917
124020                                        PV-PARAGRAPH-NAME         12402017
124021               PERFORM 9900-SQL-ABEND-ROUTINE                     12402117
124022         END-EVALUATE                                             12402217
124023     END-PERFORM.                                                 12402317
124024                                                                  12402417
124025     IF  PV-SQL-SUB GREATER PC-MAX-RETRIES                        12402517
124026         MOVE 'SELECT RETRIES EXCEEDED' TO  PV-DB2-OPERATION      12402617
124027         MOVE '4300-GET-PARENT-STORE-GROUP-ID' TO                 12402717
124028                                            PV-PARAGRAPH-NAME     12402817
124029         PERFORM 9900-SQL-ABEND-ROUTINE                           12402917
124030     END-IF.                                                      12403017
124031                                                                  12403117
124032*4300-EXIT.                                                       12403217
124033******************************************************************12403317
124034*  4400-FIND-CHILD-STR-GPS.                                      *12403417
124035*  FIND THE PARENT STR GP'S CHILD STR GRPS TABLED FOR THE OFFER. *12403517
124036******************************************************************12403617
124037 4400-FIND-CHILD-STR-GPS.                                         12403717
124038                                                                  12403817
124039     PERFORM                                                      12403917
124040       VARYING PV-ESLR-INDEX FROM 1 BY 1                          12404017
124041         UNTIL PV-ESLR-INDEX   > PC-ESLR-IDX-MAX                  12404117
124042          OR   PV-ESLR-CHLD-STR-GP-TYP-CDE(PV-ESLR-INDEX) = ZEROS 12404217
124043*                                                                 12404317
124044          EVALUATE TRUE                                           12404417
124045                                                                  12404517
124046             WHEN PV-ESLR-PRNT-STR-GP-TYP-CDE(PV-ESLR-INDEX)      12404617
124047                = PV-HLD-PRNT-STR-GRP-TYP-CDE                     12404717
124048              AND PV-ESLR-PRNT-STR-GP-ID(PV-ESLR-INDEX)           12404817
124049                = PV-HLD-PRNT-STR-GRP-ID                          12404917
124050                                                                  12405017
124051                MOVE PV-ESLR-CHLD-STR-GP-TYP-CDE(PV-ESLR-INDEX)   12405117
124052                  TO PV-HLD-CHLD-STR-GRP-TYP-CDE                  12405217
124053                MOVE PV-ESLR-CHLD-STR-GP-ID(PV-ESLR-INDEX)        12405317
124054                  TO PV-HLD-CHLD-STR-GRP-ID                       12405417
124055                PERFORM 4500-FIND-CHILD-STR-GP-LST-RCD            12405517
124056                                                                  12405617
124057             WHEN OTHER                                           12405717
124061                CONTINUE                                          12406118
124062                                                                  12406218
124063          END-EVALUATE                                            12406318
124064                                                                  12406418
124065     END-PERFORM.                                                 12406518
124066                                                                  12406618
124067*4400-EXIT.                                                       12406718
124068******************************************************************12406818
124069*  4500-FIND-CHILD-STR-GP-LST-RCD.                               *12406918
124070*  FIND THE PARENT STR GP'S CHILD STR GRPS TABLED FOR THE OFFER. *12407018
124071******************************************************************12407118
124072 4500-FIND-CHILD-STR-GP-LST-RCD.                                  12407218
124073                                                                  12407318
124074     PERFORM                                                      12407418
124075       VARYING PV-SLTR-NDX2 FROM 1 BY 1                           12407518
124076         UNTIL PV-SLTR-NDX2    > PC-SLTR-NDX-MAX                  12407618
124077          OR   PV-SLTR-EVENT-ID(PV-SLTR-NDX2) = ZEROS             12407718
124078                                                                  12407818
124079          EVALUATE TRUE                                           12407918
124080                                                                  12408018
124081             WHEN PV-SLTR-STR-GRP-TYP-CDE(PV-SLTR-NDX2)           12408118
124082                = PV-HLD-CHLD-STR-GRP-TYP-CDE                     12408218
124083              AND PV-SLTR-STR-GRP-ID(PV-SLTR-NDX2)                12408318
124084                = PV-HLD-CHLD-STR-GRP-ID                          12408418
124085                                                                  12408518
124086                 MOVE PV-STR-LIST-TBL-RCD(PV-SLTR-NDX2)           12408618
124087                   TO EP206-STORE-LIST-RCD                        12408718
124088                                                                  12408818
124089                 IF EP206-STR-GRP-TYP-CDE = PC-STR-GP-TYP-CDE-500012408918
124090                    MOVE EP206-STR-GRP-ID                         12409018
124091                      TO EP206-STORE-NUMBER                       12409118
124092                    PERFORM 8300-WRITE-STORE-GROUP-LIST           12409218
124093                 ELSE                                             12409318
124094                    PERFORM 5000-EXTENDED-STORE-LIST              12409418
124095                 END-IF                                           12409518
124096                                                                  12409618
124097             WHEN OTHER                                           12409718
124098                 CONTINUE                                         12409818
124099          END-EVALUATE                                            12409918
124100     END-PERFORM.                                                 12410000
124101                                                                  12410100
124102*4500-EXIT.                                                       12410200
124103****************************************************************  12410300
124104* 5000-EXTENDED-STORE-LIST.                                       12410400
124105*   THIS PARAGRAPH CONTROLS THE PROCESSING FOR AN IE-IND ='N'     12410500
124106*     STORE LIST.                                                 12410600
124107****************************************************************  12410700
124108 5000-EXTENDED-STORE-LIST.                                        12410800
124109                                                                  12410900
124110     MOVE EP206-STR-GRP-TYP-CDE TO XST00023-STR-GP-TYP-CDE.       12411004
124111                                                                  12411104
124112     MOVE EP206-STR-GRP-ID      TO XST00023-STR-GP-ID.            12411204
124114                                                                  12411400
124115     PERFORM 7300-OPEN-OFFER-STORES-CURSOR.                       12411500
124116                                                                  12411604
124117     PERFORM 7350-FETCH-OFFER-STORES                              12411700
124118       UNTIL PS-OFFER-STORES-CSR-EOF.                             12411800
124119                                                                  12411904
124120     PERFORM 7400-CLOSE-OFFER-STORES.                             12412000
124121                                                                  12412100
124122*5000-EXIT.                                                       12412200
124123****************************************************************  12412300
124130*  6000-INITIALIZE-STRGRP-TABLES.                              *  12413000
124200*  INITIALIZE THE STORE GROUP LIST TABLE AND                   *  12420000
124300*  THE EXCEPTION STORE GROUP PARENT XREF TABLE.                *  12430000
124400****************************************************************  12440000
124500 6000-INITIALIZE-STRGRP-TABLES.                                   12450000
124600                                                                  12460000
126210     INITIALIZE PV-STORE-LIST-TBL.                                12621008
126220                                                                  12622007
126300     SET PV-SLTR-NDX         TO +1.                               12630004
126400                                                                  12640000
127510     INITIALIZE PV-PARENT-CHLD-STR-GRP-TBL.                       12751007
127520                                                                  12752007
127600     SET PV-ESLR-INDEX       TO +1.                               12760004
127700                                                                  12770000
127800*6000-EXIT.                                                       12780000
132691****************************************************************  13269100
132692* 7300-OPEN-OFFER-STORES-CURSOR.                                  13269200
132693****************************************************************  13269300
132694 7300-OPEN-OFFER-STORES-CURSOR.                                   13269400
132695                                                                  13269500
132696     PERFORM                                                      13269600
132697       WITH TEST AFTER                                            13269700
132698         VARYING PV-SQL-SUB                                       13269800
132699           FROM 1 BY 1                                            13269900
132700             UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES             13270000
132701                       OR SQLCODE = 0)                            13270100
132702                                                                  13270200
132703         EXEC SQL                                                 13270300
132704             OPEN OFFER_STORES                                    13270400
132705         END-EXEC                                                 13270500
132706                                                                  13270600
132707         EVALUATE TRUE                                            13270700
132708             WHEN SQLCODE = -904                                  13270800
132709             WHEN SQLCODE = -911                                  13270900
132710             WHEN SQLCODE = -913                                  13271000
132711                 CONTINUE                                         13271100
132712             WHEN SQLCODE = 0                                     13271200
132713                 SET PS-OFFER-STORES-CSR-NOT-EOF                  13271300
132714                   TO TRUE                                        13271400
132715             WHEN OTHER                                           13271500
132716                 MOVE '7300-OPEN-OFFER-STORES-CURSOR'             13271600
132717                   TO PV-PARAGRAPH-NAME                           13271700
132718                 MOVE 'ERROR ON OPEN OF OFFER-SORES CURSOR'       13271800
132719                   TO PV-DB2-OPERATION                            13271900
132720                 PERFORM 9900-SQL-ABEND-ROUTINE                   13272000
132721         END-EVALUATE                                             13272100
132722     END-PERFORM.                                                 13272200
132723                                                                  13272300
132724     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13272400
132725         MOVE '7300-OPEN-OFFER-STORES-CURSOR'                     13272500
132726           TO PV-PARAGRAPH-NAME                                   13272600
132727         MOVE 'OPEN RETRIES EXCEEDED'                             13272700
132728           TO PV-DB2-OPERATION                                    13272800
132729         PERFORM 9900-SQL-ABEND-ROUTINE                           13272900
132730     END-IF.                                                      13273000
132731                                                                  13273100
132732*7300-EXIT.                                                       13273200
132735****************************************************************  13273500
132736* 7350-FETCH-OFFER-STORES.                                        13273600
132737****************************************************************  13273700
132738 7350-FETCH-OFFER-STORES.                                         13273800
132739                                                                  13273900
132740     PERFORM                                                      13274000
132741       WITH TEST AFTER                                            13274100
132742         VARYING PV-SQL-SUB                                       13274200
132743           FROM 1 BY 1                                            13274300
132744             UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES             13274400
132745                       OR SQLCODE = +0                            13274500
132746                       OR SQLCODE = +100)                         13274600
132747         EXEC SQL                                                 13274700
132748             FETCH OFFER_STORES                                   13274800
132749               INTO :XST00023-STR-NBR                             13274900
132750         END-EXEC                                                 13275000
132751                                                                  13275100
132752         EVALUATE TRUE                                            13275200
132753             WHEN SQLCODE = -904                                  13275300
132754             WHEN SQLCODE = -911                                  13275400
132755             WHEN SQLCODE = -913                                  13275500
132756                 CONTINUE                                         13275600
132757             WHEN SQLCODE = +0                                    13275700
132758                 PERFORM 8200-WRITE-STORE-LIST                    13275800
132759             WHEN SQLCODE = +100                                  13275900
132760                 SET PS-OFFER-STORES-CSR-EOF                      13276000
132761                   TO TRUE                                        13276100
132762             WHEN OTHER                                           13276200
132763                 MOVE '7350-FETCH-OFFER-STORES'                   13276300
132764                   TO PV-PARAGRAPH-NAME                           13276400
132765                 MOVE 'ERROR ON FETCHING OFFER STORES CURSOR'     13276500
132766                   TO PV-DB2-OPERATION                            13276600
132767                 PERFORM 9900-SQL-ABEND-ROUTINE                   13276700
132768         END-EVALUATE                                             13276800
132769     END-PERFORM.                                                 13276900
132770     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13277000
132771         MOVE '7350-FETCH-OFFER-STORES'                           13277100
132772           TO PV-PARAGRAPH-NAME                                   13277200
132773         MOVE 'FETCH RETRIES EXCEEDED'                            13277300
132774           TO PV-DB2-OPERATION                                    13277400
132775         PERFORM 9900-SQL-ABEND-ROUTINE                           13277500
132776     END-IF.                                                      13277600
132777                                                                  13277700
132778*7350-EXIT.                                                       13277800
132781****************************************************************  13278100
132782* 7400-CLOSE-OFFER-STORES.                                        13278200
132783****************************************************************  13278300
132784 7400-CLOSE-OFFER-STORES.                                         13278400
132785                                                                  13278500
132786     PERFORM                                                      13278600
132787       WITH TEST AFTER                                            13278700
132788         VARYING PV-SQL-SUB                                       13278800
132789           FROM 1 BY 1                                            13278900
132790             UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES             13279000
132791                       OR SQLCODE = 0)                            13279100
132792                                                                  13279200
132793         EXEC SQL                                                 13279300
132794             CLOSE OFFER_STORES                                   13279400
132795         END-EXEC                                                 13279500
132796                                                                  13279600
132797         EVALUATE TRUE                                            13279700
132798             WHEN SQLCODE = -904                                  13279800
132799             WHEN SQLCODE = -911                                  13279900
132800             WHEN SQLCODE = -913                                  13280000
132801             WHEN SQLCODE = 0                                     13280100
132802                 CONTINUE                                         13280200
132803             WHEN OTHER                                           13280300
132804                 MOVE '7400-CLOSE-OFFER-STORES'                   13280400
132805                   TO PV-PARAGRAPH-NAME                           13280500
132806                 MOVE 'ERROR ON CLOSE OF OFFER STORES'            13280600
132807                   TO PV-DB2-OPERATION                            13280700
132808                 PERFORM 9900-SQL-ABEND-ROUTINE                   13280800
132809         END-EVALUATE                                             13280900
132810     END-PERFORM.                                                 13281000
132811                                                                  13281100
132812     IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         13281200
132813         MOVE '7400-CLOSE-OFFER-STORES'                           13281300
132814           TO PV-PARAGRAPH-NAME                                   13281400
132815         MOVE 'CLOSE RETRIES EXCEEDED'                            13281500
132816           TO PV-DB2-OPERATION                                    13281600
132817         PERFORM 9900-SQL-ABEND-ROUTINE                           13281700
132818     END-IF.                                                      13281800
132819                                                                  13281900
132820*7400-EXIT.                                                       13282000
134200***************************************************************** 13420000
134300* 8100-READ-STORE-GROUP-LIST.                                     13430000
134400***************************************************************** 13440000
134500 8100-READ-STORE-GROUP-LIST.                                      13450000
134600                                                                  13460000
134700     READ OFFERS-STORE-GROUP-FILE                                 13470000
134800       INTO PV206-STORE-LIST-RCD                                  13480000
134900         AT END                                                   13490000
135000             SET STORE-GROUP-FILE-EOF                             13500000
135100               TO TRUE                                            13510000
135200         NOT AT END                                               13520000
135300             ADD 1                                                13530000
135400               TO PV-OFFERS-STORE-GROUP-RECS                      13540000
135500     END-READ.                                                    13550000
135600                                                                  13560000
135700*8100-EXIT.                                                       13570000
135710***************************************************************** 13571000
135720* 8200-WRITE-STORE-LIST.                                          13572000
135721*   THIS PARAGRAPH IS PERFORMED FOR EXCEPTION STORE LISTS         13572100
135730***************************************************************** 13573000
135740 8200-WRITE-STORE-LIST.                                           13574000
135750                                                                  13575000
135760     MOVE XST00023-STR-NBR                                        13576000
135770       TO EP206-STORE-NUMBER.                                     13577000
135793                                                                  13579300
135794     PERFORM 8300-WRITE-STORE-GROUP-LIST.                         13579400
135795                                                                  13579500
135796*8200-EXIT.                                                       13579600
135800***************************************************************** 13580000
135900* 8300-WRITE-STORE-GROUP-LIST.                                    13590000
136000***************************************************************** 13600000
136100 8300-WRITE-STORE-GROUP-LIST.                                     13610000
136200                                                                  13620000
136210     WRITE STORE-LIST-RECORD FROM EP206-STORE-LIST-RCD.           13621000
136220                                                                  13622000
136230     ADD 1 TO PV-STORE-LIST-OUT-COUNT.                            13623000
136240                                                                  13624000
137300*8300-EXIT.                                                       13730000
137301***************************************************************** 13730102
137302* 8400-READ-OFFERS-DATA-FILE.                                     13730202
137303***************************************************************** 13730302
137304 8400-READ-OFFERS-DATA-FILE.                                      13730402
137305                                                                  13730502
137306     READ OFFERS-DATA-FILE                                        13730602
137307       INTO EP205-OFFER-EXTRACT                                   13730702
137308         AT END                                                   13730802
137309             SET OFFERS-DATA-FILE-EOF                             13730902
137310               TO TRUE                                            13731002
137311         NOT AT END                                               13731102
137312             ADD 1                                                13731202
137313               TO PV-OFFERS-DATA-RECS                             13731302
137314     END-READ.                                                    13731402
137315                                                                  13731502
137316*8400-EXIT.                                                       13731602
137317***************************************************************** 13731700
137320* 9000-GET-DB2-TIMESTAMP.                                         13732000
137330*     THIS PARAGRAPH GETS THE DB2 TIMESTAMP WHICH WILL BE         13733000
137340*     USED TO UPDATE THE FILE-DIST-DATE AND THE CRT-TIMESTAMP     13734000
137350*     ON THE HEADER RECORD.                                       13735000
137360***************************************************************** 13736000
137370 9000-GET-DB2-TIMESTAMP.                                          13737000
137380                                                                  13738000
137390     EXEC SQL                                                     13739000
137391          SELECT CURRENT TIMESTAMP                                13739100
137392          INTO  :PV-TIMESTAMP                                     13739200
137393          FROM   SYSIBM.SYSDUMMY1                                 13739300
137394     END-EXEC.                                                    13739400
137395                                                                  13739500
137396     IF SQLCODE NOT EQUAL ZERO                                    13739600
137397        MOVE '9000-GET-DB2-TIMESTAMP' TO PV-PARAGRAPH-NAME        13739700
137398        MOVE 'CANNOT GET CURRENT TIMESTAMP'                       13739800
137399                                    TO PV-DB2-OPERATION           13739900
137400        PERFORM 9900-SQL-ABEND-ROUTINE                            13740000
137401     END-IF.                                                      13740100
137402                                                                  13740200
137425*9000-EXIT.                                                       13742500
137430******************************************************************13743000
137500* 9800-ABEND.                                                    *13750000
137600*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                 *13760000
137700******************************************************************13770000
137800 9800-ABEND.                                                      13780000
137900                                                                  13790000
138300     DISPLAY '** ABEND           **'.                             13830000
138400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          13840000
138500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        13850000
138600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       13860000
138700     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       13870000
138900                                                                  13890000
139000     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         13900000
139100                                                                  13910000
139200*9800-EXIT.                                                       13920000
139300***************************************************************** 13930000
139400* 9900-SQL-ABEND-ROUTINE.                                         13940000
139500*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE        13950000
139600*     OCCURS.                                                     13960000
139700***************************************************************** 13970000
139800 9900-SQL-ABEND-ROUTINE.                                          13980000
139900                                                                  13990000
140000     SET AC-4013-DB2-ERROR TO TRUE.                               14000000
140100                                                                  14010000
140200     DISPLAY '** ABEND     **'.                                   14020000
140300     DISPLAY '** PROGRAM   **' PC-PROGRAM-NAME.                   14030000
140400     DISPLAY '** PARAGRAPH **' PV-PARAGRAPH-NAME.                 14040000
140500     DISPLAY '** OPERATION **' PV-DB2-OPERATION.                  14050000
140600                                                                  14060000
140700     COPY DPPD004.                                                14070000
140800     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         14080000
140900                                                                  14090000
141000*9900-EXIT.                                                       14100000
141210***************************************************************** 14121000
141400* 9999-WRAPUP.                                                    14140000
141410***************************************************************** 14141000
141600 9999-WRAPUP.                                                     14160000
141700                                                                  14170000
141710     CLOSE OFFERS-STORE-GROUP-FILE                                14171002
141711           STORE-LIST-FILE                                        14171102
141713           OFFERS-DATA-FILE                                       14171302
141720           OFFER-FILE                                             14172002
141730           OFFER-SECTION-FILE                                     14173002
141740           OFFER-BWP-FILE                                         14174002
141750           OFFER-MDSE-FILE.                                       14175002
141760                                                                  14176002
141800     DISPLAY ' '.                                                 14180000
141900     DISPLAY '*********************************************'.     14190000
142000     DISPLAY 'PROGRAM NAME: ' PC-PROGRAM-NAME.                    14200000
142100     DISPLAY '*********************************************'.     14210000
142200     DISPLAY ' '.                                                 14220000
142300     DISPLAY 'NUMBER OF OFFERS RECORDS READ: '                    14230000
142400              PV-OFFERS-DATA-RECS.                                14240000
142500     DISPLAY ' '.                                                 14250000
142600     DISPLAY 'NUMBER OF STORE GROUP RECORDS READ: '               14260000
142700              PV-OFFERS-STORE-GROUP-RECS.                         14270000
142800     DISPLAY ' '.                                                 14280000
142900     DISPLAY 'NUMBER OF OFFER RCDS WRITTEN: ' PV-OFFER-OUT-COUNT. 14290000
143000     DISPLAY ' '.                                                 14300000
143100     DISPLAY 'NUMBER OF SECTION RCDS WRITTEN: '                   14310000
143200              PV-SECTION-OUT-COUNT.                               14320000
143300     DISPLAY ' '.                                                 14330000
143400     DISPLAY 'NUMBER OF BWP RECORDS WRITTEN: '                    14340000
143500              PV-BWP-OUT-COUNT.                                   14350000
143600     DISPLAY ' '.                                                 14360000
143700     DISPLAY 'NUMBER OF MERCHANDISE RCDS WRITTEN: '               14370000
143800              PV-MDSE-OUT-COUNT.                                  14380000
143900     DISPLAY ' '.                                                 14390000
144000     DISPLAY 'NUMBER OF STORE RECORDS WRITTEN: '                  14400000
144100              PV-STORE-LIST-OUT-COUNT.                            14410000
144200     DISPLAY '*********************************************'.     14420000
144300                                                                  14430000
144400*9999-EXIT.                                                       14440000
144900*********************  END OF PROGRAM  ***************************14490000
