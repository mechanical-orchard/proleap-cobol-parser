000100 IDENTIFICATION DIVISION.                                         11/02/93
000200 PROGRAM-ID.    CNKCS206.                                         CNKCS206
000300 AUTHOR.        TOM RUSKA. G&R.                                      LV001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          CNKCS206
000500 DATE-WRITTEN.  05-14-93.                                         CNKCS206
000600 DATE-COMPILED.                                                   CNKCS206
000700                                                                  CNKCS206
000800*---------------------------------------------------------------* CNKCS206
000900*    TRANID      - Y206                                         * CNKCS206
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * CNKCS206
001100*    DESCRIPTION - MAINTAIN FACILITY LOCATION                   * CNKCS206
001200*    MAPSET      - CNKM206                                      * CNKCS206
001300*                                                               * CNKCS206
001400*    THIS PROGRAM WILL ADD, UPDATE OR DELETE A FACILITY         * CNKCS206
001500*    LOCATION.                                                  * CNKCS206
001600*                                                               * CNKCS206
001700*---------------------------------------------------------------* CNKCS206
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961                 
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL                
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.               
CICS  *-----------------------------------------------------------------        
001800                                                                  CNKCS206
001900 ENVIRONMENT DIVISION.                                            CNKCS206
002000 DATA DIVISION.                                                   CNKCS206
002100                                                                  CNKCS206
002200/                                                                 CNKCS206
002300 WORKING-STORAGE SECTION.                                         CNKCS206
002400                                                                  CNKCS206
002500 01  DK-DB2-KEYS.                                                 CNKCS206
002600     05  DK-OPER-UNT-ID                 PIC S9(04) COMP.             CL**3
002700     05  DK-FCLTY-ID                    PIC S9(04) COMP.             CL**3
002800     05  DK-AREA-ID                     PIC  X(06).                  CL**3
002900     05  DK-SUBAREA-OF-ID               PIC  X(06).               CNKCS206
003000     05  DK-AREA-ID-LOW                 PIC  X(06).                  CL**3
003100     05  DK-AREA-ID-HIGH                PIC  X(06).                  CL**3
003200     05  DK-TYPE-LOW                    PIC  X(02).               CNKCS206
003300     05  DK-TYPE-HIGH                   PIC  X(02).               CNKCS206
003400                                                                  CNKCS206
003500 01  DN-DB2-NULL-INDICATORS.                                      CNKCS206
003600     05  DN-SUBAREA-OP-UNT-ID           PIC S9(04) VALUE +0          CL**7
003700                                                    COMP.         CNKCS206
003800     05  DN-SUBAREA-FCLTY-ID            PIC S9(04) VALUE +0          CL**3
003900                                                    COMP.         CNKCS206
004000     05  DN-SUBAREA-OF-ID               PIC S9(04) VALUE +0       CNKCS206
004100                                                    COMP.         CNKCS206
004200     05  DN-FCLTY-AREA-ID               PIC S9(04) VALUE +0          CL**3
004300                                                    COMP.         CNKCS206
004400                                                                  CNKCS206
004500 01  PC-PROGRAM-CONSTANTS.                                        CNKCS206
004600     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         CNKCS206
004700                                                    'CN206A  '.   CNKCS206
004800     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         CNKCS206
004900                                                    'CNKM206 '.   CNKCS206
005000     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     CNKCS206
005100                                                    COMP.         CNKCS206
005200     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         CNKCS206
005300                                                    'CNKCS206'.   CNKCS206
005400     05  PC-INTER-APPL-CODES.                                     CNKCS206
005500         10  PC-INTER-APPL-CRIT-SPEC    PIC  X(01)  VALUE '1'.    CNKCS206
005600         10  PC-INTER-APPL-ADD          PIC  X(01)  VALUE '2'.    CNKCS206
005700         10  PC-INTER-APPL-UPDATE       PIC  X(01)  VALUE '3'.    CNKCS206
005800         10  PC-INTER-APPL-DELETE       PIC  X(01)  VALUE '4'.    CNKCS206
005900     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      CNKCS206
006000                                                    COMP-3.       CNKCS206
006100                                                                  CNKCS206
006200     05  PC-TSYMSG-NUMBERS.                                       CNKCS206
006300         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. CNKCS206
006400         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. CNKCS206
006500         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. CNKCS206
006600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. CNKCS206
006700         10  PC-TSYMSG-00016            PIC  9(05)  VALUE  00016. CNKCS206
006800         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. CNKCS206
006900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. CNKCS206
007000         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. CNKCS206
007100         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. CNKCS206
007200         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. CNKCS206
007300         10  PC-TSYMSG-00112            PIC  9(05)  VALUE  00112. CNKCS206
007400         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. CNKCS206
007500         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. CNKCS206
007600         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. CNKCS206
007700         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. CNKCS206
007800         10  PC-TSYMSG-00158            PIC  9(05)  VALUE  00158. CNKCS206
007900                                                                  CNKCS206
008000 01  PS-PROGRAM-SWITCHES.                                         CNKCS206
008100     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    CNKCS206
008200         88  PS-NO-ERROR                            VALUE 'Y'.    CNKCS206
008300         88  PS-ERROR                               VALUE 'N'.    CNKCS206
008400     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    CNKCS206
008500         88  PS-COMMAREA-VALID                      VALUE 'Y'.    CNKCS206
008600         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    CNKCS206
008700     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    CNKCS206
008800         88  PS-DONE                                VALUE 'Y'.    CNKCS206
008900         88  PS-NOT-DONE                            VALUE 'N'.    CNKCS206
009000                                                                  CNKCS206
009100 01  PV-PROGRAM-VARIABLES.                                        CNKCS206
009200     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      CNKCS206
009300                                                    COMP SYNC.    CNKCS206
009400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      CNKCS206
009500                                                    COMP SYNC.    CNKCS206
009600     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      CNKCS206
009700                                                    COMP-3.       CNKCS206
009800                                                                  CNKCS206
009900*---------------------------------------------------------------* CNKCS206
010000*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * CNKCS206
010100*---------------------------------------------------------------* CNKCS206
010200                                                                  CNKCS206
010300     COPY CNWS005.                                                   CL*11
010400                                                                  CNKCS206
010500/                                                                 CNKCS206
010600*---------------------------------------------------------------* CNKCS206
010700*    MAP LAYOUT                                                 * CNKCS206
010800*---------------------------------------------------------------* CNKCS206
010900                                                                  CNKCS206
011000     COPY CNKM206.                                                CNKCS206
011100                                                                  CNKCS206
011200/                                                                 CNKCS206
011300*---------------------------------------------------------------* CNKCS206
011400*    ATTRIBUTE SETTINGS COPYBOOK.                               * CNKCS206
011500*---------------------------------------------------------------* CNKCS206
011600                                                                  CNKCS206
011700     COPY DPWS015.                                                CNKCS206
011800                                                                  CNKCS206
011900*---------------------------------------------------------------* CNKCS206
012000*    FUNCTION KEYS COPYBOOK.                                    * CNKCS206
012100*---------------------------------------------------------------* CNKCS206
012200                                                                  CNKCS206
012300     COPY DPWS016.                                                CNKCS206
012400                                                                  CNKCS206
012500*---------------------------------------------------------------* CNKCS206
012600*    NUMERIC EDIT LAYOUT.                                       * CNKCS206
012700*---------------------------------------------------------------* CNKCS206
012800                                                                  CNKCS206
012900     COPY DPWS010I.                                               CNKCS206
013000                                                                  CNKCS206
013100/                                                                 CNKCS206
013200*---------------------------------------------------------------* CNKCS206
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * CNKCS206
013400*---------------------------------------------------------------* CNKCS206
013500                                                                  CNKCS206
013600     COPY DPWS030.                                                CNKCS206
CICS       COPY DPWS930.                                                CNKCS206
013800/                                                                 CNKCS206
013900*---------------------------------------------------------------* CNKCS206
014000*    STANDARD COMMAREA.                                         * CNKCS206
014100*---------------------------------------------------------------* CNKCS206
014200                                                                  CNKCS206
014300     COPY DPWS020.                                                CNKCS206
014400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                CNKCS206
014500                                                                  CNKCS206
014600*---------------------------------------------------------------* CNKCS206
014700* INTER-APPLICATION COMMAREA.                                   * CNKCS206
014800*   CNWS001 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * CNKCS206
014900*             SPEC SCREEN.                                      * CNKCS206
015000*   CNWS003 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * CNKCS206
015100*             THIS LIST PROGRAM FOR A LOCAL-GO FUNCTION.        * CNKCS206
015200*---------------------------------------------------------------* CNKCS206
015300                                                                  CNKCS206
015400         10  INTER-APPL-COMM-AREA       PIC X(200).               CNKCS206
015500     COPY CNWS001.                                                   CL*11
015600     COPY CNWS003.                                                   CL*11
015700*---------------------------------------------------------------* CNKCS206
015800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * CNKCS206
015900*---------------------------------------------------------------* CNKCS206
016000         10  ASC-SPECIFIC-COMMAREA.                               CNKCS206
016100             15  ASC-INT-APPL-FORMAT-IND PIC X(01).               CNKCS206
016200             15  ASC-ACTION-SW          PIC X(03).                CNKCS206
016300                 88  ASC-ADD-PENDING    VALUE 'ADD'.              CNKCS206
016400                 88  ASC-DELETE-PENDING VALUE 'DEL'.              CNKCS206
016500                 88  ASC-UPDATE-PENDING VALUE 'UPD'.              CNKCS206
016600             15  ASC-DELETE-SUCCESSFUL-SW  PIC X(01).             CNKCS206
016700                 88  ASC-DELETE-SUCCESSFUL VALUE 'Y'.             CNKCS206
016800             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            CNKCS206
016900                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            CNKCS206
017000                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            CNKCS206
017100             15  ASC-OPER-UNT-ID        PIC 9(04).                   CL**3
017200             15  ASC-FCLTY-ID           PIC 9(04).                   CL**3
017300             15  ASC-FCLTY-NME          PIC X(25).                   CL**3
017400             15  ASC-AREA-ID            PIC X(06).                   CL**3
017500             15  ASC-TYPE               PIC X(02).                CNKCS206
017600             15  ASC-DESC               PIC X(30).                CNKCS206
017700             15  ASC-SUBAREA            PIC X(06).                CNKCS206
017800             15  ASC-IND                PIC X(01).                CNKCS206
017900             15  ASC-USE-SELECTION-QUEUE-IND                      CNKCS206
018000                                        PIC  X(01).               CNKCS206
018100                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    CNKCS206
018200             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               CNKCS206
018300             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       CNKCS206
018400             15  ASC-NUMBER-OF-SELECTED-ITEMS                     CNKCS206
018500                                        PIC S9(09)  COMP-3.       CNKCS206
018600             15  ASC-SEL-SUB            PIC S9(04)  COMP.         CNKCS206
018700             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         CNKCS206
018800                                                                  CNKCS206
018900/                                                                 CNKCS206
019000*---------------------------------------------------------------* CNKCS206
019100*    ABEND PROCESSING COPYBOOK.                                 * CNKCS206
019200*---------------------------------------------------------------* CNKCS206
019300                                                                  CNKCS206
019400     COPY DPWS013.                                                CNKCS206
019500                                                                  CNKCS206
019600/                                                                 CNKCS206
019700*---------------------------------------------------------------* CNKCS206
019800*    DB2 AREA FOR THE FACILITY LOCATION TYPE TABLE              * CNKCS206
019900*---------------------------------------------------------------* CNKCS206
020000     EXEC SQL                                                     CNKCS206
020100          INCLUDE TFLTYPE                                         CNKCS206
020200     END-EXEC.                                                    CNKCS206
020300                                                                  CNKCS206
020400/                                                                 CNKCS206
020500*---------------------------------------------------------------* CNKCS206
020600*    DB2 AREA FOR THE FACILITY LOCATION TABLE                   * CNKCS206
020700*---------------------------------------------------------------* CNKCS206
020800     EXEC SQL                                                     CNKCS206
020900          INCLUDE TFLAREA                                            CL**3
021000     END-EXEC.                                                    CNKCS206
021100                                                                  CNKCS206
021200/                                                                 CNKCS206
021300*---------------------------------------------------------------* CNKCS206
021400*    COPYBOOK USED WHEN CALLING XLKUT071                        * CNKCS206
021500*---------------------------------------------------------------* CNKCS206
021600     COPY XLWS071.                                                CNKCS206
021700                                                                  CNKCS206
021800/                                                                 CNKCS206
021900*---------------------------------------------------------------* CNKCS206
022000*    DB2 AREA FOR THE FACILITY LOCATION ASSIGNMENTS TABLE       * CNKCS206
022100*---------------------------------------------------------------* CNKCS206
022200     EXEC SQL                                                     CNKCS206
022300          INCLUDE TDCFAAS                                            CL**8
022400     END-EXEC.                                                    CNKCS206
022500                                                                  CNKCS206
022600/                                                                 CNKCS206
022700*---------------------------------------------------------------* CNKCS206
022800*    DB2 AREA FOR COMMUNICATIONS                                * CNKCS206
022900*---------------------------------------------------------------* CNKCS206
023000     EXEC SQL                                                     CNKCS206
023100          INCLUDE SQLCA                                           CNKCS206
023200     END-EXEC.                                                    CNKCS206
023300                                                                  CNKCS206
023400/                                                                 CNKCS206
023500 LINKAGE SECTION.                                                 CNKCS206
023600                                                                  CNKCS206
023700 01  DFHCOMMAREA.                                                 CNKCS206
023800     05  FILLER                         OCCURS  1 TO 4072 TIMES   CNKCS206
023900                                        DEPENDING ON EIBCALEN.    CNKCS206
024000         10  FILLER                     PIC X.                    CNKCS206
024100                                                                  CNKCS206
024200/                                                                 CNKCS206
024300 PROCEDURE DIVISION.                                              CNKCS206
024400*---------------------------------------------------------------* CNKCS206
024500*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * CNKCS206
024600*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * CNKCS206
024700*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * CNKCS206
024800*---------------------------------------------------------------* CNKCS206
024900 0000-MAIN-MODULE.                                                CNKCS206
025000                                                                  CNKCS206
025100     INITIALIZE DP030-CICS-API-FIELDS.                            CNKCS206
025200                                                                  CNKCS206
025300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       CNKCS206
025400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          CNKCS206
025500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         CNKCS206
025600                                                                  CNKCS206
025700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       CNKCS206
025800                                                                  CNKCS206
025900     MOVE LENGTH OF CN206AI        TO DP030-MAP-LENGTH (1).       CNKCS206
026000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     CNKCS206
026100                                                                  CNKCS206
026200     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS206
026300     PERFORM 1000-CONTROL-PROCESSING                              CNKCS206
026400                                                                  CNKCS206
026500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     CNKCS206
026600     PERFORM 0001-CALL-CICS-ARCH-API.                             CNKCS206
026700                                                                  CNKCS206
026800*---------------------------------------------------------------* CNKCS206
026900*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * CNKCS206
027000*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * CNKCS206
027100*---------------------------------------------------------------* CNKCS206
027200 0001-CALL-CICS-ARCH-API.                                         CNKCS206
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                              
027400                                    DFHCOMMAREA                           
027500                                    DP030-CICS-API-FIELDS                 
027600                                    DP020-STANDARD-COMMAREA               
027700                                    CN206AI.                              
027800                                                                  CNKCS206
027900     IF  DP030-RC-CALL-SUCCESSFUL                                 CNKCS206
028000         CONTINUE                                                 CNKCS206
028100     ELSE                                                         CNKCS206
028200         SET DP013-NO-ROLLBACK                                    CNKCS206
028300             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
028400             DP013-CICS-ABEND      TO TRUE                        CNKCS206
028500         MOVE '0001-CALL-CICS-ARCH-API'                           CNKCS206
028600                                   TO DP013-PARAGRAPH             CNKCS206
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O        
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)              
028900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      CNKCS206
029000         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
029100     END-IF.                                                      CNKCS206
029200                                                                  CNKCS206
029300*----------------------------------------------------------------*CNKCS206
029400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *CNKCS206
029500* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *CNKCS206
029600*----------------------------------------------------------------*CNKCS206
029700                                                                  CNKCS206
029800 1000-CONTROL-PROCESSING.                                         CNKCS206
029900                                                                  CNKCS206
030000     EVALUATE TRUE                                                CNKCS206
030100         WHEN DP020-NEXT-ACT-INITIAL                              CNKCS206
030200              PERFORM 1100-FIND-OBJECT-KEYS                       CNKCS206
030300              IF  PS-ERROR                                        CNKCS206
030400                  CONTINUE                                        CNKCS206
030500              ELSE                                                CNKCS206
030600                  IF  ASC-ADD-PENDING                             CNKCS206
030700                      PERFORM 1200-INIT-ADD-SCREEN                CNKCS206
030800                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        CNKCS206
030900                      PERFORM 3200-RESET-ATTRIBUTES               CNKCS206
031000                  ELSE                                            CNKCS206
031100                      PERFORM 4000-BUILD-INITIAL-PANEL            CNKCS206
031200                      PERFORM 3200-RESET-ATTRIBUTES               CNKCS206
031300                      IF  SQLCODE = +100                          CNKCS206
031400                          SET DP020-NEXT-ACT-APPL-ERROR           CNKCS206
031500                                         TO TRUE                  CNKCS206
031600                          MOVE PC-TSYMSG-00148                    CNKCS206
031700                                         TO DP020-MSG-NUMBER      CNKCS206
031800                          SET DP020-MSG-INFORMATIONAL             CNKCS206
031900                                         TO TRUE                  CNKCS206
032000                      ELSE                                        CNKCS206
032100                          IF  ASC-DELETE-PENDING                  CNKCS206
032200                              MOVE PC-TSYMSG-00004                CNKCS206
032300                                         TO DP020-MSG-NUMBER      CNKCS206
032400                              SET DP020-MSG-INFORMATIONAL         CNKCS206
032500                                         TO TRUE                  CNKCS206
032600                          END-IF                                  CNKCS206
032700                      END-IF                                      CNKCS206
032800                  END-IF                                          CNKCS206
032900              END-IF                                              CNKCS206
033000                                                                  CNKCS206
033100         WHEN DP020-NEXT-ACT-READ-MAP                             CNKCS206
033200             PERFORM 2000-PROCESS-PANEL                           CNKCS206
033300                                                                  CNKCS206
033400         WHEN DP020-NEXT-ACT-RETURN                               CNKCS206
033500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS206
033600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS206
033700                                                                  CNKCS206
033800         WHEN OTHER                                               CNKCS206
033900             SET DP013-LOGIC-ABEND TO TRUE                        CNKCS206
034000             SET DP013-NO-ROLLBACK TO TRUE                        CNKCS206
034100             MOVE '1000-CONTROL-PROCESSING'                       CNKCS206
034200                                   TO DP013-PARAGRAPH             CNKCS206
034300             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   CNKCS206
034400                                   TO DP013-MESSAGE-TEXT(1)       CNKCS206
034500             MOVE DP020-NEXT-APPL-ACTIVITY                        CNKCS206
034600                                   TO DP013-MESSAGE-TEXT(2)       CNKCS206
034700             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS206
034800     END-EVALUATE.                                                CNKCS206
034900                                                                  CNKCS206
035000/                                                                 CNKCS206
035100*----------------------------------------------------------------*CNKCS206
035200*  DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE    *CNKCS206
035300*  INTER-APPLICATION FORMAT CODE.                                *CNKCS206
035400*----------------------------------------------------------------*CNKCS206
035500 1100-FIND-OBJECT-KEYS.                                           CNKCS206
035600                                                                  CNKCS206
035700     INITIALIZE ASC-SPECIFIC-COMMAREA.                            CNKCS206
035800                                                                  CNKCS206
035900     MOVE DP020-INT-APPL-FORMAT-IND                               CNKCS206
036000                                   TO ASC-INT-APPL-FORMAT-IND.    CNKCS206
036100                                                                  CNKCS206
036200     EVALUATE DP020-INT-APPL-FORMAT-IND                           CNKCS206
036300         WHEN PC-INTER-APPL-CRIT-SPEC                             CNKCS206
036400             MOVE CN001-OPER-UNT-ID TO ASC-OPER-UNT-ID               CL**3
036500             MOVE CN001-FCLTY-ID    TO ASC-FCLTY-ID                  CL**3
036600             SET ASC-ADD-PENDING   TO TRUE                        CNKCS206
036700                                                                  CNKCS206
036800         WHEN PC-INTER-APPL-ADD                                   CNKCS206
036900             IF  CN003-NUMBER-OF-SELECTED-ITEMS > ZERO            CNKCS206
037000                 MOVE PC-TSYMSG-00112                             CNKCS206
037100                                   TO DP020-MSG-NUMBER            CNKCS206
037200                 SET DP020-MSG-WARNING                            CNKCS206
037300                     DP020-NEXT-ACT-APPL-ERROR                    CNKCS206
037400                     PS-ERROR      TO TRUE                        CNKCS206
037500             ELSE                                                 CNKCS206
037600                 SET ASC-ADD-PENDING                              CNKCS206
037700                                   TO TRUE                        CNKCS206
037800                 MOVE CN003-OPER-UNT-ID                              CL**3
037900                                   TO ASC-OPER-UNT-ID                CL**3
038000                 MOVE CN003-FCLTY-ID                                 CL**3
038100                                   TO ASC-FCLTY-ID                   CL**3
038200             END-IF                                               CNKCS206
038300                                                                  CNKCS206
038400         WHEN PC-INTER-APPL-UPDATE                                CNKCS206
038500             IF  CN003-NUMBER-OF-SELECTED-ITEMS = ZERO            CNKCS206
038600                 MOVE PC-TSYMSG-00057                             CNKCS206
038700                                   TO DP020-MSG-NUMBER            CNKCS206
038800                 SET DP020-MSG-WARNING                            CNKCS206
038900                     DP020-NEXT-ACT-APPL-ERROR                    CNKCS206
039000                                   TO TRUE                        CNKCS206
039100             ELSE                                                 CNKCS206
039200                 SET ASC-UPDATE-PENDING                           CNKCS206
039300                                       TO TRUE                    CNKCS206
039400                 SET ASC-USE-SELECTION-QUEUE                      CNKCS206
039500                                       TO TRUE                    CNKCS206
039600                 MOVE CN003-NUMBER-OF-SELECTED-ITEMS              CNKCS206
039700                                   TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS206
039800                 MOVE CN003-NUMBER-OF-TS-ITEMS                    CNKCS206
039900                                       TO ASC-NUMBER-OF-TS-ITEMS  CNKCS206
040000                 MOVE CN003-SEL-QUEUE-NAME                        CNKCS206
040100                                       TO ASC-SEL-QUEUE-NAME      CNKCS206
040200                 PERFORM 1120-PREPARE-LIST-ENTRY                  CNKCS206
040300             END-IF                                               CNKCS206
040400                                                                  CNKCS206
040500         WHEN PC-INTER-APPL-DELETE                                CNKCS206
040600             IF  CN003-NUMBER-OF-SELECTED-ITEMS = ZERO            CNKCS206
040700                 MOVE PC-TSYMSG-00057                             CNKCS206
040800                                   TO DP020-MSG-NUMBER            CNKCS206
040900                 SET DP020-MSG-WARNING                            CNKCS206
041000                     DP020-NEXT-ACT-APPL-ERROR                    CNKCS206
041100                                   TO TRUE                        CNKCS206
041200             ELSE                                                 CNKCS206
041300                 SET ASC-DELETE-PENDING                           CNKCS206
041400                                       TO TRUE                    CNKCS206
041500                 SET ASC-USE-SELECTION-QUEUE                      CNKCS206
041600                                       TO TRUE                    CNKCS206
041700                 MOVE CN003-NUMBER-OF-SELECTED-ITEMS              CNKCS206
041800                                   TO ASC-NUMBER-OF-SELECTED-ITEMSCNKCS206
041900                 MOVE CN003-NUMBER-OF-TS-ITEMS                    CNKCS206
042000                                       TO ASC-NUMBER-OF-TS-ITEMS  CNKCS206
042100                 MOVE CN003-SEL-QUEUE-NAME                        CNKCS206
042200                                       TO ASC-SEL-QUEUE-NAME      CNKCS206
042300                 PERFORM 1120-PREPARE-LIST-ENTRY                  CNKCS206
042400             END-IF                                               CNKCS206
042500                                                                  CNKCS206
042600         WHEN OTHER                                               CNKCS206
042700             MOVE PC-TSYMSG-00148  TO DP020-MSG-NUMBER            CNKCS206
042800             SET DP020-MSG-FATAL                                  CNKCS206
042900                 DP020-NEXT-ACT-APPL-ERROR                        CNKCS206
043000                 PS-ERROR          TO TRUE                        CNKCS206
043100     END-EVALUATE.                                                CNKCS206
043200                                                                  CNKCS206
043300/                                                                 CNKCS206
043400*----------------------------------------------------------------*CNKCS206
043500* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP     *CNKCS206
043600* STORAGE QUEUE PASSED FROM THE LIST.                            *CNKCS206
043700*----------------------------------------------------------------*CNKCS206
043800 1120-PREPARE-LIST-ENTRY.                                         CNKCS206
043900                                                                  CNKCS206
044000     MOVE CN005-MAX-ITEMS          TO ASC-SEL-SUB.                CNKCS206
044100     MOVE ZERO                     TO ASC-SEL-ITEM.               CNKCS206
044200     PERFORM 2110-GET-NEXT-RECORD.                                CNKCS206
044300                                                                  CNKCS206
044400/                                                                 CNKCS206
044500*----------------------------------------------------------------*CNKCS206
044600* INITIALIZE SCREEN FIELDS FOR AN ADD                            *CNKCS206
044700*----------------------------------------------------------------*CNKCS206
044800 1200-INIT-ADD-SCREEN.                                            CNKCS206
044900                                                                  CNKCS206
045000     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       CNKCS206
045100                                                                  CNKCS206
045200     MOVE -1                       TO ALOCL.                      CNKCS206
045300                                                                  CNKCS206
045400     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.                CL**3
045500     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                   CL**3
045600     PERFORM 4200-GET-STORE-INFORMATION.                             CL**3
045700                                                                  CNKCS206
045800     INITIALIZE ASC-AREA-ID                                          CL**3
045900                ASC-TYPE                                          CNKCS206
046000                ASC-SUBAREA                                       CNKCS206
046100                ASC-DESC.                                         CNKCS206
046200                                                                  CNKCS206
046300     MOVE 'N'                      TO ASC-IND.                    CNKCS206
046400     MOVE +1                       TO AINDL.                      CNKCS206
046500                                                                  CNKCS206
046600/                                                                 CNKCS206
046700*----------------------------------------------------------------*CNKCS206
046800* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *CNKCS206
046900* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *CNKCS206
047000* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *CNKCS206
047100* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *CNKCS206
047200* FUNCTION KEYS CAN GET THIS FAR.                                *CNKCS206
047300*----------------------------------------------------------------*CNKCS206
047400                                                                  CNKCS206
047500 2000-PROCESS-PANEL.                                              CNKCS206
047600                                                                  CNKCS206
047700     EVALUATE TRUE                                                CNKCS206
047800         WHEN DP020-SRC-AID = DP016-CLEAR                         CNKCS206
047900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS206
048000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 CNKCS206
048100                                                                  CNKCS206
048200         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS206
048300* IF USER KEYS IN AN EXISTING FORMAT ON AN ADD, REBUILD SCREEN    CNKCS206
048400* USING DATA FROM EXISTING FACILITY LOCATION AND DISPLAY          CNKCS206
048500* WE ARE SIMULATING A "COPY" FUNCTION HERE                        CNKCS206
048600             IF  ASC-ADD-PENDING                                  CNKCS206
048700             AND ALOCL > ZERO                                     CNKCS206
048800             AND ALOCI NOT = ASC-AREA-ID                             CL**3
048900                 MOVE ALOCI        TO ASC-AREA-ID                    CL**3
049000                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS206
049100                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS206
049200             END-IF                                               CNKCS206
049300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS206
049400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS206
049500                                                                  CNKCS206
049600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    CNKCS206
049700             IF (ASC-ADD-PENDING                                  CNKCS206
049800             AND ASC-ADD-NOT-SUCCESSFUL)                          CNKCS206
049900                 PERFORM 1200-INIT-ADD-SCREEN                     CNKCS206
050000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             CNKCS206
050100                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS206
050200             ELSE                                                 CNKCS206
050300                 SET DP030-DONT-ERASE                             CNKCS206
050400                     DP030-SEND-DATAONLY (PC-APPL-MAP)            CNKCS206
050500                                   TO TRUE                        CNKCS206
050600                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS206
050700                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS206
050800             END-IF                                               CNKCS206
050900                                                                  CNKCS206
051000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             CNKCS206
051100             IF  ASC-USE-SELECTION-QUEUE                          CNKCS206
051200                 PERFORM 2110-GET-NEXT-RECORD                     CNKCS206
051300                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS206
051400                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS206
051500             ELSE                                                 CNKCS206
051600*                --- BOTTOM OF LIST ---                           CNKCS206
051700                 MOVE PC-TSYMSG-00070                             CNKCS206
051800                                   TO DP020-MSG-NUMBER            CNKCS206
051900                 SET DP020-MSG-INFORMATIONAL                      CNKCS206
052000                                   TO TRUE                        CNKCS206
052100             END-IF                                               CNKCS206
052200                                                                  CNKCS206
052300         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             CNKCS206
052400             IF  ASC-USE-SELECTION-QUEUE                          CNKCS206
052500                 PERFORM 2120-GET-PREV-RECORD                     CNKCS206
052600                 PERFORM 4000-BUILD-INITIAL-PANEL                 CNKCS206
052700                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS206
052800             ELSE                                                 CNKCS206
052900*                --- TOP OF LIST ---                              CNKCS206
053000                 MOVE PC-TSYMSG-00069                             CNKCS206
053100                                   TO DP020-MSG-NUMBER            CNKCS206
053200                 SET DP020-MSG-INFORMATIONAL                      CNKCS206
053300                                   TO TRUE                        CNKCS206
053400             END-IF                                               CNKCS206
053500                                                                  CNKCS206
053600         WHEN OTHER                                               CNKCS206
053700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 CNKCS206
053800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   CNKCS206
053900             IF  PS-NO-ERROR                                      CNKCS206
054000                 SET DP030-CONTINUE-GO                            CNKCS206
054100                                   TO TRUE                        CNKCS206
054200                 PERFORM 2100-CHECK-FUNCTION-KEY                  CNKCS206
054300             ELSE                                                 CNKCS206
054400                 SET DP030-OVERRIDE-GO                            CNKCS206
054500                                   TO TRUE                        CNKCS206
054600             END-IF                                               CNKCS206
054700     END-EVALUATE.                                                CNKCS206
054800                                                                  CNKCS206
054900/                                                                 CNKCS206
055000*----------------------------------------------------------------*CNKCS206
055100* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*CNKCS206
055200* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *CNKCS206
055300* CICS ARCHITECTURE API.                                         *CNKCS206
055400*----------------------------------------------------------------*CNKCS206
055500 2100-CHECK-FUNCTION-KEY.                                         CNKCS206
055600                                                                  CNKCS206
055700     EVALUATE TRUE                                                CNKCS206
055800         WHEN DP020-SRC-AID = DP016-ENTER                         CNKCS206
055900             CONTINUE                                             CNKCS206
056000                                                                  CNKCS206
056100         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    CNKCS206
056200             IF  ASC-DELETE-SUCCESSFUL                            CNKCS206
056300                 MOVE PC-TSYMSG-00116                             CNKCS206
056400                                   TO DP020-MSG-NUMBER            CNKCS206
056500                 SET DP020-MSG-FATAL                              CNKCS206
056600                     PS-ERROR      TO TRUE                        CNKCS206
056700                 PERFORM 3200-RESET-ATTRIBUTES                    CNKCS206
056800             ELSE                                                 CNKCS206
056900                 SET DP030-CONTINUE-GO                            CNKCS206
057000                                   TO TRUE                        CNKCS206
057100                 PERFORM 7000-DELETE-FCLTY-ID                        CL**3
057200             END-IF                                               CNKCS206
057300                                                                  CNKCS206
057400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              CNKCS206
057500             SET DP030-CONTINUE-GO TO TRUE                        CNKCS206
057600             PERFORM 5000-ADD-FCLTY-ID                               CL**3
057700                                                                  CNKCS206
057800         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              CNKCS206
057900             SET DP030-CONTINUE-GO TO TRUE                        CNKCS206
058000             PERFORM 6000-UPDATE-FCLTY-ID                            CL**3
058100                                                                  CNKCS206
058200         WHEN OTHER                                               CNKCS206
058300             SET DP013-NO-ROLLBACK                                CNKCS206
058400                 DP013-XCTL-DISPLAY-RESTART                       CNKCS206
058500                 DP013-CICS-ABEND  TO TRUE                        CNKCS206
058600             MOVE '2100-CHECK-FUNCTION-KEY'                       CNKCS206
058700                                   TO DP013-PARAGRAPH             CNKCS206
058800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      CNKCS206
058900                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
059000             PERFORM DP013-0000-PROCESS-ABEND                     CNKCS206
059100     END-EVALUATE.                                                CNKCS206
059200                                                                  CNKCS206
059300/                                                                 CNKCS206
059400 2110-GET-NEXT-RECORD.                                            CNKCS206
059500                                                                  CNKCS206
059600     ADD +1                        TO ASC-SEL-SUB.                CNKCS206
059700     IF  ASC-SEL-SUB > CN005-MAX-ITEMS                            CNKCS206
059800         ADD +1                    TO ASC-SEL-ITEM                CNKCS206
059900         MOVE +1                   TO ASC-SEL-SUB                 CNKCS206
060000     END-IF.                                                      CNKCS206
060100                                                                  CNKCS206
060200     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                CNKCS206
060300         IF  ASC-DELETE-PENDING                                   CNKCS206
060400             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            CNKCS206
060500             SET DP020-MSG-INFORMATIONAL                          CNKCS206
060600                                   TO TRUE                        CNKCS206
060700             IF  ASC-DELETE-SUCCESSFUL                            CNKCS206
060800                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    CNKCS206
060900             END-IF                                               CNKCS206
061000         END-IF                                                   CNKCS206
061100         PERFORM 9100-READ-SEL-QUEUE                              CNKCS206
061200         IF  CN005-ITEM (ASC-SEL-SUB) > ZERO                      CNKCS206
061300             MOVE CN005-OPER-UNT-ID (ASC-SEL-SUB)                    CL**3
061400                                   TO ASC-OPER-UNT-ID                CL**3
061500             MOVE CN005-FCLTY-ID (ASC-SEL-SUB)                       CL**3
061600                                   TO ASC-FCLTY-ID                   CL**3
061700             MOVE CN005-AREA-ID (ASC-SEL-SUB)                        CL**3
061800                                   TO ASC-AREA-ID                    CL**3
061900             MOVE CN005-TYPE (ASC-SEL-SUB)                        CNKCS206
062000                                   TO ASC-TYPE                    CNKCS206
062100             SET CN005-INQ (ASC-SEL-SUB)                          CNKCS206
062200                                   TO TRUE                        CNKCS206
062300             PERFORM 9200-REWRITE-LIST-QUEUE                      CNKCS206
062400         ELSE                                                     CNKCS206
062500             SUBTRACT +1 FROM ASC-SEL-SUB                         CNKCS206
062600*            --- BOTTOM OF LIST ---                               CNKCS206
062700             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            CNKCS206
062800             SET DP020-MSG-INFORMATIONAL                          CNKCS206
062900                                   TO TRUE                        CNKCS206
063000         END-IF                                                   CNKCS206
063100     ELSE                                                         CNKCS206
063200         SUBTRACT +1 FROM ASC-SEL-ITEM                            CNKCS206
063300         MOVE CN005-MAX-ITEMS      TO ASC-SEL-SUB                 CNKCS206
063400         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            CNKCS206
063500         SET DP020-MSG-INFORMATIONAL                              CNKCS206
063600                                   TO TRUE                        CNKCS206
063700     END-IF.                                                      CNKCS206
063800                                                                  CNKCS206
063900/                                                                 CNKCS206
064000 2120-GET-PREV-RECORD.                                            CNKCS206
064100                                                                  CNKCS206
064200     SUBTRACT +1 FROM ASC-SEL-SUB.                                CNKCS206
064300     IF  ASC-SEL-SUB < +1                                         CNKCS206
064400         SUBTRACT +1 FROM ASC-SEL-ITEM                            CNKCS206
064500         MOVE CN005-MAX-ITEMS      TO ASC-SEL-SUB                 CNKCS206
064600     END-IF.                                                      CNKCS206
064700                                                                  CNKCS206
064800     IF  ASC-SEL-ITEM > ZERO                                      CNKCS206
064900         IF  ASC-DELETE-PENDING                                   CNKCS206
065000             MOVE PC-TSYMSG-00004  TO DP020-MSG-NUMBER            CNKCS206
065100             SET DP020-MSG-INFORMATIONAL                          CNKCS206
065200                                   TO TRUE                        CNKCS206
065300             IF  ASC-DELETE-SUCCESSFUL                            CNKCS206
065400                 MOVE SPACES       TO ASC-DELETE-SUCCESSFUL-SW    CNKCS206
065500             END-IF                                               CNKCS206
065600         END-IF                                                   CNKCS206
065700         PERFORM 9100-READ-SEL-QUEUE                              CNKCS206
065800         MOVE CN005-OPER-UNT-ID (ASC-SEL-SUB)                        CL**3
065900                                   TO ASC-OPER-UNT-ID                CL**3
066000         MOVE CN005-FCLTY-ID (ASC-SEL-SUB)                           CL**3
066100                                   TO ASC-FCLTY-ID                   CL**3
066200         MOVE CN005-AREA-ID (ASC-SEL-SUB)                            CL**3
066300                                   TO ASC-AREA-ID                    CL**3
066400         MOVE CN005-TYPE (ASC-SEL-SUB)                            CNKCS206
066500                                   TO ASC-TYPE                    CNKCS206
066600     ELSE                                                         CNKCS206
066700         MOVE +1                   TO ASC-SEL-ITEM                CNKCS206
066800                                      ASC-SEL-SUB                 CNKCS206
066900*        --- TOP OF LIST ---                                      CNKCS206
067000         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            CNKCS206
067100         SET DP020-MSG-INFORMATIONAL                              CNKCS206
067200                                   TO TRUE                        CNKCS206
067300     END-IF.                                                      CNKCS206
067400                                                                  CNKCS206
067500/                                                                 CNKCS206
067600*----------------------------------------------------------------*CNKCS206
067700*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *CNKCS206
067800*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *CNKCS206
067900*----------------------------------------------------------------*CNKCS206
068000 2200-MOVE-SCREEN-TO-COMMAREA.                                    CNKCS206
068100                                                                  CNKCS206
068200     IF  ALOCL > ZERO                                             CNKCS206
068300         MOVE ALOCI                TO ASC-AREA-ID                    CL**3
068400     ELSE                                                         CNKCS206
068500         IF  ALOCF = DP015-ERASE-EOF                              CNKCS206
068600             MOVE SPACES           TO ASC-AREA-ID                    CL**3
068700         END-IF                                                   CNKCS206
068800     END-IF.                                                      CNKCS206
068900                                                                  CNKCS206
069000     IF  ATYPEL > ZERO                                            CNKCS206
069100         MOVE ATYPEI               TO ASC-TYPE                    CNKCS206
069200     ELSE                                                         CNKCS206
069300         IF  ATYPEF = DP015-ERASE-EOF                             CNKCS206
069400             MOVE SPACES           TO ASC-TYPE                    CNKCS206
069500         END-IF                                                   CNKCS206
069600     END-IF.                                                      CNKCS206
069700                                                                  CNKCS206
069800     IF  ADESCL > ZERO                                            CNKCS206
069900         MOVE ADESCI               TO ASC-DESC                    CNKCS206
070000     ELSE                                                         CNKCS206
070100         IF  ADESCF = DP015-ERASE-EOF                             CNKCS206
070200             MOVE SPACES           TO ASC-DESC                    CNKCS206
070300         END-IF                                                   CNKCS206
070400     END-IF.                                                      CNKCS206
070500                                                                  CNKCS206
070600     IF  ASUBL > ZERO                                             CNKCS206
070700         MOVE ASUBI                TO ASC-SUBAREA                 CNKCS206
070800     ELSE                                                         CNKCS206
070900         IF  ASUBF = DP015-ERASE-EOF                              CNKCS206
071000             MOVE SPACES           TO ASC-SUBAREA                 CNKCS206
071100         END-IF                                                   CNKCS206
071200     END-IF.                                                      CNKCS206
071300                                                                  CNKCS206
071400     IF  AINDL > ZERO                                             CNKCS206
071500         MOVE AINDI                TO ASC-IND                     CNKCS206
071600     ELSE                                                         CNKCS206
071700         IF  AINDF = DP015-ERASE-EOF                              CNKCS206
071800             MOVE SPACES           TO ASC-IND                     CNKCS206
071900         END-IF                                                   CNKCS206
072000     END-IF.                                                      CNKCS206
072100                                                                  CNKCS206
072200/                                                                 CNKCS206
072300*----------------------------------------------------------------*CNKCS206
072400*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *CNKCS206
072500*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *CNKCS206
072600*----------------------------------------------------------------*CNKCS206
072700 3000-EDIT-DATA-IN-COMMAREA.                                      CNKCS206
072800                                                                  CNKCS206
072900     PERFORM 3200-RESET-ATTRIBUTES.                               CNKCS206
073000                                                                  CNKCS206
073100     IF  ASC-DESC = SPACES                                        CNKCS206
073200         SET PS-ERROR              TO TRUE                        CNKCS206
073300         SET DP020-MSG-FATAL       TO TRUE                        CNKCS206
073400         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            CNKCS206
073500         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS206
073600                                   TO ADESCA                      CNKCS206
073700         MOVE DP015-RED            TO ADESCC                      CNKCS206
073800         MOVE DP015-REVERSE        TO ADESCH                      CNKCS206
073900         MOVE -1                   TO ADESCL                      CNKCS206
074000         SET DP030-SET-CURSOR-APPL-1                              CNKCS206
074100                                   TO TRUE                        CNKCS206
074200     END-IF.                                                      CNKCS206
074300                                                                  CNKCS206
074400     IF  ASC-TYPE = SPACES                                        CNKCS206
074500         SET PS-ERROR              TO TRUE                        CNKCS206
074600         SET DP020-MSG-FATAL       TO TRUE                        CNKCS206
074700         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            CNKCS206
074800         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS206
074900                                   TO ATYPEA                      CNKCS206
075000         MOVE DP015-RED            TO ATYPEC                      CNKCS206
075100         MOVE DP015-REVERSE        TO ATYPEH                      CNKCS206
075200         MOVE -1                   TO ATYPEL                      CNKCS206
075300         SET DP030-SET-CURSOR-APPL-1                              CNKCS206
075400                                   TO TRUE                        CNKCS206
075500     END-IF.                                                      CNKCS206
075600                                                                  CNKCS206
075700     IF  ASC-AREA-ID = SPACES                                        CL**3
075800         SET PS-ERROR              TO TRUE                        CNKCS206
075900         SET DP020-MSG-FATAL       TO TRUE                        CNKCS206
076000         MOVE PC-TSYMSG-00007      TO DP020-MSG-NUMBER            CNKCS206
076100         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS206
076200                                   TO ALOCA                       CNKCS206
076300         MOVE DP015-RED            TO ALOCC                       CNKCS206
076400         MOVE DP015-REVERSE        TO ALOCH                       CNKCS206
076500         MOVE -1                   TO ALOCL                       CNKCS206
076600         SET DP030-SET-CURSOR-APPL-1                              CNKCS206
076700                                   TO TRUE                        CNKCS206
076800     END-IF.                                                      CNKCS206
076900                                                                  CNKCS206
077000     IF  ASC-IND = 'Y' OR 'N'                                     CNKCS206
077100         CONTINUE                                                 CNKCS206
077200     ELSE                                                         CNKCS206
077300         SET PS-ERROR              TO TRUE                        CNKCS206
077400         SET DP020-MSG-FATAL       TO TRUE                        CNKCS206
077500         MOVE PC-TSYMSG-00005      TO DP020-MSG-NUMBER            CNKCS206
077600         MOVE DP015-UNP-ALP-BRT-OFF                               CNKCS206
077700                                   TO AINDA                       CNKCS206
077800         MOVE DP015-RED            TO AINDC                       CNKCS206
077900         MOVE DP015-REVERSE        TO AINDH                       CNKCS206
078000         MOVE -1                   TO AINDL                       CNKCS206
078100         SET DP030-SET-CURSOR-APPL-1                              CNKCS206
078200                                   TO TRUE                        CNKCS206
078300     END-IF.                                                      CNKCS206
078400                                                                  CNKCS206
078500     IF  ASC-SUBAREA > SPACES                                     CNKCS206
078600         INITIALIZE PV-DB2-COUNT                                  CNKCS206
078700         MOVE ASC-OPER-UNT-ID      TO DK-OPER-UNT-ID                 CL**3
078800         MOVE ASC-FCLTY-ID         TO DK-FCLTY-ID                    CL**3
078900         MOVE ASC-SUBAREA          TO DK-SUBAREA-OF-ID            CNKCS206
079000         PERFORM 7120-COUNT-TFLAREA                                  CL**3
079100         IF  PV-DB2-COUNT = +0                                    CNKCS206
079200             SET PS-ERROR          TO TRUE                        CNKCS206
079300             SET DP020-MSG-FATAL   TO TRUE                        CNKCS206
079400             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            CNKCS206
079500             MOVE DP015-UNP-ALP-BRT-OFF                           CNKCS206
079600                                   TO ASUBA                       CNKCS206
079700             MOVE DP015-RED        TO ASUBC                       CNKCS206
079800             MOVE DP015-REVERSE    TO ASUBH                       CNKCS206
079900             MOVE -1               TO ASUBL                       CNKCS206
080000             SET DP030-SET-CURSOR-APPL-1                          CNKCS206
080100                                   TO TRUE                        CNKCS206
080200         END-IF                                                   CNKCS206
080300     END-IF.                                                      CNKCS206
080400                                                                  CNKCS206
080500     IF  PS-NO-ERROR                                              CNKCS206
080600         EVALUATE TRUE                                            CNKCS206
080700             WHEN ASC-ADD-PENDING                                 CNKCS206
080800                 MOVE -1           TO ALOCL                       CNKCS206
080900                 SET DP030-SET-CURSOR-APPL-1                      CNKCS206
081000                                   TO TRUE                        CNKCS206
081100             WHEN ASC-UPDATE-PENDING                              CNKCS206
081200                 MOVE -1           TO ATYPEL                      CNKCS206
081300                 SET DP030-SET-CURSOR-APPL-1                      CNKCS206
081400                                   TO TRUE                        CNKCS206
081500             WHEN ASC-DELETE-PENDING                              CNKCS206
081600                 SET DP030-SET-CURSOR-TRAILER                     CNKCS206
081700                                   TO TRUE                        CNKCS206
081800         END-EVALUATE                                             CNKCS206
081900     END-IF.                                                      CNKCS206
082000                                                                  CNKCS206
082100/                                                                 CNKCS206
082200*----------------------------------------------------------------*CNKCS206
082300*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *CNKCS206
082400*----------------------------------------------------------------*CNKCS206
082500                                                                  CNKCS206
082600 3200-RESET-ATTRIBUTES.                                           CNKCS206
082700                                                                  CNKCS206
082800     IF  ASC-ADD-PENDING                                          CNKCS206
082900         MOVE DP015-UNP-ALP-NOR-OFF TO ALOCA                      CNKCS206
083000                                       ATYPEA                     CNKCS206
083100                                       ADESCA                     CNKCS206
083200                                       ASUBA                      CNKCS206
083300                                       AINDA                      CNKCS206
083400         MOVE DP015-GREEN           TO ALOCC                      CNKCS206
083500                                       ATYPEC                     CNKCS206
083600                                       ADESCC                     CNKCS206
083700                                       ASUBC                      CNKCS206
083800                                       AINDC                      CNKCS206
083900         MOVE DP015-UNDERLINE       TO ALOCH                      CNKCS206
084000                                       ATYPEH                     CNKCS206
084100                                       ADESCH                     CNKCS206
084200                                       ASUBH                      CNKCS206
084300                                       AINDH                      CNKCS206
084400     ELSE                                                         CNKCS206
084500     IF  ASC-UPDATE-PENDING                                       CNKCS206
084600         MOVE DP015-PRO-NOR-OFF     TO ALOCA                      CNKCS206
084700         MOVE DP015-UNP-ALP-NOR-OFF TO ATYPEA                     CNKCS206
084800                                       ADESCA                     CNKCS206
084900                                       ASUBA                      CNKCS206
085000                                       AINDA                      CNKCS206
085100         MOVE DP015-BLUE            TO ALOCC                      CNKCS206
085200         MOVE DP015-GREEN           TO ATYPEC                     CNKCS206
085300                                       ADESCC                     CNKCS206
085400                                       ASUBC                      CNKCS206
085500                                       AINDC                      CNKCS206
085600         MOVE DP015-HL-OFF          TO ALOCH                      CNKCS206
085700         MOVE DP015-UNDERLINE       TO ATYPEH                     CNKCS206
085800                                       ADESCH                     CNKCS206
085900                                       ASUBH                      CNKCS206
086000                                       AINDH                      CNKCS206
086100     ELSE                                                         CNKCS206
086200     IF  ASC-DELETE-PENDING                                       CNKCS206
086300         MOVE DP015-PRO-NOR-OFF     TO ALOCA                      CNKCS206
086400                                       ATYPEA                     CNKCS206
086500                                       ADESCA                     CNKCS206
086600                                       ASUBA                      CNKCS206
086700                                       AINDA                      CNKCS206
086800         MOVE DP015-BLUE            TO ALOCC                      CNKCS206
086900                                       ATYPEC                     CNKCS206
087000                                       ADESCC                     CNKCS206
087100                                       ASUBC                      CNKCS206
087200                                       AINDC                      CNKCS206
087300         MOVE DP015-HL-OFF          TO ALOCH                      CNKCS206
087400                                       ATYPEH                     CNKCS206
087500                                       ADESCH                     CNKCS206
087600                                       ASUBH                      CNKCS206
087700                                       AINDH.                     CNKCS206
087800                                                                  CNKCS206
087900/                                                                 CNKCS206
088000*----------------------------------------------------------------*CNKCS206
088100*    VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST     *CNKCS206
088200*    ENTRY.                                                      *CNKCS206
088300*----------------------------------------------------------------*CNKCS206
088400                                                                  CNKCS206
088500 4000-BUILD-INITIAL-PANEL.                                        CNKCS206
088600                                                                  CNKCS206
088700     INITIALIZE DCLTFLAREA                                           CL**3
088800                DCLTDCFAAS.                                          CL**8
088900                                                                  CNKCS206
089000     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.                CL**3
089100     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                   CL**3
089200     PERFORM 4200-GET-STORE-INFORMATION.                             CL**3
089300                                                                  CNKCS206
089400     MOVE ASC-AREA-ID              TO DK-AREA-ID.                    CL**3
089500     PERFORM 4100-SELECT-TFLAREA.                                    CL**3
089600                                                                  CNKCS206
089700     MOVE FLAREA-FCLTY-LOC-TYP-CDE TO ASC-TYPE.                      CL**3
089800     MOVE FLAREA-FCLTY-AREA-DESC   TO ASC-DESC.                      CL**3
089900     IF DN-SUBAREA-OF-ID = -1                                     CNKCS206
090000        MOVE SPACES                TO ASC-SUBAREA                 CNKCS206
090100     ELSE                                                         CNKCS206
090200        MOVE FLAREA-SUBAREA-OF-ID  TO ASC-SUBAREA                    CL**3
090300     END-IF.                                                      CNKCS206
090400     MOVE FLAREA-DEPT-CL-IND       TO ASC-IND.                       CL**3
090500                                                                  CNKCS206
090600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        CNKCS206
090700                                                                  CNKCS206
090800/                                                                 CNKCS206
090900*----------------------------------------------------------------*CNKCS206
091000* SELECT A ROW FROM THE FACILITY LOCATION TABLE                  *CNKCS206
091100*----------------------------------------------------------------*CNKCS206
091200 4100-SELECT-TFLAREA.                                                CL**3
091300                                                                  CNKCS206
091400     PERFORM                                                      CNKCS206
091500         WITH TEST AFTER                                          CNKCS206
091600         VARYING PV-RETRY-COUNTER                                 CNKCS206
091700         FROM 1 BY 1                                              CNKCS206
091800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
091900            OR (SQLCODE = +0)                                     CNKCS206
092000            OR (SQLCODE = +100))                                  CNKCS206
092100                                                                  CNKCS206
092200         EXEC SQL                                                 CNKCS206
092300           SELECT  FCLTY_LOC_TYP_CDE                              CNKCS206
092400                  ,FCLTY_AREA_DESC                                   CL**3
092500                  ,SUBAREA_OF_ID                                  CNKCS206
092600                  ,DEPT_CL_IND                                       CL**3
092700             INTO :FLAREA-FCLTY-LOC-TYP-CDE                          CL**3
092800                 ,:FLAREA-FCLTY-AREA-DESC                            CL**3
092900                 ,:FLAREA-SUBAREA-OF-ID                              CL**3
093000                    :DN-SUBAREA-OF-ID                             CNKCS206
093100                 ,:FLAREA-DEPT-CL-IND                                CL**3
093200             FROM  TFLAREA                                           CL**3
093300            WHERE  OPER_UNT_ID   = :DK-OPER-UNT-ID                   CL**3
093400              AND  FCLTY_ID      = :DK-FCLTY-ID                      CL**3
093500              AND  FCLTY_AREA_ID = :DK-AREA-ID                       CL**3
093600         END-EXEC                                                 CNKCS206
093700                                                                  CNKCS206
093800         EVALUATE TRUE                                            CNKCS206
093900             WHEN SQLCODE = +0                                    CNKCS206
094000             WHEN SQLCODE = +100                                  CNKCS206
094100                 CONTINUE                                         CNKCS206
094200             WHEN SQLCODE = -904                                  CNKCS206
094300             WHEN SQLCODE = -913                                  CNKCS206
094400                 CONTINUE                                         CNKCS206
094500             WHEN SQLWARN0 NOT = SPACES                           CNKCS206
094600             WHEN SQLCODE < ZERO                                  CNKCS206
094700             WHEN SQLCODE > ZERO                                  CNKCS206
094800                 MOVE '4100-SELECT-TFLAREA'                          CL**3
094900                                   TO DP013-PARAGRAPH             CNKCS206
095000                 MOVE 'SELECT FACILITY LOCATION'                  CNKCS206
095100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
095200                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS206
095300                 MOVE 'TFLAREA'    TO DP013-DB2-TABLE-NAME (1)       CL**3
095400                 SET DP013-DB2-ABEND                              CNKCS206
095500                     DP013-XCTL-DISPLAY-RESTART                   CNKCS206
095600                                   TO TRUE                        CNKCS206
095700                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS206
095800         END-EVALUATE                                             CNKCS206
095900     END-PERFORM.                                                 CNKCS206
096000                                                                  CNKCS206
096100     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
096200         MOVE '4100-SELECT-TFLAREA'                                  CL**3
096300                                   TO DP013-PARAGRAPH             CNKCS206
096400         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     CNKCS206
096500                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
096600         MOVE 'ON TABLE TFLAREA'   TO DP013-MESSAGE-TEXT (2)         CL**3
096700         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
096800         MOVE 'TFLAREA'            TO DP013-DB2-TABLE-NAME (1)       CL**3
096900         SET DP013-DB2-ABEND                                      CNKCS206
097000             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
097100                                   TO TRUE                        CNKCS206
097200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
097300     END-IF.                                                      CNKCS206
097400                                                                  CNKCS206
097500                                                                  CNKCS206
190820****************************************************************  18480003
190830*    THIS PARAGRAPH RETRIEVES THE STORE INFORMATION.           *  18490003
190840*                                                              *  18500003
190850****************************************************************  18510003
190860                                                                  18520003
190861 4200-GET-STORE-INFORMATION.                                      18530003
190880                                                                  18540003
190890     INITIALIZE XL071-COMMAREA.                                   18550003
190891     MOVE DK-OPER-UNT-ID TO XL071-LOCATION-NUMBER.                18560003
190892                                                                  18570003
190893     CALL XL071-LOCATION-MODULE USING                             18580003
190894                                DFHEIBLK                          18590003
190895                                XL071-COMMAREA                    18600003
190896                                XL071-COMMAREA-REC.               18610003
190897                                                                  18620003
190898     EVALUATE TRUE                                                18630003
190899         WHEN XL071-NO-ERRORS                                     18640003
190900         WHEN XL071-DC-ASGMT-NOT-FND                              18650003
190901              MOVE XL071-LOC-NM TO ASC-FCLTY-NME                  18660003
190903                                                                  18670003
190904         WHEN XL071-LOC-NOT-FOUND                                 18680003
190905              MOVE SPACES       TO ASC-FCLTY-NME                  18690003
190906                                                                  18700003
190907         WHEN OTHER                                               18710003
190908              MOVE '4320-GET-STORE-INFORMATION'                   18720003
190909                                  TO DP013-PARAGRAPH              18730003
190910              STRING 'SELECT STORE NUMBER - '                             
190911                      XL071-LOCATION-NUMBER                               
190912                     ' - BAD RETURN CODE FROM XLKUT071 - '                
190913                      XL071-RETURN-CODE                                   
190914                      DELIMITED BY SIZE                                   
190915                      INTO DP013-MESSAGE-TEXT (1)                         
190916              STRING 'BAD SQLCODE - '                                     
190917                      XL071-SQLCODE                                       
190918                     ' - '                                                
190919                      XL071-DB2-TABLE                                     
190920                      DELIMITED BY SIZE                                   
190921                      INTO DP013-MESSAGE-TEXT (2)                         
190922              MOVE XL071-SQLCA     TO DP013-SQLCA                         
190923              MOVE XL071-DB2-TABLE TO DP013-DB2-TABLE-NAME (1)            
190930              MOVE XL071-SQLCODE TO SQLCODE                       18800003
190933              SET DP013-DB2-ABEND                                 18830003
190934                  DP013-XCTL-DISPLAY-RESTART TO TRUE              18840003
190935              PERFORM DP013-0000-PROCESS-ABEND                    18850003
190936                                                                  18860003
190937     END-EVALUATE.                                                18870003
190938                                                                  CNKCS206
190939/                                                                 CNKCS206
190940*----------------------------------------------------------------*CNKCS206
190941* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *CNKCS206
190942*----------------------------------------------------------------*CNKCS206
190943                                                                  CNKCS206
190944 4400-MOVE-COMMAREA-TO-SCREEN.                                    CNKCS206
190945                                                                  CNKCS206
190950     MOVE ASC-OPER-UNT-ID          TO AOPERO.                        CL**3
190960     MOVE ASC-FCLTY-ID             TO AFCLTYO.                       CL**3
190970     MOVE ASC-FCLTY-NME            TO AFDESCO.                       CL**3
190980     MOVE ASC-AREA-ID              TO ALOCO.                         CL**3
190990     MOVE ASC-TYPE                 TO ATYPEO.                     CNKCS206
191000     MOVE ASC-DESC                 TO ADESCO.                     CNKCS206
191100     MOVE ASC-SUBAREA              TO ASUBO.                      CNKCS206
191200     MOVE ASC-IND                  TO AINDO.                      CNKCS206
191300                                                                  CNKCS206
191400     IF ASC-UPDATE-PENDING                                        CNKCS206
191500        MOVE -1                    TO ATYPEL                      CNKCS206
191600        SET DP030-SET-CURSOR-APPL-1                               CNKCS206
191700                                   TO TRUE                        CNKCS206
191800     END-IF.                                                      CNKCS206
191900                                                                  CNKCS206
192000/                                                                 CNKCS206
192100*----------------------------------------------------------------*CNKCS206
192200* ADD A ROW TO THE FACILITY LOCATION TABLE                       *CNKCS206
192300*----------------------------------------------------------------*CNKCS206
192400 5000-ADD-FCLTY-ID.                                                  CL**3
192500                                                                  CNKCS206
192600     IF  ASC-SUBAREA = SPACES                                     CNKCS206
192700         MOVE -1                   TO DN-SUBAREA-OP-UNT-ID           CL**9
192800                                      DN-SUBAREA-FCLTY-ID            CL**9
192900                                      DN-SUBAREA-OF-ID               CL**9
193000     ELSE                                                         CNKCS206
193100         MOVE +1                   TO DN-SUBAREA-OP-UNT-ID           CL**9
193200                                      DN-SUBAREA-FCLTY-ID            CL**9
193300                                      DN-SUBAREA-OF-ID               CL**9
193400     END-IF.                                                      CNKCS206
193500                                                                  CNKCS206
193600     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.                CL**4
193700     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                   CL**4
193800                                                                     CL**4
193900     PERFORM 5100-INSERT-TFLAREA.                                    CL**3
194000                                                                  CNKCS206
194100     EVALUATE SQLCODE                                             CNKCS206
194200        WHEN +0                                                   CNKCS206
194300            MOVE PC-TSYMSG-00034   TO DP020-MSG-NUMBER            CNKCS206
194400            SET DP020-MSG-INFORMATIONAL                           CNKCS206
194500                ASC-ADD-SUCCESSFUL TO TRUE                        CNKCS206
194600            IF  ASC-USE-SELECTION-QUEUE                           CNKCS206
194700                PERFORM 5200-UPDATE-SELECTION-QUEUE               CNKCS206
194800            END-IF                                                CNKCS206
194900                                                                  CNKCS206
195000        WHEN -530                                                 CNKCS206
195100            SET PS-ERROR           TO TRUE                        CNKCS206
195200            SET DP020-MSG-FATAL    TO TRUE                        CNKCS206
195300            MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER            CNKCS206
195400            MOVE DP015-UNP-ALP-BRT-OFF                            CNKCS206
195500                                   TO ATYPEA                      CNKCS206
195600            MOVE DP015-RED         TO ATYPEC                      CNKCS206
195700            MOVE DP015-REVERSE     TO ATYPEH                      CNKCS206
195800            MOVE -1                TO ATYPEL                      CNKCS206
195900            SET DP030-SET-CURSOR-APPL-1                           CNKCS206
196000                                   TO TRUE                        CNKCS206
196100                                                                  CNKCS206
196200        WHEN -803                                                 CNKCS206
196300            SET PS-ERROR           TO TRUE                        CNKCS206
196400            SET DP020-MSG-FATAL    TO TRUE                        CNKCS206
196500            MOVE PC-TSYMSG-00117   TO DP020-MSG-NUMBER            CNKCS206
196600            MOVE DP015-UNP-ALP-BRT-OFF                            CNKCS206
196700                                   TO ALOCA                       CNKCS206
196800            MOVE DP015-RED         TO ALOCC                       CNKCS206
196900            MOVE DP015-REVERSE     TO ALOCH                       CNKCS206
197000            MOVE -1                TO ALOCL                       CNKCS206
197100            SET DP030-SET-CURSOR-APPL-1                           CNKCS206
197200                                   TO TRUE                        CNKCS206
197300     END-EVALUATE.                                                CNKCS206
197400                                                                  CNKCS206
197500/                                                                 CNKCS206
197600*----------------------------------------------------------------*CNKCS206
197700*  INSERT A ROW ON THE FACILITY LOCATION TABLE                   *CNKCS206
197800*----------------------------------------------------------------*CNKCS206
197900 5100-INSERT-TFLAREA.                                                CL**3
198000                                                                  CNKCS206
198100     PERFORM                                                      CNKCS206
198200         WITH TEST AFTER                                          CNKCS206
198300         VARYING PV-RETRY-COUNTER                                 CNKCS206
198400         FROM 1 BY 1                                              CNKCS206
198500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
198600             OR (SQLCODE = +0)                                    CNKCS206
198700             OR (SQLCODE = -530)                                  CNKCS206
198800             OR (SQLCODE = -803))                                 CNKCS206
198900                                                                  CNKCS206
199000         EXEC SQL                                                 CNKCS206
199100             INSERT  INTO TFLAREA                                    CL**3
199200                    (OPER_UNT_ID                                     CL**3
199300                    ,FCLTY_ID                                        CL**3
199400                    ,FCLTY_AREA_ID                                   CL**3
199500                    ,SUBAREA_OP_UNT_ID                               CL**4
199600                    ,SUBAREA_FCLTY_ID                                CL**3
199700                    ,SUBAREA_OF_ID                                CNKCS206
199800                    ,FCLTY_LOC_TYP_CDE                            CNKCS206
199900                    ,FCLTY_AREA_DESC                                 CL**3
200000                    ,DEPT_CL_IND)                                    CL**3
200100            VALUES  (:DK-OPER-UNT-ID                                 CL**3
200200                    ,:DK-FCLTY-ID                                    CL**4
200300                    ,:ASC-AREA-ID                                    CL**3
200400                    ,:DK-OPER-UNT-ID                                 CL*10
200500                       :DN-SUBAREA-OP-UNT-ID                         CL**9
200600                    ,:DK-FCLTY-ID                                    CL*10
200700                       :DN-SUBAREA-FCLTY-ID                          CL**9
200800                    ,:ASC-SUBAREA                                 CNKCS206
200900                       :DN-SUBAREA-OF-ID                          CNKCS206
201000                    ,:ASC-TYPE                                    CNKCS206
201100                    ,:ASC-DESC                                    CNKCS206
201200                    ,:ASC-IND)                                    CNKCS206
201300         END-EXEC                                                 CNKCS206
201400                                                                  CNKCS206
201500         EVALUATE TRUE                                            CNKCS206
201600             WHEN SQLCODE = +0                                    CNKCS206
201700             WHEN SQLCODE = -530                                  CNKCS206
201800             WHEN SQLCODE = -803                                  CNKCS206
201900             WHEN SQLCODE = -904                                  CNKCS206
202000             WHEN SQLCODE = -913                                  CNKCS206
202100                 CONTINUE                                         CNKCS206
202200             WHEN SQLWARN0 NOT = SPACES                           CNKCS206
202300             WHEN SQLCODE < +0                                    CNKCS206
202400             WHEN SQLCODE > +0                                    CNKCS206
202500                 MOVE '5100-INSERT-TFLAREA'                          CL**3
202600                                   TO DP013-PARAGRAPH             CNKCS206
202700                 MOVE 'INSERT A ROW ON TFLAREA'                      CL**3
202800                                   TO DP013-MESSAGE-TEXT(1)       CNKCS206
202900                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS206
203000                 MOVE 'TFLAREA'    TO DP013-DB2-TABLE-NAME (1)       CL**3
203100                 SET DP013-DB2-ABEND                              CNKCS206
203200                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS206
203300                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS206
203400         END-EVALUATE                                             CNKCS206
203500     END-PERFORM.                                                 CNKCS206
203600                                                                  CNKCS206
203700     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
203800         MOVE '5100-INSERT-TFLAREA'                                  CL**3
203900                                   TO DP013-PARAGRAPH             CNKCS206
204000         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS206
204100                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
204200         MOVE 'TO INSERT A TFLAREA ROW'                              CL**3
204300                                   TO DP013-MESSAGE-TEXT (2)      CNKCS206
204400         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
204500         MOVE 'TFLAREA'            TO DP013-DB2-TABLE-NAME (1)       CL**3
204600         SET DP013-DB2-ABEND                                      CNKCS206
204700             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
204800                                   TO TRUE                        CNKCS206
204900         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
205000     END-IF.                                                      CNKCS206
205100                                                                  CNKCS206
205200/                                                                 CNKCS206
205300*----------------------------------------------------------------*CNKCS206
205400* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT THIS  *CNKCS206
205500* OBJECT WAS UDPATED.                                            *CNKCS206
205600*----------------------------------------------------------------*CNKCS206
205700                                                                  CNKCS206
205800 5200-UPDATE-SELECTION-QUEUE.                                     CNKCS206
205900                                                                  CNKCS206
206000     PERFORM 9100-READ-SEL-QUEUE.                                 CNKCS206
206100                                                                  CNKCS206
206200     IF  ASC-DELETE-SUCCESSFUL                                    CNKCS206
206300         SET CN005-DEL (ASC-SEL-SUB)                              CNKCS206
206400                                   TO TRUE                        CNKCS206
206500     ELSE                                                         CNKCS206
206600         SET CN005-UPD (ASC-SEL-SUB)                              CNKCS206
206700                                   TO TRUE                        CNKCS206
206800     END-IF.                                                      CNKCS206
206900                                                                  CNKCS206
207000     PERFORM 9200-REWRITE-LIST-QUEUE.                             CNKCS206
207100                                                                  CNKCS206
207200/                                                                 CNKCS206
207300*----------------------------------------------------------------*CNKCS206
207400* APPLY THE CHANGES TO THE FACILITY LOCATION TABLE               *CNKCS206
207500*----------------------------------------------------------------*CNKCS206
207600 6000-UPDATE-FCLTY-ID.                                               CL**3
207700                                                                  CNKCS206
207800     IF  ASC-SUBAREA = SPACES                                     CNKCS206
207900         MOVE -1                   TO DN-SUBAREA-OP-UNT-ID           CL**7
208000                                      DN-SUBAREA-FCLTY-ID            CL**6
208100                                      DN-SUBAREA-OF-ID               CL**6
208200     ELSE                                                         CNKCS206
208300         MOVE +1                   TO DN-SUBAREA-OP-UNT-ID           CL**7
208400                                      DN-SUBAREA-FCLTY-ID            CL**6
208500                                      DN-SUBAREA-OF-ID               CL**6
208600     END-IF.                                                      CNKCS206
208700                                                                  CNKCS206
208800     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.                CL**3
208900     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                   CL**3
209000     MOVE ASC-AREA-ID              TO DK-AREA-ID.                    CL**3
209100     PERFORM 6100-UPDATE-TFLAREA.                                    CL**3
209200                                                                  CNKCS206
209300     MOVE PC-TSYMSG-00059          TO DP020-MSG-NUMBER.           CNKCS206
209400     SET DP020-MSG-INFORMATIONAL   TO TRUE.                       CNKCS206
209500                                                                  CNKCS206
209600     IF  ASC-USE-SELECTION-QUEUE                                  CNKCS206
209700         PERFORM 5200-UPDATE-SELECTION-QUEUE                      CNKCS206
209800     END-IF.                                                      CNKCS206
209900                                                                  CNKCS206
210000/                                                                 CNKCS206
210100*----------------------------------------------------------------*CNKCS206
210200*  UPDATE THE ROW ON THE FACILITY LOCATION TABLE                 *CNKCS206
210300*----------------------------------------------------------------*CNKCS206
210400 6100-UPDATE-TFLAREA.                                                CL**3
210500                                                                  CNKCS206
210600     PERFORM                                                      CNKCS206
210700         WITH TEST AFTER                                          CNKCS206
210800         VARYING PV-RETRY-COUNTER                                 CNKCS206
210900         FROM 1 BY 1                                              CNKCS206
211000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
211100             OR (SQLCODE = +0))                                   CNKCS206
211200                                                                  CNKCS206
211300         EXEC SQL                                                 CNKCS206
211400             UPDATE TFLAREA                                          CL**3
211500               SET   FCLTY_LOC_TYP_CDE = :ASC-TYPE                CNKCS206
211600                    ,FCLTY_AREA_DESC   = :ASC-DESC                   CL**3
211700                    ,SUBAREA_OP_UNT_ID = :DK-OPER-UNT-ID             CL**6
211800                                           :DN-SUBAREA-OP-UNT-ID     CL**6
211900                    ,SUBAREA_FCLTY_ID  = :DK-FCLTY-ID                CL**6
212000                                           :DN-SUBAREA-FCLTY-ID      CL**6
212100                    ,SUBAREA_OF_ID     = :ASC-SUBAREA                CL**6
212200                                           :DN-SUBAREA-OF-ID         CL**6
212300                    ,DEPT_CL_IND       = :ASC-IND                    CL**3
212400             WHERE  OPER_UNT_ID   = :DK-OPER-UNT-ID                  CL**3
212500               AND  FCLTY_ID      = :DK-FCLTY-ID                     CL**3
212600               AND  FCLTY_AREA_ID = :DK-AREA-ID                      CL**3
212700         END-EXEC                                                 CNKCS206
212800                                                                  CNKCS206
212900         EVALUATE TRUE                                            CNKCS206
213000             WHEN SQLCODE = +0                                    CNKCS206
213100             WHEN SQLCODE = -904                                  CNKCS206
213200             WHEN SQLCODE = -913                                  CNKCS206
213300                 CONTINUE                                         CNKCS206
213400             WHEN SQLWARN0 NOT = SPACES                           CNKCS206
213500             WHEN SQLCODE < +0                                    CNKCS206
213600             WHEN SQLCODE > +0                                    CNKCS206
213700                 MOVE '6100-UPDATE-TFLAREA'                          CL**3
213800                                   TO DP013-PARAGRAPH             CNKCS206
213900                 MOVE 'UPDATE A ROW ON TFLAREA'                      CL**3
214000                                   TO DP013-MESSAGE-TEXT(1)       CNKCS206
214100                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS206
214200                 MOVE 'TFLAREA'    TO DP013-DB2-TABLE-NAME (1)       CL**3
214300                 SET DP013-DB2-ABEND                              CNKCS206
214400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS206
214500                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS206
214600         END-EVALUATE                                             CNKCS206
214700     END-PERFORM.                                                 CNKCS206
214800                                                                  CNKCS206
214900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
215000         MOVE '6100-UPDATE-TFLAREA'                                  CL**3
215100                                   TO DP013-PARAGRAPH             CNKCS206
215200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS206
215300                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
215400         MOVE 'TO UPDATE A TFLAREA ROW'                              CL**3
215500                                   TO DP013-MESSAGE-TEXT (2)      CNKCS206
215600         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
215700         MOVE 'TFLAREA'            TO DP013-DB2-TABLE-NAME (1)       CL**3
215800         SET DP013-DB2-ABEND                                      CNKCS206
215900             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
216000                                   TO TRUE                        CNKCS206
216100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
216200     END-IF.                                                      CNKCS206
216300                                                                  CNKCS206
216400/                                                                 CNKCS206
216500*----------------------------------------------------------------*CNKCS206
216600*    CHECK TO SEE IF ANY LOCATIONS AREA ASSIGNED ON TDCFAAS      *   CL**8
216700*    IF SO, REMOVE THE ASSIGNMENT (ROW IS NOT DELETED!)          *CNKCS206
216800*                                                                *CNKCS206
216900*    CHECK TO SEE IF A ROW EXISTS ON TFLAREA FOR THE VALUE       *   CL**3
217000*    OF SUBAREA-OF-ID, IF IS TO BE "DELETED" AND IT IS USED      *CNKCS206
217100*    CHANGE ALL SUBAREA-OF-ID VALUES TO NULL.                    *CNKCS206
217200*----------------------------------------------------------------*CNKCS206
217300                                                                  CNKCS206
217400 7000-DELETE-FCLTY-ID.                                               CL**3
217500                                                                  CNKCS206
217600     MOVE ASC-OPER-UNT-ID          TO DK-OPER-UNT-ID.                CL**3
217700     MOVE ASC-FCLTY-ID             TO DK-FCLTY-ID.                   CL**3
217800     MOVE ASC-AREA-ID              TO DK-AREA-ID.                    CL**3
217900                                                                  CNKCS206
218000     INITIALIZE PV-DB2-COUNT.                                     CNKCS206
218100     PERFORM 7100-COUNT-TDCFAAS.                                     CL**8
218200                                                                  CNKCS206
218300     IF PV-DB2-COUNT > +0                                         CNKCS206
218400        MOVE -1                    TO DN-FCLTY-AREA-ID               CL**3
218500        PERFORM 7200-UPDATE-TDCFAAS                                  CL**8
218600     END-IF.                                                      CNKCS206
218700                                                                  CNKCS206
218800     INITIALIZE PV-DB2-COUNT.                                     CNKCS206
218900     PERFORM 7110-COUNT-TFLAREA.                                     CL**3
219000                                                                  CNKCS206
219100     IF PV-DB2-COUNT > +0                                         CNKCS206
219200        MOVE -1                    TO DN-SUBAREA-OF-ID            CNKCS206
219300        PERFORM 7300-UPDATE2-TFLAREA                                 CL**3
219400     END-IF.                                                      CNKCS206
219500                                                                  CNKCS206
219600     PERFORM 7400-DELETE-TFLAREA.                                    CL**3
219700                                                                  CNKCS206
219800     MOVE PC-TSYMSG-00115          TO DP020-MSG-NUMBER.           CNKCS206
219900     SET DP020-MSG-INFORMATIONAL                                  CNKCS206
220000         ASC-DELETE-SUCCESSFUL     TO TRUE.                       CNKCS206
220100                                                                  CNKCS206
220200     IF  ASC-USE-SELECTION-QUEUE                                  CNKCS206
220300         PERFORM 5200-UPDATE-SELECTION-QUEUE                      CNKCS206
220400     END-IF.                                                      CNKCS206
220500                                                                  CNKCS206
220600/                                                                 CNKCS206
220700*----------------------------------------------------------------*CNKCS206
220800*    CHECK TO SEE IF ANY LOCATIONS EXIST ON TDCFAAS              *   CL**8
220900*----------------------------------------------------------------*CNKCS206
221000                                                                  CNKCS206
221100 7100-COUNT-TDCFAAS.                                                 CL**8
221200                                                                  CNKCS206
221300     PERFORM                                                      CNKCS206
221400         WITH TEST AFTER                                          CNKCS206
221500         VARYING PV-RETRY-COUNTER                                 CNKCS206
221600         FROM 1 BY 1                                              CNKCS206
221700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
221800            OR  (SQLCODE = +0)                                    CNKCS206
221900            OR  (SQLCODE = +100))                                 CNKCS206
222000                                                                  CNKCS206
222100         EXEC SQL                                                 CNKCS206
222200             SELECT COUNT(*)                                      CNKCS206
222300              INTO :PV-DB2-COUNT                                  CNKCS206
222400              FROM TDCFAAS                                           CL**8
222500             WHERE OPER_UNT_ID   = :DK-OPER-UNT-ID                   CL**3
222600               AND FCLTY_ID      = :DK-FCLTY-ID                      CL**3
222700               AND FCLTY_AREA_ID = :DK-AREA-ID                       CL**3
222800         END-EXEC                                                 CNKCS206
222900                                                                  CNKCS206
223000         EVALUATE TRUE                                            CNKCS206
223100             WHEN SQLCODE = +0                                    CNKCS206
223200             WHEN SQLCODE = +100                                  CNKCS206
223300             WHEN SQLCODE = -904                                  CNKCS206
223400             WHEN SQLCODE = -913                                  CNKCS206
223500                  CONTINUE                                        CNKCS206
223600             WHEN SQLWARN0 NOT = SPACE                            CNKCS206
223700             WHEN SQLCODE < +0                                    CNKCS206
223800             WHEN SQLCODE > +0                                    CNKCS206
223900                  MOVE '7100-COUNT-TDCFAAS'                          CL**8
224000                                   TO DP013-PARAGRAPH             CNKCS206
224100                  MOVE 'COUNT ON TDCFAAS'                            CL**8
224200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
224300                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS206
224400                  MOVE 'TDCFAAS'   TO DP013-DB2-TABLE-NAME (1)       CL**8
224500                  SET DP013-DB2-ABEND                             CNKCS206
224600                      DP013-XCTL-DISPLAY-RESTART                  CNKCS206
224700                                   TO TRUE                        CNKCS206
224800                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS206
224900         END-EVALUATE                                             CNKCS206
225000     END-PERFORM.                                                 CNKCS206
225100                                                                  CNKCS206
225200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
225300         MOVE '7100-COUNT-TDCFAAS'                                   CL**8
225400                                   TO DP013-PARAGRAPH             CNKCS206
225500         MOVE 'MAX RETRIES EXCEEDED FOR COUNT'                    CNKCS206
225600                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
225700         MOVE 'ON TABLE TDCFAAS '  TO DP013-MESSAGE-TEXT (2)         CL**8
225800         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
225900         SET DP013-DB2-ABEND                                      CNKCS206
226000             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
226100                                   TO TRUE                        CNKCS206
226200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
226300     END-IF.                                                      CNKCS206
226400                                                                  CNKCS206
226500/                                                                 CNKCS206
226600*----------------------------------------------------------------*CNKCS206
226700*    CHECK TO SEE IF ANY SUBAREA-OF-IDS ARE USED AS A            *CNKCS206
226800*    LOCATIONS                                                   *CNKCS206
226900*----------------------------------------------------------------*CNKCS206
227000                                                                  CNKCS206
227100 7110-COUNT-TFLAREA.                                                 CL**3
227200                                                                  CNKCS206
227300     PERFORM                                                      CNKCS206
227400         WITH TEST AFTER                                          CNKCS206
227500         VARYING PV-RETRY-COUNTER                                 CNKCS206
227600         FROM 1 BY 1                                              CNKCS206
227700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
227800            OR  (SQLCODE = +0)                                    CNKCS206
227900            OR  (SQLCODE = +100))                                 CNKCS206
228000                                                                  CNKCS206
228100         EXEC SQL                                                 CNKCS206
228200             SELECT COUNT(*)                                      CNKCS206
228300              INTO :PV-DB2-COUNT                                  CNKCS206
228400              FROM TFLAREA                                           CL**3
228500             WHERE OPER_UNT_ID   = :DK-OPER-UNT-ID                   CL**3
228600               AND FCLTY_ID      = :DK-FCLTY-ID                      CL**3
228700               AND SUBAREA_OF_ID = :DK-AREA-ID                       CL**3
228800         END-EXEC                                                 CNKCS206
228900                                                                  CNKCS206
229000         EVALUATE TRUE                                            CNKCS206
229100             WHEN SQLCODE = +0                                    CNKCS206
229200             WHEN SQLCODE = +100                                  CNKCS206
229300             WHEN SQLCODE = -904                                  CNKCS206
229400             WHEN SQLCODE = -913                                  CNKCS206
229500                  CONTINUE                                        CNKCS206
229600             WHEN SQLWARN0 NOT = SPACE                            CNKCS206
229700             WHEN SQLCODE < +0                                    CNKCS206
229800             WHEN SQLCODE > +0                                    CNKCS206
229900                  MOVE '7110-COUNT-TFLAREA'                          CL**3
230000                                   TO DP013-PARAGRAPH             CNKCS206
230100                  MOVE 'COUNT ON TFLAREA'                            CL**3
230200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
230300                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS206
230400                  MOVE 'TFLAREA'   TO DP013-DB2-TABLE-NAME (1)       CL**3
230500                  SET DP013-DB2-ABEND                             CNKCS206
230600                      DP013-XCTL-DISPLAY-RESTART                  CNKCS206
230700                                   TO TRUE                        CNKCS206
230800                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS206
230900         END-EVALUATE                                             CNKCS206
231000     END-PERFORM.                                                 CNKCS206
231100                                                                  CNKCS206
231200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
231300         MOVE '7110-COUNT-TFLAREA'                                   CL**3
231400                                   TO DP013-PARAGRAPH             CNKCS206
231500         MOVE 'MAX RETRIES EXCEEDED FOR COUNT'                    CNKCS206
231600                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
231700         MOVE 'ON TABLE TFLAREA '  TO DP013-MESSAGE-TEXT (2)         CL**3
231800         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
231900         SET DP013-DB2-ABEND                                      CNKCS206
232000             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
232100                                   TO TRUE                        CNKCS206
232200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
232300     END-IF.                                                      CNKCS206
232400                                                                  CNKCS206
232500/                                                                 CNKCS206
232600*----------------------------------------------------------------*CNKCS206
232700*    CHECK TO SEE IF THE SUBAREA IS CURRENTLY DEFINED AS A       *CNKCS206
232800*    LOCATION ON TFLAREA                                         *   CL**3
232900*----------------------------------------------------------------*CNKCS206
233000                                                                  CNKCS206
233100 7120-COUNT-TFLAREA.                                                 CL**3
233200                                                                  CNKCS206
233300     PERFORM                                                      CNKCS206
233400         WITH TEST AFTER                                          CNKCS206
233500         VARYING PV-RETRY-COUNTER                                 CNKCS206
233600         FROM 1 BY 1                                              CNKCS206
233700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
233800            OR  (SQLCODE = +0)                                    CNKCS206
233900            OR  (SQLCODE = +100))                                 CNKCS206
234000                                                                  CNKCS206
234100         EXEC SQL                                                 CNKCS206
234200             SELECT COUNT(*)                                      CNKCS206
234300              INTO :PV-DB2-COUNT                                  CNKCS206
234400              FROM TFLAREA                                           CL**3
234500             WHERE OPER_UNT_ID   = :DK-OPER-UNT-ID                   CL**3
234600               AND FCLTY_ID      = :DK-FCLTY-ID                      CL**3
234700               AND FCLTY_AREA_ID = :DK-SUBAREA-OF-ID                 CL**3
234800         END-EXEC                                                 CNKCS206
234900                                                                  CNKCS206
235000         EVALUATE TRUE                                            CNKCS206
235100             WHEN SQLCODE = +0                                    CNKCS206
235200             WHEN SQLCODE = +100                                  CNKCS206
235300             WHEN SQLCODE = -904                                  CNKCS206
235400             WHEN SQLCODE = -913                                  CNKCS206
235500                  CONTINUE                                        CNKCS206
235600             WHEN SQLWARN0 NOT = SPACE                            CNKCS206
235700             WHEN SQLCODE < +0                                    CNKCS206
235800             WHEN SQLCODE > +0                                    CNKCS206
235900                  MOVE '7120-COUNT-TFLAREA'                          CL**3
236000                                   TO DP013-PARAGRAPH             CNKCS206
236100                  MOVE 'COUNT ON TFLAREA'                            CL**3
236200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
236300                  MOVE SQLCA       TO DP013-SQLCA                 CNKCS206
236400                  MOVE 'TFLAREA'   TO DP013-DB2-TABLE-NAME (1)       CL**3
236500                  SET DP013-DB2-ABEND                             CNKCS206
236600                      DP013-XCTL-DISPLAY-RESTART                  CNKCS206
236700                                   TO TRUE                        CNKCS206
236800                  PERFORM DP013-0000-PROCESS-ABEND                CNKCS206
236900         END-EVALUATE                                             CNKCS206
237000     END-PERFORM.                                                 CNKCS206
237100                                                                  CNKCS206
237200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
237300         MOVE '7120-COUNT-TFLAREA'                                   CL**3
237400                                   TO DP013-PARAGRAPH             CNKCS206
237500         MOVE 'MAX RETRIES EXCEEDED FOR COUNT'                    CNKCS206
237600                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
237700         MOVE 'ON TABLE TFLAREA '  TO DP013-MESSAGE-TEXT (2)         CL**3
237800         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
237900         SET DP013-DB2-ABEND                                      CNKCS206
238000             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
238100                                   TO TRUE                        CNKCS206
238200         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
238300     END-IF.                                                      CNKCS206
238400                                                                  CNKCS206
238500/                                                                 CNKCS206
238600*----------------------------------------------------------------*CNKCS206
238700*  UPDATE THE ROW(S) ON THE FACILITY LOCATION ASSIGNMENT TABLE   *CNKCS206
238800*----------------------------------------------------------------*CNKCS206
238900 7200-UPDATE-TDCFAAS.                                                CL**8
239000                                                                  CNKCS206
239100     PERFORM                                                      CNKCS206
239200         WITH TEST AFTER                                          CNKCS206
239300         VARYING PV-RETRY-COUNTER                                 CNKCS206
239400         FROM 1 BY 1                                              CNKCS206
239500         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
239600             OR (SQLCODE = +0))                                   CNKCS206
239700                                                                  CNKCS206
239800         EXEC SQL                                                 CNKCS206
239900             UPDATE TDCFAAS                                          CL**8
240000               SET  FCLTY_AREA_ID = :DCFAAS-FCLTY-AREA-ID            CL**8
240100                                      :DN-FCLTY-AREA-ID              CL**3
240200             WHERE OPER_UNT_ID = :DK-OPER-UNT-ID                     CL**3
240300               AND FCLTY_ID    = :DK-FCLTY-ID                        CL**3
240400         END-EXEC                                                 CNKCS206
240500                                                                  CNKCS206
240600         EVALUATE TRUE                                            CNKCS206
240700             WHEN SQLCODE = +0                                    CNKCS206
240800             WHEN SQLCODE = -904                                  CNKCS206
240900             WHEN SQLCODE = -913                                  CNKCS206
241000                 CONTINUE                                         CNKCS206
241100             WHEN SQLWARN0 NOT = SPACES                           CNKCS206
241200             WHEN SQLCODE < +0                                    CNKCS206
241300             WHEN SQLCODE > +0                                    CNKCS206
241400                 MOVE '7200-UPDATE-TDCFAAS'                          CL**8
241500                                   TO DP013-PARAGRAPH             CNKCS206
241600                 MOVE 'UPDATE ROW(S) ON TDCFAAS'                     CL**8
241700                                   TO DP013-MESSAGE-TEXT(1)       CNKCS206
241800                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS206
241900                 MOVE 'TDCFAAS'    TO DP013-DB2-TABLE-NAME (1)       CL**8
242000                 SET DP013-DB2-ABEND                              CNKCS206
242100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS206
242200                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS206
242300         END-EVALUATE                                             CNKCS206
242400     END-PERFORM.                                                 CNKCS206
242500                                                                  CNKCS206
242600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
242700         MOVE '7200-UPDATE-TDCFAAS'                                  CL**8
242800                                   TO DP013-PARAGRAPH             CNKCS206
242900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS206
243000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
243100         MOVE 'TO UPDATE TDCFAAS ROW(S)'                             CL**8
243200                                   TO DP013-MESSAGE-TEXT (2)      CNKCS206
243300         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
243400         MOVE 'TDCFAAS'            TO DP013-DB2-TABLE-NAME (1)       CL**8
243500         SET DP013-DB2-ABEND                                      CNKCS206
243600             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
243700                                   TO TRUE                        CNKCS206
243800         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
243900     END-IF.                                                      CNKCS206
244000                                                                  CNKCS206
244100/                                                                 CNKCS206
244200*----------------------------------------------------------------*CNKCS206
244300*  UPDATE THE ROW(S) ON THE FACILITY LOCATION TABLE              *CNKCS206
244400*----------------------------------------------------------------*CNKCS206
244500 7300-UPDATE2-TFLAREA.                                               CL**3
244600                                                                  CNKCS206
244700     PERFORM                                                      CNKCS206
244800         WITH TEST AFTER                                          CNKCS206
244900         VARYING PV-RETRY-COUNTER                                 CNKCS206
245000         FROM 1 BY 1                                              CNKCS206
245100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
245200             OR (SQLCODE = +0))                                   CNKCS206
245300                                                                  CNKCS206
245400         EXEC SQL                                                 CNKCS206
245500             UPDATE TFLAREA                                          CL**3
245600               SET  SUBAREA_OF_ID = :FLAREA-SUBAREA-OF-ID            CL**3
245700                                      :DN-SUBAREA-OF-ID           CNKCS206
245800             WHERE  OPER_UNT_ID   = :DK-OPER-UNT-ID                  CL**3
245900               AND  FCLTY_ID      = :DK-FCLTY-ID                     CL**3
246000               AND  SUBAREA_OF_ID = :DK-AREA-ID                      CL**3
246100         END-EXEC                                                 CNKCS206
246200                                                                  CNKCS206
246300         EVALUATE TRUE                                            CNKCS206
246400             WHEN SQLCODE = +0                                    CNKCS206
246500             WHEN SQLCODE = -904                                  CNKCS206
246600             WHEN SQLCODE = -913                                  CNKCS206
246700                 CONTINUE                                         CNKCS206
246800             WHEN SQLWARN0 NOT = SPACES                           CNKCS206
246900             WHEN SQLCODE < +0                                    CNKCS206
247000             WHEN SQLCODE > +0                                    CNKCS206
247100                 MOVE '7300-UPDATE2-TFLAREA'                         CL**3
247200                                   TO DP013-PARAGRAPH             CNKCS206
247300                 MOVE 'UPDATE A ROW ON TFLAREA'                      CL**3
247400                                   TO DP013-MESSAGE-TEXT(1)       CNKCS206
247500                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS206
247600                 MOVE 'TFLAREA'    TO DP013-DB2-TABLE-NAME (1)       CL**3
247700                 SET DP013-DB2-ABEND                              CNKCS206
247800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS206
247900                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS206
248000         END-EVALUATE                                             CNKCS206
248100     END-PERFORM.                                                 CNKCS206
248200                                                                  CNKCS206
248300     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
248400         MOVE '7300-UPDATE2-TFLAREA'                                 CL**3
248500                                   TO DP013-PARAGRAPH             CNKCS206
248600         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS206
248700                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
248800         MOVE 'TO UPDATE A TFLAREA ROW'                              CL**3
248900                                   TO DP013-MESSAGE-TEXT (2)      CNKCS206
249000         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
249100         MOVE 'TFLAREA'            TO DP013-DB2-TABLE-NAME (1)       CL**3
249200         SET DP013-DB2-ABEND                                      CNKCS206
249300             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
249400                                   TO TRUE                        CNKCS206
249500         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
249600     END-IF.                                                      CNKCS206
249700                                                                  CNKCS206
249800/                                                                 CNKCS206
249900*----------------------------------------------------------------*CNKCS206
250000*  DELETE THE ROW FROM THE FACILITY LOCATION TABLE               *CNKCS206
250100*----------------------------------------------------------------*CNKCS206
250200 7400-DELETE-TFLAREA.                                                CL**3
250300                                                                  CNKCS206
250400     PERFORM                                                      CNKCS206
250500         WITH TEST AFTER                                          CNKCS206
250600         VARYING PV-RETRY-COUNTER                                 CNKCS206
250700         FROM 1 BY 1                                              CNKCS206
250800         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               CNKCS206
250900             OR (SQLCODE = +0))                                   CNKCS206
251000                                                                  CNKCS206
251100         EXEC SQL                                                 CNKCS206
251200             DELETE FROM TFLAREA                                     CL**3
251300             WHERE  OPER_UNT_ID   = :DK-OPER-UNT-ID                  CL**3
251400               AND  FCLTY_ID      = :DK-FCLTY-ID                     CL**3
251500               AND  FCLTY_AREA_ID = :DK-AREA-ID                      CL**3
251600         END-EXEC                                                 CNKCS206
251700                                                                  CNKCS206
251800         EVALUATE TRUE                                            CNKCS206
251900             WHEN SQLCODE = +0                                    CNKCS206
252000             WHEN SQLCODE = -904                                  CNKCS206
252100             WHEN SQLCODE = -913                                  CNKCS206
252200                 CONTINUE                                         CNKCS206
252300             WHEN SQLWARN0 NOT = SPACES                           CNKCS206
252400             WHEN SQLCODE < +0                                    CNKCS206
252500             WHEN SQLCODE > +0                                    CNKCS206
252600                 MOVE '7400-DELETE-TFLAREA'                          CL**3
252700                                   TO DP013-PARAGRAPH             CNKCS206
252800                 MOVE 'DELETE A ROW FROM TFLAREA'                    CL**3
252900                                   TO DP013-MESSAGE-TEXT(1)       CNKCS206
253000                 MOVE SQLCA        TO DP013-SQLCA                 CNKCS206
253100                 MOVE 'TFLAREA'    TO DP013-DB2-TABLE-NAME (1)       CL**3
253200                 SET DP013-DB2-ABEND                              CNKCS206
253300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           CNKCS206
253400                 PERFORM DP013-0000-PROCESS-ABEND                 CNKCS206
253500         END-EVALUATE                                             CNKCS206
253600     END-PERFORM.                                                 CNKCS206
253700                                                                  CNKCS206
253800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        CNKCS206
253900         MOVE '7400-DELETE-TFLAREA'                                  CL**3
254000                                   TO DP013-PARAGRAPH             CNKCS206
254100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              CNKCS206
254200                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
254300         MOVE 'TO DELETE A TFLAREA ROW'                              CL**3
254400                                   TO DP013-MESSAGE-TEXT (2)      CNKCS206
254500         MOVE SQLCA                TO DP013-SQLCA                 CNKCS206
254600         MOVE 'TFLAREA'            TO DP013-DB2-TABLE-NAME (1)       CL**3
254700         SET DP013-DB2-ABEND                                      CNKCS206
254800             DP013-XCTL-DISPLAY-RESTART                           CNKCS206
254900                                   TO TRUE                        CNKCS206
255000         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
255100     END-IF.                                                      CNKCS206
255200                                                                  CNKCS206
255300/                                                                 CNKCS206
255400*----------------------------------------------------------------*CNKCS206
255500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *CNKCS206
255600*----------------------------------------------------------------*CNKCS206
255700                                                                  CNKCS206
255800 9100-READ-SEL-QUEUE.                                             CNKCS206
255900     EXEC CICS                                                    CNKCS206
256000         READQ TS                                                 CNKCS206
256100             QUEUE (ASC-SEL-QUEUE-NAME)                           CNKCS206
256200             INTO  (CN005-TS-SEL-REC)                             CNKCS206
256300             ITEM  (ASC-SEL-ITEM)                                 CNKCS206
256400             RESP  (PV-CICS-RESPONSE)                             CNKCS206
256500     END-EXEC.                                                    CNKCS206
256600                                                                  CNKCS206
256700     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   CNKCS206
256800         CONTINUE                                                 CNKCS206
256900     ELSE                                                         CNKCS206
257000         SET DP013-LOGIC-ABEND                                    CNKCS206
257100             DP013-NO-ROLLBACK     TO TRUE                        CNKCS206
257200         MOVE '9100-READ-SEL-QUEUE'                               CNKCS206
257300                                   TO DP013-PARAGRAPH             CNKCS206
257400         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   CNKCS206
257500                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
257600         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
257700     END-IF.                                                      CNKCS206
257800                                                                  CNKCS206
257900/                                                                 CNKCS206
258000*----------------------------------------------------------------*CNKCS206
258100* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *CNKCS206
258200*----------------------------------------------------------------*CNKCS206
258300 9200-REWRITE-LIST-QUEUE.                                         CNKCS206
258400                                                                  CNKCS206
258500     EXEC CICS                                                    CNKCS206
258600          WRITEQ TS                                               CNKCS206
258700              QUEUE  (ASC-SEL-QUEUE-NAME)                         CNKCS206
258800              FROM   (CN005-TS-SEL-REC)                           CNKCS206
258900              ITEM   (ASC-SEL-ITEM)                               CNKCS206
259000              RESP   (PV-CICS-RESPONSE)                           CNKCS206
259100              REWRITE                                             CNKCS206
259200     END-EXEC.                                                    CNKCS206
259300                                                                  CNKCS206
259400     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               CNKCS206
259500         SET DP013-CICS-ABEND                                     CNKCS206
259600             DP013-NO-ROLLBACK     TO TRUE                        CNKCS206
259700         MOVE '9200-REWRITE-LIST-QUEUE'                           CNKCS206
259800                                   TO DP013-PARAGRAPH             CNKCS206
259900         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   CNKCS206
260000                                   TO DP013-MESSAGE-TEXT (1)      CNKCS206
260100         PERFORM DP013-0000-PROCESS-ABEND                         CNKCS206
260200     END-IF.                                                      CNKCS206
260300                                                                  CNKCS206
260400/                                                                 CNKCS206
260500*----------------------------------------------------------------*CNKCS206
260600*    ABEND PROCESSOR MODULE                                      *CNKCS206
260700*----------------------------------------------------------------*CNKCS206
260800                                                                  CNKCS206
260900     COPY DPPD013.                                                CNKCS206
