000100*-----------------------*                                         00010038
000200 IDENTIFICATION DIVISION.                                         00020039
000210*-----------------------*                                         00021039
000220 PROGRAM-ID.    CNKCS229.                                         00022039
000230 AUTHOR.        DEANNA BRANTNER.                                  00023039
000240 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00024039
000250 DATE-WRITTEN.  FEBRUARY, 2001                                    00025039
000260 DATE-COMPILED.                                                   00026039
000270                                                                  00027039
000280*---------------------------------------------------------------* 00028039
000290*    Y229 - TRAILER MANIFESTING - DC-DOOR TO STORE ASGNMT LIST    00029039
000300*---------------------------------------------------------------* 00030039
263455* CHANGED 11/02/2021    BY JIM HUNTER      WR: CHG0263455         00031046
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00032046
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00033046
263455*----------------------------------------------------------------*00034046
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00035047
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00036047
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00037047
CICS  *-----------------------------------------------------------------00038047
000400 ENVIRONMENT DIVISION.                                            00040039
000500 DATA DIVISION.                                                   00050039
000600                                                                  00060039
000700 WORKING-STORAGE SECTION.                                         00070039
000800                                                                  00080039
000900 01  DK-DB2-KEYS.                                                 00090039
001000     05  DK-TYPE-CODE              PIC  X(02) VALUE SPACES.       00100039
001100     05  DK-OPER-UNT-ID            PIC S9(04) COMP VALUE +0.      00110039
001200     05  DK-DOOR-ID                PIC  X(04) VALUE SPACES.       00120039
001300     05  DK-START-DTE.                                            00130039
001400         10  DK-MM                 PIC  X(02).                    00140039
001500         10  FILLER                PIC  X(01) VALUE '/'.          00150039
001600         10  DK-DD                 PIC  X(02).                    00160039
001700         10  FILLER                PIC  X(01) VALUE '/'.          00170039
001710         10  DK-CC                 PIC  X(04).                    00171039
001720     05  DK-START-TME.                                            00172039
001730         10  DK-HR                 PIC  X(02).                    00173039
001740         10  FILLER                PIC  X(01) VALUE ':'.          00174039
001750         10  DK-MN                 PIC  X(02).                    00175039
001760     05  DK-END-DTE.                                              00176039
001770         10  DK-END-MM              PIC  X(02).                   00177039
001780         10  FILLER                 PIC  X(01) VALUE '/'.         00178039
001790         10  DK-END-DD              PIC  X(02).                   00179039
001791         10  FILLER                 PIC  X(01) VALUE '/'.         00179139
001792         10  DK-END-CC              PIC  X(04).                   00179239
001793     05  DK-END-TME.                                              00179339
001794         10  DK-END-HR              PIC  X(02).                   00179439
001795         10  FILLER                 PIC  X(01) VALUE ':'.         00179539
001796         10  DK-END-MN              PIC  X(02).                   00179639
001810                                                                  00181001
001900 01  PC-PROGRAM-CONSTANTS.                                        00190001
002000     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK229  '.  00200001
002100     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM229 '.  00210001
002200     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS229'.  00220001
002500     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00250001
002600     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00260001
002700     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00270001
002800     05  PC-DETAIL-SCREEN          PIC  X(01)  VALUE '2'.         00280001
002900     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +10          00290016
003000                                               COMP SYNC.         00300001
003100     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00310001
003200                                               COMP SYNC.         00320001
003300     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00330001
003400                                               COMP-3.            00340001
003500     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00350001
003600                                               COMP SYNC.         00360001
003700     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00370001
003800                                               COMP-3.            00380001
003900     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00390001
004000     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00400001
004100     05  PC-D                      PIC  X(01)  VALUE 'D'.         00410039
004110     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00411039
004200     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00420001
004300     05  PC-01                     PIC  X(02)  VALUE '01'.        00430001
004310     05  PC-ACTIVE                 PIC  X(06)  VALUE 'ACTIVE'.    00431004
004320     05  PC-INACTV                 PIC  X(06)  VALUE 'INACTV'.    00432004
004330     05  PC-DEFAULT-TIMESTAMP      PIC  X(26)  VALUE              00433001
004340                                 '9999-09-09-09.09.09.999999'.    00434001
004400                                                                  00440001
004500*----------------------------------------------------------------*00450001
004600*  SYSTEM MESSAGES                                               *00460001
004700*----------------------------------------------------------------*00470001
004800*   00005 = INVALID VALUE                                        *00480001
004900*   00008 = MUST BE NUMERIC                                      *00490001
005000*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00500001
005100*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00510001
005200*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00520001
005300*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00530001
005400*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00540001
005500*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00550001
005600*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00560001
005700*   00069 - TOP OF LIST                                          *00570001
005800*   00070 - BOTTOM OF LIST                                       *00580001
005900*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00590007
006100*   00279 - MORE ITEMS TO DISPLAY                                *00610001
006600*----------------------------------------------------------------*00660001
006700     05  PC-TSYMSG-NUMBERS.                                       00670001
006800         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00680001
006900         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00690001
007000         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00700001
007100         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00710001
007200         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00720001
007300         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00730001
007400         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00740001
007500         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00750001
007600         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00760001
007700         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00770001
007800         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00780001
007900         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00790004
008100         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00810001
008600                                                                  00860001
008700 01  PS-PROGRAM-SWITCHES.                                         00870001
008800     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00880001
008900         88  PS-NO-ERROR                            VALUE 'Y'.    00890001
009000         88  PS-ERROR                               VALUE 'N'.    00900001
009100     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00910001
009200         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00920001
009300         88  PS-BLOCK-ERROR                         VALUE 'N'.    00930001
009400     05  PS-CONFIRM-PROCESSING-IND      PIC  X(01)  VALUE  'N'.   00940001
009500         88  PS-CONFIRM-PROCESSING                  VALUE  'Y'.   00950001
009600         88  PS-NOT-CONFIRM-PROCESSING              VALUE  'N'.   00960001
009700     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00970001
009800         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00980001
009900         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00990001
010000     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01000001
010100         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01010001
010200         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01020001
010300     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    01030001
010400         88  PS-LIST-END                            VALUE 'Y'.    01040001
010500         88  PS-NO-LIST-END                         VALUE 'N'.    01050001
010600*                                                                 01060001
010700 01  PV-PROGRAM-VARIABLES.                                        01070001
010800     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01080001
010900                                        COMP SYNC.                01090001
011000     05  PV-SUB                         PIC S9(04)  VALUE +0      01100001
011100                                                    COMP SYNC.    01110001
011200     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01120001
011300                                                    COMP SYNC.    01130001
011400     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01140001
011500                                                    COMP-3.       01150001
011600     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01160001
011700                                                    COMP-3.       01170001
011800     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01180001
011900                                                    COMP-3.       01190001
012000     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01200001
012100                                                    COMP-3.       01210001
012200     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01220001
012300                                                    COMP-3.       01230001
012400     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01240001
012500                                                    COMP-3.       01250001
012600     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01260001
012700                                                    COMP-3.       01270001
012800     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01280001
012900                                                    COMP SYNC.    01290001
013000     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01300001
013100                                                    COMP SYNC.    01310001
013200     05  PV-ITEM                        PIC S9(04)  VALUE +0      01320001
013300                                                    COMP SYNC.    01330001
013400     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01340001
013500                                                    COMP SYNC.    01350001
013600     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01360001
013700                                                    COMP SYNC.    01370001
013800     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01380001
013900                                                    COMP SYNC.    01390001
014000     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01400001
014100                                                    COMP SYNC.    01410001
014200     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01420001
014300                                                    COMP SYNC.    01430001
014400     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01440001
014500                                                    COMP SYNC.    01450001
014600     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01460001
014700                                                    COMP SYNC.    01470001
014800     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01480001
014900                                                    COMP SYNC.    01490001
015000     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01500001
015100                                                    COMP SYNC.    01510001
015200     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01520001
015300                                                    COMP SYNC.    01530001
015400     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01540001
015500                                                    COMP SYNC.    01550001
015600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01560001
015700                                                    COMP SYNC.    01570001
015800     05  PV-SOFT-ABORT-MSG.                                       01580001
015900         10  FILLER            PIC X(12) VALUE ' CNKCS229 - '.    01590001
016000         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01600001
016100         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01610001
016200         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01620001
016300         10  PV-SOFT-PARAGRAPH PIC X(30).                         01630001
016400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01640001
016500                                                     COMP SYNC.   01650001
016600     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01660001
016700     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01670001
016800     05  PV-CICS-MSG-HOLD.                                        01680001
016900         10  FILLER                      PIC  X(01)  VALUE SPACE. 01690001
017000         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 01700001
017100     05  PV-CICS-MSG-HOLD2.                                       01710001
017200         10  FILLER                      PIC  X(01)  VALUE SPACE. 01720001
017300         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 01730001
017400                                                                  01740001
017500     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01750001
017600                                                     COMP SYNC.   01760001
017700     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01770001
017800     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01780001
018100                                                                  01810001
018200******************************************************************01820001
018300**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01830001
018400**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01840001
018500**  APPLICATION-SPECIFIC COMMAREA.                              **01850001
018600******************************************************************01860001
018700 01  LQW-LIST-QUEUE-WORK-AREA.                                    01870001
018800     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01880001
018900     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           01890001
019000                                        INDEXED BY LQW-IDX.       01900001
019100         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01910001
019200         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01920001
019300         10  LQW-SELECTED-SW            PIC  X(01).               01930001
019400             88  LQW-SELECT                         VALUE 'S'.    01940001
019500             88  LQW-DESELECT                       VALUE ' '.    01950001
019600         10  LQW-ACTION                 PIC  X(03).               01960001
019700             88  LQW-DEL                            VALUE 'DEL'.  01970001
019800             88  LQW-INQ                            VALUE 'INQ'.  01980001
019900             88  LQW-UPD                            VALUE 'UPD'.  01990001
020000             88  LQW-ERR                            VALUE 'ERR'.  02000001
020200         10  LQW-DOOR-ID                PIC  X(04).               02020036
020300         10  LQW-TYPE-CODE              PIC  X(02).               02030007
020301         10  LQW-TYPE-CODE-DESC         PIC  X(30).               02030126
020310         10  LQW-LOC-DESC               PIC  X(30).               02031007
020320         10  LQW-LANE-ASGNMT            PIC  9(09).               02032007
020330         10  LQW-DIVERT-LOC             PIC  X(04).               02033034
020331         10  LQW-LBL-SEQ                PIC  9(04).               02033134
020340         10  LQW-STOR-ASGNMT            PIC  X(05).               02034007
020400                                                                  02040007
020500*---------------------------------------------------------------* 02050007
020600* SELECTION QUEUE LAYOUT                                        * 02060007
020700*---------------------------------------------------------------* 02070007
020800     COPY CNWS013.                                                02080007
020900                                                                  02090007
021500*---------------------------------------------------------------* 02150001
021600*    MAP LAYOUT                                                 * 02160001
021700*---------------------------------------------------------------* 02170001
021800     COPY CNKM229.                                                02180001
021900*                                                                 02190001
022000 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK229O.       02200001
022100     05  FILLER                         PIC X(199).               02210038
022200     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          02220001
022300*        10  MR-SELECTL                 PIC S9(04) COMP.          02230001
022400*        10  MR-SELECTA                 PIC  X(01).               02240001
022500*        10  MR-SELECTC                 PIC  X(01).               02250001
022600*        10  MR-SELECTH                 PIC  X(01).               02260001
022700*        10  MR-SELECTI                 PIC  X(01).               02270001
022800*                                                                 02280001
022900*        10  MR-ACTIONL                 PIC S9(04) COMP.          02290001
023000*        10  MR-ACTIONA                 PIC  X(01).               02300001
023100*        10  MR-ACTIONC                 PIC  X(01).               02310001
023200*        10  MR-ACTIONH                 PIC  X(01).               02320001
023300*        10  MR-ACTION                  PIC  X(03).               02330001
023400                                                                  02340001
023500         10  MR-STATUSL                 PIC S9(04) COMP.          02350001
023600         10  MR-STATUSA                 PIC  X(01).               02360001
023700         10  MR-STATUSC                 PIC  X(01).               02370001
023800         10  MR-STATUSH                 PIC  X(01).               02380001
023900         10  MR-STATUS                  PIC  X(06).               02390001
024000                                                                  02400001
024100         10  MR-STORE-NBRL             PIC S9(04) COMP.           02410001
024200         10  MR-STORE-NBRA             PIC  X(01).                02420001
024300         10  MR-STORE-NBRC             PIC  X(01).                02430001
024400         10  MR-STORE-NBRH             PIC  X(01).                02440001
024500         10  MR-STORE-NBR              PIC  Z(04).                02450017
024600                                                                  02460001
024610         10  MR-STORE-NAMEL            PIC S9(04) COMP.           02461001
024620         10  MR-STORE-NAMEA            PIC  X(01).                02462001
024630         10  MR-STORE-NAMEC            PIC  X(01).                02463001
024640         10  MR-STORE-NAMEH            PIC  X(01).                02464001
024650         10  MR-STORE-NAME             PIC  X(10).                02465001
024660                                                                  02466001
024670         10  MR-START-DATEL            PIC S9(04) COMP.           02467001
024680         10  MR-START-DATEA            PIC  X(01).                02468001
024690         10  MR-START-DATEC            PIC  X(01).                02469001
024691         10  MR-START-DATEH            PIC  X(01).                02469101
024692         10  MR-START-DATE             PIC  X(10).                02469201
024693                                                                  02469301
024694         10  MR-START-TIMEL            PIC S9(04) COMP.           02469401
024695         10  MR-START-TIMEA            PIC  X(01).                02469501
024696         10  MR-START-TIMEC            PIC  X(01).                02469601
024697         10  MR-START-TIMEH            PIC  X(01).                02469701
024698         10  MR-START-TIME             PIC  X(05).                02469801
024699                                                                  02469901
024700         10  MR-END-DATEL              PIC S9(04) COMP.           02470001
024701         10  MR-END-DATEA              PIC  X(01).                02470101
024702         10  MR-END-DATEC              PIC  X(01).                02470201
024703         10  MR-END-DATEH              PIC  X(01).                02470301
024704         10  MR-END-DATE               PIC  X(10).                02470401
024705                                                                  02470501
024706         10  MR-END-TIMEL              PIC S9(04) COMP.           02470601
024707         10  MR-END-TIMEA              PIC  X(01).                02470701
024708         10  MR-END-TIMEC              PIC  X(01).                02470801
024709         10  MR-END-TIMEH              PIC  X(01).                02470901
024710         10  MR-END-TIME               PIC  X(05).                02471001
024712                                                                  02471201
024713         10  MR-USERIDL                PIC S9(04) COMP.           02471301
024714         10  MR-USERIDA                PIC  X(01).                02471401
024715         10  MR-USERIDC                PIC  X(01).                02471501
024716         10  MR-USERIDH                PIC  X(01).                02471601
024717         10  MR-USERID                 PIC  X(08).                02471701
024718                                                                  02471801
024720     05  FILLER                         PIC  X(12).               02472001
024800                                                                  02480001
025500*---------------------------------------------------------------* 02550001
025600*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02560001
025700*---------------------------------------------------------------* 02570001
025800     COPY DPWS015.                                                02580001
025900                                                                  02590001
026000*---------------------------------------------------------------* 02600001
026100*    FUNCTION KEYS COPYBOOK.                                    * 02610001
026200*---------------------------------------------------------------* 02620001
026300     COPY DPWS016.                                                02630001
026400                                                                  02640001
026500*---------------------------------------------------------------* 02650001
026600*    NUMERIC EDIT LAYOUT.                                       * 02660001
026700*---------------------------------------------------------------* 02670001
026800     COPY DPWS010I.                                               02680001
026900                                                                  02690001
027000*---------------------------------------------------------------* 02700001
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02710047
027200*---------------------------------------------------------------* 02720001
027300     COPY DPWS030.                                                02730001
CICS       COPY DPWS930.                                                02731047
027400                                                                  02740001
027500*---------------------------------------------------------------* 02750001
027600*    STANDARD COMMAREA.                                         * 02760001
027700*---------------------------------------------------------------* 02770001
027800     COPY DPWS020.                                                02780001
027900     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02790001
028000                                                                  02800001
028100*---------------------------------------------------------------* 02810001
028200* INTER-APPLICATION COMMAREA.                                   * 02820001
028300*   CNWS011 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02830001
028400*             SPEC SCREEN.                                      * 02840001
028500*   CNWS012 - IS THE INPUT LAYOUT WHEN COMING FROM THE OTHER    * 02850007
028600*             SCREENS.                                          * 02860007
028700*---------------------------------------------------------------* 02870001
028800         10  INTER-APPL-COMM-AREA       PIC X(200).               02880001
028900     COPY CNWS011.                                                02890001
029000     COPY CNWS012.                                                02900007
029100                                                                  02910001
029200*---------------------------------------------------------------* 02920001
029300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02930001
029400*---------------------------------------------------------------* 02940001
029500         10  ASC-SPECIFIC-COMMAREA.                               02950001
029510             15  ASC-ACTION                   PIC  X(03).         02951028
029600             15  ASC-FUNCTION                 PIC  X(01).         02960001
029610             15  ASC-CURR-OPER-UNT-ID         PIC  9(04).         02961001
029700             15  ASC-CURR-FCLTY-ID            PIC  9(04).         02970001
029701             15  ASC-OPER-UNT-ID              PIC  9(04).         02970101
029702             15  ASC-FCLTY-ID                 PIC  9(04).         02970201
029800             15  ASC-FCLTY-NAME               PIC  X(25).         02980001
029900             15  ASC-DOOR-ID                  PIC  X(04).         02990018
030000             15  ASC-TYPE-CODE                PIC  X(02).         03000004
030100             15  ASC-TYPE-CODE-DESC           PIC  X(30).         03010026
030110             15  ASC-LOC-DESC                 PIC  X(30).         03011026
030200             15  ASC-DIVERT-CODE              PIC  9(09).         03020018
030201             15  ASC-DIVERT-CODE-X REDEFINES ASC-DIVERT-CODE.     03020118
030202                 20  ASC-DIVERT-CODE-N        PIC  Z(09).         03020218
030210             15  ASC-DIVERT-LOC               PIC  X(04).         03021034
030211             15  ASC-LABEL-SEQ                PIC  X(04).         03021134
030220             15  ASC-LABEL-SEQ-X REDEFINES ASC-LABEL-SEQ.         03022018
030230                 20  ASC-LABEL-SEQ-N          PIC  Z(04).         03023018
030400             15  ASC-STOR-ASGNMT              PIC  X(05).         03040008
030500             15  ASC-START-TIMESTAMP.                             03050001
030600                 20  ASC-CENTURY           PIC  X(04).            03060001
030700                 20  FILLER                PIC  X(01).            03070001
030800                 20  ASC-MONTH             PIC  X(02).            03080001
030810                 20  FILLER                PIC  X(01).            03081001
030820                 20  ASC-DAY               PIC  X(02).            03082001
030830                 20  FILLER                PIC  X(01).            03083001
030840                 20  ASC-HOUR              PIC  X(02).            03084001
030850                 20  FILLER                PIC  X(01).            03085001
030860                 20  ASC-MINUTE            PIC  X(02).            03086001
030870                 20  ASC-REST              PIC  X(10).            03087001
030899             15  ASC-END-TIMESTAMP.                               03089901
030900                 20  ASC-END-CENTURY        PIC  X(04).           03090001
030901                 20  FILLER                 PIC  X(01).           03090101
030902                 20  ASC-END-MONTH          PIC  X(02).           03090201
030903                 20  FILLER                 PIC  X(01).           03090301
030904                 20  ASC-END-DAY            PIC  X(02).           03090401
030905                 20  FILLER                 PIC  X(01).           03090501
030906                 20  ASC-END-HOUR           PIC  X(02).           03090601
030907                 20  FILLER                 PIC  X(01).           03090701
030908                 20  ASC-END-MINUTE         PIC  X(02).           03090801
030909                 20  ASC-END-REST           PIC  X(10).           03090901
030910             15  ASC-BLK-SUB                PIC S9(04) COMP SYNC. 03091001
031100             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03110001
031200                                                         SYNC.    03120001
031300             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03130001
031400             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03140001
031500             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03150001
031600             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03160001
031700             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03170001
031800             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03180001
031900                                                         SYNC.    03190001
032000             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03200001
032100             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03210001
032200             15  ASC-XCNTL-TO-RESEND-SW       PIC  X(01).         03220001
032300                 88  ASC-XCNTL-TO-RESEND           VALUE 'Y'.     03230001
032400                 88  ASC-XCNTL-TO-RESEND-NO        VALUE 'N'.     03240001
032500             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03250001
032600                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03260001
032700                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03270001
032800             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03280001
032900                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03290001
033000                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03300001
033100             15  ASC-LIST-QUEUE-NAME.                             03310001
033200                 20  ASC-LIST-TERM-ID         PIC  X(04).         03320001
033300                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03330001
033400                 20  ASC-LIST-SEQ             PIC  9(01).         03340001
033500                                                                  03350001
033600             15  ASC-START-ITEM-REQUEST.                          03360001
033700                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03370001
033800                                                                  03380001
033900             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03390001
034000             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03400001
034100             15  ASC-CURSOR-SW                PIC  X(02).         03410001
034200                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03420001
034300                 88  ASC-DOOR-TO-STORE-CSR           VALUE 'A '.  03430007
034500*                                                                 03450001
034600             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03460001
034700                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03470001
034800             15  ASC-SEL-QUEUE-NAME.                              03480001
034900                 20  ASC-SEL-TERM-ID          PIC  X(04).         03490001
035000                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03500001
035100                 20  ASC-SEL-SEQ              PIC  9(01).         03510001
035200             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03520001
035300                                                                  03530001
035400*-----------------------------------------------------------------03540001
035500             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03550001
035600                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03560001
035700                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03570001
035800                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03580001
035900                                                                  03590001
036000                 20  ASC-ITEM-ARRAY.                              03600001
036100                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        03610015
036200                         30  ASC-LIST-ITEM-NUMBER                 03620001
036300                                                     PIC S9(09)   03630001
036400                                                     COMP-3.      03640001
036500                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03650007
036600                             88  ASC-VALID-SELECT    VALUE ' '    03660007
036700                                                           'S'    03670007
036800                                                           'B'    03680007
036900                                                           'E'.   03690007
037000                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03700007
037100                             88  ASC-TEMP-SELECT     VALUE 'S'.   03710007
037200                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03720007
037300                             88  ASC-TEMP-END        VALUE 'E'.   03730007
037400                         30  ASC-SELECTED-SW         PIC  X(01).  03740007
037500                             88  ASC-NO-SELECT       VALUE ' '.   03750007
037600                             88  ASC-SELECT          VALUE 'S'.   03760007
037700                             88  ASC-BEGIN           VALUE 'B'.   03770007
037800                             88  ASC-END             VALUE 'E'.   03780007
038000                         30  ASC-STATUS              PIC  X(06).  03800001
038100                         30  ASC-STORE-NBR           PIC  9(04).  03810001
038200                         30  ASC-STORE-NAME          PIC  X(10).  03820001
038300                         30  ASC-START-DATE          PIC  X(10).  03830001
038400                         30  ASC-START-TIME          PIC  X(05).  03840001
038410                         30  ASC-END-DATE            PIC  X(10).  03841001
038420                         30  ASC-END-TIME            PIC  X(05).  03842001
038430                         30  ASC-USERID              PIC  X(08).  03843004
038500                                                                  03850007
038600*---------------------------------------------------------------* 03860001
038700*    ABEND PROCESSING COPYBOOK.                                 * 03870001
038800*---------------------------------------------------------------* 03880001
038900     COPY DPWS013.                                                03890001
039000                                                                  03900001
039100*---------------------------------------------------------------* 03910001
039200*    TCNDRTY -  DOOR TYPE TABLE                                   03920001
039300*---------------------------------------------------------------* 03930001
039400     EXEC SQL                                                     03940001
039500          INCLUDE TCNDRTY                                         03950001
039600     END-EXEC.                                                    03960001
039700                                                                  03970001
039710*---------------------------------------------------------------* 03971001
039720*    TCNDCDR -  DC DOORS TABLE                                    03972001
039730*---------------------------------------------------------------* 03973001
039740     EXEC SQL                                                     03974001
039750          INCLUDE TCNDCDR                                         03975001
039760     END-EXEC.                                                    03976001
039770                                                                  03977001
039780*---------------------------------------------------------------* 03978001
039790*    TCNDRST -  DOOR TO STORE TABLE                               03979001
039791*---------------------------------------------------------------* 03979101
039792     EXEC SQL                                                     03979201
039793          INCLUDE TCNDRST                                         03979301
039794     END-EXEC.                                                    03979401
039795                                                                  03979501
039796*---------------------------------------------------------------* 03979601
039797*    XLT00010 - XLT_LOC - LOCATION TABLE                          03979744
039798*---------------------------------------------------------------* 03979801
039799     EXEC SQL                                                     03979901
039800          INCLUDE XLT00010                                        03980044
039801     END-EXEC.                                                    03980101
039802                                                                  03980201
041100*---------------------------------------------------------------* 04110001
041200*    DOOR TO STORE CURSOR                                         04120001
041300*---------------------------------------------------------------* 04130001
041400     EXEC SQL                                                     04140001
041500        DECLARE DOOR-TO-STORE-CSR CURSOR FOR                      04150001
041600           SELECT A.STR_NBR                                       04160001
041700                 ,A.STRT_TMST                                     04170001
041710                 ,A.END_TMST                                      04171001
041720                 ,A.CRE_USR_ID                                    04172001
041730                 ,B.LOC_10_ABBR_NM                                04173044
041800           FROM  TCNDRST A                                        04180003
041810                ,XLT_LOC B                                        04181044
041900          WHERE  A.OPER_UNT_ID = :DK-OPER-UNT-ID                  04190002
042000            AND  A.DOOR_ID     = :DK-DOOR-ID                      04200002
042010            AND  A.STR_NBR     = B.LOC_NBR                        04201044
042100        ORDER BY A.END_TMST DESC                                  04210001
042200                ,A.STRT_TMST                                      04220001
042300     END-EXEC.                                                    04230001
042400                                                                  04240001
042500*---------------------------------------------------------------* 04250001
042600*    DB2 AREA FOR COMMUNICATIONS                                * 04260001
042700*---------------------------------------------------------------* 04270001
042800     EXEC SQL                                                     04280001
042900          INCLUDE SQLCA                                           04290001
043000     END-EXEC.                                                    04300001
043100                                                                  04310001
043200***************************************************************** 04320001
043300 LINKAGE SECTION.                                                 04330001
043400                                                                  04340001
043500 01  DFHCOMMAREA.                                                 04350001
043600     05  FILLER                         OCCURS  1 TO 4072 TIMES   04360001
043700                                        DEPENDING ON EIBCALEN.    04370001
043800         10  FILLER                     PIC X.                    04380001
043900                                                                  04390001
044000                                                                  04400001
044100 PROCEDURE DIVISION.                                              04410001
044200******************************************************************04420001
044300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **04430001
044400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **04440001
044500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **04450001
044600******************************************************************04460001
044700 0000-MAIN-MODULE.                                                04470001
044800     INITIALIZE DP030-CICS-API-FIELDS.                            04480001
044900     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04490001
045000     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04500001
045100     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04510001
045200     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04520001
045300     MOVE LENGTH OF CNK229I        TO DP030-MAP-LENGTH (1).       04530001
045400     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     04540001
045500     PERFORM 0001-CALL-CICS-ARCH-API.                             04550001
045600*                                                                 04560001
045700     PERFORM 1000-CONTROL-PROCESSING                              04570001
045800*                                                                 04580001
045900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     04590001
046000     PERFORM 0001-CALL-CICS-ARCH-API.                             04600001
046100                                                                  04610001
046200******************************************************************04620001
046300**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **04630001
046400**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **04640001
046500******************************************************************04650001
046600 0001-CALL-CICS-ARCH-API.                                         04660001
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      04670047
046800                                    DFHCOMMAREA                   04680047
046900                                    DP030-CICS-API-FIELDS         04690047
047000                                    DP020-STANDARD-COMMAREA       04700047
047100                                    CNK229I.                      04710047
047200*                                                                 04720001
047300     IF  DP030-RC-CALL-SUCCESSFUL                                 04730001
047400         CONTINUE                                                 04740001
047500     ELSE                                                         04750001
047600         SET DP013-NO-ROLLBACK                                    04760001
047700             DP013-XCTL-DISPLAY-RESTART                           04770001
047800             DP013-CICS-ABEND      TO TRUE                        04780001
047900         MOVE '0001-CALL-CICS-ARCH-API'                           04790001
048000                                   TO DP013-PARAGRAPH             04800001
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O04801047
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      04802047
048300         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      04830001
048400         PERFORM DP013-0000-PROCESS-ABEND                         04840001
048500     END-IF.                                                      04850001
048600                                                                  04860001
048700*----------------------------------------------------------------*04870001
048800* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *04880001
048900* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *04890001
049000*                                                                *04900001
049100* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *04910001
049200*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *04920001
049300*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *04930001
049400*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *04940001
049500*----------------------------------------------------------------*04950001
049600 1000-CONTROL-PROCESSING.                                         04960001
049700     EVALUATE TRUE                                                04970001
049800         WHEN DP020-NEXT-ACT-INITIAL                              04980001
049900             INITIALIZE ASC-SPECIFIC-COMMAREA                     04990001
050000             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 05000001
050100                                 ASC-SEL-TERM-ID                  05010001
050200             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   05020001
050300                                           ASC-SEL-TASK-NUMBER    05030001
050400             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               05040001
050500             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                05050001
050600             PERFORM 1100-PROCESS-INTER-APPL-COMM                 05060001
050610             PERFORM 3020-RETRIEVE-TYPE-CODE-DESC                 05061026
050700             PERFORM 4000-BUILD-INITIAL-PANEL                     05070013
050800                                                                  05080001
050900         WHEN DP020-NEXT-ACT-READ-MAP                             05090001
051000             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05100001
051100             PERFORM 2000-PROCESS-PANEL                           05110001
051200                                                                  05120001
051300         WHEN DP020-NEXT-ACT-RETURN                               05130001
051400             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         05140001
051500             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    05150001
051600                                                                  05160001
051700         IF  ASC-XCNTL-TO-RESEND                                  05170001
051800             PERFORM 2050-DELETE-LIST-QUEUE                       05180001
051900             PERFORM 4000-BUILD-INITIAL-PANEL                     05190001
052100             PERFORM 3200-RESET-ATTRIBUTES                        05210001
052200             SET ASC-XCNTL-TO-RESEND-NO  TO TRUE                  05220001
052300         END-IF                                                   05230001
052400                                                                  05240001
052500             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 05250001
052600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05260001
052700                                                                  05270001
052800         WHEN OTHER                                               05280001
052900             SET DP013-LOGIC-ABEND TO TRUE                        05290001
053000             SET DP013-NO-ROLLBACK TO TRUE                        05300001
053100             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    05310001
053200             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    05320001
053300                                   TO DP013-MESSAGE-TEXT(1)       05330001
053400             PERFORM DP013-0000-PROCESS-ABEND                     05340001
053500     END-EVALUATE.                                                05350001
053600                                                                  05360001
053700*----------------------------------------------------------------*05370001
053800* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *05380001
053900* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *05390001
054000*----------------------------------------------------------------*05400001
054100 1100-PROCESS-INTER-APPL-COMM.                                    05410001
054200                                                                  05420001
054300     SET PS-COMMAREA-VALID         TO TRUE.                       05430001
054400     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     05440001
054500                                                                  05450001
054600     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          05460007
054700         MOVE CN011-CURR-OPER-UNT-ID   TO ASC-CURR-OPER-UNT-ID    05470007
054800         MOVE CN011-CURR-FCLTY-ID      TO ASC-CURR-FCLTY-ID       05480007
054810         MOVE CN011-OPER-UNT-ID        TO ASC-OPER-UNT-ID         05481007
054820         MOVE CN011-FCLTY-ID           TO ASC-FCLTY-ID            05482007
054900         MOVE CN011-FCLTY-NME          TO ASC-FCLTY-NAME          05490007
055000         MOVE CN011-DOOR-ID            TO ASC-DOOR-ID             05500034
055100         MOVE CN011-DOOR-TYPE-CDE      TO ASC-TYPE-CODE           05510007
055200         MOVE CN011-DIVERT-CODE        TO ASC-DIVERT-CODE-N       05520018
055210         MOVE CN011-DIVERT-LOC-ID      TO ASC-DIVERT-LOC          05521034
055300         MOVE CN011-LABEL-SEQ          TO ASC-LABEL-SEQ-N         05530018
055310         MOVE PC-INQ                   TO ASC-ACTION              05531028
055400     ELSE                                                         05540007
055500         SET ASC-USE-SELECTION-QUEUE TO TRUE                      05550030
055501         MOVE CN012-NUMBER-OF-SELECTED-ITEMS TO                   05550130
055502                                      ASC-NUMBER-OF-SELECTED-ITEMS05550230
055503         MOVE CN012-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  05550330
055504         MOVE CN012-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME      05550430
055510         MOVE CN012-CURR-OPER-UNT-ID   TO ASC-CURR-OPER-UNT-ID    05551013
055600         MOVE CN012-CURR-FCLTY-ID      TO ASC-CURR-FCLTY-ID       05560007
055700         MOVE CN012-OPER-UNT-ID        TO ASC-OPER-UNT-ID         05570007
055800         MOVE CN012-FCLTY-ID           TO ASC-FCLTY-ID            05580007
055801         MOVE CN012-FUNCTION           TO ASC-FUNCTION            05580113
055810         PERFORM 1120-PREPARE-LIST-ENTRY                          05581013
055900     END-IF.                                                      05590008
056200                                                                  05620001
056201*-----------------------------------------------------------------05620113
056202*  PREPARE LIST ENTRY                                             05620213
056203*-----------------------------------------------------------------05620313
056210 1120-PREPARE-LIST-ENTRY.                                         05621013
056220                                                                  05622013
056230     MOVE CN013-MAX-ITEMS          TO ASC-SEL-SUB.                05623013
056240     MOVE ZERO                     TO ASC-SEL-ITEM.               05624013
056250     PERFORM 1130-GET-NEXT-RECORD.                                05625013
056260                                                                  05626013
056270*-----------------------------------------------------------------05627013
056280*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*05628013
056290*-----------------------------------------------------------------05629013
056291 1130-GET-NEXT-RECORD.                                            05629113
056293     ADD +1                       TO ASC-SEL-SUB.                 05629313
056294                                                                  05629413
056295     IF  ASC-SEL-SUB > CN013-MAX-ITEMS                            05629513
056296         ADD +1                   TO ASC-SEL-ITEM                 05629613
056297         MOVE +1                  TO ASC-SEL-SUB                  05629713
056298     END-IF.                                                      05629813
056299                                                                  05629913
056300     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                05630013
056301         PERFORM 9100-READ-SEL-QUEUE                              05630113
056302         IF  CN013-ITEM (ASC-SEL-SUB) > ZERO                      05630213
056309             MOVE CN013-ACTION-SW (ASC-SEL-SUB)  TO ASC-ACTION    05630928
056310             MOVE CN013-DOOR-ID (ASC-SEL-SUB)    TO ASC-DOOR-ID   05631035
056311             MOVE CN013-TYPE-CODE (ASC-SEL-SUB)  TO ASC-TYPE-CODE 05631122
056312             MOVE CN013-LOC-DESC  (ASC-SEL-SUB)  TO ASC-LOC-DESC  05631222
056313             MOVE CN013-LANE-ASGNMT (ASC-SEL-SUB)                 05631322
056314                                             TO ASC-DIVERT-CODE-N 05631422
056315             MOVE CN013-DIVERT-LOC-ID (ASC-SEL-SUB)               05631534
056316                                               TO ASC-DIVERT-LOC  05631634
056317             MOVE CN013-LBL-SEQ-NBR (ASC-SEL-SUB)                 05631734
056318                                               TO ASC-LABEL-SEQ-N 05631834
056319             MOVE CN013-STORE-ASGNMT (ASC-SEL-SUB)                05631934
056320                                               TO ASC-STOR-ASGNMT 05632034
056336             SET CN013-INQ (ASC-SEL-SUB) TO TRUE                  05633613
056338             PERFORM 9200-REWRITE-SEL-QUEUE                       05633813
056339         ELSE                                                     05633913
056340             SUBTRACT +1 FROM ASC-SEL-SUB                         05634013
056341             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             05634113
056342             SET DP020-MSG-INFORMATIONAL                          05634213
056343                 PS-LIST-END             TO TRUE                  05634313
056344         END-IF                                                   05634413
056345     ELSE                                                         05634513
056346         SUBTRACT +1 FROM ASC-SEL-ITEM                            05634613
056347         MOVE CN013-MAX-ITEMS     TO ASC-SEL-SUB                  05634713
056348         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             05634813
056349         SET DP020-MSG-INFORMATIONAL                              05634913
056350             PS-LIST-END             TO TRUE                      05635013
056351     END-IF.                                                      05635113
056352                                                                  05635213
056354*----------------------------------------------------------------*05635413
056355*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *05635513
056356*    PROCESSED.                                                  *05635613
056357*----------------------------------------------------------------*05635713
056359 1140-GET-PREV-RECORD.                                            05635921
056361     SUBTRACT +1 FROM ASC-SEL-SUB.                                05636113
056362                                                                  05636213
056363     IF  ASC-SEL-SUB < +1                                         05636313
056364         SUBTRACT +1 FROM ASC-SEL-ITEM                            05636413
056365         MOVE CN013-MAX-ITEMS     TO ASC-SEL-SUB                  05636513
056366     END-IF.                                                      05636613
056367                                                                  05636713
056368     IF  ASC-SEL-ITEM > ZERO                                      05636813
056369         PERFORM 9100-READ-SEL-QUEUE                              05636913
056370         MOVE CN013-ACTION-SW (ASC-SEL-SUB)  TO ASC-ACTION        05637028
056371         MOVE CN013-DOOR-ID (ASC-SEL-SUB)    TO ASC-DOOR-ID       05637134
056372         MOVE CN013-TYPE-CODE (ASC-SEL-SUB)  TO ASC-TYPE-CODE     05637222
056373         MOVE CN013-LOC-DESC  (ASC-SEL-SUB)  TO ASC-LOC-DESC      05637322
056374         MOVE CN013-LANE-ASGNMT (ASC-SEL-SUB) TO ASC-DIVERT-CODE-N05637422
056375         MOVE CN013-DIVERT-LOC-ID (ASC-SEL-SUB) TO ASC-DIVERT-LOC 05637535
056377         MOVE CN013-LBL-SEQ-NBR (ASC-SEL-SUB) TO ASC-LABEL-SEQ-N  05637734
056378         MOVE CN013-STORE-ASGNMT (ASC-SEL-SUB) TO ASC-STOR-ASGNMT 05637834
056410         SET CN013-INQ (ASC-SEL-SUB) TO TRUE                      05641013
056412         PERFORM 9200-REWRITE-SEL-QUEUE                           05641213
056413     ELSE                                                         05641313
056414         MOVE +1                  TO ASC-SEL-ITEM                 05641413
056415                                     ASC-SEL-SUB                  05641513
056416         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             05641613
056417         SET DP020-MSG-INFORMATIONAL                              05641713
056418             PS-LIST-END             TO TRUE                      05641813
056419     END-IF.                                                      05641913
056420                                                                  05642013
056421*----------------------------------------------------------------*05642101
056430* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *05643001
056500* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *05650001
056600* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *05660001
056700* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *05670001
056800* FUNCTION KEYS CAN GET THIS FAR.                                *05680001
056900*----------------------------------------------------------------*05690001
057000 2000-PROCESS-PANEL.                                              05700001
057100     EVALUATE TRUE                                                05710001
057200         WHEN DP020-SRC-AID = DP016-CLEAR                         05720001
057300             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                05730001
057400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05740001
057500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05750001
057600                                                                  05760001
057700         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    05770001
057800             PERFORM 2050-DELETE-LIST-QUEUE                       05780001
057900             PERFORM 4000-BUILD-INITIAL-PANEL                     05790001
058000                                                                  05800001
058100*F20-NEXT SEL                                                     05810029
058200         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             05820029
058300             IF  ASC-USE-SELECTION-QUEUE                          05830029
058400                 PERFORM 1130-GET-NEXT-RECORD                     05840029
058500                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               05850029
058700                 IF PS-LIST-END                                   05870029
058800                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05880029
058810                     SET PS-NO-LIST-END TO TRUE                   05881029
058820                 ELSE                                             05882029
058821                     PERFORM 2050-DELETE-LIST-QUEUE               05882133
058830                     PERFORM 4000-BUILD-INITIAL-PANEL             05883029
058840                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05884029
058850                     PERFORM 3200-RESET-ATTRIBUTES                05885029
058860                 END-IF                                           05886029
058870             ELSE                                                 05887029
058880*                --- BOTTOM OF LIST ---                           05888029
058890                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         05889029
058891                 SET DP020-MSG-INFORMATIONAL TO TRUE              05889129
058892             END-IF                                               05889229
058893                                                                  05889329
058894*F19-PREV SEL                                                     05889429
058895         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             05889529
058896             IF  ASC-USE-SELECTION-QUEUE                          05889629
058897                 PERFORM 1140-GET-PREV-RECORD                     05889729
058898                 PERFORM 3000-EDIT-DATA-IN-COMMAREA               05889829
058900                 IF PS-LIST-END                                   05890029
058901                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05890129
058902                     SET PS-NO-LIST-END TO TRUE                   05890229
058903                 ELSE                                             05890329
058904                     PERFORM 2050-DELETE-LIST-QUEUE               05890433
058905                     PERFORM 4000-BUILD-INITIAL-PANEL             05890529
058906                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         05890629
058907                     PERFORM 3200-RESET-ATTRIBUTES                05890729
058908                 END-IF                                           05890829
058909             ELSE                                                 05890929
058910                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         05891029
058911                 SET DP020-MSG-INFORMATIONAL TO TRUE              05891129
058912             END-IF                                               05891229
058913                                                                  05891329
058920         WHEN OTHER                                               05892001
059000             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 05900001
059100             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05910001
059200             IF  PS-NO-ERROR                                      05920001
059300                 SET DP030-CONTINUE-GO TO TRUE                    05930001
059400                 PERFORM 2100-CHECK-FUNCTION-KEY                  05940001
059500             ELSE                                                 05950001
059600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             05960001
059700                 SET DP030-OVERRIDE-GO TO TRUE                    05970001
059800             END-IF                                               05980001
059900     END-EVALUATE.                                                05990001
060000                                                                  06000001
060100*----------------------------------------------------------------*06010001
060200*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *06020001
060300*----------------------------------------------------------------*06030001
060400 2050-DELETE-LIST-QUEUE.                                          06040001
060500                                                                  06050001
060600     EXEC CICS                                                    06060001
060700         DELETEQ TS                                               06070001
060800             QUEUE (ASC-LIST-QUEUE-NAME)                          06080001
060900             RESP  (PV-CICS-RESP)                                 06090001
061000     END-EXEC.                                                    06100001
061100                                                                  06110001
061200     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       06120001
061300        (PV-CICS-RESP = DFHRESP(QIDERR))                          06130001
061400         CONTINUE                                                 06140001
061500     ELSE                                                         06150001
061600         SET DP013-CICS-ABEND      TO TRUE                        06160001
061700         SET DP013-NO-ROLLBACK     TO TRUE                        06170001
061800                                                                  06180001
061900         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         06190001
062000         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    06200001
062100                                   TO DP013-MESSAGE-TEXT (1)      06210001
062200         PERFORM DP013-0000-PROCESS-ABEND                         06220001
062300     END-IF.                                                      06230001
062400                                                                  06240001
062500     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       06250001
062600                                                                  06260001
062700*----------------------------------------------------------------*06270001
062800* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*06280001
062900* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *06290001
063000* CICS ARCHITECTURE API.                                         *06300001
063100*----------------------------------------------------------------*06310001
063200 2100-CHECK-FUNCTION-KEY.                                         06320001
063300                                                                  06330001
063400     EVALUATE TRUE                                                06340001
063500                                                                  06350001
065900* F6 - FIRST PAGE                                                 06590001
066000         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  06600001
066100             MOVE +1               TO PV-TOP-ITEM                 06610001
066200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06620001
066300                                                                  06630001
066400* F7 - PREVIOUS PAGE                                              06640001
066500         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   06650001
066600             PERFORM 2110-BROWSE-BACKWARD                         06660001
066700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06670001
066800                                                                  06680001
066900* F8 - NEXT PAGE                                                  06690001
067000         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   06700001
067100             PERFORM 2120-BROWSE-FORWARD                          06710001
067200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06720001
067300                                                                  06730001
067400* ENTER KEY                                                       06740001
067500         WHEN DP020-SRC-AID = DP016-ENTER                         06750001
067600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   06760001
067700             IF  PS-ERROR                                         06770001
067800                 CONTINUE                                         06780001
067900             ELSE                                                 06790001
068000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             06800001
068100             END-IF                                               06810001
068200                                                                  06820001
068300         WHEN OTHER                                               06830001
068400             SET DP013-NO-ROLLBACK                                06840001
068500                 DP013-XCTL-DISPLAY-RESTART                       06850001
068600                 DP013-CICS-ABEND  TO TRUE                        06860001
068700             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    06870001
068800             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      06880001
068900                                   TO DP013-MESSAGE-TEXT (1)      06890001
069000             PERFORM DP013-0000-PROCESS-ABEND                     06900001
069100     END-EVALUATE.                                                06910001
069200                                                                  06920001
069300*----------------------------------------------------------------*06930001
069400*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *06940001
069500*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *06950001
069600*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *06960001
069700*    MESSAGE.                                                    *06970001
069800*----------------------------------------------------------------*06980001
069900 2110-BROWSE-BACKWARD.                                            06990001
070000     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    07000001
070100         GIVING PV-TOP-ITEM.                                      07010001
070200*                                                                 07020001
070300     IF  ((PV-TOP-ITEM < +1)                                      07030001
070400       OR (PV-TOP-ITEM = +1))                                     07040001
070500         MOVE +1                   TO PV-TOP-ITEM                 07050001
070600*        -- TOP OF LIST --                                        07060001
070700         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            07070001
070800         SET DP020-MSG-INFORMATIONAL TO TRUE                      07080001
070900     END-IF.                                                      07090001
071000                                                                  07100001
071100*----------------------------------------------------------------*07110001
071200*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *07120001
071300*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *07130001
071400*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *07140001
071500*----------------------------------------------------------------*07150001
071600 2120-BROWSE-FORWARD.                                             07160001
071700     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              07170001
071800         GIVING PV-TOP-ITEM.                                      07180001
071900     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   07190001
072000         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07200001
072100*        -- BOTTOM OF LIST --                                     07210001
072200         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            07220001
072300         SET DP020-MSG-INFORMATIONAL TO TRUE                      07230001
072400     ELSE                                                         07240001
072500         COMPUTE PV-BOTTOM-ITEM =                                 07250001
072600             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 07260001
072700         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            07270001
072800*            -- BOTTOM OF LIST --                                 07280001
072900             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            07290001
073000             SET DP020-MSG-INFORMATIONAL TO TRUE                  07300001
073100         END-IF                                                   07310001
073200     END-IF.                                                      07320001
073300                                                                  07330001
073400*----------------------------------------------------------------*07340001
073500*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *07350001
073600*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *07360001
073700*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *07370001
073800*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *07380001
073900*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *07390001
074000*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *07400001
074100*----------------------------------------------------------------*07410001
074200 2130-CHECK-FOR-JUMP-BROWSE.                                      07420001
074300     SET PS-NO-ERROR               TO TRUE.                       07430001
074400     IF (ASC-START-ITEM-REQUEST = SPACE)                          07440001
074500         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             07450001
074600     ELSE                                                         07460001
074700         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     07470001
074800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       07480001
074900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     07490001
075000         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  07500001
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         07511046
263455              USING DP010I-NUMERIC-EDIT-AREA                      07512046
075200                                                                  07520001
075300         IF  NOT DP010I-ERROR-DETECTED                            07530001
075400             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N07540001
075500             IF  ASC-START-ITEM-REQUEST-N > ZERO                  07550001
075600                 IF  ASC-START-ITEM-REQUEST-N >                   07560001
075700                                          ASC-NUMBER-OF-ITEMS-READ07570001
075800                     MOVE SPACE TO ASC-START-ITEM-REQUEST         07580001
075900                     COMPUTE PV-TOP-ITEM =                        07590001
076000                             ASC-NUMBER-OF-ITEMS-READ             07600001
076100                             - PC-ITEMS-PER-PANEL + 1             07610001
076200                     IF  PV-TOP-ITEM < +1                         07620001
076300                         MOVE +1   TO PV-TOP-ITEM                 07630001
076400                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07640001
076500                         SET DP020-MSG-INFORMATIONAL TO TRUE      07650001
076600                     END-IF                                       07660001
076700                 ELSE                                             07670001
076800                     MOVE ASC-START-ITEM-REQUEST-N                07680001
076900                                   TO PV-TOP-ITEM                 07690001
077000                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      07700001
077100                     COMPUTE PV-BOTTOM-ITEM =                     07710001
077200                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     07720001
077300                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ07730001
077400*                        -- BOTTOM OF LIST --                     07740001
077500                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 07750001
077600                         SET DP020-MSG-INFORMATIONAL TO TRUE      07760001
077700                     END-IF                                       07770001
077800                 END-IF                                           07780001
077900             ELSE                                                 07790001
078000*                --- VALUE OUT OF RANGE ----                      07800001
078100                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         07810001
078200                 MOVE -1              TO ASTRTITL                 07820001
078300                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              07830001
078400                 MOVE DP015-REVERSE   TO ASTRTITH                 07840001
078500                 MOVE DP015-RED       TO ASTRTITC                 07850001
078600                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           07860001
078700                 SET DP020-MSG-FATAL  TO TRUE                     07870001
078800                 SET PS-ERROR         TO TRUE                     07880001
078900             END-IF                                               07890001
079000         ELSE                                                     07900001
079100             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            07910001
079200             MOVE -1               TO ASTRTITL                    07920001
079300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  07930001
079400             MOVE DP015-REVERSE    TO ASTRTITH                    07940001
079500             MOVE DP015-RED        TO ASTRTITC                    07950001
079600             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               07960001
079700             SET DP020-MSG-FATAL   TO TRUE                        07970001
079800             SET PS-ERROR          TO TRUE                        07980001
079900         END-IF                                                   07990001
080000     END-IF.                                                      08000001
080100                                                                  08010001
102100******************************************************************10210001
102200** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **10220001
102300** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **10230001
102400******************************************************************10240001
102500 2200-MOVE-SCREEN-TO-COMMAREA.                                    10250001
102600                                                                  10260001
102700     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             10270001
102800     MOVE +1                       TO PV-SUB.                     10280001
102900*                                                                 10290001
103000     PERFORM 3100-SET-SUBSCRIPTS.                                 10300001
103100                                                                  10310001
103200     IF  ASTRTITL > ZERO                                          10320001
103300         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          10330001
103400     ELSE                                                         10340001
103500         IF  ASTRTITF = DP015-ERASE-EOF                           10350001
103600             INITIALIZE ASC-START-ITEM-REQUEST                    10360001
103700         END-IF                                                   10370001
103800     END-IF.                                                      10380001
103900                                                                  10390001
105000     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          10500007
105100         VARYING PV-SUB FROM 1 BY 1                               10510007
105210         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      10521032
105300                                                                  10530007
105400******************************************************************10540007
105500** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**10550007
105600******************************************************************10560007
105700 2210-MOVE-LINES-TO-COMMAREA.                                     10570007
105800*    IF  MR-SELECTL (PV-SUB) > ZERO                               10580007
105900*        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             10590007
106000*        MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        10600007
106100*                                (ASC-BLK-SUB, ASC-ITEM-SUB)      10610007
106200*    ELSE                                                         10620007
106300*        IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                10630007
106400*                SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     10640007
106500*                MOVE SPACE        TO ASC-TEMP-SELECTED-SW        10650007
106600*                                     (ASC-BLK-SUB, ASC-ITEM-SUB) 10660007
106700*        END-IF                                                   10670007
106800*    END-IF.                                                      10680007
106900                                                                  10690007
106910     MOVE CN013-ACTION-SW (PV-SUB)      TO ASC-ACTION.            10691034
106920     MOVE CN013-DOOR-ID (PV-SUB)        TO ASC-DOOR-ID.           10692034
106930     MOVE CN013-TYPE-CODE (PV-SUB)      TO ASC-TYPE-CODE.         10693034
106994     MOVE CN013-LOC-DESC (PV-SUB)       TO ASC-LOC-DESC.          10699434
106996     MOVE CN013-LANE-ASGNMT (PV-SUB)    TO ASC-DIVERT-CODE-N.     10699634
106997     MOVE CN013-DIVERT-LOC-ID (PV-SUB)  TO ASC-DIVERT-LOC.        10699734
106998     MOVE CN013-LBL-SEQ-NBR (PV-SUB)    TO ASC-LABEL-SEQ-N.       10699834
107000     MOVE CN013-STORE-ASGNMT (PV-SUB)   TO ASC-STOR-ASGNMT.       10700034
107002                                                                  10700207
107010*    ADD +1                        TO ASC-ITEM-SUB.               10701008
107100*    IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        10710008
107200*        ADD +1                    TO ASC-BLK-SUB                 10720008
107300*        MOVE +1                   TO ASC-ITEM-SUB                10730008
107400*    END-IF.                                                      10740008
107500*                                                                 10750008
107600******************************************************************10760001
107700** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **10770001
107800** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **10780001
107900******************************************************************10790001
108000 3000-EDIT-DATA-IN-COMMAREA.                                      10800001
108100     SET PS-NO-ERROR               TO TRUE.                       10810001
108200     PERFORM 3200-RESET-ATTRIBUTES.                               10820001
108300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     10830001
108400                                                                  10840001
108600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              10860001
108700* EDITTING IS DONE FROM THE BOTTOM UP.                            10870001
108800**                                                                10880001
108900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       10890001
109000         ASC-ITEMS-DISPLAYED - 1.                                 10900001
109100     PERFORM 3100-SET-SUBSCRIPTS.                                 10910001
109200                                                                  10920001
109300      IF  PS-NO-ERROR                                             10930001
109400          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       10940001
109500      END-IF.                                                     10950001
109600                                                                  10960001
109700     IF  PS-NO-ERROR                                              10970001
109800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        10980001
109900     END-IF.                                                      10990001
110000                                                                  11000001
110100     IF  ((PS-NO-ERROR)                                           11010007
110200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   11020007
110300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    11030007
110400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  11040007
110500     END-IF.                                                      11050007
110600                                                                  11060007
110700*----------------------------------------------------------------*11070001
110800* 3005-EDIT-COMMAREA-BLOCKS                                      *11080001
110900*----------------------------------------------------------------*11090001
111000 3005-EDIT-COMMAREA-BLOCKS.                                       11100001
111100     MOVE +1                       TO PV-BLOCK-NUMBER.            11110001
111200     MOVE +1                       TO ASC-BLK-SUB.                11120001
111300     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               11130001
111400                                                                  11140001
111500     COMPUTE PV-BLOCK-NUMBER  =                                   11150001
111600             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            11160001
111700             PC-ITEMS-PER-PANEL.                                  11170001
111800                                                                  11180001
111900     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          11190001
112000                                                                  11200001
112100     PERFORM                                                      11210001
112200        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         11220001
112300           OR PS-ERROR                                            11230001
112400           OR PS-BLOCK-ERROR                                      11240001
112500                                                                  11250001
112600              COMPUTE PV-ITEMS-HOLD  =                            11260001
112700                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       11270001
112800                      PC-ITEMS-PER-PANEL - 1                      11280001
112900                                                                  11290001
113000               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     11300001
113100                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             11310001
113200                       FROM  PV-ITEMS-HOLD                        11320001
113300                     GIVING  PV-ITEMS-DIFF                        11330001
113400                   SUBTRACT  PV-ITEMS-DIFF                        11340001
113500                       FROM  PC-ITEMS-PER-PANEL                   11350001
113600                     GIVING  PV-ITEMS-HOLD                        11360001
113700                       MOVE  PV-ITEMS-HOLD TO PV-SUB              11370001
113800                                              ASC-ITEM-SUB        11380001
113900                                              ASC-ITEMS-DISPLAYED 11390001
114000                                                                  11400001
114100               ELSE                                               11410001
114200                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            11420001
114300                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      11430001
114400               END-IF                                             11440001
114500                                                                  11450001
115100               MOVE +1               TO ASC-BLK-SUB               11510001
115200                                                                  11520001
115300               PERFORM 5105-REWRITE-ASC-LISTQ                     11530001
115400                                                                  11540001
115500               MOVE +1                TO ASC-BLK-SUB              11550001
115600                                                                  11560001
115700               IF  PS-BLOCK-ERROR                                 11570001
115800                   SET  PS-ERROR     TO TRUE                      11580001
115900                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      11590001
116000                                     TO PV-TOP-ITEM               11600001
116100               ELSE                                               11610001
116200                   ADD  +1           TO PV-BLOCK-NUMBER           11620001
116300                   IF  PV-BLOCK-NUMBER >                          11630001
116400                       ASC-HIGHEST-BLOCK-WRITTEN                  11640001
116500                       MOVE +2       TO ASC-BLK-SUB               11650001
116600                       PERFORM 4410-READ-TEMP-STORAGE             11660001
116700                       MOVE +1       TO ASC-BLK-SUB               11670001
116800                   ELSE                                           11680001
116900                       PERFORM 4410-READ-TEMP-STORAGE             11690001
117000                       ADD  +1        TO PV-BLOCK-NUMBER          11700001
117100                       MOVE +2        TO ASC-BLK-SUB              11710001
117200                       PERFORM 4410-READ-TEMP-STORAGE             11720001
117300                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          11730001
117400                       MOVE +1        TO ASC-BLK-SUB              11740001
117500               END-IF                                             11750001
117600           END-IF                                                 11760001
117700     END-PERFORM.                                                 11770001
117800                                                                  11780001
117900     IF  PV-ORIGINAL-BLOCK  = +1    OR                            11790001
118000         PS-ERROR                   OR                            11800001
118100         PS-BLOCK-ERROR                                           11810001
118200             CONTINUE                                             11820001
118300     ELSE                                                         11830001
118400         MOVE +1                 TO PV-BLOCK-NUMBER               11840001
118500         MOVE +1                 TO ASC-BLK-SUB                   11850001
118600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  11860001
118700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           11870001
118800         PERFORM 4410-READ-TEMP-STORAGE                           11880001
118900                                                                  11890001
119000         PERFORM                                                  11900001
119100            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             11910001
119200               OR PS-ERROR                                        11920001
119300               OR PS-BLOCK-ERROR                                  11930001
119400                                                                  11940001
119500                  COMPUTE PV-ITEMS-HOLD  =                        11950001
119600                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   11960001
119700                          PC-ITEMS-PER-PANEL - 1                  11970001
119800                                                                  11980001
119900                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    11990001
120000                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          12000001
120100                          FROM  PV-ITEMS-HOLD                     12010001
120200                        GIVING  PV-ITEMS-DIFF                     12020001
120300                      SUBTRACT  PV-ITEMS-DIFF                     12030001
120400                          FROM  PC-ITEMS-PER-PANEL                12040001
120500                        GIVING  PV-ITEMS-HOLD                     12050001
120600                          MOVE  PV-ITEMS-HOLD TO PV-SUB           12060001
120700                                                 ASC-ITEM-SUB     12070001
120800                                              ASC-ITEMS-DISPLAYED 12080001
120900                  ELSE                                            12090001
121000                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         12100001
121100                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   12110001
121200                  END-IF                                          12120001
121300                                                                  12130001
122000                  MOVE +1               TO ASC-BLK-SUB            12200001
122100                                                                  12210001
122200                  PERFORM 5105-REWRITE-ASC-LISTQ                  12220001
122300                                                                  12230001
122400                  MOVE +1                TO ASC-BLK-SUB           12240001
122500                                                                  12250001
122600                  IF  PS-BLOCK-ERROR                              12260001
122700                      SET  PS-ERROR     TO TRUE                   12270001
122800                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   12280001
122900                                        TO PV-TOP-ITEM            12290001
123000                  ELSE                                            12300001
123100                      ADD  +1            TO PV-BLOCK-NUMBER       12310001
123200                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     12320001
123300                          MOVE +2        TO ASC-BLK-SUB           12330001
123400                          PERFORM 4410-READ-TEMP-STORAGE          12340001
123500                          MOVE +1        TO ASC-BLK-SUB           12350001
123600                      ELSE                                        12360001
123700                          PERFORM 4410-READ-TEMP-STORAGE          12370001
123800                          ADD  +1        TO PV-BLOCK-NUMBER       12380001
123900                          MOVE +2        TO ASC-BLK-SUB           12390001
124000                          PERFORM 4410-READ-TEMP-STORAGE          12400001
124100                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       12410001
124200                          MOVE +1        TO ASC-BLK-SUB           12420001
124300                      END-IF                                      12430001
124400                  END-IF                                          12440001
124500     END-PERFORM.                                                 12450001
124600                                                                  12460001
124700******************************************************************12470026
124800** RETRIEVE DOOR TYPE CODE DESCRIPTION                            12480026
124900******************************************************************12490026
125000 3020-RETRIEVE-TYPE-CODE-DESC.                                    12500026
125100      MOVE ASC-TYPE-CODE  TO DK-TYPE-CODE.                        12510026
125200                                                                  12520026
125300        EXEC SQL                                                  12530026
125400          SELECT  DOOR_TYP_CDE_DESC                               12540026
125500            INTO :CNDRTY-DOOR-TYP-CDE-DESC                        12550026
125600            FROM  TCNDRTY                                         12560026
125700           WHERE  DOOR_TYP_CDE   = :DK-TYPE-CODE                  12570039
125710             AND  DIVERT_TYP_CDE = :PC-D                          12571039
125800        END-EXEC                                                  12580026
125900                                                                  12590026
126000        EVALUATE TRUE                                             12600026
126100            WHEN SQLCODE = +0                                     12610026
126200              MOVE CNDRTY-DOOR-TYP-CDE-DESC TO ASC-TYPE-CODE-DESC 12620026
126300            WHEN SQLCODE = +100                                   12630026
126400              MOVE 'NO TYPE CODE DESC FOUND' TO ASC-TYPE-CODE-DESC12640026
127300            WHEN SQLWARN0 NOT = SPACES                            12730026
127400            WHEN SQLCODE < +0                                     12740026
127500            WHEN SQLCODE > +0                                     12750026
127600                MOVE '3020-RETRIEVE-TYPE-CODE-DESC'               12760026
127700                                          TO DP013-PARAGRAPH      12770026
127800                MOVE 'COULDNT RETRIEVE DOOR TYPE CODE DESC'       12780026
127900                                    TO DP013-MESSAGE-TEXT (1)     12790026
128000                MOVE SQLCA      TO DP013-SQLCA                    12800026
128100                MOVE 'TCNDRTY'  TO DP013-DB2-TABLE-NAME (1)       12810026
128200                SET DP013-DB2-ABEND                               12820026
128300                    DP013-XCTL-DISPLAY-RESTART TO TRUE            12830026
128400                PERFORM DP013-0000-PROCESS-ABEND                  12840026
128500        END-EVALUATE.                                             12850026
128600                                                                  12860026
132200*----------------------------------------------------------------*13220001
132300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13230001
132400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13240001
132500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13250001
132600*                                                                *13260001
132700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13270001
132800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13280001
132900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13290001
133000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13300001
133100*----------------------------------------------------------------*13310001
133200 3100-SET-SUBSCRIPTS.                                             13320001
133300     COMPUTE ASC-ITEM-SUB =                                       13330001
133400         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13340001
133500                                                                  13350001
133600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13360001
133700         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13370001
133800         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13380001
133900     ELSE                                                         13390001
134000         MOVE +1                     TO ASC-BLK-SUB               13400001
134100     END-IF.                                                      13410001
134200                                                                  13420001
134300******************************************************************13430001
134400** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13440001
134500******************************************************************13450001
134600 3200-RESET-ATTRIBUTES.                                           13460001
134700     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13470001
134900     MOVE DP015-GREEN              TO ASTRTITC.                   13490001
135100     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13510001
135300                                                                  13530001
135400     PERFORM                                                      13540001
135500         VARYING PV-SUB                                           13550001
135600         FROM 1 BY 1                                              13560001
135700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13570001
136200         MOVE DP015-PRO-NOR-OFF    TO MR-STATUSA (PV-SUB)         13620001
136300                                      MR-STORE-NBRA (PV-SUB)      13630001
136310                                      MR-STORE-NAMEA (PV-SUB)     13631001
136320                                      MR-START-DATEA (PV-SUB)     13632001
136321                                      MR-START-TIMEA (PV-SUB)     13632101
136330                                      MR-END-DATEA   (PV-SUB)     13633001
136340                                      MR-END-TIMEA   (PV-SUB)     13634001
136350                                      MR-USERIDA     (PV-SUB)     13635001
136400         MOVE DP015-BLUE           TO MR-STATUSC     (PV-SUB)     13640001
136410                                      MR-STORE-NBRC  (PV-SUB)     13641001
136420                                      MR-STORE-NAMEC (PV-SUB)     13642001
136430                                      MR-START-DATEC (PV-SUB)     13643001
136440                                      MR-START-TIMEC (PV-SUB)     13644001
136450                                      MR-END-DATEC   (PV-SUB)     13645001
136460                                      MR-END-TIMEC   (PV-SUB)     13646001
136470                                      MR-USERIDC     (PV-SUB)     13647001
136600     END-PERFORM.                                                 13660001
136700                                                                  13670001
136800******************************************************************13680007
136900** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13690007
137000** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13700007
137100** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13710007
137200** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13720007
137300******************************************************************13730007
137400 3300-EDIT-SELECTIONS.                                            13740007
137500     EVALUATE TRUE                                                13750007
137600         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13760007
137700             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13770007
137800                 CONTINUE                                         13780007
137900         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13790007
138000             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13800007
138100                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13810007
138200                 MOVE ASC-TEMP-SELECTED-SW                        13820007
138300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13830007
138400                                TO ASC-SELECTED-SW                13840007
138500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13850007
138600             END-IF                                               13860007
138700         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13870007
138800                 = SPACE                                          13880007
138900             EVALUATE TRUE                                        13890007
139000                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13900007
139100                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13910007
139200                     MOVE SPACE TO ASC-SELECTED-SW                13920007
139300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13930007
139400                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        13940007
139500                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    13950007
139600                     MOVE SPACE TO ASC-SELECTED-SW                13960007
139700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13970007
139800                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          13980007
139900                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      13990007
140000                     MOVE SPACE TO ASC-SELECTED-SW                14000007
140100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14010007
140200             END-EVALUATE                                         14020007
140300         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14030007
140400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14040007
140500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14050007
140600             END-IF                                               14060007
140700             PERFORM 3310-EDIT-RANGE                              14070007
140800         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14080007
140900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14090007
141000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14100007
141100             END-IF                                               14110007
141200             PERFORM 3310-EDIT-RANGE                              14120007
141300         WHEN OTHER                                               14130007
141400             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14140007
141500             SET DP020-MSG-FATAL    TO TRUE                       14150007
141600             MOVE -1                TO ASTRTITL                   14160007
141700             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14170007
141800*            MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14180007
141900*            MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14190007
142000             SET PS-ERROR TO TRUE                                 14200007
142100             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14210007
142200                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14220007
142300                 MOVE SPACE         TO ASC-SELECTED-SW            14230007
142400                                        (ASC-BLK-SUB ASC-ITEM-SUB)14240007
142500             END-IF                                               14250007
142600     END-EVALUATE.                                                14260007
142700                                                                  14270007
142800     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14280007
142900     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14290007
143000     IF  ASC-ITEM-SUB < 1                                         14300007
143100         SUBTRACT +1 FROM ASC-BLK-SUB                             14310007
143200         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14320007
143300     END-IF.                                                      14330007
143400                                                                  14340007
143500******************************************************************14350007
143600** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14360007
143700** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14370007
143800** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14380007
143900** THE ENDING.                                                  **14390007
144000******************************************************************14400007
144100 3310-EDIT-RANGE.                                                 14410007
144200     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14420007
144300         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14430007
144400             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14440007
144500                                   TO ASC-SELECTED-SW             14450007
144600                                        (ASC-BLK-SUB ASC-ITEM-SUB)14460007
144700             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14470007
144800         ELSE                                                     14480007
144900             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14490007
145000                 CONTINUE                                         14500007
145100             ELSE                                                 14510007
145200*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14520007
145300                 MOVE PC-TSYMSG-00054                             14530007
145400                                   TO DP020-MSG-NUMBER            14540007
145500                 SET DP020-MSG-FATAL                              14550007
145600                                   TO TRUE                        14560007
145700*                MOVE -1           TO MR-SELECTL (PV-SUB)         14570007
145800                 MOVE -1           TO ASTRTITL                    14580007
145900                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              14590007
146000*                MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         14600007
146100*                MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      14610007
146200                 SET PS-ERROR      TO TRUE                        14620007
146300             END-IF                                               14630007
146400         END-IF                                                   14640007
146500     ELSE                                                         14650007
146600         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     14660007
146700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 14670007
146800                                   TO ASC-SELECTED-SW             14680007
146900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   14690007
147000             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   14700007
147100         ELSE                                                     14710007
147200             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       14720007
147300                 CONTINUE                                         14730007
147400             ELSE                                                 14740007
147500*                -- ONLY ONE END-OF-RANGE ALLOWED --              14750007
147600                 MOVE PC-TSYMSG-00055                             14760007
147700                                   TO DP020-MSG-NUMBER            14770007
147800                 SET DP020-MSG-FATAL                              14780007
147900                                   TO TRUE                        14790007
148000*                MOVE -1           TO MR-SELECTL (PV-SUB)         14800007
148100                 MOVE -1           TO ASTRTITL                    14810007
148200                 SET DP030-SET-CURSOR-APPL-1                      14820007
148300                                   TO TRUE                        14830007
148400                 SET PS-ERROR      TO TRUE                        14840007
148500             END-IF                                               14850007
148600         END-IF                                                   14860007
148700     END-IF.                                                      14870007
148800*                                                                 14880007
148900******************************************************************14890001
149000** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **14900001
149100** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **14910001
149200******************************************************************14920001
149300 3400-CHECK-RANGE-SEQUENCE.                                       14930001
149400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       14940001
149500       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      14950001
149600       AND  ASC-START-OF-SELECTED-RANGE >                         14960001
149700                                         ASC-END-OF-SELECTED-RANGE14970001
149800*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                14980001
149900         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 14990001
150000         SET DP020-MSG-FATAL TO TRUE                              15000001
150100         SET PS-ERROR TO TRUE                                     15010001
150300     END-IF.                                                      15030001
150400                                                                  15040001
150500******************************************************************15050007
150600** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15060007
150700** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15070007
150800** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15080007
150900******************************************************************15090007
151000 3410-POSITION-AT-ERROR.                                          15100007
151100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       15110007
151200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15120007
151300                    - PV-TOP-ITEM + 1.                            15130007
151400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15140007
151500         CONTINUE                                                 15150007
151600*    ELSE                                                         15160007
151700*        MOVE -1                   TO MR-SELECTL (PV-SUB)         15170007
151800*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15180007
151900*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15190007
152000     END-IF.                                                      15200007
152100                                                                  15210007
152200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15220007
152300                    - PV-TOP-ITEM + 1.                            15230007
152400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15240007
152500         CONTINUE                                                 15250007
152600*    ELSE                                                         15260007
152700*        MOVE -1                   TO MR-SELECTL (PV-SUB)         15270007
152800*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15280007
152900*        MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15290007
153000     END-IF.                                                      15300007
153100                                                                  15310007
153200*----------------------------------------------------------------*15320007
153300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15330007
153400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15340007
153500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15350007
153600*----------------------------------------------------------------*15360007
153700 3500-MARK-RANGE-AS-SELECTED.                                     15370007
153800     MOVE +1                       TO  ASC-BLK-SUB.               15380007
153900     PERFORM 3510-MARK-SELECTED-INDS                              15390007
154000         VARYING ASC-ITEM-SUB                                     15400007
154100         FROM 1 BY 1                                              15410007
154200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15420007
154300                                                                  15430007
154400     ADD +1                        TO ASC-BLK-SUB.                15440007
154500     PERFORM 3510-MARK-SELECTED-INDS                              15450007
154600         VARYING ASC-ITEM-SUB                                     15460007
154700         FROM 1 BY 1                                              15470007
154800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15480007
154900                                                                  15490007
155000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15500007
155100                                   TO  PV-LIST-ITEM-NUMBER.       15510007
155200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15520007
155300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15530007
155400               PC-ITEMS-PER-PANEL).                               15540007
155500                                                                  15550007
155600     MOVE ASC-START-OF-SELECTED-RANGE                             15560007
155700                                   TO PV-START-OF-SELECTED-RANGE. 15570007
155800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            15580007
155900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  15590007
156000               PC-ITEMS-PER-PANEL).                               15600007
156100                                                                  15610007
156200     MOVE ASC-END-OF-SELECTED-RANGE                               15620007
156300                                   TO  PV-END-OF-SELECTED-RANGE.  15630007
156400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             15640007
156500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    15650007
156600               PC-ITEMS-PER-PANEL).                               15660007
156700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             15670007
156800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             15680007
156900                                                                  15690007
157000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    15700007
157100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        15710007
157200         MOVE +1                   TO ASC-BLK-SUB                 15720007
157300         PERFORM 5100-WRITE-TEMP-STORAGE                          15730007
157400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         15740007
157500             PV-FIRST-BLOCK-IN-ARRAY - 1                          15750007
157600                                                                  15760007
157700         PERFORM                                                  15770007
157800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      15780007
157900                   PV-PREV-BLOCK-IN-ARRAY                         15790007
158000             MOVE PV-FIRST-BLOCK-IN-RANGE                         15800007
158100                                   TO PV-BLOCK-NUMBER             15810007
158200             PERFORM 4410-READ-TEMP-STORAGE                       15820007
158300             PERFORM 3510-MARK-SELECTED-INDS                      15830007
158400                 VARYING ASC-ITEM-SUB                             15840007
158500                 FROM 1 BY 1                                      15850007
158600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15860007
158700             PERFORM 5100-WRITE-TEMP-STORAGE                      15870007
158800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     15880007
158900         END-PERFORM                                              15890007
159000                                                                  15900007
159100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         15910007
159200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     15920007
159300         PERFORM                                                  15930007
159400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       15940007
159500                   PV-LAST-BLOCK-IN-RANGE                         15950007
159600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          15960007
159700                                   TO PV-BLOCK-NUMBER             15970007
159800             PERFORM 4410-READ-TEMP-STORAGE                       15980007
159900             PERFORM 3510-MARK-SELECTED-INDS                      15990007
160000                 VARYING ASC-ITEM-SUB                             16000007
160100                 FROM 1 BY 1                                      16010007
160200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16020007
160300             PERFORM 5100-WRITE-TEMP-STORAGE                      16030007
160400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16040007
160500         END-PERFORM                                              16050007
160600                                                                  16060007
160700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16070007
160800                                   TO PV-BLOCK-NUMBER             16080007
160900         PERFORM 4410-READ-TEMP-STORAGE                           16090007
161000     END-IF.                                                      16100007
161100                                                                  16110007
161200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16120007
161300                                      ASC-END-OF-SELECTED-RANGE.  16130007
161400                                                                  16140007
161500*----------------------------------------------------------------*16150007
161600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16160007
161700*----------------------------------------------------------------*16170007
161800 3510-MARK-SELECTED-INDS.                                         16180007
161900     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16190007
162000                                ASC-ITEM-SUB) >                   16200007
162100         ASC-START-OF-SELECTED-RANGE)                             16210007
162200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16220007
162300                                ASC-ITEM-SUB) =                   16230007
162400         ASC-START-OF-SELECTED-RANGE)                             16240007
162500                                                                  16250007
162600         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16260007
162700                                    ASC-ITEM-SUB) <               16270007
162800             ASC-END-OF-SELECTED-RANGE)                           16280007
162900         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16290007
163000                                    ASC-ITEM-SUB) =               16300007
163100             ASC-END-OF-SELECTED-RANGE)                           16310007
163200                                                                  16320007
163300             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16330007
163400                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16340007
163500                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16350007
163600                               TO TRUE                            16360007
163700                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16370007
163800                               TO TRUE                            16380007
163900                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16390007
164000             END-IF                                               16400007
164100         END-IF                                                   16410007
164200     END-IF.                                                      16420007
164300                                                                  16430007
164400*----------------------------------------------------------------*16440001
164500*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16450001
164600*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16460001
164700*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16470001
164800*    DISPLAY THE PANEL TO USER.                                  *16480001
164900*----------------------------------------------------------------*16490001
165000 4000-BUILD-INITIAL-PANEL.                                        16500001
165100     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16510001
165200                                 ASC-BLOCK-ENTRIES (2).           16520001
165300     MOVE +1                   TO ASC-BLK-SUB.                    16530001
165400     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           16540001
165500                                                                  16550001
165600     MOVE +0                 TO ASC-ITEM-SUB                      16560001
165700                                ASC-NUMBER-OF-ITEMS-READ          16570001
165800                                ASC-NUMBER-OF-SELECTED-ITEMS      16580001
165900                                ASC-HIGHEST-BLOCK-WRITTEN         16590001
166000                                ASC-START-OF-SELECTED-RANGE       16600001
166100                                ASC-END-OF-SELECTED-RANGE         16610001
166200                                ASC-ITEM-AT-TOP-OF-PANEL.         16620001
166300                                                                  16630001
166500     PERFORM 4010-OPEN-CURSOR.                                    16650001
166600     PERFORM 4300-READ-ITEMS-FROM-DB.                             16660001
166700     PERFORM 4020-CLOSE-CURSOR.                                   16670001
166800                                                                  16680001
166900     MOVE +1                   TO  PV-TOP-ITEM.                   16690042
167000*    IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          16700041
167100*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    16710041
167200*        SET DP020-MSG-FATAL   TO  TRUE                           16720041
167300*        MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               16730041
167400*    ELSE                                                         16740041
167700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    16770043
167800*    END-IF.                                                      16780041
167900                                                                  16790001
168000*----------------------------------------------------------------*16800001
168100* OPEN THE CURSOR.                                               *16810001
168200*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *16820001
168300*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *16830001
168400*   ASSOCIATE.                                                   *16840001
168500*----------------------------------------------------------------*16850001
168600 4010-OPEN-CURSOR.                                                16860001
168700     MOVE ASC-OPER-UNT-ID  TO DK-OPER-UNT-ID.                     16870001
168701     MOVE ASC-DOOR-ID      TO DK-DOOR-ID.                         16870134
168710     PERFORM                                                      16871001
168800         WITH TEST AFTER                                          16880001
168900         VARYING PV-RETRY-COUNTER                                 16890001
169000         FROM 1 BY 1                                              16900001
169100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16910001
169200                   OR (SQLCODE = ZERO))                           16920001
169300                                                                  16930001
169800              EXEC SQL                                            16980001
169900                  OPEN DOOR-TO-STORE-CSR                          16990001
170000              END-EXEC                                            17000001
170100                                                                  17010001
171100         EVALUATE TRUE                                            17110001
171200             WHEN SQLCODE = ZERO                                  17120001
171300             WHEN SQLCODE = -904                                  17130001
171400             WHEN SQLCODE = -913                                  17140001
171500                 CONTINUE                                         17150001
171600             WHEN SQLWARN0 NOT = SPACES                           17160001
171700             WHEN SQLCODE < ZERO                                  17170001
171800             WHEN SQLCODE > ZERO                                  17180001
171900                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       17190001
172000                 MOVE 'UNABLE TO OPEN A CURSOR -'                 17200001
172100                                   TO DP013-MESSAGE-TEXT (1)      17210001
172200                 MOVE SQLCA        TO DP013-SQLCA                 17220001
172300                 MOVE 'TCNDRST '   TO DP013-DB2-TABLE-NAME (1)    17230003
172400                 SET DP013-DB2-ABEND                              17240001
172500                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17250001
172600                 PERFORM DP013-0000-PROCESS-ABEND                 17260001
172700         END-EVALUATE                                             17270001
172800     END-PERFORM.                                                 17280001
172900*                                                                 17290001
173000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17300001
173100         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17310001
173200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17320001
173300                                   TO DP013-MESSAGE-TEXT (1)      17330001
173400         MOVE SQLCA                TO DP013-SQLCA                 17340001
173500         MOVE 'TCNDRST '           TO DP013-DB2-TABLE-NAME (1)    17350003
173600         SET DP013-DB2-ABEND                                      17360001
173700             DP013-XCTL-DISPLAY-RESTART TO TRUE                   17370001
173800         PERFORM DP013-0000-PROCESS-ABEND                         17380001
173900     END-IF.                                                      17390001
174000                                                                  17400001
174100*----------------------------------------------------------------*17410001
174200* CLOSE THE CURSOR                                               *17420001
174300*----------------------------------------------------------------*17430001
174400 4020-CLOSE-CURSOR.                                               17440001
174700          EXEC SQL                                                17470001
174800               CLOSE DOOR-TO-STORE-CSR                            17480001
174900          END-EXEC                                                17490001
175000                                                                  17500001
175700     EVALUATE TRUE                                                17570001
175800         WHEN SQLCODE = ZERO                                      17580001
175900             CONTINUE                                             17590001
176000         WHEN SQLWARN0 NOT = SPACES                               17600001
176100         WHEN SQLCODE < ZERO                                      17610001
176200         WHEN SQLCODE > ZERO                                      17620001
176300             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          17630001
176400             MOVE 'UNABLE TO CLOSE CURSOR '                       17640001
176500                               TO DP013-MESSAGE-TEXT (1)          17650001
176600             MOVE SQLCA        TO DP013-SQLCA                     17660001
176700             MOVE 'TCNDRST '   TO DP013-DB2-TABLE-NAME (1)        17670003
176800             SET DP013-DB2-ABEND                                  17680001
176900                 DP013-XCTL-DISPLAY-RESTART TO TRUE               17690001
177000             PERFORM DP013-0000-PROCESS-ABEND                     17700001
177100     END-EVALUATE.                                                17710001
177200                                                                  17720001
178700*----------------------------------------------------------------*17870001
178800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *17880001
178900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *17890001
179000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *17900001
179100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *17910001
179200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *17920001
179300*                                                                *17930001
179400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *17940001
179500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *17950001
179600*    UPON INITIALIZATION.                                        *17960001
179700*----------------------------------------------------------------*17970001
179800 4300-READ-ITEMS-FROM-DB.                                         17980001
179900     PERFORM                                                      17990001
180000         VARYING PV-READ-COUNT                                    18000001
180100         FROM 1 BY 1                                              18010001
180200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18020001
180300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18030001
180400                                                                  18040001
180500         PERFORM 4310-FETCH                                       18050001
180600                                                                  18060001
180700         IF  ASC-ITEMS-LEFT-ON-DB                                 18070001
180800             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18080001
180900                 ADD +1            TO ASC-ITEM-SUB                18090001
181000             ELSE                                                 18100001
181100                 ADD +1            TO ASC-BLK-SUB                 18110001
181200                 MOVE +1           TO ASC-ITEM-SUB                18120001
181300                                                                  18130001
181400                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18140001
181500                     MOVE +1       TO ASC-BLK-SUB                 18150001
181600                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           18160001
181700                     PERFORM 5100-WRITE-TEMP-STORAGE              18170001
181800                     MOVE ASC-BLOCK-ENTRIES                       18180001
181900                               (PC-MAX-BLOCKS-IN-ARRAY)           18190001
182000                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18200001
182100                     ADD +1        TO ASC-BLK-SUB                 18210001
182200                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18220001
182300                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18230001
182400                                   TO TRUE                        18240001
182500                 END-IF                                           18250001
182600             END-IF                                               18260001
182700             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18270001
182800             MOVE ASC-NUMBER-OF-ITEMS-READ                        18280001
182900                                   TO ASC-LIST-ITEM-NUMBER        18290001
183000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  18300001
183100             MOVE SPACES           TO  ASC-ACTION                 18310026
183300             MOVE CNDRST-STR-NBR   TO  ASC-STORE-NBR              18330016
183400                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18340001
183500             MOVE CNDRST-STRT-TMST TO  ASC-START-TIMESTAMP        18350004
183501             MOVE ASC-MONTH        TO  DK-MM                      18350106
183504             MOVE ASC-DAY          TO  DK-DD                      18350406
183506             MOVE ASC-CENTURY      TO  DK-CC                      18350606
183507             MOVE ASC-HOUR         TO  DK-HR                      18350706
183510             MOVE ASC-MINUTE       TO  DK-MN                      18351006
183520             MOVE DK-START-DTE     TO  ASC-START-DATE             18352005
183600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18360001
183601             MOVE DK-START-TME     TO  ASC-START-TIME             18360105
183602                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18360201
183610             MOVE CNDRST-END-TMST  TO  ASC-END-TIMESTAMP          18361003
183611             IF CNDRST-END-TMST = PC-DEFAULT-TIMESTAMP            18361103
183612                 MOVE PC-ACTIVE    TO  ASC-STATUS                 18361201
183613                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18361301
183614             ELSE                                                 18361401
183615                 MOVE PC-INACTV    TO  ASC-STATUS                 18361501
183616                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18361601
183617             END-IF                                               18361701
183618             MOVE ASC-END-MONTH    TO  DK-END-MM                  18361806
183619             MOVE ASC-END-DAY      TO  DK-END-DD                  18361906
183620             MOVE ASC-END-CENTURY  TO  DK-END-CC                  18362006
183621             MOVE ASC-END-HOUR     TO  DK-END-HR                  18362106
183622             MOVE ASC-END-MINUTE   TO  DK-END-MN                  18362206
183623             MOVE DK-END-DTE       TO  ASC-END-DATE               18362305
183624                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18362401
183630             MOVE DK-END-TME       TO  ASC-END-TIME               18363005
183640                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18364001
183650             MOVE CNDRST-CRE-USR-ID TO ASC-USERID                 18365003
183660                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18366001
183670             MOVE XLT00010-LOC-10-ABBR-NM TO ASC-STORE-NAME       18367045
183680                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18368001
183700         END-IF                                                   18370001
183800     END-PERFORM.                                                 18380001
183900                                                                  18390001
184000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          18400041
184100         MOVE +1               TO ASC-BLK-SUB                     18410041
184200         PERFORM 5100-WRITE-TEMP-STORAGE                          18420041
184300         ADD +1                TO ASC-BLK-SUB                     18430041
184400         PERFORM 5100-WRITE-TEMP-STORAGE                          18440041
184500                                                                  18450041
184600         MOVE 1                TO ASC-BLK-SUB                     18460041
184700                                  PV-BLOCK-NUMBER                 18470041
184800         PERFORM 4410-READ-TEMP-STORAGE                           18480041
184900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             18490041
185000             MOVE 2            TO ASC-BLK-SUB                     18500041
185100                                  PV-BLOCK-NUMBER                 18510041
185200             PERFORM 4410-READ-TEMP-STORAGE                       18520041
185300         END-IF                                                   18530041
185400     END-IF.                                                      18540041
185500                                                                  18550001
185600*----------------------------------------------------------------*18560001
185700*    FETCH THE CURSOR                                             18570001
185800*----------------------------------------------------------------*18580001
185900 4310-FETCH.                                                      18590001
186200       EXEC SQL                                                   18620001
186300            FETCH DOOR-TO-STORE-CSR                               18630001
186400            INTO  :CNDRST-STR-NBR                                 18640003
186500                , :CNDRST-STRT-TMST                               18650003
186510                , :CNDRST-END-TMST                                18651003
186520                , :CNDRST-CRE-USR-ID                              18652003
186530                , :XLT00010-LOC-10-ABBR-NM                        18653045
186600      END-EXEC                                                    18660001
186700                                                                  18670001
187400                                                                  18740001
187500     EVALUATE TRUE                                                18750001
187600         WHEN SQLCODE = ZERO                                      18760001
187700         WHEN SQLCODE = +100                                      18770001
187800              CONTINUE                                            18780001
187900         WHEN SQLWARN0 NOT = SPACE                                18790001
188000         WHEN SQLCODE NOT = ZERO                                  18800001
188100              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         18810001
188200              MOVE 'COULD NOT FETCH CURSOR'                       18820001
188300                               TO DP013-MESSAGE-TEXT (1)          18830001
188400              MOVE SQLCA       TO DP013-SQLCA                     18840001
188500              SET DP013-DB2-ABEND TO TRUE                         18850001
188600              PERFORM DP013-0000-PROCESS-ABEND                    18860001
188700     END-EVALUATE.                                                18870001
188800                                                                  18880001
188900     IF  SQLCODE EQUAL +100                                       18890001
189000         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      18900001
189100     END-IF.                                                      18910001
189200                                                                  18920001
189300*----------------------------------------------------------------*18930001
189400* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *18940001
189500*----------------------------------------------------------------*18950001
189600 4400-MOVE-COMMAREA-TO-SCREEN.                                    18960001
189700     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             18970001
189800         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          18980001
189900         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          18990001
190000             MOVE +1    TO ASC-BLK-SUB                            19000001
190100             PERFORM 5100-WRITE-TEMP-STORAGE                      19010001
190200             ADD +1     TO ASC-BLK-SUB                            19020001
190300             PERFORM 5100-WRITE-TEMP-STORAGE                      19030001
190400             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             19040001
190500                 GIVING PV-BLOCK-NUMBER                           19050001
190600                 REMAINDER PV-REMAINDER                           19060001
190700             IF  PV-REMAINDER > ZERO                              19070001
190800                 ADD +1 TO PV-BLOCK-NUMBER                        19080001
190900             END-IF                                               19090001
191000             MOVE +1    TO ASC-BLK-SUB                            19100001
191100             PERFORM 4410-READ-TEMP-STORAGE                       19110001
191200             ADD +1     TO ASC-BLK-SUB                            19120001
191300                           PV-BLOCK-NUMBER                        19130001
191400             PERFORM 4410-READ-TEMP-STORAGE                       19140001
191500     END-IF.                                                      19150001
191600     MOVE +1            TO ASC-BLK-SUB.                           19160001
191700     COMPUTE ASC-ITEM-SUB =                                       19170001
191800         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              19180001
191900         + PC-ITEMS-PER-PANEL).                                   19190001
192000*                                                                 19200001
192100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        19210001
192200         ADD +1         TO ASC-BLK-SUB                            19220001
192300         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            19230001
192400     END-IF.                                                      19240001
192500*                                                                 19250001
192600     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           19260001
192700         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                19270001
192800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        19280001
192900     PERFORM 4420-FORMAT-LIST-LINES                               19290001
193000         VARYING PV-SUB                                           19300001
193100         FROM PC-ITEMS-PER-PANEL BY -1                            19310001
193200         UNTIL PV-SUB < +1.                                       19320001
193300*                                                                 19330001
193400     COMPUTE ASC-ITEMS-DISPLAYED =                                19340001
193500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          19350001
193600     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    19360001
193700                                      ASTRTITO.                   19370001
193800     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    19380001
193900     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    19390001
194000     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            19400001
194100                                   TO ASELITO.                    19410001
194200     MOVE ASC-OPER-UNT-ID          TO AOPRUNTO.                   19420001
194300     MOVE ASC-FCLTY-NAME           TO AOPRNMEO.                   19430004
194400     MOVE ASC-DOOR-ID              TO ADOORIDO.                   19440034
194410     MOVE ASC-LOC-DESC             TO ALOCDSCO.                   19441025
194411     MOVE ASC-DIVERT-CODE-N        TO ALANEASGO.                  19441118
194412     MOVE ASC-DIVERT-LOC           TO ADIVLOCO.                   19441234
194420     MOVE ASC-TYPE-CODE            TO ADRTYPCO.                   19442001
194430     MOVE ASC-TYPE-CODE-DESC       TO ADRTYDSO.                   19443026
194440     MOVE ASC-LABEL-SEQ-N          TO ALBLNBRO.                   19444018
194500                                                                  19450001
194600     IF  DP020-MSG-NUMBER-X = SPACE                               19460001
194700         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  19470001
194800*            --- MORE ITEMS TO DISPLAY ----                       19480001
194900             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            19490001
195000             SET DP020-MSG-INFORMATIONAL TO TRUE                  19500001
195100         END-IF                                                   19510001
195200     END-IF.                                                      19520001
195300                                                                  19530001
195400*----------------------------------------------------------------*19540001
195500*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *19550001
195600*----------------------------------------------------------------*19560001
195700 4410-READ-TEMP-STORAGE.                                          19570001
195800     EXEC CICS                                                    19580001
195900         READQ TS                                                 19590001
196000             QUEUE (ASC-LIST-QUEUE-NAME)                          19600001
196100             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               19610001
196200             ITEM  (PV-BLOCK-NUMBER)                              19620001
196300             RESP  (PV-CICS-RESP)                                 19630001
196400     END-EXEC.                                                    19640001
196500                                                                  19650001
196600     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       19660001
196700       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     19670001
196800         CONTINUE                                                 19680001
196900     ELSE                                                         19690001
197000         SET DP013-CICS-ABEND     TO TRUE                         19700001
197100         SET DP013-NO-ROLLBACK    TO TRUE                         19710001
197200         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         19720001
197300         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      19730001
197400                                  TO DP013-MESSAGE-TEXT(1)        19740001
197500         PERFORM DP013-0000-PROCESS-ABEND                         19750001
197600     END-IF.                                                      19760001
197700                                                                  19770001
197800     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             19780001
197900*                                                                 19790001
198000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         19800001
198100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               19810001
198200     END-IF.                                                      19820001
198300                                                                  19830001
198400*----------------------------------------------------------------*19840001
198500*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *19850001
198600*----------------------------------------------------------------*19860001
198700 4420-FORMAT-LIST-LINES.                                          19870001
198800     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      19880001
198900         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                19890001
199000*        MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           19900001
199100*        MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           19910001
199200*        MOVE SPACE              TO MR-SELECTI (PV-SUB)           19920001
199300*                                   MR-ACTION  (PV-SUB)           19930001
199400         MOVE SPACE TO              MR-STATUS  (PV-SUB)           19940001
199510                                    MR-STORE-NAME (PV-SUB)        19951001
199520                                    MR-START-DATE (PV-SUB)        19952001
199530                                    MR-START-TIME (PV-SUB)        19953001
199540                                    MR-END-DATE   (PV-SUB)        19954001
199550                                    MR-END-TIME   (PV-SUB)        19955001
199560                                    MR-USERID     (PV-SUB)        19956001
199570         MOVE ZEROES            TO  MR-STORE-NBR  (PV-SUB)        19957004
199600     ELSE                                                         19960001
199700*        IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      19970001
199800*                                                  > SPACE        19980001
199900*            MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 19990001
200000*                                TO MR-SELECTI (PV-SUB)           20000001
200100*        ELSE                                                     20010001
200200*            MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      20020001
200300*                                TO MR-SELECTI (PV-SUB)           20030001
200400*        END-IF                                                   20040001
200500                                                                  20050001
200600*        IF  DP030-SET-CURSOR-TRAILER                             20060004
200700*            IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)20070001
200800*                > SPACE)                                         20080001
200900*              OR (PV-SUB = 1))                                   20090001
201000*               SET DP030-SET-CURSOR-APPL-1 TO TRUE               20100004
201100*               MOVE -1          TO MR-SELECTL (PV-SUB)           20110004
201200*            END-IF                                               20120001
201300*        END-IF                                                   20130005
201400                                                                  20140001
201500         MOVE ASC-STATUS (ASC-BLK-SUB ASC-ITEM-SUB)               20150001
201600                                            TO MR-STATUS (PV-SUB) 20160001
201700         MOVE ASC-STORE-NBR  (ASC-BLK-SUB ASC-ITEM-SUB)           20170001
201800                                         TO MR-STORE-NBR (PV-SUB) 20180001
201900         MOVE ASC-STORE-NAME (ASC-BLK-SUB ASC-ITEM-SUB)           20190001
202000                                        TO MR-STORE-NAME (PV-SUB) 20200001
202001         MOVE ASC-START-DATE (ASC-BLK-SUB ASC-ITEM-SUB)           20200101
202010                                        TO MR-START-DATE (PV-SUB) 20201001
202011         MOVE ASC-START-TIME (ASC-BLK-SUB ASC-ITEM-SUB)           20201101
202020                                        TO MR-START-TIME (PV-SUB) 20202001
202030         MOVE ASC-END-DATE (ASC-BLK-SUB ASC-ITEM-SUB)             20203001
202040                                          TO MR-END-DATE (PV-SUB) 20204001
202050         MOVE ASC-END-TIME (ASC-BLK-SUB ASC-ITEM-SUB)             20205001
202060                                        TO MR-END-TIME (PV-SUB)   20206001
202061         MOVE ASC-USERID (ASC-BLK-SUB ASC-ITEM-SUB)               20206101
202070                                            TO MR-USERID (PV-SUB) 20207001
202100     END-IF.                                                      20210001
202200     SUBTRACT +1 FROM ASC-ITEM-SUB                                20220001
202300     IF  ASC-ITEM-SUB < + 1                                       20230001
202400         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  20240001
202500         MOVE +1                 TO ASC-BLK-SUB                   20250001
202600     END-IF.                                                      20260001
202700                                                                  20270001
202800******************************************************************20280001
202900** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **20290001
203000** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **20300001
203100** ISSUE A WARNING.                                             **20310001
203200******************************************************************20320001
203300 4430-CHECK-FOR-BEGIN-AND-END.                                    20330001
203400     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       20340001
203500         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     20350001
203600*            -- NO END-OF-RANGE SPECFIED ---                      20360001
203700             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            20370001
203800             SET DP020-MSG-WARNING TO TRUE                        20380001
203900*            PERFORM 4431-POSITION-AT-WARNING                     20390004
204000         END-IF                                                   20400001
204100     ELSE                                                         20410001
204200         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     20420001
204300*            -- NO BEGINNING-OF-RANGE SPECFIED ---                20430001
204400             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            20440001
204500             SET DP020-MSG-WARNING TO TRUE                        20450001
204600*            PERFORM 4431-POSITION-AT-WARNING                     20460004
204700         END-IF                                                   20470001
204800     END-IF.                                                      20480001
204900                                                                  20490001
205000******************************************************************20500007
205100** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **20510007
205200** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **20520007
205300** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **20530007
205400** POSITION THE CURSOR THERE.                                   **20540007
205500******************************************************************20550007
205600 4431-POSITION-AT-WARNING.                                        20560007
205700     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 20570007
205800                    - PV-TOP-ITEM + 1.                            20580007
205900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20590007
206000         CONTINUE                                                 20600007
206100*    ELSE                                                         20610007
206200*        SET DP030-SET-CURSOR-APPL-1                              20620007
206300*                                  TO TRUE                        20630007
206400*        MOVE -1                   TO MR-SELECTL (PV-SUB)         20640007
206500*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20650007
206600*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20660007
206700     END-IF.                                                      20670007
206800                                                                  20680007
206900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   20690007
207000                    - PV-TOP-ITEM + 1.                            20700007
207100     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      20710007
207200         CONTINUE                                                 20720007
207300*    ELSE                                                         20730007
207400*        SET DP030-SET-CURSOR-APPL-1  TO TRUE                     20740007
207600*        MOVE -1                   TO MR-SELECTL (PV-SUB)         20760007
207700*        MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         20770007
207800*        MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         20780007
207900     END-IF.                                                      20790007
208000                                                                  20800007
208100*----------------------------------------------------------------*20810007
208200* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *20820007
208300* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *20830007
208400* FOR THE SELECTED ITEMS QUEUE.                                  *20840007
208500*                                                                *20850007
208600* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *20860007
208700* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *20870007
208800* THE ARRAY IS FULL.                                             *20880007
208900*----------------------------------------------------------------*20890007
209000 5000-PREPARE-SEL-QUEUE.                                          20900007
209100     MOVE +1                   TO  ASC-BLK-SUB.                   20910007
209200     PERFORM 5100-WRITE-TEMP-STORAGE.                             20920007
209300     ADD +1                    TO  ASC-BLK-SUB.                   20930007
209400     PERFORM 5100-WRITE-TEMP-STORAGE.                             20940007
209500                                                                  20950007
209600     MOVE ASC-SEL-QUEUE-NAME   TO  CN012-SEL-QUEUE-NAME.          20960007
209700     PERFORM 6010-DELETE-SEL-QUEUE.                               20970007
209800                                                                  20980007
209900     SET ASC-UPDATE-TSQ        TO  TRUE.                          20990007
210000                                                                  21000007
210100     SET CN013-IDX             TO  1.                             21010007
210200     MOVE ZERO                 TO CN012-NUMBER-OF-TS-ITEMS.       21020007
210300     INITIALIZE CN013-SELECTED-ITEM-ARRAY.                        21030007
210400                                                                  21040007
210500     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21050007
210600             VARYING PV-ITEM                                      21060007
210700             FROM 1 BY 1                                          21070007
210800             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     21080007
210900                                                                  21090007
211000     IF  CN013-IDX > 1                                            21100007
211100         PERFORM 5205-WRITE-SEL-QUEUE                             21110007
211200         ADD +1                TO CN012-NUMBER-OF-TS-ITEMS        21120007
211300     END-IF.                                                      21130007
211400                                                                  21140007
223400*----------------------------------------------------------------*22340001
223500*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22350001
223600*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22360001
223700*----------------------------------------------------------------*22370001
223800 5100-WRITE-TEMP-STORAGE.                                         22380001
223900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22390001
224000                                   TO PV-LIST-ITEM-NUMBER.        22400001
224100     COMPUTE PV-BLOCK-NUMBER =                                    22410001
224200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22420001
224300                                                                  22430001
224400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22440001
224500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22450001
224600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22460001
224700             PERFORM 5105-REWRITE-ASC-LISTQ                       22470001
224800         END-IF                                                   22480001
224900     ELSE                                                         22490001
225000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22500001
225100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22510001
225200         PERFORM 5110-WRITE-ASC-LISTQ                             22520001
225300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22530001
225400     END-IF.                                                      22540001
225500                                                                  22550001
225600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22560001
225700                                                                  22570001
225800******************************************************************22580001
225900** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22590001
226000** SPECIFIC COMMAREA.                                           **22600001
226100******************************************************************22610001
226200 5105-REWRITE-ASC-LISTQ.                                          22620001
226300     EXEC CICS                                                    22630001
226400         WRITEQ TS                                                22640001
226500             QUEUE (ASC-LIST-QUEUE-NAME)                          22650001
226600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22660001
226700             ITEM  (PV-BLOCK-NUMBER)                              22670001
226800             REWRITE                                              22680001
226900             RESP  (PV-CICS-RESP)                                 22690001
227000     END-EXEC.                                                    22700001
227100                                                                  22710001
227200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22720001
227300         CONTINUE                                                 22730001
227400     ELSE                                                         22740001
227500         SET DP013-CICS-ABEND            TO TRUE                  22750001
227600         SET DP013-NO-ROLLBACK           TO TRUE                  22760001
227700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22770001
227800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22780001
227900                                         TO DP013-MESSAGE-TEXT(1) 22790001
228000         PERFORM DP013-0000-PROCESS-ABEND                         22800001
228100     END-IF.                                                      22810001
228200                                                                  22820001
228300******************************************************************22830001
228400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22840001
228500** SPECIFIC COMMAREA.                                           **22850001
228600******************************************************************22860001
228700 5110-WRITE-ASC-LISTQ.                                            22870001
228800     EXEC CICS                                                    22880001
228900         WRITEQ TS                                                22890001
229000             QUEUE (ASC-LIST-QUEUE-NAME)                          22900001
229100             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22910001
229200             ITEM  (PV-BLOCK-NUMBER)                              22920001
229300             RESP  (PV-CICS-RESP)                                 22930001
229400     END-EXEC.                                                    22940001
229500     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22950001
229600         SET DP013-CICS-ABEND      TO TRUE                        22960001
229700         SET DP013-NO-ROLLBACK     TO TRUE                        22970001
229800         MOVE '5110-WRITE-ASC-LISTQ'                              22980001
229900                                   TO DP013-PARAGRAPH             22990001
230000         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23000001
230100                                   TO DP013-MESSAGE-TEXT(1)       23010001
230200         PERFORM DP013-0000-PROCESS-ABEND                         23020001
230300     END-IF.                                                      23030001
230400                                                                  23040001
230500*----------------------------------------------------------------*23050007
230600* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23060007
230700* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23070007
230800*----------------------------------------------------------------*23080007
230900 5200-FILL-SEL-QUEUE-RECORD.                                      23090007
231000     PERFORM 6112-READ-LIST-QUEUE.                                23100007
231100                                                                  23110007
231200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23120007
231300         PERFORM VARYING LQW-IDX                                  23130007
231400         FROM 1 BY 1                                              23140007
231500         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23150007
231600           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               23160007
231700                                                                  23170007
231800           IF LQW-SELECT (LQW-IDX)                                23180007
231900                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX) TO            23190007
232000                                            CN013-ITEM (CN013-IDX)23200007
232300                 MOVE SPACE        TO CN013-ACTION-SW (CN013-IDX) 23230031
232310                 MOVE LQW-DOOR-ID (LQW-IDX)                       23231022
232320                                     TO CN013-DOOR-ID (CN013-IDX) 23232022
232400                 MOVE LQW-TYPE-CODE (LQW-IDX)                     23240007
232500                                   TO CN013-TYPE-CODE (CN013-IDX) 23250007
232510                 MOVE LQW-LOC-DESC (LQW-IDX)                      23251007
232520                                    TO CN013-LOC-DESC (CN013-IDX) 23252007
232530                 MOVE LQW-LANE-ASGNMT (LQW-IDX)                   23253007
232540                                 TO CN013-LANE-ASGNMT (CN013-IDX) 23254007
232550                 MOVE LQW-DIVERT-LOC (LQW-IDX)                    23255034
232560                               TO CN013-DIVERT-LOC-ID (CN013-IDX) 23256034
232561                 MOVE LQW-LBL-SEQ (LQW-IDX)                       23256134
232562                                TO CN013-LBL-SEQ-NBR (CN013-IDX)  23256234
232570                 MOVE LQW-STOR-ASGNMT (LQW-IDX)                   23257007
232580                                TO CN013-STORE-ASGNMT (CN013-IDX) 23258007
232600                                                                  23260007
232700                 SET CN013-IDX UP BY 1                            23270007
232800                 IF  CN013-IDX > CN013-MAX-ITEMS                  23280007
232900                     PERFORM 5205-WRITE-SEL-QUEUE                 23290007
233000                     ADD +1        TO CN012-NUMBER-OF-TS-ITEMS    23300007
233100                     INITIALIZE CN013-SELECTED-ITEM-ARRAY         23310007
233200                     SET CN013-IDX TO  1                          23320007
233300                 END-IF                                           23330007
233400           END-IF                                                 23340007
233500         END-PERFORM                                              23350007
233600     END-IF.                                                      23360007
233700                                                                  23370007
233800*----------------------------------------------------------------*23380007
233900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23390007
234000*----------------------------------------------------------------*23400007
234100 5205-WRITE-SEL-QUEUE.                                            23410007
234200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN013-SELECTED-ITEMS.   23420007
234300                                                                  23430007
234400     EXEC CICS                                                    23440007
234500          WRITEQ TS                                               23450007
234600              QUEUE (ASC-SEL-QUEUE-NAME)                          23460007
234700              FROM  (CN013-SELECT-RECORD)                         23470007
234800              ITEM  (PV-SEL-QUEUE-ITEM)                           23480007
234900              RESP  (PV-CICS-RESP)                                23490007
235000     END-EXEC.                                                    23500007
235100                                                                  23510007
235200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23520007
235300         CONTINUE                                                 23530007
235400     ELSE                                                         23540007
235500         SET DP013-CICS-ABEND      TO TRUE                        23550007
235600         SET DP013-NO-ROLLBACK     TO TRUE                        23560007
235700         MOVE '5205-WRITE-SEL-QUEUE'                              23570007
235800                                   TO DP013-PARAGRAPH             23580007
235900         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23590007
236000                                   TO DP013-MESSAGE-TEXT(1)       23600007
236100         PERFORM DP013-0000-PROCESS-ABEND                         23610007
236200     END-IF.                                                      23620007
236300                                                                  23630007
236400******************************************************************23640001
236500** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **23650001
236600** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **23660001
236700** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **23670001
236800** THE USER.                                                    **23680001
236900******************************************************************23690001
237000 6000-REFRESH-PANEL-FROM-TEMP.                                    23700001
237100     IF  ASC-UPDATE-TSQ                                           23710001
237200         SET ASC-NO-TSQ-UPDATE TO TRUE                            23720001
237300         MOVE ZERO                 TO PV-SAVE-ITEM                23730001
237400                                      PV-SEL-QUEUE-ITEM           23740001
237500         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23750001
237600                                   TO PV-HOLD-SELECTED-ITEMS      23760001
237700         MOVE +1                   TO PV-ITEMS-PROCESSED          23770001
237800         PERFORM 6100-UPDATE-TSQ                                  23780031
237900             UNTIL PV-ITEMS-PROCESSED >                           23790031
238000                                     PV-HOLD-SELECTED-ITEMS       23800031
238200         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23820001
238300                    ASC-BLOCK-ENTRIES (2)                         23830001
238400     END-IF.                                                      23840001
238500                                                                  23850001
238600*----------------------------------------------------------------*23860001
238700*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23870001
238800*----------------------------------------------------------------*23880001
238900 6010-DELETE-SEL-QUEUE.                                           23890001
239000                                                                  23900001
239100     EXEC CICS                                                    23910001
239200         DELETEQ TS                                               23920001
239300             QUEUE (ASC-SEL-QUEUE-NAME)                           23930001
239400             RESP  (PV-CICS-RESP)                                 23940001
239500     END-EXEC.                                                    23950001
239600*                                                                 23960001
239700     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23970001
239800        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23980001
239900         CONTINUE                                                 23990001
240000     ELSE                                                         24000001
240100         SET DP013-CICS-ABEND TO TRUE                             24010001
240200         SET DP013-NO-ROLLBACK TO TRUE                            24020001
240300         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          24030001
240400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24040001
240500                                        TO DP013-MESSAGE-TEXT (1) 24050001
240600         PERFORM DP013-0000-PROCESS-ABEND                         24060001
240700     END-IF.                                                      24070001
240800                                                                  24080001
240900*----------------------------------------------------------------*24090007
241000*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24100007
241100*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24110007
241200*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24120007
241300*    THE TEMP QUEUE.                                             *24130007
241400*----------------------------------------------------------------*24140007
241500 6100-UPDATE-TSQ.                                                 24150007
241600     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              24160007
241700     PERFORM 6105-READ-SEL-QUEUE.                                 24170007
241800     PERFORM                                                      24180007
241900         VARYING CN013-IDX FROM 1 BY 1                            24190007
242000         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     24200007
242100         OR (CN013-IDX GREATER THAN CN013-MAX-ITEMS))             24210007
242200         IF  CN013-ACTION-SW (CN013-IDX) > SPACE                  24220007
242300             PERFORM 6110-PROCESS-ITEMS                           24230007
242400         END-IF                                                   24240007
242500         ADD +1                TO PV-ITEMS-PROCESSED              24250007
242600     END-PERFORM.                                                 24260007
242700     PERFORM 6111-WRITE-LIST-QUEUE.                               24270007
242800                                                                  24280007
242900*----------------------------------------------------------------*24290007
243000*    READ THE LIST QUEUE RECORD.                                 *24300007
243100*----------------------------------------------------------------*24310007
243200 6105-READ-SEL-QUEUE.                                             24320007
243300                                                                  24330007
243400     EXEC CICS                                                    24340007
243500          READQ TS                                                24350007
243600              QUEUE (ASC-SEL-QUEUE-NAME)                          24360007
243700              INTO  (CN013-SELECT-RECORD)                         24370007
243800              ITEM  (PV-SEL-QUEUE-ITEM)                           24380007
243900              RESP  (PV-CICS-RESP)                                24390007
244000     END-EXEC.                                                    24400007
244100*                                                                 24410007
244200     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24420007
244300         CONTINUE                                                 24430007
244400     ELSE                                                         24440007
244500         SET DP013-CICS-ABEND      TO  TRUE                       24450007
244600         SET DP013-NO-ROLLBACK     TO  TRUE                       24460007
244700         MOVE '6105-READ-SEL-QUEUE'                               24470007
244800                                   TO  DP013-PARAGRAPH            24480007
244900         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24490007
245000                                   TO  DP013-MESSAGE-TEXT(1)      24500007
245100         PERFORM DP013-0000-PROCESS-ABEND                         24510007
245200     END-IF.                                                      24520007
245300                                                                  24530007
245400*----------------------------------------------------------------*24540007
245500*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24550007
245600*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24560007
245700*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24570007
245800*----------------------------------------------------------------*24580007
245900 6110-PROCESS-ITEMS.                                              24590007
246000                                                                  24600007
246100     COMPUTE PV-ITEM = 1 + ((CN013-ITEM (CN013-IDX) - 1)          24610007
246200                     / PC-ITEMS-PER-PANEL).                       24620007
246300                                                                  24630007
246400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24640007
246500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24650007
246600             PERFORM 6111-WRITE-LIST-QUEUE                        24660007
246700         END-IF                                                   24670007
246800         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24680007
246900                                                                  24690007
247000         PERFORM 6112-READ-LIST-QUEUE                             24700007
247100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24710007
247200             CONTINUE                                             24720007
247300         END-IF                                                   24730007
247400     END-IF.                                                      24740007
247500                                                                  24750007
247600     COMPUTE PV-SUB = (CN013-ITEM (CN013-IDX)                     24760007
247700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24770007
247800     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24780007
247900     MOVE LQW-SELECTED-SW (PV-SUB)                                24790007
248000                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24800007
248100     EVALUATE TRUE                                                24810007
248200         WHEN CN013-INQ (CN013-IDX)                               24820007
248300              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24830007
248400                                                                  24840007
248500         WHEN CN013-UPD (CN013-IDX)                               24850007
248600              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             24860007
248700                                                                  24870007
248800         WHEN CN013-DEL (CN013-IDX)                               24880007
248900              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             24890007
249000                                                                  24900007
249100         WHEN CN013-ERR (CN013-IDX)                               24910007
249200              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             24920007
249300                                                                  24930007
249600     END-EVALUATE.                                                24960007
249700                                                                  24970007
249800     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                24980007
249900                                                                  24990007
250000*----------------------------------------------------------------*25000007
250100*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25010007
250200*----------------------------------------------------------------*25020007
250300 6111-WRITE-LIST-QUEUE.                                           25030007
250400     EXEC CICS                                                    25040007
250500         WRITEQ TS                                                25050007
250600             QUEUE (ASC-LIST-QUEUE-NAME)                          25060007
250700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25070007
250800             ITEM  (PV-SAVE-ITEM)                                 25080007
250900             REWRITE                                              25090007
251000             RESP  (PV-CICS-RESP)                                 25100007
251100     END-EXEC.                                                    25110007
251200*                                                                 25120007
251300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25130007
251400         CONTINUE                                                 25140007
251500     ELSE                                                         25150007
251600         SET DP013-CICS-ABEND  TO  TRUE                           25160007
251700         SET DP013-NO-ROLLBACK TO  TRUE                           25170007
251800         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         25180007
251900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25190007
252000                               TO  DP013-MESSAGE-TEXT(1)          25200007
252100         PERFORM DP013-0000-PROCESS-ABEND                         25210007
252200     END-IF.                                                      25220007
252300                                                                  25230007
252400*----------------------------------------------------------------*25240007
252500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25250007
252600*----------------------------------------------------------------*25260007
252700 6112-READ-LIST-QUEUE.                                            25270007
252800     EXEC CICS                                                    25280007
252900         READQ TS                                                 25290007
253000             QUEUE (ASC-LIST-QUEUE-NAME)                          25300007
253100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25310007
253200             ITEM  (PV-ITEM)                                      25320007
253300             RESP  (PV-CICS-RESP)                                 25330007
253400     END-EXEC.                                                    25340007
253500*                                                                 25350007
253600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25360007
253700         CONTINUE                                                 25370007
253800     ELSE                                                         25380007
253900         SET DP013-CICS-ABEND        TO TRUE                      25390007
254000         SET DP013-NO-ROLLBACK       TO TRUE                      25400007
254100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25410007
254200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25420007
254300                                     TO DP013-MESSAGE-TEXT(1)     25430007
254400         PERFORM DP013-0000-PROCESS-ABEND                         25440007
254500     END-IF.                                                      25450007
254600                                                                  25460007
254610*----------------------------------------------------------------*25461014
254620* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *25462014
254630*----------------------------------------------------------------*25463014
254640 9100-READ-SEL-QUEUE.                                             25464014
254650     EXEC CICS                                                    25465014
254660         READQ TS                                                 25466014
254670             QUEUE (ASC-SEL-QUEUE-NAME)                           25467014
254680             INTO  (CN013-SELECT-RECORD)                          25468014
254690             ITEM  (ASC-SEL-ITEM)                                 25469014
254691             RESP  (PV-CICS-RESPONSE)                             25469114
254692     END-EXEC.                                                    25469214
254693                                                                  25469314
254694     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       25469414
254695         CONTINUE                                                 25469514
254696     ELSE                                                         25469614
254697         SET DP013-LOGIC-ABEND                                    25469714
254698             DP013-NO-ROLLBACK     TO TRUE                        25469814
254699         MOVE '9100-READ-SEL-QUEUE' TO DP013-PARAGRAPH            25469914
254700         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   25470014
254701                                   TO DP013-MESSAGE-TEXT (1)      25470114
254702         PERFORM DP013-0000-PROCESS-ABEND                         25470214
254703     END-IF.                                                      25470314
254704                                                                  25470414
254705*----------------------------------------------------------------*25470514
254706* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *25470614
254707*----------------------------------------------------------------*25470714
254708 9200-REWRITE-SEL-QUEUE.                                          25470814
254709     EXEC CICS                                                    25470914
254710          WRITEQ TS                                               25471014
254711              QUEUE  (ASC-SEL-QUEUE-NAME)                         25471114
254712              FROM   (CN013-SELECT-RECORD)                        25471214
254713              ITEM   (ASC-SEL-ITEM)                               25471314
254714              RESP   (PV-CICS-RESPONSE)                           25471414
254715              REWRITE                                             25471514
254716     END-EXEC.                                                    25471614
254717                                                                  25471714
254718     IF  PV-CICS-RESPONSE NOT = DFHRESP(NORMAL)                   25471814
254719         SET DP013-CICS-ABEND                                     25471914
254720             DP013-NO-ROLLBACK     TO TRUE                        25472014
254721         MOVE '9200-REWRITE-SEL-QUEUE'  TO DP013-PARAGRAPH        25472114
254722         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   25472214
254723                                   TO DP013-MESSAGE-TEXT (1)      25472314
254724         PERFORM DP013-0000-PROCESS-ABEND                         25472414
254725     END-IF.                                                      25472514
254726                                                                  25472614
254730*----------------------------------------------------------------*25473001
254800*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *25480001
254900*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *25490001
255000*----------------------------------------------------------------*25500001
255100 9900-SOFT-ABORT.                                                 25510001
255200     EXEC CICS SYNCPOINT                                          25520001
255300          ROLLBACK                                                25530001
255400     END-EXEC.                                                    25540001
255500                                                                  25550001
255600     SET  PS-ERROR                                                25560001
255700          PS-SOFT-ABORT-ERROR                                     25570001
255800          DP020-MSG-FATAL       TO  TRUE.                         25580001
255900                                                                  25590001
256000*----------------------------------------------------------------*25600001
256100*    ABEND PROCESSOR MODULE                                      *25610001
256200*----------------------------------------------------------------*25620001
256300     COPY DPPD013.                                                25630001
