000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'WMS ASN DOWNLOAD MODULE'.                                 00020000
000300 PROGRAM-ID.    WSKCS301.                                         00030000
000400 AUTHOR.        THERESE RAMSEYER.                                 00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  FEBRUARY 2007.                                    00060000
000700**************************************************************    00070000
000800*  THIS IS A CALLED MODULE.                                  *    00080000
000900*  THIS NORMALLY COMPILES WITH A RET CODE OF 4.              *    00090000
001000*                                                            *    00100000
001100*  CSSL - THIS PGM AUTOMATICALLY WRITES TO THE CSSL IN THE   *    00110000
001200*  EVENT OF AN ABEND, BUT A SWITCH CONTROLS THE OTHER CSSL   *    00120000
001300*  MESSAGES THAT ARE LEFT IN PLACE FOR DEBUGGING, ETC.       *    00130000
001400*                                                            *    00140000
001500*  PURPOSE:  THIS PROGRAM IS A CALLED MODULE THAT RECEIVES   *    00150000
001600*  --------  A SHIPMENT ID AND A TRIP ID FROM THE CALLING    *    00160000
001700*  PROGRAM.  IT CREATES ALL THE ASN TRANSMISSION RECORDS     *    00170000
001800*  NEEDED TO DOWNLOAD A SHIPMENT TO WMS.                     *    00180000
001900*                                                            *    00190000
002000*  THE DATA RECORDS CONTAINED IN WST_SHPMT_XREF_HDR -AND-    *    00200000
002100*  WST_SHPMT_XREF_DTL DRIVE THE PROCESSING.                  *    00210000
002200*                                                            *    00220000
002300*  ASN DWNLD RECORDS THAT ARE CREATED AND INSERTED TO        *    00230000
002400*  WST_ASN_DWNLD, ARE TRACKED IN WST_DAT_CNTL &              *    00240000
002500*  WST_DAT_XFER USING THE LAST 6 DIGITS OF THE DB2           *    00250000
002600*  CURRENT TMST (RETRIEVED ONCE IN PGM) FOR PRC_GP_ID.       *    00260000
002700*                                                            *    00270000
002800*  THE RECORDS CREATED FOR THE ASN DOWNLOAD WILL BE          *    00280000
002900*  PLACED INTO THE WST_ASN_DWNLD DB2 TABLE AND PROCESSED     *    00290000
003000*  BY WSKCS302. THE DOWNLOAD RECORDS INCLUDE :               *    00300000
003100*  'AP' APPOINTMENTS, 'AH' ASN HEADER, 'CH' CASE HEADER &    *    00310000
003200*  'CD' CASE DETAIL.                                         *    00320000
003300*                                                            *    00330000
003400*   EACH RECORD THAT GETS INSERTED TO THE WST_ASN_DWNLD TBL  *    00340000
003500*   WILL BE ASSIGNED 3 NUMBERS IN ORDER TO MAINTAIN THEIR    *    00350000
003600*   ASSOCIATION WITH EACH OTHER, AND TO BE SORTED IN         *    00360000
003700*   A SPECIFIC ORDER TO BE PROCESSED IN WSKCS302.            *    00370000
003800*                                                            *    00380000
003900*   ROW NBR: THIS IS INCREMENTED SEQUENTIALLY DURING         *    00390000
004000*   PROCESSING - SO IF THERE ARE 30 ROWS INSERTED INTO       *    00400000
004100*   WST_ASN_DWNLD, THEN THE ROW NBRS RANGE FROM 1 THRU 30.   *    00410000
004200*                                                            *    00420000
004300*   GROUP NBR: THIS IS INTENDED TO KEEP RELATED RECORDS      *    00430000
004400*   GROUPED TOGETHER, SUCH AS CASE HDR W/ CASE DTL.          *    00440000
004500*                                                            *    00450000
004600*   DETAIL NBR: THIS IS USED TO MATCH NBR OF CASE DETAILS    *    00460000
004700*   WITH CASE HEADERS.                                       *    00470000
004800*                                                            *    00480000
004900*  SEE EXAMPLE BELOW:                                        *    00490000
005000*                                                            *    00500000
005100*  SHPMT       ROW      GROUP      DETAIL     REC TYPE       *    00510000
005200* -------     -----    -------    --------   -----------     *    00520000
005300*  12345        1         1         99999    AP APPOINTMENT  *    00530000
005400*  12345        2         2         99999    AH ASN HEADER   *    00540000
005500*  12345        3         3         99999    AD ASN DETAIL   *    00550000
005600*  12345        4         4         99999    AD ASN DETAIL   *    00560000
005700*  12345        5         5           1      CD CASE DETAIL  *    00570000
005800*  12345        6         5           1      CH CASE HEADER  *    00580000
005900*  12345        7         6           1      CD CASE DETAIL  *    00590000
006000*  12345        8         6           1      CH CASE HEADER  *    00600000
006100*  12345        9         7           2      CD CASE DETAIL  *    00610000
006200*  12345        10        7           2      CD CASE DETAIL  *    00620000
006300*  12345        11        7           2      CH CASE HEADER  *    00630000
006400*  12345        12        8           1      CD CASE DETAIL  *    00640000
006500*  12345        13        8           1      CH CASE HEADER  *    00650000
006600*  12345        14        9           3      CD CASE DETAIL  *    00660000
006700*  12345        15        9           3      CD CASE DETAIL  *    00670000
006800*  12345        16        9           3      CD CASE DETAIL  *    00680000
006900*  12345        17        9           3      CH CASE HEADER  *    00690000
007000*  -----------------------------------------------------------    00700000
007100*                                                            *    00710000
007200*  MAIN PROCESSING:                                          *    00720000
007300*  ---------------                                           *    00730000
007400*  THE HIGHEST LEVEL LOOP IS PERFORMED FROM A CURSOR, THOUGH *    00740000
007500*  THIS WILL ONLY CYCLE ONCE TO COMPLETELY PROCESS 1         *    00750000
007600*  SHIPMENT DOWNLOAD TO WMS AT A TIME.                       *    00760000
007700*  THIS PROGRAM IS PASSED A SINGLE SHIPMENT ID.              *    00770000
007800*  THE PRIMARY KEY FOR THE WST_SHPMT_XREF_HDR TBL IS         *    00780000
007900*  EXT_SHP_ID.                                               *    00790000
008000*                                                            *    00800000
008100*  PROCESS FLOWS AS FOLLOWS:                                 *    00810000
008200*  ------------------------                                  *    00820000
008300*                                                            *    00830000
008400*  1) 1100- UPDATE THE WST_SHPMT_XREF_DTL DWNLD CODE TO 'N'  *    00840000
008500*                                                            *    00850000
008600*  2) SPIN THE TRIP_ID_CSR TO LOOK FOR TROUBLE ON ANY LEVEL. *    00860000
008700*     PARA 1200- THROUGH 1500- .                             *    00870000
008800*     (RCVR, PRE-PACK OR PO-LINE). ANY DTLS IN TROUBLE WILL  *    00880000
008900*     NOT BE DOWNLOADED, AND AN ENTIRE SHIPMENT WILL NOT     *    00890000
009000*     BE DOWNLOADED IF IT CONSISTS OF ONE SINGLE RCVR THAT   *    00900000
009100*     IS ALSO IN TROUBLE.                                    *    00910000
009200*                                                            *    00920000
009300*   3) FOR SHPMT, GET SCAC, PRO NBR & OPER UNT ID  2200-     *    00930000
009400*                                                            *    00940000
009500*   4) CHECK INTEGRATION TYPE 2400-   : THIS DETERMINES      *    00950000
009600*      WHAT GETS WRITTEN TO THE ASN_DWNLD TABLE.             *    00960000
009700*      WHEN WST00010-ATTR-ELEM-TXT = 'D' , EVERYTHING IS     *    00970000
009800*      WRITTEN. WHEN WST00010-ATTR-ELEM-TXT = 'H' , ONLY     *    00980000
009900*      THE ASN HDR RECORD IS WRITTEN. WHEN 'N', THEN NOTHING *    00990000
010000*      IS WRITTEN TO THE ASN_DWNLD TBL.                      *    01000000
010100*      IMPORTANT NOTE: THE ASN_DWNLD TABLE WAS ORIGINALLY    *    01010000
010200*      A VIRTUAL TABLE, SO IT IS REFERRED TO AS THE TEMP     *    01020000
010300*      TABLE THROUGHOUT THE PROGRAM. WHEN THE ASN_DWNLD TBL  *    01030000
010400*      WAS CHANGED TO A PERMANENT DB2 TABLE, THE 'TEMP'      *    01040000
010500*      REFERENCE WAS LEFT INTACT BECAUSE IT WAS A PART OF    *    01050000
010600*      SO MANY REFERENCES, PARAGRAPH NAMES AND SWITHCHES.    *    01060000
010700*                                                            *    01070000
010800*   5) 2500-APPOINTMENTS: CREATE AN AP REC IF THE HDR        *    01080000
010900*      DWNLD_CDE IS 'N' (FIRST TIME BEING DWNLOADED) AND     *    01090000
011000*      THIS IS NOT A DUMMY SHIPMENT (WHERE DUMMY SEQ = 0)    *    01100000
011100*      2600- INSERTS THE TBL                                 *    01110000
011200*      NOTE : FROM THE "WHEN SQLCODE = 0" CONDITION IN       *    01120000
011300*      2500- COMES THE REST OF THE RECORD CREATING AS        *    01130000
011400*      FAR AS ASN DTLS, CASE CTLS AND CASE HDRS, ETC.        *    01140000
011500*                                                            *    01150000
011600*   6) 2700-CREATE-ASN-HDR                                   *    01160000
011700*                                                            *    01170000
011800*   7) 2800-CREATE-ASN-DTL-LVL                               *    01180000
011900*                                                            *    01190000
012000*   8) 3200-CASE-LVL-PROCESSING:                             *    01200000
012100*   .      3220-FETCH-CS-DTL-CSR                             *    01210000
012200*   .           WHEN SQLCODE = 0                             *    01220000
012300*   .                PERFORM 3400-PROCESS-CS-LVL-ASNS        *    01230000
012400*   .                    PERFORMS: 3600-GET-PREPACK-CASES    *    01240000
012500*   .                                 AND/OR                 *    01250000
012600*   .                              5000-GET-LN-LVL-CASES     *    01260000
012700*   .                                 AND/OR                 *    01270000
012800*   .                              5500-GET-PBS-CASES        *    01280000
012900*   .                                                        *    01290000
013000*   .                       (THE SEQUENCE OF CASE DTL        *    01300000
013100*   .                        PARAGRAPHS IS THE SAME AS       *    01310000
013200*   .                        EXECUTED FROM THE +0 RET        *    01320000
013300*   .                        CODE FROM THE MAIN FETCH        *    01330000
013400*   .                        IN 8A, 8B, 8C)                  *    01340000
013500*   .                                                        *    01350000
013600*   .                                                        *    01360000
013700*   8A) 3600-GET-PREPACK-CASES:                              *    01370000
013800*           3820-FETCH-CARTON-PK-CSR                         *    01380000
013900*                WHEN SQLCODE = 0                            *    01390000
014000*                     PERFORMS: 6650-MULTIPLE-SKU-CHECK      *    01400000
014100*                               6000-CARTON-CONTENT-DTLS     *    01410000
014200*                                   6120-FETCH-CTN-CNTNT-CSR *    01420000
014300*                                      WHEN SQLCODE = 0      *    01430000
014400*                                         PERFORM:           *    01440000
014500*                                           6200-CREATE-CS-LVL-DTL01450000
014600*                                           (CS DTL FOR ASN_DWNLD)01460000
014700*                                      WHEN SQLCODE = 100    *    01470000
014800*                                         PERFORM:           *    01480000
014900*                                           6600-CREATE-CS-LVL-HDR01490000
015000*                                           (CS HDR FOR ASN_DWNLD)01500000
015100*                                                            *    01510000
015200*                                                            *    01520000
015300*   8B) 5000-GET-LN-LVL-CASES                                *    01530000
015400*           5020-FETCH-CARTON-CSR                            *    01540000
015500*                WHEN SQLCODE = 0                            *    01550000
015600*                     PERFORMS: 6650-MULTIPLE-SKU-CHECK      *    01560000
015700*                               6000-CARTON-CONTENT-DTLS     *    01570000
015800*                                   6120-FETCH-CTN-CNTNT-CSR *    01580000
015900*                                      WHEN SQLCODE = 0      *    01590000
016000*                                         PERFORM:           *    01600000
016100*                                           6200-CREATE-CS-LVL-DTL01610000
016200*                                           (CS DTL FOR ASN_DWNLD)01620000
016300*                                      WHEN SQLCODE = 100    *    01630000
016400*                                         PERFORM:           *    01640000
016500*                                           6600-CREATE-CS-LVL-HDR01650000
016600*                                           (CS HDR FOR ASN_DWNLD)01660000
016700*                                                            *    01670000
016800*   8C) 5500-GET-PBS-CASES                                   *    01680000
016900*           5520-FETCH-PBS-CS-CSR                            *    01690000
017000*                WHEN SQLCODE = 0                            *    01700000
017100*                     PERFORMS: 6650-MULTIPLE-SKU-CHECK      *    01710000
017200*                               6000-CARTON-CONTENT-DTLS     *    01720000
017300*                                   6120-FETCH-CTN-CNTNT-CSR *    01730000
017400*                                      WHEN SQLCODE = 0      *    01740000
017500*                                         PERFORM:           *    01750000
017600*                                           6200-CREATE-CS-LVL-DTL01760000
017700*                                           (CS DTL FOR ASN_DWNLD)01770000
017800*                                      WHEN SQLCODE = 100    *    01780000
017900*                                         PERFORM:           *    01790000
018000*                                           6600-CREATE-CS-LVL-HDR01800000
018100*                                           (CS HDR FOR ASN_DWNLD)01810000
018200*                                                            *    01820000
018300*                                                            *    01830000
018400*   9) 7100-UPD-HDR-XREF-VER-NBR - INCREMENTED EVERY TIME    *    01840000
018500*      THE SHIPMENT IS DOWNLOADED.                           *    01850000
018600*                                                            *    01860000
018700*   10) 7200-ASN-DWNLD-MODULE: CALLS WSKCS302 TO PROCESS     *    01870000
018800*       THE RECORDS IN WST_ASN_DWNLD                         *    01880000
018900*                                                            *    01890000
019000*   11) UPON SUCCESSFUL RETURN FROM WSKCS302, PERFORM        *    01900000
019100*       7420-FETCH-XREF-DTL-CSR WHICH CALLS FOR EVERY        *    01910000
019200*       DTL THE 7450-CALL-PO-RCVR-TRKG-MOD TO INSERT         *    01920000
019300*       RCT_PO_RCVR_TRKG.                                    *    01930000
019400*                                                            *    01940000
019500**************************************************************    01950000
019600 DATE-COMPILED.                                                   01960000
019700 ENVIRONMENT DIVISION.                                            01970000
019800 CONFIGURATION SECTION.                                           01980000
019900 SOURCE-COMPUTER. IBM-3090.                                       01990000
020000 OBJECT-COMPUTER. IBM-3090.                                       02000000
020100                                                                  02010000
020200 DATA DIVISION.                                                   02020000
020300 WORKING-STORAGE SECTION.                                         02030000
020400 01  PV-PROGRAM-VARIABLES-1.                                      02040000
020500     05  PV-TASK-X.                                               02050000
020600         10  PV-TASK                     PIC   9(7)  VALUE ZERO.  02060000
020700 01  PV-PROGRAM-VARIABLES.                                        02070000
020800     05  PV-UNION-TYPE                PIC  X(01).                 02080000
020900     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  02090000
021000                                                     COMP SYNC.   02100000
021100     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO        02110000
021200                                                COMP SYNC.        02120000
021300     05  PV-DUMMY-VARIABLE            PIC  X(01) VALUE SPACE.     02130000
021400     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02140000
021500                                                     COMP.        02150000
021600     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     02160000
021700                                                     COMP SYNC.   02170000
021800     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0         02180000
021900                                                COMP SYNC.        02190000
022000     05  PV-RECS-IN-TRBL-COUNT        PIC S9(04) VALUE +0         02200000
022100                                                COMP SYNC.        02210000
022200     05  PV-ROW-COUNTER               PIC S9(04) VALUE +0         02220000
022300                                                COMP SYNC.        02230000
022400     05  PV-GROUP-COUNTER             PIC S9(04) VALUE +0         02240000
022500                                                COMP SYNC.        02250000
022600     05  PV-MULT-SKU-COUNTER          PIC S9(04) VALUE +0         02260000
022700                                                COMP SYNC.        02270000
022800     05  PV-CARTON-CNTNT-COUNTER      PIC S9(04) VALUE +0         02280000
022900                                                COMP SYNC.        02290000
023000     05  PV-RCVR-COUNT                PIC S9(04) VALUE +0         02300000
023100                                                COMP SYNC.        02310000
023200     05  PV-PRC-LOD-SEQ-ID            PIC  S9(9) COMP VALUE +0.   02320000
023300     05  PV-TROUBLE-COUNT             PIC  S9(09) COMP VALUE +0.  02330000
023400     05  PV-HOLD-TRIP-CSR-PREPK-ID    PIC  S9(4) COMP VALUE +0.   02340000
023500     05  PV-HOLD-TRIP-CSR-PO-NBR      PIC  S9(09) COMP VALUE +0.  02350000
023600     05  PV-HOLD-RCVR-NBR             PIC  S9(09) COMP VALUE +0.  02360000
023700     05  PV-HOLD-CS-LVL-PREPK-ID      PIC  S9(4) COMP VALUE +0.   02370000
023800     05  PV-HOLD-CS-LVL-PO-NBR        PIC  S9(09) COMP VALUE +0.  02380000
023900     05  PV-HOLD-CS-LVL-REC-SEQ-NBR   PIC  S9(09) COMP VALUE +0.  02390000
024000     05  PV-DISP-EXT-SHP-ID           PIC  X(20) VALUE SPACE.     02400000
024100     05  PV-DISP-TRIP-ID              PIC  9(09) VALUE ZERO.      02410000
024200     05  PV-DISP-ENT-ID               PIC  9(09) VALUE ZERO.      02420000
024300     05  PV-DISP-SQLCODE              PIC -9(05) VALUE ZEROES.    02430000
024400     05  PV-DISP-PO-NBR               PIC  9(09) VALUE ZEROES.    02440000
024500     05  PV-DISP-RCVR-SEQ-NBR         PIC  9(04) VALUE ZEROES.    02450000
024600     05  PV-DISP-PREPK-ID             PIC  9(04) VALUE ZEROES.    02460000
024700     05  PV-DISP-PO-LINE-NBR          PIC  9(04) VALUE ZEROES.    02470000
024800     05  PV-DISP-OPER-UNT-ID          PIC  9(04) VALUE ZEROES.    02480000
024900     05  PV-DISP-CSE-DTL-NBR          PIC  9(04) VALUE ZEROES.    02490000
025000     05  PV-DISP-REC-TYP-GP-NBR       PIC  9(09) VALUE ZEROES.    02500000
025100     05  PV-DISP-ROW-NBR              PIC  9(09) VALUE ZEROES.    02510000
025200     05  PV-DISP-VER-NBR              PIC  9(04) VALUE ZEROES.    02520000
025300     05  PV-DISP-DMY-SEQ-NBR          PIC  9(04) VALUE ZEROES.    02530000
025400     05  PV-DISP-PRC-LOD-SEQ          PIC  9(04) VALUE ZEROES.    02540000
025500     05  PV-DISP-RECS-IN-TRBL-COUNT   PIC  9(04) VALUE ZEROES.    02550000
025600     05  PV-DISP-RCVR-COUNT           PIC  9(04) VALUE ZEROES.    02560000
025700     05  PV-DISP-LAST-HOST-INPUT-ID   PIC  9(04) VALUE ZEROES.    02570000
025800     05  PV-DISP-HOST-INPUT-ID        PIC  9(04) VALUE ZEROES.    02580000
025900     05  PV-DISP-SHIPT-UNT-ID         PIC  9(18) VALUE ZEROES.    02590000
026000     05  PV-DISP-SKU                  PIC  9(09) VALUE ZEROES.    02600000
026100     05  PV-DISP-INTR-UPC-ID          PIC  9(09) VALUE ZEROES.    02610000
026200     05  PV-DISP-TRN-TYP-CDE          PIC  X(08) VALUE SPACES.    02620000
026300     05  PV-DISP-PRC-GP-ID            PIC  9(09) VALUE ZEROES.    02630000
026400     05  PV-DISP-LOC-NBR              PIC  9(04) VALUE ZEROES.    02640000
026500     05  PV-OPER-UNT-ID-PIC9          PIC   9(04) VALUE 0.        02650000
026600     05  PV-CURRENT-TMST              PIC   X(26) VALUE SPACE.    02660000
026700     05  PV-CICS-MSG-AREA             PIC  X(100) VALUE SPACE.    02670000
026800     05  PV-SWITCH-IND                PIC   X(01) VALUE SPACE.    02680000
026900     05  PV-PROGRAM-NAME              PIC   X(08) VALUE SPACE.    02690000
027000     05  PV-TEMP-COPYBOOK-NAME        PIC   X(08) VALUE SPACE.    02700000
027100     05  PV-LAST-HOST-INPUT-ID        PIC   S9(04) COMP VALUE +0. 02710000
027200     05  PV-HOST-INPUT-ID             PIC   S9(04) COMP VALUE +0. 02720000
027300     05  PV-ETA-REFORMATTED           PIC   X(14) VALUE SPACE.    02730000
027400     05  PV-UNIT-WT                   PIC   9(13) VALUE 0.        02740000
027500     05  PV-CARTON-WT                 PIC   9(13) VALUE 0.        02750000
027600     05  PV-TOT-UNITS-IN-CASE         PIC   9(13) VALUE 0.        02760000
027700     05  PV-DISP-NUM                  PIC   9(09) VALUE 0.        02770000
027800     05  PV-HDR-CSR-FETCH-COUNT       PIC   9(09) VALUE 0.        02780000
027900     05  PV-TRN-LNE-CDE               PIC X(09).                  02790000
028000     05  PV-TRN-LNE-CDE-PIC           REDEFINES PV-TRN-LNE-CDE.   02800000
028100         10  PV-TRN-LNE-NBR           PIC 9(09).                  02810000
028200**AMIT**21/07/2013**INITIAL                                       02820000
028300     05  PV-AMT                       PIC  9(16)V99.              02830000
028400     05  PV-UNIT-RTL-AMT              PIC  9(07)V99.              02840000
028500     05  PV-FINAL-AMT                 PIC  9(16)V99.              02850000
028600     05  PV-TROUBLE-COUNT1            PIC  S9(09) COMP VALUE +0.  02860000
028700     05  PV-TROUBLE-COUNTC            PIC  S9(09) COMP VALUE +0.  02870000
028800**AMIT**21/07/2013**FINAL                                         02880000
028900                                                                  02890000
029000**ROOPA**21/07/2013**INITIAL                                      02900000
029100     05 PV-TM-FREEFORM-TXT.                                       02910000
029200       10  FILLER               PIC X(18) VALUE                   02920000
029300           ' RETAIL AMOUNT:  $'.                                  02930000
029400       10  PV-TM-FREEFORM-TXT-2  PIC  ZZZZ9.99.                   02940000
029500 01  PRV-PROGRAM-RETURN-VARIABLES.                                02950000
029600     05  PRV-00                       PIC X(42) VALUE             02960000
029700         '00PROGRAM CALL WAS SUCCESSFUL             '.            02970000
029800**ROOPA**21/07/2013**FINAL                                        02980000
029900                                                                  02990000
030000 01  DK-DATA-KEYS.                                                03000000
030100     05  DK-TRIP-ID                   PIC  S9(09) COMP VALUE +0.  03010000
030200     05  DK-EXT-SHP-ID                PIC   X(20) VALUE SPACE.    03020000
030300*ROOPA START                                                      03030000
030400     05  DK-REC-TYP-DESC.                                         03040000
030500          49 DK-REC-TYP-DESC-LEN      PIC S9(4) COMP.             03050000
030600          49 DK-REC-TYP-DESC-TEXT     PIC X(300).                 03060000
030700     05  DK-REC-TYP-DESC-P            REDEFINES DK-REC-TYP-DESC.  03070000
030800*        10  DK-DUMMY-WILDCRD1        PIC  X(01).                 03080000
030900         10  DK-REC-TYP-DESC-C        PIC  X(300).                03090000
031000         10  DK-DUMMY-WILDCRD2        PIC  X(01).                 03100000
031100*ROOPA END                                                        03110000
031200                                                                  03120000
031300 01  PS-PROGRAM-SWITCHES.                                         03130000
031400     05  PS-ERROR-SW                   PIC  X(01)    VALUE 'N'.   03140000
031500         88  PS-ERROR                                VALUE 'Y'.   03150000
031600         88  PS-NO-ERROR                             VALUE 'N'.   03160000
031700     05  PS-END-OF-TRIP-ID-SW          PIC  X(01)    VALUE 'N'.   03170000
031800         88  PS-END-OF-TRIP-ID-CSR-YES               VALUE 'Y'.   03180000
031900         88  PS-END-OF-TRIP-ID-CSR-NO                VALUE 'N'.   03190000
032000     05  PS-END-OF-HDR-CSR-1-SW        PIC  X(01)    VALUE 'N'.   03200000
032100         88  PS-END-OF-HDR-CSR-1-YES                 VALUE 'Y'.   03210000
032200         88  PS-END-OF-HDR-CSR-1-NO                  VALUE 'N'.   03220000
032300     05  PS-END-OF-ASN-DTL-CSR-SW      PIC  X(01)    VALUE 'N'.   03230000
032400         88  PS-END-OF-ASN-DTL-CSR-YES               VALUE 'Y'.   03240000
032500         88  PS-END-OF-ASN-DTL-CSR-NO                VALUE 'N'.   03250000
032600     05  PS-END-OF-CS-DTL-CSR-SW       PIC  X(01)    VALUE 'N'.   03260000
032700         88  PS-END-OF-CS-DTL-CSR-YES                VALUE 'Y'.   03270000
032800         88  PS-END-OF-CS-DTL-CSR-NO                 VALUE 'N'.   03280000
032900     05  PS-PACK-BY-STORE-SW           PIC  X(01)    VALUE 'N'.   03290000
033000         88  PS-PACK-BY-STORE-YES                    VALUE 'Y'.   03300000
033100         88  PS-PACK-BY-STORE-NO                     VALUE 'N'.   03310000
033200     05  PS-END-OF-CARTON-PK-CSR-SW    PIC  X(01)    VALUE 'N'.   03320000
033300         88  PS-END-OF-CARTON-PK-CSR-YES             VALUE 'Y'.   03330000
033400         88  PS-END-OF-CARTON-PK-CSR-NO              VALUE 'N'.   03340000
033500     05  PS-END-OF-CTN-CNTNT-CSR-SW    PIC  X(01)    VALUE 'N'.   03350000
033600         88  PS-END-OF-CTN-CNTNT-CSR-YES             VALUE 'Y'.   03360000
033700         88  PS-END-OF-CTN-CNTNT-CSR-NO              VALUE 'N'.   03370000
033800     05  PS-MULTIPLE-SKU-SW            PIC  X(01)    VALUE 'N'.   03380000
033900         88  PS-MULTIPLE-SKU-YES                     VALUE 'Y'.   03390000
034000         88  PS-MULTIPLE-SKU-NO                      VALUE 'N'.   03400000
034100*ROOPA START                                                      03410000
034200     05  PS-SKU-EXISTS-ON-DWNLD-SW     PIC  X(01)    VALUE 'N'.   03420000
034300         88  PS-SKU-EXISTS-ON-DWNLD-YES              VALUE 'Y'.   03430000
034400         88  PS-SKU-EXISTS-ON-DWNLD-NO               VALUE 'N'.   03440000
034500*ROOPA END                                                        03450000
034600     05  PS-END-OF-CARTON-CSR-SW       PIC  X(01)    VALUE 'N'.   03460000
034700         88  PS-END-OF-CARTON-CSR-YES                VALUE 'Y'.   03470000
034800         88  PS-END-OF-CARTON-CSR-NO                 VALUE 'N'.   03480000
034900     05  PS-END-OF-PBS-CS-CSR-SW       PIC  X(01)    VALUE 'N'.   03490000
035000         88  PS-END-OF-PBS-CS-CSR-YES                VALUE 'Y'.   03500000
035100         88  PS-END-OF-PBS-CS-CSR-NO                 VALUE 'N'.   03510000
035200     05  PS-END-OF-XREF-DTL-CSR-SW     PIC  X(01)    VALUE 'N'.   03520000
035300         88  PS-END-OF-XREF-DTL-CSR-YES              VALUE 'Y'.   03530000
035400         88  PS-END-OF-XREF-DTL-CSR-NO               VALUE 'N'.   03540000
035500     05  PS-THIS-IS-ASN-HDR-SW         PIC  X(01)    VALUE 'N'.   03550000
035600         88  PS-THIS-IS-ASN-HDR-YES                  VALUE 'Y'.   03560000
035700         88  PS-THIS-IS-ASN-HDR-NO                   VALUE 'N'.   03570000
035800     05  PS-WRITE-TO-CSSL-SW           PIC  X(01)    VALUE 'N'.   03580000
035900         88  PS-WRITE-TO-CSSL-YES                    VALUE 'Y'.   03590000
036000         88  PS-WRITE-TO-CSSL-NO                     VALUE 'N'.   03600000
036100     05  PS-INTEGRATION-TYP-CDE-SW     PIC  X(01)    VALUE ' '.   03610000
036200         88  PS-WRITE-ALL-TO-TEMP                    VALUE 'D'.   03620000
036300         88  PS-WRITE-HDR-ONLY-TO-TEMP               VALUE 'H'.   03630000
036400         88  PS-WRITE-NOTHING-TO-TEMP                VALUE 'N'.   03640000
036500     05  PS-DAT-CNTL-REC-INSERTED-SW   PIC  X(01)    VALUE ' '.   03650000
036600         88  PS-DAT-CNTL-REC-INSERTED-YES            VALUE 'Y'.   03660000
036700         88  PS-DAT-CNTL-REC-INSERTED-NO             VALUE 'N'.   03670000
036800     05  PS-TROUBLE-SW                 PIC  X(01)    VALUE ' '.   03680000
036900         88  PS-TROUBLE-FOUND-YES                    VALUE 'Y'.   03690000
037000         88  PS-TROUBLE-FOUND-NO                     VALUE 'N'.   03700000
037100     05  PS-BYPASS-SW                  PIC  X(01)    VALUE ' '.   03710000
037200         88  PS-BYPASS-YES                           VALUE 'Y'.   03720000
037300         88  PS-BYPASS-NO                            VALUE 'N'.   03730000
037400**AMIT**21/07/2013**INITIAL                                       03740000
037500     05  PS-RETAIL-SW                  PIC  X(01)    VALUE ' '.   03750000
037600         88  PS-RETAIL-OPEN                          VALUE 'Y'.   03760000
037700         88  PS-RETAIL-CLOSE                         VALUE 'N'.   03770000
037800     05  PS-TROUBLES-SW                PIC  X(01)    VALUE ' '.   03780000
037900         88  PS-TROUBLE-FLAG-YES                     VALUE 'Y'.   03790000
038000         88  PS-TROUBLE-FLAG-NO                      VALUE 'N'.   03800000
038100**AMIT**21/07/2013**FINAL                                         03810000
038200**ROOPA**31/07/2013**INITIAL                                      03820000
038300     05  PS-DONE-SW                   PIC  X    VALUE 'N'.        03830000
038400         88  PS-NOT-DONE                        VALUE 'N'.        03840000
038500         88  PS-DONE                            VALUE 'Y'.        03850000
038600**ROOPA**31/07/2013**FINAL                                        03860000
038700                                                                  03870000
038800 01  PC-PROGRAM-CONSTANTS.                                        03880000
038900     05  PC-MAX-RETRIES              PIC S9(04) VALUE +3 COMP.    03890000
039000     05  PC-HIGH-NINES               PIC S9(04) VALUE +9999 COMP. 03900000
039100     05  PC-TEMP-TBL-DESC-LENGTH     PIC S9(04) COMP VALUE +300.  03910000
039200**ROOPA**31/07/2013**INITIAL                                      03920000
039300     05  PC-600                       PIC S9(4) COMP VALUE +600.  03930000
039400     05  PC-516                       PIC S9(4) COMP VALUE +516.  03940000
039500     05  PC-TMKCS521                  PIC X(08) VALUE             03950000
039600                                                'TMKCS521'.       03960000
039700**ROOPA**31/07/2013**FINAL                                        03970000
039800     05  PC-PROGRAM-NAME             PIC  X(08) VALUE 'WSKCS301'. 03980000
039900     05  PC-ASN-DWNLD-PGM            PIC  X(08) VALUE 'WSKCS302'. 03990000
040000     05  PC-PRC-TYP-CDE              PIC  X(08) VALUE 'ASN     '. 04000000
040100     05  PC-DEFAULT-NINES            PIC  X(26) VALUE             04010000
040200                                     '9999-09-09-09.09.09.999999'.04020000
040300     05  PC-DAT-LOAD-VER-NBR      PIC  S9(2)V9(2) COMP-3 VALUE +1.04030000
040400     05  PC-DC-FUNC-CDE-DWNLD        PIC   X(02) VALUE '0I'.      04040000
040500     05  PC-DC-FUNC-CDE-TRBL         PIC   X(02) VALUE '0J'.      04050000
040600     05  PC-APPL-FUNC-DESC          PIC  X(10) VALUE 'REPOSITORY'.04060000
040700     05  PC-INTGRTN-TYP-CDE         PIC  X(10) VALUE 'VNDRASN   '.04070000
040800     05  PC-ATTR-DEFN-SEQ-NBR        PIC S9(04) COMP VALUE +1.    04080000
040900     05  PC-STAT-CDE                 PIC  X(06) VALUE 'LOADIN'.   04090000
041000     05  PC-A                        PIC  X(01) VALUE 'A'.        04100000
041100     05  PC-Y                        PIC  X(01) VALUE 'Y'.        04110000
041200     05  PC-D                        PIC  X(01) VALUE 'D'.        04120000
041300     05  PC-H                        PIC  X(01) VALUE 'H'.        04130000
041400     05  PC-P                        PIC  X(01) VALUE 'P'.        04140000
041500     05  PC-AP                       PIC  X(02) VALUE 'AP'.       04150000
041600     05  PC-AH                       PIC  X(02) VALUE 'AH'.       04160000
041700     05  PC-AD                       PIC  X(02) VALUE 'AD'.       04170000
041800     05  PC-CD                       PIC  X(02) VALUE 'CD'.       04180000
041900     05  PC-CH                       PIC  X(02) VALUE 'CH'.       04190000
042000     05  PC-M                        PIC  X(01) VALUE 'M'.        04200000
042100     05  PC-N                        PIC  X(01) VALUE 'N'.        04210000
042200     05  PC-T                        PIC  X(01) VALUE 'T'.        04220000
042300**AMIT**21/07/2013**INITIAL                                       04230000
042400**   05  CT-DOLLAR-VALUE              PIC  9(04) VALUE 5000.      04240000
042500     05  CT-DOLLAR-VALUE              PIC  9(16)V99 VALUE ZERO.   04250000
042600     05  PC-PROGRAM-NAME1            PIC  X(08) VALUE 'WSKCS30B'. 04260000
042700**AMIT**21/07/2013**FINAL                                         04270000
042800                                                                  04280000
042900******************************************************************04290000
043000*  COMMUNICATIONS AREA FOR DB2                                    04300000
043100******************************************************************04310000
043200     EXEC SQL                                                     04320000
043300          INCLUDE SQLCA                                           04330000
043400     END-EXEC.                                                    04340000
043500                                                                  04350000
043600******************************************************************04360000
043700*  DB2 TABLE DECLARATION - IT-WEB ITEM ATTRIBUTES                 04370000
043800*      (TWEBITM)                                                  04380000
043900******************************************************************04390000
044000     EXEC SQL                                                     04400000
044100          INCLUDE TWEBITM                                         04410000
044200     END-EXEC.                                                    04420000
044300                                                                  04430000
044400******************************************************************04440000
044500*  DB2 TABLE DECLARATION - PO-PREPACK                             04450000
044600*      (TPOPRPK)                                                  04460000
044700******************************************************************04470000
044800     EXEC SQL                                                     04480000
044900          INCLUDE TPOPRPK                                         04490000
045000     END-EXEC.                                                    04500000
045100                                                                  04510000
045200******************************************************************04520000
045300*  DB2 TABLE DECLARATION - RC-RECEIVER                            04530000
045400*      (TRECEIV)                                                  04540000
045500******************************************************************04550000
045600     EXEC SQL                                                     04560000
045700          INCLUDE TRECEIV                                         04570000
045800     END-EXEC.                                                    04580000
045900                                                                  04590000
046000******************************************************************04600000
046100*  DB2 TABLE DECLARATION - SU-SHIPMENT UNIT LOCATION              04610000
046200*      (TSHUNLO)                                                  04620000
046300******************************************************************04630000
046400     EXEC SQL                                                     04640000
046500          INCLUDE TSHUNLO                                         04650000
046600     END-EXEC.                                                    04660000
046700                                                                  04670000
046800******************************************************************04680000
046900*  DB2 TABLE DECLARATION - SU-SHIPMENT UNIT/UPC ASSOCIATION       04690000
047000*      (TSHUUPC)                                                  04700000
047100******************************************************************04710000
047200     EXEC SQL                                                     04720000
047300          INCLUDE TSHUUPC                                         04730000
047400     END-EXEC.                                                    04740000
047500                                                                  04750000
047600******************************************************************04760000
047700*  DB2 TABLE DECLARATION - SU-SHIPMENT UNIT                       04770000
047800*      (TSHPUNT)                                                  04780000
047900******************************************************************04790000
048000     EXEC SQL                                                     04800000
048100          INCLUDE TSHPUNT                                         04810000
048200     END-EXEC.                                                    04820000
048300                                                                  04830000
048400******************************************************************04840000
048500*  DB2 TABLE DECLARATION - SU-INBOUND EDI PACKLIST/VENDOR SHIPMENT04850000
048600*                                                 UNIT ASSOCIATION04860000
048700*      (TINPKSU)                                                  04870000
048800******************************************************************04880000
048900     EXEC SQL                                                     04890000
049000          INCLUDE TINPKSU                                         04900000
049100     END-EXEC.                                                    04910000
049200                                                                  04920000
049300******************************************************************04930000
049400*  DB2 TABLE DECLARATION - RC-PACK SLIP                           04940000
049500*      (TPKSLIP)                                                  04950000
049600******************************************************************04960000
049700     EXEC SQL                                                     04970000
049800          INCLUDE TPKSLIP                                         04980000
049900     END-EXEC.                                                    04990000
050000                                                                  05000000
050100******************************************************************05010000
050200*  DB2 TABLE DECLARATION - TR-SHIPMENT - PO ASSOCIATION           05020000
050300*      (TSHPTPO)                                                  05030000
050400******************************************************************05040000
050500     EXEC SQL                                                     05050000
050600          INCLUDE TSHPTPO                                         05060000
050700     END-EXEC.                                                    05070000
050800                                                                  05080000
050900******************************************************************05090000
051000*  DB2 TABLE DECLARATION - RECEIPT ITEM                           05100000
051100*      (TRECITM)                                                  05110000
051200******************************************************************05120000
051300     EXEC SQL                                                     05130000
051400          INCLUDE TRECITM                                         05140000
051500     END-EXEC.                                                    05150000
051600                                                                  05160000
051700******************************************************************05170000
051800*  DB2 TABLE DECLARATION - PO PURCHASE ORDER                      05180000
051900*      (TPURCHS)                                                  05190000
052000******************************************************************05200000
052100     EXEC SQL                                                     05210000
052200          INCLUDE TPURCHS                                         05220000
052300     END-EXEC.                                                    05230000
052400                                                                  05240000
052500******************************************************************05250000
052600*  DB2 TABLE DECLARATION - LOGISTICS - SKU.                       05260000
052700*      (XLT_SKU)                                                  05270000
052800******************************************************************05280000
052900     EXEC SQL                                                     05290000
053000          INCLUDE XLT00003                                        05300000
053100     END-EXEC.                                                    05310000
053200                                                                  05320000
053300******************************************************************05330000
053400*  DB2 TABLE DECLARATION - LOGISTICS - UPC.                       05340000
053500*      (XLT_UPC)                                                  05350000
053600******************************************************************05360000
053700     EXEC SQL                                                     05370000
053800          INCLUDE XLT00006                                        05380000
053900     END-EXEC.                                                    05390000
054000                                                                  05400000
054100******************************************************************05410000
054200*  DB2 TABLE DECLARATION - PURCHASE ITEM TABLE                    05420000
054300*      (TPURITM)                                                  05430000
054400******************************************************************05440000
054500     EXEC SQL                                                     05450000
054600          INCLUDE TPURITM                                         05460000
054700     END-EXEC.                                                    05470000
054800                                                                  05480000
054900******************************************************************05490000
055000*  DB2 TABLE DECLARATION - TROUBLE NOTIFICATION                   05500000
055100*      (TTRBNTF)                                                  05510000
055200******************************************************************05520000
055300     EXEC SQL                                                     05530000
055400          INCLUDE TTRBNTF                                         05540000
055500     END-EXEC.                                                    05550000
055600                                                                  05560000
055700******************************************************************05570000
055800*  DB2 TABLE DECLARATION - TROUBLE REASON                         05580000
055900*      (TTRBRSN)                                                  05590000
056000******************************************************************05600000
056100     EXEC SQL                                                     05610000
056200          INCLUDE TTRBRSN                                         05620000
056300     END-EXEC.                                                    05630000
056400                                                                  05640000
056500******************************************************************05650000
056600*  DB2 TABLE DECLARATION - TROUBLE REPORTING CONTROL TABLE        05660000
056700*      (TTRBRCN)                                                  05670000
056800******************************************************************05680000
056900     EXEC SQL                                                     05690000
057000          INCLUDE TTRBRCN                                         05700000
057100     END-EXEC.                                                    05710000
057200                                                                  05720000
057300******************************************************************05730000
057400*  DB2 TABLE DECLARATION - VEHICLE TRIP                           05740000
057500*      (TVHTRIP)                                                  05750000
057600******************************************************************05760000
057700     EXEC SQL                                                     05770000
057800          INCLUDE TVHTRIP                                         05780000
057900     END-EXEC.                                                    05790000
058000                                                                  05800000
058010******************************************************************05801001
058020*  DB2 TABLE DECLARATION - AUDIT VEHICLE TRIP                     05802001
058030*      (TAUTRIP)                                                  05803001
058040******************************************************************05804001
058050     EXEC SQL                                                     05805001
058060          INCLUDE TAUTRIP                                         05806001
058070     END-EXEC.                                                    05807001
058080                                                                  05808001
058100******************************************************************05810000
058200*  DB2 TABLE DECLARATION - SHIPMENT                               05820000
058300*      (TSHIPMT)                                                  05830000
058400******************************************************************05840000
058500     EXEC SQL                                                     05850000
058600          INCLUDE TSHIPMT                                         05860000
058700     END-EXEC.                                                    05870000
058800                                                                  05880000
058900******************************************************************05890000
059000*  DB2 TABLE DECLARATION - TRIP STATUS                            05900000
059100*      (TTRIPST)                                                  05910000
059200******************************************************************05920000
059300     EXEC SQL                                                     05930000
059400          INCLUDE TTRIPST                                         05940000
059500     END-EXEC.                                                    05950000
059600                                                                  05960000
059610******************************************************************05961003
059620*  DB2 TABLE DECLARATION - TRIP STATUS TYPE PRIORITY              05962003
059630*      (TTRSTYP)                                                  05963003
059640******************************************************************05964003
059650     EXEC SQL                                                     05965003
059660          INCLUDE TTRSTYP                                         05966003
059670     END-EXEC.                                                    05967003
059680                                                                  05968003
059700******************************************************************05970000
059800*  DB2 TABLE DECLARATION - HEADER SHIPMENT CROSS REFERENCE        05980000
059900*      (WST_SHPMT_XREF_HDR)                                       05990000
060000******************************************************************06000000
060100     EXEC SQL                                                     06010000
060200          INCLUDE WST00001                                        06020000
060300     END-EXEC.                                                    06030000
060400                                                                  06040000
060500******************************************************************06050000
060600*  DB2 TABLE DECLARATION - DETAIL SHIPMENT CROSS REFERENCE        06060000
060700*      (WST_SHPMT_XREF_DTL)                                       06070000
060800******************************************************************06080000
060900     EXEC SQL                                                     06090000
061000          INCLUDE WST00002                                        06100000
061100     END-EXEC.                                                    06110000
061200                                                                  06120000
061300******************************************************************06130000
061400*  DB2 TABLE DECLARATION - WMS DOWNLOAD DATA CONTROL              06140000
061500*      (WST_DAT_CNTL)                                             06150000
061600******************************************************************06160000
061700     EXEC SQL                                                     06170000
061800          INCLUDE WST00003                                        06180000
061900     END-EXEC.                                                    06190000
062000                                                                  06200000
062100******************************************************************06210000
062200*  DB2 TABLE DECLARATION - WMS DOWNLOAD DATA TRANSFER             06220000
062300*      (WST_DAT_XFER)                                             06230000
062400******************************************************************06240000
062500     EXEC SQL                                                     06250000
062600          INCLUDE WST00004                                        06260000
062700     END-EXEC.                                                    06270000
062800                                                                  06280000
062900******************************************************************06290000
063000*  DB2 TABLE DECLARATION - TABLE FOR ASN DOWNLOADS                06300000
063100*      (WST_ASN_DWNLD)                                            06310000
063200******************************************************************06320000
063300     EXEC SQL                                                     06330000
063400          INCLUDE WST00011                                        06340000
063500     END-EXEC.                                                    06350000
063600                                                                  06360000
063700******************************************************************06370000
063800*  DB2 TABLE DECLARATION - WMS INTEGRATION TYPE                   06380000
063900*      (WST_INTGRTN_TYP)                                          06390000
064000******************************************************************06400000
064100     EXEC SQL                                                     06410000
064200          INCLUDE WST00008                                        06420000
064300     END-EXEC.                                                    06430000
064400                                                                  06440000
064500******************************************************************06450000
064600*  DB2 TABLE DECLARATION - WMS ATTRIBUTE DEFINITION               06460000
064700*      (WST_ATTR_DEFN)                                            06470000
064800******************************************************************06480000
064900     EXEC SQL                                                     06490000
065000          INCLUDE WST00009                                        06500000
065100     END-EXEC.                                                    06510000
065200                                                                  06520000
065300******************************************************************06530000
065400*  DB2 TABLE DECLARATION - WMS ATTRIBUTE ELEMENT                  06540000
065500*      (WST_ATTR_ELEM)                                            06550000
065600******************************************************************06560000
065700     EXEC SQL                                                     06570000
065800          INCLUDE WST00010                                        06580000
065900     END-EXEC.                                                    06590000
066000                                                                  06600000
066100******************************************************************06610000
066200*  DB2 TABLE DECLARATION - PARM TABLE                             06620000
066300*      (TKRPRPM)                                                  06630000
066400******************************************************************06640000
066500     EXEC SQL                                                     06650000
066600          INCLUDE TKRPRPM                                         06660000
066700     END-EXEC.                                                    06670000
066800                                                                  06680000
066900******************************************************************06690000
067000*  DB2 FORMATTED MESSAGE AREA                                     06700000
067100******************************************************************06710000
067200     COPY DPWS004.                                                06720000
067300                                                                  06730000
067400******************************************************************06740000
067500*  LAYOUT FOR THE ABEND COMMUNICATIONS AREA                       06750000
067600******************************************************************06760000
067700     COPY DPWS013.                                                06770000
067800                                                                  06780000
067900******************************************************************06790000
068000*  COMMAREA                                                       06800000
068100******************************************************************06810000
068200     COPY WSWS003.                                                06820000
068300                                                                  06830000
068400******************************************************************06840000
068500*  ASN HEADER - TRAILER INTO WMOS                                 06850000
068600******************************************************************06860000
068700     COPY WSRD004.                                                06870000
068800                                                                  06880000
068900******************************************************************06890000
069000*  ASN DETAIL - TRAILER INTO WMOS                                 06900000
069100******************************************************************06910000
069200     COPY WSRD005.                                                06920000
069300                                                                  06930000
069400******************************************************************06940000
069500*  CASE HEADER - INTO WMOS                                        06950000
069600******************************************************************06960000
069700     COPY WSRD006.                                                06970000
069800                                                                  06980000
069900******************************************************************06990000
070000*  CASE DETAIL - INTO WMOS                                        07000000
070100******************************************************************07010000
070200     COPY WSRD007.                                                07020000
070300                                                                  07030000
070400******************************************************************07040000
070500*  APPOINTMENT - TRAILER INTO WMOS                                07050000
070600******************************************************************07060000
070700     COPY WSRD008.                                                07070000
070800                                                                  07080000
070900******************************************************************07090000
071000*  USED TO CALL THE ASN TRANSMISSION MODULE                       07100000
071100******************************************************************07110000
071200     COPY WSWS006.                                                07120000
071300                                                                  07130000
071400******************************************************************07140000
071500*  USED TO CALL THE PO-RCVR-TRKG  MODULE                          07150000
071600******************************************************************07160000
071700     COPY RCWS071.                                                07170000
071800                                                                  07180000
071900**ROOPA**30/10/2013**INITIAL                                      07190000
072000******************************************************************07200000
072100*    TROUBLE MANAGEMENT COPYBOOK AREA                             07210000
072200******************************************************************07220000
072300     COPY TMWS500.                                                07230000
072400**ROOPA**30/10/2013**FINAL                                        07240000
072500                                                                  07250000
072600*-----------------------------------------------------------------07260000
072700*  ASN DOWNLOAD CONTROL TABLE MAINTENANCE                         07270000
072800*-----------------------------------------------------------------07280000
072900     COPY WSWS001.                                                07290000
073000                                                                  07300000
073100**DECLARE THE TRIP_ID_CSR                                         07310000
073200     EXEC SQL                                                     07320000
073300          DECLARE TRIP_ID_CSR CURSOR FOR                          07330000
073400           SELECT  PO_NBR                                         07340000
073500                  ,PO_LNE_NBR                                     07350000
073600                  ,RCVR_SEQ_NBR                                   07360000
073700                  ,ASN_LVL_CDE                                    07370000
073800                  ,PREPK_ID                                       07380000
073900           FROM    WST_SHPMT_XREF_HDR H                           07390000
074000                  ,WST_SHPMT_XREF_DTL D                           07400000
074100           WHERE   H.EXT_SHP_ID    =  D.EXT_SHP_ID                07410000
074200           AND     H.EXT_SHP_ID    = :DK-EXT-SHP-ID               07420000
074300           AND     H.INTR_TRIP_ID  = :DK-TRIP-ID                  07430000
074400           AND     H.RCPT_TMST     = :PC-DEFAULT-NINES            07440000
074500           AND     D.ACTV_CDE      = 'A'                          07450000
074600           ORDER BY D.PO_NBR                                      07460000
074700                  , D.RCVR_SEQ_NBR                                07470000
074800                  , D.PREPK_ID                                    07480000
074900                  , D.PO_LNE_NBR                                  07490000
074910            WITH UR                                               07491008
075000     END-EXEC.                                                    07500000
075100                                                                  07510000
075200**DECLARE THE HDR_CSR_1                                           07520000
075300     EXEC SQL                                                     07530000
075400          DECLARE HDR_CSR_1 CURSOR FOR                            07540000
075500           SELECT  SOR_CDE                                        07550000
075600                  ,DMY_SEQ_NBR                                    07560000
075700                  ,DEST_LOC_NBR                                   07570000
075800                  ,DWNLD_CDE                                      07580000
075900                  ,RCPT_TMST                                      07590000
076000                  ,CRE_USR_ID                                     07600000
076100                  ,CRE_TMST                                       07610000
076200                  ,DWNLD_TMST                                     07620000
076300                  ,LAST_PRCG_TMST                                 07630000
076400                  ,PRC_CDE                                        07640000
076500                  ,VER_NBR                                        07650000
076600           FROM    WST_SHPMT_XREF_HDR H                           07660000
076700           WHERE   H.EXT_SHP_ID   = :DK-EXT-SHP-ID                07670000
076800           AND     H.INTR_TRIP_ID = :DK-TRIP-ID                   07680000
076900           AND     H.RCPT_TMST    = :PC-DEFAULT-NINES             07690000
077000           AND     H.DWNLD_CDE       IN ('N','P','C')             07700000
077010            WITH UR                                               07701008
077100     END-EXEC.                                                    07710000
077200                                                                  07720000
077300**DECLARE THE ASN_DTL_CSR                                         07730000
077400     EXEC SQL                                                     07740000
077500          DECLARE ASN_DTL_CSR CURSOR FOR                          07750000
077600           SELECT  B.PO_NBR                                       07760000
077700                  ,B.PO_LNE_NBR                                   07770000
077800                  ,RCVR_SEQ_NBR                                   07780000
077900                  ,ASN_LVL_CDE                                    07790000
078000                  ,PREPK_ID                                       07800000
078100                  ,CRE_USR_ID                                     07810000
078200                  ,B.CRE_TMST                                     07820000
078300                  ,DWNLD_CDE                                      07830000
078400                  ,ACTV_CDE                                       07840000
078500                  ,SKU_NBR                                        07850000
078600           FROM    WST_SHPMT_XREF_DTL B                           07860000
078700                  ,TPURITM C                                      07870000
078800                  ,XLT_SKU D                                      07880000
078900           WHERE B.EXT_SHP_ID      = :DK-EXT-SHP-ID               07890000
079000              AND B.ASN_LVL_CDE    = 'S'                          07900000
079100              AND B.DWNLD_CDE NOT IN ('T')                        07910000
079200              AND B.ACTV_CDE       = 'A'                          07920000
079300              AND B.PO_NBR         = C.PO_NBR                     07930000
079400              AND B.PO_LNE_NBR     = C.PO_LNE_NBR                 07940000
079500              AND C.VER_STATUS_CDE = 'A'                          07950000
079600              AND C.ITM_NBR        = D.ITM_NBR                    07960000
079610             WITH UR                                              07961008
079700     END-EXEC.                                                    07970000
079800                                                                  07980000
079900**DECLARE THE CS_DTL_CSR                                          07990000
080000     EXEC SQL                                                     08000000
080100          DECLARE CS_DTL_CSR CURSOR FOR                           08010000
080200           SELECT  PO_NBR                                         08020000
080300                  ,PO_LNE_NBR                                     08030000
080400                  ,RCVR_SEQ_NBR                                   08040000
080500                  ,ASN_LVL_CDE                                    08050000
080600                  ,PREPK_ID                                       08060000
080700                  ,CRE_USR_ID                                     08070000
080800                  ,CRE_TMST                                       08080000
080900                  ,DWNLD_CDE                                      08090000
081000                  ,ACTV_CDE                                       08100000
081100           FROM    WST_SHPMT_XREF_DTL B                           08110000
081200           WHERE B.EXT_SHP_ID      = :DK-EXT-SHP-ID               08120000
081300              AND B.ASN_LVL_CDE    = 'C'                          08130000
081400              AND B.DWNLD_CDE NOT IN ('T')                        08140000
081500              AND B.ACTV_CDE       = 'A'                          08150000
081600           ORDER BY B.PO_NBR                                      08160000
081700                  , B.RCVR_SEQ_NBR                                08170000
081800                  , B.PREPK_ID                                    08180000
081900                  , B.PO_LNE_NBR                                  08190000
081910            WITH UR                                               08191008
082000     END-EXEC.                                                    08200000
082100                                                                  08210000
082200**DECLARE THE CARTON_PK_CSR                                       08220000
082300     EXEC SQL                                                     08230000
082400          DECLARE CARTON_PK_CSR CURSOR FOR                        08240000
082500          SELECT 'A'                                              08250000
082600                , H.SHIPT_UNT_ID                                  08260000
082700             FROM TSHIPMT A                                       08270000
082800                , TSHPTPO B                                       08280000
082900                , TPKSLIP C                                       08290000
083000                , TINPKSU D                                       08300000
083100                , TSHUNLO E                                       08310000
083200                , TVHTRIP F                                       08320000
083300                , TSHPUNT H                                       08330000
083400                , TSHUUPC I                                       08340000
083500                , TRECITM J                                       08350000
083600            WHERE A.SHIPT_ID      = B.SHIPT_ID                    08360000
083700              AND A.TRIP_ID       = F.TRIP_ID                     08370000
083800              AND B.PO_NBR        = :WST00002-PO-NBR              08380000
083900              AND B.REC_SEQ_NBR   = :WST00002-RCVR-SEQ-NBR        08390000
084000              AND B.PO_NBR        = C.PO_NBR                      08400000
084100              AND B.REC_SEQ_NBR   = C.REC_SEQ_NBR                 08410000
084200              AND C.VER_STAT_CDE  = 'A'                           08420000
084300              AND B.PO_NBR        = D.PO_NBR                      08430000
084400              AND D.SEQ_NBR       = C.SEQ_NBR                     08440000
084500              AND E.SHIPT_UNT_ID  = D.SHIPT_UNT_ID                08450000
084600              AND E.SHIPT_UNT_ID  = H.SHIPT_UNT_ID                08460000
084700              AND E.SCN_LOC_ID    = 'RECV'                        08470000
084800              AND E.ACTV_CDE      = 'A'                           08480000
084900              AND H.SHIPT_UNT_ID  = I.SHIPT_UNT_ID                08490000
085000              AND I.TRN_LNE_NBR   = J.ORD_LNE_NBR                 08500000
085100              AND J.PREPK_ID      = :WST00002-PREPK-ID            08510000
085200              AND B.PO_NBR        = J.ORD_NBR                     08520000
085300              AND B.REC_SEQ_NBR   = J.REC_SEQ_NBR                 08530000
085400              AND H.ACTV_IND      = 'A'                           08540000
085500            UNION                                                 08550000
085600           SELECT 'B'                                             08560000
085700                , G.SHIPT_UNT_ID                                  08570000
085800             FROM TSHIPMT A                                       08580000
085900                , TSHPTPO B                                       08590000
086000                , TPKSLIP C                                       08600000
086100                , TINPKSU D                                       08610000
086200                , TVHTRIP F                                       08620000
086300                , TSHPUNT G                                       08630000
086400                , TSHUUPC H                                       08640000
086500                , TRECITM J                                       08650000
086600           WHERE A.SHIPT_ID     = B.SHIPT_ID                      08660000
086700             AND A.TRIP_ID      = F.TRIP_ID                       08670000
086800             AND B.PO_NBR       = :WST00002-PO-NBR                08680000
086900             AND B.REC_SEQ_NBR  = :WST00002-RCVR-SEQ-NBR          08690000
087000             AND B.PO_NBR       = C.PO_NBR                        08700000
087100             AND B.REC_SEQ_NBR  = C.REC_SEQ_NBR                   08710000
087200             AND C.VER_STAT_CDE = 'A'                             08720000
087300             AND B.PO_NBR       = D.PO_NBR                        08730000
087400             AND D.SEQ_NBR      = C.SEQ_NBR                       08740000
087500             AND D.SHIPT_UNT_ID = G.SHIPT_UNT_ID                  08750000
087600             AND G.SHIPT_UNT_ID = H.SHIPT_UNT_ID                  08760000
087700             AND H.TRN_LNE_NBR  = J.ORD_LNE_NBR                   08770000
087800             AND J.PREPK_ID     = :WST00002-PREPK-ID              08780000
087900             AND B.PO_NBR       = J.ORD_NBR                       08790000
088000             AND B.REC_SEQ_NBR  = J.REC_SEQ_NBR                   08800000
088100             AND G.ACTV_IND     = 'A'                             08810000
088200             AND NOT EXISTS                                       08820000
088300               (SELECT G.SHIPT_UNT_ID                             08830000
088400                FROM TSHUNLO G                                    08840000
088500                WHERE G.SHIPT_UNT_ID = D.SHIPT_UNT_ID             08850000
088600                  AND G.ACTV_CDE     = 'A'                        08860000
088700                  AND G.SCN_LOC_ID   = 'RECV')                    08870000
088710            WITH UR                                               08871008
088800     END-EXEC.                                                    08880000
088900                                                                  08890000
089000**DECLARE THE CARTON_CNTNT_CSR                                    08900000
089100     EXEC SQL                                                     08910000
089200          DECLARE CARTON_CNTNT_CSR CURSOR FOR                     08920000
089300          SELECT    C.SKU_NBR                                     08930000
089400                   ,A.SHPD_QTY                                    08940000
089500                   ,C.INTR_UPC_ID                                 08950000
089600                   ,A.TRN_LNE_NBR                                 08960000
089700           FROM     TSHUUPC A                                     08970000
089800                   ,XLT_UPC B                                     08980000
089900                   ,XLT_SKU C                                     08990000
090000           WHERE    A.SHIPT_UNT_ID = :SHPUNT-SHIPT-UNT-ID         09000000
090100             AND    A.SHPD_QTY     > 0                            09010000
090200             AND    A.UPC_NBR      = B.UPC_NBR                    09020000
090300             AND    B.INTR_UPC_ID  = C.INTR_UPC_ID                09030000
090310            WITH UR                                               09031008
090400     END-EXEC.                                                    09040000
090500                                                                  09050000
090600**DECLARE THE CARTON_CSR                                          09060000
090700     EXEC SQL                                                     09070000
090800          DECLARE CARTON_CSR CURSOR FOR                           09080000
090900          SELECT 'A'                                              09090000
091000                , H.SHIPT_UNT_ID                                  09100000
091100             FROM TSHIPMT A                                       09110000
091200                , TSHPTPO B                                       09120000
091300                , TPKSLIP C                                       09130000
091400                , TINPKSU D                                       09140000
091500                , TSHUNLO E                                       09150000
091600                , TVHTRIP F                                       09160000
091700                , TSHPUNT H                                       09170000
091800                , TSHUUPC I                                       09180000
091900            WHERE A.SHIPT_ID      = B.SHIPT_ID                    09190000
092000              AND A.TRIP_ID       = F.TRIP_ID                     09200000
092100              AND B.PO_NBR        = :WST00002-PO-NBR              09210000
092200              AND B.REC_SEQ_NBR   = :WST00002-RCVR-SEQ-NBR        09220000
092300              AND B.PO_NBR        = C.PO_NBR                      09230000
092400              AND B.REC_SEQ_NBR   = C.REC_SEQ_NBR                 09240000
092500              AND C.VER_STAT_CDE  = 'A'                           09250000
092600              AND B.PO_NBR        = D.PO_NBR                      09260000
092700              AND D.SEQ_NBR       = C.SEQ_NBR                     09270000
092800              AND E.SHIPT_UNT_ID  = D.SHIPT_UNT_ID                09280000
092900              AND E.SHIPT_UNT_ID  = H.SHIPT_UNT_ID                09290000
093000              AND E.SCN_LOC_ID    = 'RECV'                        09300000
093100              AND E.ACTV_CDE      = 'A'                           09310000
093200              AND H.SHIPT_UNT_ID  = I.SHIPT_UNT_ID                09320000
093300              AND I.TRN_LNE_NBR   = :WST00002-PO-LNE-NBR          09330000
093400              AND H.ACTV_IND      = 'A'                           09340000
093500            UNION                                                 09350000
093600           SELECT 'B'                                             09360000
093700                , G.SHIPT_UNT_ID                                  09370000
093800             FROM TSHIPMT A                                       09380000
093900                , TSHPTPO B                                       09390000
094000                , TPKSLIP C                                       09400000
094100                , TINPKSU D                                       09410000
094200                , TVHTRIP F                                       09420000
094300                , TSHPUNT G                                       09430000
094400                , TSHUUPC H                                       09440000
094500           WHERE A.SHIPT_ID     = B.SHIPT_ID                      09450000
094600             AND A.TRIP_ID      = F.TRIP_ID                       09460000
094700             AND B.PO_NBR       = :WST00002-PO-NBR                09470000
094800             AND B.REC_SEQ_NBR  = :WST00002-RCVR-SEQ-NBR          09480000
094900             AND B.PO_NBR       = C.PO_NBR                        09490000
095000             AND B.REC_SEQ_NBR  = C.REC_SEQ_NBR                   09500000
095100             AND C.VER_STAT_CDE = 'A'                             09510000
095200             AND B.PO_NBR       = D.PO_NBR                        09520000
095300             AND D.SEQ_NBR      = C.SEQ_NBR                       09530000
095400             AND D.SHIPT_UNT_ID = G.SHIPT_UNT_ID                  09540000
095500             AND G.SHIPT_UNT_ID = H.SHIPT_UNT_ID                  09550000
095600             AND H.TRN_LNE_NBR  = :WST00002-PO-LNE-NBR            09560000
095700             AND G.ACTV_IND      = 'A'                            09570000
095800             AND NOT EXISTS                                       09580000
095900               (SELECT G.SHIPT_UNT_ID                             09590000
096000                FROM TSHUNLO G                                    09600000
096100                WHERE G.SHIPT_UNT_ID = D.SHIPT_UNT_ID             09610000
096200                  AND G.ACTV_CDE      = 'A'                       09620000
096300                  AND G.SCN_LOC_ID   = 'RECV')                    09630000
096310           WITH UR                                                09631008
096400     END-EXEC.                                                    09640000
096500                                                                  09650000
096600**DECLARE THE PSB_CS_CSR                                          09660000
096700     EXEC SQL                                                     09670000
096800          DECLARE PBS_CS_CSR CURSOR FOR                           09680000
096900     SELECT                                                       09690000
097000            C.SHIPT_UNT_ID                                        09700000
097100       FROM TPKSLIP A                                             09710000
097200          , TINPKSU B                                             09720000
097300          , TSHPUNT C                                             09730000
097400          , TSHUUPC D                                             09740000
097500      WHERE A.PO_NBR       = :WST00002-PO-NBR                     09750000
097600        AND A.REC_SEQ_NBR  = :WST00002-RCVR-SEQ-NBR               09760000
097700        AND A.VER_STAT_CDE = 'A'                                  09770000
097800        AND A.PO_NBR       = B.PO_NBR                             09780000
097900        AND A.SEQ_NBR      = B.SEQ_NBR                            09790000
098000        AND B.SHIPT_UNT_ID = C.SHIPT_UNT_ID                       09800000
098100        AND B.SHIPT_UNT_ID = D.SHIPT_UNT_ID                       09810000
098200  GROUP BY A.REC_SEQ_NBR                                          09820000
098300        ,C.SHIPT_UNT_ID                                           09830000
098400        ,C.ACTV_IND                                               09840000
098500        ,C.DEST_OPER_UNT_ID                                       09850000
098600        ,A.CRE_TMST                                               09860000
098700        ,C.CRE_DTE                                                09870000
098800        ,C.CRE_TM                                                 09880000
098810        WITH UR                                                   09881008
098900     END-EXEC.                                                    09890000
099000                                                                  09900000
099100**DECLARE THE XREF_DTL_CSR                                        09910000
099200     EXEC SQL                                                     09920000
099300          DECLARE XREF_DTL_CSR CURSOR FOR                         09930000
099400           SELECT  PO_NBR                                         09940000
099500                  ,PO_LNE_NBR                                     09950000
099600                  ,RCVR_SEQ_NBR                                   09960000
099700                  ,ASN_LVL_CDE                                    09970000
099800                  ,PREPK_ID                                       09980000
099900                  ,CRE_USR_ID                                     09990000
100000                  ,CRE_TMST                                       10000000
100100                  ,DWNLD_CDE                                      10010000
100200                  ,ACTV_CDE                                       10020000
100300           FROM    WST_SHPMT_XREF_DTL B                           10030000
100400           WHERE B.EXT_SHP_ID      = :DK-EXT-SHP-ID               10040000
100500           AND   B.ACTV_CDE = 'A'                                 10050000
100600           ORDER BY B.PO_NBR                                      10060000
100700                  , B.RCVR_SEQ_NBR                                10070000
100800                  , B.PREPK_ID                                    10080000
100900                  , B.PO_LNE_NBR                                  10090000
100910           WITH UR                                                10091008
101000     END-EXEC.                                                    10100000
101100**AMIT**INITIAL                                                   10110000
101200**DECLARE THE RETAIL_VAL_CSR                                      10120000
101300     EXEC SQL                                                     10130000
101400          DECLARE RETAIL_VAL_CSR CURSOR FOR                       10140000
101500           SELECT UNT_RTL_AMT                                     10150000
101600                 ,PKSL_ITM_QTY                                    10160000
101700           FROM  TRECITM                                          10170000
101800           WHERE ORD_NBR        = :WST00002-PO-NBR                10180000
101900             AND REC_SEQ_NBR    = :WST00002-RCVR-SEQ-NBR          10190000
102000             AND VER_STATUS_CDE = 'A'                             10200000
102010            WITH UR                                               10201008
102100     END-EXEC.                                                    10210000
102200                                                                  10220000
102300**AMIT**FINAL                                                     10230000
102400******************************************************************10240000
102500 LINKAGE SECTION.                                                 10250000
102600                                                                  10260000
102700 01  DFHCOMMAREA.                                                 10270000
102800     05  FILLER                       OCCURS  1 TO 4072 TIMES     10280000
102900                                      DEPENDING ON EIBCALEN.      10290000
103000         10 FILLER                    PIC X.                      10300000
103100                                                                  10310000
103200                                                                  10320000
103300******************************************************************10330000
103400 PROCEDURE DIVISION.                                              10340000
103500******************************************************************10350000
103600******************************************************************10360000
103700*  0000-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE PROGRAM.  *10370000
103800******************************************************************10380000
103900 0000-PROGRAM-MAINLINE.                                           10390000
104000                                                                  10400000
104100     MOVE LENGTH WS003-SHIPT-COMMAREA                             10410000
104200                                 TO PV-COMMAREA-LENGTH.           10420000
104300                                                                  10430000
104400     EXEC CICS                                                    10440000
104500         RETRIEVE                                                 10450000
104600         INTO(WS003-SHIPT-COMMAREA)                               10460000
104700         LENGTH(PV-COMMAREA-LENGTH)                               10470000
104800         RESP(PV-CICS-RESPONSE)                                   10480000
104900     END-EXEC.                                                    10490000
105000                                                                  10500000
105100     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       10510000
105200        MOVE WS003-WM-SHIPT-NBR TO DK-EXT-SHP-ID                  10520000
105300        MOVE WS003-TRIP-ID      TO DK-TRIP-ID                     10530000
105400        PERFORM 1000-INITIALIZE                                   10540000
105500                                                                  10550000
105600* JAK 06/2007 - ADD LOGIC FOR A CANCELED SHIPMENT                 10560000
105700        IF  WS003-CANCEL-SHPMT-YES                                10570000
105800           PERFORM 1080-PROCESS-CANCEL                            10580000
105900        ELSE                                                      10590000
106000           PERFORM 1070-PROCESS-UPDATE                            10600000
106100        END-IF                                                    10610000
106200     ELSE                                                         10620000
106300        STRING ' WSKCS301 - INVALID RETREIVE OF COMMAREA'         10630000
106400               'TASK = ' WS003-SRC-TASK-NUMBER                    10640000
106500        DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                   10650000
106600        PERFORM 9200-WRITE-TO-CICS-LOG                            10660000
106700     END-IF.                                                      10670000
106800                                                                  10680000
106900     STRING ' WSKCS301 ENDED  - TASK = ' WS003-SRC-TASK-NUMBER    10690000
107000         DELIMITED BY SIZE INTO PV-CICS-MSG-AREA                  10700000
107100     PERFORM 9200-WRITE-TO-CICS-LOG                               10710000
107200                                                                  10720000
107300     GOBACK.                                                      10730000
107400                                                                  10740000
107500******************************************************************10750000
107600* INIT DCLGENS, GET TMST ONLY ONCE FOR PRC-GP-ID FOR DAT_CNTL/XFER10760000
107700******************************************************************10770000
107800 1000-INITIALIZE.                                                 10780000
107900                                                                  10790000
108000     INITIALIZE DCLTVHTRIP                                        10800000
108100                DCLTSHIPMT                                        10810000
108200                DCLTTRIPST.                                       10820000
108300                                                                  10830000
108400     INITIALIZE PV-PROGRAM-VARIABLES.                             10840000
108500     MOVE 0 TO PV-HDR-CSR-FETCH-COUNT.                            10850000
108600                                                                  10860000
108700     PERFORM 1010-CHECK-LOGGING.                                  10870000
108800                                                                  10880000
108900     PERFORM 1050-GET-CURRENT-TMST.                               10890000
109000**ROOPA**30/10/2013**INITIAL                                      10900000
109100     PERFORM 1060-INITIALZ-TM500-VARIABLS.                        10910000
109200**ROOPA**30/10/2013**FINAL                                        10920000
109300                                                                  10930000
109400     IF PS-WRITE-TO-CSSL-YES                                      10940000
109500         STRING   ' ' WS003-SRC-TASK-NUMBER                       10950000
109600                  ' WSKCS301 CALLED FROM '                        10960000
109700                  WS003-CALLING-PROGRAM-NAME                      10970000
109800                  DELIMITED BY SIZE                               10980000
109900                  INTO PV-CICS-MSG-AREA                           10990000
110000         PERFORM 9200-WRITE-TO-CICS-LOG                           11000000
110100         MOVE  WS003-OPER-UNT-ID  TO PV-DISP-OPER-UNT-ID          11010000
110200         MOVE DK-EXT-SHP-ID       TO PV-DISP-EXT-SHP-ID           11020000
110300         MOVE DK-TRIP-ID          TO PV-DISP-TRIP-ID              11030000
110400         STRING   ' ' WS003-SRC-TASK-NUMBER                       11040000
110500                  ' WSKCS301-1000:'                               11050000
110600                  ' ' PV-DISP-OPER-UNT-ID                         11060000
110700                  ' ' WS003-USERID                                11070000
110800                  ' CICS LOGGING TURNED ON'                       11080000
110900         DELIMITED BY SIZE                                        11090000
111000         INTO PV-CICS-MSG-AREA                                    11100000
111100         PERFORM 9200-WRITE-TO-CICS-LOG                           11110000
111200         STRING   '==> KEY EXT SHP ID: '                          11120000
111300                  PV-DISP-EXT-SHP-ID                              11130000
111400                  '==> KEY TRIP ID: '                             11140000
111500                  PV-DISP-TRIP-ID                                 11150000
111600         DELIMITED BY SIZE                                        11160000
111700         INTO PV-CICS-MSG-AREA                                    11170000
111800         PERFORM 9200-WRITE-TO-CICS-LOG                           11180000
111900         STRING   '==> KEY DWNLD TMST: '                          11190000
112000                  PV-CURRENT-TMST                                 11200000
112100         DELIMITED BY SIZE                                        11210000
112200         INTO PV-CICS-MSG-AREA                                    11220000
112300         PERFORM 9200-WRITE-TO-CICS-LOG                           11230000
112400     END-IF.                                                      11240000
112500                                                                  11250000
112600******************************************************************11260000
112700** CSSL MSGS FOR DEBUGGING ARE CONTROLLED WITH A SWITCH,        **11270000
112800** AN ABEND WILL AUTOMATICALLY WRITE MSGS TO CSSL               **11280000
112900******************************************************************11290000
113000 1010-CHECK-LOGGING.                                              11300000
113100                                                                  11310000
113200     INITIALIZE WST00010-ATTR-ELEM-TXT-TEXT.                      11320000
113300                                                                  11330000
113400     EXEC SQL                                                     11340000
113500         SELECT A.INTGRTN_TYP_CDE                                 11350000
113600              , A.INTGRTN_TYP_DESC                                11360000
113700              , C.ATTR_ELEM_TXT    AS PROGRAM_NAME                11370000
113800              , D.ATTR_ELEM_TXT    AS SWITCH_IND                  11380000
113900         INTO  :WST00008-INTGRTN-TYP-CDE                          11390000
114000              ,:WST00008-INTGRTN-TYP-DESC                         11400000
114100              ,:PV-PROGRAM-NAME                                   11410000
114200              ,:PV-SWITCH-IND                                     11420000
114300         FROM   WST_INTGRTN_TYP   A                               11430000
114400              , WST_ATTR_DEFN     B                               11440000
114500              , WST_ATTR_ELEM     C                               11450000
114600              , WST_ATTR_ELEM     D                               11460000
114700         WHERE A.INTGRTN_TYP_CDE    =  'CSSLLOG'                  11470000
114800           AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE          11480000
114900           AND B.ATTR_DEFN_SEQ_NBR  =  1                          11490000
115000           AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE          11500000
115100           AND C.ATTR_DEFN_SEQ_NBR  =  1                          11510000
115200           AND B.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE          11520000
115300           AND D.ATTR_DEFN_SEQ_NBR  =  2                          11530000
115400           AND C.ATTR_ELEM_SEQ_NBR  =  D.ATTR_ELEM_SEQ_NBR        11540000
115500           AND C.ATTR_ELEM_TXT      = 'WSKCS301'                  11550000
115510          WITH UR                                                 11551008
115600     END-EXEC                                                     11560000
115700                                                                  11570000
115800     EVALUATE TRUE                                                11580000
115900         WHEN SQLCODE = ZERO                                      11590000
116000              IF PV-SWITCH-IND = PC-Y                             11600000
116100                 SET PS-WRITE-TO-CSSL-YES  TO TRUE                11610000
116200              END-IF                                              11620000
116300         WHEN SQLWARN0 NOT = SPACES                               11630000
116400         WHEN SQLCODE NOT = ZERO                                  11640000
116500              SET  PS-ERROR         TO TRUE                       11650000
116600              MOVE SQLCODE       TO PV-DISP-SQLCODE               11660000
116700              STRING ' ' WS003-SRC-TASK-NUMBER                    11670000
116800                     ' WSKCS301-1010: CHECK-LOGGING'              11680000
116900                     ' CALLED BY-'                                11690000
117000                       WS003-CALLING-PROGRAM-NAME                 11700000
117100                     ' SQLCODE='                                  11710000
117200                       PV-DISP-SQLCODE                            11720000
117300                     ' SUCC='                                     11730000
117400                       WS003-SUCCESS-IND                          11740000
117500               DELIMITED BY SIZE                                  11750000
117600               INTO PV-CICS-MSG-AREA                              11760000
117700              PERFORM 9200-WRITE-TO-CICS-LOG                      11770000
117800              MOVE '1010-CHECK-LOGGING'                           11780000
117900                               TO DP013-PARAGRAPH                 11790000
118000              MOVE 'SELECT WST_INTGRTN_TYP, WST_ATTR_DEFN'        11800000
118100                               TO DP013-MESSAGE-TEXT (1)          11810000
118200              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 11820000
118300              STRING ' ' WS003-SRC-TASK-NUMBER                    11830000
118400                     ' WSKCS301-1010: CHECK-LOGGING'              11840000
118500                     ' TRIP ID: '                                 11850000
118600                     PV-DISP-TRIP-ID                              11860000
118700                     ' EXT SHIP ID: '                             11870000
118800                     DK-EXT-SHP-ID                                11880000
118900                     ' DWNLD TMST: '                              11890000
119000                     PV-CURRENT-TMST                              11900000
119100              DELIMITED BY SIZE                                   11910000
119200              INTO DP013-MESSAGE-TEXT (2)                         11920000
119300              MOVE 'WST00008'  TO DP013-DB2-TABLE-NAME (1)        11930000
119400              MOVE SQLCA       TO DP013-SQLCA                     11940000
119500              SET DP013-DB2-ABEND  TO TRUE                        11950000
119600              PERFORM 9999-ABEND                                  11960000
119700     END-EVALUATE.                                                11970000
119800                                                                  11980000
119900     IF PS-WRITE-TO-CSSL-YES                                      11990000
120000         MOVE DK-EXT-SHP-ID       TO PV-DISP-EXT-SHP-ID           12000000
120100         STRING   ' ' WS003-SRC-TASK-NUMBER                       12010000
120200                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   12020000
120300                  ' WSKCS301-1010: CHECK-LOGGING'                 12030000
120400         DELIMITED BY SIZE                                        12040000
120500         INTO PV-CICS-MSG-AREA                                    12050000
120600         PERFORM 9200-WRITE-TO-CICS-LOG                           12060000
120700     END-IF.                                                      12070000
120800                                                                  12080000
120900******************************************************************12090000
121000** GET CURRENT DB2 TIMESTAMP (SAME TMST IS USED FOR ALL INSERTS)**12100000
121100******************************************************************12110000
121200 1050-GET-CURRENT-TMST.                                           12120000
121300                                                                  12130000
121400     EXEC SQL                                                     12140000
121500         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 12150000
121600     END-EXEC                                                     12160000
121700                                                                  12170000
121800     EVALUATE TRUE                                                12180000
121900         WHEN SQLCODE = ZERO                                      12190000
122000              CONTINUE                                            12200000
122100         WHEN SQLWARN0 NOT = SPACES                               12210000
122200         WHEN SQLCODE NOT = ZERO                                  12220000
122300              SET  PS-ERROR         TO TRUE                       12230000
122400              MOVE SQLCODE       TO PV-DISP-SQLCODE               12240000
122500              STRING ' ' WS003-SRC-TASK-NUMBER                    12250000
122600                     ' WSKCS301-1050: GET-CURRENT-TMST'           12260000
122700                     ' CALLED BY-'                                12270000
122800                       WS003-CALLING-PROGRAM-NAME                 12280000
122900                     ' SQLCODE='                                  12290000
123000                       PV-DISP-SQLCODE                            12300000
123100                     ' SUCC='                                     12310000
123200                       WS003-SUCCESS-IND                          12320000
123300               DELIMITED BY SIZE                                  12330000
123400               INTO PV-CICS-MSG-AREA                              12340000
123500              PERFORM 9200-WRITE-TO-CICS-LOG                      12350000
123600              MOVE '1050-GET-CURRENT-TMST'                        12360000
123700                               TO DP013-PARAGRAPH                 12370000
123800              MOVE 'SELECT DB2 TMST'                              12380000
123900                               TO DP013-MESSAGE-TEXT (1)          12390000
124000              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 12400000
124100              STRING ' TRIP ID: '                                 12410000
124200                     PV-DISP-TRIP-ID                              12420000
124300                     ' EXT SHIP ID: '                             12430000
124400                     DK-EXT-SHP-ID                                12440000
124500                     ' DWNLD TMST: '                              12450000
124600                     PV-CURRENT-TMST                              12460000
124700              DELIMITED BY SIZE                                   12470000
124800              INTO DP013-MESSAGE-TEXT (2)                         12480000
124900              MOVE 'DB2 TMST'  TO DP013-DB2-TABLE-NAME (1)        12490000
125000              MOVE SQLCA       TO DP013-SQLCA                     12500000
125100              SET DP013-DB2-ABEND  TO TRUE                        12510000
125200              PERFORM 9999-ABEND                                  12520000
125300     END-EVALUATE.                                                12530000
125400                                                                  12540000
125500     IF PS-WRITE-TO-CSSL-YES                                      12550000
125600         MOVE DK-EXT-SHP-ID       TO PV-DISP-EXT-SHP-ID           12560000
125700         STRING   ' ' WS003-SRC-TASK-NUMBER                       12570000
125800                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   12580000
125900                  ' WSKCS301-1050: GET-CURRENT-TMST= '            12590000
126000                  PV-CURRENT-TMST                                 12600000
126100         DELIMITED BY SIZE                                        12610000
126200         INTO PV-CICS-MSG-AREA                                    12620000
126300         PERFORM 9200-WRITE-TO-CICS-LOG                           12630000
126400     END-IF.                                                      12640000
126500                                                                  12650000
126600**ROOPA**30/10/2013**INITIAL                                      12660000
126700 1060-INITIALZ-TM500-VARIABLS.                                    12670000
126800******************************************************************12680000
126900*    THIS PARAGRAPH INITIALIZES THE TMWS500 COPYBOOK.             12690000
127000******************************************************************12700000
127100                                                                  12710000
127200     INITIALIZE TM500-FIELDS.                                     12720000
127300                                                                  12730000
127400     IF EIBCALEN = 0                                              12740000
127500         SET PS-DONE          TO TRUE                             12750000
127600     ELSE                                                         12760000
127700         MOVE DFHCOMMAREA     TO TM500-FIELDS                     12770000
127800         MOVE PRV-00          TO TM500-RETURN-DATA                12780000
127900         SET TM500-NO-TROUBLE TO TRUE                             12790000
128000     END-IF.                                                      12800000
128100                                                                  12810000
128200**ROOPA**30/10/2013**FINAL                                        12820000
128300* JAK 06/2007 - MOVE LOGIC FROM MAINLINE TO SEPARATE PARAGRAPH    12830000
128400 1070-PROCESS-UPDATE.                                             12840000
128500**UPD DOWNLOAD CODES TO 'N' FOR THE EXT-SHP-ID THAT WAS PASSED    12850000
128600     PERFORM 1100-UPD-DOWNLOAD-CODES.                             12860000
128700                                                                  12870000
128800     PERFORM 1200-OPEN-TRIP-ID-CSR.                               12880000
128900                                                                  12890000
129000     PERFORM 1300-FETCH-TRIP-ID-CSR.                              12900000
129100                                                                  12910000
129200**SPIN THRU THE CSR TO CHECK FOR TROUBLE ON ANY LEVEL             12920000
129300**AND UPD DOWNLOAD CODE TO 'T' AT THE APPROPRIATE LEVEL           12930000
129400**IF TROUBLE IS FOUND AND THERE IS ONLY ONE RCVR,BYPASS THE       12940000
129500**REC TO BE SURE THERE ISN'T AN APPOINTMENT & ASN HDR             12950000
129600     SET PS-TROUBLE-FOUND-NO                                      12960000
129700         PS-BYPASS-NO TO TRUE.                                    12970000
129800     PERFORM 1500-PROCESS-TRIP-ID-CSR                             12980000
129900        UNTIL PS-END-OF-TRIP-ID-CSR-YES.                          12990000
130000                                                                  13000000
130100     PERFORM 1400-CLOSE-TRIP-ID-CSR.                              13010000
130200                                                                  13020000
130300     IF PS-TROUBLE-FOUND-YES                                      13030000
130400      AND PV-RCVR-COUNT = +1                                      13040000
130500        SET PS-BYPASS-YES TO TRUE                                 13050000
130600     END-IF.                                                      13060000
130700                                                                  13070000
130800     IF PS-WRITE-TO-CSSL-YES                                      13080000
130900       AND SQLCODE = 0                                            13090000
131000         MOVE PV-RCVR-COUNT      TO PV-DISP-RCVR-COUNT            13100000
131100         STRING  ' ' WS003-SRC-TASK-NUMBER                        13110000
131200                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    13120000
131300                 ' 1070: PROCESS-UPDATE'                          13130000
131400                 ' COUNT DISTINCT RCVRS : '                       13140000
131500                 PV-DISP-RCVR-COUNT                               13150000
131600                 ' TRBL FOUND Y OR N :'                           13160000
131700                 PS-TROUBLE-SW                                    13170000
131800                                                                  13180000
131900         DELIMITED BY SIZE                                        13190000
132000         INTO PV-CICS-MSG-AREA                                    13200000
132100         PERFORM 9200-WRITE-TO-CICS-LOG                           13210000
132200     END-IF.                                                      13220000
132300                                                                  13230000
132400     IF PS-BYPASS-YES                                             13240000
132500        IF PS-WRITE-TO-CSSL-YES                                   13250000
132600          AND SQLCODE = 0                                         13260000
132700            MOVE PV-RCVR-COUNT      TO PV-DISP-RCVR-COUNT         13270000
132800            STRING  ' ' WS003-SRC-TASK-NUMBER                     13280000
132900                    ' ' PV-DISP-EXT-SHP-ID (1:10)                 13290000
133000                    ' 1070: PROCESS-UPDATE: BYPASS SHPMT'         13300000
133100                    ' ONLY 1 RCVR THAT IS IN TRBL = BYPASS'       13310000
133200            DELIMITED BY SIZE                                     13320000
133300            INTO PV-CICS-MSG-AREA                                 13330000
133400            PERFORM 9200-WRITE-TO-CICS-LOG                        13340000
133500        END-IF                                                    13350000
133600     ELSE                                                         13360000
133700        PERFORM 2000-GET-TRIP-INFO                                13370000
133800        PERFORM 2400-CHECK-INTEGRATION-TYP                        13380000
133900        PERFORM 2500-APPOINTMENTS                                 13390000
134000** TCR 5/03 ADDED 'IF' LOGIC AROUND PERF OF 7100- BELOW           13400000
134100        IF PS-BYPASS-NO                                           13410000
134200           PERFORM 7100-UPD-HDR-XREF-VER-NBR                      13420000
134300        END-IF                                                    13430000
134400                                                                  13440000
134500**CALL WSKCS302 - PGM TO PROCESS THE ENTRIES IN THE TEMP TBL      13450000
134600        IF PS-NO-ERROR AND PS-BYPASS-NO                           13460000
134700*TCR 5/03  IF PS-NO-ERROR                                         13470000
134800           PERFORM 7200-ASN-DWNLD-MODULE                          13480000
134900           IF WS006-SUCCESSFUL                                    13490000
135000              CONTINUE                                            13500000
135100           ELSE                                                   13510000
135200              STRING ' ' WS003-SRC-TASK-NUMBER                    13520000
135300                     ' WSKCS301-1070: PROCESS-UPDATE'             13530000
135400                     ' INVALID RETURN FROM WSKCS302'              13540000
135500                     ' WS006-SUCCESS-IND: '                       13550000
135600                     WS006-SUCCESS-IND                            13560000
135700              DELIMITED BY SIZE                                   13570000
135800              INTO PV-CICS-MSG-AREA                               13580000
135900              PERFORM 9200-WRITE-TO-CICS-LOG                      13590000
136000              MOVE '7200-ASN-DWNLD-MODULE'                        13600000
136100                                  TO DP013-PARAGRAPH              13610000
136200              MOVE 'PROCESS WST_ASN_DWNLD'                        13620000
136300                                  TO DP013-MESSAGE-TEXT (1)       13630000
136400              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 13640000
136500              STRING ' TRIP ID: '                                 13650000
136600                     PV-DISP-TRIP-ID                              13660000
136700                     ' EXT SHIP ID: '                             13670000
136800                     DK-EXT-SHP-ID                                13680000
136900                     ' DWNLD TMST: '                              13690000
137000                     PV-CURRENT-TMST                              13700000
137100              DELIMITED BY SIZE                                   13710000
137200              INTO DP013-MESSAGE-TEXT (2)                         13720000
137300              MOVE WS006-SQLCODE TO PV-DISP-SQLCODE               13730000
137400              STRING ' ' WS003-SRC-TASK-NUMBER                    13740000
137500                     ' WSKCS301-1000: 0000-PROGRAM-MAINLINE'      13750000
137600                     ' SQL PARA: '                                13760000
137700                     WS006-SQL-ERROR-PARA                         13770000
137800                     ' SQLCODE: '                                 13780000
137900                     PV-DISP-SQLCODE                              13790000
138000              DELIMITED BY SIZE                                   13800000
138100              INTO DP013-MESSAGE-TEXT (3)                         13810000
138200              STRING ' RET MSG: '                                 13820000
138300                     WS006-CRA-RET-MSG                            13830000
138400              DELIMITED BY SIZE                                   13840000
138500              INTO DP013-MESSAGE-TEXT (4)                         13850000
138600              MOVE 'WST00011'  TO DP013-DB2-TABLE-NAME (1)        13860000
138700              MOVE WS006-SQLCA TO DP013-SQLCA                     13870000
138800              SET DP013-DB2-ABEND  TO TRUE                        13880000
138900              PERFORM 9999-ABEND                                  13890000
139000           END-IF                                                 13900000
139100           SET PS-END-OF-XREF-DTL-CSR-NO TO TRUE                  13910000
139200           PERFORM 7410-OPEN-XREF-DTL-CSR                         13920000
139300                                                                  13930000
139400           PERFORM 7420-FETCH-XREF-DTL-CSR                        13940000
139500              UNTIL PS-END-OF-XREF-DTL-CSR-YES                    13950000
139600                                                                  13960000
139700           PERFORM 7430-CLOSE-XREF-DTL-CSR                        13970000
139800        ELSE                                                      13980000
139900*TCR 5/03 ADDED 'IF PS-BYPASS-NO' BELOW                           13990000
140000         IF PS-BYPASS-NO                                          14000000
140100           MOVE '1070-PROCESS-UPDATE'                             14010000
140200                               TO DP013-PARAGRAPH                 14020000
140300           MOVE 'PROGRAM ERROR W/O ABEND'                         14030000
140400                               TO DP013-MESSAGE-TEXT (1)          14040000
140500           MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                    14050000
140600           STRING ' TRIP ID: '                                    14060000
140700                  PV-DISP-TRIP-ID                                 14070000
140800                  ' EXT SHIP ID: '                                14080000
140900                  DK-EXT-SHP-ID                                   14090000
141000                  ' DWNLD TMST: '                                 14100000
141100                  PV-CURRENT-TMST                                 14110000
141200           DELIMITED BY SIZE                                      14120000
141300           INTO DP013-MESSAGE-TEXT (2)                            14130000
141400           MOVE 'UNKNOWN '  TO DP013-DB2-TABLE-NAME (1)           14140000
141500           SET DP013-DB2-ABEND  TO TRUE                           14150000
141600           PERFORM 9999-ABEND                                     14160000
141700         ELSE                                                     14170000
141800           IF PS-WRITE-TO-CSSL-YES                                14180000
141900             AND SQLCODE = 0                                      14190000
142000               MOVE PV-RCVR-COUNT      TO PV-DISP-RCVR-COUNT      14200000
142100               STRING  ' ' WS003-SRC-TASK-NUMBER                  14210000
142200                       ' ' PV-DISP-EXT-SHP-ID (1:10)              14220000
142300                       ' 1070:PROCESS-UPDATE BYPASS SHPMT'        14230000
142400                       ' SHPMT FOUND ON HDR TABLE = BYPASS'       14240000
142500               DELIMITED BY SIZE                                  14250000
142600               INTO PV-CICS-MSG-AREA                              14260000
142700               PERFORM 9200-WRITE-TO-CICS-LOG                     14270000
142800            END-IF                                                14280000
142900*TCR 5/03 ADDED 'END-IF' BELOW                                    14290000
143000         END-IF                                                   14300000
143100        END-IF                                                    14310000
143200     END-IF.                                                      14320000
143300* JAK 06/2007 - END OF NEW PARAGRAPH                              14330000
143400                                                                  14340000
143500* JAK 06/2007 - NEW PARAGRAPH TO PROCESS CANCELS                  14350000
143600 1080-PROCESS-CANCEL.                                             14360000
143700     PERFORM 2000-GET-TRIP-INFO.                                  14370000
143800**AMIT*21/07/2013**INITIAL                                        14380000
143900** GET OPER_UNT_ID FROM TTRIPST                                   14390000
144000*    PERFORM 2300-GET-OPER-UNT-ID.                                14400000
144100**AMIT*21/07/2013**FINAL                                          14410000
144200     PERFORM 2400-CHECK-INTEGRATION-TYP.                          14420000
144300     PERFORM 1150-READ-XREF-HDR.                                  14430000
144400     MOVE 1             TO PV-GROUP-COUNTER.                      14440000
144500     MOVE 1             TO PV-ROW-COUNTER.                        14450000
144600     PERFORM 2700-CREATE-ASN-HDR.                                 14460000
144700     PERFORM 7100-UPD-HDR-XREF-VER-NBR.                           14470000
144800     MOVE PV-CURRENT-TMST (21:6)  TO WST00003-PRC-GP-ID.          14480000
144900     PERFORM 7200-ASN-DWNLD-MODULE.                               14490000
145000* JAK 06/2007 - END OF NEW PARAGRAPH                              14500000
145100                                                                  14510000
145200******************************************************************14520000
145300* UPDATE THE WST_SHIPT_XER_DTL.DWNLD_CDE TO 'N' FOR THE EXT_SHP_ID14530000
145400* THE +100 RETURN CODE WOULD BE AN ERROR                          14540000
145500******************************************************************14550000
145600 1100-UPD-DOWNLOAD-CODES.                                         14560000
145700                                                                  14570000
145800     EXEC SQL                                                     14580000
145900          UPDATE WST_SHPMT_XREF_DTL                               14590000
146000            SET  DWNLD_CDE = :PC-N                                14600000
146100           WHERE EXT_SHP_ID = :DK-EXT-SHP-ID                      14610000
146200     END-EXEC                                                     14620000
146300                                                                  14630000
146400     EVALUATE TRUE                                                14640000
146500         WHEN SQLCODE = ZERO                                      14650000
146600             CONTINUE                                             14660000
146700         WHEN SQLWARN0 NOT = SPACES                               14670000
146800         WHEN SQLCODE NOT = ZERO                                  14680000
146900              SET  PS-ERROR         TO TRUE                       14690000
147000              MOVE SQLCODE            TO PV-DISP-SQLCODE          14700000
147100              STRING ' ' WS003-SRC-TASK-NUMBER                    14710000
147200                     ' WSKCS301-1100: UPD-DOWNLOAD-CODES'         14720000
147300                     ' CALLED BY-'                                14730000
147400                      WS003-CALLING-PROGRAM-NAME                  14740000
147500                     ' SQLCODE='                                  14750000
147600                      PV-DISP-SQLCODE                             14760000
147700                     ' SUCC='                                     14770000
147800                      WS003-SUCCESS-IND                           14780000
147900              DELIMITED BY SIZE                                   14790000
148000              INTO PV-CICS-MSG-AREA                               14800000
148100              PERFORM 9200-WRITE-TO-CICS-LOG                      14810000
148200              MOVE '1100-UPD-DOWNLOAD-CODES'                      14820000
148300                               TO DP013-PARAGRAPH                 14830000
148400              MOVE 'UPDATE WST_SHPMT_XREF_DTL'                    14840000
148500                               TO DP013-MESSAGE-TEXT (1)          14850000
148600              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 14860000
148700              STRING ' TRIP ID: '                                 14870000
148800                     PV-DISP-TRIP-ID                              14880000
148900                     ' EXT SHIP ID: '                             14890000
149000                     DK-EXT-SHP-ID                                14900000
149100                     ' DWNLD TMST: '                              14910000
149200                     PV-CURRENT-TMST                              14920000
149300              DELIMITED BY SIZE                                   14930000
149400              INTO DP013-MESSAGE-TEXT (2)                         14940000
149500              MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)        14950000
149600              MOVE SQLCA       TO DP013-SQLCA                     14960000
149700              SET DP013-DB2-ABEND  TO TRUE                        14970000
149800              PERFORM 9999-ABEND                                  14980000
149900     END-EVALUATE.                                                14990000
150000                                                                  15000000
150100     IF PS-WRITE-TO-CSSL-YES                                      15010000
150200         STRING   ' ' WS003-SRC-TASK-NUMBER                       15020000
150300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   15030000
150400                  ' WSKCS301-1100: UPD-DOWNLOAD-CODES'            15040000
150500                  ' XREF DTL DWNLD CODES UPDATED TO N'            15050000
150600         DELIMITED BY SIZE                                        15060000
150700         INTO PV-CICS-MSG-AREA                                    15070000
150800         PERFORM 9200-WRITE-TO-CICS-LOG                           15080000
150900     END-IF.                                                      15090000
151000                                                                  15100000
151100* JAK 06/2007 - ADD PARAGRAPH 1150 TO READ XREF HDR TABLE         15110000
151200******************************************************************15120000
151300* READ THE XREF HEADER TO GET INFORMATION FOR ASN CANCEL TRANS    15130000
151400******************************************************************15140000
151500 1150-READ-XREF-HDR.                                              15150000
151600                                                                  15160000
151700     EXEC SQL                                                     15170000
151800          SELECT CRE_USR_ID                                       15180000
151900               , CRE_TMST                                         15190000
152000               , DWNLD_CDE                                        15200000
152100               , VER_NBR                                          15210000
152200            INTO :WST00001-CRE-USR-ID                             15220000
152300               , :WST00001-CRE-TMST                               15230000
152400               , :WST00001-DWNLD-CDE                              15240000
152500               , :WST00001-VER-NBR                                15250000
152600            FROM WST_SHPMT_XREF_HDR                               15260000
152700           WHERE EXT_SHP_ID = :DK-EXT-SHP-ID                      15270000
152710            WITH UR                                               15271008
152800     END-EXEC.                                                    15280000
152900                                                                  15290000
153000     EVALUATE TRUE                                                15300000
153100         WHEN SQLCODE = ZERO                                      15310000
153200**INCREMENT HOST-ID FIELD FOR LATER UPDATE OF HDR XREF VER-NBR    15320000
153300             IF WST00001-DWNLD-CDE = PC-N                         15330000
153400                 MOVE +1 TO PV-HOST-INPUT-ID                      15340000
153500             ELSE                                                 15350000
153600                 MOVE WST00001-VER-NBR                            15360000
153700                            TO PV-LAST-HOST-INPUT-ID              15370000
153800                 COMPUTE PV-HOST-INPUT-ID =                       15380000
153900                            PV-LAST-HOST-INPUT-ID + 1             15390000
154000             END-IF                                               15400000
154100         WHEN SQLWARN0 NOT = SPACES                               15410000
154200         WHEN SQLCODE NOT = ZERO                                  15420000
154300              SET  PS-ERROR         TO TRUE                       15430000
154400              MOVE SQLCODE            TO PV-DISP-SQLCODE          15440000
154500              STRING ' ' WS003-SRC-TASK-NUMBER                    15450000
154600                     ' WSKCS301-1150: READ-XREF-HDR'              15460000
154700                     ' SQLCODE='                                  15470000
154800                      PV-DISP-SQLCODE                             15480000
154900              DELIMITED BY SIZE                                   15490000
155000              INTO PV-CICS-MSG-AREA                               15500000
155100              PERFORM 9200-WRITE-TO-CICS-LOG                      15510000
155200              MOVE '1150-READ-XREF-HDR'                           15520000
155300                               TO DP013-PARAGRAPH                 15530000
155400              MOVE 'SELECT WST_SHPMT_XREF_DTL'                    15540000
155500                               TO DP013-MESSAGE-TEXT (1)          15550000
155600              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 15560000
155700              STRING ' TRIP ID: '                                 15570000
155800                     PV-DISP-TRIP-ID                              15580000
155900                     ' EXT SHIP ID: '                             15590000
156000                     DK-EXT-SHP-ID                                15600000
156100                     ' DWNLD TMST: '                              15610000
156200                     PV-CURRENT-TMST                              15620000
156300              DELIMITED BY SIZE                                   15630000
156400              INTO DP013-MESSAGE-TEXT (2)                         15640000
156500              MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)        15650000
156600              MOVE SQLCA       TO DP013-SQLCA                     15660000
156700              SET DP013-DB2-ABEND  TO TRUE                        15670000
156800              PERFORM 9999-ABEND                                  15680000
156900     END-EVALUATE.                                                15690000
157000                                                                  15700000
157100     IF PS-WRITE-TO-CSSL-YES                                      15710000
157200         STRING   ' ' WS003-SRC-TASK-NUMBER                       15720000
157300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   15730000
157400                  ' WSKCS301-1150: READ-XREF-HDR'                 15740000
157500                  ' EXT SHIP ID: ' DK-EXT-SHP-ID                  15750000
157600         DELIMITED BY SIZE                                        15760000
157700         INTO PV-CICS-MSG-AREA                                    15770000
157800         PERFORM 9200-WRITE-TO-CICS-LOG                           15780000
157900     END-IF.                                                      15790000
158000* JAK 06/2007 - END OF NEW PARAGRAPH                              15800000
158100                                                                  15810000
158200******************************************************************15820000
158300* OPEN TRIP_ID_CSR                                               *15830000
158400******************************************************************15840000
158500 1200-OPEN-TRIP-ID-CSR.                                           15850000
158600                                                                  15860000
158700     EXEC SQL                                                     15870000
158800          OPEN TRIP_ID_CSR                                        15880000
158900     END-EXEC                                                     15890000
159000                                                                  15900000
159100     EVALUATE TRUE                                                15910000
159200         WHEN SQLCODE = ZERO                                      15920000
159300              CONTINUE                                            15930000
159400         WHEN SQLWARN0 NOT = SPACES                               15940000
159500         WHEN SQLCODE NOT = ZERO                                  15950000
159600             SET  PS-ERROR         TO TRUE                        15960000
159700             MOVE SQLCODE            TO PV-DISP-SQLCODE           15970000
159800             STRING ' ' WS003-SRC-TASK-NUMBER                     15980000
159900                    ' WSKCS301-1200: OPEN-TRIP-ID-CSR'            15990000
160000                    ' CALLED BY-'                                 16000000
160100                     WS003-CALLING-PROGRAM-NAME                   16010000
160200                    ' SQLCODE='                                   16020000
160300                     PV-DISP-SQLCODE                              16030000
160400                    ' SUCC='                                      16040000
160500                     WS003-SUCCESS-IND                            16050000
160600              DELIMITED BY SIZE                                   16060000
160700              INTO PV-CICS-MSG-AREA                               16070000
160800              PERFORM 9200-WRITE-TO-CICS-LOG                      16080000
160900              MOVE '1200-OPEN-TRIP-ID-CSR'                        16090000
161000                               TO DP013-PARAGRAPH                 16100000
161100              MOVE 'SELECT WST_SHPMT_XREF_HDR & DTL'              16110000
161200                               TO DP013-MESSAGE-TEXT (1)          16120000
161300              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 16130000
161400              STRING ' TRIP ID: '                                 16140000
161500                     PV-DISP-TRIP-ID                              16150000
161600                     ' EXT SHIP ID: '                             16160000
161700                     DK-EXT-SHP-ID                                16170000
161800                     ' DWNLD TMST: '                              16180000
161900                     PV-CURRENT-TMST                              16190000
162000              DELIMITED BY SIZE                                   16200000
162100              INTO DP013-MESSAGE-TEXT (2)                         16210000
162200              MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)        16220000
162300              MOVE SQLCA       TO DP013-SQLCA                     16230000
162400              SET DP013-DB2-ABEND  TO TRUE                        16240000
162500              PERFORM 9999-ABEND                                  16250000
162600     END-EVALUATE.                                                16260000
162700                                                                  16270000
162800******************************************************************16280000
162900* FETCH  TRIP_ID_CSR                                             *16290000
163000******************************************************************16300000
163100 1300-FETCH-TRIP-ID-CSR.                                          16310000
163200                                                                  16320000
163300     EXEC SQL                                                     16330000
163400          FETCH TRIP_ID_CSR                                       16340000
163500          INTO                                                    16350000
163600                :WST00002-PO-NBR                                  16360000
163700               ,:WST00002-PO-LNE-NBR                              16370000
163800               ,:WST00002-RCVR-SEQ-NBR                            16380000
163900               ,:WST00002-ASN-LVL-CDE                             16390000
164000               ,:WST00002-PREPK-ID                                16400000
164100     END-EXEC                                                     16410000
164200                                                                  16420000
164300     EVALUATE TRUE                                                16430000
164400         WHEN SQLCODE = ZERO                                      16440000
164500             CONTINUE                                             16450000
164600         WHEN SQLCODE = +100                                      16460000
164700             SET PS-END-OF-TRIP-ID-CSR-YES TO TRUE                16470000
164800             MOVE 0 TO PV-HOLD-TRIP-CSR-PREPK-ID                  16480000
164900                       PV-HOLD-TRIP-CSR-PO-NBR                    16490000
165000         WHEN SQLWARN0 NOT = SPACES                               16500000
165100         WHEN SQLCODE NOT = ZERO                                  16510000
165200         WHEN SQLCODE NOT = +100                                  16520000
165300             SET  PS-ERROR         TO TRUE                        16530000
165400             MOVE SQLCODE            TO PV-DISP-SQLCODE           16540000
165500             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            16550000
165600             MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID         16560000
165700             MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR      16570000
165800             STRING ' ' WS003-SRC-TASK-NUMBER                     16580000
165900                    ' WSKCS301-1300: FETCH-TRIP-ID-CSR'           16590000
166000                    ' CALLED BY-'                                 16600000
166100                     WS003-CALLING-PROGRAM-NAME                   16610000
166200                    ' SQLCODE='                                   16620000
166300                     PV-DISP-SQLCODE                              16630000
166400                    ' SUCC='                                      16640000
166500                     WS003-SUCCESS-IND                            16650000
166600                    ' PO='                                        16660000
166700                     PV-DISP-PO-NBR                               16670000
166800                    ' PRPK='                                      16680000
166900                     PV-DISP-PREPK-ID                             16690000
167000                    ' PO LNE='                                    16700000
167100                     PV-DISP-PO-LINE-NBR                          16710000
167200               DELIMITED BY SIZE                                  16720000
167300               INTO PV-CICS-MSG-AREA                              16730000
167400               PERFORM 9200-WRITE-TO-CICS-LOG                     16740000
167500               MOVE '1300-FETCH-TRIP-ID-CSR'                      16750000
167600                                TO DP013-PARAGRAPH                16760000
167700               MOVE 'SELECT WST_SHPMT_XREF_HDR & DTL'             16770000
167800                                TO DP013-MESSAGE-TEXT (1)         16780000
167900               MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                16790000
168000               STRING ' TRIP ID: '                                16800000
168100                      PV-DISP-TRIP-ID                             16810000
168200                      ' EXT SHIP ID: '                            16820000
168300                      DK-EXT-SHP-ID                               16830000
168400                      ' DWNLD TMST: '                             16840000
168500                      PV-CURRENT-TMST                             16850000
168600               DELIMITED BY SIZE                                  16860000
168700               INTO DP013-MESSAGE-TEXT (2)                        16870000
168800               MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)       16880000
168900               MOVE SQLCA       TO DP013-SQLCA                    16890000
169000               SET DP013-DB2-ABEND  TO TRUE                       16900000
169100               PERFORM 9999-ABEND                                 16910000
169200     END-EVALUATE.                                                16920000
169300                                                                  16930000
169400     IF PS-WRITE-TO-CSSL-YES                                      16940000
169500      AND SQLCODE = 0                                             16950000
169600         STRING   ' ' WS003-SRC-TASK-NUMBER                       16960000
169700                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   16970000
169800                  ' WSKCS301-1300: FETCH-TRIP-ID-CSR'             16980000
169900         DELIMITED BY SIZE                                        16990000
170000         INTO PV-CICS-MSG-AREA                                    17000000
170100         PERFORM 9200-WRITE-TO-CICS-LOG                           17010000
170200         MOVE WST00002-PO-NBR       TO PV-DISP-PO-NBR             17020000
170300         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       17030000
170400         MOVE WST00002-PREPK-ID     TO PV-DISP-PREPK-ID           17040000
170500         MOVE WST00002-PO-LNE-NBR   TO PV-DISP-PO-LINE-NBR        17050000
170600         STRING   ' ' PV-DISP-EXT-SHP-ID (1:10)                   17060000
170700                  ' PO NBR: '                                     17070000
170800                  PV-DISP-PO-NBR                                  17080000
170900                  ' RCVR: '                                       17090000
171000                  PV-DISP-RCVR-SEQ-NBR                            17100000
171100                  ' PRE PACK ID: '                                17110000
171200                  PV-DISP-PREPK-ID                                17120000
171300                  ' PO LINE: '                                    17130000
171400                  PV-DISP-PO-LINE-NBR                             17140000
171500         DELIMITED BY SIZE                                        17150000
171600         INTO PV-CICS-MSG-AREA                                    17160000
171700         PERFORM 9200-WRITE-TO-CICS-LOG                           17170000
171800     END-IF.                                                      17180000
171900                                                                  17190000
172000******************************************************************17200000
172100* CLOSE TRIP_ID_CSR                                              *17210000
172200******************************************************************17220000
172300 1400-CLOSE-TRIP-ID-CSR.                                          17230000
172400                                                                  17240000
172500     EXEC SQL                                                     17250000
172600          CLOSE TRIP_ID_CSR                                       17260000
172700     END-EXEC                                                     17270000
172800                                                                  17280000
172900     EVALUATE TRUE                                                17290000
173000         WHEN SQLCODE = ZERO                                      17300000
173100              CONTINUE                                            17310000
173200         WHEN SQLWARN0 NOT = SPACES                               17320000
173300         WHEN SQLCODE NOT = ZERO                                  17330000
173400             SET  PS-ERROR         TO TRUE                        17340000
173500             MOVE SQLCODE            TO PV-DISP-SQLCODE           17350000
173600             STRING ' ' WS003-SRC-TASK-NUMBER                     17360000
173700                    ' WSKCS301-1400: CLOSE-TRIP-ID-CSR'           17370000
173800                    ' CALLED BY-'                                 17380000
173900                     WS003-CALLING-PROGRAM-NAME                   17390000
174000                    ' SQLCODE='                                   17400000
174100                     PV-DISP-SQLCODE                              17410000
174200                    ' SUCC='                                      17420000
174300                     WS003-SUCCESS-IND                            17430000
174400             DELIMITED BY SIZE                                    17440000
174500             INTO PV-CICS-MSG-AREA                                17450000
174600             PERFORM 9200-WRITE-TO-CICS-LOG                       17460000
174700             MOVE '1400-CLOSE-TRIP-ID-CSR'                        17470000
174800                              TO DP013-PARAGRAPH                  17480000
174900             MOVE 'SELECT WST_SHPMT_XREF_HDR & DTL'               17490000
175000                              TO DP013-MESSAGE-TEXT (1)           17500000
175100             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  17510000
175200             STRING ' TRIP ID: '                                  17520000
175300                    PV-DISP-TRIP-ID                               17530000
175400                    ' EXT SHIP ID: '                              17540000
175500                    DK-EXT-SHP-ID                                 17550000
175600                    ' DWNLD TMST: '                               17560000
175700                    PV-CURRENT-TMST                               17570000
175800             DELIMITED BY SIZE                                    17580000
175900             INTO DP013-MESSAGE-TEXT (2)                          17590000
176000             MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)         17600000
176100             MOVE SQLCA       TO DP013-SQLCA                      17610000
176200             SET DP013-DB2-ABEND  TO TRUE                         17620000
176300             PERFORM 9999-ABEND                                   17630000
176400     END-EVALUATE.                                                17640000
176500                                                                  17650000
176600******************************************************************17660000
176700* -CHECK FOR TROUBLE AT THE PACK, PO LINE & RCVR LEVELS          *17670000
176800******************************************************************17680000
176900 1500-PROCESS-TRIP-ID-CSR.                                        17690000
177000                                                                  17700000
177100     IF WST00002-PO-NBR = PV-HOLD-TRIP-CSR-PO-NBR                 17710000
177200        IF WST00002-RCVR-SEQ-NBR = PV-HOLD-RCVR-NBR               17720000
177300           CONTINUE                                               17730000
177400        ELSE                                                      17740000
177500**AMIT**21/07/2013**INITIAL                                       17750000
177600** GET OPER_UNT_ID FROM TTRIPST                                   17760000
177700*          PERFORM 2300-GET-OPER-UNT-ID                           17770000
177800**AMIT**21/07/2013**FINAL                                         17780000
177900           PERFORM 1800-CHECK-FOR-TROUBLE                         17790000
178000           MOVE WST00002-RCVR-SEQ-NBR TO PV-HOLD-RCVR-NBR         17800000
178100           ADD +1 TO PV-RCVR-COUNT                                17810000
178200        END-IF                                                    17820000
178300     ELSE                                                         17830000
178400**AMIT**21/07/2013**INITIAL                                       17840000
178500** GET OPER_UNT_ID FROM TTRIPST                                   17850000
178600*       PERFORM 2300-GET-OPER-UNT-ID                              17860000
178700**AMIT**21/07/2013**FINAL                                         17870000
178800        PERFORM 1800-CHECK-FOR-TROUBLE                            17880000
178900        MOVE WST00002-PO-NBR TO PV-HOLD-TRIP-CSR-PO-NBR           17890000
179000        MOVE WST00002-RCVR-SEQ-NBR TO PV-HOLD-RCVR-NBR            17900000
179100        ADD +1 TO PV-RCVR-COUNT                                   17910000
179200     END-IF.                                                      17920000
179300                                                                  17930000
179400     PERFORM 1300-FETCH-TRIP-ID-CSR.                              17940000
179500                                                                  17950000
179600******************************************************************17960000
179700** CHECK FOR TROUBLE AT ANY LEVEL - RCVR, PK OR LN LEVEL        **17970000
179800******************************************************************17980000
179900 1800-CHECK-FOR-TROUBLE.                                          17990000
180000                                                                  18000000
180100     MOVE 0                   TO PV-TROUBLE-COUNT.                18010000
180200                                                                  18020000
180300     EXEC SQL                                                     18030000
180400        SELECT COUNT(*)                                           18040000
180500          INTO :PV-TROUBLE-COUNT                                  18050000
180600          FROM TTRBNTF A                                          18060000
180700              ,TTRBRSN C                                          18070000
180800         WHERE A.PO_NBR       =  :WST00002-PO-NBR                 18080000
180900           AND A.REC_SEQ_NBR  =  :WST00002-RCVR-SEQ-NBR           18090000
181000           AND A.RESOLVED_IND IN ('N','I','R')                    18100000
181100           AND A.TRBL_RSN_CDE = C.TRBL_RSN_CDE                    18110000
181200           AND C.NOTIF_IND    =  :PC-T                            18120000
181300           AND NOT EXISTS                                         18130000
181400              ( SELECT *                                          18140000
181500                FROM  TTRBRCN B                                   18150000
181600                WHERE B.RPT_PGM_NM  = :PC-PROGRAM-NAME            18160000
181700                  AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE )         18170000
181710          WITH UR                                                 18171008
181800     END-EXEC                                                     18180000
181900                                                                  18190000
182000     EVALUATE TRUE                                                18200000
182100         WHEN SQLCODE = +100                                      18210000
182200              CONTINUE                                            18220000
182300         WHEN SQLCODE = ZERO                                      18230000
182400         WHEN SQLCODE = -811                                      18240000
182500              IF PV-TROUBLE-COUNT > 0                             18250000
182600**AMIT**21/07/2013**INITIAL                                       18260000
182700                 PERFORM 1807-GET-TRBL-RSN-CDE                    18270000
182800**AMIT**21/07/2013**FINAL                                         18280000
182900              END-IF                                              18290000
183000         WHEN SQLWARN0 NOT = SPACES                               18300000
183100         WHEN SQLCODE NOT = ZERO                                  18310000
183200         WHEN SQLCODE NOT = +100                                  18320000
183300         WHEN SQLCODE NOT = -811                                  18330000
183400             SET  PS-ERROR         TO TRUE                        18340000
183500             MOVE SQLCODE            TO PV-DISP-SQLCODE           18350000
183600             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            18360000
183700             MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR   18370000
183800             STRING ' ' WS003-SRC-TASK-NUMBER                     18380000
183900                    ' WSKCS301-1800: 1800-CHECK-FOR-TROUBLE'      18390000
184000                    ' CALLED BY-'                                 18400000
184100                    WS003-CALLING-PROGRAM-NAME                    18410000
184200                    ' SQLCODE='                                   18420000
184300                    PV-DISP-SQLCODE                               18430000
184400                    ' SUCC='                                      18440000
184500                    WS003-SUCCESS-IND                             18450000
184600                    ' PO='                                        18460000
184700                    PV-DISP-PO-NBR                                18470000
184800                    ' RCVR='                                      18480000
184900                    PV-DISP-RCVR-SEQ-NBR                          18490000
185000             DELIMITED BY SIZE                                    18500000
185100             INTO PV-CICS-MSG-AREA                                18510000
185200             PERFORM 9200-WRITE-TO-CICS-LOG                       18520000
185300             MOVE '1800-CHECK-FOR-TROUBLE'                        18530000
185400                              TO DP013-PARAGRAPH                  18540000
185500             MOVE 'SELECT TTRBNTF, TTRBRSN'                       18550000
185600                              TO DP013-MESSAGE-TEXT (1)           18560000
185700             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  18570000
185800             STRING ' TRIP ID: '                                  18580000
185900                    PV-DISP-TRIP-ID                               18590000
186000                    ' EXT SHIP ID: '                              18600000
186100                    DK-EXT-SHP-ID                                 18610000
186200                    ' DWNLD TMST: '                               18620000
186300                    PV-CURRENT-TMST                               18630000
186400             DELIMITED BY SIZE                                    18640000
186500             INTO DP013-MESSAGE-TEXT (2)                          18650000
186600             MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)         18660000
186700             MOVE SQLCA       TO DP013-SQLCA                      18670000
186800             SET DP013-DB2-ABEND  TO TRUE                         18680000
186900             PERFORM 9999-ABEND                                   18690000
187000     END-EVALUATE.                                                18700000
187100                                                                  18710000
187200******************************************************************18720000
187300* UPDATE THE WST_SHIPT_XER_DTL.DWNLD_CDE TO 'T' FOR THE EXT_SHP_ID18730000
187400* PO_NBR, RCVR_SEQ.                                               18740000
187500******************************************************************18750000
187600 1810-UPD-DTL-FOR-TROUBLE.                                        18760000
187700                                                                  18770000
187800     EXEC SQL                                                     18780000
187900          UPDATE WST_SHPMT_XREF_DTL                               18790000
188000            SET  DWNLD_CDE = :PC-T                                18800000
188100           WHERE EXT_SHP_ID   = :DK-EXT-SHP-ID                    18810000
188200           AND   PO_NBR       = :WST00002-PO-NBR                  18820000
188300           AND   RCVR_SEQ_NBR = :WST00002-RCVR-SEQ-NBR            18830000
188400     END-EXEC                                                     18840000
188500                                                                  18850000
188600     EVALUATE TRUE                                                18860000
188700         WHEN SQLCODE = ZERO                                      18870000
188800             CONTINUE                                             18880000
188900         WHEN SQLWARN0 NOT = SPACES                               18890000
189000         WHEN SQLCODE NOT = ZERO                                  18900000
189100             SET  PS-ERROR         TO TRUE                        18910000
189200             MOVE SQLCODE            TO PV-DISP-SQLCODE           18920000
189300             STRING ' ' WS003-SRC-TASK-NUMBER                     18930000
189400                    ' WSKCS301-1810: 1810-UPD-DTL-FOR-TROUBLE'    18940000
189500                    ' CALLED BY-'                                 18950000
189600                     WS003-CALLING-PROGRAM-NAME                   18960000
189700                    ' SQLCODE='                                   18970000
189800                     PV-DISP-SQLCODE                              18980000
189900                    ' SUCC='                                      18990000
190000                     WS003-SUCCESS-IND                            19000000
190100             DELIMITED BY SIZE                                    19010000
190200             INTO PV-CICS-MSG-AREA                                19020000
190300             PERFORM 9200-WRITE-TO-CICS-LOG                       19030000
190400             MOVE '1810-UPD-DTL-FOR-TROUBLE'                      19040000
190500                              TO DP013-PARAGRAPH                  19050000
190600             MOVE 'UPDATE WST_SHPMT_XREF_DTL'                     19060000
190700                              TO DP013-MESSAGE-TEXT (1)           19070000
190800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  19080000
190900             STRING ' TRIP ID: '                                  19090000
191000                    PV-DISP-TRIP-ID                               19100000
191100                    ' EXT SHIP ID: '                              19110000
191200                    DK-EXT-SHP-ID                                 19120000
191300                    ' DWNLD TMST: '                               19130000
191400                    PV-CURRENT-TMST                               19140000
191500             DELIMITED BY SIZE                                    19150000
191600             INTO DP013-MESSAGE-TEXT (2)                          19160000
191700             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         19170000
191800             MOVE SQLCA       TO DP013-SQLCA                      19180000
191900             SET DP013-DB2-ABEND  TO TRUE                         19190000
192000             PERFORM 9999-ABEND                                   19200000
192100     END-EVALUATE.                                                19210000
192200                                                                  19220000
192300     IF PS-WRITE-TO-CSSL-YES                                      19230000
192400      AND SQLCODE = 0                                             19240000
192500         STRING   ' ' WS003-SRC-TASK-NUMBER                       19250000
192600                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   19260000
192700                  ' WSKCS301-1810: UPD-DTL-FOR-TROUBLE'           19270000
192800         DELIMITED BY SIZE                                        19280000
192900         INTO PV-CICS-MSG-AREA                                    19290000
193000         PERFORM 9200-WRITE-TO-CICS-LOG                           19300000
193100         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                19310000
193200         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       19320000
193300         STRING   ' ' WS003-SRC-TASK-NUMBER                       19330000
193400                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   19340000
193500                  ' DTL XREF UPD TO T FOR PO NBR: '               19350000
193600                  PV-DISP-PO-NBR                                  19360000
193700                  ' RCVR: '                                       19370000
193800                  PV-DISP-RCVR-SEQ-NBR                            19380000
193900         DELIMITED BY SIZE                                        19390000
194000         INTO PV-CICS-MSG-AREA                                    19400000
194100         PERFORM 9200-WRITE-TO-CICS-LOG                           19410000
194200     END-IF.                                                      19420000
194300**AMIT**21/07/2013**INITIAL                                       19430000
194400*----------------------------------------------------------------*19440000
194500*    GET TROUBLE REASON CODE                                     *19450000
194600*----------------------------------------------------------------*19460000
194700 1807-GET-TRBL-RSN-CDE.                                           19470000
194800                                                                  19480000
194900     MOVE 0                   TO PV-TROUBLE-COUNT1.               19490000
195000     SET  PS-TROUBLE-FLAG-NO  TO TRUE.                            19500000
195100                                                                  19510000
195200     EXEC SQL                                                     19520000
195300        SELECT COUNT(*)                                           19530000
195400          INTO :PV-TROUBLE-COUNT1                                 19540000
195500          FROM TTRBNTF A                                          19550000
195600              ,TTRBRSN C                                          19560000
195700         WHERE A.PO_NBR       =  :WST00002-PO-NBR                 19570000
195800           AND A.REC_SEQ_NBR  =  :WST00002-RCVR-SEQ-NBR           19580000
195900           AND A.RESOLVED_IND IN ('N','I','R')                    19590000
196000           AND A.TRBL_RSN_CDE = C.TRBL_RSN_CDE                    19600000
196100           AND C.NOTIF_IND    =  :PC-T                            19610000
196200           AND  EXISTS                                            19620000
196300              ( SELECT *                                          19630000
196400                FROM  TTRBRCN B                                   19640000
196500                WHERE B.RPT_PGM_NM  = :PC-PROGRAM-NAME1           19650000
196600                  AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE )         19660000
196610         WITH UR                                                  19661008
196700     END-EXEC                                                     19670000
196800                                                                  19680000
196900         EVALUATE TRUE                                            19690000
197000             WHEN SQLCODE = +100                                  19700000
197100                  PERFORM 1810-UPD-DTL-FOR-TROUBLE                19710000
197200                  SET PS-TROUBLE-FOUND-YES TO TRUE                19720000
197300                  SET PS-TROUBLE-FLAG-YES  TO TRUE                19730000
197400             WHEN SQLCODE = 0                                     19740000
197500             WHEN SQLCODE = -811                                  19750000
197600                 IF PV-TROUBLE-COUNT1 > 0                         19760000
197700                 INITIALIZE PV-FINAL-AMT                          19770000
197800                 PERFORM 1811-OPEN-RETAIL-VALUE                   19780000
197900                 PERFORM 1812-FETCH-RETAIL-VALUE                  19790000
198000                   UNTIL PS-RETAIL-CLOSE                          19800000
198100                 PERFORM 1813-CLOSE-RETAIL-VALUE                  19810000
198200                 PERFORM 1900-GET-PARM-VALUE                      19820000
198300                   IF PV-FINAL-AMT < CT-DOLLAR-VALUE              19830000
198400**ROOPA**31/07/2013**INITIAL                                      19840000
198500                      PERFORM 1815-CREATE-TROUBLE-RECORD          19850000
198600*                     CONTINUE                                    19860000
198700**ROOPA**31/07/2013**FINAL                                        19870000
198800                   ELSE                                           19880000
198900                      PERFORM 1810-UPD-DTL-FOR-TROUBLE            19890000
199000                      SET PS-TROUBLE-FOUND-YES TO TRUE            19900000
199100                      SET PS-TROUBLE-FLAG-YES  TO TRUE            19910000
199200                   END-IF                                         19920000
199300*                ELSE                                             19930000
199400*                     PERFORM 1810-UPD-DTL-FOR-TROUBLE            19940000
199500*                     SET PS-TROUBLE-FOUND-YES TO TRUE            19950000
199600                 END-IF                                           19960000
199700                 IF PS-TROUBLE-FLAG-NO                            19970000
199800                      PERFORM 1808-GET-CONSRV-TRBL-CDE            19980000
199900                 END-IF                                           19990000
200000             WHEN SQLWARN0 NOT = SPACES                           20000000
200100             WHEN SQLCODE NOT = ZERO                              20010000
200200             WHEN SQLCODE NOT = +100                              20020000
200300             WHEN SQLCODE NOT = -811                              20030000
200400                  SET  PS-ERROR         TO TRUE                   20040000
200500                  MOVE SQLCODE            TO PV-DISP-SQLCODE      20050000
200600                  MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR       20060000
200700                MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR20070000
200800                  STRING ' ' WS003-SRC-TASK-NUMBER                20080000
200900                    ' WSKCS301-1800: 1800-CHECK-FOR-TROUBLE'      20090000
201000                    ' CALLED BY-'                                 20100000
201100                    WS003-CALLING-PROGRAM-NAME                    20110000
201200                    ' SQLCODE='                                   20120000
201300                    PV-DISP-SQLCODE                               20130000
201400                    ' SUCC='                                      20140000
201500                    WS003-SUCCESS-IND                             20150000
201600                    ' PO='                                        20160000
201700                    PV-DISP-PO-NBR                                20170000
201800                    ' RCVR='                                      20180000
201900                    PV-DISP-RCVR-SEQ-NBR                          20190000
202000                 DELIMITED BY SIZE                                20200000
202100                 INTO PV-CICS-MSG-AREA                            20210000
202200                 PERFORM 9200-WRITE-TO-CICS-LOG                   20220000
202300                 MOVE '1807-GET-TRBL-RSN-CDE'                     20230000
202400                              TO DP013-PARAGRAPH                  20240000
202500                 MOVE 'SELECT TTRBNTF, TTRBRSN'                   20250000
202600                              TO DP013-MESSAGE-TEXT (1)           20260000
202700                 MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID              20270000
202800                 STRING ' TRIP ID: '                              20280000
202900                    PV-DISP-TRIP-ID                               20290000
203000                    ' EXT SHIP ID: '                              20300000
203100                    DK-EXT-SHP-ID                                 20310000
203200                    ' DWNLD TMST: '                               20320000
203300                    PV-CURRENT-TMST                               20330000
203400                 DELIMITED BY SIZE                                20340000
203500                 INTO DP013-MESSAGE-TEXT (2)                      20350000
203600                 MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)     20360000
203700                 MOVE SQLCA       TO DP013-SQLCA                  20370000
203800                 SET DP013-DB2-ABEND  TO TRUE                     20380000
203900                 PERFORM 9999-ABEND                               20390000
204000         END-EVALUATE.                                            20400000
204100*----------------------------------------------------------------*20410000
204200*    GET CONSERVATIVE TROUBLE REASON CODE                        *20420000
204300*----------------------------------------------------------------*20430000
204400 1808-GET-CONSRV-TRBL-CDE.                                        20440000
204500                                                                  20450000
204600     MOVE 0                   TO PV-TROUBLE-COUNTC.               20460000
204700                                                                  20470000
204800     EXEC SQL                                                     20480000
204900        SELECT COUNT(*)                                           20490000
205000          INTO :PV-TROUBLE-COUNTC                                 20500000
205100          FROM TTRBNTF A                                          20510000
205200              ,TTRBRSN C                                          20520000
205300         WHERE A.PO_NBR       =  :WST00002-PO-NBR                 20530000
205400           AND A.REC_SEQ_NBR  =  :WST00002-RCVR-SEQ-NBR           20540000
205500           AND A.RESOLVED_IND IN ('N','I','R')                    20550000
205600           AND A.TRBL_RSN_CDE = C.TRBL_RSN_CDE                    20560000
205700           AND C.NOTIF_IND    =  :PC-T                            20570000
205800           AND  NOT EXISTS                                        20580000
205900              ( SELECT *                                          20590000
206000                FROM  TTRBRCN B                                   20600000
206100                WHERE B.RPT_PGM_NM IN(:PC-PROGRAM-NAME1 ,         20610000
206200                                      :PC-PROGRAM-NAME)           20620000
206300                  AND A.TRBL_RSN_CDE  =  B.TRBL_RSN_CDE )         20630000
206310         WITH UR                                                  20631008
206400     END-EXEC                                                     20640000
206500                                                                  20650000
206600         EVALUATE TRUE                                            20660000
206700             WHEN SQLCODE = +100                                  20670000
206800                  CONTINUE                                        20680000
206900             WHEN SQLCODE = 0                                     20690000
207000             WHEN SQLCODE = -811                                  20700000
207100                 IF PV-TROUBLE-COUNTC > 0                         20710000
207200                 PERFORM 1810-UPD-DTL-FOR-TROUBLE                 20720000
207300                 SET PS-TROUBLE-FOUND-YES TO TRUE                 20730000
207400                 END-IF                                           20740000
207500             WHEN SQLWARN0 NOT = SPACES                           20750000
207600             WHEN SQLCODE NOT = ZERO                              20760000
207700             WHEN SQLCODE NOT = +100                              20770000
207800             WHEN SQLCODE NOT = -811                              20780000
207900                  SET  PS-ERROR         TO TRUE                   20790000
208000                  MOVE SQLCODE            TO PV-DISP-SQLCODE      20800000
208100                  MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR       20810000
208200                MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR20820000
208300                  STRING ' ' WS003-SRC-TASK-NUMBER                20830000
208400                    ' WSKCS301-1800: 1800-CHECK-FOR-TROUBLE'      20840000
208500                    ' CALLED BY-'                                 20850000
208600                    WS003-CALLING-PROGRAM-NAME                    20860000
208700                    ' SQLCODE='                                   20870000
208800                    PV-DISP-SQLCODE                               20880000
208900                    ' SUCC='                                      20890000
209000                    WS003-SUCCESS-IND                             20900000
209100                    ' PO='                                        20910000
209200                    PV-DISP-PO-NBR                                20920000
209300                    ' RCVR='                                      20930000
209400                    PV-DISP-RCVR-SEQ-NBR                          20940000
209500                 DELIMITED BY SIZE                                20950000
209600                 INTO PV-CICS-MSG-AREA                            20960000
209700                 PERFORM 9200-WRITE-TO-CICS-LOG                   20970000
209800                 MOVE '1808-GET-CONSRV-TRBL-CDE'                  20980000
209900                              TO DP013-PARAGRAPH                  20990000
210000                 MOVE 'SELECT TTRBNTF, TTRBRSN'                   21000000
210100                              TO DP013-MESSAGE-TEXT (1)           21010000
210200                 MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID              21020000
210300                 STRING ' TRIP ID: '                              21030000
210400                    PV-DISP-TRIP-ID                               21040000
210500                    ' EXT SHIP ID: '                              21050000
210600                    DK-EXT-SHP-ID                                 21060000
210700                    ' DWNLD TMST: '                               21070000
210800                    PV-CURRENT-TMST                               21080000
210900                 DELIMITED BY SIZE                                21090000
211000                 INTO DP013-MESSAGE-TEXT (2)                      21100000
211100                 MOVE 'TTRBNTF '  TO DP013-DB2-TABLE-NAME (1)     21110000
211200                 MOVE SQLCA       TO DP013-SQLCA                  21120000
211300                 SET DP013-DB2-ABEND  TO TRUE                     21130000
211400                 PERFORM 9999-ABEND                               21140000
211500         END-EVALUATE.                                            21150000
211600/                                                                 21160000
211700******************************************************************21170000
211800* OPEN RETAIL CURSOR                                             *21180000
211900******************************************************************21190000
212000 1811-OPEN-RETAIL-VALUE.                                          21200000
212100                                                                  21210000
212200     EXEC SQL                                                     21220000
212300          OPEN RETAIL_VAL_CSR                                     21230000
212400     END-EXEC                                                     21240000
212500                                                                  21250000
212600     EVALUATE TRUE                                                21260000
212700         WHEN SQLCODE = ZERO                                      21270000
212800              SET PS-RETAIL-OPEN TO TRUE                          21280000
212900         WHEN SQLWARN0 NOT = SPACES                               21290000
213000         WHEN SQLCODE NOT = ZERO                                  21300000
213100             SET PS-ERROR TO TRUE                                 21310000
213200             SET  PS-RETAIL-CLOSE  TO TRUE                        21320000
213300             MOVE SQLCODE            TO PV-DISP-SQLCODE           21330000
213400             STRING ' ' WS003-SRC-TASK-NUMBER                     21340000
213500                    ' WSKCS301-1811: OPEN-RETAIL-VALUE'           21350000
213600                    ' CALLED BY-'                                 21360000
213700                     WS003-CALLING-PROGRAM-NAME                   21370000
213800                    ' SQLCODE='                                   21380000
213900                     PV-DISP-SQLCODE                              21390000
214000                    ' SUCC='                                      21400000
214100                     WS003-SUCCESS-IND                            21410000
214200              DELIMITED BY SIZE                                   21420000
214300              INTO PV-CICS-MSG-AREA                               21430000
214400              PERFORM 9200-WRITE-TO-CICS-LOG                      21440000
214500              MOVE '1811-OPEN-RETAIL-VALUE'                       21450000
214600                               TO DP013-PARAGRAPH                 21460000
214700              MOVE 'SELECT TRECITM '                              21470000
214800                               TO DP013-MESSAGE-TEXT (1)          21480000
214900              MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR           21490000
215000              MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR  21500000
215100              STRING ' PO-NBR : '                                 21510000
215200                     PV-DISP-PO-NBR                               21520000
215300                     ' RCVR-SEQ-NBR:'                             21530000
215400                     PV-DISP-RCVR-SEQ-NBR                         21540000
215500              DELIMITED BY SIZE                                   21550000
215600              INTO DP013-MESSAGE-TEXT (2)                         21560000
215700              MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)        21570000
215800              MOVE SQLCA       TO DP013-SQLCA                     21580000
215900              SET DP013-DB2-ABEND  TO TRUE                        21590000
216000              PERFORM 9999-ABEND                                  21600000
216100     END-EVALUATE.                                                21610000
216200                                                                  21620000
216300******************************************************************21630000
216400* FETCH  REATIL CURSOR                                           *21640000
216500******************************************************************21650000
216600 1812-FETCH-RETAIL-VALUE.                                         21660000
216700                                                                  21670000
216800     EXEC SQL                                                     21680000
216900          FETCH RETAIL_VAL_CSR                                    21690000
217000          INTO                                                    21700000
217100                :RECITM-UNT-RTL-AMT                               21710000
217200               ,:RECITM-PKSL-ITM-QTY                              21720000
217300     END-EXEC                                                     21730000
217400                                                                  21740000
217500     EVALUATE TRUE                                                21750000
217600         WHEN SQLCODE = ZERO                                      21760000
217700              COMPUTE PV-AMT = RECITM-UNT-RTL-AMT *               21770000
217800                                     RECITM-PKSL-ITM-QTY          21780000
217900              COMPUTE PV-FINAL-AMT = PV-FINAL-AMT +               21790000
218000                                     PV-AMT                       21800000
218100         WHEN SQLCODE = +100                                      21810000
218200             SET PS-RETAIL-CLOSE  TO TRUE                         21820000
218300         WHEN SQLWARN0 NOT = SPACES                               21830000
218400         WHEN SQLCODE NOT = ZERO                                  21840000
218500         WHEN SQLCODE NOT = +100                                  21850000
218600             SET  PS-ERROR         TO TRUE                        21860000
218700             MOVE SQLCODE            TO PV-DISP-SQLCODE           21870000
218800             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            21880000
218900             MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR   21890000
219000             STRING ' ' WS003-SRC-TASK-NUMBER                     21900000
219100                    ' WSKCS301-1300: FETCH-TRIP-ID-CSR'           21910000
219200                    ' CALLED BY-'                                 21920000
219300                     WS003-CALLING-PROGRAM-NAME                   21930000
219400                    ' SQLCODE='                                   21940000
219500                     PV-DISP-SQLCODE                              21950000
219600                    ' SUCC='                                      21960000
219700                     WS003-SUCCESS-IND                            21970000
219800                    ' PO='                                        21980000
219900                     PV-DISP-PO-NBR                               21990000
220000                    ' RCVR='                                      22000000
220100                     PV-DISP-RCVR-SEQ-NBR                         22010000
220200               DELIMITED BY SIZE                                  22020000
220300               INTO PV-CICS-MSG-AREA                              22030000
220400               PERFORM 9200-WRITE-TO-CICS-LOG                     22040000
220500               MOVE '1812-FETCH-RETAIL-VALUE'                     22050000
220600                                TO DP013-PARAGRAPH                22060000
220700               MOVE 'SELECT TRECITM '                             22070000
220800                                TO DP013-MESSAGE-TEXT (1)         22080000
220900               STRING ' PO-NBR: '                                 22090000
221000                      PV-DISP-PO-NBR                              22100000
221100                      ' RCVR-SEQ-NBR: '                           22110000
221200                      PV-DISP-RCVR-SEQ-NBR                        22120000
221300               DELIMITED BY SIZE                                  22130000
221400               INTO DP013-MESSAGE-TEXT (2)                        22140000
221500               MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)       22150000
221600               MOVE SQLCA       TO DP013-SQLCA                    22160000
221700               SET DP013-DB2-ABEND  TO TRUE                       22170000
221800               PERFORM 9999-ABEND                                 22180000
221900     END-EVALUATE.                                                22190000
222000                                                                  22200000
222100     IF PS-WRITE-TO-CSSL-YES                                      22210000
222200      AND SQLCODE = 0                                             22220000
222300         STRING   ' ' WS003-SRC-TASK-NUMBER                       22230000
222400                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   22240000
222500                  ' WSKCS301-1812: FETCH-FETCH-RETAIL-VALUE'      22250000
222600         DELIMITED BY SIZE                                        22260000
222700         INTO PV-CICS-MSG-AREA                                    22270000
222800         PERFORM 9200-WRITE-TO-CICS-LOG                           22280000
222900         MOVE WST00002-PO-NBR       TO PV-DISP-PO-NBR             22290000
223000         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       22300000
223100         STRING   ' ' PV-DISP-EXT-SHP-ID (1:10)                   22310000
223200                  ' PO NBR: '                                     22320000
223300                  PV-DISP-PO-NBR                                  22330000
223400                  ' RCVR: '                                       22340000
223500                  PV-DISP-RCVR-SEQ-NBR                            22350000
223600         DELIMITED BY SIZE                                        22360000
223700         INTO PV-CICS-MSG-AREA                                    22370000
223800         PERFORM 9200-WRITE-TO-CICS-LOG                           22380000
223900     END-IF.                                                      22390000
224000                                                                  22400000
224100******************************************************************22410000
224200* CLOSE RETAIL CURSOR                                            *22420000
224300******************************************************************22430000
224400 1813-CLOSE-RETAIL-VALUE.                                         22440000
224500                                                                  22450000
224600     EXEC SQL                                                     22460000
224700          CLOSE RETAIL_VAL_CSR                                    22470000
224800     END-EXEC                                                     22480000
224900                                                                  22490000
225000     EVALUATE TRUE                                                22500000
225100         WHEN SQLCODE = ZERO                                      22510000
225200              CONTINUE                                            22520000
225300         WHEN SQLWARN0 NOT = SPACES                               22530000
225400         WHEN SQLCODE NOT = ZERO                                  22540000
225500             SET  PS-ERROR         TO TRUE                        22550000
225600             MOVE SQLCODE            TO PV-DISP-SQLCODE           22560000
225700             STRING ' ' WS003-SRC-TASK-NUMBER                     22570000
225800                    ' WSKCS301-1812: CLOSE-RETAIL-VALUE'          22580000
225900                    ' CALLED BY-'                                 22590000
226000                     WS003-CALLING-PROGRAM-NAME                   22600000
226100                    ' SQLCODE='                                   22610000
226200                     PV-DISP-SQLCODE                              22620000
226300                    ' SUCC='                                      22630000
226400                     WS003-SUCCESS-IND                            22640000
226500             DELIMITED BY SIZE                                    22650000
226600             INTO PV-CICS-MSG-AREA                                22660000
226700             PERFORM 9200-WRITE-TO-CICS-LOG                       22670000
226800             MOVE '1813-CLOSE-RETAIL-VALUE'                       22680000
226900                              TO DP013-PARAGRAPH                  22690000
227000             MOVE 'SELECT TRECITM  '                              22700000
227100                              TO DP013-MESSAGE-TEXT (1)           22710000
227200             STRING ' PO-NBR : '                                  22720000
227300                    PV-DISP-PO-NBR                                22730000
227400                    ' RCVR-SEQ-NBR: '                             22740000
227500                    PV-DISP-RCVR-SEQ-NBR                          22750000
227600             DELIMITED BY SIZE                                    22760000
227700             INTO DP013-MESSAGE-TEXT (2)                          22770000
227800             MOVE 'TRECITM'   TO DP013-DB2-TABLE-NAME (1)         22780000
227900             MOVE SQLCA       TO DP013-SQLCA                      22790000
228000             SET DP013-DB2-ABEND  TO TRUE                         22800000
228100             PERFORM 9999-ABEND                                   22810000
228200     END-EVALUATE.                                                22820000
228300                                                                  22830000
228400******************************************************************22840000
228500**AMIT**21/07/2013**FINAL                                         22850000
228600******************************************************************22860000
228700**ROOPA**31/07/2013**INITIAL                                      22870000
228800 1815-CREATE-TROUBLE-RECORD.                                      22880000
228900******************************************************************22890000
229000*    THIS PARAGRAPH CALLS PROGRAM TMKCS521 WHICH WILL MAINTAIN    22900000
229100*    TROUBLE RECORDS IN TTRBNTF AND TTRBDTL TABLES.  IT ALSO      22910000
229200*    CHECKS TO MAKE SURE THAT IF IT IS IN AUTO-RESOLVE,  IT MUST  22920000
229300*    NOT HAVE ANY DETAILS.  THEREFORE, IT SAVES THE DETAILS AND   22930000
229400*    RE-INSTATE THE DETAILS WHEN RETURNING FROM TMKCS521.         22940000
229500******************************************************************22950000
229600                                                                  22960000
229700                                                                  22970000
229800     MOVE TRIPST-OPER-UNT-ID   TO TM500-OPER-UNT-ID.              22980000
229900     MOVE 1                    TO TM500-FCLTY-ID.                 22990000
230000     MOVE WST00002-PO-NBR       TO TM500-PO-NBR.                  23000000
230100     MOVE WST00002-RCVR-SEQ-NBR TO TM500-REC-SEQ-NBR.             23010000
230200     SET  TM500-CREATE-AUTO     TO TRUE.                          23020000
230300     MOVE PC-516                TO TM500-TRBL-RSN-CDE.            23030000
230400     SET  TM500-ADD-DETAILS     TO TRUE.                          23040000
230500     MOVE  PV-FINAL-AMT    TO PV-TM-FREEFORM-TXT-2                23050000
230600     MOVE  PV-TM-FREEFORM-TXT                                     23060000
230700                                TO TM500-FREEFORM-TEXT.           23070000
230800                                                                  23080000
230900     EXEC CICS                                                    23090000
231000         LINK PROGRAM  (PC-TMKCS521)                              23100000
231100              COMMAREA (TM500-FIELDS)                             23110000
231200              LENGTH   (PC-600)                                   23120000
231300     END-EXEC.                                                    23130000
231400                                                                  23140000
231500     IF TM500-FREEFORM-TEXT > SPACES AND                          23150000
231600        TM500-NO-DETAILS AND TM500-RESOLVE-AUTO AND TM500-UPDATE  23160000
231700         SET TM500-ADD-DETAILS TO TRUE                            23170000
231800     END-IF.                                                      23180000
231900                                                                  23190000
232000     EVALUATE TRUE                                                23200000
232100         WHEN TM500-CALL-SUCCESSFUL                               23210000
232200         WHEN TM500-TTRBNTF-UPDATE-NOT-FND                        23220000
232300              CONTINUE                                            23230000
232400                                                                  23240000
232500         WHEN OTHER                                               23250000
232600              SET PS-DONE TO TRUE                                 23260000
232700     END-EVALUATE.                                                23270000
232800                                                                  23280000
232900                                                                  23290000
233000**ROOPA**31/07/2013**FINAL                                        23300000
233100******************************************************************23310000
233200* 1900-GET-PARM-VALUE.                                           *23320000
233300*  RETRIEVE THE RETAIL VALUE FROM THE PARM TABLE.                *23330000
233400******************************************************************23340000
233500 1900-GET-PARM-VALUE.                                             23350000
233600                                                                  23360000
233700     MOVE ZERO    TO KRPRPM-FUNC-QTY.                             23370000
233800                                                                  23380000
233900     EXEC SQL                                                     23390000
234000          SELECT FUNC_QTY                                         23400000
234100            INTO :KRPRPM-FUNC-QTY                                 23410000
234200            FROM TKRPRPM                                          23420000
234300           WHERE LOC_ID            = 90                           23430000
234400             AND SYS_PRC_FUNC_CDE  = 'RTLAMT'                     23440000
234500             AND INTFC_SYS_CDE     = 'KHL'                        23450000
234600             AND FUNC_PRC_STAT_CDE = 'AC'                         23460000
234700             AND (CURRENT_DATE BETWEEN DATE(FUNC_BEG_TMST)        23470000
234800                                   AND DATE(FUNC_END_TMST))       23480000
234900           WITH UR                                                23490000
235000     END-EXEC.                                                    23500000
235100                                                                  23510000
235200     EVALUATE TRUE                                                23520000
235300         WHEN SQLCODE = ZERO                                      23530000
235400         WHEN SQLCODE = +100                                      23540000
235500              MOVE KRPRPM-FUNC-QTY  TO CT-DOLLAR-VALUE            23550000
235600                                                                  23560000
235700         WHEN SQLWARN0 NOT = SPACES                               23570000
235800         WHEN SQLCODE NOT = ZERO                                  23580000
235900         WHEN SQLCODE NOT = +100                                  23590000
236000         WHEN SQLCODE NOT = -811                                  23600000
236100              SET  PS-ERROR         TO TRUE                       23610000
236200              MOVE SQLCODE          TO PV-DISP-SQLCODE            23620000
236300              STRING ' ' WS003-SRC-TASK-NUMBER                    23630000
236400                     ' WSKCS301-1900: GET-PARM-VALUE'             23640000
236500                     ' CALLED BY-'                                23650000
236600                      WS003-CALLING-PROGRAM-NAME                  23660000
236700                     ' SQLCODE='                                  23670000
236800                      PV-DISP-SQLCODE                             23680000
236900                     ' SUCC='                                     23690000
237000                      WS003-SUCCESS-IND                           23700000
237100                   DELIMITED BY SIZE                              23710000
237200                        INTO PV-CICS-MSG-AREA                     23720000
237300              PERFORM 9200-WRITE-TO-CICS-LOG                      23730000
237400              MOVE '1900-GET-PARM-VALUE'                          23740000
237500                               TO DP013-PARAGRAPH                 23750000
237600              MOVE 'SELECT TKRPRPM'                               23760000
237700                               TO DP013-MESSAGE-TEXT (1)          23770000
237800              STRING ' PARM = RTLAMT '                            23780000
237900                     ' DWNLD TMST: '                              23790000
238000                     PV-CURRENT-TMST                              23800000
238100                  DELIMITED BY SIZE                               23810000
238200                       INTO DP013-MESSAGE-TEXT (2)                23820000
238300              MOVE 'TKRPRPM '  TO DP013-DB2-TABLE-NAME (1)        23830000
238400              MOVE SQLCA       TO DP013-SQLCA                     23840000
238500              SET DP013-DB2-ABEND  TO TRUE                        23850000
238600              PERFORM 9999-ABEND                                  23860000
238700     END-EVALUATE.                                                23870000
238800                                                                  23880000
238900     IF PS-WRITE-TO-CSSL-YES                                      23890000
239000     AND SQLCODE = 0                                              23900000
239100         STRING ' ' WS003-SRC-TASK-NUMBER                         23910000
239200                ' WSKCS301-1900: GET-PARM-VALUE'                  23920000
239300                ' FOR RTLAMT'                                     23930000
239400              DELIMITED BY SIZE                                   23940000
239500                   INTO PV-CICS-MSG-AREA                          23950000
239600         PERFORM 9200-WRITE-TO-CICS-LOG                           23960000
239700     END-IF.                                                      23970000
239800                                                                  23980000
239900******************************************************************23990000
240000** GATHER VARIOUS TRIP SPECIFICS FOR THE TRIP THAT IS PASSED IN **24000000
240100******************************************************************24010000
240200 2000-GET-TRIP-INFO.                                              24020000
240300                                                                  24030000
240400** GET SCAC, VEHICLE_NBR & ETA_DATE FROM TVHTRIP                  24040000
240500     PERFORM 2100-GET-SCAC.                                       24050000
240600                                                                  24060000
240700** GET DISTINCT PRO_NBR FROM TSHIPMT                              24070000
240800     PERFORM 2200-GET-PRO-NBR.                                    24080000
240900                                                                  24090000
241000** GET OPER_UNT_ID FROM TTRIPST                                   24100000
241100     PERFORM 2300-GET-OPER-UNT-ID.                                24110000
241200                                                                  24120000
241300******************************************************************24130000
241400** THE STD DB2 TMST MUST BE REFORMATTED TO 14 CHAR.             **24140000
241500** SO PV-ETA-REFORMATTED IS CCYYMMDDHHMMSS                      **24150000
241600******************************************************************24160000
241700 2100-GET-SCAC.                                                   24170000
241800                                                                  24180000
241900     INITIALIZE VHTRIP-OWNER-SCAC-ID                              24190000
242000                VHTRIP-VEH-NBR                                    24200000
242100                VHTRIP-EST-AR-TMST                                24210000
242200                PV-ETA-REFORMATTED.                               24220000
242300                                                                  24230000
242400     EXEC SQL                                                     24240000
242500        SELECT   OWNER_SCAC_ID                                    24250000
242600               , VEH_NBR                                          24260000
242700               , EST_AR_TMST                                      24270000
242800          INTO  :VHTRIP-OWNER-SCAC-ID                             24280000
242900               ,:VHTRIP-VEH-NBR                                   24290000
243000               ,:VHTRIP-EST-AR-TMST                               24300000
243100          FROM TVHTRIP                                            24310004
243200         WHERE TRIP_ID = :DK-TRIP-ID                              24320000
243210          WITH UR                                                 24321008
243300     END-EXEC                                                     24330000
243400                                                                  24340000
243500     EVALUATE TRUE                                                24350000
243600         WHEN SQLCODE = ZERO                                      24360000
243700              MOVE VHTRIP-EST-AR-TMST (1:4)                       24370000
243800                TO PV-ETA-REFORMATTED (1:4)                       24380000
243900                                                                  24390000
244000              MOVE VHTRIP-EST-AR-TMST (6:2)                       24400000
244100                TO PV-ETA-REFORMATTED (5:2)                       24410000
244200                                                                  24420000
244300              MOVE VHTRIP-EST-AR-TMST (9:2)                       24430000
244400                TO PV-ETA-REFORMATTED (7:2)                       24440000
244500                                                                  24450000
244600              MOVE VHTRIP-EST-AR-TMST (12:2)                      24460000
244700                TO PV-ETA-REFORMATTED (9:2)                       24470000
244800                                                                  24480000
244900              MOVE VHTRIP-EST-AR-TMST (15:2)                      24490000
245000                TO PV-ETA-REFORMATTED (11:2)                      24500000
245100                                                                  24510000
245200              MOVE VHTRIP-EST-AR-TMST (18:2)                      24520000
245300                TO PV-ETA-REFORMATTED (13:2)                      24530000
245400                                                                  24540000
245500         IF PS-WRITE-TO-CSSL-YES                                  24550000
245600          AND SQLCODE = 0                                         24560000
245700              STRING ' ' WS003-SRC-TASK-NUMBER                    24570000
245800                     ' WSKCS301-2100: GET-SCAC'                   24580000
245900                     ' PV-ETA-REFORMATTED:'                       24590000
246000                     PV-ETA-REFORMATTED                           24600000
246100              DELIMITED BY SIZE                                   24610000
246200              INTO PV-CICS-MSG-AREA                               24620000
246300              PERFORM 9200-WRITE-TO-CICS-LOG                      24630000
246400         END-IF                                                   24640000
246500                                                                  24650000
246600         WHEN SQLCODE = -305                                      24660001
246601              PERFORM 2110-EST-AR-TMST-PROCESS                    24660102
246602                                                                  24660202
246610         WHEN SQLCODE = +100                                      24661001
246700              CONTINUE                                            24670000
246800         WHEN SQLWARN0 NOT = SPACES                               24680000
246900         WHEN SQLCODE NOT = ZERO                                  24690000
247000         WHEN SQLCODE NOT = +100                                  24700000
247100             SET  PS-ERROR         TO TRUE                        24710000
247200             MOVE SQLCODE            TO PV-DISP-SQLCODE           24720000
247300             STRING ' ' WS003-SRC-TASK-NUMBER                     24730000
247400                    ' WSKCS301-2100: GET-SCAC'                    24740000
247500                    ' CALLED BY-'                                 24750000
247600                     WS003-CALLING-PROGRAM-NAME                   24760000
247700                    ' SQLCODE='                                   24770000
247800                     PV-DISP-SQLCODE                              24780000
247900                    ' SUCC='                                      24790000
248000                     WS003-SUCCESS-IND                            24800000
248100             DELIMITED BY SIZE                                    24810000
248200             INTO PV-CICS-MSG-AREA                                24820000
248300             PERFORM 9200-WRITE-TO-CICS-LOG                       24830000
248400             MOVE '2100-GET-SCAC'                                 24840000
248500                              TO DP013-PARAGRAPH                  24850000
248600             MOVE 'SELECT TVHTRIP'                                24860000
248700                              TO DP013-MESSAGE-TEXT (1)           24870000
248800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  24880000
248900             STRING ' TRIP ID: '                                  24890000
249000                    PV-DISP-TRIP-ID                               24900000
249100                    ' EXT SHIP ID: '                              24910000
249200                    DK-EXT-SHP-ID                                 24920000
249300                    ' DWNLD TMST: '                               24930000
249400                    PV-CURRENT-TMST                               24940000
249500             DELIMITED BY SIZE                                    24950000
249600             INTO DP013-MESSAGE-TEXT (2)                          24960000
249700             MOVE 'TVHTRIP '  TO DP013-DB2-TABLE-NAME (1)         24970000
249800             MOVE SQLCA       TO DP013-SQLCA                      24980000
249900             SET DP013-DB2-ABEND  TO TRUE                         24990000
250000             PERFORM 9999-ABEND                                   25000000
250100     END-EVALUATE.                                                25010000
250200                                                                  25020000
250300     IF PS-WRITE-TO-CSSL-YES                                      25030000
250400      AND SQLCODE = 0                                             25040000
250500         STRING ' ' WS003-SRC-TASK-NUMBER                         25050000
250600                ' ' PV-DISP-EXT-SHP-ID (1:10)                     25060000
250700                ' WSKCS301-2100: GET-SCAC'                        25070000
250800                ' SCAC:'                                          25080000
250900                 VHTRIP-OWNER-SCAC-ID                             25090000
251000                ' VHTRIP VEH-NBR :'                               25100000
251100                 VHTRIP-VEH-NBR                                   25110000
251200         DELIMITED BY SIZE                                        25120000
251300         INTO PV-CICS-MSG-AREA                                    25130000
251400         PERFORM 9200-WRITE-TO-CICS-LOG                           25140000
251500     END-IF.                                                      25150000
251600                                                                  25160000
251601******************************************************************25160102
251602** TVHTRIP ETA-AR-TMST IS NULLS - STEPS TO POPULATE TMST        **25160202
251603**   1.  SELECT CURRENT TVHTRIP FIELDS & CURRENT TIMESTAMP      **25160302
251604**       INTO THE TRIP AUDIT TABLE FIELDS                       **25160402
251605**   2.  UPDATE TVHTRIP ETA-AR-TMST WITH CURRENT TIMESTAMP      **25160502
251606**   3.  WRITE AUDIT ROW TO TAUTRIP TABLE                       **25160602
251607**                                                              **25160702
251610******************************************************************25161002
251611 2110-EST-AR-TMST-PROCESS.                                        25161102
251612                                                                  25161203
251647     INITIALIZE AUTRIP-OWNER-SCAC-ID                              25164702
251648                AUTRIP-VEH-NBR                                    25164802
251649                AUTRIP-TRIP-ID                                    25164902
251650                AUTRIP-TRIP-BEG-DTE                               25165002
251651                AUTRIP-TRIP-BEG-TME                               25165102
251652                AUTRIP-CRT-SRC-CDE                                25165202
251653                AUTRIP-LAST-UPD-DTE                               25165302
251654                AUTRIP-LAST-UPD-TME                               25165402
251655                AUTRIP-LAST-UPD-UID                               25165502
251656                AUTRIP-MANIFEST-NBR                               25165602
251657                AUTRIP-PLND-TRIP-SEQ                              25165702
251658                AUTRIP-PLND-ACTVY-CDE                             25165802
251659                AUTRIP-REF-TRIP-ID                                25165902
251660                AUTRIP-EST-AR-TMST                                25166002
251661                AUTRIP-OWNR-SCAC-SHIP-DTE                         25166102
251662                AUTRIP-AUD-STATUS-CDE                             25166202
251663                AUTRIP-SPLT-XMIT-IND                              25166302
251664                AUTRIP-SPLT-XMIT-DTE                              25166402
251665                AUTRIP-SPLT-XMIT-TM.                              25166502
251681                                                                  25168102
251682     EXEC SQL                                                     25168202
251683        SELECT   A.OWNER_SCAC_ID                                  25168303
251684               , A.VEH_NBR                                        25168403
251685               , A.TRIP_ID                                        25168503
251686               , A.TRIP_BEG_DTE                                   25168603
251687               , A.TRIP_BEG_TME                                   25168703
251688               , A.CRT_SRC_CDE                                    25168803
251689               , CURRENT DATE                                     25168906
251690               , CURRENT TIME                                     25169006
251691               , 'WSKCS301'                                       25169103
251692               , A.MANIFEST_NBR                                   25169203
251693               , A.PLND_TRIP_SEQ                                  25169303
251694               , A.PLND_ACTVY_CDE                                 25169403
251695               , A.OWNR_SCAC_SHIP_DTE                             25169503
251696               , A.REF_TRIP_ID                                    25169603
251697               , CURRENT TIMESTAMP                                25169706
251698               , B.TRIP_STATUS_CDE                                25169803
251699               , A.SPLT_XMIT_IND                                  25169903
251700               , A.SPLT_XMIT_DTE                                  25170003
251701               , A.SPLT_XMIT_TM                                   25170103
251708          INTO  :AUTRIP-OWNER-SCAC-ID                             25170802
251709               ,:AUTRIP-VEH-NBR                                   25170902
251710               ,:AUTRIP-TRIP-ID                                   25171002
251711               ,:AUTRIP-TRIP-BEG-DTE                              25171102
251712               ,:AUTRIP-TRIP-BEG-TME                              25171202
251713               ,:AUTRIP-CRT-SRC-CDE                               25171302
251714               ,:AUTRIP-LAST-UPD-DTE                              25171402
251715               ,:AUTRIP-LAST-UPD-TME                              25171502
251716               ,:AUTRIP-LAST-UPD-UID                              25171602
251717               ,:AUTRIP-MANIFEST-NBR                              25171702
251718               ,:AUTRIP-PLND-TRIP-SEQ                             25171802
251719               ,:AUTRIP-PLND-ACTVY-CDE                            25171902
251720               ,:AUTRIP-OWNR-SCAC-SHIP-DTE                        25172003
251721               ,:AUTRIP-REF-TRIP-ID                               25172102
251722               ,:AUTRIP-EST-AR-TMST                               25172202
251724               ,:AUTRIP-AUD-STATUS-CDE                            25172403
251725               ,:AUTRIP-SPLT-XMIT-IND                             25172502
251726               ,:AUTRIP-SPLT-XMIT-DTE                             25172602
251727               ,:AUTRIP-SPLT-XMIT-TM                              25172702
251728          FROM TVHTRIP A                                          25172803
251729             , TTRIPST B                                          25172903
251730             , TTRSTYP C                                          25173003
251731         WHERE A.TRIP_ID = :DK-TRIP-ID                            25173103
251732           AND A.TRIP_ID =  B.TRIP_ID                             25173203
251733           AND B.TRIP_STATUS_CDE  =  C.TRIP_STATUS_CDE            25173303
251734           AND C.PRTY_CDE  IN                                     25173403
251735               (SELECT MAX(CC.PRTY_CDE)                           25173503
251736                  FROM TTRIPST BB                                 25173603
251737                     , TTRSTYP CC                                 25173703
251738                 WHERE B.TRIP_ID  =  BB.TRIP_ID                   25173806
251739                   AND BB.TRIP_STATUS_CDE  =  CC.TRIP_STATUS_CDE) 25173903
251740          WITH UR                                                 25174008
251741     END-EXEC                                                     25174103
251742                                                                  25174203
251743     EVALUATE TRUE                                                25174303
251744         WHEN SQLCODE = ZERO                                      25174403
251745              MOVE AUTRIP-EST-AR-TMST TO VHTRIP-EST-AR-TMST       25174503
251746                                                                  25174603
251747              MOVE VHTRIP-EST-AR-TMST (1:4)                       25174703
251748                TO PV-ETA-REFORMATTED (1:4)                       25174803
251749                                                                  25174903
251750              MOVE VHTRIP-EST-AR-TMST (6:2)                       25175003
251751                TO PV-ETA-REFORMATTED (5:2)                       25175103
251752                                                                  25175203
251753              MOVE VHTRIP-EST-AR-TMST (9:2)                       25175303
251754                TO PV-ETA-REFORMATTED (7:2)                       25175403
251755                                                                  25175503
251756              MOVE VHTRIP-EST-AR-TMST (12:2)                      25175603
251757                TO PV-ETA-REFORMATTED (9:2)                       25175703
251758                                                                  25175803
251759              MOVE VHTRIP-EST-AR-TMST (15:2)                      25175903
251760                TO PV-ETA-REFORMATTED (11:2)                      25176003
251761                                                                  25176103
251762              MOVE VHTRIP-EST-AR-TMST (18:2)                      25176203
251763                TO PV-ETA-REFORMATTED (13:2)                      25176303
251764                                                                  25176403
251765         IF PS-WRITE-TO-CSSL-YES                                  25176503
251766          AND SQLCODE = 0                                         25176603
251767              STRING ' ' WS003-SRC-TASK-NUMBER                    25176703
251768                     ' WSKCS301-2110-EST-AR-TMST-PROCESS'         25176803
251769                     ' PV-ETA-REFORMATTED:'                       25176903
251770                     PV-ETA-REFORMATTED                           25177003
251771              DELIMITED BY SIZE                                   25177103
251772              INTO PV-CICS-MSG-AREA                               25177203
251773              PERFORM 9200-WRITE-TO-CICS-LOG                      25177303
251774         END-IF                                                   25177403
251775                                                                  25177503
251776         PERFORM 2120-UPDATE-TVHTRIP-EST-AR                       25177603
251778                                                                  25177803
251779         WHEN SQLCODE = +100                                      25177903
251780              CONTINUE                                            25178003
251781         WHEN SQLWARN0 NOT = SPACES                               25178103
251782         WHEN SQLCODE NOT = ZERO                                  25178203
251783         WHEN SQLCODE NOT = +100                                  25178303
251784             SET  PS-ERROR         TO TRUE                        25178403
251785             MOVE SQLCODE            TO PV-DISP-SQLCODE           25178503
251786             STRING ' ' WS003-SRC-TASK-NUMBER                     25178603
251787                    ' WSKCS301-2110-EST-AR-TMST-PROCESS '         25178703
251788                    ' CALLED BY-'                                 25178803
251789                     WS003-CALLING-PROGRAM-NAME                   25178903
251790                    ' SQLCODE='                                   25179003
251791                     PV-DISP-SQLCODE                              25179103
251792                    ' SUCC='                                      25179203
251793                     WS003-SUCCESS-IND                            25179303
251794             DELIMITED BY SIZE                                    25179403
251795             INTO PV-CICS-MSG-AREA                                25179503
251796             PERFORM 9200-WRITE-TO-CICS-LOG                       25179603
251797             MOVE '2110-EST-AR-TMST-PROCESS'                      25179703
251798                              TO DP013-PARAGRAPH                  25179803
251799             MOVE 'SELECT TVHTRIP'                                25179903
251800                              TO DP013-MESSAGE-TEXT (1)           25180003
251801             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  25180103
251802             STRING ' TRIP ID: '                                  25180203
251803                    PV-DISP-TRIP-ID                               25180303
251804                    ' EXT SHIP ID: '                              25180403
251805                    DK-EXT-SHP-ID                                 25180503
251806                    ' DWNLD TMST: '                               25180603
251807                    PV-CURRENT-TMST                               25180703
251808             DELIMITED BY SIZE                                    25180803
251809             INTO DP013-MESSAGE-TEXT (2)                          25180903
251810             MOVE 'TVHTRIP '  TO DP013-DB2-TABLE-NAME (1)         25181003
251811             MOVE SQLCA       TO DP013-SQLCA                      25181103
251812             SET DP013-DB2-ABEND  TO TRUE                         25181203
251813             PERFORM 9999-ABEND                                   25181303
251814     END-EVALUATE.                                                25181403
251815                                                                  25181503
251816     IF PS-WRITE-TO-CSSL-YES                                      25181603
251817      AND SQLCODE = 0                                             25181703
251818         STRING ' ' WS003-SRC-TASK-NUMBER                         25181803
251819                ' ' PV-DISP-EXT-SHP-ID (1:10)                     25181903
251820                ' WSKCS301-2110-EST-AR-TMST-PROCESS'              25182003
251821                ' SCAC:'                                          25182103
251822                 VHTRIP-OWNER-SCAC-ID                             25182203
251823                ' VHTRIP VEH-NBR :'                               25182303
251824                 VHTRIP-VEH-NBR                                   25182403
251825         DELIMITED BY SIZE                                        25182503
251826         INTO PV-CICS-MSG-AREA                                    25182603
251827         PERFORM 9200-WRITE-TO-CICS-LOG                           25182703
251828     END-IF.                                                      25182803
251829                                                                  25182903
251830                                                                  25183003
251831                                                                  25183103
251832******************************************************************25183203
251833**                                                              **25183303
251834******************************************************************25183403
251835 2120-UPDATE-TVHTRIP-EST-AR.                                      25183503
251836                                                                  25183603
251837     EXEC SQL                                                     25183703
251838          UPDATE TVHTRIP                                          25183803
251839            SET  EST_AR_TMST  = :VHTRIP-EST-AR-TMST               25183903
251840              ,  LAST_UPD_DTE = :AUTRIP-LAST-UPD-DTE              25184003
251841              ,  LAST_UPD_TME = :AUTRIP-LAST-UPD-TME              25184103
251842              ,  LAST_UPD_UID = :AUTRIP-LAST-UPD-UID              25184203
251843           WHERE TRIP_ID      = :DK-TRIP-ID                       25184305
251844     END-EXEC                                                     25184403
251845                                                                  25184503
251846     EVALUATE TRUE                                                25184603
251847         WHEN SQLCODE = ZERO                                      25184703
251848              PERFORM 2130-INSERT-TAUTRIP-EST-AR                  25184803
251849                                                                  25184903
251850         WHEN SQLWARN0 NOT = SPACES                               25185003
251851         WHEN SQLCODE NOT = ZERO                                  25185103
251852              SET  PS-ERROR         TO TRUE                       25185203
251853              MOVE SQLCODE            TO PV-DISP-SQLCODE          25185303
251854              STRING ' ' WS003-SRC-TASK-NUMBER                    25185403
251855                     ' WSKCS301-2120-UPDATE-TVHTRIP-EST-AR'       25185503
251856                     ' CALLED BY-'                                25185603
251857                      WS003-CALLING-PROGRAM-NAME                  25185703
251858                     ' SQLCODE='                                  25185803
251859                      PV-DISP-SQLCODE                             25185903
251860                     ' SUCC='                                     25186003
251861                      WS003-SUCCESS-IND                           25186103
251862              DELIMITED BY SIZE                                   25186203
251863              INTO PV-CICS-MSG-AREA                               25186303
251864              PERFORM 9200-WRITE-TO-CICS-LOG                      25186403
251865              MOVE '2120-UPDATE-TVHTRIP-EST-AR'                   25186503
251866                               TO DP013-PARAGRAPH                 25186603
251867              MOVE 'UPDATE TVHTRIP           '                    25186703
251868                               TO DP013-MESSAGE-TEXT (1)          25186803
251869              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 25186903
251870              STRING ' TRIP ID: '                                 25187003
251871                     PV-DISP-TRIP-ID                              25187103
251872                     ' EXT SHIP ID: '                             25187203
251873                     DK-EXT-SHP-ID                                25187303
251874                     ' DWNLD TMST: '                              25187403
251875                     VHTRIP-EST-AR-TMST                           25187503
251876              DELIMITED BY SIZE                                   25187603
251877              INTO DP013-MESSAGE-TEXT (2)                         25187703
251878              MOVE 'TVHTRIP '  TO DP013-DB2-TABLE-NAME (1)        25187803
251879              MOVE SQLCA       TO DP013-SQLCA                     25187903
251880              SET DP013-DB2-ABEND  TO TRUE                        25188003
251881              PERFORM 9999-ABEND                                  25188103
251882     END-EVALUATE.                                                25188203
251883                                                                  25188303
251884     IF PS-WRITE-TO-CSSL-YES                                      25188403
251885         STRING   ' ' WS003-SRC-TASK-NUMBER                       25188503
251886                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   25188603
251887                  ' WSKCS301-2120: UPD-EST-AR-TMST   '            25188703
251888                  ' TVHTRIP UPDATE EST_AR_TMST       '            25188803
251889         DELIMITED BY SIZE                                        25188903
251890         INTO PV-CICS-MSG-AREA                                    25189003
251891         PERFORM 9200-WRITE-TO-CICS-LOG                           25189103
251892     END-IF.                                                      25189203
251893                                                                  25189303
251894                                                                  25189403
251895******************************************************************25189503
251896**                                                              **25189603
251897******************************************************************25189703
251898 2130-INSERT-TAUTRIP-EST-AR.                                      25189803
251903                                                                  25190303
251904     EXEC SQL                                                     25190403
251905         INSERT  INTO TAUTRIP                                     25190503
251906                (OWNER_SCAC_ID                                    25190603
251907                ,VEH_NBR                                          25190703
251908                ,TRIP_ID                                          25190803
251909                ,TRIP_BEG_DTE                                     25190903
251910                ,TRIP_BEG_TME                                     25191003
251911                ,CRT_SRC_CDE                                      25191103
251912                ,LAST_UPD_DTE                                     25191203
251913                ,LAST_UPD_TME                                     25191303
251914                ,LAST_UPD_UID                                     25191403
251915                ,MANIFEST_NBR                                     25191503
251916                ,PLND_TRIP_SEQ                                    25191603
251917                ,PLND_ACTVY_CDE                                   25191703
251918                ,OWNR_SCAC_SHIP_DTE                               25191803
251919                ,REF_TRIP_ID                                      25191903
251920                ,EST_AR_TMST                                      25192003
251921                ,AUD_STATUS_CDE                                   25192103
251922                ,SPLT_XMIT_IND                                    25192203
251923                ,SPLT_XMIT_DTE                                    25192303
251924                ,SPLT_XMIT_TM)                                    25192403
251925        VALUES  (:AUTRIP-OWNER-SCAC-ID                            25192503
251926                ,:AUTRIP-VEH-NBR                                  25192603
251928                ,:AUTRIP-TRIP-ID                                  25192803
251929                ,:AUTRIP-TRIP-BEG-DTE                             25192903
251930                ,:AUTRIP-TRIP-BEG-TME                             25193003
251931                ,:AUTRIP-CRT-SRC-CDE                              25193103
251932                ,:AUTRIP-LAST-UPD-DTE                             25193203
251933                ,:AUTRIP-LAST-UPD-TME                             25193303
251934                ,:AUTRIP-LAST-UPD-UID                             25193403
251935                ,:AUTRIP-MANIFEST-NBR                             25193503
251936                ,:AUTRIP-PLND-TRIP-SEQ                            25193603
251937                ,:AUTRIP-PLND-ACTVY-CDE                           25193703
251938                ,:AUTRIP-OWNR-SCAC-SHIP-DTE                       25193803
251939                ,:AUTRIP-REF-TRIP-ID                              25193903
251940                ,:AUTRIP-EST-AR-TMST                              25194003
251942                ,:AUTRIP-AUD-STATUS-CDE                           25194207
251943                ,:AUTRIP-SPLT-XMIT-IND                            25194303
251944                ,:AUTRIP-SPLT-XMIT-DTE                            25194403
251945                ,:AUTRIP-SPLT-XMIT-TM)                            25194503
251946     END-EXEC.                                                    25194603
251947                                                                  25194703
251948     EVALUATE TRUE                                                25194803
251949         WHEN SQLCODE = +0                                        25194903
251952             CONTINUE                                             25195203
251953                                                                  25195303
251954         WHEN SQLWARN0 NOT = SPACES                               25195403
251955         WHEN SQLCODE NOT = ZERO                                  25195503
251956              SET  PS-ERROR         TO TRUE                       25195603
251957              MOVE SQLCODE            TO PV-DISP-SQLCODE          25195703
251958              STRING ' ' WS003-SRC-TASK-NUMBER                    25195803
251959                     ' WSKCS301-2130-INSERT-TAUTRIP-EST-AR'       25195903
251960                     ' CALLED BY-'                                25196003
251961                      WS003-CALLING-PROGRAM-NAME                  25196103
251962                     ' SQLCODE='                                  25196203
251963                      PV-DISP-SQLCODE                             25196303
251964                     ' SUCC='                                     25196403
251965                      WS003-SUCCESS-IND                           25196503
251966              DELIMITED BY SIZE                                   25196603
251967              INTO PV-CICS-MSG-AREA                               25196703
251968              PERFORM 9200-WRITE-TO-CICS-LOG                      25196803
251969              MOVE '2130-INSERT-TAUTRIP-EST-AR'                   25196903
251970                               TO DP013-PARAGRAPH                 25197003
251971              MOVE 'INSERT TAUTRIP           '                    25197103
251972                               TO DP013-MESSAGE-TEXT (1)          25197203
251973              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 25197303
251974              STRING ' TRIP ID: '                                 25197403
251975                     PV-DISP-TRIP-ID                              25197503
251976                     ' EXT SHIP ID: '                             25197603
251977                     DK-EXT-SHP-ID                                25197703
251978                     ' EST AR TMST: '                             25197803
251979                     VHTRIP-EST-AR-TMST                           25197903
251980              DELIMITED BY SIZE                                   25198003
251981              INTO DP013-MESSAGE-TEXT (2)                         25198103
251982              MOVE 'TAUTRIP '  TO DP013-DB2-TABLE-NAME (1)        25198203
251983              MOVE SQLCA       TO DP013-SQLCA                     25198303
251984              SET DP013-DB2-ABEND  TO TRUE                        25198403
251985              PERFORM 9999-ABEND                                  25198503
251986     END-EVALUATE.                                                25198603
251987                                                                  25198703
251988     IF PS-WRITE-TO-CSSL-YES                                      25198803
251989         STRING   ' ' WS003-SRC-TASK-NUMBER                       25198903
251990                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   25199003
251991                  ' WSKCS301-2130-INSERT-TAUTRIP-EST-AR'          25199103
251992                  ' TAUTRIP INSERT EST_AR_TMST       '            25199203
251993         DELIMITED BY SIZE                                        25199303
251994         INTO PV-CICS-MSG-AREA                                    25199403
251995         PERFORM 9200-WRITE-TO-CICS-LOG                           25199503
251996     END-IF.                                                      25199603
251997                                                                  25199703
252018                                                                  25201803
252019                                                                  25201903
252020******************************************************************25202003
252021**                                                              **25202102
252022******************************************************************25202200
252030 2200-GET-PRO-NBR.                                                25203000
252100                                                                  25210000
252200     INITIALIZE SHIPMT-PRO-NBR.                                   25220000
252300                                                                  25230000
252400     EXEC SQL                                                     25240000
252500        SELECT DISTINCT(PRO_NBR)                                  25250000
252600          INTO  :SHIPMT-PRO-NBR                                   25260000
252700          FROM TSHIPMT                                            25270000
252800         WHERE TRIP_ID = :DK-TRIP-ID                              25280000
252810          WITH UR                                                 25281008
252900     END-EXEC.                                                    25290000
253000                                                                  25300000
253100     EVALUATE TRUE                                                25310000
253200         WHEN SQLCODE = ZERO                                      25320000
253300         WHEN SQLCODE = +100                                      25330000
253400         WHEN SQLCODE = -811                                      25340000
253500              CONTINUE                                            25350000
253600         WHEN SQLWARN0 NOT = SPACES                               25360000
253700         WHEN SQLCODE NOT = ZERO                                  25370000
253800         WHEN SQLCODE NOT = +100                                  25380000
253900         WHEN SQLCODE NOT = -811                                  25390000
254000              SET  PS-ERROR         TO TRUE                       25400000
254100              MOVE SQLCODE            TO PV-DISP-SQLCODE          25410000
254200              STRING ' ' WS003-SRC-TASK-NUMBER                    25420000
254300                     ' WSKCS301-2200: GET-PRO-NBR'                25430000
254400                     ' CALLED BY-'                                25440000
254500                      WS003-CALLING-PROGRAM-NAME                  25450000
254600                     ' SQLCODE='                                  25460000
254700                      PV-DISP-SQLCODE                             25470000
254800                     ' SUCC='                                     25480000
254900                      WS003-SUCCESS-IND                           25490000
255000              DELIMITED BY SIZE                                   25500000
255100              INTO PV-CICS-MSG-AREA                               25510000
255200              PERFORM 9200-WRITE-TO-CICS-LOG                      25520000
255300              MOVE '2200-GET-PRO-NBR'                             25530000
255400                               TO DP013-PARAGRAPH                 25540000
255500              MOVE 'SELECT TSHIPMT'                               25550000
255600                               TO DP013-MESSAGE-TEXT (1)          25560000
255700              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 25570000
255800              STRING ' TRIP ID: '                                 25580000
255900                     PV-DISP-TRIP-ID                              25590000
256000                     ' EXT SHIP ID: '                             25600000
256100                     DK-EXT-SHP-ID                                25610000
256200                     ' DWNLD TMST: '                              25620000
256300                     PV-CURRENT-TMST                              25630000
256400              DELIMITED BY SIZE                                   25640000
256500              INTO DP013-MESSAGE-TEXT (2)                         25650000
256600              MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (1)        25660000
256700              MOVE SQLCA       TO DP013-SQLCA                     25670000
256800              SET DP013-DB2-ABEND  TO TRUE                        25680000
256900              PERFORM 9999-ABEND                                  25690000
257000     END-EVALUATE.                                                25700000
257100                                                                  25710000
257200     IF PS-WRITE-TO-CSSL-YES                                      25720000
257300      AND SQLCODE = 0                                             25730000
257400         STRING ' ' WS003-SRC-TASK-NUMBER                         25740000
257500                ' ' PV-DISP-EXT-SHP-ID (1:10)                     25750000
257600                ' WSKCS301-2200: GET-PRO-NBR'                     25760000
257700                ' PRO NBR:'                                       25770000
257800                 SHIPMT-PRO-NBR                                   25780000
257900         DELIMITED BY SIZE                                        25790000
258000         INTO PV-CICS-MSG-AREA                                    25800000
258100         PERFORM 9200-WRITE-TO-CICS-LOG                           25810000
258200     END-IF.                                                      25820000
258300                                                                  25830000
258400******************************************************************25840000
258500**                                                              **25850000
258600******************************************************************25860000
258700 2300-GET-OPER-UNT-ID.                                            25870000
258800                                                                  25880000
258900     INITIALIZE TRIPST-OPER-UNT-ID.                               25890000
259000                                                                  25900000
259100     EXEC SQL                                                     25910000
259200        SELECT OPER_UNT_ID                                        25920000
259300               , A.STATUS_TME                                     25930000
259400               , A.STATUS_DTE                                     25940000
259500         INTO   :TRIPST-OPER-UNT-ID                               25950000
259600               ,:TRIPST-STATUS-TME                                25960000
259700               ,:TRIPST-STATUS-DTE                                25970000
259800            FROM TTRIPST A                                        25980000
259900           WHERE TRIP_ID = :DK-TRIP-ID                            25990000
260000            AND A.STATUS_TME =                                    26000000
260100                  (SELECT MAX(F.STATUS_TME)                       26010000
260200                   FROM   TTRIPST F                               26020000
260300                  WHERE A.TRIP_ID       = F.TRIP_ID               26030000
260400                   AND F.STATUS_DTE =                             26040000
260500                  (SELECT MAX(D.STATUS_DTE)                       26050000
260600                   FROM   TTRIPST D                               26060000
260700                   WHERE A.TRIP_ID       = D.TRIP_ID))            26070000
260710           WITH UR                                                26071008
260800     END-EXEC                                                     26080000
260900                                                                  26090000
261000     EVALUATE TRUE                                                26100000
261100         WHEN SQLCODE = ZERO                                      26110000
261200              MOVE TRIPST-OPER-UNT-ID                             26120000
261300                TO PV-OPER-UNT-ID-PIC9                            26130000
261400         WHEN SQLCODE = +100                                      26140000
261500              CONTINUE                                            26150000
261600         WHEN SQLWARN0 NOT = SPACES                               26160000
261700         WHEN SQLCODE NOT = ZERO                                  26170000
261800         WHEN SQLCODE NOT = +100                                  26180000
261900             SET  PS-ERROR         TO TRUE                        26190000
262000             MOVE SQLCODE            TO PV-DISP-SQLCODE           26200000
262100             STRING ' ' WS003-SRC-TASK-NUMBER                     26210000
262200                    ' WSKCS301-2300: GET-OPER-UNT-ID'             26220000
262300                    ' CALLED BY-'                                 26230000
262400                     WS003-CALLING-PROGRAM-NAME                   26240000
262500                    ' SQLCODE='                                   26250000
262600                     PV-DISP-SQLCODE                              26260000
262700                    ' SUCC='                                      26270000
262800                     WS003-SUCCESS-IND                            26280000
262900             DELIMITED BY SIZE                                    26290000
263000             INTO PV-CICS-MSG-AREA                                26300000
263100             PERFORM 9200-WRITE-TO-CICS-LOG                       26310000
263200             MOVE '2300-GET-OPER-UNT-ID'                          26320000
263300                              TO DP013-PARAGRAPH                  26330000
263400             MOVE 'SELECT TTRIPST'                                26340000
263500                              TO DP013-MESSAGE-TEXT (1)           26350000
263600             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  26360000
263700             STRING ' TRIP ID: '                                  26370000
263800                    PV-DISP-TRIP-ID                               26380000
263900                    ' EXT SHIP ID: '                              26390000
264000                    DK-EXT-SHP-ID                                 26400000
264100                    ' DWNLD TMST: '                               26410000
264200                    PV-CURRENT-TMST                               26420000
264300             DELIMITED BY SIZE                                    26430000
264400             INTO DP013-MESSAGE-TEXT (2)                          26440000
264500             MOVE 'TTRIPST '  TO DP013-DB2-TABLE-NAME (1)         26450000
264600             MOVE SQLCA       TO DP013-SQLCA                      26460000
264700             SET DP013-DB2-ABEND  TO TRUE                         26470000
264800             PERFORM 9999-ABEND                                   26480000
264900     END-EVALUATE.                                                26490000
265000                                                                  26500000
265100     IF PS-WRITE-TO-CSSL-YES                                      26510000
265200      AND SQLCODE = 0                                             26520000
265300         STRING ' ' WS003-SRC-TASK-NUMBER                         26530000
265400                ' ' PV-DISP-EXT-SHP-ID (1:10)                     26540000
265500                ' WSKCS301-2300: GET-OPER-ID'                     26550000
265600                ' OPER UNT ID:'                                   26560000
265700                 PV-OPER-UNT-ID-PIC9                              26570000
265800         DELIMITED BY SIZE                                        26580000
265900         INTO PV-CICS-MSG-AREA                                    26590000
266000         PERFORM 9200-WRITE-TO-CICS-LOG                           26600000
266100     END-IF.                                                      26610000
266200                                                                  26620000
266300******************************************************************26630000
266400** THIS DETERMINES WHAT GETS DOWNLOADED TO WST_ASN_DWNLD        **26640000
266500******************************************************************26650000
266600 2400-CHECK-INTEGRATION-TYP.                                      26660000
266700                                                                  26670000
266800     INITIALIZE WST00010-ATTR-ELEM-TXT-TEXT.                      26680000
266900                                                                  26690000
267000     EXEC SQL                                                     26700000
267100         SELECT A.INTGRTN_TYP_CDE                                 26710000
267200              , A.INTGRTN_TYP_DESC                                26720000
267300              , A.APPL_FUNC_DESC                                  26730000
267400              , B.ATTR_ELEM_TXT                                   26740000
267500          INTO :WST00008-INTGRTN-TYP-CDE                          26750000
267600              ,:WST00008-INTGRTN-TYP-DESC                         26760000
267700              ,:WST00008-APPL-FUNC-DESC                           26770000
267800              ,:WST00010-ATTR-ELEM-TXT                            26780000
267900          FROM  WST_INTGRTN_TYP   A                               26790000
268000              , WST_ATTR_ELEM     B                               26800000
268100              , WST_ATTR_DEFN     C                               26810000
268200         WHERE  A.APPL_FUNC_DESC     = :PC-APPL-FUNC-DESC         26820000
268300         AND    A.INTGRTN_TYP_CDE    = B.INTGRTN_TYP_CDE          26830000
268400         AND    A.INTGRTN_TYP_CDE    = C.INTGRTN_TYP_CDE          26840000
268500         AND    C.ATTR_DEFN_SEQ_NBR  = :PC-ATTR-DEFN-SEQ-NBR      26850000
268600         AND    A.INTGRTN_TYP_CDE    = :PC-INTGRTN-TYP-CDE        26860000
268610         WITH UR                                                  26861008
268700     END-EXEC                                                     26870000
268800                                                                  26880000
268900     EVALUATE TRUE                                                26890000
269000         WHEN SQLCODE = ZERO                                      26900000
269100              EVALUATE TRUE                                       26910000
269200                 WHEN WST00010-ATTR-ELEM-TXT-TEXT = PC-D          26920000
269300                      SET PS-WRITE-ALL-TO-TEMP      TO TRUE       26930000
269400                      PERFORM 2450-PREP-DAT-CNTL-TBLS             26940000
269500                 WHEN WST00010-ATTR-ELEM-TXT-TEXT = PC-H          26950000
269600                      SET PS-WRITE-HDR-ONLY-TO-TEMP TO TRUE       26960000
269700                      PERFORM 2450-PREP-DAT-CNTL-TBLS             26970000
269800                 WHEN WST00010-ATTR-ELEM-TXT-TEXT = PC-N          26980000
269900                      SET PS-WRITE-NOTHING-TO-TEMP  TO TRUE       26990000
270000              END-EVALUATE                                        27000000
270100         WHEN SQLWARN0 NOT = SPACES                               27010000
270200         WHEN SQLCODE NOT = ZERO                                  27020000
270300             SET  PS-ERROR         TO TRUE                        27030000
270400             MOVE SQLCODE            TO PV-DISP-SQLCODE           27040000
270500             STRING ' ' WS003-SRC-TASK-NUMBER                     27050000
270600                    ' WSKCS301-2400: CHECK-INTEGRATION-TYP'       27060000
270700                    ' CALLED BY-'                                 27070000
270800                     WS003-CALLING-PROGRAM-NAME                   27080000
270900                    ' SQLCODE='                                   27090000
271000                     PV-DISP-SQLCODE                              27100000
271100                    ' SUCC='                                      27110000
271200                     WS003-SUCCESS-IND                            27120000
271300             DELIMITED BY SIZE                                    27130000
271400             INTO PV-CICS-MSG-AREA                                27140000
271500             PERFORM 9200-WRITE-TO-CICS-LOG                       27150000
271600             MOVE '2400-CHECK-INTEGRATION-TYP'                    27160000
271700                              TO DP013-PARAGRAPH                  27170000
271800             MOVE 'SELECT WST_INTGRTN_TYP, WST_ATTR_ELEM'         27180000
271900                              TO DP013-MESSAGE-TEXT (1)           27190000
272000             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  27200000
272100             STRING ' TRIP ID: '                                  27210000
272200                    PV-DISP-TRIP-ID                               27220000
272300                    ' EXT SHIP ID: '                              27230000
272400                    DK-EXT-SHP-ID                                 27240000
272500                    ' DWNLD TMST: '                               27250000
272600                    PV-CURRENT-TMST                               27260000
272700             DELIMITED BY SIZE                                    27270000
272800             INTO DP013-MESSAGE-TEXT (2)                          27280000
272900             MOVE 'WST00008'  TO DP013-DB2-TABLE-NAME (1)         27290000
273000             MOVE SQLCA       TO DP013-SQLCA                      27300000
273100             SET DP013-DB2-ABEND  TO TRUE                         27310000
273200             PERFORM 9999-ABEND                                   27320000
273300     END-EVALUATE.                                                27330000
273400                                                                  27340000
273500     IF PS-WRITE-TO-CSSL-YES                                      27350000
273600      AND SQLCODE = 0                                             27360000
273700         STRING   ' ' WS003-SRC-TASK-NUMBER                       27370000
273800                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   27380000
273900                  ' WSKCS301-2400: CHECK-INTEGRATION-TYP'         27390000
274000         DELIMITED BY SIZE                                        27400000
274100         INTO PV-CICS-MSG-AREA                                    27410000
274200         PERFORM 9200-WRITE-TO-CICS-LOG                           27420000
274300         STRING   ' INTEGRATION TYPE: '                           27430000
274400                  WST00010-ATTR-ELEM-TXT-TEXT                     27440000
274500         DELIMITED BY SIZE                                        27450000
274600         INTO PV-CICS-MSG-AREA                                    27460000
274700         PERFORM 9200-WRITE-TO-CICS-LOG                           27470000
274800     END-IF.                                                      27480000
274900                                                                  27490000
275000******************************************************************27500000
275100**  LOAD THE DAT CNTL DCLGEN VALUES THAT ARE COMMON TO THIS TRANS*27510000
275200******************************************************************27520000
275300 2450-PREP-DAT-CNTL-TBLS.                                         27530000
275400                                                                  27540000
275500     MOVE PC-PRC-TYP-CDE          TO WST00003-TRN-TYP-CDE         27550000
275600                                     WST00004-TRN-TYP-CDE.        27560000
275700     MOVE PV-CURRENT-TMST (21:6)  TO WST00003-PRC-GP-ID           27570000
275800                                     WST00004-PRC-GP-ID.          27580000
275900     MOVE PV-CURRENT-TMST         TO WST00003-PRC-CNTL-TMST       27590000
276000                                     WST00003-BEG-PRC-TMST        27600000
276100                                     WST00004-PRC-CNTL-TMST.      27610000
276200     MOVE PV-OPER-UNT-ID-PIC9     TO WST00003-LOC-NBR.            27620000
276300     MOVE PC-STAT-CDE             TO WST00003-STAT-CDE.           27630000
276400     MOVE PC-DEFAULT-NINES        TO WST00003-END-PRC-TMST.       27640000
276500     MOVE PC-DAT-LOAD-VER-NBR     TO WST00003-DAT-LOD-VER-NBR.    27650000
276600     MOVE PC-TEMP-TBL-DESC-LENGTH TO WST00004-LOD-DAT-TXT-LEN.    27660000
276700                                                                  27670000
276800                                                                  27680000
276900******************************************************************27690000
277000** ONLY CREATE APPOINTMENTS FOR A FIRST TIME DWNLD WHERE THE    **27700000
277100** SHIPMENT IS NOT A DUMMY SHIPMENT.                            **27710000
277200******************************************************************27720000
277300 2500-APPOINTMENTS.                                               27730000
277400                                                                  27740000
277500     MOVE +1 TO PV-ROW-COUNTER                                    27750000
277600                PV-GROUP-COUNTER.                                 27760000
277700                                                                  27770000
277800     MOVE 0  TO PV-HOST-INPUT-ID                                  27780000
277900                PV-LAST-HOST-INPUT-ID .                           27790000
278000                                                                  27800000
278100     PERFORM 2510-OPEN-HDR-CSR-1.                                 27810000
278200                                                                  27820000
278300     SET PS-END-OF-HDR-CSR-1-NO TO TRUE.                          27830000
278400     PERFORM 2520-FETCH-HDR-CSR-1                                 27840000
278500       UNTIL PS-END-OF-HDR-CSR-1-YES.                             27850000
278600                                                                  27860000
278700     PERFORM 2540-CLOSE-HDR-CSR-1.                                27870000
278800                                                                  27880000
278900******************************************************************27890000
279000* OPEN HDR_CSR_1                                                 *27900000
279100******************************************************************27910000
279200 2510-OPEN-HDR-CSR-1.                                             27920000
279300                                                                  27930000
279400     EXEC SQL                                                     27940000
279500          OPEN HDR_CSR_1                                          27950000
279600     END-EXEC                                                     27960000
279700                                                                  27970000
279800     EVALUATE TRUE                                                27980000
279900         WHEN SQLCODE = ZERO                                      27990000
280000              CONTINUE                                            28000000
280100         WHEN SQLWARN0 NOT = SPACES                               28010000
280200         WHEN SQLCODE NOT = ZERO                                  28020000
280300             SET  PS-ERROR         TO TRUE                        28030000
280400             MOVE SQLCODE            TO PV-DISP-SQLCODE           28040000
280500             STRING ' ' WS003-SRC-TASK-NUMBER                     28050000
280600                    ' WSKCS301-2510: OPEN-HDR-CSR-1'              28060000
280700                    ' CALLED BY-'                                 28070000
280800                     WS003-CALLING-PROGRAM-NAME                   28080000
280900                    ' SQLCODE='                                   28090000
281000                     PV-DISP-SQLCODE                              28100000
281100                    ' SUCC='                                      28110000
281200                     WS003-SUCCESS-IND                            28120000
281300             DELIMITED BY SIZE                                    28130000
281400             INTO PV-CICS-MSG-AREA                                28140000
281500             PERFORM 9200-WRITE-TO-CICS-LOG                       28150000
281600             MOVE '2510-OPEN-HDR-CSR-1'                           28160000
281700                              TO DP013-PARAGRAPH                  28170000
281800             MOVE 'SELECT WST_SHPMT_XREF_HDR'                     28180000
281900                              TO DP013-MESSAGE-TEXT (1)           28190000
282000             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  28200000
282100             STRING ' TRIP ID: '                                  28210000
282200                    PV-DISP-TRIP-ID                               28220000
282300                    ' EXT SHIP ID: '                              28230000
282400                    DK-EXT-SHP-ID                                 28240000
282500                    ' DWNLD TMST: '                               28250000
282600                    PV-CURRENT-TMST                               28260000
282700             DELIMITED BY SIZE                                    28270000
282800             INTO DP013-MESSAGE-TEXT (2)                          28280000
282900             MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)         28290000
283000             MOVE SQLCA       TO DP013-SQLCA                      28300000
283100             SET DP013-DB2-ABEND  TO TRUE                         28310000
283200             PERFORM 9999-ABEND                                   28320000
283300     END-EVALUATE.                                                28330000
283400                                                                  28340000
283500******************************************************************28350000
283600* FETCH  HDR_CSR_1                                               *28360000
283700******************************************************************28370000
283800 2520-FETCH-HDR-CSR-1.                                            28380000
283900                                                                  28390000
284000     EXEC SQL                                                     28400000
284100          FETCH HDR_CSR_1                                         28410000
284200          INTO                                                    28420000
284300                :WST00001-SOR-CDE                                 28430000
284400               ,:WST00001-DMY-SEQ-NBR                             28440000
284500               ,:WST00001-DEST-LOC-NBR                            28450000
284600               ,:WST00001-DWNLD-CDE                               28460000
284700               ,:WST00001-RCPT-TMST                               28470000
284800               ,:WST00001-CRE-USR-ID                              28480000
284900               ,:WST00001-CRE-TMST                                28490000
285000               ,:WST00001-DWNLD-TMST                              28500000
285100               ,:WST00001-LAST-PRCG-TMST                          28510000
285200               ,:WST00001-PRC-CDE                                 28520000
285300               ,:WST00001-VER-NBR                                 28530000
285400     END-EXEC                                                     28540000
285500                                                                  28550000
285600     EVALUATE TRUE                                                28560000
285700         WHEN SQLCODE = ZERO                                      28570000
285800         ADD 1 TO PV-HDR-CSR-FETCH-COUNT                          28580000
285900**CREATE APPOINTMENT                                              28590000
286000              IF WST00001-DWNLD-CDE = PC-N                        28600000
286100**DO NOT CREATE APPOINTMENTS FOR DUMMY SHIPMENTS (DMY-SEQ-NBR>0)  28610000
286200                 AND WST00001-DMY-SEQ-NBR = 0                     28620000
286300                 PERFORM 2600-CREATE-APPOINTMENT                  28630000
286400              END-IF                                              28640000
286500**INCREMENT HOST-ID FIELD FOR LATER UPDATE OF HDR XREF VER-NBR    28650000
286600              IF WST00001-DWNLD-CDE = PC-N                        28660000
286700                 MOVE +1 TO PV-HOST-INPUT-ID                      28670000
286800              ELSE                                                28680000
286900                 MOVE WST00001-VER-NBR                            28690000
287000                   TO PV-LAST-HOST-INPUT-ID                       28700000
287100                 COMPUTE PV-HOST-INPUT-ID =                       28710000
287200                         PV-LAST-HOST-INPUT-ID + 1                28720000
287300              END-IF                                              28730000
287400                                                                  28740000
287500**CREATE ASN HEADER                                               28750000
287600              PERFORM 2700-CREATE-ASN-HDR                         28760000
287700**CREATE ASN DETAILS                                              28770000
287800              PERFORM 2800-CREATE-ASN-DTL-LVL                     28780000
287900**CASE LEVEL PROCESSING                                           28790000
288000              PERFORM 3200-CASE-LVL-PROCESSING                    28800000
288100                                                                  28810000
288200         WHEN SQLCODE = +100                                      28820000
288300              SET PS-END-OF-HDR-CSR-1-YES TO TRUE                 28830000
288400*TCR 5/03 BELOW                                                   28840000
288500              IF PV-HDR-CSR-FETCH-COUNT = 0                       28850000
288600                 SET PS-BYPASS-YES           TO TRUE              28860000
288700              END-IF                                              28870000
288800              MOVE 0 TO PV-HDR-CSR-FETCH-COUNT                    28880000
288900         WHEN SQLWARN0 NOT = SPACES                               28890000
289000         WHEN SQLCODE NOT = ZERO                                  28900000
289100             SET  PS-ERROR         TO TRUE                        28910000
289200             MOVE SQLCODE            TO PV-DISP-SQLCODE           28920000
289300             STRING ' ' WS003-SRC-TASK-NUMBER                     28930000
289400                    ' WSKCS301-2520: FETCH-HDR-CSR-1'             28940000
289500                    ' CALLED BY-'                                 28950000
289600                     WS003-CALLING-PROGRAM-NAME                   28960000
289700                    ' SQLCODE='                                   28970000
289800                     PV-DISP-SQLCODE                              28980000
289900                    ' SUCC='                                      28990000
290000                     WS003-SUCCESS-IND                            29000000
290100             DELIMITED BY SIZE                                    29010000
290200             INTO PV-CICS-MSG-AREA                                29020000
290300             PERFORM 9200-WRITE-TO-CICS-LOG                       29030000
290400             MOVE '2520-FETCH-HDR-CSR-1'                          29040000
290500                              TO DP013-PARAGRAPH                  29050000
290600             MOVE 'SELECT WST_SHPMT_XREF_HDR'                     29060000
290700                              TO DP013-MESSAGE-TEXT (1)           29070000
290800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  29080000
290900             STRING ' TRIP ID: '                                  29090000
291000                    PV-DISP-TRIP-ID                               29100000
291100                    ' EXT SHIP ID: '                              29110000
291200                    DK-EXT-SHP-ID                                 29120000
291300                    ' DWNLD TMST: '                               29130000
291400                    PV-CURRENT-TMST                               29140000
291500             DELIMITED BY SIZE                                    29150000
291600             INTO DP013-MESSAGE-TEXT (2)                          29160000
291700             MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)         29170000
291800             MOVE SQLCA       TO DP013-SQLCA                      29180000
291900             SET DP013-DB2-ABEND  TO TRUE                         29190000
292000             PERFORM 9999-ABEND                                   29200000
292100     END-EVALUATE.                                                29210000
292200                                                                  29220000
292300     IF PS-WRITE-TO-CSSL-YES                                      29230000
292400      AND SQLCODE = 0                                             29240000
292500         STRING   ' ' WS003-SRC-TASK-NUMBER                       29250000
292600                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   29260000
292700                  ' WSKCS301-2520: FETCH-HDR-CSR-1'               29270000
292800         DELIMITED BY SIZE                                        29280000
292900         INTO PV-CICS-MSG-AREA                                    29290000
293000         PERFORM 9200-WRITE-TO-CICS-LOG                           29300000
293100         MOVE WST00001-DMY-SEQ-NBR  TO PV-DISP-DMY-SEQ-NBR        29310000
293200         MOVE WST00001-VER-NBR      TO PV-DISP-VER-NBR            29320000
293300         STRING   ' DWNLD CODE: '                                 29330000
293400                  WST00001-DWNLD-CDE                              29340000
293500                  ' DMY SEQ NBR: '                                29350000
293600                  PV-DISP-DMY-SEQ-NBR                             29360000
293700                  ' VER NBR: '                                    29370000
293800                  PV-DISP-VER-NBR                                 29380000
293900         DELIMITED BY SIZE                                        29390000
294000         INTO PV-CICS-MSG-AREA                                    29400000
294100         PERFORM 9200-WRITE-TO-CICS-LOG                           29410000
294200     END-IF.                                                      29420000
294300                                                                  29430000
294400******************************************************************29440000
294500* CLOSE HDR_CSR_1                                                *29450000
294600******************************************************************29460000
294700 2540-CLOSE-HDR-CSR-1.                                            29470000
294800                                                                  29480000
294900     EXEC SQL                                                     29490000
295000          CLOSE HDR_CSR_1                                         29500000
295100     END-EXEC                                                     29510000
295200                                                                  29520000
295300     EVALUATE TRUE                                                29530000
295400         WHEN SQLCODE = ZERO                                      29540000
295500              CONTINUE                                            29550000
295600         WHEN SQLWARN0 NOT = SPACES                               29560000
295700         WHEN SQLCODE NOT = ZERO                                  29570000
295800             SET  PS-ERROR         TO TRUE                        29580000
295900             MOVE SQLCODE            TO PV-DISP-SQLCODE           29590000
296000             STRING ' ' WS003-SRC-TASK-NUMBER                     29600000
296100                    ' WSKCS301-2540: CLOSE-HDR-CSR-1'             29610000
296200                    ' CALLED BY-'                                 29620000
296300                     WS003-CALLING-PROGRAM-NAME                   29630000
296400                     ' SQLCODE='                                  29640000
296500                     PV-DISP-SQLCODE                              29650000
296600                    ' SUCC='                                      29660000
296700                     WS003-SUCCESS-IND                            29670000
296800             DELIMITED BY SIZE                                    29680000
296900             INTO PV-CICS-MSG-AREA                                29690000
297000             PERFORM 9200-WRITE-TO-CICS-LOG                       29700000
297100             MOVE '2540-CLOSE-HDR-CSR-1'                          29710000
297200                               TO DP013-PARAGRAPH                 29720000
297300             MOVE 'SELECT WST_SHPMT_XREF_HDR'                     29730000
297400                               TO DP013-MESSAGE-TEXT (1)          29740000
297500             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  29750000
297600             STRING ' TRIP ID: '                                  29760000
297700                    PV-DISP-TRIP-ID                               29770000
297800                    ' EXT SHIP ID: '                              29780000
297900                    DK-EXT-SHP-ID                                 29790000
298000             DELIMITED BY SIZE                                    29800000
298100             INTO DP013-MESSAGE-TEXT (2)                          29810000
298200             MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)         29820000
298300             MOVE SQLCA       TO DP013-SQLCA                      29830000
298400             SET DP013-DB2-ABEND  TO TRUE                         29840000
298500             PERFORM 9999-ABEND                                   29850000
298600     END-EVALUATE.                                                29860000
298700                                                                  29870000
298800******************************************************************29880000
298900* INSERT APPOINTMENT TO WST_ASN_DWNLD                            *29890000
299000******************************************************************29900000
299100 2600-CREATE-APPOINTMENT.                                         29910000
299200                                                                  29920000
299300     PERFORM 2605-LOAD-APPT-REC.                                  29930000
299400                                                                  29940000
299500     PERFORM 2610-LOAD-APPT-REC-TO-TEMP.                          29950000
299600                                                                  29960000
299700     EXEC SQL                                                     29970000
299800          INSERT INTO WST_ASN_DWNLD                               29980000
299900               (  EXT_SHP_ID                                      29990000
300000                , CRE_TMST                                        30000000
300100                , ROW_NBR                                         30010000
300200                , REC_TYP_GP_NBR                                  30020000
300300                , REC_TYP_CDE                                     30030000
300400                , CSE_DTL_NBR                                     30040000
300500                , REC_TYP_DESC                                    30050000
300600               )                                                  30060000
300700             VALUES                                               30070000
300800               ( :WST00011-EXT-SHP-ID                             30080000
300900                ,:WST00011-CRE-TMST                               30090000
301000                ,:WST00011-ROW-NBR                                30100000
301100                ,:WST00011-REC-TYP-GP-NBR                         30110000
301200                ,:WST00011-REC-TYP-CDE                            30120000
301300                ,:WST00011-CSE-DTL-NBR                            30130000
301400                ,:WST00011-REC-TYP-DESC                           30140000
301500               )                                                  30150000
301600     END-EXEC                                                     30160000
301700                                                                  30170000
301800     IF PS-WRITE-TO-CSSL-YES                                      30180000
301900      AND SQLCODE = 0                                             30190000
302000        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          30200000
302100        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   30210000
302200        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      30220000
302300        STRING   ' ' WS003-SRC-TASK-NUMBER                        30230000
302400                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    30240000
302500                 ' WSKCS301-2600: CREATE-APPOINTMENT'             30250000
302600        DELIMITED BY SIZE                                         30260000
302700        INTO PV-CICS-MSG-AREA                                     30270000
302800        PERFORM 9200-WRITE-TO-CICS-LOG                            30280000
302900        STRING   ' ' WS003-SRC-TASK-NUMBER                        30290000
303000               ' ' PV-DISP-EXT-SHP-ID (1:10)                      30300000
303100               ' # REC TYP CDE    : '                             30310000
303200               WST00011-REC-TYP-CDE                               30320000
303300               ' # ROW NBR        : '                             30330000
303400               PV-DISP-ROW-NBR                                    30340000
303500        DELIMITED BY SIZE                                         30350000
303600        INTO PV-CICS-MSG-AREA                                     30360000
303700        PERFORM 9200-WRITE-TO-CICS-LOG                            30370000
303800        STRING ' ' WS003-SRC-TASK-NUMBER                          30380000
303900               ' ' PV-DISP-EXT-SHP-ID (1:10)                      30390000
304000               ' # REC TYP GP NBR : '                             30400000
304100               PV-DISP-REC-TYP-GP-NBR                             30410000
304200               ' # CSE DTL NBR    : '                             30420000
304300               PV-DISP-CSE-DTL-NBR                                30430000
304400        DELIMITED BY SIZE                                         30440000
304500        INTO PV-CICS-MSG-AREA                                     30450000
304600        PERFORM 9200-WRITE-TO-CICS-LOG                            30460000
304700     END-IF.                                                      30470000
304800                                                                  30480000
304900     EVALUATE TRUE                                                30490000
305000         WHEN SQLCODE = ZERO                                      30500000
305100              ADD 1 TO PV-ROW-COUNTER                             30510000
305200                       PV-GROUP-COUNTER                           30520000
305300         WHEN SQLWARN0 NOT = SPACES                               30530000
305400         WHEN SQLCODE NOT = ZERO                                  30540000
305500             SET  PS-ERROR         TO TRUE                        30550000
305600             MOVE SQLCODE            TO PV-DISP-SQLCODE           30560000
305700             STRING ' ' WS003-SRC-TASK-NUMBER                     30570000
305800                    ' WSKCS301-2600: CREATE-APPOINTMENT'          30580000
305900                    ' CALLED BY-'                                 30590000
306000                     WS003-CALLING-PROGRAM-NAME                   30600000
306100                    ' SQLCODE='                                   30610000
306200                     PV-DISP-SQLCODE                              30620000
306300                    ' SUCC='                                      30630000
306400                     WS003-SUCCESS-IND                            30640000
306500             DELIMITED BY SIZE                                    30650000
306600             INTO PV-CICS-MSG-AREA                                30660000
306700             PERFORM 9200-WRITE-TO-CICS-LOG                       30670000
306800             MOVE '2600-CREATE-APPOINTMENT'                       30680000
306900                              TO DP013-PARAGRAPH                  30690000
307000             MOVE 'INSERT WST_ASN_DWNLD'                          30700000
307100                              TO DP013-MESSAGE-TEXT (1)           30710000
307200             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  30720000
307300             STRING ' TRIP ID: '                                  30730000
307400                    PV-DISP-TRIP-ID                               30740000
307500                    ' EXT SHIP ID: '                              30750000
307600                    DK-EXT-SHP-ID                                 30760000
307700                    ' DWNLD TMST: '                               30770000
307800                    PV-CURRENT-TMST                               30780000
307900             DELIMITED BY SIZE                                    30790000
308000             INTO DP013-MESSAGE-TEXT (2)                          30800000
308100             MOVE 'WST00011'  TO DP013-DB2-TABLE-NAME (1)         30810000
308200             MOVE SQLCA       TO DP013-SQLCA                      30820000
308300             SET DP013-DB2-ABEND  TO TRUE                         30830000
308400             PERFORM 9999-ABEND                                   30840000
308500     END-EVALUATE.                                                30850000
308600                                                                  30860000
308700******************************************************************30870000
308800* MOVES TO CREATE AN APPOINTMENT.                                *30880000
308900******************************************************************30890000
309000 2605-LOAD-APPT-REC.                                              30900000
309100                                                                  30910000
309200     INITIALIZE WS008-APPOINTMENT-REC.                            30920000
309300     MOVE 'WSRD008 '  TO PV-TEMP-COPYBOOK-NAME.                   30930000
309400                                                                  30940000
309500     SET WS008-AP-ADD              TO TRUE.                       30950000
309600     SET WS008-AP-APPOINTMT        TO TRUE.                       30960000
309700     MOVE WST00001-CRE-USR-ID      TO WS008-AP-CREATE-USERID.     30970000
309800     MOVE WST00001-CRE-TMST        TO WS008-AP-CREATE-TMST.       30980000
309900     MOVE DK-EXT-SHP-ID            TO WS008-AP-SHIPMT-NBR.        30990000
310000     MOVE PV-ETA-REFORMATTED       TO WS008-AP-EXPCT-STRT-DT-TM.  31000000
310100     SET WS008-AP-NO-PRIORITY      TO TRUE.                       31010000
310200     MOVE VHTRIP-OWNER-SCAC-ID     TO WS008-AP-SCAC.              31020000
310300     MOVE VHTRIP-VEH-NBR           TO WS008-AP-TRLR-NBR.          31030000
310400     MOVE SHIPMT-PRO-NBR           TO WS008-AP-PRO-NBR            31040000
310500     SET WS008-AP-INS-UPD          TO TRUE.                       31050000
310600     MOVE TRIPST-OPER-UNT-ID       TO PV-OPER-UNT-ID-PIC9.        31060000
310700     MOVE PV-OPER-UNT-ID-PIC9      TO WS008-AP-WHSE.              31070000
310800     MOVE SPACES                   TO WS008-AP-BOL.               31080000
310900     MOVE SPACES                   TO WS008-AP-SEAL-NBR.          31090000
311000                                                                  31100000
311100******************************************************************31110000
311200* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *31120000
311300******************************************************************31130000
311400 2610-LOAD-APPT-REC-TO-TEMP.                                      31140000
311500                                                                  31150000
311600     INITIALIZE DCLWST00011.                                      31160000
311700                                                                  31170000
311800     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       31180000
311900     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         31190000
312000     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          31200000
312100     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   31210000
312200     MOVE PC-AP                     TO WST00011-REC-TYP-CDE.      31220000
312300     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 31230000
312400     MOVE WS008-APPOINTMENT-REC     TO WST00011-REC-TYP-DESC-TEXT.31240000
312500     MOVE PC-HIGH-NINES             TO WST00011-CSE-DTL-NBR.      31250000
312600                                                                  31260000
312700******************************************************************31270000
312800*                                                                *31280000
312900******************************************************************31290000
313000 2700-CREATE-ASN-HDR.                                             31300000
313100                                                                  31310000
313200     MOVE +1 TO PV-PRC-LOD-SEQ-ID.                                31320000
313300     SET PS-DAT-CNTL-REC-INSERTED-NO  TO TRUE.                    31330000
313400                                                                  31340000
313500     PERFORM 2705-LOAD-ASN-HDR-REC.                               31350000
313600                                                                  31360000
313700     PERFORM 2710-LOAD-ASN-HDR-REC-TO-TEMP.                       31370000
313800                                                                  31380000
313900     EXEC SQL                                                     31390000
314000          INSERT INTO WST_ASN_DWNLD                               31400000
314100               (  EXT_SHP_ID                                      31410000
314200                , CRE_TMST                                        31420000
314300                , ROW_NBR                                         31430000
314400                , REC_TYP_GP_NBR                                  31440000
314500                , REC_TYP_CDE                                     31450000
314600                , CSE_DTL_NBR                                     31460000
314700                , REC_TYP_DESC                                    31470000
314800               )                                                  31480000
314900             VALUES                                               31490000
315000               ( :WST00011-EXT-SHP-ID                             31500000
315100                ,:WST00011-CRE-TMST                               31510000
315200                ,:WST00011-ROW-NBR                                31520000
315300                ,:WST00011-REC-TYP-GP-NBR                         31530000
315400                ,:WST00011-REC-TYP-CDE                            31540000
315500                ,:WST00011-CSE-DTL-NBR                            31550000
315600                ,:WST00011-REC-TYP-DESC                           31560000
315700               )                                                  31570000
315800     END-EXEC                                                     31580000
315900                                                                  31590000
316000     IF PS-WRITE-TO-CSSL-YES                                      31600000
316100      AND SQLCODE = 0                                             31610000
316200        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          31620000
316300        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   31630000
316400        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      31640000
316500        STRING ' ' WS003-SRC-TASK-NUMBER                          31650000
316600               ' ' PV-DISP-EXT-SHP-ID (1:10)                      31660000
316700               ' WSKCS301-2700: CREATE-ASN-HDR'                   31670000
316800        DELIMITED BY SIZE                                         31680000
316900        INTO PV-CICS-MSG-AREA                                     31690000
317000        PERFORM 9200-WRITE-TO-CICS-LOG                            31700000
317100        STRING   ' ' WS003-SRC-TASK-NUMBER                        31710000
317200               ' ' PV-DISP-EXT-SHP-ID (1:10)                      31720000
317300               ' # REC TYP CDE    : '                             31730000
317400               WST00011-REC-TYP-CDE                               31740000
317500               ' # ROW NBR        : '                             31750000
317600               PV-DISP-ROW-NBR                                    31760000
317700        DELIMITED BY SIZE                                         31770000
317800        INTO PV-CICS-MSG-AREA                                     31780000
317900        PERFORM 9200-WRITE-TO-CICS-LOG                            31790000
318000        STRING ' ' WS003-SRC-TASK-NUMBER                          31800000
318100               ' ' PV-DISP-EXT-SHP-ID (1:10)                      31810000
318200               ' # REC TYP GP NBR : '                             31820000
318300               PV-DISP-REC-TYP-GP-NBR                             31830000
318400               ' # CSE DTL NBR    : '                             31840000
318500               PV-DISP-CSE-DTL-NBR                                31850000
318600        DELIMITED BY SIZE                                         31860000
318700        INTO PV-CICS-MSG-AREA                                     31870000
318800        PERFORM 9200-WRITE-TO-CICS-LOG                            31880000
318900     END-IF.                                                      31890000
319000                                                                  31900000
319100     EVALUATE TRUE                                                31910000
319200         WHEN SQLCODE = ZERO                                      31920000
319300              SET PS-THIS-IS-ASN-HDR-YES TO TRUE                  31930000
319400              PERFORM 7500-DAT-CNTL-TBLS                          31940000
319500              ADD 1 TO PV-ROW-COUNTER                             31950000
319600                       PV-GROUP-COUNTER                           31960000
319700         WHEN SQLWARN0 NOT = SPACES                               31970000
319800         WHEN SQLCODE NOT = ZERO                                  31980000
319900             SET  PS-ERROR         TO TRUE                        31990000
320000             MOVE SQLCODE            TO PV-DISP-SQLCODE           32000000
320100             STRING ' ' WS003-SRC-TASK-NUMBER                     32010000
320200                    ' WSKCS301-2700: CREATE-ASN-HDR'              32020000
320300                    ' CALLED BY-'                                 32030000
320400                     WS003-CALLING-PROGRAM-NAME                   32040000
320500                    ' SQLCODE='                                   32050000
320600                     PV-DISP-SQLCODE                              32060000
320700                    ' SUCC='                                      32070000
320800                     WS003-SUCCESS-IND                            32080000
320900             DELIMITED BY SIZE                                    32090000
321000             INTO PV-CICS-MSG-AREA                                32100000
321100             PERFORM 9200-WRITE-TO-CICS-LOG                       32110000
321200             MOVE '2700-CREATE-ASN-HDR'                           32120000
321300                              TO DP013-PARAGRAPH                  32130000
321400             MOVE 'INSERT WST_ASN_DWNLD'                          32140000
321500                              TO DP013-MESSAGE-TEXT (1)           32150000
321600             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  32160000
321700             STRING ' TRIP ID: '                                  32170000
321800                    PV-DISP-TRIP-ID                               32180000
321900                    ' EXT SHIP ID: '                              32190000
322000                    DK-EXT-SHP-ID                                 32200000
322100                    ' DWNLD TMST: '                               32210000
322200                    PV-CURRENT-TMST                               32220000
322300             DELIMITED BY SIZE                                    32230000
322400             INTO DP013-MESSAGE-TEXT (2)                          32240000
322500             MOVE 'WST00011'  TO DP013-DB2-TABLE-NAME (1)         32250000
322600             MOVE SQLCA       TO DP013-SQLCA                      32260000
322700             SET DP013-DB2-ABEND  TO TRUE                         32270000
322800             PERFORM 9999-ABEND                                   32280000
322900     END-EVALUATE.                                                32290000
323000                                                                  32300000
323100******************************************************************32310000
323200* MOVES TO CREATE ASN HEADER REC.                                *32320000
323300******************************************************************32330000
323400 2705-LOAD-ASN-HDR-REC.                                           32340000
323500                                                                  32350000
323600     INITIALIZE WS004-ASN-REC.                                    32360000
323700     MOVE 'WSRD004 '  TO PV-TEMP-COPYBOOK-NAME.                   32370000
323800                                                                  32380000
323900     SET WS004-AH-ADD               TO TRUE.                      32390000
324000     SET WS004-AH-ASN-HDR           TO TRUE.                      32400000
324100     MOVE WST00001-CRE-USR-ID       TO WS004-AH-CREATE-USERID.    32410000
324200     MOVE WST00001-CRE-TMST         TO WS004-AH-CREATE-TMST.      32420000
324300     MOVE DK-EXT-SHP-ID             TO WS004-AH-SHIPMT-NBR.       32430000
324400     MOVE PV-OPER-UNT-ID-PIC9       TO WS004-AH-WHSE.             32440000
324500     MOVE SPACES                    TO WS004-AH-BOL-NBR.          32450000
324600     MOVE VHTRIP-OWNER-SCAC-ID      TO WS004-AH-CARRIER-SHIP-VIA. 32460000
324700     MOVE VHTRIP-VEH-NBR            TO WS004-AH-TRLR-NBR.         32470000
324800     MOVE DK-TRIP-ID                TO WS004-AH-TRIP-ID.          32480000
324900     MOVE SHIPMT-PRO-NBR            TO WS004-AH-PRO-NBR.          32490000
325000     MOVE PV-ETA-REFORMATTED        TO WS004-AH-SHIP-DATE         32500000
325100                                       WS004-AH-EXPT-START-DATE.  32510000
325200                                                                  32520000
325300     MOVE +0 TO PV-RECS-IN-TRBL-COUNT.                            32530000
325400     PERFORM 2715-COUNT-RECS-IN-TRBL.                             32540000
325500                                                                  32550000
325600     IF PV-RECS-IN-TRBL-COUNT > 0                                 32560000
325700        SET WS004-AH-TROUBLE-SHPMT TO TRUE                        32570000
325800        PERFORM 2720-UPD-HDR-XREF-DWNLD-CDE                       32580000
325900     ELSE                                                         32590000
326000        SET WS004-AH-NO-TROUBLE TO TRUE                           32600000
326100     END-IF.                                                      32610000
326200                                                                  32620000
326300* JAK 06/2007 - SET CODE BASED ON WS003 INPUT                     32630000
326400     IF WS003-CANCEL-SHPMT-YES                                    32640000
326500        SET WS004-AH-CANCEL     TO TRUE                           32650000
326600     ELSE                                                         32660000
326700        SET WS004-AH-IN-TRANSIT TO TRUE                           32670000
326800     END-IF.                                                      32680000
326900                                                                  32690000
327000     SET WS004-AH-DONT-CREATE-APPT                                32700000
327100         WS004-AH-VENDOR-SHIPMT TO TRUE.                          32710000
327200                                                                  32720000
327300     MOVE PV-HOST-INPUT-ID          TO WS004-AH-HOST-INPT-ID.     32730000
327400                                                                  32740000
327500******************************************************************32750000
327600* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *32760000
327700******************************************************************32770000
327800 2710-LOAD-ASN-HDR-REC-TO-TEMP.                                   32780000
327900                                                                  32790000
328000     INITIALIZE DCLWST00011.                                      32800000
328100                                                                  32810000
328200     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       32820000
328300     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         32830000
328400     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          32840000
328500     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   32850000
328600     MOVE PC-AH                     TO WST00011-REC-TYP-CDE.      32860000
328700     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 32870000
328800     MOVE WS004-ASN-REC             TO WST00011-REC-TYP-DESC-TEXT.32880000
328900     MOVE PC-HIGH-NINES             TO WST00011-CSE-DTL-NBR.      32890000
329000                                                                  32900000
329100******************************************************************32910000
329200*                                                                *32920000
329300******************************************************************32930000
329400 2715-COUNT-RECS-IN-TRBL.                                         32940000
329500                                                                  32950000
329600     EXEC SQL                                                     32960000
329700          SELECT COUNT (*)                                        32970000
329800          INTO :PV-RECS-IN-TRBL-COUNT                             32980000
329900          FROM WST_SHPMT_XREF_DTL                                 32990000
330000          WHERE DWNLD_CDE  = :PC-T                                33000000
330100          AND   EXT_SHP_ID = :DK-EXT-SHP-ID                       33010000
330110          WITH UR                                                 33011008
330200     END-EXEC                                                     33020000
330300                                                                  33030000
330400     EVALUATE TRUE                                                33040000
330500         WHEN SQLCODE = ZERO                                      33050000
330600         WHEN SQLCODE = +100                                      33060000
330700              CONTINUE                                            33070000
330800         WHEN SQLWARN0 NOT = SPACES                               33080000
330900         WHEN SQLCODE NOT = ZERO                                  33090000
331000         WHEN SQLCODE NOT = +100                                  33100000
331100             SET  PS-ERROR         TO TRUE                        33110000
331200             MOVE SQLCODE            TO PV-DISP-SQLCODE           33120000
331300             STRING ' ' WS003-SRC-TASK-NUMBER                     33130000
331400                    ' WSKCS301-2715: COUNT-RECS-IN-TRBL'          33140000
331500                    ' CALLED BY-'                                 33150000
331600                     WS003-CALLING-PROGRAM-NAME                   33160000
331700                    ' SQLCODE='                                   33170000
331800                     PV-DISP-SQLCODE                              33180000
331900                    ' SUCC='                                      33190000
332000                     WS003-SUCCESS-IND                            33200000
332100             DELIMITED BY SIZE                                    33210000
332200             INTO PV-CICS-MSG-AREA                                33220000
332300             PERFORM 9200-WRITE-TO-CICS-LOG                       33230000
332400             MOVE '2715-COUNT-RECS-IN-TRBL'                       33240000
332500                              TO DP013-PARAGRAPH                  33250000
332600             MOVE 'SELECT WST_SHPMT_XREF_HDR'                     33260000
332700                              TO DP013-MESSAGE-TEXT (1)           33270000
332800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  33280000
332900             STRING ' TRIP ID: '                                  33290000
333000                    PV-DISP-TRIP-ID                               33300000
333100                    ' EXT SHIP ID: '                              33310000
333200                    DK-EXT-SHP-ID                                 33320000
333300                    ' DWNLD TMST: '                               33330000
333400                   PV-CURRENT-TMST                                33340000
333500             DELIMITED BY SIZE                                    33350000
333600             INTO DP013-MESSAGE-TEXT (2)                          33360000
333700             MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)         33370000
333800             MOVE SQLCA       TO DP013-SQLCA                      33380000
333900             SET DP013-DB2-ABEND  TO TRUE                         33390000
334000             PERFORM 9999-ABEND                                   33400000
334100     END-EVALUATE.                                                33410000
334200                                                                  33420000
334300******************************************************************33430000
334400* UPDATE THE WST_SHIPT_XER_HDR.DWNLD_CDE TO 'P' BECAUSE TROUBLE   33440000
334500* EXISTS ON THE SHIPMENT AT SOME LEVEL.                           33450000
334600******************************************************************33460000
334700 2720-UPD-HDR-XREF-DWNLD-CDE.                                     33470000
334800                                                                  33480000
334900     EXEC SQL                                                     33490000
335000          UPDATE WST_SHPMT_XREF_HDR                               33500000
335100            SET  DWNLD_CDE    = :PC-P                             33510000
335200           WHERE EXT_SHP_ID   = :DK-EXT-SHP-ID                    33520000
335300     END-EXEC                                                     33530000
335400                                                                  33540000
335500     EVALUATE TRUE                                                33550000
335600         WHEN SQLCODE = ZERO                                      33560000
335700             CONTINUE                                             33570000
335800         WHEN SQLWARN0 NOT = SPACES                               33580000
335900         WHEN SQLCODE NOT = ZERO                                  33590000
336000             SET  PS-ERROR         TO TRUE                        33600000
336100             MOVE SQLCODE            TO PV-DISP-SQLCODE           33610000
336200             STRING ' ' WS003-SRC-TASK-NUMBER                     33620000
336300                    ' WSKCS301-2720: UPD-HDR-XREF-DWNLD-CDE'      33630000
336400                    ' CALLED BY-'                                 33640000
336500                     WS003-CALLING-PROGRAM-NAME                   33650000
336600                    ' SQLCODE='                                   33660000
336700                     PV-DISP-SQLCODE                              33670000
336800                    ' SUCC='                                      33680000
336900                     WS003-SUCCESS-IND                            33690000
337000             DELIMITED BY SIZE                                    33700000
337100             INTO PV-CICS-MSG-AREA                                33710000
337200             PERFORM 9200-WRITE-TO-CICS-LOG                       33720000
337300             MOVE '2720-UPD-HDR-XREF-DWNLD-CDE'                   33730000
337400                              TO DP013-PARAGRAPH                  33740000
337500             MOVE 'UPDATE WST_SHPMT_XREF_HDR'                     33750000
337600                              TO DP013-MESSAGE-TEXT (1)           33760000
337700             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  33770000
337800             STRING ' TRIP ID: '                                  33780000
337900                    PV-DISP-TRIP-ID                               33790000
338000                    ' EXT SHIP ID: '                              33800000
338100                    DK-EXT-SHP-ID                                 33810000
338200                    ' DWNLD TMST: '                               33820000
338300                    PV-CURRENT-TMST                               33830000
338400             DELIMITED BY SIZE                                    33840000
338500             INTO DP013-MESSAGE-TEXT (2)                          33850000
338600             MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)         33860000
338700             MOVE SQLCA       TO DP013-SQLCA                      33870000
338800             SET DP013-DB2-ABEND  TO TRUE                         33880000
338900             PERFORM 9999-ABEND                                   33890000
339000     END-EVALUATE.                                                33900000
339100                                                                  33910000
339200     IF PS-WRITE-TO-CSSL-YES                                      33920000
339300      AND SQLCODE = 0                                             33930000
339400        STRING   ' ' WS003-SRC-TASK-NUMBER                        33940000
339500                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    33950000
339600                 ' WSKCS301-2720: UPD-HDR-XREF-DWNLD-CDE TO P'    33960000
339700         DELIMITED BY SIZE                                        33970000
339800         INTO PV-CICS-MSG-AREA                                    33980000
339900         PERFORM 9200-WRITE-TO-CICS-LOG                           33990000
340000     END-IF.                                                      34000000
340100                                                                  34010000
340200******************************************************************34020000
340300*                                                                *34030000
340400******************************************************************34040000
340500 2800-CREATE-ASN-DTL-LVL.                                         34050000
340600                                                                  34060000
340700     PERFORM 2810-OPEN-ASN-DTL-CSR.                               34070000
340800                                                                  34080000
340900     SET PS-END-OF-ASN-DTL-CSR-NO TO TRUE.                        34090000
341000     PERFORM 2820-FETCH-ASN-DTL-CSR                               34100000
341100       UNTIL PS-END-OF-ASN-DTL-CSR-YES.                           34110000
341200                                                                  34120000
341300     PERFORM 2830-CLOSE-ASN-DTL-CSR.                              34130000
341400                                                                  34140000
341500******************************************************************34150000
341600* OPEN ASN_DTL_CSR     SKU LEVEL                                 *34160000
341700******************************************************************34170000
341800 2810-OPEN-ASN-DTL-CSR.                                           34180000
341900                                                                  34190000
342000     EXEC SQL                                                     34200000
342100          OPEN ASN_DTL_CSR                                        34210000
342200     END-EXEC                                                     34220000
342300                                                                  34230000
342400     EVALUATE TRUE                                                34240000
342500         WHEN SQLCODE = ZERO                                      34250000
342600              CONTINUE                                            34260000
342700         WHEN SQLWARN0 NOT = SPACES                               34270000
342800         WHEN SQLCODE NOT = ZERO                                  34280000
342900             SET  PS-ERROR         TO TRUE                        34290000
343000             MOVE SQLCODE            TO PV-DISP-SQLCODE           34300000
343100             STRING ' ' WS003-SRC-TASK-NUMBER                     34310000
343200                    ' WSKCS301-2810: OPEN-ASN-DTL-CSR'            34320000
343300                    ' CALLED BY-'                                 34330000
343400                     WS003-CALLING-PROGRAM-NAME                   34340000
343500                    ' SQLCODE='                                   34350000
343600                     PV-DISP-SQLCODE                              34360000
343700                    ' SUCC='                                      34370000
343800                     WS003-SUCCESS-IND                            34380000
343900             DELIMITED BY SIZE                                    34390000
344000             INTO PV-CICS-MSG-AREA                                34400000
344100             PERFORM 9200-WRITE-TO-CICS-LOG                       34410000
344200             MOVE '2810-OPEN-ASN-DTL-CSR'                         34420000
344300                              TO DP013-PARAGRAPH                  34430000
344400             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     34440000
344500                              TO DP013-MESSAGE-TEXT (1)           34450000
344600             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  34460000
344700             STRING ' TRIP ID: '                                  34470000
344800                    PV-DISP-TRIP-ID                               34480000
344900                    ' EXT SHIP ID: '                              34490000
345000                    DK-EXT-SHP-ID                                 34500000
345100                    ' DWNLD TMST: '                               34510000
345200                    PV-CURRENT-TMST                               34520000
345300             DELIMITED BY SIZE                                    34530000
345400             INTO DP013-MESSAGE-TEXT (2)                          34540000
345500             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         34550000
345600             MOVE SQLCA       TO DP013-SQLCA                      34560000
345700             SET DP013-DB2-ABEND  TO TRUE                         34570000
345800             PERFORM 9999-ABEND                                   34580000
345900     END-EVALUATE.                                                34590000
346000                                                                  34600000
346100******************************************************************34610000
346200* FETCH  ASN_DTL_CSR    SKU LEVEL                                *34620000
346300******************************************************************34630000
346400 2820-FETCH-ASN-DTL-CSR.                                          34640000
346500                                                                  34650000
346600     EXEC SQL                                                     34660000
346700          FETCH ASN_DTL_CSR                                       34670000
346800          INTO                                                    34680000
346900                :WST00002-PO-NBR                                  34690000
347000               ,:WST00002-PO-LNE-NBR                              34700000
347100               ,:WST00002-RCVR-SEQ-NBR                            34710000
347200               ,:WST00002-ASN-LVL-CDE                             34720000
347300               ,:WST00002-PREPK-ID                                34730000
347400               ,:WST00002-CRE-USR-ID                              34740000
347500               ,:WST00002-CRE-TMST                                34750000
347600               ,:WST00002-DWNLD-CDE                               34760000
347700               ,:WST00002-ACTV-CDE                                34770000
347800               ,:XLT00003-SKU-NBR                                 34780000
347900     END-EXEC                                                     34790000
348000                                                                  34800000
348100     EVALUATE TRUE                                                34810000
348200         WHEN SQLCODE = ZERO                                      34820000
348300              PERFORM 3000-CREATE-ASN-DTLS                        34830000
348400         WHEN SQLCODE = +100                                      34840000
348500             SET PS-END-OF-ASN-DTL-CSR-YES TO TRUE                34850000
348600         WHEN SQLWARN0 NOT = SPACES                               34860000
348700         WHEN SQLCODE NOT = ZERO                                  34870000
348800             SET  PS-ERROR         TO TRUE                        34880000
348900             MOVE SQLCODE            TO PV-DISP-SQLCODE           34890000
349000             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            34900000
349100             MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR   34910000
349200             MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID         34920000
349300             MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR      34930000
349400             STRING ' ' WS003-SRC-TASK-NUMBER                     34940000
349500                    ' WSKCS301-2820: FETCH-ASN-DTL-CSR'           34950000
349600                    ' CALLED BY-'                                 34960000
349700                     WS003-CALLING-PROGRAM-NAME                   34970000
349800                    ' SQLCODE='                                   34980000
349900                     PV-DISP-SQLCODE                              34990000
350000                    ' SUCC='                                      35000000
350100                     WS003-SUCCESS-IND                            35010000
350200                     ' PO='                                       35020000
350300                     PV-DISP-PO-NBR                               35030000
350400                     ' RCVR='                                     35040000
350500                     PV-DISP-RCVR-SEQ-NBR                         35050000
350600                     ' PRPK='                                     35060000
350700                     PV-DISP-PREPK-ID                             35070000
350800                     ' LNE='                                      35080000
350900                     PV-DISP-PO-LINE-NBR                          35090000
351000             DELIMITED BY SIZE                                    35100000
351100             INTO PV-CICS-MSG-AREA                                35110000
351200             PERFORM 9200-WRITE-TO-CICS-LOG                       35120000
351300             MOVE '2820-FETCH-ASN-DTL-CSR'                        35130000
351400                              TO DP013-PARAGRAPH                  35140000
351500             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     35150000
351600                              TO DP013-MESSAGE-TEXT (1)           35160000
351700             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  35170000
351800             STRING ' TRIP ID: '                                  35180000
351900                    PV-DISP-TRIP-ID                               35190000
352000                    ' EXT SHIP ID: '                              35200000
352100                    DK-EXT-SHP-ID                                 35210000
352200                    ' DWNLD TMST: '                               35220000
352300                    PV-CURRENT-TMST                               35230000
352400             DELIMITED BY SIZE                                    35240000
352500             INTO DP013-MESSAGE-TEXT (2)                          35250000
352600             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         35260000
352700             MOVE SQLCA       TO DP013-SQLCA                      35270000
352800             SET DP013-DB2-ABEND  TO TRUE                         35280000
352900             PERFORM 9999-ABEND                                   35290000
353000     END-EVALUATE.                                                35300000
353100                                                                  35310000
353200     IF PS-WRITE-TO-CSSL-YES                                      35320000
353300      AND SQLCODE = 0                                             35330000
353400        STRING   ' ' WS003-SRC-TASK-NUMBER                        35340000
353500                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    35350000
353600                 ' WSKCS301-2820: FETCH-ASN-DTL-CSR '             35360000
353700         DELIMITED BY SIZE                                        35370000
353800         INTO PV-CICS-MSG-AREA                                    35380000
353900         PERFORM 9200-WRITE-TO-CICS-LOG                           35390000
354000         MOVE XLT00003-SKU-NBR  TO PV-DISP-SKU                    35400000
354100         STRING   ' ' WS003-SRC-TASK-NUMBER                       35410000
354200                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   35420000
354300                  ' SKU NBR : '                                   35430000
354400                  PV-DISP-SKU                                     35440000
354500         DELIMITED BY SIZE                                        35450000
354600         INTO PV-CICS-MSG-AREA                                    35460000
354700         PERFORM 9200-WRITE-TO-CICS-LOG                           35470000
354800     END-IF.                                                      35480000
354900                                                                  35490000
355000******************************************************************35500000
355100* CLOSE ASN_DTL_CSR       SKU_LEVEL                              *35510000
355200******************************************************************35520000
355300 2830-CLOSE-ASN-DTL-CSR.                                          35530000
355400                                                                  35540000
355500     EXEC SQL                                                     35550000
355600          CLOSE ASN_DTL_CSR                                       35560000
355700     END-EXEC                                                     35570000
355800                                                                  35580000
355900     EVALUATE TRUE                                                35590000
356000         WHEN SQLCODE = ZERO                                      35600000
356100              CONTINUE                                            35610000
356200         WHEN SQLWARN0 NOT = SPACES                               35620000
356300         WHEN SQLCODE NOT = ZERO                                  35630000
356400             SET  PS-ERROR         TO TRUE                        35640000
356500             MOVE SQLCODE            TO PV-DISP-SQLCODE           35650000
356600             STRING ' ' WS003-SRC-TASK-NUMBER                     35660000
356700                    ' WSKCS301-2830: CLOSE-ASN-DTL-CSR'           35670000
356800                    ' CALLED BY-'                                 35680000
356900                     WS003-CALLING-PROGRAM-NAME                   35690000
357000                    ' SQLCODE='                                   35700000
357100                     PV-DISP-SQLCODE                              35710000
357200                    ' SUCC='                                      35720000
357300                     WS003-SUCCESS-IND                            35730000
357400             DELIMITED BY SIZE                                    35740000
357500             INTO PV-CICS-MSG-AREA                                35750000
357600             PERFORM 9200-WRITE-TO-CICS-LOG                       35760000
357700             MOVE '2830-CLOSE-ASN-DTL-CSR'                        35770000
357800                              TO DP013-PARAGRAPH                  35780000
357900             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     35790000
358000                              TO DP013-MESSAGE-TEXT (1)           35800000
358100             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  35810000
358200             STRING ' TRIP ID: '                                  35820000
358300                    PV-DISP-TRIP-ID                               35830000
358400                    ' EXT SHIP ID: '                              35840000
358500                    DK-EXT-SHP-ID                                 35850000
358600                    ' DWNLD TMST: '                               35860000
358700                    PV-CURRENT-TMST                               35870000
358800             DELIMITED BY SIZE                                    35880000
358900             INTO DP013-MESSAGE-TEXT (2)                          35890000
359000             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         35900000
359100             MOVE SQLCA       TO DP013-SQLCA                      35910000
359200             SET DP013-DB2-ABEND  TO TRUE                         35920000
359300             PERFORM 9999-ABEND                                   35930000
359400     END-EVALUATE.                                                35940000
359500                                                                  35950000
359600******************************************************************35960000
359700*                                                                *35970000
359800******************************************************************35980000
359900 3000-CREATE-ASN-DTLS.                                            35990000
360000                                                                  36000000
360100     PERFORM 3005-LOAD-ASN-DTL-REC.                               36010000
360200                                                                  36020000
360300     PERFORM 3010-LOAD-ASN-DTL-REC-TO-TEMP.                       36030000
360400                                                                  36040000
360500     EXEC SQL                                                     36050000
360600          INSERT INTO WST_ASN_DWNLD                               36060000
360700               (  EXT_SHP_ID                                      36070000
360800                , CRE_TMST                                        36080000
360900                , ROW_NBR                                         36090000
361000                , REC_TYP_GP_NBR                                  36100000
361100                , REC_TYP_CDE                                     36110000
361200                , CSE_DTL_NBR                                     36120000
361300                , REC_TYP_DESC                                    36130000
361400               )                                                  36140000
361500             VALUES                                               36150000
361600               ( :WST00011-EXT-SHP-ID                             36160000
361700                ,:WST00011-CRE-TMST                               36170000
361800                ,:WST00011-ROW-NBR                                36180000
361900                ,:WST00011-REC-TYP-GP-NBR                         36190000
362000                ,:WST00011-REC-TYP-CDE                            36200000
362100                ,:WST00011-CSE-DTL-NBR                            36210000
362200                ,:WST00011-REC-TYP-DESC                           36220000
362300               )                                                  36230000
362400     END-EXEC                                                     36240000
362500                                                                  36250000
362600     IF PS-WRITE-TO-CSSL-YES                                      36260000
362700      AND SQLCODE = 0                                             36270000
362800        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          36280000
362900        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   36290000
363000        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      36300000
363100        STRING   ' ' WS003-SRC-TASK-NUMBER                        36310000
363200                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    36320000
363300                 ' WSKCS301-3000: CREATE-ASN-DTLS '               36330000
363400        DELIMITED BY SIZE                                         36340000
363500        INTO PV-CICS-MSG-AREA                                     36350000
363600        PERFORM 9200-WRITE-TO-CICS-LOG                            36360000
363700        STRING   ' ' WS003-SRC-TASK-NUMBER                        36370000
363800               ' ' PV-DISP-EXT-SHP-ID (1:10)                      36380000
363900               ' # REC TYP CDE    : '                             36390000
364000               WST00011-REC-TYP-CDE                               36400000
364100               ' # ROW NBR        : '                             36410000
364200               PV-DISP-ROW-NBR                                    36420000
364300        DELIMITED BY SIZE                                         36430000
364400        INTO PV-CICS-MSG-AREA                                     36440000
364500        PERFORM 9200-WRITE-TO-CICS-LOG                            36450000
364600        STRING ' ' WS003-SRC-TASK-NUMBER                          36460000
364700               ' ' PV-DISP-EXT-SHP-ID (1:10)                      36470000
364800               ' # REC TYP GP NBR : '                             36480000
364900               PV-DISP-REC-TYP-GP-NBR                             36490000
365000               ' # CSE DTL NBR    : '                             36500000
365100               PV-DISP-CSE-DTL-NBR                                36510000
365200        DELIMITED BY SIZE                                         36520000
365300        INTO PV-CICS-MSG-AREA                                     36530000
365400        PERFORM 9200-WRITE-TO-CICS-LOG                            36540000
365500     END-IF.                                                      36550000
365600                                                                  36560000
365700     EVALUATE TRUE                                                36570000
365800         WHEN SQLCODE = ZERO                                      36580000
365900              PERFORM 7500-DAT-CNTL-TBLS                          36590000
366000              ADD 1 TO PV-ROW-COUNTER                             36600000
366100                       PV-GROUP-COUNTER                           36610000
366200         WHEN SQLWARN0 NOT = SPACES                               36620000
366300         WHEN SQLCODE NOT = ZERO                                  36630000
366400             SET  PS-ERROR         TO TRUE                        36640000
366500             MOVE SQLCODE            TO PV-DISP-SQLCODE           36650000
366600             STRING ' ' WS003-SRC-TASK-NUMBER                     36660000
366700                    ' WSKCS301-3000: CREATE-ASN-DTLS'             36670000
366800                    ' CALLED BY-'                                 36680000
366900                     WS003-CALLING-PROGRAM-NAME                   36690000
367000                    ' SQLCODE='                                   36700000
367100                     PV-DISP-SQLCODE                              36710000
367200                    ' SUCC='                                      36720000
367300                     WS003-SUCCESS-IND                            36730000
367400             DELIMITED BY SIZE                                    36740000
367500             INTO PV-CICS-MSG-AREA                                36750000
367600             PERFORM 9200-WRITE-TO-CICS-LOG                       36760000
367700             MOVE '3000-CREATE-ASN-DTLS'                          36770000
367800                              TO DP013-PARAGRAPH                  36780000
367900             MOVE 'INSERT WST_ASN_DWNLD'                          36790000
368000                              TO DP013-MESSAGE-TEXT (1)           36800000
368100             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  36810000
368200             STRING ' TRIP ID: '                                  36820000
368300                    PV-DISP-TRIP-ID                               36830000
368400                    ' EXT SHIP ID: '                              36840000
368500                    DK-EXT-SHP-ID                                 36850000
368600                    ' DWNLD TMST: '                               36860000
368700                    PV-CURRENT-TMST                               36870000
368800             DELIMITED BY SIZE                                    36880000
368900             INTO DP013-MESSAGE-TEXT (2)                          36890000
369000             MOVE 'WST00011'  TO DP013-DB2-TABLE-NAME (1)         36900000
369100             MOVE SQLCA       TO DP013-SQLCA                      36910000
369200             SET DP013-DB2-ABEND  TO TRUE                         36920000
369300             PERFORM 9999-ABEND                                   36930000
369400     END-EVALUATE.                                                36940000
369500                                                                  36950000
369600******************************************************************36960000
369700* MOVES TO CREATE ASN DETAIL REC.                                *36970000
369800******************************************************************36980000
369900 3005-LOAD-ASN-DTL-REC.                                           36990000
370000                                                                  37000000
370100     INITIALIZE WS005-ASN-DTL-REC.                                37010000
370200     MOVE 'WSRD005 '  TO PV-TEMP-COPYBOOK-NAME.                   37020000
370300                                                                  37030000
370400     SET WS005-AD-ADD         TO TRUE.                            37040000
370500     SET WS005-AD-ASN-DTL     TO TRUE.                            37050000
370600     MOVE WST00001-CRE-USR-ID TO WS005-AD-CREATE-USERID.          37060000
370700     MOVE WST00001-CRE-TMST   TO WS005-AD-CREATE-TMST.            37070000
370800     MOVE DK-EXT-SHP-ID       TO WS005-AD-SHIPMT-NBR.             37080000
370900     MOVE XLT00003-SKU-NBR    TO WS005-AD-SKU-ID.                 37090000
371000     MOVE XLT00003-SKU-NBR    TO WS005-AD-SKU-NBR.                37100000
371100     PERFORM 3015-GET-ITM-QTYS.                                   37110000
371200                                                                  37120000
371300     IF RECITM-DTL-CK-ITM-QTY > 0                                 37130000
371400        MOVE RECITM-DTL-CK-ITM-QTY  TO WS005-AD-UNITS-SHIPPED     37140000
371500     ELSE                                                         37150000
371600        MOVE RECITM-PKSL-ITM-QTY    TO WS005-AD-UNITS-SHIPPED     37160000
371700     END-IF.                                                      37170000
371800                                                                  37180000
371900     SET WS005-CHECK-IMMED-NEEDS TO TRUE.                         37190000
372000                                                                  37200000
372100     MOVE WST00002-PO-NBR           TO WS005-AD-PO-NBR.           37210000
372200     MOVE WST00002-PO-LNE-NBR       TO WS005-AD-PO-LINE-NBR.      37220000
372300                                                                  37230000
372400     MOVE DK-TRIP-ID                TO WS005-AD-TRIP-ID.          37240000
372500                                                                  37250000
372600     MOVE WST00002-RCVR-SEQ-NBR     TO WS005-AD-RCVR-SEQ-NBR.     37260000
372700                                                                  37270000
372800     PERFORM 7820-GET-VENDOR-ID.                                  37280000
372900     MOVE PURCHS-ENT-ID             TO WS005-AD-VENDOR-ID.        37290000
373000     SET  WS005-AD-ADD-CDE          TO TRUE.                      37300000
373100     MOVE PV-HOST-INPUT-ID          TO WS005-AD-HOST-INPT-ID.     37310000
373200     MOVE PV-OPER-UNT-ID-PIC9       TO WS005-AD-WHSE.             37320000
373300     SET WS005-AD-VENDOR-SHIPMT     TO TRUE.                      37330000
373400                                                                  37340000
373500******************************************************************37350000
373600* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *37360000
373700******************************************************************37370000
373800 3010-LOAD-ASN-DTL-REC-TO-TEMP.                                   37380000
373900                                                                  37390000
374000     INITIALIZE DCLWST00011.                                      37400000
374100                                                                  37410000
374200     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       37420000
374300     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         37430000
374400     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          37440000
374500     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   37450000
374600     MOVE PC-AD                     TO WST00011-REC-TYP-CDE.      37460000
374700     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 37470000
374800     MOVE WS005-ASN-DTL-REC         TO WST00011-REC-TYP-DESC-TEXT.37480000
374900     MOVE PC-HIGH-NINES             TO WST00011-CSE-DTL-NBR.      37490000
375000                                                                  37500000
375100******************************************************************37510000
375200*                                                                *37520000
375300******************************************************************37530000
375400 3015-GET-ITM-QTYS.                                               37540000
375500                                                                  37550000
375600     EXEC SQL                                                     37560000
375700          SELECT PKSL_ITM_QTY                                     37570000
375800               , DTL_CK_ITM_QTY                                   37580000
375900          INTO  :RECITM-PKSL-ITM-QTY                              37590000
376000               ,:RECITM-DTL-CK-ITM-QTY                            37600000
376100          FROM TRECITM                                            37610000
376200          WHERE ORD_NBR        = :WST00002-PO-NBR                 37620000
376300          AND   ORD_LNE_NBR    = :WST00002-PO-LNE-NBR             37630000
376400          AND   REC_SEQ_NBR    = :WST00002-RCVR-SEQ-NBR           37640000
376410           WITH UR                                                37641008
376500     END-EXEC                                                     37650000
376600                                                                  37660000
376700     EVALUATE TRUE                                                37670000
376800         WHEN SQLCODE = ZERO                                      37680000
376900         WHEN SQLCODE = +100                                      37690000
377000              CONTINUE                                            37700000
377100         WHEN SQLWARN0 NOT = SPACES                               37710000
377200         WHEN SQLCODE NOT = ZERO                                  37720000
377300         WHEN SQLCODE NOT = +100                                  37730000
377400             SET  PS-ERROR         TO TRUE                        37740000
377500             MOVE SQLCODE            TO PV-DISP-SQLCODE           37750000
377600             STRING ' ' WS003-SRC-TASK-NUMBER                     37760000
377700                    ' WSKCS301-3015: GET-ITM-QTYS'                37770000
377800                    ' CALLED BY-'                                 37780000
377900                     WS003-CALLING-PROGRAM-NAME                   37790000
378000                    ' SQLCODE='                                   37800000
378100                     PV-DISP-SQLCODE                              37810000
378200                    ' SUCC='                                      37820000
378300                     WS003-SUCCESS-IND                            37830000
378400             DELIMITED BY SIZE                                    37840000
378500             INTO PV-CICS-MSG-AREA                                37850000
378600             PERFORM 9200-WRITE-TO-CICS-LOG                       37860000
378700             MOVE '3015-GET-ITM-QTYS'                             37870000
378800                              TO DP013-PARAGRAPH                  37880000
378900             MOVE 'SELECT TRECITM'                                37890000
379000                              TO DP013-MESSAGE-TEXT (1)           37900000
379100             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  37910000
379200             STRING ' TRIP ID: '                                  37920000
379300                    PV-DISP-TRIP-ID                               37930000
379400                    ' EXT SHIP ID: '                              37940000
379500                    DK-EXT-SHP-ID                                 37950000
379600                    ' DWNLD TMST: '                               37960000
379700                    PV-CURRENT-TMST                               37970000
379800             DELIMITED BY SIZE                                    37980000
379900             INTO DP013-MESSAGE-TEXT (2)                          37990000
380000             MOVE 'TRECITM '  TO DP013-DB2-TABLE-NAME (1)         38000000
380100             MOVE SQLCA       TO DP013-SQLCA                      38010000
380200             SET DP013-DB2-ABEND  TO TRUE                         38020000
380300             PERFORM 9999-ABEND                                   38030000
380400     END-EVALUATE.                                                38040000
380500                                                                  38050000
380600******************************************************************38060000
380700*                                                                *38070000
380800******************************************************************38080000
380900 3200-CASE-LVL-PROCESSING.                                        38090000
381000                                                                  38100000
381100     PERFORM 3210-OPEN-CS-DTL-CSR.                                38110000
381200                                                                  38120000
381300     MOVE +0 TO PV-HOLD-CS-LVL-PREPK-ID                           38130000
381400                PV-HOLD-CS-LVL-PO-NBR                             38140000
381500                PV-HOLD-CS-LVL-REC-SEQ-NBR.                       38150000
381600                                                                  38160000
381700     SET PS-END-OF-CS-DTL-CSR-NO TO TRUE.                         38170000
381800     PERFORM 3220-FETCH-CS-DTL-CSR                                38180000
381900       UNTIL PS-END-OF-CS-DTL-CSR-YES.                            38190000
382000                                                                  38200000
382100     PERFORM 3230-CLOSE-CS-DTL-CSR.                               38210000
382200                                                                  38220000
382300******************************************************************38230000
382400* OPEN CS_DTL_CSR                                                *38240000
382500******************************************************************38250000
382600 3210-OPEN-CS-DTL-CSR.                                            38260000
382700                                                                  38270000
382800     EXEC SQL                                                     38280000
382900          OPEN CS_DTL_CSR                                         38290000
383000     END-EXEC                                                     38300000
383100                                                                  38310000
383200     EVALUATE TRUE                                                38320000
383300         WHEN SQLCODE = ZERO                                      38330000
383400              CONTINUE                                            38340000
383500         WHEN SQLWARN0 NOT = SPACES                               38350000
383600         WHEN SQLCODE NOT = ZERO                                  38360000
383700             SET  PS-ERROR         TO TRUE                        38370000
383800             MOVE SQLCODE            TO PV-DISP-SQLCODE           38380000
383900             STRING ' ' WS003-SRC-TASK-NUMBER                     38390000
384000                    ' WSKCS301-3210: OPEN-CS-DTL-CSR'             38400000
384100                    ' CALLED BY-'                                 38410000
384200                     WS003-CALLING-PROGRAM-NAME                   38420000
384300                    ' SQLCODE='                                   38430000
384400                     PV-DISP-SQLCODE                              38440000
384500                    ' SUCC='                                      38450000
384600                     WS003-SUCCESS-IND                            38460000
384700             DELIMITED BY SIZE                                    38470000
384800             INTO PV-CICS-MSG-AREA                                38480000
384900             PERFORM 9200-WRITE-TO-CICS-LOG                       38490000
385000             MOVE '3210-OPEN-CS-DTL-CSR'                          38500000
385100                              TO DP013-PARAGRAPH                  38510000
385200             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     38520000
385300                              TO DP013-MESSAGE-TEXT (1)           38530000
385400             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  38540000
385500             STRING ' TRIP ID: '                                  38550000
385600                    PV-DISP-TRIP-ID                               38560000
385700                    ' EXT SHIP ID: '                              38570000
385800                    DK-EXT-SHP-ID                                 38580000
385900                    ' DWNLD TMST: '                               38590000
386000                    PV-CURRENT-TMST                               38600000
386100             DELIMITED BY SIZE                                    38610000
386200             INTO DP013-MESSAGE-TEXT (2)                          38620000
386300             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         38630000
386400             MOVE SQLCA       TO DP013-SQLCA                      38640000
386500             SET DP013-DB2-ABEND  TO TRUE                         38650000
386600             PERFORM 9999-ABEND                                   38660000
386700     END-EVALUATE.                                                38670000
386800                                                                  38680000
386900******************************************************************38690000
387000* FETCH  CS_DTL_CSR                                              *38700000
387100******************************************************************38710000
387200 3220-FETCH-CS-DTL-CSR.                                           38720000
387300                                                                  38730000
387400     EXEC SQL                                                     38740000
387500          FETCH CS_DTL_CSR                                        38750000
387600          INTO                                                    38760000
387700                :WST00002-PO-NBR                                  38770000
387800               ,:WST00002-PO-LNE-NBR                              38780000
387900               ,:WST00002-RCVR-SEQ-NBR                            38790000
388000               ,:WST00002-ASN-LVL-CDE                             38800000
388100               ,:WST00002-PREPK-ID                                38810000
388200               ,:WST00002-CRE-USR-ID                              38820000
388300               ,:WST00002-CRE-TMST                                38830000
388400               ,:WST00002-DWNLD-CDE                               38840000
388500               ,:WST00002-ACTV-CDE                                38850000
388600     END-EXEC                                                     38860000
388700                                                                  38870000
388800     EVALUATE TRUE                                                38880000
388900         WHEN SQLCODE = ZERO                                      38890000
389000              PERFORM 3400-PROCESS-CS-LVL-ASNS                    38900000
389100         WHEN SQLCODE = +100                                      38910000
389200             SET PS-END-OF-CS-DTL-CSR-YES TO TRUE                 38920000
389300         WHEN SQLWARN0 NOT = SPACES                               38930000
389400         WHEN SQLCODE NOT = ZERO                                  38940000
389500         WHEN SQLCODE NOT = +100                                  38950000
389600             SET  PS-ERROR         TO TRUE                        38960000
389700             MOVE SQLCODE            TO PV-DISP-SQLCODE           38970000
389800             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            38980000
389900             MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR   38990000
390000             MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID         39000000
390100             MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR      39010000
390200             STRING ' ' WS003-SRC-TASK-NUMBER                     39020000
390300                    ' WSKCS301-3220: FETCH-CS-DTL-CSR'            39030000
390400                    ' CALLED BY-'                                 39040000
390500                     WS003-CALLING-PROGRAM-NAME                   39050000
390600                    ' SQLCODE='                                   39060000
390700                     PV-DISP-SQLCODE                              39070000
390800                    ' SUCC='                                      39080000
390900                     WS003-SUCCESS-IND                            39090000
391000                    ' PO='                                        39100000
391100                     PV-DISP-PO-NBR                               39110000
391200                    ' RCVR='                                      39120000
391300                     PV-DISP-RCVR-SEQ-NBR                         39130000
391400                    ' PRPK='                                      39140000
391500                     PV-DISP-PREPK-ID                             39150000
391600                    ' LNE='                                       39160000
391700                     PV-DISP-PO-LINE-NBR                          39170000
391800             DELIMITED BY SIZE                                    39180000
391900             INTO PV-CICS-MSG-AREA                                39190000
392000             PERFORM 9200-WRITE-TO-CICS-LOG                       39200000
392100             MOVE '3220-FETCH-CS-DTL-CSR'                         39210000
392200                              TO DP013-PARAGRAPH                  39220000
392300             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     39230000
392400                              TO DP013-MESSAGE-TEXT (1)           39240000
392500             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  39250000
392600             STRING ' TRIP ID: '                                  39260000
392700                    PV-DISP-TRIP-ID                               39270000
392800                    ' EXT SHIP ID: '                              39280000
392900                    DK-EXT-SHP-ID                                 39290000
393000                    ' DWNLD TMST: '                               39300000
393100                    PV-CURRENT-TMST                               39310000
393200             DELIMITED BY SIZE                                    39320000
393300             INTO DP013-MESSAGE-TEXT (2)                          39330000
393400             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         39340000
393500             MOVE SQLCA       TO DP013-SQLCA                      39350000
393600             SET DP013-DB2-ABEND  TO TRUE                         39360000
393700             PERFORM 9999-ABEND                                   39370000
393800     END-EVALUATE.                                                39380000
393900                                                                  39390000
394000     IF PS-WRITE-TO-CSSL-YES                                      39400000
394100      AND SQLCODE = 0                                             39410000
394200         STRING   ' ' WS003-SRC-TASK-NUMBER                       39420000
394300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   39430000
394400                  ' WSKCS301-3220: FETCH-CS-DTL-CSR'              39440000
394500         DELIMITED BY SIZE                                        39450000
394600         INTO PV-CICS-MSG-AREA                                    39460000
394700         PERFORM 9200-WRITE-TO-CICS-LOG                           39470000
394800         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                39480000
394900         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       39490000
395000         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             39500000
395100         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          39510000
395200         STRING   ' ' WS003-SRC-TASK-NUMBER                       39520000
395300                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   39530000
395400                  ' PO NBR: '                                     39540000
395500                  PV-DISP-PO-NBR                                  39550000
395600                  ' RCVR NBR: '                                   39560000
395700                  PV-DISP-RCVR-SEQ-NBR                            39570000
395800                  'PREPACK ID: '                                  39580000
395900                  PV-DISP-PREPK-ID                                39590000
396000                  'PO LINE: '                                     39600000
396100                  PV-DISP-PO-LINE-NBR                             39610000
396200         DELIMITED BY SIZE                                        39620000
396300         INTO PV-CICS-MSG-AREA                                    39630000
396400         PERFORM 9200-WRITE-TO-CICS-LOG                           39640000
396500     END-IF.                                                      39650000
396600                                                                  39660000
396700******************************************************************39670000
396800* CLOSE CS_DTL_CSR                                               *39680000
396900******************************************************************39690000
397000 3230-CLOSE-CS-DTL-CSR.                                           39700000
397100                                                                  39710000
397200     EXEC SQL                                                     39720000
397300          CLOSE CS_DTL_CSR                                        39730000
397400     END-EXEC                                                     39740000
397500                                                                  39750000
397600     EVALUATE TRUE                                                39760000
397700         WHEN SQLCODE = ZERO                                      39770000
397800              CONTINUE                                            39780000
397900         WHEN SQLWARN0 NOT = SPACES                               39790000
398000         WHEN SQLCODE NOT = ZERO                                  39800000
398100             SET  PS-ERROR         TO TRUE                        39810000
398200             MOVE SQLCODE            TO PV-DISP-SQLCODE           39820000
398300             STRING ' ' WS003-SRC-TASK-NUMBER                     39830000
398400                    ' WSKCS301-3230: FETCH-CS-DTL-CSR'            39840000
398500                    ' CALLED BY-'                                 39850000
398600                     WS003-CALLING-PROGRAM-NAME                   39860000
398700                    ' SQLCODE='                                   39870000
398800                     PV-DISP-SQLCODE                              39880000
398900                    ' SUCC='                                      39890000
399000                     WS003-SUCCESS-IND                            39900000
399100             DELIMITED BY SIZE                                    39910000
399200             INTO PV-CICS-MSG-AREA                                39920000
399300             PERFORM 9200-WRITE-TO-CICS-LOG                       39930000
399400             MOVE '3230-CLOSE-CS-DTL-CSR'                         39940000
399500                              TO DP013-PARAGRAPH                  39950000
399600             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     39960000
399700                              TO DP013-MESSAGE-TEXT (1)           39970000
399800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  39980000
399900             STRING ' TRIP ID: '                                  39990000
400000                    PV-DISP-TRIP-ID                               40000000
400100                    ' EXT SHIP ID: '                              40010000
400200                    DK-EXT-SHP-ID                                 40020000
400300                    ' DWNLD TMST: '                               40030000
400400                    PV-CURRENT-TMST                               40040000
400500             DELIMITED BY SIZE                                    40050000
400600             INTO DP013-MESSAGE-TEXT (2)                          40060000
400700             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         40070000
400800             MOVE SQLCA       TO DP013-SQLCA                      40080000
400900             SET DP013-DB2-ABEND  TO TRUE                         40090000
401000             PERFORM 9999-ABEND                                   40100000
401100     END-EVALUATE.                                                40110000
401200                                                                  40120000
401300******************************************************************40130000
401400* PROCESS CASE LEVEL ASNS                                        *40140000
401500* 3600-, 5000- & 5500- EACH EXEC A MAIN CURSOR - FROM EACH FETCH,*40150000
401600* THE CASE LEVEL RECORD CREATION PROCESS IS THE SAME:            *40160000
401700* SEE 8A - 8C IN PGM DOC ABOVE...                                *40170000
401800*        6650-MULTIPLE-SKU-CHECK                                 *40180000
401900*        6000-CARTON-CONTENT-DTLS                                *40190000
402000*            6120-FETCH-CTN-CNTNT-CSR                            *40200000
402100*               WHEN SQLCODE = 0                                 *40210000
402200*                  PERFORM:                                      *40220000
402300*                    6200-CREATE-CS-LVL-DTL                      *40230000
402400*                    (CS DTL FOR ASN_DWNLD)                      *40240000
402500*               WHEN SQLCODE = 100                               *40250000
402600*                  PERFORM:                                      *40260000
402700*                    6600-CREATE-CS-LVL-HDR                      *40270000
402800*                    (CS HDR FOR ASN_DWNLD)                      *40280000
402900******************************************************************40290000
403000 3400-PROCESS-CS-LVL-ASNS.                                        40300000
403100                                                                  40310000
403200     IF WST00002-PO-NBR = PV-HOLD-CS-LVL-PO-NBR                   40320000
403300        IF WST00002-RCVR-SEQ-NBR = PV-HOLD-CS-LVL-REC-SEQ-NBR     40330000
403400           IF PS-PACK-BY-STORE-YES                                40340000
403500              CONTINUE                                            40350000
403600           ELSE                                                   40360000
403700              IF WST00002-PREPK-ID > 0                            40370000
403800                 IF WST00002-PREPK-ID = PV-HOLD-CS-LVL-PREPK-ID   40380000
403900                    CONTINUE                                      40390000
404000                 ELSE                                             40400000
404100                    PERFORM 3600-GET-PREPACK-CASES                40410000
404200                    MOVE WST00002-PREPK-ID                        40420000
404300                             TO PV-HOLD-CS-LVL-PREPK-ID           40430000
404400                 END-IF                                           40440000
404500              ELSE                                                40450000
404600                 PERFORM 5000-GET-LN-LVL-CASES                    40460000
404700              END-IF                                              40470000
404800           END-IF                                                 40480000
404900        ELSE                                                      40490000
405000           PERFORM 3450-DETERMINE-PBS                             40500000
405100           IF PS-PACK-BY-STORE-YES                                40510000
405200              PERFORM 5500-GET-PBS-CASES                          40520000
405300*** DMH ADDED 5/29/13 - BEGIN                                     40530000
405400           ELSE                                                   40540000
405500               IF WST00002-PREPK-ID > 0                           40550000
405600                  PERFORM 3600-GET-PREPACK-CASES                  40560000
405700                  MOVE WST00002-PREPK-ID                          40570000
405800                    TO PV-HOLD-CS-LVL-PREPK-ID                    40580000
405900               ELSE                                               40590000
406000                  PERFORM 5000-GET-LN-LVL-CASES                   40600000
406100               END-IF                                             40610000
406200*** DMH ADDED 5/29/13 - END                                       40620000
406300           END-IF                                                 40630000
406400           MOVE WST00002-RCVR-SEQ-NBR                             40640000
406500                   TO PV-HOLD-CS-LVL-REC-SEQ-NBR                  40650000
406600*DMH 5/29  MOVE +0 TO PV-HOLD-CS-LVL-PREPK-ID                     40660000
406700           MOVE WST00002-PREPK-ID TO PV-HOLD-CS-LVL-PREPK-ID      40670000
406800        END-IF                                                    40680000
406900     ELSE                                                         40690000
407000        PERFORM 3450-DETERMINE-PBS                                40700000
407100        IF PS-PACK-BY-STORE-YES                                   40710000
407200           PERFORM 5500-GET-PBS-CASES                             40720000
407300        ELSE                                                      40730000
407400           IF WST00002-PREPK-ID > 0                               40740000
407500             PERFORM 3600-GET-PREPACK-CASES                       40750000
407600             MOVE WST00002-PREPK-ID                               40760000
407700                TO PV-HOLD-CS-LVL-PREPK-ID                        40770000
407800           ELSE                                                   40780000
407900             PERFORM 5000-GET-LN-LVL-CASES                        40790000
408000           END-IF                                                 40800000
408100        END-IF                                                    40810000
408200        MOVE WST00002-PO-NBR       TO PV-HOLD-CS-LVL-PO-NBR       40820000
408300        MOVE WST00002-RCVR-SEQ-NBR TO PV-HOLD-CS-LVL-REC-SEQ-NBR  40830000
408400        MOVE WST00002-PREPK-ID     TO PV-HOLD-CS-LVL-PREPK-ID     40840000
408500     END-IF.                                                      40850000
408600                                                                  40860000
408700******************************************************************40870000
408800*                                                                *40880000
408900******************************************************************40890000
409000 3450-DETERMINE-PBS.                                              40900000
409100                                                                  40910000
409200     SET PS-PACK-BY-STORE-NO TO TRUE.                             40920000
409300                                                                  40930000
409400     EXEC SQL                                                     40940000
409500          SELECT PACK_BY_ST_IND                                   40950000
409600          INTO  :RECEIV-PACK-BY-ST-IND                            40960000
409700          FROM TRECEIV                                            40970000
409800          WHERE ORD_NBR        = :WST00002-PO-NBR                 40980000
409900          AND   REC_SEQ_NBR    = :WST00002-RCVR-SEQ-NBR           40990000
409910           WITH UR                                                40991008
410000     END-EXEC                                                     41000000
410100                                                                  41010000
410200     EVALUATE TRUE                                                41020000
410300         WHEN SQLCODE = ZERO                                      41030000
410400              IF RECEIV-PACK-BY-ST-IND = PC-Y                     41040000
410500                 SET PS-PACK-BY-STORE-YES TO TRUE                 41050000
410600              END-IF                                              41060000
410700         WHEN SQLCODE = +100                                      41070000
410800              CONTINUE                                            41080000
410900         WHEN SQLWARN0 NOT = SPACES                               41090000
411000         WHEN SQLCODE NOT = ZERO                                  41100000
411100         WHEN SQLCODE NOT = +100                                  41110000
411200            SET  PS-ERROR         TO TRUE                         41120000
411300            MOVE SQLCODE            TO PV-DISP-SQLCODE            41130000
411400            STRING ' ' WS003-SRC-TASK-NUMBER                      41140000
411500                   ' WSKCS301-3450: DETERMINE-PBS'                41150000
411600                   ' CALLED BY-'                                  41160000
411700                    WS003-CALLING-PROGRAM-NAME                    41170000
411800                   ' SQLCODE='                                    41180000
411900                    PV-DISP-SQLCODE                               41190000
412000                   ' SUCC='                                       41200000
412100                    WS003-SUCCESS-IND                             41210000
412200            DELIMITED BY SIZE                                     41220000
412300            INTO PV-CICS-MSG-AREA                                 41230000
412400            PERFORM 9200-WRITE-TO-CICS-LOG                        41240000
412500            MOVE '3450-DETERMINE-PBS'                             41250000
412600                             TO DP013-PARAGRAPH                   41260000
412700            MOVE 'SELECT TRECEIV'                                 41270000
412800                             TO DP013-MESSAGE-TEXT (1)            41280000
412900            MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                   41290000
413000            STRING ' TRIP ID: '                                   41300000
413100                   PV-DISP-TRIP-ID                                41310000
413200                   ' EXT SHIP ID: '                               41320000
413300                   DK-EXT-SHP-ID                                  41330000
413400                   ' DWNLD TMST: '                                41340000
413500                   PV-CURRENT-TMST                                41350000
413600            DELIMITED BY SIZE                                     41360000
413700            INTO DP013-MESSAGE-TEXT (2)                           41370000
413800            MOVE 'TRECEIV '  TO DP013-DB2-TABLE-NAME (1)          41380000
413900            MOVE SQLCA       TO DP013-SQLCA                       41390000
414000            SET DP013-DB2-ABEND  TO TRUE                          41400000
414100            PERFORM 9999-ABEND                                    41410000
414200     END-EVALUATE.                                                41420000
414300                                                                  41430000
414400******************************************************************41440000
414500* GET PREPACK CASES                                              *41450000
414600******************************************************************41460000
414700 3600-GET-PREPACK-CASES.                                          41470000
414800                                                                  41480000
414900     PERFORM 3810-OPEN-CARTON-PK-CSR.                             41490000
415000                                                                  41500000
415100     SET PS-END-OF-CARTON-PK-CSR-NO TO TRUE.                      41510000
415200     PERFORM 3820-FETCH-CARTON-PK-CSR                             41520000
415300       UNTIL PS-END-OF-CARTON-PK-CSR-YES.                         41530000
415400                                                                  41540000
415500     PERFORM 3830-CLOSE-CARTON-PK-CSR.                            41550000
415600                                                                  41560000
415700******************************************************************41570000
415800* OPEN CARTON_PK_CSR                                             *41580000
415900******************************************************************41590000
416000 3810-OPEN-CARTON-PK-CSR.                                         41600000
416100                                                                  41610000
416200     EXEC SQL                                                     41620000
416300          OPEN CARTON_PK_CSR                                      41630000
416400     END-EXEC                                                     41640000
416500                                                                  41650000
416600     EVALUATE TRUE                                                41660000
416700         WHEN SQLCODE = ZERO                                      41670000
416800              CONTINUE                                            41680000
416900         WHEN SQLWARN0 NOT = SPACES                               41690000
417000         WHEN SQLCODE NOT = ZERO                                  41700000
417100             SET  PS-ERROR         TO TRUE                        41710000
417200             MOVE SQLCODE            TO PV-DISP-SQLCODE           41720000
417300             STRING ' ' WS003-SRC-TASK-NUMBER                     41730000
417400                    ' WSKCS301-3810: OPEN-CARTON-PK-CSR'          41740000
417500                    ' CALLED BY-'                                 41750000
417600                     WS003-CALLING-PROGRAM-NAME                   41760000
417700                    ' SQLCODE='                                   41770000
417800                     PV-DISP-SQLCODE                              41780000
417900                    ' SUCC='                                      41790000
418000                     WS003-SUCCESS-IND                            41800000
418100             DELIMITED BY SIZE                                    41810000
418200             INTO PV-CICS-MSG-AREA                                41820000
418300             PERFORM 9200-WRITE-TO-CICS-LOG                       41830000
418400             MOVE '3810-OPEN-CARTON-PK-CSR'                       41840000
418500                              TO DP013-PARAGRAPH                  41850000
418600             MOVE 'SELECT TSHIPMT'                                41860000
418700                              TO DP013-MESSAGE-TEXT (1)           41870000
418800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  41880000
418900             STRING ' TRIP ID: '                                  41890000
419000                    PV-DISP-TRIP-ID                               41900000
419100                    ' EXT SHIP ID: '                              41910000
419200                    DK-EXT-SHP-ID                                 41920000
419300                    ' DWNLD TMST: '                               41930000
419400                    PV-CURRENT-TMST                               41940000
419500             DELIMITED BY SIZE                                    41950000
419600             INTO DP013-MESSAGE-TEXT (2)                          41960000
419700             MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (1)         41970000
419800             MOVE SQLCA       TO DP013-SQLCA                      41980000
419900             SET DP013-DB2-ABEND  TO TRUE                         41990000
420000             PERFORM 9999-ABEND                                   42000000
420100     END-EVALUATE.                                                42010000
420200                                                                  42020000
420300******************************************************************42030000
420400* FETCH  CARTON_PK_CSR                                           *42040000
420500******************************************************************42050000
420600 3820-FETCH-CARTON-PK-CSR.                                        42060000
420700                                                                  42070000
420800     EXEC SQL                                                     42080000
420900          FETCH CARTON_PK_CSR                                     42090000
421000          INTO  :PV-UNION-TYPE                                    42100000
421100               ,:SHPUNT-SHIPT-UNT-ID                              42110000
421200     END-EXEC                                                     42120000
421300                                                                  42130000
421400     EVALUATE TRUE                                                42140000
421500         WHEN SQLCODE = ZERO                                      42150000
421600              PERFORM 6650-MULTIPLE-SKU-CHECK                     42160000
421700              PERFORM 6000-CARTON-CONTENT-DTLS                    42170000
421800         WHEN SQLCODE = +100                                      42180000
421900             SET PS-END-OF-CARTON-PK-CSR-YES TO TRUE              42190000
422000         WHEN SQLWARN0 NOT = SPACES                               42200000
422100         WHEN SQLCODE NOT = ZERO                                  42210000
422200         WHEN SQLCODE NOT = +100                                  42220000
422300             SET  PS-ERROR         TO TRUE                        42230000
422400             MOVE SQLCODE            TO PV-DISP-SQLCODE           42240000
422500             STRING ' ' WS003-SRC-TASK-NUMBER                     42250000
422600                    ' WSKCS301-3820: FETCH-CARTON-PK-CSR'         42260000
422700                    ' CALLED BY-'                                 42270000
422800                     WS003-CALLING-PROGRAM-NAME                   42280000
422900                    ' SQLCODE='                                   42290000
423000                     PV-DISP-SQLCODE                              42300000
423100                    ' SUCC='                                      42310000
423200                     WS003-SUCCESS-IND                            42320000
423300             DELIMITED BY SIZE                                    42330000
423400             INTO PV-CICS-MSG-AREA                                42340000
423500             PERFORM 9200-WRITE-TO-CICS-LOG                       42350000
423600             MOVE '3820-FETCH-CARTON-PK-CSR'                      42360000
423700                              TO DP013-PARAGRAPH                  42370000
423800             MOVE 'SELECT TSHIPMT'                                42380000
423900                              TO DP013-MESSAGE-TEXT (1)           42390000
424000             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  42400000
424100             STRING ' TRIP ID: '                                  42410000
424200                    PV-DISP-TRIP-ID                               42420000
424300                    ' EXT SHIP ID: '                              42430000
424400                    DK-EXT-SHP-ID                                 42440000
424500                    ' DWNLD TMST: '                               42450000
424600                    PV-CURRENT-TMST                               42460000
424700             DELIMITED BY SIZE                                    42470000
424800             INTO DP013-MESSAGE-TEXT (2)                          42480000
424900             MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (1)         42490000
425000             MOVE SQLCA       TO DP013-SQLCA                      42500000
425100             SET DP013-DB2-ABEND  TO TRUE                         42510000
425200             PERFORM 9999-ABEND                                   42520000
425300     END-EVALUATE.                                                42530000
425400                                                                  42540000
425500     IF PS-WRITE-TO-CSSL-YES                                      42550000
425600      AND SQLCODE = 0                                             42560000
425700         STRING   ' ' WS003-SRC-TASK-NUMBER                       42570000
425800                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   42580000
425900                  ' WSKCS301-3280: FETCH-CARTON-PK-CSR'           42590000
426000         DELIMITED BY SIZE                                        42600000
426100         INTO PV-CICS-MSG-AREA                                    42610000
426200         PERFORM 9200-WRITE-TO-CICS-LOG                           42620000
426300         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        42630000
426400         STRING ' ' WS003-SRC-TASK-NUMBER                         42640000
426500                ' SHIP UNT ID: '                                  42650000
426600                PV-DISP-SHIPT-UNT-ID                              42660000
426700         DELIMITED BY SIZE                                        42670000
426800         INTO PV-CICS-MSG-AREA                                    42680000
426900         PERFORM 9200-WRITE-TO-CICS-LOG                           42690000
427000     END-IF.                                                      42700000
427100                                                                  42710000
427200******************************************************************42720000
427300* CLOSE CARTON_PK_CSR                                            *42730000
427400******************************************************************42740000
427500 3830-CLOSE-CARTON-PK-CSR.                                        42750000
427600                                                                  42760000
427700     EXEC SQL                                                     42770000
427800          CLOSE CARTON_PK_CSR                                     42780000
427900     END-EXEC                                                     42790000
428000                                                                  42800000
428100     EVALUATE TRUE                                                42810000
428200         WHEN SQLCODE = ZERO                                      42820000
428300              CONTINUE                                            42830000
428400         WHEN SQLWARN0 NOT = SPACES                               42840000
428500         WHEN SQLCODE NOT = ZERO                                  42850000
428600             SET  PS-ERROR         TO TRUE                        42860000
428700             MOVE SQLCODE            TO PV-DISP-SQLCODE           42870000
428800             STRING ' ' WS003-SRC-TASK-NUMBER                     42880000
428900                    ' WSKCS301-3830: CLOSE-CARTON-PK-CSR'         42890000
429000                    ' CALLED BY-'                                 42900000
429100                     WS003-CALLING-PROGRAM-NAME                   42910000
429200                    ' SQLCODE='                                   42920000
429300                     PV-DISP-SQLCODE                              42930000
429400                    ' SUCC='                                      42940000
429500                     WS003-SUCCESS-IND                            42950000
429600             DELIMITED BY SIZE                                    42960000
429700             INTO PV-CICS-MSG-AREA                                42970000
429800             PERFORM 9200-WRITE-TO-CICS-LOG                       42980000
429900             MOVE '3830-CLOSE-CARTON-PK-CSR'                      42990000
430000                              TO DP013-PARAGRAPH                  43000000
430100             MOVE 'SELECT TSHIPMT'                                43010000
430200                              TO DP013-MESSAGE-TEXT (1)           43020000
430300             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  43030000
430400             STRING ' TRIP ID: '                                  43040000
430500                    PV-DISP-TRIP-ID                               43050000
430600                    ' EXT SHIP ID: '                              43060000
430700                    DK-EXT-SHP-ID                                 43070000
430800                    ' DWNLD TMST: '                               43080000
430900                    PV-CURRENT-TMST                               43090000
431000             DELIMITED BY SIZE                                    43100000
431100             INTO DP013-MESSAGE-TEXT (2)                          43110000
431200             MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (1)         43120000
431300             MOVE SQLCA       TO DP013-SQLCA                      43130000
431400             SET DP013-DB2-ABEND  TO TRUE                         43140000
431500             PERFORM 9999-ABEND                                   43150000
431600     END-EVALUATE.                                                43160000
431700                                                                  43170000
431800******************************************************************43180000
431900* GET LINE LEVEL CASES                                           *43190000
432000******************************************************************43200000
432100 5000-GET-LN-LVL-CASES.                                           43210000
432200                                                                  43220000
432300     PERFORM 5010-OPEN-CARTON-CSR.                                43230000
432400                                                                  43240000
432500     SET PS-END-OF-CARTON-CSR-NO TO TRUE.                         43250000
432600     PERFORM 5020-FETCH-CARTON-CSR                                43260000
432700       UNTIL PS-END-OF-CARTON-CSR-YES.                            43270000
432800                                                                  43280000
432900     PERFORM 5030-CLOSE-CARTON-CSR.                               43290000
433000                                                                  43300000
433100******************************************************************43310000
433200* OPEN CARTON_CSR                                                *43320000
433300******************************************************************43330000
433400 5010-OPEN-CARTON-CSR.                                            43340000
433500                                                                  43350000
433600     EXEC SQL                                                     43360000
433700          OPEN CARTON_CSR                                         43370000
433800     END-EXEC                                                     43380000
433900                                                                  43390000
434000     EVALUATE TRUE                                                43400000
434100         WHEN SQLCODE = ZERO                                      43410000
434200              CONTINUE                                            43420000
434300         WHEN SQLWARN0 NOT = SPACES                               43430000
434400         WHEN SQLCODE NOT = ZERO                                  43440000
434500             SET  PS-ERROR         TO TRUE                        43450000
434600             MOVE SQLCODE            TO PV-DISP-SQLCODE           43460000
434700             STRING ' ' WS003-SRC-TASK-NUMBER                     43470000
434800                    ' WSKCS301-5010: OPEN-CARTON-CSR'             43480000
434900                    ' CALLED BY-'                                 43490000
435000                     WS003-CALLING-PROGRAM-NAME                   43500000
435100                    ' SQLCODE='                                   43510000
435200                     PV-DISP-SQLCODE                              43520000
435300                    ' SUCC='                                      43530000
435400                     WS003-SUCCESS-IND                            43540000
435500             DELIMITED BY SIZE                                    43550000
435600             INTO PV-CICS-MSG-AREA                                43560000
435700             PERFORM 9200-WRITE-TO-CICS-LOG                       43570000
435800             MOVE '5010-OPEN-CARTON-CSR'                          43580000
435900                              TO DP013-PARAGRAPH                  43590000
436000             MOVE 'SELECT TSHIPMT'                                43600000
436100                              TO DP013-MESSAGE-TEXT (1)           43610000
436200             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  43620000
436300             STRING ' TRIP ID: '                                  43630000
436400                    PV-DISP-TRIP-ID                               43640000
436500                    ' EXT SHIP ID: '                              43650000
436600                    DK-EXT-SHP-ID                                 43660000
436700                    ' DWNLD TMST: '                               43670000
436800                    PV-CURRENT-TMST                               43680000
436900             DELIMITED BY SIZE                                    43690000
437000             INTO DP013-MESSAGE-TEXT (2)                          43700000
437100             MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (1)         43710000
437200             MOVE SQLCA       TO DP013-SQLCA                      43720000
437300             SET DP013-DB2-ABEND  TO TRUE                         43730000
437400             PERFORM 9999-ABEND                                   43740000
437500     END-EVALUATE.                                                43750000
437600                                                                  43760000
437700******************************************************************43770000
437800* FETCH  CARTON_CSR                                              *43780000
437900******************************************************************43790000
438000 5020-FETCH-CARTON-CSR.                                           43800000
438100                                                                  43810000
438200     EXEC SQL                                                     43820000
438300          FETCH CARTON_CSR                                        43830000
438400          INTO  :PV-UNION-TYPE                                    43840000
438500               ,:SHPUNT-SHIPT-UNT-ID                              43850000
438600     END-EXEC                                                     43860000
438700                                                                  43870000
438800     EVALUATE TRUE                                                43880000
438900         WHEN SQLCODE = ZERO                                      43890000
439000              PERFORM 6650-MULTIPLE-SKU-CHECK                     43900000
439100*ROOPA START-CHECK NOT TO INSERT SAME SKU MULTIPLE TIMES          43910000
439200              PERFORM 5020A-CHK-SKU-EXIST                         43920000
439300              IF  PS-SKU-EXISTS-ON-DWNLD-YES                      43930000
439400                  SET PS-SKU-EXISTS-ON-DWNLD-NO TO TRUE           43940000
439500              ELSE                                                43950000
439600                  PERFORM 6000-CARTON-CONTENT-DTLS                43960000
439700              END-IF                                              43970000
439800*ROOPA END                                                        43980000
439900         WHEN SQLCODE = +100                                      43990000
440000             SET PS-END-OF-CARTON-CSR-YES TO TRUE                 44000000
440100         WHEN SQLWARN0 NOT = SPACES                               44010000
440200         WHEN SQLCODE NOT = ZERO                                  44020000
440300         WHEN SQLCODE NOT = +100                                  44030000
440400             SET  PS-ERROR         TO TRUE                        44040000
440500             MOVE SQLCODE            TO PV-DISP-SQLCODE           44050000
440600             STRING ' ' WS003-SRC-TASK-NUMBER                     44060000
440700                    ' WSKCS301-5020: FETCH-CARTON-CSR'            44070000
440800                    ' CALLED BY-'                                 44080000
440900                     WS003-CALLING-PROGRAM-NAME                   44090000
441000                    ' SQLCODE='                                   44100000
441100                     PV-DISP-SQLCODE                              44110000
441200                    ' SUCC='                                      44120000
441300                     WS003-SUCCESS-IND                            44130000
441400             DELIMITED BY SIZE                                    44140000
441500             INTO PV-CICS-MSG-AREA                                44150000
441600             PERFORM 9200-WRITE-TO-CICS-LOG                       44160000
441700             MOVE '5020-FETCH-CARTON-CSR'                         44170000
441800                              TO DP013-PARAGRAPH                  44180000
441900             MOVE 'SELECT TSHIPMT'                                44190000
442000                              TO DP013-MESSAGE-TEXT (1)           44200000
442100             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  44210000
442200             STRING ' TRIP ID: '                                  44220000
442300                    PV-DISP-TRIP-ID                               44230000
442400                    ' EXT SHIP ID: '                              44240000
442500                    DK-EXT-SHP-ID                                 44250000
442600                    ' DWNLD TMST: '                               44260000
442700                    PV-CURRENT-TMST                               44270000
442800             DELIMITED BY SIZE                                    44280000
442900             INTO DP013-MESSAGE-TEXT (2)                          44290000
443000             MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (1)         44300000
443100             MOVE SQLCA       TO DP013-SQLCA                      44310000
443200             SET DP013-DB2-ABEND  TO TRUE                         44320000
443300             PERFORM 9999-ABEND                                   44330000
443400     END-EVALUATE.                                                44340000
443500                                                                  44350000
443600     IF PS-WRITE-TO-CSSL-YES                                      44360000
443700      AND SQLCODE = 0                                             44370000
443800         STRING ' ' WS003-SRC-TASK-NUMBER                         44380000
443900                ' ' PV-DISP-EXT-SHP-ID (1:10)                     44390000
444000                ' WSKCS301-5020: FETCH-CARTON-DSR'                44400000
444100         DELIMITED BY SIZE                                        44410000
444200         INTO PV-CICS-MSG-AREA                                    44420000
444300         PERFORM 9200-WRITE-TO-CICS-LOG                           44430000
444400         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        44440000
444500         STRING  ' ' WS003-SRC-TASK-NUMBER                        44450000
444600                 ' SHIP UNT ID: '                                 44460000
444700                 PV-DISP-SHIPT-UNT-ID                             44470000
444800         DELIMITED BY SIZE                                        44480000
444900         INTO PV-CICS-MSG-AREA                                    44490000
445000         PERFORM 9200-WRITE-TO-CICS-LOG                           44500000
445100     END-IF.                                                      44510000
445200                                                                  44520000
445300*ROOPA START                                                      44530000
445400******************************************************************44540000
445500* CHECK TO SEE IF THE CARTON HAS MULTIPLE SKU'S. IF YES THEN CHECK44550000
445600* TO SEE IT ALREADY EXISTS ON WST_ASN_DWNLD TABLE.               *44560000
445700* THIS CHECK IS TO AVOID MULTIPLE INSERTION OF SAME SKU'S IN TBL *44570000
445800******************************************************************44580000
445900 5020A-CHK-SKU-EXIST.                                             44590000
446000     IF PS-MULTIPLE-SKU-YES                                       44600000
446100        MOVE WST00011-REC-TYP-DESC-TEXT TO DK-REC-TYP-DESC-C      44610000
446200        MOVE '%'                        TO DK-DUMMY-WILDCRD2      44620000
446300                                                                  44630000
446400        EXEC SQL                                                  44640000
446500             SELECT EXT_SHP_ID                                    44650000
446600               INTO :WST00011-EXT-SHP-ID                          44660000
446700               FROM WST_ASN_DWNLD A                               44670000
446800              WHERE A.EXT_SHP_ID  = :DK-EXT-SHP-ID                44680000
446900                AND A.REC_TYP_CDE = 'CH'                          44690000
447000                AND A.CRE_TMST    = :WST00011-CRE-TMST            44700000
447100                AND A.REC_TYP_DESC LIKE 'DK-REC-TYP-DESC-P'       44710000
447200                WITH UR                                           44720000
447300        END-EXEC                                                  44730000
447400                                                                  44740000
447500        EVALUATE TRUE                                             44750000
447600           WHEN SQLCODE = ZERO                                    44760000
447700                SET PS-SKU-EXISTS-ON-DWNLD-YES TO TRUE            44770000
447800                IF PS-WRITE-TO-CSSL-YES                           44780000
447900                   STRING ' ' WS003-SRC-TASK-NUMBER               44790000
448000                          ' ' PV-DISP-EXT-SHP-ID (1:10)           44800000
448100                          ' WSKCS301-5020A:CHK-SKU-EXISTS'        44810000
448200                   DELIMITED BY SIZE                              44820000
448300                   INTO PV-CICS-MSG-AREA                          44830000
448400                   PERFORM 9200-WRITE-TO-CICS-LOG                 44840000
448500                   MOVE DK-EXT-SHP-ID TO PV-DISP-SHIPT-UNT-ID     44850000
448600                   STRING  ' ' WS003-SRC-TASK-NUMBER              44860000
448700                           ' SHIP UNT ID: '                       44870000
448800                           PV-DISP-SHIPT-UNT-ID                   44880000
448900                   DELIMITED BY SIZE                              44890000
449000                   INTO PV-CICS-MSG-AREA                          44900000
449100                   PERFORM 9200-WRITE-TO-CICS-LOG                 44910000
449200                END-IF                                            44920000
449300           WHEN SQLCODE = +100                                    44930000
449400                IF PS-WRITE-TO-CSSL-YES                           44940000
449500                   STRING ' ' WS003-SRC-TASK-NUMBER               44950000
449600                          ' ' PV-DISP-EXT-SHP-ID (1:10)           44960000
449700                          ' WSKCS301-5020A:CHK-SKU-EXISTS'        44970000
449800                   DELIMITED BY SIZE                              44980000
449900                   INTO PV-CICS-MSG-AREA                          44990000
450000                   PERFORM 9200-WRITE-TO-CICS-LOG                 45000000
450100                   MOVE DK-EXT-SHP-ID TO PV-DISP-SHIPT-UNT-ID     45010000
450200                   STRING  ' ' WS003-SRC-TASK-NUMBER              45020000
450300                           ' SHIP UNT ID: '                       45030000
450400                           PV-DISP-SHIPT-UNT-ID                   45040000
450500                   DELIMITED BY SIZE                              45050000
450600                   INTO PV-CICS-MSG-AREA                          45060000
450700                   PERFORM 9200-WRITE-TO-CICS-LOG                 45070000
450800                END-IF                                            45080000
450900                CONTINUE                                          45090000
451000           WHEN SQLWARN0 NOT = SPACES                             45100000
451100           WHEN SQLCODE NOT = ZERO                                45110000
451200                MOVE SQLCODE         TO WS003-SQLCODE             45120000
451300                SET  PS-ERROR        TO TRUE                      45130000
451400                MOVE SQLCODE         TO PV-DISP-SQLCODE           45140000
451500                STRING ' ' WS003-SRC-TASK-NUMBER                  45150000
451600                      ' WSKCS301-5020A: CHK-SKU-EXISTS'           45160000
451700                      ' CALLED BY-'                               45170000
451800                       WS003-CALLING-PROGRAM-NAME                 45180000
451900                      ' SQLCODE='                                 45190000
452000                       PV-DISP-SQLCODE                            45200000
452100                      ' SUCC='                                    45210000
452200                       WS003-SUCCESS-IND                          45220000
452300                DELIMITED BY SIZE                                 45230000
452400                INTO PV-CICS-MSG-AREA                             45240000
452500                PERFORM 9200-WRITE-TO-CICS-LOG                    45250000
452600                MOVE '5020A-CHK-SKU-EXISTS'                       45260000
452700                                TO DP013-PARAGRAPH                45270000
452800                MOVE 'SELECT EXT_SHP_ID'                          45280000
452900                                TO DP013-MESSAGE-TEXT (1)         45290000
453000                MOVE DK-EXT-SHP-ID TO PV-DISP-EXT-SHP-ID          45300000
453100                STRING ' EXT SHP ID: '                            45310000
453200                       PV-DISP-EXT-SHP-ID                         45320000
453300                       ' DWNLD TMST: '                            45330000
453400                       PV-CURRENT-TMST                            45340000
453500                DELIMITED BY SIZE                                 45350000
453600                INTO DP013-MESSAGE-TEXT (2)                       45360000
453700                MOVE 'WST_ASN-DWNLD '  TO DP013-DB2-TABLE-NAME (1)45370000
453800                MOVE SQLCA             TO DP013-SQLCA             45380000
453900                SET DP013-DB2-ABEND    TO TRUE                    45390000
454000                PERFORM 9999-ABEND                                45400000
454100        END-EVALUATE                                              45410000
454200     END-IF.                                                      45420000
454300*ROOPA END                                                        45430000
454400******************************************************************45440000
454500* CLOSE CARTON_CSR                                               *45450000
454600******************************************************************45460000
454700 5030-CLOSE-CARTON-CSR.                                           45470000
454800                                                                  45480000
454900     EXEC SQL                                                     45490000
455000          CLOSE CARTON_CSR                                        45500000
455100     END-EXEC                                                     45510000
455200                                                                  45520000
455300     EVALUATE TRUE                                                45530000
455400         WHEN SQLCODE = ZERO                                      45540000
455500              CONTINUE                                            45550000
455600         WHEN SQLWARN0 NOT = SPACES                               45560000
455700         WHEN SQLCODE NOT = ZERO                                  45570000
455800             SET  PS-ERROR         TO TRUE                        45580000
455900             MOVE SQLCODE            TO PV-DISP-SQLCODE           45590000
456000             STRING ' ' WS003-SRC-TASK-NUMBER                     45600000
456100                    ' WSKCS301-5030: CLOSE-CARTON-CSR'            45610000
456200                    ' CALLED BY-'                                 45620000
456300                     WS003-CALLING-PROGRAM-NAME                   45630000
456400                    ' SQLCODE='                                   45640000
456500                     PV-DISP-SQLCODE                              45650000
456600                    ' SUCC='                                      45660000
456700                     WS003-SUCCESS-IND                            45670000
456800             DELIMITED BY SIZE                                    45680000
456900             INTO PV-CICS-MSG-AREA                                45690000
457000             PERFORM 9200-WRITE-TO-CICS-LOG                       45700000
457100             MOVE '5030-CLOSE-CARTON-CSR'                         45710000
457200                              TO DP013-PARAGRAPH                  45720000
457300             MOVE 'SELECT TSHIPMT'                                45730000
457400                              TO DP013-MESSAGE-TEXT (1)           45740000
457500             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  45750000
457600             STRING ' TRIP ID: '                                  45760000
457700                    PV-DISP-TRIP-ID                               45770000
457800                    ' EXT SHIP ID: '                              45780000
457900                    DK-EXT-SHP-ID                                 45790000
458000                    ' DWNLD TMST: '                               45800000
458100                    PV-CURRENT-TMST                               45810000
458200             DELIMITED BY SIZE                                    45820000
458300             INTO DP013-MESSAGE-TEXT (2)                          45830000
458400             MOVE 'TSHIPMT '  TO DP013-DB2-TABLE-NAME (1)         45840000
458500             MOVE SQLCA       TO DP013-SQLCA                      45850000
458600             SET DP013-DB2-ABEND  TO TRUE                         45860000
458700             PERFORM 9999-ABEND                                   45870000
458800     END-EVALUATE.                                                45880000
458900                                                                  45890000
459000******************************************************************45900000
459100* GET PACK BY STORE CASES                                        *45910000
459200******************************************************************45920000
459300 5500-GET-PBS-CASES.                                              45930000
459400                                                                  45940000
459500     PERFORM 5510-OPEN-PBS-CS-CSR.                                45950000
459600                                                                  45960000
459700     SET PS-END-OF-PBS-CS-CSR-NO TO TRUE.                         45970000
459800     PERFORM 5520-FETCH-PBS-CS-CSR                                45980000
459900       UNTIL PS-END-OF-PBS-CS-CSR-YES.                            45990000
460000                                                                  46000000
460100     PERFORM 5530-CLOSE-PBS-CS-CSR.                               46010000
460200                                                                  46020000
460300******************************************************************46030000
460400* OPEN PBS_CS_CSR                                                *46040000
460500******************************************************************46050000
460600 5510-OPEN-PBS-CS-CSR.                                            46060000
460700                                                                  46070000
460800     EXEC SQL                                                     46080000
460900          OPEN PBS_CS_CSR                                         46090000
461000     END-EXEC                                                     46100000
461100                                                                  46110000
461200     EVALUATE TRUE                                                46120000
461300         WHEN SQLCODE = ZERO                                      46130000
461400         WHEN SQLCODE = +100                                      46140000
461500              CONTINUE                                            46150000
461600         WHEN SQLWARN0 NOT = SPACES                               46160000
461700         WHEN SQLCODE NOT = ZERO                                  46170000
461800         WHEN SQLCODE NOT = +100                                  46180000
461900             SET  PS-ERROR         TO TRUE                        46190000
462000             MOVE SQLCODE            TO PV-DISP-SQLCODE           46200000
462100             STRING ' ' WS003-SRC-TASK-NUMBER                     46210000
462200                    ' WSKCS301-5510: OPEN-PBS-CS-CSR'             46220000
462300                    ' CALLED BY-'                                 46230000
462400                     WS003-CALLING-PROGRAM-NAME                   46240000
462500                    ' SQLCODE='                                   46250000
462600                     PV-DISP-SQLCODE                              46260000
462700                    ' SUCC='                                      46270000
462800                     WS003-SUCCESS-IND                            46280000
462900             DELIMITED BY SIZE                                    46290000
463000             INTO PV-CICS-MSG-AREA                                46300000
463100             PERFORM 9200-WRITE-TO-CICS-LOG                       46310000
463200             MOVE '5510-OPEN-PBS-CS-CSR'                          46320000
463300                              TO DP013-PARAGRAPH                  46330000
463400             MOVE 'SELECT TPKSLIP'                                46340000
463500                              TO DP013-MESSAGE-TEXT (1)           46350000
463600             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  46360000
463700             STRING ' TRIP ID: '                                  46370000
463800                    PV-DISP-TRIP-ID                               46380000
463900                    ' EXT SHIP ID: '                              46390000
464000                    DK-EXT-SHP-ID                                 46400000
464100                    ' DWNLD TMST: '                               46410000
464200                    PV-CURRENT-TMST                               46420000
464300             DELIMITED BY SIZE                                    46430000
464400             INTO DP013-MESSAGE-TEXT (2)                          46440000
464500             MOVE 'TPKSLIP '  TO DP013-DB2-TABLE-NAME (1)         46450000
464600             MOVE SQLCA       TO DP013-SQLCA                      46460000
464700             SET DP013-DB2-ABEND  TO TRUE                         46470000
464800             PERFORM 9999-ABEND                                   46480000
464900     END-EVALUATE.                                                46490000
465000                                                                  46500000
465100******************************************************************46510000
465200* FETCH  PACK BY STORE CSR                                       *46520000
465300******************************************************************46530000
465400 5520-FETCH-PBS-CS-CSR.                                           46540000
465500                                                                  46550000
465600     EXEC SQL                                                     46560000
465700          FETCH PBS_CS_CSR                                        46570000
465800          INTO  :SHPUNT-SHIPT-UNT-ID                              46580000
465900     END-EXEC                                                     46590000
466000                                                                  46600000
466100     EVALUATE TRUE                                                46610000
466200         WHEN SQLCODE = ZERO                                      46620000
466300              PERFORM 6650-MULTIPLE-SKU-CHECK                     46630000
466400              PERFORM 6000-CARTON-CONTENT-DTLS                    46640000
466500         WHEN SQLCODE = +100                                      46650000
466600             SET PS-END-OF-PBS-CS-CSR-YES TO TRUE                 46660000
466700         WHEN SQLWARN0 NOT = SPACES                               46670000
466800         WHEN SQLCODE NOT = ZERO                                  46680000
466900         WHEN SQLCODE NOT = +100                                  46690000
467000             SET  PS-ERROR         TO TRUE                        46700000
467100             MOVE SQLCODE            TO PV-DISP-SQLCODE           46710000
467200             STRING ' ' WS003-SRC-TASK-NUMBER                     46720000
467300                    ' WSKCS301-5520: FETCH-PBS-CS-CSR'            46730000
467400                    ' CALLED BY-'                                 46740000
467500                     WS003-CALLING-PROGRAM-NAME                   46750000
467600                    ' SQLCODE='                                   46760000
467700                     PV-DISP-SQLCODE                              46770000
467800                    ' SUCC='                                      46780000
467900                     WS003-SUCCESS-IND                            46790000
468000             DELIMITED BY SIZE                                    46800000
468100             INTO PV-CICS-MSG-AREA                                46810000
468200             PERFORM 9200-WRITE-TO-CICS-LOG                       46820000
468300             MOVE '5520-FETCH-PBS-CS-CSR'                         46830000
468400                              TO DP013-PARAGRAPH                  46840000
468500             MOVE 'SELECT TPKSLIP'                                46850000
468600                              TO DP013-MESSAGE-TEXT (1)           46860000
468700             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  46870000
468800             STRING ' TRIP ID: '                                  46880000
468900                    PV-DISP-TRIP-ID                               46890000
469000                    ' EXT SHIP ID: '                              46900000
469100                    DK-EXT-SHP-ID                                 46910000
469200                    ' DWNLD TMST: '                               46920000
469300                    PV-CURRENT-TMST                               46930000
469400             DELIMITED BY SIZE                                    46940000
469500             INTO DP013-MESSAGE-TEXT (2)                          46950000
469600             MOVE 'TPKSLIP '  TO DP013-DB2-TABLE-NAME (1)         46960000
469700             MOVE SQLCA       TO DP013-SQLCA                      46970000
469800             SET DP013-DB2-ABEND  TO TRUE                         46980000
469900             PERFORM 9999-ABEND                                   46990000
470000     END-EVALUATE.                                                47000000
470100                                                                  47010000
470200     IF PS-WRITE-TO-CSSL-YES                                      47020000
470300      AND SQLCODE = 0                                             47030000
470400         STRING  ' ' WS003-SRC-TASK-NUMBER                        47040000
470500                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    47050000
470600                 ' WSKCS301-5520: FETCH-PBS-CS-CSR'               47060000
470700         DELIMITED BY SIZE                                        47070000
470800         INTO PV-CICS-MSG-AREA                                    47080000
470900         PERFORM 9200-WRITE-TO-CICS-LOG                           47090000
471000         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        47100000
471100         STRING  ' ' WS003-SRC-TASK-NUMBER                        47110000
471200                  ' SHIP UNT ID: '                                47120000
471300                  PV-DISP-SHIPT-UNT-ID                            47130000
471400         DELIMITED BY SIZE                                        47140000
471500         INTO PV-CICS-MSG-AREA                                    47150000
471600         PERFORM 9200-WRITE-TO-CICS-LOG                           47160000
471700     END-IF.                                                      47170000
471800                                                                  47180000
471900******************************************************************47190000
472000* CLOSE PACK BY STORE CSR                                        *47200000
472100******************************************************************47210000
472200 5530-CLOSE-PBS-CS-CSR.                                           47220000
472300                                                                  47230000
472400     EXEC SQL                                                     47240000
472500          CLOSE PBS_CS_CSR                                        47250000
472600     END-EXEC                                                     47260000
472700                                                                  47270000
472800     EVALUATE TRUE                                                47280000
472900         WHEN SQLCODE = ZERO                                      47290000
473000              CONTINUE                                            47300000
473100         WHEN SQLWARN0 NOT = SPACES                               47310000
473200         WHEN SQLCODE NOT = ZERO                                  47320000
473300             SET  PS-ERROR         TO TRUE                        47330000
473400             MOVE SQLCODE            TO PV-DISP-SQLCODE           47340000
473500             STRING ' ' WS003-SRC-TASK-NUMBER                     47350000
473600                    ' WSKCS301-5530: CLOSE-PBS-CS-CSR'            47360000
473700                    ' CALLED BY-'                                 47370000
473800                     WS003-CALLING-PROGRAM-NAME                   47380000
473900                    ' SQLCODE='                                   47390000
474000                     PV-DISP-SQLCODE                              47400000
474100                    ' SUCC='                                      47410000
474200                     WS003-SUCCESS-IND                            47420000
474300             DELIMITED BY SIZE                                    47430000
474400             INTO PV-CICS-MSG-AREA                                47440000
474500             PERFORM 9200-WRITE-TO-CICS-LOG                       47450000
474600             MOVE '5530-CLOSE-PBS-CS-CSR'                         47460000
474700                              TO DP013-PARAGRAPH                  47470000
474800             MOVE 'SELECT TPKSLIP'                                47480000
474900                              TO DP013-MESSAGE-TEXT (1)           47490000
475000             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  47500000
475100             STRING ' TRIP ID: '                                  47510000
475200                    PV-DISP-TRIP-ID                               47520000
475300                    ' EXT SHIP ID: '                              47530000
475400                    DK-EXT-SHP-ID                                 47540000
475500                    ' DWNLD TMST: '                               47550000
475600                    PV-CURRENT-TMST                               47560000
475700             DELIMITED BY SIZE                                    47570000
475800             INTO DP013-MESSAGE-TEXT (2)                          47580000
475900             MOVE 'TPKSLIP '  TO DP013-DB2-TABLE-NAME (1)         47590000
476000             MOVE SQLCA       TO DP013-SQLCA                      47600000
476100             SET DP013-DB2-ABEND  TO TRUE                         47610000
476200             PERFORM 9999-ABEND                                   47620000
476300     END-EVALUATE.                                                47630000
476400                                                                  47640000
476500******************************************************************47650000
476600*                                                                *47660000
476700******************************************************************47670000
476800 6000-CARTON-CONTENT-DTLS.                                        47680000
476900                                                                  47690000
477000     PERFORM 6110-OPEN-CTN-CNTNT-CSR.                             47700000
477100                                                                  47710000
477200     INITIALIZE PV-UNIT-WT                                        47720000
477300                PV-CARTON-WT                                      47730000
477400                PV-TOT-UNITS-IN-CASE.                             47740000
477500                                                                  47750000
477600     SET PS-END-OF-CTN-CNTNT-CSR-NO TO TRUE.                      47760000
477700     PERFORM 6120-FETCH-CTN-CNTNT-CSR                             47770000
477800       UNTIL PS-END-OF-CTN-CNTNT-CSR-YES.                         47780000
477900                                                                  47790000
478000     PERFORM 6130-CLOSE-CTN-CNTNT-CSR.                            47800000
478100                                                                  47810000
478200******************************************************************47820000
478300* OPEN CARTON_CNTNT_CSR                                          *47830000
478400******************************************************************47840000
478500 6110-OPEN-CTN-CNTNT-CSR.                                         47850000
478600                                                                  47860000
478700     MOVE 0 TO PV-CARTON-CNTNT-COUNTER.                           47870000
478800                                                                  47880000
478900     EXEC SQL                                                     47890000
479000          OPEN CARTON_CNTNT_CSR                                   47900000
479100     END-EXEC                                                     47910000
479200                                                                  47920000
479300     EVALUATE TRUE                                                47930000
479400         WHEN SQLCODE = ZERO                                      47940000
479500              CONTINUE                                            47950000
479600         WHEN SQLWARN0 NOT = SPACES                               47960000
479700         WHEN SQLCODE NOT = ZERO                                  47970000
479800             SET  PS-ERROR         TO TRUE                        47980000
479900             MOVE SQLCODE            TO PV-DISP-SQLCODE           47990000
480000             STRING ' ' WS003-SRC-TASK-NUMBER                     48000000
480100                    ' WSKCS301-6110: OPEN-CTN-CNTNT-CSR'          48010000
480200                    ' CALLED BY-'                                 48020000
480300                     WS003-CALLING-PROGRAM-NAME                   48030000
480400                    ' SQLCODE='                                   48040000
480500                     PV-DISP-SQLCODE                              48050000
480600                    ' SUCC='                                      48060000
480700                     WS003-SUCCESS-IND                            48070000
480800             DELIMITED BY SIZE                                    48080000
480900             INTO PV-CICS-MSG-AREA                                48090000
481000             PERFORM 9200-WRITE-TO-CICS-LOG                       48100000
481100             MOVE '6110-OPEN-CTN-CNTNT-CSR'                       48110000
481200                              TO DP013-PARAGRAPH                  48120000
481300             MOVE 'SELECT TSHUUPC'                                48130000
481400                              TO DP013-MESSAGE-TEXT (1)           48140000
481500             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  48150000
481600             STRING ' TRIP ID: '                                  48160000
481700                    PV-DISP-TRIP-ID                               48170000
481800                    ' EXT SHIP ID: '                              48180000
481900                    DK-EXT-SHP-ID                                 48190000
482000                    ' DWNLD TMST: '                               48200000
482100                    PV-CURRENT-TMST                               48210000
482200             DELIMITED BY SIZE                                    48220000
482300             INTO DP013-MESSAGE-TEXT (2)                          48230000
482400             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (1)         48240000
482500             MOVE SQLCA       TO DP013-SQLCA                      48250000
482600             SET DP013-DB2-ABEND  TO TRUE                         48260000
482700             PERFORM 9999-ABEND                                   48270000
482800     END-EVALUATE.                                                48280000
482900                                                                  48290000
483000******************************************************************48300000
483100* FETCH  CARTON_CNTNT_CSR                                        *48310000
483200******************************************************************48320000
483300 6120-FETCH-CTN-CNTNT-CSR.                                        48330000
483400                                                                  48340000
483500     EXEC SQL                                                     48350000
483600          FETCH CARTON_CNTNT_CSR                                  48360000
483700          INTO  :XLT00003-SKU-NBR                                 48370000
483800               ,:SHUUPC-SHPD-QTY                                  48380000
483900               ,:XLT00003-INTR-UPC-ID                             48390000
484000               ,:SHUUPC-TRN-LNE-NBR                               48400000
484100     END-EXEC                                                     48410000
484200                                                                  48420000
484300     EVALUATE TRUE                                                48430000
484400         WHEN SQLCODE = ZERO                                      48440000
484500              INITIALIZE PV-UNIT-WT                               48450000
484600              PERFORM 6200-CREATE-CS-LVL-DTL                      48460000
484700         WHEN SQLCODE = +100                                      48470000
484800             SET PS-END-OF-CTN-CNTNT-CSR-YES TO TRUE              48480000
484900             IF PV-TOT-UNITS-IN-CASE > 0                          48490000
485000                PERFORM 6600-CREATE-CS-LVL-HDR                    48500000
485100                INITIALIZE PV-TOT-UNITS-IN-CASE                   48510000
485200                           PV-CARTON-WT                           48520000
485300             END-IF                                               48530000
485400         WHEN SQLWARN0 NOT = SPACES                               48540000
485500         WHEN SQLCODE NOT = ZERO                                  48550000
485600         WHEN SQLCODE NOT = +100                                  48560000
485700             SET  PS-ERROR             TO TRUE                    48570000
485800             MOVE SQLCODE              TO PV-DISP-SQLCODE         48580000
485900             MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID    48590000
486000             MOVE XLT00003-SKU-NBR     TO PV-DISP-SKU             48600000
486100             MOVE XLT00003-INTR-UPC-ID TO PV-DISP-INTR-UPC-ID     48610000
486200             STRING ' ' WS003-SRC-TASK-NUMBER                     48620000
486300                    ' WSKCS301-6120: FETCH-CTN-CNTNT-CSR'         48630000
486400                    ' CALLED BY-'                                 48640000
486500                     WS003-CALLING-PROGRAM-NAME                   48650000
486600                    ' SQLCODE='                                   48660000
486700                     PV-DISP-SQLCODE                              48670000
486800                    ' SUCC='                                      48680000
486900                     WS003-SUCCESS-IND                            48690000
487000                    ' SHP UNT='                                   48700000
487100                     PV-DISP-SHIPT-UNT-ID                         48710000
487200                    ' SKU='                                       48720000
487300                     PV-DISP-SKU                                  48730000
487400                    'INTR UPC='                                   48740000
487500                     PV-DISP-INTR-UPC-ID                          48750000
487600             DELIMITED BY SIZE                                    48760000
487700             INTO PV-CICS-MSG-AREA                                48770000
487800             PERFORM 9200-WRITE-TO-CICS-LOG                       48780000
487900             MOVE '6120-FETCH-CTN-CNTNT-CSR'                      48790000
488000                              TO DP013-PARAGRAPH                  48800000
488100             MOVE 'SELECT TSHUUPC'                                48810000
488200                              TO DP013-MESSAGE-TEXT (1)           48820000
488300             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  48830000
488400             STRING ' TRIP ID: '                                  48840000
488500                    PV-DISP-TRIP-ID                               48850000
488600                    ' EXT SHIP ID: '                              48860000
488700                    DK-EXT-SHP-ID                                 48870000
488800                    ' DWNLD TMST: '                               48880000
488900                    PV-CURRENT-TMST                               48890000
489000             DELIMITED BY SIZE                                    48900000
489100             INTO DP013-MESSAGE-TEXT (2)                          48910000
489200             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (1)         48920000
489300             MOVE SQLCA       TO DP013-SQLCA                      48930000
489400             SET DP013-DB2-ABEND  TO TRUE                         48940000
489500             PERFORM 9999-ABEND                                   48950000
489600     END-EVALUATE.                                                48960000
489700                                                                  48970000
489800     IF PS-WRITE-TO-CSSL-YES                                      48980000
489900      AND SQLCODE = 0                                             48990000
490000         STRING  ' ' WS003-SRC-TASK-NUMBER                        49000000
490100                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    49010000
490200                 ' WSKCS301-6120: FETCH-CTN-CNTNT-CSR'            49020000
490300         DELIMITED BY SIZE                                        49030000
490400         INTO PV-CICS-MSG-AREA                                    49040000
490500         PERFORM 9200-WRITE-TO-CICS-LOG                           49050000
490600         MOVE XLT00003-SKU-NBR  TO PV-DISP-SKU                    49060000
490700         STRING   ' ' WS003-SRC-TASK-NUMBER                       49070000
490800                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   49080000
490900                  ' SKU NBR: '                                    49090000
491000                  PV-DISP-SKU                                     49100000
491100         DELIMITED BY SIZE                                        49110000
491200         INTO PV-CICS-MSG-AREA                                    49120000
491300         PERFORM 9200-WRITE-TO-CICS-LOG                           49130000
491400     END-IF.                                                      49140000
491500                                                                  49150000
491600******************************************************************49160000
491700* CLOSE CARTON_CNTNT_CSR                                         *49170000
491800******************************************************************49180000
491900 6130-CLOSE-CTN-CNTNT-CSR.                                        49190000
492000                                                                  49200000
492100     EXEC SQL                                                     49210000
492200          CLOSE CARTON_CNTNT_CSR                                  49220000
492300     END-EXEC                                                     49230000
492400                                                                  49240000
492500     EVALUATE TRUE                                                49250000
492600         WHEN SQLCODE = ZERO                                      49260000
492700              CONTINUE                                            49270000
492800         WHEN SQLWARN0 NOT = SPACES                               49280000
492900         WHEN SQLCODE NOT = ZERO                                  49290000
493000             SET  PS-ERROR         TO TRUE                        49300000
493100             MOVE SQLCODE            TO PV-DISP-SQLCODE           49310000
493200             STRING ' ' WS003-SRC-TASK-NUMBER                     49320000
493300                    ' WSKCS301-6130: CLOSE-CTN-CNTNT-CSR'         49330000
493400                    ' CALLED BY-'                                 49340000
493500                     WS003-CALLING-PROGRAM-NAME                   49350000
493600                    ' SQLCODE='                                   49360000
493700                     PV-DISP-SQLCODE                              49370000
493800                    ' SUCC='                                      49380000
493900                     WS003-SUCCESS-IND                            49390000
494000             DELIMITED BY SIZE                                    49400000
494100             INTO PV-CICS-MSG-AREA                                49410000
494200             PERFORM 9200-WRITE-TO-CICS-LOG                       49420000
494300             MOVE '6130-CLOSE-CTN-CNTNT-CSR'                      49430000
494400                              TO DP013-PARAGRAPH                  49440000
494500             MOVE 'SELECT TSHUUPC'                                49450000
494600                              TO DP013-MESSAGE-TEXT (1)           49460000
494700             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  49470000
494800             STRING ' TRIP ID: '                                  49480000
494900                    PV-DISP-TRIP-ID                               49490000
495000                    ' EXT SHIP ID: '                              49500000
495100                    DK-EXT-SHP-ID                                 49510000
495200                    ' DWNLD TMST: '                               49520000
495300                    PV-CURRENT-TMST                               49530000
495400             DELIMITED BY SIZE                                    49540000
495500             INTO DP013-MESSAGE-TEXT (2)                          49550000
495600             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (1)         49560000
495700             MOVE SQLCA       TO DP013-SQLCA                      49570000
495800             SET DP013-DB2-ABEND  TO TRUE                         49580000
495900             PERFORM 9999-ABEND                                   49590000
496000     END-EVALUATE.                                                49600000
496100                                                                  49610000
496200******************************************************************49620000
496300*                                                                *49630000
496400******************************************************************49640000
496500 6200-CREATE-CS-LVL-DTL.                                          49650000
496600                                                                  49660000
496700     PERFORM 6205-LOAD-CS-DTL-REC.                                49670000
496800                                                                  49680000
496900     PERFORM 6210-LOAD-CS-DTL-REC-TO-TEMP.                        49690000
497000                                                                  49700000
497100     EXEC SQL                                                     49710000
497200          INSERT INTO WST_ASN_DWNLD                               49720000
497300               (  EXT_SHP_ID                                      49730000
497400                , CRE_TMST                                        49740000
497500                , ROW_NBR                                         49750000
497600                , REC_TYP_GP_NBR                                  49760000
497700                , REC_TYP_CDE                                     49770000
497800                , CSE_DTL_NBR                                     49780000
497900                , REC_TYP_DESC                                    49790000
498000               )                                                  49800000
498100             VALUES                                               49810000
498200               ( :WST00011-EXT-SHP-ID                             49820000
498300                ,:WST00011-CRE-TMST                               49830000
498400                ,:WST00011-ROW-NBR                                49840000
498500                ,:WST00011-REC-TYP-GP-NBR                         49850000
498600                ,:WST00011-REC-TYP-CDE                            49860000
498700                ,:WST00011-CSE-DTL-NBR                            49870000
498800                ,:WST00011-REC-TYP-DESC                           49880000
498900               )                                                  49890000
499000     END-EXEC                                                     49900000
499100                                                                  49910000
499200     IF PS-WRITE-TO-CSSL-YES                                      49920000
499300      AND SQLCODE = 0                                             49930000
499400        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          49940000
499500        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   49950000
499600        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      49960000
499700        STRING  ' ' WS003-SRC-TASK-NUMBER                         49970000
499800                ' ' PV-DISP-EXT-SHP-ID (1:10)                     49980000
499900                ' WSKCS301-6200: CREATE-CS-LVL-DTL'               49990000
500000        DELIMITED BY SIZE                                         50000000
500100        INTO PV-CICS-MSG-AREA                                     50010000
500200        PERFORM 9200-WRITE-TO-CICS-LOG                            50020000
500300        STRING  ' ' WS003-SRC-TASK-NUMBER                         50030000
500400               ' ' PV-DISP-EXT-SHP-ID (1:10)                      50040000
500500               ' # REC TYP CDE    : '                             50050000
500600               WST00011-REC-TYP-CDE                               50060000
500700               ' # ROW NBR        : '                             50070000
500800               PV-DISP-ROW-NBR                                    50080000
500900        DELIMITED BY SIZE                                         50090000
501000        INTO PV-CICS-MSG-AREA                                     50100000
501100        PERFORM 9200-WRITE-TO-CICS-LOG                            50110000
501200        STRING ' ' WS003-SRC-TASK-NUMBER                          50120000
501300               ' ' PV-DISP-EXT-SHP-ID (1:10)                      50130000
501400               ' # REC TYP GP NBR : '                             50140000
501500               PV-DISP-REC-TYP-GP-NBR                             50150000
501600               ' # CSE DTL NBR    : '                             50160000
501700               PV-DISP-CSE-DTL-NBR                                50170000
501800        DELIMITED BY SIZE                                         50180000
501900        INTO PV-CICS-MSG-AREA                                     50190000
502000        PERFORM 9200-WRITE-TO-CICS-LOG                            50200000
502100     END-IF.                                                      50210000
502200                                                                  50220000
502300     EVALUATE TRUE                                                50230000
502400         WHEN SQLCODE = ZERO                                      50240000
502500              PERFORM 7500-DAT-CNTL-TBLS                          50250000
502600              ADD 1 TO PV-ROW-COUNTER                             50260000
502700         WHEN SQLWARN0 NOT = SPACES                               50270000
502800         WHEN SQLCODE NOT = ZERO                                  50280000
502900         WHEN SQLCODE NOT = +100                                  50290000
503000             SET  PS-ERROR         TO TRUE                        50300000
503100             MOVE SQLCODE            TO PV-DISP-SQLCODE           50310000
503200             STRING  ' ' WS003-SRC-TASK-NUMBER                    50320000
503300                     ' WSKCS301-6200: CREATE-CS-LVL-DTL'          50330000
503400                     ' CALLED BY-'                                50340000
503500                     WS003-CALLING-PROGRAM-NAME                   50350000
503600                     ' SQLCODE='                                  50360000
503700                     PV-DISP-SQLCODE                              50370000
503800                     ' SUCC='                                     50380000
503900                     WS003-SUCCESS-IND                            50390000
504000             DELIMITED BY SIZE                                    50400000
504100             INTO PV-CICS-MSG-AREA                                50410000
504200             PERFORM 9200-WRITE-TO-CICS-LOG                       50420000
504300             MOVE '6200-CREATE-CS-LVL-DTL'                        50430000
504400                              TO DP013-PARAGRAPH                  50440000
504500             MOVE 'INSERT WST_ASN_DWNLD'                          50450000
504600                              TO DP013-MESSAGE-TEXT (1)           50460000
504700             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  50470000
504800             STRING ' TRIP ID: '                                  50480000
504900                    PV-DISP-TRIP-ID                               50490000
505000                    ' EXT SHIP ID: '                              50500000
505100                    DK-EXT-SHP-ID                                 50510000
505200                    ' DWNLD TMST: '                               50520000
505300                    PV-CURRENT-TMST                               50530000
505400             DELIMITED BY SIZE                                    50540000
505500             INTO DP013-MESSAGE-TEXT (2)                          50550000
505600             MOVE 'WST00011'  TO DP013-DB2-TABLE-NAME (1)         50560000
505700             MOVE SQLCA       TO DP013-SQLCA                      50570000
505800             SET DP013-DB2-ABEND  TO TRUE                         50580000
505900             PERFORM 9999-ABEND                                   50590000
506000     END-EVALUATE.                                                50600000
506100                                                                  50610000
506200******************************************************************50620000
506300* MOVES TO CREATE CASE LEVEL DETAIL RECORD                       *50630000
506400******************************************************************50640000
506500 6205-LOAD-CS-DTL-REC.                                            50650000
506600                                                                  50660000
506700     INITIALIZE WS007-CASE-DTL-REC.                               50670000
506800     MOVE 'WSRD007 '  TO PV-TEMP-COPYBOOK-NAME.                   50680000
506900                                                                  50690000
507000     SET WS007-CD-ADD            TO TRUE.                         50700000
507100     SET WS007-CD-CSE-DTL        TO TRUE.                         50710000
507200     MOVE WST00002-CRE-USR-ID    TO WS007-CD-CREATE-USERID.       50720000
507300     MOVE WST00002-CRE-TMST      TO WS007-CD-CREATE-TMST.         50730000
507400     MOVE '00'                   TO WS007-CD-CASE-NBR (1:2).      50740000
507500     MOVE SHPUNT-SHIPT-UNT-ID    TO WS007-CD-CASE-NBR (3:18).     50750000
507600     MOVE XLT00003-SKU-NBR       TO WS007-CD-SKU-NBR              50760000
507700                                    WS007-CD-SKU-ID.              50770000
507800     MOVE SHUUPC-TRN-LNE-NBR     TO PV-TRN-LNE-NBR.               50780000
507900     MOVE PV-TRN-LNE-CDE(6:4)    TO WS007-CD-PO-LINE-NBR.         50790000
508000     MOVE SHUUPC-SHPD-QTY        TO WS007-CD-SHIPD-UNT-QTY.       50800000
508100     ADD SHUUPC-SHPD-QTY         TO PV-TOT-UNITS-IN-CASE.         50810000
508200     IF WST00002-PREPK-ID > 0                                     50820000
508300        PERFORM 6400-GET-POPRPK-SKU                               50830000
508400     END-IF.                                                      50840000
508500     MOVE POPRPK-PK-SKU-NBR      TO WS007-CD-PACK-SKU.            50850000
508600                                                                  50860000
508700     PERFORM 6450-GET-SHIP-WT-QTY.                                50870000
508800                                                                  50880000
508900     COMPUTE PV-UNIT-WT = WEBITM-SHIP-WT-QTY * SHUUPC-SHPD-QTY.   50890000
509000                                                                  50900000
509100     COMPUTE PV-CARTON-WT = PV-CARTON-WT +                        50910000
509200                            PV-UNIT-WT.                           50920000
509300                                                                  50930000
509400**THIS IS NEEDED TO PUT DTL NBR ON THE DTL LVL TEMP TBL REC       50940000
509500** THINK                                                          50950000
509600**   PERFORM 6650-MULTIPLE-SKU-CHECK.                             50960000
509700                                                                  50970000
509800     MOVE PV-HOST-INPUT-ID          TO WS007-CD-HOST-INPT-ID.     50980000
509900                                                                  50990000
510000******************************************************************51000000
510100* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *51010000
510200******************************************************************51020000
510300 6210-LOAD-CS-DTL-REC-TO-TEMP.                                    51030000
510400                                                                  51040000
510500     INITIALIZE DCLWST00011.                                      51050000
510600                                                                  51060000
510700     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       51070000
510800     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         51080000
510900     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          51090000
511000     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   51100000
511100     MOVE PC-CD                     TO WST00011-REC-TYP-CDE.      51110000
511200     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 51120000
511300     MOVE WS007-CASE-DTL-REC        TO WST00011-REC-TYP-DESC-TEXT.51130000
511400     MOVE PV-MULT-SKU-COUNTER       TO WST00011-CSE-DTL-NBR.      51140000
511500                                                                  51150000
511600******************************************************************51160000
511700*                                                                *51170000
511800******************************************************************51180000
511900 6400-GET-POPRPK-SKU.                                             51190000
512000                                                                  51200000
512100     INITIALIZE POPRPK-PK-SKU-NBR.                                51210000
512200                                                                  51220000
512300     EXEC SQL                                                     51230000
512400          SELECT PK_SKU_NBR                                       51240000
512500          INTO  :POPRPK-PK-SKU-NBR                                51250000
512600          FROM TPOPRPK                                            51260000
512700          WHERE PO_NBR         = :WST00002-PO-NBR                 51270000
512800          AND   PO_PREPK_ID    = :WST00002-PREPK-ID               51280000
512900          AND   PREPK_STAT_CDE = 'A'                              51290000
513000     END-EXEC                                                     51300000
513100                                                                  51310000
513200     EVALUATE TRUE                                                51320000
513300         WHEN SQLCODE = ZERO                                      51330000
513400         WHEN SQLCODE = +100                                      51340000
513500              CONTINUE                                            51350000
513600         WHEN SQLWARN0 NOT = SPACES                               51360000
513700         WHEN SQLCODE NOT = ZERO                                  51370000
513800         WHEN SQLCODE NOT = +100                                  51380000
513900             SET  PS-ERROR         TO TRUE                        51390000
514000             MOVE SQLCODE            TO PV-DISP-SQLCODE           51400000
514100             STRING  ' ' WS003-SRC-TASK-NUMBER                    51410000
514200                     ' WSKCS301-6400: GET-POPRPK-SKU'             51420000
514300                     ' CALLED BY-'                                51430000
514400                     WS003-CALLING-PROGRAM-NAME                   51440000
514500                     ' SQLCODE='                                  51450000
514600                     PV-DISP-SQLCODE                              51460000
514700                     ' SUCC='                                     51470000
514800                     WS003-SUCCESS-IND                            51480000
514900             DELIMITED BY SIZE                                    51490000
515000             INTO PV-CICS-MSG-AREA                                51500000
515100             PERFORM 9200-WRITE-TO-CICS-LOG                       51510000
515200             MOVE '6400-GET-POPRPK-SKUDTL'                        51520000
515300                              TO DP013-PARAGRAPH                  51530000
515400             MOVE 'SELECT TPOPRPK'                                51540000
515500                              TO DP013-MESSAGE-TEXT (1)           51550000
515600             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  51560000
515700             STRING ' TRIP ID: '                                  51570000
515800                    PV-DISP-TRIP-ID                               51580000
515900                    ' EXT SHIP ID: '                              51590000
516000                    DK-EXT-SHP-ID                                 51600000
516100                    ' DWNLD TMST: '                               51610000
516200                    PV-CURRENT-TMST                               51620000
516300             DELIMITED BY SIZE                                    51630000
516400             INTO DP013-MESSAGE-TEXT (2)                          51640000
516500             MOVE 'TPOPRPK '  TO DP013-DB2-TABLE-NAME (1)         51650000
516600             MOVE SQLCA       TO DP013-SQLCA                      51660000
516700             SET DP013-DB2-ABEND  TO TRUE                         51670000
516800             PERFORM 9999-ABEND                                   51680000
516900     END-EVALUATE.                                                51690000
517000                                                                  51700000
517100******************************************************************51710000
517200*                                                                *51720000
517300******************************************************************51730000
517400 6450-GET-SHIP-WT-QTY.                                            51740000
517500                                                                  51750000
517600     INITIALIZE WEBITM-SHIP-WT-QTY.                               51760000
517700     INITIALIZE WEBITM-SHIP-DPTH-QTY.                             51770000
517800     INITIALIZE WEBITM-SHIP-HT-QTY.                               51780000
517900     INITIALIZE WEBITM-SHIP-WD-QTY.                               51790000
518000                                                                  51800000
518100     EXEC SQL                                                     51810000
518200          SELECT SHIP_WT_QTY                                      51820000
518300             ,   SHIP_DPTH_QTY                                    51830000
518400             ,   SHIP_HT_QTY                                      51840000
518500             ,   SHIP_WD_QTY                                      51850000
518600          INTO  :WEBITM-SHIP-WT-QTY                               51860000
518700             ,  :WEBITM-SHIP-DPTH-QTY                             51870000
518800             ,  :WEBITM-SHIP-HT-QTY                               51880000
518900             ,  :WEBITM-SHIP-WD-QTY                               51890000
519000          FROM TWEBITM                                            51900000
519100          WHERE INTR_UPC_ID    = :XLT00003-INTR-UPC-ID            51910000
519200          AND   EFF_END_TMST   IS NULL                            51920000
519210            WITH UR                                               51921008
519300     END-EXEC                                                     51930000
519400                                                                  51940000
519500     EVALUATE TRUE                                                51950000
519600         WHEN SQLCODE = ZERO                                      51960000
519700         WHEN SQLCODE = +100                                      51970000
519800              CONTINUE                                            51980000
519900         WHEN SQLWARN0 NOT = SPACES                               51990000
520000         WHEN SQLCODE NOT = ZERO                                  52000000
520100         WHEN SQLCODE NOT = +100                                  52010000
520200             SET  PS-ERROR         TO TRUE                        52020000
520300             MOVE SQLCODE            TO PV-DISP-SQLCODE           52030000
520400             STRING  ' ' WS003-SRC-TASK-NUMBER                    52040000
520500                     ' WSKCS301-6450: GET-SHIP-WT-QTY'            52050000
520600                     ' CALLED BY-'                                52060000
520700                     WS003-CALLING-PROGRAM-NAME                   52070000
520800                     ' SQLCODE='                                  52080000
520900                     PV-DISP-SQLCODE                              52090000
521000                     ' SUCC='                                     52100000
521100                     WS003-SUCCESS-IND                            52110000
521200             DELIMITED BY SIZE                                    52120000
521300             INTO PV-CICS-MSG-AREA                                52130000
521400             PERFORM 9200-WRITE-TO-CICS-LOG                       52140000
521500             MOVE '6450-GET-SHIP-WT-QTY'                          52150000
521600                              TO DP013-PARAGRAPH                  52160000
521700             MOVE 'SELECT TWEBITM'                                52170000
521800                              TO DP013-MESSAGE-TEXT (1)           52180000
521900             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  52190000
522000             STRING ' TRIP ID: '                                  52200000
522100                    PV-DISP-TRIP-ID                               52210000
522200                    ' EXT SHIP ID: '                              52220000
522300                    DK-EXT-SHP-ID                                 52230000
522400                    ' DWNLD TMST: '                               52240000
522500                    PV-CURRENT-TMST                               52250000
522600             DELIMITED BY SIZE                                    52260000
522700             INTO DP013-MESSAGE-TEXT (2)                          52270000
522800             MOVE 'TWEBITM '  TO DP013-DB2-TABLE-NAME (1)         52280000
522900             MOVE SQLCA       TO DP013-SQLCA                      52290000
523000             SET DP013-DB2-ABEND  TO TRUE                         52300000
523100             PERFORM 9999-ABEND                                   52310000
523200     END-EVALUATE.                                                52320000
523300                                                                  52330000
523400******************************************************************52340000
523500*                                                                *52350000
523600******************************************************************52360000
523700 6600-CREATE-CS-LVL-HDR.                                          52370000
523800                                                                  52380000
523900     PERFORM 6605-LOAD-CS-HDR-REC.                                52390000
524000                                                                  52400000
524100     PERFORM 6610-LOAD-CS-HDR-REC-TO-TEMP.                        52410000
524200                                                                  52420000
524300     EXEC SQL                                                     52430000
524400          INSERT INTO WST_ASN_DWNLD                               52440000
524500               (  EXT_SHP_ID                                      52450000
524600                , CRE_TMST                                        52460000
524700                , ROW_NBR                                         52470000
524800                , REC_TYP_GP_NBR                                  52480000
524900                , REC_TYP_CDE                                     52490000
525000                , CSE_DTL_NBR                                     52500000
525100                , REC_TYP_DESC                                    52510000
525200               )                                                  52520000
525300             VALUES                                               52530000
525400               ( :WST00011-EXT-SHP-ID                             52540000
525500                ,:WST00011-CRE-TMST                               52550000
525600                ,:WST00011-ROW-NBR                                52560000
525700                ,:WST00011-REC-TYP-GP-NBR                         52570000
525800                ,:WST00011-REC-TYP-CDE                            52580000
525900                ,:WST00011-CSE-DTL-NBR                            52590000
526000                ,:WST00011-REC-TYP-DESC                           52600000
526100               )                                                  52610000
526200     END-EXEC                                                     52620000
526300                                                                  52630000
526400     IF PS-WRITE-TO-CSSL-YES                                      52640000
526500      AND SQLCODE = 0                                             52650000
526600        MOVE WST00011-ROW-NBR        TO  PV-DISP-ROW-NBR          52660000
526700        MOVE WST00011-REC-TYP-GP-NBR TO  PV-DISP-REC-TYP-GP-NBR   52670000
526800        MOVE WST00011-CSE-DTL-NBR    TO  PV-DISP-CSE-DTL-NBR      52680000
526900        STRING  ' ' WS003-SRC-TASK-NUMBER                         52690000
527000                ' ' PV-DISP-EXT-SHP-ID (1:10)                     52700000
527100                ' WSKCS301-6600: CREATE-CS-LVL-HDR'               52710000
527200        DELIMITED BY SIZE                                         52720000
527300        INTO PV-CICS-MSG-AREA                                     52730000
527400        PERFORM 9200-WRITE-TO-CICS-LOG                            52740000
527500        STRING  ' ' WS003-SRC-TASK-NUMBER                         52750000
527600               ' ' PV-DISP-EXT-SHP-ID (1:10)                      52760000
527700               ' # REC TYP CDE    : '                             52770000
527800               WST00011-REC-TYP-CDE                               52780000
527900               ' # ROW NBR        : '                             52790000
528000               PV-DISP-ROW-NBR                                    52800000
528100        DELIMITED BY SIZE                                         52810000
528200        INTO PV-CICS-MSG-AREA                                     52820000
528300        PERFORM 9200-WRITE-TO-CICS-LOG                            52830000
528400        STRING ' ' WS003-SRC-TASK-NUMBER                          52840000
528500               ' ' PV-DISP-EXT-SHP-ID (1:10)                      52850000
528600               ' # REC TYP GP NBR : '                             52860000
528700               PV-DISP-REC-TYP-GP-NBR                             52870000
528800               ' # CSE DTL NBR    : '                             52880000
528900               PV-DISP-CSE-DTL-NBR                                52890000
529000        DELIMITED BY SIZE                                         52900000
529100        INTO PV-CICS-MSG-AREA                                     52910000
529200        PERFORM 9200-WRITE-TO-CICS-LOG                            52920000
529300     END-IF.                                                      52930000
529400                                                                  52940000
529500     EVALUATE TRUE                                                52950000
529600         WHEN SQLCODE = ZERO                                      52960000
529700              PERFORM 7500-DAT-CNTL-TBLS                          52970000
529800              ADD 1 TO PV-ROW-COUNTER                             52980000
529900                       PV-GROUP-COUNTER                           52990000
530000**INCR BOTH FOR NEW CS DTL/HDR COMBO                              53000000
530100         WHEN SQLWARN0 NOT = SPACES                               53010000
530200         WHEN SQLCODE NOT = ZERO                                  53020000
530300             SET  PS-ERROR         TO TRUE                        53030000
530400             MOVE SQLCODE            TO PV-DISP-SQLCODE           53040000
530500             STRING  ' ' WS003-SRC-TASK-NUMBER                    53050000
530600                     ' WSKCS301-6650: CREATE-CS-LVL-HDR'          53060000
530700                     ' CALLED BY-'                                53070000
530800                     WS003-CALLING-PROGRAM-NAME                   53080000
530900                     ' SQLCODE='                                  53090000
531000                     PV-DISP-SQLCODE                              53100000
531100                     ' SUCC='                                     53110000
531200                     WS003-SUCCESS-IND                            53120000
531300             DELIMITED BY SIZE                                    53130000
531400             INTO PV-CICS-MSG-AREA                                53140000
531500             PERFORM 9200-WRITE-TO-CICS-LOG                       53150000
531600             MOVE '6600-CREATE-CS-LVL-HDR'                        53160000
531700                              TO DP013-PARAGRAPH                  53170000
531800             MOVE 'INSERT WST_ASN_DWNLD'                          53180000
531900                              TO DP013-MESSAGE-TEXT (1)           53190000
532000             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  53200000
532100             STRING ' TRIP ID: '                                  53210000
532200                    PV-DISP-TRIP-ID                               53220000
532300                    ' EXT SHIP ID: '                              53230000
532400                    DK-EXT-SHP-ID                                 53240000
532500                    ' DWNLD TMST: '                               53250000
532600                    PV-CURRENT-TMST                               53260000
532700             DELIMITED BY SIZE                                    53270000
532800             INTO DP013-MESSAGE-TEXT (2)                          53280000
532900             MOVE 'WST00011'  TO DP013-DB2-TABLE-NAME (1)         53290000
533000             MOVE SQLCA       TO DP013-SQLCA                      53300000
533100             SET DP013-DB2-ABEND  TO TRUE                         53310000
533200             PERFORM 9999-ABEND                                   53320000
533300     END-EVALUATE.                                                53330000
533400                                                                  53340000
533500******************************************************************53350000
533600* MOVES TO CREATE CASE LEVEL HEADER RECORD                       *53360000
533700******************************************************************53370000
533800 6605-LOAD-CS-HDR-REC.                                            53380000
533900                                                                  53390000
534000     INITIALIZE WS006-CASE-HDR-REC.                               53400000
534100     MOVE 'WSRD006 '  TO PV-TEMP-COPYBOOK-NAME.                   53410000
534200                                                                  53420000
534300     SET WS006-CH-ADD                TO TRUE.                     53430000
534400     SET WS006-CH-CSE-HDR            TO TRUE.                     53440000
534500     MOVE WST00002-CRE-USR-ID        TO WS006-CH-CREATE-USERID.   53450000
534600     MOVE WST00002-CRE-TMST          TO WS006-CH-CREATE-TMST.     53460000
534700     MOVE DK-EXT-SHP-ID              TO WS006-CH-ORIG-SHPMT-NBR.  53470000
534800     MOVE PV-OPER-UNT-ID-PIC9        TO WS006-CH-WHSE.            53480000
534900     MOVE '00'                       TO WS006-CH-CASE-NBR (1:2).  53490000
535000     MOVE SHPUNT-SHIPT-UNT-ID        TO WS006-CH-CASE-NBR (3:18). 53500000
535100     MOVE WST00002-RCVR-SEQ-NBR      TO WS006-CH-RCVR-SEQ-NBR.    53510000
535200     MOVE DK-TRIP-ID                 TO WS006-CH-TRIP-ID          53520000
535300     MOVE WST00002-PO-NBR            TO WS006-CH-PO-NBR           53530000
535400     MOVE VHTRIP-OWNER-SCAC-ID       TO WS006-CH-SCAC.            53540000
535500     MOVE VHTRIP-VEH-NBR             TO WS006-CH-TRLR-ID.         53550000
535600     PERFORM 7820-GET-VENDOR-ID.                                  53560000
535700     MOVE PURCHS-ENT-ID              TO WS006-CH-VENDOR-ID.       53570000
535800     MOVE PV-TOT-UNITS-IN-CASE       TO WS006-CH-SHPD-UNT-QTY.    53580000
535900     MOVE PV-CARTON-WT               TO WS006-CH-EST-WEIGHT.      53590000
536000     IF PS-MULTIPLE-SKU-YES                                       53600000
536100        SET WS006-CH-MULT-SKU   TO TRUE                           53610000
536200        MOVE PV-TOT-UNITS-IN-CASE TO WS006-CH-SHPD-UNT-VOL        53620000
536300     ELSE                                                         53630000
536400        SET WS006-CH-SNGL-SKU    TO TRUE                          53640000
536500        IF (WEBITM-SHIP-WD-QTY = 0 OR WEBITM-SHIP-DPTH-QTY = 0    53650000
536600            OR WEBITM-SHIP-HT-QTY = 0)                            53660000
536700            MOVE PV-TOT-UNITS-IN-CASE TO WS006-CH-SHPD-UNT-VOL    53670000
536800        ELSE                                                      53680000
536900            COMPUTE WS006-CH-SHPD-UNT-VOL = WEBITM-SHIP-WD-QTY *  53690000
537000            WEBITM-SHIP-DPTH-QTY * WEBITM-SHIP-HT-QTY *           53700000
537100            WS006-CH-SHPD-UNT-QTY                                 53710000
537200        END-IF                                                    53720000
537300     END-IF.                                                      53730000
537400     MOVE PV-HOST-INPUT-ID       TO WS006-CH-HOST-INPT-ID.        53740000
537500     SET WS006-CH-VENDOR-SHIPMT  TO TRUE.                         53750000
537600                                                                  53760000
537700******************************************************************53770000
537800* MOVES TO LOAD THE FIELDS TO PREP FOR AN INSERT                 *53780000
537900******************************************************************53790000
538000 6610-LOAD-CS-HDR-REC-TO-TEMP.                                    53800000
538100                                                                  53810000
538200     INITIALIZE DCLWST00011.                                      53820000
538300                                                                  53830000
538400     MOVE DK-EXT-SHP-ID             TO WST00011-EXT-SHP-ID.       53840000
538500     MOVE PV-CURRENT-TMST           TO WST00011-CRE-TMST.         53850000
538600     MOVE PV-ROW-COUNTER            TO WST00011-ROW-NBR.          53860000
538700     MOVE PV-GROUP-COUNTER          TO WST00011-REC-TYP-GP-NBR.   53870000
538800     MOVE PC-CH                     TO WST00011-REC-TYP-CDE.      53880000
538900     MOVE PC-TEMP-TBL-DESC-LENGTH   TO WST00011-REC-TYP-DESC-LEN. 53890000
539000     MOVE WS006-CASE-HDR-REC        TO WST00011-REC-TYP-DESC-TEXT.53900000
539100     MOVE PV-MULT-SKU-COUNTER       TO WST00011-CSE-DTL-NBR.      53910000
539200                                                                  53920000
539300******************************************************************53930000
539400*                                                                *53940000
539500******************************************************************53950000
539600 6650-MULTIPLE-SKU-CHECK.                                         53960000
539700                                                                  53970000
539800     SET PS-MULTIPLE-SKU-NO TO TRUE.                              53980000
539900     MOVE 0                 TO PV-MULT-SKU-COUNTER.               53990000
540000                                                                  54000000
540100     EXEC SQL                                                     54010000
540200          SELECT   COUNT(DISTINCT(C.SKU_NBR))                     54020000
540300          INTO    :PV-MULT-SKU-COUNTER                            54030000
540400          FROM     TSHUUPC A                                      54040000
540500                  ,XLT_UPC B                                      54050000
540600                  ,XLT_SKU C                                      54060000
540700          WHERE   A.SHIPT_UNT_ID = :SHPUNT-SHIPT-UNT-ID           54070000
540800            AND   A.SHPD_QTY > 0                                  54080000
540900            AND   A.UPC_NBR  = B.UPC_NBR                          54090000
541000            AND   B.INTR_UPC_ID = C.INTR_UPC_ID                   54100000
541010           WITH UR                                                54101008
541100     END-EXEC                                                     54110000
541200                                                                  54120000
541300     EVALUATE TRUE                                                54130000
541400         WHEN SQLCODE = ZERO                                      54140000
541500         WHEN SQLCODE = +100                                      54150000
541600         WHEN SQLCODE = -811                                      54160000
541700              IF PV-MULT-SKU-COUNTER > 1                          54170000
541800                 SET PS-MULTIPLE-SKU-YES TO TRUE                  54180000
541900              END-IF                                              54190000
542000         WHEN SQLWARN0 NOT = SPACES                               54200000
542100         WHEN SQLCODE NOT = ZERO                                  54210000
542200         WHEN SQLCODE NOT = +100                                  54220000
542300             SET  PS-ERROR         TO TRUE                        54230000
542400             MOVE SQLCODE            TO PV-DISP-SQLCODE           54240000
542500             MOVE SHPUNT-SHIPT-UNT-ID TO PV-DISP-SHIPT-UNT-ID     54250000
542600             STRING  ' ' WS003-SRC-TASK-NUMBER                    54260000
542700                     ' WSKCS301-6650: MULTIPLE-SKU-CHECK'         54270000
542800                     ' CALLED BY-'                                54280000
542900                     WS003-CALLING-PROGRAM-NAME                   54290000
543000                     ' SQLCODE='                                  54300000
543100                     PV-DISP-SQLCODE                              54310000
543200                     ' SUCC='                                     54320000
543300                     WS003-SUCCESS-IND                            54330000
543400                     ' SHP UNT='                                  54340000
543500                     PV-DISP-SHIPT-UNT-ID                         54350000
543600             DELIMITED BY SIZE                                    54360000
543700             INTO PV-CICS-MSG-AREA                                54370000
543800             PERFORM 9200-WRITE-TO-CICS-LOG                       54380000
543900             MOVE '6650-MULTIPLE-SKU-CHECK'                       54390000
544000                              TO DP013-PARAGRAPH                  54400000
544100             MOVE 'SELECT TSHUUPC'                                54410000
544200                              TO DP013-MESSAGE-TEXT (1)           54420000
544300             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  54430000
544400             STRING ' TRIP ID: '                                  54440000
544500                    PV-DISP-TRIP-ID                               54450000
544600                    ' EXT SHIP ID: '                              54460000
544700                    DK-EXT-SHP-ID                                 54470000
544800                    ' DWNLD TMST: '                               54480000
544900                    PV-CURRENT-TMST                               54490000
545000             DELIMITED BY SIZE                                    54500000
545100             INTO DP013-MESSAGE-TEXT (2)                          54510000
545200             MOVE 'TSHUUPC '  TO DP013-DB2-TABLE-NAME (1)         54520000
545300             MOVE SQLCA       TO DP013-SQLCA                      54530000
545400             SET DP013-DB2-ABEND  TO TRUE                         54540000
545500             PERFORM 9999-ABEND                                   54550000
545600     END-EVALUATE.                                                54560000
545700                                                                  54570000
545800******************************************************************54580000
545900* UPDATE THE VERSION NUMBER ON THE HDR XREF. EVERYTIME A SHIPMENT 54590000
546000* IS DOWNLOADED TO WMS, THE VER-NBR SHOULD BE INCREMENTED BY +1.  54600000
546100******************************************************************54610000
546200 7100-UPD-HDR-XREF-VER-NBR.                                       54620000
546300                                                                  54630000
546400     EXEC SQL                                                     54640000
546500          UPDATE WST_SHPMT_XREF_HDR                               54650000
546600            SET  VER_NBR = :PV-HOST-INPUT-ID                      54660000
546700           WHERE EXT_SHP_ID = :DK-EXT-SHP-ID                      54670000
546800     END-EXEC                                                     54680000
546900                                                                  54690000
547000     EVALUATE TRUE                                                54700000
547100         WHEN SQLCODE = ZERO                                      54710000
547200             CONTINUE                                             54720000
547300         WHEN SQLWARN0 NOT = SPACES                               54730000
547400         WHEN SQLCODE NOT = ZERO                                  54740000
547500              SET  PS-ERROR         TO TRUE                       54750000
547600              MOVE SQLCODE            TO PV-DISP-SQLCODE          54760000
547700              STRING ' ' WS003-SRC-TASK-NUMBER                    54770000
547800                     ' 7100-UPD-HDR-XREF-VER-NBR'                 54780000
547900                     ' CALLED BY-'                                54790000
548000                      WS003-CALLING-PROGRAM-NAME                  54800000
548100                     ' SQLCODE='                                  54810000
548200                      PV-DISP-SQLCODE                             54820000
548300                     ' SUCC='                                     54830000
548400                      WS003-SUCCESS-IND                           54840000
548500              DELIMITED BY SIZE                                   54850000
548600              INTO PV-CICS-MSG-AREA                               54860000
548700              PERFORM 9200-WRITE-TO-CICS-LOG                      54870000
548800              MOVE '7100-UPD-HDR-XREF-VER-NBR'                    54880000
548900                               TO DP013-PARAGRAPH                 54890000
549000              MOVE 'UPDATE WST_SHPMT_XREF_DTL'                    54900000
549100                               TO DP013-MESSAGE-TEXT (1)          54910000
549200              MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                 54920000
549300              STRING ' TRIP ID: '                                 54930000
549400                     PV-DISP-TRIP-ID                              54940000
549500                     ' EXT SHIP ID: '                             54950000
549600                     DK-EXT-SHP-ID                                54960000
549700                     ' DWNLD TMST: '                              54970000
549800                     PV-CURRENT-TMST                              54980000
549900              DELIMITED BY SIZE                                   54990000
550000              INTO DP013-MESSAGE-TEXT (2)                         55000000
550100              MOVE 'WST00001'  TO DP013-DB2-TABLE-NAME (1)        55010000
550200              MOVE SQLCA       TO DP013-SQLCA                     55020000
550300              SET DP013-DB2-ABEND  TO TRUE                        55030000
550400              PERFORM 9999-ABEND                                  55040000
550500     END-EVALUATE.                                                55050000
550600                                                                  55060000
550700     IF PS-WRITE-TO-CSSL-YES                                      55070000
550800         STRING   ' ' WS003-SRC-TASK-NUMBER                       55080000
550900                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   55090000
551000                  ' WSKCS301-7100: UPD-HDR-XREF-VER-NBR'          55100000
551100                  ' INCREMENT HDR XREF CER BVR'                   55110000
551200         DELIMITED BY SIZE                                        55120000
551300         INTO PV-CICS-MSG-AREA                                    55130000
551400         PERFORM 9200-WRITE-TO-CICS-LOG                           55140000
551500         MOVE PV-LAST-HOST-INPUT-ID TO PV-DISP-LAST-HOST-INPUT-ID 55150000
551600         MOVE PV-HOST-INPUT-ID      TO PV-DISP-HOST-INPUT-ID      55160000
551700         STRING   ' ' WS003-SRC-TASK-NUMBER                       55170000
551800                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   55180000
551900                  ' VER-NBR ON HDR REC: '                         55190000
552000                  PV-DISP-LAST-HOST-INPUT-ID                      55200000
552100                  ' INCREMENTED VER NBR: '                        55210000
552200                  PV-DISP-HOST-INPUT-ID                           55220000
552300         DELIMITED BY SIZE                                        55230000
552400         INTO PV-CICS-MSG-AREA                                    55240000
552500         PERFORM 9200-WRITE-TO-CICS-LOG                           55250000
552600     END-IF.                                                      55260000
552700                                                                  55270000
552800******************************************************************55280000
552900* THIS CALLS WSKCS302 TO PROCESS THE WST_ASN_DWNLD RECS           55290000
553000******************************************************************55300000
553100 7200-ASN-DWNLD-MODULE.                                           55310000
553200                                                                  55320000
553300     INITIALIZE WS006-TRANS-COMMAREA.                             55330000
553400                                                                  55340000
553500     MOVE DK-EXT-SHP-ID         TO WS006-EXT-SHP-ID.              55350000
553600     MOVE PC-PROGRAM-NAME       TO WS006-CALLING-PROGRAM-NAME.    55360000
553700     MOVE PC-PRC-TYP-CDE        TO WS006-TRN-TYP-CDE.             55370000
553800     MOVE WST00003-PRC-GP-ID    TO WS006-PRC-GP-ID.               55380000
553900                                                                  55390000
554000*****MOVE WS003-OPER-UNT-ID     TO WS006-OPER-UNT-ID.             55400000
554100     IF WS003-OPER-UNT-ID  > 0                                    55410000
554200        MOVE WS003-OPER-UNT-ID  TO WS006-OPER-UNT-ID              55420000
554300     ELSE                                                         55430000
554400       MOVE TRIPST-OPER-UNT-ID  TO WS006-OPER-UNT-ID              55440000
554500     END-IF.                                                      55450000
554600                                                                  55460000
554700     MOVE WS003-USERID          TO WS006-USERID.                  55470000
554800     MOVE WS003-SRC-TASK-NUMBER TO WS006-SRC-TASK-NUMBER.         55480000
554900     MOVE PV-CURRENT-TMST       TO WS006-DWNLD-TMST.              55490000
555000     IF PV-RECS-IN-TRBL-COUNT > 0                                 55500000
555100        SET WS006-TROUBLE-SHPMT  TO TRUE                          55510000
555200     ELSE                                                         55520000
555300        SET WS006-NO-TROUBLE     TO TRUE                          55530000
555400     END-IF.                                                      55540000
555500                                                                  55550000
555600     IF PS-WRITE-TO-CSSL-YES                                      55560000
555700         MOVE PV-RECS-IN-TRBL-COUNT                               55570000
555800                        TO PV-DISP-RECS-IN-TRBL-COUNT             55580000
555900         STRING  ' ' WS006-OPER-UNT-ID                            55590000
556000                 ' ' WS006-EXT-SHP-ID                             55600000
556100                 ' OPER&SHIP_ID          '                        55610000
556200         DELIMITED BY SIZE                                        55620000
556300         INTO PV-CICS-MSG-AREA                                    55630000
556400         PERFORM 9200-WRITE-TO-CICS-LOG                           55640000
556500     END-IF.                                                      55650000
556600                                                                  55660000
556700     IF PS-WRITE-TO-CSSL-YES                                      55670000
556800         MOVE PV-RECS-IN-TRBL-COUNT                               55680000
556900                        TO PV-DISP-RECS-IN-TRBL-COUNT             55690000
557000         STRING  ' ' WS003-SRC-TASK-NUMBER                        55700000
557100                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    55710000
557200                 ' PV-RECS-IN-TRBL-COUNT:'                        55720000
557300                 PV-DISP-RECS-IN-TRBL-COUNT                       55730000
557400         DELIMITED BY SIZE                                        55740000
557500         INTO PV-CICS-MSG-AREA                                    55750000
557600         PERFORM 9200-WRITE-TO-CICS-LOG                           55760000
557700     END-IF.                                                      55770000
557800                                                                  55780000
557900     IF PS-WRITE-TO-CSSL-YES                                      55790000
558000         STRING  ' ' WS003-SRC-TASK-NUMBER                        55800000
558100                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    55810000
558200                 ' WSKCS301-7200: ASN-DWNLD-MODULE'               55820000
558300                 ' ========>  WSKCS301 CALLING WSKCS302'          55830000
558400         DELIMITED BY SIZE                                        55840000
558500         INTO PV-CICS-MSG-AREA                                    55850000
558600         PERFORM 9200-WRITE-TO-CICS-LOG                           55860000
558700     END-IF.                                                      55870000
558800                                                                  55880000
558900     MOVE LENGTH OF WS006-TRANS-COMMAREA TO PV-COMMAREA-LENGTH.   55890000
559000                                                                  55900000
559100     EXEC CICS                                                    55910000
559200         LINK PROGRAM  (PC-ASN-DWNLD-PGM)                         55920000
559300              COMMAREA (WS006-TRANS-COMMAREA)                     55930000
559400              LENGTH   (PV-COMMAREA-LENGTH)                       55940000
559500              RESP     (PV-CICS-RESP)                             55950000
559600     END-EXEC.                                                    55960000
559700                                                                  55970000
559800     IF PS-WRITE-TO-CSSL-YES                                      55980000
559900         STRING  ' ' WS003-SRC-TASK-NUMBER                        55990000
560000                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    56000000
560100                 ' WSKCS301-7200: ASN-DWNLD-MODULE'               56010000
560200                 ' ===>  RE ENTERING WSKCS301 '                   56020000
560300         DELIMITED BY SIZE                                        56030000
560400         INTO PV-CICS-MSG-AREA                                    56040000
560500         PERFORM 9200-WRITE-TO-CICS-LOG                           56050000
560600         STRING  ' ' WS003-SRC-TASK-NUMBER                        56060000
560700                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    56070000
560800                 ' WSKCS301-7200: ASN-DWNLD-MODULE'               56080000
560900                 ' --->  CICS REPONSE=' PV-DISP-NUM               56090000
561000         DELIMITED BY SIZE                                        56100000
561100         INTO PV-CICS-MSG-AREA                                    56110000
561200         PERFORM 9200-WRITE-TO-CICS-LOG                           56120000
561300         STRING  ' WS006-SUCCESS-IND: ' WS006-SUCCESS-IND         56130000
561400         DELIMITED BY SIZE                                        56140000
561500         INTO PV-CICS-MSG-AREA                                    56150000
561600         PERFORM 9200-WRITE-TO-CICS-LOG                           56160000
561700         STRING  ' COMMAREA: ' WS006-TRANS-COMMAREA               56170000
561800         DELIMITED BY SIZE                                        56180000
561900         INTO PV-CICS-MSG-AREA                                    56190000
562000         PERFORM 9200-WRITE-TO-CICS-LOG                           56200000
562100     END-IF.                                                      56210000
562200                                                                  56220000
562300     MOVE EIBCALEN  TO PV-DISP-NUM.                               56230000
562400     IF PS-WRITE-TO-CSSL-YES                                      56240000
562500         STRING  ' WS006-SUCCESS-IND: ' WS006-SUCCESS-IND         56250000
562600         DELIMITED BY SIZE                                        56260000
562700         INTO PV-CICS-MSG-AREA                                    56270000
562800         PERFORM 9200-WRITE-TO-CICS-LOG                           56280000
562900         STRING  ' EIBCALEN   :' PV-DISP-NUM                      56290000
563000         DELIMITED BY SIZE                                        56300000
563100         INTO PV-CICS-MSG-AREA                                    56310000
563200         PERFORM 9200-WRITE-TO-CICS-LOG                           56320000
563300         STRING  ' DFHCOMMAREA:' DFHCOMMAREA                      56330000
563400         DELIMITED BY SIZE                                        56340000
563500         INTO PV-CICS-MSG-AREA                                    56350000
563600         PERFORM 9200-WRITE-TO-CICS-LOG                           56360000
563700     END-IF.                                                      56370000
563800                                                                  56380000
563900******************************************************************56390000
564000* OPEN XREF_DTL_CSR                                               56400000
564100******************************************************************56410000
564200 7410-OPEN-XREF-DTL-CSR.                                          56420000
564300                                                                  56430000
564400     EXEC SQL                                                     56440000
564500          OPEN XREF_DTL_CSR                                       56450000
564600     END-EXEC                                                     56460000
564700                                                                  56470000
564800     EVALUATE TRUE                                                56480000
564900         WHEN SQLCODE = ZERO                                      56490000
565000              CONTINUE                                            56500000
565100         WHEN SQLWARN0 NOT = SPACES                               56510000
565200         WHEN SQLCODE NOT = ZERO                                  56520000
565300             SET  PS-ERROR         TO TRUE                        56530000
565400             MOVE SQLCODE            TO PV-DISP-SQLCODE           56540000
565500             STRING ' ' WS003-SRC-TASK-NUMBER                     56550000
565600                    ' WSKCS301-7410: OPEN-XREF-DTL-CSR'           56560000
565700                    ' CALLED BY-'                                 56570000
565800                    WS003-CALLING-PROGRAM-NAME                    56580000
565900                    ' SQLCODE='                                   56590000
566000                    PV-DISP-SQLCODE                               56600000
566100                    ' SUCC='                                      56610000
566200                    WS003-SUCCESS-IND                             56620000
566300             DELIMITED BY SIZE                                    56630000
566400             INTO PV-CICS-MSG-AREA                                56640000
566500             PERFORM 9200-WRITE-TO-CICS-LOG                       56650000
566600             MOVE '7410-OPEN-XREF-DTL-CSR'                        56660000
566700                              TO DP013-PARAGRAPH                  56670000
566800             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     56680000
566900                              TO DP013-MESSAGE-TEXT (1)           56690000
567000             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  56700000
567100             STRING ' TRIP ID: '                                  56710000
567200                    PV-DISP-TRIP-ID                               56720000
567300                    ' EXT SHIP ID: '                              56730000
567400                    DK-EXT-SHP-ID                                 56740000
567500                    ' DWNLD TMST: '                               56750000
567600                    PV-CURRENT-TMST                               56760000
567700             DELIMITED BY SIZE                                    56770000
567800             INTO DP013-MESSAGE-TEXT (2)                          56780000
567900             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         56790000
568000             MOVE SQLCA       TO DP013-SQLCA                      56800000
568100             SET DP013-DB2-ABEND  TO TRUE                         56810000
568200             PERFORM 9999-ABEND                                   56820000
568300     END-EVALUATE.                                                56830000
568400                                                                  56840000
568500******************************************************************56850000
568600* FETCH  XREF_DTL_CSR                                             56860000
568700******************************************************************56870000
568800 7420-FETCH-XREF-DTL-CSR.                                         56880000
568900                                                                  56890000
569000     EXEC SQL                                                     56900000
569100          FETCH XREF_DTL_CSR                                      56910000
569200          INTO                                                    56920000
569300                :WST00002-PO-NBR                                  56930000
569400               ,:WST00002-PO-LNE-NBR                              56940000
569500               ,:WST00002-RCVR-SEQ-NBR                            56950000
569600               ,:WST00002-ASN-LVL-CDE                             56960000
569700               ,:WST00002-PREPK-ID                                56970000
569800               ,:WST00002-CRE-USR-ID                              56980000
569900               ,:WST00002-CRE-TMST                                56990000
570000               ,:WST00002-DWNLD-CDE                               57000000
570100               ,:WST00002-ACTV-CDE                                57010000
570200     END-EXEC                                                     57020000
570300                                                                  57030000
570400     EVALUATE TRUE                                                57040000
570500         WHEN SQLCODE = ZERO                                      57050000
570600              PERFORM 7450-CALL-PO-RCVR-TRKG-MOD                  57060000
570700         WHEN SQLCODE = +100                                      57070000
570800             SET PS-END-OF-XREF-DTL-CSR-YES TO TRUE               57080000
570900         WHEN SQLWARN0 NOT = SPACES                               57090000
571000         WHEN SQLCODE NOT = ZERO                                  57100000
571100         WHEN SQLCODE NOT = +100                                  57110000
571200             SET  PS-ERROR         TO TRUE                        57120000
571300             MOVE SQLCODE            TO PV-DISP-SQLCODE           57130000
571400             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            57140000
571500             MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR   57150000
571600             MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID         57160000
571700             MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR      57170000
571800             STRING ' ' WS003-SRC-TASK-NUMBER                     57180000
571900                    ' WSKCS301-7420: FETCH-XREF-DTL-CSR'          57190000
572000                    ' CALLED BY-'                                 57200000
572100                     WS003-CALLING-PROGRAM-NAME                   57210000
572200                    ' SQLCODE='                                   57220000
572300                     PV-DISP-SQLCODE                              57230000
572400                    ' SUCC='                                      57240000
572500                     WS003-SUCCESS-IND                            57250000
572600                    ' PO='                                        57260000
572700                     PV-DISP-PO-NBR                               57270000
572800                    ' RCVR='                                      57280000
572900                     PV-DISP-RCVR-SEQ-NBR                         57290000
573000                    ' PRPK='                                      57300000
573100                     PV-DISP-PREPK-ID                             57310000
573200                    ' LNE='                                       57320000
573300                     PV-DISP-PO-LINE-NBR                          57330000
573400             DELIMITED BY SIZE                                    57340000
573500             INTO PV-CICS-MSG-AREA                                57350000
573600             PERFORM 9200-WRITE-TO-CICS-LOG                       57360000
573700             MOVE '3740-FETCH-XREF-DTL-CSR'                       57370000
573800                              TO DP013-PARAGRAPH                  57380000
573900             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     57390000
574000                              TO DP013-MESSAGE-TEXT (1)           57400000
574100             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  57410000
574200             STRING ' TRIP ID: '                                  57420000
574300                    PV-DISP-TRIP-ID                               57430000
574400                    ' EXT SHIP ID: '                              57440000
574500                    DK-EXT-SHP-ID                                 57450000
574600                    ' DWNLD TMST: '                               57460000
574700                    PV-CURRENT-TMST                               57470000
574800             DELIMITED BY SIZE                                    57480000
574900             INTO DP013-MESSAGE-TEXT (2)                          57490000
575000             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         57500000
575100             MOVE SQLCA       TO DP013-SQLCA                      57510000
575200             SET DP013-DB2-ABEND  TO TRUE                         57520000
575300             PERFORM 9999-ABEND                                   57530000
575400     END-EVALUATE.                                                57540000
575500                                                                  57550000
575600     IF PS-WRITE-TO-CSSL-YES                                      57560000
575700      AND SQLCODE = 0                                             57570000
575800         STRING   ' ' WS003-SRC-TASK-NUMBER                       57580000
575900                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   57590000
576000                  ' WSKCS301-7420: FETCH-XREF-DTL-CSR'            57600000
576100         DELIMITED BY SIZE                                        57610000
576200         INTO PV-CICS-MSG-AREA                                    57620000
576300         PERFORM 9200-WRITE-TO-CICS-LOG                           57630000
576400         MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR                57640000
576500         MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR       57650000
576600         MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID             57660000
576700         MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR          57670000
576800         STRING   ' ' WS003-SRC-TASK-NUMBER                       57680000
576900                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   57690000
577000                  ' PO NBR: '                                     57700000
577100                  PV-DISP-PO-NBR                                  57710000
577200                  ' RCVR NBR: '                                   57720000
577300                  PV-DISP-RCVR-SEQ-NBR                            57730000
577400                  'PREPACK ID: '                                  57740000
577500                  PV-DISP-PREPK-ID                                57750000
577600                  'PO LINE: '                                     57760000
577700                  PV-DISP-PO-LINE-NBR                             57770000
577800         DELIMITED BY SIZE                                        57780000
577900         INTO PV-CICS-MSG-AREA                                    57790000
578000         PERFORM 9200-WRITE-TO-CICS-LOG                           57800000
578100     END-IF.                                                      57810000
578200                                                                  57820000
578300******************************************************************57830000
578400* CLOSE XREF_DTL_CSR                                              57840000
578500******************************************************************57850000
578600 7430-CLOSE-XREF-DTL-CSR.                                         57860000
578700                                                                  57870000
578800     EXEC SQL                                                     57880000
578900          CLOSE XREF_DTL_CSR                                      57890000
579000     END-EXEC                                                     57900000
579100                                                                  57910000
579200     EVALUATE TRUE                                                57920000
579300         WHEN SQLCODE = ZERO                                      57930000
579400              CONTINUE                                            57940000
579500         WHEN SQLWARN0 NOT = SPACES                               57950000
579600         WHEN SQLCODE NOT = ZERO                                  57960000
579700             SET  PS-ERROR         TO TRUE                        57970000
579800             MOVE SQLCODE            TO PV-DISP-SQLCODE           57980000
579900             STRING ' ' WS003-SRC-TASK-NUMBER                     57990000
580000                    ' WSKCS301-7430: FETCH-XREF-DTL-CSR'          58000000
580100                    ' CALLED BY-'                                 58010000
580200                     WS003-CALLING-PROGRAM-NAME                   58020000
580300                    ' SQLCODE='                                   58030000
580400                     PV-DISP-SQLCODE                              58040000
580500                    ' SUCC='                                      58050000
580600                     WS003-SUCCESS-IND                            58060000
580700             DELIMITED BY SIZE                                    58070000
580800             INTO PV-CICS-MSG-AREA                                58080000
580900             PERFORM 9200-WRITE-TO-CICS-LOG                       58090000
581000             MOVE '7430-CLOSE-XREF-DTL-CSR'                       58100000
581100                              TO DP013-PARAGRAPH                  58110000
581200             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     58120000
581300                              TO DP013-MESSAGE-TEXT (1)           58130000
581400             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  58140000
581500             STRING ' TRIP ID: '                                  58150000
581600                    PV-DISP-TRIP-ID                               58160000
581700                    ' EXT SHIP ID: '                              58170000
581800                    DK-EXT-SHP-ID                                 58180000
581900                    ' DWNLD TMST: '                               58190000
582000                    PV-CURRENT-TMST                               58200000
582100             DELIMITED BY SIZE                                    58210000
582200             INTO DP013-MESSAGE-TEXT (2)                          58220000
582300             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         58230000
582400             MOVE SQLCA       TO DP013-SQLCA                      58240000
582500             SET DP013-DB2-ABEND  TO TRUE                         58250000
582600             PERFORM 9999-ABEND                                   58260000
582700     END-EVALUATE.                                                58270000
582800                                                                  58280000
582900******************************************************************58290000
583000* CALL PO-RCVR-TRKING-MODULE TO INSERT RCT_PO_RCVR_TRKG          *58300000
583100******************************************************************58310000
583200 7450-CALL-PO-RCVR-TRKG-MOD.                                      58320000
583300                                                                  58330000
583400     INITIALIZE RC071-FIELDS.                                     58340000
583500     MOVE WST00002-PO-NBR           TO RC071-PO-NBR               58350000
583600     MOVE WST00002-RCVR-SEQ-NBR     TO RC071-PO-RCVR              58360000
583700     MOVE WST00002-PREPK-ID         TO RC071-PREPK-ID             58370000
583800     MOVE WST00002-PO-LNE-NBR       TO RC071-PO-LINE              58380000
583900     MOVE PV-OPER-UNT-ID-PIC9       TO RC071-SIGNON-LOCATION      58390000
584000     MOVE WST00002-CRE-USR-ID       TO RC071-USER-ID              58400000
584100     MOVE PC-PROGRAM-NAME           TO RC071-CALLING-PROGRAM      58410000
584200     IF WST00002-DWNLD-CDE = PC-T                                 58420000
584300        MOVE PC-DC-FUNC-CDE-TRBL  TO RC071-DC-FUNCTION-CODE       58430000
584400     ELSE                                                         58440000
584500        MOVE PC-DC-FUNC-CDE-DWNLD TO RC071-DC-FUNCTION-CODE       58450000
584600     END-IF.                                                      58460000
584700                                                                  58470000
584800     MOVE LENGTH OF RC071-FIELDS    TO PV-COMMAREA-LENGTH.        58480000
584900                                                                  58490000
585000     CALL RC071-PO-RCVR-TRACKING USING  DFHEIBLK                  58500000
585100                                        RC071-COMMAREA            58510000
585200                                        RC071-FIELDS.             58520000
585300                                                                  58530000
585400     EVALUATE TRUE                                                58540000
585500       WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                   58550000
585600          IF RC071-SUCCESSFUL                                     58560000
585700             CONTINUE                                             58570000
585800          ELSE                                                    58580000
585900             SET  PS-ERROR           TO TRUE                      58590000
586000             MOVE SQLCODE            TO PV-DISP-SQLCODE           58600000
586100             MOVE WST00002-PO-NBR    TO PV-DISP-PO-NBR            58610000
586200             MOVE WST00002-RCVR-SEQ-NBR TO PV-DISP-RCVR-SEQ-NBR   58620000
586300             MOVE WST00002-PREPK-ID   TO PV-DISP-PREPK-ID         58630000
586400             MOVE WST00002-PO-LNE-NBR TO PV-DISP-PO-LINE-NBR      58640000
586500             STRING ' ' WS003-SRC-TASK-NUMBER                     58650000
586600                    ' WSKCS301-7450: CALL-PO-RCVR-TRKL-MOD'       58660000
586700                    ' CALLED BY-'                                 58670000
586800                     WS003-CALLING-PROGRAM-NAME                   58680000
586900                    ' SQLCODE='                                   58690000
587000                     PV-DISP-SQLCODE                              58700000
587100                    ' SUCC='                                      58710000
587200                     WS003-SUCCESS-IND                            58720000
587300                     ' PO='                                       58730000
587400                     PV-DISP-PO-NBR                               58740000
587500                     ' RCVR='                                     58750000
587600                     PV-DISP-RCVR-SEQ-NBR                         58760000
587700                     ' PRPK='                                     58770000
587800                     PV-DISP-PREPK-ID                             58780000
587900                     ' LNE='                                      58790000
588000                     PV-DISP-PO-LINE-NBR                          58800000
588100             DELIMITED BY SIZE                                    58810000
588200             INTO PV-CICS-MSG-AREA                                58820000
588300             PERFORM 9200-WRITE-TO-CICS-LOG                       58830000
588400             MOVE '7450-CALL-PO-RCVR-TRKL-MOD'                    58840000
588500                              TO DP013-PARAGRAPH                  58850000
588600             MOVE 'SELECT WST_SHPMT_XREF_DTL'                     58860000
588700                              TO DP013-MESSAGE-TEXT (1)           58870000
588800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  58880000
588900             STRING ' TRIP ID: '                                  58890000
589000                    PV-DISP-TRIP-ID                               58900000
589100                    ' EXT SHIP ID: '                              58910000
589200                    DK-EXT-SHP-ID                                 58920000
589300                    ' DWNLD TMST: '                               58930000
589400                    PV-CURRENT-TMST                               58940000
589500             DELIMITED BY SIZE                                    58950000
589600             INTO DP013-MESSAGE-TEXT (2)                          58960000
589700             MOVE 'WST00002'  TO DP013-DB2-TABLE-NAME (1)         58970000
589800             MOVE SQLCA       TO DP013-SQLCA                      58980000
589900             SET DP013-DB2-ABEND  TO TRUE                         58990000
590000             PERFORM 9999-ABEND                                   59000000
590100          END-IF                                                  59010000
590200     END-EVALUATE.                                                59020000
590300                                                                  59030000
590400     IF PS-WRITE-TO-CSSL-YES                                      59040000
590500      AND SQLCODE = 0                                             59050000
590600         STRING   ' ' WS003-SRC-TASK-NUMBER                       59060000
590700                  ' ' PV-DISP-EXT-SHP-ID (1:10)                   59070000
590800                  ' WSKCS301-7450: CALL-PO-RCVR-TRKG-MOD'         59080000
590900         DELIMITED BY SIZE                                        59090000
591000         INTO PV-CICS-MSG-AREA                                    59100000
591100         PERFORM 9200-WRITE-TO-CICS-LOG                           59110000
591200         MOVE SHPUNT-SHIPT-UNT-ID  TO PV-DISP-SHIPT-UNT-ID        59120000
591300         STRING ' ' WS003-SRC-TASK-NUMBER                         59130000
591400                ' ' PV-DISP-EXT-SHP-ID                            59140000
591500                ' SHIP UNT ID: '                                  59150000
591600                PV-DISP-SHIPT-UNT-ID                              59160000
591700         DELIMITED BY SIZE                                        59170000
591800         INTO PV-CICS-MSG-AREA                                    59180000
591900         PERFORM 9200-WRITE-TO-CICS-LOG                           59190000
592000     END-IF.                                                      59200000
592100                                                                  59210000
592200******************************************************************59220000
592300** TRACK WHAT WAS DOWNLOADED TO WMS THRU THESE DATA CNTL TABLES **59230000
592400******************************************************************59240000
592500 7500-DAT-CNTL-TBLS.                                              59250000
592600                                                                  59260000
592700     IF PS-WRITE-HDR-ONLY-TO-TEMP                                 59270000
592800      AND PS-THIS-IS-ASN-HDR-YES                                  59280000
592900        MOVE PV-PRC-LOD-SEQ-ID TO WST00004-PRC-LOD-SEQ-ID         59290000
593000        MOVE 'WSRD004'         TO WST00004-RDM-PRC-TYP-CDE        59300000
593100        MOVE WS004-ASN-REC     TO WST00004-LOD-DAT-TXT-TEXT       59310000
593200        IF PS-DAT-CNTL-REC-INSERTED-NO                            59320000
593300           PERFORM 7600-INSERT-DAT-CNTL                           59330000
593400        END-IF                                                    59340000
593500        PERFORM 7650-INSERT-DAT-XFER                              59350000
593600        SET PS-THIS-IS-ASN-HDR-NO TO TRUE                         59360000
593700     END-IF.                                                      59370000
593800                                                                  59380000
593900     IF PS-WRITE-ALL-TO-TEMP                                      59390000
594000        MOVE PV-PRC-LOD-SEQ-ID      TO WST00004-PRC-LOD-SEQ-ID    59400000
594100        STRING 'ASN '                                             59410000
594200               PV-TEMP-COPYBOOK-NAME                              59420000
594300        DELIMITED BY SIZE                                         59430000
594400        INTO WST00004-RDM-PRC-TYP-CDE                             59440000
594500        MOVE WST00011-REC-TYP-DESC-TEXT                           59450000
594600                                    TO WST00004-LOD-DAT-TXT-TEXT  59460000
594700        IF PS-DAT-CNTL-REC-INSERTED-NO                            59470000
594800           PERFORM 7600-INSERT-DAT-CNTL                           59480000
594900        END-IF                                                    59490000
595000        PERFORM 7650-INSERT-DAT-XFER                              59500000
595100        SET PS-THIS-IS-ASN-HDR-NO   TO TRUE                       59510000
595200     END-IF.                                                      59520000
595300                                                                  59530000
595400******************************************************************59540000
595500* INSERT WST_DAT_CNTL                                            *59550000
595600******************************************************************59560000
595700 7600-INSERT-DAT-CNTL.                                            59570000
595800                                                                  59580000
595900     EXEC SQL                                                     59590000
596000          INSERT INTO WST_DAT_CNTL                                59600000
596100               ( TRN_TYP_CDE                                      59610000
596200                ,PRC_GP_ID                                        59620000
596300                ,PRC_CNTL_TMST                                    59630000
596400                ,LOC_NBR                                          59640000
596500                ,STAT_CDE                                         59650000
596600                ,BEG_PRC_TMST                                     59660000
596700                ,END_PRC_TMST                                     59670000
596800                ,DAT_LOD_VER_NBR                                  59680000
596900               )                                                  59690000
597000             VALUES                                               59700000
597100               ( :WST00003-TRN-TYP-CDE                            59710000
597200                ,:WST00003-PRC-GP-ID                              59720000
597300                ,:WST00003-PRC-CNTL-TMST                          59730000
597400                ,:WST00003-LOC-NBR                                59740000
597500                ,:WST00003-STAT-CDE                               59750000
597600                ,:WST00003-BEG-PRC-TMST                           59760000
597700                ,:WST00003-END-PRC-TMST                           59770000
597800                ,:WST00003-DAT-LOD-VER-NBR                        59780000
597900               )                                                  59790000
598000     END-EXEC                                                     59800000
598100                                                                  59810000
598200     EVALUATE TRUE                                                59820000
598300         WHEN SQLCODE = ZERO                                      59830000
598400              SET PS-DAT-CNTL-REC-INSERTED-YES TO TRUE            59840000
598500         WHEN SQLCODE = -803                                      59850000
598600              ADD  1 TO WST00003-PRC-GP-ID                        59860000
598700                        WST00004-PRC-GP-ID                        59870000
598800              PERFORM 7601-INSERT-DAT-CNTL-RETRY                  59880000
598900         WHEN SQLWARN0 NOT = SPACES                               59890000
599000         WHEN SQLCODE NOT = ZERO                                  59900000
599100         WHEN SQLCODE NOT = -803                                  59910000
599200             SET  PS-ERROR         TO TRUE                        59920000
599300             MOVE SQLCODE            TO PV-DISP-SQLCODE           59930000
599400             MOVE WST00003-TRN-TYP-CDE TO PV-DISP-TRN-TYP-CDE     59940000
599500             MOVE WST00003-PRC-GP-ID   TO PV-DISP-PRC-GP-ID       59950000
599600             MOVE WST00003-LOC-NBR     TO PV-DISP-OPER-UNT-ID     59960000
599700             STRING  ' ' WS003-SRC-TASK-NUMBER                    59970000
599800                     ' WSKCS301-7600: INSERT-DAT-CNTL'            59980000
599900                     ' CALLED BY-'                                59990000
600000                     WS003-CALLING-PROGRAM-NAME                   60000000
600100                     ' SQLCODE='                                  60010000
600200                     PV-DISP-SQLCODE                              60020000
600300                     ' SUCC='                                     60030000
600400                     WS003-SUCCESS-IND                            60040000
600500                     ' TRN TYP='                                  60050000
600600                     PV-DISP-TRN-TYP-CDE                          60060000
600700                     ' PRC GP='                                   60070000
600800                     PV-DISP-PRC-GP-ID                            60080000
600900                     ' OPER UNT='                                 60090000
601000                     PV-DISP-OPER-UNT-ID                          60100000
601100             DELIMITED BY SIZE                                    60110000
601200             INTO PV-CICS-MSG-AREA                                60120000
601300             PERFORM 9200-WRITE-TO-CICS-LOG                       60130000
601400             MOVE '7600-INSERT-DAT-CNTL'                          60140000
601500                          TO DP013-PARAGRAPH                      60150000
601600             MOVE 'UPDATE WST_DAT_CNTL'                           60160000
601700                          TO DP013-MESSAGE-TEXT (1)               60170000
601800             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  60180000
601900             STRING ' TRIP ID: '                                  60190000
602000                    PV-DISP-TRIP-ID                               60200000
602100                    ' EXT SHIP ID: '                              60210000
602200                    DK-EXT-SHP-ID                                 60220000
602300                    ' DWNLD TMST: '                               60230000
602400                    PV-CURRENT-TMST                               60240000
602500             DELIMITED BY SIZE                                    60250000
602600             INTO DP013-MESSAGE-TEXT (2)                          60260000
602700             MOVE 'WST00003'  TO DP013-DB2-TABLE-NAME (1)         60270000
602800             MOVE SQLCA       TO DP013-SQLCA                      60280000
602900             SET DP013-DB2-ABEND  TO TRUE                         60290000
603000             PERFORM 9999-ABEND                                   60300000
603100     END-EVALUATE.                                                60310000
603200                                                                  60320000
603300     IF PS-WRITE-TO-CSSL-YES                                      60330000
603400      AND (SQLCODE = 0 OR SQLCODE = -803)                         60340000
603500         STRING  ' ' WS003-SRC-TASK-NUMBER                        60350000
603600                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    60360000
603700                 ' WSKCS301-7600: INSERT-DAT-CNTL'                60370000
603800         DELIMITED BY SIZE                                        60380000
603900         INTO PV-CICS-MSG-AREA                                    60390000
604000         PERFORM 9200-WRITE-TO-CICS-LOG                           60400000
604100         MOVE WST00003-PRC-GP-ID  TO PV-DISP-PRC-GP-ID            60410000
604200         STRING  ' ' WS003-SRC-TASK-NUMBER                        60420000
604300                 ' ' PV-DISP-EXT-SHP-ID                           60430000
604400                 ' PRC GP ID: '                                   60440000
604500                  PV-DISP-PRC-GP-ID                               60450000
604600         DELIMITED BY SIZE                                        60460000
604700         INTO PV-CICS-MSG-AREA                                    60470000
604800         PERFORM 9200-WRITE-TO-CICS-LOG                           60480000
604900     END-IF.                                                      60490000
605000                                                                  60500000
605100     IF PS-WRITE-TO-CSSL-YES                                      60510000
605200       AND SQLCODE = 0                                            60520000
605300         MOVE WST00003-PRC-GP-ID TO PV-DISP-PRC-GP-ID             60530000
605400         STRING  ' ' WS003-SRC-TASK-NUMBER                        60540000
605500                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    60550000
605600                 ' 7600-INSERT-DAT-CNTL '                         60560000
605700                 ' WST00003-PRC-GP-ID : '                         60570000
605800                 PV-DISP-PRC-GP-ID                                60580000
605900                 ' WST00003-TRN-TYP-CDE :'                        60590000
606000                 WST00003-TRN-TYP-CDE                             60600000
606100         DELIMITED BY SIZE                                        60610000
606200         INTO PV-CICS-MSG-AREA                                    60620000
606300         PERFORM 9200-WRITE-TO-CICS-LOG                           60630000
606400     END-IF.                                                      60640000
606500                                                                  60650000
606600******************************************************************60660000
606700* INSERT WST_DAT_CNTL - RETRY BECAUSE OF -803 IN PARA 7600-      *60670000
606800*                       THE PRC-GP-ID NBR, WHICH IS THE LAST     *60680000
606900*                       6 BYTES OF THE PRC_CNTL_TMST WAS INCRE-  *60690000
607000*                       MENTED BY 1 BEOFRE THE RETRY.            *60700000
607100******************************************************************60710000
607200 7601-INSERT-DAT-CNTL-RETRY.                                      60720000
607300                                                                  60730000
607400     EXEC SQL                                                     60740000
607500          INSERT INTO WST_DAT_CNTL                                60750000
607600               ( TRN_TYP_CDE                                      60760000
607700                ,PRC_GP_ID                                        60770000
607800                ,PRC_CNTL_TMST                                    60780000
607900                ,LOC_NBR                                          60790000
608000                ,STAT_CDE                                         60800000
608100                ,BEG_PRC_TMST                                     60810000
608200                ,END_PRC_TMST                                     60820000
608300                ,DAT_LOD_VER_NBR                                  60830000
608400               )                                                  60840000
608500             VALUES                                               60850000
608600               ( :WST00003-TRN-TYP-CDE                            60860000
608700                ,:WST00003-PRC-GP-ID                              60870000
608800                ,:WST00003-PRC-CNTL-TMST                          60880000
608900                ,:WST00003-LOC-NBR                                60890000
609000                ,:WST00003-STAT-CDE                               60900000
609100                ,:WST00003-BEG-PRC-TMST                           60910000
609200                ,:WST00003-END-PRC-TMST                           60920000
609300                ,:WST00003-DAT-LOD-VER-NBR                        60930000
609400               )                                                  60940000
609500     END-EXEC                                                     60950000
609600                                                                  60960000
609700     EVALUATE TRUE                                                60970000
609800         WHEN SQLCODE = ZERO                                      60980000
609900              CONTINUE                                            60990000
610000         WHEN SQLWARN0 NOT = SPACES                               61000000
610100         WHEN SQLCODE NOT = ZERO                                  61010000
610200         WHEN SQLCODE NOT = -803                                  61020000
610300             SET  PS-ERROR         TO TRUE                        61030000
610400             MOVE SQLCODE            TO PV-DISP-SQLCODE           61040000
610500             MOVE WST00003-TRN-TYP-CDE TO PV-DISP-TRN-TYP-CDE     61050000
610600             MOVE WST00003-PRC-GP-ID   TO PV-DISP-PRC-GP-ID       61060000
610700             MOVE WST00003-LOC-NBR     TO PV-DISP-OPER-UNT-ID     61070000
610800             STRING  ' ' WS003-SRC-TASK-NUMBER                    61080000
610900                     ' WSKCS301-7601: INSERT-DAT-CNTL-RETRY'      61090000
611000                     ' CALLED BY-'                                61100000
611100                     WS003-CALLING-PROGRAM-NAME                   61110000
611200                     ' SQLCODE='                                  61120000
611300                     PV-DISP-SQLCODE                              61130000
611400                     ' SUCC='                                     61140000
611500                     WS003-SUCCESS-IND                            61150000
611600                     ' TRN TYP='                                  61160000
611700                     PV-DISP-TRN-TYP-CDE                          61170000
611800                     ' PRC GP='                                   61180000
611900                     PV-DISP-PRC-GP-ID                            61190000
612000                     ' OPER UNT='                                 61200000
612100                     PV-DISP-OPER-UNT-ID                          61210000
612200             DELIMITED BY SIZE                                    61220000
612300             INTO PV-CICS-MSG-AREA                                61230000
612400             PERFORM 9200-WRITE-TO-CICS-LOG                       61240000
612500             MOVE '7601-INSERT-DAT-CNTL-RETRY'                    61250000
612600                              TO DP013-PARAGRAPH                  61260000
612700             MOVE 'UPDATE WST_DAT_CNTL'                           61270000
612800                              TO DP013-MESSAGE-TEXT (1)           61280000
612900             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  61290000
613000             STRING ' TRIP ID: '                                  61300000
613100                    PV-DISP-TRIP-ID                               61310000
613200                    ' EXT SHIP ID: '                              61320000
613300                    DK-EXT-SHP-ID                                 61330000
613400                    ' DWNLD TMST: '                               61340000
613500                    PV-CURRENT-TMST                               61350000
613600             DELIMITED BY SIZE                                    61360000
613700             INTO DP013-MESSAGE-TEXT (2)                          61370000
613800             MOVE 'WST00003'  TO DP013-DB2-TABLE-NAME (1)         61380000
613900             MOVE SQLCA       TO DP013-SQLCA                      61390000
614000             SET DP013-DB2-ABEND  TO TRUE                         61400000
614100             PERFORM 9999-ABEND                                   61410000
614200     END-EVALUATE.                                                61420000
614300                                                                  61430000
614400     IF PS-WRITE-TO-CSSL-YES                                      61440000
614500      AND SQLCODE = 0                                             61450000
614600         STRING  ' ' WS003-SRC-TASK-NUMBER                        61460000
614700                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    61470000
614800                 ' WSKCS301-7601: INSERT-DAT-CNTL-RETRY'          61480000
614900         DELIMITED BY SIZE                                        61490000
615000         INTO PV-CICS-MSG-AREA                                    61500000
615100         PERFORM 9200-WRITE-TO-CICS-LOG                           61510000
615200         MOVE WST00003-PRC-GP-ID  TO PV-DISP-PRC-GP-ID            61520000
615300         STRING  ' ' WS003-SRC-TASK-NUMBER                        61530000
615400                 ' ' PV-DISP-EXT-SHP-ID                           61540000
615500                 ' PRC GP ID: '                                   61550000
615600                  PV-DISP-PRC-GP-ID                               61560000
615700         DELIMITED BY SIZE                                        61570000
615800         INTO PV-CICS-MSG-AREA                                    61580000
615900         PERFORM 9200-WRITE-TO-CICS-LOG                           61590000
616000     END-IF.                                                      61600000
616100                                                                  61610000
616200     IF PS-WRITE-TO-CSSL-YES                                      61620000
616300       AND SQLCODE = 0                                            61630000
616400         MOVE WST00003-PRC-GP-ID TO PV-DISP-PRC-GP-ID             61640000
616500         STRING  ' ' WS003-SRC-TASK-NUMBER                        61650000
616600                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    61660000
616700                 ' 7601-INSERT-DAT-CNTL '                         61670000
616800                 ' WST00003-PRC-GP-ID : '                         61680000
616900                 PV-DISP-PRC-GP-ID                                61690000
617000                 ' WST00003-TRN-TYP-CDE :'                        61700000
617100                 WST00003-TRN-TYP-CDE                             61710000
617200         DELIMITED BY SIZE                                        61720000
617300         INTO PV-CICS-MSG-AREA                                    61730000
617400         PERFORM 9200-WRITE-TO-CICS-LOG                           61740000
617500     END-IF.                                                      61750000
617600                                                                  61760000
617700******************************************************************61770000
617800* INSERT WST_DAT_XFER - THERE IS NO RETRY LOGIC FOR -803         *61780000
617900* BECAUSE THE PRC-GP-ID MUST BE THE SAME FOR THESE 2 INSERTS     *61790000
618000******************************************************************61800000
618100 7650-INSERT-DAT-XFER.                                            61810000
618200                                                                  61820000
618300     EXEC SQL                                                     61830000
618400          INSERT INTO WST_DAT_XFER                                61840000
618500               ( TRN_TYP_CDE                                      61850000
618600                ,PRC_GP_ID                                        61860000
618700                ,PRC_LOD_SEQ_ID                                   61870000
618800                ,PRC_CNTL_TMST                                    61880000
618900                ,RDM_PRC_TYP_CDE                                  61890000
619000                ,LOD_DAT_TXT                                      61900000
619100               )                                                  61910000
619200             VALUES                                               61920000
619300               ( :WST00004-TRN-TYP-CDE                            61930000
619400                ,:WST00004-PRC-GP-ID                              61940000
619500                ,:WST00004-PRC-LOD-SEQ-ID                         61950000
619600                ,:WST00004-PRC-CNTL-TMST                          61960000
619700                ,:WST00004-RDM-PRC-TYP-CDE                        61970000
619800                ,:WST00004-LOD-DAT-TXT                            61980000
619900               )                                                  61990000
620000     END-EXEC                                                     62000000
620100                                                                  62010000
620200     EVALUATE TRUE                                                62020000
620300         WHEN SQLCODE = ZERO                                      62030000
620400              ADD +1 TO PV-PRC-LOD-SEQ-ID                         62040000
620500         WHEN SQLWARN0 NOT = SPACES                               62050000
620600         WHEN SQLCODE NOT = ZERO                                  62060000
620700             SET  PS-ERROR         TO TRUE                        62070000
620800             MOVE SQLCODE            TO PV-DISP-SQLCODE           62080000
620900             MOVE WST00003-TRN-TYP-CDE TO PV-DISP-TRN-TYP-CDE     62090000
621000             MOVE WST00003-PRC-GP-ID   TO PV-DISP-PRC-GP-ID       62100000
621100             MOVE WST00003-LOC-NBR     TO PV-DISP-OPER-UNT-ID     62110000
621200             STRING  ' ' WS003-SRC-TASK-NUMBER                    62120000
621300                     ' WSKCS301-7650: 7650-INSERT-DAT-XFER'       62130000
621400                     ' CALLED BY-'                                62140000
621500                     WS003-CALLING-PROGRAM-NAME                   62150000
621600                     ' SQLCODE='                                  62160000
621700                     PV-DISP-SQLCODE                              62170000
621800                     ' SUCC='                                     62180000
621900                     WS003-SUCCESS-IND                            62190000
622000                     ' TRN TYP='                                  62200000
622100                     PV-DISP-TRN-TYP-CDE                          62210000
622200                     ' PRC GP='                                   62220000
622300                     PV-DISP-PRC-GP-ID                            62230000
622400                     ' OPER UNT='                                 62240000
622500                     PV-DISP-OPER-UNT-ID                          62250000
622600             DELIMITED BY SIZE                                    62260000
622700             INTO PV-CICS-MSG-AREA                                62270000
622800             PERFORM 9200-WRITE-TO-CICS-LOG                       62280000
622900             MOVE '7650-INSERT-DAT-XFER'                          62290000
623000                              TO DP013-PARAGRAPH                  62300000
623100             MOVE 'UPDATE WST_DAT_XFER'                           62310000
623200                              TO DP013-MESSAGE-TEXT (1)           62320000
623300             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  62330000
623400             STRING ' TRIP ID: '                                  62340000
623500                    PV-DISP-TRIP-ID                               62350000
623600                    ' EXT SHIP ID: '                              62360000
623700                    DK-EXT-SHP-ID                                 62370000
623800                    ' DWNLD TMST: '                               62380000
623900                    PV-CURRENT-TMST                               62390000
624000             DELIMITED BY SIZE                                    62400000
624100             INTO DP013-MESSAGE-TEXT (2)                          62410000
624200             MOVE 'WST00004'  TO DP013-DB2-TABLE-NAME (1)         62420000
624300             MOVE SQLCA       TO DP013-SQLCA                      62430000
624400             SET DP013-DB2-ABEND  TO TRUE                         62440000
624500             PERFORM 9999-ABEND                                   62450000
624600     END-EVALUATE.                                                62460000
624700                                                                  62470000
624800     IF PS-WRITE-TO-CSSL-YES                                      62480000
624900       AND SQLCODE = 0                                            62490000
625000         MOVE WST00003-PRC-GP-ID TO PV-DISP-PRC-GP-ID             62500000
625100         MOVE PV-PRC-LOD-SEQ-ID  TO PV-DISP-PRC-LOD-SEQ           62510000
625200         STRING  ' ' WS003-SRC-TASK-NUMBER                        62520000
625300                 ' ' PV-DISP-EXT-SHP-ID (1:10)                    62530000
625400                 ' 7650-INSERT-DAT-XFER '                         62540000
625500                 ' WST00003-PRC-GP-ID : '                         62550000
625600                 PV-DISP-PRC-GP-ID                                62560000
625700                 ' PRC LOD SEQ : '                                62570000
625800                 PV-DISP-PRC-LOD-SEQ                              62580000
625900         DELIMITED BY SIZE                                        62590000
626000         INTO PV-CICS-MSG-AREA                                    62600000
626100         PERFORM 9200-WRITE-TO-CICS-LOG                           62610000
626200     END-IF.                                                      62620000
626300                                                                  62630000
626400******************************************************************62640000
626500*                                                                *62650000
626600******************************************************************62660000
626700 7820-GET-VENDOR-ID.                                              62670000
626800                                                                  62680000
626900     EXEC SQL                                                     62690000
627000          SELECT DISTINCT(ENT_ID)                                 62700000
627100          INTO  :PURCHS-ENT-ID                                    62710000
627200          FROM TPURCHS                                            62720000
627300          WHERE PO_NBR         = :WST00002-PO-NBR                 62730000
627310           WITH UR                                                62731008
627400     END-EXEC                                                     62740000
627500                                                                  62750000
627600     EVALUATE TRUE                                                62760000
627700         WHEN SQLCODE = ZERO                                      62770000
627800              IF PS-WRITE-TO-CSSL-YES                             62780000
627900                 STRING   ' ' WS003-SRC-TASK-NUMBER               62790000
628000                          ' ' PV-DISP-EXT-SHP-ID (1:10)           62800000
628100                          ' WSKCS301-7820: GET-VENDOR-ID'         62810000
628200                  DELIMITED BY SIZE                               62820000
628300                  INTO PV-CICS-MSG-AREA                           62830000
628400                  PERFORM 9200-WRITE-TO-CICS-LOG                  62840000
628500                  MOVE WST00002-PO-NBR   TO PV-DISP-PO-NBR        62850000
628600                  MOVE PURCHS-ENT-ID     TO PV-DISP-ENT-ID        62860000
628700                  STRING   ' ' WS003-SRC-TASK-NUMBER              62870000
628800                           ' ' PV-DISP-EXT-SHP-ID (1:10)          62880000
628900                           ' PO NBR : '                           62890000
629000                           PV-DISP-PO-NBR                         62900000
629100                           ' ENT ID : '                           62910000
629200                           PV-DISP-ENT-ID                         62920000
629300                  DELIMITED BY SIZE                               62930000
629400                  INTO PV-CICS-MSG-AREA                           62940000
629500                  PERFORM 9200-WRITE-TO-CICS-LOG                  62950000
629600              END-IF                                              62960000
629700         WHEN SQLCODE = +100                                      62970000
629800              CONTINUE                                            62980000
629900         WHEN SQLWARN0 NOT = SPACES                               62990000
630000         WHEN SQLCODE NOT = ZERO                                  63000000
630100         WHEN SQLCODE NOT = +100                                  63010000
630200             SET  PS-ERROR         TO TRUE                        63020000
630300             MOVE SQLCODE            TO PV-DISP-SQLCODE           63030000
630400             STRING ' ' WS003-SRC-TASK-NUMBER                     63040000
630500                    ' WSKCS301-7820: GET-VENDOR-ID'               63050000
630600                    ' CALLED BY-'                                 63060000
630700                     WS003-CALLING-PROGRAM-NAME                   63070000
630800                    ' SQLCODE='                                   63080000
630900                     PV-DISP-SQLCODE                              63090000
631000                    ' SUCC='                                      63100000
631100                     WS003-SUCCESS-IND                            63110000
631200             DELIMITED BY SIZE                                    63120000
631300             INTO PV-CICS-MSG-AREA                                63130000
631400             PERFORM 9200-WRITE-TO-CICS-LOG                       63140000
631500             MOVE '7820-GET-VENDOR-ID'                            63150000
631600                              TO DP013-PARAGRAPH                  63160000
631700             MOVE 'SELECT TPURCHS'                                63170000
631800                              TO DP013-MESSAGE-TEXT (1)           63180000
631900             MOVE DK-TRIP-ID  TO PV-DISP-TRIP-ID                  63190000
632000             STRING ' TRIP ID: '                                  63200000
632100                    PV-DISP-TRIP-ID                               63210000
632200                    ' EXT SHIP ID: '                              63220000
632300                    DK-EXT-SHP-ID                                 63230000
632400                    ' DWNLD TMST: '                               63240000
632500                    PV-CURRENT-TMST                               63250000
632600             DELIMITED BY SIZE                                    63260000
632700             INTO DP013-MESSAGE-TEXT (2)                          63270000
632800             MOVE 'TPURCHS '  TO DP013-DB2-TABLE-NAME (1)         63280000
632900             MOVE SQLCA       TO DP013-SQLCA                      63290000
633000             SET DP013-DB2-ABEND  TO TRUE                         63300000
633100             PERFORM 9999-ABEND                                   63310000
633200     END-EVALUATE.                                                63320000
633300                                                                  63330000
633400******************************************************************63340000
633500**  WRITE TO LOG IF PV-SWITCH-IND = Y                           **63350000
633600******************************************************************63360000
633700 9200-WRITE-TO-CICS-LOG.                                          63370000
633800                                                                  63380000
633900     MOVE LENGTH PV-CICS-MSG-AREA TO                              63390000
634000                                     PV-COMMAREA-LENGTH.          63400000
634100     EXEC CICS                                                    63410000
634200          WRITEQ TD                                               63420000
634300          QUEUE  ('CSSL')                                         63430000
634400          FROM  (PV-CICS-MSG-AREA)                                63440000
634500          LENGTH  (PV-COMMAREA-LENGTH)                            63450000
634600          RESP  (PV-CICS-RESP)                                    63460000
634700     END-EXEC.                                                    63470000
634800                                                                  63480000
634900     MOVE SPACES TO PV-CICS-MSG-AREA.                             63490000
635000                                                                  63500000
635100******************************************************************63510000
635200*   STANDARD ABEND ROUTINE                                        63520000
635300* ==> PROCESSES:                                                  63530000
635400*   - ISSUES THE ABEND.                                           63540000
635500******************************************************************63550000
635600 9999-ABEND.                                                      63560000
635700     MOVE PC-PROGRAM-NAME             TO DP013-PROGRAM.           63570000
635800     MOVE DFHEIBLK                    TO DP013-DFHEIBLK.          63580000
635900     INITIALIZE DP013-SRC-TASK-NUMBER                             63590000
636000                DP013-STACK.                                      63600000
636100     SET DP013-LINK-RETURN TO TRUE.                               63610000
636200     SET DP013-ROLLBACK    TO TRUE.                               63620000
636300                                                                  63630000
636400     EXEC CICS                                                    63640000
636500         LINK                                                     63650000
636600             PROGRAM  (DP013-NAME)                                63660000
636700             COMMAREA (DP013-PARAMETERS)                          63670000
636800             LENGTH   (DP013-LENGTH)                              63680000
636900     END-EXEC.                                                    63690000
637000                                                                  63700000
637100                                                                  63710000
637200     EXEC CICS                                                    63720000
637300         RETURN                                                   63730000
637400     END-EXEC.                                                    63740000
637500                                                                  63750000
637600******************************************************************63760000
637700**            E N D   O F   P R O G R A M                       **63770000
637800******************************************************************63780000
