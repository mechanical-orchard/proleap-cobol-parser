000100*-----------------------*                                         00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*-----------------------*                                         00030000
000400 PROGRAM-ID.    TRKCS161.                                         00040000
000500 AUTHOR.        NIRMAL KUMAR.                                     00050000
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060000
000700 DATE-WRITTEN.  04/98.                                            00070000
000800 DATE-COMPILED.                                                   00080000
000900*----------------------------------------------------------------*00090000
001000*    Y161 - IMPORT PO TRACKING SUMMARY.                          *00100000
001100*                                                                *00110000
001200*    THIS PROGRAM ALLOWS THE USER TO VIEW IMPORT INFORMATION     *00120000
001300*    FOR A PURCHASE ORDER IN INQUIRY ONLY.                       *00130000
001400*----------------------------------------------------------------*00140000
001500***************************************************************** 00150000
001600* CHANGE DESCRIPTION                                              00160000
001700***************************************************************** 00170000
001800* DATE  06/29/2010                                                00180000
001900*  CHANGE MADE: CHANGED TO DISPLAY WHSE REPLEN INDICATOR FIELD    00190000
002000*  ON TR-PO TRACKING SUMMARY SCREEN                               00200000
002100*  MADE BY: TOYAM SAIKH     TKID:TKMAX89                          00210000
002200*  CHANGES ARE TAGGED AS TS 06/29/2010                            00220000
002201***************************************************************** 00220100
002202***************************************************************** 00220203
002203* DATE  05/16/2011                                                00220303
002204*  CHANGE MADE: THE NEW SYSTEM OF RECORD FOR OUTER PACK QTY WILL  00220403
002205*  BE RMS AND PUBLISHED TO TPURITM.  CHANGED OUTR-PCK-CSR         00220503
002206*  TO SELECT  OUTR_PK_QTY FROM TPURITM AND REMOVED JOIN TO TUPC   00220603
002207*  AND TSKXREF.                                                   00220703
002208*  MADE BY: GERMAN BANDA                                          00220803
002210***************************************************************** 00221003
CICS  * CHANGED  1/12/2023    BY JIM HUNTER      WR: CHG0278495         00221108
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00221208
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00221308
CICS  *-----------------------------------------------------------------00221408
002211                                                                  00221503
002212 ENVIRONMENT DIVISION.                                            00221603
002213                                                                  00221703
002214 DATA DIVISION.                                                   00221803
002215                                                                  00221903
002216 WORKING-STORAGE SECTION.                                         00222003
002217                                                                  00222103
002220 01  PC-PROGRAM-CONSTANTS.                                        00223003
002300     05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'TRKCS161'.  00230000
002400     05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'TR161A  '.  00240000
002500     05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'TRKM161 '.  00250000
002600     05  PC-A                     PIC  X(01)  VALUE  'A'.         00260000
002610     05  PC-TRBL-LIST-FORMAT      PIC  X(01)  VALUE  '2'.         00261000
002700     05  PC-APPL-MAP              PIC S9(04)  VALUE  +1           00270000
002800                                              COMP.               00280000
002900     05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3           00290000
003000                                              COMP.               00300000
003100     05  PC-INIT-DATE             PIC  X(10)  VALUE '0001-01-01'. 00310000
003200                                                                  00320000
003300     05  PC-TSYMSG-NUMBERS.                                       00330000
003310         10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.       00331000
003400         10  PC-TSYMSG-00083      PIC  9(05)  VALUE  00083.       00340000
003500                                                                  00350000
003600 01  PS-PROGRAM-SWITCHES.                                         00360000
003700     05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'N'.         00370000
003800         88  PS-COMMAREA-VALID                VALUE  'Y'.         00380000
003900         88  PS-COMMAREA-NOT-VALID            VALUE  'N'.         00390000
004000                                                                  00400000
004100 01  PV-PROGRAM-VARIABLES.                                        00410000
004200     05  PV-DEPT-NBR              PIC  X(04).                     00420000
004300     05  PV-DEPT-NBR-N REDEFINES                                  00430000
004301         PV-DEPT-NBR              PIC  9(04).                     00430100
004302     05  PV-COUNT                 PIC S9(09)  COMP.               00430200
004303     05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0            00430300
004400                                              COMP SYNC.          00440000
004500     05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0            00450000
004600                                              COMP SYNC.          00460000
004700     05  PV-ITEM-CART-CNT         PIC S9(05)  VALUE +0            00470000
004800                                              COMP.               00480000
004900     05  PV-PO-CART-CNT           PIC S9(05)  VALUE +0            00490000
005000                                              COMP.               00500000
005100     05  PV-AD-DTE-IND            PIC S9(04)  VALUE +0            00510000
005200                                              COMP.               00520000
005300     05  PV-DATE-BREAK.                                           00530000
005400         10  FILLER               PIC  X(02).                     00540000
005500         10  PV-DB-YY             PIC  X(02).                     00550000
005600         10  FILLER               PIC  X(01).                     00560000
005700         10  PV-DB-MM             PIC  X(02).                     00570000
005800         10  FILLER               PIC  X(01).                     00580000
005900         10  PV-DB-DD             PIC  X(02).                     00590000
006000     05  PV-DATE-DISPLAY.                                         00600000
006100         10  PV-DD-MM             PIC  X(02).                     00610000
006200         10  FILLER               PIC  X(01) VALUE '/'.           00620000
006300         10  PV-DD-DD             PIC  X(02).                     00630000
006400         10  FILLER               PIC  X(01) VALUE '/'.           00640000
006500         10  PV-DD-YY             PIC  X(02).                     00650000
006600     05  PV-CONTNR-ID             PIC  X(12)   VALUE SPACES.      00660000
006700     05  PV-TRIP-ID               PIC  S9(09)  COMP VALUE 0.      00670000
006800     05  PV-SHIPT-ID              PIC  S9(09)  COMP VALUE 0.      00680000
006900     05  PV-PO-NBR                PIC  S9(09)  COMP VALUE 0.      00690000
007000     05  PV-OPER-UNT-ID           PIC  S9(4)   COMP VALUE 0.      00700000
007100     05  PV-VEH-NBR               PIC  X(10)   VALUE SPACES.      00710000
007200     05  PV-FOB-CDE               PIC  X(05)   VALUE SPACES.      00720000
007300     05  PV-MOM-FOB-CDE           PIC  X(05)   VALUE SPACES.      00730000
007400     05  PV-MOM-TRIP-TYP-CDE      PIC  X       VALUE SPACES.      00740000
007500     05  PV-FDR-TRIP-TYP-CDE      PIC  X       VALUE SPACES.      00750000
007600     05  PV-MOM-DEST-POE-CDE      PIC  X(04)   VALUE SPACES.      00760000
007700     05  PV-ACTL-POE-DELY-TMST    PIC  X(26)   VALUE SPACES.      00770000
007710     05  PV-SHIP-CTNS             PIC  9(05)   VALUE ZEROES.      00771000
007800                                                                  00780000
007900 EJECT                                                            00790000
008000*---------------------------------------------------------------* 00800000
008100*  RECORD LAYOUT FOR SELECTION TEMP STORAGE QUEUE.                00810000
008200*---------------------------------------------------------------* 00820000
008300                                                                  00830000
008400     COPY TMWS002.                                                00840000
008401                                                                  00840100
008402 EJECT                                                            00840200
008403*----------------------------------------------------------------*00840300
008404*    MAP LAYOUT                                                  *00840400
008405*----------------------------------------------------------------*00840500
008406                                                                  00840600
008407     COPY TRKM161.                                                00840700
008500                                                                  00850000
008600 EJECT                                                            00860000
008700*----------------------------------------------------------------*00870000
008800*    ATTRIBUTE SETTINGS COPYBOOK.                                *00880000
008900*----------------------------------------------------------------*00890000
009000                                                                  00900000
009100     COPY DPWS015.                                                00910000
009200                                                                  00920000
009300 EJECT                                                            00930000
009400*----------------------------------------------------------------*00940000
009500*    FUNCTION KEYS COPYBOOK                                      *00950000
009600*----------------------------------------------------------------*00960000
009700                                                                  00970000
009800     COPY DPWS016.                                                00980000
009900                                                                  00990000
010000 EJECT                                                            01000000
010100*---------------------------------------------------------------**01010000
010200*  NUMERIC EDIT LAYOUT (DPKUT100)                               **01020000
010300*---------------------------------------------------------------**01030000
010400                                                                  01040000
010500     COPY DPWS010I.                                               01050000
010600                                                                  01060000
010700 EJECT                                                            01070000
010800*---------------------------------------------------------------**01080000
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          **01090008
011000*---------------------------------------------------------------**01100000
011100                                                                  01110000
011200     COPY DPWS030.                                                01120000
CICS       COPY DPWS930.                                                01130008
011400 EJECT                                                            01140000
011500*---------------------------------------------------------------**01150000
011600*    STANDARD COMMAREA.                                           01160000
011700*---------------------------------------------------------------**01170000
011800                                                                  01180000
011900     COPY DPWS020.                                                01190000
012000     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01200000
012100                                                                  01210000
012200*----------------------------------------------------------------*01220000
012300*    INTER-APPLICATION COMMAREA.                                 *01230000
012400*----------------------------------------------------------------*01240000
012500                                                                  01250000
012600         10  INTER-APPL-COMM-AREA PIC X(200).                     01260000
012700     COPY TRWS105.                                                01270000
012800     COPY TMWS006.                                                01280000
012900                                                                  01290000
012904*----------------------------------------------------------------*01290400
012905*    SPECIFIC COMMMAREA FOR TRKCS161.                            *01290500
013000*----------------------------------------------------------------*01300000
013100         10  ASC-SPECIFIC-COMMAREA.                               01310000
013200             15  ASC-USE-SELECTION-QUEUE-IND     PIC X(01).       01320000
013300                 88  ASC-USE-SELECTION-QUEUE     VALUE 'Y'.       01330000
013400             15  ASC-NUMBER-OF-SELECTED-ITEMS    PIC S9(09)       01340000
013500                                                     COMP-3.      01350000
013600             15  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.     01360000
013700             15  ASC-IN-SEL-QUEUE-NAME           PIC X(08).       01370000
013800             15  ASC-SEL-SUB               PIC S9(04) COMP.       01380000
013900             15  ASC-SEL-ITEM              PIC S9(04) COMP.       01390000
014000             15  ASC-START-ITEM-REQUEST.                          01400000
014001                 20  ASC-START-ITEM-REQUEST-N   PIC  9(05).       01400100
014002             15  ASC-PO-NBR                PIC S9(09)  COMP.      01400200
014003             15  ASC-VND-NME               PIC  X(30).            01400300
014004             15  ASC-PO-TYPE               PIC  X(02).            01400400
014005             15  ASC-DEPT-NBR              PIC S9(04) COMP.       01400500
014006             15  ASC-CAN-DTE               PIC  X(08).            01400600
014007             15  ASC-FOB-CDE               PIC  X(03).            01400700
014008             15  ASC-EXT-CAN-DTE           PIC  X(08).            01400800
014009             15  ASC-POE-CDE               PIC  X(03).            01400900
014010             15  ASC-STRT-X-FACT-DTE       PIC  X(08).            01401000
014100             15  ASC-AD-DTE                PIC  X(08).            01410000
014200             15  ASC-LAST-X-FACT-DTE       PIC  X(08).            01420000
014300             15  ASC-OTB-MTH               PIC  X(06).            01430000
014400             15  ASC-DONT-SHP-BEF-DTE      PIC  X(08).            01440000
014500             15  ASC-CNTRY-CDE             PIC  X(03).            01450000
014600             15  ASC-ORD-UNTS              PIC S9(09) COMP.       01460000
014700             15  ASC-EXP-CTNS              PIC S9(05) COMP.       01470000
014800             15  ASC-POINFO-IND            PIC  X(01).            01480000
014900             15  ASC-BOOKING-IND           PIC  X(01).            01490000
015000             15  ASC-RECEIVING-IND         PIC  X(01).            01500000
015100             15  ASC-SAILING-IND           PIC  X(01).            01510000
015200             15  ASC-CONTAINER-IND         PIC  X(01).            01520000
015300             15  ASC-BUYER-DECON-IND       PIC  X(01).            01530000
015400             15  ASC-DECONSOL-LH-IND       PIC  X(01).            01540000
015500             15  ASC-TRAILER-IND           PIC  X(01).            01550000
015600             15  ASC-CUSTOMS-IND           PIC  X(01).            01560000
015700             15  ASC-PO-STATUS             PIC  X(20).            01570000
015900             15  FILLER                    PIC  X(01).            01590006
015902                                                                  01590200
015903 EJECT                                                            01590300
015904*----------------------------------------------------------------*01590400
016000*    ABEND PROCESSING COPYBOOK.                                  *01600000
016100*----------------------------------------------------------------*01610000
016200                                                                  01620000
016300     COPY DPWS013.                                                01630000
016400                                                                  01640000
016500 EJECT                                                            01650000
016600*----------------------------------------------------------------*01660000
016700*    DB2 AREA FOR PURCHASE ORDER                                 *01670000
016800*----------------------------------------------------------------*01680000
016900     EXEC SQL                                                     01690000
017000          INCLUDE TPURCHS                                         01700000
017100     END-EXEC.                                                    01710000
017200*----------------------------------------------------------------*01720000
017300*    DB2 AREA FOR ENTERPRISE NAME                                *01730000
017400*----------------------------------------------------------------*01740000
017500     EXEC SQL                                                     01750000
017600          INCLUDE TENTNME                                         01760000
017700     END-EXEC.                                                    01770000
017800*----------------------------------------------------------------*01780000
017900*    DB2 AREA FOR TIMCNTK TABLE                                  *01790000
018000*----------------------------------------------------------------*01800000
018100     EXEC SQL                                                     01810000
018200          INCLUDE TIMCNTK                                         01820000
018300     END-EXEC.                                                    01830000
018400*----------------------------------------------------------------*01840000
018500*    DB2 AREA FOR VEHICLE TABLE                                  *01850000
018600*----------------------------------------------------------------*01860000
018700     EXEC SQL                                                     01870000
018800          INCLUDE TVEHICL                                         01880000
018900     END-EXEC.                                                    01890000
019000*----------------------------------------------------------------*01900000
019100*    DB2 AREA FOR PLANNED SHIPMENTS                              *01910000
019200*----------------------------------------------------------------*01920000
019300     EXEC SQL                                                     01930000
019400          INCLUDE TPLNSHP                                         01940000
019500     END-EXEC.                                                    01950000
019600*----------------------------------------------------------------*01960000
019700*    DB2 AREA FOR AD EVENT DATE                                  *01970000
019800*----------------------------------------------------------------*01980000
019900     EXEC SQL                                                     01990000
020000          INCLUDE TPURITM                                         02000000
020100     END-EXEC.                                                    02010000
020200*----------------------------------------------------------------*02020000
020300*    DB2 AREA FOR THE PACK SLIP TABLE                            *02030000
020400*----------------------------------------------------------------*02040000
020500     EXEC SQL                                                     02050000
020600          INCLUDE TPKSLIP                                         02060000
020700     END-EXEC.                                                    02070000
020800*----------------------------------------------------------------*02080000
020900*    DB2 AREA FOR THE PORT OF ENTRY TABLE                        *02090000
021000*----------------------------------------------------------------*02100000
021100     EXEC SQL                                                     02110000
021200          INCLUDE TIMPOE                                          02120000
021300     END-EXEC.                                                    02130000
021400*----------------------------------------------------------------*02140000
021500*    DB2 AREA FOR THE FREE ON BOARD TABLE                        *02150000
021600*----------------------------------------------------------------*02160000
021700     EXEC SQL                                                     02170000
021800          INCLUDE TIMFOB                                          02180000
021900     END-EXEC.                                                    02190000
022000*----------------------------------------------------------------*02200000
022100*    DB2 AREA FOR THE BOOKING TABLE                              *02210000
022200*----------------------------------------------------------------*02220000
022300     EXEC SQL                                                     02230000
022400          INCLUDE TIMBKPO                                         02240000
022500     END-EXEC.                                                    02250000
022600*----------------------------------------------------------------*02260000
022700*    DB2 AREA FOR THE CUSTOMS PO TABLES                          *02270000
022800*----------------------------------------------------------------*02280000
022900     EXEC SQL                                                     02290000
023000          INCLUDE TIMCSPO                                         02300000
023100     END-EXEC.                                                    02310000
023200*----------------------------------------------------------------*02320000
023300*    DB2 AREA FOR THE TRIP TABLE                                 *02330000
023400*----------------------------------------------------------------*02340000
023500     EXEC SQL                                                     02350000
023600          INCLUDE TTRIPST                                         02360000
023700     END-EXEC.                                                    02370000
023800*----------------------------------------------------------------*02380000
023900*    DB2 AREA FOR THE RECEIVING TABLE                            *02390000
024000*----------------------------------------------------------------*02400000
024100     EXEC SQL                                                     02410000
024200          INCLUDE TIMRCPO                                         02420000
024300     END-EXEC.                                                    02430000
024400*----------------------------------------------------------------*02440000
024500*    DB2 AREA FOR THE TIMCNPO TABLE                              *02450000
024600*----------------------------------------------------------------*02460000
024700     EXEC SQL                                                     02470000
024800          INCLUDE TIMCNPO                                         02480000
024900     END-EXEC.                                                    02490000
025000*----------------------------------------------------------------*02500000
025100*    DB2 AREA FOR THE TSKXREF TABLE                              *02510000
025200*----------------------------------------------------------------*02520000
025300     EXEC SQL                                                     02530000
025400          INCLUDE TSKXREF                                         02540000
025500     END-EXEC.                                                    02550000
025501*----------------------------------------------------------------*02550100
025502*    DB2 AREA FOR THE TUPC TABLE                                 *02550200
025503*----------------------------------------------------------------*02550300
025504     EXEC SQL                                                     02550400
025505          INCLUDE TUPC                                            02550500
025506     END-EXEC.                                                    02550600
025600*----------------------------------------------------------------*02560000
025700*    DB2 AREA FOR THE TVHTRIP  TABLE                             *02570000
025800*----------------------------------------------------------------*02580000
025900     EXEC SQL                                                     02590000
026000          INCLUDE TVHTRIP                                         02600000
026100     END-EXEC.                                                    02610000
026200*----------------------------------------------------------------*02620000
026300*    DB2 AREA FOR THE TSHPTPO  TABLE                             *02630000
026400*----------------------------------------------------------------*02640000
026500     EXEC SQL                                                     02650000
026600          INCLUDE TSHPTPO                                         02660000
026700     END-EXEC.                                                    02670000
026800*----------------------------------------------------------------*02680000
026900*    DB2 AREA FOR THE TSHIPMT  TABLE                             *02690000
027000*----------------------------------------------------------------*02700000
027100     EXEC SQL                                                     02710000
027200          INCLUDE TSHIPMT                                         02720000
027300     END-EXEC.                                                    02730000
027400*----------------------------------------------------------------*02740000
027500*    DB2 AREA FOR THE TRECEIV  TABLE                             *02750000
027600*----------------------------------------------------------------*02760000
027700     EXEC SQL                                                     02770000
027800          INCLUDE TRECEIV                                         02780000
027900     END-EXEC.                                                    02790000
028000*----------------------------------------------------------------*02800000
028100*    DB2 AREA FOR THE TSTATCD  TABLE                             *02810000
028200*----------------------------------------------------------------*02820000
028300     EXEC SQL                                                     02830000
028400          INCLUDE TSTATCD                                         02840000
028500     END-EXEC.                                                    02850000
028600                                                                  02860004
028700                                                                  02870004
029401*                                                                 02940100
029402*----------------------------------------------------------------*02940200
029403*    DB2 AREA FOR COMMUNICATIONS                                 *02940300
029404*----------------------------------------------------------------*02940400
029405     EXEC SQL                                                     02940500
029406          INCLUDE SQLCA                                           02940600
029407     END-EXEC.                                                    02940700
029408*----------------------------------------------------------------*02940800
029409*    CURSOR DECLARATION FOR SELECTING OUTER PACK QUANTITY        *02940900
029410*----------------------------------------------------------------*02941000
029500                                                                  02950000
029600     EXEC SQL                                                     02960000
029700          DECLARE  OUTR-PCK-CSR CURSOR                            02970000
029800             FOR   SELECT                                         02980000
030000                   A.UNT_QTY                                      03000000
030010                ,  A.OUTR_PK_QTY                                  03001002
030100             FROM  TPURITM  A                                     03010000
030301             WHERE A.PO_NBR         = :ASC-PO-NBR                 03030100
030500             AND   A.VER_STATUS_CDE = 'A'                         03050000
030600             FOR   FETCH ONLY                                     03060000
030700     END-EXEC.                                                    03070000
030800                                                                  03080000
030900 EJECT                                                            03090000
031000*----------------------------------------------------------------*03100000
031100 LINKAGE SECTION.                                                 03110000
031200                                                                  03120000
031300 01  DFHCOMMAREA.                                                 03130000
031400     05  FILLER                         OCCURS  1 TO 4072 TIMES   03140000
031500                                        DEPENDING ON EIBCALEN.    03150000
031600         10  FILLER                     PIC X.                    03160000
031700                                                                  03170000
031800*----------------------------------------------------------------*03180000
031900 PROCEDURE DIVISION.                                              03190000
032000*----------------------------------------------------------------*03200000
032100*  THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM.   *03210000
032200*  THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API    *03220000
032300*  MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.              *03230000
032400*                                                                *03240000
032500*  THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE    *03250000
032600*  LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.         *03260000
032700*----------------------------------------------------------------*03270000
032800 0000-MAIN-MODULE.                                                03280000
032900                                                                  03290000
033000     INITIALIZE DP030-CICS-API-FIELDS.                            03300000
033100     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       03310000
033200     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          03320000
033300     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         03330000
033400     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       03340000
033500     MOVE LENGTH OF TR161AI        TO DP030-MAP-LENGTH (1).       03350000
033600     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     03360000
033700     PERFORM 0001-CALL-CICS-ARCH-API.                             03370000
033800     PERFORM 1000-CONTROL-PROCESSING                              03380000
033900     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     03390000
034000     PERFORM 0001-CALL-CICS-ARCH-API.                             03400000
034100                                                                  03410000
034200*----------------------------------------------------------------*03420000
034300*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *03430000
034400*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *03440000
034500*----------------------------------------------------------------*03450000
034600 0001-CALL-CICS-ARCH-API.                                         03460000
034700                                                                  03470000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      03480008
034900                                    DFHCOMMAREA                   03490008
035000                                    DP030-CICS-API-FIELDS         03500008
035100                                    DP020-STANDARD-COMMAREA       03510008
035200                                    TR161AI.                      03520008
035300*                                                                 03530000
035400     IF  DP030-RC-CALL-SUCCESSFUL                                 03540000
035500         CONTINUE                                                 03550000
035600     ELSE                                                         03560000
035700         SET DP013-NO-ROLLBACK                                    03570000
035800             DP013-XCTL-DISPLAY-RESTART                           03580000
035900             DP013-CICS-ABEND      TO TRUE                        03590000
036000         MOVE 'BEFORE 0000-MAIN-MODULE'                           03600000
036100                                   TO DP013-PARAGRAPH             03610000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O03631008
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      03632008
036400         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      03640000
036500         PERFORM DP013-0000-PROCESS-ABEND                         03650000
036600     END-IF.                                                      03660000
036700                                                                  03670000
036800 EJECT                                                            03680000
036900*----------------------------------------------------------------*03690000
037000*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *03700000
037100*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *03710000
037200*----------------------------------------------------------------*03720000
037300 1000-CONTROL-PROCESSING.                                         03730000
037400                                                                  03740000
037500     EVALUATE TRUE                                                03750000
037600         WHEN DP020-NEXT-ACT-INITIAL                              03760000
037700             INITIALIZE ASC-SPECIFIC-COMMAREA                     03770000
037800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 03780000
037900             IF  PS-COMMAREA-NOT-VALID                            03790000
038000                 SET DP020-NEXT-ACT-APPL-ERROR                    03800000
038100                                   TO TRUE                        03810000
038200             ELSE                                                 03820000
038300                 PERFORM 4000-BUILD-INITIAL-PANEL                 03830000
038400             END-IF                                               03840000
038500                                                                  03850000
038600         WHEN DP020-NEXT-ACT-READ-MAP                             03860000
038700             PERFORM 2000-PROCESS-PANEL                           03870000
038800                                                                  03880000
038900         WHEN DP020-NEXT-ACT-RETURN                               03890000
039000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 03900000
039100                                                                  03910000
039200         WHEN OTHER                                               03920000
039300             SET DP013-LOGIC-ABEND TO TRUE                        03930000
039400             SET DP013-NO-ROLLBACK TO TRUE                        03940000
039500             MOVE '1000-CONTROL-PROCESSING'                       03950000
039600                                   TO DP013-PARAGRAPH             03960000
039700             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    03970000
039800                                   TO DP013-MESSAGE-TEXT(1)       03980000
039900             PERFORM DP013-0000-PROCESS-ABEND                     03990000
040000     END-EVALUATE.                                                04000000
040100                                                                  04010000
040200 EJECT                                                            04020000
040300*----------------------------------------------------------------*04030000
040400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *04040000
040500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *04050000
040600*----------------------------------------------------------------*04060000
040700 1100-PROCESS-INTER-APPL-COMM.                                    04070000
040800                                                                  04080000
040900     SET PS-COMMAREA-VALID         TO TRUE.                       04090000
041000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     04100000
041100                                                                  04110000
145600     EVALUATE TRUE                                                14560000
145700**** COMING FROM THE TRBL LIST SCREEN  *************************  14570000
145800         WHEN DP020-INT-APPL-FORMAT-IND = PC-TRBL-LIST-FORMAT     14580000
145900             IF TM006-NUMBER-OF-SELECTED-ITEMS > ZERO             14590000
146000                 SET ASC-USE-SELECTION-QUEUE                      14600000
146100                           TO TRUE                                14610000
146200                 MOVE TM006-NUMBER-OF-SELECTED-ITEMS              14620000
146300                           TO ASC-NUMBER-OF-SELECTED-ITEMS        14630000
146400                 MOVE TM006-NUMBER-OF-TS-ITEMS                    14640000
146500                             TO ASC-NUMBER-OF-TS-ITEMS            14650000
146600                 MOVE TM006-SEL-QUEUE-NAME                        14660000
146700                           TO ASC-IN-SEL-QUEUE-NAME               14670000
146800                 PERFORM 1120-PREPARE-LIST-ENTRY                  14680000
146900             END-IF                                               14690000
147000                                                                  14700000
147100         WHEN DP020-NAV-KEY-DATA > SPACE                          14710000
147200             MOVE DP020-NAV-KEY-DATA   TO ASC-PO-NBR              14720000
147300                                                                  14730000
147400         WHEN OTHER                                               14740000
147500             MOVE TR105-PO-NBR         TO ASC-PO-NBR              14750000
147600     END-EVALUATE.                                                14760000
147700                                                                  14770000
147701 EJECT                                                            14770100
147702*----------------------------------------------------------------*14770200
147703* PREPARE THE LIST ENTRY WHEN COMING FROM THE TROUBLE LIST SCREEN*14770300
147704*----------------------------------------------------------------*14770400
147705 1120-PREPARE-LIST-ENTRY.                                         14770500
147706     MOVE TM002-MAX-ITEMS          TO ASC-SEL-SUB.                14770600
147707     MOVE ZERO                     TO ASC-SEL-ITEM.               14770700
147708     PERFORM 1160-GET-NEXT-RECORD.                                14770800
147709                                                                  14770900
147710*----------------------------------------------------------------*14771000
147711* GET NEXT RECORD WHEN COMING FROM THE TROUBLE LIST SCREEN.      *14771100
147712*----------------------------------------------------------------*14771200
147713 1160-GET-NEXT-RECORD.                                            14771300
147714                                                                  14771400
147715     ADD +1                        TO ASC-SEL-SUB.                14771500
147716     IF  ASC-SEL-SUB > TM002-MAX-ITEMS                            14771600
147717         ADD +1                    TO ASC-SEL-ITEM                14771700
147718         MOVE +1                   TO ASC-SEL-SUB                 14771800
147719     END-IF.                                                      14771900
147720                                                                  14772000
147730     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                14773000
147740         PERFORM 9100-READ-SEL-QUEUE                              14774000
147750         IF  TM002-ITEM (ASC-SEL-SUB) > ZERO                      14775000
147760             MOVE TM002-PO-NBR (ASC-SEL-SUB) TO                   14776000
147770                                ASC-PO-NBR                        14777000
147780             SET TM002-INQ (ASC-SEL-SUB)                          14778000
147790                                TO TRUE                           14779000
147800             PERFORM 9200-REWRITE-LIST-QUEUE                      14780000
147900         ELSE                                                     14790000
148000             SUBTRACT +1 FROM ASC-SEL-SUB                         14800000
148100*            --- BOTTOM OF LIST ---                               14810000
148200             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            14820000
148300             SET DP020-MSG-INFORMATIONAL                          14830000
148400                                   TO TRUE                        14840000
148500         END-IF                                                   14850000
148600     ELSE                                                         14860000
148700         SUBTRACT +1 FROM ASC-SEL-ITEM                            14870000
148800         MOVE TM002-MAX-ITEMS      TO ASC-SEL-SUB                 14880000
148900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            14890000
149000         SET DP020-MSG-INFORMATIONAL                              14900000
149100                                   TO TRUE                        14910000
149200     END-IF.                                                      14920000
149201/                                                                 14920100
149202*----------------------------------------------------------------*14920200
149203* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *14920300
149204* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *14920400
149205* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *14920500
149206* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *14920600
149207* FUNCTION KEYS CAN GET THIS FAR.                                *14920700
149208*----------------------------------------------------------------*14920800
149209 2000-PROCESS-PANEL.                                              14920900
149210                                                                  14921000
149211     EVALUATE TRUE                                                14921100
149212         WHEN DP020-SRC-AID = DP016-CLEAR                         14921200
149213             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 14921300
149214                                                                  14921400
149215         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    14921500
149216             PERFORM 4000-BUILD-INITIAL-PANEL                     14921600
149217                                                                  14921700
149218         WHEN OTHER                                               14921800
149219             PERFORM 2100-CHECK-FUNCTION-KEY                      14921900
149220     END-EVALUATE.                                                14922000
149221                                                                  14922100
149222 EJECT                                                            14922200
149223*----------------------------------------------------------------*14922300
149224* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*14922400
149225* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *14922500
149226* CICS ARCHITECTURE API.                                         *14922600
149227*----------------------------------------------------------------*14922700
149228 2100-CHECK-FUNCTION-KEY.                                         14922800
149229                                                                  14922900
149230     EVALUATE TRUE                                                14923000
149231         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              14923100
149232         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              14923200
149233         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              14923300
149234         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              14923400
149235         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              14923500
149236         WHEN DP020-FK-LOCAL-FUNC-06 (DP020-SRC-AID)              14923600
149237         WHEN DP020-FK-LOCAL-FUNC-07 (DP020-SRC-AID)              14923700
149238         WHEN DP020-FK-LOCAL-FUNC-08 (DP020-SRC-AID)              14923800
149239**           INITIALIZE TR105-INTER-APPL-COMMAREA                 14923900
149240             MOVE LOW-VALUES TO TR105-INTER-APPL-COMMAREA         14924000
149250             MOVE ASC-PO-NBR      TO TR105-PO-NBR                 14925000
149260                                                                  14926005
149289         WHEN DP020-SRC-AID = DP016-ENTER                         14928900
149290             CONTINUE                                             14929000
149291                                                                  14929100
149292         WHEN OTHER                                               14929200
149293             SET DP013-NO-ROLLBACK                                14929300
149294                 DP013-XCTL-DISPLAY-RESTART                       14929400
149295                 DP013-CICS-ABEND  TO TRUE                        14929500
149296             MOVE '2100-CHECK-FUNCTION-KEY'                       14929600
149297                                   TO DP013-PARAGRAPH             14929700
149298             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      14929800
149299                                   TO DP013-MESSAGE-TEXT (1)      14929900
149300             PERFORM DP013-0000-PROCESS-ABEND                     14930000
149301     END-EVALUATE.                                                14930100
149302                                                                  14930200
149303 EJECT                                                            14930300
149304*----------------------------------------------------------------*14930400
149305*     READ THE DATABASE AND DISPLAY THE PANEL TO USER            *14930500
149306*----------------------------------------------------------------*14930600
149307 4000-BUILD-INITIAL-PANEL.                                        14930700
149308                                                                  14930800
149309     PERFORM 4100-GET-PO.                                         14930900
149310     IF SQLCODE = +0                                              14931000
149311        PERFORM 4150-EDIT-PO-DETAILS                              14931100
149312        MOVE 'Y'           TO ASC-POINFO-IND                      14931200
149313     ELSE                                                         14931300
149314        MOVE 'N'           TO ASC-POINFO-IND                      14931400
149315     END-IF.                                                      14931500
149316                                                                  14931600
149317     IF  PURCHS-STATUS-CDE = SPACES                               14931700
149318         CONTINUE                                                 14931800
149319     ELSE                                                         14931900
149320         PERFORM 4155-GET-PO-STATUS-DESC                          14932000
149330     END-IF.                                                      14933000
149331                                                                  14933100
149332     PERFORM 4160-SELECT-AD-DTE                                   14933200
149333     PERFORM 4170-OPEN-OUTR-PCK-CSR                               14933300
149334     PERFORM 4180-FETCH-OUTR-PCK                                  14933400
149335     PERFORM 4190-CLOSE-OUTR-PCK-CSR                              14933500
149336     MOVE PV-PO-CART-CNT   TO ASC-EXP-CTNS                        14933600
149337     PERFORM 4210-CHECK-PO-BOOKING.                               14933700
149338     PERFORM 4220-CHECK-PO-RECEIVING.                             14933800
149339     PERFORM 4230-CHECK-PO-SAIL-CONTNR.                           14933900
149340*    PERFORM 4240-CHECK-PO-TRAILER.                               14934000
149341*    PERFORM 4250-CHECK-RECEIPTS.                                 14934100
149342     PERFORM 4250-CHECK-DECONSOL-LH.                              14934200
149343     PERFORM 4260-CHECK-BUYER-DECON.                              14934300
149344     PERFORM 4270-CHECK-TRAILER.                                  14934400
149345     PERFORM 4280-CHECK-CUSTOMS.                                  14934500
149346                                                                  14934604
149350                                                                  14935004
149351*    MOVE 'N'              TO ASC-TRAILER-IND.                    14935100
149352*    MOVE 'N'              TO ASC-RECEIPTS-IND.                   14935200
149353     IF (ASC-AD-DTE              =  SPACES AND                    14935300
149354         ASC-EXP-CTNS            =  ZEROS AND                     14935400
149355         ASC-BOOKING-IND         = 'N' AND                        14935500
149356         ASC-RECEIVING-IND       = 'N' AND                        14935600
149357         ASC-SAILING-IND         = 'N' AND                        14935700
149358         ASC-CONTAINER-IND       = 'N' AND                        14935800
149359         ASC-DECONSOL-LH-IND     = 'N' AND                        14935900
149360         ASC-TRAILER-IND         = 'N' AND                        14936000
149361         ASC-CUSTOMS-IND         = 'N' AND                        14936100
149362         ASC-BUYER-DECON-IND     = 'N')                           14936207
149367         SET DP020-MSG-FATAL   TO  TRUE                           14936700
149368*------- PURCHASE ORDER DOES NOT EXIST                            14936800
149369         MOVE PC-TSYMSG-00083  TO  DP020-MSG-NUMBER               14936900
149370     END-IF.                                                      14937000
149371     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14937100
149372                                                                  14937200
149373 EJECT                                                            14937300
149374*----------------------------------------------------------------*14937400
149375*     GET IMPORT SCREEN FIELDS                                   *14937500
149376*----------------------------------------------------------------*14937600
149377 4100-GET-PO.                                                     14937700
149378                                                                  14937800
149379     PERFORM                                                      14937900
149380         WITH TEST AFTER                                          14938000
149381         VARYING PV-RETRY-COUNTER                                 14938100
149382         FROM 1 BY 1                                              14938200
149383         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14938300
149384            OR  (SQLCODE = ZERO)                                  14938400
149385            OR  (SQLCODE = +100))                                 14938500
149386                                                                  14938600
149387         EXEC SQL                                                 14938700
149388              SELECT A.DEPT_NBR,                                  14938800
149389                     A.OTB_PER_NBR,                               14938900
149390                     A.TOT_UNT_QTY,                               14939000
149391                     A.PO_TYP_CDE,                                14939100
149392                     A.PROD_CNTRY_CDE,                            14939200
149393                     A.STATUS_CDE,                                14939300
149394                     B.ENT_NAME_DESC,                             14939400
149395                     C.CAN_IFNOT_SHIP_DTE,                        14939500
149396                     C.EXT_CAN_DTE,                               14939600
149397                     C.STRT_FCTRY_DTE,                            14939700
149398                     C.LAST_FCTRY_DTE,                            14939800
149399                     C.DONT_SHIP_BEF_DTE,                         14939900
149400                     C.FOB_CDE,                                   14940000
149401                     C.POE_CDE                                    14940100
149402              INTO  :PURCHS-DEPT-NBR,                             14940200
149403                    :PURCHS-OTB-PER-NBR,                          14940300
149404                    :PURCHS-TOT-UNT-QTY,                          14940400
149405                    :PURCHS-PO-TYP-CDE,                           14940500
149406                    :PURCHS-PROD-CNTRY-CDE,                       14940600
149407                    :PURCHS-STATUS-CDE,                           14940700
149408                    :ENTNME-ENT-NAME-DESC,                        14940800
149409                    :PLNSHP-CAN-IFNOT-SHIP-DTE,                   14940900
149410                    :PLNSHP-EXT-CAN-DTE,                          14941000
149411                    :PLNSHP-STRT-FCTRY-DTE,                       14941100
149412                    :PLNSHP-LAST-FCTRY-DTE,                       14941200
149413                    :PLNSHP-DONT-SHIP-BEF-DTE,                    14941300
149414                    :PLNSHP-FOB-CDE,                              14941400
149415                    :PLNSHP-POE-CDE                               14941500
149416               FROM  TPURCHS A,                                   14941600
149417                     TENTNME B,                                   14941700
149418                     TPLNSHP C                                    14941800
149419               WHERE A.PO_NBR         = :ASC-PO-NBR               14941900
149420                 AND A.VER_STATUS_CDE = 'A'                       14942000
149421                 AND B.ENT_ID         =  A.ENT_ID                 14942100
149422                 AND B.TYPE_CDE       = '01'                      14942200
149423                 AND C.PO_NBR         =  A.PO_NBR                 14942300
149424                 AND C.VER_STATUS_CDE = 'A'                       14942400
149425         END-EXEC                                                 14942500
149426*                                                                 14942600
149427         EVALUATE TRUE                                            14942700
149428             WHEN SQLCODE = ZERO                                  14942800
149429             WHEN SQLCODE = +100                                  14942900
149430             WHEN SQLCODE = -904                                  14943000
149431             WHEN SQLCODE = -913                                  14943100
149432                 CONTINUE                                         14943200
149433             WHEN SQLWARN0 NOT = SPACES                           14943300
149434             WHEN SQLCODE < ZERO                                  14943400
149435             WHEN SQLCODE > ZERO                                  14943500
149436                 MOVE '4100-GET-PO'                               14943600
149437                                   TO DP013-PARAGRAPH             14943700
149438                 MOVE 'SQL ERROR SELECTING PO'                    14943800
149439                                   TO DP013-MESSAGE-TEXT (1)      14943900
149440                 MOVE SQLCA        TO DP013-SQLCA                 14944000
149441                 MOVE 'TPURCHS '   TO DP013-DB2-TABLE-NAME (1)    14944100
149442                 SET DP013-DB2-ABEND                              14944200
149443                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14944300
149444                 PERFORM DP013-0000-PROCESS-ABEND                 14944400
149445         END-EVALUATE                                             14944500
149446     END-PERFORM.                                                 14944600
149447*                                                                 14944700
149448     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        14944800
149449         MOVE '4100-GET-PO'        TO DP013-PARAGRAPH             14944900
149450         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  14945000
149451                                   TO DP013-MESSAGE-TEXT (1)      14945100
149452         MOVE SQLCA                TO DP013-SQLCA                 14945200
149453         MOVE 'TPURCHS '           TO DP013-DB2-TABLE-NAME (1)    14945300
149454         SET DP013-DB2-ABEND                                      14945400
149455             DP013-XCTL-DISPLAY-RESTART                           14945500
149456                                   TO TRUE                        14945600
149457         PERFORM DP013-0000-PROCESS-ABEND                         14945700
149458     END-IF.                                                      14945800
149459                                                                  14945900
149460 EJECT                                                            14946000
149470*----------------------------------------------------------------*14947000
149480*    GET THE PURCHASE ORDER STATUS DESCRIPTION                   *14948000
149490*----------------------------------------------------------------*14949000
149500 4155-GET-PO-STATUS-DESC.                                         14950000
149600                                                                  14960000
149700     PERFORM                                                      14970000
149800         WITH TEST AFTER                                          14980000
149900         VARYING PV-RETRY-COUNTER                                 14990000
150000         FROM 1 BY 1                                              15000000
150100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15010000
150200             OR (SQLCODE = +0)                                    15020000
150300             OR (SQLCODE = +100))                                 15030000
150400                                                                  15040000
150500         EXEC SQL                                                 15050000
150600              SELECT STATUS_DESC                                  15060000
150700                INTO :STATCD-STATUS-DESC                          15070000
150800                FROM TSTATCD                                      15080000
150900               WHERE STATUS_TYP_CDE = 'P'                         15090000
151000                 AND STATUS_CDE     = :PURCHS-STATUS-CDE          15100000
151100         END-EXEC                                                 15110000
151200                                                                  15120000
151300         EVALUATE TRUE                                            15130000
151400             WHEN SQLCODE = +0                                    15140000
151500                  MOVE STATCD-STATUS-DESC                         15150000
151600                                  TO ASC-PO-STATUS                15160000
151700                                                                  15170000
151800             WHEN SQLCODE = +100                                  15180000
151900                  MOVE SPACES     TO ASC-PO-STATUS                15190000
152000             WHEN SQLCODE = -904                                  15200000
152100             WHEN SQLCODE = -913                                  15210000
152200                  CONTINUE                                        15220000
152300                                                                  15230000
152400             WHEN SQLWARN0 NOT = SPACES                           15240000
152500             WHEN SQLCODE < +0                                    15250000
152600             WHEN SQLCODE > +0                                    15260000
152700                  MOVE '4155-GET-PO-STATUS-DESC'                  15270000
152800                                  TO DP013-PARAGRAPH              15280000
152900                  MOVE 'UNSUCCESSFUL SELECT PO STATUS DESC'       15290000
153000                                  TO DP013-MESSAGE-TEXT (1)       15300000
153100                  MOVE SQLCA      TO DP013-SQLCA                  15310000
153200                  MOVE 'TSTATCD ' TO DP013-DB2-TABLE-NAME (1)     15320000
153300                  SET DP013-DB2-ABEND                             15330000
153400                      DP013-XCTL-DISPLAY-RESTART                  15340000
153500                                  TO TRUE                         15350000
153600                  PERFORM DP013-0000-PROCESS-ABEND                15360000
153700         END-EVALUATE                                             15370000
153800     END-PERFORM.                                                 15380000
153900                                                                  15390000
154000     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15400000
154100         MOVE '4155-GET-PO-STATUS-DESC'                           15410000
154200                                  TO DP013-PARAGRAPH              15420000
154300         MOVE 'MAX RETRIES EXCEEDED ON SELECT PO STATUS DESC'     15430000
154400                                  TO DP013-MESSAGE-TEXT (1)       15440000
154500         MOVE SQLCA               TO DP013-SQLCA                  15450000
154600         MOVE 'TSTATCD '          TO DP013-DB2-TABLE-NAME (1)     15460000
154700         SET DP013-DB2-ABEND                                      15470000
154800             DP013-XCTL-DISPLAY-RESTART                           15480000
154900                                  TO TRUE                         15490000
155000         PERFORM DP013-0000-PROCESS-ABEND                         15500000
155100     END-IF.                                                      15510000
155200                                                                  15520000
155201/                                                                 15520100
155202*----------------------------------------------------------------*15520200
155203*  EDIT PO DETAILS FROM TPURCHS AND TPLNSHP AND MOVE TO COMMAREA *15520300
155204*----------------------------------------------------------------*15520400
155205 4150-EDIT-PO-DETAILS.                                            15520500
155206     MOVE PURCHS-DEPT-NBR          TO PV-DEPT-NBR-N.              15520600
155207     MOVE PV-DEPT-NBR-N            TO ASC-DEPT-NBR.               15520700
155208     MOVE PURCHS-OTB-PER-NBR       TO ASC-OTB-MTH.                15520800
155209     MOVE PURCHS-TOT-UNT-QTY       TO ASC-ORD-UNTS.               15520900
155210     MOVE PURCHS-PROD-CNTRY-CDE    TO ASC-CNTRY-CDE.              15521000
155211     MOVE ENTNME-ENT-NAME-DESC     TO ASC-VND-NME.                15521100
155212     MOVE PLNSHP-FOB-CDE           TO ASC-FOB-CDE.                15521200
155213     MOVE PLNSHP-POE-CDE           TO ASC-POE-CDE.                15521300
155214     MOVE PURCHS-PO-TYP-CDE        TO ASC-PO-TYPE.                15521400
155215*                                                                 15521500
155216     IF PLNSHP-CAN-IFNOT-SHIP-DTE  = PC-INIT-DATE                 15521600
155217        MOVE SPACES                TO ASC-CAN-DTE                 15521700
155218     ELSE                                                         15521800
155219        MOVE PLNSHP-CAN-IFNOT-SHIP-DTE                            15521900
155220                                   TO PV-DATE-BREAK               15522000
155221        PERFORM 4310-PROCESS-DATE                                 15522100
155222        MOVE PV-DATE-DISPLAY       TO ASC-CAN-DTE                 15522200
155223     END-IF.                                                      15522300
155224*                                                                 15522400
155225     IF PLNSHP-EXT-CAN-DTE         =  PC-INIT-DATE                15522500
155226        MOVE SPACES                TO ASC-EXT-CAN-DTE             15522600
155227     ELSE                                                         15522700
155228        MOVE PLNSHP-EXT-CAN-DTE    TO PV-DATE-BREAK               15522800
155229        PERFORM 4310-PROCESS-DATE                                 15522900
155230        MOVE PV-DATE-DISPLAY       TO ASC-EXT-CAN-DTE             15523000
155231     END-IF.                                                      15523100
155232*                                                                 15523200
155233     IF PLNSHP-STRT-FCTRY-DTE      =  PC-INIT-DATE                15523300
155234        MOVE SPACES                TO ASC-STRT-X-FACT-DTE         15523400
155235     ELSE                                                         15523500
155236        MOVE PLNSHP-STRT-FCTRY-DTE                                15523600
155237                                   TO PV-DATE-BREAK               15523700
155238        PERFORM 4310-PROCESS-DATE                                 15523800
155239        MOVE PV-DATE-DISPLAY       TO ASC-STRT-X-FACT-DTE         15523900
155240     END-IF.                                                      15524000
155241*                                                                 15524100
155242     IF PLNSHP-LAST-FCTRY-DTE      =  PC-INIT-DATE                15524200
155243        MOVE SPACES                TO ASC-LAST-X-FACT-DTE         15524300
155244     ELSE                                                         15524400
155245        MOVE PLNSHP-LAST-FCTRY-DTE                                15524500
155246                                   TO PV-DATE-BREAK               15524600
155247        PERFORM 4310-PROCESS-DATE                                 15524700
155248        MOVE PV-DATE-DISPLAY       TO ASC-LAST-X-FACT-DTE         15524800
155249     END-IF.                                                      15524900
155250*                                                                 15525000
155251     IF PLNSHP-DONT-SHIP-BEF-DTE   =  PC-INIT-DATE                15525100
155252        MOVE SPACES                TO ASC-DONT-SHP-BEF-DTE        15525200
155253     ELSE                                                         15525300
155254        MOVE PLNSHP-DONT-SHIP-BEF-DTE                             15525400
155255                                   TO PV-DATE-BREAK               15525500
155256        PERFORM 4310-PROCESS-DATE                                 15525600
155257        MOVE PV-DATE-DISPLAY       TO ASC-DONT-SHP-BEF-DTE        15525700
155258     END-IF.                                                      15525800
155259                                                                  15525900
155260 EJECT                                                            15526000
155261*----------------------------------------------------------------*15526100
155262*     SELECT AD-DATE FOR THE PO FROM TPURITM                     *15526200
155263*----------------------------------------------------------------*15526300
155264 4160-SELECT-AD-DTE.                                              15526400
155265                                                                  15526500
155266     PERFORM                                                      15526600
155267         WITH TEST AFTER                                          15526700
155268         VARYING PV-RETRY-COUNTER                                 15526800
155269         FROM 1 BY 1                                              15526900
155270         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15527000
155271            OR  (SQLCODE = ZERO)                                  15527100
155272            OR  (SQLCODE = +100))                                 15527200
155273                                                                  15527300
155274         EXEC SQL                                                 15527400
155275              SELECT                                              15527500
155276                     MIN(AD_EVNT_DTE)                             15527600
155277              INTO  :PURITM-AD-EVNT-DTE :PV-AD-DTE-IND            15527700
155278              FROM   TPURITM                                      15527800
155279              WHERE  PO_NBR         = :ASC-PO-NBR                 15527900
155280              AND    VER_STATUS_CDE = 'A'                         15528000
155281              AND    AD_EVNT_DTE   ^= '0001-01-01'                15528100
155282         END-EXEC                                                 15528200
155283*                                                                 15528300
155284         EVALUATE TRUE                                            15528400
155285             WHEN SQLCODE = ZERO                                  15528500
155286             WHEN SQLCODE = +100                                  15528600
155287             WHEN SQLCODE = -904                                  15528700
155288             WHEN SQLCODE = -913                                  15528800
155289                 CONTINUE                                         15528900
155290             WHEN SQLWARN0 NOT = SPACES                           15529000
155291             WHEN SQLCODE < ZERO                                  15529100
155292             WHEN SQLCODE > ZERO                                  15529200
155293                 MOVE '4160-SELECT-AD-DTE'                        15529300
155294                                   TO DP013-PARAGRAPH             15529400
155295                 MOVE 'SQL ERROR SELECTING AD-DATE'               15529500
155296                                   TO DP013-MESSAGE-TEXT (1)      15529600
155297                 MOVE SQLCA        TO DP013-SQLCA                 15529700
155298                 MOVE 'TPURITM '   TO DP013-DB2-TABLE-NAME (1)    15529800
155299                 SET DP013-DB2-ABEND                              15529900
155300                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15530000
155301                 PERFORM DP013-0000-PROCESS-ABEND                 15530100
155302         END-EVALUATE                                             15530200
155303     END-PERFORM.                                                 15530300
155304*                                                                 15530400
155305     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15530500
155306         MOVE '4160-SELECT-AD-DTE' TO DP013-PARAGRAPH             15530600
155307         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT AD-DA15530700
155308-             'TE'                 TO DP013-MESSAGE-TEXT (1)      15530800
155309         MOVE SQLCA                TO DP013-SQLCA                 15530900
155310         MOVE 'TPURITM '           TO DP013-DB2-TABLE-NAME (1)    15531000
155311         SET DP013-DB2-ABEND                                      15531100
155312             DP013-XCTL-DISPLAY-RESTART                           15531200
155313                                   TO TRUE                        15531300
155314         PERFORM DP013-0000-PROCESS-ABEND                         15531400
155315     END-IF.                                                      15531500
155316*                                                                 15531600
155317     IF (SQLCODE EQUAL + 0  AND  PV-AD-DTE-IND = 0)               15531700
155318         MOVE PURITM-AD-EVNT-DTE   TO PV-DATE-BREAK               15531800
155319         PERFORM 4310-PROCESS-DATE                                15531900
155320         MOVE PV-DATE-DISPLAY      TO ASC-AD-DTE                  15532000
155321      ELSE                                                        15532100
155322         MOVE SPACES               TO ASC-AD-DTE                  15532200
155323     END-IF.                                                      15532300
155324                                                                  15532400
155325 EJECT                                                            15532500
155326*----------------------------------------------------------------*15532600
155327*     OPEN THE OUTER PACK CURSOR                                 *15532700
155328*----------------------------------------------------------------*15532800
155329 4170-OPEN-OUTR-PCK-CSR.                                          15532900
155330                                                                  15533000
155331     PERFORM                                                      15533100
155332         WITH TEST AFTER                                          15533200
155333         VARYING PV-RETRY-COUNTER                                 15533300
155334         FROM 1 BY 1                                              15533400
155335         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15533500
155336            OR  (SQLCODE = ZERO))                                 15533600
155337                                                                  15533700
155338         MOVE 'CURSOR:  OUTR-PCK-CSR' TO DP013-MESSAGE-TEXT (2)   15533800
155339                                                                  15533900
155340         EXEC SQL                                                 15534000
155341              OPEN OUTR-PCK-CSR                                   15534100
155342         END-EXEC                                                 15534200
155343*                                                                 15534300
155344         EVALUATE TRUE                                            15534400
155345             WHEN SQLCODE = ZERO                                  15534500
155346             WHEN SQLCODE = -904                                  15534600
155347             WHEN SQLCODE = -913                                  15534700
155348                 CONTINUE                                         15534800
155349             WHEN SQLWARN0 NOT = SPACES                           15534900
155350             WHEN SQLCODE < ZERO                                  15535000
155351             WHEN SQLCODE > ZERO                                  15535100
155352                 MOVE '4170-OPEN-OUTR-PCK-CSR'                    15535200
155353                                   TO DP013-PARAGRAPH             15535300
155354                 MOVE 'OPEN OUTER-PACK CURSOR - '                 15535400
155355                                   TO DP013-MESSAGE-TEXT (1)      15535500
155356                 MOVE SQLCA        TO DP013-SQLCA                 15535600
155357                 MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)    15535700
155358                 SET DP013-DB2-ABEND                              15535800
155359                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15535900
155360                 PERFORM DP013-0000-PROCESS-ABEND                 15536000
155361         END-EVALUATE                                             15536100
155362     END-PERFORM.                                                 15536200
155363*                                                                 15536300
155364     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15536400
155365         MOVE '4170-OPEN-OUTR-PCK-CSR'   TO DP013-PARAGRAPH       15536500
155366         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   15536600
155367                                   TO DP013-MESSAGE-TEXT (1)      15536700
155368         MOVE SQLCA                TO DP013-SQLCA                 15536800
155369         MOVE 'TUPC    '           TO DP013-DB2-TABLE-NAME (1)    15536900
155370         SET DP013-DB2-ABEND                                      15537000
155371             DP013-XCTL-DISPLAY-RESTART                           15537100
155372                                   TO TRUE                        15537200
155373         PERFORM DP013-0000-PROCESS-ABEND                         15537300
155374     END-IF.                                                      15537400
155375                                                                  15537500
155376 EJECT                                                            15537600
155377*----------------------------------------------------------------*15537700
155378*     FETCH THE OUTER PACK QUANTITY                              *15537800
155379*----------------------------------------------------------------*15537900
155380 4180-FETCH-OUTR-PCK.                                             15538000
155381                                                                  15538100
155382     PERFORM                                                      15538200
155383         WITH TEST AFTER                                          15538300
155384         VARYING PV-RETRY-COUNTER                                 15538400
155385         FROM 1 BY 1                                              15538500
155386         UNTIL (SQLCODE = +100)                                   15538600
155387                                                                  15538700
155388         EXEC SQL                                                 15538800
155389              FETCH OUTR-PCK-CSR                                  15538900
155390              INTO  :PURITM-UNT-QTY                               15539000
155391                 ,  :PURITM-OUTR-PK-QTY                           15539102
155393         END-EXEC                                                 15539302
155394*                                                                 15539402
155395         EVALUATE TRUE                                            15539502
155396             WHEN SQLCODE = ZERO                                  15539602
155397             WHEN SQLCODE = +100                                  15539702
155398                  CONTINUE                                        15539802
155399             WHEN SQLWARN0 NOT = SPACE                            15539902
155400             WHEN SQLCODE NOT = ZERO                              15540002
155401                  MOVE '4180-FETCH-OUTR-PCK'                      15540102
155402                                   TO DP013-PARAGRAPH             15540202
155403                  MOVE 'FETCH OUTER-PACK CURSOR'                  15540302
155404                                   TO DP013-MESSAGE-TEXT (1)      15540402
155405                  MOVE SQLCA       TO DP013-SQLCA                 15540502
155406                  SET DP013-DB2-ABEND                             15540602
155407                                   TO TRUE                        15540702
155408                  PERFORM DP013-0000-PROCESS-ABEND                15540802
155409         END-EVALUATE                                             15540902
155410*                                                                 15541002
155411         IF  SQLCODE EQUAL +0                                     15541102
155412             IF PURITM-OUTR-PK-QTY = 0                            15541202
155413                DIVIDE 1 INTO PURITM-UNT-QTY                      15541302
155414                GIVING PV-ITEM-CART-CNT ROUNDED                   15541402
155415             ELSE                                                 15541502
155416                DIVIDE PURITM-OUTR-PK-QTY INTO PURITM-UNT-QTY     15541602
155417                GIVING PV-ITEM-CART-CNT ROUNDED                   15541702
155418             END-IF                                               15541802
155419             ADD PV-ITEM-CART-CNT TO PV-PO-CART-CNT               15541902
155420         END-IF                                                   15542002
155421     END-PERFORM.                                                 15542102
155422                                                                  15542202
155423 EJECT                                                            15542302
155424*----------------------------------------------------------------*15542402
155425*     CLOSE THE OUTER PACK QUANTITY CURSOR                       *15542502
155426*----------------------------------------------------------------*15542602
155427 4190-CLOSE-OUTR-PCK-CSR.                                         15542702
155428                                                                  15542802
155429     EXEC SQL                                                     15542902
155430          CLOSE OUTR-PCK-CSR                                      15543002
155431     END-EXEC.                                                    15543102
155432*                                                                 15543202
155433     EVALUATE TRUE                                                15543302
155434         WHEN SQLCODE = ZERO                                      15543402
155435             CONTINUE                                             15543502
155436         WHEN SQLWARN0 NOT = SPACES                               15543602
155437         WHEN SQLCODE < ZERO                                      15543702
155438         WHEN SQLCODE > ZERO                                      15543802
155439             MOVE '4190-CLOSE-OUTR-PCK-CSR'                       15543902
155440                               TO DP013-PARAGRAPH                 15544002
155441             MOVE 'CLOSE OUTER-PACK CURSOR '                      15544102
155442                               TO DP013-MESSAGE-TEXT (1)          15544202
155443             MOVE SQLCA        TO DP013-SQLCA                     15544302
155444             MOVE 'TUPC    '   TO DP013-DB2-TABLE-NAME (1)        15544402
155445             SET DP013-DB2-ABEND                                  15544502
155446                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15544602
155447             PERFORM DP013-0000-PROCESS-ABEND                     15544702
155448     END-EVALUATE.                                                15544802
155449                                                                  15544902
155450 EJECT                                                            15545002
155451*----------------------------------------------------------------*15545102
155452*     CHECK WHETHER BOOKING INFORMATION IS AVAILABLE FOR THE PO  *15545202
155453*----------------------------------------------------------------*15545302
155454 4210-CHECK-PO-BOOKING.                                           15545402
155455                                                                  15545502
155456     PERFORM                                                      15545602
155457         WITH TEST AFTER                                          15545702
155458         VARYING PV-RETRY-COUNTER                                 15545802
155459         FROM 1 BY 1                                              15545902
155460         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15546002
155461            OR  (SQLCODE = ZERO)                                  15546102
155462            OR  (SQLCODE = +100))                                 15546202
155463                                                                  15546302
155464         EXEC SQL                                                 15546402
155465              SELECT DISTINCT                                     15546502
155466                     A.PO_NBR                                     15546602
155467              INTO  :IMBKPO-PO-NBR                                15546702
155468              FROM   TIMBKPO A                                    15546802
155469              WHERE  A.PO_NBR = :ASC-PO-NBR                       15546902
155470         END-EXEC                                                 15547002
155471*                                                                 15547102
155472         EVALUATE TRUE                                            15547202
155473             WHEN SQLCODE = -904                                  15547302
155474             WHEN SQLCODE = -913                                  15547402
155475                 CONTINUE                                         15547502
155476             WHEN SQLCODE = ZERO                                  15547602
155477             WHEN SQLCODE = -811                                  15547702
155478                  MOVE 'Y'         TO ASC-BOOKING-IND             15547802
155479             WHEN SQLCODE = +100                                  15547902
155480                  MOVE 'N'         TO ASC-BOOKING-IND             15548002
155481             WHEN SQLWARN0 NOT = SPACES                           15548102
155482             WHEN SQLCODE < ZERO                                  15548202
155483             WHEN SQLCODE > ZERO                                  15548302
155484                 MOVE '4210-CHECK-PO-BOOKING'                     15548402
155485                                   TO DP013-PARAGRAPH             15548502
155486                 MOVE 'SQL ERROR SELECTING PO'                    15548602
155487                                   TO DP013-MESSAGE-TEXT (1)      15548702
155488                 MOVE SQLCA        TO DP013-SQLCA                 15548802
155489                 MOVE 'TIMBKPO '   TO DP013-DB2-TABLE-NAME (1)    15548902
155490                 SET DP013-DB2-ABEND                              15549002
155491                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15549102
155492                 PERFORM DP013-0000-PROCESS-ABEND                 15549202
155493         END-EVALUATE                                             15549302
155494     END-PERFORM.                                                 15549402
155495*                                                                 15549502
155496     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15549602
155497         MOVE '4210-CHECK-PO-BOOKING'    TO DP013-PARAGRAPH       15549702
155498         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15549802
155499                                   TO DP013-MESSAGE-TEXT (1)      15549902
155500         MOVE SQLCA                TO DP013-SQLCA                 15550002
155501         MOVE 'TIMBKPO '           TO DP013-DB2-TABLE-NAME (1)    15550102
155502         SET DP013-DB2-ABEND                                      15550202
155503             DP013-XCTL-DISPLAY-RESTART                           15550302
155504                                   TO TRUE                        15550402
155505         PERFORM DP013-0000-PROCESS-ABEND                         15550502
155506     END-IF.                                                      15550602
155507                                                                  15550702
155508 EJECT                                                            15550802
155509*----------------------------------------------------------------*15550902
155510*    CHECK WHETHER RECEIVING INFORMATION IS AVAILABLE FOR THE PO *15551002
155511*----------------------------------------------------------------*15551102
155512 4220-CHECK-PO-RECEIVING.                                         15551202
155513                                                                  15551302
155514     PERFORM                                                      15551402
155515         WITH TEST AFTER                                          15551502
155516         VARYING PV-RETRY-COUNTER                                 15551602
155517         FROM 1 BY 1                                              15551702
155518         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15551802
155519            OR  (SQLCODE = ZERO)                                  15551902
155520            OR  (SQLCODE = +100))                                 15552002
155521                                                                  15552102
155522         EXEC SQL                                                 15552202
155523              SELECT DISTINCT                                     15552302
155524                     A.PO_NBR                                     15552402
155525              INTO  :IMRCPO-PO-NBR                                15552502
155526              FROM   TIMRCPO A                                    15552602
155527              WHERE  A.PO_NBR = :ASC-PO-NBR                       15552702
155528         END-EXEC                                                 15552802
155529*                                                                 15552902
155530         EVALUATE TRUE                                            15553002
155531             WHEN SQLCODE = -904                                  15553102
155532             WHEN SQLCODE = -913                                  15553202
155533                 CONTINUE                                         15553302
155534             WHEN SQLCODE = ZERO                                  15553402
155535             WHEN SQLCODE = -811                                  15553502
155536                  MOVE 'Y'         TO ASC-RECEIVING-IND           15553602
155537             WHEN SQLCODE = +100                                  15553702
155538                  MOVE 'N'         TO ASC-RECEIVING-IND           15553802
155539             WHEN SQLWARN0 NOT = SPACES                           15553902
155540             WHEN SQLCODE < ZERO                                  15554002
155541             WHEN SQLCODE > ZERO                                  15554102
155542                 MOVE '4210-CHECK-PO-RECEIVING'                   15554202
155543                                   TO DP013-PARAGRAPH             15554302
155544                 MOVE 'SQL ERROR SELECTING PO'                    15554402
155545                                   TO DP013-MESSAGE-TEXT (1)      15554502
155546                 MOVE SQLCA        TO DP013-SQLCA                 15554602
155547                 MOVE 'TIMRCPO '   TO DP013-DB2-TABLE-NAME (1)    15554702
155548                 SET DP013-DB2-ABEND                              15554802
155549                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15554902
155550                 PERFORM DP013-0000-PROCESS-ABEND                 15555002
155551         END-EVALUATE                                             15555102
155552     END-PERFORM.                                                 15555202
155553*                                                                 15555302
155554     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15555402
155555         MOVE '4220-CHECK-PO-RECEIVING'    TO DP013-PARAGRAPH     15555502
155556         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15555602
155557                                   TO DP013-MESSAGE-TEXT (1)      15555702
155558         MOVE SQLCA                TO DP013-SQLCA                 15555802
155559         MOVE 'TIMRCPO '           TO DP013-DB2-TABLE-NAME (1)    15555902
155560         SET DP013-DB2-ABEND                                      15556002
155561             DP013-XCTL-DISPLAY-RESTART                           15556102
155562                                   TO TRUE                        15556202
155563         PERFORM DP013-0000-PROCESS-ABEND                         15556302
155564     END-IF.                                                      15556402
155565                                                                  15556502
155566 EJECT                                                            15556602
155567*----------------------------------------------------------------*15556702
155568*     CHECK FOR SAILING AND CONTAINER INFORMATION                *15556802
155569*----------------------------------------------------------------*15556902
155570 4230-CHECK-PO-SAIL-CONTNR.                                       15557002
155571                                                                  15557102
155572     PERFORM                                                      15557202
155573         WITH TEST AFTER                                          15557302
155574         VARYING PV-RETRY-COUNTER                                 15557402
155575         FROM 1 BY 1                                              15557502
155576         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15557602
155577            OR  (SQLCODE = ZERO)                                  15557702
155578            OR  (SQLCODE = +100)                                  15557802
155579            OR  (SQLCODE = -811))                                 15557902
155580                                                                  15558002
155581         EXEC SQL                                                 15558102
155582            SELECT DISTINCT                                       15558202
155583                   A.PO_NBR                                       15558302
155584            INTO  :IMCNPO-PO-NBR                                  15558402
155585            FROM   TIMCNPO A                                      15558502
155586            WHERE  A.PO_NBR         = :ASC-PO-NBR                 15558602
155587         END-EXEC                                                 15558702
155588*                                                                 15558802
155589         EVALUATE TRUE                                            15558902
155590             WHEN SQLCODE = -904                                  15559002
155591             WHEN SQLCODE = -913                                  15559102
155592                 CONTINUE                                         15559202
155593             WHEN SQLCODE = ZERO                                  15559302
155594             WHEN SQLCODE = -811                                  15559402
155595                  MOVE 'Y'         TO ASC-SAILING-IND             15559502
155596                                      ASC-CONTAINER-IND           15559602
155597             WHEN SQLCODE = +100                                  15559702
155598                  MOVE 'N'         TO ASC-SAILING-IND             15559802
155599                                      ASC-CONTAINER-IND           15559902
155600             WHEN SQLWARN0 NOT = SPACES                           15560002
155601             WHEN SQLCODE < ZERO                                  15560102
155602             WHEN SQLCODE > ZERO                                  15560202
155603                 MOVE '4230-CHECK-PO-SAIL-CONTNR'                 15560302
155604                                   TO DP013-PARAGRAPH             15560402
155605                 MOVE 'SQL ERROR SELECTING PO'                    15560502
155606                                   TO DP013-MESSAGE-TEXT (1)      15560602
155607                 MOVE SQLCA        TO DP013-SQLCA                 15560702
155608                 MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)    15560802
155609                 SET DP013-DB2-ABEND                              15560902
155610                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15561002
155611                 PERFORM DP013-0000-PROCESS-ABEND                 15561102
155612         END-EVALUATE                                             15561202
155613     END-PERFORM.                                                 15561302
155614*                                                                 15561402
155615     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15561502
155616         MOVE '4230-CHECK-PO-SAIL-CONTNR' TO DP013-PARAGRAPH      15561602
155617         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15561702
155618                                   TO DP013-MESSAGE-TEXT (1)      15561802
155619         MOVE SQLCA                TO DP013-SQLCA                 15561902
155620         MOVE 'TIMCNPO '           TO DP013-DB2-TABLE-NAME (1)    15562002
155621         SET DP013-DB2-ABEND                                      15562102
155622             DP013-XCTL-DISPLAY-RESTART                           15562202
155623                                   TO TRUE                        15562302
155624         PERFORM DP013-0000-PROCESS-ABEND                         15562402
155625     END-IF.                                                      15562502
155626                                                                  15562602
155627 EJECT                                                            15562702
155628*----------------------------------------------------------------*15562802
155629*     CHECK WHETHER TRAILER INFORMATION IS AVAILABLE FOR THE PO  *15562902
155630*----------------------------------------------------------------*15563002
155631*4240-CHECK-PO-TRAILER.                                           15563102
155632                                                                  15563202
155633*    PERFORM                                                      15563302
155634*        WITH TEST AFTER                                          15563402
155635*        VARYING PV-RETRY-COUNTER                                 15563502
155636*        FROM 1 BY 1                                              15563602
155637*        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15563702
155638*           OR  (SQLCODE = ZERO)                                  15563802
155639*           OR  (SQLCODE = +100))                                 15563902
155640                                                                  15564002
155641*        EXEC SQL                                                 15564102
155642*             SELECT DISTINCT                                     15564202
155643*                    B.PO_NBR                                     15564302
155644*             INTO  :SHPTPO-PO-NBR                                15564402
155645*             FROM   TVHTRIP  A                                   15564502
155646*                  , TSHPTPO  B                                   15564602
155647*                  , TSHIPMT  C                                   15564702
155648*             WHERE  B.PO_NBR         = :ASC-PO-NBR               15564802
155649*             AND    B.SHIPT_ID       =  C.SHIPT_ID               15564902
155650*             AND    C.TRIP_ID        =  A.TRIP_ID                15565002
155651*        END-EXEC                                                 15565102
155652*                                                                 15565202
155653*        EVALUATE TRUE                                            15565302
155654*            WHEN SQLCODE = -904                                  15565402
155655*            WHEN SQLCODE = -913                                  15565502
155656*                CONTINUE                                         15565602
155657*            WHEN SQLCODE = ZERO                                  15565702
155658*            WHEN SQLCODE = -811                                  15565802
155659*                MOVE 'Y'          TO ASC-TRAILER-IND             15565902
155660*            WHEN SQLCODE = +100                                  15566002
155661*                MOVE 'N'          TO ASC-TRAILER-IND             15566102
155662*            WHEN SQLWARN0 NOT = SPACES                           15566202
155663*            WHEN SQLCODE < ZERO                                  15566302
155664*            WHEN SQLCODE > ZERO                                  15566402
155665*                MOVE '4240-CHECK-PO-TRAILER'                     15566502
155666*                                  TO DP013-PARAGRAPH             15566602
155667*                MOVE 'SQL ERROR SELECTING PO'                    15566702
155668*                                  TO DP013-MESSAGE-TEXT (1)      15566802
155669*                MOVE SQLCA        TO DP013-SQLCA                 15566902
155670*                MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)    15567002
155671*                SET DP013-DB2-ABEND                              15567102
155672*                    DP013-XCTL-DISPLAY-RESTART TO TRUE           15567202
155673*                PERFORM DP013-0000-PROCESS-ABEND                 15567302
155674*        END-EVALUATE                                             15567402
155675*    END-PERFORM.                                                 15567502
155676*                                                                 15567602
155677*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15567702
155678*        MOVE '4240-CHECK-PO-TRAILER'  TO DP013-PARAGRAPH         15567802
155679*        MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15567902
155680*                                  TO DP013-MESSAGE-TEXT (1)      15568002
155681*        MOVE SQLCA                TO DP013-SQLCA                 15568102
155682*        MOVE 'TSHPTPO '           TO DP013-DB2-TABLE-NAME (1)    15568202
155683*        SET DP013-DB2-ABEND                                      15568302
155684*            DP013-XCTL-DISPLAY-RESTART                           15568402
155685*                                  TO TRUE                        15568502
155686*        PERFORM DP013-0000-PROCESS-ABEND                         15568602
155687*    END-IF.                                                      15568702
155688*                                                                 15568802
155689*EJECT                                                            15568902
155690*----------------------------------------------------------------*15569002
155691*     CHECK WHETHER RECEIPT INFORMATION IS AVAILABLE FOR THE PO  *15569102
155692*----------------------------------------------------------------*15569202
155693*4250-CHECK-RECEIPTS.                                             15569302
155694                                                                  15569402
155695*    PERFORM                                                      15569502
155696*        WITH TEST AFTER                                          15569602
155697*        VARYING PV-RETRY-COUNTER                                 15569702
155698*        FROM 1 BY 1                                              15569802
155699*        UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15569902
155700*           OR  (SQLCODE = ZERO)                                  15570002
155701*           OR  (SQLCODE = +100))                                 15570102
155702*                                                                 15570202
155703*        EXEC SQL                                                 15570302
155704*             SELECT DISTINCT                                     15570402
155705*                    A.ORD_NBR                                    15570502
155706*             INTO  :RECEIV-ORD-NBR                               15570602
155707*             FROM   TRECEIV  A                                   15570702
155708*                  , TSTATCD  B                                   15570802
155709*             WHERE  A.ORD_NBR        = :ASC-PO-NBR               15570902
155710*             AND    A.VER_STATUS_CDE = 'A'                       15571002
155711*             AND    B.STATUS_TYP_CDE = 'R'                       15571102
155712*             AND    A.STATUS_CDE     = B.STATUS_CDE              15571202
155713*        END-EXEC                                                 15571302
155714*                                                                 15571402
155715*        EVALUATE TRUE                                            15571502
155716*            WHEN SQLCODE = -904                                  15571602
155717*            WHEN SQLCODE = -913                                  15571702
155718*                CONTINUE                                         15571802
155719*            WHEN SQLCODE = ZERO                                  15571902
155720*            WHEN SQLCODE = -811                                  15572002
155721*                MOVE 'Y'          TO ASC-RECEIPTS-IND            15572102
155722*            WHEN SQLCODE = +100                                  15572202
155723*                MOVE 'N'          TO ASC-RECEIPTS-IND            15572302
155724*            WHEN SQLWARN0 NOT = SPACES                           15572402
155725*            WHEN SQLCODE < ZERO                                  15572502
155726*            WHEN SQLCODE > ZERO                                  15572602
155727*                MOVE '4250-CHECK-RECEIPTS  '                     15572702
155728*                                  TO DP013-PARAGRAPH             15572802
155729*                MOVE 'SQL ERROR SELECTING PO'                    15572902
155730*                                  TO DP013-MESSAGE-TEXT (1)      15573002
155731*                MOVE SQLCA        TO DP013-SQLCA                 15573102
155732*                MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)    15573202
155733*                SET DP013-DB2-ABEND                              15573302
155734*                    DP013-XCTL-DISPLAY-RESTART TO TRUE           15573402
155735*                PERFORM DP013-0000-PROCESS-ABEND                 15573502
155736*        END-EVALUATE                                             15573602
155737*    END-PERFORM.                                                 15573702
155738*                                                                 15573802
155739*    IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15573902
155740*        MOVE '4250-CHECK-RECEIPTS  '  TO DP013-PARAGRAPH         15574002
155741*        MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15574102
155742*                                  TO DP013-MESSAGE-TEXT (1)      15574202
155743*        MOVE SQLCA                TO DP013-SQLCA                 15574302
155744*        MOVE 'TSHPTPO '           TO DP013-DB2-TABLE-NAME (1)    15574402
155745*        SET DP013-DB2-ABEND                                      15574502
155746*            DP013-XCTL-DISPLAY-RESTART                           15574602
155747*                                  TO TRUE                        15574702
155748*        PERFORM DP013-0000-PROCESS-ABEND                         15574802
155749*    END-IF.                                                      15574902
155750*----------------------------------------------------------------*15575002
155751*     CHECK WHETHER DECONSOLIDATION LINEHAUL INFO IS AVAILABLE   *15575102
155752*----------------------------------------------------------------*15575202
155753 4250-CHECK-DECONSOL-LH.                                          15575302
155754                                                                  15575402
155755     PERFORM                                                      15575502
155756         WITH TEST AFTER                                          15575602
155757         VARYING PV-RETRY-COUNTER                                 15575702
155758         FROM 1 BY 1                                              15575802
155759         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15575902
155760            OR  (SQLCODE = ZERO)                                  15576002
155761            OR  (SQLCODE = -811)                                  15576102
155762            OR  (SQLCODE = -305)                                  15576202
155763            OR  (SQLCODE = +100))                                 15576302
155764                                                                  15576402
155765*---------------------------------------------------------------* 15576502
155766*    CURSOR FOR DECONSOLIDATION LIST FOR A REQUESTED PO         * 15576602
155767*    FIRST THIS 'DBA APPROVED' CURSOR CREATES A TEMPORARY       * 15576702
155768*    TABLE OF ALL THE CONTAINERS FOR A PARTICULAR PO.           * 15576802
155769*    IT THEN 'LEFT JOINS' THAT TABLE WITH THE RESULTS OF THE    * 15576902
155770*    WHERE CLAUSE FOR THE REST OF THE TABLES. THE RESULTS OF    * 15577002
155771*    THIS QUERY IS THAT IT WILL BOTH BE ABLE TO LIST ANY        * 15577102
155772*    CONTAINER FOR WHICH THERE WAS NO INFORMATION ON ONE OF THE * 15577202
155773*    TABLES AND WILL ALSO HANDLE MULTIPLE TRAILERS. (IF YOU     * 15577302
155774*    BREAK THIS CURSOR APART INTO TWO CURSORS AND FETCH ALL OF  * 15577402
155775*    CONTAINERS FIRST YOU WILL THEN NEED TO DEAL WITH THE       * 15577502
155776*    PROBLEM OF GETTING MULTIPLE TRAILER ROWS FOR A CONTAINER   * 15577602
155777*    AND TRYING TO DISPLAY THEM USING THE CURRENT LIST PROCESS  * 15577702
155778*    UTILIZED BY THE CICS ARCHITECTURE.                         * 15577802
155779*---------------------------------------------------------------* 15577902
155780                                                                  15578002
155781     EXEC SQL                                                     15578102
155782         SELECT G.CONTNR_ID                                       15578202
155783              , COALESCE(CNTR_TBL.TRIP_ID,0)                      15578302
155784              , COALESCE(CNTR_TBL.SHIPT_ID,0)                     15578402
155785              , COALESCE(CNTR_TBL.PO_NBR,0)                       15578502
155786              , COALESCE(CNTR_TBL.OPER_UNT_ID,0)                  15578602
155787              , COALESCE(CNTR_TBL.VEH_NBR,' ')                    15578702
155788              , COALESCE(CNTR_TBL.FDR_FOB_CDE,' ')                15578802
155789              , COALESCE(CNTR_TBL.MOM_FOB_CDE,' ')                15578902
155790              , COALESCE(CNTR_TBL.MOM_TRIP_TYP_CDE,' ')           15579002
155791              , COALESCE(CNTR_TBL.FDR_TRIP_TYP_CDE,' ')           15579102
155792              , COALESCE(CNTR_TBL.MOM_DEST_POE_CDE,' ')           15579202
155793              , COALESCE(CNTR_TBL.ACTL_POE_DELY_TMST,             15579302
155794                    TIMESTAMP('0001-01-01-00.00.00.000000'))      15579402
155795            INTO                                                  15579502
155796                :PV-CONTNR-ID                                     15579602
155797              , :PV-TRIP-ID                                       15579702
155798              , :PV-SHIPT-ID                                      15579802
155799              , :PV-PO-NBR                                        15579902
155800              , :PV-OPER-UNT-ID                                   15580002
155801              , :PV-VEH-NBR                                       15580102
155802              , :PV-FOB-CDE                                       15580202
155803              , :PV-MOM-FOB-CDE                                   15580302
155804              , :PV-MOM-TRIP-TYP-CDE                              15580402
155805              , :PV-FDR-TRIP-TYP-CDE                              15580502
155806              , :PV-MOM-DEST-POE-CDE                              15580602
155807              , :PV-ACTL-POE-DELY-TMST                            15580702
155808            FROM (SELECT CONTNR_ID                                15580802
155809                        ,PO_NBR                                   15580902
155810                    FROM TIMCNPO                                  15581002
155811                   WHERE PO_NBR = :ASC-PO-NBR) AS G               15581102
155812                 LEFT OUTER JOIN                                  15581202
155813                 (SELECT A.TRIP_ID                                15581302
155814                        ,A.SHIPT_ID                               15581402
155815                        ,C.OPER_UNT_ID                            15581502
155816                        ,E.VEH_NBR                                15581602
155817                        ,C.CONTNR_ID                              15581702
155818                        ,B.PO_NBR                                 15581802
155819                        ,H.FDR_FOB_CDE                            15581902
155820                        ,H.MOM_FOB_CDE                            15582002
155821                        ,H.MOM_TRIP_TYP_CDE                       15582102
155822                        ,H.FDR_TRIP_TYP_CDE                       15582202
155823                        ,H.MOM_DEST_POE_CDE                       15582302
155824                        ,H.ACTL_POE_DELY_TMST                     15582402
155825                    FROM TSHIPMT  A                               15582502
155826                        ,TSHPTPO  B                               15582602
155827                        ,TPKSLIP  C                               15582702
155828                        ,TPURCHS  D                               15582802
155829                        ,TVHTRIP  E                               15582902
155830                        ,TVEHICL  F                               15583002
155831                        ,TIMCNTK  H                               15583102
155832                  WHERE  B.PO_NBR = :ASC-PO-NBR                   15583202
155833                    AND  B.PO_NBR = C.PO_NBR                      15583302
155834                    AND  B.REC_SEQ_NBR   = C.REC_SEQ_NBR          15583402
155835                    AND  B.REC_SEQ_NBR  ^= 0                      15583502
155836                    AND  C.PO_NBR        = D.PO_NBR               15583602
155837                    AND  C.CONTNR_ID     = H.CONTNR_ID            15583702
155838                    AND  A.SHIPT_ID      = B.SHIPT_ID             15583802
155839                    AND  A.TRIP_ID       = E.TRIP_ID              15583902
155840                    AND  E.OWNER_SCAC_ID = F.OWNER_SCAC_ID        15584002
155841                    AND  E.VEH_NBR       = F.VEH_NBR              15584102
155842                    AND  F.VEH_TYP_CDE   = 'TR'                   15584202
155843                    AND  C.VER_STAT_CDE  = 'A'                    15584302
155844                    AND  D.VER_STATUS_CDE  = 'A') AS CNTR_TBL     15584402
155845                 ON G.PO_NBR = CNTR_TBL.PO_NBR                    15584502
155846                AND G.CONTNR_ID = CNTR_TBL.CONTNR_ID              15584602
155847                                                                  15584702
155848     END-EXEC                                                     15584802
155849                                                                  15584902
155850                                                                  15585002
155851         EVALUATE TRUE                                            15585102
155852             WHEN SQLCODE = -904                                  15585202
155853             WHEN SQLCODE = -913                                  15585302
155854                 CONTINUE                                         15585402
155855             WHEN SQLCODE = ZERO                                  15585502
155856             WHEN SQLCODE = -811                                  15585602
155857                 MOVE 'Y'          TO ASC-DECONSOL-LH-IND         15585702
155858             WHEN SQLCODE = +100                                  15585802
155859             WHEN SQLCODE = -305                                  15585902
155860                 MOVE 'N'          TO ASC-DECONSOL-LH-IND         15586002
155861             WHEN SQLWARN0 NOT = SPACES                           15586102
155862             WHEN SQLCODE < ZERO                                  15586202
155863             WHEN SQLCODE > ZERO                                  15586302
155864                 MOVE '4250-CHECK-DECONSOL-LH'                    15586402
155865                                   TO DP013-PARAGRAPH             15586502
155866                 MOVE 'SQL ERROR SELECTING PO'                    15586602
155867                                   TO DP013-MESSAGE-TEXT (1)      15586702
155868                 MOVE SQLCA        TO DP013-SQLCA                 15586802
155869                 MOVE 'TIMCNPO '   TO DP013-DB2-TABLE-NAME (1)    15586902
155870                 SET DP013-DB2-ABEND                              15587002
155871                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15587102
155872                 PERFORM DP013-0000-PROCESS-ABEND                 15587202
155873         END-EVALUATE                                             15587302
155874     END-PERFORM.                                                 15587402
155875                                                                  15587502
155876     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15587602
155877         MOVE '4250-CHECK-DECONSOL-LH'  TO DP013-PARAGRAPH        15587702
155878         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15587802
155879                                   TO DP013-MESSAGE-TEXT (1)      15587902
155880         MOVE SQLCA                TO DP013-SQLCA                 15588002
155881         MOVE 'TIMCNPO '           TO DP013-DB2-TABLE-NAME (1)    15588102
155882         SET DP013-DB2-ABEND                                      15588202
155883             DP013-XCTL-DISPLAY-RESTART                           15588302
155884                                   TO TRUE                        15588402
155885         PERFORM DP013-0000-PROCESS-ABEND                         15588502
155886     END-IF.                                                      15588602
155887 4260-CHECK-BUYER-DECON.                                          15588702
155888                                                                  15588802
155889     PERFORM                                                      15588902
155890         WITH TEST AFTER                                          15589002
155891         VARYING PV-RETRY-COUNTER                                 15589102
155892         FROM 1 BY 1                                              15589202
155893         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15589302
155894            OR  (SQLCODE = ZERO)                                  15589402
155895            OR  (SQLCODE = -811)                                  15589502
155896            OR  (SQLCODE = +100))                                 15589602
155897                                                                  15589702
155898         EXEC SQL                                                 15589802
155899              SELECT DISTINCT                                     15589902
155900                     A.SHIPT_ID                                   15590002
155901              INTO  :SHIPMT-SHIPT-ID                              15590102
155902              FROM   TSHIPMT  A                                   15590202
155903                   , TSHPTPO  B                                   15590302
155904                   , TTRIPST  C                                   15590402
155905                   , TPURCHS  D                                   15590502
155906              WHERE  B.PO_NBR         = :ASC-PO-NBR               15590602
155907              AND    A.SHIPT_ID       = B.SHIPT_ID                15590702
155908              AND    C.TRIP_ID        = A.TRIP_ID                 15590802
155909              AND    B.PO_NBR         = D.PO_NBR                  15590902
155910              AND    D.VER_STATUS_CDE = :PC-A                     15591002
155911         END-EXEC                                                 15591102
155912                                                                  15591202
155913         EVALUATE TRUE                                            15591302
155914             WHEN SQLCODE = -904                                  15591402
155915             WHEN SQLCODE = -913                                  15591502
155916                 CONTINUE                                         15591602
155917             WHEN SQLCODE = ZERO                                  15591702
155918             WHEN SQLCODE = -811                                  15591802
155919                 MOVE 'Y'          TO ASC-BUYER-DECON-IND         15591902
155920             WHEN SQLCODE = +100                                  15592002
155921                 MOVE 'N'          TO ASC-BUYER-DECON-IND         15592102
155922             WHEN SQLWARN0 NOT = SPACES                           15592202
155923             WHEN SQLCODE < ZERO                                  15592302
155924             WHEN SQLCODE > ZERO                                  15592402
155925                 MOVE '4260-CHECK-BUYER-DECON'                    15592502
155926                                   TO DP013-PARAGRAPH             15592602
155927                 MOVE 'SQL ERROR SELECTING PO'                    15592702
155928                                   TO DP013-MESSAGE-TEXT (1)      15592802
155929                 MOVE SQLCA        TO DP013-SQLCA                 15592902
155930                 MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)    15593002
155931                 SET DP013-DB2-ABEND                              15593102
155932                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15593202
155933                 PERFORM DP013-0000-PROCESS-ABEND                 15593302
155934         END-EVALUATE                                             15593402
155935     END-PERFORM.                                                 15593502
155936                                                                  15593602
155937     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15593702
155938         MOVE '4260-CHECK-BUYER-DECON'  TO DP013-PARAGRAPH        15593802
155939         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15593902
155940                                   TO DP013-MESSAGE-TEXT (1)      15594002
155941         MOVE SQLCA                TO DP013-SQLCA                 15594102
155942         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    15594202
155943         SET DP013-DB2-ABEND                                      15594302
155944             DP013-XCTL-DISPLAY-RESTART                           15594402
155945                                   TO TRUE                        15594502
155946         PERFORM DP013-0000-PROCESS-ABEND                         15594602
155947     END-IF.                                                      15594702
155948 4270-CHECK-TRAILER.                                              15594802
155949                                                                  15594902
155950     PERFORM                                                      15595002
155951         WITH TEST AFTER                                          15595102
155952         VARYING PV-RETRY-COUNTER                                 15595202
155953         FROM 1 BY 1                                              15595302
155954         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15595402
155955            OR  (SQLCODE = ZERO)                                  15595502
155956            OR  (SQLCODE = -811)                                  15595602
155957            OR  (SQLCODE = +100))                                 15595702
155958                                                                  15595802
155959         EXEC SQL                                                 15595902
155960                SELECT                                            15596002
155961                    F.OWNER_SCAC_ID                               15596102
155962                   ,F.VEH_NBR                                     15596202
155963                   ,A.SHIPT_ID                                    15596302
155964                   ,B.TRIP_ID                                     15596402
155965                INTO                                              15596502
155966                  :VEHICL-OWNER-SCAC-ID                           15596602
155967                 ,:VEHICL-VEH-NBR                                 15596702
155968                 ,:SHPTPO-SHIPT-ID                                15596802
155969                 ,:SHIPMT-TRIP-ID                                 15596902
155970                   FROM    TSHPTPO    A                           15597002
155971                          ,TSHIPMT    B                           15597102
155972                          ,TPURCHS    D                           15597202
155973                          ,TVHTRIP    E                           15597302
155974                          ,TVEHICL    F                           15597402
155975            WHERE A.PO_NBR             = D.PO_NBR                 15597502
155976            AND     A.PO_NBR           = :ASC-PO-NBR              15597602
155977            AND     A.SHIPT_ID         = B.SHIPT_ID               15597702
155978            AND     D.VER_STATUS_CDE  = 'A'                       15597802
155979            AND     B.TRIP_ID          = E.TRIP_ID                15597902
155980            AND     E.VEH_NBR          = F.VEH_NBR                15598002
155981            AND     E.OWNER_SCAC_ID   = F.OWNER_SCAC_ID           15598102
155982            AND  F.VEH_TYP_CDE      = 'TR'                        15598202
155983     END-EXEC                                                     15598302
155984                                                                  15598402
155985         EVALUATE TRUE                                            15598502
155986             WHEN SQLCODE = -904                                  15598602
155987             WHEN SQLCODE = -913                                  15598702
155988                 CONTINUE                                         15598802
155989             WHEN SQLCODE = ZERO                                  15598902
155990             WHEN SQLCODE = -811                                  15599002
155991                 MOVE 'Y'          TO ASC-TRAILER-IND             15599102
155992             WHEN SQLCODE = +100                                  15599202
155993                 MOVE 'N'          TO ASC-TRAILER-IND             15599302
155994             WHEN SQLWARN0 NOT = SPACES                           15599402
155995             WHEN SQLCODE < ZERO                                  15599502
155996             WHEN SQLCODE > ZERO                                  15599602
155997                 MOVE '4270-CHECK-TRAILER'                        15599702
155998                                   TO DP013-PARAGRAPH             15599802
155999                 MOVE 'SQL ERROR TRAILERS'                        15599902
156000                                   TO DP013-MESSAGE-TEXT (1)      15600002
156001                 MOVE SQLCA        TO DP013-SQLCA                 15600102
156002                 MOVE 'TSHPTPO '   TO DP013-DB2-TABLE-NAME (1)    15600202
156003                 SET DP013-DB2-ABEND                              15600302
156004                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15600402
156005                 PERFORM DP013-0000-PROCESS-ABEND                 15600502
156006         END-EVALUATE                                             15600602
156007     END-PERFORM.                                                 15600702
156008                                                                  15600802
156009     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15600902
156010         MOVE '4270-CHECK-TRAILERS'  TO DP013-PARAGRAPH           15601002
156011         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15601102
156012                                   TO DP013-MESSAGE-TEXT (1)      15601202
156013         MOVE SQLCA                TO DP013-SQLCA                 15601302
156014         MOVE 'TSHIPMT '           TO DP013-DB2-TABLE-NAME (1)    15601402
156015         SET DP013-DB2-ABEND                                      15601502
156016             DP013-XCTL-DISPLAY-RESTART                           15601602
156017                                   TO TRUE                        15601702
156018         PERFORM DP013-0000-PROCESS-ABEND                         15601802
156019     END-IF.                                                      15601902
156020*                                                                 15602002
156021*EJECT                                                            15602102
156022*----------------------------------------------------------------*15602202
156023*    CHECK WHETHER CUSTOMS INFORMATION IS AVAILABLE FOR THE PO   *15602302
156024*----------------------------------------------------------------*15602402
156025 4280-CHECK-CUSTOMS.                                              15602502
156026                                                                  15602602
156027     PERFORM                                                      15602702
156028         WITH TEST AFTER                                          15602802
156029         VARYING PV-RETRY-COUNTER                                 15602902
156030         FROM 1 BY 1                                              15603002
156031         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15603102
156032            OR  (SQLCODE = ZERO)                                  15603202
156033            OR  (SQLCODE = +100))                                 15603302
156034                                                                  15603402
156035         EXEC SQL                                                 15603502
156036              SELECT DISTINCT                                     15603602
156037                     A.PO_NBR                                     15603702
156038              INTO  :IMCSPO-PO-NBR                                15603802
156039              FROM   TIMCSPO A                                    15603902
156040              WHERE  A.PO_NBR = :ASC-PO-NBR                       15604002
156041         END-EXEC                                                 15604102
156042*                                                                 15604202
156043         EVALUATE TRUE                                            15604302
156044             WHEN SQLCODE = -904                                  15604402
156045             WHEN SQLCODE = -913                                  15604502
156046                 CONTINUE                                         15604602
156047             WHEN SQLCODE = ZERO                                  15604702
156048             WHEN SQLCODE = -811                                  15604802
156049                  MOVE 'Y'         TO ASC-CUSTOMS-IND             15604902
156050             WHEN SQLCODE = +100                                  15605002
156051                  MOVE 'N'         TO ASC-CUSTOMS-IND             15605102
156052             WHEN SQLWARN0 NOT = SPACES                           15605202
156053             WHEN SQLCODE < ZERO                                  15605302
156054             WHEN SQLCODE > ZERO                                  15605402
156055                 MOVE '4280-CHECK-CUSTOMS'                        15605502
156056                                   TO DP013-PARAGRAPH             15605602
156057                 MOVE 'SQL ERROR SELECTING PO'                    15605702
156058                                   TO DP013-MESSAGE-TEXT (1)      15605802
156059                 MOVE SQLCA        TO DP013-SQLCA                 15605902
156060                 MOVE 'TICSCPO '   TO DP013-DB2-TABLE-NAME (1)    15606002
156061                 SET DP013-DB2-ABEND                              15606102
156062                     DP013-XCTL-DISPLAY-RESTART TO TRUE           15606202
156063                 PERFORM DP013-0000-PROCESS-ABEND                 15606302
156064         END-EVALUATE                                             15606402
156065     END-PERFORM.                                                 15606502
156066*                                                                 15606602
156067     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        15606702
156068         MOVE '4280-CHECK-CUSTOMS' TO DP013-PARAGRAPH             15606802
156069         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT PO'  15606902
156070                                   TO DP013-MESSAGE-TEXT (1)      15607002
156071         MOVE SQLCA                TO DP013-SQLCA                 15607102
156072         MOVE 'TIMCSPO '           TO DP013-DB2-TABLE-NAME (1)    15607202
156073         SET DP013-DB2-ABEND                                      15607302
156074             DP013-XCTL-DISPLAY-RESTART                           15607402
156075                                   TO TRUE                        15607502
156076         PERFORM DP013-0000-PROCESS-ABEND                         15607602
156077     END-IF.                                                      15607702
156078                                                                  15607802
156079 EJECT                                                            15607902
156080                                                                  15608002
156081                                                                  15608104
161801*                                                                 16180100
161802*----------------------------------------------------------------*16180200
161803*     PROCESS THE DB2 DATE TO MM/DD/YY FORMAT                    *16180300
161804*----------------------------------------------------------------*16180400
161805 4310-PROCESS-DATE.                                               16180500
161806                                                                  16180600
161807     MOVE PV-DB-MM             TO PV-DD-MM.                       16180700
161808     MOVE PV-DB-DD             TO PV-DD-DD.                       16180800
161809     MOVE PV-DB-YY             TO PV-DD-YY.                       16180900
161810                                                                  16181000
161811 EJECT                                                            16181100
161812*----------------------------------------------------------------*16181200
161813*    RESTORE THE DATA ON THE SCREEN FROM THE COMMAREA.           *16181300
161814*----------------------------------------------------------------*16181400
161815 4400-MOVE-COMMAREA-TO-SCREEN.                                    16181500
161816                                                                  16181600
161817     MOVE ASC-PO-NBR               TO APONBRO.                    16181700
161818     MOVE ASC-PO-TYPE              TO APOTYPO.                    16181800
161819     MOVE ASC-DEPT-NBR             TO ADEPTO.                     16181900
161820     MOVE ASC-OTB-MTH              TO AOTBO.                      16182000
161821     MOVE ASC-ORD-UNTS             TO AUNTSO.                     16182100
161822     MOVE ASC-VND-NME              TO AVNDNMEO.                   16182200
161823     MOVE ASC-FOB-CDE              TO AFOBO.                      16182300
161824     MOVE ASC-POE-CDE              TO APOEO.                      16182400
161825     MOVE ASC-CNTRY-CDE            TO ACNTRYO.                    16182500
161826     MOVE ASC-CAN-DTE              TO ACANDTO                     16182600
161827     MOVE ASC-EXT-CAN-DTE          TO AXCANDTO.                   16182700
161828     MOVE ASC-STRT-X-FACT-DTE      TO ASTXFDTO.                   16182800
161829     MOVE ASC-LAST-X-FACT-DTE      TO ALTXFDTO.                   16182900
161830     MOVE ASC-DONT-SHP-BEF-DTE     TO ADSHBEFO.                   16183000
161831     MOVE ASC-AD-DTE               TO AADDTO.                     16183100
161832     MOVE ASC-EXP-CTNS             TO ACTNSO.                     16183200
161833     MOVE ASC-BOOKING-IND          TO ABOKNGO.                    16183300
161834     MOVE ASC-RECEIVING-IND        TO ARCVNGO.                    16183400
161835     MOVE ASC-SAILING-IND          TO ASAILNGO.                   16183500
161836     MOVE ASC-CONTAINER-IND        TO ACONTNRO.                   16183600
161837*    MOVE ASC-RECEIPTS-IND         TO ARCPTSO.                    16183700
161838     MOVE ASC-BUYER-DECON-IND      TO ABUYDCSO.                   16183800
161839     MOVE ASC-DECONSOL-LH-IND      TO ADECONSO.                   16183900
161840     MOVE ASC-TRAILER-IND          TO ATRLDCSO.                   16184000
161841     MOVE ASC-CUSTOMS-IND          TO ACUSTMSO.                   16184100
161842     MOVE ASC-PO-STATUS            TO ASTATUSO.                   16184200
161846                                                                  16184600
161847 EJECT                                                            16184700
161848                                                                  16184800
161849*----------------------------------------------------------------*16184900
161850*    READ THE SELECTION QUEUE.                                   *16185000
161860*----------------------------------------------------------------*16186000
161870 9100-READ-SEL-QUEUE.                                             16187000
161880     EXEC CICS                                                    16188000
161890         READQ TS                                                 16189000
161900             QUEUE (ASC-IN-SEL-QUEUE-NAME)                        16190000
162000             INTO  (TM002-MESSAGE-SEL-REC)                        16200000
162100             ITEM  (ASC-SEL-ITEM)                                 16210000
162200             RESP  (PV-CICS-RESPONSE)                             16220000
162300     END-EXEC.                                                    16230000
162400                                                                  16240000
162500     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   16250000
162600         CONTINUE                                                 16260000
162700     ELSE                                                         16270000
162800         SET DP013-LOGIC-ABEND                                    16280000
162900             DP013-NO-ROLLBACK     TO TRUE                        16290000
163000         MOVE '9100-READ-SEL-QUEUE'                               16300000
163100                                   TO DP013-PARAGRAPH             16310000
163200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   16320000
163300                                   TO DP013-MESSAGE-TEXT (1)      16330000
163400         PERFORM DP013-0000-PROCESS-ABEND                         16340000
163500     END-IF.                                                      16350000
163501/                                                                 16350100
163502*----------------------------------------------------------------*16350200
163503*    REWRITE THE LIST QUEUE.                                     *16350300
163504*----------------------------------------------------------------*16350400
163505 9200-REWRITE-LIST-QUEUE.                                         16350500
163506     EXEC CICS                                                    16350600
163507          WRITEQ TS                                               16350700
163508              QUEUE  (ASC-IN-SEL-QUEUE-NAME)                      16350800
163509              FROM   (TM002-MESSAGE-SEL-REC)                      16350900
163510              ITEM   (ASC-SEL-ITEM)                               16351000
163520              RESP   (PV-CICS-RESPONSE)                           16352000
163530              REWRITE                                             16353000
163540     END-EXEC.                                                    16354000
163550                                                                  16355000
163560     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               16356000
163570         SET DP013-CICS-ABEND                                     16357000
163580             DP013-NO-ROLLBACK     TO TRUE                        16358000
163590         MOVE '9200-REWRITE-LIST-QUEUE'                           16359000
163600                                   TO DP013-PARAGRAPH             16360000
163700         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   16370000
163800                                   TO DP013-MESSAGE-TEXT (1)      16380000
163900         PERFORM DP013-0000-PROCESS-ABEND                         16390000
164000     END-IF.                                                      16400000
164001/                                                                 16400100
164002*----------------------------------------------------------------*16400200
164003*    ABEND PROCESSOR MODULE                                      *16400300
164004*----------------------------------------------------------------*16400400
164005                                                                  16400500
164006     COPY DPPD013.                                                16400600
164007                                                                  16400700
