000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    APKCS329.                                         00020001
000300 AUTHOR.        MARC BLAZICH. G&R.                                00030001
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040001
000500 DATE-WRITTEN.  06-22-94.                                         00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800*---------------------------------------------------------------* 00080001
000900*    TRANID      - E329                                         * 00090001
001000*    TYPE        - CICS ARCHITECTURE MAINTENANCE - DB2          * 00100001
001100*    DESCRIPTION - INVOICE ITEM UPDATE/DELETE                   * 00110001
001200*    MAPSET      - APKM329                                      * 00120001
001300*                                                               * 00130001
001400*    THIS PROGRAM WILL UPDATE AND DELETE NON-EDI INVOICE ITEMS  * 00140001
001500*                                                               * 00150001
001600*---------------------------------------------------------------* 00160001
001800* CHANGE LOG:                                                   * 00180001
001900*                                                               * 00190001
002000* 09/07/94    BMW  REPLACED SQL THAT REFERENCED THE TSK.SIZE_CDE* 00200001
002100*                  AND TSK.COLOR_CDE FIELDS SINCE THESE FIELDS  * 00210001
002200*                  ARE IN TEST, BUT WILL NOT BE IN PRODUCTION   * 00220001
002300*                  WHEN THIS PROGRAM IS INSTALLED.              * 00230001
002400*                                                               * 00240001
002500* 10/13/94    BMW  FIX -811 ABEND RETURNING MULTIPLE ROWS IN    * 00250001
002600*                  PARA 4050-                                   * 00260001
002700*                                                               * 00270001
002800* 01/17/95    BMW  REMOVED THE USE OF VALUE(PO_NBR, +0) IN THE  * 00280001
002900*                  WHERE CLAUSES.  IT WAS CAUSING TABLE SCANS.  * 00290001
003000*                  REMOVED EDIT THAT RESTRICTED  A PO LINE NBR  * 00300001
003100*                  BEING ASSIGNED TO ONE AND ONLY ONE INVC LINE.* 00310001
003200*                                                               * 00320001
003300* 03/15/95  P.KEBER  CHANGED NEXT-ACT-RETURN LOGIC TO REBUILD   * 00330001
003400*                    THE SCREEN FROM THE COMMAREA.  ELIMINATED  * 00340001
003500*                    UNNECESSARY INTER-APPL-COMMAREA MOVES.     * 00350001
003600*                    ACTIVATED THE 5200-UPDATE-SELECTION-QUEUE  * 00360001
003700*                    ROUTINE.                                   * 00370001
003800*                                                               * 00380001
003900* 05/18/95  P.KEBER  CORRECTED THE SELECT FROM TPURITM CALL IN  * 00390001
004000*                    4050-GET-DATA-FROM-PURITM TO ACCESS BY PO_ * 00400001
004100*                    LINE_NBR AND TO RETRIEVE APP_PO_LNE_NBR    * 00410001
004200*                    WHICH WILL BE DISPLAYED AS THE PO LNE      * 00420001
004300*                    FIELD ON THE INVOICE ITEM UPDATE SCREEN.   * 00430001
004400*                                                               * 00440001
004500* 07/25/95  P.KEBER  MADE CHANGES TO DISPLAY PURITM-APP-PO-LNE- * 00450001
004600*                    NBR INSTEAD OF PURITM-PO-LNE-NBR IN ORDER  * 00460001
004700*                    TO BE CONSISTENT WITH THE INVOICE ITEM     * 00470001
004800*                    LIST SCREEN.                               * 00480001
004900*                                                               * 00490001
005000* 03/21/97  MJW      ADDED LOGIC TO PREVENT CHANGES BEING MADE  * 00500001
005100*                    TO WRITE OFF INVOICE.                      * 00510001
005200*                                                               * 00520001
005300* 02/03/98   ROBIN BERNOSKI                  WR/IR #: WR5703    * 00530001
005400*            - MODIFIED THE MANNER IN WHICH THE STANDARD DATE   * 00540001
005500*              ROUTINE, DPKUT500, IS TO BE CALLED WITHIN A      * 00550001
005600*              PROGRAM SO THAT THE CALL IS DYNAMIC.             * 00560001
005700*            - REPLACED ++INCLUDES WITH COPY STATEMENTS.        * 00570001
005800*                                                               * 00580001
005900* 01/10/01    MAB  COMMENTED VARIOUS PARTS OF CODE WHERE ERROR  * 00590001
006000*                  MESSAGE 00851 IS USED TO STOP THE USER FROM  * 00600001
006100*                  UPDATING EDI EBTERED INVOICES.  ALSO RELATED * 00610001
006200*                  WAS CODE THAT REFERRED TO THE ENTR-MTHD-CDE  * 00620001
006300*                  BEING EQUAL TO 'ED'.  THIS WAS ALL DONE TO   * 00630001
006400*                  THE USER TO BE ABLE TO DO INVOICE DETAIL     * 00640001
006500*                  MODIFICATIONS SO THAT AP WON'T HAVE TO DO    * 00650001
006600*                  MULTIPLE PAY RELEASES.  THIS WILL CUT DOWN ON* 00660001
006700*                  THE MULTIPLE GENERATED SHORTAGES TO THE      * 00670001
006800*                  VENDOR ALSO.                 WR# 21576       * 00680001
006900*                                                               * 00690001
007000* 06/12/01    MAB  ADDED A SET OF () TO THE FIRST IF STMT IN    * 00700001
007100*                  PARA 3200-.  THIS IS CORRECTING A PROBLEM    * 00710001
007200*                  THAT ALLOWED THE USER TO UPDATE QUANTITY AND * 00720001
007300*                  NOT THE PO LINE NUMBER FOR REMAINDER INVOICES* 00730001
007400*                  THE USER SHOULD ONLY BE ABLE TO UPDATE THE PO* 00740001
007500*                  LINE NUMBER FOR REMAINDER INVOICES.          * 00750001
007600*                                               WR# 21576       * 00760001
007700*                                                               * 00770001
007800* 06/13/01    MAB  RETURNED HOW EDI INVOICES ARE HANDLED IN     * 00780001
007900*                  PARA 3200-.  ADDED IF STMT TO JUST OPEN UP   * 00790001
008000*                  THE QUANTITY WITH PARA 3216-.  ALSO CREATED  * 00800001
008100*                  PARAS 3216- AND 6250- AND REDID THE CODE SO  * 00810001
008200*                  THAT ONLY THE QUANTITY (NOT THE UOM AND UNIT * 00820001
008300*                  COST) WAS ADDITIONALLY ALLOWED TO BE CHANGED * 00830001
008400*                  FOR EDI INVOICES.                            * 00840001
008500*                                               WR# 21576       * 00850001
008600*                                                               * 00860001
008700* 06/15/01    MAB  UNDID THE CHANGES FROM 06-13-01. RESTORED    * 00870001
008800*                  THE ABILITY FOR THE USER TO CHANGE ON AN EDI * 00880001
008900*                  MERCHANDISE INVOICE THE PO LINE NUMBER, UOM, * 00890001
009000*                  QUANTITY AND UNIT COST.  THEY CAN ALSO DELETE* 00900001
009100*                  A DETAIL LINE.                               * 00910001
009200*                                               WR# 21576       * 00920001
009300*                                                               * 00930001
009400* 09/21/01    MAB  ADDED CODE TO BLOCK AN EXPENSE INVOICE FROM  * 00940001
009500*                  HAVING ANY OF ITS LINE ITEMS BEING UPDATED OR* 00950001
009600*                  DELETED.                     WR# 20530       * 00960001
009700*                                                               * 00970001
009800* 02/27/02  CHANGED BY: MIKE BESKE              WR# 21278       * 00980001
009900*          - REPLACED THE TSK TABLE WITH TSKXREF AS PART        * 00990001
010000*            OF RETEK PROJECT PRELIM FOR AP.  (PARA 4060-)      * 01000001
010100*            TSK STILL HAS TO BE KEPT THOUGH BECAUSE OF OTHER   * 01010001
010200*            COLUMNS THAT ARE NEEDED AND NOT FOUND ON TSKXREF.  * 01020001
010300*                                                               * 01030001
010400*   5/22/02  ADDED LABELS TO PO_NBR IN SQL WHERE JOINS OF       * 01040001
010500*            TINVOIC AND TPAYREQ IN ORDER TO DIFFERENTIATE THE  * 01050001
010600*            TABLE THE PO_NBR IS ORIGINATING FROM.              * 01060001
010700*             BY: MIKE BESKE                     WR: 23500      * 01070001
010800*                                                               * 01080001
010900*  11/04/02  COLBY DATING PROJECT                               * 01090001
011000*            ELIMINATED THE TPAYREQ.  ADDEC 'PJ' TO CODE NOT    * 01100001
011100*            ALLOW DELETES OR UPDATES OTHER INVOICE STATUS TYPES* 01110001
011200*             BY: MIKE BESKE                     WR: 23750      * 01120001
011300*                                                               * 01130001
011400* 04/22/03  CHANGE MADE:                                        * 01140007
011500*           MODIFICATIONS DONE AS PART OF NI-SKU PROJECT.       * 01150007
011600*           REMOVED TPURCHS TVNDINV TUPCSKU TSKXREF TSK         * 01160007
011700*           + ALL REFERENCES TO THESE TABLES.  REMOVED CODE THAT* 01170007
011800*           POPULATED THE SCREEN FIELD NAMES THAT WERE REMOVED  * 01180007
011900*           FRPM APKM346.  ADDED CODE TO POPULATE ADPTNBR ON THE* 01190007
012000*           NI-SKU CHANGES.  TPURITM COULD NOT BE COMPLETELY    * 01200007
012100*           OMITTED AT THIS TIME, AS IT IS STILL NEEDED TO      * 01210007
012200*           VERIFY VALID PO LINE #S THAT CAN BE UPDATED.        * 01220007
012300*           CHANGED BY: MIKE BESKE              WR# 22557       * 01230007
012400*                                                               * 01240007
012500* 06/04/03  CHANGE MADE:                                        * 01250009
012600*           HAD TO COMPLETELY RESTORE THE USE OF TPURITM IN RE- * 01260009
012700*           GARDS TO THE COMPLEX HANDLING OF PO LINE NUMBER.    * 01270009
012800*           AP USERS WERE HAVING PROBLEMS MAKING PO LINE NUMBER * 01280009
012900*           CHANGES WHEN THE PO-LNE-NBR WAS NOT THE SAME VALUE  * 01290009
013000*           AS THE APP-PO-LNE-NBR ON TPURITM.                   * 01300009
013100*           CHANGED BY: MIKE BESKE              WR# 22557       * 01310009
013200*                                                               * 01320009
013300* 07/21/03  CHANGE MADE:                                        * 01330010
013400*           ADDED 'AS' TO THE EVALUATE IN 3030-EDIT-UOM AS A    * 01340010
013500*           VALID UNIT OF MEASURE.  THIS VALUE REPRESENTS AN    * 01350010
013600*           UNMATCHED LINE FOR A COMPOUND PREPACK HEADER UPC    * 01360010
013700*           WAS SENT VIA EDI WITH NO DETAIL AND COULD NOT BE    * 01370010
013800*           EXPLODED.                                           * 01380010
013900*           CHANGED BY: MIKE BESKE              WR# 24685       * 01390010
014000*                                                               * 01400010
014090* 07/17/06  CHANGE MADE:                                        * 01409037
014091*           COMMENTED VARIOUS PARTS OF CODE IN PARGRAPHS        * 01409137
014092*           2100-CHECK-FUNCTION-KEY AND 4000-BUILD-INITIAL-PANEL* 01409237
014093*           WHERE ERROR MESSAGE 09700 WAS USED TO PREVENT THE   * 01409337
014094*           USER FROM UPDATING REMAINDER INVOICES.  COMMENTED   * 01409437
014095*           ALL CODE IN PARAGRAPH 3200-RESET-ATTRIBUTES         * 01409537
014096*           RELATING TO SPECIFIC INVOICE TYPES AND ENTRY        * 01409637
014097*           METHODS.  IT WAS REQUESTED THAT BOTH MERCHANDISE    * 01409737
014098*           AND REMAINDER INVOICES ONLY ALLOW THE ABILITY FOR   * 01409837
014099*           THE PO LINE NUMBER TO BE UPDATED.  PARAGRAPHS       * 01409939
014100*           3000-EDIT-DATA-IN-COMMAREA AND 6000-UPDATE-DATABASE * 01410039
014101*           WERE ALSO EDITED FOR THE SAME REASON.  THESE CHANGES* 01410139
014102*           WERE MADE TO ALLOW THE USER THE ABILITY TO MODIFY   * 01410239
014103*           INVOICE DETAILS (SUCH AS PO LINE NUMBER) SO THAT AP * 01410340
014104*           WILL NOT HAVE TO PERFORM MULTIPLE PAY RELEASES.     * 01410439
014106*           CHANGED BY: KRYSTEN LEARY           WR# 30974       * 01410637
014107*                                                               * 01410741
014108* 03/11/07  CHANGE MADE:                                        * 01410847
014109*           MATCH BY DC -- IN PARAGRAPH 8800-CHECK-IF-PROCESSED,* 01410941
014115*           ADDED MATCH LEVEL AND DC COMPARISON LOGIC TO THE    * 01411546
014116*           WHERE CLAUSE OF THE QUERY.                          * 01411646
014123*           CHANGED BY: KRYSTEN LEARY           WR# 21578       * 01412342
014124*                                                               * 01412448
014125* 10/20/14  CHANGE MADE:                                        * 01412548
014126*           PO EXTENDED DIGIT CHANGES - EXTENDED PO# FROM       * 01412648
014127*           7 TO 9                                              * 01412748
014129*           CHANGED BY: COGNIZANT        WR/IR #: CHG0094517    * 01412948
014130* DATE  09/01/2021                                                01413052
014131*            - CHANGE CALL OF  DPKUT100  TO                     * 01413154
014132*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 01413252
014133*              MAKING THE CALL DYNAMIC VS STATIC                * 01413352
014134*     MADE BY: GERMAN BANDA            WR/IR #: CHG0261053        01413455
014135* DATE  03/15/2022                                                01413562
014136*            - ALLOW UPDATES FOR INVOICES IN PJ STATUS FOR      * 01413657
014137*              SEPHORA.                                         * 01413757
014139*     MADE BY: JEAN KURK               WR/IR #: CHG0265588        01413957
014140* DATE  10/21/2022                                                01414062
014141*     ADD COPYBOOK DPWS930                                        01414162
014142*     CHANGE CICS ARCHITECTURE CALL TO USE DP930-CICS-ARCH-API    01414262
014143*     MADE BY: BOB MCASEY              WR/IR #: CHG0276864        01414362
014150*---------------------------------------------------------------* 01415001
014200                                                                  01420001
014300 ENVIRONMENT DIVISION.                                            01430001
014400 DATA DIVISION.                                                   01440001
014500                                                                  01450001
014700 WORKING-STORAGE SECTION.                                         01470001
014800                                                                  01480001
014900 01  DK-DB2-KEYS.                                                 01490001
015000     05  DK-INVC-ID                   PIC  X(22).                 01500001
015100     05  DK-PAYT-REQ-SEQ-NBR          PIC S9(09) VALUE +0         01510001
015200                                                 COMP.            01520001
015300     05  DK-PAYT-REQ-LNE-NBR          PIC S9(09) VALUE +0         01530001
015400                                                 COMP.            01540001
015500     05  DK-PO-LNE-NBR                PIC S9(09) VALUE +0         01550001
015600                                                 COMP.            01560001
015700     05  DK-APP-PO-LNE-NBR            PIC S9(09) VALUE +0         01570001
015800                                                 COMP.            01580001
015900     05  DK-PO-NBR                    PIC S9(09) VALUE +0         01590001
016000                                                 COMP.            01600001
016100     05  DK-PO-NBR-LOW                PIC S9(09) VALUE +0         01610001
016200                                                 COMP.            01620001
016300     05  DK-PO-NBR-HIGH               PIC S9(09) VALUE +0         01630001
016400                                                 COMP.            01640001
016500                                                                  01650001
016600 01  PC-PROGRAM-CONSTANTS.                                        01660001
016700     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         01670001
016800                                                    'AP329A  '.   01680001
016900     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         01690001
017000                                                    'APKM329 '.   01700001
017100     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     01710001
017200                                                    COMP.         01720001
017300     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         01730001
017400                                                    'APKCS329'.   01740001
017500     05  PC-DPKUT100                    PIC  X(08)  VALUE         01750001
017600                                                    'DPKUT100'.   01760001
017700     05  PC-NULL-DATE                   PIC  X(10)  VALUE         01770001
017800                                                    '9999-09-09'. 01780001
017900     05  PC-PRIME1                      PIC S9(05)   COMP-3       01790001
018000                                            VALUE +38543.         01800001
018100     05  PC-PRIME2                      PIC S9(05)   COMP-3       01810001
018200                                            VALUE +58889.         01820001
018300     05  PC-ONE-BILLION                 PIC S9(11)   COMP-3       01830001
018400                                            VALUE +1000000000.    01840001
018500     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      01850001
018600                                                    COMP-3.       01860001
018700     05  PC-N-CODE                      PIC X(01)   VALUE 'N'.    01870001
018800     05  PC-TSYMSG-NUMBERS.                                       01880001
018900                                                                  01890001
019000         10  PC-TSYMSG-00004            PIC  9(05)  VALUE  00004. 01900001
019100         10  PC-TSYMSG-00005            PIC  9(05)  VALUE  00005. 01910001
019200         10  PC-TSYMSG-00007            PIC  9(05)  VALUE  00007. 01920001
019300         10  PC-TSYMSG-00008            PIC  9(05)  VALUE  00008. 01930001
019400         10  PC-TSYMSG-00009            PIC  9(05)  VALUE  00009. 01940001
019500         10  PC-TSYMSG-00010            PIC  9(05)  VALUE  00010. 01950001
019600         10  PC-TSYMSG-00016            PIC  9(05)  VALUE  00016. 01960001
019700         10  PC-TSYMSG-00017            PIC  9(05)  VALUE  00017. 01970001
019800         10  PC-TSYMSG-00034            PIC  9(05)  VALUE  00034. 01980001
019900         10  PC-TSYMSG-00046            PIC  9(05)  VALUE  00046. 01990001
020000         10  PC-TSYMSG-00047            PIC  9(05)  VALUE  00047. 02000001
020100         10  PC-TSYMSG-00057            PIC  9(05)  VALUE  00057. 02010001
020200         10  PC-TSYMSG-00059            PIC  9(05)  VALUE  00059. 02020001
020300         10  PC-TSYMSG-00069            PIC  9(05)  VALUE  00069. 02030001
020400         10  PC-TSYMSG-00070            PIC  9(05)  VALUE  00070. 02040001
020500         10  PC-TSYMSG-00073            PIC  9(05)  VALUE  00073. 02050001
020600         10  PC-TSYMSG-00100            PIC  9(05)  VALUE  00100. 02060001
020700         10  PC-TSYMSG-00112            PIC  9(05)  VALUE  00112. 02070001
020800         10  PC-TSYMSG-00115            PIC  9(05)  VALUE  00115. 02080001
020900         10  PC-TSYMSG-00116            PIC  9(05)  VALUE  00116. 02090001
021000         10  PC-TSYMSG-00117            PIC  9(05)  VALUE  00117. 02100001
021100         10  PC-TSYMSG-00118            PIC  9(05)  VALUE  00118. 02110001
021200         10  PC-TSYMSG-00124            PIC  9(05)  VALUE  00124. 02120001
021300         10  PC-TSYMSG-00134            PIC  9(05)  VALUE  00134. 02130001
021400         10  PC-TSYMSG-00148            PIC  9(05)  VALUE  00148. 02140001
021500         10  PC-TSYMSG-00158            PIC  9(05)  VALUE  00158. 02150001
021600         10  PC-TSYMSG-00164            PIC  9(05)  VALUE  00164. 02160001
021700         10  PC-TSYMSG-00165            PIC  9(05)  VALUE  00165. 02170001
021800         10  PC-TSYMSG-00170            PIC  9(05)  VALUE  00170. 02180001
021900         10  PC-TSYMSG-00224            PIC  9(05)  VALUE  00224. 02190001
022000         10  PC-TSYMSG-00231            PIC  9(05)  VALUE  00231. 02200001
022100         10  PC-TSYMSG-00308            PIC  9(05)  VALUE  00308. 02210001
022200         10  PC-TSYMSG-00316            PIC  9(05)  VALUE  00316. 02220001
022300         10  PC-TSYMSG-00349            PIC  9(05)  VALUE  00349. 02230001
022400         10  PC-TSYMSG-00354            PIC  9(05)  VALUE  00354. 02240001
022500         10  PC-TSYMSG-00396            PIC  9(05)  VALUE  00396. 02250001
022600         10  PC-TSYMSG-00457            PIC  9(05)  VALUE  00457. 02260001
022700         10  PC-TSYMSG-00482            PIC  9(05)  VALUE  00482. 02270001
022800         10  PC-TSYMSG-00494            PIC  9(05)  VALUE  00494. 02280001
022900         10  PC-TSYMSG-00601            PIC  9(05)  VALUE  00601. 02290001
023000         10  PC-TSYMSG-00726            PIC  9(05)  VALUE  00726. 02300001
023100         10  PC-TSYMSG-00849            PIC  9(05)  VALUE  00849. 02310001
023200         10  PC-TSYMSG-00850            PIC  9(05)  VALUE  00850. 02320001
023300         10  PC-TSYMSG-00851            PIC  9(05)  VALUE  00851. 02330001
023400         10  PC-TSYMSG-00852            PIC  9(05)  VALUE  00852. 02340001
023500         10  PC-TSYMSG-00855            PIC  9(05)  VALUE  00855. 02350001
023600         10  PC-TSYMSG-00856            PIC  9(05)  VALUE  00856. 02360001
023700         10  PC-TSYMSG-00857            PIC  9(05)  VALUE  00857. 02370001
023800         10  PC-TSYMSG-00858            PIC  9(05)  VALUE  00858. 02380001
023900         10  PC-TSYMSG-00859            PIC  9(05)  VALUE  00859. 02390001
024000         10  PC-TSYMSG-00860            PIC  9(05)  VALUE  00860. 02400001
024100         10  PC-TSYMSG-00865            PIC  9(05)  VALUE  00865. 02410001
024200         10  PC-TSYMSG-00869            PIC  9(05)  VALUE  00869. 02420001
024300         10  PC-TSYMSG-00870            PIC  9(05)  VALUE  00870. 02430001
024400         10  PC-TSYMSG-00871            PIC  9(05)  VALUE  00871. 02440001
024500         10  PC-TSYMSG-00873            PIC  9(05)  VALUE  00873. 02450001
024600         10  PC-TSYMSG-00874            PIC  9(05)  VALUE  00874. 02460001
024700         10  PC-TSYMSG-00913            PIC  9(05)  VALUE  00913. 02470001
024800         10  PC-TSYMSG-00961            PIC  9(05)  VALUE  00961. 02480001
024900*        10  PC-TSYMSG-00970            PIC  9(05)  VALUE  00970. 02490014
025000         10  PC-TSYMSG-01517            PIC  9(05)  VALUE  01517. 02500001
025100         10  PC-TSYMSG-01518            PIC  9(05)  VALUE  01518. 02510001
025200         10  PC-TSYMSG-02699            PIC  9(05)  VALUE  02699. 02520001
025300                                                                  02530001
025400 01  PV-PROGRAM-VARIABLES.                                        02540001
025500                                                                  02550001
025600     05  PV-APP-PO-LNE-NBR              PIC S9(9) VALUE +0 COMP.  02560001
025700     05  PV-NEW-KEY-PO-LNE-NBR          PIC S9(9) VALUE +0 COMP.  02570001
025800     05  PV-DB2-COUNT                   PIC S9(9) COMP.           02580001
025900     05  PV-DUMMY-NBR                   PIC S9(9) COMP VALUE 0.   02590001
026000     05  PV-NULL-INDICATORS.                                      02600001
026100         10  MIITEM-PO-LNE-NBR-NN       PIC S9(4) COMP.           02610001
026200                                                                  02620001
026300     05  PV-NUM3                        PIC ZZ9.                  02630001
026400     05  PV-NUM3-X REDEFINES                                      02640001
026500         PV-NUM3                        PIC X(3).                 02650001
026600     05  PV-NUM4                        PIC ZZZ9.                 02660001
026700     05  PV-NUM4-X REDEFINES                                      02670001
026800         PV-NUM4                        PIC X(4).                 02680001
026900     05  PV-NUM7                        PIC Z(7).                 02690050
027000     05  PV-NUM7-X REDEFINES                                      02700050
027100         PV-NUM7                        PIC X(7).                 02710050
027110     05  PV-NUM9                        PIC Z(9).                 02711050
027120     05  PV-NUM9-X REDEFINES                                      02712050
027130         PV-NUM9                        PIC X(9).                 02713050
027200     05  PV-NUM11                       PIC Z(11).                02720001
027300     05  PV-NUM11-X REDEFINES                                     02730001
027400         PV-NUM11                       PIC X(11).                02740001
027500     05  PV-7V99                        PIC Z(7).99.              02750001
027600     05  PV-7V99-X REDEFINES                                      02760001
027700         PV-7V99                        PIC X(10).                02770001
027800     05  PV-6V999                       PIC Z(6).999.             02780001
027900     05  PV-6V999-X REDEFINES                                     02790001
028000         PV-6V999                       PIC X(10).                02800001
028100     05  PV-CICS-RESPONSE               PIC S9(04)  VALUE +0      02810001
028200                                                    COMP SYNC.    02820001
028300     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02830001
028400                                                    COMP SYNC.    02840001
028500     05  PV-WORK-FIELD                   PIC S9(17)   COMP-3      02850001
028600                                                      VALUE +0.   02860001
028700     05  PV-WORK-FIELD2                  PIC S9(17)   COMP-3      02870001
028800                                                      VALUE +0.   02880001
028900     05  PV-DUP-COUNTER                 PIC S9(04) COMP.          02890001
029000                                                                  02900001
029100 01  PS-PROGRAM-SWITCHES.                                         02910001
029200     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    02920001
029300         88  PS-NO-ERROR                            VALUE 'Y'.    02930001
029400         88  PS-ERROR                               VALUE 'N'.    02940001
029500     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    02950001
029600         88  PS-COMMAREA-VALID                      VALUE 'Y'.    02960001
029700         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    02970001
029800     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    02980001
029900         88  PS-DONE                                VALUE 'Y'.    02990001
030000         88  PS-NOT-DONE                            VALUE 'N'.    03000001
030100     05  PS-PURITM-FOUND-SW             PIC  X(01)  VALUE 'N'.    03010001
030200         88  PURITM-FOUND                           VALUE 'Y'.    03020001
030300         88  PURITM-NOT-FOUND                       VALUE 'N'.    03030001
030400                                                                  03040043
030500*--------------------------------------------------------------*  03050043
030600* RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE      *  03060043
030700*--------------------------------------------------------------*  03070043
030900     COPY APWS301.                                                03090001
031000                                                                  03100001
031200*--------------------------------------------------------------*  03120043
031300* MAP LAYOUT                                                   *  03130043
031400*--------------------------------------------------------------*  03140043
031600     COPY APKM329.                                                03160001
031700                                                                  03170043
031800*--------------------------------------------------------------*  03180043
031900* ATTRIBUTE SETTINGS COPYBOOK                                  *  03190043
032000*--------------------------------------------------------------*  03200043
032200     COPY DPWS015.                                                03220001
032300                                                                  03230001
032400*--------------------------------------------------------------*  03240043
032500* FUNCTION KEYS COPYBOOK.                                      *  03250043
032600*--------------------------------------------------------------*  03260043
032800     COPY DPWS016.                                                03280001
032900                                                                  03290001
033000*--------------------------------------------------------------*  03300043
033100* WORK AREA FOR NUMERIC EDIT ROUTINE - DPKUT100                *  03310043
033200*--------------------------------------------------------------*  03320043
033300     COPY DPWS010I.                                               03330001
033400                                                                  03340001
033600*--------------------------------------------------------------*  03360043
033700* PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).     *  03370043
033800*--------------------------------------------------------------*  03380043
034000     COPY DPWS030.                                                03400001
034010     COPY DPWS930.                                                03401062
034100                                                                  03410001
034300*--------------------------------------------------------------*  03430043
034400* STANDARD COMMAREA.                                           *  03440043
034500*--------------------------------------------------------------*  03450043
034700     COPY DPWS020.                                                03470001
034710                                                                  03471043
034800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03480001
035000         10  INTER-APPL-COMM-AREA       PIC X(200).               03500001
035100     COPY APWS300.                                                03510001
035200*---------------------------------------------------------------* 03520001
035300*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03530001
035400*---------------------------------------------------------------* 03540001
035500         10  ASC-SPECIFIC-COMMAREA.                               03550001
035600             15  ASC-INT-APPL-FORMAT-IND    PIC X(01).            03560001
035700                 88  ASC-INTER-APPL-CRIT-UPD     VALUE ' '.       03570001
035800                 88  ASC-INTER-APPL-CRIT-DEL     VALUE '1'.       03580001
035900                 88  ASC-INTER-APPL-LIST-UPD     VALUE '5'.       03590001
036000                 88  ASC-INTER-APPL-LIST-DEL     VALUE '6'.       03600001
036100             15  ASC-REQUEST-SW             PIC X(03).            03610001
036200                 88  ASC-DELETE-REQUESTED   VALUE 'DEL'.          03620001
036300                 88  ASC-UPDATE-REQUESTED   VALUE 'UPD'.          03630001
036400             15  ASC-ACTION-SW              PIC X(03).            03640001
036500                 88  ASC-DELETE-ALLOWED     VALUE '   '.          03650001
036600                 88  ASC-NO-CHANGES-ALLOWED VALUE 'NOC'.          03660001
036700                 88  ASC-DELETE-PENDING     VALUE 'DEL'.          03670001
036800                 88  ASC-UPDATE-PENDING     VALUE 'UPD'.          03680001
036900             15  ASC-DELETE-SUCCESSFUL-SW   PIC X(01).            03690001
037000                 88  ASC-DELETE-SUCCESSFUL  VALUE 'Y'.            03700001
037100             15  ASC-ADD-SUCCESSFUL-SW      PIC X(01).            03710001
037200                 88  ASC-ADD-NOT-SUCCESSFUL VALUE ' '.            03720001
037300                 88  ASC-ADD-SUCCESSFUL     VALUE 'Y'.            03730001
037400             15  ASC-FIELDS-MODIFIED-SW     PIC X(01).            03740001
037500                 88  ASC-FIELDS-MODIFIED    VALUE 'Y'.            03750001
037600             15  ASC-INVOICE-FOUND-SW       PIC X(01).            03760001
037700                 88  ASC-INVOICE-FOUND      VALUE 'Y'.            03770001
037800                 88  ASC-INVOICE-NOT-FOUND  VALUE 'N'.            03780001
037900                 88  ASC-INVOICE-DUPLICATE  VALUE 'D'.            03790001
038000             15  ASC-TALCHRG-EXISTS-SW      PIC X(01).            03800001
038100                 88  ASC-TALCHRG-EXISTS     VALUE 'Y'.            03810001
038200             15  ASC-KEY-FIELDS.                                  03820001
038300                 20  ASC-KEY-PAYT-REQ-SEQ-NBR     PIC S9(09) COMP.03830001
038400                 20  ASC-KEY-PO-NBR               PIC S9(09) COMP.03840001
038500                 20  ASC-KEY-INVC-ID              PIC  X(22).     03850001
038600                 20  ASC-KEY-INVC-STATUS          PIC  X(02).     03860001
038700                 20  ASC-KEY-PO-LNE-NBR           PIC S9(09) COMP.03870001
038800                 20  ASC-KEY-PAYT-REQ-LNE-NBR     PIC S9(09) COMP.03880001
038900                 20  ASC-KEY-DEPT-NBR             PIC  X(03).     03890001
039000             15  ASC-ORIGINAL-FIELD-VALUES.                       03900001
039100                 20  ASC-OLD-PO-LNE-NBR           PIC S9(09) COMP.03910001
039200                 20  ASC-OLD-PREQIT-FIELDS.                       03920001
039300                     25  ASC-OLD-PAY-REQ-LNE-QTY  PIC S9(09) COMP.03930001
039400                     25  ASC-OLD-QTY-UNT-OF-MSMT  PIC  X(02).     03940001
039500                     25  ASC-OLD-UNT-COST-AMT     PIC S9(07)V9(3) 03950001
039600                                                       COMP-3.    03960001
039700             15  ASC-NEWLY-ENTERED-FIELD-VALUES.                  03970001
039800                 20  ASC-NEW-PO-LNE-NBR           PIC S9(09) COMP.03980001
039900                 20  ASC-NEW-PREQIT-FIELDS.                       03990001
040000                     25  ASC-NEW-PAY-REQ-LNE-QTY  PIC S9(09) COMP.04000001
040100                     25  ASC-NEW-QTY-UNT-OF-MSMT  PIC  X(02).     04010001
040200                     25  ASC-NEW-UNT-COST-AMT     PIC S9(07)V9(3) 04020001
040300                                                       COMP-3.    04030001
040400             15  ASC-ALPHA-COUNTERPARTS.                          04040001
040500                 20  ASC-ALP-PO-LNE-NBR.                          04050001
040600                     25  ASC-ALP-PO-LNE-NBR-NUM                   04060001
040700                                                  PIC 9(4).       04070001
040800                 20  ASC-ALP-PAY-REQ-LNE-QTY.                     04080001
040900                     25  ASC-ALP-PAY-REQ-LNE-QTY-NUM              04090001
041000                                                  PIC 9(7).       04100001
041100                 20  ASC-ALP-UNT-COST-AMT.                        04110001
041200                     25  ASC-ALP-UNT-COST-AMT-NUM PIC 9(7)V9(3).  04120001
041300                                                                  04130001
041400             15  ASC-OTHER-FIELDS.                                04140001
041500                 20  ASC-INVC-TYP-CDE         PIC X(2).           04150001
041600                 20  ASC-ENTR-MTHD-CDE        PIC X(2).           04160001
041700                 20  ASC-PREV-KEY-FIELDS.                         04170001
041800                     25  ASC-PREV-PO-LNE-NBR  PIC 9(04).          04180001
041900                 20  ASC-PAY-IND              PIC X(1).           04190001
042000                 20  ASC-DUN-NBR              PIC  X(09).         04200001
042100                 20  ASC-CURRENT-TIMESTAMP    PIC  X(26).         04210001
042200                 20  ASC-CURRENT-TS-RDF       REDEFINES           04220001
042300                     ASC-CURRENT-TIMESTAMP.                       04230001
042400                     25  ASC-CURRENT-DATE     PIC X(10).          04240001
042500                     25  FILLER               PIC X(01).          04250001
042600                     25  ASC-CURRENT-TIME.                        04260001
042700                         30  ASC-HH           PIC 9(02).          04270001
042800                         30  FILLER           PIC X(01).          04280001
042900                         30  ASC-MIN          PIC 9(02).          04290001
043000                         30  FILLER           PIC X(01).          04300001
043100                         30  ASC-SEC          PIC 9(02).          04310001
043200                         30  FILLER           PIC X(01).          04320001
043300                         30  ASC-MILLI-SEC    PIC 9(06).          04330001
043400             15  ASC-USE-SELECTION-QUEUE-IND                      04340001
043500                                        PIC  X(01).               04350001
043600                 88  ASC-USE-SELECTION-QUEUE        VALUE 'Y'.    04360001
043700             15  ASC-SEL-QUEUE-NAME     PIC  X(08).               04370001
043800             15  ASC-NUMBER-OF-TS-ITEMS PIC S9(05)  COMP-3.       04380001
043900             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04390001
044000                                        PIC S9(09)  COMP-3.       04400001
044100             15  ASC-SEL-SUB            PIC S9(04)  COMP.         04410001
044200             15  ASC-SEL-ITEM           PIC S9(04)  COMP.         04420001
044300             15  ASC-NEW-KEY-PO-LNE-NBR PIC S9(09)  COMP.         04430001
044400                                                                  04440001
044600*--------------------------------------------------------------*  04460043
044700* ABEND PROCESSING COPYBOOK                                    *  04470043
044800*--------------------------------------------------------------*  04480043
045000     COPY DPWS013.                                                04500001
045100                                                                  04510001
045300*--------------------------------------------------------------*  04530043
045400* INVOICE TABLE                                                *  04540043
045500*--------------------------------------------------------------*  04550043
045510     EXEC SQL INCLUDE TINVOIC  END-EXEC.                          04551043
045600                                                                  04560001
045610*--------------------------------------------------------------*  04561043
045620* PAYMENT REQUEST ITEM TABLE                                   *  04562043
045630*--------------------------------------------------------------*  04563043
045700     EXEC SQL INCLUDE TPREQIT  END-EXEC.                          04570001
045800                                                                  04580043
045900*--------------------------------------------------------------*  04590043
045910* PO/STORE TABLE                                               *  04591043
045920*--------------------------------------------------------------*  04592043
046100     EXEC SQL INCLUDE TPOSTRR  END-EXEC.                          04610001
046200                                                                  04620043
046210*--------------------------------------------------------------*  04621043
046220* MERCHANDISE INVOICE ITEM TABLE                               *  04622043
046230*--------------------------------------------------------------*  04623043
046300     EXEC SQL INCLUDE TMIITEM  END-EXEC.                          04630001
046400                                                                  04640043
046410*--------------------------------------------------------------*  04641043
046420* PURCHASE ORDER LINE ITEM TABLE                               *  04642043
046430*--------------------------------------------------------------*  04643043
046500     EXEC SQL INCLUDE TPURITM  END-EXEC.                          04650043
046620                                                                  04662043
046710*--------------------------------------------------------------*  04671043
046800* DB2 AREA FOR COMMUNICATIONS                                  *  04680043
046900*--------------------------------------------------------------*  04690043
047000     EXEC SQL                                                     04700001
047100          INCLUDE SQLCA                                           04710043
047200     END-EXEC.                                                    04720001
047210                                                                  04721043
047300*--------------------------*                                      04730043
047500 LINKAGE SECTION.                                                 04750001
047600*--------------------------*                                      04760043
047700 01  DFHCOMMAREA.                                                 04770001
047800     05  FILLER                         OCCURS  1 TO 4072 TIMES   04780001
047900                                        DEPENDING ON EIBCALEN.    04790001
048000         10  FILLER                     PIC X.                    04800001
048100                                                                  04810001
048300 PROCEDURE DIVISION.                                              04830001
048400*-------------------------------------------------------------*   04840044
048500* THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. *   04850043
048600* FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  *   04860043
048700* PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. *   04870043
048800*-------------------------------------------------------------*   04880044
048900 0000-MAIN-MODULE.                                                04890001
049000                                                                  04900001
049100     INITIALIZE DP030-CICS-API-FIELDS.                            04910001
049200                                                                  04920001
049300     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       04930001
049400     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          04940001
049500     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         04950001
049600                                                                  04960001
049700     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       04970001
049800                                                                  04980001
049900     MOVE LENGTH OF AP329AI        TO DP030-MAP-LENGTH (1).       04990001
050000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05000001
050100                                                                  05010001
050200     PERFORM 0001-CALL-CICS-ARCH-API.                             05020001
050300     PERFORM 1000-CONTROL-PROCESSING                              05030001
050400                                                                  05040001
050500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05050001
050600     PERFORM 0001-CALL-CICS-ARCH-API.                             05060001
050700                                                                  05070001
050800*--------------------------------------------------------------*  05080044
050900* THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE    *  05090044
051000* AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.          *  05100044
051100*--------------------------------------------------------------*  05110044
051200 0001-CALL-CICS-ARCH-API.                                         05120001
051210                                                                  05121044
051300     CALL DP930-CICS-ARCH-API  USING DFHEIBLK                     05130062
051400                                     DFHCOMMAREA                  05140062
051500                                     DP030-CICS-API-FIELDS        05150062
051600                                     DP020-STANDARD-COMMAREA      05160062
051700                                     AP329AI.                     05170062
051800                                                                  05180001
051900     IF  DP030-RC-CALL-SUCCESSFUL                                 05190001
052000         CONTINUE                                                 05200001
052100     ELSE                                                         05210001
052200         SET DP013-NO-ROLLBACK                                    05220001
052300             DP013-XCTL-DISPLAY-RESTART                           05230001
052400             DP013-CICS-ABEND      TO TRUE                        05240001
052500         MOVE '0001-CALL-CICS-ARCH-API'                           05250001
052600                                   TO DP013-PARAGRAPH             05260001
052810         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05281062
052820-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05282062
052900         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05290001
053000         PERFORM DP013-0000-PROCESS-ABEND                         05300001
053100     END-IF.                                                      05310001
053200                                                                  05320001
053300*--------------------------------------------------------------*  05330044
053400* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT    *  05340044
053500* COURSE OF ACTION IS FOR THIS TRANSACTION.                    *  05350044
053600*--------------------------------------------------------------*  05360044
053800 1000-CONTROL-PROCESSING.                                         05380001
053900                                                                  05390001
054000     EVALUATE TRUE                                                05400001
054100         WHEN DP020-NEXT-ACT-INITIAL                              05410001
054200              PERFORM 1100-FIND-OBJECT-KEYS                       05420001
054300              IF  PS-ERROR                                        05430001
054400                  CONTINUE                                        05440001
054500              ELSE                                                05450001
054600                  PERFORM 4000-BUILD-INITIAL-PANEL                05460001
054700                  IF PS-ERROR                                     05470001
054800                      CONTINUE                                    05480001
054900                  ELSE                                            05490001
055000                      PERFORM 3200-RESET-ATTRIBUTES               05500001
055100                      PERFORM 3500-SAVE-SCREEN-FIELDS             05510001
055200                      IF  ASC-INVOICE-FOUND                       05520001
055300                          IF  ASC-DELETE-REQUESTED                05530001
055400                              SET ASC-DELETE-PENDING TO TRUE      05540001
055500*-->                          ** PRESS PF2 TO CONFIRM DELETE **   05550001
055600                              MOVE PC-TSYMSG-00354                05560001
055700                                         TO DP020-MSG-NUMBER      05570001
055800                              SET DP020-MSG-INFORMATIONAL         05580001
055900                                         TO TRUE                  05590001
056000                          END-IF                                  05600001
056100                      ELSE                                        05610001
056200                          IF ASC-INVOICE-NOT-FOUND                05620001
056300                              SET DP020-NEXT-ACT-APPL-ERROR       05630001
056400                                             TO TRUE              05640001
056500                              MOVE PC-TSYMSG-00855                05650001
056600                                             TO DP020-MSG-NUMBER  05660001
056700                              SET DP020-MSG-INFORMATIONAL         05670001
056800                                             TO TRUE              05680001
056900                          END-IF                                  05690001
057000                      END-IF                                      05700001
057100                  END-IF                                          05710001
057200              END-IF                                              05720001
057300                                                                  05730001
057400         WHEN DP020-NEXT-ACT-READ-MAP                             05740001
057500             PERFORM 2000-PROCESS-PANEL                           05750001
057600                                                                  05760001
057700         WHEN DP020-NEXT-ACT-RETURN                               05770001
057800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 05780001
057900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   05790001
058000*            PERFORM 3500-SAVE-SCREEN-FIELDS                      05800001
058100                                                                  05810001
058200         WHEN OTHER                                               05820001
058300             SET DP013-LOGIC-ABEND TO TRUE                        05830001
058400             SET DP013-NO-ROLLBACK TO TRUE                        05840001
058500             MOVE '1000-CONTROL-PROCESSING'                       05850001
058600                                   TO DP013-PARAGRAPH             05860001
058700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   05870001
058800                                   TO DP013-MESSAGE-TEXT(1)       05880001
058900             MOVE DP020-NEXT-APPL-ACTIVITY                        05890001
059000                                   TO DP013-MESSAGE-TEXT(2)       05900001
059100             PERFORM DP013-0000-PROCESS-ABEND                     05910001
059200     END-EVALUATE.                                                05920001
059300                                                                  05930001
059500*--------------------------------------------------------------*  05950044
059600* DETERMINE THE KEY OF THE OBJECT TO BE UPDATED BASED ON THE   *  05960044
059700* INTER-APPLICATION FORMAT CODE.                               *  05970044
059800*--------------------------------------------------------------*  05980044
059900 1100-FIND-OBJECT-KEYS.                                           05990001
060000                                                                  06000001
060100     INITIALIZE ASC-SPECIFIC-COMMAREA.                            06010001
060200     SET PS-NO-ERROR             TO TRUE                          06020001
060300                                                                  06030001
060400     MOVE AP300-INVC-ID          TO ASC-KEY-INVC-ID               06040001
060500     MOVE AP300-PO-NBR           TO ASC-KEY-PO-NBR                06050001
060600     MOVE AP300-DEPT-NBR         TO ASC-KEY-DEPT-NBR              06060001
060700                                                                  06070001
060800     MOVE AP300-PO-LNE-NBR       TO ASC-KEY-PO-LNE-NBR            06080001
060900     MOVE AP300-PAYT-REQ-LNE-NBR TO ASC-KEY-PAYT-REQ-LNE-NBR      06090001
061000                                                                  06100001
061100     IF ASC-KEY-INVC-ID > SPACES                                  06110001
061200         CONTINUE                                                 06120001
061300     ELSE                                                         06130001
061400         MOVE PC-TSYMSG-00849    TO DP020-MSG-NUMBER              06140001
061500         SET DP020-MSG-FATAL                                      06150001
061600             DP020-NEXT-ACT-APPL-ERROR                            06160001
061700             PS-ERROR            TO TRUE                          06170001
061800     END-IF                                                       06180001
061900                                                                  06190001
062000     IF PS-NO-ERROR                                               06200001
062100         MOVE DP020-INT-APPL-FORMAT-IND                           06210001
062200                                     TO ASC-INT-APPL-FORMAT-IND   06220001
062300         EVALUATE TRUE                                            06230001
062400                                                                  06240001
062500             WHEN ASC-INTER-APPL-CRIT-UPD                         06250001
062600                 SET ASC-UPDATE-PENDING                           06260001
062700                     ASC-UPDATE-REQUESTED  TO TRUE                06270001
062800                                                                  06280001
062900             WHEN ASC-INTER-APPL-CRIT-DEL                         06290001
063000                 SET ASC-DELETE-REQUESTED  TO TRUE                06300001
063100                                                                  06310001
063200             WHEN ASC-INTER-APPL-LIST-UPD                         06320001
063300             WHEN ASC-INTER-APPL-LIST-DEL                         06330001
063400                 IF ASC-INTER-APPL-LIST-UPD                       06340001
063500                     SET ASC-UPDATE-PENDING                       06350001
063600                         ASC-UPDATE-REQUESTED  TO TRUE            06360001
063700                 ELSE                                             06370001
063800                     SET ASC-DELETE-REQUESTED  TO TRUE            06380001
063900                 END-IF                                           06390001
064000                 SET ASC-USE-SELECTION-QUEUE                      06400001
064100                                 TO TRUE                          06410001
064200                 MOVE AP300-NUMBER-OF-SELECTED-ITEMS              06420001
064300                                 TO ASC-NUMBER-OF-SELECTED-ITEMS  06430001
064400                 MOVE AP300-NUMBER-OF-TS-ITEMS                    06440001
064500                                 TO ASC-NUMBER-OF-TS-ITEMS        06450001
064600                 MOVE AP300-SEL-QUEUE-NAME                        06460001
064700                                 TO ASC-SEL-QUEUE-NAME            06470001
064800                                                                  06480001
064900                 PERFORM 1120-PREPARE-LIST-ENTRY                  06490001
065000                                                                  06500001
065100             WHEN OTHER                                           06510001
065200                 MOVE PC-TSYMSG-00148 TO DP020-MSG-NUMBER         06520001
065300                 SET DP020-MSG-FATAL                              06530001
065400                     DP020-NEXT-ACT-APPL-ERROR                    06540001
065500                     PS-ERROR        TO TRUE                      06550001
065600         END-EVALUATE                                             06560001
065700     END-IF.                                                      06570001
065800                                                                  06580001
066000*--------------------------------------------------------------*  06600044
066100* ENTRY IS FROM A LIST.  GET THE FORMAT NUMBER FROM THE TEMP   *  06610044
066200* STORAGE QUEUE PASSED FROM THE LIST.                          *  06620044
066300*--------------------------------------------------------------*  06630044
066400 1120-PREPARE-LIST-ENTRY.                                         06640001
066500                                                                  06650001
066600     MOVE AP301-MAX-ITEMS          TO ASC-SEL-SUB.                06660001
066700     MOVE ZERO                     TO ASC-SEL-ITEM.               06670001
066800     PERFORM 2110-GET-NEXT-RECORD.                                06680001
066900                                                                  06690044
067000*--------------------------------------------------------------*  06700044
067100* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA *  06710044
067200* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT *  06720044
067300* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST*  06730044
067400* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID    *  06740044
067500* FUNCTION KEYS CAN GET THIS FAR.                              *  06750044
067600*--------------------------------------------------------------*  06760044
067800 2000-PROCESS-PANEL.                                              06780001
067900                                                                  06790001
068000     EVALUATE TRUE                                                06800001
068100                                                                  06810001
068200         WHEN DP020-FK-CONFIRM (DP020-SRC-AID)                    06820001
068300             EVALUATE TRUE                                        06830001
068400                 WHEN ASC-DELETE-SUCCESSFUL                       06840001
068500                     MOVE PC-TSYMSG-00116                         06850001
068600                                       TO DP020-MSG-NUMBER        06860001
068700                     SET DP020-MSG-FATAL                          06870001
068800                         PS-ERROR      TO TRUE                    06880001
068900                     PERFORM 3200-RESET-ATTRIBUTES                06890001
069000                                                                  06900001
069100                 WHEN ASC-DELETE-PENDING                          06910001
069200                     PERFORM 8800-CHECK-IF-PROCESSED              06920001
069300                     IF PS-ERROR                                  06930001
069400                         MOVE PC-TSYMSG-00961 TO                  06940001
069500                              DP020-MSG-NUMBER                    06950001
069600                         SET DP020-MSG-FATAL                      06960001
069700                             DP030-OVERRIDE-GO                    06970001
069800                             PS-ERROR         TO TRUE             06980001
069900                     ELSE                                         06990001
070000                         SET DP030-CONTINUE-GO                    07000001
070100                                           TO TRUE                07010001
070200                         PERFORM 7000-DELETE-TPREQIT              07020001
070300                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     07030001
070400                     END-IF                                       07040001
070500                                                                  07050001
070600                 WHEN (ASC-NO-CHANGES-ALLOWED AND                 07060001
070700                       ASC-DELETE-REQUESTED)                      07070001
070800**-->                ** CAN'T DO IT FOR THIS STATUS  **           07080001
070900                     IF ASC-INVC-TYP-CDE = 'WO'                   07090001
071000                        MOVE PC-TSYMSG-01518                      07100001
071100                                       TO DP020-MSG-NUMBER        07110001
071200                     ELSE                                         07120001
071300                        MOVE PC-TSYMSG-00170                      07130001
071400                                       TO DP020-MSG-NUMBER        07140001
071500                     END-IF                                       07150001
071600                     SET DP020-MSG-FATAL                          07160001
071700                         PS-ERROR      TO TRUE                    07170001
071800                     PERFORM 3200-RESET-ATTRIBUTES                07180001
071900                 WHEN OTHER                                       07190001
072000**-->                ** MUST REQUEST DELETE BEFORE CONFIRMING **  07200001
072100                     MOVE PC-TSYMSG-00118                         07210001
072200                                       TO DP020-MSG-NUMBER        07220001
072300                     SET DP020-MSG-FATAL                          07230001
072400                         PS-ERROR      TO TRUE                    07240001
072500                     PERFORM 3200-RESET-ATTRIBUTES                07250001
072600             END-EVALUATE                                         07260001
072700                                                                  07270001
072800         WHEN DP020-SRC-AID = DP016-CLEAR                         07280001
072900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07290001
073000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07300001
073100                                                                  07310001
073200         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07320001
073300             SET DP030-DONT-ERASE                                 07330001
073400                 DP030-SEND-DATAONLY (PC-APPL-MAP)                07340001
073500                               TO TRUE                            07350001
073600             PERFORM 4000-BUILD-INITIAL-PANEL                     07360001
073700             PERFORM 3200-RESET-ATTRIBUTES                        07370001
073800             PERFORM 3500-SAVE-SCREEN-FIELDS                      07380001
073900                                                                  07390001
074000         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07400001
074100             IF  ASC-USE-SELECTION-QUEUE                          07410001
074200                 PERFORM 2110-GET-NEXT-RECORD                     07420001
074300                 PERFORM 4000-BUILD-INITIAL-PANEL                 07430001
074400                 PERFORM 3200-RESET-ATTRIBUTES                    07440001
074500                 PERFORM 3500-SAVE-SCREEN-FIELDS                  07450001
074600             ELSE                                                 07460001
074700*                --- BOTTOM OF LIST ---                           07470001
074800                 MOVE PC-TSYMSG-00070                             07480001
074900                                   TO DP020-MSG-NUMBER            07490001
075000                 SET DP020-MSG-INFORMATIONAL                      07500001
075100                                   TO TRUE                        07510001
075200             END-IF                                               07520001
075300                                                                  07530001
075400         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07540001
075500             IF  ASC-USE-SELECTION-QUEUE                          07550001
075600                 PERFORM 2120-GET-PREV-RECORD                     07560001
075700                 PERFORM 4000-BUILD-INITIAL-PANEL                 07570001
075800                 PERFORM 3200-RESET-ATTRIBUTES                    07580001
075900                 PERFORM 3500-SAVE-SCREEN-FIELDS                  07590001
076000             ELSE                                                 07600001
076100*                --- TOP OF LIST ---                              07610001
076200                 MOVE PC-TSYMSG-00069                             07620001
076300                                   TO DP020-MSG-NUMBER            07630001
076400                 SET DP020-MSG-INFORMATIONAL                      07640001
076500                                   TO TRUE                        07650001
076600             END-IF                                               07660001
076700                                                                  07670001
076800         WHEN OTHER                                               07680001
076900             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07690001
077000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07700001
077100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07710001
077200             IF PS-NO-ERROR        OR                             07720001
077300                DP020-MSG-WARNING                                 07730001
077400                 SET DP030-CONTINUE-GO                            07740001
077500                                   TO TRUE                        07750001
077600                 PERFORM 2100-CHECK-FUNCTION-KEY                  07760001
077700             ELSE                                                 07770001
077800                 SET DP030-OVERRIDE-GO                            07780001
077900                                   TO TRUE                        07790001
078000             END-IF                                               07800001
078100     END-EVALUATE.                                                07810001
078200                                                                  07820044
078300*--------------------------------------------------------------*  07830044
078400* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     *  07840044
078410* FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED *  07841044
078420* FROM THE CICS ARCHITECTURE API.                              *  07842044
078700*--------------------------------------------------------------*  07870044
078800 2100-CHECK-FUNCTION-KEY.                                         07880001
078900                                                                  07890001
079000     EVALUATE TRUE                                                07900001
079100         WHEN DP020-SRC-AID = DP016-ENTER                         07910001
079200             CONTINUE                                             07920001
079300                                                                  07930001
079400         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 07940001
079500                                                                  07950001
079600             MOVE ASC-KEY-PO-NBR      TO AP300-PO-NBR             07960001
079700             MOVE ASC-KEY-INVC-ID     TO AP300-INVC-ID            07970001
079800             MOVE ASC-KEY-INVC-STATUS TO AP300-INVC-STATUS        07980001
079900             MOVE ASC-KEY-PAYT-REQ-LNE-NBR                        07990001
080000                                      TO AP300-PAYT-REQ-LNE-NBR   08000001
080100             MOVE ASC-KEY-PO-LNE-NBR  TO AP300-PO-LNE-NBR         08010001
080200             MOVE ASC-KEY-DEPT-NBR    TO AP300-DEPT-NBR           08020001
080300             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    08030001
080400                                TO AP300-NUMBER-OF-SELECTED-ITEMS 08040001
080500             MOVE ASC-NUMBER-OF-TS-ITEMS                          08050001
080600                                      TO AP300-NUMBER-OF-TS-ITEMS 08060001
080700             MOVE ASC-SEL-QUEUE-NAME  TO AP300-SEL-QUEUE-NAME     08070001
080800                                                                  08080001
080900*            IF ASC-ENTR-MTHD-CDE = 'ED'                          08090001
081000*-->             -- CANNOT UPDATE EDI INVOICE ITEM --             08100001
081100*                SET ASC-UPDATE-REQUESTED                         08110001
081200*                    ASC-UPDATE-PENDING     TO TRUE               08120001
081300*                MOVE PC-TSYMSG-00851 TO                          08130001
081400*                     DP020-MSG-NUMBER                            08140001
081500*                SET DP020-MSG-FATAL                              08150001
081600*                    DP030-OVERRIDE-GO                            08160001
081700*                    PS-ERROR         TO TRUE                     08170001
081800*            END-IF                                               08180001
081900             IF ASC-INVC-TYP-CDE  = 'EI'                          08190001
082000*-->             -- CANNOT DELETE EXPENSE INVOICE ITEM --         08200001
082100                 SET ASC-UPDATE-REQUESTED                         08210001
082200                     ASC-UPDATE-PENDING     TO TRUE               08220001
082300                 MOVE PC-TSYMSG-02699 TO                          08230001
082400                      DP020-MSG-NUMBER                            08240001
082500                 SET DP020-MSG-FATAL                              08250001
082600                     DP030-OVERRIDE-GO                            08260001
082700                     PS-ERROR         TO TRUE                     08270001
082800             END-IF                                               08280001
082900*            IF ASC-INVC-TYP-CDE  = 'RI'                          08290014
083000*-->             -- CANNOT DELETE REMAINDER INVOICE ITEM --       08300001
083100*                SET ASC-UPDATE-REQUESTED                         08310014
083200*                    ASC-UPDATE-PENDING     TO TRUE               08320014
083300*                MOVE PC-TSYMSG-00970 TO                          08330014
083400*                     DP020-MSG-NUMBER                            08340014
083500*                SET DP020-MSG-FATAL                              08350014
083600*                    DP030-OVERRIDE-GO                            08360014
083700*                    PS-ERROR         TO TRUE                     08370014
083800*            END-IF                                               08380014
083900             IF ASC-INVC-TYP-CDE  = 'WO'                          08390001
084000*-->             -- CANNOT DELETE WRITE OFF INVOICE ITEM --       08400001
084100                 SET ASC-NO-CHANGES-ALLOWED                       08410001
084200                     ASC-UPDATE-REQUESTED                         08420001
084300                     ASC-UPDATE-PENDING     TO TRUE               08430001
084400                 MOVE PC-TSYMSG-01518 TO                          08440001
084500                      DP020-MSG-NUMBER                            08450001
084600                 SET DP020-MSG-FATAL                              08460001
084700                     DP030-OVERRIDE-GO                            08470001
084800                     PS-ERROR         TO TRUE                     08480001
084900             END-IF                                               08490001
085000                                                                  08500001
085100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08510001
085200             IF ASC-UPDATE-PENDING                                08520001
085300                IF ASC-INVC-TYP-CDE  = 'WO'                       08530001
085400                   MOVE PC-TSYMSG-01517 TO DP020-MSG-NUMBER       08540001
085500                   SET DP020-MSG-FATAL                            08550001
085600                       DP030-OVERRIDE-GO                          08560001
085700                       PS-ERROR         TO TRUE                   08570001
085800                ELSE                                              08580001
085900                   PERFORM 3600-CHECK-IF-FIELDS-CHANGED           08590001
086000                   IF ASC-FIELDS-MODIFIED                         08600001
086100                      PERFORM 8800-CHECK-IF-PROCESSED             08610001
086200                      IF PS-ERROR                                 08620001
086300                         MOVE PC-TSYMSG-00961 TO                  08630001
086400                              DP020-MSG-NUMBER                    08640001
086500                         SET DP020-MSG-FATAL                      08650001
086600                             DP030-OVERRIDE-GO                    08660001
086700                             PS-ERROR         TO TRUE             08670001
086800                      ELSE                                        08680001
086900                         SET DP030-CONTINUE-GO                    08690001
087000                                         TO TRUE                  08700001
087100                         PERFORM 6000-UPDATE-DATABASE             08710001
087200                         PERFORM 3500-SAVE-SCREEN-FIELDS          08720001
087300                      END-IF                                      08730001
087400                    ELSE                                          08740001
087500                       MOVE PC-TSYMSG-00046                       08750001
087600                                       TO DP020-MSG-NUMBER        08760001
087700                       SET DP020-MSG-INFORMATIONAL                08770001
087800                                       TO TRUE                    08780001
087900                    END-IF                                        08790001
088000                 END-IF                                           08800001
088100             ELSE                                                 08810001
088200                 IF ASC-UPDATE-REQUESTED AND                      08820001
088300                    ASC-NO-CHANGES-ALLOWED                        08830001
088400                    EVALUATE TRUE                                 08840001
088500*                     WHEN ASC-ENTR-MTHD-CDE = 'ED'               08850001
088600*                        MOVE PC-TSYMSG-00851                     08860001
088700*                                         TO DP020-MSG-NUMBER     08870001
088800                      WHEN ASC-INVC-TYP-CDE  = 'EI'               08880001
088900                         MOVE PC-TSYMSG-02699                     08890001
089000                                          TO DP020-MSG-NUMBER     08900001
089100*                     WHEN ASC-INVC-TYP-CDE  = 'RI'               08910014
089200*                        MOVE PC-TSYMSG-00970                     08920014
089300*                                         TO DP020-MSG-NUMBER     08930014
089400                      WHEN ASC-INVC-TYP-CDE  = 'WO'               08940001
089500                         MOVE PC-TSYMSG-01517                     08950001
089600                                          TO DP020-MSG-NUMBER     08960001
089700                      WHEN OTHER                                  08970001
089800                         MOVE PC-TSYMSG-00170                     08980001
089900                                          TO DP020-MSG-NUMBER     08990001
090000                     END-EVALUATE                                 09000001
090100                     SET DP020-MSG-FATAL                          09010001
090200                         PS-ERROR         TO TRUE                 09020001
090300                 END-IF                                           09030001
090400                 PERFORM 3200-RESET-ATTRIBUTES                    09040001
090500                 SET DP030-SET-CURSOR-TRAILER TO TRUE             09050001
090600             END-IF                                               09060001
090700                                                                  09070001
090800                                                                  09080001
090900         WHEN OTHER                                               09090001
091000             SET DP013-NO-ROLLBACK                                09100001
091100                 DP013-XCTL-DISPLAY-RESTART                       09110001
091200                 DP013-CICS-ABEND  TO TRUE                        09120001
091300             MOVE '2100-CHECK-FUNCTION-KEY'                       09130001
091400                                   TO DP013-PARAGRAPH             09140001
091500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09150001
091600                                   TO DP013-MESSAGE-TEXT (1)      09160001
091700             PERFORM DP013-0000-PROCESS-ABEND                     09170001
091800     END-EVALUATE.                                                09180001
091810                                                                  09181044
091910*--------------------------------------------------------------*  09191044
091920* GET THE NEXT RECORD IN THE LIST                              *  09192044
091950*--------------------------------------------------------------*  09195044
092000 2110-GET-NEXT-RECORD.                                            09200001
092100                                                                  09210001
092200     ADD +1                        TO ASC-SEL-SUB.                09220001
092300     IF  ASC-SEL-SUB > AP301-MAX-ITEMS                            09230001
092400         ADD +1                    TO ASC-SEL-ITEM                09240001
092500         MOVE +1                   TO ASC-SEL-SUB                 09250001
092600     END-IF.                                                      09260001
092700                                                                  09270001
092800     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                09280001
092900         PERFORM 9100-READ-SEL-QUEUE                              09290001
093000         IF  AP301-ITEM (ASC-SEL-SUB) > ZERO                      09300001
093100             MOVE AP301-PO-LNE-NBR       (ASC-SEL-SUB)            09310001
093200                                   TO ASC-KEY-PO-LNE-NBR          09320001
093300             MOVE AP301-PAYT-REQ-LNE-NBR (ASC-SEL-SUB)            09330001
093400                                   TO ASC-KEY-PAYT-REQ-LNE-NBR    09340001
093500*-->         IT'S POSSIBLE THAT THE USER DID AN UPDATE, DID A     09350001
093600*-->         "PREV", AND DID A NEXT TO RE-DISPLAY THIS RECORD.    09360001
093700*-->         IF SO, AP301-ACTION-SW WOULD EQUAL 'U', AND SHOULD   09370001
093800*-->         STAY THAT WAY.  THAT WAY, WHEN PF3'ING BACK TO THE   09380001
093900*-->         LIST, "UPD" WILL SHOW UP BESIDE THE UPDATED REC.     09390001
094000             IF AP301-ACTION-SW (ASC-SEL-SUB) > SPACES            09400001
094100                 CONTINUE                                         09410001
094200             ELSE                                                 09420001
094300                 SET AP301-INQ (ASC-SEL-SUB)                      09430001
094400                                       TO TRUE                    09440001
094500                 PERFORM 9200-REWRITE-LIST-QUEUE                  09450001
094600             END-IF                                               09460001
094700         ELSE                                                     09470001
094800             SUBTRACT +1 FROM ASC-SEL-SUB                         09480001
094900*            --- BOTTOM OF LIST ---                               09490001
095000             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            09500001
095100             SET DP020-MSG-INFORMATIONAL                          09510001
095200                                   TO TRUE                        09520001
095300         END-IF                                                   09530001
095400     ELSE                                                         09540001
095500         SUBTRACT +1 FROM ASC-SEL-ITEM                            09550001
095600         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 09560001
095700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            09570001
095800         SET DP020-MSG-INFORMATIONAL                              09580001
095900                                   TO TRUE                        09590001
096000     END-IF.                                                      09600001
096100                                                                  09610001
096210*--------------------------------------------------------------*  09621044
096220* GET THE PREVIOUS RECORD IN THE LIST                          *  09622044
096230*--------------------------------------------------------------*  09623044
096300 2120-GET-PREV-RECORD.                                            09630001
096400                                                                  09640001
096500     SUBTRACT +1 FROM ASC-SEL-SUB.                                09650001
096600     IF  ASC-SEL-SUB < +1                                         09660001
096700         SUBTRACT +1 FROM ASC-SEL-ITEM                            09670001
096800         MOVE AP301-MAX-ITEMS      TO ASC-SEL-SUB                 09680001
096900     END-IF.                                                      09690001
097000                                                                  09700001
097100     IF  ASC-SEL-ITEM > ZERO                                      09710001
097200         PERFORM 9100-READ-SEL-QUEUE                              09720001
097300         MOVE AP301-PO-LNE-NBR       (ASC-SEL-SUB)                09730001
097400                               TO ASC-KEY-PO-LNE-NBR              09740001
097500         MOVE AP301-PAYT-REQ-LNE-NBR (ASC-SEL-SUB)                09750001
097600                               TO ASC-KEY-PAYT-REQ-LNE-NBR        09760001
097700     ELSE                                                         09770001
097800         MOVE +1                   TO ASC-SEL-ITEM                09780001
097900                                      ASC-SEL-SUB                 09790001
098000*        --- TOP OF LIST ---                                      09800001
098100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09810001
098200         SET DP020-MSG-INFORMATIONAL                              09820001
098300                                   TO TRUE                        09830001
098400     END-IF.                                                      09840001
098500                                                                  09850001
098700*--------------------------------------------------------------*  09870044
098800* MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    *  09880044
098900* SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. *  09890044
099000*--------------------------------------------------------------*  09900044
099100 2200-MOVE-SCREEN-TO-COMMAREA.                                    09910001
099200                                                                  09920001
099300     IF  APOLNEL  > ZERO                                          09930001
099400         MOVE APOLNEI              TO ASC-ALP-PO-LNE-NBR          09940001
099500     ELSE                                                         09950001
099600         IF  APOLNEF  = DP015-ERASE-EOF                           09960001
099700             MOVE SPACE            TO ASC-ALP-PO-LNE-NBR          09970001
099800         END-IF                                                   09980001
099900     END-IF.                                                      09990001
100000                                                                  10000001
100100     IF  ANBRPCSL > ZERO                                          10010001
100200         MOVE ANBRPCSI             TO ASC-ALP-PAY-REQ-LNE-QTY     10020001
100300     ELSE                                                         10030001
100400         IF  ANBRPCSF = DP015-ERASE-EOF                           10040001
100500             MOVE SPACE            TO ASC-ALP-PAY-REQ-LNE-QTY     10050001
100600         END-IF                                                   10060001
100700     END-IF.                                                      10070001
100800                                                                  10080001
100900     IF  AUOML    > ZERO                                          10090001
101000         MOVE AUOMI                TO ASC-NEW-QTY-UNT-OF-MSMT     10100001
101100     ELSE                                                         10110001
101200         IF  AUOMF    = DP015-ERASE-EOF                           10120001
101300             MOVE SPACE            TO ASC-NEW-QTY-UNT-OF-MSMT     10130001
101400         END-IF                                                   10140001
101500     END-IF.                                                      10150001
101600                                                                  10160001
101700     IF  AUNTCSTL > ZERO                                          10170001
101800         MOVE AUNTCSTI             TO ASC-ALP-UNT-COST-AMT        10180001
101900     ELSE                                                         10190001
102000         IF  AUNTCSTF = DP015-ERASE-EOF                           10200001
102100             MOVE SPACE            TO ASC-ALP-UNT-COST-AMT        10210001
102200         END-IF                                                   10220001
102300     END-IF.                                                      10230001
102400                                                                  10240001
102600*--------------------------------------------------------------*  10260044
102700* PERFORM EDITS ON EACH FIELD ENTERED BY THE USER.  IF AN ERROR*  10270044
102800* IS FOUND, THE CURSOR IS POSITIONED AT THAT FIELD AND AN      *  10280044
102900* APPROPRIATE ERROR MESSAGE IS DISPLAYED.                      *  10290044
103000*--------------------------------------------------------------*  10300044
103100 3000-EDIT-DATA-IN-COMMAREA.                                      10310001
103200                                                                  10320001
103300     PERFORM 3200-RESET-ATTRIBUTES.                               10330001
103310                                                                  10331039
103400* ALL COMMENTED CODE IS RELATED TO WR30974                        10340039
103500     IF ASC-UPDATE-PENDING                                        10350001
103600*        IF ASC-ENTR-MTHD-CDE = 'ED'                              10360023
103610            PERFORM 3010-EDIT-PO-LNE-NBR                          10361024
103700*           PERFORM 3020-EDIT-PAY-REQ-LNE-QTY                     10370039
103800*           PERFORM 3030-EDIT-UOM                                 10380039
103900*           PERFORM 3040-EDIT-UNT-COST-AMT                        10390039
104000*        END-IF                                                   10400023
104100*        IF ASC-ENTR-MTHD-CDE = 'ED'                              10410023
104200*        OR ASC-INVC-TYP-CDE  = 'RI'                              10420023
104300*            PERFORM 3010-EDIT-PO-LNE-NBR                         10430023
104310*            PERFORM 3020-EDIT-PAY-REQ-LNE-QTY                    10431022
104320*            PERFORM 3030-EDIT-UOM                                10432022
104330*            PERFORM 3040-EDIT-UNT-COST-AMT                       10433022
104400*        ELSE                                                     10440023
104500*            PERFORM 3020-EDIT-PAY-REQ-LNE-QTY                    10450023
104600*            PERFORM 3030-EDIT-UOM                                10460023
104700*            PERFORM 3040-EDIT-UNT-COST-AMT                       10470024
104800*        END-IF                                                   10480025
104900         SET DP030-SET-CURSOR-APPL-1   TO TRUE                    10490001
105000         IF PS-NO-ERROR                                           10500001
105100             MOVE -1                   TO ANBRPCSL                10510001
105200         END-IF                                                   10520001
105300     END-IF.                                                      10530001
105400                                                                  10540001
105410*--------------------------------------------------------------*  10541044
105420* EDIT THE PO LINE NUMBER                                      *  10542044
105450*--------------------------------------------------------------*  10545044
105500 3010-EDIT-PO-LNE-NBR.                                            10550001
105600                                                                  10560001
105700     IF ASC-ALP-PO-LNE-NBR = SPACES OR '****'                     10570001
105800         MOVE +0                   TO ASC-NEW-PO-LNE-NBR          10580001
105900         SET DP020-MSG-FATAL       TO TRUE                        10590001
106000*        -- MUST EXIST --                                         10600001
106100         MOVE DP015-UNP-ALP-BRT-OFF                               10610001
106200                                   TO APOLNEA                     10620001
106300         MOVE DP015-RED            TO APOLNEC                     10630001
106400         MOVE DP015-REVERSE        TO APOLNEH                     10640001
106500         MOVE -1                   TO APOLNEL                     10650001
106600         IF PS-NO-ERROR                                           10660001
106700             MOVE PC-TSYMSG-00007  TO DP020-MSG-NUMBER            10670001
106800         END-IF                                                   10680001
106900         SET PS-ERROR              TO TRUE                        10690001
107000     ELSE                                                         10700001
107100         MOVE ASC-ALP-PO-LNE-NBR  TO DP010I-UNEDITED-FIELD        10710001
107200         MOVE 4                   TO DP010I-MAXIMUM-DIGITS        10720001
107300         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      10730001
107400         SET  DP010I-NEGATIVE-NOT-ALLOWED                         10740001
107500                                  TO TRUE                         10750001
107620         CALL DP010I-NUMERIC-EDIT-ROUTINE                         10762052
107630                         USING DP010I-NUMERIC-EDIT-AREA           10763052
107700         IF DP010I-ERROR-DETECTED                                 10770001
107800             SET DP020-MSG-FATAL  TO TRUE                         10780001
107900*            -- MUST BE NUMERIC --                                10790001
108000             MOVE DP015-UNP-ALP-BRT-OFF                           10800001
108100                                  TO APOLNEA                      10810001
108200             MOVE DP015-RED       TO APOLNEC                      10820001
108300             MOVE DP015-REVERSE   TO APOLNEH                      10830001
108400             MOVE -1                  TO APOLNEL                  10840001
108500             IF PS-NO-ERROR                                       10850001
108600                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         10860001
108700             END-IF                                               10870001
108800             SET PS-ERROR         TO TRUE                         10880001
108900         ELSE                                                     10890001
109000             MOVE DP010I-NUMERIC-FIELD TO ASC-NEW-PO-LNE-NBR      10900001
109100                                          ASC-ALP-PO-LNE-NBR-NUM  10910001
109200             PERFORM 3012-VALIDATE-PO-LNE-NBR                     10920001
109300         END-IF                                                   10930001
109400     END-IF.                                                      10940001
109500                                                                  10950001
109510*--------------------------------------------------------------*  10951044
109520* VALIDATE THE PO LINE NUMBER                                  *  10952044
109530*--------------------------------------------------------------*  10953044
109600 3012-VALIDATE-PO-LNE-NBR.                                        10960001
109700                                                                  10970001
109800     IF ASC-NEW-PO-LNE-NBR NOT = ASC-PREV-PO-LNE-NBR              10980001
109900*-->     ** THE PO_LNE_NBR CHANGED                                10990001
110000         IF ASC-NEW-PO-LNE-NBR =                                  11000001
110100            ASC-OLD-PO-LNE-NBR                                    11010001
110200*-->         ** RESTORE THE SKU FIELDS TO THEIR ORIGINAL VALUE    11020001
110300*            MOVE ASC-OLD-SKU-FIELDS TO ASC-NEW-SKU-FIELDS        11030003
110400             NEXT SENTENCE                                        11040005
110500         ELSE                                                     11050001
110600             MOVE ASC-KEY-PO-NBR             TO                   11060001
110700                  DK-PO-NBR                                       11070001
110800             MOVE ASC-KEY-PAYT-REQ-SEQ-NBR   TO                   11080001
110900                  DK-PAYT-REQ-SEQ-NBR                             11090001
111000             MOVE ASC-KEY-PAYT-REQ-LNE-NBR  TO                    11100001
111100                  DK-PAYT-REQ-LNE-NBR                             11110001
111200             MOVE ASC-NEW-PO-LNE-NBR        TO                    11120001
111300                  DK-APP-PO-LNE-NBR                               11130001
111400             PERFORM 3015-GET-DATA-FROM-TPURITM                   11140001
111500             IF PURITM-FOUND                                      11150005
111600*                PERFORM 4060-GET-UPC-INFO                        11160005
111700                 NEXT SENTENCE                                    11170005
111800             ELSE                                                 11180001
111900                 SET DP020-MSG-FATAL       TO TRUE                11190001
112000*                -- THE PO_LNE_NBR DOES NOT EXIST --              11200001
112100                 MOVE DP015-UNP-ALP-BRT-OFF                       11210001
112200                                      TO APOLNEA                  11220001
112300                 MOVE DP015-RED           TO APOLNEC              11230001
112400                 MOVE DP015-REVERSE       TO APOLNEH              11240001
112500                 MOVE -1                  TO APOLNEL              11250001
112600                 IF PS-NO-ERROR                                   11260001
112700                     MOVE PC-TSYMSG-00913                         11270001
112800                                      TO DP020-MSG-NUMBER         11280001
112900                 END-IF                                           11290001
113000                 SET PS-ERROR             TO TRUE                 11300001
113100             END-IF                                               11310001
113200         END-IF                                                   11320001
113300     END-IF.                                                      11330001
113400                                                                  11340001
113410*--------------------------------------------------------------*  11341044
113420* OBTAIN DATA FROM TPURITM TABLE                               *  11342044
113430*--------------------------------------------------------------*  11343044
113500 3015-GET-DATA-FROM-TPURITM.                                      11350001
113600                                                                  11360001
113700     INITIALIZE DCLTPURITM                                        11370001
113800     SET PURITM-NOT-FOUND        TO TRUE                          11380001
113900                                                                  11390001
114000     PERFORM                                                      11400001
114100         WITH TEST AFTER                                          11410001
114200         VARYING PV-RETRY-COUNTER                                 11420001
114300         FROM 1 BY 1                                              11430001
114400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               11440001
114500            OR (SQLCODE = +0)                                     11450001
114600            OR (SQLCODE = +100))                                  11460001
114700                                                                  11470001
114800         EXEC SQL                                                 11480001
114900            SELECT VEND_STYL_NAME                                 11490001
115000                  ,COLOR_CDE                                      11500001
115100                  ,COLOR_DESC                                     11510001
115200                  ,SIZE_CDE                                       11520001
115300                  ,SIZE_DESC                                      11530001
115400                  ,SKU_DESC                                       11540001
115500                  ,CL_NBR                                         11550001
115600                  ,SKU_SEQ_NBR                                    11560001
115700                  ,PO_LNE_NBR                                     11570001
115800            INTO  :PURITM-VEND-STYL-NAME                          11580001
115900                 ,:PURITM-COLOR-CDE                               11590001
116000                 ,:PURITM-COLOR-DESC                              11600001
116100                 ,:PURITM-SIZE-CDE                                11610001
116200                 ,:PURITM-SIZE-DESC                               11620001
116300                 ,:PURITM-SKU-DESC                                11630001
116400                 ,:PURITM-CL-NBR                                  11640001
116500                 ,:PURITM-SKU-SEQ-NBR                             11650001
116600                 ,:PURITM-PO-LNE-NBR                              11660001
116700           FROM   TPURITM                                         11670001
116800          WHERE   PO_NBR             = :DK-PO-NBR                 11680001
116900            AND   APP_PO_LNE_NBR     = :DK-APP-PO-LNE-NBR         11690001
117000            AND   VER_STATUS_CDE     = 'A'                        11700001
117100         END-EXEC                                                 11710001
117200                                                                  11720001
117300         EVALUATE TRUE                                            11730001
117400             WHEN SQLCODE = +0                                    11740001
117500                 SET PURITM-FOUND        TO TRUE                  11750001
117600                 MOVE PURITM-PO-LNE-NBR TO                        11760001
117700                       PV-NEW-KEY-PO-LNE-NBR                      11770001
117800             WHEN SQLCODE = -904                                  11780001
117900             WHEN SQLCODE = -913                                  11790001
118000             WHEN SQLCODE = +100                                  11800001
118100                 CONTINUE                                         11810001
118200             WHEN SQLWARN0 NOT = SPACES                           11820001
118300             WHEN SQLCODE < ZERO                                  11830001
118400             WHEN SQLCODE > ZERO                                  11840001
118500                 MOVE '3015-...'                                  11850001
118600                                   TO DP013-PARAGRAPH             11860001
118700                 MOVE 'SELECT ON TPURITM'                         11870001
118800                                   TO DP013-MESSAGE-TEXT (1)      11880001
118900                 MOVE SQLCA        TO DP013-SQLCA                 11890001
119000                 MOVE 'TPURITM'    TO DP013-DB2-TABLE-NAME (1)    11900001
119100                 SET DP013-DB2-ABEND                              11910001
119200                     DP013-XCTL-DISPLAY-RESTART                   11920001
119300                                   TO TRUE                        11930001
119400                 PERFORM DP013-0000-PROCESS-ABEND                 11940001
119500         END-EVALUATE                                             11950001
119600     END-PERFORM.                                                 11960001
119700                                                                  11970001
119800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        11980001
119900         MOVE '3015-...'                                          11990001
120000                                   TO DP013-PARAGRAPH             12000001
120100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     12010001
120200                                   TO DP013-MESSAGE-TEXT (1)      12020001
120300         MOVE SQLCA                TO DP013-SQLCA                 12030001
120400         MOVE 'TPURITM'            TO DP013-DB2-TABLE-NAME (1)    12040001
120500         SET DP013-DB2-ABEND                                      12050001
120600             DP013-XCTL-DISPLAY-RESTART                           12060001
120700                                   TO TRUE                        12070001
120800         PERFORM DP013-0000-PROCESS-ABEND                         12080001
120900     END-IF.                                                      12090001
121000                                                                  12100044
121010*--------------------------------------------------------------*  12101044
121020* EDIT THE LINE QUANTITY                                       *  12102044
121030*--------------------------------------------------------------*  12103044
121100 3020-EDIT-PAY-REQ-LNE-QTY.                                       12110001
121200                                                                  12120001
121300     IF  ASC-ALP-PAY-REQ-LNE-QTY > SPACES                         12130001
121400         MOVE ASC-ALP-PAY-REQ-LNE-QTY TO DP010I-UNEDITED-FIELD    12140001
121500         MOVE 7                       TO DP010I-MAXIMUM-DIGITS    12150001
121600         MOVE 0                       TO DP010I-MAXIMUM-DECIMALS  12160001
121700         SET  DP010I-NEGATIVE-NOT-ALLOWED                         12170001
121800                                  TO TRUE                         12180001
121920         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12192052
121930                         USING DP010I-NUMERIC-EDIT-AREA           12193052
122000         IF DP010I-ERROR-DETECTED                                 12200001
122100             SET DP020-MSG-FATAL  TO TRUE                         12210001
122200*            --  MUST BE NUMERIC --                               12220001
122300             MOVE DP015-UNP-ALP-BRT-OFF                           12230001
122400                                  TO ANBRPCSA                     12240001
122500             MOVE DP015-RED       TO ANBRPCSC                     12250001
122600             MOVE DP015-REVERSE   TO ANBRPCSH                     12260001
122700             MOVE -1                  TO ANBRPCSL                 12270001
122800             IF PS-NO-ERROR                                       12280001
122900                 MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER         12290001
123000             END-IF                                               12300001
123100             SET PS-ERROR         TO TRUE                         12310001
123200         ELSE                                                     12320001
123300             MOVE DP010I-NUMERIC-FIELD                            12330001
123400                                  TO ASC-NEW-PAY-REQ-LNE-QTY      12340001
123500                                     ASC-ALP-PAY-REQ-LNE-QTY-NUM  12350001
123600             IF ASC-NEW-PAY-REQ-LNE-QTY = +0                      12360001
123700                 SET DP020-MSG-FATAL  TO TRUE                     12370001
123800*                --  CANNOT BE ZERO  --                           12380001
123900                 MOVE DP015-UNP-ALP-BRT-OFF                       12390001
124000                                      TO ANBRPCSA                 12400001
124100                 MOVE DP015-RED       TO ANBRPCSC                 12410001
124200                 MOVE DP015-REVERSE   TO ANBRPCSH                 12420001
124300                 MOVE -1              TO ANBRPCSL                 12430001
124400                 IF PS-NO-ERROR                                   12440001
124500                     MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER     12450001
124600                 END-IF                                           12460001
124700                 SET PS-ERROR         TO TRUE                     12470001
124800             END-IF                                               12480001
124900         END-IF                                                   12490001
125000     ELSE                                                         12500001
125100         SET DP020-MSG-FATAL  TO TRUE                             12510001
125200*        --  REQUIRED ENTRY  --                                   12520001
125300         MOVE DP015-UNP-ALP-BRT-OFF                               12530001
125400                              TO ANBRPCSA                         12540001
125500         MOVE DP015-RED       TO ANBRPCSC                         12550001
125600         MOVE DP015-REVERSE   TO ANBRPCSH                         12560001
125700         MOVE -1              TO ANBRPCSL                         12570001
125800         IF PS-NO-ERROR                                           12580001
125900             MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER             12590001
126000         END-IF                                                   12600001
126100         SET PS-ERROR         TO TRUE                             12610001
126200     END-IF.                                                      12620001
126300                                                                  12630001
126310*--------------------------------------------------------------*  12631044
126320* EDIT THE UNIT OF MEASURE                                     *  12632044
126330*--------------------------------------------------------------*  12633044
126400 3030-EDIT-UOM.                                                   12640001
126500                                                                  12650001
126600     EVALUATE ASC-NEW-QTY-UNT-OF-MSMT                             12660001
126700         WHEN 'AS'                                                12670010
126800         WHEN 'EA'                                                12680010
126900         WHEN 'PK'                                                12690001
127000         WHEN 'PR'                                                12700001
127100         WHEN 'ST'                                                12710001
127200             CONTINUE                                             12720001
127300         WHEN OTHER                                               12730001
127400             SET DP020-MSG-FATAL  TO TRUE                         12740001
127500*            --  INVALID VALUE   --                               12750001
127600             MOVE DP015-UNP-ALP-BRT-OFF                           12760001
127700                                  TO AUOMA                        12770001
127800             MOVE DP015-RED       TO AUOMC                        12780001
127900             MOVE DP015-REVERSE   TO AUOMH                        12790001
128000             MOVE -1              TO AUOML                        12800001
128100             IF PS-NO-ERROR                                       12810001
128200                 MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER         12820001
128300             END-IF                                               12830001
128400             SET PS-ERROR         TO TRUE                         12840001
128500     END-EVALUATE.                                                12850001
128600                                                                  12860001
128610*--------------------------------------------------------------*  12861044
128620* EDIT THE UNIT COST AMOUNT                                    *  12862044
128630*--------------------------------------------------------------*  12863044
128700 3040-EDIT-UNT-COST-AMT.                                          12870001
128800                                                                  12880001
128900     IF  ASC-ALP-UNT-COST-AMT = 'NC'                              12890001
129000         MOVE 0                    TO ASC-NEW-UNT-COST-AMT        12900001
129100     ELSE                                                         12910001
129200         IF ASC-ALP-UNT-COST-AMT = SPACES                         12920001
129300             SET DP020-MSG-FATAL  TO TRUE                         12930001
129400*            --  REQUIRED ENTRY  --                               12940001
129500             MOVE DP015-UNP-ALP-BRT-OFF                           12950001
129600                                  TO AUNTCSTA                     12960001
129700             MOVE DP015-RED       TO AUNTCSTC                     12970001
129800             MOVE DP015-REVERSE   TO AUNTCSTH                     12980001
129900             MOVE -1              TO AUNTCSTL                     12990001
130000             IF PS-NO-ERROR                                       13000001
130100                 MOVE PC-TSYMSG-00007 TO DP020-MSG-NUMBER         13010001
130200             END-IF                                               13020001
130300             SET PS-ERROR         TO TRUE                         13030001
130400         ELSE                                                     13040001
130500             MOVE ASC-ALP-UNT-COST-AMT TO DP010I-UNEDITED-FIELD   13050001
130600             MOVE 6                    TO DP010I-MAXIMUM-DIGITS   13060001
130700             MOVE 3                    TO DP010I-MAXIMUM-DECIMALS 13070001
130800             SET  DP010I-NEGATIVE-NOT-ALLOWED                     13080001
130900                                      TO TRUE                     13090001
131020         CALL DP010I-NUMERIC-EDIT-ROUTINE                         13102052
131030                         USING DP010I-NUMERIC-EDIT-AREA           13103052
131100             IF DP010I-ERROR-DETECTED                             13110001
131200                 SET DP020-MSG-FATAL  TO TRUE                     13120001
131300*                -- MUST BE NUMERIC --                            13130001
131400                 MOVE DP015-UNP-ALP-BRT-OFF                       13140001
131500                                      TO AUNTCSTA                 13150001
131600                 MOVE DP015-RED       TO AUNTCSTC                 13160001
131700                 MOVE DP015-REVERSE   TO AUNTCSTH                 13170001
131800                 MOVE -1              TO AUNTCSTL                 13180001
131900                 IF PS-NO-ERROR                                   13190001
132000                     MOVE PC-TSYMSG-00008 TO DP020-MSG-NUMBER     13200001
132100                 END-IF                                           13210001
132200                 SET PS-ERROR         TO TRUE                     13220001
132300             ELSE                                                 13230001
132400                 MOVE DP010I-NUMERIC-FIELD                        13240001
132500                                      TO ASC-NEW-UNT-COST-AMT     13250001
132600                                         ASC-ALP-UNT-COST-AMT-NUM 13260001
132700             END-IF                                               13270001
132800         END-IF                                                   13280001
132900     END-IF.                                                      13290001
133000                                                                  13300001
133200*--------------------------------------------------------------*  13320044
133300* MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON *  13330044
133400* MAP.                                                         *  13340044
133500*--------------------------------------------------------------*  13350044
133600 3200-RESET-ATTRIBUTES.                                           13360001
133700                                                                  13370001
133710** ALL COMMENTED CODE IS RELATED TO WR30974                       13371039
133800     IF ASC-UPDATE-PENDING                                        13380001
133900*        IF ASC-ENTR-MTHD-CDE = 'MN'                              13390031
134000*        AND ASC-INVC-TYP-CDE = 'MI'                              13400031
134100*            PERFORM 3222-PROTECT-PO-LNE-NBR                      13410018
134110             PERFORM 3210-UNPROTECT-PO-LNE-NBR                    13411018
134120             PERFORM 3224-PROTECT-TPREQIT-FIELDS                  13412035
134200*            PERFORM 3215-UNPROTECT-TPREQIT-FIELDS                13420034
134210             MOVE -1               TO APOLNEL                     13421030
134300*        ELSE                                                     13430031
134400*            PERFORM 3220-PROTECT-ALL-FIELDS                      13440017
134500*            IF ASC-ENTR-MTHD-CDE = 'ED'                          13450031
134600*            OR ASC-INVC-TYP-CDE  = 'RI'                          13460031
134700*                PERFORM 3210-UNPROTECT-PO-LNE-NBR                13470031
134710*                PERFORM 3215-UNPROTECT-TPREQIT-FIELDS            13471031
134800*                MOVE -1           TO APOLNEL                     13480031
134900*            END-IF                                               13490031
135000*            IF ASC-ENTR-MTHD-CDE = 'ED'                          13500015
135100*               PERFORM 3215-UNPROTECT-TPREQIT-FIELDS             13510015
135200*            END-IF                                               13520015
135300*        END-IF                                                   13530031
135400     ELSE                                                         13540001
135500         PERFORM 3220-PROTECT-ALL-FIELDS                          13550001
135600     END-IF.                                                      13560001
135700                                                                  13570001
135710*--------------------------------------------------------------*  13571044
135720* UNPROTECT THE PO LINE NUMBER FOR EDITING                     *  13572044
135740*--------------------------------------------------------------*  13574044
135800 3210-UNPROTECT-PO-LNE-NBR.                                       13580001
135900                                                                  13590001
136000     MOVE DP015-UNP-ALP-NOR-OFF    TO                             13600001
136100           APOLNEA.                                               13610001
136200     MOVE DP015-GREEN              TO                             13620001
136300           APOLNEC.                                               13630001
136400     MOVE DP015-UNDERLINE          TO                             13640001
136500           APOLNEH.                                               13650001
136600                                                                  13660001
136610*--------------------------------------------------------------*  13661044
136620* UNPROTECT THE NUMBER OF PIECES, UNIT OF MEASURE, AND UNIT    *  13662044
136621* COST AMOUNT FOR EDITING                                      *  13662144
136630*--------------------------------------------------------------*  13663044
136700 3215-UNPROTECT-TPREQIT-FIELDS.                                   13670001
136800                                                                  13680001
136900     MOVE DP015-UNP-ALP-NOR-OFF    TO                             13690001
137000          ANBRPCSA                                                13700001
137100             AUOMA                                                13710001
137200          AUNTCSTA                                                13720001
137300     MOVE DP015-GREEN              TO                             13730001
137400          ANBRPCSC                                                13740001
137500             AUOMC                                                13750001
137600          AUNTCSTC                                                13760001
137700     MOVE DP015-UNDERLINE          TO                             13770001
137800          ANBRPCSH                                                13780001
137900             AUOMH                                                13790001
138000          AUNTCSTH.                                               13800001
138100                                                                  13810001
138200*--------------------------------------------------------------*  13820044
138210* PROTECT ALL EDITABLE FIELDS                                  *  13821044
138230*--------------------------------------------------------------*  13823044
138300 3220-PROTECT-ALL-FIELDS.                                         13830001
138400                                                                  13840001
138500     PERFORM 3222-PROTECT-PO-LNE-NBR                              13850001
138600     PERFORM 3224-PROTECT-TPREQIT-FIELDS.                         13860001
138700                                                                  13870001
138710*--------------------------------------------------------------*  13871044
138720* PROTECT THE PO LINE NUMBER FROM EDITING                      *  13872044
138740*--------------------------------------------------------------*  13874044
138800 3222-PROTECT-PO-LNE-NBR.                                         13880001
138900                                                                  13890001
139000     MOVE DP015-PRO-NOR-OFF        TO                             13900001
139100           APOLNEA                                                13910001
139200     MOVE DP015-BLUE               TO                             13920001
139300           APOLNEC                                                13930001
139400     MOVE DP015-HL-OFF             TO                             13940001
139500           APOLNEH.                                               13950001
139600                                                                  13960001
139610*--------------------------------------------------------------*  13961044
139620* PROTECT THE NUMBER OF PIECES, UNIT OF MEASURE, AND UNIT COST *  13962044
139621* AMOUNT FROM EDITING                                          *  13962144
139630*--------------------------------------------------------------*  13963044
139700 3224-PROTECT-TPREQIT-FIELDS.                                     13970001
139800                                                                  13980001
139900     MOVE DP015-PRO-NOR-OFF        TO                             13990001
140000          ANBRPCSA                                                14000001
140100             AUOMA                                                14010001
140200          AUNTCSTA                                                14020001
140300                                                                  14030001
140400     MOVE DP015-BLUE               TO                             14040001
140500          ANBRPCSC                                                14050001
140600             AUOMC                                                14060001
140700          AUNTCSTC                                                14070001
140800                                                                  14080001
140900     MOVE DP015-HL-OFF             TO                             14090001
141000          ANBRPCSH                                                14100001
141100             AUOMH                                                14110001
141200          AUNTCSTH.                                               14120001
141300                                                                  14130001
141500*--------------------------------------------------------------*  14150044
141600* VALIDATE THE QUEUE WAS PASSED AND DISPLAY FOR THE FIRST ENTRY*  14160044
141800*--------------------------------------------------------------*  14180044
142000 3500-SAVE-SCREEN-FIELDS.                                         14200001
142100                                                                  14210001
142200     MOVE ASC-NEWLY-ENTERED-FIELD-VALUES  TO                      14220001
142300          ASC-ORIGINAL-FIELD-VALUES.                              14230001
142400                                                                  14240044
142500*--------------------------------------------------------------*  14250044
142600* CHECK TO SEE IF ANY FIELDS CHANGED.                          *  14260044
142700*--------------------------------------------------------------*  14270044
142900 3600-CHECK-IF-FIELDS-CHANGED.                                    14290001
143000                                                                  14300001
143100     MOVE 'N'                    TO ASC-FIELDS-MODIFIED-SW        14310001
143200                                                                  14320001
143300     IF ASC-NEWLY-ENTERED-FIELD-VALUES  NOT =                     14330001
143400        ASC-ORIGINAL-FIELD-VALUES                                 14340001
143500         SET ASC-FIELDS-MODIFIED TO TRUE                          14350001
143600     END-IF.                                                      14360001
143700                                                                  14370001
143810*--------------------------------------------------------------*  14381044
143820* POSITION THE CURSOR AT THE APPROPRIATE FIELD.  IF THERE IS   *  14382044
143821* ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE IT HERE.     *  14382144
143830*--------------------------------------------------------------*  14383044
143900 4000-BUILD-INITIAL-PANEL.                                        14390001
144000                                                                  14400001
144100     INITIALIZE DCLTINVOIC                                        14410001
144200                DCLTPREQIT                                        14420001
144300                DCLTMIITEM                                        14430001
144400                DK-DB2-KEYS                                       14440001
144500                ASC-ORIGINAL-FIELD-VALUES                         14450001
144600                ASC-NEWLY-ENTERED-FIELD-VALUES                    14460001
144700                ASC-ALPHA-COUNTERPARTS                            14470001
144800                ASC-OTHER-FIELDS                                  14480001
144900                                                                  14490001
145000     EXEC SQL                                                     14500001
145100         SET :ASC-CURRENT-TIMESTAMP = CURRENT TIMESTAMP           14510001
145200     END-EXEC                                                     14520001
145300                                                                  14530001
145400     MOVE ASC-KEY-INVC-ID         TO DK-INVC-ID                   14540001
145500                                                                  14550001
145600     IF ASC-KEY-PO-NBR > +0                                       14560001
145700         MOVE ASC-KEY-PO-NBR      TO DK-PO-NBR-LOW                14570001
145800                                     DK-PO-NBR-HIGH               14580001
145900     ELSE                                                         14590001
146000         MOVE +0                  TO DK-PO-NBR-LOW                14600001
146100         MOVE +999999999          TO DK-PO-NBR-HIGH               14610001
146200     END-IF.                                                      14620001
146300                                                                  14630001
146400     SET PS-NO-ERROR TO TRUE                                      14640001
146500     PERFORM 4010-VALIDATE-INVC-PO-COMBO.                         14650001
146600                                                                  14660001
146700     IF ASC-INVOICE-NOT-FOUND OR                                  14670001
146800        ASC-INVOICE-DUPLICATE                                     14680001
146900         IF ASC-INVOICE-DUPLICATE                                 14690001
147000             IF DK-PO-NBR-LOW = +0                                14700001
147100*                -- PO NBR REQUIRED TO BREAK THE TIE --           14710001
147200                 MOVE PC-TSYMSG-00852 TO DP020-MSG-NUMBER         14720001
147300             ELSE                                                 14730001
147400*                -- SEVERE DATA CORRUPTION - CONTACT DP --        14740001
147500                 MOVE PC-TSYMSG-00858 TO DP020-MSG-NUMBER         14750001
147600             END-IF                                               14760001
147700         ELSE                                                     14770001
147800             MOVE PC-TSYMSG-00855     TO DP020-MSG-NUMBER         14780001
147900         END-IF                                                   14790001
148000         SET DP020-MSG-FATAL                                      14800001
148100             PS-ERROR                                             14810001
148200             DP020-NEXT-ACT-APPL-ERROR                            14820001
148300                                      TO TRUE                     14830001
148400     ELSE                                                         14840001
148500         EVALUATE TRUE                                            14850001
148600            WHEN  INVOIC-INVC-TYP-CDE     = 'WO'                  14860001
148700                IF ASC-DELETE-REQUESTED                           14870001
148800                   MOVE PC-TSYMSG-01518    TO DP020-MSG-NUMBER    14880001
148900                ELSE                                              14890001
149000                   MOVE PC-TSYMSG-01517    TO DP020-MSG-NUMBER    14900001
149100                END-IF                                            14910001
149200                SET PS-ERROR                                      14920001
149300                    DP020-MSG-FATAL                               14930001
149400                    DP020-NEXT-ACT-APPL-ERROR  TO TRUE            14940001
149500                                                                  14950001
149600            WHEN  INVOIC-STATUS-CDE       = 'DE'                  14960001
149700            WHEN  INVOIC-STATUS-CDE       = 'OP'                  14970001
149800            WHEN  INVOIC-STATUS-CDE       = 'PD'                  14980001
149900*           WHEN  INVOIC-STATUS-CDE       = 'PJ'                  14990056
150000            WHEN  INVOIC-STATUS-CDE       = 'RL'                  15000001
150100            WHEN  INVOIC-STATUS-CDE       = 'OB'                  15010001
150200                MOVE PC-TSYMSG-00170       TO DP020-MSG-NUMBER    15020001
150300                IF ASC-DELETE-REQUESTED                           15030001
150400                    SET PS-ERROR                                  15040001
150500                        DP020-MSG-FATAL                           15050001
150600                        DP020-NEXT-ACT-APPL-ERROR                 15060001
150700                                               TO TRUE            15070001
150800                ELSE                                              15080001
150900*                   -- ALLOW THEM TO LOOK, BUT NOT TOUCH --       15090001
151000                    SET ASC-NO-CHANGES-ALLOWED                    15100001
151100                        DP020-MSG-INFORMATIONAL TO TRUE           15110001
151200                END-IF                                            15120001
151300*           WHEN (ASC-DELETE-REQUESTED AND                        15130001
151400*                 INVOIC-ENTR-MTHD-CDE    = 'ED')                 15140001
151500*-->             -- CANNOT DELETE EDI INVOICE ITEM --             15150001
151600*               MOVE PC-TSYMSG-00851       TO DP020-MSG-NUMBER    15160001
151700*               SET PS-ERROR                                      15170001
151800*                   DP020-MSG-FATAL                               15180001
151900*                   DP020-NEXT-ACT-APPL-ERROR                     15190001
152000*                                          TO TRUE                15200001
152100            WHEN (ASC-DELETE-REQUESTED AND                        15210001
152200                  INVOIC-INVC-TYP-CDE     = 'EI')                 15220001
152300*-->             -- CANNOT DELETE EXP INVOICE ITEM --             15230001
152400                MOVE PC-TSYMSG-02699       TO DP020-MSG-NUMBER    15240001
152500                SET PS-ERROR                                      15250001
152600                    DP020-MSG-FATAL                               15260001
152700                    DP020-NEXT-ACT-APPL-ERROR                     15270001
152800                                           TO TRUE                15280001
152900*           WHEN (ASC-DELETE-REQUESTED AND                        15290014
153000*                 INVOIC-INVC-TYP-CDE     = 'RI')                 15300014
153100*-->             -- CANNOT DELETE REM INVOICE ITEM --             15310001
153200*               MOVE PC-TSYMSG-00970       TO DP020-MSG-NUMBER    15320014
153300*               SET PS-ERROR                                      15330014
153400*                   DP020-MSG-FATAL                               15340014
153500*                   DP020-NEXT-ACT-APPL-ERROR                     15350014
153600*                                          TO TRUE                15360014
153700         END-EVALUATE                                             15370001
153800     END-IF.                                                      15380001
153900                                                                  15390001
154000     IF PS-NO-ERROR                                               15400001
154100         MOVE INVOIC-PAYT-REQ-SEQ-NBR   TO                        15410001
154200              DK-PAYT-REQ-SEQ-NBR                                 15420001
154300         MOVE ASC-KEY-PAYT-REQ-LNE-NBR  TO                        15430001
154400              DK-PAYT-REQ-LNE-NBR                                 15440001
154500         MOVE INVOIC-PO-NBR             TO                        15450001
154600              DK-PO-NBR                                           15460001
154700         MOVE ASC-KEY-PO-LNE-NBR        TO                        15470001
154800              DK-PO-LNE-NBR                                       15480001
154900         PERFORM 4020-GET-REST-OF-DATA                            15490001
155000         PERFORM 4200-MOVE-DATABASE-TO-COMMAREA                   15500001
155100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     15510001
155200     END-IF.                                                      15520001
155300                                                                  15530044
155310*--------------------------------------------------------------*  15531044
155320* VALIDATE THE INVOICE/PO COMBINATION                          *  15532044
155340*--------------------------------------------------------------*  15534044
155400 4010-VALIDATE-INVC-PO-COMBO.                                     15540001
155500                                                                  15550001
155600     PERFORM                                                      15560001
155700         WITH TEST AFTER                                          15570001
155800         VARYING PV-RETRY-COUNTER                                 15580001
155900         FROM 1 BY 1                                              15590001
156000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               15600001
156100            OR (SQLCODE = +0)                                     15610001
156200            OR (SQLCODE = +100)                                   15620001
156300            OR (SQLCODE = -811))                                  15630001
156400                                                                  15640001
156500**       ***   THE "VALUE" FUNCTION REPLACES NULL VALUES WITH     15650001
156600**       ***   WHATEVER VALUE IS SPECIFIED.  IN THIS CASE,        15660001
156700**       ***   ALL NULL PO_NBR'S  WILL BE TREATED AS IF THEIR     15670001
156800**       ***   PO_NBR'S WERE ZERO, AND WOULD NOT BE RETURNED      15680001
156900**       ***   IF AN ACTUAL ASC-KEY-PO-NBR WAS SPECIFIED, BUT     15690001
157000**       ***   WOULD BE RETURNED IF NO ASC-KEY-PO-NBR WAS         15700001
157100**       ***   SUPPLIED.                                          15710001
157200                                                                  15720001
157300         EXEC SQL                                                 15730001
157400           SELECT  PAYT_REQ_SEQ_NBR                               15740001
157500                  ,INVC_ID                                        15750001
157600                  ,INVC_TYP_CDE                                   15760001
157700                  ,STATUS_CDE                                     15770001
157800                  ,ENTR_MTHD_CDE                                  15780001
157900                  ,DTL_ENTR_IND                                   15790001
158000                  ,RMIT_VND_ID                                    15800001
158100                  ,VALUE(PO_NBR,+0)                               15810001
158200            INTO   :INVOIC-PAYT-REQ-SEQ-NBR                       15820001
158300                  ,:INVOIC-INVC-ID                                15830001
158400                  ,:INVOIC-INVC-TYP-CDE                           15840001
158500                  ,:INVOIC-STATUS-CDE                             15850001
158600                  ,:INVOIC-ENTR-MTHD-CDE                          15860001
158700                  ,:INVOIC-DTL-ENTR-IND                           15870001
158800                  ,:INVOIC-RMIT-VND-ID                            15880001
158900                  ,:INVOIC-PO-NBR                                 15890001
159000             FROM   TINVOIC                                       15900001
159100            WHERE   INVC_ID                = :DK-INVC-ID          15910001
159200              AND   PO_NBR                 IS NOT NULL            15920001
159300              AND   PO_NBR           BETWEEN :DK-PO-NBR-LOW       15930001
159400                                         AND :DK-PO-NBR-HIGH      15940001
159500         END-EXEC                                                 15950001
159600                                                                  15960001
159700         EVALUATE TRUE                                            15970001
159800             WHEN SQLCODE = +0                                    15980001
159900                 SET ASC-INVOICE-FOUND         TO TRUE            15990001
160000             WHEN SQLCODE = -904                                  16000001
160100             WHEN SQLCODE = -913                                  16010001
160200                 CONTINUE                                         16020001
160300             WHEN SQLCODE = -811                                  16030001
160400                                                                  16040001
160500                 SET ASC-INVOICE-DUPLICATE     TO TRUE            16050001
160600                                                                  16060001
160700             WHEN SQLCODE = +100                                  16070001
160800                                                                  16080001
160900                 SET ASC-INVOICE-NOT-FOUND     TO TRUE            16090001
161000                                                                  16100001
161100             WHEN SQLWARN0 NOT = SPACES                           16110001
161200             WHEN SQLCODE < ZERO                                  16120001
161300             WHEN SQLCODE > ZERO                                  16130001
161400                 MOVE '4010-SELECT-TINVOIC'                       16140001
161500                                   TO DP013-PARAGRAPH             16150001
161600                 MOVE 'SELECT ON TINVOIC        '                 16160001
161700                                   TO DP013-MESSAGE-TEXT (1)      16170001
161800                 MOVE SQLCA        TO DP013-SQLCA                 16180001
161900                 MOVE 'TINVOIC'    TO DP013-DB2-TABLE-NAME (1)    16190001
162000                 MOVE SPACE        TO DP013-DB2-TABLE-NAME (2)    16200001
162100                 SET DP013-DB2-ABEND                              16210001
162200                     DP013-XCTL-DISPLAY-RESTART                   16220001
162300                                   TO TRUE                        16230001
162400                 PERFORM DP013-0000-PROCESS-ABEND                 16240001
162500         END-EVALUATE                                             16250001
162600     END-PERFORM.                                                 16260001
162700                                                                  16270001
162800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        16280001
162900         MOVE '4010-SELECT-TINVOIC'                               16290001
163000                                   TO DP013-PARAGRAPH             16300001
163100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     16310001
163200                                   TO DP013-MESSAGE-TEXT (1)      16320001
163300         MOVE SQLCA                TO DP013-SQLCA                 16330001
163400         MOVE 'TINVOIC'            TO DP013-DB2-TABLE-NAME (1)    16340001
163500         MOVE SPACE                TO DP013-DB2-TABLE-NAME (2)    16350001
163600         SET DP013-DB2-ABEND                                      16360001
163700             DP013-XCTL-DISPLAY-RESTART                           16370001
163800                                   TO TRUE                        16380001
163900         PERFORM DP013-0000-PROCESS-ABEND                         16390001
164000     END-IF.                                                      16400001
164100                                                                  16410044
164110*--------------------------------------------------------------*  16411044
164120* OBTAIN DATA FROM THE TPREQIT AND TMIITEM TABLES              *  16412044
164130*--------------------------------------------------------------*  16413044
164200 4020-GET-REST-OF-DATA.                                           16420001
164300                                                                  16430001
164400     PERFORM 4030-VALIDATE-TPREQIT-TMIITEM.                       16440001
164500                                                                  16450001
164600     IF SQLCODE = +0                                              16460001
164700         IF ASC-KEY-PO-LNE-NBR = +0                               16470001
164800             MOVE ZERO TO PV-APP-PO-LNE-NBR                       16480001
164900         ELSE                                                     16490001
165000             PERFORM 4050-GET-DATA-FROM-TPURITM                   16500001
165100             IF PURITM-FOUND                                      16510001
165200                NEXT SENTENCE                                     16520005
165300             END-IF                                               16530001
165400         END-IF                                                   16540001
165500     ELSE                                                         16550001
165600*-->     -- DATA GOT BLOWN AWAY BY SOMEONE ELSE --                16560001
165700         MOVE PC-TSYMSG-00134   TO DP020-MSG-NUMBER               16570001
165800         SET PS-ERROR                                             16580001
165900             DP020-NEXT-ACT-APPL-ERROR                            16590001
166000                                TO TRUE                           16600001
166100     END-IF.                                                      16610001
166200                                                                  16620044
166210*--------------------------------------------------------------*  16621044
166220* OBTAIN DATA FROM THE TPREQIT AND TMIITEM TABLES              *  16622044
166230*--------------------------------------------------------------*  16623044
166300 4030-VALIDATE-TPREQIT-TMIITEM.                                   16630001
166400                                                                  16640001
166500     PERFORM                                                      16650001
166600         WITH TEST AFTER                                          16660001
166700         VARYING PV-RETRY-COUNTER                                 16670001
166800         FROM 1 BY 1                                              16680001
166900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16690001
167000            OR (SQLCODE = +0)                                     16700001
167100            OR (SQLCODE = +100))                                  16710001
167200                                                                  16720001
167300**       ***   THE "VALUE" FUNCTION REPLACES NULL VALUES WITH     16730001
167400**       ***   WHATEVER VALUE IS SPECIFIED.  IN THIS CASE, NULL   16740001
167500**       ***   PO_LNE_NBR'S ARE TREATED AS THOUGH THEY EQUAL +0.  16750001
167600                                                                  16760001
167700         EXEC SQL                                                 16770001
167800           SELECT  A.PAYT_REQ_LNE_NBR                             16780001
167900                  ,A.PAY_REQ_LNE_QTY                              16790001
168000                  ,A.QTY_UNT_OF_MSMT                              16800001
168100                  ,A.UNT_COST_AMT                                 16810001
168200                  ,B.UNT_COST_SEL_CDE                             16820001
168300           INTO   :PREQIT-PAYT-REQ-LNE-NBR                        16830001
168400                 ,:PREQIT-PAY-REQ-LNE-QTY                         16840001
168500                 ,:PREQIT-QTY-UNT-OF-MSMT                         16850001
168600                 ,:PREQIT-UNT-COST-AMT                            16860001
168700                 ,:MIITEM-UNT-COST-SEL-CDE                        16870001
168800           FROM   TPREQIT A                                       16880001
168900                 ,TMIITEM B                                       16890001
169000          WHERE   A.PAYT_REQ_SEQ_NBR   = :DK-PAYT-REQ-SEQ-NBR     16900001
169100            AND   B.PAYT_REQ_SEQ_NBR   = :DK-PAYT-REQ-SEQ-NBR     16910001
169200            AND   A.PAYT_REQ_LNE_NBR   = :DK-PAYT-REQ-LNE-NBR     16920001
169300            AND   B.PAYT_REQ_LNE_NBR   = :DK-PAYT-REQ-LNE-NBR     16930001
169400         END-EXEC                                                 16940001
169500                                                                  16950001
169600         EVALUATE TRUE                                            16960001
169700             WHEN SQLCODE = +0                                    16970001
169800             WHEN SQLCODE = -904                                  16980001
169900             WHEN SQLCODE = -913                                  16990001
170000             WHEN SQLCODE = +100                                  17000001
170100                 CONTINUE                                         17010001
170200             WHEN SQLWARN0 NOT = SPACES                           17020001
170300             WHEN SQLCODE < ZERO                                  17030001
170400             WHEN SQLCODE > ZERO                                  17040001
170500                 MOVE '4030-...'                                  17050001
170600                                   TO DP013-PARAGRAPH             17060001
170700                 MOVE 'SELECT ON TPREQIT/TMIITEM'                 17070001
170800                                   TO DP013-MESSAGE-TEXT (1)      17080001
170900                 MOVE SQLCA        TO DP013-SQLCA                 17090001
171000                 MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)    17100001
171100                 MOVE 'TMIITEM'    TO DP013-DB2-TABLE-NAME (2)    17110001
171200                 SET DP013-DB2-ABEND                              17120001
171300                     DP013-XCTL-DISPLAY-RESTART                   17130001
171400                                   TO TRUE                        17140001
171500                 PERFORM DP013-0000-PROCESS-ABEND                 17150001
171600         END-EVALUATE                                             17160001
171700     END-PERFORM.                                                 17170001
171800                                                                  17180001
171900     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17190001
172000         MOVE '4030-...'                                          17200001
172100                                   TO DP013-PARAGRAPH             17210001
172200         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     17220001
172300                                   TO DP013-MESSAGE-TEXT (1)      17230001
172400         MOVE SQLCA                TO DP013-SQLCA                 17240001
172500         MOVE 'TPREQIT'            TO DP013-DB2-TABLE-NAME (1)    17250001
172600         MOVE 'TMIITEM'            TO DP013-DB2-TABLE-NAME (2)    17260001
172700         SET DP013-DB2-ABEND                                      17270001
172800             DP013-XCTL-DISPLAY-RESTART                           17280001
172900                                   TO TRUE                        17290001
173000         PERFORM DP013-0000-PROCESS-ABEND                         17300001
173100     END-IF.                                                      17310001
173200                                                                  17320044
173210*--------------------------------------------------------------*  17321044
173220* OBTAIN DATA FROM THE TPURITM TABLE                           *  17322044
173230*--------------------------------------------------------------*  17323044
173300 4050-GET-DATA-FROM-TPURITM.                                      17330001
173400                                                                  17340001
173500     INITIALIZE DCLTPURITM                                        17350001
173600     SET PURITM-NOT-FOUND        TO TRUE                          17360001
173700                                                                  17370001
173800     PERFORM                                                      17380001
173900         WITH TEST AFTER                                          17390001
174000         VARYING PV-RETRY-COUNTER                                 17400001
174100         FROM 1 BY 1                                              17410001
174200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17420001
174300            OR (SQLCODE = +0)                                     17430001
174400            OR (SQLCODE = +100))                                  17440001
174500                                                                  17450001
174600         EXEC SQL                                                 17460001
174700            SELECT VEND_STYL_NAME                                 17470001
174800                  ,COLOR_CDE                                      17480001
174900                  ,COLOR_DESC                                     17490001
175000                  ,SIZE_CDE                                       17500001
175100                  ,SIZE_DESC                                      17510001
175200                  ,SKU_DESC                                       17520001
175300                  ,CL_NBR                                         17530001
175400                  ,SKU_SEQ_NBR                                    17540001
175500                  ,APP_PO_LNE_NBR                                 17550001
175600            INTO  :PURITM-VEND-STYL-NAME                          17560001
175700                 ,:PURITM-COLOR-CDE                               17570001
175800                 ,:PURITM-COLOR-DESC                              17580001
175900                 ,:PURITM-SIZE-CDE                                17590001
176000                 ,:PURITM-SIZE-DESC                               17600001
176100                 ,:PURITM-SKU-DESC                                17610001
176200                 ,:PURITM-CL-NBR                                  17620001
176300                 ,:PURITM-SKU-SEQ-NBR                             17630001
176400                 ,:PURITM-APP-PO-LNE-NBR                          17640001
176500           FROM   TPURITM                                         17650001
176600          WHERE   PO_NBR             = :DK-PO-NBR                 17660001
176700            AND   PO_LNE_NBR         = :DK-PO-LNE-NBR             17670001
176800            AND   VER_STATUS_CDE     = 'A'                        17680001
176900         END-EXEC                                                 17690001
177000                                                                  17700001
177100         EVALUATE TRUE                                            17710001
177200             WHEN SQLCODE = +0                                    17720001
177300                 SET PURITM-FOUND        TO TRUE                  17730001
177400                 MOVE PURITM-APP-PO-LNE-NBR TO                    17740001
177500                       PV-APP-PO-LNE-NBR                          17750001
177600             WHEN SQLCODE = -904                                  17760001
177700             WHEN SQLCODE = -913                                  17770001
177800             WHEN SQLCODE = +100                                  17780001
177900                 MOVE DK-PO-LNE-NBR TO PV-APP-PO-LNE-NBR          17790001
178000             WHEN SQLWARN0 NOT = SPACES                           17800001
178100             WHEN SQLCODE < ZERO                                  17810001
178200             WHEN SQLCODE > ZERO                                  17820001
178300                 MOVE '4050-...'                                  17830001
178400                                   TO DP013-PARAGRAPH             17840001
178500                 MOVE 'SELECT ON TPURITM'                         17850001
178600                                   TO DP013-MESSAGE-TEXT (1)      17860001
178700                 MOVE SQLCA        TO DP013-SQLCA                 17870001
178800                 MOVE 'TPURITM'    TO DP013-DB2-TABLE-NAME (1)    17880001
178900                 SET DP013-DB2-ABEND                              17890001
179000                     DP013-XCTL-DISPLAY-RESTART                   17900001
179100                                   TO TRUE                        17910001
179200                 PERFORM DP013-0000-PROCESS-ABEND                 17920001
179300         END-EVALUATE                                             17930001
179400     END-PERFORM.                                                 17940001
179500                                                                  17950001
179600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17960001
179700         MOVE '4050-...'                                          17970001
179800                                   TO DP013-PARAGRAPH             17980001
179900         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     17990001
180000                                   TO DP013-MESSAGE-TEXT (1)      18000001
180100         MOVE SQLCA                TO DP013-SQLCA                 18010001
180200         MOVE 'TPURITM'            TO DP013-DB2-TABLE-NAME (1)    18020001
180300         SET DP013-DB2-ABEND                                      18030001
180400             DP013-XCTL-DISPLAY-RESTART                           18040001
180500                                   TO TRUE                        18050001
180600         PERFORM DP013-0000-PROCESS-ABEND                         18060001
180700     END-IF.                                                      18070001
180800                                                                  18080001
180947*--------------------------------------------------------------*  18094744
180948* MOVE THE DISPLAYED FIELDS FROM THE DATABASE TO THE COMMAREA  *  18094844
180950*--------------------------------------------------------------*  18095044
181000 4200-MOVE-DATABASE-TO-COMMAREA.                                  18100001
181100                                                                  18110001
181200     MOVE INVOIC-PAYT-REQ-SEQ-NBR  TO ASC-KEY-PAYT-REQ-SEQ-NBR    18120001
181300     MOVE INVOIC-INVC-TYP-CDE      TO ASC-INVC-TYP-CDE            18130001
181400     MOVE INVOIC-STATUS-CDE        TO ASC-KEY-INVC-STATUS         18140001
181500     MOVE INVOIC-ENTR-MTHD-CDE     TO ASC-ENTR-MTHD-CDE           18150001
181600                                                                  18160001
181700     MOVE INVOIC-RMIT-VND-ID       TO ASC-DUN-NBR                 18170001
181800     MOVE INVOIC-PO-NBR            TO ASC-KEY-PO-NBR              18180001
181900                                                                  18190001
182000     MOVE PREQIT-PAY-REQ-LNE-QTY   TO ASC-OLD-PAY-REQ-LNE-QTY     18200001
182100                                      ASC-ALP-PAY-REQ-LNE-QTY-NUM 18210001
182200     MOVE PREQIT-UNT-COST-AMT      TO ASC-OLD-UNT-COST-AMT        18220001
182300                                      ASC-ALP-UNT-COST-AMT-NUM    18230001
182400     IF PREQIT-UNT-COST-AMT = +0                                  18240001
182500         MOVE 'NC'                 TO ASC-ALP-UNT-COST-AMT        18250001
182600     END-IF                                                       18260001
182700                                                                  18270001
182800     MOVE PREQIT-QTY-UNT-OF-MSMT   TO ASC-OLD-QTY-UNT-OF-MSMT.    18280001
182900                                                                  18290001
183000     MOVE PV-APP-PO-LNE-NBR        TO ASC-OLD-PO-LNE-NBR          18300001
183100                                      ASC-PREV-PO-LNE-NBR         18310001
183200                                      ASC-ALP-PO-LNE-NBR-NUM      18320001
183300                                                                  18330001
183400     IF MIITEM-UNT-COST-SEL-CDE = 'P'                             18340001
183500         MOVE 'Y'                  TO ASC-PAY-IND                 18350001
183600     ELSE                                                         18360001
183700         MOVE 'N'                  TO ASC-PAY-IND                 18370001
183800     END-IF.                                                      18380008
183900                                                                  18390001
184000     MOVE ASC-ORIGINAL-FIELD-VALUES   TO                          18400001
184100          ASC-NEWLY-ENTERED-FIELD-VALUES.                         18410001
184200                                                                  18420001
184210*--------------------------------------------------------------*  18421044
184220* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SREEN     *  18422044
184230*--------------------------------------------------------------*  18423044
184300 4400-MOVE-COMMAREA-TO-SCREEN.                                    18430001
184400                                                                  18440001
184500     MOVE ASC-KEY-INVC-ID           TO AINVNBRO                   18450001
184600                                                                  18460001
184700     MOVE ASC-KEY-PAYT-REQ-LNE-NBR  TO PV-NUM4                    18470001
184800     MOVE PV-NUM4-X                 TO AINVLNEO                   18480001
184900                                                                  18490001
185000                                                                  18500001
185100     MOVE ASC-KEY-PO-NBR            TO PV-NUM9                    18510050
185200     MOVE PV-NUM9-X                 TO APONUMO                    18520050
185300                                                                  18530001
185400     IF ASC-ALP-PO-LNE-NBR = '****' OR                            18540001
185500        ASC-ALP-PO-LNE-NBR = '0000'                               18550001
185600         MOVE '****'                   TO APOLNEO                 18560001
185700                                          ASC-ALP-PO-LNE-NBR      18570001
185800     ELSE                                                         18580001
185900         IF ASC-ALP-PO-LNE-NBR NUMERIC                            18590001
186000             MOVE ASC-NEW-PO-LNE-NBR   TO PV-NUM4                 18600001
186100             MOVE PV-NUM4-X            TO APOLNEO                 18610001
186200                                          ASC-ALP-PO-LNE-NBR      18620001
186300         ELSE                                                     18630001
186400             MOVE ASC-ALP-PO-LNE-NBR   TO APOLNEO                 18640001
186500         END-IF                                                   18650001
186600     END-IF.                                                      18660008
186700                                                                  18670001
186800     MOVE ASC-DUN-NBR               TO ADUNNBRO                   18680001
186900     MOVE ASC-KEY-DEPT-NBR          TO ADPTNBRO.                  18690006
187000                                                                  18700001
187100     IF ASC-ALP-PAY-REQ-LNE-QTY NOT NUMERIC                       18710001
187200         MOVE +0                    TO ASC-NEW-PAY-REQ-LNE-QTY    18720001
187300         MOVE ASC-ALP-PAY-REQ-LNE-QTY                             18730001
187400                                    TO ANBRPCSO                   18740001
187500     ELSE                                                         18750001
187600         MOVE ASC-NEW-PAY-REQ-LNE-QTY TO PV-NUM7                  18760050
187700         MOVE PV-NUM7-X             TO ANBRPCSO                   18770050
187800                                       ASC-ALP-PAY-REQ-LNE-QTY    18780001
187900     END-IF.                                                      18790008
188000                                                                  18800001
188100     MOVE ASC-NEW-QTY-UNT-OF-MSMT   TO AUOMO                      18810001
188200     MOVE ASC-PAY-IND               TO APAYINDO                   18820001
188300                                                                  18830001
188400     IF ASC-ALP-UNT-COST-AMT NOT NUMERIC                          18840001
188500         MOVE +0                    TO ASC-NEW-UNT-COST-AMT       18850001
188600         MOVE ASC-ALP-UNT-COST-AMT  TO AUNTCSTO                   18860001
188700     ELSE                                                         18870001
188800         MOVE ASC-NEW-UNT-COST-AMT  TO PV-6V999                   18880001
188900         MOVE PV-6V999-X            TO AUNTCSTO                   18890001
189000                                       ASC-ALP-UNT-COST-AMT       18900001
189100         IF ASC-NEW-UNT-COST-AMT = +0                             18910001
189200             MOVE SPACES            TO ASC-ALP-UNT-COST-AMT       18920001
189300                                       AUNTCSTO                   18930001
189400         END-IF                                                   18940001
189500     END-IF.                                                      18950008
189600                                                                  18960001
189700     IF ASC-DELETE-REQUESTED OR                                   18970001
189800        ASC-NO-CHANGES-ALLOWED                                    18980001
189900         SET DP030-SET-CURSOR-TRAILER TO TRUE                     18990001
190000     ELSE                                                         19000001
190100         IF PS-NO-ERROR                                           19010001
190200             SET DP030-SET-CURSOR-APPL-1                          19020001
190300                                      TO TRUE                     19030001
190400             MOVE -1                  TO ANBRPCSL                 19040001
190500         END-IF                                                   19050001
190600     END-IF.                                                      19060001
190700                                                                  19070044
190800*--------------------------------------------------------------*  19080044
190900* RECORD IN THE SELECTION TEMP STORAGE QUEUE THE FACT THAT     *  19090044
191000* THIS OBJECT WAS UPDATED.                                     *  19100044
191100*--------------------------------------------------------------*  19110044
191300 5200-UPDATE-SELECTION-QUEUE.                                     19130001
191400                                                                  19140001
191500     PERFORM 9100-READ-SEL-QUEUE.                                 19150001
191600                                                                  19160001
191700     IF ASC-DELETE-SUCCESSFUL                                     19170001
191800         SET AP301-DEL (ASC-SEL-SUB)  TO TRUE                     19180001
191900     ELSE                                                         19190001
192000**       THEY MAY HAVE UPDATED THE NETWORK OR VENDOR INCHG INFO,  19200001
192100**       SO BE SURE TO UPDATE THE CORRESPONDING TS REC TOO.       19210001
192200         SET AP301-UPD (ASC-SEL-SUB)     TO TRUE                  19220001
192300     END-IF.                                                      19230001
192400                                                                  19240001
192500     PERFORM 9200-REWRITE-LIST-QUEUE.                             19250001
192600                                                                  19260001
192700**   PERFORM 3500-SAVE-SCREEN-FIELDS.                             19270001
192800                                                                  19280001
192810*--------------------------------------------------------------*  19281044
192820* UPDATE THE DATABASE TABLES                                   *  19282044
192840*--------------------------------------------------------------*  19284044
192900 6000-UPDATE-DATABASE.                                            19290001
192910                                                                  19291044
193000* ALL COMMENTED CODE IS RELATED TO WR30974                        19300039
193100*    IF ASC-ENTR-MTHD-CDE = 'ED'                                  19310036
193200*        IF ASC-OLD-PREQIT-FIELDS NOT = ASC-NEW-PREQIT-FIELDS     19320036
193300*            PERFORM 6200-TPREQIT-UPDATE                          19330036
193400*        END-IF                                                   19340036
193500*    END-IF.                                                      19350036
193600                                                                  19360001
193700*    IF ASC-ENTR-MTHD-CDE = 'ED'                                  19370036
193800*    OR ASC-INVC-TYP-CDE  = 'RI'                                  19380036
193900         IF ASC-OLD-PO-LNE-NBR    NOT = ASC-NEW-PO-LNE-NBR        19390001
194000             PERFORM 6100-TMIITEM-UPDATE                          19400001
194100         END-IF.                                                  19410038
194200*    ELSE                                                         19420036
194300*        IF ASC-OLD-PREQIT-FIELDS NOT = ASC-NEW-PREQIT-FIELDS     19430036
194400*            PERFORM 6200-TPREQIT-UPDATE                          19440036
194500*        END-IF                                                   19450036
194600*    END-IF.                                                      19460036
194700                                                                  19470001
194800     MOVE PC-TSYMSG-00059        TO DP020-MSG-NUMBER.             19480001
194900     SET DP020-MSG-INFORMATIONAL TO TRUE.                         19490001
195000                                                                  19500001
195100     IF ASC-USE-SELECTION-QUEUE                                   19510001
195200         PERFORM 5200-UPDATE-SELECTION-QUEUE                      19520001
195300     END-IF.                                                      19530001
195400                                                                  19540001
195500     EXEC CICS                                                    19550001
195600         SYNCPOINT                                                19560001
195700     END-EXEC.                                                    19570001
195800                                                                  19580044
195810*--------------------------------------------------------------*  19581044
195820* UPDATE THE TMIITEM TABLE                                     *  19582044
195830*--------------------------------------------------------------*  19583044
195900 6100-TMIITEM-UPDATE.                                             19590001
196000                                                                  19600001
196100     MOVE +1 TO MIITEM-PO-LNE-NBR-NN                              19610001
196200                                                                  19620001
196300     PERFORM                                                      19630001
196400         WITH TEST AFTER                                          19640001
196500         VARYING PV-RETRY-COUNTER                                 19650001
196600         FROM 1 BY 1                                              19660001
196700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               19670001
196800             OR (SQLCODE = +0))                                   19680001
196900                                                                  19690001
197000         EXEC SQL                                                 19700001
197100             UPDATE TMIITEM                                       19710001
197200                SET PO_LNE_NBR       = :PV-NEW-KEY-PO-LNE-NBR     19720001
197300                                       :MIITEM-PO-LNE-NBR-NN      19730001
197400              WHERE PAYT_REQ_SEQ_NBR = :ASC-KEY-PAYT-REQ-SEQ-NBR  19740001
197500                AND PAYT_REQ_LNE_NBR = :ASC-KEY-PAYT-REQ-LNE-NBR  19750001
197600         END-EXEC                                                 19760001
197700                                                                  19770001
197800         EVALUATE TRUE                                            19780001
197900             WHEN SQLCODE = +0                                    19790001
198000                  MOVE PV-NEW-KEY-PO-LNE-NBR TO                   19800001
198100                        ASC-KEY-PO-LNE-NBR                        19810001
198200             WHEN SQLCODE = -904                                  19820001
198300             WHEN SQLCODE = -913                                  19830001
198400                  CONTINUE                                        19840001
198500                                                                  19850001
198600             WHEN SQLWARN0 NOT = SPACES                           19860001
198700             WHEN SQLCODE < +0                                    19870001
198800             WHEN SQLCODE > +0                                    19880001
198900                  MOVE '6100-TMIITEM-UPDATE'                      19890001
199000                                  TO DP013-PARAGRAPH              19900001
199100                  MOVE 'UNSUCCESSFUL UPDATE'                      19910001
199200                                  TO DP013-MESSAGE-TEXT (1)       19920001
199300                  MOVE SQLCA      TO DP013-SQLCA                  19930001
199400                  MOVE 'TMIITEM ' TO DP013-DB2-TABLE-NAME (1)     19940001
199500                  SET DP013-DB2-ABEND                             19950001
199600                      DP013-XCTL-DISPLAY-RESTART                  19960001
199700                                  TO TRUE                         19970001
199800                  PERFORM DP013-0000-PROCESS-ABEND                19980001
199900         END-EVALUATE                                             19990001
200000     END-PERFORM.                                                 20000001
200100                                                                  20010001
200200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20020001
200300         MOVE '6100-TMIITEM-UPDATE'                               20030001
200400                                  TO DP013-PARAGRAPH              20040001
200500         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE'                   20050001
200600                                  TO DP013-MESSAGE-TEXT (1)       20060001
200700         MOVE SQLCA               TO DP013-SQLCA                  20070001
200800         MOVE 'TMIITEM '          TO DP013-DB2-TABLE-NAME (1)     20080001
200900         SET DP013-DB2-ABEND                                      20090001
201000             DP013-XCTL-DISPLAY-RESTART                           20100001
201100                                  TO TRUE                         20110001
201200         PERFORM DP013-0000-PROCESS-ABEND                         20120001
201300     END-IF.                                                      20130001
201400                                                                  20140001
201510*--------------------------------------------------------------*  20151044
201520* UPDATE THE TPREQIT TABLE                                     *  20152044
201530*--------------------------------------------------------------*  20153044
201600 6200-TPREQIT-UPDATE.                                             20160001
201700                                                                  20170001
201800     INITIALIZE DCLTPREQIT.                                       20180001
201900                                                                  20190001
202000     PERFORM                                                      20200001
202100         WITH TEST AFTER                                          20210001
202200         VARYING PV-RETRY-COUNTER                                 20220001
202300         FROM 1 BY 1                                              20230001
202400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20240001
202500             OR (SQLCODE = +0))                                   20250001
202600                                                                  20260001
202700         EXEC SQL                                                 20270001
202800             UPDATE TPREQIT                                       20280001
202900                SET PAY_REQ_LNE_QTY  = :ASC-NEW-PAY-REQ-LNE-QTY   20290001
203000                   ,QTY_UNT_OF_MSMT  = :ASC-NEW-QTY-UNT-OF-MSMT   20300001
203100                   ,UNT_COST_AMT     = :ASC-NEW-UNT-COST-AMT      20310001
203200              WHERE PAYT_REQ_SEQ_NBR = :ASC-KEY-PAYT-REQ-SEQ-NBR  20320001
203300                AND PAYT_REQ_LNE_NBR = :ASC-KEY-PAYT-REQ-LNE-NBR  20330001
203400         END-EXEC                                                 20340001
203500                                                                  20350001
203600         EVALUATE TRUE                                            20360001
203700             WHEN SQLCODE = +0                                    20370001
203800             WHEN SQLCODE = -904                                  20380001
203900             WHEN SQLCODE = -913                                  20390001
204000                  CONTINUE                                        20400001
204100                                                                  20410001
204200             WHEN SQLWARN0 NOT = SPACES                           20420001
204300             WHEN SQLCODE < +0                                    20430001
204400             WHEN SQLCODE > +0                                    20440001
204500                  MOVE '6200-TPREQIT-UPDATE'                      20450001
204600                                  TO DP013-PARAGRAPH              20460001
204700                  MOVE 'UNSUCCESSFUL UPDATE'                      20470001
204800                                  TO DP013-MESSAGE-TEXT (1)       20480001
204900                  MOVE SQLCA      TO DP013-SQLCA                  20490001
205000                  MOVE 'TPREQIT ' TO DP013-DB2-TABLE-NAME (1)     20500001
205100                  SET DP013-DB2-ABEND                             20510001
205200                      DP013-XCTL-DISPLAY-RESTART                  20520001
205300                                  TO TRUE                         20530001
205400                  PERFORM DP013-0000-PROCESS-ABEND                20540001
205500         END-EVALUATE                                             20550001
205600     END-PERFORM.                                                 20560001
205700                                                                  20570001
205800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20580001
205900         MOVE '6200-TPREQIT-UPDATE'                               20590001
206000                                  TO DP013-PARAGRAPH              20600001
206100         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE'                   20610001
206200                                  TO DP013-MESSAGE-TEXT (1)       20620001
206300         MOVE SQLCA               TO DP013-SQLCA                  20630001
206400         MOVE 'TPREQIT '          TO DP013-DB2-TABLE-NAME (1)     20640001
206500         SET DP013-DB2-ABEND                                      20650001
206600             DP013-XCTL-DISPLAY-RESTART                           20660001
206700                                  TO TRUE                         20670001
206800         PERFORM DP013-0000-PROCESS-ABEND                         20680001
206900     END-IF.                                                      20690001
207000                                                                  20700001
207200*--------------------------------------------------------------*  20720044
207300* DUE TO REFERENTIAL INTEGRITY, DELETING A TPREQIT ROW         *  20730044
207400* CASCADES DOWN TO DELETE TMIITEM & TVNDINV AS WELL.           *  20740044
207500*--------------------------------------------------------------*  20750044
207600 7000-DELETE-TPREQIT.                                             20760001
207700                                                                  20770001
207800     PERFORM                                                      20780001
207900         WITH TEST AFTER                                          20790001
208000         VARYING PV-RETRY-COUNTER                                 20800001
208100         FROM 1 BY 1                                              20810001
208200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20820001
208300             OR (SQLCODE = +0)                                    20830001
208400             OR (SQLCODE = +100) )                                20840001
208500                                                                  20850001
208600         EXEC SQL DELETE FROM TPREQIT                             20860001
208700                                                                  20870001
208800            WHERE PAYT_REQ_SEQ_NBR = :ASC-KEY-PAYT-REQ-SEQ-NBR    20880001
208900              AND PAYT_REQ_LNE_NBR = :ASC-KEY-PAYT-REQ-LNE-NBR    20890001
209000                                                                  20900001
209100         END-EXEC                                                 20910001
209200                                                                  20920001
209300         EVALUATE TRUE                                            20930001
209400             WHEN SQLCODE = +0                                    20940001
209500             WHEN SQLCODE = +100                                  20950001
209600             WHEN SQLCODE = -904                                  20960001
209700             WHEN SQLCODE = -913                                  20970001
209800                 CONTINUE                                         20980001
209900                                                                  20990001
210000             WHEN SQLWARN0 NOT = SPACES                           21000001
210100             WHEN SQLCODE < +0                                    21010001
210200             WHEN SQLCODE > +0                                    21020001
210300                 MOVE '7000-DELETE-TPREQIT'                       21030001
210400                                   TO DP013-PARAGRAPH             21040001
210500                 MOVE 'DELETE ROW FROM TPREQIT'                   21050001
210600                                   TO DP013-MESSAGE-TEXT(1)       21060001
210700                 MOVE SQLCA        TO DP013-SQLCA                 21070001
210800                 MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)    21080001
210900                 SET DP013-DB2-ABEND                              21090001
211000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           21100001
211100                 PERFORM DP013-0000-PROCESS-ABEND                 21110001
211200         END-EVALUATE                                             21120001
211300     END-PERFORM.                                                 21130001
211400                                                                  21140001
211500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21150001
211600         MOVE '7000-DELETE-TPREQIT' TO DP013-PARAGRAPH            21160001
211700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING '              21170001
211800                                   TO DP013-MESSAGE-TEXT (1)      21180001
211900         MOVE 'TO DELETE A TPREQIT TABLE'                         21190001
212000                                   TO DP013-MESSAGE-TEXT (2)      21200001
212100         MOVE SQLCA                TO DP013-SQLCA                 21210001
212200         MOVE 'TPREQIT'            TO DP013-DB2-TABLE-NAME (1)    21220001
212300         SET DP013-DB2-ABEND                                      21230001
212400             DP013-XCTL-DISPLAY-RESTART                           21240001
212500                                   TO TRUE                        21250001
212600         PERFORM DP013-0000-PROCESS-ABEND                         21260001
212700     END-IF.                                                      21270001
212800                                                                  21280001
212900     MOVE PC-TSYMSG-00115        TO DP020-MSG-NUMBER              21290001
213000     SET DP020-MSG-INFORMATIONAL TO TRUE.                         21300001
213100     SET ASC-DELETE-SUCCESSFUL TO TRUE.                           21310001
213200                                                                  21320001
213300     PERFORM                                                      21330001
213400         WITH TEST AFTER                                          21340001
213500         VARYING PV-RETRY-COUNTER                                 21350001
213600         FROM 1 BY 1                                              21360001
213700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21370001
213800            OR (SQLCODE = +0)                                     21380001
213900            OR (SQLCODE = +100)                                   21390001
214000            OR (SQLCODE = -811))                                  21400001
214100                                                                  21410001
214200         EXEC SQL                                                 21420001
214300            SELECT 1                                              21430001
214400            INTO  :PV-DUMMY-NBR                                   21440001
214500            FROM   TPREQIT                                        21450001
214600            WHERE   PAYT_REQ_SEQ_NBR = :ASC-KEY-PAYT-REQ-SEQ-NBR  21460001
214700         END-EXEC                                                 21470001
214800                                                                  21480001
214900         EVALUATE TRUE                                            21490001
215000             WHEN SQLCODE = +0                                    21500001
215100             WHEN SQLCODE = -811                                  21510001
215200             WHEN SQLCODE = +100                                  21520001
215300             WHEN SQLCODE = -904                                  21530001
215400             WHEN SQLCODE = -913                                  21540001
215500                 CONTINUE                                         21550001
215600             WHEN SQLWARN0 NOT = SPACES                           21560001
215700             WHEN SQLCODE < ZERO                                  21570001
215800             WHEN SQLCODE > ZERO                                  21580001
215900                 MOVE '7000-...'                                  21590001
216000                                   TO DP013-PARAGRAPH             21600001
216100                 MOVE 'SELECT ON TPREQIT'                         21610001
216200                                   TO DP013-MESSAGE-TEXT (1)      21620001
216300                 MOVE SQLCA        TO DP013-SQLCA                 21630001
216400                 MOVE 'TPREQIT'    TO DP013-DB2-TABLE-NAME (1)    21640001
216500                 SET DP013-DB2-ABEND                              21650001
216600                     DP013-XCTL-DISPLAY-RESTART                   21660001
216700                                   TO TRUE                        21670001
216800                 PERFORM DP013-0000-PROCESS-ABEND                 21680001
216900         END-EVALUATE                                             21690001
217000     END-PERFORM.                                                 21700001
217100                                                                  21710001
217200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        21720001
217300         MOVE '7000-...'                                          21730001
217400                                   TO DP013-PARAGRAPH             21740001
217500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     21750001
217600                                   TO DP013-MESSAGE-TEXT (1)      21760001
217700         MOVE SQLCA                TO DP013-SQLCA                 21770001
217800         MOVE 'TPREQIT'            TO DP013-DB2-TABLE-NAME (1)    21780001
217900         SET DP013-DB2-ABEND                                      21790001
218000             DP013-XCTL-DISPLAY-RESTART                           21800001
218100                                   TO TRUE                        21810001
218200         PERFORM DP013-0000-PROCESS-ABEND                         21820001
218300     END-IF.                                                      21830001
218400                                                                  21840001
218500     IF SQLCODE = +100                                            21850001
218600        PERFORM 7050-UPDATE-TINVOIC                               21860001
218700     END-IF.                                                      21870001
218800                                                                  21880001
218900     IF ASC-USE-SELECTION-QUEUE                                   21890001
219000         PERFORM 5200-UPDATE-SELECTION-QUEUE                      21900001
219100     END-IF.                                                      21910001
219200                                                                  21920001
219300     EXEC CICS                                                    21930001
219400         SYNCPOINT                                                21940001
219500     END-EXEC.                                                    21950001
219600                                                                  21960001
219610*--------------------------------------------------------------*  21961044
219620* UPDATE THE TINVOIC TABLE                                     *  21962044
219630*--------------------------------------------------------------*  21963044
219700 7050-UPDATE-TINVOIC.                                             21970001
219800                                                                  21980001
219900     PERFORM                                                      21990001
220000         WITH TEST AFTER                                          22000001
220100         VARYING PV-RETRY-COUNTER                                 22010001
220200         FROM 1 BY 1                                              22020001
220300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22030001
220400             OR (SQLCODE = +0))                                   22040001
220500                                                                  22050001
220600         EXEC SQL                                                 22060001
220700             UPDATE TINVOIC                                       22070001
220800                SET DTL_ENTR_IND     = :PC-N-CODE                 22080001
220900              WHERE PAYT_REQ_SEQ_NBR = :ASC-KEY-PAYT-REQ-SEQ-NBR  22090001
221000         END-EXEC                                                 22100001
221100                                                                  22110001
221200         EVALUATE TRUE                                            22120001
221300             WHEN SQLCODE = +0                                    22130001
221400             WHEN SQLCODE = -904                                  22140001
221500             WHEN SQLCODE = -913                                  22150001
221600                  CONTINUE                                        22160001
221700                                                                  22170001
221800             WHEN SQLWARN0 NOT = SPACES                           22180001
221900             WHEN SQLCODE < +0                                    22190001
222000             WHEN SQLCODE > +0                                    22200001
222100                  MOVE '7050-TINVOIC-UPDATE'                      22210001
222200                                  TO DP013-PARAGRAPH              22220001
222300                  MOVE 'UNSUCCESSFUL UPDATE'                      22230001
222400                                  TO DP013-MESSAGE-TEXT (1)       22240001
222500                  MOVE SQLCA      TO DP013-SQLCA                  22250001
222600                  MOVE 'TINVOIC ' TO DP013-DB2-TABLE-NAME (1)     22260001
222700                  SET DP013-DB2-ABEND                             22270001
222800                      DP013-XCTL-DISPLAY-RESTART                  22280001
222900                                  TO TRUE                         22290001
223000                  PERFORM DP013-0000-PROCESS-ABEND                22300001
223100         END-EVALUATE                                             22310001
223200     END-PERFORM.                                                 22320001
223300                                                                  22330001
223400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22340001
223500         MOVE '7050-TINVOIC-UPDATE'                               22350001
223600                                  TO DP013-PARAGRAPH              22360001
223700         MOVE 'MAX RETRIES EXCEEDED FOR UPDATE'                   22370001
223800                                  TO DP013-MESSAGE-TEXT (1)       22380001
223900         MOVE SQLCA               TO DP013-SQLCA                  22390001
224000         MOVE 'TINVOIC '          TO DP013-DB2-TABLE-NAME (1)     22400001
224100         SET DP013-DB2-ABEND                                      22410001
224200             DP013-XCTL-DISPLAY-RESTART                           22420001
224300                                  TO TRUE                         22430001
224400         PERFORM DP013-0000-PROCESS-ABEND                         22440001
224500     END-IF.                                                      22450001
224600                                                                  22460001
224610*--------------------------------------------------------------*  22461044
224620* CHECK IF THE PO/MATCH LEVEL COMBINATION HAS ALREADY BEEN     *  22462044
224621* PROCESSED.                                                   *  22462144
224630*--------------------------------------------------------------*  22463044
224700 8800-CHECK-IF-PROCESSED.                                         22470001
224800                                                                  22480001
224900     PERFORM                                                      22490001
225000         WITH TEST AFTER                                          22500001
225100         VARYING PV-RETRY-COUNTER                                 22510001
225200         FROM 1 BY 1                                              22520001
225300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               22530001
225400             OR (SQLCODE = +0))                                   22540001
225500                                                                  22550001
225600         EXEC SQL                                                 22560001
225700             SELECT COUNT(*)                                      22570001
225800               INTO :PV-DB2-COUNT                                 22580001
225900               FROM TPOSTRR A                                     22590001
226000                   ,TINVOIC B                                     22600001
226100              WHERE A.PO_NBR           = :ASC-KEY-PO-NBR          22610001
226200                AND A.STATUS_CDE       = ' '                      22620001
226300                AND B.PAYT_REQ_SEQ_NBR = :ASC-KEY-PAYT-REQ-SEQ-NBR22630001
226400                AND B.INVC_ID          = :ASC-KEY-INVC-ID         22640001
226500                AND B.INVC_TYP_CDE     = 'RI'                     22650001
226600                AND A.MTCH_LVL_CDE     = B.MTCH_LVL_CDE           22660041
226610                AND (A.STR_NBR         = B.STR_NBR                22661045
226620                     OR A.STR_NBR      = B.DC_NBR)                22662045
226700         END-EXEC                                                 22670001
226800                                                                  22680001
226900         EVALUATE TRUE                                            22690001
227000             WHEN SQLCODE = +0                                    22700001
227100             WHEN SQLCODE = -305                                  22710001
227200             WHEN SQLCODE = -904                                  22720001
227300             WHEN SQLCODE = -913                                  22730001
227400                  CONTINUE                                        22740001
227500                                                                  22750001
227600             WHEN SQLWARN0 NOT = SPACES                           22760001
227700             WHEN SQLCODE  NOT = ZERO                             22770001
227800                  MOVE '8800-CHECK-IF-PROCESSED'                  22780001
227900                                  TO DP013-PARAGRAPH              22790001
228000                  MOVE 'UNSUCCESSFUL SELECT COUNT'                22800001
228100                                  TO DP013-MESSAGE-TEXT (1)       22810001
228200                  MOVE SQLCA      TO DP013-SQLCA                  22820001
228300                  MOVE 'TPOSTRR ' TO DP013-DB2-TABLE-NAME (1)     22830001
228400                  MOVE 'TINVOIC ' TO DP013-DB2-TABLE-NAME (2)     22840001
228500                  SET DP013-DB2-ABEND                             22850001
228600                      DP013-XCTL-DISPLAY-RESTART                  22860001
228700                                  TO TRUE                         22870001
228800                  PERFORM DP013-0000-PROCESS-ABEND                22880001
228900         END-EVALUATE                                             22890001
229000     END-PERFORM.                                                 22900001
229100                                                                  22910001
229200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22920001
229300         MOVE '8800-CHECK-IF-PROCESSED'                           22930001
229400                                  TO DP013-PARAGRAPH              22940001
229500         MOVE 'MAX RETRIES EXCEEDED FOR SELECT COUNT'             22950001
229600                                  TO DP013-MESSAGE-TEXT (1)       22960001
229700         MOVE SQLCA               TO DP013-SQLCA                  22970001
229800         MOVE 'TPOSTRR '          TO DP013-DB2-TABLE-NAME (1)     22980001
229900         MOVE 'TINVOIC '          TO DP013-DB2-TABLE-NAME (2)     22990001
230000         SET DP013-DB2-ABEND                                      23000001
230100             DP013-XCTL-DISPLAY-RESTART                           23010001
230200                                  TO TRUE                         23020001
230300         PERFORM DP013-0000-PROCESS-ABEND                         23030001
230400     END-IF.                                                      23040001
230500                                                                  23050001
230600     IF SQLCODE = ZERO AND PV-DB2-COUNT > ZERO                    23060001
230700         MOVE DP015-UNP-ALP-BRT-OFF                               23070001
230800                              TO APONUMA                          23080001
230900         MOVE DP015-RED       TO APONUMC                          23090001
231000         MOVE DP015-REVERSE   TO APONUMH                          23100001
231100         SET PS-ERROR         TO TRUE                             23110001
231200     END-IF.                                                      23120001
231300                                                                  23130044
231400*--------------------------------------------------------------*  23140044
231500* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.     *  23150044
231600*--------------------------------------------------------------*  23160044
231800 9100-READ-SEL-QUEUE.                                             23180001
231900                                                                  23190001
232000     EXEC CICS                                                    23200001
232100         READQ TS                                                 23210001
232200             QUEUE (ASC-SEL-QUEUE-NAME)                           23220001
232300             INTO  (AP301-INVC-LIST-TS-RCRD)                      23230001
232400             ITEM  (ASC-SEL-ITEM)                                 23240001
232500             RESP  (PV-CICS-RESPONSE)                             23250001
232600     END-EXEC.                                                    23260001
232700                                                                  23270001
232800     IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                   23280001
232900         CONTINUE                                                 23290001
233000     ELSE                                                         23300001
233100         SET DP013-LOGIC-ABEND                                    23310001
233200             DP013-NO-ROLLBACK     TO TRUE                        23320001
233300         MOVE '9100-READ-SEL-QUEUE'                               23330001
233400                                   TO DP013-PARAGRAPH             23340001
233500         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   23350001
233600                                   TO DP013-MESSAGE-TEXT (1)      23360001
233700         PERFORM DP013-0000-PROCESS-ABEND                         23370001
233800     END-IF.                                                      23380001
233900                                                                  23390001
234100*--------------------------------------------------------------*  23410044
234200* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.     *  23420044
234300*--------------------------------------------------------------*  23430044
234400 9200-REWRITE-LIST-QUEUE.                                         23440001
234500                                                                  23450001
234600     EXEC CICS                                                    23460001
234700          WRITEQ TS                                               23470001
234800              QUEUE  (ASC-SEL-QUEUE-NAME)                         23480001
234900              FROM   (AP301-INVC-LIST-TS-RCRD)                    23490001
235000              ITEM   (ASC-SEL-ITEM)                               23500001
235100              RESP   (PV-CICS-RESPONSE)                           23510001
235200              REWRITE                                             23520001
235300     END-EXEC.                                                    23530001
235400                                                                  23540001
235500     IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)               23550001
235600         SET DP013-CICS-ABEND                                     23560001
235700             DP013-NO-ROLLBACK     TO TRUE                        23570001
235800         MOVE '9200-REWRITE-LIST-QUEUE'                           23580001
235900                                   TO DP013-PARAGRAPH             23590001
236000         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   23600001
236100                                   TO DP013-MESSAGE-TEXT (1)      23610001
236200         PERFORM DP013-0000-PROCESS-ABEND                         23620001
236300     END-IF.                                                      23630001
236400                                                                  23640001
236600*--------------------------------------------------------------*  23660044
236700* ABEND PROCESSOR MODULE                                       *  23670044
236800*--------------------------------------------------------------*  23680044
237000     COPY DPPD013.                                                23700001
237100                                                                  23710044
