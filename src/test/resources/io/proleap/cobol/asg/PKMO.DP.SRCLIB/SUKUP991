000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUP991.                                         00050000
000600 AUTHOR.        RON KRIER.                                        00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   JULY, 2000.                                       00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM WILL TAKE IN A PO NUMBER, ACCESS DATA FROM        00120000
001300*  THE SHIPPING UNIT TABLES AND WRITE INFORMATION TO THE          00130000
001400*  LABEL DATA TABLE USED TO CREATE 4X4 LABELS FROM THE CHECK-IN   00140072
001500*  APPLICATION.                                                   00150000
001600*                                                                 00160000
001700*  THIS WILL BE USED SO THAT WE CREATE BARCODED LABELS OF         00170000
001800*  INBOUND CARTONS TO BE ABLE TO USE FOR TESTING OF THE CHECK-IN  00180000
001900*  APPLICATION.                                                   00190000
002000*                                                                 00200000
002001*  CHANGE THE SCAC - TRAILER - TRIP                               00200169
002002*                                                                 00200200
002003*  MORE INFORMATION ABOUT THIS OVER PROCESS CAN BE FOUND BY       00200372
002004*  LOOKING THE SU FAQ SPREADSHEET AND DO A FIND ON SUKUP991.      00200472
002005*                                                                 00200572
002100******************************************************************00210000
002200                                                                  00220000
002300******************************************************************00230000
002400 ENVIRONMENT DIVISION.                                            00240000
002500******************************************************************00250000
002600                                                                  00260000
002700 CONFIGURATION SECTION.                                           00270000
002800                                                                  00280000
002900 SOURCE-COMPUTER.        IBM-3090.                                00290000
003000 OBJECT-COMPUTER.        IBM-3090.                                00300000
003100                                                                  00310000
003200 INPUT-OUTPUT SECTION.                                            00320000
003300                                                                  00330000
003400 FILE-CONTROL.                                                    00340000
003500                                                                  00350000
003600                                                                  00360000
003700     SELECT INPUT-FILE                                            00370000
003800         ASSIGN TO IN01.                                          00380000
003900                                                                  00390000
004000******************************************************************00400000
004100 DATA DIVISION.                                                   00410000
004200******************************************************************00420000
004300                                                                  00430000
004400 FILE SECTION.                                                    00440000
004500                                                                  00450000
004600 FD  INPUT-FILE                                                   00460000
004700     RECORDING MODE IS F                                          00470000
004800     LABEL RECORDS ARE STANDARD                                   00480000
004900     BLOCK CONTAINS 0 RECORDS                                     00490009
004910     RECORD CONTAINS 80 CHARACTERS.                               00491012
005000                                                                  00500000
005100 01  INPUT-RECORD.                                                00510000
005200     05  INPUT-PO-NUMBER               PIC  9(08).                00520000
005300     05  FILLER                        PIC  X(04).                00530000
005400     05  INPUT-RECEIVER-NUMBER         PIC  9(08).                00540000
005500     05  FILLER                        PIC  X(04).                00550000
005600     05  INPUT-CREATE-COUNT            PIC  9(08).                00560000
005700         88  INPUT-CREATE-ALL                      VALUE 99999999.00570000
005710     05  FILLER                        PIC  X(04).                00571021
005720     05  INPUT-TK-NUMBER               PIC  X(08).                00572021
005721     05  FILLER                        PIC  X(04).                00572170
005722     05  INPUT-PO-LNE-NBR              PIC  9(08).                00572221
005800     05  FILLER                        PIC  X(24).                00580021
005900*                                                                 00590000
006000******************************************************************00600000
006100 WORKING-STORAGE SECTION.                                         00610000
006200******************************************************************00620000
006210                                                                  00621072
006300*                                                                 00630000
006400******************************************************************00640000
006500*  DB2 FORMATTED MESSAGE AREA                                     00650000
006600******************************************************************00660000
006700     COPY DPWS004.                                                00670000
006800*                                                                 00680000
006900*                                                                 00690000
007000     COPY SQLCA2.                                                 00700000
007100*----------------------------------------------------------------*00710001
007200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      00720001
007300*  TABLE                                                          00730001
007400*----------------------------------------------------------------*00740001
007500     EXEC SQL                                                     00750001
007600         INCLUDE TSHPUNT                                          00760001
007700     END-EXEC.                                                    00770001
007800                                                                  00780001
007900*----------------------------------------------------------------*00790001
008000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT UPC  00800001
008100*  TABLE                                                          00810001
008200*----------------------------------------------------------------*00820001
008300     EXEC SQL                                                     00830001
008400         INCLUDE TSHUUPC                                          00840001
008500     END-EXEC.                                                    00850001
008600                                                                  00860001
009500*----------------------------------------------------------------*00950001
009600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE INBOUND EDI PACKSLI00960001
009700*  VENDOR SHIPMENT UNIT ASSOCIATION TABLE                         00970001
009800*----------------------------------------------------------------*00980001
009900     EXEC SQL                                                     00990001
010000         INCLUDE TINPKSU                                          01000001
010100     END-EXEC.                                                    01010001
010200                                                                  01020001
011000*----------------------------------------------------------------*01100001
011100*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE PO TABLE           01110001
011200*----------------------------------------------------------------*01120001
011300     EXEC SQL                                                     01130001
011400         INCLUDE TPURCHS                                          01140001
011500     END-EXEC.                                                    01150001
011600                                                                  01160001
014500*----------------------------------------------------------------*01450001
014600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE LABEL PRINT DATA  *01460001
014700*  TABLE                                                         *01470001
014800*----------------------------------------------------------------*01480001
014900     EXEC SQL                                                     01490001
015000         INCLUDE TLBPTDA                                          01500001
015100     END-EXEC.                                                    01510001
015200                                                                  01520001
015201*----------------------------------------------------------------*01520170
015202*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE CARTON CROSS-     *01520201
015203*  REFERENCE TABLE                                               *01520301
015204*----------------------------------------------------------------*01520401
015205     EXEC SQL                                                     01520501
015206         INCLUDE TSULBXF                                          01520601
015207     END-EXEC.                                                    01520701
015208                                                                  01520801
015300*----------------------------------------------------------------*01530001
015400*  DCLGEN LAYOUT AND COBOL DECLARATION                           *01540001
015500*----------------------------------------------------------------*01550001
015600     EXEC SQL                                                     01560001
015700         INCLUDE TVHTRIP                                          01570001
015800     END-EXEC.                                                    01580001
015900                                                                  01590001
016000*----------------------------------------------------------------*01600001
016100*  DCLGEN LAYOUT AND COBOL DECLARATION                           *01610001
016200*----------------------------------------------------------------*01620001
016300     EXEC SQL                                                     01630001
016400         INCLUDE TSHIPMT                                          01640001
016500     END-EXEC.                                                    01650001
016600                                                                  01660001
016700*----------------------------------------------------------------*01670001
016800*  DCLGEN LAYOUT AND COBOL DECLARATION                           *01680001
016900*----------------------------------------------------------------*01690001
017000     EXEC SQL                                                     01700001
017100         INCLUDE TSHPTPO                                          01710001
017200     END-EXEC.                                                    01720001
017300                                                                  01730001
018100*----------------------------------------------------------------*01810001
018200*  DCLGEN LAYOUT AND COBOL DECLARATION                           *01820001
018300*----------------------------------------------------------------*01830001
018400     EXEC SQL                                                     01840001
018500         INCLUDE TPKSLIP                                          01850001
018600     END-EXEC.                                                    01860001
018700                                                                  01870001
019500*----------------------------------------------------------------*01950001
019600*  DCLGEN LAYOUT AND COBOL DECLARATION                           *01960001
019700*----------------------------------------------------------------*01970001
019800     EXEC SQL                                                     01980001
019900         INCLUDE TRECITM                                          01990001
020000     END-EXEC.                                                    02000001
020100                                                                  02010001
020200*----------------------------------------------------------------*02020001
020300*  DCLGEN LAYOUT AND COBOL DECLARATION                           *02030001
020400*----------------------------------------------------------------*02040001
020500     EXEC SQL                                                     02050001
020600         INCLUDE TPURITM                                          02060001
020700     END-EXEC.                                                    02070001
020800                                                                  02080001
020900*----------------------------------------------------------------*02090001
021000*  DCLGEN LAYOUT AND COBOL DECLARATION                           *02100001
021100*----------------------------------------------------------------*02110001
021200     EXEC SQL                                                     02120001
021300         INCLUDE TVNDDPT                                          02130001
021400     END-EXEC.                                                    02140001
021500                                                                  02150001
021600*----------------------------------------------------------------*02160001
021700*  DCLGEN LAYOUT AND COBOL DECLARATION FOR SEASONAL SET TABLE    *02170001
021800*----------------------------------------------------------------*02180001
021900     EXEC SQL                                                     02190001
022000         INCLUDE TSEASET                                          02200001
022100     END-EXEC.                                                    02210001
022110                                                                  02211006
022120*----------------------------------------------------------------*02212006
022130*  DCLGEN LAYOUT AND COBOL DECLARATION FOR COMPANRY CONTROL TABLE*02213006
022140*----------------------------------------------------------------*02214006
022150     EXEC SQL                                                     02215006
022160         INCLUDE TCOCNTL                                          02216006
022170     END-EXEC.                                                    02217006
022200                                                                  02220001
022210*----------------------------------------------------------------*02221072
022220*  DCLGEN LAYOUT AND COBOL DECLARATION FOR PARM TABLE            *02222072
022230*----------------------------------------------------------------*02223072
022240     EXEC SQL                                                     02224072
022250         INCLUDE TKRPRPM                                          02225072
022260     END-EXEC.                                                    02226072
022270                                                                  02227072
022300*----------------------------------------------------------------*02230001
022400*  COMMUNICATIONS AREA FOR DB2                                    02240001
022500*----------------------------------------------------------------*02250001
022600     EXEC SQL                                                     02260001
022700         INCLUDE SQLCA                                            02270001
022800     END-EXEC.                                                    02280001
022900                                                                  02290001
023000*                                                                 02300000
023100 01  ABEND-CODE                      PIC S9(04)    VALUE +0       02310000
023200                                                   COMP SYNC.     02320000
023300                                                                  02330000
023400 01  PS-PROGRAM-SWITCHES.                                         02340000
023500     05  PS-EOF-SW                   PIC  X(01)    VALUE 'N'.     02350000
023600         88  PS-EOF                                VALUE 'Y'.     02360000
023700         88  PS-NOT-EOF                            VALUE 'N'.     02370000
023800     05  PS-END-OF-CURSOR-SW        PIC   X(01)    VALUE 'N'.     02380001
023900         88  PS-END-OF-CURSOR                      VALUE 'Y'.     02390001
024000         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     02400001
024100     05  PS-CURSOR-COMPLETE-SW      PIC   X(01)    VALUE 'N'.     02410001
024200         88  PS-CURSOR-COMPLETE                    VALUE 'Y'.     02420001
024300         88  PS-CURSOR-NOT-COMPLETE                VALUE 'N'.     02430001
024400     05  PS-NEW-RECEIVER-SW         PIC   X(01)    VALUE 'Y'.     02440016
024500         88  PS-NEW-RECEIVER                       VALUE 'Y'.     02450001
024600         88  PS-NOT-NEW-RECEIVER                   VALUE 'N'.     02460001
024700                                                                  02470000
024800 01  DK-DB2-KEYS.                                                 02480002
024900     05  DK-CTN                          PIC  S9(18)V COMP-3.     02490002
025000     05  DK-BARCODE.                                              02500070
025100      10  FILLER                      PIC  X(02) VALUE '00'.      02510070
025200      10  DK-BCDE                     PIC  9(18) VALUE ZEROES.    02520070
025300      10  FILLER                      PIC  X(02) VALUE SPACES.    02530070
025301     05  DK-BARCODE-2                    PIC  X(22).              02530170
025302     05  DK-CURR-OPER-UNT-ID             PIC  S9(04)  COMP.       02530202
025303     05  DK-OPER-UNT-ID                  PIC  S9(04)  COMP.       02530302
025304     05  DK-FCLTY-ID                     PIC  S9(04)  COMP.       02530402
025305     05  DK-MANIFEST                     PIC  S9(09)  COMP.       02530502
025400     05  DK-BATCH-NUMBER                 PIC  S9(04)  COMP.       02540002
025500     05  DK-PO-NBR                       PIC  S9(09)  COMP.       02550002
025600     05  DK-STORE                        PIC  S9(04)  COMP.       02560002
025700     05  DK-REC-SEQ-NBR                  PIC  S9(09)  COMP.       02570017
025800     05  DK-PO-LNE-NBR                   PIC  S9(09)  COMP.       02580002
025900                                                                  02590002
025901 01  DN-DB2-NULL-INDICATORS.                                      02590106
025910     05  DN-VEH-NBR                      PIC S9(04)   VALUE +0    02591006
025920                                                      COMP.       02592006
026000 01  PC-PROGRAM-CONSTANTS.                                        02600000
026100     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          02610000
026200         'SUKUP991'.                                              02620000
026300     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       02630000
026400                                                   COMP SYNC.     02640000
026500                                                                  02650000
026600     05  PC-COMMIT-HOLD              PIC 9(3)      VALUE 100.     02660000
026700     05  PC-C                        PIC X(1)      VALUE 'C'.     02670000
026800     05  PC-D                        PIC X(1)      VALUE 'D'.     02680000
026900     05  PC-V                        PIC X(1)      VALUE 'V'.     02690000
026910     05  PC-90                       PIC S9(04)    COMP           02691072
026911                                                   VALUE 90.      02691173
026912     05  PC-RCV                      PIC  X(03)    VALUE 'RCV'.   02691272
026913     05  PC-KHL                      PIC  X(03)    VALUE 'KHL'.   02691372
026914     05  PC-PRDCHK                   PIC  X(06)    VALUE 'PRDCHK'.02691472
026915     05  PC-PARM-TEXT                PIC  X(25)    VALUE          02691572
026916         'LOWER LEVEL ONLY         '.                             02691672
026920                                                                  02692073
027020 01  WS-LOCAL-SERVER.                                             02702072
027030     05  WS-SUBSYS                   PIC X(04)  VALUE SPACES.     02703072
027040     05  FILLER                      PIC X(12)  VALUE SPACES.     02704072
027050                                                                  02705072
027100 01  PV-PROGRAM-VARIABLES.                                        02710000
027200     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACES.  02720000
027300     05  PV-DB2-OPERATION-ATTEMPTED  PIC  X(30)    VALUE SPACES.  02730000
027400     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             02740000
027500     05  PV-DISPLAY-SQLCODE             PIC -9(03).               02750070
027501     05  PV-DISPLAY-TRIP                PIC  Z(09).               02750170
027502                                                                  02750200
027600     05  PV-CHECK-ROWS-PROCESSED     PIC S9(09)  VALUE +0         02760004
027610                                                    COMP SYNC.    02761003
027611     05  PV-ROWS-PROCESSED           PIC S9(09)  VALUE +0         02761104
027612                                                    COMP SYNC.    02761204
027613     05  PV-ROWS-INSERTED            PIC S9(09)  VALUE +0         02761304
027614                                                    COMP SYNC.    02761404
027615     05  PV-INSERT-COUNT             PIC S9(09)  VALUE +0         02761570
027616                                                    COMP SYNC.    02761604
027620     05  PV-NOTFND-COUNT             PIC S9(04)  VALUE +0         02762003
027700                                                    COMP SYNC.    02770000
027800     05  PV-READ-COUNT               PIC S9(04)  VALUE +0         02780000
027900                                                    COMP SYNC.    02790000
028000     05  PV-UPDATE-COUNT             PIC S9(04)  VALUE +0         02800000
028100                                                    COMP SYNC.    02810000
028200     05  PV-UPDATE-COUNTER           PIC S9(04)  VALUE +0         02820000
028300                                                    COMP SYNC.    02830000
028400     05  PV-COMMIT-COUNT             PIC S9(04)  VALUE +0         02840000
028500                                                    COMP SYNC.    02850000
028600     05  PV-COMMIT-COUNTER           PIC 9(03)   VALUE ZERO.      02860000
028700     05  PV-NEW-STORE                PIC S9(4)   VALUE +0         02870000
028800                                                   COMP.          02880000
028900     05  PV-CURRENT-DB2-TIME         PIC X(08).                   02890005
028910                                                                  02891005
028920     05  PV-CURRENT-DB2-TIMEX.                                    02892005
029000         10  PV-CURRENT-HH           PIC 9(02).                   02900001
029100         10  FILLER                  PIC X(01).                   02910001
029200         10  PV-CURRENT-MM           PIC 9(02).                   02920001
029300         10  FILLER                  PIC X(01).                   02930001
029400         10  PV-CURRENT-SS           PIC 9(02).                   02940001
029500                                                                  02950001
029600     05  PV-HOLD-TIME.                                            02960001
029700         10  PV-HOLD-MM              PIC 9(02).                   02970001
029800         10  PV-HOLD-SS              PIC 9(02).                   02980001
029900                                                                  02990001
030000     05  PV-HOLD-TIME-R REDEFINES PV-HOLD-TIME.                   03000070
030100         10  PV-NEW-BATCH-NBR        PIC 9(04).                   03010001
030110                                                                  03011007
030200     05  PV-VEND-STYL-NAME               PIC  X(20) VALUE SPACES. 03020002
030300     05  PV-DEPT-NUMBER                  PIC  X(03) VALUE SPACES. 03030002
030400     05  PV-CL-NBR                       PIC  X(02) VALUE SPACES. 03040002
030500     05  PV-SKU-SEQ-NBR                  PIC  X(03) VALUE SPACES. 03050002
030600     05  PV-SKU.                                                  03060002
030700         10  PV-DEPT-NBR                 PIC  X(03) VALUE SPACES. 03070002
030800         10  PV-SKU-DASH-1               PIC  X(01) VALUE SPACE.  03080002
030900         10  PV-CLASS-NBR                PIC  X(02) VALUE SPACES. 03090002
031000         10  PV-SKU-DASH-2               PIC  X(01) VALUE SPACE.  03100002
031100         10  PV-SKU-NBR                  PIC  X(03) VALUE SPACES. 03110002
031200     05  PV-INNR-PACK-QTY                PIC  S9(5) VALUE ZEROES  03120002
031300                                                    COMP.         03130002
031400     05  PV-OUTR-PACK-QTY                PIC  S9(5) VALUE ZEROES  03140002
031500                                                    COMP.         03150002
031600     05  PV-SHIPPED-QTY                  PIC  S9(9) VALUE ZEROES  03160002
031700                                                    COMP.         03170002
031800     05  PV-BAR-CODE                     PIC  X(20) VALUE ZEROES. 03180007
031900     05  PV-BAR-CODE-R  REDEFINES  PV-BAR-CODE.                   03190002
032000         10 PV-BAR-CODE-1-2              PIC  9(02).              03200007
032100         10 PV-BAR-CODE-3-20             PIC  9(18).              03210002
032600                                                                  03260001
032700                                                                  03270000
032800 01  PV-COMMIT-INFO.                                              03280000
032900     05  FILLER                      PIC X(25) VALUE              03290000
033000        ' CARTON NUMBER: '.                                       03300000
033100     05  PV-COMMIT-KEY.                                           03310000
033200         10  PV-COMMIT-CART-NBR      PIC 9(18).                   03320000
033300     05  FILLER                      PIC X(24) VALUE SPACE.       03330000
033400     05  FILLER                      PIC X(22) VALUE              03340000
033500        ' # RECS UPDATED     : '.                                 03350000
033600     05  PV-RECS-UPDATED-COUNT       PIC 9(7)  VALUE 0.           03360000
033700*                                                                 03370000
033800                                                                  03380001
033900                                                                  03390001
034000     EXEC SQL                                                     03400001
034100       DECLARE RCVR-CARTON-CSR CURSOR FOR                         03410001
034200         SELECT A.SHIPT_UNT_ID,                                   03420001
034300                A.ORGN_OPER_UNT_ID,                               03430001
034400                A.DEST_OPER_UNT_ID,                               03440001
034500                C.PO_NBR,                                         03450001
034600                C.SEQ_NBR                                         03460001
034700          FROM  TSHPUNT A                                         03470001
034800              , TINPKSU C                                         03480001
034900              , TPKSLIP D                                         03490001
035000          WHERE C.PO_NBR            = :DK-PO-NBR                  03500001
035100            AND D.PO_NBR            = C.PO_NBR                    03510001
035200            AND D.SEQ_NBR           = C.SEQ_NBR                   03520001
035300            AND D.REC_SEQ_NBR       = :DK-REC-SEQ-NBR             03530001
035400            AND D.VER_STAT_CDE      = 'A'                         03540001
035500            AND A.SHIPT_UNT_ID      = C.SHIPT_UNT_ID              03550001
035600          ORDER BY A.SHIPT_UNT_ID                                 03560001
035700     END-EXEC.                                                    03570001
035800*                                                                 03580001
035900     EXEC SQL                                                     03590070
035901       DECLARE RCVR-LNE-CTN-CSR CURSOR FOR                        03590170
035902         SELECT A.SHIPT_UNT_ID,                                   03590201
035903                A.ORGN_OPER_UNT_ID,                               03590301
035904                A.DEST_OPER_UNT_ID,                               03590401
035905                C.PO_NBR,                                         03590501
035906                C.SEQ_NBR                                         03590601
035907          FROM  TSHPUNT A                                         03590701
035908              , TINPKSU C                                         03590801
035909              , TPKSLIP D                                         03590901
035910              , TSHUUPC E                                         03591001
035911          WHERE C.PO_NBR            = :DK-PO-NBR                  03591101
035912            AND D.PO_NBR            = C.PO_NBR                    03591201
035913            AND D.SEQ_NBR           = C.SEQ_NBR                   03591301
035914            AND D.REC_SEQ_NBR       = :DK-REC-SEQ-NBR             03591401
035915            AND D.VER_STAT_CDE      = 'A'                         03591501
035916            AND A.SHIPT_UNT_ID      = C.SHIPT_UNT_ID              03591601
035917            AND A.SHIPT_UNT_ID      = E.SHIPT_UNT_ID              03591701
035918            AND E.TRN_LNE_NBR       = :DK-PO-LNE-NBR              03591870
035919          ORDER BY A.SHIPT_UNT_ID                                 03591901
035920     END-EXEC.                                                    03592001
035921*                                                                 03592101
035922******************************************************************03592200
036000 PROCEDURE DIVISION.                                              03600000
036100******************************************************************03610000
036200                                                                  03620000
036300 0000-PROGRAM-MAINLINE.                                           03630000
036400******************************************************************03640000
036500* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     03650000
036600*      PROGRAM.                                                   03660000
036700******************************************************************03670000
036800                                                                  03680000
036810*    DISPLAY '** START OF SUKUP991 **'.                           03681020
036900     PERFORM 1000-INITIALIZE.                                     03690000
037000     PERFORM 2000-PROCESS-INPUT                                   03700000
037100       UNTIL PS-EOF.                                              03710000
037200     PERFORM 9000-EOJ-ROUTINE.                                    03720000
037300                                                                  03730000
037400     STOP RUN.                                                    03740000
037700                                                                  03770014
037800 1000-INITIALIZE.                                                 03780000
037900******************************************************************03790000
038000*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    03800000
038100******************************************************************03810000
038200                                                                  03820000
038201     PERFORM 1100-GET-DB2-INSTANCE.                               03820172
038202     PERFORM 1200-CHECK-IF-PRODUCTION.                            03820272
038203                                                                  03820372
038210*    DISPLAY '** START OF 1000-INITIALIZE **'.                    03821020
038300     OPEN INPUT INPUT-FILE.                                       03830001
038400                                                                  03840000
038500     MOVE +0 TO PV-COMMIT-COUNTER                                 03850000
038501                PV-INSERT-COUNT.                                  03850170
038502                                                                  03850219
038510     PERFORM 4100-GET-BATCH-ID.                                   03851019
038600                                                                  03860000
038700     PERFORM 7000-READ-INPUT.                                     03870000
038800                                                                  03880000
038810*    DISPLAY '** DONE WITH 1000-INITIALIZE **'.                   03881020
038811                                                                  03881172
038820 1100-GET-DB2-INSTANCE.                                           03882072
038830                                                                  03883072
038840     MOVE '1100-GET-DB2-INSTANCE'                                 03884072
038850          TO PV-PARAGRAPH-NAME.                                   03885072
038860     MOVE 'GET DB2 INSTANCE'                                      03886072
038870          TO PV-DB2-OPERATION-ATTEMPTED.                          03887072
038880                                                                  03888072
038890     EXEC SQL                                                     03889072
038891         SELECT CURRENT SERVER INTO :WS-LOCAL-SERVER              03889172
038892             FROM SYSIBM.SYSDUMMY1 WITH UR                        03889272
038893     END-EXEC.                                                    03889372
038894                                                                  03889472
038895     EVALUATE TRUE                                                03889572
038896         WHEN SQLCODE = +0                                        03889672
038897             CONTINUE                                             03889772
038898         WHEN SQLWARN0 NOT = SPACES                               03889872
038899         WHEN SQLCODE < +0                                        03889972
038900         WHEN SQLCODE > +0                                        03890072
038901             PERFORM 9100-SQL-ABEND                               03890172
038902     END-EVALUATE.                                                03890272
038903*                                                                 03890372
038904 1200-CHECK-IF-PRODUCTION.                                        03890472
038905                                                                  03890572
038906     MOVE '1200-CHECK-IF-PRODUCTION'                              03890672
038907          TO PV-PARAGRAPH-NAME.                                   03890772
038908     MOVE 'SELECT PRDCHK TKRPRPM '                                03890872
038909          TO PV-DB2-OPERATION-ATTEMPTED.                          03890972
038910                                                                  03891072
038911     EXEC SQL                                                     03891172
038912       SELECT FUNC_TXT                                            03891272
038913         INTO :KRPRPM-FUNC-TXT                                    03891372
038914       FROM   TKRPRPM                                             03891472
038915       WHERE  SYS_PRC_FUNC_CDE  = :PC-PRDCHK                      03891572
038916         AND  INTFC_SYS_CDE     = :PC-KHL                         03891672
038917         AND  LOC_ID            = :PC-90                          03891772
038918         AND  FUNC_TXT          = :PC-PARM-TEXT                   03891872
038919     END-EXEC                                                     03891972
038920                                                                  03892072
038921     EVALUATE TRUE                                                03892172
038922         WHEN SQLCODE = +0                                        03892272
038923             CONTINUE                                             03892372
038924         WHEN SQLCODE = +100                                      03892472
038925             DISPLAY '*******************************************'03892572
038926             DISPLAY '** ABEND - DO NOT RUN THIS SUKUP991 PROGRAM'03892672
038927             DISPLAY '** ABEND - AGAINST PRODUCTION'              03892772
038928             DISPLAY '** ABEND - THIS SHOULD ONLY EVER BE'        03892872
038929             DISPLAY '** ABEND - RUN AGAINST TEST DATA'           03892972
038930             DISPLAY '*******************************************'03893072
038931             DISPLAY '** ABEND - THIS RUN IS GOING AGAINST'       03893172
038932             DISPLAY '** ABEND - DB2 INSTANCE:  '                 03893272
038933                     WS-LOCAL-SERVER                              03893372
038934             DISPLAY '*******************************************'03893472
038935             PERFORM 9100-SQL-ABEND                               03893572
038936                                                                  03893672
038937         WHEN SQLWARN0 NOT = SPACES                               03893772
038938         WHEN SQLCODE < +0                                        03893872
038939         WHEN SQLCODE > +0                                        03893972
038940             PERFORM 9100-SQL-ABEND                               03894072
038941     END-EVALUATE.                                                03894172
038942                                                                  03894272
038950 2000-PROCESS-INPUT.                                              03895000
039000******************************************************************03900000
039100*  RETRIEVE DATA FOR THE PO/RECEIVER FROM THE INPUT FILE AND WRITE03910001
039200*  TO THE LABEL DATA TABLE FOR CARTONS ASSOCIATED TO THE INPUT    03920001
039300*  RECORD.                                                        03930001
039400******************************************************************03940000
039401                                                                  03940114
039410*    DISPLAY '** START OF 2000-PROCESS-INPUT'.                    03941020
039500                                                                  03950000
039600     PERFORM 3000-OPEN-CURSOR.                                    03960001
039700                                                                  03970000
039800     SET PS-NOT-END-OF-CURSOR TO TRUE.                            03980001
039900     SET PS-CURSOR-NOT-COMPLETE TO TRUE.                          03990001
040000     SET PS-NEW-RECEIVER TO TRUE.                                 04000001
040100                                                                  04010001
040200     PERFORM 3100-FETCH-CURSOR.                                   04020001
040300                                                                  04030001
040400     DISPLAY 'PROCESS CURSOR SWITCH '  PS-CURSOR-COMPLETE-SW      04040070
040401     DISPLAY 'END OF CURSOR  SWITCH '  PS-END-OF-CURSOR-SW        04040170
040402                                                                  04040201
040403     PERFORM 3200-PROCESS-CURSOR                                  04040301
040500         UNTIL PS-CURSOR-COMPLETE                                 04050001
040600            OR PS-END-OF-CURSOR.                                  04060001
040700                                                                  04070001
040800     PERFORM 3400-CLOSE-CURSOR.                                   04080001
040900                                                                  04090001
041000     EXEC SQL                                                     04100001
041100        COMMIT                                                    04110001
041200     END-EXEC.                                                    04120001
041300                                                                  04130001
041400     IF SQLCODE NOT = +0                                          04140001
041500         DISPLAY '### COMMIT FAILED ! ###'                        04150001
041600         PERFORM 9100-SQL-ABEND                                   04160001
041700     END-IF.                                                      04170001
041800                                                                  04180001
041900     PERFORM 7000-READ-INPUT.                                     04190001
042000                                                                  04200001
042100                                                                  04210000
042200 3000-OPEN-CURSOR.                                                04220001
042300                                                                  04230001
042320*    DISPLAY '** START OF 3000-OPEN-CURSOR'.                      04232020
042330                                                                  04233014
042400     MOVE '3000-OPEN-CURSOR   '                                   04240001
042500                                 TO PV-PARAGRAPH-NAME.            04250007
042600*    DISPLAY 'INPUT PO LINE NBR ' INPUT-PO-LNE-NBR.               04260070
042700                                                                  04270070
042800     IF INPUT-PO-LNE-NBR > 0                                      04280070
042900        MOVE INPUT-PO-LNE-NBR TO DK-PO-LNE-NBR                    04290070
043000*       DISPLAY 'DK    PO LINE NBR' DK-PO-LNE-NBR                 04300070
043100        EXEC SQL                                                  04310070
043200            OPEN RCVR-LNE-CTN-CSR                                 04320070
043300        END-EXEC                                                  04330070
043400*       DISPLAY 'OPENED LINE CURSOR '                             04340070
043500     ELSE                                                         04350070
043600        EXEC SQL                                                  04360070
043700            OPEN RCVR-CARTON-CSR                                  04370070
043800        END-EXEC                                                  04380070
043900*       DISPLAY 'OPENED CART CURSOR '                             04390070
043901     END-IF.                                                      04390170
043902                                                                  04390201
043903     EVALUATE TRUE                                                04390301
043904       WHEN SQLCODE = ZEROS                                       04390401
043905         CONTINUE                                                 04390501
043906       WHEN OTHER                                                 04390601
043907         DISPLAY PV-PARAGRAPH-NAME                                04390707
043908         PERFORM 9100-SQL-ABEND                                   04390801
043909     END-EVALUATE.                                                04390901
043910                                                                  04391001
043911 3100-FETCH-CURSOR.                                               04391101
043912                                                                  04391201
043920*    DISPLAY '** START OF 3100-FETCH-CURSOR'.                     04392020
043930                                                                  04393015
044000     MOVE '3100-FETCH-CURSOR   '                                  04400001
044100                                 TO PV-PARAGRAPH-NAME.            04410007
044200*    DISPLAY 'INPUT PO LINE NBR ' INPUT-PO-LNE-NBR.               04420070
044300     IF INPUT-PO-LNE-NBR > 0                                      04430070
044400        EXEC SQL                                                  04440070
044500             FETCH RCVR-LNE-CTN-CSR                               04450070
044600             INTO   :SHPUNT-SHIPT-UNT-ID,                         04460070
044700                    :SHPUNT-ORGN-OPER-UNT-ID,                     04470070
044800                    :SHPUNT-DEST-OPER-UNT-ID,                     04480070
044900                    :INPKSU-PO-NBR,                               04490070
045000                    :INPKSU-SEQ-NBR                               04500070
045100        END-EXEC                                                  04510070
045200*       DISPLAY 'FETCH LINE CURSOR '                              04520070
045300     ELSE                                                         04530070
045400        EXEC SQL                                                  04540070
045500             FETCH RCVR-CARTON-CSR                                04550070
045600             INTO   :SHPUNT-SHIPT-UNT-ID,                         04560070
045700                    :SHPUNT-ORGN-OPER-UNT-ID,                     04570070
045800                    :SHPUNT-DEST-OPER-UNT-ID,                     04580070
045900                    :INPKSU-PO-NBR,                               04590070
046000                    :INPKSU-SEQ-NBR                               04600070
046100        END-EXEC                                                  04610070
046200*       DISPLAY 'FETCH CART CURSOR '                              04620070
046201     END-IF.                                                      04620170
046202                                                                  04620201
046203*    MOVE SQLCODE TO PV-DISPLAY-COUNT.                            04620370
046204*    DISPLAY 'SQLCODE = ' PV-DISPLAY-COUNT.                       04620470
046205                                                                  04620570
046206     EVALUATE TRUE                                                04620601
046207       WHEN SQLCODE = ZEROS                                       04620701
046208         CONTINUE                                                 04620801
046209       WHEN SQLCODE = +100                                        04620901
046210           SET PS-END-OF-CURSOR TO TRUE                           04621001
046211       WHEN OTHER                                                 04621101
046212         DISPLAY PV-PARAGRAPH-NAME                                04621207
046213         PERFORM 9100-SQL-ABEND                                   04621301
046214     END-EVALUATE.                                                04621401
046215                                                                  04621501
046216 3200-PROCESS-CURSOR.                                             04621601
046217                                                                  04621716
046218*    DISPLAY '** START OF 3200-PROCESS-CURSOR'.                   04621820
046219                                                                  04621901
046300     IF  PS-NEW-RECEIVER                                          04630001
046310         MOVE ZEROS TO PV-ROWS-PROCESSED                          04631004
046320         SET PS-NOT-NEW-RECEIVER TO TRUE                          04632016
046400         PERFORM 4000-GET-TRIP-INFO                               04640071
046420         MOVE VHTRIP-TRIP-ID TO                                   04642071
046421              LBPTDA-TRIP-ID                                      04642171
046422              PV-DISPLAY-TRIP                                     04642271
046430         MOVE VHTRIP-OWNER-SCAC-ID TO                             04643071
046431              LBPTDA-OWNR-SCAC-ID                                 04643171
046440         MOVE VHTRIP-VEH-NBR TO                                   04644071
046450              LBPTDA-VEH-NBR                                      04645071
046500*        PERFORM 4100-GET-BATCH-ID                                04650019
046510         ADD 1 TO PV-NEW-BATCH-NBR                                04651019
046600         DISPLAY 'PO NUMBER '                                     04660001
046700                 INPUT-PO-NUMBER                                  04670001
046800                 ', RECEVIER NUMBER '                             04680001
046900                 INPUT-RECEIVER-NUMBER                            04690001
047000                 ' HAS BEEN ATTACHED TO TRIP ID '                 04700071
047010                 PV-DISPLAY-TRIP                                  04701071
047100                 ' WITH BATCH NUMBER '                            04710071
047200                 PV-NEW-BATCH-NBR                                 04720001
047300     END-IF.                                                      04730001
047400                                                                  04740001
047500     IF PV-INSERT-COUNT > 100                                     04750070
047600        ADD +1 TO PV-NEW-BATCH-NBR                                04760070
047700        DISPLAY 'PO NUMBER '                                      04770070
047800                INPUT-PO-NUMBER                                   04780070
047900                ', RECEVIER NUMBER '                              04790070
048000                INPUT-RECEIVER-NUMBER                             04800070
048100                ' HAS BEEN ATTACHED TO TRIP ID '                  04810071
048110                PV-DISPLAY-TRIP                                   04811071
048200                ' WITH BATCH NUMBER '                             04820071
048300                PV-NEW-BATCH-NBR                                  04830070
048400        MOVE 0 TO PV-INSERT-COUNT                                 04840070
048401     END-IF.                                                      04840170
048402                                                                  04840201
048403*    MOVE 121011809  TO                                           04840371
048404*         LBPTDA-TRIP-ID                                          04840471
048405*    MOVE 'SCNN' TO                                               04840571
048406*         LBPTDA-OWNR-SCAC-ID                                     04840671
048407*    MOVE 'TA946410'  TO                                          04840771
048408*         LBPTDA-VEH-NBR                                          04840871
048409*                                                                 04840971
048410*    MOVE  LBPTDA-TRIP-ID  TO  PV-DISPLAY-TRIP                    04841071
048420     INITIALIZE LBPTDA-MDSE-PGM-DESC                              04842070
048430     MOVE 35                        TO LBPTDA-MDSE-PGM-DESC-LEN.  04843070
048440     STRING  LBPTDA-OWNR-SCAC-ID '/'                              04844070
048450             LBPTDA-VEH-NBR                                       04845070
048460             ' TRIP:' PV-DISPLAY-TRIP                             04846070
048470             DELIMITED BY SIZE                                    04847070
048471                  INTO LBPTDA-MDSE-PGM-DESC-TEXT                  04847170
048472                                                                  04847201
048473     MOVE INPUT-TK-NUMBER TO                                      04847321
048474          LBPTDA-CRE-USR-ID.                                      04847401
048475                                                                  04847501
048500     MOVE PV-NEW-BATCH-NBR TO                                     04850001
048600          LBPTDA-LBL-PRT-BTCH-ID.                                 04860001
048700                                                                  04870001
048710     MOVE 0 TO PV-BAR-CODE-1-2.                                   04871007
048800     MOVE SHPUNT-SHIPT-UNT-ID TO                                  04880001
048810          PV-BAR-CODE-3-20                                        04881002
048900          LBPTDA-SHIPT-UNT-ID.                                    04890001
049000                                                                  04900001
049001     MOVE PV-BAR-CODE TO                                          04900102
049010          LBPTDA-BRCDE-NBR.                                       04901002
049020                                                                  04902002
049100     MOVE 90 TO                                                   04910001
049200          LBPTDA-OPER-UNT-ID.                                     04920001
049300     MOVE 1 TO                                                    04930001
049400          LBPTDA-FCLTY-ID.                                        04940001
049500                                                                  04950001
049600*    LBPTDA-CRE-TMST                                              04960001
049700                                                                  04970001
049800     MOVE ' ' TO                                                  04980001
049900          LBPTDA-RPRT-IND                                         04990001
050000          LBPTDA-SU-DUP-LBL-IND                                   05000001
050100          LBPTDA-SU-FRE-ASTRA-IND                                 05010001
050200          LBPTDA-SU-MSSG-DAT-IND                                  05020001
050300          LBPTDA-INVLD-DAT-ERR-CDE                                05030001
050400          LBPTDA-ODD-CART-IND                                     05040001
050500          LBPTDA-INPK-CNVYB-IND                                   05050001
050600          LBPTDA-SU-MISDIR-IND.                                   05060001
050700                                                                  05070001
050800     MOVE 0 TO                                                    05080001
050900          LBPTDA-MISDIR-OPER-UNT-ID.                              05090001
051000                                                                  05100001
051100     MOVE INPUT-PO-NUMBER TO                                      05110001
051200          LBPTDA-PO-NBR.                                          05120001
051300     MOVE INPUT-RECEIVER-NUMBER TO                                05130001
051400          LBPTDA-RCVR-SEQ-NBR.                                    05140001
051500                                                                  05150002
051510     MOVE '000' TO PV-DEPT-NUMBER                                 05151002
051520                   PV-SKU-SEQ-NBR                                 05152002
051530                   PV-CL-NBR.                                     05153002
051531     MOVE SPACES TO PV-VEND-STYL-NAME.                            05153102
051540                                                                  05154002
051600     PERFORM 4200-GET-LINE-INFO.                                  05160002
051700                                                                  05170002
051710     MOVE PV-DEPT-NUMBER TO                                       05171002
051720          LBPTDA-SKU-DEPT-NBR.                                    05172002
051730     MOVE PV-CL-NBR TO                                            05173002
051740          LBPTDA-SKU-CL-NBR.                                      05174002
051750     MOVE PV-SKU-SEQ-NBR TO                                       05175002
051760          LBPTDA-SKU-NBR.                                         05176002
051761     MOVE PV-VEND-STYL-NAME TO                                    05176102
051770          LBPTDA-VS-NBR.                                          05177002
051900                                                                  05190001
052000     MOVE SHPUNT-DEST-OPER-UNT-ID TO                              05200001
052100          LBPTDA-DEST-OPER-UNT-ID.                                05210001
052200                                                                  05220001
052300     MOVE SPACES TO                                               05230001
052400          LBPTDA-MODU-DESC                                        05240001
052500          LBPTDA-SEASET-NM                                        05250001
052600          LBPTDA-FIXT-ID                                          05260001
052700          LBPTDA-STR-NM                                           05270001
052710          LBPTDA-DEPT-DESC                                        05271002
052720          LBPTDA-MAJ-CL-DESC                                      05272002
052800          LBPTDA-STR-ZN-ID.                                       05280001
052900                                                                  05290001
053000     MOVE PV-SHIPPED-QTY TO                                       05300002
053400          LBPTDA-OTPK-UNT-QTY.                                    05340002
053600                                                                  05360001
053700     MOVE '703' TO                                                05370001
053800          LBPTDA-PRTR-ID.                                         05380001
053900                                                                  05390001
054200     MOVE '90' TO                                                 05420001
054300          LBPTDA-DC-PRTD-AT-CDE.                                  05430001
054400                                                                  05440001
054900                                                                  05490001
055000     MOVE ZEROS TO                                                05500001
055001          LBPTDA-PREPK-ID                                         05500102
055002          LBPTDA-PREPK-RATO-QTY                                   05500202
055003          LBPTDA-PREPK-UNT-QTY                                    05500302
055004          LBPTDA-CSE-PK-QTY                                       05500402
055010          LBPTDA-INPK-UNT-QTY                                     05501002
055020          LBPTDA-ITM-NBR                                          05502002
055100          LBPTDA-LBL-TYP-LBL-SEQ-ID                               05510001
055200          LBPTDA-LBL-TYP-TOT-QTY.                                 05520001
055300                                                                  05530001
055400     MOVE 'S' TO                                                  05540002
055700          LBPTDA-CART-LBL-TYP-CDE.                                05570002
055710                                                                  05571070
055800                                                                  05580001
055810     EXEC SQL                                                     05581002
055820         INSERT INTO TLBPTDA                                      05582002
055830                ( TRIP_ID                                         05583002
055840                , CRE_USR_ID                                      05584002
055850                , LBL_PRT_BTCH_ID                                 05585002
055860                , SHIPT_UNT_ID                                    05586002
055870                , OPER_UNT_ID                                     05587002
055880                , FCLTY_ID                                        05588002
055890                , CRE_TMST                                        05589002
055891                , OWNR_SCAC_ID                                    05589102
055892                , VEH_NBR                                         05589202
055893                , RPRT_IND                                        05589302
055894                , SU_DUP_LBL_IND                                  05589402
055895                , SU_FRE_ASTRA_IND                                05589502
055896                , SU_MSSG_DAT_IND                                 05589602
055897                , SU_MISDIR_IND                                   05589702
055898                , MISDIR_OPER_UNT_ID                              05589802
055899                , PO_NBR                                          05589902
055900                , RCVR_SEQ_NBR                                    05590002
055901                , PO_LNE_NBR                                      05590102
055902                , DEST_OPER_UNT_ID                                05590202
055903                , STR_NM                                          05590302
055904                , STR_ZN_ID                                       05590402
055905                , SKU_DEPT_NBR                                    05590502
055906                , SKU_CL_NBR                                      05590602
055907*               , SKU_SEQ_NBR                                     05590702
055908                , VS_NBR                                          05590802
055909                , OTPK_UNT_QTY                                    05590902
055910                , INPK_UNT_QTY                                    05591002
055911                , PRTR_ID                                         05591102
055912                , BRCDE_NBR                                       05591202
055913                , DC_PRTD_AT_CDE                                  05591302
055914                , INVLD_DAT_ERR_CDE                               05591402
055915                , PREPK_ID                                        05591502
055916                , PREPK_RATO_QTY                                  05591602
055917                , PREPK_UNT_QTY                                   05591702
055918                , CSE_PK_QTY                                      05591802
055919                , ODD_CART_IND                                    05591902
055920                , INPK_CNVYB_IND                                  05592002
055921                , LBL_TYP_LBL_SEQ_ID                              05592102
055922                , LBL_TYP_TOT_QTY                                 05592202
055923                , MODU_DESC                                       05592302
055924                , ITM_NBR                                         05592402
055925                , DEPT_DESC                                       05592502
055926                , MAJ_CL_DESC                                     05592602
055927                , SEASET_NM                                       05592702
055928                , FIXT_ID                                         05592802
055929                , CART_LBL_TYP_CDE                                05592902
055930                , SKU_NBR                                         05593070
055931                , MDSE_PGM_DESC)                                  05593170
055932         VALUES                                                   05593202
055933                ( :LBPTDA-TRIP-ID                                 05593302
055934                , :LBPTDA-CRE-USR-ID                              05593402
055935                , :LBPTDA-LBL-PRT-BTCH-ID                         05593502
055936                , :LBPTDA-SHIPT-UNT-ID                            05593602
055937                , :LBPTDA-OPER-UNT-ID                             05593702
055938                , :LBPTDA-FCLTY-ID                                05593802
055939                ,  CURRENT TIMESTAMP                              05593902
055940                , :LBPTDA-OWNR-SCAC-ID                            05594002
055941                , :LBPTDA-VEH-NBR                                 05594102
055942                , :LBPTDA-RPRT-IND                                05594202
055943                , :LBPTDA-SU-DUP-LBL-IND                          05594302
055944                , :LBPTDA-SU-FRE-ASTRA-IND                        05594402
055945                , :LBPTDA-SU-MSSG-DAT-IND                         05594502
055946                , :LBPTDA-SU-MISDIR-IND                           05594602
055947                , :LBPTDA-MISDIR-OPER-UNT-ID                      05594702
055948                , :LBPTDA-PO-NBR                                  05594802
055949                , :LBPTDA-RCVR-SEQ-NBR                            05594902
055950                , :LBPTDA-PO-LNE-NBR                              05595002
055951                , :LBPTDA-DEST-OPER-UNT-ID                        05595102
055952                , :LBPTDA-STR-NM                                  05595202
055953                , :LBPTDA-STR-ZN-ID                               05595302
055954                , :LBPTDA-SKU-DEPT-NBR                            05595402
055955                , :LBPTDA-SKU-CL-NBR                              05595502
055956*               , :LBPTDA-SKU-SEQ-NBR                             05595602
055957                , :LBPTDA-VS-NBR                                  05595702
055958                , :LBPTDA-OTPK-UNT-QTY                            05595802
055959                , :LBPTDA-INPK-UNT-QTY                            05595902
055960                , :LBPTDA-PRTR-ID                                 05596002
055961                , :LBPTDA-BRCDE-NBR                               05596102
055962                , :LBPTDA-DC-PRTD-AT-CDE                          05596202
055963                , :LBPTDA-INVLD-DAT-ERR-CDE                       05596302
055964                , :LBPTDA-PREPK-ID                                05596402
055965                , :LBPTDA-PREPK-RATO-QTY                          05596502
055966                , :LBPTDA-PREPK-UNT-QTY                           05596602
055967                , :LBPTDA-CSE-PK-QTY                              05596702
055968                , :LBPTDA-ODD-CART-IND                            05596802
055969                , :LBPTDA-INPK-CNVYB-IND                          05596902
055970                , :LBPTDA-LBL-TYP-LBL-SEQ-ID                      05597002
055971                , :LBPTDA-LBL-TYP-TOT-QTY                         05597102
055972                , :LBPTDA-MODU-DESC                               05597202
055973                , :LBPTDA-ITM-NBR                                 05597302
055974                , :LBPTDA-DEPT-DESC                               05597402
055975                , :LBPTDA-MAJ-CL-DESC                             05597502
055976                , :LBPTDA-SEASET-NM                               05597602
055977                , :LBPTDA-FIXT-ID                                 05597702
055978                , :LBPTDA-CART-LBL-TYP-CDE                        05597802
055979                , :LBPTDA-SKU-NBR                                 05597902
055980                , :LBPTDA-MDSE-PGM-DESC)                          05598002
055981     END-EXEC.                                                    05598102
055982                                                                  05598202
055983     EVALUATE TRUE                                                05598302
055984         WHEN SQLCODE = ZERO                                      05598402
055985              ADD  1  TO  PV-ROWS-INSERTED                        05598503
055986                          PV-ROWS-PROCESSED                       05598604
055987         WHEN SQLWARN0 NOT = SPACES                               05598702
055988         WHEN SQLCODE NOT EQUAL ZERO                              05598802
055989              MOVE '3200-PROCESS-CURSOR'      TO                  05598903
055990                   PV-PARAGRAPH-NAME                              05599007
055991              DISPLAY PV-PARAGRAPH-NAME                           05599107
056000              PERFORM 9100-SQL-ABEND                              05600003
056003     END-EVALUATE.                                                05600302
056004                                                                  05600404
056005     IF  PV-ROWS-PROCESSED < PV-CHECK-ROWS-PROCESSED              05600504
056006         CONTINUE                                                 05600604
056007     ELSE                                                         05600704
056008         SET PS-CURSOR-COMPLETE TO TRUE                           05600804
056009     END-IF.                                                      05600904
056010                                                                  05601018
056020     MOVE SHPUNT-SHIPT-UNT-ID TO DK-BCDE.                         05602070
056021     MOVE DK-BARCODE TO DK-BARCODE-2.                             05602170
056022                                                                  05602218
319500     EXEC SQL                                                     31950070
319600         INSERT INTO TSULBXF                                      31960070
319700               ( SHIPT_UNT_ID                                     31970070
319800                ,BRCDE_NBR                                        31980070
319900                ,CART_LBL_TYP_CDE                                 31990070
320000                ,DEST_OPER_UNT_ID                                 32000070
320100                ,STAT_CDE                                         32010070
320200                ,LAST_STAT_CHG_TMST                               32020070
320300                ,CRE_TMST)                                        32030070
320400         VALUES (:SHPUNT-SHIPT-UNT-ID                             32040070
320500               , :DK-BARCODE-2                                    32050070
320600               , 'C'                                              32060070
320700               , 085                                              32070070
320800               , 'A'                                              32080070
320900               ,  CURRENT TIMESTAMP                               32090070
321000               ,  CURRENT TIMESTAMP)                              32100070
321100     END-EXEC                                                     32110070
321101     EVALUATE TRUE                                                32110170
321102         WHEN SQLCODE = ZERO                                      32110202
321103              ADD  1  TO  PV-ROWS-INSERTED                        32110303
321104*                         PV-ROWS-PROCESSED                       32110404
321105                          PV-INSERT-COUNT                         32110504
321106         WHEN SQLWARN0 NOT = SPACES                               32110602
321107         WHEN SQLCODE NOT EQUAL ZERO                              32110702
321108              MOVE 'INSERT TO SULBXF     '    TO                  32110803
321109                   PV-PARAGRAPH-NAME                              32110907
321110              DISPLAY PV-PARAGRAPH-NAME                           32111007
321111              PERFORM 9100-SQL-ABEND                              32111103
321112     END-EVALUATE.                                                32111202
321113                                                                  32111303
321114     PERFORM 3100-FETCH-CURSOR.                                   32111418
321115                                                                  32111570
321116                                                                  32111603
321117 3400-CLOSE-CURSOR.                                               32111707
321118                                                                  32111816
321119*    DISPLAY '** START OF 3400-CLOSE-CURSOR'.                     32111920
321120                                                                  32112007
321121     MOVE '3400-CLOSE-CURSOR  '                                   32112107
321122                                 TO PV-PARAGRAPH-NAME.            32112207
321123     IF INPUT-PO-LNE-NBR > 0                                      32112370
321124        EXEC SQL                                                  32112470
321125            CLOSE RCVR-LNE-CTN-CSR                                32112570
321126        END-EXEC                                                  32112670
321127     ELSE                                                         32112770
321128        EXEC SQL                                                  32112870
321129            CLOSE RCVR-CARTON-CSR                                 32112970
321130        END-EXEC                                                  32113070
321131     END-IF.                                                      32113170
321132                                                                  32113207
321133     EVALUATE TRUE                                                32113307
321134       WHEN SQLCODE = ZEROS                                       32113407
321135         CONTINUE                                                 32113507
321136       WHEN OTHER                                                 32113607
321137         DISPLAY PV-PARAGRAPH-NAME                                32113707
321138         PERFORM 9100-SQL-ABEND                                   32113807
321139     END-EVALUATE.                                                32113907
321140                                                                  32114007
321141 4000-GET-TRIP-INFO.                                              32114101
321142                                                                  32114201
321143     EXEC SQL                                                     32114301
321144          SELECT  DISTINCT                                        32114401
321145                  C.OWNER_SCAC_ID                                 32114505
321146                 ,C.VEH_NBR                                       32114601
321147                 ,C.TRIP_ID                                       32114701
321148            INTO :VHTRIP-OWNER-SCAC-ID                            32114801
321149                ,:VHTRIP-VEH-NBR :DN-VEH-NBR                      32114901
321150                ,:VHTRIP-TRIP-ID                                  32115001
321151            FROM  TSHPTPO A                                       32115101
321152                 ,TSHIPMT B                                       32115201
321153                 ,TVHTRIP C                                       32115301
321154        WHERE A.PO_NBR          = :DK-PO-NBR                      32115401
321155          AND A.REC_SEQ_NBR     = :DK-REC-SEQ-NBR                 32115501
321156          AND A.SHIPT_ID        = B.SHIPT_ID                      32115601
321157          AND B.TRIP_ID         = C.TRIP_ID                       32115701
321158     END-EXEC.                                                    32115801
321159                                                                  32115901
321160     EVALUATE TRUE                                                32116001
321161       WHEN SQLCODE = ZEROS                                       32116101
321162       WHEN SQLCODE = -811                                        32116270
321163         CONTINUE                                                 32116370
321164       WHEN SQLCODE = +100                                        32116470
321165         MOVE ZEROS TO VHTRIP-TRIP-ID                             32116570
321166         MOVE SPACES TO VHTRIP-OWNER-SCAC-ID                      32116670
321167                        VHTRIP-VEH-NBR                            32116770
321168       WHEN OTHER                                                 32116870
321169             DISPLAY '4000-GET-TRIP-INFO'                         32116970
321170             PERFORM 9100-SQL-ABEND                               32117070
321171     END-EVALUATE.                                                32117170
321172                                                                  32117270
321173 4100-GET-BATCH-ID.                                               32117370
321174                                                                  32117470
321175*    DISPLAY '** START OF 4100-GET-BATCH-ID'.                     32117570
321176                                                                  32117670
321177     EXEC SQL                                                     32117770
321178         SELECT CURRENT TIME                                      32117870
321179           INTO  :PV-CURRENT-DB2-TIME                             32117970
321180           FROM  TCOCNTL                                          32118070
321181          WHERE  OPER_UNT_ID = 90                                 32118170
321182     END-EXEC.                                                    32118270
321183                                                                  32118370
321184     EVALUATE TRUE                                                32118470
321185         WHEN SQLCODE = ZERO                                      32118570
321186             MOVE PV-CURRENT-DB2-TIME    TO PV-CURRENT-DB2-TIMEX  32118670
321187             MOVE PV-CURRENT-MM          TO PV-HOLD-MM            32118770
321188             MOVE PV-CURRENT-SS          TO PV-HOLD-SS            32118870
321189*            MOVE PV-HOLD-TIME           TO PV-NEW-BATCH-NBR      32118974
321190         WHEN OTHER                                               32119070
321191              MOVE SQLCODE  TO  PV-DISPLAY-SQLCODE                32119170
321192              DISPLAY '4100-GET-BATCH-ID  -  '                    32119270
321193                      PV-DISPLAY-SQLCODE                          32119370
321194              PERFORM 9100-SQL-ABEND                              32119470
321195      END-EVALUATE.                                               32119570
321196                                                                  32119670
321197 4200-GET-LINE-INFO.                                              32119770
321198                                                                  32119870
321199     MOVE SHPUNT-SHIPT-UNT-ID TO DK-CTN.                          32119970
321200                                                                  32120070
321201     EXEC SQL                                                     32120170
321202         SELECT  DISTINCT(TRN_LNE_NBR)                            32120270
321203           INTO :SHUUPC-TRN-LNE-NBR                               32120370
321204           FROM  TSHUUPC                                          32120470
321205          WHERE  SHIPT_UNT_ID   = :DK-CTN                         32120570
321206            AND  TRN_LNE_NBR    > 0                               32120670
321207     END-EXEC.                                                    32120770
321208                                                                  32120870
321209     EVALUATE TRUE                                                32120970
321210         WHEN SQLCODE = ZERO                                      32121070
321211              MOVE  SHUUPC-TRN-LNE-NBR  TO  LBPTDA-PO-LNE-NBR     32121170
321212              PERFORM  4300-GET-DEPT-CL-SKU                       32121270
321213              PERFORM  4400-GET-OUTER-PACK                        32121370
321214         WHEN SQLCODE = -811                                      32121470
321215              MOVE  ZEROES                 TO  LBPTDA-PO-LNE-NBR  32121570
321216              MOVE  '** MULTIPLE LINES **' TO  PV-VEND-STYL-NAME  32121670
321217              PERFORM  4400-GET-OUTER-PACK                        32121770
321218         WHEN SQLCODE = +100                                      32121870
321219              MOVE  ZEROES                 TO  LBPTDA-PO-LNE-NBR  32121970
321220              MOVE  '** NO LINE NUMBER **' TO  PV-VEND-STYL-NAME  32122070
321221                                                                  32122170
321222         WHEN SQLWARN0 NOT = SPACES                               32122270
321223         WHEN SQLCODE NOT EQUAL ZERO                              32122370
321224             DISPLAY '4200-GET-LINE-INFO '                        32122470
321225             PERFORM 9100-SQL-ABEND                               32122570
321226     END-EVALUATE.                                                32122670
321227                                                                  32122770
321228 4300-GET-DEPT-CL-SKU.                                            32122870
321229                                                                  32122970
321230     MOVE  SHUUPC-TRN-LNE-NBR TO DK-PO-LNE-NBR.                   32123070
321231                                                                  32123170
321232     EXEC SQL                                                     32123270
321233         SELECT A.DEPT_NBR                                        32123370
321234               ,C.INNR_PACK_QTY                                   32123470
321235               ,D.CL_NBR                                          32123570
321236               ,D.SKU_SEQ_NBR                                     32123670
321237               ,D.VEND_STYL_NAME                                  32123770
321238           INTO :PV-DEPT-NUMBER,                                  32123870
321239                :PV-INNR-PACK-QTY,                                32123970
321240                :PV-CL-NBR,                                       32124070
321241                :PV-SKU-SEQ-NBR,                                  32124170
321242                :PV-VEND-STYL-NAME                                32124270
321243           FROM TPURCHS A                                         32124370
321244               ,TRECITM C                                         32124470
321245               ,TPURITM D                                         32124570
321246          WHERE A.PO_NBR         =  :DK-PO-NBR                    32124670
321247            AND A.VER_STATUS_CDE =  'A'                           32124770
321248            AND C.ORD_NBR        =  A.PO_NBR                      32124870
321249            AND C.REC_SEQ_NBR    =  :DK-REC-SEQ-NBR               32124970
321250            AND C.ORD_NBR        =  D.PO_NBR                      32125070
321251            AND C.ORD_LNE_NBR    =  :DK-PO-LNE-NBR                32125170
321252            AND C.ORD_LNE_NBR    =  D.APP_PO_LNE_NBR              32125270
321253            AND C.VER_STATUS_CDE =  'A'                           32125370
321254            AND C.PO_VER_NBR     =  D.VER_NBR                     32125470
321255     END-EXEC                                                     32125570
321256                                                                  32125670
321257     EVALUATE TRUE                                                32125770
321258         WHEN SQLCODE = ZERO                                      32125870
321259         WHEN SQLCODE = +100                                      32125970
321260              CONTINUE                                            32126070
321261         WHEN SQLWARN0 NOT = SPACES                               32126170
321262         WHEN SQLCODE NOT EQUAL ZERO                              32126270
321263             DISPLAY '4300-GET-DEPT-CL-SKU'                       32126370
321264             PERFORM 9100-SQL-ABEND                               32126470
321265     END-EVALUATE.                                                32126570
321266                                                                  32126670
321267 4400-GET-OUTER-PACK.                                             32126770
321268                                                                  32126870
321269     MOVE ZEROS TO PV-SHIPPED-QTY.                                32126970
321270                                                                  32127070
321271     EXEC SQL                                                     32127170
321272          SELECT  SUM(SHPD_QTY)                                   32127270
321273            INTO :PV-SHIPPED-QTY                                  32127370
321274            FROM  TSHUUPC                                         32127470
321275           WHERE  SHIPT_UNT_ID  = :DK-CTN                         32127570
321276     END-EXEC                                                     32127670
321277                                                                  32127770
321278     EVALUATE TRUE                                                32127870
321279         WHEN SQLCODE = ZERO                                      32127970
321280             CONTINUE                                             32128070
321281         WHEN SQLWARN0 NOT = SPACES                               32128170
321282         WHEN SQLCODE NOT EQUAL ZERO                              32128270
321283             DISPLAY '4400-GET-OUTER-PACK '                       32128370
321284             PERFORM 9100-SQL-ABEND                               32128470
321285     END-EVALUATE.                                                32128570
321286 7000-READ-INPUT.                                                 32128670
321287******************************************************************32128770
321288*  READ   THE INPUT FILE                                          32128870
321289******************************************************************32128970
321290     READ INPUT-FILE                                              32129070
321291          AT END SET PS-EOF  TO TRUE.                             32129170
321292                                                                  32129270
321293     IF PS-NOT-EOF                                                32129370
321294         ADD +1  TO PV-READ-COUNT                                 32129470
321295         MOVE INPUT-PO-NUMBER        TO DK-PO-NBR                 32129570
321296         MOVE INPUT-RECEIVER-NUMBER  TO DK-REC-SEQ-NBR            32129670
321297         MOVE INPUT-CREATE-COUNT     TO PV-CHECK-ROWS-PROCESSED   32129770
321298         MOVE INPUT-PO-LNE-NBR       TO DK-PO-LNE-NBR             32129870
321299     END-IF.                                                      32129970
321300*                                                                 32130070
321301                                                                  32130170
321302 9000-EOJ-ROUTINE.                                                32130270
321303******************************************************************32130370
321304*  CLOSE OUTPUT FILE.  DISPLAY RECORD COUNTS                      32130470
321305******************************************************************32130570
321306     CLOSE INPUT-FILE.                                            32130670
321307     MOVE PV-ROWS-INSERTED TO PV-DISPLAY-COUNT.                   32130770
321308     DISPLAY 'TOTAL ROWS INSERTED  : '  PV-DISPLAY-COUNT.         32130870
321309     MOVE PV-READ-COUNT    TO PV-DISPLAY-COUNT.                   32130970
321310     DISPLAY 'TOTAL INPUT READ     : '  PV-DISPLAY-COUNT.         32131070
321311                                                                  32131170
321312 9100-SQL-ABEND.                                                  32131270
321313******************************************************************32131370
321314*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    32131470
321315*  ERROR OR WARNING CODE OCCURS.                                  32131570
321316******************************************************************32131670
321317     DISPLAY '9100-SQL-ABEND'.                                    32131770
321318     DISPLAY '** ABEND     **'.                                   32131870
321319     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        32131970
321320     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              32132070
321321     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION-ATTEMPTED.     32132170
321322     DISPLAY '***'                                                32132270
321323     DISPLAY '*** LAST COMMIT TAKEN **' PV-COMMIT-INFO            32132370
321324     DISPLAY '***'                                                32132470
321325     DISPLAY '*** COMMITTED UPDATE COUNTS FOLLOW: ***'            32132570
321326     DISPLAY '***'                                                32132670
321327     EXEC SQL                                                     32132770
321328          ROLLBACK                                                32132870
321329     END-EXEC.                                                    32132970
321330******************************************************************32133070
321331* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    32133170
321332* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         32133270
321333* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     32133370
321334* FORMAT.                                                         32133470
321335******************************************************************32133570
321336     COPY DPPD004.                                                32133670
321337                                                                  32133770
321338     MOVE +4013                  TO ABEND-CODE.                   32133870
321339     CALL 'ILBOABN0' USING ABEND-CODE.                            32133970
