000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.               XSKUT045.                              00020001
000300 AUTHOR.                   JIM LEIKNESS                           00030001
000400 INSTALLATION.             KOHLS DEPARTMENT STORES.               00040001
000500 DATE-WRITTEN.             12-30-2002.                            00050001
000600 DATE-COMPILED.                                                   00060001
000700******************************************************************00070001
000800*     EXTRACT OF XST_DIST AND XST_DIST_REGN TO A FILE             00080001
000900******************************************************************00090001
001100*   PROGRAM WRITES XST_DIST AND XST_DIST_REGN DATA TO A FILE      00110001
001200******************************************************************00120001
001300                                                                  00130001
001400 ENVIRONMENT DIVISION.                                            00140001
001500                                                                  00150001
001600                                                                  00160001
001700 CONFIGURATION SECTION.                                           00170001
001800                                                                  00180001
001900 SOURCE-COMPUTER.    IBM-3090.                                    00190001
002000 OBJECT-COMPUTER.    IBM-3090.                                    00200001
002100                                                                  00210001
002200                                                                  00220001
002300 INPUT-OUTPUT SECTION.                                            00230001
002400                                                                  00240001
002500 FILE-CONTROL.                                                    00250001
002600                                                                  00260001
002700     SELECT XST-OUTPUT-FILE            ASSIGN TO OUT01.           00270001
002800     EJECT                                                        00280001
002900                                                                  00290001
003000 DATA DIVISION.                                                   00300001
003100                                                                  00310001
003200 FILE SECTION.                                                    00320001
003300                                                                  00330001
003400 FD  XST-OUTPUT-FILE                                              00340001
003500     RECORDING MODE IS F                                          00350001
003600     BLOCK CONTAINS 0                                             00360001
003700     LABEL RECORDS ARE STANDARD.                                  00370001
003800 01  XST-OUTPUT-RECORD                PIC X(62).                  00380001
003900                                                                  00390001
004000                                                                  00400001
004100 WORKING-STORAGE SECTION.                                         00410001
004200                                                                  00420001
004600 01  PC-PROGRAM-CONSTANTS.                                        00460001
005000     05  PC-PROGRAM-NUMBER            PIC X(08)      VALUE        00500001
005100         'XSKUT045'.                                              00510001
005200     05  PC-ABEND-MSSG                PIC X(12)      VALUE        00520001
005300         '** ABEND ** '.                                          00530001
005400     05  PC-DB-ERROR-PREFIX           PIC X(09)      VALUE        00540001
005500         'DB2 ERROR'.                                             00550001
005600     05  PC-DB-ATTEMPTING-MSSG        PIC X(14)      VALUE        00560001
005700         'ATTEMPTING TO '.                                        00570001
005800                                                                  00580001
005900 01  PS-PROCESS-SWITCHES.                                         00590001
006000     05  PS-TRANSACTION-DETAIL-SW     PIC X(01)      VALUE 'N'.   00600001
006100         88  PS-NOT-END-OF-TRANS-DETAIL              VALUE 'N'.   00610001
006200         88  PS-END-OF-TRANSACTION-DETAIL            VALUE 'Y'.   00620001
006300                                                                  00630001
006600 01  PV-PROGRAM-VARIABLES.                                        00660001
006700     05  PV-SUB                       PIC S9(04)     COMP.        00670001
006800     05  PV-PARAGRAPH-NAME            PIC X(50)      VALUE SPACES.00680001
006900     05  PV-DB2-ERROR-MSSG            PIC X(50)      VALUE SPACES.00690001
007000                                                                  00700001
007100 01  ABEND-CODE  COMP                 PIC S9(04)     VALUE ZEROS. 00710001
007200     88  ABEND-4003-INVALID-CC-DATE                  VALUE +4003. 00720001
007300     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 00730001
007400     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 00740001
007500     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 00750001
007600                                                                  00760001
007700******************************************************************00770001
007800*    STANDARD FILE LAYOUT FOR THE DISTRICT TABLE FILE             00780001
007900******************************************************************00790001
008000                                                                  00800001
008100     COPY HORD007.                                                00810001
008200                                                                  00820001
008300     COPY DPWS004.                                                00830001
008400******************************************************************00840001
008500*  DB2 DCLGEN FOR THE DISTRICT TABLE (XST_DIST)                   00850001
008600******************************************************************00860001
008610                                                                  00861001
008620     EXEC SQL                                                     00862001
008630         INCLUDE XST00003                                         00863001
008640     END-EXEC.                                                    00864001
008650******************************************************************00865001
008660*  DB2 DCLGEN FOR DISTRICT REGION  TABLE (XST_DIST_REGN)          00866001
008670******************************************************************00867001
008680                                                                  00868001
008690     EXEC SQL                                                     00869001
008700         INCLUDE XST00004                                         00870001
008800     END-EXEC.                                                    00880001
008900                                                                  00890001
009000******************************************************************00900001
009100*  DB2 COMMUNICATIONS AREA                                        00910001
009200******************************************************************00920001
009300                                                                  00930001
009400     EXEC SQL                                                     00940001
009500         INCLUDE SQLCA                                            00950001
009600     END-EXEC.                                                    00960001
009700                                                                  00970001
009800******************************************************************00980001
009900*  DECLARE CURSOR                                                 00990001
010000******************************************************************01000001
010100                                                                  01010001
010200     EXEC SQL                                                     01020001
010300         DECLARE DIST-EXTR-CSR CURSOR FOR                         01030001
010400                                                                  01040001
010500         SELECT  DIST.DIST_NBR                                    01050001
010600              ,  REGN.REGN_NBR                                    01060001
010700              ,  DIST.DIST_NM                                     01070001
010800              ,  DIST.DIST_MGR_NM                                 01080001
010900         FROM XST_DIST DIST,                                      01090006
011000              XST_DIST_REGN REGN                                  01100006
011100         WHERE DIST.DIST_NBR = REGN.DIST_NBR                      01110007
011110          AND REGN.END_DTE IS NULL                                01111006
011300                                                                  01130001
011400     END-EXEC.                                                    01140001
011500                                                                  01150001
011600******************************************************************01160001
011700 PROCEDURE DIVISION.                                              01170001
011800******************************************************************01180001
011900                                                                  01190001
012000     OPEN OUTPUT XST-OUTPUT-FILE.                                 01200001
012100                                                                  01210001
012200     PERFORM 1000-OPEN-DIST-EXTR-CSR.                             01220001
012300                                                                  01230001
012400     INITIALIZE HO007-DISTRICT-DATA.                              01240001
012500                                                                  01250001
012600     PERFORM 1050-FETCH-DIST-EXTR-CSR.                            01260001
012700                                                                  01270001
012800     PERFORM 2000-PROCESS                                         01280001
012900         UNTIL PS-END-OF-TRANSACTION-DETAIL.                      01290001
013000                                                                  01300001
013100     PERFORM 1070-CLOSE-DIST-EXTR-CSR.                            01310001
013200                                                                  01320001
013300     CLOSE XST-OUTPUT-FILE.                                       01330001
013400                                                                  01340001
013500     STOP RUN.                                                    01350001
013600                                                                  01360001
013700******************************************************************01370001
013800*   OPEN THE DISTRICT EXTRACT CURSOR                              01380001
013900******************************************************************01390001
014000 1000-OPEN-DIST-EXTR-CSR.                                         01400001
014100                                                                  01410001
014200     EXEC SQL                                                     01420001
014300         OPEN DIST-EXTR-CSR                                       01430001
014400     END-EXEC.                                                    01440001
014500                                                                  01450001
014600     EVALUATE TRUE                                                01460001
014700       WHEN SQLCODE NOT = 0                                       01470001
014800       WHEN SQLWARN0    = 'W'                                     01480001
014900         MOVE '1000-OPEN-DIST-EXTR-CSR '                          01490001
015000                           TO PV-PARAGRAPH-NAME                   01500001
015100         MOVE 'OPEN DISTRICT EXTRACT CURSOR ERROR.'               01510001
015200                           TO PV-DB2-ERROR-MSSG                   01520001
015300         PERFORM 9400-DB2-ERROR                                   01530001
015400     END-EVALUATE.                                                01540001
015500                                                                  01550001
015600******************************************************************01560001
015700*   FETCH DATA FROM THE DISTRICT EXTRACT CURSOR                  *01570001
015800******************************************************************01580001
015900 1050-FETCH-DIST-EXTR-CSR.                                        01590001
016000                                                                  01600001
016100     EXEC SQL                                                     01610001
016200         FETCH DIST-EXTR-CSR                                      01620001
016300           INTO :XST00003-DIST-NBR                                01630001
016400              , :XST00004-REGN-NBR                                01640001
016500              , :XST00003-DIST-NM                                 01650001
016600              , :XST00003-DIST-MGR-NM                             01660001
016700     END-EXEC.                                                    01670001
016800                                                                  01680001
016900     EVALUATE TRUE                                                01690001
017000         WHEN SQLCODE = +0                                        01700001
017100           CONTINUE                                               01710001
017200         WHEN SQLCODE = +100                                      01720001
017300           SET PS-END-OF-TRANSACTION-DETAIL TO TRUE               01730001
017400         WHEN OTHER                                               01740001
017500             MOVE '1050-FETCH-DIST-EXTR-CURSOR'                   01750001
017600                               TO PV-PARAGRAPH-NAME               01760001
017700             MOVE 'FETCH FROM DISTRICT EXTRACT CURSOR ERROR.'     01770001
017800                               TO PV-DB2-ERROR-MSSG               01780001
017900             PERFORM 9400-DB2-ERROR                               01790001
018000     END-EVALUATE.                                                01800001
018100                                                                  01810001
018200     MOVE XST00003-DIST-NBR      TO HO007-DIST-NBR.               01820001
018300     MOVE XST00004-REGN-NBR      TO HO007-DIST-REGN-NBR.          01830001
018400     MOVE XST00003-DIST-NM       TO HO007-DIST-NM.                01840002
018500     MOVE XST00003-DIST-MGR-NM   TO HO007-DIST-MGR-NM.            01850002
018600                                                                  01860001
018700******************************************************************01870001
018800*   CLOSE THE DISTRICT EXTRACT CSR                               *01880001
018900******************************************************************01890001
019000 1070-CLOSE-DIST-EXTR-CSR.                                        01900001
019100     EXEC SQL                                                     01910001
019200       CLOSE DIST-EXTR-CSR                                        01920001
019300     END-EXEC.                                                    01930001
019400                                                                  01940001
019500     EVALUATE TRUE                                                01950001
019600       WHEN SQLCODE NOT = 0                                       01960001
019700       WHEN SQLWARN0    = 'W'                                     01970001
019800           MOVE '1070-CLOSE-DIST-EXTR-CSR'                        01980001
019900                             TO PV-PARAGRAPH-NAME                 01990001
020000           MOVE 'CLOSE FAILED FOR DISTRICT EXTRACT CURSOR'        02000001
020100                             TO PV-DB2-ERROR-MSSG                 02010001
020200           PERFORM 9400-DB2-ERROR                                 02020001
020300     END-EVALUATE.                                                02030001
020400                                                                  02040001
020500******************************************************************02050001
020600* PROCESS  :  FETCH RECORDS AND WRITE TO EXTRACT FILE            *02060001
020700******************************************************************02070001
020800 2000-PROCESS.                                                    02080001
020900                                                                  02090001
021000     PERFORM 3000-WRITE-DISTRICT-FILE.                            02100001
021100                                                                  02110001
021200     INITIALIZE HO007-DISTRICT-DATA.                              02120001
021300                                                                  02130001
021400     PERFORM 1050-FETCH-DIST-EXTR-CSR.                            02140001
021500                                                                  02150001
021600******************************************************************02160001
021700* WRITE-DISTRICT-FILE                                             02170001
021800******************************************************************02180001
021900 3000-WRITE-DISTRICT-FILE.                                        02190001
022000                                                                  02200001
022100     WRITE XST-OUTPUT-RECORD     FROM HORD007-RECORD.             02210001
022200                                                                  02220001
022300                                                                  02230001
022400******************************************************************02240001
022500*    DB2 ERROR                                                   *02250001
023000******************************************************************02300001
023100 9400-DB2-ERROR.                                                  02310001
023200                                                                  02320001
023300     DISPLAY PC-ABEND-MSSG  PC-PROGRAM-NUMBER.                    02330001
023400     DISPLAY PC-DB-ERROR-PREFIX                                   02340001
023500     DISPLAY PC-DB-ATTEMPTING-MSSG PV-DB2-ERROR-MSSG.             02350001
023600     COPY DPPD004.                                                02360001
023700     SET ABEND-4013-DB2-ERROR TO TRUE.                            02370001
023800     CALL 'ILBOABN0' USING ABEND-CODE.                            02380001
023900     EJECT                                                        02390001
