       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    MLKRP218.                                         00020000
       AUTHOR.        SCOTT JACKSON.                                    00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  07-20-99.                                         00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      *                                                                 00080000
      * MLKRP218 - DESCRIPTION.............                             00090000
      *                                                                 00100000
      * THIS PROGRAM WILL READ A D099-10 TRANSACTIONS AND CREATE REPORT 00110000
      * CONTAINING TOTALS.                                              00120000
      *                                                                 00130000
      *CHANGE HISTORY:                                                  00140064
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00150064
      * ------- ---------- ----------- -------------------------------- 00160064
W26603* W26603  03-08-2004 ROD JANSSEN MERCH LEDGER STORE EXPANSION     00170064
PM3403* PM3403  04-20-2012 S.JACKSON LG RETAIL RECOMPILE ONLY(MLRD020)  00180068
      ******************************************************************00190000
      *                                                                 00200000
       ENVIRONMENT DIVISION.                                            00210000
      *                                                                 00220000
       CONFIGURATION SECTION.                                           00230000
      *                                                                 00240000
       SOURCE-COMPUTER.        IBM-3090.                                00250000
       OBJECT-COMPUTER.        IBM-3090.                                00260000
      *                                                                 00270000
       INPUT-OUTPUT SECTION.                                            00280000
       FILE-CONTROL.                                                    00290000
                                                                        00300000
           SELECT CONTROL-DATE-FILE                                     00310001
               ASSIGN TO INP01.                                         00320000
                                                                        00330000
           SELECT SALE-REVERSAL-FILE                                    00340001
               ASSIGN TO INP02.                                         00350001
                                                                        00360001
           SELECT PRICE-CHANGE-REVERSAL-FILE                            00370001
               ASSIGN TO INP03.                                         00380001
                                                                        00390000
           SELECT REPORT-FILE                                           00400001
               ASSIGN TO RPT01.                                         00410012
                                                                        00420001
      ******************************************************************00430000
       DATA DIVISION.                                                   00440000
      ******************************************************************00450000
                                                                        00460000
       FILE SECTION.                                                    00470000
                                                                        00480000
       FD  CONTROL-DATE-FILE                                            00490001
           LABEL RECORDS ARE STANDARD                                   00500000
           RECORDING MODE IS F                                          00510000
           BLOCK CONTAINS 0 RECORDS.                                    00520000
       01  CONTROL-DATE-RECORD             PIC X(80).                   00530001
                                                                        00540000
       FD  SALE-REVERSAL-FILE                                           00550001
           LABEL RECORDS ARE STANDARD                                   00560001
           RECORDING MODE IS F                                          00570001
           BLOCK CONTAINS 0 RECORDS.                                    00580001
W26603 01  SALE-REVERSAL-RECORD            PIC X(175).                  00590064
                                                                        00600001
       FD  PRICE-CHANGE-REVERSAL-FILE                                   00610001
           RECORDING MODE IS F                                          00620000
           LABEL RECORDS ARE STANDARD                                   00630000
           BLOCK CONTAINS 0 RECORDS.                                    00640000
                                                                        00650000
W26603 01  PRICE-CHANGE-REVERSAL-RECORD    PIC X(175).                  00660064
                                                                        00670000
       FD  REPORT-FILE                                                  00680001
           LABEL RECORDS ARE OMITTED                                    00690000
           RECORDING MODE IS F                                          00700000
           BLOCK CONTAINS 0 RECORDS.                                    00710000
                                                                        00720001
       01  REPORT-RECORD                   PIC X(80).                   00730001
                                                                        00740000
      ******************************************************************00750000
       WORKING-STORAGE SECTION.                                         00760000
      ******************************************************************00770000
                                                                        00780000
       01 ABEND-AREAS.                                                  00790001
           05 ABEND-CODE               PIC S9(04)  VALUE ZERO           00800001
                                                   COMP SYNC.           00810001
                                                                        00820001
       01  PS-PROGRAM-SWITCHES.                                         00830000
           05  PS-SALE-PROCESS-SW        PIC X       VALUE 'N'.         00840002
               88  PS-FIRST-SALE-REC                 VALUE 'Y'.         00850002
           05  PS-MKDN-PROCESS-SW        PIC X       VALUE 'N'.         00860002
               88  PS-FIRST-MKDN-REC                 VALUE 'Y'.         00870002
           05  PS-MKUP-PROCESS-SW        PIC X       VALUE 'N'.         00880002
               88  PS-FIRST-MKUP-REC                 VALUE 'Y'.         00890002
           05  PS-END-OF-SALES-FILE-SW   PIC X       VALUE 'N'.         00900002
               88  PS-END-OF-SALES                   VALUE 'Y'.         00910002
           05  PS-END-OF-PRCHG-FILE-SW   PIC X       VALUE 'N'.         00920001
               88  PS-END-OF-PRCHG                   VALUE 'Y'.         00930001
                                                                        00940000
       01  PA-PROGRAM-ACCUMULATORS.                                     00950001
           05  PA-PAGE-COUNT           PIC  9(04)     VALUE ZERO.       00960022
           05  PA-LINE-COUNT           PIC  9(05)     VALUE ZERO.       00970006
      * RECORD COUNT                                                    00980006
           05  PA-INPUT-RECORDS        PIC S9(05)     VALUE ZERO.       00990006
           05  PA-SALE-READ            PIC S9(05)     VALUE ZERO.       01000006
           05  PA-MARKDOWN-READ        PIC S9(05)     VALUE ZERO.       01010006
           05  PA-MARKUP-READ          PIC S9(05)     VALUE ZERO.       01020006
      * DOLLAR TALLY                                                    01030006
           05  PA-INPUT-TOTAL          PIC S9(07)V99  VALUE ZERO.       01040006
           05  PA-SALE-TOTAL           PIC S9(07)V99  VALUE ZERO.       01050006
           05  PA-MARKDOWN-OLD         PIC S9(07)V99  VALUE ZERO.       01060034
           05  PA-MARKDOWN-NEW         PIC S9(07)V99  VALUE ZERO.       01070034
           05  PA-MARKUP-OLD           PIC S9(07)V99  VALUE ZERO.       01080034
           05  PA-MARKUP-NEW           PIC S9(07)V99  VALUE ZERO.       01090034
      *                                                                 01100006
       01  PC-PROGRAM-CONSTANTS.                                        01110000
           05  PC-JOB-NAME             PIC X(06)   VALUE 'MLK490'.      01120001
           05  PC-PROGRAM-NAME         PIC X(08)   VALUE 'MLKRP218'.    01130001
           05  PC-REPORT-VERSION       PIC X(01).                       01140008
               88 PC-REPORT-REVERSALS              VALUE '1'.           01150008
               88 PC-REPORT-ALLOCATE               VALUE '2'.           01160008
           05  PC-TRAN-TYPE            PIC X(10).                       01170005
               88 PC-TRAN-SALES                    VALUE '  SALES   '.  01180005
               88 PC-TRAN-MARKDOWN                 VALUE 'MARKDOWNS '.  01190005
               88 PC-TRAN-MARKUP                   VALUE ' MARKUPS  '.  01200005
           05  PC-MAX-LINE-COUNT       PIC S9(02)  VALUE +58.           01210063
                                                                        01220006
       01  PV-PROGRAM-VARIABLES.                                        01230000
           05  PV-TRAN-CODE            PIC X(02).                       01240001
               88  PV-SALES                        VALUE '20'.          01250001
               88  PV-PRICE-CHANGE                 VALUE '40' '50'.     01260001
           05  PV-HOLD-TRAN-CODE       PIC X(02)   VALUE SPACES.        01270030
           05  PV-REPORT-TITLE         PIC X(09).                       01280001
               88  PV-REVERSAL                     VALUE 'REVERSALS'.   01290001
               88  PV-ALLOCATE                     VALUE 'ALLOCATED'.   01300001
           05  PV-TIME-HHMMSS.                                          01310008
               10  PV-TIME-HHMMSS-HH   PIC X(02)   VALUE SPACES.        01320008
               10  PV-TIME-HHMMSS-MM   PIC X(02)   VALUE SPACES.        01330008
               10  PV-TIME-HHMMSS-SS   PIC X(02)   VALUE SPACES.        01340008
           05  PV-HOLD-EXTD-VALUES.                                     01350057
               10  PV-MARKDOWN-OLD-EXTD    PIC S9(07)V99  VALUE ZEROES. 01360057
               10  PV-MARKDOWN-NEW-EXTD    PIC S9(07)V99  VALUE ZEROES. 01370057
               10  PV-MARKUP-OLD-EXTD      PIC S9(07)V99  VALUE ZEROES. 01380057
               10  PV-MARKUP-NEW-EXTD      PIC S9(07)V99  VALUE ZEROES. 01390057
      *                                                                 01400008
       01  CC-CONTROL-CARD.                                             01410008
           05  CC-CURRENT-DATE.                                         01420008
               10  CC-CURR-CC          PIC X(02)   VALUE SPACES.        01430008
               10  CC-CURR-YY          PIC X(02)   VALUE SPACES.        01440008
               10  FILLER              PIC X(01)   VALUE '-'.           01450008
               10  CC-CURR-MM          PIC X(02)   VALUE SPACES.        01460008
               10  FILLER              PIC X(01)   VALUE '-'.           01470008
               10  CC-CURR-DD          PIC X(02)   VALUE SPACES.        01480008
                                                                        01490006
      ******************************************************************01500006
      ***  INPUT RECORD LAYOUT                                          01510006
      ******************************************************************01520006
      *                                                                 01530006
           COPY MLRD020.                                                01540006
                                                                        01550006
      ******************************************************************01560006
      ***  DB2 COMMUNICATION AREA                                       01570009
      ******************************************************************01580006
      *                                                                 01590006
           EXEC SQL                                                     01600006
               INCLUDE SQLCA                                            01610009
           END-EXEC.                                                    01620006
      *                                                                 01630009
      ******************************************************************01640009
      ***  STORE TABLE USED TO GET STORE NAME FOR REPORT                01650009
      ******************************************************************01660009
           EXEC SQL                                                     01670009
W26603         INCLUDE XMT00001                                         01680064
           END-EXEC.                                                    01690009
      *                                                                 01700006
      ******************************************************************01710000
      ***  REPORT TITLE LINES                                           01720000
      ******************************************************************01730000
       01  HEADER-TITLE-LINE1.                                          01740001
           05  HD-DATE-MM              PIC X(02)   VALUE SPACES.        01750001
           05  FILLER                  PIC X(01)   VALUE '/'.           01760001
           05  HD-DATE-DD              PIC X(02)   VALUE SPACES.        01770001
           05  FILLER                  PIC X(01)   VALUE '/'.           01780001
           05  HD-DATE-YY              PIC X(02)   VALUE SPACES.        01790001
           05  FILLER                  PIC X(18)   VALUE SPACES.        01800022
           05  FILLER                  PIC X(24)                        01810001
                                VALUE 'DEPT 099-10 TRANSACTIONS'.       01820001
           05  FILLER                  PIC X(18)   VALUE SPACES.        01830053
           05  HD-REPORT-NAME          PIC X(08)   VALUE SPACES.        01840019
           05  FILLER                  PIC X(01)   VALUE '-'.           01850001
           05  HD-REPORT-VERSION       PIC X(01)   VALUE SPACES.        01860001
           05  FILLER                  PIC X(02)   VALUE SPACES.        01870053
                                                                        01880000
       01  HEADER-TITLE-LINE2.                                          01890001
           05  HD2-RUN-HOUR            PIC X(02)   VALUE SPACES.        01900002
           05  FILLER                  PIC X(01)   VALUE ':'.           01910002
           05  HD2-RUN-MINUTE          PIC X(02)   VALUE SPACES.        01920002
           05  FILLER                  PIC X(01)   VALUE ':'.           01930002
           05  HD2-RUN-SECOND          PIC X(02)   VALUE SPACES.        01940002
           05  FILLER                  PIC X(23)   VALUE SPACES.        01950025
           05  HD2-REPORT-VERSION      PIC X(13).                       01960001
               88  HD2-REVERSALS                 VALUE '( REVERSALS )'. 01970001
               88  HD2-ALLOCATES                 VALUE '(RE-ALLOCATE)'. 01980001
           05  FILLER                  PIC X(24) VALUE SPACES.          01990053
           05  FILLER                  PIC X(06) VALUE 'PAGE: '.        02000006
           05  HD2-PAGE-COUNT          PIC ZZZ9.                        02010022
           05  FILLER                  PIC X(02) VALUE SPACES.          02020053
                                                                        02030000
      ******************************************************************02040000
      ***  REPORT COLUMN HEADING LINES  -  SALES RECORDS                02050033
      ******************************************************************02060000
       01  COLUMN-TITLE1-HEADINGS.                                      02070001
           05  CT-TRAN-TYPE            PIC X(10)   VALUE 'TRAN TYPE '.  02080002
           05  FILLER                  PIC X(05)   VALUE SPACES.        02090002
           05  CT-STORE-NBR            PIC X(09)   VALUE 'STORE NBR'.   02100001
           05  FILLER                  PIC X(06)   VALUE SPACES.        02110001
           05  CT-STORE-NAME           PIC X(10)   VALUE 'STORE NAME'.  02120001
           05  FILLER                  PIC X(11)   VALUE SPACES.        02130001
           05  CT-DOLLARS              PIC X(07)   VALUE 'DOLLARS'.     02140001
           05  FILLER                  PIC X(19)   VALUE SPACES.        02150033
                                                                        02160000
      ******************************************************************02170001
      ***  REPORT COLUMN HEADING LINES SUPPORTER  -  SALES              02180033
      ******************************************************************02190001
       01  COLUMN-TITLE2-HEADINGS.                                      02200001
           05  CT2-LINE-ONE            PIC X(10)   VALUE '----------'.  02210002
           05  FILLER                  PIC X(05)   VALUE SPACES.        02220002
           05  CT2-LINE-TWO            PIC X(09)   VALUE '---------'.   02230002
           05  FILLER                  PIC X(06)   VALUE SPACES.        02240001
           05  CT2-LINE-THREE          PIC X(10)   VALUE '----------'.  02250002
           05  FILLER                  PIC X(08)   VALUE SPACES.        02260022
           05  CT2-LINE-FOUR           PIC X(12)   VALUE '------------'.02270033
           05  FILLER                  PIC X(27)   VALUE SPACES.        02280033
                                                                        02290001
      ******************************************************************02300000
      ***  REPORT DETAIL LINES  -  SALES RECORDS                        02310033
      ******************************************************************02320000
       01  DETAIL-LINE-SALES.                                           02330033
           05  DL-TRAN-TYPE            PIC X(10).                       02340002
           05  FILLER                  PIC X(08)   VALUE SPACE.         02350002
W26603     05  DL-STORE-NBR            PIC X(05)   VALUE SPACE.         02360064
W26603     05  FILLER                  PIC X(07)   VALUE SPACE.         02370066
           05  DL-STORE-NAME           PIC X(10)   VALUE SPACE.         02380001
           05  FILLER                  PIC X(07)   VALUE SPACE.         02390001
           05  DL-TRANS-TOTAL          PIC ZZ,ZZZ,ZZZ.99-               02400001
                                       BLANK WHEN ZERO.                 02410000
           05  FILLER                  PIC X(19)   VALUE SPACE.         02420033
                                                                        02430006
      ******************************************************************02440006
      ***  SUBTOTAL LINES  -  SALES                                     02450033
      ******************************************************************02460006
       01  SUB-TOTAL-LINE1.                                             02470006
           05  FILLER                  PIC X(50)   VALUE SPACES.        02480022
           05  ST1-LINE-TWO            PIC X(10)   VALUE '----------'.  02490007
           05  FILLER                  PIC X(20)   VALUE SPACES.        02500044
                                                                        02510006
      ******************************************************************02520006
      ***  REPORT SUBTOTAL LINES - DISPLAYING INTERIM TOTALS (SALES)    02530033
      ******************************************************************02540006
       01  SUB-TOTAL-LINE2.                                             02550006
           05  FILLER                PIC X(30)   VALUE SPACES.          02560044
           05  ST2-SUBTOTAL          PIC X(10)   VALUE 'SUBTOTAL  '.    02570007
           05  FILLER                PIC X(07)   VALUE SPACES.          02580006
           05  ST2-TRAN-TOTAL        PIC ZZ,ZZZ,ZZZ.99-.                02590022
           05  FILLER                PIC X(19)   VALUE SPACES.          02600044
      *                                                                 02610033
      ******************************************************************02620033
      ***  REPORT COLUMN HEADING LINES  -  FOR PRICE CHANGE RECORDS     02630033
      ******************************************************************02640033
       01  COLUMN-PC-HEADING1.                                          02650033
           05  CT-PC-TRAN-TYPE         PIC X(10)   VALUE 'TRAN TYPE '.  02660033
           05  FILLER                  PIC X(05)   VALUE SPACES.        02670033
           05  CT-PC-STORE-NBR         PIC X(09)   VALUE 'STORE NBR'.   02680033
           05  FILLER                  PIC X(06)   VALUE SPACES.        02690033
           05  CT-PC-STORE-NAME        PIC X(10)   VALUE 'STORE NAME'.  02700033
           05  FILLER                  PIC X(08)   VALUE SPACES.        02710047
           05  CT-PC-DOLLAR-1          PIC X(11)   VALUE 'OLD DOLLARS'. 02720040
           05  FILLER                  PIC X(06)   VALUE SPACES.        02730047
           05  CT-PC-DOLLAR-2          PIC X(11)   VALUE 'NEW DOLLARS'. 02740040
           05  FILLER                  PIC X(05)   VALUE SPACES.        02750033
      *                                                                 02760060
      ******************************************************************02770033
      ***  REPORT COLUMN HEADING LINES SUPPORTER                        02780033
      ******************************************************************02790033
       01  COLUMN-PC-HEADING2.                                          02800033
           05  CT2-LINE-ONE            PIC X(10)   VALUE '----------'.  02810033
           05  FILLER                  PIC X(05)   VALUE SPACES.        02820033
           05  CT2-LINE-TWO            PIC X(09)   VALUE '---------'.   02830033
           05  FILLER                  PIC X(06)   VALUE SPACES.        02840033
           05  CT2-LINE-THREE          PIC X(10)   VALUE '----------'.  02850033
           05  FILLER                  PIC X(08)   VALUE SPACES.        02860033
           05  CT2-LINE-FOUR           PIC X(12)   VALUE '------------'.02870033
           05  FILLER                  PIC X(05)   VALUE SPACES.        02880033
           05  CT2-LINE-FIVE           PIC X(12)   VALUE '------------'.02890033
           05  FILLER                  PIC X(03)   VALUE SPACES.        02900033
      *                                                                 02910060
      ******************************************************************02920033
      ***  REPORT DETAIL LINES   -   PRICE CHANGES                      02930033
      ******************************************************************02940033
       01  DETAIL-PC-LINE.                                              02950033
           05  DL-PC-TRAN-TYPE         PIC X(10)   VALUE SPACE.         02960034
           05  FILLER                  PIC X(08)   VALUE SPACE.         02970033
W26603     05  DL-PC-STORE-NBR         PIC X(05)   VALUE SPACE.         02980065
W26603     05  FILLER                  PIC X(07)   VALUE SPACE.         02990066
           05  DL-PC-STORE-NAME        PIC X(10)   VALUE SPACE.         03000034
           05  FILLER                  PIC X(07)   VALUE SPACE.         03010033
           05  DL-PC-TRANS-TOTAL1      PIC ZZ,ZZZ,ZZZ.99-.              03020050
           05  FILLER                  PIC X(03)   VALUE SPACE.         03030033
           05  DL-PC-TRANS-TOTAL2      PIC ZZ,ZZZ,ZZZ.99-.              03040050
           05  FILLER                  PIC X(02)   VALUE SPACE.         03050033
                                                                        03060033
      ******************************************************************03070033
      ***  SUBTOTAL LINES  -    FOR PRICE CHANGES                       03080033
      ******************************************************************03090033
       01  SUB-TOTAL-PC-LINE1.                                          03100033
           05  FILLER                  PIC X(50)   VALUE SPACES.        03110033
           05  ST-PC-LINE-ONE          PIC X(11)   VALUE '----------'.  03120033
           05  FILLER                  PIC X(06)   VALUE SPACES.        03130053
           05  ST-PC-LINE-TWO          PIC X(11)   VALUE '----------'.  03140033
           05  FILLER                  PIC X(02)   VALUE SPACES.        03150053
                                                                        03160033
      ******************************************************************03170033
      ***  REPORT SUBTOTAL LINES - DISPLAYING INTERIM TOTALS            03180033
      ******************************************************************03190033
       01  SUB-TOTAL-PC-LINE2.                                          03200033
           05  FILLER                PIC X(30)   VALUE SPACES.          03210033
           05  ST2-FILLER            PIC X(10)   VALUE 'SUBTOTAL  '.    03220033
           05  FILLER                PIC X(07)   VALUE SPACES.          03230033
           05  ST-PC-SUBTOTAL-ONE    PIC ZZ,ZZZ,ZZZ.99-.                03240034
           05  FILLER                PIC X(03)   VALUE SPACES.          03250033
           05  ST-PC-SUBTOTAL-TWO    PIC ZZ,ZZZ,ZZZ.99-.                03260034
           05  FILLER                PIC X(03)   VALUE SPACES.          03270033
                                                                        03280033
      ******************************************************************03290033
      ***  REPORT TOTAL LINES - DISPLAYING TOTALS FOR ALL 099-10 TRANS  03300028
      ******************************************************************03310028
       01  TOTAL-LINE.                                                  03320006
           05  FILLER                  PIC X(10)   VALUE SPACE.         03330006
           05  FILLER                  PIC X(09)   VALUE 'TOTALS : '.   03340008
           05  FILLER                  PIC X(06)   VALUE SPACE.         03350006
           05  FILLER                  PIC X(07)   VALUE 'RECORD '.     03360006
           05  FILLER                  PIC X(09)   VALUE 'COUNT    '.   03370006
           05  TL-REC-COUNT            PIC ZZ,ZZ9-.                     03380022
           05  FILLER                  PIC X(09)   VALUE SPACES.        03390033
           05  TL-TRAN-TOTAL           PIC ZZ,ZZZ,ZZZ.99-.              03400010
           05  FILLER                  PIC X(09)   VALUE SPACES.        03410010
      *                                                                 03420006
      ******************************************************************03430000
      ***  REPORT END OF REPORT LINE                                    03440000
      ******************************************************************03450000
       01  ER-END-OF-REPORT-LINE.                                       03460000
           05  FILLER                  PIC X(21)   VALUE                03470000
                                          '*** END OF REPORT ***'.      03480000
                                                                        03490000
       EJECT                                                            03500000
                                                                        03510000
      ******************************************************************03520000
       PROCEDURE DIVISION.                                              03530000
      ******************************************************************03540000
                                                                        03550000
      ******************************************************************03560000
       0000-MAINLINE-MLKRP218.                                          03570000
      ******************************************************************03580000
      *                                                                 03590000
           PERFORM 1000-INITIALIZATION.                                 03600001
                                                                        03610001
           PERFORM 2000-MAIN-PROCESS.                                   03620001
                                                                        03630001
           PERFORM 8000-EOJ.                                            03640007
                                                                        03650007
           STOP RUN.                                                    03660007
                                                                        03670007
       EJECT                                                            03680000
                                                                        03690000
      ******************************************************************03700000
       1000-INITIALIZATION.                                             03710000
      ******************************************************************03720000
      *                                                                 03730000
           OPEN INPUT  CONTROL-DATE-FILE                                03740001
                       SALE-REVERSAL-FILE                               03750001
                       PRICE-CHANGE-REVERSAL-FILE                       03760001
           OPEN OUTPUT REPORT-FILE.                                     03770001
                                                                        03780000
           INITIALIZE PV-PROGRAM-VARIABLES                              03790005
                      PA-PROGRAM-ACCUMULATORS.                          03800005
      *                                                                 03810006
           SET PS-FIRST-SALE-REC                                        03820007
               PS-FIRST-MKDN-REC                                        03830007
               PS-FIRST-MKUP-REC TO TRUE.                               03840007
      *                                                                 03850001
           ACCEPT PV-TIME-HHMMSS FROM TIME.                             03860002
           MOVE   PV-TIME-HHMMSS-HH      TO HD2-RUN-HOUR.               03870003
           MOVE   PV-TIME-HHMMSS-MM      TO HD2-RUN-MINUTE.             03880003
           MOVE   PV-TIME-HHMMSS-SS      TO HD2-RUN-SECOND.             03890003
                                                                        03900000
           MOVE 0 TO PA-LINE-COUNT.                                     03910044
                                                                        03920044
           PERFORM 4000-READ-DATE-FILE.                                 03930011
      *                                                                 03940011
           MOVE CC-CURR-MM            TO HD-DATE-MM                     03950016
           MOVE CC-CURR-DD            TO HD-DATE-DD                     03960016
           MOVE CC-CURR-YY            TO HD-DATE-YY                     03970016
      *                                                                 03980016
           PERFORM 4100-READ-SALES-FILE.                                03990016
      *                                                                 04000016
           IF NOT PS-END-OF-SALES                                       04010048
               SET PC-TRAN-SALES TO TRUE                                04020048
               MOVE '20' TO PV-HOLD-TRAN-CODE                           04030048
               PERFORM 5000-FORMAT-HEADINGS                             04040053
           END-IF.                                                      04050048
      *                                                                 04060048
      *                                                                 04070011
      ******************************************************************04080000
       2000-MAIN-PROCESS.                                               04090000
      ******************************************************************04100000
      *                                                                 04110016
           PERFORM 2100-PROCESS-SALES-FILE                              04120001
               UNTIL PS-END-OF-SALES.                                   04130001
                                                                        04140053
           IF PA-SALE-READ > 0                                          04150053
               PERFORM 5300-WRITE-SUBTOTAL-LINES                        04160053
           END-IF.                                                      04170053
      *                                                                 04180053
           PERFORM 4200-READ-PRCHG-FILE.                                04190006
      *                                                                 04200001
           PERFORM 2200-PROCESS-PRICE-CHANGE-FILE                       04210006
               UNTIL PS-END-OF-PRCHG.                                   04220001
      *                                                                 04230007
           PERFORM 5350-WRITE-SUBTOTAL-LINES.                           04240043
                                                                        04250000
       EJECT                                                            04260000
                                                                        04270000
      ******************************************************************04280001
       2100-PROCESS-SALES-FILE.                                         04290001
      ******************************************************************04300001
      *                                                                 04310001
           MOVE ZEROES                 TO PV-HOLD-EXTD-VALUES.          04320057
      *                                                                 04330057
           ADD +1                      TO PA-SALE-READ                  04340006
                                          PA-INPUT-RECORDS.             04350006
      *                                                                 04360001
           SET PC-TRAN-SALES       TO TRUE.                             04370016
           MOVE PC-TRAN-TYPE       TO DL-TRAN-TYPE.                     04380016
      *                                                                 04390016
           IF ML020-TRANS-CDE NOT EQUAL '20'                            04400010
               DISPLAY ' TRAN CODE NOT ''20'' ON SALES FILE '           04410006
               MOVE +4003              TO ABEND-CODE                    04420006
               PERFORM 9900-COMMON-ABEND-ROUTINE                        04430016
           END-IF.                                                      04440016
      *                                                                 04450016
           PERFORM 7000-GET-STORE-NAME.                                 04460005
      *                                                                 04470005
           MOVE ML020-STORE-NBR           TO  DL-STORE-NBR.             04480005
W26603     MOVE XMT00001-LOC-10-ABBR-NM   TO  DL-STORE-NAME.            04490067
      *                                                                 04500005
           MOVE ML020-SALE-EXTD-RTL-AMT   TO  DL-TRANS-TOTAL.           04510057
           ADD  ML020-SALE-EXTD-RTL-AMT   TO  PA-SALE-TOTAL             04520006
                                              PA-INPUT-TOTAL.           04530006
      *                                                                 04540005
           PERFORM 5200-WRITE-DETAIL-RECORD.                            04550006
      *                                                                 04560004
           PERFORM 4100-READ-SALES-FILE.                                04570005
      *                                                                 04580001
           IF PS-END-OF-SALES                                           04590045
               MOVE PA-SALE-TOTAL TO ST2-TRAN-TOTAL                     04600045
           END-IF.                                                      04610045
                                                                        04620045
      ******************************************************************04630006
       2200-PROCESS-PRICE-CHANGE-FILE.                                  04640006
      ******************************************************************04650006
      *  PRICE CHANGE RECORDS CONTAIN BOTH 'OLD' AND 'NEW' TOTALS       04660006
      *  THIS PROGRAM WILL REPORT TOTALS BY MULTIPLYING QTY * OLD/NEW   04670057
      *  AMOUNT (ML020-PC-NEW-PR-AMT)                                   04680057
      ******************************************************************04690006
      *                                                                 04700006
           ADD +1                      TO PA-INPUT-RECORDS.             04710006
      *                                                                 04720006
           EVALUATE TRUE                                                04730009
               WHEN ML020-MKDOWN                                        04740006
                   PERFORM 2300-PROCESS-MARKDOWNS                       04750057
               WHEN ML020-MKUP                                          04760006
                   PERFORM 2400-PROCESS-MARKUPS                         04770057
               WHEN OTHER                                               04780006
                   DISPLAY ' TRAN CODE ON PRICE CHANGE FILE IS NOT ',   04790006
                           ' A MARKUP OR MARKDOWN '                     04800006
                   MOVE +4003              TO ABEND-CODE                04810006
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    04820009
           END-EVALUATE.                                                04830006
      *                                                                 04840044
           PERFORM 5250-WRITE-DETAIL-RECORD.                            04850035
      *                                                                 04860006
           PERFORM 4200-READ-PRCHG-FILE.                                04870026
      *                                                                 04880057
      *                                                                 04890057
      ******************************************************************04900057
       2300-PROCESS-MARKDOWNS.                                          04910058
      ******************************************************************04920057
           IF PS-FIRST-MKDN-REC                                         04930057
               MOVE 'N'                TO PS-MKDN-PROCESS-SW            04940057
               MOVE '40'               TO PV-HOLD-TRAN-CODE             04950057
               SET PC-TRAN-MARKDOWN    TO TRUE                          04960057
               MOVE PC-TRAN-TYPE       TO DL-PC-TRAN-TYPE               04970057
               PERFORM 5100-WRITE-REPORT-TITLES                         04980057
           END-IF                                                       04990057
      *                                                                 05000057
           ADD +1                  TO PA-MARKDOWN-READ.                 05010057
      *                                                                 05020057
           COMPUTE PV-MARKDOWN-OLD-EXTD =                               05030057
                                     ML020-PC-OLD-PR-AMT * ML020-PC-QTY.05040057
           COMPUTE PV-MARKDOWN-NEW-EXTD =                               05050057
                                     ML020-PC-NEW-PR-AMT * ML020-PC-QTY.05060057
      *                                                                 05070057
           ADD PV-MARKDOWN-OLD-EXTD      TO PA-MARKDOWN-OLD.            05080057
           ADD PV-MARKDOWN-NEW-EXTD      TO PA-MARKDOWN-NEW.            05090057
      *                                                                 05100006
           PERFORM 7000-GET-STORE-NAME.                                 05110057
      *                                                                 05120057
           MOVE ML020-STORE-NBR           TO  DL-PC-STORE-NBR.          05130057
W26603     MOVE XMT00001-LOC-10-ABBR-NM   TO  DL-PC-STORE-NAME.         05140067
      *                                                                 05150057
           MOVE PV-MARKDOWN-OLD-EXTD  TO  DL-PC-TRANS-TOTAL1.           05160057
                                                                        05170057
           MOVE PV-MARKDOWN-NEW-EXTD  TO  DL-PC-TRANS-TOTAL2.           05180057
      *                                                                 05190057
      ******************************************************************05200057
       2400-PROCESS-MARKUPS.                                            05210057
      ******************************************************************05220057
           IF PS-FIRST-MKUP-REC                                         05230057
               MOVE 'N'                TO PS-MKUP-PROCESS-SW            05240057
               SET PC-TRAN-MARKUP      TO TRUE                          05250057
               MOVE PC-TRAN-TYPE       TO DL-PC-TRAN-TYPE               05260057
               IF PV-HOLD-TRAN-CODE = '40'                              05270057
                   PERFORM 5350-WRITE-SUBTOTAL-LINES                    05280057
                       MOVE '50'           TO PV-HOLD-TRAN-CODE         05290057
                       PERFORM 5100-WRITE-REPORT-TITLES                 05300057
                ELSE                                                    05310057
                   IF PV-HOLD-TRAN-CODE = '20'                          05320057
                       MOVE '50'           TO PV-HOLD-TRAN-CODE         05330057
                       PERFORM 5100-WRITE-REPORT-TITLES                 05340057
                    END-IF                                              05350057
                END-IF                                                  05360057
           END-IF.                                                      05370057
      *                                                                 05380057
           ADD +1                         TO PA-MARKUP-READ             05390057
      *                                                                 05400057
           COMPUTE PV-MARKUP-OLD-EXTD =                                 05410057
                                     ML020-PC-OLD-PR-AMT * ML020-PC-QTY.05420057
           COMPUTE PV-MARKUP-NEW-EXTD =                                 05430057
                                     ML020-PC-NEW-PR-AMT * ML020-PC-QTY.05440057
      *                                                                 05450057
           ADD PV-MARKUP-OLD-EXTD         TO PA-MARKDOWN-OLD.           05460057
           ADD PV-MARKUP-NEW-EXTD         TO PA-MARKDOWN-NEW.           05470057
      *                                                                 05480057
           PERFORM 7000-GET-STORE-NAME.                                 05490057
      *                                                                 05500057
           MOVE ML020-STORE-NBR           TO  DL-PC-STORE-NBR.          05510057
W26603     MOVE XMT00001-LOC-10-ABBR-NM   TO  DL-PC-STORE-NAME.         05520067
      *                                                                 05530057
           MOVE PV-MARKUP-OLD-EXTD        TO  DL-PC-TRANS-TOTAL1.       05540057
                                                                        05550057
           MOVE PV-MARKUP-NEW-EXTD        TO  DL-PC-TRANS-TOTAL2.       05560057
      *                                                                 05570057
      ******************************************************************05580006
       4000-READ-DATE-FILE.                                             05590001
      ******************************************************************05600000
      *                                                                 05610000
           READ CONTROL-DATE-FILE                                       05620001
             INTO CC-CONTROL-CARD                                       05630001
               AT END                                                   05640000
                   DISPLAY ' CONTROL CARD IS EMPTY'                     05650001
                   MOVE +4001          TO ABEND-CODE                    05660001
                   PERFORM 9900-COMMON-ABEND-ROUTINE                    05670000
           END-READ.                                                    05680000
                                                                        05690000
       EJECT                                                            05700000
                                                                        05710000
      ******************************************************************05720000
       4100-READ-SALES-FILE.                                            05730001
      ******************************************************************05740000
      *                                                                 05750000
           READ SALE-REVERSAL-FILE                                      05760015
             INTO ML020-COMPOSITE-RECORD                                05770006
               AT END                                                   05780000
                   SET PS-END-OF-SALES TO TRUE.                         05790001
                                                                        05800000
      ******************************************************************05810000
       4200-READ-PRCHG-FILE.                                            05820001
      ******************************************************************05830000
      *                                                                 05840000
           READ PRICE-CHANGE-REVERSAL-FILE                              05850015
             INTO ML020-COMPOSITE-RECORD                                05860006
               AT END                                                   05870006
                   SET PS-END-OF-PRCHG TO TRUE.                         05880006
      *                                                                 05890005
      *                                                                 05900016
      ******************************************************************05910016
       5000-FORMAT-HEADINGS.                                            05920016
      ******************************************************************05930016
      *                                                                 05940016
           IF ML020-DEPT-NBR = '099'                                    05950016
                SET  HD2-REVERSALS       TO TRUE                        05960017
                SET  PC-REPORT-REVERSALS TO TRUE                        05970017
                MOVE PC-PROGRAM-NAME     TO HD-REPORT-NAME              05980016
                MOVE PC-REPORT-VERSION   TO HD-REPORT-VERSION           05990017
           ELSE                                                         06000016
                SET  HD2-ALLOCATES       TO TRUE                        06010017
                SET  PC-REPORT-ALLOCATE  TO TRUE                        06020018
                MOVE PC-PROGRAM-NAME     TO HD-REPORT-NAME              06030016
                MOVE PC-REPORT-VERSION   TO HD-REPORT-VERSION           06040018
           END-IF                                                       06050016
      *                                                                 06060016
           PERFORM 5100-WRITE-REPORT-TITLES.                            06070016
      *                                                                 06080016
      ******************************************************************06090005
       5100-WRITE-REPORT-TITLES.                                        06100005
      ******************************************************************06110005
                                                                        06120000
           ADD 1                       TO PA-PAGE-COUNT.                06130009
           MOVE PA-PAGE-COUNT          TO HD2-PAGE-COUNT.               06140009
                                                                        06150005
           WRITE REPORT-RECORD      FROM HEADER-TITLE-LINE1             06160006
               AFTER ADVANCING PAGE.                                    06170006
                                                                        06180006
           WRITE REPORT-RECORD      FROM HEADER-TITLE-LINE2             06190006
               AFTER ADVANCING 1 LINE.                                  06200006
                                                                        06210006
           IF PV-HOLD-TRAN-CODE = '20'                                  06220044
               WRITE REPORT-RECORD      FROM COLUMN-TITLE1-HEADINGS     06230044
                   AFTER ADVANCING 2 LINES                              06240044
               WRITE REPORT-RECORD      FROM COLUMN-TITLE2-HEADINGS     06250044
                   AFTER ADVANCING 1 LINE                               06260044
           ELSE                                                         06270044
               WRITE REPORT-RECORD      FROM COLUMN-PC-HEADING1         06280044
                   AFTER ADVANCING 2 LINES                              06290044
               WRITE REPORT-RECORD      FROM COLUMN-PC-HEADING2         06300044
                   AFTER ADVANCING 1 LINE                               06310044
                                                                        06320044
           MOVE SPACES                 TO REPORT-RECORD.                06330006
                                                                        06340000
           MOVE +5                     TO PA-LINE-COUNT.                06350052
      *                                                                 06360044
      ******************************************************************06370000
       5200-WRITE-DETAIL-RECORD.                                        06380006
      ******************************************************************06390000
      *                                                                 06400000
           IF PA-LINE-COUNT > PC-MAX-LINE-COUNT                         06410009
               PERFORM 5100-WRITE-REPORT-TITLES.                        06420006
                                                                        06430000
           WRITE REPORT-RECORD      FROM DETAIL-LINE-SALES              06440035
               AFTER ADVANCING 1 LINE.                                  06450000
                                                                        06460006
           ADD 1                       TO PA-LINE-COUNT.                06470009
                                                                        06480000
      ******************************************************************06490035
      *PRICE CHANGES                                                    06500035
       5250-WRITE-DETAIL-RECORD.                                        06510035
      ******************************************************************06520035
      *                                                                 06530035
           IF PA-LINE-COUNT > PC-MAX-LINE-COUNT                         06540035
               PERFORM 5100-WRITE-REPORT-TITLES.                        06550035
                                                                        06560035
           WRITE REPORT-RECORD      FROM DETAIL-PC-LINE                 06570035
               AFTER ADVANCING 1 LINE.                                  06580035
                                                                        06590035
           ADD 1                       TO PA-LINE-COUNT.                06600035
                                                                        06610035
       EJECT                                                            06620000
                                                                        06630006
      ******************************************************************06640006
       5300-WRITE-SUBTOTAL-LINES.                                       06650006
      ******************************************************************06660006
      *                                                                 06670006
           IF PA-LINE-COUNT > PC-MAX-LINE-COUNT                         06680009
               PERFORM 5100-WRITE-REPORT-TITLES.                        06690006
                                                                        06700006
           WRITE REPORT-RECORD      FROM SUB-TOTAL-LINE1                06710007
               AFTER ADVANCING 2 LINES.                                 06720007
                                                                        06730006
           WRITE REPORT-RECORD      FROM SUB-TOTAL-LINE2                06740007
               AFTER ADVANCING 1 LINES.                                 06750027
                                                                        06760007
           MOVE SPACES TO SUB-TOTAL-LINE2.                              06770030
                                                                        06780028
           WRITE REPORT-RECORD      FROM SUB-TOTAL-LINE2                06790029
               AFTER ADVANCING 2 LINES.                                 06800027
           ADD 4                       TO PA-LINE-COUNT.                06810056
                                                                        06820027
      ******************************************************************06830043
       5350-WRITE-SUBTOTAL-LINES.                                       06840043
      ******************************************************************06850043
      *                                                                 06860043
           EVALUATE TRUE                                                06870043
               WHEN ML020-MKDOWN                                        06880043
                   MOVE PA-MARKDOWN-OLD   TO  ST-PC-SUBTOTAL-ONE        06890043
                   MOVE PA-MARKDOWN-NEW   TO  ST-PC-SUBTOTAL-TWO        06900043
               WHEN ML020-MKUP                                          06910043
                   IF PV-HOLD-TRAN-CODE = '40' AND PS-FIRST-MKUP-REC    06920043
                       MOVE PA-MARKDOWN-OLD   TO  ST-PC-SUBTOTAL-ONE    06930043
                       MOVE PA-MARKDOWN-NEW   TO  ST-PC-SUBTOTAL-TWO    06940043
                   ELSE                                                 06950043
                       MOVE PA-MARKUP-OLD     TO  ST-PC-SUBTOTAL-ONE    06960043
                       MOVE PA-MARKUP-NEW     TO  ST-PC-SUBTOTAL-TWO    06970043
                   END-IF                                               06980043
           END-EVALUATE.                                                06990060
      *                                                                 07000060
           ADD 3                       TO PA-LINE-COUNT.                07010009
      *                                                                 07020044
           IF PA-LINE-COUNT > PC-MAX-LINE-COUNT                         07030044
               PERFORM 5100-WRITE-REPORT-TITLES.                        07040044
                                                                        07050044
           WRITE REPORT-RECORD      FROM SUB-TOTAL-PC-LINE1             07060047
               AFTER ADVANCING 2 LINES.                                 07070044
                                                                        07080044
           WRITE REPORT-RECORD      FROM SUB-TOTAL-PC-LINE2             07090047
               AFTER ADVANCING 1 LINES.                                 07100044
                                                                        07110044
           MOVE SPACES TO SUB-TOTAL-LINE2.                              07120044
                                                                        07130044
           WRITE REPORT-RECORD      FROM SUB-TOTAL-LINE2                07140044
               AFTER ADVANCING 2 LINES.                                 07150044
           ADD 3                       TO PA-LINE-COUNT.                07160044
                                                                        07170044
      *                                                                 07180044
      ******************************************************************07190005
       7000-GET-STORE-NAME.                                             07200005
      ******************************************************************07210005
      *                                                                 07220005
W26603     MOVE ML020-STORE-NBR-9   TO XMT00001-LOC-NBR.                07230064
W26603                                                                  07240064
           EXEC SQL                                                     07250005
W26603         SELECT LOC_10_ABBR_NM                                    07260067
W26603         INTO   :XMT00001-LOC-10-ABBR-NM                          07270067
W26603         FROM   XMT_LOC                                           07280064
W26603         WHERE  LOC_NBR = :XMT00001-LOC-NBR                       07290064
           END-EXEC                                                     07300005
                                                                        07310005
           EVALUATE SQLCODE                                             07320013
               WHEN ZERO                                                07330013
                   CONTINUE                                             07340005
               WHEN +100                                                07350013
                   DISPLAY ' STORE ON INPUT RECORD NOT FOUND ON XMTLOC' 07360064
               WHEN OTHER                                               07370013
                   DISPLAY ' PROBLEM GOING AFTER XMTLOC'                07380064
           END-EVALUATE.                                                07390005
      *                                                                 07400005
      ******************************************************************07410005
       8000-EOJ.                                                        07420000
      ******************************************************************07430000
      *                                                                 07440000
           CLOSE CONTROL-DATE-FILE                                      07450007
                 SALE-REVERSAL-FILE                                     07460007
                 PRICE-CHANGE-REVERSAL-FILE                             07470007
                 REPORT-FILE.                                           07480007
                                                                        07490000
       EJECT                                                            07500000
                                                                        07510000
      ******************************************************************07520000
       9900-COMMON-ABEND-ROUTINE.                                       07530000
      ******************************************************************07540000
      *                                                                 07550000
           DISPLAY ABEND-CODE.                                          07560000
                                                                        07570000
           CALL 'ILBOABN0' USING ABEND-CODE.                            07580000
                                                                        07590000
