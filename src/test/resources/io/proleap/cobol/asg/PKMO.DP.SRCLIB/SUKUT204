000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.    SUKUT204.                                         00050000
000600 AUTHOR.        DENISE HAHN.                                      00060000
000700 INSTALLATION.  KOHLS.                                            00070000
000800 DATE-WRITTEN   MAY 2020.                                         00080018
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200*  THIS PROGRAM CHECKS FOR CONVEYOR DIVERT INFORMATION BEING     *00120000
001300*  SENT FROM THE DC'S.                                           *00130000
001310*  IF WE ARE RECEIVING CONVEYOR DIVERTS, THIS PROGRAM WILL CHECK *00131000
001320*  THE AMOUNT OF DELAY BETWEEN THE TIMESTAMP FROM THE CONVEYOR   *00132035
001400*  AND WHEN WE RECEIVED THE DIVERT IN THE DATABASE.              *00140000
001500*  IF THE DELAY IS > THE LIMIT SET BY DC/CONVEY VENDOR, THEN AN  *00150000
001510*  EMAIL WILL BE SENT TO INDICATE THAT DIVERTS ARE NOT BEING     *00151000
001520*  RECEIVED IN A TIMELY MANNER.                                  *00152000
001600******************************************************************00160000
001700                                                                  00170000
001800******************************************************************00180000
001900 ENVIRONMENT DIVISION.                                            00190000
002000******************************************************************00200000
002100                                                                  00210000
002200 CONFIGURATION SECTION.                                           00220000
002300                                                                  00230000
002400 SOURCE-COMPUTER.        IBM-3090.                                00240000
002500 OBJECT-COMPUTER.        IBM-3090.                                00250000
002600                                                                  00260000
002700 INPUT-OUTPUT SECTION.                                            00270000
002800                                                                  00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT SU-CNVYR-CNTL-FILE                                    00310000
003200         ASSIGN TO INP01.                                         00320000
003300                                                                  00330000
003400     SELECT ERROR-OUT-FILE                                        00340000
003500         ASSIGN TO OUT01.                                         00350000
003600                                                                  00360000
003700******************************************************************00370000
003800 DATA DIVISION.                                                   00380000
003900******************************************************************00390000
004000                                                                  00400000
004100 FILE SECTION.                                                    00410000
004200*                                                                 00420000
004300 FD  SU-CNVYR-CNTL-FILE                                           00430000
004400     RECORDING MODE IS F                                          00440000
004500     LABEL RECORDS ARE STANDARD                                   00450000
004600     BLOCK CONTAINS 0 RECORDS.                                    00460000
004700 01  SU-CNVYR-CNTL-FILE-RECORD        PIC  X(75).                 00470000
004800*                                                                 00480000
004900*                                                                 00490000
005000 FD  ERROR-OUT-FILE                                               00500000
005100     RECORDING MODE IS F                                          00510000
005200     BLOCK CONTAINS 0 RECORDS                                     00520000
005300     LABEL RECORDS ARE STANDARD.                                  00530000
005400                                                                  00540000
005500 01  ERROR-OUT-RECORD             PIC X(80).                      00550000
005600                                                                  00560000
005700                                                                  00570000
005800******************************************************************00580000
005900 WORKING-STORAGE SECTION.                                         00590000
006000******************************************************************00600000
006100*                                                                 00610000
006200*                                                                 00620000
006300 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00630000
006400                                                   COMP SYNC.     00640000
006500                                                                  00650000
006600***************************************************************** 00660000
006700*    INPUT CONTROL CARD                                           00670000
006800***************************************************************** 00680000
006900 01  CC-CONTROL-CARD.                                             00690000
007000     05  CC-OPER-UNT-ID              PIC 9(04)     VALUE ZERO.    00700000
007100     05  FILLER                      PIC X(03)     VALUE SPACES.  00710000
007200     05  CC-FCLTY-NAME               PIC X(20)     VALUE SPACES.  00720000
007210     05  FILLER                      PIC X(03)     VALUE SPACES.  00721000
007220     05  CC-PERIOD                   PIC X(08)     VALUE SPACES.  00722000
007230     05  CC-PERIOD-R7 REDEFINES CC-PERIOD.                        00723000
007240         10  CC-PERIOD-7             PIC X(07).                   00724000
007250         10  FILLER                  PIC X(01).                   00725000
007260     05  CC-PERIOD-R6 REDEFINES CC-PERIOD.                        00726000
007270         10  CC-PERIOD-6             PIC X(06).                   00727000
007280         10  FILLER                  PIC X(02).                   00728000
007290     05  CC-PERIOD-R5 REDEFINES CC-PERIOD.                        00729000
007291         10  CC-PERIOD-5             PIC X(05).                   00729100
007292         10  FILLER                  PIC X(03).                   00729200
007293     05  CC-PERIOD-R4 REDEFINES CC-PERIOD.                        00729300
007294         10  CC-PERIOD-4             PIC X(04).                   00729400
007295         10  FILLER                  PIC X(04).                   00729500
007296     05  CC-PERIOD-R3 REDEFINES CC-PERIOD.                        00729600
007297         10  CC-PERIOD-3             PIC X(03).                   00729700
007298         10  FILLER                  PIC X(05).                   00729800
007299                                                                  00729900
007300 01  DK-DB2-KEYS.                                                 00730000
007400     05  DK-OPER-UNT-ID              PIC S9(04)    VALUE +0       00740000
007500                                                   COMP SYNC.     00750000
007600     05  DK-LOC-ID                   PIC S9(04)    VALUE +0       00760000
007700                                                   COMP SYNC.     00770000
007800 01  HEADING-OUT.                                                 00780000
007900     05  HEAD-REC                    PIC X(80)     VALUE SPACES.  00790000
008000                                                                  00800000
008100 01  PC-PROGRAM-CONSTANTS.                                        00810000
008200     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          00820000
008300         'SUKUT204'.                                              00830000
008400     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       00840000
008500                                                   COMP SYNC.     00850000
008600 01  PS-PROGRAM-SWITCHES.                                         00860000
008700     05  PS-EOF-CNTL-FILE-SW         PIC  X(01)    VALUE 'N'.     00870000
008800         88  PS-EOF-CNTL-FILE                      VALUE 'Y'.     00880000
008900         88  PS-NOT-EOF-CNTL-FILE                  VALUE 'N'.     00890000
009000     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     00900000
009100         88  PS-END-OF-CURSOR                      VALUE 'Y'.     00910000
009200         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     00920000
009300     05  PS-CONVEYOR-VENDORS-SW      PIC  X(01)    VALUE 'S'.     00930000
009400         88  PS-SINGLE-CONVEYOR-VENDOR             VALUE 'S'.     00940000
009500         88  PS-MULTI-CONVEYOR-VENDORS             VALUE 'M'.     00950000
009510         88  PS-SORTER-CONVEYOR-CHECK              VALUE 'C'.     00951000
009520     05  PS-ADDITIONAL-CHECK-SW      PIC  X(01)    VALUE 'N'.     00952000
009530         88  PS-ADDITIONAL-CHECK-NEEDED            VALUE 'Y'.     00953000
009540         88  PS-NO-ADDITIONAL-CHECK-NEEDED         VALUE 'N'.     00954000
009550     05  PS-DELAYED-DIVERTS-SW       PIC  X(01)    VALUE 'N'.     00955019
009560         88  PS-DELAYED-DIVERTS                    VALUE 'Y'.     00956018
009570         88  PS-NO-DELAYED-DIVERTS                 VALUE 'N'.     00957018
009580                                                                  00958000
009600     05  PS-EOF-ASGMT-CSR-SW         PIC  X(01)    VALUE 'N'.     00960000
009700         88  PS-EOF-ASGMT-CSR                      VALUE 'Y'.     00970000
009800         88  PS-NOT-EOF-ASGMT-CSR                  VALUE 'N'.     00980000
009900                                                                  00990000
010000 01  PV-PROGRAM-VARIABLES.                                        01000000
010100     05  PV-COUNTER                  PIC S9(04)    VALUE ZERO     01010000
010200                                                   COMP SYNC.     01020000
010201     05  PV-PARM-MINUTES             PIC S9(09)    VALUE ZERO     01020100
010202                                                   COMP SYNC.     01020200
010203     05  PV-CURRENT-TIMESTAMP        PIC  X(26)    VALUE SPACES.  01020300
010207     05  PV-CALC-TIMESTAMP           PIC  X(26)    VALUE SPACES.  01020705
010208     05  PV-MAX-DIVERT-TIMESTAMP     PIC  X(26)    VALUE SPACES.  01020805
010209     05  PV-MAX-DIVERT-TIMESTAMP-R REDEFINES                      01020905
010210                                   PV-MAX-DIVERT-TIMESTAMP.       01021005
010211         10  PV-MAX-TMST-DATE-CST    PIC  X(10).                  01021105
010212         10  FILLER                  PIC  X(01).                  01021205
010213         10  PV-MAX-TMST-HHMM-CST    PIC  X(05).                  01021305
010220         10  FILLER                  PIC  X(10).                  01022000
010230                                                                  01023000
010240     05  PV-DISPLAY-COUNT            PIC ZZZ,ZZZ,ZZ9.             01024000
010250                                                                  01025000
010260     05  PV-OPEN-ASGMT-COUNT         PIC S9(09)    VALUE ZERO     01026000
010270                                                   COMP-3.        01027000
010280     05  PV-CLOSED-ASGMT-COUNT       PIC S9(09)    VALUE ZERO     01028000
010290                                                   COMP-3.        01029000
010300     05  PV-PARM-SEQ-NBR             PIC S9(09)    VALUE ZERO     01030000
010400                                                   COMP-3.        01040000
010500     05  PV-SINGLE-CNVYR-VENDOR      PIC  X(01)    VALUE SPACES.  01050000
010600     05  PV-CNVY-VENDOR              PIC  X(20)    VALUE SPACES.  01060000
010700     05  PV-BEGIN-RANGE              PIC  X(50)    VALUE SPACES.  01070015
010710     05  PV-BEGIN-RANGE-R REDEFINES PV-BEGIN-RANGE.               01071016
010720         10  PV-BEGIN-RANGE-1-4      PIC  X(04).                  01072015
010730         10  FILLER                  PIC  X(46).                  01073015
010800     05  PV-END-RANGE                PIC  X(50)    VALUE SPACES.  01080015
010810     05  PV-END-RANGE-R REDEFINES PV-END-RANGE.                   01081015
010820         10  PV-END-RANGE-1-4        PIC  X(04).                  01082015
010830         10  FILLER                  PIC  X(46).                  01083015
010910     05  PV-ADDL-DOOR                PIC  X(50)    VALUE SPACES.  01091016
010920     05  PV-ADDL-DOOR-R REDEFINES PV-ADDL-DOOR.                   01092015
010930         10  PV-ADDL-DOOR-1-4        PIC  X(04).                  01093015
010940         10  FILLER                  PIC  X(46).                  01094015
011000     05  PV-DC-NBR                   PIC S9(10)V9(5) VALUE ZERO   01100000
011100                                                     COMP-3.      01110000
011200     05  PV-SORTER-NAME              PIC  X(20)    VALUE SPACES.  01120000
011300     05  PV-OPER-UNT-ID-DISP.                                     01130000
011400         10  PV-OPER-UNT-ID-N        PIC 9(04)     VALUE ZERO.    01140000
011500                                                                  01150000
011800     05  PV-ASGMT-COUNT         PIC S9(09) VALUE ZERO COMP.       01180000
011900     05  PV-EVENT-SUM           PIC S9(09) VALUE ZERO COMP.       01190000
012000                                                                  01200000
012100     05  PV-ASGMT-MSG-1         PIC  X(80) VALUE                  01210000
012200         '*** ACTIVE LABOR ASSIGNMENT SHOWN BELOW ***'.           01220000
012300     05  PV-ASGMT-MSG-FLAT.                                       01230000
012400         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01240000
012500         10  FILLER             PIC  X(12) VALUE 'FLAT........'.  01250000
012600         10  FILLER             PIC  X(04) VALUE SPACES.          01260000
012610         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01261000
012620         10  PV-MSG-FLAT-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01262000
012621         10  FILLER             PIC  X(04) VALUE SPACES.          01262100
012622         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01262200
012623         10  PV-MSG-FLAT-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01262300
012624         10  FILLER             PIC  X(31) VALUE SPACES.          01262400
012625     05  PV-ASGMT-MSG-RECV.                                       01262500
012626         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01262600
012627         10  FILLER             PIC  X(11) VALUE 'RECV.......'.   01262700
012628         10  FILLER             PIC  X(03) VALUE SPACES.          01262800
012629         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01262900
012630         10  PV-MSG-RECV-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01263000
012631         10  FILLER             PIC  X(04) VALUE SPACES.          01263100
012632         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01263200
012633         10  PV-MSG-RECV-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01263300
012634         10  FILLER             PIC  X(32) VALUE SPACES.          01263400
012635     05  PV-ASGMT-MSG-RLABL.                                      01263500
012636         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01263600
012637         10  FILLER             PIC  X(11) VALUE 'RLABL......'.   01263700
012638         10  FILLER             PIC  X(03) VALUE SPACES.          01263800
012639         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01263900
012640         10  PV-MSG-RLABL-CNT   PIC  ZZZ,ZZZ,ZZ9.                 01264000
012641         10  FILLER             PIC  X(04) VALUE SPACES.          01264100
012642         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01264200
012643         10  PV-MSG-RLABL-SUM   PIC  ZZZ,ZZZ,ZZ9.                 01264300
012644         10  FILLER             PIC  X(32) VALUE SPACES.          01264400
012645     05  PV-ASGMT-MSG-SHIP.                                       01264500
012646         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01264600
012647         10  FILLER             PIC  X(11) VALUE 'SHIP.......'.   01264713
012648         10  FILLER             PIC  X(03) VALUE SPACES.          01264814
012649         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01264900
012650         10  PV-MSG-SHIP-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01265000
012651         10  FILLER             PIC  X(04) VALUE SPACES.          01265100
012652         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01265200
012653         10  PV-MSG-SHIP-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01265300
012654         10  FILLER             PIC  X(32) VALUE SPACES.          01265400
012655     05  PV-ASGMT-MSG-P2L.                                        01265500
012656         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01265600
012657         10  FILLER             PIC  X(11) VALUE 'P2L........'.   01265713
012658         10  FILLER             PIC  X(03) VALUE SPACES.          01265814
012659         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01265900
012660         10  PV-MSG-P2L-CNT     PIC  ZZZ,ZZZ,ZZ9.                 01266000
012661         10  FILLER             PIC  X(04) VALUE SPACES.          01266100
012662         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01266200
012663         10  PV-MSG-P2L-SUM     PIC  ZZZ,ZZZ,ZZ9.                 01266300
012664         10  FILLER             PIC  X(32) VALUE SPACES.          01266400
012665     05  PV-ASGMT-MSG-MASTCON.                                    01266500
012666         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01266600
012667         10  FILLER             PIC  X(11) VALUE 'MASTCON....'.   01266713
012668         10  FILLER             PIC  X(03) VALUE SPACES.          01266814
012669         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01266900
012670         10  PV-MSG-MAST-CNT    PIC  ZZZ,ZZZ,ZZ9.                 01267000
012671         10  FILLER             PIC  X(04) VALUE SPACES.          01267100
012672         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01267200
012673         10  PV-MSG-MAST-SUM    PIC  ZZZ,ZZZ,ZZ9.                 01267300
012674         10  FILLER             PIC  X(31) VALUE SPACES.          01267400
012675     05  PV-ASGMT-MSG-OTHER.                                      01267500
012676         10  FILLER             PIC  X(11) VALUE 'WORK AREA: '.   01267600
012677         10  PV-MSG-OTHER       PIC  X(11) VALUE SPACES.          01267713
012678         10  FILLER             PIC  X(03) VALUE SPACES.          01267814
012679         10  FILLER             PIC  X(13) VALUE 'OPEN ASGMTS: '. 01267900
012680         10  PV-MSG-OTH-CNT     PIC  ZZZ,ZZZ,ZZ9.                 01268000
012681         10  FILLER             PIC  X(04) VALUE SPACES.          01268100
012682         10  FILLER             PIC  X(10) VALUE '# EVENTS: '.    01268200
012683         10  PV-MSG-OTH-SUM     PIC  ZZZ,ZZZ,ZZ9.                 01268300
012684         10  FILLER             PIC  X(31) VALUE SPACES.          01268400
012688         10  PV-NBR-DAYS-BACK      PIC S9(9) COMP.                01268800
012689         10  PV-DISP-NBR-DAYS      PIC  Z(9).                     01268900
012690         10  PV-DIVERT-BEGIN-TMST  PIC  X(26).                    01269000
012691                                                                  01269106
012692     05  PV-SYS-TMST-LOCAL         PIC  X(26)    VALUE SPACES.    01269205
012693     05  PV-SYS-TMST-CENTRAL       PIC  X(26)    VALUE SPACES.    01269305
012694     05  PV-TMST-DIFF              PIC  S9(10)V9(5) COMP-3.       01269406
012695     05  PV-MULT-LIMIT             PIC  S9(10)V9(5) COMP-3.       01269506
012697     05  PV-SNGL-LIMIT             PIC  S9(10)V9(5) COMP-3.       01269706
012699     05  PV-SRTR-LIMIT             PIC  S9(10)V9(5) COMP-3.       01269906
012700                                                                  01270006
012701     05  PV-DISP-TMST-DIFF         PIC Z(10) VALUE ZEROES.        01270106
012702     05  PV-DISP-LIMIT             PIC Z(10) VALUE ZEROES.        01270206
012703     05  PV-DISP-DIFF              PIC Z(10) VALUE ZEROES.        01270306
012706                                                                  01270606
012707 01  PV-ABEND-VARIABLES.                                          01270706
012708     05  PV-SQLCODE                  PIC S9(9).                   01270806
012709     05  PV-DISPLAY-SQLCODE          PIC -------999.              01270906
012710     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'SUKUT204'.  01271006
012711     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      01271106
012712     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      01271206
012713     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      01271306
012720     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      01272006
012800     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      01280000
012900     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      01290000
013000     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      01300000
013100     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      01310000
013200     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      01320000
013300*                                                                 01330000
013400*                                                                 01340000
013500******************************************************************01350000
013600** DIVERT MONITORING CONTROL CARD LAYOUT COPYBOOK               **01360000
013700******************************************************************01370000
013800     COPY SURD096.                                                01380000
013900*                                                                 01390000
014000*                                                                 01400000
014100******************************************************************01410000
014200** DB2 FORMATTED MESSAGE AREA                                   **01420000
014300******************************************************************01430000
014400     COPY DPWS004.                                                01440000
014500*                                                                 01450000
014600*                                                                 01460000
014700******************************************************************01470000
014800** COMMUNICATIONS AREA FOR DB2                                  **01480000
014900******************************************************************01490000
015000     EXEC SQL                                                     01500000
015100          INCLUDE SQLCA                                           01510000
015200     END-EXEC.                                                    01520000
015300*                                                                 01530000
015400*                                                                 01540000
015500******************************************************************01550000
015600** COBOL DECLARATION AND DCLGEN MEMBER FOR THE KOHLS PROCESSING **01560000
015700** PARAMETER TABLE                                              **01570000
015800******************************************************************01580000
015900     EXEC SQL                                                     01590000
016000          INCLUDE TKRPRPM                                         01600000
016100     END-EXEC.                                                    01610000
016200*                                                                 01620000
016300*                                                                 01630000
016400******************************************************************01640000
016500** COBOL DECLARATION AND DCLGEN MEMBER FOR THE KOHLS CARTON     **01650000
016600** DIVERT TABLE                                                 **01660000
016700******************************************************************01670000
016800     EXEC SQL                                                     01680000
016900          INCLUDE TSUCRDV                                         01690000
017000     END-EXEC.                                                    01700000
017100*                                                                 01710000
017200*                                                                 01720000
017300******************************************************************01730000
017400*  DB2 DECLARATION - WMOS INTEGRATION TYPE                        01740000
017500*      TABLE (WST_INTGRTN_TYP)                                    01750000
017600******************************************************************01760000
017700     EXEC SQL                                                     01770000
017800         INCLUDE WST00008                                         01780000
017900     END-EXEC.                                                    01790000
018000                                                                  01800000
018100******************************************************************01810000
018200*  DB2 DECLARATION - WMOS ATTRIBUTE DEFINITION                    01820000
018300*      TABLE (WST_ATTR_DEFN)                                      01830000
018400******************************************************************01840000
018500     EXEC SQL                                                     01850000
018600         INCLUDE WST00009                                         01860000
018700     END-EXEC.                                                    01870000
018800                                                                  01880000
018900******************************************************************01890000
019000*  DB2 DECLARATION - WMOS ATTRIBUTE ELEMENTS                      01900000
019100*      TABLE (WST_ATTR_ELEM)                                      01910000
019200******************************************************************01920000
019300     EXEC SQL                                                     01930000
019400         INCLUDE WST00010                                         01940000
019500     END-EXEC.                                                    01950000
019600                                                                  01960000
019700******************************************************************01970000
019800*  DB2 DECLARATION - LABOR ASSIGNMENT TABLE (DLT_ASGMT)           01980000
019900******************************************************************01990000
020000     EXEC SQL                                                     02000000
020100         INCLUDE DLT00004                                         02010000
020200     END-EXEC.                                                    02020000
020300*                                                                 02030000
020400******************************************************************02040000
020500*  DB2 CURSOR DECLARATION - MULTIPLE CONVEYOR VENDORS             02050000
020600******************************************************************02060000
020700     EXEC SQL                                                     02070000
020800          DECLARE CNVYR-VEND-CSR CURSOR FOR                       02080000
020900           SELECT  T2.ATTR_ELEM_SEQ_NBR                           02090001
020910                 , T2.DC_NBR                                      02091001
020920                 , T2.CNVY_VENDOR                                 02092001
020930                 , T2.BEGIN_RANGE                                 02093001
020940                 , T2.END_RANGE                                   02094001
020950                 , T2.ADDL_DOOR                                   02095001
020960                 , T2.OPER_UNT_ID                                 02096001
020970                 , T2.DIVERT_TMST                                 02097001
020980                 , T2.BRCDE_NBR                                   02098001
020990                 , T2.SHIPT_UNT_ID                                02099001
020991                 , T2.ACTV_CDE                                    02099101
020992                 , T2.DOOR_ID                                     02099201
020993                 , T2.DIVERT_SYS_DTE                              02099301
020994                 , T2.DIVERT_SYS_TM                               02099401
020995                 , T2.SYS_TMST_LOCAL                              02099501
020996                 , T2.SYS_TMST_CENTRAL                            02099601
020997                 , T2.TMST_DIFF                                   02099701
020998           FROM                                                   02099801
020999           (SELECT                                                02099901
021000                     T1.ATTR_ELEM_SEQ_NBR                         02100001
021001                   , T1.DC_NBR                                    02100101
021002                   , T1.CNVY_VENDOR                               02100201
021003                   , T1.BEGIN_RANGE                               02100301
021004                   , T1.END_RANGE                                 02100401
021005                   , T1.ADDL_DOOR                                 02100501
021006                   , T1.OPER_UNT_ID                               02100601
021007                   , T1.SHIPT_UNT_ID                              02100701
021008                   , T1.DIVERT_TMST                               02100801
021009                   , T1.DIVERT_NBR                                02100901
021010                   , T1.DIVERT_LOC_ID                             02101001
021011                   , T1.BRCDE_NBR                                 02101101
021012                   , T1.ACTV_CDE                                  02101201
021013                   , T1.DOOR_ID                                   02101301
021014                   , T1.DEST_OPER_UNT_ID                          02101401
021015                   , T1.DIVERT_SYS_DTE                            02101501
021016                   , T1.DIVERT_SYS_TM                             02101601
021017                   , T1.SYS_TMST_LOCAL                            02101701
021018                   , T1.SYS_TMST_CENTRAL                          02101801
021019                   , T1.DIVERT_TMST - T1.SYS_TMST_CENTRAL         02101901
021020                                                AS TMST_DIFF      02102001
021021           FROM                                                   02102101
021022           (SELECT  CC.ATTR_ELEM_SEQ_NBR                          02102201
021023                   , CC.ATTR_ELEM_NBR  AS  DC_NBR                 02102301
021024                   , DD.ATTR_ELEM_TXT  AS  CNVY_VENDOR            02102401
021025                   , EE.ATTR_ELEM_TXT  AS  BEGIN_RANGE            02102501
021026                   , FF.ATTR_ELEM_TXT  AS  END_RANGE              02102601
021027                   , GG.ATTR_ELEM_TXT  AS  ADDL_DOOR              02102701
021028                   , HH.OPER_UNT_ID                               02102801
021029                   , HH.SHIPT_UNT_ID                              02102901
021030                   , HH.DIVERT_TMST                               02103001
021031                   , HH.DIVERT_NBR                                02103101
021032                   , HH.DIVERT_LOC_ID                             02103201
021033                   , HH.BRCDE_NBR                                 02103301
021034                   , HH.ACTV_CDE                                  02103401
021035                   , HH.DOOR_ID                                   02103501
021036                   , HH.DEST_OPER_UNT_ID                          02103601
021037                   , HH.DIVERT_SYS_DTE                            02103701
021038                   , HH.DIVERT_SYS_TM                             02103801
021039                   , TIMESTAMP(HH.DIVERT_SYS_DTE                  02103901
021040                             , HH.DIVERT_SYS_TM)                  02104001
021041                       AS SYS_TMST_LOCAL                          02104101
021042                   , TIMESTAMP(HH.DIVERT_SYS_DTE                  02104201
021043                             , HH.DIVERT_SYS_TM)                  02104301
021044                             - II.FUNC_QTY HOURS                  02104401
021045                       AS SYS_TMST_CENTRAL                        02104501
021047              FROM   WST_INTGRTN_TYP AA                           02104701
021048                   , WST_ATTR_DEFN   BB                           02104801
021049                   , WST_ATTR_ELEM   CC                           02104901
021050                   , WST_ATTR_ELEM   DD                           02105001
021051                   , WST_ATTR_ELEM   EE                           02105101
021052                   , WST_ATTR_ELEM   FF                           02105201
021053                   , WST_ATTR_ELEM   GG                           02105301
021054                   , TSUCRDV         HH                           02105401
021055                   , TKRPRPM         II                           02105501
021056             WHERE   AA.INTGRTN_TYP_CDE   = 'DCCNVYVNDR'          02105601
021057               AND   AA.INTGRTN_TYP_CDE   = BB.INTGRTN_TYP_CDE    02105701
021058               AND   BB.INTGRTN_TYP_CDE   = CC.INTGRTN_TYP_CDE    02105801
021059               AND   BB.INTGRTN_TYP_CDE   = DD.INTGRTN_TYP_CDE    02105901
021060               AND   BB.INTGRTN_TYP_CDE   = EE.INTGRTN_TYP_CDE    02106001
021061               AND   BB.INTGRTN_TYP_CDE   = FF.INTGRTN_TYP_CDE    02106101
021062               AND   BB.INTGRTN_TYP_CDE   = GG.INTGRTN_TYP_CDE    02106201
021063               AND   BB.ATTR_DEFN_SEQ_NBR = 1                     02106301
021064               AND   CC.ATTR_DEFN_SEQ_NBR = 1                     02106401
021065               AND   DD.ATTR_DEFN_SEQ_NBR = 2                     02106501
021066               AND   EE.ATTR_DEFN_SEQ_NBR = 3                     02106601
021067               AND   FF.ATTR_DEFN_SEQ_NBR = 4                     02106701
021068               AND   GG.ATTR_DEFN_SEQ_NBR = 5                     02106801
021069               AND   CC.ATTR_ELEM_SEQ_NBR = DD.ATTR_ELEM_SEQ_NBR  02106901
021070               AND   CC.ATTR_ELEM_SEQ_NBR = EE.ATTR_ELEM_SEQ_NBR  02107001
021071               AND   CC.ATTR_ELEM_SEQ_NBR = FF.ATTR_ELEM_SEQ_NBR  02107101
021072               AND   CC.ATTR_ELEM_SEQ_NBR = GG.ATTR_ELEM_SEQ_NBR  02107201
021073               AND   CC.ATTR_ELEM_NBR     = II.LOC_ID             02107301
021074               AND   II.INTFC_SYS_CDE     = 'KHL'                 02107401
021075               AND   II.SYS_PRC_FUNC_CDE  = 'TIMEZN'              02107501
021076               AND   II.FUNC_BEG_TMST    <= CURRENT TIMESTAMP     02107601
021077               AND   II.FUNC_END_TMST    >= CURRENT TIMESTAMP     02107701
021078                                                                  02107801
021079               AND   CC.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID       02107901
021080               AND   CC.ATTR_ELEM_NBR     = HH.OPER_UNT_ID        02108001
021081               AND  (                                             02108101
021082                     (HH.DOOR_ID         >= EE.ATTR_ELEM_TXT AND  02108201
021083                      HH.DOOR_ID         <= FF.ATTR_ELEM_TXT)     02108301
021084                OR                                                02108401
021085                     (HH.DOOR_ID          = GG.ATTR_ELEM_TXT)     02108501
021086                    )                                             02108601
021087              AND  HH.DIVERT_SYS_DTE > CURRENT DATE - 1 YEAR      02108738
021088              AND  HH.DIVERT_TMST        <= :SU096-CURR-TMST      02108801
021089              AND  HH.DIVERT_TMST        >= :PV-DIVERT-BEGIN-TMST 02108901
021090              AND  HH.DIVERT_TMST IN                              02109001
021091                 (SELECT  MAX(H.DIVERT_TMST)                      02109101
021092                    FROM  WST_INTGRTN_TYP A                       02109201
021093                        , WST_ATTR_DEFN   B                       02109301
021094                        , WST_ATTR_ELEM   C                       02109401
021095                        , WST_ATTR_ELEM   D                       02109501
021096                        , WST_ATTR_ELEM   E                       02109601
021097                        , WST_ATTR_ELEM   F                       02109701
021098                        , WST_ATTR_ELEM   G                       02109801
021099                        , TSUCRDV         H                       02109901
021100                  WHERE A.INTGRTN_TYP_CDE = 'DCCNVYVNDR'          02110001
021101                    AND A.INTGRTN_TYP_CDE = B.INTGRTN_TYP_CDE     02110101
021102                    AND B.INTGRTN_TYP_CDE = C.INTGRTN_TYP_CDE     02110201
021103                    AND B.INTGRTN_TYP_CDE = D.INTGRTN_TYP_CDE     02110301
021104                    AND B.INTGRTN_TYP_CDE = E.INTGRTN_TYP_CDE     02110401
021105                    AND B.INTGRTN_TYP_CDE = F.INTGRTN_TYP_CDE     02110501
021106                    AND B.INTGRTN_TYP_CDE = G.INTGRTN_TYP_CDE     02110601
021107                    AND B.ATTR_DEFN_SEQ_NBR = 1                   02110701
021108                    AND C.ATTR_DEFN_SEQ_NBR = 1                   02110801
021109                    AND D.ATTR_DEFN_SEQ_NBR = 2                   02110901
021110                    AND E.ATTR_DEFN_SEQ_NBR = 3                   02111001
021111                    AND F.ATTR_DEFN_SEQ_NBR = 4                   02111101
021112                    AND G.ATTR_DEFN_SEQ_NBR = 5                   02111201
021113                    AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR 02111301
021114                    AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR 02111401
021115                    AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR 02111501
021116                    AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR 02111601
021117                                                                  02111701
021118                    AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID     02111801
021119                    AND C.ATTR_ELEM_NBR     = H.OPER_UNT_ID       02111901
021120                    AND (                                         02112001
021121                         (H.DOOR_ID   >= E.ATTR_ELEM_TXT  AND     02112101
021122                          H.DOOR_ID   <= F.ATTR_ELEM_TXT)         02112201
021123                     OR                                           02112301
021124                         (H.DOOR_ID    = G.ATTR_ELEM_TXT)         02112401
021125                        )                                         02112501
021126                    AND H.DIVERT_SYS_DTE  > CURRENT DATE - 1 YEAR 02112638
021127                    AND H.DIVERT_TMST  <= :SU096-CURR-TMST        02112701
021128                    AND H.DIVERT_TMST  >= :PV-DIVERT-BEGIN-TMST   02112801
021129                    GROUP BY  C.ATTR_ELEM_SEQ_NBR                 02112901
021130                            , C.ATTR_ELEM_NBR                     02113001
021131                            , D.ATTR_ELEM_TXT                     02113101
021132                            , E.ATTR_ELEM_TXT                     02113201
021133                            , F.ATTR_ELEM_TXT                     02113301
021134                            , G.ATTR_ELEM_TXT                     02113401
021135                            , H.OPER_UNT_ID                       02113501
021136                    )                                             02113601
021137           ) AS T1                                                02113701
021138           ) AS T2                                                02113801
025500                  WITH UR                                         02550001
025600     END-EXEC.                                                    02560000
025700                                                                  02570000
025800                                                                  02580000
025900******************************************************************02590000
026000*  CURSOR TO BE USED TO DISPLAY THE OPEN LABOR ASSIGNMENTS        02600000
026200******************************************************************02620000
026300     EXEC SQL                                                     02630000
026400          DECLARE LABOR-ASGMT-CSR CURSOR FOR                      02640000
026500           SELECT A.WK_TYP_DESC                                   02650000
026600                , COUNT(*)                                        02660000
026700                , SUM(A.LAST_USD_SEQ_NBR)                         02670000
026800             FROM DLT_ASGMT A                                     02680000
026810            WHERE A.DC_NBR  =  :DK-OPER-UNT-ID                    02681000
026820              AND A.ASGMT_STP_TMST  IS NULL                       02682000
026830            GROUP BY A.WK_TYP_DESC                                02683000
026840            ORDER BY A.WK_TYP_DESC                                02684000
026850             WITH UR                                              02685000
026860     END-EXEC.                                                    02686000
026870                                                                  02687000
026880******************************************************************02688000
026890*  DB2 CURSOR DECLARATION - CONVEYOR CHECK BY SORTER              02689000
026891******************************************************************02689100
026892     EXEC SQL                                                     02689200
026893          DECLARE CNVYR-SORTER-CSR CURSOR FOR                     02689300
026894           SELECT T2.ATTR_ELEM_SEQ_NBR                            02689402
026895                , T2.SORTER_OPER                                  02689502
026896                , T2.SORTER_NAME                                  02689602
026897                , T2.OPER_UNT_ID                                  02689702
026898                , T2.DIVERT_TMST                                  02689802
026899                , T2.BRCDE_NBR                                    02689902
026900                , T2.SHIPT_UNT_ID                                 02690002
026901                , T2.ACTV_CDE                                     02690102
026902                , T2.DOOR_ID                                      02690202
026903                , T2.DIVERT_SYS_DTE                               02690302
026904                , T2.DIVERT_SYS_TM                                02690402
026905                , T2.SYS_TMST_LOCAL                               02690502
026906                , T2.SYS_TMST_CENTRAL                             02690602
026907                , T2.TMST_DIFF                                    02690702
026908             FROM                                                 02690802
026909           (SELECT T1.ATTR_ELEM_SEQ_NBR                           02690902
026910                 , T1.SORTER_OPER                                 02691002
026911                 , T1.SORTER_NAME                                 02691102
026912                 , T1.OPER_UNT_ID                                 02691202
026913                 , T1.SHIPT_UNT_ID                                02691302
026914                 , T1.DIVERT_TMST                                 02691402
026915                 , T1.DIVERT_NBR                                  02691502
026916                 , T1.DIVERT_LOC_ID                               02691602
026917                 , T1.BRCDE_NBR                                   02691702
026918                 , T1.ACTV_CDE                                    02691802
026919                 , T1.DOOR_ID                                     02691902
026920                 , T1.DEST_OPER_UNT_ID                            02692002
026921                 , T1.DIVERT_SYS_DTE                              02692102
026922                 , T1.DIVERT_SYS_TM                               02692202
026923                 , T1.SYS_TMST_LOCAL                              02692302
026924                 , T1.SYS_TMST_CENTRAL                            02692402
026925                 , T1.DIVERT_TMST - T1.SYS_TMST_CENTRAL           02692502
026926                       AS TMST_DIFF                               02692602
026927              FROM                                                02692702
026928              (SELECT CC.ATTR_ELEM_SEQ_NBR                        02692802
026929                    , CC.ATTR_ELEM_NBR  AS  SORTER_OPER           02692902
026930                    , DD.ATTR_ELEM_TXT  AS  SORTER_NAME           02693002
026931                    , HH.OPER_UNT_ID                              02693102
026932                    , HH.SHIPT_UNT_ID                             02693202
026933                    , HH.DIVERT_TMST                              02693302
026934                    , HH.DIVERT_NBR                               02693402
026935                    , HH.DIVERT_LOC_ID                            02693502
026936                    , HH.BRCDE_NBR                                02693602
026937                    , HH.ACTV_CDE                                 02693702
026938                    , HH.DOOR_ID                                  02693802
026939                    , HH.DEST_OPER_UNT_ID                         02693902
026940                    , HH.DIVERT_SYS_DTE                           02694002
026941                    , HH.DIVERT_SYS_TM                            02694102
026942                    , TIMESTAMP(HH.DIVERT_SYS_DTE                 02694202
026943                              , HH.DIVERT_SYS_TM)                 02694302
026944                          AS SYS_TMST_LOCAL                       02694402
026945                    , TIMESTAMP(HH.DIVERT_SYS_DTE                 02694502
026946                              , HH.DIVERT_SYS_TM)                 02694602
026947                              - II.FUNC_QTY HOURS                 02694702
026948                          AS SYS_TMST_CENTRAL                     02694802
026950                 FROM WST_INTGRTN_TYP AA                          02695002
026951                     ,WST_ATTR_DEFN   BB                          02695102
026952                     ,WST_ATTR_ELEM   CC                          02695202
026953                     ,WST_ATTR_ELEM   DD                          02695302
026954                     ,WST_ATTR_ELEM   EE                          02695402
026955                     ,TSUCRDV         HH                          02695502
026956                     ,TKRPRPM         II                          02695602
026957                WHERE AA.INTGRTN_TYP_CDE = 'DCCNVYSORT'           02695702
026958                  AND AA.INTGRTN_TYP_CDE = BB.INTGRTN_TYP_CDE     02695802
026959                  AND BB.INTGRTN_TYP_CDE = CC.INTGRTN_TYP_CDE     02695902
026960                  AND BB.INTGRTN_TYP_CDE = DD.INTGRTN_TYP_CDE     02696002
026961                  AND BB.INTGRTN_TYP_CDE = EE.INTGRTN_TYP_CDE     02696102
026962                  AND BB.ATTR_DEFN_SEQ_NBR = 1                    02696202
026963                  AND CC.ATTR_DEFN_SEQ_NBR = 1                    02696302
026964                  AND DD.ATTR_DEFN_SEQ_NBR = 2                    02696402
026965                  AND EE.ATTR_DEFN_SEQ_NBR = 3                    02696502
026966                  AND CC.ATTR_ELEM_SEQ_NBR = DD.ATTR_ELEM_SEQ_NBR 02696602
026967                  AND CC.ATTR_ELEM_SEQ_NBR = EE.ATTR_ELEM_SEQ_NBR 02696702
026968                  AND CC.ATTR_ELEM_NBR     = II.LOC_ID            02696802
026969                  AND II.INTFC_SYS_CDE     = 'KHL'                02696902
026970                  AND II.SYS_PRC_FUNC_CDE  = 'TIMEZN'             02697002
026971                  AND II.FUNC_BEG_TMST    <= CURRENT TIMESTAMP    02697102
026972                  AND II.FUNC_END_TMST    >= CURRENT TIMESTAMP    02697202
026973                  AND CC.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID      02697302
026974                  AND CC.ATTR_ELEM_NBR     = HH.OPER_UNT_ID       02697402
026975                  AND EE.ATTR_ELEM_TXT     = HH.DOOR_ID           02697502
026976                  AND HH.DIVERT_TMST <= :SU096-CURR-TMST          02697602
026977                  AND HH.DIVERT_TMST >= :PV-DIVERT-BEGIN-TMST     02697702
026978                  AND HH.DIVERT_TMST IN                           02697802
026979                  (SELECT MAX(F.DIVERT_TMST)                      02697902
026980                     FROM WST_INTGRTN_TYP A                       02698002
026981                        , WST_ATTR_DEFN   B                       02698102
026982                        , WST_ATTR_ELEM   C                       02698202
026983                        , WST_ATTR_ELEM   D                       02698302
026984                        , WST_ATTR_ELEM   E                       02698402
026985                        , TSUCRDV         F                       02698502
026986                    WHERE                                         02698602
026987                          A.INTGRTN_TYP_CDE = 'DCCNVYSORT'        02698702
026988                      AND A.INTGRTN_TYP_CDE = B.INTGRTN_TYP_CDE   02698802
026989                      AND B.INTGRTN_TYP_CDE = C.INTGRTN_TYP_CDE   02698902
026990                      AND B.INTGRTN_TYP_CDE = D.INTGRTN_TYP_CDE   02699002
026991                      AND B.INTGRTN_TYP_CDE = E.INTGRTN_TYP_CDE   02699102
026993                      AND B.ATTR_DEFN_SEQ_NBR = 1                 02699302
026994                      AND C.ATTR_DEFN_SEQ_NBR = 1                 02699402
026995                      AND D.ATTR_DEFN_SEQ_NBR = 2                 02699502
026996                      AND E.ATTR_DEFN_SEQ_NBR = 3                 02699602
026997                      AND C.ATTR_ELEM_SEQ_NBR =                   02699702
026998                                            D.ATTR_ELEM_SEQ_NBR   02699802
026999                      AND C.ATTR_ELEM_SEQ_NBR =                   02699906
027000                                            E.ATTR_ELEM_SEQ_NBR   02700002
027001                      AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID   02700102
027002                                                                  02700202
027003                      AND C.ATTR_ELEM_NBR = F.OPER_UNT_ID         02700302
027004                      AND E.ATTR_ELEM_TXT = F.DOOR_ID             02700402
027005                      AND F.DIVERT_TMST  <= :SU096-CURR-TMST      02700502
027006                      AND F.DIVERT_TMST  >= :PV-DIVERT-BEGIN-TMST 02700602
027007                    GROUP BY                                      02700702
027008                           C.ATTR_ELEM_NBR                        02700802
027009                       ,   D.ATTR_ELEM_TXT                        02700902
027010                   )                                              02701002
027011              ) AS T1                                             02701102
027020              ) AS T2                                             02702002
027035                  WITH UR                                         02703502
027036     END-EXEC.                                                    02703602
027037                                                                  02703702
027038******************************************************************02703802
027039 PROCEDURE DIVISION.                                              02703902
027040******************************************************************02704002
027041                                                                  02704102
027042******************************************************************02704202
027043* 0000-PROGRAM-MAINLINE - CONTROLS THE MAIN PROCESSING OF THE     02704302
027044*      PROGRAM.                                                   02704402
027045******************************************************************02704502
027046 0000-PROGRAM-MAINLINE.                                           02704602
027047                                                                  02704702
027048     PERFORM 1000-INITIALIZE.                                     02704802
027049                                                                  02704902
027050     PERFORM 1100-CHECK-NBR-CNVYR-VNDRS.                          02705002
027051                                                                  02705102
027060     PERFORM 1200-CALC-BEGIN-DATE-BOOKEND.                        02706002
027100     MOVE  PV-NBR-DAYS-BACK      TO PV-DISP-NBR-DAYS              02710000
027200     DISPLAY '* CNVY CHECK DAYS==>  ' PV-DISP-NBR-DAYS            02720014
027300     DISPLAY '* FROM TMST==>  ' PV-DIVERT-BEGIN-TMST.             02730014
027500                                                                  02750000
027501     DISPLAY '*                                    '.             02750114
027502     DISPLAY '*************************************'.             02750207
027503     DISPLAY '**                                   '.             02750314
027504     DISPLAY '** FROM:  ' PV-DIVERT-BEGIN-TMST                    02750407
027510     DISPLAY '** TO:    ' SU096-CURR-TMST                         02751007
027520     DISPLAY '**                                   '.             02752014
027521     DISPLAY '*************************************'.             02752107
027530                                                                  02753007
027600     IF  PS-MULTI-CONVEYOR-VENDORS                                02760000
027700         DISPLAY 'DC HAS MULTIPLE CONVEYOR VENDORS'               02770000
027710         DISPLAY 'PARM:  DCCNVYVNDR'                              02771010
027800         PERFORM 2000-PROCESS-MULT-CNVYR-VNDRS                    02780000
027900     ELSE                                                         02790000
028200         IF  PS-SORTER-CONVEYOR-CHECK                             02820000
028202             DISPLAY 'DC CHECK BASED ON SORTERS'                  02820200
028203             DISPLAY 'PARM:  DCCNVYSORT'                          02820310
028204             PERFORM 2700-PROCESS-CHECK-BY-SORTER                 02820400
028205         ELSE                                                     02820500
028206             DISPLAY 'DC HAS A SINGLE CONVEYOR VENDOR '           02820600
028207             PERFORM 2200-PROCESS-SNGL-CNVYR-VNDR                 02820700
028208         END-IF                                                   02820800
028209     END-IF.                                                      02820900
028210                                                                  02821000
028250     IF  PS-DELAYED-DIVERTS                                       02825019
028260         PERFORM 3000-CHECK-OPEN-ASGMTS                           02826000
028270     END-IF.                                                      02827000
028280                                                                  02828000
028400     MOVE   SPACES                      TO HEAD-REC.              02840000
028500     DISPLAY HEAD-REC.                                            02850000
028600     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02860000
028700                                                                  02870000
028800     STRING  'FROM DATE - '     PV-DIVERT-BEGIN-TMST              02880013
028900             '    SUKUT204'                                       02890000
029000                  DELIMITED BY SIZE                               02900000
029010                                      INTO HEAD-REC.              02901000
029020     DISPLAY HEAD-REC.                                            02902000
029030     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02903000
029031                                                                  02903100
029032     MOVE   SPACES                      TO HEAD-REC.              02903200
029035                                                                  02903500
029036     STRING  'TO DATE   - '     SU096-CURR-TMST                   02903600
029037             '    SUKUT204'                                       02903700
029038                  DELIMITED BY SIZE                               02903800
029039                                      INTO HEAD-REC.              02903900
029040     DISPLAY HEAD-REC.                                            02904000
029041     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02904100
029042                                                                  02904200
029043     MOVE '*****************************************'             02904300
029044                                        TO HEAD-REC.              02904400
029045     DISPLAY HEAD-REC.                                            02904500
029046     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        02904600
029047                                                                  02904700
029048                                                                  02904800
029049     CLOSE SU-CNVYR-CNTL-FILE                                     02904900
029050           ERROR-OUT-FILE.                                        02905000
029051                                                                  02905100
029052*    IF THE CONVEYOR DIVERTS RECEIVED ARE DELAYED, SET THE        02905220
029053*    RETURN CODE SO THAT THE EMAIL WILL GET SENT OUT IN THE       02905300
029054*    NEXT STEP.                                                   02905400
029055                                                                  02905500
029056     DISPLAY '*****************************************'.         02905622
029061     DISPLAY '* PS-DELAYED-DIVERTS: '                             02906122
029062              PS-DELAYED-DIVERTS-SW.                              02906222
029067     DISPLAY '*****************************************'.         02906722
029071                                                                  02907120
029072     IF PS-DELAYED-DIVERTS                                        02907220
029073         MOVE 4050 TO RETURN-CODE                                 02907328
029075     END-IF.                                                      02907524
029076                                                                  02907624
029077     STOP RUN.                                                    02907724
029080                                                                  02908000
029090                                                                  02909000
029100***************************************************************** 02910000
029200*  INITIALIZATION PARAGRAPH                                       02920000
029300***************************************************************** 02930000
029400 1000-INITIALIZE.                                                 02940000
029500                                                                  02950000
029600     OPEN INPUT SU-CNVYR-CNTL-FILE                                02960000
029700         OUTPUT ERROR-OUT-FILE.                                   02970000
029800                                                                  02980000
029900     ACCEPT CC-CONTROL-CARD FROM SYSIN.                           02990000
030000                                                                  03000000
030100     DISPLAY '*************************************'.             03010007
030101     DISPLAY '**                                  *'.             03010107
030110     DISPLAY '**           SUKUT204               *'.             03011007
030111     DISPLAY '**                                  *'.             03011107
030112     DISPLAY '*************************************'.             03011207
030113     DISPLAY '**                                  *'.             03011307
030120     DISPLAY 'CONTROL CARD ====>  ' CC-CONTROL-CARD.              03012007
030200                                                                  03020000
030300     MOVE CC-OPER-UNT-ID       TO DK-OPER-UNT-ID                  03030000
030400                                  DK-LOC-ID.                      03040000
030500     SET PS-NO-DELAYED-DIVERTS TO TRUE.                           03050018
030600                                                                  03060000
030700     PERFORM 7000-READ-CNVYR-CNTL-REC.                            03070000
031000                                                                  03100000
031100                                                                  03110000
031200******************************************************************03120000
031300*  FETCH A PARAMETER FROM THE TKRPRPM TABLE THAT INDICATES        03130000
031400*  THE NUMBER OF CONVEYOR VENDORS AT A DC.  SET THE SINGLE        03140000
031500*  VENDOR OR MULTIPLE VENDOR SWITCH ACCORDINGLY.                  03150000
031600******************************************************************03160000
031700 1100-CHECK-NBR-CNVYR-VNDRS.                                      03170000
031800                                                                  03180000
031900     INITIALIZE PV-SINGLE-CNVYR-VENDOR.                           03190000
032000                                                                  03200000
032100     PERFORM WITH TEST AFTER                                      03210000
032200       VARYING PV-COUNTER FROM 1 BY 1                             03220000
032300         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       03230000
032400                OR                                                03240000
032500                SQLCODE = ZERO)                                   03250000
032600                                                                  03260000
032700         EXEC SQL                                                 03270000
032800             SELECT FUNC_TXT AS SINGLE_CNVYR_VENDOR               03280000
032900               INTO :PV-SINGLE-CNVYR-VENDOR                       03290000
033000               FROM TKRPRPM                                       03300000
033100              WHERE LOC_ID            = :DK-LOC-ID                03310000
033200                AND SYS_PRC_FUNC_CDE  = 'CNVYCK'                  03320000
033300                AND INTFC_SYS_CDE     = 'KHL'                     03330000
033400                AND FUNC_PRC_STAT_CDE  = 'AC'                     03340000
033500                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        03350000
033600                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        03360000
033700         END-EXEC                                                 03370000
033800                                                                  03380000
033900         EVALUATE TRUE                                            03390000
034000             WHEN SQLCODE = -904                                  03400000
034100             WHEN SQLCODE = -911                                  03410000
034200                 CONTINUE                                         03420000
034300             WHEN SQLCODE = ZERO                                  03430000
034400                 IF  PV-SINGLE-CNVYR-VENDOR = 'Y'                 03440000
034500                     SET PS-SINGLE-CONVEYOR-VENDOR                03450000
034600                                 TO TRUE                          03460000
034700                 ELSE                                             03470000
035000                     IF  PV-SINGLE-CNVYR-VENDOR = 'C'             03500000
035100                         SET PS-SORTER-CONVEYOR-CHECK             03510000
035200                                 TO TRUE                          03520000
035210                     ELSE                                         03521000
035213                         SET PS-MULTI-CONVEYOR-VENDORS            03521300
035214                                 TO TRUE                          03521400
035215                     END-IF                                       03521500
035216                 END-IF                                           03521600
035217                                                                  03521700
035218             WHEN SQLWARN0 NOT = SPACES                           03521800
035219             WHEN SQLCODE < ZERO                                  03521900
035220             WHEN SQLCODE > ZERO                                  03522000
035221                 MOVE '1100-CHECK-NBR-CNVYR-VNDRS     '           03522100
035230                                 TO PV-ABEND-PARAGRAPH            03523000
035240                 MOVE 'FETCH DATA FROM TKRPRPM TABLE  '           03524000
035250                                 TO PV-ABEND-OPER-MESSAGE-1       03525000
035260                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              03526000
035270                 PERFORM 9100-SQL-ABEND                           03527000
035280             WHEN SQLCODE = ZERO                                  03528000
035290                 CONTINUE                                         03529000
035300         END-EVALUATE                                             03530000
035400     END-PERFORM.                                                 03540000
035500                                                                  03550000
035600     IF PV-COUNTER > PC-MAX-RETRIES                               03560000
035700         MOVE '1100-CHECK-NBR-CNVYR-VNDRS  '                      03570000
035800                                 TO PV-ABEND-PARAGRAPH            03580000
035900         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'03590000
036000                                 TO PV-ABEND-OPER-MESSAGE-1       03600000
036100         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              03610000
036200         PERFORM 9100-SQL-ABEND                                   03620000
036300     END-IF.                                                      03630000
036400                                                                  03640000
036500                                                                  03650000
036600******************************************************************03660000
036700*  FETCH A PARAMETER FROM THE TKRPRPM TABLE THAT INDICATES        03670000
036800*  THE NUMBER OF DAYS PRIOR TO THE CURRENT DATE - THIS WILL SETN  03680000
036900*  THE BEGIN DATE BOOKEND FOR THE DIVERT CHECK.                   03690000
037000*  10/11/2016 - DMH                                               03700000
037100******************************************************************03710000
037200 1200-CALC-BEGIN-DATE-BOOKEND.                                    03720000
037300                                                                  03730000
037400     MOVE ZEROES  TO  PV-NBR-DAYS-BACK.                           03740000
037500                                                                  03750000
037510     PERFORM WITH TEST AFTER                                      03751000
037520       VARYING PV-COUNTER FROM 1 BY 1                             03752000
037530         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       03753000
037540                OR                                                03754000
037550                SQLCODE = ZERO)                                   03755000
037560                                                                  03756000
037570         EXEC SQL                                                 03757000
037580             SELECT FUNC_QTY                                      03758000
037590                  , CURRENT TIMESTAMP - FUNC_QTY DAYS             03759000
037600               INTO :PV-NBR-DAYS-BACK                             03760000
037601                  , :PV-DIVERT-BEGIN-TMST                         03760100
037602               FROM TKRPRPM                                       03760200
037603              WHERE LOC_ID            = :DK-LOC-ID                03760300
037604                AND SYS_PRC_FUNC_CDE  = 'CNVYDY'                  03760400
037605                AND INTFC_SYS_CDE     = 'KHL'                     03760500
037606                AND FUNC_PRC_STAT_CDE  = 'AC'                     03760600
037607                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        03760700
037608                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        03760800
037609         END-EXEC                                                 03760900
037610                                                                  03761000
037611         EVALUATE TRUE                                            03761100
037612             WHEN SQLCODE = -904                                  03761200
037613             WHEN SQLCODE = -911                                  03761300
037614                 CONTINUE                                         03761400
037615             WHEN SQLCODE = ZERO                                  03761500
037616                 CONTINUE                                         03761600
037617             WHEN SQLWARN0 NOT = SPACES                           03761700
037618             WHEN SQLCODE < ZERO                                  03761800
037619             WHEN SQLCODE > ZERO                                  03761900
037620                 MOVE '1200-CALC-BEGIN-DATE-BOOKEND   '           03762000
037630                                 TO PV-ABEND-PARAGRAPH            03763000
037631                 MOVE 'FETCH DATA FROM TKRPRPM TABLE  '           03763100
037632                                 TO PV-ABEND-OPER-MESSAGE-1       03763200
037633                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              03763300
037634                 PERFORM 9100-SQL-ABEND                           03763400
037635             WHEN SQLCODE = ZERO                                  03763500
037636                 CONTINUE                                         03763600
037637         END-EVALUATE                                             03763700
037638     END-PERFORM.                                                 03763800
037639                                                                  03763900
037640     IF PV-COUNTER > PC-MAX-RETRIES                               03764000
037641         MOVE '1200-CALC-BEGIN-DATE-BOOKEND'                      03764100
037642                                 TO PV-ABEND-PARAGRAPH            03764200
037643         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'03764300
037644                                 TO PV-ABEND-OPER-MESSAGE-1       03764400
037645         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              03764500
037646         PERFORM 9100-SQL-ABEND                                   03764600
037647     END-IF.                                                      03764700
037648                                                                  03764800
037649                                                                  03764900
037650******************************************************************03765000
037660*  THIS IS THE PROCESS WHERE THERE ARE MULTIPLE CONVEYOR VENDORS  03766000
037670*  AT A FACILITY.  FOR EACH CONVEYOR VENDOR, THIS CURSOR WILL     03767003
037680*  BRING BACK THE LAST CARTON THAT WAS DIVERTED FOR EACH CONVEYOR 03768003
037690*  AND IT WILL CALCULATE THE DELAY DIFFERENCE BETWEEN WHEN THE    03769003
037700*  CONVEYOR TIME AND THE TIME WE RECEIVED THE CARTON IN THE       03770003
037800*  DATABASE.                                                      03780003
037900*  FOR EACH ROW RECEIVED ANOTHER CHECK WILL NEED TO BE MADE TO    03790003
038000*  PARM DCCNVYLIMT  TO COMPARE THE DELAY LIMIT WE HAVE SET FOR    03800037
038010*  THE CONVEYOR AND THE DELAY THAT WAS CALCULATED IN THE CURSOR   03801003
038100******************************************************************03810000
038200 2000-PROCESS-MULT-CNVYR-VNDRS.                                   03820000
038300                                                                  03830000
038400     PERFORM 2050-OPEN-CNVYR-VEND-CSR.                            03840000
038500                                                                  03850000
038600     PERFORM 2060-FETCH-CNVYR-VEND-CSR.                           03860000
038700                                                                  03870000
038800     PERFORM 2100-PROCESS-CNVYR-VEND-CSR                          03880000
038900         UNTIL PS-END-OF-CURSOR.                                  03890000
039000                                                                  03900000
039100     PERFORM 2070-CLOSE-CNVYR-VEND-CSR.                           03910000
039200                                                                  03920000
039500                                                                  03950000
039600                                                                  03960000
039700******************************************************************03970000
039800* OPEN THE CONVEYOR VENDOR CURSOR                                 03980000
039900******************************************************************03990000
040000 2050-OPEN-CNVYR-VEND-CSR.                                        04000000
040100                                                                  04010000
040200     PERFORM WITH TEST AFTER                                      04020000
040300       VARYING PV-COUNTER FROM 1 BY 1                             04030000
040400         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       04040000
040500                OR                                                04050000
040600                SQLCODE = ZERO)                                   04060000
040700                                                                  04070000
040800         EXEC SQL                                                 04080000
040900              OPEN CNVYR-VEND-CSR                                 04090000
041000         END-EXEC                                                 04100000
041100                                                                  04110000
041200         EVALUATE TRUE                                            04120000
041300             WHEN SQLCODE = +0                                    04130000
041400             WHEN SQLCODE = -904                                  04140000
041500             WHEN SQLCODE = -911                                  04150000
041600             WHEN SQLCODE = -913                                  04160000
041700                 CONTINUE                                         04170000
041800             WHEN SQLWARN0 NOT EQUAL SPACE                        04180000
041900             WHEN SQLCODE NOT EQUAL ZERO                          04190000
042000                 MOVE '2050-OPEN-CNVYR-VEND-CSR'                  04200000
042100                                      TO PV-ABEND-PARAGRAPH       04210000
042200                 MOVE 'ERROR OPENING CONVEYOR VENDOR CURSOR'      04220000
042300                                      TO PV-ABEND-OPER-MESSAGE-1  04230000
042400                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         04240000
042500                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        04250000
042600                         PV-OPER-UNT-ID-DISP                      04260000
042700                                         DELIMITED BY SIZE        04270000
042800                                   INTO PV-ABEND-OPER-MESSAGE-2   04280000
042900                 MOVE 'WST_INTGRTN_TYP'                           04290000
043000                                      TO PV-ABEND-TABLE-1         04300000
043100                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         04310000
043200                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         04320000
043300                 MOVE 'TSUCRDV'       TO PV-ABEND-TABLE-4         04330000
043400                 PERFORM 9100-SQL-ABEND                           04340000
043500         END-EVALUATE                                             04350000
043600     END-PERFORM.                                                 04360000
043700                                                                  04370000
043800     IF  PV-COUNTER > PC-MAX-RETRIES                              04380000
043900         MOVE '2050-OPEN-CNVYR-VEND-CSR'                          04390000
044000                                      TO PV-ABEND-PARAGRAPH       04400000
044100         MOVE 'MAX RETRIES ERROR OPENING CONVEYOR VENDOR CURSOR'  04410000
044200                                      TO PV-ABEND-OPER-MESSAGE-1  04420000
044300         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         04430000
044400         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                04440000
044500                 PV-OPER-UNT-ID-DISP                              04450000
044600                                 DELIMITED BY SIZE                04460000
044700                                    INTO PV-ABEND-OPER-MESSAGE-2  04470000
044800         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         04480000
044900         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         04490000
045000         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         04500000
045100         MOVE 'TSUCRDV'               TO PV-ABEND-TABLE-4         04510000
045200         PERFORM 9100-SQL-ABEND                                   04520000
045300     END-IF.                                                      04530000
045400                                                                  04540000
045500                                                                  04550000
045600******************************************************************04560000
045700* FETCH A ROW FROM THE AUDIT CONTROL GROUP CURSOR.               *04570000
045800******************************************************************04580000
045900 2060-FETCH-CNVYR-VEND-CSR.                                       04590000
046000                                                                  04600000
046100     EXEC SQL                                                     04610000
046200          FETCH CNVYR-VEND-CSR                                    04620004
047010           INTO :WST00010-ATTR-ELEM-SEQ-NBR                       04701005
047020               ,:PV-DC-NBR                                        04702001
047030               ,:PV-CNVY-VENDOR                                   04703001
047040               ,:PV-BEGIN-RANGE                                   04704001
047050               ,:PV-END-RANGE                                     04705001
047060               ,:PV-ADDL-DOOR                                     04706001
047070               ,:SUCRDV-OPER-UNT-ID                               04707001
047080               ,:PV-MAX-DIVERT-TIMESTAMP                          04708001
047090               ,:SUCRDV-BRCDE-NBR                                 04709001
047091               ,:SUCRDV-SHIPT-UNT-ID                              04709101
047092               ,:SUCRDV-ACTV-CDE                                  04709201
047093               ,:SUCRDV-DOOR-ID                                   04709301
047094               ,:SUCRDV-DIVERT-SYS-DTE                            04709401
047095               ,:SUCRDV-DIVERT-SYS-TM                             04709501
047096               ,:PV-SYS-TMST-LOCAL                                04709601
047097               ,:PV-SYS-TMST-CENTRAL                              04709701
047098               ,:PV-TMST-DIFF                                     04709801
047100     END-EXEC.                                                    04710000
047200                                                                  04720000
047300     EVALUATE TRUE                                                04730000
047400       WHEN SQLCODE = ZERO                                        04740000
047411                                                                  04741110
047412             DISPLAY 'CONVEYOR VENDOR       ' PV-CNVY-VENDOR      04741210
047413             DISPLAY 'DC LOCAL DIVERT TMST:   '                   04741310
047414                      PV-SYS-TMST-LOCAL                           04741410
047415             DISPLAY 'DC CENTRAL DVRT TMST:   '                   04741510
047416                      PV-SYS-TMST-CENTRAL                         04741610
047417             DISPLAY 'DATABASE DIVERT TMST:   '                   04741710
047418                      PV-MAX-DIVERT-TIMESTAMP                     04741810
047419             MOVE PV-TMST-DIFF  TO PV-DISP-TMST-DIFF              04741910
047420             DISPLAY 'DIFF/DELAY DC/DATABASE: '                   04742010
047421                      PV-DISP-TMST-DIFF                           04742110
047422                     '  HHMMSS'                                   04742210
047423                                                                  04742310
047424             PERFORM 2075-CHECK-MULT-LIMIT                        04742410
047425                                                                  04742510
047426             IF  PV-TMST-DIFF  >  PV-MULT-LIMIT                   04742610
047427                 SET PS-ADDITIONAL-CHECK-NEEDED                   04742710
047428                     PS-DELAYED-DIVERTS                           04742819
047429                                 TO TRUE                          04742919
047430             ELSE                                                 04743019
047431                 SET PS-NO-ADDITIONAL-CHECK-NEEDED                04743119
047432                                 TO TRUE                          04743219
047433             END-IF                                               04743319
047450                                                                  04745003
048600       WHEN SQLCODE = +100                                        04860000
048700           SET PS-END-OF-CURSOR      TO TRUE                      04870000
048800       WHEN SQLWARN0 NOT EQUAL SPACE                              04880000
048900       WHEN SQLCODE NOT EQUAL ZERO                                04890000
049000           MOVE '2060-FETCH-CNVYR-VEND-CSR'                       04900000
049100                                     TO PV-ABEND-PARAGRAPH        04910000
049200           MOVE 'FETCH CONVEYOR VENDOR CURSOR ROW'                04920000
049300                                     TO PV-ABEND-OPER-MESSAGE-1   04930000
049400           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          04940000
049500           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              04950000
049600                   PV-OPER-UNT-ID-DISP                            04960000
049700                                   DELIMITED BY SIZE              04970000
049800                                   INTO PV-ABEND-OPER-MESSAGE-2   04980000
049900           MOVE 'WST_INTGRTN_TYP'    TO PV-ABEND-TABLE-1          04990000
050000           MOVE 'WST_ATTR_DEFN'      TO PV-ABEND-TABLE-2          05000000
050100           MOVE 'WST_ATTR_ELEM'      TO PV-ABEND-TABLE-3          05010000
050200           MOVE 'TSUCRDV'            TO PV-ABEND-TABLE-4          05020000
050300           PERFORM 9100-SQL-ABEND                                 05030000
050400     END-EVALUATE.                                                05040000
050500                                                                  05050000
050600                                                                  05060000
050700******************************************************************05070000
050800* CLOSE THE CONVEYOR VENDOR CURSOR                                05080000
050900******************************************************************05090000
051000 2070-CLOSE-CNVYR-VEND-CSR.                                       05100000
051100                                                                  05110000
051200     PERFORM                                                      05120000
051300         WITH TEST AFTER                                          05130000
051400         VARYING PV-COUNTER                                       05140000
051500         FROM 1 BY 1                                              05150000
051600         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     05160000
051700                   OR (SQLCODE = ZERO))                           05170000
051800         EXEC SQL                                                 05180000
051900             CLOSE CNVYR-VEND-CSR                                 05190000
052000         END-EXEC                                                 05200000
052100                                                                  05210000
052200         EVALUATE TRUE                                            05220000
052300             WHEN SQLCODE = +0                                    05230000
052400             WHEN SQLCODE = -904                                  05240000
052500             WHEN SQLCODE = -911                                  05250000
052600             WHEN SQLCODE = -913                                  05260000
052700                 CONTINUE                                         05270000
052800             WHEN SQLWARN0 NOT EQUAL SPACE                        05280000
052900             WHEN SQLCODE NOT EQUAL ZERO                          05290000
053000                 MOVE '2070-CLOSE-CNVYR-VEND-CSR'                 05300000
053100                                      TO PV-ABEND-PARAGRAPH       05310000
053200                 MOVE 'ERROR CLOSING CONVEYOR VENDOR CURSOR'      05320000
053300                                      TO PV-ABEND-OPER-MESSAGE-1  05330000
053400                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         05340000
053500                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        05350000
053600                         PV-OPER-UNT-ID-DISP                      05360000
053700                                         DELIMITED BY SIZE        05370000
053800                                    INTO PV-ABEND-OPER-MESSAGE-2  05380000
053900                 MOVE 'WST_INTGRTN_TYP'                           05390000
054000                                      TO PV-ABEND-TABLE-1         05400000
054100                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         05410000
054200                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         05420000
054300                 MOVE 'TSUCRDV'       TO PV-ABEND-TABLE-4         05430000
054400                 PERFORM 9100-SQL-ABEND                           05440000
054500         END-EVALUATE                                             05450000
054600     END-PERFORM.                                                 05460000
054700                                                                  05470000
054800     IF  PV-COUNTER > PC-MAX-RETRIES                              05480000
054900         MOVE '2070-CLOSE-CNVYR-VEND-CSR'                         05490000
055000                                      TO PV-ABEND-PARAGRAPH       05500000
055100         MOVE 'MAX RETRIES ERROR CLOSING AUDIT CNTL GROUP CURSOR' 05510000
055200                                      TO PV-ABEND-OPER-MESSAGE-1  05520000
055300         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         05530000
055400         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        05540000
055500                 PV-OPER-UNT-ID-DISP                              05550000
055600                                         DELIMITED BY SIZE        05560000
055700                                    INTO PV-ABEND-OPER-MESSAGE-2  05570000
055800         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         05580000
055900         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         05590000
056000         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         05600000
056100         MOVE 'TSUCRDV'               TO PV-ABEND-TABLE-4         05610000
056200         PERFORM 9100-SQL-ABEND                                   05620000
056300     END-IF.                                                      05630000
056400                                                                  05640000
056401                                                                  05640103
056420******************************************************************05642003
056430*  THIS SELECT IS FOR DC'S WITH MULTIPLE CONVEYOR SYSTEM.  THIS   05643003
056440*  VALUE WILL BE THE ALERT LIMIT.  HOW MUCH DIFFERENCE WILL BE    05644003
056450*  ALLOWED BETWEEN THE TIME THE DC CONVEYOR SENDS THE DIVERT AND  05645003
056460*  WHEN WE RECEIVE IT IN THE DATABASE.                            05646003
056470*                                                                 05647003
056480*  NOTE THIS IS SET UP BY DC, IN CASE THE TIME ON THE CONVEYOR    05648003
056490*  SERVER IS NOT SET UP CORRECTLY                                 05649003
056491*                                                                 05649103
056492*  THIS WILL BE COMPARED WITH PV-TMST-DIFF                        05649203
056493******************************************************************05649303
056494 2075-CHECK-MULT-LIMIT.                                           05649403
056496                                                                  05649603
056497     MOVE ZEROES  TO  PV-MULT-LIMIT.                              05649703
056498                                                                  05649803
056499     PERFORM WITH TEST AFTER                                      05649903
056500       VARYING PV-COUNTER FROM 1 BY 1                             05650003
056501         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       05650103
056502                OR                                                05650203
056503                SQLCODE = ZERO)                                   05650303
056504                                                                  05650403
056505         EXEC SQL                                                 05650503
056506              SELECT                                              05650604
056512                      H.ATTR_ELEM_NBR                             05651204
056513                INTO :PV-MULT-LIMIT                               05651304
056514                FROM  WST_INTGRTN_TYP A                           05651404
056515                    , WST_ATTR_DEFN   B                           05651504
056516                    , WST_ATTR_ELEM   C                           05651604
056517                    , WST_ATTR_ELEM   D                           05651704
056518                    , WST_ATTR_ELEM   E                           05651804
056519                    , WST_ATTR_ELEM   F                           05651904
056520                    , WST_ATTR_ELEM   G                           05652004
056521                    , WST_ATTR_ELEM   H                           05652104
056522                WHERE A.INTGRTN_TYP_CDE   = 'DCCNVYLIMT'          05652204
056523                  AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE     05652304
056524                  AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE     05652404
056525                  AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE     05652504
056526                  AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE     05652604
056527                  AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE     05652704
056528                  AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE     05652804
056529                  AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE     05652904
056530                  AND B.ATTR_DEFN_SEQ_NBR = 1                     05653004
056531                  AND C.ATTR_DEFN_SEQ_NBR = 1                     05653104
056532                  AND D.ATTR_DEFN_SEQ_NBR = 2                     05653204
056533                  AND E.ATTR_DEFN_SEQ_NBR = 3                     05653304
056534                  AND F.ATTR_DEFN_SEQ_NBR = 4                     05653404
056535                  AND G.ATTR_DEFN_SEQ_NBR = 5                     05653504
056536                  AND H.ATTR_DEFN_SEQ_NBR = 6                     05653604
056537                  AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR   05653704
056538                  AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR   05653804
056539                  AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR   05653904
056540                  AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR   05654004
056541                  AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR   05654104
056542                                                                  05654204
056543                  AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID       05654304
056544                  AND D.ATTR_ELEM_TXT     = :PV-CNVY-VENDOR       05654404
056556               WITH UR                                            05655604
056557         END-EXEC                                                 05655704
056558                                                                  05655804
056559         EVALUATE TRUE                                            05655904
056560             WHEN SQLCODE = -904                                  05656004
056561             WHEN SQLCODE = -911                                  05656104
056562                 CONTINUE                                         05656204
056563             WHEN SQLWARN0 NOT = SPACES                           05656304
056564             WHEN SQLCODE < ZERO                                  05656404
056565             WHEN SQLCODE > ZERO                                  05656504
056566                 MOVE '2075-CHECK-MULT-LIMIT          '           05656604
056567                                 TO PV-ABEND-PARAGRAPH            05656704
056568                 MOVE 'SELECT PARM:  DCCNVYLIMT       '           05656837
056569                                 TO PV-ABEND-OPER-MESSAGE-1       05656904
056570                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              05657004
056571                 PERFORM 9100-SQL-ABEND                           05657104
056572             WHEN SQLCODE = ZERO                                  05657204
056573                 MOVE  PV-MULT-LIMIT                              05657310
056574                                 TO  PV-DISP-LIMIT                05657404
056575                 DISPLAY 'DCCNVYLIMT - MULTIPLE CONVEY LIMIT: '   05657537
056576                              PV-DISP-LIMIT                       05657604
056577         END-EVALUATE                                             05657704
056578     END-PERFORM.                                                 05657804
056579                                                                  05657904
056580     IF PV-COUNTER > PC-MAX-RETRIES                               05658004
056581         MOVE '2075-CHECK-MULT-LIMIT       '                      05658104
056582                                 TO PV-ABEND-PARAGRAPH            05658204
056583         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'05658304
056584                                 TO PV-ABEND-OPER-MESSAGE-1       05658404
056585         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              05658504
056586         PERFORM 9100-SQL-ABEND                                   05658604
056587     END-IF.                                                      05658704
056588                                                                  05658804
056590                                                                  05659004
056600******************************************************************05660000
056700*  THIS CODE WILL PROCESS THE TIMESTAMP OF THE LAST DIVERT FOR    05670000
056800*  EACH CONVEYOR VENDOR.  IF THIS TIMESTAMP IS LATER THAN THE     05680000
056900*  CALCULATED TIMESTAMP, THIS MEANS THAT WE ARE RECEIVING DIVERTS 05690000
057000*  FROM THE SORTER FOR THE DC.  IF THIS TIMESTAMP IS EARLIER THAN 05700000
057100*  THE CALCULATED TIMESTAMP, THIS MEANS THAT WE HAVE NOT RECEIVED 05710000
057200*  DIVERTS FOR A SPECIFIED PERIOD OF TIME, BASED ON THE CALCULATED05720000
057300*  TIMESTAMP.  ADDITIONAL CHECKING MUST BE DONE TO SEE IF AN ISSUE05730000
057400*  EXISTS.                                                        05740000
057500******************************************************************05750000
057600 2100-PROCESS-CNVYR-VEND-CSR.                                     05760000
058200                                                                  05820000
058300     IF  PS-ADDITIONAL-CHECK-NEEDED                               05830000
058400         PERFORM 2350-FETCH-SEQ-NBR-PARM                          05840000
058500         PERFORM 2400-CHECK-OPEN-ASSIGNMENTS                      05850000
058600         IF  PV-OPEN-ASGMT-COUNT > 0                              05860000
058700             PERFORM 2500-CHECK-CLOSED-ASSIGNMENTS                05870000
058800             IF  PV-CLOSED-ASGMT-COUNT > 0                        05880000
058900                 SET PS-DELAYED-DIVERTS  TO TRUE                  05890018
059000                 PERFORM 2600-SETUP-ERROR-REC                     05900000
059010             ELSE                                                 05901033
059020                 SET  PS-NO-DELAYED-DIVERTS  TO TRUE              05902033
059100             END-IF                                               05910000
059110          ELSE                                                    05911032
059120             SET  PS-NO-DELAYED-DIVERTS  TO TRUE                  05912032
059200         END-IF                                                   05920000
059300     END-IF.                                                      05930000
059400                                                                  05940000
059500     PERFORM 2060-FETCH-CNVYR-VEND-CSR.                           05950000
059800                                                                  05980000
059900                                                                  05990000
060000******************************************************************06000000
060100*  THIS IS THE PROCESS WHERE THERE IS ONE CONVEYOR VENDOR AT A    06010000
060200*  FACILITY.  START BY FETCHING THE TIMESTAMP OF THE LAST DIVERT. 06020000
060300*  IF THIS TIMESTAMP IS LATER THAN THE CALCULATED TIMESTAMP, THIS 06030000
060400*  MEANS THAT WE ARE RECEIVING DIVERTS FROM THE SORTER FOR THE    06040000
060500*  DC.  IF THIS TIMESTAMP IS EARLIER THAN THE CALCULATED TIMESTAMP06050000
060600*  THIS MEANS THAT WE HAVE NOT RECEIVED DIVERTS FOR A SPECIFIED   06060000
060700*  PERIOD OF TIME, BASED ON THE CALCULATED TIMESTAMP.  ADDITIONAL 06070000
060800*  CHECKING MUST BE DONE TO SEE IF AN ISSUE EXISTS.               06080000
060900******************************************************************06090000
061000 2200-PROCESS-SNGL-CNVYR-VNDR.                                    06100000
061100                                                                  06110000
061200     PERFORM 2300-FETCH-LAST-DIVERT-TMST.                         06120000
061300                                                                  06130000
061400     IF  PS-ADDITIONAL-CHECK-NEEDED                               06140000
061500         PERFORM 2350-FETCH-SEQ-NBR-PARM                          06150000
061600         PERFORM 2400-CHECK-OPEN-ASSIGNMENTS                      06160000
061700         IF  PV-OPEN-ASGMT-COUNT > 0                              06170000
061800             PERFORM 2500-CHECK-CLOSED-ASSIGNMENTS                06180000
061900             IF  PV-CLOSED-ASGMT-COUNT > 0                        06190000
062000                 SET PS-DELAYED-DIVERTS  TO TRUE                  06200018
062100                 PERFORM 2600-SETUP-ERROR-REC                     06210000
062110             ELSE                                                 06211033
062120                 SET  PS-NO-DELAYED-DIVERTS  TO TRUE              06212033
062200             END-IF                                               06220000
062210          ELSE                                                    06221032
062220             SET  PS-NO-DELAYED-DIVERTS  TO TRUE                  06222032
062300         END-IF                                                   06230000
062400     END-IF.                                                      06240000
062700                                                                  06270000
062800                                                                  06280000
062900******************************************************************06290000
063000*  FETCH THE LAST DIVERT TIMESTAMP FROM THE CONTAINER DIVERT      06300000
063100*  TABLE (TSUCRDV).                                               06310000
063110*  THIS WILL BRING BACK THE DIFFERENCE/DELAY FROM WHEN THE        06311003
063120*  CONVEYOR SENT THE DIVERT & WHEN WE RECEIVED THE DIVERT         06312003
063200******************************************************************06320000
063300 2300-FETCH-LAST-DIVERT-TMST.                                     06330000
063400                                                                  06340000
063500     INITIALIZE PV-MAX-DIVERT-TIMESTAMP.                          06350000
063600                                                                  06360000
063700     PERFORM WITH TEST AFTER                                      06370000
063800       VARYING PV-COUNTER FROM 1 BY 1                             06380000
063900         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       06390000
064000                OR                                                06400000
064100                SQLCODE = ZERO)                                   06410000
064200                                                                  06420000
064300         EXEC SQL                                                 06430000
064310              SELECT  T2.OPER_UNT_ID                              06431003
064311                    , T2.DIVERT_NBR                               06431130
064312                    , T2.DIVERT_LOC_ID                            06431230
064320                    , T2.DIVERT_TMST                              06432003
064330                    , T2.BRCDE_NBR                                06433003
064340                    , T2.SHIPT_UNT_ID                             06434003
064350                    , T2.ACTV_CDE                                 06435003
064360                    , T2.DOOR_ID                                  06436003
064361                    , T2.DEST_OPER_UNT_ID                         06436130
064370                    , T2.DIVERT_SYS_DTE                           06437003
064380                    , T2.DIVERT_SYS_TM                            06438003
064390                    , T2.SYS_TMST_LOCAL                           06439003
064391                    , T2.SYS_TMST_CENTRAL                         06439103
064392                    , T2.TMST_DIFF                                06439203
064395               INTO  :SUCRDV-OPER-UNT-ID                          06439503
064396                    ,:SUCRDV-DIVERT-NBR                           06439603
064397                    ,:SUCRDV-DIVERT-LOC-ID                        06439703
064398                    ,:SUCRDV-DIVERT-TMST                          06439803
064399                    ,:SUCRDV-BRCDE-NBR                            06439903
064400                    ,:SUCRDV-SHIPT-UNT-ID                         06440003
064401                    ,:SUCRDV-ACTV-CDE                             06440103
064402                    ,:SUCRDV-DOOR-ID                              06440203
064403                    ,:SUCRDV-DEST-OPER-UNT-ID                     06440303
064404                    ,:SUCRDV-DIVERT-SYS-DTE                       06440403
064405                    ,:SUCRDV-DIVERT-SYS-TM                        06440503
064406                    ,:PV-SYS-TMST-LOCAL                           06440603
064407                    ,:PV-SYS-TMST-CENTRAL                         06440703
064408                    ,:PV-TMST-DIFF                                06440803
064410              FROM                                                06441003
064411              (SELECT T1.OPER_UNT_ID                              06441103
064412                    , T1.DIVERT_NBR                               06441203
064413                    , T1.DIVERT_LOC_ID                            06441303
064414                    , T1.DIVERT_TMST                              06441403
064415                    , T1.BRCDE_NBR                                06441503
064416                    , T1.SHIPT_UNT_ID                             06441603
064417                    , T1.ACTV_CDE                                 06441703
064418                    , T1.DOOR_ID                                  06441803
064419                    , T1.DEST_OPER_UNT_ID                         06441903
064420                    , T1.DIVERT_SYS_DTE                           06442003
064421                    , T1.DIVERT_SYS_TM                            06442103
064422                    , T1.SYS_TMST_LOCAL                           06442203
064423                    , T1.SYS_TMST_CENTRAL                         06442303
064424                    , T1.DIVERT_TMST - T1.SYS_TMST_CENTRAL        06442403
064425                          AS TMST_DIFF                            06442503
064426               FROM                                               06442603
064427               (SELECT A.OPER_UNT_ID                              06442703
064428                     , A.DIVERT_NBR                               06442803
064429                     , A.DIVERT_LOC_ID                            06442903
064430                     , A.DIVERT_TMST                              06443003
064431                     , A.BRCDE_NBR                                06443103
064432                     , A.SHIPT_UNT_ID                             06443203
064433                     , A.ACTV_CDE                                 06443303
064434                     , A.DOOR_ID                                  06443403
064435                     , A.DEST_OPER_UNT_ID                         06443503
064436                     , A.DIVERT_SYS_DTE                           06443603
064437                     , A.DIVERT_SYS_TM                            06443703
064438                     , TIMESTAMP(A.DIVERT_SYS_DTE                 06443803
064439                               , A.DIVERT_SYS_TM)                 06443903
064440                           AS SYS_TMST_LOCAL                      06444003
064441                     , TIMESTAMP(A.DIVERT_SYS_DTE                 06444103
064442                               , A.DIVERT_SYS_TM)                 06444203
064443                               - B.FUNC_QTY HOURS                 06444303
064444                           AS SYS_TMST_CENTRAL                    06444403
064445                  FROM TSUCRDV A                                  06444503
064446                     , TKRPRPM B                                  06444603
064447                 WHERE A.OPER_UNT_ID  = :DK-OPER-UNT-ID           06444703
064448                   AND A.DIVERT_TMST >= :PV-DIVERT-BEGIN-TMST     06444803
064449                   AND A.DIVERT_TMST <= :SU096-CURR-TMST          06444903
064450                   AND A.ACTV_CDE     = 'A'                       06445003
064451                   AND A.DIVERT_TMST IN                           06445103
064452                      (SELECT MAX(C.DIVERT_TMST)                  06445203
064453                         FROM TSUCRDV C                           06445303
064454                        WHERE C.OPER_UNT_ID  = :DK-OPER-UNT-ID    06445403
064455                          AND C.DIVERT_TMST                       06445503
064456                                        >= :PV-DIVERT-BEGIN-TMST  06445603
064457                          AND C.DIVERT_TMST <= :SU096-CURR-TMST   06445703
064458                          AND C.ACTV_CDE     = 'A'                06445803
064459                       )                                          06445903
064460                    AND A.OPER_UNT_ID      =  B.LOC_ID            06446003
064461                    AND B.INTFC_SYS_CDE    =  'KHL'               06446103
064462                    AND B.SYS_PRC_FUNC_CDE = 'TIMEZN'             06446203
064463                    AND B.FUNC_BEG_TMST   <= CURRENT TIMESTAMP    06446303
064464                    AND B.FUNC_END_TMST   >= CURRENT TIMESTAMP    06446403
064465               ) AS T1                                            06446503
064466              ) AS T2                                             06446603
064470              WITH UR                                             06447003
065700         END-EXEC                                                 06570006
065800                                                                  06580000
065900         EVALUATE TRUE                                            06590000
066000             WHEN SQLCODE = -904                                  06600000
066100             WHEN SQLCODE = -911                                  06610000
066200                 CONTINUE                                         06620000
066210                                                                  06621017
066300             WHEN SQLCODE = +100                                  06630017
066400                 PERFORM 2310-FETCH-LAST-DIVERT-TMST              06640017
066401                                                                  06640117
066402             WHEN SQLCODE = ZERO                                  06640217
066403                 DISPLAY '                        '               06640317
066410                 DISPLAY 'DC LOCAL DIVERT TMST:   '               06641010
066500                          PV-SYS-TMST-LOCAL                       06650003
066510                 DISPLAY 'DC CENTRAL DVRT TMST:   '               06651003
066520                          PV-SYS-TMST-CENTRAL                     06652003
066530                 DISPLAY 'DATABASE DIVERT TMST:   '               06653003
066540                          SUCRDV-DIVERT-TMST                      06654003
066541                 MOVE PV-TMST-DIFF  TO  PV-DISP-TMST-DIFF         06654106
066550                 DISPLAY 'DIFF/DELAY DC/DATABASE: '               06655003
066560                          PV-DISP-TMST-DIFF                       06656003
066570                         '  HHMMSS'                               06657003
066580                                                                  06658003
066590                 PERFORM 2375-CHECK-SNGL-LIMIT                    06659003
066591                                                                  06659103
066592                 IF  PV-TMST-DIFF  >  PV-SNGL-LIMIT               06659203
066700                     SET PS-ADDITIONAL-CHECK-NEEDED               06670000
066701                         PS-DELAYED-DIVERTS                       06670119
066710                                 TO TRUE                          06671000
066720                 ELSE                                             06672000
066730                     SET PS-NO-ADDITIONAL-CHECK-NEEDED            06673000
066740                                 TO TRUE                          06674000
066750                 END-IF                                           06675000
066760                                                                  06676000
066900             WHEN SQLWARN0 NOT = SPACES                           06690000
067000             WHEN SQLCODE < ZERO                                  06700000
067100             WHEN SQLCODE > ZERO                                  06710000
067200                 MOVE '2300-FETCH-LAST-DIVERT-TMST    '           06720000
067300                                 TO PV-ABEND-PARAGRAPH            06730000
067400                 MOVE 'FETCH MAX DIVERT TIMESTAMP'                06740000
067500                                 TO PV-ABEND-OPER-MESSAGE-1       06750000
067510                 MOVE SU096-CURR-TMST                             06751029
067520                                 TO PV-ABEND-OPER-MESSAGE-2       06752029
067600                 MOVE 'TSUCRDV'  TO PV-ABEND-TABLE-1              06760000
067700                 PERFORM 9100-SQL-ABEND                           06770000
067800             WHEN SQLCODE = ZERO                                  06780000
067900                 CONTINUE                                         06790000
068000         END-EVALUATE                                             06800000
068100     END-PERFORM.                                                 06810000
068200                                                                  06820000
068300     IF PV-COUNTER > PC-MAX-RETRIES                               06830000
068400         MOVE '2300-FETCH-LAST-DIVERT-TMST '                      06840000
068500                                 TO PV-ABEND-PARAGRAPH            06850000
068600         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF MAX DIVERT TMST'  06860000
068700                                 TO PV-ABEND-OPER-MESSAGE-1       06870000
068710         MOVE SU096-CURR-TMST                                     06871029
068720                                 TO PV-ABEND-OPER-MESSAGE-2       06872029
068800         MOVE 'TSUCRDV'          TO PV-ABEND-TABLE-1              06880000
068900         PERFORM 9100-SQL-ABEND                                   06890000
069000     END-IF.                                                      06900000
069300                                                                  06930000
069400                                                                  06940000
069401******************************************************************06940117
069402*  FETCH THE LAST DIVERT TIMESTAMP FROM THE CONTAINER DIVERT      06940217
069403*  TABLE (TSUCRDV).                                               06940317
069404*  THIS IS THE SAME SQL AS 2300-FETCH-LAST-DIVERT-TMST BUT        06940417
069405*  WITHOUT THE DAYS RESTRICTION.  THIS WAS PUT IN BECAUSE THE DC'S06940517
069406*  WERE CLOSED DUE TO THE COVID-19 VIRUS, DC'S WERE CLOSED        06940617
069407******************************************************************06940717
069408 2310-FETCH-LAST-DIVERT-TMST.                                     06940817
069409                                                                  06940917
069410     INITIALIZE PV-MAX-DIVERT-TIMESTAMP.                          06941017
069411                                                                  06941117
069412     PERFORM WITH TEST AFTER                                      06941217
069413       VARYING PV-COUNTER FROM 1 BY 1                             06941317
069414         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       06941417
069415                OR                                                06941517
069416                SQLCODE = ZERO)                                   06941617
069417                                                                  06941717
069418         EXEC SQL                                                 06941817
069419              SELECT  T2.OPER_UNT_ID                              06941917
069420                    , T2.DIVERT_NBR                               06942030
069421                    , T2.DIVERT_LOC_ID                            06942130
069422                    , T2.DIVERT_TMST                              06942217
069423                    , T2.BRCDE_NBR                                06942317
069424                    , T2.SHIPT_UNT_ID                             06942417
069425                    , T2.ACTV_CDE                                 06942517
069426                    , T2.DOOR_ID                                  06942617
069427                    , T2.DEST_OPER_UNT_ID                         06942730
069428                    , T2.DIVERT_SYS_DTE                           06942817
069429                    , T2.DIVERT_SYS_TM                            06942917
069430                    , T2.SYS_TMST_LOCAL                           06943017
069431                    , T2.SYS_TMST_CENTRAL                         06943117
069432                    , T2.TMST_DIFF                                06943217
069433               INTO  :SUCRDV-OPER-UNT-ID                          06943317
069434                    ,:SUCRDV-DIVERT-NBR                           06943417
069435                    ,:SUCRDV-DIVERT-LOC-ID                        06943517
069436                    ,:SUCRDV-DIVERT-TMST                          06943617
069437                    ,:SUCRDV-BRCDE-NBR                            06943717
069438                    ,:SUCRDV-SHIPT-UNT-ID                         06943817
069439                    ,:SUCRDV-ACTV-CDE                             06943917
069440                    ,:SUCRDV-DOOR-ID                              06944017
069441                    ,:SUCRDV-DEST-OPER-UNT-ID                     06944117
069442                    ,:SUCRDV-DIVERT-SYS-DTE                       06944217
069443                    ,:SUCRDV-DIVERT-SYS-TM                        06944317
069444                    ,:PV-SYS-TMST-LOCAL                           06944417
069445                    ,:PV-SYS-TMST-CENTRAL                         06944517
069446                    ,:PV-TMST-DIFF                                06944617
069447              FROM                                                06944717
069448              (SELECT T1.OPER_UNT_ID                              06944817
069449                    , T1.DIVERT_NBR                               06944917
069450                    , T1.DIVERT_LOC_ID                            06945017
069451                    , T1.DIVERT_TMST                              06945117
069452                    , T1.BRCDE_NBR                                06945217
069453                    , T1.SHIPT_UNT_ID                             06945317
069454                    , T1.ACTV_CDE                                 06945417
069455                    , T1.DOOR_ID                                  06945517
069456                    , T1.DEST_OPER_UNT_ID                         06945617
069457                    , T1.DIVERT_SYS_DTE                           06945717
069458                    , T1.DIVERT_SYS_TM                            06945817
069459                    , T1.SYS_TMST_LOCAL                           06945917
069460                    , T1.SYS_TMST_CENTRAL                         06946017
069461                    , T1.DIVERT_TMST - T1.SYS_TMST_CENTRAL        06946117
069462                          AS TMST_DIFF                            06946217
069463               FROM                                               06946317
069464               (SELECT A.OPER_UNT_ID                              06946417
069465                     , A.DIVERT_NBR                               06946517
069466                     , A.DIVERT_LOC_ID                            06946617
069467                     , A.DIVERT_TMST                              06946717
069468                     , A.BRCDE_NBR                                06946817
069469                     , A.SHIPT_UNT_ID                             06946917
069470                     , A.ACTV_CDE                                 06947017
069471                     , A.DOOR_ID                                  06947117
069472                     , A.DEST_OPER_UNT_ID                         06947217
069473                     , A.DIVERT_SYS_DTE                           06947317
069474                     , A.DIVERT_SYS_TM                            06947417
069475                     , TIMESTAMP(A.DIVERT_SYS_DTE                 06947517
069476                               , A.DIVERT_SYS_TM)                 06947617
069477                           AS SYS_TMST_LOCAL                      06947717
069478                     , TIMESTAMP(A.DIVERT_SYS_DTE                 06947817
069479                               , A.DIVERT_SYS_TM)                 06947917
069480                               - B.FUNC_QTY HOURS                 06948017
069481                           AS SYS_TMST_CENTRAL                    06948117
069482                  FROM TSUCRDV A                                  06948217
069483                     , TKRPRPM B                                  06948317
069484                 WHERE A.OPER_UNT_ID  = :DK-OPER-UNT-ID           06948417
069485                   AND A.DIVERT_TMST <= :SU096-CURR-TMST          06948517
069486                   AND A.ACTV_CDE     = 'A'                       06948617
069487                   AND A.DIVERT_TMST IN                           06948717
069488                      (SELECT MAX(C.DIVERT_TMST)                  06948817
069489                         FROM TSUCRDV C                           06948917
069490                        WHERE C.OPER_UNT_ID  = :DK-OPER-UNT-ID    06949017
069491                          AND C.DIVERT_TMST <= :SU096-CURR-TMST   06949117
069492                          AND C.ACTV_CDE     = 'A'                06949217
069493                       )                                          06949317
069494                    AND A.OPER_UNT_ID      =  B.LOC_ID            06949417
069495                    AND B.INTFC_SYS_CDE    =  'KHL'               06949517
069496                    AND B.SYS_PRC_FUNC_CDE = 'TIMEZN'             06949617
069497                    AND B.FUNC_BEG_TMST   <= CURRENT TIMESTAMP    06949717
069498                    AND B.FUNC_END_TMST   >= CURRENT TIMESTAMP    06949817
069499               ) AS T1                                            06949917
069500              ) AS T2                                             06950017
069501              WITH UR                                             06950117
069502         END-EXEC                                                 06950217
069503                                                                  06950317
069504         EVALUATE TRUE                                            06950417
069505             WHEN SQLCODE = -904                                  06950517
069506             WHEN SQLCODE = -911                                  06950617
069507                 CONTINUE                                         06950717
069508                                                                  06950817
069511             WHEN SQLCODE = ZERO                                  06951117
069512                 DISPLAY '                        '               06951217
069513                 DISPLAY 'DC LOCAL DIVERT TMST:   '               06951317
069514                          PV-SYS-TMST-LOCAL                       06951417
069515                 DISPLAY 'DC CENTRAL DVRT TMST:   '               06951517
069516                          PV-SYS-TMST-CENTRAL                     06951617
069517                 DISPLAY 'DATABASE DIVERT TMST:   '               06951717
069518                          SUCRDV-DIVERT-TMST                      06951817
069519                 MOVE PV-TMST-DIFF  TO  PV-DISP-TMST-DIFF         06951917
069520                 DISPLAY 'DIFF/DELAY DC/DATABASE: '               06952017
069521                          PV-DISP-TMST-DIFF                       06952117
069522                         '  HHMMSS'                               06952217
069523                                                                  06952317
069524                 PERFORM 2375-CHECK-SNGL-LIMIT                    06952417
069525                                                                  06952517
069526                 IF  PV-TMST-DIFF  >  PV-SNGL-LIMIT               06952617
069527                     SET PS-ADDITIONAL-CHECK-NEEDED               06952717
069528                         PS-DELAYED-DIVERTS                       06952819
069529                                 TO TRUE                          06952919
069530                 ELSE                                             06953019
069531                     SET PS-NO-ADDITIONAL-CHECK-NEEDED            06953119
069532                                 TO TRUE                          06953219
069533                 END-IF                                           06953319
069534                                                                  06953419
069535             WHEN SQLWARN0 NOT = SPACES                           06953519
069536             WHEN SQLCODE < ZERO                                  06953619
069537             WHEN SQLCODE > ZERO                                  06953719
069538                 MOVE '2310-FETCH-LAST-DIVERT-TMST    '           06953819
069539                                 TO PV-ABEND-PARAGRAPH            06953919
069540                 MOVE 'FETCH MAX DIVERT TIMESTAMP'                06954019
069541                                 TO PV-ABEND-OPER-MESSAGE-1       06954119
069542                 MOVE SU096-CURR-TMST                             06954229
069543                                 TO PV-ABEND-OPER-MESSAGE-2       06954329
069544                 MOVE 'TSUCRDV'  TO PV-ABEND-TABLE-1              06954419
069545                 PERFORM 9100-SQL-ABEND                           06954519
069546             WHEN SQLCODE = ZERO                                  06954619
069547                 CONTINUE                                         06954719
069548         END-EVALUATE                                             06954819
069549     END-PERFORM.                                                 06954919
069550                                                                  06955019
069551     IF PV-COUNTER > PC-MAX-RETRIES                               06955119
069552         MOVE '2310-FETCH-LAST-DIVERT-TMST '                      06955219
069553                                 TO PV-ABEND-PARAGRAPH            06955319
069554         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF MAX DIVERT TMST'  06955419
069555                                 TO PV-ABEND-OPER-MESSAGE-1       06955519
069556         MOVE SU096-CURR-TMST                                     06955629
069557                                 TO PV-ABEND-OPER-MESSAGE-2       06955729
069558         MOVE 'TSUCRDV'          TO PV-ABEND-TABLE-1              06955819
069559         PERFORM 9100-SQL-ABEND                                   06955919
069560     END-IF.                                                      06956019
069561                                                                  06956119
069562                                                                  06956219
069563******************************************************************06956319
069564*  FETCH THE LAST USED SEQUENCE NUMBER PARAMETER.  THIS PARAMETER 06956419
069565*  WILL BE USED AS PART OF THE OPEN ASSIGNMENTS CHECK AND THE     06956519
069566*  CLOSED ASSIGNMENTS CHECK TO DETERMINE IF A DC IS OPEN FOR      06956619
069567*  PROCESSING.                                                    06956719
069568******************************************************************06956819
069569 2350-FETCH-SEQ-NBR-PARM.                                         06956919
069570                                                                  06957019
069571     INITIALIZE DCLTKRPRPM.                                       06957119
069572                                                                  06957219
069573     PERFORM WITH TEST AFTER                                      06957319
069574       VARYING PV-COUNTER FROM 1 BY 1                             06957419
069575         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       06957519
069576                OR                                                06957619
069577                SQLCODE = ZERO)                                   06957719
069578                                                                  06957819
069579         EXEC SQL                                                 06957919
069580             SELECT FUNC_QTY                  AS PARM_SEQ_NBR     06958019
069581               INTO :PV-PARM-SEQ-NBR                              06958119
069582               FROM TKRPRPM                                       06958219
069583              WHERE LOC_ID            = 90                        06958319
069584                AND SYS_PRC_FUNC_CDE  = 'CNVYSQ'                  06958419
069585                AND INTFC_SYS_CDE     = 'KHL'                     06958519
069586                AND FUNC_PRC_STAT_CDE  = 'AC'                     06958619
069587                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        06958719
069588                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        06958819
069589         END-EXEC                                                 06958919
069590                                                                  06959019
069591         EVALUATE TRUE                                            06959119
069592             WHEN SQLCODE = -904                                  06959219
069593             WHEN SQLCODE = -911                                  06959319
069594                 CONTINUE                                         06959419
069595             WHEN SQLWARN0 NOT = SPACES                           06959519
069596             WHEN SQLCODE < ZERO                                  06959619
069597             WHEN SQLCODE > ZERO                                  06959719
069598                 MOVE '2350-FETCH-SEQ-NBR-PARM        '           06959819
069599                                 TO PV-ABEND-PARAGRAPH            06959919
069600                 MOVE 'FETCH DATA FROM TKRPRPM TABLE  '           06960019
069601                                 TO PV-ABEND-OPER-MESSAGE-1       06960119
069602                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              06960219
069603                 PERFORM 9100-SQL-ABEND                           06960319
069604             WHEN SQLCODE = ZERO                                  06960419
069605                 MOVE  PV-PARM-SEQ-NBR                            06960519
069606                                 TO  PV-DISPLAY-COUNT             06960619
069607                 DISPLAY 'CNVYSQ PARM SEQUENCE NUMBER -    '      06960719
069608                              PV-DISPLAY-COUNT                    06960819
069609         END-EVALUATE                                             06960919
069610     END-PERFORM.                                                 06961019
069611                                                                  06961119
069612     IF PV-COUNTER > PC-MAX-RETRIES                               06961219
069613         MOVE '2350-FETCH-SEQ-NBR-PARM     '                      06961319
069614                                 TO PV-ABEND-PARAGRAPH            06961419
069615         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'06961519
069616                                 TO PV-ABEND-OPER-MESSAGE-1       06961619
069617         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              06961719
069618         PERFORM 9100-SQL-ABEND                                   06961819
069619     END-IF.                                                      06961919
069620                                                                  06962019
069621                                                                  06962119
069622******************************************************************06962219
069630*  THIS SELECT IS FOR DC'S WITH SINGLE CONVEYOR SYSTEM.  THIS     06963003
069700*  VALUE WILL BE THE ALERT LIMIT.  HOW MUCH DIFFERENCE WILL BE    06970003
069800*  ALLOWED BETWEEN THE TIME THE DC CONVEYOR SENDS THE DIVERT AND  06980003
069900*  WHEN WE RECEIVE IT IN THE DATABASE.                            06990003
069901*                                                                 06990103
069902*  NOTE THIS IS SET UP BY DC, IN CASE THE TIME ON THE CONVEYOR    06990203
069903*  SERVER IS NOT SET UP CORRECTLY                                 06990303
069904*                                                                 06990403
069910*  THIS WILL BE COMPARED WITH PV-TMST-DIFF                        06991003
070000******************************************************************07000000
070010 2375-CHECK-SNGL-LIMIT.                                           07001003
070020                                                                  07002000
070030     MOVE ZEROES  TO  PV-SNGL-LIMIT.                              07003003
070040                                                                  07004000
070050     PERFORM WITH TEST AFTER                                      07005000
070060       VARYING PV-COUNTER FROM 1 BY 1                             07006000
070070         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       07007000
070080                OR                                                07008000
070090                SQLCODE = ZERO)                                   07009000
070091                                                                  07009100
070092         EXEC SQL                                                 07009200
070093             SELECT FUNC_QTY                                      07009303
070094               INTO :PV-SNGL-LIMIT                                07009403
070095               FROM TKRPRPM                                       07009500
070096              WHERE LOC_ID            = :DK-OPER-UNT-ID           07009603
070097                AND SYS_PRC_FUNC_CDE  = 'CNSGTM'                  07009736
070098                AND INTFC_SYS_CDE     = 'KHL'                     07009800
070099                AND FUNC_PRC_STAT_CDE  = 'AC'                     07009900
070100                AND FUNC_BEG_TMST     <= CURRENT TIMESTAMP        07010000
070101                AND FUNC_END_TMST     >= CURRENT TIMESTAMP        07010100
070102               WITH UR                                            07010203
070103         END-EXEC                                                 07010300
070104                                                                  07010400
070105         EVALUATE TRUE                                            07010500
070106             WHEN SQLCODE = -904                                  07010600
070107             WHEN SQLCODE = -911                                  07010700
070108                 CONTINUE                                         07010800
070109             WHEN SQLWARN0 NOT = SPACES                           07010900
070110             WHEN SQLCODE < ZERO                                  07011000
070111             WHEN SQLCODE > ZERO                                  07011100
070112                 MOVE '2375-CHECK-SNGL-LIMIT          '           07011203
070113                                 TO PV-ABEND-PARAGRAPH            07011300
070114                 MOVE 'SELECT PARM:  CNSGTM           '           07011403
070115                                 TO PV-ABEND-OPER-MESSAGE-1       07011500
070116                 MOVE 'TKRPRPM'  TO PV-ABEND-TABLE-1              07011600
070117                 PERFORM 9100-SQL-ABEND                           07011700
070118             WHEN SQLCODE = ZERO                                  07011800
070119                 MOVE  PV-SNGL-LIMIT                              07011903
070120                                 TO  PV-DISP-LIMIT                07012003
070121                 DISPLAY 'CNSGTM - SINGLE CONVEY LIMIT: '         07012103
070122                              PV-DISP-LIMIT                       07012203
070123         END-EVALUATE                                             07012300
070124     END-PERFORM.                                                 07012400
070125                                                                  07012500
070126     IF PV-COUNTER > PC-MAX-RETRIES                               07012600
070127         MOVE '2375-CHECK-SNGL-LIMIT       '                      07012703
070128                                 TO PV-ABEND-PARAGRAPH            07012800
070129         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'07012900
070130                                 TO PV-ABEND-OPER-MESSAGE-1       07013000
070131         MOVE 'TKRPRPM'          TO PV-ABEND-TABLE-1              07013100
070132         PERFORM 9100-SQL-ABEND                                   07013200
070133     END-IF.                                                      07013300
070135                                                                  07013500
070136                                                                  07013600
070137******************************************************************07013700
070138*  CHECK IF THERE ARE ANY OPEN ASSIGNMENTS FOR THE SPECIFIED DC.  07013800
070139******************************************************************07013900
070140 2400-CHECK-OPEN-ASSIGNMENTS.                                     07014000
070150                                                                  07015000
070160     INITIALIZE DCLDLT00004                                       07016000
070170                PV-OPEN-ASGMT-COUNT                               07017000
070180                                                                  07018000
070190     PERFORM WITH TEST AFTER                                      07019000
070200       VARYING PV-COUNTER FROM 1 BY 1                             07020000
070300         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       07030000
070400                OR                                                07040000
070500                SQLCODE = ZERO                                    07050000
070600                OR                                                07060000
070700                SQLCODE = +100)                                   07070000
070800                                                                  07080000
072300         EXEC SQL                                                 07230000
072400             SELECT 1                                             07240000
072500               INTO :PV-OPEN-ASGMT-COUNT                          07250000
072600               FROM DLT_ASGMT A                                   07260000
072700              WHERE A.DC_NBR         = :DK-LOC-ID                 07270000
072710                AND (A.WK_TYP_DESC LIKE 'RECV%'                   07271000
072720                 OR  A.WK_TYP_DESC LIKE 'P2L%')                   07272000
072730                AND A.ASGMT_STP_TMST IS NULL                      07273000
072740                AND A.LAST_USD_SEQ_NBR > :PV-PARM-SEQ-NBR         07274000
072750           FETCH FIRST 1 ROW ONLY                                 07275000
072760         END-EXEC                                                 07276000
072770                                                                  07277000
072780         EVALUATE TRUE                                            07278000
072790             WHEN SQLCODE = ZERO                                  07279000
072791                  MOVE 1  TO  PV-OPEN-ASGMT-COUNT                 07279100
072792                  MOVE  PV-OPEN-ASGMT-COUNT                       07279200
072793                          TO  PV-DISPLAY-COUNT                    07279300
072794                  DISPLAY '                          '            07279411
072795                  DISPLAY 'OPEN ASSIGNMENT COUNT -   '            07279511
072796                           PV-DISPLAY-COUNT                       07279611
072797                                                                  07279711
072798             WHEN SQLCODE = +100                                  07279811
072799             WHEN SQLCODE = -904                                  07279911
072800             WHEN SQLCODE = -911                                  07280011
072810                  MOVE  0  TO  PV-OPEN-ASGMT-COUNT                07281011
072900                  DISPLAY 'THERE WERE NOT ANY OPEN '              07290000
073000                          'ASSIGNMENTS FOUND FOR THIS DC'         07300000
073100                                                                  07310000
073200             WHEN SQLWARN0 NOT = SPACES                           07320000
073210             WHEN SQLCODE < ZERO                                  07321000
073220             WHEN SQLCODE > ZERO                                  07322000
073230                  MOVE  0  TO  PV-OPEN-ASGMT-COUNT                07323000
073240                 MOVE '2400-CHECK-OPEN-ASSIGNMENTS    '           07324000
073250                                 TO PV-ABEND-PARAGRAPH            07325000
073260                 MOVE 'CHECK FOR OPEN ASSIGNMENTS  '              07326000
073270                                 TO PV-ABEND-OPER-MESSAGE-1       07327000
073280                 MOVE 'DLT_ASGMT'                                 07328000
073290                                 TO PV-ABEND-TABLE-1              07329000
073300                 PERFORM 9100-SQL-ABEND                           07330000
073400         END-EVALUATE                                             07340000
073500     END-PERFORM.                                                 07350000
073600                                                                  07360000
073700     IF PV-COUNTER > PC-MAX-RETRIES                               07370000
073800         MOVE '2400-CHECK-OPEN-ASSIGNMENTS '                      07380000
073900                                 TO PV-ABEND-PARAGRAPH            07390000
074000         MOVE 'MAX RETRIES EXCEEDED CHECK FOR OPEN ASSIGNMENTS'   07400000
074100                                 TO PV-ABEND-OPER-MESSAGE-1       07410000
074200         MOVE 'DLT_ASGMT'        TO PV-ABEND-TABLE-1              07420000
074300         PERFORM 9100-SQL-ABEND                                   07430000
074400     END-IF.                                                      07440000
074700                                                                  07470000
074800                                                                  07480000
074900******************************************************************07490000
075000*  CHECK IF THERE ARE ANY CLOSED ASSIGNMENTS FOR THE SPECIFIED    07500000
075100*  DC.                                                            07510000
075200******************************************************************07520000
075300 2500-CHECK-CLOSED-ASSIGNMENTS.                                   07530000
075400                                                                  07540000
075500     INITIALIZE DCLDLT00004                                       07550000
075600                PV-CLOSED-ASGMT-COUNT                             07560000
075700                                                                  07570000
075800     PERFORM WITH TEST AFTER                                      07580000
075900       VARYING PV-COUNTER FROM 1 BY 1                             07590000
076000         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       07600000
076100                OR                                                07610000
076200                SQLCODE = ZERO                                    07620000
076300                OR                                                07630000
076400                SQLCODE = +100)                                   07640000
076500                                                                  07650000
078000         EXEC SQL                                                 07800000
078100             SELECT  1                                            07810000
078200               INTO :PV-CLOSED-ASGMT-COUNT                        07820000
078300               FROM DLT_ASGMT A                                   07830000
078400              WHERE A.DC_NBR          = :DK-LOC-ID                07840000
078500                AND (A.WK_TYP_DESC LIKE 'RECV%'                   07850000
078600                 OR  A.WK_TYP_DESC LIKE 'P2L%')                   07860000
078700                AND A.ASGMT_STP_TMST >= :SU096-BACK-TMST          07870000
078800                AND A.LAST_USD_SEQ_NBR > :PV-PARM-SEQ-NBR         07880000
078810           FETCH FIRST 1 ROW ONLY                                 07881000
078820         END-EXEC                                                 07882000
078830                                                                  07883000
078840         EVALUATE TRUE                                            07884000
078850             WHEN SQLCODE = ZERO                                  07885000
078860                  MOVE  1  TO  PV-CLOSED-ASGMT-COUNT              07886000
078870                  MOVE  PV-CLOSED-ASGMT-COUNT                     07887000
078880                              TO  PV-DISPLAY-COUNT                07888000
078890                  DISPLAY 'CLOSED ASSIGNMENT COUNT - '            07889000
078900                           PV-DISPLAY-COUNT                       07890000
079000                                                                  07900000
079010             WHEN SQLCODE = +100                                  07901000
079020             WHEN SQLCODE = -904                                  07902000
079030             WHEN SQLCODE = -911                                  07903000
079040                  MOVE 0  TO  PV-CLOSED-ASGMT-COUNT               07904000
079050                  DISPLAY 'THERE WERE NOT ANY CLOSED '            07905000
079060                          'ASSIGNMENTS FOUND FOR THIS DC'         07906000
079070                                                                  07907000
079080             WHEN SQLWARN0 NOT = SPACES                           07908000
079090             WHEN SQLCODE < ZERO                                  07909000
079100             WHEN SQLCODE > ZERO                                  07910000
079200                 MOVE '2500-CHECK-CLOSED-ASSIGNMENTS  '           07920000
079300                                 TO PV-ABEND-PARAGRAPH            07930000
079400                 MOVE 'CHECK FOR CLOSED ASSIGNMENTS'              07940000
079500                                 TO PV-ABEND-OPER-MESSAGE-1       07950000
079600                 MOVE 'DLT_ASGMT'                                 07960000
079700                                 TO PV-ABEND-TABLE-1              07970000
079800                 PERFORM 9100-SQL-ABEND                           07980000
079900         END-EVALUATE                                             07990000
080000     END-PERFORM.                                                 08000000
080100                                                                  08010000
080200     IF PV-COUNTER > PC-MAX-RETRIES                               08020000
080300         MOVE '2500-CHECK-CLOSED-ASSIGNMENTS'                     08030000
080400                                 TO PV-ABEND-PARAGRAPH            08040000
080500         MOVE 'MAX RETRIES EXCEEDED CHECK FOR CLOSED ASSIGNMENTS' 08050000
080600                                 TO PV-ABEND-OPER-MESSAGE-1       08060000
080700         MOVE 'DLT_ASGMT'        TO PV-ABEND-TABLE-1              08070000
080800         PERFORM 9100-SQL-ABEND                                   08080000
080900     END-IF.                                                      08090000
081200                                                                  08120000
081300                                                                  08130000
081400******************************************************************08140000
081500*  SET UP THE ERROR RECORD THAT WILL BE WRITTEN TO A FILE AND     08150000
081600*  ALSO DISPLAYED IN SYSOUT WHEN THERE HAVE NOT BEEN CONTAINER    08160000
081700*  DIVERTS RECEIVED FOR A DC AND THEY ARE OPEN FOR PROCESSING.    08170000
081800******************************************************************08180000
081900 2600-SETUP-ERROR-REC.                                            08190000
082000                                                                  08200000
082600     MOVE SPACES                        TO HEAD-REC.              08260000
082700     DISPLAY HEAD-REC.                                            08270000
082800     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08280000
082900                                                                  08290000
083000     MOVE SPACES                        TO HEAD-REC.              08300000
083100     STRING  'CONVEYOR DIVERT TO DATABASE HAS EXCEEDED '          08310003
083200             'TIME LIMIT'                                         08320003
083300                  DELIMITED BY SIZE                               08330000
083400                                      INTO HEAD-REC.              08340000
083500     DISPLAY HEAD-REC.                                            08350000
083600     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08360000
083700                                                                  08370000
084200     MOVE SPACES                        TO HEAD-REC.              08420000
084300     STRING  'IS THERE AN ISSUE WITH UPLOADS?'                    08430003
084400                  DELIMITED BY SIZE                               08440000
084500                                      INTO HEAD-REC.              08450000
084600     DISPLAY HEAD-REC.                                            08460000
084700     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08470000
084800                                                                  08480000
085600     STRING  'CONVEYOR DIVERTS ARE DELAYED FOR '                  08560003
085700              CC-CONTROL-CARD                                     08570000
085800                  DELIMITED BY SIZE                               08580000
085900                                      INTO HEAD-REC.              08590000
086000     DISPLAY HEAD-REC.                                            08600000
086100     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08610000
086200                                                                  08620000
086400     MOVE SPACES                        TO HEAD-REC               08640000
086500     DISPLAY HEAD-REC.                                            08650000
086510     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08651000
086530                                                                  08653000
086531                                                                  08653104
086532************************************************************      08653204
086533*  MULTIPLE CONVEYOR VENDORS CHECK - EMAIL INFO                   08653304
086534*                                                                 08653404
086535*         FROM CONVEYOR VENDOR XXXXXXXXXXXXXXXXXXXX               08653504
086536*         DIVERT TIMESTAMP: CCYY-MM-DD-YY.HH.MM.SSSSSS            08653604
086537*                                                                 08653704
086538*         DC LOCAL TMST:    CCYY-MM-DD-YY.HH.MM.SSSSSS            08653804
086539*         DC CENTRAL TMST:  CCYY-MM-DD-YY.HH.MM.SSSSSS            08653904
086540*                                                                 08654004
086541*         LIMIT: HHMMSS       DELAY: HHMMSS                       08654104
086542*                                                                 08654204
086543************************************************************      08654304
086544     IF  PS-MULTI-CONVEYOR-VENDORS                                08654404
086550         MOVE SPACES                    TO HEAD-REC               08655000
086560         STRING                                                   08656004
086580                 'FROM CONVEYOR VENDOR '                          08658000
086590                      DELIMITED BY SIZE                           08659000
086600                  PV-CNVY-VENDOR                                  08660000
086700                      DELIMITED BY '  '                           08670000
086800                  ':'                                             08680000
086900                      DELIMITED BY SIZE                           08690000
087000                                      INTO HEAD-REC               08700000
087100         DISPLAY HEAD-REC                                         08710000
087200         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08720000
087201                                                                  08720114
087202         MOVE SPACES                    TO HEAD-REC               08720214
087203         STRING  '     '                                          08720314
087204                 'DOOR RANGE: ' PV-BEGIN-RANGE-1-4                08720415
087206                 '-'            PV-END-RANGE-1-4                  08720615
087207                 '  '           PV-ADDL-DOOR-1-4                  08720715
087212                      DELIMITED BY SIZE                           08721214
087213                                      INTO HEAD-REC               08721314
087214         DISPLAY HEAD-REC                                         08721414
087215         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08721514
087216                                                                  08721614
087217         MOVE SPACES                    TO HEAD-REC               08721714
087218         DISPLAY HEAD-REC                                         08721814
087219         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08721914
087220                                                                  08722003
087300         MOVE SPACES                    TO HEAD-REC               08730000
087400         STRING 'DIVERT TIMESTAMP: '  PV-MAX-DIVERT-TIMESTAMP     08740012
087800                                           DELIMITED BY SIZE      08780000
087900                                      INTO HEAD-REC               08790000
088000         DISPLAY HEAD-REC                                         08800000
088100         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08810000
088101                                                                  08810103
088102         MOVE SPACES                    TO HEAD-REC               08810213
088103         STRING 'SML NUMBER:       '  SUCRDV-BRCDE-NBR            08810313
088104                                           DELIMITED BY SIZE      08810413
088105                                      INTO HEAD-REC               08810513
088106         DISPLAY HEAD-REC                                         08810613
088107         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08810713
088108                                                                  08810813
088109         MOVE SPACES                    TO HEAD-REC               08810903
088110         DISPLAY HEAD-REC                                         08811013
088111         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08811113
088112                                                                  08811213
088113         MOVE SPACES                    TO HEAD-REC               08811313
088114         STRING 'DC LOCAL TMST:    '  PV-SYS-TMST-LOCAL           08811413
088115                                           DELIMITED BY SIZE      08811513
088116                                      INTO HEAD-REC               08811613
088117         DISPLAY HEAD-REC                                         08811713
088118         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08811813
088119                                                                  08811913
088120         MOVE SPACES                    TO HEAD-REC               08812003
088121         STRING 'DC CENTRAL TMST:  '  PV-SYS-TMST-CENTRAL         08812103
088122                                           DELIMITED BY SIZE      08812203
088123                                      INTO HEAD-REC               08812303
088124         DISPLAY HEAD-REC                                         08812403
088125         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08812503
088126                                                                  08812603
088127         MOVE SPACES                    TO HEAD-REC               08812703
088128         DISPLAY HEAD-REC                                         08812803
088129         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08812912
088130                                                                  08813003
088142         MOVE PV-MULT-LIMIT             TO PV-DISP-LIMIT          08814204
088143         MOVE PV-TMST-DIFF              TO PV-DISP-DIFF           08814303
088144         MOVE SPACES                    TO HEAD-REC               08814403
088145         STRING 'LIMIT: '  PV-DISP-LIMIT                          08814503
088146                '       '                                         08814606
088147                'DELAY: '  PV-DISP-DIFF                           08814706
088148                '    HHMMSS'                                      08814812
088149                                           DELIMITED BY SIZE      08814912
088150                                      INTO HEAD-REC               08815012
088151         DISPLAY HEAD-REC                                         08815112
088152         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08815212
088153                                                                  08815312
088154     ELSE                                                         08815412
088155                                                                  08815512
088156************************************************************      08815612
088157*  SORTER CHECK - EMAIL INFO                                      08815712
088158*                                                                 08815812
088159*         FROM SORTER:      XXXXXXXXXXXXXXXXXXXX                  08815912
088160*         DIVERT TIMESTAMP: CCYY-MM-DD-YY.HH.MM.SSSSSS            08816012
088161*                                                                 08816112
088162*         DC LOCAL TMST:    CCYY-MM-DD-YY.HH.MM.SSSSSS            08816212
088163*         DC CENTRAL TMST:  CCYY-MM-DD-YY.HH.MM.SSSSSS            08816312
088164*                                                                 08816412
088165*         LIMIT: HHMMSS       DELAY: HHMMSS                       08816512
088166*                                                                 08816612
088167************************************************************      08816712
088168     IF  PS-SORTER-CONVEYOR-CHECK                                 08816812
088169         MOVE SPACES                    TO HEAD-REC               08816912
088170         STRING                                                   08817012
088171                 'FROM SORTER: '                                  08817112
088172                      DELIMITED BY SIZE                           08817212
088173                  PV-SORTER-NAME                                  08817312
088174                      DELIMITED BY '  '                           08817412
088175                  ':'                                             08817512
088176                      DELIMITED BY SIZE                           08817612
088177                                      INTO HEAD-REC               08817712
088178         DISPLAY HEAD-REC                                         08817812
088179         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08817912
088180                                                                  08818012
088191         MOVE SPACES                    TO HEAD-REC               08819114
088192         DISPLAY HEAD-REC                                         08819214
088193         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08819314
088194                                                                  08819414
088195         MOVE SPACES                    TO HEAD-REC               08819512
088196         STRING 'DIVERT TIMESTAMP: '  SUCRDV-DIVERT-TMST          08819612
088197                                           DELIMITED BY SIZE      08819712
088198                                      INTO HEAD-REC               08819812
088199         DISPLAY HEAD-REC                                         08819912
088200         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08820012
088201                                                                  08820112
088202         MOVE SPACES                    TO HEAD-REC               08820213
088203         STRING 'SML NUMBER:       '  SUCRDV-BRCDE-NBR            08820313
088204                                           DELIMITED BY SIZE      08820413
088205                                      INTO HEAD-REC               08820513
088206         DISPLAY HEAD-REC                                         08820613
088207         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08820713
088208                                                                  08820813
088209         MOVE SPACES                    TO HEAD-REC               08820912
088210         STRING 'DC LOCAL TMST:    '  PV-SYS-TMST-LOCAL           08821012
088211                                           DELIMITED BY SIZE      08821112
088212                                      INTO HEAD-REC               08821212
088213         DISPLAY HEAD-REC                                         08821312
088214         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08821412
088215                                                                  08821512
088216         MOVE SPACES                    TO HEAD-REC               08821612
088217         STRING 'DC CENTRAL TMST:  '  PV-SYS-TMST-CENTRAL         08821712
088218                                           DELIMITED BY SIZE      08821812
088219                                      INTO HEAD-REC               08821912
088220         DISPLAY HEAD-REC                                         08822012
088221         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08822112
088222                                                                  08822212
088223         MOVE SPACES                    TO HEAD-REC               08822312
088224         DISPLAY HEAD-REC                                         08822412
088225         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08822512
088226                                                                  08822604
088227         MOVE PV-SRTR-LIMIT             TO PV-DISP-LIMIT          08822704
088228         MOVE PV-TMST-DIFF              TO PV-DISP-DIFF           08822804
088229         MOVE SPACES                    TO HEAD-REC               08822904
088230         STRING 'LIMIT: '  PV-DISP-LIMIT                          08823004
088231                '       '                                         08823106
088232                'DELAY: '  PV-DISP-DIFF                           08823206
088233                '    HHMMSS'                                      08823312
088234                                           DELIMITED BY SIZE      08823412
088235                                      INTO HEAD-REC               08823512
088236         DISPLAY HEAD-REC                                         08823612
088237         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08823712
088240                                                                  08824012
088249     ELSE                                                         08824900
088250                                                                  08825003
088251************************************************************      08825103
088252* SINGLE CONVEYOR E-MAIL INFO                                     08825203
088253*                                                                 08825303
088254*         DIVERT TIMESTAMP: CCYY-MM-DD-YY.HH.MM.SSSSSS            08825403
088255*                                                                 08825503
088256*         DC LOCAL TMST:    CCYY-MM-DD-YY.HH.MM.SSSSSS            08825603
088257*         DC CENTRAL TMST:  CCYY-MM-DD-YY.HH.MM.SSSSSS            08825703
088258*                                                                 08825803
088259*         LIMIT: HHMMSS       DELAY: HHMMSS                       08825903
088260*                                                                 08826003
088261************************************************************      08826103
088262         MOVE SPACES                    TO HEAD-REC               08826203
088263         STRING 'DIVERT TIMESTAMP: '  SUCRDV-DIVERT-TMST          08826303
088264                                           DELIMITED BY SIZE      08826403
088265                                      INTO HEAD-REC               08826503
088266         DISPLAY HEAD-REC                                         08826603
088267         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08826703
088269                                                                  08826913
088270         MOVE SPACES                    TO HEAD-REC               08827013
088271         STRING 'SML NUMBER:       '  SUCRDV-BRCDE-NBR            08827113
088272                                           DELIMITED BY SIZE      08827213
088273                                      INTO HEAD-REC               08827313
088274         DISPLAY HEAD-REC                                         08827413
088275         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08827513
088276                                                                  08827613
088279         MOVE SPACES                    TO HEAD-REC               08827903
088280         DISPLAY HEAD-REC                                         08828013
088281         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08828113
088282                                                                  08828213
088283         MOVE SPACES                    TO HEAD-REC               08828313
088284         STRING 'DC LOCAL TMST:    '  PV-SYS-TMST-LOCAL           08828413
088285                                           DELIMITED BY SIZE      08828513
088286                                      INTO HEAD-REC               08828613
088287         DISPLAY HEAD-REC                                         08828713
088288         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08828813
088289                                                                  08828913
088290         MOVE SPACES                    TO HEAD-REC               08829013
088291         STRING 'DC CENTRAL TMST:  '  PV-SYS-TMST-CENTRAL         08829113
088292                                           DELIMITED BY SIZE      08829213
088293                                      INTO HEAD-REC               08829313
088294         DISPLAY HEAD-REC                                         08829413
088295         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08829513
088296                                                                  08829613
088297         MOVE SPACES                    TO HEAD-REC               08829713
088298         DISPLAY HEAD-REC                                         08829813
088299         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08829913
088300                                                                  08830013
088301         MOVE PV-SNGL-LIMIT             TO PV-DISP-LIMIT          08830113
088302         MOVE PV-TMST-DIFF              TO PV-DISP-DIFF           08830213
088303         MOVE SPACES                    TO HEAD-REC               08830313
088304         STRING 'LIMIT: '  PV-DISP-LIMIT                          08830413
088305                '       '                                         08830513
088306                'DELAY: '  PV-DISP-DIFF                           08830613
088307                '    HHMMSS'                                      08830713
088308                                           DELIMITED BY SIZE      08830813
088309                                      INTO HEAD-REC               08830913
088310         DISPLAY HEAD-REC                                         08831013
088320         WRITE ERROR-OUT-RECORD FROM HEAD-REC                     08832003
088400                                                                  08840003
089000     END-IF                                                       08900000
089100     END-IF.                                                      08910000
089200                                                                  08920000
089300     MOVE SPACES                        TO HEAD-REC.              08930000
089310     DISPLAY HEAD-REC.                                            08931000
089320     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08932000
089330                                                                  08933000
089340     MOVE '*****************************************'             08934000
089350                                        TO HEAD-REC.              08935000
089360     DISPLAY HEAD-REC.                                            08936000
089370     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08937000
089380                                                                  08938000
089390     MOVE SPACES                        TO HEAD-REC.              08939000
089400     DISPLAY HEAD-REC.                                            08940000
089500     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        08950000
089600                                                                  08960000
089900                                                                  08990000
090000******************************************************************09000000
090100*  ADD DISPLAY OF OPEN LABOR ASSIGNMENTS TO THE CONVEYOR E-MAIL   09010000
090200*  THIS WILL BE USED TO DETERMINE IF THE DC IS ACTUALLY WORKING   09020000
090300*  ADDED 4/9/13                                                   09030000
090400******************************************************************09040000
090500 2610-DISPLAY-OPEN-ASGMT.                                         09050000
090600                                                                  09060000
090700     EVALUATE TRUE                                                09070000
090800         WHEN DLT00004-WK-TYP-DESC  = 'FLAT        '              09080000
090900              INITIALIZE PV-ASGMT-MSG-FLAT                        09090000
091000              MOVE  PV-ASGMT-COUNT TO PV-MSG-FLAT-CNT             09100000
091100              MOVE  PV-EVENT-SUM   TO PV-MSG-FLAT-SUM             09110000
091200              MOVE PV-ASGMT-MSG-FLAT  TO HEAD-REC                 09120000
091300         WHEN DLT00004-WK-TYP-DESC  = 'SHIP        '              09130000
091400              INITIALIZE PV-ASGMT-MSG-SHIP                        09140000
091500              MOVE  PV-ASGMT-COUNT TO PV-MSG-SHIP-CNT             09150000
091600              MOVE  PV-EVENT-SUM   TO PV-MSG-SHIP-SUM             09160000
091610              MOVE PV-ASGMT-MSG-SHIP  TO HEAD-REC                 09161000
091611         WHEN DLT00004-WK-TYP-DESC  = 'P2L         '              09161100
091612              INITIALIZE PV-ASGMT-MSG-P2L                         09161200
091613              MOVE  PV-ASGMT-COUNT TO PV-MSG-P2L-CNT              09161300
091614              MOVE  PV-EVENT-SUM   TO PV-MSG-P2L-SUM              09161400
091615              MOVE PV-ASGMT-MSG-P2L  TO HEAD-REC                  09161500
091616         WHEN DLT00004-WK-TYP-DESC  = 'RECV        '              09161600
091617              INITIALIZE PV-ASGMT-MSG-RECV                        09161700
091618              MOVE  PV-ASGMT-COUNT TO PV-MSG-RECV-CNT             09161800
091619              MOVE  PV-EVENT-SUM   TO PV-MSG-RECV-SUM             09161900
091620              MOVE PV-ASGMT-MSG-RECV  TO HEAD-REC                 09162000
091630         WHEN DLT00004-WK-TYP-DESC  = 'RLABL       '              09163000
091631              INITIALIZE PV-ASGMT-MSG-RLABL                       09163100
091632              MOVE  PV-ASGMT-COUNT TO PV-MSG-RLABL-CNT            09163200
091633              MOVE  PV-EVENT-SUM   TO PV-MSG-RLABL-SUM            09163300
091634              MOVE PV-ASGMT-MSG-RLABL  TO HEAD-REC                09163400
091635         WHEN DLT00004-WK-TYP-DESC =  'MASTCON     '              09163500
091636              INITIALIZE PV-ASGMT-MSG-MASTCON                     09163600
091637              MOVE  PV-ASGMT-COUNT TO PV-MSG-MAST-CNT             09163700
091638              MOVE  PV-EVENT-SUM   TO PV-MSG-MAST-SUM             09163800
091639              MOVE PV-ASGMT-MSG-MASTCON  TO HEAD-REC              09163900
091640         WHEN OTHER                                               09164000
091650              INITIALIZE PV-ASGMT-MSG-OTHER                       09165000
091651              MOVE DLT00004-WK-TYP-DESC TO PV-MSG-OTHER           09165100
091652              MOVE PV-ASGMT-COUNT TO PV-MSG-OTH-CNT               09165200
091653              MOVE PV-EVENT-SUM   TO PV-MSG-OTH-SUM               09165300
091654              MOVE PV-ASGMT-MSG-OTHER  TO HEAD-REC                09165400
091655     END-EVALUATE.                                                09165500
091656                                                                  09165600
091657     DISPLAY HEAD-REC.                                            09165700
091658     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09165800
091659                                                                  09165900
091660                                                                  09166000
091661******************************************************************09166100
091662*  THIS IS THE PROCESS WHERE WE WILL BE CHECKING BY THE SORTERS   09166200
091663*  AT A FACILITY.  FOR EACH SORTER VENDOR, FETCH THE TIMESTAMP    09166300
091664*  OF THE LAST DIVERT.  IF THIS TIMESTAMP IS LATER THAN THE       09166400
091665*  CALCULATED TIMESTAMP, THIS MEANS THAT WE ARE RECEIVING DIVERTS 09166500
091666*  FROM THE DC.  IF THIS TIMESTAMP IS EARLIER THAN THE CALCULATED 09166600
091667*  TIMESTAMP, THIS MEANS THAT WE HAVE NOT RECEIVED DIVERTS FOR A  09166700
091668*  SPECIFIED PERIOD OF TIME, BASED ON THE CALCULATED TIMESTAMP.   09166800
091669*  ADDITIONAL CHECKING MUST BE DONE TO SEE IF AN ISSUE EXISTS.    09166900
091670*  DMH 8/15/16                                                    09167000
091671******************************************************************09167100
091672 2700-PROCESS-CHECK-BY-SORTER.                                    09167200
091673                                                                  09167300
091674     PERFORM 2710-OPEN-CNVYR-SORTER-CSR.                          09167400
091675                                                                  09167500
091676     PERFORM 2720-FETCH-CNVYR-SORTER-CSR.                         09167600
091677                                                                  09167700
091678     PERFORM 2730-PROCESS-CNVYR-SORTER-CSR                        09167800
091679         UNTIL PS-END-OF-CURSOR.                                  09167900
091680                                                                  09168000
091681     PERFORM 2740-CLOSE-CNVYR-SORTER-CSR.                         09168100
091682                                                                  09168200
091683                                                                  09168300
091684******************************************************************09168400
091685*                                                                 09168500
091686*  DMH 8/15/16                                                    09168600
091687******************************************************************09168700
091688 2710-OPEN-CNVYR-SORTER-CSR.                                      09168800
091689                                                                  09168900
091690     PERFORM                                                      09169000
091700         WITH TEST AFTER                                          09170000
091710         VARYING PV-COUNTER                                       09171000
091711         FROM 1 BY 1                                              09171100
091712         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     09171200
091713                   OR (SQLCODE = ZERO))                           09171300
091714         EXEC SQL                                                 09171400
091715             OPEN  CNVYR-SORTER-CSR                               09171500
091716         END-EXEC                                                 09171600
091717                                                                  09171700
091718         EVALUATE TRUE                                            09171800
091719             WHEN SQLCODE = +0                                    09171900
091720             WHEN SQLCODE = -904                                  09172000
091721             WHEN SQLCODE = -911                                  09172100
091722             WHEN SQLCODE = -913                                  09172200
091723                 CONTINUE                                         09172300
091724             WHEN SQLWARN0 NOT EQUAL SPACE                        09172400
091725             WHEN SQLCODE NOT EQUAL ZERO                          09172500
091726                 MOVE '2710-OPEN-CNVYR-SORTER-CSR'                09172600
091727                                      TO PV-ABEND-PARAGRAPH       09172700
091728                 MOVE 'ERROR OPENING CONVEYOR SORTER CURSOR'      09172800
091729                                      TO PV-ABEND-OPER-MESSAGE-1  09172900
091730                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09173000
091731                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09173100
091732                         PV-OPER-UNT-ID-DISP                      09173200
091733                                         DELIMITED BY SIZE        09173300
091734                                    INTO PV-ABEND-OPER-MESSAGE-2  09173400
091735                 MOVE 'WST_INTGRTN_TYP'                           09173500
091736                                      TO PV-ABEND-TABLE-1         09173600
091737                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         09173700
091738                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         09173800
091739                 PERFORM 9100-SQL-ABEND                           09173900
091740         END-EVALUATE                                             09174000
091741     END-PERFORM.                                                 09174100
091742                                                                  09174200
091743     IF  PV-COUNTER > PC-MAX-RETRIES                              09174300
091744         MOVE '2710-OPEN-CNVYR-SORTER-CSR'                        09174400
091745                                      TO PV-ABEND-PARAGRAPH       09174500
091746         MOVE 'MAX RETRIES ERROR OPENING CONVEYOR SORTER CURSOR'  09174600
091747                                      TO PV-ABEND-OPER-MESSAGE-1  09174700
091748         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09174800
091749         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        09174900
091750                 PV-OPER-UNT-ID-DISP                              09175000
091751                                         DELIMITED BY SIZE        09175100
091752                                    INTO PV-ABEND-OPER-MESSAGE-2  09175200
091753         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         09175300
091754         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         09175400
091755         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         09175500
091756         PERFORM 9100-SQL-ABEND                                   09175600
091757     END-IF.                                                      09175700
091758                                                                  09175800
091759                                                                  09175900
091760******************************************************************09176000
091761*                                                                 09176100
091762*  DMH 8/15/16                                                    09176200
091763******************************************************************09176300
091764 2720-FETCH-CNVYR-SORTER-CSR.                                     09176400
091765                                                                  09176500
091766     EXEC SQL                                                     09176600
091767          FETCH CNVYR-SORTER-CSR                                  09176700
091772           INTO :WST00010-ATTR-ELEM-SEQ-NBR                       09177202
091773              , :PV-DC-NBR                                        09177302
091774              , :PV-SORTER-NAME                                   09177402
091775              , :SUCRDV-OPER-UNT-ID                               09177502
091776              , :PV-MAX-DIVERT-TIMESTAMP                          09177602
091777              , :SUCRDV-BRCDE-NBR                                 09177702
091778              , :SUCRDV-SHIPT-UNT-ID                              09177802
091779              , :SUCRDV-ACTV-CDE                                  09177902
091780              , :SUCRDV-DOOR-ID                                   09178002
091781              , :SUCRDV-DIVERT-SYS-DTE                            09178102
091782              , :SUCRDV-DIVERT-SYS-TM                             09178202
091783              , :PV-SYS-TMST-LOCAL                                09178302
091784              , :PV-SYS-TMST-CENTRAL                              09178402
091785              , :PV-TMST-DIFF                                     09178502
091786     END-EXEC.                                                    09178600
091804                                                                  09180400
091805     EVALUATE TRUE                                                09180500
091806       WHEN SQLCODE = ZERO                                        09180600
091807             DISPLAY '                      '                     09180710
091808             DISPLAY 'SORTER NAME:          ' PV-SORTER-NAME      09180810
091809             DISPLAY 'DC LOCAL DIVERT TMST:   '                   09180910
091810                      PV-SYS-TMST-LOCAL                           09181010
091811             DISPLAY 'DC CENTRAL DVRT TMST:   '                   09181110
091812                      PV-SYS-TMST-CENTRAL                         09181210
091813             DISPLAY 'DATABASE DIVERT TMST:   '                   09181310
091814                      SUCRDV-DIVERT-TMST                          09181410
091815             MOVE PV-TMST-DIFF  TO  PV-DISP-TMST-DIFF             09181510
091816             DISPLAY 'DIFF/DELAY DC/DATABASE: '                   09181610
091817                      PV-DISP-TMST-DIFF                           09181710
091818                     '  HHMMSS'                                   09181810
091819                                                                  09181910
091820             PERFORM 2775-CHECK-SRTR-LIMIT                        09182010
091821                                                                  09182110
091822             IF  PV-TMST-DIFF  >  PV-SRTR-LIMIT                   09182210
091823                 SET PS-ADDITIONAL-CHECK-NEEDED                   09182310
091824                     PS-DELAYED-DIVERTS                           09182431
091825                                 TO TRUE                          09182510
091826             ELSE                                                 09182610
091827                 SET PS-NO-ADDITIONAL-CHECK-NEEDED                09182710
091828                                 TO TRUE                          09182810
091829             END-IF                                               09182910
091838                                                                  09183800
091839       WHEN SQLCODE = +100                                        09183900
091840           SET PS-END-OF-CURSOR      TO TRUE                      09184000
091841       WHEN SQLWARN0 NOT EQUAL SPACE                              09184100
091842       WHEN SQLCODE NOT EQUAL ZERO                                09184200
091843           MOVE '2720-FETCH-CNVYR-SORTER-CSR'                     09184300
091844                                     TO PV-ABEND-PARAGRAPH        09184400
091845           MOVE 'FETCH CONVEYOR SORTER CURSOR ROW'                09184500
091846                                     TO PV-ABEND-OPER-MESSAGE-1   09184600
091847           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09184700
091848           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              09184800
091849                   PV-OPER-UNT-ID-DISP                            09184900
091850                                   DELIMITED BY SIZE              09185000
091851                                   INTO PV-ABEND-OPER-MESSAGE-2   09185100
091852           MOVE 'WST_INTGRTN_TYP'    TO PV-ABEND-TABLE-1          09185200
091853           MOVE 'WST_ATTR_DEFN'      TO PV-ABEND-TABLE-2          09185300
091854           MOVE 'WST_ATTR_ELEM'      TO PV-ABEND-TABLE-3          09185400
091855           MOVE 'TSUCRDV'            TO PV-ABEND-TABLE-4          09185500
091856           PERFORM 9100-SQL-ABEND                                 09185600
091857     END-EVALUATE.                                                09185700
091858                                                                  09185800
091859                                                                  09185900
091860******************************************************************09186000
091861*                                                                 09186100
091862******************************************************************09186200
091863 2730-PROCESS-CNVYR-SORTER-CSR.                                   09186300
091864                                                                  09186400
091865     IF  PS-ADDITIONAL-CHECK-NEEDED                               09186500
091866         PERFORM 2350-FETCH-SEQ-NBR-PARM                          09186600
091867         PERFORM 2400-CHECK-OPEN-ASSIGNMENTS                      09186700
091868         IF  PV-OPEN-ASGMT-COUNT > 0                              09186800
091869             PERFORM 2500-CHECK-CLOSED-ASSIGNMENTS                09186900
091870             IF  PV-CLOSED-ASGMT-COUNT > 0                        09187000
091871                 SET PS-DELAYED-DIVERTS  TO TRUE                  09187118
091872                 PERFORM 2600-SETUP-ERROR-REC                     09187200
091873             ELSE                                                 09187333
091874                 SET  PS-NO-DELAYED-DIVERTS  TO TRUE              09187433
091875             END-IF                                               09187500
091876          ELSE                                                    09187632
091877             SET  PS-NO-DELAYED-DIVERTS  TO TRUE                  09187732
091878         END-IF                                                   09187800
091879     END-IF.                                                      09187900
091880                                                                  09188000
091881     PERFORM 2720-FETCH-CNVYR-SORTER-CSR.                         09188100
091882                                                                  09188200
091883                                                                  09188300
091884******************************************************************09188400
091885*                                                                 09188500
091886******************************************************************09188600
091887 2740-CLOSE-CNVYR-SORTER-CSR.                                     09188700
091888                                                                  09188800
091889     PERFORM                                                      09188900
091890         WITH TEST AFTER                                          09189000
091891         VARYING PV-COUNTER                                       09189100
091892         FROM 1 BY 1                                              09189200
091893         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     09189300
091894                   OR (SQLCODE = ZERO))                           09189400
091895         EXEC SQL                                                 09189500
091896             CLOSE CNVYR-SORTER-CSR                               09189600
091897         END-EXEC                                                 09189700
091898                                                                  09189800
091899         EVALUATE TRUE                                            09189900
091900             WHEN SQLCODE = +0                                    09190000
091901             WHEN SQLCODE = -904                                  09190100
091902             WHEN SQLCODE = -911                                  09190200
091903             WHEN SQLCODE = -913                                  09190300
091904                 CONTINUE                                         09190400
091905             WHEN SQLWARN0 NOT EQUAL SPACE                        09190500
091906             WHEN SQLCODE NOT EQUAL ZERO                          09190600
091907                 MOVE '2740-CLOSE-CNVYR-SORTER-CSR'               09190700
091908                                      TO PV-ABEND-PARAGRAPH       09190800
091909                 MOVE 'ERROR CLOSING CONVEYOR SORTER CURSOR'      09190900
091910                                      TO PV-ABEND-OPER-MESSAGE-1  09191000
091911                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09191100
091912                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09191200
091913                         PV-OPER-UNT-ID-DISP                      09191300
091914                                         DELIMITED BY SIZE        09191400
091915                                    INTO PV-ABEND-OPER-MESSAGE-2  09191500
091916                 MOVE 'WST_INTGRTN_TYP'                           09191600
091917                                      TO PV-ABEND-TABLE-1         09191700
091918                 MOVE 'WST_ATTR_DEFN' TO PV-ABEND-TABLE-2         09191800
091919                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-3         09191900
091920                 PERFORM 9100-SQL-ABEND                           09192000
091921         END-EVALUATE                                             09192100
091922     END-PERFORM.                                                 09192200
091923                                                                  09192300
091924     IF  PV-COUNTER > PC-MAX-RETRIES                              09192400
091925         MOVE '2740-CLOSE-CNVYR-SORTER-CSR'                       09192500
091926                                      TO PV-ABEND-PARAGRAPH       09192600
091927         MOVE 'MAX RETRIES ERROR CLOSING CONVEYOR SORTER CURSOR'  09192700
091928                                      TO PV-ABEND-OPER-MESSAGE-1  09192800
091929         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09192900
091930         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        09193000
091931                 PV-OPER-UNT-ID-DISP                              09193100
091932                                         DELIMITED BY SIZE        09193200
091933                                    INTO PV-ABEND-OPER-MESSAGE-2  09193300
091934         MOVE 'WST_INTGRTN_TYP'       TO PV-ABEND-TABLE-1         09193400
091935         MOVE 'WST_ATTR_DEFN'         TO PV-ABEND-TABLE-2         09193500
091936         MOVE 'WST_ATTR_ELEM'         TO PV-ABEND-TABLE-3         09193600
091937         PERFORM 9100-SQL-ABEND                                   09193700
091938     END-IF.                                                      09193800
091939                                                                  09193900
091940                                                                  09194004
091941******************************************************************09194104
091942*  THIS SELECT IS FOR DC'S THAT CHECK BY CONVEYOR SORTER.  THIS   09194204
091943*  VALUE WILL BE THE ALERT LIMIT.  HOW MUCH DIFFERENCE WILL BE    09194304
091944*  ALLOWED BETWEEN THE TIME THE DC CONVEYOR SENDS THE DIVERT AND  09194404
091945*  WHEN WE RECEIVE IT IN THE DATABASE.                            09194504
091946*                                                                 09194604
091947*  NOTE THIS IS SET UP BY DC, IN CASE THE TIME ON THE CONVEYOR    09194704
091948*  SERVER IS NOT SET UP CORRECTLY                                 09194804
091949*                                                                 09194904
091950*  THIS WILL BE COMPARED WITH PV-TMST-DIFF                        09195004
091951******************************************************************09195104
091952 2775-CHECK-SRTR-LIMIT.                                           09195204
091953                                                                  09195304
091954     MOVE ZEROES  TO  PV-SRTR-LIMIT.                              09195404
091955                                                                  09195504
091956     PERFORM WITH TEST AFTER                                      09195604
091957       VARYING PV-COUNTER FROM 1 BY 1                             09195704
091958         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       09195804
091959                OR                                                09195904
091960                SQLCODE = ZERO)                                   09196004
091961                                                                  09196104
091962         EXEC SQL                                                 09196204
091963              SELECT                                              09196304
091964                      H.ATTR_ELEM_NBR                             09196404
091965                INTO :PV-SRTR-LIMIT                               09196504
091966                FROM  WST_INTGRTN_TYP A                           09196604
091967                    , WST_ATTR_DEFN   B                           09196704
091968                    , WST_ATTR_ELEM   C                           09196804
091969                    , WST_ATTR_ELEM   D                           09196904
091970                    , WST_ATTR_ELEM   E                           09197004
091971                    , WST_ATTR_ELEM   F                           09197104
091972                    , WST_ATTR_ELEM   G                           09197204
091973                    , WST_ATTR_ELEM   H                           09197304
091974                WHERE A.INTGRTN_TYP_CDE   = 'DCSRTRLIMT'          09197404
091975                  AND A.INTGRTN_TYP_CDE   = B.INTGRTN_TYP_CDE     09197504
091976                  AND B.INTGRTN_TYP_CDE   = C.INTGRTN_TYP_CDE     09197604
091977                  AND B.INTGRTN_TYP_CDE   = D.INTGRTN_TYP_CDE     09197704
091978                  AND B.INTGRTN_TYP_CDE   = E.INTGRTN_TYP_CDE     09197804
091979                  AND B.INTGRTN_TYP_CDE   = F.INTGRTN_TYP_CDE     09197904
091980                  AND B.INTGRTN_TYP_CDE   = G.INTGRTN_TYP_CDE     09198004
091981                  AND B.INTGRTN_TYP_CDE   = H.INTGRTN_TYP_CDE     09198104
091982                  AND B.ATTR_DEFN_SEQ_NBR = 1                     09198204
091983                  AND C.ATTR_DEFN_SEQ_NBR = 1                     09198304
091984                  AND D.ATTR_DEFN_SEQ_NBR = 2                     09198404
091985                  AND E.ATTR_DEFN_SEQ_NBR = 3                     09198504
091986                  AND F.ATTR_DEFN_SEQ_NBR = 4                     09198604
091987                  AND G.ATTR_DEFN_SEQ_NBR = 5                     09198704
091988                  AND H.ATTR_DEFN_SEQ_NBR = 6                     09198804
091989                  AND C.ATTR_ELEM_SEQ_NBR = D.ATTR_ELEM_SEQ_NBR   09198904
091990                  AND C.ATTR_ELEM_SEQ_NBR = E.ATTR_ELEM_SEQ_NBR   09199004
091991                  AND C.ATTR_ELEM_SEQ_NBR = F.ATTR_ELEM_SEQ_NBR   09199104
091992                  AND C.ATTR_ELEM_SEQ_NBR = G.ATTR_ELEM_SEQ_NBR   09199204
091993                  AND C.ATTR_ELEM_SEQ_NBR = H.ATTR_ELEM_SEQ_NBR   09199304
091994                                                                  09199404
091995                  AND C.ATTR_ELEM_NBR     = :DK-OPER-UNT-ID       09199504
091996                  AND D.ATTR_ELEM_TXT     = :PV-SORTER-NAME       09199604
091997               WITH UR                                            09199704
091998         END-EXEC                                                 09199804
091999                                                                  09199904
092000         EVALUATE TRUE                                            09200004
092001             WHEN SQLCODE = -904                                  09200104
092002             WHEN SQLCODE = -911                                  09200204
092003                 CONTINUE                                         09200304
092004             WHEN SQLWARN0 NOT = SPACES                           09200404
092005             WHEN SQLCODE < ZERO                                  09200504
092006             WHEN SQLCODE > ZERO                                  09200604
092007                 MOVE '2775-CHECK-SRTR-LIMIT          '           09200704
092008                                 TO PV-ABEND-PARAGRAPH            09200804
092009                 MOVE 'SELECT PARM:  DCSRTRLIMT'                  09200906
092010                                 TO PV-ABEND-OPER-MESSAGE-1       09201004
092011                 MOVE 'WST_ATTR_ELEM' TO PV-ABEND-TABLE-1         09201104
092012                 PERFORM 9100-SQL-ABEND                           09201204
092013             WHEN SQLCODE = ZERO                                  09201304
092014                 MOVE  PV-SRTR-LIMIT                              09201404
092015                                 TO  PV-DISP-LIMIT                09201504
092016                 DISPLAY 'DCSRTRLIMT:' PV-SORTER-NAME             09201604
092017                         '  LIMIT:'    PV-DISP-LIMIT              09201704
092018         END-EVALUATE                                             09201804
092019     END-PERFORM.                                                 09201904
092020                                                                  09202004
092021     IF PV-COUNTER > PC-MAX-RETRIES                               09202104
092022         MOVE '2775-CHECK-SRTR-LIMIT       '                      09202204
092023                                 TO PV-ABEND-PARAGRAPH            09202304
092024         MOVE 'MAX RETRIES EXCEEDED ON FETCH OF DATA FROM TKRPRPM'09202404
092025                                 TO PV-ABEND-OPER-MESSAGE-1       09202504
092026         MOVE 'WST_ATTR_ELEM'    TO PV-ABEND-TABLE-1              09202604
092027         PERFORM 9100-SQL-ABEND                                   09202704
092028     END-IF.                                                      09202804
092029                                                                  09202904
092030                                                                  09203004
092031******************************************************************09203104
092032* PROCESS CURSOR TO DISPLAY ACTIVE ASSIGNMENT INFORMATION ON THE *09203204
092033* ERROR E-MAIL                                                   *09203304
092034* ADDED 4/9/13                                                   *09203404
092035******************************************************************09203504
092036 3000-CHECK-OPEN-ASGMTS.                                          09203604
092037                                                                  09203704
092038     SET  PS-NOT-EOF-ASGMT-CSR  TO  TRUE.                         09203804
092039     PERFORM 3005-OPEN-ASGMT-CSR.                                 09203904
092040                                                                  09204004
092041     MOVE  PV-ASGMT-MSG-1         TO  HEAD-REC.                   09204104
092042     DISPLAY HEAD-REC.                                            09204204
092043     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09204304
092044     MOVE   SPACES                      TO HEAD-REC.              09204404
092045     DISPLAY HEAD-REC.                                            09204504
092046     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09204604
092047                                                                  09204704
092048     PERFORM 3010-FETCH-ASGMT-CSR                                 09204804
092049       UNTIL PS-EOF-ASGMT-CSR.                                    09204904
092050                                                                  09205004
092051     PERFORM 3015-CLOSE-ASGMT-CSR.                                09205104
092052                                                                  09205204
092053     MOVE   SPACES                      TO HEAD-REC.              09205304
092054     DISPLAY HEAD-REC.                                            09205404
092055     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09205504
092056     MOVE '*****************************************'             09205604
092057                                        TO HEAD-REC.              09205704
092058     DISPLAY HEAD-REC.                                            09205804
092059     WRITE ERROR-OUT-RECORD FROM HEAD-REC.                        09205904
092060                                                                  09206004
092061                                                                  09206104
092062******************************************************************09206204
092063* OPEN THE ACTIVE ASSIGNMENT CURSOR                               09206304
092064* ADDED 4/9/13                                                   *09206404
092065******************************************************************09206504
092066 3005-OPEN-ASGMT-CSR.                                             09206604
092067                                                                  09206704
092068     PERFORM WITH TEST AFTER                                      09206804
092069       VARYING PV-COUNTER FROM 1 BY 1                             09206904
092070         UNTIL (PV-COUNTER > PC-MAX-RETRIES OR                    09207004
092071                SQLCODE = ZERO)                                   09207104
092072                                                                  09207204
092073         EXEC SQL                                                 09207304
092074              OPEN LABOR-ASGMT-CSR                                09207404
092075         END-EXEC                                                 09207504
092076                                                                  09207604
092077         EVALUATE TRUE                                            09207704
092078             WHEN SQLCODE = +0                                    09207804
092079             WHEN SQLCODE = -904                                  09207904
092080             WHEN SQLCODE = -911                                  09208004
092081             WHEN SQLCODE = -913                                  09208104
092082                 CONTINUE                                         09208204
092083             WHEN SQLWARN0 NOT EQUAL SPACE                        09208304
092084             WHEN SQLCODE NOT EQUAL ZERO                          09208404
092085                 MOVE '3005-OPEN-ASGMT-CSR'                       09208504
092086                                      TO PV-ABEND-PARAGRAPH       09208604
092087                 MOVE 'ERROR OPENING ASSIGNMENT CURSOR'           09208704
092088                                      TO PV-ABEND-OPER-MESSAGE-1  09208804
092089                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09208904
092090                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09209004
092091                         PV-OPER-UNT-ID-DISP                      09209104
092092                                         DELIMITED BY SIZE        09209204
092093                                   INTO PV-ABEND-OPER-MESSAGE-2   09209304
092094                 MOVE 'DLT_ASGMT'     TO PV-ABEND-TABLE-1         09209404
092095                 PERFORM 9100-SQL-ABEND                           09209504
092096         END-EVALUATE                                             09209604
092097     END-PERFORM.                                                 09209704
092098                                                                  09209804
092099     IF  PV-COUNTER > PC-MAX-RETRIES                              09209904
092100         MOVE '3005-OPEN-ASGMT-CSR'                               09210004
092101                                      TO PV-ABEND-PARAGRAPH       09210104
092102         MOVE 'MAX RETRIES ERROR OPENING ASSIGNMENT CURSOR'       09210204
092103                                      TO PV-ABEND-OPER-MESSAGE-1  09210304
092104         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09210404
092105         STRING 'OPER UNT ID: '  DELIMITED BY SIZE                09210504
092106                 PV-OPER-UNT-ID-DISP                              09210604
092107                                 DELIMITED BY SIZE                09210704
092108                                    INTO PV-ABEND-OPER-MESSAGE-2  09210804
092109         MOVE 'DLT_ASGMT'             TO PV-ABEND-TABLE-1         09210904
092110         PERFORM 9100-SQL-ABEND                                   09211004
092111     END-IF.                                                      09211104
092112                                                                  09211204
092113                                                                  09211304
092114******************************************************************09211404
092115* FETCH A ROW FROM THE OPEN LABOR ASSIGNMENT CURSOR              *09211504
092116* ADDED 4/9/13                                                   *09211604
092117******************************************************************09211704
092118 3010-FETCH-ASGMT-CSR.                                            09211804
092119                                                                  09211904
092120     EXEC SQL                                                     09212004
092121          FETCH LABOR-ASGMT-CSR                                   09212104
092122           INTO :DLT00004-WK-TYP-DESC                             09212204
092123               ,:PV-ASGMT-COUNT                                   09212304
092124               ,:PV-EVENT-SUM                                     09212404
092125     END-EXEC.                                                    09212504
092126                                                                  09212604
092127     EVALUATE TRUE                                                09212704
092128       WHEN SQLCODE = ZERO                                        09212804
092129            PERFORM 2610-DISPLAY-OPEN-ASGMT                       09212904
092130                                                                  09213004
092131       WHEN SQLCODE = +100                                        09213104
092132           SET PS-EOF-ASGMT-CSR      TO TRUE                      09213204
092133       WHEN SQLWARN0 NOT EQUAL SPACE                              09213304
092134       WHEN SQLCODE NOT EQUAL ZERO                                09213404
092135           MOVE '3010-FETCH-ASGMT-CSR'                            09213504
092136                                     TO PV-ABEND-PARAGRAPH        09213604
092137           MOVE 'FETCH OPEN LABOR ASSIGNMENT CSR '                09213704
092138                                     TO PV-ABEND-OPER-MESSAGE-1   09213804
092139           MOVE DK-OPER-UNT-ID       TO PV-OPER-UNT-ID-N          09213904
092140           STRING 'OPER UNT ID: '  DELIMITED BY SIZE              09214004
092141                   PV-OPER-UNT-ID-DISP                            09214104
092142                                   DELIMITED BY SIZE              09214204
092143                                   INTO PV-ABEND-OPER-MESSAGE-2   09214304
092144           MOVE 'DLT_ASGMT'          TO PV-ABEND-TABLE-1          09214404
092145           PERFORM 9100-SQL-ABEND                                 09214504
092146     END-EVALUATE.                                                09214604
092147                                                                  09214704
092148                                                                  09214804
092149******************************************************************09214904
092150* CLOSE THE CONVEYOR VENDOR CURSOR                                09215004
092151* ADDED 4/9/13                                                   *09215104
092152******************************************************************09215204
092153 3015-CLOSE-ASGMT-CSR.                                            09215304
092154                                                                  09215404
092155     PERFORM                                                      09215504
092156         WITH TEST AFTER                                          09215604
092157         VARYING PV-COUNTER                                       09215704
092158         FROM 1 BY 1                                              09215804
092159         UNTIL ((PV-COUNTER > PC-MAX-RETRIES) OR                  09215904
092160                (SQLCODE = ZERO))                                 09216004
092161         EXEC SQL                                                 09216104
092162             CLOSE LABOR-ASGMT-CSR                                09216204
092163         END-EXEC                                                 09216304
092164                                                                  09216404
092165         EVALUATE TRUE                                            09216504
092166             WHEN SQLCODE = +0                                    09216604
092167             WHEN SQLCODE = -904                                  09216704
092168             WHEN SQLCODE = -911                                  09216804
092169             WHEN SQLCODE = -913                                  09216904
092170                 CONTINUE                                         09217004
092171             WHEN SQLWARN0 NOT EQUAL SPACE                        09217104
092172             WHEN SQLCODE NOT EQUAL ZERO                          09217204
092173                 MOVE '3015-CLOSE-ASGMT-CSR'                      09217304
092174                                      TO PV-ABEND-PARAGRAPH       09217404
092175                 MOVE 'ERROR CLOSING ASSIGNMENT CURSOR     '      09217504
092176                                      TO PV-ABEND-OPER-MESSAGE-1  09217604
092177                 MOVE DK-OPER-UNT-ID  TO PV-OPER-UNT-ID-N         09217704
092178                 STRING 'OPER UNT ID: '  DELIMITED BY SIZE        09217804
092179                         PV-OPER-UNT-ID-DISP                      09217904
092180                                         DELIMITED BY SIZE        09218004
092181                                    INTO PV-ABEND-OPER-MESSAGE-2  09218104
092182                 MOVE 'DLT_ASGMT'     TO PV-ABEND-TABLE-1         09218204
092183                 PERFORM 9100-SQL-ABEND                           09218304
092184         END-EVALUATE                                             09218404
092185     END-PERFORM.                                                 09218504
092186                                                                  09218604
092187     IF  PV-COUNTER > PC-MAX-RETRIES                              09218704
092188         MOVE '3015-CLOSE-ASGMT-CSR'                              09218804
092189                                      TO PV-ABEND-PARAGRAPH       09218904
092190         MOVE 'MAX RETRIES ERROR CLOSING LABOR ASSIGNMENT CURSOR' 09219004
092191                                      TO PV-ABEND-OPER-MESSAGE-1  09219104
092192         MOVE DK-OPER-UNT-ID          TO PV-OPER-UNT-ID-N         09219204
092193         STRING 'OPER UNT ID: '          DELIMITED BY SIZE        09219304
092194                 PV-OPER-UNT-ID-DISP                              09219404
092195                                         DELIMITED BY SIZE        09219504
092196                                    INTO PV-ABEND-OPER-MESSAGE-2  09219604
092197         MOVE 'DLT_ASGMT'             TO PV-ABEND-TABLE-1         09219704
092198         MOVE 'TSUCRDV'               TO PV-ABEND-TABLE-4         09219804
092199         PERFORM 9100-SQL-ABEND                                   09219904
092200     END-IF.                                                      09220004
092201                                                                  09220104
092202                                                                  09220204
092203******************************************************************09220304
092204*  READ THE CONVEYOR CONTROL RECORD                               09220404
092205******************************************************************09220504
092206 7000-READ-CNVYR-CNTL-REC.                                        09220604
092207     READ SU-CNVYR-CNTL-FILE                                      09220704
092208         INTO SU096-DATE-CONTROL-REC                              09220804
092209             AT END                                               09220904
092210                 SET PS-EOF-CNTL-FILE TO TRUE.                    09221004
092211                                                                  09221104
092212         DISPLAY '* * * * * * * * * * * * * * * * * * * * * *'.   09221204
092213         DISPLAY '* FROM INPUT FILE                          '.   09221314
092214         DISPLAY '* END TIMESTAMP - ' SU096-CURR-TMST.            09221414
092217         DISPLAY '*                                          '.   09221714
092218                                                                  09221808
092219                                                                  09221908
092220******************************************************************09222008
092230*  PERFORMS THE ABEND FOR THE PROGRAM IN THE EVENT THAT AN SQL    09223008
092300*  ERROR OR WARNING CODE OCCURS.                                  09230000
092400******************************************************************09240000
092410 9100-SQL-ABEND.                                                  09241000
092500     MOVE SQLCODE    TO PV-SQLCODE.                               09250000
092600     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       09260000
092700                                                                  09270000
092800     DISPLAY '9100-SQL-ABEND'.                                    09280000
092900     DISPLAY '** ABEND              **'.                          09290000
093000     DISPLAY '** SQLCODE            ** = ' PV-DISPLAY-SQLCODE.    09300000
093100     DISPLAY '** PROGRAM            ** = ' PC-CURRENT-PROGRAM-NAME09310000
093200     DISPLAY '** PARAGRAPH          ** = ' PV-ABEND-PARAGRAPH.    09320000
093300     DISPLAY '** TABLE(S) AFFECTED  ** = ' PV-ABEND-TABLE-1.      09330000
093400     DISPLAY '**                    ** = ' PV-ABEND-TABLE-2.      09340000
093500     DISPLAY '**                    ** = ' PV-ABEND-TABLE-3.      09350000
093600     DISPLAY '**                    ** = ' PV-ABEND-TABLE-4.      09360000
093700     DISPLAY '** OPERATION          ** = ' PV-ABEND-OPER-MESSAGE-109370000
093800     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-209380000
093900     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-309390000
094000     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-409400000
094100     DISPLAY '**                    ** = '                        09410000
094200                                                                  09420000
094300******************************************************************09430000
094400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    09440000
094500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         09450000
094600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     09460000
094700* FORMAT.                                                         09470000
094800******************************************************************09480000
094900     COPY DPPD004.                                                09490000
095000                                                                  09500000
095100     MOVE +4013                  TO ABEND-CODE.                   09510000
095200     CALL 'ILBOABN0' USING ABEND-CODE.                            09520000
