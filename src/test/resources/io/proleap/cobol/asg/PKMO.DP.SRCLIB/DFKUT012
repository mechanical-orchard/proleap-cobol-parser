000100 IDENTIFICATION DIVISION.                                         00010002
000200                                                                  00020002
000300 PROGRAM-ID.      DFKUT012.                                       00030002
000400 AUTHOR.          STEVEN NOWAK.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    06/15/09.                                       00060000
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*          DAILY FLASH TABLE ROLL OF DFT_DLY_FLSH_SUM             00100010
001100******************************************************************00110000
001200* THIS PROGRAM WRITES OUT THE DATA THAT WILL BE USED TO ROLL      00120010
001300* THE DATA IN THE DFT_DLY_FLSH_SUM TABLE FORWARD TO THE NEXT DAY  00130010
001400*                                                                 00140000
001500*========================== CHANGE LOG ===========================00150000
001600*  AUTH      BY        DATE                 DESCRIPTION           00160000
001700*=================================================================00170000
001800* WR36718  S. NOWAK   06-15-09   CREATE PROGRAM                   00180010
001900*                                                                 00190000
002000******************************************************************00200000
002100                                                                  00210000
002200 ENVIRONMENT DIVISION.                                            00220000
002300 CONFIGURATION SECTION.                                           00230000
002400                                                                  00240000
002500 SOURCE-COMPUTER.        IBM-3090.                                00250000
002600 OBJECT-COMPUTER.        IBM-3090.                                00260000
002700                                                                  00270000
002800 INPUT-OUTPUT SECTION.                                            00280000
002900 FILE-CONTROL.                                                    00290000
003000                                                                  00300000
003100     SELECT DATE-CONTROL-FILE ASSIGN TO INP01.                    00310000
003200     SELECT FLASH-FILE        ASSIGN TO OUT01.                    00320001
003300                                                                  00330000
003400 DATA DIVISION.                                                   00340000
003500 FILE SECTION.                                                    00350000
003600                                                                  00360000
003700 FD  DATE-CONTROL-FILE                                            00370000
003800     RECORDING MODE F                                             00380000
003900     BLOCK CONTAINS 0 RECORDS                                     00390000
004000     LABEL RECORDS ARE OMITTED.                                   00400000
004100                                                                  00410000
004200 01  DATE-CONTROL-RECORD           PIC  X(80).                    00420001
004300                                                                  00430000
004400 FD  FLASH-FILE                                                   00440001
004500     RECORDING MODE IS F                                          00450001
004600     BLOCK CONTAINS 0 RECORDS                                     00460001
004700     LABEL RECORDS ARE STANDARD.                                  00470001
004800                                                                  00480001
004900 01  FLASH-REC                     PIC  X(82).                    00490001
005000                                                                  00500001
005100                                                                  00510000
005200******************************************************************00520000
005300*                       WORKING STORAGE                           00530000
005400******************************************************************00540000
005500 WORKING-STORAGE SECTION.                                         00550000
005600                                                                  00560000
005700 01  W-START                       PIC  X(50)    VALUE            00570001
005800     ' *** WORKING STORAGE STARTS HERE FOR DFKUT012 *** '.        00580000
005900                                                                  00590000
006000******************************************************************00600000
006100*                          SWITCHES                               00610000
006200******************************************************************00620000
006300 01  PS-PROGRAM-SWITCHES.                                         00630000
006400     05  PS-END-OF-TABLE-SW        PIC  X(01)    VALUE 'N'.       00640001
006500         88  PS-END-OF-TABLE                     VALUE 'Y'.       00650001
006600                                                                  00660000
006700******************************************************************00670000
006800*                         CONSTANTS                               00680000
006900******************************************************************00690000
007000 01 PC-CONSTANTS.                                                 00700000
007100     05  PC-PGM-NAME               PIC  X(08)    VALUE 'DFKUT012'.00710001
007200     05  PC-ROW-NOT-FOUND          PIC S9(04)    VALUE +100       00720001
007300                                                 COMP SYNC.       00730001
007400     05  PC-ROW-FOUND              PIC S9(04)    VALUE +0         00740001
007500                                                 COMP SYNC.       00750000
007600                                                                  00760000
007700******************************************************************00770000
007800*                      ACCUMULATORS                               00780000
007900******************************************************************00790000
008000 01  PA-ACCULATORS.                                               00800000
008100     05  PA-WRITTEN                PIC  9(07)    VALUE ZERO.      00810001
008200                                                                  00820000
008300******************************************************************00830000
008400*                       VARIABLES                                 00840000
008500******************************************************************00850000
008600 01  PV-PROGRAM-VARIABLES.                                        00860000
008700     05  PV-SQL                    PIC S9(04)    VALUE ZEROS.     00870001
008800     05  PV-PARAGRAPH-NAME         PIC  X(30)    VALUE SPACES.    00880001
008900     05  PV-DB2-TABLE-NAME         PIC  X(12)    VALUE SPACES.    00890001
009000     05  PV-DB2-OPERATION          PIC  X(60)    VALUE SPACES.    00900001
009100     05  PV-OPERATION-MSG-1        PIC  X(40)    VALUE SPACES.    00910001
009200                                                                  00920000
009300     05  PV-INCREMENTING-DATE      PIC  X(10)    VALUE SPACES.    00930001
009400                                                                  00940000
009500******************************************************************00950000
009600*                      WORK AREA                                  00960000
009700******************************************************************00970000
009800 01  WS-WORK-AREA.                                                00980000
009900     05  PV-CONTROL-DATE.                                         00990000
010000         10  PV-CNTL-CC            PIC  X(02)    VALUE '20'.      01000001
010100         10  PV-CNTL-YY            PIC  X(02)    VALUE SPACES.    01010001
010200         10  PV-CNTL-MM            PIC  X(02)    VALUE SPACES.    01020001
010300         10  PV-CNTL-DD            PIC  X(02)    VALUE SPACES.    01030001
010400                                                                  01040000
010500     05  PV-CONTROL-DATE-FMT.                                     01050000
010600         10 PV-CNTL-DATE-CC        PIC  9(02)    VALUE 20.        01060001
010700         10 PV-CNTL-DATE-YY        PIC  9(02)    VALUE ZEROES.    01070001
010800         10 FILLER                 PIC  X(01)    VALUE '-'.       01080001
010900         10 PV-CNTL-DATE-MM        PIC  9(02)    VALUE ZEROES.    01090001
011000         10 FILLER                 PIC  X(01)    VALUE '-'.       01100001
011100         10 PV-CNTL-DATE-DD        PIC  9(02)    VALUE ZEROES.    01110001
011200                                                                  01120000
011300     05  PV-FMT-DTE                PIC  X(10)    VALUE SPACES.    01130001
011400     05  PV-CUR-WTD-BEG-DATE       PIC  X(10)    VALUE SPACES.    01140001
011500     05  PV-CUR-WTD-END-DATE       PIC  X(10)    VALUE SPACES.    01150001
011600     05  PV-CUR-MTD-BEG-DATE       PIC  X(10)    VALUE SPACES.    01160001
011700     05  PV-CUR-MTD-END-DATE       PIC  X(10)    VALUE SPACES.    01170001
011800     05  PV-CUR-QTD-BEG-DATE       PIC  X(10)    VALUE SPACES.    01180001
011900     05  PV-CUR-QTD-END-DATE       PIC  X(10)    VALUE SPACES.    01190001
012000     05  PV-CUR-STD-BEG-DATE       PIC  X(10)    VALUE SPACES.    01200001
012100     05  PV-CUR-STD-END-DATE       PIC  X(10)    VALUE SPACES.    01210001
012200     05  PV-CUR-YTD-BEG-DTE        PIC  X(10)    VALUE SPACES.    01220001
012300     05  PV-CUR-YTD-END-DTE        PIC  X(10)    VALUE SPACES.    01230001
012400                                                                  01240000
012500******************************************************************01250000
012600*                      CONTROL CARD                               01260000
012700******************************************************************01270000
012800 01 CD-CONTROL-DATE.                                              01280000
012900     05  FILLER                    PIC  X(14)    VALUE SPACES.    01290001
013000     05  CD-POS-DATE-MDY           PIC  X(06)    VALUE SPACES.    01300001
013100     05  FILLER REDEFINES CD-POS-DATE-MDY.                        01310001
013200         10  CD-POS-MONTH          PIC  X(02).                    01320001
013300         10  CD-POS-DAY            PIC  X(02).                    01330001
013400         10  CD-POS-YEAR           PIC  X(02).                    01340001
013500     05  FILLER                    PIC  X(60).                    01350001
013600                                                                  01360000
013700******************************************************************01370000
013800*               SYSTEM TIME AND DATE VARIABLES                    01380000
013900******************************************************************01390000
014000 01  SYS-DATE-TIME.                                               01400000
014100     05  SYS-DATE                  PIC  X(08)    VALUE SPACES.    01410001
014200     05  SYS-TIME                  PIC  X(08)    VALUE SPACES.    01420001
014300                                                                  01430000
014400 01  ST-BEG-TIME.                                                 01440000
014500     05  ST-BEG-HR                 PIC  9(02)    VALUE ZEROS.     01450001
014600     05  FILLER                    PIC  X(01)    VALUE ':'.       01460001
014700     05  ST-BEG-MN                 PIC  9(02)    VALUE ZEROS.     01470001
014800                                                                  01480000
014900 01  ST-END-TIME.                                                 01490000
015000     05  ST-END-HR                 PIC  9(02)    VALUE ZEROS.     01500001
015100     05  FILLER                    PIC  X(01)    VALUE ':'.       01510001
015200     05  ST-END-MN                 PIC  9(02)    VALUE ZEROS.     01520001
015300                                                                  01530000
015400 01  SD-EDIT-DATE.                                                01540000
015500     05  SD-MONTH                  PIC  9(02)    VALUE ZEROS.     01550001
015600     05  FILLER                    PIC  X(01)    VALUE '-'.       01560001
015700     05  SD-DAY                    PIC  9(02)    VALUE ZEROS.     01570001
015800     05  FILLER                    PIC  X(01)    VALUE '-'.       01580001
015900     05  SD-CENT                   PIC  9(02)    VALUE ZEROS.     01590001
016000     05  SD-YEAR                   PIC  9(02)    VALUE ZEROS.     01600001
016100                                                                  01610000
016200******************************************************************01620000
016300*                        ERROR HANDLING                           01630000
016400******************************************************************01640000
016500 01  ABEND-CODE                    PIC S9(04)    VALUE ZEROS      01650001
016600                                                 COMP SYNC.       01660001
016700     88  ABEND-4002-READ-ERROR                   VALUE +4002.     01670001
016800     88  ABEND-4003-CTRL-CARD-ERROR              VALUE +4003.     01680001
016900     88  ABEND-4005-OPEN-ERROR                   VALUE +4005.     01690001
017000     88  ABEND-4006-CLOSE-ERROR                  VALUE +4006.     01700001
017100     88  ABEND-4013-DB2-ERROR                    VALUE +4013.     01710001
017200                                                                  01720000
017300                                                                  01730000
017400******************************************************************01740001
017500* DAILY FLASH SUMMARY RECORD                                      01750003
017600******************************************************************01760001
017700     COPY DFRD008.                                                01770001
017800                                                                  01780001
017900******************************************************************01790000
018000* DATE CALCULATION ROUTINE RECORD LAYOUT                          01800000
018100******************************************************************01810000
018200     COPY DPWS500.                                                01820000
018300                                                                  01830000
018400***************************************************************** 01840000
018500*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            01850000
018600***************************************************************** 01860000
018700     COPY DPWS004.                                                01870000
018800                                                                  01880000
018900******************************************************************01890000
019000*  DB2 MESSAGE AREA                                               01900000
019100******************************************************************01910000
019200     COPY SQLCA2.                                                 01920000
019300                                                                  01930000
019400******************************************************************01940000
019500*  DB2 COMMUNICATION AREA                                         01950000
019600******************************************************************01960000
019700     EXEC SQL                                                     01970000
019800        INCLUDE SQLCA                                             01980000
019900     END-EXEC.                                                    01990000
020000                                                                  02000000
020100******************************************************************02010000
020200* DCLGEN FOR THE DAILY FLASH SUMMARY TABLE.                       02020000
020300******************************************************************02030000
020400     EXEC SQL                                                     02040000
020500        INCLUDE DFT00000                                          02050000
020600     END-EXEC.                                                    02060000
020700                                                                  02070000
020800******************************************************************02080000
020900* DCLGEN FOR THE XST LOCATION TABLE.                              02090000
021000******************************************************************02100000
021100     EXEC SQL                                                     02110000
021200        INCLUDE XST00001                                          02120000
021300     END-EXEC.                                                    02130000
021400                                                                  02140000
021500                                                                  02150000
021600******************************************************************02160000
021700*  DFT TABLE CURSOR  DB2 SELECT  (MAIN CURSOR)                    02170000
021800******************************************************************02180000
021900     EXEC SQL                                                     02190000
022000       DECLARE DFT-TABLE-CURSOR CURSOR WITH HOLD FOR              02200000
022100            SELECT SLS_DTE                                        02210000
022200                  ,STR_NBR                                        02220000
022300                  ,DEPT_NBR                                       02230000
022400                  ,AMT_CLSN_CDE                                   02240000
022500                  ,DLY_DOL_AMT                                    02250000
022600                  ,WTD_DOL_AMT                                    02260000
022700                  ,MTD_DOL_AMT                                    02270000
022800                  ,QTD_DOL_AMT                                    02280000
022900                  ,S_T_D_DOL_AMT                                  02290000
023000                  ,YTD_DOL_AMT                                    02300000
023100                  ,DLY_ITM_QTY                                    02310000
023200                  ,WTD_ITM_QTY                                    02320000
023300                  ,MTD_ITM_QTY                                    02330000
023400                  ,QTD_ITM_QTY                                    02340000
023500                  ,S_T_D_ITM_QTY                                  02350000
023600                  ,YTD_ITM_QTY                                    02360000
023700        FROM DFT_DLY_FLSH_SUM DFT                                 02370000
023800        WHERE DFT.SLS_DTE = :PV-FMT-DTE                           02380000
023900        WITH UR                                                   02390000
024000     END-EXEC.                                                    02400000
024100                                                                  02410000
024200                                                                  02420000
024300                                                                  02430000
024400 PROCEDURE DIVISION.                                              02440000
024500******************************************************************02450000
024600* MAINLINE                                                        02460000
024700******************************************************************02470000
024800 0000-MAINLINE.                                                   02480000
024900                                                                  02490000
025000     PERFORM 1000-INITIALIZATION.                                 02500000
025100                                                                  02510000
025200     PERFORM 2000-PROCESS-TABLE                                   02520000
025300       UNTIL PS-END-OF-TABLE.                                     02530000
025400                                                                  02540000
025500     PERFORM 9900-END-PROC.                                       02550000
025600                                                                  02560000
025700     GOBACK.                                                      02570000
025800                                                                  02580000
025900                                                                  02590000
026000******************************************************************02600000
026100* PROCESSES THE DATE CONTROL CARD AND OPEN FILES                  02610000
026200******************************************************************02620000
026300 1000-INITIALIZATION.                                             02630000
026400                                                                  02640000
026500     OPEN INPUT  DATE-CONTROL-FILE.                               02650001
026600     OPEN OUTPUT FLASH-FILE.                                      02660001
026700                                                                  02670000
026800     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 02680000
026900                                                                  02690000
027000     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            02700000
027100     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            02710000
027200                                                                  02720000
027300     MOVE SYS-DATE (1:2) TO SD-CENT.                              02730000
027400     MOVE SYS-DATE (3:2) TO SD-YEAR.                              02740000
027500     MOVE SYS-DATE (5:2) TO SD-MONTH.                             02750000
027600     MOVE SYS-DATE (7:2) TO SD-DAY.                               02760000
027700                                                                  02770000
027800     PERFORM 1100-PROCESS-CONTROL-DATE.                           02780000
027900     PERFORM 1200-VALIDATE-CONTROL-DATE.                          02790000
028000     PERFORM 1300-INCREMENT-DATE.                                 02800000
028100                                                                  02810000
028200     PERFORM 5000-OPEN-DFT-TABLE-CURSOR.                          02820000
028300     PERFORM 5100-FETCH-DFT-TABLE-CURSOR.                         02830000
028400                                                                  02840000
028500                                                                  02850000
028600******************************************************************02860000
028700* OPEN THE DATE CONTROL FILE, AND SAVE OFF THE VALUE IN WORKING   02870000
028800* STORAGE.                                                        02880000
028900******************************************************************02890000
029000 1100-PROCESS-CONTROL-DATE.                                       02900000
029100                                                                  02910000
029200     READ DATE-CONTROL-FILE                                       02920000
029300       AT END                                                     02930000
029400         MOVE '1100-PROCESS-CONTROL-DATE'  TO PV-PARAGRAPH-NAME   02940000
029500         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  02950000
029600                                                                  02960000
029700         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   02970000
029800                                                                  02980000
029900         PERFORM 9100-ABEND                                       02990000
030000     END-READ.                                                    03000000
030100                                                                  03010000
030200     MOVE DATE-CONTROL-RECORD TO CD-CONTROL-DATE.                 03020000
030300                                                                  03030000
030400     CLOSE DATE-CONTROL-FILE.                                     03040000
030500                                                                  03050000
030600     MOVE CD-POS-YEAR      TO PV-CNTL-YY                          03060000
030700                              PV-CNTL-DATE-YY.                    03070000
030800     MOVE CD-POS-MONTH     TO PV-CNTL-MM                          03080000
030900                              PV-CNTL-DATE-MM.                    03090000
031000     MOVE CD-POS-DAY       TO PV-CNTL-DD                          03100000
031100                              PV-CNTL-DATE-DD.                    03110000
031200                                                                  03120000
031300     MOVE PV-CONTROL-DATE-FMT TO PV-FMT-DTE.                      03130000
031400                                                                  03140000
031500                                                                  03150000
031600******************************************************************03160000
031700* ENSURE THAT THE CONTROL DATE MARKS THE BEGINNING OF A FISCAL    03170000
031800* PERIOD WEEK.                                                    03180000
031900******************************************************************03190000
032000 1200-VALIDATE-CONTROL-DATE.                                      03200000
032100                                                                  03210000
032200     INITIALIZE DPG51 DPG52 DPG53                                 03220000
032300                DPG54 DPG55 DPG56.                                03230000
032400                                                                  03240000
032500     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      03250000
032600                                                                  03260000
032700     MOVE PV-CONTROL-DATE      TO DPG52-DB2-ISO-DATE.             03270000
032800     SET DPG52-LK-DTE-ISO      TO TRUE.                           03280000
032900                                                                  03290000
033000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03300000
033100                                             DPG54 DPG55 DPG56.   03310000
033200                                                                  03320000
033300     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  03330000
033400         DISPLAY '           '                                    03340000
033500         DISPLAY '** ABEND **'                                    03350000
033600         DISPLAY '   DATE = ' PV-CONTROL-DATE                     03360000
033700         DISPLAY '   ERR  = ' DPG54-ERROR-MESSAGE                 03370000
033800                                                                  03380000
033900         MOVE '1200-VALIDATE-CONTROL-DATE' TO PV-PARAGRAPH-NAME   03390000
034000         MOVE 'INVALID CONTROL CARD DATE ' TO PV-OPERATION-MSG-1  03400000
034100                                                                  03410000
034200         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   03420000
034300                                                                  03430000
034400         PERFORM 9100-ABEND                                       03440000
034500     END-IF.                                                      03450000
034600                                                                  03460000
034700     MOVE DPG55-1ST-WKDY-DB2ISO-FMT  TO PV-CUR-WTD-BEG-DATE       03470000
034800     MOVE DPG55-LAST-WKDY-DB2ISO-FMT TO PV-CUR-WTD-END-DATE.      03480000
034900     MOVE DPG56-FIRST-FP-DB2-ISO-FMT TO PV-CUR-MTD-BEG-DATE.      03490000
035000     MOVE DPG56-LAST-FP-DB2-ISO-FMT  TO PV-CUR-MTD-END-DATE.      03500000
035100     MOVE DPG56-FIRST-FQ-DB2-ISO-FMT TO PV-CUR-QTD-BEG-DATE       03510000
035200     MOVE DPG56-LAST-FQ-DB2-ISO-FMT  TO PV-CUR-QTD-END-DATE.      03520000
035300     MOVE DPG56-FIRST-FS-DB2-ISO-FMT TO PV-CUR-STD-BEG-DATE       03530000
035400     MOVE DPG56-LAST-FS-DB2-ISO-FMT  TO PV-CUR-STD-END-DATE.      03540000
035500     MOVE DPG56-FIRST-FD-DB2-ISO-FMT TO PV-CUR-YTD-BEG-DTE.       03550000
035600     MOVE DPG56-LAST-FD-DB2-ISO-FMT  TO PV-CUR-YTD-END-DTE.       03560000
035700                                                                  03570000
035800                                                                  03580000
035900******************************************************************03590000
036000* THIS PARAGRAPH INCREMENTS THE DATE BY ONE AND SELECTS ALL OF    03600000
036100* THE FISCAL GROUPINGS ASSOCIATED WITH IT.                        03610000
036200******************************************************************03620000
036300 1300-INCREMENT-DATE.                                             03630000
036400                                                                  03640000
036500     INITIALIZE DPG51 DPG52 DPG53                                 03650000
036600                DPG54 DPG55 DPG56.                                03660000
036700                                                                  03670000
036800     SET DPG51-FISCAL-454-CALENDAR  TO TRUE.                      03680000
036900     SET DPG51-INCREMENT-DATE       TO TRUE.                      03690000
037000     MOVE 1                         TO DPG51-INCR-DECR-DAYS-9     03700000
037100     SET DPG52-LK-DTE-ISO-FMT       TO TRUE.                      03710000
037200                                                                  03720000
037300     MOVE PV-CONTROL-DATE-FMT TO DPG52-DB2-ISO-DATE-FMT.          03730000
037400                                                                  03740000
037500     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    03750000
037600                                             DPG54 DPG55 DPG56.   03760000
037700                                                                  03770000
037800     IF DPG54-SEVERE-ERROR OR DPG54-DATE-INVALID                  03780000
037900         DISPLAY '           '                                    03790000
038000         DISPLAY '** ABEND **'                                    03800000
038100         DISPLAY '   DATE = ' PV-CONTROL-DATE                     03810002
038200         DISPLAY '   ERR  = ' DPG54-ERROR-MESSAGE                 03820000
038300                                                                  03830000
038400                                                                  03840000
038500         MOVE '1300-INCREMENT-DATE'        TO PV-PARAGRAPH-NAME   03850000
038600         MOVE 'ERROR ON INCREMENT OF DATE' TO PV-OPERATION-MSG-1  03860000
038700                                                                  03870000
038800         SET ABEND-4003-CTRL-CARD-ERROR TO TRUE                   03880000
038900                                                                  03890000
039000         PERFORM 9100-ABEND                                       03900000
039100     END-IF.                                                      03910000
039200                                                                  03920000
039300     MOVE DPG55-DB2-ISO-DATE-FMT TO PV-INCREMENTING-DATE.         03930000
039400                                                                  03940000
039500                                                                  03950000
039600******************************************************************03960000
039700* PROCESSES THE DFT TABLE                                         03970000
039800******************************************************************03980000
039900 2000-PROCESS-TABLE.                                              03990000
040000                                                                  04000000
040100     PERFORM 3000-PREPR-INSRT-TABLE.                              04010000
040200     PERFORM 4000-INSRT-DFT-TABLE.                                04020000
040300                                                                  04030000
040400     PERFORM 5100-FETCH-DFT-TABLE-CURSOR.                         04040000
040500                                                                  04050000
040600                                                                  04060000
040700******************************************************************04070000
040800* THIS SECTION SETS UP THE FIELDS TO BE UPDATED IN THE DFT TABLE  04080000
040900******************************************************************04090000
041000 3000-PREPR-INSRT-TABLE.                                          04100000
041100                                                                  04110000
041200     MOVE ZEROES TO DFT00000-DLY-DOL-AMT.                         04120000
041300     MOVE ZEROES TO DFT00000-DLY-ITM-QTY.                         04130000
041400                                                                  04140000
041500     MOVE PV-INCREMENTING-DATE TO DFT00000-SLS-DTE.               04150000
041600                                                                  04160000
041700** HISTORY NOT IN SAME FISCAL WEEK AS DATE IN PROCESS             04170000
041800        IF  DFT00000-SLS-DTE <= PV-CUR-WTD-BEG-DATE               04180000
041900              OR > PV-CUR-WTD-END-DATE                            04190000
042000                                                                  04200000
042100           MOVE ZEROES  TO DFT00000-WTD-DOL-AMT                   04210000
042200           MOVE ZEROES  TO DFT00000-WTD-ITM-QTY                   04220000
042300        END-IF                                                    04230000
042400                                                                  04240000
042500** HISTORY NOT IN SAME FISCAL MONTH AS DATE IN PROCESS            04250000
042600        IF  DFT00000-SLS-DTE <= PV-CUR-MTD-BEG-DATE               04260000
042700              OR > PV-CUR-MTD-END-DATE                            04270000
042800                                                                  04280000
042900           MOVE ZEROES  TO DFT00000-MTD-DOL-AMT                   04290000
043000           MOVE ZEROES  TO DFT00000-MTD-ITM-QTY                   04300000
043100        END-IF                                                    04310000
043200                                                                  04320000
043300** HISTORY NOT IN SAME FISCAL QUARTER AS DATE IN PROCESS          04330000
043400        IF  DFT00000-SLS-DTE <= PV-CUR-QTD-BEG-DATE               04340000
043500              OR > PV-CUR-QTD-END-DATE                            04350000
043600                                                                  04360000
043700           MOVE ZEROES  TO DFT00000-QTD-DOL-AMT                   04370000
043800           MOVE ZEROES  TO DFT00000-QTD-ITM-QTY                   04380000
043900        END-IF                                                    04390000
044000                                                                  04400000
044100** HISTORY NOT IN SAME FISCAL SEASON AS DATE IN PROCESS           04410000
044200        IF  DFT00000-SLS-DTE <= PV-CUR-STD-BEG-DATE               04420000
044300              OR > PV-CUR-STD-END-DATE                            04430000
044400                                                                  04440000
044500           MOVE ZEROES  TO DFT00000-S-T-D-DOL-AMT                 04450000
044600           MOVE ZEROES  TO DFT00000-S-T-D-ITM-QTY                 04460000
044700        END-IF                                                    04470000
044800                                                                  04480000
044900** HISTORY NOT IN SAME FISCAL YEAR AS DATE IN PROCESS             04490000
045000        IF  DFT00000-SLS-DTE <= PV-CUR-YTD-BEG-DTE                04500000
045100              OR > PV-CUR-YTD-END-DTE                             04510000
045200                                                                  04520000
045300           MOVE ZEROES  TO DFT00000-YTD-DOL-AMT                   04530000
045400           MOVE ZEROES  TO DFT00000-YTD-ITM-QTY                   04540000
045500        END-IF.                                                   04550000
045600                                                                  04560000
045700                                                                  04570000
045800******************************************************************04580000
045900* THIS SECTION WILL INSERT A ROW INTO THE DFT TABLE               04590000
046000******************************************************************04600000
046100 4000-INSRT-DFT-TABLE.                                            04610000
046200                                                                  04620000
046300     MOVE DFT00000-SLS-DTE       TO DF008-SLS-DTE.                04630000
046400     MOVE DFT00000-STR-NBR       TO DF008-STR-NBR.                04640000
046500     MOVE DFT00000-DEPT-NBR      TO DF008-DEPT-NBR.               04650000
046600     MOVE DFT00000-AMT-CLSN-CDE  TO DF008-AMT-CLSN-CDE.           04660000
046700                                                                  04670004
046800     IF  DFT00000-DLY-DOL-AMT NUMERIC                             04680004
046900         MOVE DFT00000-DLY-DOL-AMT   TO DF008-DLY-DOL-AMT         04690004
047000     ELSE                                                         04700004
047100         MOVE ZEROS                  TO DF008-DLY-DOL-AMT         04710004
047200     END-IF.                                                      04720004
047300     IF  DFT00000-WTD-DOL-AMT NUMERIC                             04730004
047400         MOVE DFT00000-WTD-DOL-AMT   TO DF008-WTD-DOL-AMT         04740004
047500     ELSE                                                         04750004
047600         MOVE ZEROS                  TO DF008-WTD-DOL-AMT         04760004
047700     END-IF.                                                      04770004
047800     IF  DFT00000-MTD-DOL-AMT NUMERIC                             04780004
047900         MOVE DFT00000-MTD-DOL-AMT   TO DF008-MTD-DOL-AMT         04790004
048000     ELSE                                                         04800004
048100         MOVE ZEROS                  TO DF008-MTD-DOL-AMT         04810004
048200     END-IF.                                                      04820004
048300     IF  DFT00000-QTD-DOL-AMT NUMERIC                             04830004
048400         MOVE DFT00000-QTD-DOL-AMT   TO DF008-QTD-DOL-AMT         04840004
048500     ELSE                                                         04850004
048600         MOVE ZEROS                  TO DF008-QTD-DOL-AMT         04860004
048700     END-IF.                                                      04870004
048800     IF  DFT00000-S-T-D-DOL-AMT NUMERIC                           04880004
048900         MOVE DFT00000-S-T-D-DOL-AMT TO DF008-S-T-D-DOL-AMT       04890004
049000     ELSE                                                         04900004
049100         MOVE ZEROS                  TO DF008-S-T-D-DOL-AMT       04910004
049200     END-IF.                                                      04920004
049300     IF  DFT00000-YTD-DOL-AMT NUMERIC                             04930004
049400         MOVE DFT00000-YTD-DOL-AMT   TO DF008-YTD-DOL-AMT         04940004
049500     ELSE                                                         04950004
049600         MOVE ZEROS                  TO DF008-YTD-DOL-AMT         04960004
049700     END-IF.                                                      04970004
049800                                                                  04980004
049900     MOVE DFT00000-DLY-ITM-QTY   TO DF008-DLY-ITM-QTY.            04990004
050000     MOVE DFT00000-WTD-ITM-QTY   TO DF008-WTD-ITM-QTY.            05000004
050100     MOVE DFT00000-MTD-ITM-QTY   TO DF008-MTD-ITM-QTY.            05010004
050200     MOVE DFT00000-QTD-ITM-QTY   TO DF008-QTD-ITM-QTY.            05020004
050300     MOVE DFT00000-S-T-D-ITM-QTY TO DF008-S-T-D-ITM-QTY.          05030004
050400     MOVE DFT00000-YTD-ITM-QTY   TO DF008-YTD-ITM-QTY.            05040004
050500                                                                  05050000
050600                                                                  05060004
050700     WRITE FLASH-REC FROM DF008-DFT-REC.                          05070001
050800                                                                  05080000
050900     ADD 1 TO PA-WRITTEN.                                         05090001
051000                                                                  05100000
051100                                                                  05110000
051200******************************************************************05120000
051300* OPEN DFT_DLY_FLSH_SUM CURSOR                                    05130000
051400******************************************************************05140000
051500 5000-OPEN-DFT-TABLE-CURSOR.                                      05150000
051600                                                                  05160000
051700     EXEC SQL                                                     05170000
051800          OPEN DFT-TABLE-CURSOR                                   05180000
051900     END-EXEC.                                                    05190000
052000                                                                  05200000
052100     EVALUATE TRUE                                                05210000
052200         WHEN SQLCODE = ZERO                                      05220000
052300            CONTINUE                                              05230000
052400                                                                  05240000
052500         WHEN SQLWARN0 NOT EQUAL SPACE                            05250000
052600         WHEN SQLCODE NOT EQUAL ZERO                              05260000
052700            MOVE SQLCODE TO PV-SQL                                05270000
052800                                                                  05280000
052900            MOVE '5000-OPEN-DFT-TABLE-CURSOR' TO PV-PARAGRAPH-NAME05290000
053000            MOVE 'DFT_DLY_FLSH_SUM'           TO PV-DB2-TABLE-NAME05300000
053100                                                                  05310000
053200            STRING 'ERROR ON OPEN OF DFT-TBL-CURSOR - SQLCODE = ' 05320000
053300                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    05330000
053400            END-STRING                                            05340000
053500                                                                  05350000
053600            SET ABEND-4005-OPEN-ERROR TO TRUE                     05360000
053700            PERFORM 9200-SQL-ABEND                                05370000
053800     END-EVALUATE.                                                05380000
053900                                                                  05390000
054000                                                                  05400000
054100******************************************************************05410000
054200* FETCH THE DFT TABLE RECORD.                                     05420000
054300******************************************************************05430000
054400 5100-FETCH-DFT-TABLE-CURSOR.                                     05440000
054500                                                                  05450000
054600     EXEC SQL                                                     05460000
054700         FETCH DFT-TABLE-CURSOR                                   05470000
054800          INTO   :DFT00000-SLS-DTE,                               05480000
054900                 :DFT00000-STR-NBR,                               05490000
055000                 :DFT00000-DEPT-NBR,                              05500000
055100                 :DFT00000-AMT-CLSN-CDE,                          05510000
055200                 :DFT00000-DLY-DOL-AMT,                           05520000
055300                 :DFT00000-WTD-DOL-AMT,                           05530000
055400                 :DFT00000-MTD-DOL-AMT,                           05540000
055500                 :DFT00000-QTD-DOL-AMT,                           05550000
055600                 :DFT00000-S-T-D-DOL-AMT,                         05560000
055700                 :DFT00000-YTD-DOL-AMT,                           05570000
055800                 :DFT00000-DLY-ITM-QTY,                           05580000
055900                 :DFT00000-WTD-ITM-QTY,                           05590000
056000                 :DFT00000-MTD-ITM-QTY,                           05600000
056100                 :DFT00000-QTD-ITM-QTY,                           05610000
056200                 :DFT00000-S-T-D-ITM-QTY,                         05620000
056300                 :DFT00000-YTD-ITM-QTY                            05630000
056400     END-EXEC.                                                    05640000
056500                                                                  05650000
056600     EVALUATE TRUE                                                05660000
056700         WHEN SQLCODE = PC-ROW-FOUND                              05670000
056800             MOVE 'N' TO PS-END-OF-TABLE-SW                       05680000
056900                                                                  05690000
057000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          05700000
057100             MOVE 'Y' TO PS-END-OF-TABLE-SW                       05710000
057200                                                                  05720000
057300         WHEN SQLWARN0 NOT EQUAL SPACE                            05730000
057400         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      05740000
057500            MOVE SQLCODE TO PV-SQL                                05750000
057600                                                                  05760000
057700            MOVE '5100-FETCH-PROMO-TABLE-CURSOR'                  05770000
057800                                        TO PV-PARAGRAPH-NAME      05780000
057900            MOVE 'DFT_DLY_FLSH_SUM'     TO PV-DB2-TABLE-NAME      05790000
058000                                                                  05800000
058100            STRING 'ERROR ON FETCH OF DFT-TBL-CURSOR - SQLCODE = '05810000
058200                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    05820000
058300            END-STRING                                            05830000
058400                                                                  05840000
058500            SET ABEND-4002-READ-ERROR TO TRUE                     05850000
058600                                                                  05860000
058700            PERFORM 9200-SQL-ABEND                                05870000
058800     END-EVALUATE.                                                05880000
058900                                                                  05890000
059000                                                                  05900000
059100******************************************************************05910000
059200* 5200-CLOSE-DFT-TABLE-CURSOR                                     05920000
059300******************************************************************05930000
059400 5200-CLOSE-DFT-TABLE-CURSOR.                                     05940000
059500                                                                  05950000
059600     EXEC SQL                                                     05960000
059700          CLOSE DFT-TABLE-CURSOR                                  05970000
059800     END-EXEC.                                                    05980000
059900                                                                  05990000
060000     EVALUATE TRUE                                                06000000
060100         WHEN SQLCODE = PC-ROW-FOUND                              06010000
060200              CONTINUE                                            06020000
060300                                                                  06030000
060400         WHEN SQLWARN0 NOT EQUAL SPACE                            06040000
060500         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      06050000
060600            MOVE SQLCODE TO PV-SQL                                06060000
060700                                                                  06070000
060800            MOVE '5200-CLOSE-DFT-TABLE-CURSOR'                    06080000
060900                                          TO PV-PARAGRAPH-NAME    06090000
061000            MOVE 'DFT_DLY_FLSH_SUM'       TO PV-DB2-TABLE-NAME    06100000
061100                                                                  06110000
061200            STRING 'ERROR ON CLOSE OF DFT-TBL-CURSOR - SQLCODE = '06120000
061300                PV-SQL DELIMITED BY SIZE INTO PV-DB2-OPERATION    06130000
061400            END-STRING                                            06140000
061500                                                                  06150000
061600            SET ABEND-4006-CLOSE-ERROR TO TRUE                    06160000
061700            PERFORM 9200-SQL-ABEND                                06170000
061800     END-EVALUATE.                                                06180000
061900                                                                  06190000
062000                                                                  06200000
062100******************************************************************06210000
062200*  ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                     06220000
062300******************************************************************06230000
062400 9100-ABEND.                                                      06240000
062500                                                                  06250000
062600     PERFORM 9900-END-PROC.                                       06260000
062700                                                                  06270000
062800     DISPLAY '** ABEND           **'.                             06280000
062900     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              06290001
063000     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        06300000
063100     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       06310000
063200                                                                  06320000
063300     CALL 'ILBOABN0' USING ABEND-CODE.                            06330000
063400                                                                  06340000
063500                                                                  06350000
063600***************************************************************** 06360000
063700* ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    06370000
063800***************************************************************** 06380000
063900 9200-SQL-ABEND.                                                  06390000
064000                                                                  06400000
064100     MOVE SQLCODE    TO SQLCODE2.                                 06410000
064200     MOVE SQLERRD(3) TO SQLERRD3.                                 06420000
064300                                                                  06430000
064400     DISPLAY '** ABEND           ** = SQLABEND'.                  06440000
064500     DISPLAY '** PROGRAM         ** = ' PC-PGM-NAME.              06450001
064600     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        06460000
064700     DISPLAY '** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.        06470000
064800     DISPLAY '** OPERATION       ** = ' PV-DB2-OPERATION.         06480000
064900     DISPLAY '** SQLCODE         ** = ' SQLCODE2.                 06490000
065000     DISPLAY '** ROWS PROCESSED  ** = ' SQLERRD3.                 06500000
065100     DISPLAY '** SQLERRM         ** = ' SQLERRM.                  06510000
065200     DISPLAY '** SQLERRMC        ** = ' SQLERRMC.                 06520000
065300                                                                  06530000
065400***************************************************************** 06540000
065500*  THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   06550000
065600*  MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        06560000
065700* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     06570000
065800*  FORMAT.                                                        06580000
065900***************************************************************** 06590000
066000     COPY DPPD004.                                                06600000
066100                                                                  06610000
066200     CALL 'ILBOABN0' USING ABEND-CODE.                            06620000
066300                                                                  06630000
066400                                                                  06640000
066500******************************************************************06650000
066600* PREFORMS TASK TERMINATION PROCESSING                            06660000
066700******************************************************************06670000
066800 9900-END-PROC.                                                   06680000
066900                                                                  06690000
067000     PERFORM 5200-CLOSE-DFT-TABLE-CURSOR.                         06700000
067100                                                                  06710000
067200     CLOSE FLASH-FILE.                                            06720001
067300                                                                  06730000
067400     PERFORM 9999-CONTROLS.                                       06740000
067500                                                                  06750000
067600                                                                  06760000
067700******************************************************************06770000
067800* DISPLAY CONTROLS FROM THE PROGRAM                               06780000
067900******************************************************************06790000
068000 9999-CONTROLS.                                                   06800000
068100                                                                  06810000
068200     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 06820000
068300                                                                  06830000
068400     MOVE SYS-TIME (1:2) TO ST-END-HR.                            06840000
068500     MOVE SYS-TIME (3:2) TO ST-END-MN.                            06850000
068600                                                                  06860000
068700     DISPLAY '                    '.                              06870000
068800     DISPLAY '**********************'.                            06880000
068900     DISPLAY '   SAKUT060 CONTROLS  '.                            06890000
069000     DISPLAY '**********************'.                            06900000
069100     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         06910000
069200     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          06920000
069300     DISPLAY 'END TIME  = ' ST-END-TIME.                          06930000
069400     DISPLAY '======================'.                            06940000
069500     DISPLAY 'CONTROL DATE= ' CD-POS-DATE-MDY.                    06950000
069600     DISPLAY '              '.                                    06960001
069700     DISPLAY 'INFORMATION FROM CONTROL CARD DATE: '.              06970000
069800     DISPLAY 'FIRST WEEK = '     PV-CUR-WTD-BEG-DATE.             06980000
069900     DISPLAY 'LAST WEEK = '      PV-CUR-WTD-END-DATE.             06990000
070000     DISPLAY '            '.                                      07000000
070100     DISPLAY 'FIRST MTH DATE = ' PV-CUR-MTD-BEG-DATE.             07010000
070200     DISPLAY 'LAST  MTH DATE = ' PV-CUR-MTD-END-DATE.             07020000
070300     DISPLAY '            '.                                      07030000
070400     DISPLAY 'FIRST QTR DATE = ' PV-CUR-QTD-BEG-DATE.             07040000
070500     DISPLAY 'LAST  QTR DATE = ' PV-CUR-QTD-END-DATE.             07050000
070600     DISPLAY '            '.                                      07060000
070700     DISPLAY 'FIRST SEASON = '   PV-CUR-STD-BEG-DATE.             07070000
070800     DISPLAY 'LAST SEASON = '    PV-CUR-STD-END-DATE.             07080000
070900     DISPLAY '            ' .                                     07090000
071000     DISPLAY 'FIRST YEAR = '     PV-CUR-YTD-BEG-DTE.              07100000
071100     DISPLAY 'LAST YEAR = '      PV-CUR-YTD-END-DTE.              07110000
071200     DISPLAY '            '.                                      07120000
071300     DISPLAY 'DATE TO BE INCREMENTED = '                          07130000
071400                               PV-CONTROL-DATE-FMT.               07140000
071500     DISPLAY 'UPDATED DATE           = '                          07150001
071600                               PV-INCREMENTING-DATE.              07160001
071700     DISPLAY '                         '.                         07170001
071800     DISPLAY 'RECS WRITTEN = ' PA-WRITTEN.                        07180001
071900                                                                  07190000
072000                                                                  07200000
