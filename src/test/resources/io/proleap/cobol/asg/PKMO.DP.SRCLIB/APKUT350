000100 IDENTIFICATION DIVISION.                                         00010002
000200 PROGRAM-ID.      APKUT350.                                       00020002
000300 AUTHOR.          KRYSTEN LEROY.                                  00030002
000400 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040002
000500 DATE-WRITTEN.    NOVEMBER 2009.                                  00050002
000600*----------------------------------------------------------------*00060002
000700*   CREATE ADJUSTMENT DETAILS FROM SPREADSHEET UPLOAD FILES      *00070002
000800*----------------------------------------------------------------*00080002
000900*                  COBOL390 WITH DB2 SQL                         *00090002
001000*----------------------------------------------------------------*00100002
001100* THIS PROGRAM READS AN INPUT FILE FROM AN EXCEL TEMPLATE AND    *00110099
001200* PERFORMS DATA REFORMATTING TO CREATE ADJUSTMENT RECORDS IN THE *00120099
001300* APRD045 LAYOUT.  AN OFFSETTING RECORD IS CREATED WHEN DICTATED *00130099
001400* EITHER BY THE USER OR THE TRNCDE TABLE.                        *00140099
001500* ERRORS ARE NOT WRITTEN TO THE ADJUSTMENT OUTPUT FILE (APRD045),*00150099
001510* WHILE EXPECTIONS (I.E. WARNINGS) ARE WRITTEN TO THE FILE.      *00151099
001513* BOTH ERRORS AND WARNINGS WILL BE INCLUDED IN THE ERROR/        *00151399
001520* EXCEPTION OUTPUT FILE (APRD122).  THIS FILE WILL BE USED BY    *00152099
001521* THE APKRP351 PROGRAM TO CREATE AN ERROR/EXCPTION REPORT.       *00152199
001530*----------------------------------------------------------------*00153002
001550* DB2 TABLES:                                                    *00155002
001560*  1. ACCOUNTS PAYABLE CONTROL TABLE            (TAPCNTL)        *00156002
001570*  2. EXTERNAL ENTITY TABLE                     (TEXTENT)        *00157002
001580*  3. ENTITY NAME TABLE                         (TENTNME)        *00158002
001581*  4. ACCOUNTS PAYABLE TRANSACTION CODE TABLE   (TTRNCDE)        *00158102
001590*                                                                *00159002
001600* INPUT FILE:                                                    *00160002
001700*  1. ADJUSTMENT UPLOAD RECORDS                 (APRD121)        *00170002
001800*                                                                *00180002
001900* OUTPUT FILES:                                                  *00190002
002000*  1. ADJUSTMENT DETAIL RECORDS                 (APRD045)        *00200002
002100*  2. ERROR/EXPEPTION RECORDS                   (APRD122)        *00210002
002200*----------------------------------------------------------------*00220002
002300* CHANGE LOG:                                                    *00230002
002400*                                                                *00240002
002410* DATE  10/25/2010                                               *00241099
002420*     CHANGE MADE: INITIAL IMPLEMENTATION.                       *00242002
002424*     MADE BY: KRYSTEN LEROY           WR/IR #: WR35892          *00242402
002425*                                                                *00242599
002426* DATE  01/25/2011                                               *00242699
002427*     CHANGE MADE: MODIFIED PARAGRAPH C350-FORMAT-OFFSET-RECORD  *00242799
002428*     TO MOVE ZERO TO THE RETAIL AMOUNT WHEN THE TRAN TYPE IS    *00242899
002429*     EXPENSE, BUT CONTINUE TO CALCULATE THE AMOUNT OTHERWISE.   *00242999
002430*     MADE BY: NANCY EILBES            WR/IR #: PKE000000006194  *00243099
002433*                                                                *00243399
002434* DATE  03/04/2014                                               *00243499
002435*     CHANGE MADE: ADDED THREE FIELDS PO #, NET COST AND         *00243599
002436*                  NET RETAIL TO THE REPORT.                     *00243699
002437*  MADE BY: SHEBENA (COGNIZANT)        WR/IR#: CHG0077514        *00243799
002438*                                                                *00243899
002439* DATE  11/20/2015                                               *00243999
002440*     CHANGE MADE: MODIFIED PARAGRAPH C650-VALIDATE-INPUT-FIELDS *00244099
002441*     TO CHECK THE AP121-OFFSET-CDE FOR VALID VALUES. REJECT THE *00244199
002442*     TRANSACTION AND REPORT IF THE VALUE IS NOT VALID.          *00244299
002443*     MADE BY: NANCY EILBES            WR/IR #: CHG0128938       *00244399
002444* DATE  05/17/2016                                                00244499
002445*     CHANGE MADE: SET AP045-DOC-HLD BASED ON AP121-DOC-HLD-IND  *00244599
002446*     MADE BY: NEHA BAGRODIA           WR/IR #: CHG0135353       *00244699
002444* DATE  03/16/2022                                                00244799
002445*     CHANGE MADE: REMOVE LEADING BLANKS FROM DOCUMENT NUMBER    *00244899
002446*     MADE BY: JEAN KURK               WR/IR #: CHG0267713       *00244999
002447******************************************************************00245099
002448                                                                  00245199
002449 ENVIRONMENT DIVISION.                                            00245299
002450 INPUT-OUTPUT SECTION.                                            00245399
002460 FILE-CONTROL.                                                    00246099
002470     SELECT ADJUST-UPLOAD-FILE     ASSIGN TO INP01.               00247099
002480     SELECT ADJUST-DTL-FILE        ASSIGN TO OUT01.               00248099
002490     SELECT ERROR-EXCPT-FILE       ASSIGN TO OUT02.               00249099
002500                                                                  00250099
002600 DATA DIVISION.                                                   00260099
002700 FILE SECTION.                                                    00270099
002800                                                                  00280099
002900 FD  ADJUST-UPLOAD-FILE                                           00290099
003200     LABEL RECORDS ARE STANDARD                                   00320002
003210     RECORDING MODE IS F                                          00321003
003220     RECORD CONTAINS 307 CHARACTERS                               00322099
003300     BLOCK CONTAINS 0 RECORDS.                                    00330003
003600 01  ADJUST-UPLOAD-RECORD       PIC X(307).                       00360099
003700                                                                  00370002
003800 FD  ADJUST-DTL-FILE                                              00380003
003810     LABEL RECORDS ARE STANDARD                                   00381003
003900     RECORDING MODE F                                             00390002
004100     BLOCK CONTAINS 0 RECORDS.                                    00410003
004200 01  ADJUST-DTL-RECORD          PIC X(500).                       00420003
004300                                                                  00430002
004310 FD  ERROR-EXCPT-FILE                                             00431003
004320     LABEL RECORDS ARE STANDARD                                   00432003
004330     RECORDING MODE F                                             00433003
004340     BLOCK CONTAINS 0 RECORDS.                                    00434003
004350 01  ERROR-EXCPT-RECORD         PIC X(154).                       00435099
004400                                                                  00440002
004500 WORKING-STORAGE SECTION.                                         00450002
004510*----------------------------------------------------------------*00451003
004600* SQLCA FORMATTED MESSAGE AREA                                   *00460003
004610*----------------------------------------------------------------*00461003
004620     COPY DPWS004.                                                00462003
004630                                                                  00463003
004640*----------------------------------------------------------------*00464003
004650* RECORD LAYOUT FOR INPUT ADJUSTMENT UPLOAD FILES                *00465003
004660*----------------------------------------------------------------*00466003
004670     COPY APRD121.                                                00467003
004680                                                                  00468003
004690*----------------------------------------------------------------*00469003
004691* RECORD LAYOUT FOR OUTPUT ADJUSTMENT DETAIL FILE                *00469103
004692*----------------------------------------------------------------*00469203
004693     COPY APRD045.                                                00469303
004694                                                                  00469403
004695*----------------------------------------------------------------*00469503
004696* RECORD LAYOUT FOR OUTPUT ERROR/EXCEPTION FILE                  *00469634
004697*----------------------------------------------------------------*00469703
004698     COPY APRD122.                                                00469803
004699                                                                  00469903
004700*----------------------------------------------------------------*00470003
004701*  WORKING STORAGE AREA FOR DPKUP151                             *00470103
004702*----------------------------------------------------------------*00470203
004703     COPY APWS151.                                                00470303
004704                                                                  00470403
004710*----------------------------------------------------------------*00471003
004800* COMMUNICATIONS AREA FOR DB2                                    *00480003
004810*----------------------------------------------------------------*00481003
004820     COPY SQLCA2.                                                 00482003
004830                                                                  00483003
004900 01  PROGRAM-CONSTANTS.                                           00490003
005000     05  PC-RECD-TYP-CDE            PIC X(01)    VALUE '2'.       00500003
005100     05  PC-ENTR-TME                PIC X(16)                     00510003
005200         VALUE '-17.00.00.000000'.                                00520003
005300     05  PC-ORGN-CDE                PIC X(01)    VALUE 'A'.       00530003
005310     05  PC-BTCH-SEQ-NBR            PIC X(02)    VALUE '00'.      00531003
005330     05  PC-OFFSET-STR-NBR          PIC 9(05)    VALUE 90.        00533018
005340     05  PC-ZERO-DOC-NBR            PIC X(16)                     00534098
005350         VALUE '0000000000000000'.                                00535098
005361     05  PC-VNDR-FIELD              PIC X(06)    VALUE 'VENDOR'.  00536134
005362     05  PC-INACTIVE                PIC X(17)                     00536283
005363         VALUE 'VALUE IS INACTIVE'.                               00536383
005364     05  PC-NOT-FOUND-MSG           PIC X(09)                     00536434
005365         VALUE 'NOT FOUND'.                                       00536534
005370     05  PC-VALUES-NOT-EQUAL-MSG    PIC X(46)                     00537034
005380         VALUE 'TRNCDE TBL VALUE NOT EQUAL TO INPUT FILE VALUE'.  00538034
005390     05  PC-NOT-NUMERIC-MSG         PIC X(26)                     00539099
005391         VALUE 'INPUT VALUE IS NOT NUMERIC'.                      00539199
005392     05  PC-INVALID-VALUE-MSG       PIC X(45)                     00539299
005393         VALUE 'INPUT VALUE IS NOT ONE OF THE ACCEPTED VALUES'.   00539399
005400                                                                  00540002
005410 01  WS-CALL-DPKUP151                PIC X(08) VALUE 'DPKUP151'.  00541099
005500 01  PV-PROGRAM-VARIABLES.                                        00550002
005510     05  PV-PREV-TRNCDE              PIC X(02)  VALUE SPACES.     00551022
005520     05  PV-PREV-VND-NBR             PIC X(09)  VALUE SPACES.     00552022
005530     05  PV-PREV-DOC-NBR             PIC X(16)  VALUE SPACES.     00553022
005540     05  PV-PREV-DOC-DTE             PIC X(10)  VALUE SPACES.     00554022
005550     05  PV-PREV-PO-NBR              PIC X(09)  VALUE SPACES.     00555022
005560     05  PV-PREV-DEPT-NBR            PIC X(03)  VALUE SPACES.     00556022
005570     05  PV-PREV-ACCT-NBR            PIC X(06)  VALUE SPACES.     00557022
005572     05  PV-ORIG-PSTG-TYP-CDE        PIC X(02)  VALUE SPACES.     00557222
005573     05  PV-ORIG-TRN-TYP-CDE         PIC X(03)  VALUE SPACES.     00557322
005574     05  PV-ORIG-BTCH-SRC-CDE        PIC X(03)  VALUE SPACES.     00557422
005575     05  PV-ORIG-OFFST-TRN-CDE       PIC X(02)  VALUE SPACES.     00557599
005576     05  PV-ORIG-GL-ACCT-NBR         PIC X(06)  VALUE SPACES.     00557622
005577     05  PV-ORIG-OFFSET-CDE          PIC X(01)  VALUE SPACES.     00557799
005578         88  PV-BYPASS-OFFSET                   VALUE 'B'.        00557899
005579         88  PV-EVALUATE-OFFSET                 VALUE 'E'.        00557999
005580     05  PV-HOLD-OFFST-TRNCDE        PIC X(02)  VALUE SPACES.     00558099
005581     05  PV-CTL-GRO-COST-AMT      PIC S9(11)V99 COMP-3 VALUE +0.  00558199
005590     05  PV-CTL-RETL-AMT          PIC S9(11)V99 COMP-3 VALUE +0.  00559013
005600     05  PV-CTL-FRGT-AMT          PIC S9(11)V99 COMP-3 VALUE +0.  00560010
005700     05  PV-CTL-MISC-CHRG-AMT     PIC S9(11)V99 COMP-3 VALUE +0.  00570010
005800     05  PV-CTL-NET-COST-AMT      PIC S9(11)V99 COMP-3 VALUE +0.  00580010
005900     05  PV-CTL-TERM-DISC-AMT     PIC S9(11)V99 COMP-3 VALUE +0.  00590010
006000     05  PV-VND-NBR-9                PIC 9(09)  VALUE ZEROS.      00600099
006100     05  PV-PO-NBR-9                 PIC 9(09)  VALUE ZEROS.      00610099
006200     05  PV-DEPT-NBR-9               PIC 9(03)  VALUE ZEROS.      00620099
006210     05  PV-ACCT-NBR-9               PIC 9(06)  VALUE ZEROS.      00621099
006220     05  PV-STR-NBR-9                PIC 9(05)  VALUE ZEROS.      00622099
006230     05  PV-CL-NBR-9                 PIC 9(02)  VALUE ZEROS.      00623099
006240     05  PV-SKU-NBR-9                PIC 9(08)  VALUE ZEROS.      00624099
006241     05  PV-BEFORE-DECIMAL           PIC X(09).                   00624199
006242     05  PV-AFTER-DECIMAL            PIC X(02).                   00624299
006243     05  PV-NUMBER-W-DECIMAL         PIC X(12).                   00624399
006271     05  PV-GRO-COST-AMT-N           PIC -(09).99.                00627199
006272     05  PV-GRO-COST-AMT-X REDEFINES PV-GRO-COST-AMT-N.           00627299
006273         10  PV-GRO-COST-AMT         PIC X(12).                   00627399
006274     05  PV-RETL-AMT-N               PIC -(09).99.                00627499
006275     05  PV-RETL-AMT-X REDEFINES PV-RETL-AMT-N.                   00627599
006276         10  PV-RETL-AMT             PIC X(12).                   00627699
006280     05  PV-FRGT-AMT-N               PIC -(09).99.                00628099
006281     05  PV-FRGT-AMT-X REDEFINES PV-FRGT-AMT-N.                   00628199
006282         10  PV-FRGT-AMT            PIC X(12).                    00628299
006286     05  PV-MISC-CHRG-AMT-N         PIC -(09).99.                 00628699
006287     05  PV-MISC-CHRG-AMT-X REDEFINES PV-MISC-CHRG-AMT-N.         00628799
006288         10  PV-MISC-CHRG-AMT       PIC X(12).                    00628899
006292     05  PV-DISC-AMT-N              PIC -(09).99.                 00629299
006293     05  PV-DISC-AMT-X REDEFINES PV-DISC-AMT-N.                   00629399
006294         10  PV-DISC-AMT            PIC X(12).                    00629499
006298     05  PV-NET-COST-AMT-N          PIC -(09).99.                 00629899
006299     05  PV-NET-COST-AMT-X REDEFINES PV-NET-COST-AMT-N.           00629999
006300         10  PV-NET-COST-AMT        PIC X(12).                    00630099
006301     05  PV-VALIDATE-OFFSET-CDE     PIC X.                        00630199
006302         88  PV-OFFSET-CDE-VALID        VALUES 'B', 'D', 'S'.     00630299
006301     05  PV-DOC-NBR                 PIC X(16).                    00630399
006301     05  PV-START                   PIC 9(05).                    00630499
006301     05  PV-LENGTH                  PIC 9(05).                    00630599
006310                                                                  00631099
006400 01  PROGRAM-COUNTERS.                                            00640002
006410     05  PC-REC-READ-CNT              PIC 9(09)  VALUE ZERO.      00641005
006420     05  PC-REC-EXCPT-CNT             PIC 9(09)  VALUE ZERO.      00642009
006430     05  PC-REC-WRTTN-CNT             PIC 9(09)  VALUE ZERO.      00643009
007100                                                                  00710002
007200 01  PROGRAM-SWITCHES.                                            00720003
007300     05  PS-ADJUST-UPLOAD-EOF-SW       PIC X(01)  VALUE 'N'.      00730003
007400         88 ADJUST-UPLOAD-EOF                     VALUE 'Y'.      00740009
007410         88 ADJUST-UPLOAD-NOT-EOF                 VALUE 'N'.      00741009
007411     05  PS-TRNCDE-FOUND-SW            PIC X(01)  VALUE 'N'.      00741106
007412         88 PS-TRNCDE-FOUND                       VALUE 'Y'.      00741206
007413         88 PS-TRNCDE-NOT-FOUND                   VALUE 'N'.      00741306
007414     05  PS-VENDOR-FOUND-SW            PIC X(01)  VALUE 'N'.      00741406
007415         88 PS-VENDOR-FOUND                       VALUE 'Y'.      00741506
007416         88 PS-VENDOR-NOT-FOUND                   VALUE 'N'.      00741606
007423     05  PS-WS151-DOC-NBR-FOUND-SW     PIC X(01)  VALUE 'N'.      00742310
007424         88 PS-WS151-DOC-NBR-FOUND                VALUE 'Y'.      00742410
007425         88 PS-WS151-DOC-NBR-NOT-FOUND            VALUE 'N'.      00742510
007426     05  PS-OFFSET-TRNCDE-FOUND-SW     PIC X(01)  VALUE 'N'.      00742620
007427         88 PS-OFFSET-TRNCDE-FOUND                VALUE 'Y'.      00742720
007430         88 PS-OFFSET-TRNCDE-NOT-FOUND            VALUE 'N'.      00743020
007431     05  PS-OFFSET-SW                  PIC X(01)  VALUE 'N'.      00743130
007432         88 PS-BYPASS-OFFSET                      VALUE 'B'.      00743230
007433         88 PS-CREATE-OFFSET                      VALUE 'C'.      00743330
007434         88 PS-REJECT-OFFSET                      VALUE 'R'.      00743437
007438     05  PS-OFFSET-ACCT-SW             PIC X(01)  VALUE 'N'.      00743830
007439         88 PS-USE-TRNCDE-ACCT                    VALUE 'T'.      00743930
007440         88 PS-USE-OFFSET-ACCT                    VALUE 'O'.      00744030
007441     05  PS-REJECT-SW                  PIC X(01)  VALUE 'N'.      00744165
007442         88 PS-REJECT                             VALUE 'Y'.      00744265
007443         88 PS-NO-REJECT                          VALUE 'N'.      00744366
007444     05  PS-VALID-DATA-SW              PIC X(01)  VALUE 'Y'.      00744499
007445         88 PS-VALID-DATA                         VALUE 'Y'.      00744599
007446         88 PS-INVALID-DATA                       VALUE 'N'.      00744699
007447     05  PS-VALID-AMT-SW               PIC X(01)  VALUE 'N'.      00744799
007448         88 PS-VALID-AMT                          VALUE 'Y'.      00744899
007449         88 PS-INVALID-AMT                        VALUE 'N'.      00744999
007450     05  PS-FIRST-REC-FORMAT-SW        PIC X(01)  VALUE 'N'.      00745099
007451         88 PS-FIRST-REC-FORMAT                   VALUE 'Y'.      00745199
007452         88 PS-FIRST-REC-NOT-FORMAT               VALUE 'N'.      00745299
007453     05  PS-GRO-COST-AMT-SW            PIC X(01)  VALUE 'N'.      00745399
007460         88 PS-GRO-COST-AMT-ZEROS                 VALUE 'Y'.      00746099
007470         88 PS-GRO-COST-AMT-NOT-ZEROS             VALUE 'N'.      00747099
007480     05  PS-RETL-AMT-SW                PIC X(01)  VALUE 'N'.      00748099
007490         88 PS-RETL-AMT-ZEROS                     VALUE 'Y'.      00749099
007491         88 PS-RETL-AMT-NOT-ZEROS                 VALUE 'N'.      00749199
007492     05  PS-FRGT-AMT-SW                PIC X(01)  VALUE 'N'.      00749299
007493         88 PS-FRGT-AMT-ZEROS                     VALUE 'Y'.      00749399
007494         88 PS-FRGT-AMT-NOT-ZEROS                 VALUE 'N'.      00749499
007495     05  PS-MISC-CHRG-AMT-SW           PIC X(01)  VALUE 'N'.      00749599
007496         88 PS-MISC-CHRG-AMT-ZEROS                VALUE 'Y'.      00749699
007497         88 PS-MISC-CHRG-AMT-NOT-ZEROS            VALUE 'N'.      00749799
007498     05  PS-DISC-AMT-SW                PIC X(01)  VALUE 'N'.      00749899
007499         88 PS-DISC-AMT-ZEROS                     VALUE 'Y'.      00749999
007500         88 PS-DISC-AMT-NOT-ZEROS                 VALUE 'N'.      00750099
007501     05  PS-NET-COST-AMT-SW            PIC X(01)  VALUE 'N'.      00750199
007502         88 PS-NET-COST-AMT-ZEROS                 VALUE 'Y'.      00750299
007503         88 PS-NET-COST-AMT-NOT-ZEROS             VALUE 'N'.      00750399
007504     05  PS-AMOUNT-SW                  PIC X(01)  VALUE 'N'.      00750499
007505         88 PS-AMOUNT-ZEROS                       VALUE 'Y'.      00750599
007506         88 PS-AMOUNT-NOT-ZEROS                   VALUE 'N'.      00750699
007507                                                                  00750799
007508*---------------------------------------------------------------* 00750803
007510* DB2 ABEND AREA                                                * 00751003
007520*---------------------------------------------------------------* 00752003
007530 01  ABEND-CODE                 PIC S9(04) VALUE ZEROS COMP SYNC. 00753014
007540     88  AP-DB2-ERROR                       VALUE +4013.          00754003
007550     88  AC-BAD-DATA                        VALUE +4008.          00755003
007560                                                                  00756003
007600 01  ABEND-AREAS.                                                 00760003
007700     05  AA-ABEND-LIT                  PIC X(40)  VALUE           00770003
007800         '******       ABEND'.                                    00780003
007810     05  AA-PROGRAM-LIT                PIC X(40)  VALUE           00781003
007820         '*****   PROGRAM: APKUT350'.                             00782003
008300     05  AA-PARAGRAPH-LIT.                                        00830014
008400         10  FILLER                    PIC X(17)  VALUE           00840003
008500             '***** PARAGRAPH: '.                                 00850002
008600         10  AA-PARAGRAPH-NAME         PIC X(35)  VALUE SPACES.   00860003
008700     05  AA-MESSAGE-LINE.                                         00870003
008800         10  FILLER                    PIC X(06)  VALUE '******'. 00880003
008900         10  AA-MESSAGE                PIC X(127) VALUE SPACES.   00890003
009000         10  FILLER REDEFINES AA-MESSAGE.                         00900003
009010             15 AA-MESSAGE-1           PIC X(45).                 00901003
009020             15 AA-MESSAGE-2           PIC X(45).                 00902003
009030             15 AA-MESSAGE-3           PIC X(37).                 00903003
009040     05  AA-DB2-ERROR-LIT              PIC X(40)  VALUE           00904003
009050         '****     DB2 ERROR'.                                    00905003
010600     05  AA-DB2-OPERATION-LIT.                                    01060003
010610         10  FILLER                    PIC X(17)  VALUE           01061003
010620             '***** OPERATION: '.                                 01062003
010630         10  AA-DB2-OPERATION.                                    01063003
010640             15 AA-DB2-OP-1            PIC X(25)  VALUE SPACES.   01064003
010650             15 AA-DB2-OP-2            PIC X(25)  VALUE SPACES.   01065003
010660     05  AA-DB2-TABLE-1                PIC X(15)  VALUE SPACES.   01066003
010670     05  AA-DB2-TABLE-2                PIC X(15)  VALUE SPACES.   01067003
010680                                                                  01068003
014600*----------------------------------------------------------------*01460002
014700* ACCOUNTS PAYABLE CONTROL TABLE                                 *01470003
014800*----------------------------------------------------------------*01480002
015000     EXEC SQL                                                     01500002
015100         INCLUDE TAPCNTL                                          01510002
015200     END-EXEC.                                                    01520002
015300                                                                  01530002
015400*----------------------------------------------------------------*01540002
015500* EXTERNAL ENTITY TABLE                                          *01550003
015600*----------------------------------------------------------------*01560002
015800     EXEC SQL                                                     01580002
015900         INCLUDE TEXTENT                                          01590002
016000     END-EXEC.                                                    01600002
016100                                                                  01610002
016200*----------------------------------------------------------------*01620002
016300* EXTERNAL ENTITY NAME TABLE                                     *01630003
016400*----------------------------------------------------------------*01640002
016600     EXEC SQL                                                     01660002
016700         INCLUDE TENTNME                                          01670002
016800     END-EXEC.                                                    01680002
016900                                                                  01690002
016910*----------------------------------------------------------------*01691003
016920* ACCOUNTS PAYABLE TRANSACTION CODE TABLE                        *01692003
016930*----------------------------------------------------------------*01693003
016940     EXEC SQL                                                     01694003
016950         INCLUDE TTRNCDE                                          01695003
016960     END-EXEC.                                                    01696003
016970                                                                  01697003
017000*----------------------------------------------------------------*01700002
017100* DB2 COMMUNICATION AREA                                         *01710003
017200*----------------------------------------------------------------*01720002
017400     EXEC SQL                                                     01740002
017500         INCLUDE SQLCA                                            01750002
017600     END-EXEC.                                                    01760002
017700                                                                  01770002
017800*------------------------*                                        01780003
018400 PROCEDURE DIVISION.                                              01840002
018500*------------------------*                                        01850003
018600 A100-PROGRAM-MAINLINE.                                           01860002
018700                                                                  01870002
018800     PERFORM B100-INITIALIZATION.                                 01880003
019000     PERFORM B200-PROCESS-ADJUST-UPLD-FILE                        01900014
019100       UNTIL ADJUST-UPLOAD-EOF.                                   01910003
019300     PERFORM B300-END-OF-JOB.                                     01930002
019500     GOBACK.                                                      01950002
019600                                                                  01960002
019700*----------------------------------------------------------------*01970002
019800* INITIALIZATION PROCESSING                                      *01980003
020100*----------------------------------------------------------------*02010002
020300 B100-INITIALIZATION.                                             02030003
020400                                                                  02040002
020500     OPEN INPUT  ADJUST-UPLOAD-FILE                               02050003
020600          OUTPUT ADJUST-DTL-FILE                                  02060003
020610                 ERROR-EXCPT-FILE.                                02061003
020700                                                                  02070002
020800     INITIALIZE AP045-TRANSACTION-FILE                            02080037
020810                PS-OFFSET-SW                                      02081037
020820                PS-OFFSET-ACCT-SW.                                02082037
020900                                                                  02090002
021000     PERFORM S050-SELECT-BTCH-CNTRL.                              02100004
021300     PERFORM R100-READ-ADJUST-UPLOAD-FILE.                        02130004
021311     PERFORM C025-FIRST-REC-PROCSSING                             02131199
021312       UNTIL PS-FIRST-REC-FORMAT                                  02131299
021313          OR ADJUST-UPLOAD-EOF.                                   02131399
021610                                                                  02161099
021700*---------------------------------------------------------------* 02170002
021800* PRIMARY PROCESSING                                            * 02180004
022000*---------------------------------------------------------------* 02200002
022200 B200-PROCESS-ADJUST-UPLD-FILE.                                   02220014
022300                                                                  02230002
022360     PERFORM C650-VALIDATE-INPUT-FIELDS.                          02236099
022370                                                                  02237099
022380     IF PS-VALID-DATA                                             02238099
022400        IF AP121-AP-TRN-CDE = PV-PREV-TRNCDE                      02240099
022500           IF AP121-VND-NBR = PV-PREV-VND-NBR                     02250099
022600              IF AP121-DOC-NBR = PV-PREV-DOC-NBR                  02260099
022610                 PERFORM C200-DOC-NBRS-EQUAL                      02261099
022620              ELSE                                                02262099
022630                 PERFORM C250-DOC-NBRS-NOT-EQUAL                  02263099
022700              END-IF                                              02270099
022710           ELSE                                                   02271099
022720              PERFORM S200-SELECT-VENDOR-DATA                     02272099
022730              IF PS-VENDOR-FOUND                                  02273099
022740                 IF AP121-DOC-NBR = PV-PREV-DOC-NBR               02274099
022750                    PERFORM C200-DOC-NBRS-EQUAL                   02275099
022760                 ELSE                                             02276099
022770                    PERFORM C250-DOC-NBRS-NOT-EQUAL               02277099
022780                 END-IF                                           02278099
022781              ELSE                                                02278199
022782                 PERFORM R100-READ-ADJUST-UPLOAD-FILE             02278299
022790              END-IF                                              02279099
022800           END-IF                                                 02280099
022810        ELSE                                                      02281099
022820           PERFORM S100-SELECT-TRNCDE-DATA                        02282099
022830           IF PS-TRNCDE-FOUND                                     02283099
022831              IF AP121-VND-NBR = PV-PREV-VND-NBR                  02283199
022850                 IF AP121-DOC-NBR = PV-PREV-DOC-NBR               02285099
022860                    PERFORM C200-DOC-NBRS-EQUAL                   02286099
022870                 ELSE                                             02287099
022880                    PERFORM C250-DOC-NBRS-NOT-EQUAL               02288099
022890                 END-IF                                           02289099
022891              ELSE                                                02289199
022892                 PERFORM S200-SELECT-VENDOR-DATA                  02289299
022893                 IF PS-VENDOR-FOUND                               02289399
022894                    IF AP121-DOC-NBR = PV-PREV-DOC-NBR            02289499
022895                       PERFORM C200-DOC-NBRS-EQUAL                02289599
022896                    ELSE                                          02289699
022897                       PERFORM C250-DOC-NBRS-NOT-EQUAL            02289799
022898                    END-IF                                        02289899
022899                 ELSE                                             02289999
022900                    PERFORM R100-READ-ADJUST-UPLOAD-FILE          02290099
022901                 END-IF                                           02290199
022902              END-IF                                              02290299
022903           ELSE                                                   02290399
022904              PERFORM R100-READ-ADJUST-UPLOAD-FILE                02290499
022905           END-IF                                                 02290599
022910        END-IF                                                    02291099
023000     ELSE                                                         02300099
023100        PERFORM R100-READ-ADJUST-UPLOAD-FILE                      02310099
023200     END-IF.                                                      02320099
023300                                                                  02330099
023500*---------------------------------------------------------------* 02350002
023600* END OF PROGRAM PROCESSING                                     * 02360004
023800*---------------------------------------------------------------* 02380002
024000 B300-END-OF-JOB.                                                 02400002
024100                                                                  02410002
024200     IF PC-REC-WRTTN-CNT > 0                                      02420010
024300        INITIALIZE AP045-KEY-FIELDS                               02430010
024310                   AP045-COMMON-FIELDS                            02431010
024320                   AP045-CONTROL-FIELDS                           02432010
024330        SET AP045-CONTROL-RECORD    TO TRUE                       02433010
024340        MOVE PC-REC-WRTTN-CNT       TO AP045-CTL-RECORD-COUNT     02434010
024350        MOVE PV-CTL-GRO-COST-AMT    TO AP045-CTL-GRO-COST-AMT     02435010
024360        MOVE PV-CTL-RETL-AMT        TO AP045-CTL-RETL-AMT         02436010
024361        MOVE PV-CTL-FRGT-AMT        TO AP045-CTL-FRGT-AMT         02436110
024362        MOVE PV-CTL-MISC-CHRG-AMT   TO AP045-CTL-MISC-CHRG-AMT    02436210
024363        MOVE PV-CTL-NET-COST-AMT    TO AP045-CTL-NET-COST-AMT     02436310
024364        MOVE PV-CTL-TERM-DISC-AMT   TO AP045-CTL-TERM-DISC-AMT    02436410
024370        PERFORM W100-WRITE-ADJUST-DTL-RECORD                      02437023
024380     END-IF.                                                      02438002
024390                                                                  02439002
024400     CLOSE ADJUST-UPLOAD-FILE                                     02440004
024500           ADJUST-DTL-FILE                                        02450004
024510           ERROR-EXCPT-FILE.                                      02451004
024600                                                                  02460002
024700     DISPLAY 'ADJUSTMENT UPLOAD RECORDS READ = ' PC-REC-READ-CNT. 02470010
024710     DISPLAY 'ERROR/EXCEPTION RECORDS WRITTEN = '                 02471010
024720       PC-REC-EXCPT-CNT.                                          02472010
024800     DISPLAY 'ADJUSTMENT RECORDS WRITTEN = ' PC-REC-WRTTN-CNT.    02480010
024900                                                                  02490002
024901*----------------------------------------------------------------*02490199
024902* LOOP THROUGH THE ADJUSTMENT FILE UNTIL THE FIRST RECORD THAT   *02490299
024903* CONTAINS VALID DATA IS FOUND                                   *02490399
024904*----------------------------------------------------------------*02490499
024905 C025-FIRST-REC-PROCSSING.                                        02490599
024906                                                                  02490699
024909     PERFORM C650-VALIDATE-INPUT-FIELDS.                          02490999
024910     IF PS-VALID-DATA                                             02491099
024911        PERFORM C050-FORMAT-FIRST-RECORD                          02491199
024912     ELSE                                                         02491299
024913        PERFORM R100-READ-ADJUST-UPLOAD-FILE                      02491399
024914     END-IF.                                                      02491499
024915                                                                  02491599
024916*----------------------------------------------------------------*02491607
024920* FORMAT THE FIRST RECORD OF THE ADJUSTMENT UPLOAD FILE THAT     *02492099
024921* CONTAINS VALID DATA                                            *02492199
024930*----------------------------------------------------------------*02493007
024940 C050-FORMAT-FIRST-RECORD.                                        02494099
024950                                                                  02495007
024953     SET PS-FIRST-REC-FORMAT            TO TRUE.                  02495399
024954                                                                  02495499
024960     PERFORM S100-SELECT-TRNCDE-DATA.                             02496007
024970     IF PS-TRNCDE-FOUND                                           02497007
024980        PERFORM S200-SELECT-VENDOR-DATA                           02498007
024990        IF PS-VENDOR-FOUND                                        02499007
024991           MOVE AP121-AP-TRN-CDE     TO PV-PREV-TRNCDE            02499199
024992           MOVE AP121-VND-NBR        TO PV-PREV-VND-NBR           02499299
024993           IF (AP121-DOC-NBR >= '0' AND                           02499398
024994               AP121-DOC-NBR <= PC-ZERO-DOC-NBR)                  02499499
024995               MOVE PC-ZERO-DOC-NBR  TO PV-PREV-DOC-NBR           02499598
024997           ELSE                                                   02499798
024998               MOVE AP121-DOC-NBR    TO PV-PREV-DOC-NBR           02499898
024999           END-IF                                                 02499998
025000           PERFORM B200-PROCESS-ADJUST-UPLD-FILE                  02500014
025001        ELSE                                                      02500107
025002           PERFORM C150-MOVE-HOLD-FIELDS                          02500284
025003           PERFORM R100-READ-ADJUST-UPLOAD-FILE                   02500307
025004        END-IF                                                    02500407
025005     ELSE                                                         02500507
025006        PERFORM C150-MOVE-HOLD-FIELDS                             02500684
025007        PERFORM R100-READ-ADJUST-UPLOAD-FILE                      02500707
025008     END-IF.                                                      02500807
025009                                                                  02500907
025010*----------------------------------------------------------------*02501022
025011* MOVE THE ORIGINAL TRNCDE TABLE FIELDS TO HOLD VARIABLES        *02501122
025012* PV-BYPASS-OFFSET WILL OVERRIDE THE OFFSET CODE ON THE INPUT    *02501299
025013* RECORD IN THE CASE WHERE THE ORIGINAL TRANCODE IS EXP.         *02501399
025014*----------------------------------------------------------------*02501499
025015 C100-MOVE-ORIG-TRNCDE-VALUES.                                    02501599
025016                                                                  02501699
025017      MOVE TRNCDE-PSTG-TYP-CDE       TO PV-ORIG-PSTG-TYP-CDE.     02501799
025018      MOVE TRNCDE-TRN-TYP-CDE        TO PV-ORIG-TRN-TYP-CDE.      02501899
025019      MOVE TRNCDE-BTCH-SRC-CDE       TO PV-ORIG-BTCH-SRC-CDE.     02501999
025020      MOVE TRNCDE-AUTO-OFFST-TRN-CDE TO PV-ORIG-OFFST-TRN-CDE.    02502099
025021      MOVE TRNCDE-GL-ACCT-NBR        TO PV-ORIG-GL-ACCT-NBR.      02502199
025022                                                                  02502299
025023*     IF  TRNCDE-TRN-TYP-CDE = 'EXP'                              02502399
025024*         SET PV-BYPASS-OFFSET TO TRUE                            02502499
025025*     ELSE                                                        02502599
025026*         SET PV-EVALUATE-OFFSET TO TRUE                          02502699
025027*     END-IF.                                                     02502799
025028                                                                  02502899
025029*----------------------------------------------------------------*02502999
025030* MOVE FIELDS FROM THE CURRENT RECORD INTO STORAGE VARIABLES     *02503099
025031* FOR LATER FIELD COMPARISON PROCESSING                          *02503199
025032*----------------------------------------------------------------*02503299
025033 C150-MOVE-HOLD-FIELDS.                                           02503399
025034                                                                  02503499
025035     MOVE AP121-AP-TRN-CDE               TO PV-PREV-TRNCDE.       02503599
025036     MOVE AP121-VND-NBR                  TO PV-PREV-VND-NBR.      02503699
025037     MOVE AP121-DOC-NBR                  TO PV-PREV-DOC-NBR.      02503799
025038     MOVE AP121-DOC-DTE                  TO PV-PREV-DOC-DTE.      02503825
025039     MOVE AP121-PO-NBR                   TO PV-PREV-PO-NBR.       02503907
025040     MOVE AP121-DEPT-NBR                 TO PV-PREV-DEPT-NBR.     02504007
025041     MOVE AP121-GL-ACCT-NBR              TO PV-PREV-ACCT-NBR.     02504107
025049                                                                  02504907
025050*----------------------------------------------------------------*02505007
025051* PROCESS RECORDS WHERE THE CURRENT DOCUMENT NUMBER IS EQUAL TO  *02505107
025052* THE PREVIOUS RECORD'S DOCUMENT NUMBER.                         *02505207
025053*----------------------------------------------------------------*02505307
025054 C200-DOC-NBRS-EQUAL.                                             02505423
025055                                                                  02505507
025058     IF (AP121-DOC-NBR = SPACES OR                                02505897
025059        AP121-DOC-NBR = PC-ZERO-DOC-NBR)                          02505999
025061        IF (AP121-DOC-DTE = PV-PREV-DOC-DTE AND                   02506119
025062            AP121-PO-NBR = PV-PREV-PO-NBR AND                     02506219
025063            AP121-DEPT-NBR = PV-PREV-DEPT-NBR AND                 02506319
025064            AP121-GL-ACCT-NBR = PV-PREV-ACCT-NBR AND              02506487
025065            AP121-AP-TRN-CDE = PV-PREV-TRNCDE AND                 02506587
025066            AP121-VND-NBR = PV-PREV-VND-NBR)                      02506687
025067           CONTINUE                                               02506719
025068        ELSE                                                      02506819
025069           PERFORM S300-GET-NEXT-DOC-NBR                          02506919
025070        END-IF                                                    02507019
025071     ELSE                                                         02507107
025072        SET PS-WS151-DOC-NBR-NOT-FOUND   TO TRUE                  02507219
025074     END-IF.                                                      02507407
025075                                                                  02507507
025076     PERFORM C150-MOVE-HOLD-FIELDS.                               02507623
025077     PERFORM C450-DETERMINE-OFFSET.                               02507727
025078                                                                  02507819
025079*----------------------------------------------------------------*02507907
025080* PROCESS RECORDS WHERE THE CURRENT DOCUMENT NUMBER IS NOT EQUAL *02508007
025081* TO THE PREVIOUS RECORD'S DOCUMENT NUMBER.                      *02508107
025082*----------------------------------------------------------------*02508207
025083 C250-DOC-NBRS-NOT-EQUAL.                                         02508323
025084                                                                  02508407
025087     IF (AP121-DOC-NBR = SPACES OR                                02508797
025088        AP121-DOC-NBR = PC-ZERO-DOC-NBR)                          02508899
025091        PERFORM S300-GET-NEXT-DOC-NBR                             02509119
025095     ELSE                                                         02509507
025097        SET PS-WS151-DOC-NBR-NOT-FOUND    TO TRUE                 02509710
025099     END-IF.                                                      02509907
025100                                                                  02510007
025110     PERFORM C150-MOVE-HOLD-FIELDS.                               02511023
025111     PERFORM C450-DETERMINE-OFFSET.                               02511127
025150                                                                  02515019
025200*----------------------------------------------------------------*02520007
025300* FORMAT THE OUTPUT RECORD(S) BASED ON IF AN OFFSET RECORD       *02530099
025400* SHOULD ALSO BE CREATED.                                        *02540099
025500*----------------------------------------------------------------*02550007
025600 C300-FORMAT-OUTPUT-RECORD.                                       02560023
025610                                                                  02561007
025613     IF PS-BYPASS-OFFSET                                          02561327
025614        PERFORM C400-FORMAT-ADJUST-DTL-RECORD                     02561427
025615     END-IF.                                                      02561527
025616     IF PS-CREATE-OFFSET                                          02561627
025617        PERFORM C400-FORMAT-ADJUST-DTL-RECORD                     02561727
025618        PERFORM C350-FORMAT-OFFSET-RECORD                         02561827
025619     END-IF.                                                      02561927
025620                                                                  02562037
025621     INITIALIZE AP045-TRANSACTION-FILE                            02562139
025622                PS-OFFSET-SW                                      02562239
025623                PS-OFFSET-ACCT-SW                                 02562373
025624                PS-REJECT-SW.                                     02562473
025630     PERFORM R100-READ-ADJUST-UPLOAD-FILE.                        02563037
025640                                                                  02564018
025650*----------------------------------------------------------------*02565027
025660* FORMAT THE COMMON FIELDS BETWEEN THE ADJUSTMENT DETAIL RECORD  *02566027
025670* AND THE OFFSET RECORD.                                         *02567027
025680*----------------------------------------------------------------*02568027
025690 C325-FORMAT-COMMON-FIELDS.                                       02569027
025700                                                                  02570027
026100     MOVE AP121-VND-NBR                TO AP045-VND-NBR.          02610008
026700     MOVE AP121-DOC-DTE                TO AP045-DOC-DTE.          02670008
026900     MOVE PC-RECD-TYP-CDE              TO AP045-RECD-TYP-CDE.     02690008
027500     MOVE APCNTL-BTCH-PRC-DTE          TO AP045-ENTR-DTE.         02750008
027600     MOVE PC-ENTR-TME                  TO AP045-ENTR-TME.         02760008
027700     MOVE AP121-ENTR-ID                TO AP045-ENTR-ID.          02770013
027800     MOVE PC-ORGN-CDE                  TO AP045-ORGN-CDE.         02780008
027900     MOVE APCNTL-BTCH-PRC-DTE          TO AP045-INV-CUTOFF-DTE.   02790008
028000     MOVE SPACES                       TO AP045-BAR-CDE.          02800008
028100     MOVE APCNTL-BTCH-PRC-DTE          TO AP045-PS-BTCH-DTE.      02810008
028300     MOVE PC-BTCH-SEQ-NBR              TO AP045-PS-BTCH-SEQ-NBR.  02830008
028400     MOVE EXTENT-ENT-ID                TO AP045-ENT-ID.           02840008
028500     MOVE ENTNME-ENT-NAME-DESC         TO AP045-ENT-NME-DESC.     02850008
028510     MOVE AP121-RSN-TXT                TO AP045-RSN-TXT.          02851008
028520     MOVE ZERO                         TO AP045-TERM-DISC-PCT.    02852008
028530     MOVE ZERO                         TO AP045-NW-STR-DISC-PCT.  02853008
028540     MOVE ZERO                         TO AP045-TRD-DISC-PCT.     02854008
028541     IF APCNTL-MULT-PSTG-PER-IND = 'Y'                            02854142
028542        IF AP121-PSTG-PER-IND = 'P'                               02854242
028570           MOVE APCNTL-PREV-PSTG-FYR-NBR TO AP045-PSTG-FYR-NBR    02857042
028580           MOVE APCNTL-PREV-PSTG-FMN-NBR TO AP045-PSTG-FMN-NBR    02858042
028590           MOVE APCNTL-PREV-PSTG-FWK-NBR TO AP045-PSTG-FWK-NBR    02859042
028600        ELSE                                                      02860042
028700           MOVE APCNTL-CURR-PSTG-FYR-NBR TO AP045-PSTG-FYR-NBR    02870042
028710           MOVE APCNTL-CURR-PSTG-FMN-NBR TO AP045-PSTG-FMN-NBR    02871042
028720           MOVE APCNTL-CURR-PSTG-FWK-NBR TO AP045-PSTG-FWK-NBR    02872042
028721     ELSE                                                         02872142
028722        IF AP121-PSTG-PER-IND = 'P'                               02872242
028723           SET AP122-WARNING             TO TRUE                  02872342
028725           MOVE SPACES                   TO AP122-ERROR-FIELD     02872542
028726                                            AP122-ERROR-VALUE     02872642
028727           MOVE 'INPUT PSTG-PER-IND = P WHILE TAPCNTL VALUE = N'  02872742
028728             TO AP122-ERROR-MESSAGE                               02872842
028729           PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                 02872942
028730        END-IF                                                    02873042
028731        MOVE APCNTL-CURR-PSTG-FYR-NBR    TO AP045-PSTG-FYR-NBR    02873142
028732        MOVE APCNTL-CURR-PSTG-FMN-NBR    TO AP045-PSTG-FMN-NBR    02873242
028733        MOVE APCNTL-CURR-PSTG-FWK-NBR    TO AP045-PSTG-FWK-NBR    02873342
028734     END-IF.                                                      02873408
028735     IF AP121-DOC-HLD-IND =  'Y'                                  02873599
028736        SET AP045-DOC-HLD TO TRUE                                 02873699
028737     ELSE                                                         02873799
028738       IF AP121-DOC-HLD-IND = 'N'                                 02873899
028739          SET AP045-NOT-ON-HLD TO TRUE                            02873999
028740       END-IF                                                     02874099
028741     END-IF.                                                      02874199
028742                                                                  02874299
028743     MOVE ZERO                       TO AP045-MOS-DISC-PCT.       02874399
028750     MOVE ZERO                       TO AP045-ADV-DISC-PCT.       02875099
028795     MOVE ZERO                       TO AP045-DTL-NW-STR-DISC-AMT.02879518
028797     MOVE ZERO                       TO AP045-DTL-TRD-DISC-AMT.   02879799
028798     MOVE ZERO                       TO AP045-DTL-MOS-DISC-AMT.   02879899
028800     MOVE AP121-PYMT-DUE-DTE         TO AP045-PYMT-DUE-DTE.       02880099
028801     MOVE AP121-AUTH-NBR             TO AP045-AUTH-NBR.           02880199
028803                                                                  02880310
028804     ADD AP045-GRO-COST-AMT          TO PV-CTL-GRO-COST-AMT.      02880499
028805     ADD AP045-RETL-AMT              TO PV-CTL-RETL-AMT.          02880599
028806     ADD AP045-FRGT-AMT              TO PV-CTL-FRGT-AMT.          02880699
028807     ADD AP045-MISC-CHRG-AMT         TO PV-CTL-MISC-CHRG-AMT.     02880799
028808     ADD AP045-NET-COST-AMT          TO PV-CTL-NET-COST-AMT.      02880899
028809     ADD AP045-DTL-TERM-DISC-AMT     TO PV-CTL-TERM-DISC-AMT.     02880999
028810                                                                  02881010
028820     PERFORM W100-WRITE-ADJUST-DTL-RECORD.                        02882027
028901                                                                  02890108
028902*----------------------------------------------------------------*02890218
028903* FORMAT THE OFFSET RECORD                                       *02890399
028904*----------------------------------------------------------------*02890418
028905 C350-FORMAT-OFFSET-RECORD.                                       02890523
028906                                                                  02890618
028909     STRING AP045-DOC-NBR, 'OFF'                                  02890919
028910       DELIMITED BY ' '                                           02891019
028911       INTO AP045-DOC-NBR                                         02891119
028912     END-STRING.                                                  02891219
028913     MOVE PV-HOLD-OFFST-TRNCDE         TO AP045-AP-TRN-CDE.       02891399
028914     IF PS-USE-OFFSET-ACCT                                        02891427
028915        MOVE AP121-OFFSET-ACCT         TO AP045-GL-ACCT-NBR       02891527
028916     ELSE                                                         02891627
028917        MOVE TRNCDE-GL-ACCT-NBR        TO AP045-GL-ACCT-NBR       02891727
028918     END-IF.                                                      02891827
028919     MOVE SPACES                       TO AP045-DEPT-NBR          02891999
028920                                          AP045-CL-NBR.           02892099
028921     MOVE TRNCDE-PSTG-TYP-CDE          TO AP045-PSTG-TYP-CDE.     02892123
028922     MOVE TRNCDE-TRN-TYP-CDE           TO AP045-TRN-TYP-CDE.      02892223
028923     MOVE TRNCDE-BTCH-SRC-CDE          TO AP045-PS-BTCH-SRC-CDE.  02892325
028924     MOVE PC-OFFSET-STR-NBR            TO AP045-STR-NBR.          02892418
028925                                                                  02892599
028926     MULTIPLY -1 BY AP045-GRO-COST-AMT.                           02892618
028928     MULTIPLY -1 BY AP045-FRGT-AMT.                               02892818
028929     MULTIPLY -1 BY AP045-MISC-CHRG-AMT.                          02892918
028930     MULTIPLY -1 BY AP045-NET-COST-AMT.                           02893018
028931     MULTIPLY -1 BY AP045-DTL-TERM-DISC-AMT.                      02893118
028932                                                                  02893299
028933     IF  AP045-EXPENSE                                            02893399
028934         MOVE ZERO TO AP045-RETL-AMT                              02893499
028935     ELSE                                                         02893599
028936         MULTIPLY -1 BY AP045-RETL-AMT                            02893699
028937     END-IF.                                                      02893799
028938                                                                  02893899
028939     MOVE ZEROS                        TO AP045-SKU-NBR.          02893999
028940     PERFORM C325-FORMAT-COMMON-FIELDS.                           02894099
028941                                                                  02894199
028942*----------------------------------------------------------------*02894299
028943* FORMAT THE ADJUSTMENT DETAIL RECORD                            *02894399
028944*----------------------------------------------------------------*02894499
028945 C400-FORMAT-ADJUST-DTL-RECORD.                                   02894599
028946                                                                  02894699
028947     INITIALIZE AP045-KEY-FIELDS                                  02894799
028948                AP045-COMMON-FIELDS                               02894899
028949                AP045-DETAIL-FIELDS.                              02894999
028950                                                                  02895099
028951     IF PS-WS151-DOC-NBR-FOUND                                    02895199
028952        MOVE WS151-NEXT-DOC-NBR        TO AP045-DOC-NBR           02895299
028953     ELSE                                                         02895399
028954        MOVE AP121-DOC-NBR             TO AP045-DOC-NBR           02895499
028955     END-IF.                                                      02895599
028956     MOVE AP121-AP-TRN-CDE             TO AP045-AP-TRN-CDE.       02895699
028957     MOVE AP121-PO-NBR                 TO AP045-PO-NBR.           02895799
028958                                                                  02895899
028959     IF  PV-ORIG-TRN-TYP-CDE  = 'MDS'                             02895999
028960         MOVE SPACES                   TO AP045-GL-ACCT-NBR       02896099
028961         MOVE AP121-DEPT-NBR           TO AP045-DEPT-NBR          02896199
028962         MOVE AP121-CL-NBR             TO AP045-CL-NBR            02896299
028963     ELSE                                                         02896399
028964         MOVE AP121-GL-ACCT-NBR        TO AP045-GL-ACCT-NBR       02896499
028965         MOVE SPACES                   TO AP045-DEPT-NBR          02896599
028966                                          AP045-CL-NBR            02896699
028967     END-IF.                                                      02896799
028968                                                                  02896899
028969     MOVE PV-ORIG-PSTG-TYP-CDE         TO AP045-PSTG-TYP-CDE.     02896999
028970     MOVE PV-ORIG-TRN-TYP-CDE          TO AP045-TRN-TYP-CDE.      02897099
028971     MOVE AP121-STR-NBR                TO AP045-STR-NBR.          02897199
028972                                                                  02897299
028973     MOVE PV-GRO-COST-AMT-N            TO AP045-GRO-COST-AMT.     02897399
028974     MOVE PV-RETL-AMT-N                TO AP045-RETL-AMT.         02897499
028978     MOVE PV-FRGT-AMT-N                TO AP045-FRGT-AMT.         02897899
028983     MOVE PV-MISC-CHRG-AMT-N           TO AP045-MISC-CHRG-AMT.    02898399
028988     MOVE PV-NET-COST-AMT-N            TO AP045-NET-COST-AMT.     02898899
028993     MOVE PV-DISC-AMT-N                TO AP045-DTL-TERM-DISC-AMT.02899399
028994     MOVE AP121-SKU-NBR                TO AP045-SKU-NBR.          02899418
028995     MOVE PV-ORIG-BTCH-SRC-CDE         TO AP045-PS-BTCH-SRC-CDE.  02899525
028996     PERFORM C325-FORMAT-COMMON-FIELDS.                           02899627
029000                                                                  02900018
029020*----------------------------------------------------------------*02902019
029030* DETERMINE IF AN OFFSET RECORD SHOULD BE CREATED FOR THE        *02903019
029031* ADJUSTMENT.  THE FIRST 'IF' STATEMENT IS CHECKING AN INTERNAL  *02903199
029032* SWITCH THAT WAS SET BASED ON WHETHER THE ORIGINAL TRANCODE WAS *02903299
029033* 'EXP' - WHICH DOES NOT ALLOW OFFSETS.  IF THIS HAS NOT BEEN    *02903399
029034* SET, THE OFFSET IS PROCESSED BASED ON THE OFFSET CODE FROM THE *02903499
029035* INPUT RECORD.                                                  *02903599
029040*----------------------------------------------------------------*02904019
029050 C450-DETERMINE-OFFSET.                                           02905027
029060                                                                  02906027
029061*    IF  PV-BYPASS-OFFSET                                         02906199
029062*        SET PS-BYPASS-OFFSET                 TO TRUE             02906299
029063*        PERFORM C300-FORMAT-OUTPUT-RECORD                        02906399
029064*    ELSE                                                         02906499
029070         EVALUATE AP121-OFFSET-CDE                                02907099
029080           WHEN 'B'                                               02908099
029082             SET PS-BYPASS-OFFSET TO TRUE                         02908299
029083             PERFORM C300-FORMAT-OUTPUT-RECORD                    02908399
029090           WHEN 'D'                                               02909099
029093             IF PV-ORIG-OFFST-TRN-CDE = SPACES                    02909399
029094                SET PS-BYPASS-OFFSET TO TRUE                      02909499
029095                PERFORM C300-FORMAT-OUTPUT-RECORD                 02909599
029096             ELSE                                                 02909699
029097                MOVE PV-ORIG-OFFST-TRN-CDE                        02909799
029098                  TO PV-HOLD-OFFST-TRNCDE                         02909899
029099                PERFORM S400-SELECT-OFFSET-TRNCDE                 02909999
029100                IF PS-OFFSET-TRNCDE-FOUND                         02910099
029101                   IF TRNCDE-TRN-TYP-CDE NOT = 'EXP'              02910199
029102                      SET AP122-REJECTION     TO TRUE             02910299
029103                      SET PS-REJECT           TO TRUE             02910399
029104                      MOVE 'OFFSET TRN TYP'   TO AP122-ERROR-FIELD02910499
029105                      MOVE TRNCDE-TRN-TYP-CDE TO AP122-ERROR-VALUE02910599
029106                      MOVE 'VALUE NOT EQUAL TO EXP'               02910699
029107                        TO AP122-ERROR-MESSAGE                    02910799
029108                      PERFORM C600-FORMAT-ERROR-EXCPT-RECORD      02910899
029109                   END-IF                                         02910999
029110                   IF TRNCDE-GL-ACCT-NBR = SPACES                 02911099
029111                      IF AP121-OFFSET-ACCT = SPACES               02911199
029112                      OR AP121-OFFSET-ACCT = '00000'              02911299
029113                         SET AP122-REJECTION  TO TRUE             02911399
029114                         MOVE 'GL ACCOUNT'    TO AP122-ERROR-FIELD02911499
029115                         MOVE SPACES          TO AP122-ERROR-VALUE02911599
029116                         MOVE 'NO VALUE ON TRNCDE TBL OR INPUT '  02911699
029117                           TO AP122-ERROR-MESSAGE                 02911799
029118                         SET PS-REJECT-OFFSET     TO TRUE         02911899
029119                         PERFORM C600-FORMAT-ERROR-EXCPT-RECORD   02911999
029120                         PERFORM C300-FORMAT-OUTPUT-RECORD        02912099
029121                      ELSE                                        02912199
029122                         SET PS-USE-OFFSET-ACCT   TO TRUE         02912299
029123                         SET PS-CREATE-OFFSET     TO TRUE         02912399
029124                         PERFORM C300-FORMAT-OUTPUT-RECORD        02912499
029125                      END-IF                                      02912599
029126                   ELSE                                           02912699
029127                      IF AP121-OFFSET-ACCT = SPACES               02912799
029128                      OR AP121-OFFSET-ACCT = '00000'              02912899
029129                         SET PS-USE-TRNCDE-ACCT   TO TRUE         02912999
029130                         SET PS-CREATE-OFFSET     TO TRUE         02913099
029131                         PERFORM C300-FORMAT-OUTPUT-RECORD        02913199
029132                      ELSE                                        02913299
029133                         PERFORM C550-COMPARE-ACCOUNTS            02913399
029134                         PERFORM C300-FORMAT-OUTPUT-RECORD        02913499
029135                      END-IF                                      02913599
029136                   END-IF                                         02913699
029137                ELSE                                              02913799
029138                   PERFORM R100-READ-ADJUST-UPLOAD-FILE           02913899
029139                END-IF                                            02913999
029140             END-IF                                               02914099
029141           WHEN 'S'                                               02914199
029142             MOVE AP121-OFFSET-TRN-CDE TO PV-HOLD-OFFST-TRNCDE    02914299
029143             PERFORM S400-SELECT-OFFSET-TRNCDE                    02914399
029144             IF PS-OFFSET-TRNCDE-FOUND                            02914499
029145                IF TRNCDE-TRN-TYP-CDE NOT = 'EXP'                 02914599
029146                   SET AP122-REJECTION        TO TRUE             02914699
029147                   SET PS-REJECT              TO TRUE             02914799
029148                   MOVE 'OFFSET TRN TYP CDE'  TO AP122-ERROR-FIELD02914899
029149                   MOVE TRNCDE-TRN-TYP-CDE    TO AP122-ERROR-VALUE02914999
029150                   MOVE 'VALUE NOT EQUAL TO EXP'                  02915099
029151                     TO AP122-ERROR-MESSAGE                       02915199
029152                   PERFORM C600-FORMAT-ERROR-EXCPT-RECORD         02915299
029153                END-IF                                            02915399
029154                IF TRNCDE-TRN-SRC-CDE = 'B'                       02915499
029155                   SET AP122-REJECTION        TO TRUE             02915599
029156                   SET PS-REJECT              TO TRUE             02915699
029157                   MOVE 'OFFSET TRN SRC CDE'  TO AP122-ERROR-FIELD02915799
029158                   MOVE TRNCDE-TRN-SRC-CDE    TO AP122-ERROR-VALUE02915899
029159                   MOVE 'VALUE NOT O OR A'                        02915999
029160                     TO AP122-ERROR-MESSAGE                       02916099
029161                   PERFORM C600-FORMAT-ERROR-EXCPT-RECORD         02916199
029162                END-IF                                            02916299
029163                IF PV-ORIG-PSTG-TYP-CDE = TRNCDE-PSTG-TYP-CDE     02916399
029164                   PERFORM C500-INVALID-OFFSET-SIGN               02916499
029165                END-IF                                            02916599
029166                IF PS-REJECT                                      02916699
029167                   SET PS-REJECT-OFFSET       TO TRUE             02916799
029168                   PERFORM C600-FORMAT-ERROR-EXCPT-RECORD         02916899
029169                   PERFORM C300-FORMAT-OUTPUT-RECORD              02916999
029170                ELSE                                              02917099
029171                   IF TRNCDE-GL-ACCT-NBR NOT = SPACES             02917199
029172                      PERFORM C550-COMPARE-ACCOUNTS               02917299
029173                   ELSE                                           02917399
029174                      SET PS-USE-OFFSET-ACCT   TO TRUE            02917499
029175                      SET PS-CREATE-OFFSET     TO TRUE            02917599
029177                   END-IF                                         02917799
029178                   IF PV-ORIG-OFFST-TRN-CDE NOT = SPACES          02917899
029179                      PERFORM C575-COMPARE-TRANCODES              02917999
029180                   END-IF                                         02918099
029181                   PERFORM C300-FORMAT-OUTPUT-RECORD              02918199
029182                END-IF                                            02918299
029183             ELSE                                                 02918399
029184                PERFORM R100-READ-ADJUST-UPLOAD-FILE              02918499
029185             END-IF                                               02918599
029237         END-EVALUATE                                             02923799
029238         .                                                        02923899
029239**   END-IF.                                                      02923999
029240                                                                  02924027
029241*----------------------------------------------------------------*02924130
029242* ISSUE AN ERROR SINCE THE OFFSET SIGN IS NOT THE OPPOSITE OF    *02924230
029243* THE ORIGINAL ADJUSTMENT TRANSACTION SIGN                       *02924330
029244*----------------------------------------------------------------*02924430
029245 C500-INVALID-OFFSET-SIGN.                                        02924530
029246                                                                  02924630
029247     SET AP122-REJECTION            TO TRUE.                      02924730
029248     SET PS-REJECT                  TO TRUE.                      02924865
029249     MOVE 'OFFSET PSTG TYP CDE'     TO AP122-ERROR-FIELD.         02924930
029250     MOVE TRNCDE-PSTG-TYP-CDE       TO AP122-ERROR-VALUE.         02925030
029251     MOVE 'OFFSET SIGN NOT OPPOSITE OF ORIGINAL'                  02925130
029252       TO AP122-ERROR-MESSAGE.                                    02925230
029253     PERFORM C600-FORMAT-ERROR-EXCPT-RECORD.                      02925330
029260                                                                  02926030
029270*----------------------------------------------------------------*02927030
029280* VALIDATE THAT THE TRNCDE TABLE ACCOUNT VALUE MATCHES THE       *02928030
029290* ACCOUNT VALUE GIVEN ON THE INPUT FILE                          *02929030
029300*----------------------------------------------------------------*02930030
029400 C550-COMPARE-ACCOUNTS.                                           02940030
029410                                                                  02941030
029500     IF  TRNCDE-GL-ACCT-NBR = AP121-OFFSET-ACCT                   02950099
029510         CONTINUE                                                 02951099
029520     ELSE                                                         02952099
029600         SET AP122-WARNING            TO TRUE                     02960099
029610         MOVE 'OFFSET ACCOUNT'        TO AP122-ERROR-FIELD        02961099
029611         STRING TRNCDE-GL-ACCT-NBR DELIMITED BY ' '               02961199
029612                ','                DELIMITED BY SIZE              02961299
029613                AP121-OFFSET-ACCT  DELIMITED BY ' '               02961399
029614            INTO AP122-ERROR-VALUE                                02961499
029615         END-STRING                                               02961599
029616         MOVE PC-VALUES-NOT-EQUAL-MSG  TO AP122-ERROR-MESSAGE     02961699
029618         PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                   02961899
029621     END-IF.                                                      02962139
029622     SET PS-USE-TRNCDE-ACCT           TO TRUE.                    02962239
029623     SET PS-CREATE-OFFSET             TO TRUE.                    02962339
029624***  PERFORM C300-FORMAT-OUTPUT-RECORD.                           02962499
029625                                                                  02962530
029626*----------------------------------------------------------------*02962699
029627* VALIDATE THAT THE TRNCDE TABLE OFFSET TRANCODE MATCHES THE     *02962799
029628* OFFSET TRANCODE VALUE GIVEN ON THE INPUT FILE                  *02962899
029629*----------------------------------------------------------------*02962999
029630 C575-COMPARE-TRANCODES.                                          02963099
029631                                                                  02963199
029632     IF  PV-ORIG-OFFST-TRN-CDE = AP121-OFFSET-TRN-CDE             02963299
029633         CONTINUE                                                 02963399
029634     ELSE                                                         02963499
029635*    DISPLAY 'ORIG-OFFSET = ' PV-ORIG-OFFST-TRN-CDE               02963599
029636*    DISPLAY 'HOLD-OFFSET = ' PV-HOLD-OFFST-TRNCDE                02963699
029637*    DISPLAY ' INPUT RECORD = ' AP121-TRANSACTION-FILE            02963799
029638         SET AP122-WARNING            TO TRUE                     02963899
029639         MOVE 'OFFSET TRNCDE'         TO AP122-ERROR-FIELD        02963999
029640         STRING PV-ORIG-OFFST-TRN-CDE DELIMITED BY ' '            02964099
029641              ','                        DELIMITED BY SIZE        02964199
029642              AP121-OFFSET-TRN-CDE       DELIMITED BY ' '         02964299
029643         INTO AP122-ERROR-VALUE                                   02964399
029644         END-STRING                                               02964499
029645         MOVE PC-VALUES-NOT-EQUAL-MSG TO AP122-ERROR-MESSAGE      02964599
029646         PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                   02964699
029647     END-IF.                                                      02964799
029648*----------------------------------------------------------------*02964823
029649* FORMATS THE ERROR/EXCEPTION RECORD                             *02964923
029650*----------------------------------------------------------------*02965023
029651 C600-FORMAT-ERROR-EXCPT-RECORD.                                  02965123
029652                                                                  02965223
029653     IF AP122-REJECTION OR AP122-WARNING                          02965354
029654        MOVE AP121-VND-NBR               TO AP122-VND-NBR         02965454
029655        MOVE AP121-DOC-NBR               TO AP122-DOC-NBR         02965554
029656        MOVE AP121-DOC-DTE               TO AP122-DOC-DTE         02965654
029657        MOVE AP121-AP-TRN-CDE            TO AP122-AP-TRN-CDE      02965754
029658        MOVE AP121-PO-NBR                TO AP122-PO-NBR          02965899
029659        MOVE AP121-NET-COST-AMT          TO AP122-NET-COST        02965999
029660        MOVE AP121-RETL-AMT              TO AP122-NET-RETAIL      02966099
029661        PERFORM W200-WRITE-ERROR-EXCPT-RECORD                     02966199
029662     END-IF.                                                      02966299
029663                                                                  02966399
029664     IF PS-REJECT-OFFSET                                          02966499
029665        SET AP122-REJECTION           TO TRUE                     02966599
029666        MOVE SPACES                   TO AP122-ERROR-FIELD        02966699
029667                                         AP122-ERROR-VALUE        02966799
029668        MOVE 'ORIGINAL ADJUSTMENT REJECTED DUE TO OFFSET ERROR'   02966899
029669          TO AP122-ERROR-MESSAGE                                  02966999
029670        PERFORM W200-WRITE-ERROR-EXCPT-RECORD                     02967099
029671     END-IF.                                                      02967199
029672                                                                  02967299
029673*----------------------------------------------------------------*02967399
029674* VALIDATES THAT THE INPUT FIELDS ARE FORMATTED PROPERLY         *02967499
029675*----------------------------------------------------------------*02967599
029676 C650-VALIDATE-INPUT-FIELDS.                                      02967699
029677                                                                  02967799
029678     INSPECT AP121-VND-NBR REPLACING ALL SPACES BY '0'.           02967899
029679     MOVE AP121-VND-NBR                   TO PV-VND-NBR-9.        02967999
029680     IF PV-VND-NBR-9 NOT NUMERIC                                  02968099
029681        SET AP122-REJECTION               TO TRUE                 02968199
029682        SET PS-INVALID-DATA               TO TRUE                 02968299
029683        MOVE PC-VNDR-FIELD                TO AP122-ERROR-FIELD    02968399
029684        MOVE AP121-VND-NBR                TO AP122-ERROR-VALUE    02968499
029685        MOVE PC-NOT-NUMERIC-MSG           TO AP122-ERROR-MESSAGE  02968599
029686        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02968699
029687     END-IF.                                                      02968799
029688                                                                  02968899
029689     IF AP121-PO-NBR NOT EQUAL SPACES                             02968999
029690        INSPECT AP121-PO-NBR REPLACING ALL SPACES BY '0'          02969099
029691        MOVE AP121-PO-NBR                 TO PV-PO-NBR-9          02969199
029692        IF PV-PO-NBR-9 NOT NUMERIC                                02969299
029693           SET AP122-REJECTION            TO TRUE                 02969399
029694           SET PS-INVALID-DATA            TO TRUE                 02969499
029695           MOVE 'PO NUMBER'               TO AP122-ERROR-FIELD    02969599
029696           MOVE AP121-PO-NBR              TO AP122-ERROR-VALUE    02969699
029697           MOVE PC-NOT-NUMERIC-MSG        TO AP122-ERROR-MESSAGE  02969799
029698           PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                 02969899
029699        END-IF                                                    02969999
029700     END-IF.                                                      02970099
029701                                                                  02970199
029702     IF AP121-DEPT-NBR NOT EQUAL SPACES                           02970299
029703        MOVE AP121-DEPT-NBR               TO PV-DEPT-NBR-9        02970399
029704        IF PV-DEPT-NBR-9 NOT NUMERIC                              02970499
029705           SET AP122-REJECTION            TO TRUE                 02970599
029706           SET PS-INVALID-DATA            TO TRUE                 02970699
029707           MOVE 'DEPARTMENT NBR'          TO AP122-ERROR-FIELD    02970799
029708           MOVE AP121-DEPT-NBR            TO AP122-ERROR-VALUE    02970899
029709           MOVE PC-NOT-NUMERIC-MSG        TO AP122-ERROR-MESSAGE  02970999
029710           PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                 02971099
029711        END-IF                                                    02971199
029712     END-IF.                                                      02971299
029713                                                                  02971399
029714     IF AP121-GL-ACCT-NBR NOT EQUAL SPACES                        02971499
029715        MOVE AP121-GL-ACCT-NBR            TO PV-ACCT-NBR-9        02971599
029716        IF PV-ACCT-NBR-9 NOT NUMERIC                              02971699
029717           SET AP122-REJECTION            TO TRUE                 02971799
029718           SET PS-INVALID-DATA            TO TRUE                 02971899
029719           MOVE 'ACCOUNT NUMBER'          TO AP122-ERROR-FIELD    02971999
029720           MOVE AP121-GL-ACCT-NBR         TO AP122-ERROR-VALUE    02972099
029721           MOVE PC-NOT-NUMERIC-MSG        TO AP122-ERROR-MESSAGE  02972199
029722           PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                 02972299
029723        END-IF                                                    02972399
029724     END-IF.                                                      02972499
029725                                                                  02972599
029726     MOVE AP121-OFFSET-CDE TO PV-VALIDATE-OFFSET-CDE.             02972699
029727     IF  PV-OFFSET-CDE-VALID                                      02972799
029728         CONTINUE                                                 02972899
029729     ELSE                                                         02972999
029730         SET AP122-REJECTION            TO TRUE                   02973099
029731         SET PS-INVALID-DATA            TO TRUE                   02973199
029732         MOVE 'OFFSET CODE'             TO AP122-ERROR-FIELD      02973299
029733         MOVE AP121-OFFSET-CDE          TO AP122-ERROR-VALUE      02973399
029734         MOVE PC-INVALID-VALUE-MSG      TO AP122-ERROR-MESSAGE    02973499
029735         PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                   02973599
029736     END-IF.                                                      02973699
029737                                                                  02973799
029738     IF AP121-STR-NBR NOT EQUAL SPACES                            02973899
029739        MOVE AP121-STR-NBR                TO PV-STR-NBR-9         02973999
029740        IF PV-STR-NBR-9 NOT NUMERIC                               02974099
029741           SET AP122-REJECTION            TO TRUE                 02974199
029742           SET PS-INVALID-DATA            TO TRUE                 02974299
029743           MOVE 'STORE NUMBER'            TO AP122-ERROR-FIELD    02974399
029744           MOVE AP121-STR-NBR             TO AP122-ERROR-VALUE    02974499
029745           MOVE PC-NOT-NUMERIC-MSG        TO AP122-ERROR-MESSAGE  02974599
029746           PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                 02974699
029747        END-IF                                                    02974799
029748     END-IF.                                                      02974899
029749                                                                  02974999
029750     IF AP121-CL-NBR NOT EQUAL SPACES                             02975099
029751        MOVE AP121-CL-NBR                 TO PV-CL-NBR-9          02975199
029752        IF PV-CL-NBR-9 NOT NUMERIC                                02975299
029753           SET AP122-REJECTION            TO TRUE                 02975399
029754           SET PS-INVALID-DATA            TO TRUE                 02975499
029755           MOVE 'CLASS NUMBER'            TO AP122-ERROR-FIELD    02975599
029756           MOVE AP121-CL-NBR              TO AP122-ERROR-VALUE    02975699
029757           MOVE PC-NOT-NUMERIC-MSG        TO AP122-ERROR-MESSAGE  02975799
029758           PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                 02975899
029759        END-IF                                                    02975999
029760     END-IF.                                                      02976099
029761                                                                  02976199
029762     IF AP121-SKU-NBR NOT EQUAL SPACES                            02976299
029763        MOVE AP121-SKU-NBR                TO PV-SKU-NBR-9         02976399
029764        IF PV-SKU-NBR-9 NOT NUMERIC                               02976499
029765           SET AP122-REJECTION            TO TRUE                 02976599
029766           SET PS-INVALID-DATA            TO TRUE                 02976699
029767           MOVE 'SKU NUMBER'              TO AP122-ERROR-FIELD    02976799
029768           MOVE AP121-SKU-NBR             TO AP122-ERROR-VALUE    02976899
029769           MOVE PC-NOT-NUMERIC-MSG        TO AP122-ERROR-MESSAGE  02976999
029770           PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                 02977099
029771        END-IF                                                    02977199
029772     END-IF.                                                      02977299
029773                                                                  02977399
029774     PERFORM C775-INITIALIZE-FIELDS.                              02977499
029775     MOVE PV-GRO-COST-AMT                 TO PV-NUMBER-W-DECIMAL. 02977599
029776     PERFORM C700-VALIDATE-ZERO-AMT.                              02977699
029777     IF PS-AMOUNT-ZEROS                                           02977799
029778        SET PS-GRO-COST-AMT-ZEROS         TO TRUE                 02977899
029779        MOVE '.00'                        TO PV-GRO-COST-AMT      02977999
029780     ELSE                                                         02978099
029781        SET PS-GRO-COST-AMT-NOT-ZEROS     TO TRUE                 02978199
029782     END-IF.                                                      02978299
029783     PERFORM C750-VALIDATE-AMOUNT.                                02978399
029784     IF PS-INVALID-AMT                                            02978499
029785        MOVE 'GROSS AMOUNT'               TO AP122-ERROR-FIELD    02978599
029786        MOVE AP121-GRO-COST-AMT           TO AP122-ERROR-VALUE    02978699
029787        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02978799
029788     END-IF.                                                      02978899
029789                                                                  02978999
029790     PERFORM C775-INITIALIZE-FIELDS.                              02979099
029791     MOVE PV-RETL-AMT                     TO PV-NUMBER-W-DECIMAL. 02979199
029792     PERFORM C700-VALIDATE-ZERO-AMT.                              02979299
029793     IF PS-AMOUNT-ZEROS                                           02979399
029794        SET PS-RETL-AMT-ZEROS             TO TRUE                 02979499
029795        MOVE '.00'                        TO PV-RETL-AMT          02979599
029796     ELSE                                                         02979699
029797        SET PS-RETL-AMT-NOT-ZEROS         TO TRUE                 02979799
029798     END-IF.                                                      02979899
029799     PERFORM C750-VALIDATE-AMOUNT.                                02979999
029800     IF PS-INVALID-AMT                                            02980099
029801        MOVE 'RETAIL AMOUNT'              TO AP122-ERROR-FIELD    02980199
029802        MOVE AP121-RETL-AMT               TO AP122-ERROR-VALUE    02980299
029803        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02980399
029812     END-IF.                                                      02981299
029813                                                                  02981399
029815     PERFORM C775-INITIALIZE-FIELDS.                              02981599
029816     MOVE PV-FRGT-AMT                     TO PV-NUMBER-W-DECIMAL. 02981699
029817     PERFORM C700-VALIDATE-ZERO-AMT.                              02981799
029818     IF PS-AMOUNT-ZEROS                                           02981899
029819        SET PS-FRGT-AMT-ZEROS             TO TRUE                 02981999
029820        MOVE '.00'                        TO PV-FRGT-AMT          02982099
029821     ELSE                                                         02982199
029822        SET PS-FRGT-AMT-NOT-ZEROS         TO TRUE                 02982299
029823     END-IF.                                                      02982399
029824     PERFORM C750-VALIDATE-AMOUNT.                                02982499
029825     IF PS-INVALID-AMT                                            02982599
029826        MOVE 'FREIGHT AMOUNT'             TO AP122-ERROR-FIELD    02982699
029827        MOVE AP121-FRGT-AMT               TO AP122-ERROR-VALUE    02982799
029828        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02982899
029840     END-IF.                                                      02984099
029841                                                                  02984199
029842     PERFORM C775-INITIALIZE-FIELDS.                              02984299
029843     MOVE PV-MISC-CHRG-AMT                TO PV-NUMBER-W-DECIMAL. 02984399
029844     PERFORM C700-VALIDATE-ZERO-AMT.                              02984499
029845     IF PS-AMOUNT-ZEROS                                           02984599
029846        SET PS-MISC-CHRG-AMT-ZEROS        TO TRUE                 02984699
029847        MOVE '.00'                        TO PV-MISC-CHRG-AMT     02984799
029848     ELSE                                                         02984899
029849        SET PS-MISC-CHRG-AMT-NOT-ZEROS    TO TRUE                 02984999
029850     END-IF.                                                      02985099
029851     PERFORM C750-VALIDATE-AMOUNT.                                02985199
029852     IF PS-INVALID-AMT                                            02985299
029853        MOVE 'MISC CHARGE AMOUNT'         TO AP122-ERROR-FIELD    02985399
029854        MOVE AP121-MISC-CHRG-AMT          TO AP122-ERROR-VALUE    02985499
029855        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02985599
029865     END-IF.                                                      02986599
029866                                                                  02986699
029867     PERFORM C775-INITIALIZE-FIELDS.                              02986799
029868     MOVE PV-DISC-AMT                     TO PV-NUMBER-W-DECIMAL. 02986899
029869     PERFORM C700-VALIDATE-ZERO-AMT.                              02986999
029870     IF PS-AMOUNT-ZEROS                                           02987099
029871        SET PS-DISC-AMT-ZEROS             TO TRUE                 02987199
029872        MOVE '.00'                        TO PV-DISC-AMT          02987299
029873     ELSE                                                         02987399
029874        SET PS-DISC-AMT-NOT-ZEROS         TO TRUE                 02987499
029875     END-IF.                                                      02987599
029876     PERFORM C750-VALIDATE-AMOUNT.                                02987699
029877     IF PS-INVALID-AMT                                            02987799
029878        MOVE 'DISCOUNT AMOUNT'            TO AP122-ERROR-FIELD    02987899
029879        MOVE AP121-DISC-AMT               TO AP122-ERROR-VALUE    02987999
029880        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02988099
029889     END-IF.                                                      02988999
029890                                                                  02989099
029891     PERFORM C775-INITIALIZE-FIELDS.                              02989199
029892     MOVE PV-NET-COST-AMT                 TO PV-NUMBER-W-DECIMAL. 02989299
029893     PERFORM C700-VALIDATE-ZERO-AMT.                              02989399
029894     IF PS-AMOUNT-ZEROS                                           02989499
029895        SET PS-NET-COST-AMT-ZEROS         TO TRUE                 02989599
029896        MOVE '.00'                        TO PV-NET-COST-AMT      02989699
029897     ELSE                                                         02989799
029898        SET PS-NET-COST-AMT-NOT-ZEROS     TO TRUE                 02989899
029899     END-IF.                                                      02989999
029900     PERFORM C750-VALIDATE-AMOUNT.                                02990099
029901     IF PS-INVALID-AMT                                            02990199
029902        MOVE 'NET COST AMOUNT'            TO AP122-ERROR-FIELD    02990299
029903        MOVE AP121-NET-COST-AMT           TO AP122-ERROR-VALUE    02990399
029904        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02990499
029917     END-IF.                                                      02991799
029918                                                                  02991899
029919     IF PS-GRO-COST-AMT-ZEROS AND                                 02991999
029920        PS-RETL-AMT-ZEROS AND                                     02992099
029921        PS-FRGT-AMT-ZEROS AND                                     02992199
029922        PS-MISC-CHRG-AMT-ZEROS AND                                02992299
029923        PS-DISC-AMT-ZEROS AND                                     02992399
029924        PS-NET-COST-AMT-ZEROS                                     02992499
029925        SET AP122-WARNING                 TO TRUE                 02992599
029926        SET PS-INVALID-DATA               TO TRUE                 02992699
029927        MOVE SPACES                       TO AP122-ERROR-FIELD    02992799
029928                                             AP122-ERROR-VALUE    02992899
029929        MOVE 'ALL INPUT AMOUNTS EQUAL TO 0.00'                    02992999
029930          TO AP122-ERROR-MESSAGE                                  02993099
029931        PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                    02993199
029932     END-IF.                                                      02993299
029933                                                                  02993399
029933* IF THE DOC NUMBER CONTAINS LEADING BLANKS, REMOVE THEM          02993499
571600     IF AP121-DOC-NBR NOT = SPACES                                02993599
571600         INITIALIZE                PV-START                       02993699
571900                                   PV-LENGTH                      02993799
163300         MOVE AP121-DOC-NBR        TO PV-DOC-NBR                  02993899
163300         INSPECT PV-DOC-NBR TALLYING PV-START                     02994099
163300                                   FOR LEADING SPACE              02994199
163300         IF PV-START > 0                                          02994299
163300             COMPUTE PV-LENGTH = 16 - PV-START                    02994499
163300             ADD 1                 TO PV-START                    02994599
163300             MOVE PV-DOC-NBR(PV-START:PV-LENGTH)                  02994699
163300                                   TO AP121-DOC-NBR               02994799
029933          END-IF                                                  02995199
029933     END-IF.                                                      02995299
029933                                                                  02995399
029934     IF PS-VALID-DATA-SW = 'N'                                    02995499
029935        CONTINUE                                                  02995599
029936     ELSE                                                         02995699
029937        SET PS-VALID-DATA                 TO TRUE                 02995799
029938     END-IF.                                                      02995899
029939                                                                  02995999
029940*----------------------------------------------------------------*02996099
029941* VALIDATE THAT AMOUNTS ARE NOT ALL ZEROS                        *02996199
029942*----------------------------------------------------------------*02996299
029943 C700-VALIDATE-ZERO-AMT.                                          02996399
029944                                                                  02996499
029945     INITIALIZE PV-BEFORE-DECIMAL                                 02996599
029946                PV-AFTER-DECIMAL.                                 02996699
029947                                                                  02996799
029948     INSPECT PV-NUMBER-W-DECIMAL REPLACING FIRST '-' BY ZERO.     02996899
029949     INSPECT PV-NUMBER-W-DECIMAL REPLACING FIRST '+' BY ZERO.     02996999
029950     INSPECT PV-NUMBER-W-DECIMAL REPLACING LEADING SPACES BY ZERO.02997099
029951     UNSTRING PV-NUMBER-W-DECIMAL DELIMITED BY '.'                02997199
029952         INTO PV-BEFORE-DECIMAL                                   02997299
029953              PV-AFTER-DECIMAL.                                   02997399
029954                                                                  02997499
029957     IF (PV-BEFORE-DECIMAL = '000000000' AND                      02997599
029958         PV-AFTER-DECIMAL = '00')                                 02997699
029959        SET PS-AMOUNT-ZEROS              TO TRUE                  02997799
029960     ELSE                                                         02997899
029961        SET PS-AMOUNT-NOT-ZEROS          TO TRUE                  02997999
029962     END-IF.                                                      02998099
029963                                                                  02998199
029964*----------------------------------------------------------------*02998299
029965* VALIDATE THAT AMOUNTS ARE NUMERIC AND CONTAIN A DECIMAL POINT  *02998399
029966*----------------------------------------------------------------*02998499
029967 C750-VALIDATE-AMOUNT.                                            02998599
029968                                                                  02998699
029969     IF (PV-BEFORE-DECIMAL > SPACES AND                           02998799
029970         PV-BEFORE-DECIMAL IS NOT NUMERIC) OR                     02998899
029971         PV-AFTER-DECIMAL IS NOT NUMERIC                          02998999
029972         SET AP122-REJECTION              TO TRUE                 02999099
029973         SET PS-INVALID-DATA              TO TRUE                 02999199
029974         SET PS-INVALID-AMT               TO TRUE                 02999299
029975         MOVE PC-NOT-NUMERIC-MSG          TO AP122-ERROR-MESSAGE  02999399
029976     ELSE                                                         02999499
029977        SET PS-VALID-AMT                  TO TRUE                 02999599
029978     END-IF.                                                      02999699
029979                                                                  02999799
029980*----------------------------------------------------------------*02999899
029981* INITIALIZE COMMON FIELDS                                       *02999999
029982*----------------------------------------------------------------*03000099
029983 C775-INITIALIZE-FIELDS.                                          03000199
029984                                                                  03000299
029985     INITIALIZE PS-AMOUNT-SW                                      03000399
029986                PV-NUMBER-W-DECIMAL.                              03000499
029988                                                                  03000599
029989*----------------------------------------------------------------*03000699
029990* READS THE INPUT ADJUSTMENT UPLOAD FILE                         *03000799
029991*----------------------------------------------------------------*03000899
029992 R100-READ-ADJUST-UPLOAD-FILE.                                    03000999
029993                                                                  03001099
029994     READ ADJUST-UPLOAD-FILE INTO AP121-TRANSACTION-FILE          03001199
029995       AT END                                                     03001299
029996          SET ADJUST-UPLOAD-EOF   TO TRUE                         03002099
030000       NOT AT END                                                 03010005
030200        ADD 1                     TO PC-REC-READ-CNT              03020005
030210        IF (AP121-DOC-NBR >= '0' AND                              03021099
030220           AP121-DOC-NBR <= PC-ZERO-DOC-NBR)                      03022099
030230            MOVE PC-ZERO-DOC-NBR       TO AP121-DOC-NBR           03023099
030240        END-IF                                                    03024099
030300     END-READ.                                                    03030005
030301                                                                  03030199
030302     INITIALIZE PS-VALID-DATA-SW.                                 03030299
030310     MOVE AP121-GRO-COST-AMT           TO PV-GRO-COST-AMT.        03031099
030320     MOVE AP121-RETL-AMT               TO PV-RETL-AMT.            03032099
030330     MOVE AP121-FRGT-AMT               TO PV-FRGT-AMT.            03033099
030340     MOVE AP121-MISC-CHRG-AMT          TO PV-MISC-CHRG-AMT.       03034099
030350     MOVE AP121-DISC-AMT               TO PV-DISC-AMT.            03035099
030360     MOVE AP121-NET-COST-AMT           TO PV-NET-COST-AMT.        03036099
030400                                                                  03040002
030410*----------------------------------------------------------------*03041003
030420* SELECT BATCH CONTROL VALUES                                    *03042003
030440*----------------------------------------------------------------*03044003
030450 S050-SELECT-BTCH-CNTRL.                                          03045003
030460                                                                  03046003
030470     EXEC SQL                                                     03047003
030480         SELECT BTCH_PRC_DTE                                      03048003
030490              , CURR_PSTG_FYR_NBR                                 03049003
030491              , CURR_PSTG_FMN_NBR                                 03049103
030492              , CURR_PSTG_FWK_NBR                                 03049203
030493              , PREV_PSTG_FYR_NBR                                 03049303
030494              , PREV_PSTG_FMN_NBR                                 03049403
030495              , PREV_PSTG_FWK_NBR                                 03049503
030496              , MULT_PSTG_PER_IND                                 03049603
030497           INTO :APCNTL-BTCH-PRC-DTE                              03049713
030498              , :APCNTL-CURR-PSTG-FYR-NBR                         03049813
030499              , :APCNTL-CURR-PSTG-FMN-NBR                         03049903
030500              , :APCNTL-CURR-PSTG-FWK-NBR                         03050003
030501              , :APCNTL-PREV-PSTG-FYR-NBR                         03050103
030502              , :APCNTL-PREV-PSTG-FMN-NBR                         03050203
030503              , :APCNTL-PREV-PSTG-FWK-NBR                         03050303
030504              , :APCNTL-MULT-PSTG-PER-IND                         03050403
030505           FROM TAPCNTL                                           03050503
030506     END-EXEC.                                                    03050603
030510                                                                  03051002
030520     EVALUATE TRUE                                                03052003
030521       WHEN SQLCODE = ZERO                                        03052103
030522         CONTINUE                                                 03052203
030523       WHEN OTHER                                                 03052303
030524         MOVE 'S050-SELECT-BTCH-CNTRL'   TO AA-PARAGRAPH-NAME     03052403
030525         MOVE 'UNSUCCESSFUL SELECT'      TO AA-DB2-OPERATION      03052503
030526         MOVE 'TAPCNTL'                  TO AA-DB2-TABLE-1        03052603
030527         MOVE SPACES                     TO AA-DB2-TABLE-2        03052703
030528         PERFORM Z999-DB2-ABEND                                   03052803
030530     END-EVALUATE.                                                03053003
030540                                                                  03054003
032410*----------------------------------------------------------------*03241005
032420* SELECT TRANSACTION CODE DATA                                   *03242005
032430*----------------------------------------------------------------*03243005
032440 S100-SELECT-TRNCDE-DATA.                                         03244014
032450                                                                  03245005
032453     EXEC SQL                                                     03245305
032454         SELECT PSTG_TYP_CDE                                      03245405
032455              , TRN_TYP_CDE                                       03245505
032456              , BTCH_SRC_CDE                                      03245605
032457              , AUTO_OFFST_TRN_CDE                                03245705
032458              , GL_ACCT_NBR                                       03245805
032460           INTO :TRNCDE-PSTG-TYP-CDE                              03246005
032461              , :TRNCDE-TRN-TYP-CDE                               03246105
032462              , :TRNCDE-BTCH-SRC-CDE                              03246205
032463              , :TRNCDE-AUTO-OFFST-TRN-CDE                        03246305
032464              , :TRNCDE-GL-ACCT-NBR                               03246405
032467           FROM TTRNCDE                                           03246705
032468          WHERE AP_TRN_CDE = :AP121-AP-TRN-CDE                    03246805
032469            AND TRN_SRC_CDE IN ('O','A')                          03246905
032470            AND CURRENT DATE BETWEEN EFF_STRT_DTE AND EFF_END_DTE 03247005
032471     END-EXEC.                                                    03247105
032480                                                                  03248005
032490     EVALUATE TRUE                                                03249005
032491       WHEN SQLCODE = ZERO                                        03249105
032492         SET PS-TRNCDE-FOUND             TO TRUE                  03249205
032493         PERFORM C100-MOVE-ORIG-TRNCDE-VALUES                     03249323
032494       WHEN SQLCODE = +100                                        03249405
032495         SET PS-TRNCDE-NOT-FOUND         TO TRUE                  03249505
032496         SET AP122-REJECTION             TO TRUE                  03249615
032497         MOVE 'TRAN CODE'                TO AP122-ERROR-FIELD     03249710
032498         MOVE AP121-AP-TRN-CDE           TO AP122-ERROR-VALUE     03249810
032499         MOVE PC-NOT-FOUND-MSG           TO AP122-ERROR-MESSAGE   03249934
032501         PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                   03250105
032503       WHEN OTHER                                                 03250305
032504         MOVE 'S100-SELECT-TRNCDE-DATA'  TO AA-PARAGRAPH-NAME     03250414
032505         MOVE 'UNSUCCESSFUL SELECT'      TO AA-DB2-OPERATION      03250505
032506         MOVE 'TRNCDE'                   TO AA-DB2-TABLE-1        03250605
032507         MOVE SPACES                     TO AA-DB2-TABLE-2        03250705
032508         PERFORM Z999-DB2-ABEND                                   03250805
032509     END-EVALUATE.                                                03250905
032510                                                                  03251005
032511*----------------------------------------------------------------*03251105
032512* SELECT VENDOR DATA                                             *03251205
032520*----------------------------------------------------------------*03252005
033100 S200-SELECT-VENDOR-DATA.                                         03310006
033200                                                                  03320002
034000     EXEC SQL                                                     03400005
034100         SELECT B.ENT_ID                                          03410008
034200              , A.ENT_NAME_DESC                                   03420005
034210              , B.STATUS_CDE                                      03421005
034300           INTO :EXTENT-ENT-ID                                    03430005
034400              , :ENTNME-ENT-NAME-DESC                             03440005
034410              , :EXTENT-STATUS-CDE                                03441006
034500           FROM TENTNME A                                         03450005
034600              , TEXTENT B                                         03460005
034700          WHERE A.ENT_ID = B.ENT_ID                               03470005
034800            AND B.DUN_NBR = :AP121-VND-NBR                        03480005
034900            AND A.TYPE_CDE = '01'                                 03490005
035000     END-EXEC.                                                    03500005
035100                                                                  03510002
035200     EVALUATE TRUE                                                03520006
035300       WHEN SQLCODE = ZERO                                        03530006
035301            SET PS-VENDOR-FOUND           TO TRUE                 03530147
035302         IF EXTENT-STATUS-CDE = 'I'                               03530206
035304            SET AP122-WARNING             TO TRUE                 03530415
035305            MOVE PC-VNDR-FIELD            TO AP122-ERROR-FIELD    03530510
035306            MOVE AP121-VND-NBR            TO AP122-ERROR-VALUE    03530610
035307            MOVE PC-INACTIVE              TO AP122-ERROR-MESSAGE  03530783
035309            PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                03530939
035311         END-IF                                                   03531106
035312       WHEN SQLCODE = +100                                        03531206
035313         SET PS-VENDOR-NOT-FOUND          TO TRUE                 03531310
035314         SET AP122-REJECTION              TO TRUE                 03531415
035315         MOVE PC-VNDR-FIELD               TO AP122-ERROR-FIELD    03531510
035316         MOVE AP121-VND-NBR               TO AP122-ERROR-VALUE    03531610
035317         MOVE PC-NOT-FOUND-MSG            TO AP122-ERROR-MESSAGE  03531734
035318         PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                   03531806
035320       WHEN OTHER                                                 03532006
035330         MOVE 'S200-SELECT-VENDOR-DATA'   TO AA-PARAGRAPH-NAME    03533010
035340         MOVE 'UNSUCCESSFUL SELECT'       TO AA-DB2-OPERATION     03534010
035350         MOVE 'TENTNME'                   TO AA-DB2-TABLE-1       03535010
035360         MOVE 'TEXTENT'                   TO AA-DB2-TABLE-2       03536010
035370         PERFORM Z999-DB2-ABEND                                   03537006
035400     END-EVALUATE.                                                03540006
035500                                                                  03550006
038500*----------------------------------------------------------------*03850006
038600* SELECT THE NEXT AVAILABLE DOC NUMBER FROM THE TAPCNTL TABLE    *03860006
038700*----------------------------------------------------------------*03870006
038800 S300-GET-NEXT-DOC-NBR.                                           03880006
038900                                                                  03890006
039000     CALL WS-CALL-DPKUP151 USING WS151-DOC-NBR-PARAMETERS.        03900099
039100                                                                  03910006
039200     IF WS151-ERRORS-FOUND                                        03920006
039300        SET AC-BAD-DATA               TO TRUE                     03930006
039400        MOVE 'S300-GET-NEXT-DOC-NBR'  TO AA-PARAGRAPH-NAME        03940006
039500        MOVE WS151-ERROR-MESSAGE      TO AA-MESSAGE-1             03950006
039600        MOVE WS151-SQLCODE            TO AA-MESSAGE-2             03960006
039700        PERFORM Z998-ABEND                                        03970010
039710     ELSE                                                         03971010
039720        SET PS-WS151-DOC-NBR-FOUND    TO TRUE                     03972010
039800     END-IF.                                                      03980006
039900                                                                  03990006
039910*----------------------------------------------------------------*03991019
039920* SELECT OFFSET TRANSACTION CODE DATA                            *03992019
039930*----------------------------------------------------------------*03993019
039940 S400-SELECT-OFFSET-TRNCDE.                                       03994019
039950                                                                  03995019
039953     EXEC SQL                                                     03995319
039954         SELECT PSTG_TYP_CDE                                      03995419
039955              , TRN_TYP_CDE                                       03995519
039956              , BTCH_SRC_CDE                                      03995619
039957              , AUTO_OFFST_TRN_CDE                                03995719
039958              , GL_ACCT_NBR                                       03995819
039959              , TRN_SRC_CDE                                       03995929
039960           INTO :TRNCDE-PSTG-TYP-CDE                              03996022
039961              , :TRNCDE-TRN-TYP-CDE                               03996122
039962              , :TRNCDE-BTCH-SRC-CDE                              03996222
039963              , :TRNCDE-AUTO-OFFST-TRN-CDE                        03996322
039964              , :TRNCDE-GL-ACCT-NBR                               03996422
039965              , :TRNCDE-TRN-SRC-CDE                               03996529
039966           FROM TTRNCDE                                           03996619
039967          WHERE AP_TRN_CDE = :PV-HOLD-OFFST-TRNCDE                03996799
039968            AND CURRENT DATE BETWEEN EFF_STRT_DTE AND EFF_END_DTE 03996819
039969     END-EXEC.                                                    03996919
039970                                                                  03997019
039971     EVALUATE TRUE                                                03997119
039972       WHEN SQLCODE = ZERO                                        03997219
039973         SET PS-OFFSET-TRNCDE-FOUND        TO TRUE                03997319
039974       WHEN SQLCODE = +100                                        03997419
039975         SET PS-OFFSET-TRNCDE-NOT-FOUND    TO TRUE                03997519
039976         SET AP122-REJECTION               TO TRUE                03997619
039977         MOVE 'OFFSET TRAN CODE'           TO AP122-ERROR-FIELD   03997719
039978         MOVE PV-HOLD-OFFST-TRNCDE         TO AP122-ERROR-VALUE   03997899
039979         MOVE PC-NOT-FOUND-MSG             TO AP122-ERROR-MESSAGE 03997934
039980         PERFORM C600-FORMAT-ERROR-EXCPT-RECORD                   03998019
039982       WHEN OTHER                                                 03998219
039983         MOVE 'S400-SELECT-OFFSET-TRNCDE' TO AA-PARAGRAPH-NAME    03998319
039984         MOVE 'UNSUCCESSFUL SELECT'       TO AA-DB2-OPERATION     03998419
039985         MOVE 'TRNCDE'                    TO AA-DB2-TABLE-1       03998519
039986         MOVE SPACES                      TO AA-DB2-TABLE-2       03998619
039987         PERFORM Z999-DB2-ABEND                                   03998719
039988     END-EVALUATE.                                                03998819
039990                                                                  03999019
040000*----------------------------------------------------------------*04000010
040100* WRITES TO THE ADJUSTMENT DETAIL OUTPUT FILE                    *04010010
040200*----------------------------------------------------------------*04020010
040300 W100-WRITE-ADJUST-DTL-RECORD.                                    04030023
040400                                                                  04040010
040500     WRITE ADJUST-DTL-RECORD FROM AP045-TRANSACTION-FILE.         04050010
040600     ADD 1                   TO PC-REC-WRTTN-CNT.                 04060010
040700                                                                  04070010
049300*----------------------------------------------------------------*04930002
049500* WRITES TO THE ERROR/EXCEPTION OUTPUT FILE                      *04950005
049600*----------------------------------------------------------------*04960002
049800 W200-WRITE-ERROR-EXCPT-RECORD.                                   04980023
049900                                                                  04990002
050000     WRITE ERROR-EXCPT-RECORD                                     05000005
050100           FROM AP122-ADJ-INTERFACE-EXCEPTIONS.                   05010005
050200     ADD 1 TO PC-REC-EXCPT-CNT.                                   05020005
050210     INITIALIZE AP122-ERROR-TYP-CDE                               05021081
050220                AP122-ERROR-FIELD                                 05022081
050230                AP122-ERROR-VALUE                                 05023081
050240                AP122-ERROR-MESSAGE.                              05024081
050300                                                                  05030002
050500*----------------------------------------------------------------*05050002
050600* ABEND ROUTINE                                                  *05060004
050800*----------------------------------------------------------------*05080002
050900 Z998-ABEND.                                                      05090002
051000                                                                  05100002
051100     DISPLAY AA-ABEND-LIT.                                        05110004
051200     DISPLAY AA-PROGRAM-LIT.                                      05120004
051300     DISPLAY AA-PARAGRAPH-LIT.                                    05130004
051400     DISPLAY AA-MESSAGE-LINE.                                     05140004
051600                                                                  05160002
051610     COPY DPPD004.                                                05161004
051700     CALL 'ILBOABN0' USING ABEND-CODE.                            05170002
051800                                                                  05180002
051900*----------------------------------------------------------------*05190002
052000* DB2 ABEND ROUTINE                                              *05200004
052100*----------------------------------------------------------------*05210002
052300 Z999-DB2-ABEND.                                                  05230004
052400                                                                  05240002
052500     DISPLAY AA-ABEND-LIT.                                        05250004
052600     DISPLAY AA-DB2-ERROR-LIT.                                    05260004
052700     DISPLAY AA-PROGRAM-LIT.                                      05270004
052800     DISPLAY AA-PARAGRAPH-LIT.                                    05280004
052900     DISPLAY AA-DB2-OPERATION-LIT.                                05290004
052910     DISPLAY AA-DB2-TABLE-1.                                      05291004
052920     DISPLAY AA-DB2-TABLE-2.                                      05292004
052930     SET AP-DB2-ERROR                 TO TRUE.                    05293004
053400                                                                  05340002
053500     COPY DPPD004.                                                05350002
053600     CALL 'ILBOABN0' USING ABEND-CODE.                            05360002
