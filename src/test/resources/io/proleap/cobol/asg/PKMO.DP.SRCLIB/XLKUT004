000100 IDENTIFICATION DIVISION.                                                 
000200 TITLE 'LOGISTICS DOMAIN DEPT ACCESS MODULE'.                             
000300 PROGRAM-ID.   XLKUT004.                                                  
000400 AUTHOR.        DENNIS STEFFEN.                                           
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
000600 DATE-WRITTEN.  APRIL 2002.                                               
000700 DATE-COMPILED.                                                           
000800 ENVIRONMENT DIVISION.                                                    
000900 CONFIGURATION SECTION.                                                   
001000 SOURCE-COMPUTER. IBM-3090.                                               
001100 OBJECT-COMPUTER. IBM-3090.                                               
001200                                                                          
001300 DATA DIVISION.                                                           
001400 WORKING-STORAGE SECTION.                                                 
001500 01  PV-STUFF.                                                            
001600     05  PV-NULL-IND                  PIC S9(4) VALUE ZERO                
001700                                                COMP SYNC.                
001800     05  PV-CURRENT-DATE              PIC X(10) VALUE SPACES.             
001900     05  PV-RETRY-COUNTER             PIC S9(04) VALUE +0                 
002000                                                COMP SYNC.                
002100     05  PV-DEPT-NBR-N                PIC 9(04).                          
002200     05  PV-DEPT-NBR-A REDEFINES PV-DEPT-NBR-N.                           
002300         10  FILLER                   PIC X.                              
002400         10  PV-DEPT-NBR-3CH          PIC X(03).                          
002500     05  PV-MAJ-CL-NBR-N              PIC 9(04).                          
002600     05  PV-MAJ-CL-NBR-A REDEFINES PV-MAJ-CL-NBR-N.                       
002700         10  FILLER                   PIC X(02).                          
002800         10  PV-MAJ-CL-NBR-2CH        PIC X(02).                          
002900     05  PV-SUB-CL-NBR-N              PIC 9(04).                          
003000     05  PV-SUB-CL-NBR-A REDEFINES PV-SUB-CL-NBR-N.                       
003100         10  FILLER                   PIC X(02).                          
003200         10  PV-SUB-CL-NBR-2CH        PIC X(02).                          
003300                                                                          
003500                                                                          
003800 01  PC-CONSTANTS.                                                        
003900     05  PC-MAX-RETRIES              PIC S9(04) VALUE +3                  
004000                                                COMP.                     
004200/                                                                         
004300*  XLK_BUS_AREA                                                           
004400     EXEC SQL                                                             
004500         INCLUDE XLT00000                                                 
004600     END-EXEC.                                                            
006300                                                                          
006301*  XLK_BUS_GP                                                             
006302     EXEC SQL                                                             
006303         INCLUDE XLT00001                                                 
006304     END-EXEC.                                                            
006305                                                                          
006310*  XLK_DEPT                                                               
006320     EXEC SQL                                                             
006330         INCLUDE XLT00002                                                 
006340     END-EXEC.                                                            
006350                                                                          
006391                                                                          
006400     EXEC SQL                                                             
006500          INCLUDE SQLCA                                                   
006600     END-EXEC.                                                            
006700                                                                          
006800                                                                          
006900 LINKAGE SECTION.                                                         
007000     COPY XLWS004.                                                        
007100/                                                                         
007200                                                                          
007300 PROCEDURE DIVISION USING XL004-DEPT-COMMAREA.                            
007400                                                                          
007500     SET XL004-SUCCESSFUL        TO TRUE                                  
007600     INITIALIZE DCLXLT00000                                               
007700                DCLXLT00001                                               
007800                DCLXLT00002                                               
008100                                                                          
008200     PERFORM 1000-VERIFY-INPUT.                                           
008210                                                                          
008300     IF XL004-SUCCESSFUL                                                  
008400         PERFORM 2000-GET-DEPT-DATA                                       
008500     END-IF.                                                              
009400                                                                          
009600     PERFORM 9000-BUILD-OUTPUT.                                           
009800                                                                          
009900     MOVE SQLCA                       TO XL004-SQLCA                      
010000     GOBACK.                                                              
010100/                                                                         
010110 1000-VERIFY-INPUT.                                                       
010120     IF XL004-DEPT-NBR > ZERO                                             
010130         CONTINUE                                                         
010140     ELSE                                                                 
010150         SET XL004-INVALID-INPUT      TO TRUE                             
010160     END-IF.                                                              
010170                                                                          
010180 2000-GET-DEPT-DATA.                                                      
031100     PERFORM 7000-SELECT-DEPT.                                            
031101                                                                          
031110 7000-SELECT-DEPT.                                                        
031200                                                                          
031300     PERFORM                                                              
031400         WITH TEST AFTER                                                  
031500         VARYING PV-RETRY-COUNTER                                         
031600         FROM 1 BY 1                                                      
031700         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                          
031800            OR (SQLCODE = ZERO OR +100)                                   
031900                                                                          
032000         EXEC SQL                                                         
032100             SELECT                                                       
032200                DP.DEPT_NM                                                
032300             ,  DP.MDSE_LNE_CDE                                           
032400             ,  DP.BUS_GP_NBR                                             
032500             ,  DP.STR_ZN_CDE                                             
032600             ,  GP.BUS_AREA_ID                                            
032700             ,  GP.BUS_GP_DESC                                            
032800             ,  ID.BUS_AREA_DESC                                          
032900                                                                          
032910         INTO                                                             
032920                                                                          
032921                :XLT00002-DEPT-NM                                         
032922             ,  :XLT00002-MDSE-LNE-CDE                                    
032923             ,  :XLT00002-BUS-GP-NBR                                      
032924             ,  :XLT00002-STR-ZN-CDE                                      
032925             ,  :XLT00001-BUS-AREA-ID                                     
032926             ,  :XLT00001-BUS-GP-DESC                                     
032927             ,  :XLT00000-BUS-AREA-DESC                                   
032930                                                                          
033000         FROM                                                             
033010              XLT_DEPT         DP                                         
033100         ,    XLT_BUS_GP       GP                                         
033200         ,    XLT_BUS_AREA     ID                                         
033300                                                                          
033400         WHERE                                                            
033500             DP.BUS_GP_NBR       = GP.BUS_GP_NBR                          
033600        AND  GP.BUS_AREA_ID      = ID.BUS_AREA_ID                         
033700                                                                          
033800        AND  DP.DEPT_NBR         = :XL004-DEPT-NBR                        
033900                                                                          
034000         END-EXEC                                                         
036000                                                                          
036100         EVALUATE TRUE                                                    
036200             WHEN SQLCODE = ZERO                                          
036300             WHEN SQLCODE = -904                                          
036400             WHEN SQLCODE = -913                                          
036500             WHEN SQLCODE = -911                                          
036600                 CONTINUE                                                 
036200             WHEN SQLCODE = +100                                          
                       SET XL004-NOT-FOUND TO TRUE                              
036700             WHEN SQLWARN0 NOT = SPACES                                   
036800             WHEN SQLCODE NOT = ZERO                                      
036900                 MOVE +4          TO PV-RETRY-COUNTER                     
037000         END-EVALUATE                                                     
037100     END-PERFORM.                                                         
037200*                                                                         
037300     IF SQLCODE = ZERO OR +100                                            
               CONTINUE                                                         
           ELSE                                                                 
037400         IF PV-RETRY-COUNTER > PC-MAX-RETRIES                             
037500             MOVE '7000-'             TO XL004-ERROR-PARAGRAPH-NBR        
037600             SET XL004-SQL-ERROR      TO TRUE                             
037700         END-IF                                                           
037700     END-IF                                                               
                                                                                
037800     MOVE SQLCODE                 TO XL004-SQLCODE.                       
076000/                                                                         
076200 9000-BUILD-OUTPUT.                                                       
076300                                                                          
076400     MOVE XLT00002-DEPT-NM            TO XL004-DEPT-NM                    
076500     MOVE XLT00002-MDSE-LNE-CDE       TO XL004-MDSE-LNE-CDE               
076600     MOVE XLT00002-BUS-GP-NBR         TO XL004-BUS-GP-NBR                 
076700     MOVE XLT00002-STR-ZN-CDE         TO XL004-STR-ZN-CDE                 
076800     MOVE XLT00001-BUS-AREA-ID        TO XL004-BUS-AREA-ID                
078500     MOVE XLT00001-BUS-GP-DESC        TO XL004-BUS-GP-DESC                
078700     MOVE XLT00000-BUS-AREA-DESC      TO XL004-BUS-AREA-DESC.             
