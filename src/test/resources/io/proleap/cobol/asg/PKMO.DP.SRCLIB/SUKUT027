000200***************************************************************** 00020001
000300 IDENTIFICATION DIVISION.                                         00030001
000400***************************************************************** 00040001
000500 PROGRAM-ID.    SUKUT027.                                         00050001
000600 AUTHOR.        GERMAN BANDA.                                     00060001
000700 INSTALLATION.  KOHLS.                                            00070001
000800 DATE-WRITTEN   JANUARY 2000.                                     00080046
000900 DATE-COMPILED.                                                   00090001
001000***************************************************************** 00100001
001100*  THIS PROGRAM CREATES AN EXTRACT FILE OF DATA FROM THE        * 00110001
001200*  SHIPPING UNIT DATABASE(TSHPUNT) FOR THE PAST PROCESSING DATE.* 00120001
001800***************************************************************** 00180001
001900*  CHANGED MM/DD/YY BY XXXXXXXXXXX                              * 00190001
002000*   WR# XXXX XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX * 00200001
002100*                                                               * 00210001
002200***************************************************************** 00220001
002300***************************************************************** 00230001
002400 ENVIRONMENT DIVISION.                                            00240001
002500***************************************************************** 00250001
002600 INPUT-OUTPUT SECTION.                                            00260001
002700                                                                  00270001
002800 FILE-CONTROL.                                                    00280001
002900                                                                  00290001
003100     SELECT EXTRACT-FILE   ASSIGN TO OUT01.                       00310026
003200                                                                  00320001
003300***************************************************************** 00330001
003400 DATA DIVISION.                                                   00340001
003500***************************************************************** 00350001
003600 FILE SECTION.                                                    00360001
003700*                                                                 00370001
004500*                                                                 00450001
004600 FD  EXTRACT-FILE                                                 00460001
004700     RECORDING MODE IS F                                          00470001
004800     LABEL RECORDS ARE STANDARD                                   00480001
005000     BLOCK CONTAINS 0 RECORDS.                                    00500012
005200 01  EXTRACT-RECORD              PIC X(200).                      00520009
005300*                                                                 00530001
005400***************************************************************** 00540001
005500 WORKING-STORAGE SECTION.                                         00550001
005600                                                                  00560001
005700 01  PS-PROGRAM-SWITCHES.                                         00570001
006100     05  PS-NORMAL-RUN-SW             PIC X(01)  VALUE 'N'.       00610001
006200         88  PS-NORMAL-RUN                       VALUE 'Y'.       00620001
006300         88  PS-SPECIAL-RUN                      VALUE 'N'.       00630001
006400     05  PS-EOF-EXTRACT-SW            PIC X(01)  VALUE 'N'.       00640001
006500         88  PS-EOF-EXTRACT-CSR                  VALUE 'Y'.       00650001
006600         88  PS-NOT-EOF-EXTRACT-CSR              VALUE 'N'.       00660001
007500*                                                                 00750001
007600 01  PV-PROGRAM-VARIABLES.                                        00760001
007700     05 PV-EXTRACT-DTE                PIC X(10).                  00770013
007710*                                                                 00771016
007800     05 PV-CRE-DATE-TMST              PIC X(10).                  00780010
007900     05 PV-CRE-TIME-TMST              PIC X(8).                   00790010
008700*                                                                 00870001
016300     05  PV-SQLCODE                   PIC 9(9)   VALUE ZERO.      01630040
016301*                                                                 01630140
016302     05  PV-FETCH-COUNTER             PIC S9(09) VALUE ZERO       01630245
016303                                                  COMP SYNC.      01630340
016310     05  PV-WRITE-COUNTER             PIC S9(09) VALUE ZERO       01631040
016400                                                  COMP SYNC.      01640040
016500     05  PV-DISPLAY-COUNT             PIC ZZZ,ZZZ,ZZ9.            01650041
020200                                                                  02020001
020201 01  DN-DB2-NULL-INDICATORS.                                      02020148
020202     05  DN-VEH-NBR                   PIC S9(04) COMP VALUE +0.   02021048
020203                                                                  02022048
020300 01 PC-PROGRAM-CONSTANTS.                                         02030001
020400     05 PC-PROGRAM-NAME               PIC X(08)  VALUE 'SUKUT027'.02040002
021000     05  PC-DEFAULT-CC-DATE          PIC X(10) VALUE '9999-09-09'.02100001
021200                                                                  02120001
021300 01 CC-CONTROL-CARD-DATE.                                         02130008
021400    05 CC-PROCESS-DATE.                                           02140007
021500       10 CC-PROC-CC                  PIC 9(02) VALUE ZEROS.      02150007
021600       10 CC-PROC-YY                  PIC 9(02) VALUE ZEROS.      02160007
021700       10 FILLER                      PIC X(01) VALUE SPACE.      02170001
021800       10 CC-PROC-MM                  PIC 9(02) VALUE ZEROS.      02180007
021900       10 FILLER                      PIC X(01) VALUE SPACE.      02190001
022000       10 CC-PROC-DD                  PIC 9(02) VALUE ZEROS.      02200007
023300                                                                  02330001
023400 01  PV-ABEND-FIELDS.                                             02340001
023500     05  PV-ABEND-CODE                PIC S9(04) VALUE +0         02350001
023600                                                 COMP SYNC.       02360001
023700     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'SUKUT027'.02370002
023800     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    02380001
023900     05  PV-ABEND-OPERATION           PIC  X(51) VALUE SPACES.    02390009
026800******************************************************************02680001
026900*  USED FOR DB2 ERROR MESSAGE BUILDING                            02690001
027000******************************************************************02700001
027100     COPY DPWS004.                                                02710001
027200                                                                  02720001
027300******************************************************************02730001
027400*   DB2 SQL COMMUNICATION AREA                                    02740001
027500******************************************************************02750001
027600     EXEC SQL                                                     02760001
027700          INCLUDE SQLCA                                           02770001
027800     END-EXEC.                                                    02780001
027900                                                                  02790001
028000******************************************************************02800001
028100*   DB2 DCLGEN FOR COMPANY CONTROL TABLE                          02810001
028200******************************************************************02820001
028300     EXEC SQL                                                     02830001
028400          INCLUDE TCOCNTL                                         02840001
028500     END-EXEC.                                                    02850001
028600                                                                  02860001
028610******************************************************************02861027
028620*   DB2 DCLGEN                                                    02862047
028630******************************************************************02863020
028640     EXEC SQL                                                     02864020
028650          INCLUDE TSHUNLO                                         02865020
028660     END-EXEC.                                                    02866020
028670                                                                  02867020
028700******************************************************************02870001
028800*   DB2 DCLGEN FOR SHIP UNIT TABLE                                02880001
028900******************************************************************02890001
029000     EXEC SQL                                                     02900001
029100          INCLUDE TSHPUNT                                         02910001
029200     END-EXEC.                                                    02920001
029300                                                                  02930001
029400******************************************************************02940003
029500*   DB2 DCLGEN FOR PACKSLIP TABLE                                 02950003
029600******************************************************************02960003
029700     EXEC SQL                                                     02970003
029800          INCLUDE TPKSLIP                                         02980003
029900     END-EXEC.                                                    02990003
030000                                                                  03000003
030100******************************************************************03010003
030200*   DB2 DCLGEN BRIDGE BETWEEN TSHPUNT AND TPKSLIP                 03020003
030300******************************************************************03030003
030400     EXEC SQL                                                     03040003
030500          INCLUDE TINPKSU                                         03050003
030600     END-EXEC.                                                    03060003
030700                                                                  03070003
030800******************************************************************03080008
030900*   DB2 DCLGEN XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX               03090008
031000******************************************************************03100008
031100     EXEC SQL                                                     03110008
031200          INCLUDE TVHTRIP                                         03120008
031300     END-EXEC.                                                    03130008
031400                                                                  03140008
032100******************************************************************03210001
032200* EXTRACT CURSOR                                                 *03220001
032300******************************************************************03230001
032400     EXEC SQL                                                     03240001
032500          DECLARE EXTRACT-CSR CURSOR FOR                          03250001
032600          SELECT A.SHIPT_UNT_ID,                                  03260001
032700                 A.OPER_UNT_ID,                                   03270001
032710                 A.FCLTY_ID,                                            03
032800                 A.CRE_USR_ID,                                    03280003
032900                 DATE(A.CRE_TMST),                                03290031
033000                 TIME(A.CRE_TMST),                                03300031
033200                 A.TRIP_ID,                                       03320001
033500                 B.ORGN_OPER_UNT_ID,                              03350001
033510                 B.ORGN_FCLTY_ID,                                       01
033600                 B.DEST_OPER_UNT_ID,                              03360003
033601                 B.DEST_FCLTY_ID,                                       03
033610                 B.CRE_DTE,B.CRE_TM,                              03361003
033620                 D.PO_NBR,                                        03362003
033630                 D.REC_SEQ_NBR,                                   03363007
033631                 D.ASN_NBR,                                       03363128
033640                 E.OWNER_SCAC_ID,                                 03364007
033650                 E.VEH_NBR                                        03365007
033700          FROM   TSHUNLO A,                                       03370007
033710                 TSHPUNT B,                                       03371007
033720                 TINPKSU C,                                       03372007
033730                 TPKSLIP D,                                       03373021
033740                 TVHTRIP E                                        03374021
033900          WHERE A.SHIPT_UNT_ID = B.SHIPT_UNT_ID                   03390003
033901            AND A.SCN_LOC_ID       = 'RECV'                               
033910            AND A.ACTV_CDE         = 'A'                                  
034000            AND DATE(A.CRE_TMST)  =  :PV-EXTRACT-DTE              03400031
034200            AND B.SHIPT_UNT_ID     =  C.SHIPT_UNT_ID              03420003
034300            AND C.PO_NBR           =  D.PO_NBR                    03430009
034301            AND C.SEQ_NBR          =  D.SEQ_NBR                   03430137
034302            AND D.VER_STAT_CDE     =  'A'                         03430204
034303            AND E.TRIP_ID          =  A.TRIP_ID                   03430307
034304            AND B.ACTV_IND         = 'A'                                  
034305     END-EXEC.                                                    03430401
034400                                                                  03440001
035000***********************************************************       03500001
035100*  COPYBOOK USED IN CREATING EXTRACT FILE.                *       03510001
035200***********************************************************       03520001
035300     COPY SURD008.                                                03530001
035400                                                                  03540001
035500 EJECT                                                            03550001
035600***********************************************************       03560001
035700 PROCEDURE DIVISION.                                              03570001
035800***********************************************************       03580001
035900     DISPLAY '***BEGINNING SUKUT027***'.                          03590002
036000*                                                                 03600001
036100     PERFORM 1000-INITIALIZATION.                                 03610001
036200*                                                                 03620001
036300     SET PS-NOT-EOF-EXTRACT-CSR TO TRUE.                          03630001
036400     PERFORM 1900-OPEN-EXTRACT-CURSOR.                            03640001
036500*                                                                 03650001
036600     PERFORM 2000-PROCESS-EXTRACTS                                03660001
036700         UNTIL PS-EOF-EXTRACT-CSR.                                03670001
036800*                                                                 03680001
036900     PERFORM 3000-CLOSE-EXTRACT-CSR.                              03690001
037000*                                                                 03700001
037100     CLOSE EXTRACT-FILE.                                          03710002
037300*                                                                 03730001
037320*                                                                 03732040
037400     GOBACK.                                                      03740001
037500*                                                                 03750001
037600*                                                                 03760001
038601******************************************************************03860108
038602*  DO FIRST TIME PROGRAM INITIALIZATION TASKS.                    03860202
038603******************************************************************03860308
038604 1000-INITIALIZATION.                                             03860411
038607                                                                  03860708
038608     OPEN OUTPUT EXTRACT-FILE.                                    03860802
038611                                                                  03861102
038616     ACCEPT CC-CONTROL-CARD-DATE FROM SYSIN.                      03861608
038617     DISPLAY '**************************************'.            03861708
038618     DISPLAY '*        PROGRAM - SUKUT027          *'.            03861808
038619     DISPLAY '**************************************'.            03861908
038620     DISPLAY '                                      '.            03862008
038621                                                                  03862108
038622     DISPLAY 'CONTROL CARD SET-UP FOR THIS RUN IS:  '             03862208
038623             CC-CONTROL-CARD-DATE.                                03862308
038624                                                                  03862408
038630     PERFORM 1200-CHECK-CC-DATE.                                  03863009
043900***************************************************************** 04390001
044000 1200-CHECK-CC-DATE.                                              04400008
044100***************************************************************** 04410001
044300*                                                                 04430001
044400     IF CC-PROCESS-DATE IS = PC-DEFAULT-CC-DATE                   04440007
044600         SET PS-NORMAL-RUN    TO TRUE                             04460001
044601         EXEC SQL                                                 04460112
044610           SELECT DISTINCT(BTCH_PRC_DTE)                          04461012
044620             INTO :PV-EXTRACT-DTE                                 04462012
044630           FROM TCOCNTL                                           04463012
044640         END-EXEC                                                 04464012
044700     ELSE                                                         04470001
044800         SET PS-SPECIAL-RUN   TO TRUE                             04480008
044900         MOVE CC-PROCESS-DATE TO PV-EXTRACT-DTE                   04490008
045000     END-IF.                                                      04500008
045001                                                                  04500109
045002     EVALUATE TRUE                                                04500209
045003         WHEN SQLCODE = ZERO                                      04500309
045004             DISPLAY ' EXTRACT DATE IS ' PV-EXTRACT-DTE           04500435
045006         WHEN SQLWARN0 NOT = SPACES                               04500609
045007         WHEN SQLCODE < ZERO                                      04500709
045008         WHEN SQLCODE > ZERO                                      04500809
045009             MOVE '1200-CHECK-CC-DATE'                            04500909
045010                                 TO PV-ABEND-PARAGRAPH            04501013
045011             MOVE 'ATTEMPTING TO SELECT BATCH PROCESS DATE        04501116
045012-                 'FROM TCOCNTL'                                  04501209
045013                                 TO PV-ABEND-OPERATION            04501309
045020             PERFORM Z999-SQL-ABEND                               04502009
045100     END-EVALUATE.                                                04510009
046300*                                                                 04630001
068800***************************************************************** 06880001
068900 1900-OPEN-EXTRACT-CURSOR.                                        06890001
069000***************************************************************** 06900001
069400*                                                                 06940001
069500     EXEC SQL                                                     06950001
069600         OPEN EXTRACT-CSR                                         06960001
069700     END-EXEC.                                                    06970001
069800*                                                                 06980001
069900     EVALUATE TRUE                                                06990001
070000         WHEN SQLCODE = +0                                        07000001
070010             CONTINUE                                             07001044
070400         WHEN SQLWARN0 NOT = SPACE                                07040001
070500         WHEN SQLCODE  NOT = +0                                   07050001
070600             MOVE '1900-OPEN-EXTRACT-CURSOR'                      07060001
070700                                 TO PV-ABEND-PARAGRAPH            07070001
071000             PERFORM Z999-SQL-ABEND                               07100001
071100     END-EVALUATE.                                                07110001
071200*                                                                 07120001
071300*                                                                 07130001
071400***************************************************************** 07140009
071500 2000-PROCESS-EXTRACTS.                                           07150001
071600***************************************************************** 07160001
071700     MOVE '2000-PROCESS-EXTRACTS   ' TO PV-ABEND-PARAGRAPH.       07170001
071800*                                                                 07180001
071900     PERFORM 2100-FETCH-EXTRACT-CSR.                              07190001
072000*                                                                 07200001
072100     IF PS-NOT-EOF-EXTRACT-CSR                                    07210001
072200         INITIALIZE SU008-EXTRACT-RECORD                          07220001
072300         PERFORM 2200-LOAD-EXTRACT-RECORD                         07230001
072401         WRITE EXTRACT-RECORD FROM SU008-EXTRACT-RECORD           07240140
072410         ADD +1 TO PV-WRITE-COUNTER                               07241040
072600     END-IF.                                                      07260001
072700*                                                                 07270001
072800*                                                                 07280001
072900***************************************************************** 07290001
073000 2100-FETCH-EXTRACT-CSR.                                          07300001
073100***************************************************************** 07310001
073200     MOVE '2100-FETCH-EXTRACT-CSR  ' TO PV-ABEND-PARAGRAPH.       07320001
073300*                                                                 07330001
073400     EXEC SQL                                                     07340001
073500          FETCH EXTRACT-CSR                                       07350001
073600           INTO  :SHUNLO-SHIPT-UNT-ID,                            07360020
073700                 :SHUNLO-OPER-UNT-ID,                             07370001
073800                 :SHUNLO-FCLTY-ID,                                      01
074000                 :SHUNLO-CRE-USR-ID,                              07400001
074010                 :PV-CRE-DATE-TMST,                               07401031
074020                 :PV-CRE-TIME-TMST,                               07402031
074200                 :SHUNLO-TRIP-ID,                                 07420001
074500                 :SHPUNT-ORGN-OPER-UNT-ID,                        07450001
074510                 :SHPUNT-ORGN-FCLTY-ID,                                 01
074600                 :SHPUNT-DEST-OPER-UNT-ID,                        07460001
074700                 :SHPUNT-DEST-FCLTY-ID,                                 01
074810                 :SHPUNT-CRE-DTE,                                 07481025
074820                 :SHPUNT-CRE-TM,                                  07482031
074900                 :PKSLIP-PO-NBR,                                  07490004
074901                 :PKSLIP-REC-SEQ-NBR,                             07490122
074902                 :PKSLIP-ASN-NBR,                                 07490228
074903                 :VHTRIP-OWNER-SCAC-ID,                           07490328
074904                 :VHTRIP-VEH-NBR :DN-VEH-NBR                      07490448
074905     END-EXEC.                                                    07490528
074906*                                                                 07490628
074907     EVALUATE TRUE                                                07490728
075000         WHEN SQLCODE = +0                                        07500001
075001             ADD +1 TO PV-FETCH-COUNTER                           07500144
075002             IF DN-VEH-NBR = -1                                   07500248
075003                MOVE SPACES TO VHTRIP-VEH-NBR                     07500348
075004                DISPLAY 'NULLS IN VEHICLE FOR TRIP '                      
075005                SHUNLO-TRIP-ID                                            
075006             END-IF                                               07500448
075200         WHEN SQLCODE = +100                                      07520001
075300              SET PS-EOF-EXTRACT-CSR TO TRUE                      07530001
075400         WHEN SQLWARN0 NOT = SPACE                                07540001
075500         WHEN SQLCODE  NOT = +0                                   07550001
075600              MOVE '2100-FETCH-EXTRACT-CSR'                       07560001
075700                                   TO PV-ABEND-PARAGRAPH          07570001
075800              MOVE 'ATTEMPTING TO FETCH EXTRACT CURSOR'           07580015
075900                                   TO PV-ABEND-OPERATION          07590015
076200              PERFORM Z999-SQL-ABEND                              07620001
076300     END-EVALUATE.                                                07630001
076400*                                                                 07640001
076500*                                                                 07650001
076600***************************************************************** 07660001
076700 2200-LOAD-EXTRACT-RECORD.                                        07670001
076800***************************************************************** 07680001
076900     MOVE '2200-LOAD-EXTRACT-RCD   ' TO PV-ABEND-PARAGRAPH.       07690001
077000*                                                                 07700001
077100     MOVE SHUNLO-SHIPT-UNT-ID     TO SU008-SHIPT-UNT-ID.          07710004
077200     MOVE SHUNLO-OPER-UNT-ID      TO SU008-SCN-OPER-UNT-ID.       07720004
077210     MOVE SHUNLO-FCLTY-ID         TO SU008-SCN-FCLTY-ID.          07720004
077300     MOVE SHUNLO-CRE-USR-ID       TO SU008-SCN-USR-ID.            07730039
077410     MOVE PV-CRE-DATE-TMST        TO SU008-SCN-DATE.              07741039
077420     MOVE PV-CRE-TIME-TMST        TO SU008-SCN-TIME.              07742039
077500     MOVE SHUNLO-TRIP-ID          TO SU008-TRIP-ID.               07750004
077600     MOVE SHPUNT-ORGN-OPER-UNT-ID TO SU008-ORGN-OPER-UNT-ID.      07760004
077610     MOVE SHPUNT-ORGN-FCLTY-ID    TO SU008-ORGN-FCLTY-ID.               04
077700     MOVE SHPUNT-DEST-OPER-UNT-ID TO SU008-DEST-OPER-UNT-ID.      07770004
077800     MOVE SHPUNT-DEST-FCLTY-ID    TO SU008-DEST-FCLTY-ID.               04
077910     MOVE SHPUNT-CRE-DTE          TO SU008-ASN-CRE-DATE.          07791024
077920     MOVE SHPUNT-CRE-TM           TO SU008-ASN-CRE-TIME.          07792033
078000     MOVE PKSLIP-PO-NBR           TO SU008-PO-NBR.                07800004
078001     MOVE PKSLIP-REC-SEQ-NBR      TO SU008-REC-SEQ-NBR.           07800104
078002     MOVE PKSLIP-ASN-NBR          TO SU008-ASN-NBR.               07800228
078003     MOVE VHTRIP-OWNER-SCAC-ID    TO SU008-SCAC-CDE.              07800328
078004     MOVE VHTRIP-VEH-NBR          TO SU008-VEH-NBR.               07800428
078005*                                                                 07800528
078300*                                                                 07830001
082300 3000-CLOSE-EXTRACT-CSR.                                          08230001
082400***************************************************************** 08240001
082500     DISPLAY '3000-CLOSE-EXTRACT-CSR'.                            08250001
082600*                                                                 08260001
082700     EXEC SQL                                                     08270001
082800         CLOSE EXTRACT-CSR                                        08280001
082900     END-EXEC                                                     08290001
082901*                                                                 08290141
082902      MOVE PV-FETCH-COUNTER TO PV-DISPLAY-COUNT.                  08290245
082903      DISPLAY 'FETCH ROUTINE TOTAL '            PV-DISPLAY-COUNT. 08290346
082904      MOVE PV-WRITE-COUNTER TO PV-DISPLAY-COUNT.                  08290446
082905      DISPLAY 'TOTAL EXTRACT RECORDS WRITTEN '  PV-DISPLAY-COUNT. 08290546
082906      DISPLAY 'FETCH TOTAL SHOULD EQUAL WRITE TOTAL '.            08290646
083000*                                                                 08300001
083100     EVALUATE TRUE                                                08310001
083200         WHEN SQLCODE = ZERO                                      08320001
083300             CONTINUE                                             08330001
083400         WHEN OTHER                                               08340001
083500             PERFORM Z999-SQL-ABEND                               08350001
083600     END-EVALUATE.                                                08360045
083601                                                                  08360142
083700*                                                                 08370001
083800*                                                                 08380001
086600***************************************************************** 08660001
086700 Z999-SQL-ABEND.                                                  08670001
086800***************************************************************** 08680001
086900                                                                  08690001
087000     MOVE SQLCODE TO PV-SQLCODE.                                  08700001
087100     DISPLAY '*** DB2 ERROR '.                                    08710001
087200     DISPLAY '*** SQLCODE   = ' PV-SQLCODE.                       08720001
087300     DISPLAY '*** PROGRAM   = ' PV-ABEND-PROGRAM.                 08730013
087400     DISPLAY '*** PARAGRAPH = ' PV-ABEND-PARAGRAPH.               08740001
087500     DISPLAY '*** OPERATION = ' PV-ABEND-OPERATION.               08750001
088500                                                                  08850001
088600     COPY DPPD004.                                                08860001
088700                                                                  08870001
088800                                                                  08880001
088900     MOVE +4013                  TO PV-ABEND-CODE.                08890001
089000     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         08900001
