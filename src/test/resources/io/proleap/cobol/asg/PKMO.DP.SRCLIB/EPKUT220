000100*------------------------------------------------------------     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------------------------------------------     00030000
000400 PROGRAM-ID.    EPKUT220.                                         00040000
000500 AUTHOR.        MEDHA CHOUDHURY.                                  00050000
000600 DATE-WRITTEN.  MAR 20, 2009.                                     00060000
000700                                                                  00070000
000800*------------------------------------------------------------     00080000
000900*    MERCHANDISE HIERARCHY FORMATTER                              00090004
001000*------------------------------------------------------------     00100005
001100*    THIS PROGRAM WILL FORMAT THE MERCHANDISE HIERARCHY       *   00110005
001200*    DATA FILE FOR THE SQL SERVER STORE DATABASE TABLE,       *   00120005
001300*    AND ADD DISTRIBUTION HEADER RECORDS, AS APPROPRIATE.     *   00130005
001400*    POS 2009 FALL - PRICING INFRASTRUCTURE PROJECT WR# 35484 *   00140005
001500*                                                             *   00150005
001600*------------------------------------------------------------     00160000
001700*  INPUT:                                                     *   00170005
001800*        DEPT-FILE                        EPRD224             *   00180005
001900*        MAJ-CL-FILE                      EPRD226             *   00190005
002000*        SUB-CL-FILE                      EPRD227             *   00200005
002100*        VND-STYLE-FILE                   EPRD228             *   00210005
002200*        VENDOR-FILE                      EPRD229             *   00220005
002300*        VND-DEPT-FILE                    EPRD230                 00230005
002310*        FILE-TYPE                        EPRD667                 00231028
002400*                                                             *   00240005
002500*  OUTPUT:                                                    *   00250005
002600*        FORMATTED-MERCH-HIER-FL          EPRD217             *   00260005
002700*                                (FOR HEADER FORMAT)          *   00270005
002800*-------------------------------------------------------------*   00280005
002900* HISTORY LOG:                                                *   00290005
003000*                                                             *   00300005
003100*-------------------------------------------------------------*   00310005
003200* DATE: MAR 20 2009                                           *   00320005
003300* WR/IR#: WR #35484                                           *   00330005
003400* PROGRAMMER: MEDHA CHOUDHURY                                 *   00340005
003500* DESCRIPTION: INITIAL PROGRAM CREATION                       *   00350005
003600*-------------------------------------------------------------*   00360005
003700* DATE:                                                       *   00370005
003800* WR/IR#:                                                     *   00380005
003900* PROGRAMMER:                                                 *   00390005
004000* DESCRIPTION:                                                *   00400005
004100*                                                             *   00410005
004200*-------------------------------------------------------------*   00420005
004300 ENVIRONMENT DIVISION.                                            00430005
004400*-------------------------------------------------------------*   00440005
004500 CONFIGURATION SECTION.                                           00450005
004600 SOURCE-COMPUTER. IBM-3090.                                       00460005
004700 OBJECT-COMPUTER. IBM-3090.                                       00470005
004800                                                                  00480005
004900 INPUT-OUTPUT SECTION.                                            00490005
005000                                                                  00500005
005010 FILE-CONTROL.                                                    00501009
005100*  INPUT:                                                     *   00510005
005200           SELECT DEPT-FILE                                       00520005
005300             ASSIGN TO INP01.                                     00530005
005400                                                                  00540005
005500           SELECT MAJ-CL-FILE                                     00550005
005600             ASSIGN TO INP02.                                     00560005
005700                                                                  00570005
005800           SELECT SUB-CL-FILE                                     00580005
005900             ASSIGN TO INP03.                                     00590005
006000                                                                  00600005
006100           SELECT VND-STYLE-FILE                                  00610005
006200             ASSIGN TO INP04.                                     00620005
006300                                                                  00630005
006400           SELECT VENDOR-FILE                                     00640005
006500             ASSIGN TO INP05.                                     00650005
006600                                                                  00660005
007000           SELECT VEND-DEPT-FILE                                  00700006
007100             ASSIGN TO INP06.                                     00710006
007200                                                                  00720006
007300           SELECT CC-FILE-TYPE                                    00730006
007400             ASSIGN TO INP07.                                     00740006
007500                                                                  00750006
007600*  OUTOUT:                                                    *   00760005
007700           SELECT FORMATTED-MERCH-HIER-FL                         00770005
007800             ASSIGN TO OUT01.                                     00780005
007900                                                                  00790005
008000                                                                  00800005
008100*-------------------------------------------------------------*   00810005
008200 DATA DIVISION.                                                   00820005
008300*----------------------------------------------------------       00830005
008400 FILE SECTION.                                                    00840005
008500                                                                  00850005
008600 FD  DEPT-FILE                                                    00860005
008700     RECORDING MODE IS F                                          00870005
008800     LABEL RECORDS ARE STANDARD                                   00880005
008900     RECORD CONTAINS 120 CHARACTERS                               00890016
009000     BLOCK CONTAINS 0 RECORDS                                     00900005
009100     DATA RECORD IS DEPT-RECORD.                                  00910005
009200                                                                  00920005
009300 01  DEPT-RECORD             PIC X(120).                          00930016
009400                                                                  00940005
009500 FD  MAJ-CL-FILE                                                  00950005
009600     RECORDING MODE IS F                                          00960005
009700     LABEL RECORDS ARE STANDARD                                   00970005
009800     RECORD CONTAINS 50 CHARACTERS                                00980016
009900     BLOCK CONTAINS 0 RECORDS                                     00990005
010000     DATA RECORD IS MAJ-CL-RECORD.                                01000005
010100                                                                  01010005
010200 01  MAJ-CL-RECORD           PIC X(50).                           01020016
010300                                                                  01030005
010400 FD  SUB-CL-FILE                                                  01040005
010500     RECORDING MODE IS F                                          01050005
010600     LABEL RECORDS ARE STANDARD                                   01060005
010700     RECORD CONTAINS 85 CHARACTERS                                01070016
010800     BLOCK CONTAINS 0 RECORDS                                     01080005
010900     DATA RECORD IS SUB-CL-RECORD.                                01090005
011000                                                                  01100005
011100 01  SUB-CL-RECORD           PIC X(85).                           01110016
011200                                                                  01120005
011300 FD  VND-STYLE-FILE                                               01130005
011400     RECORDING MODE IS F                                          01140005
011500     LABEL RECORDS ARE STANDARD                                   01150005
011600     RECORD CONTAINS 185 CHARACTERS                               01160016
011700     BLOCK CONTAINS 0 RECORDS                                     01170005
011800     DATA RECORD IS VND-STYLE-RECORD.                             01180005
011900                                                                  01190005
012000 01  VND-STYLE-RECORD        PIC X(185).                          01200016
012100                                                                  01210005
012200 FD  VENDOR-FILE                                                  01220005
012300     RECORDING MODE IS F                                          01230005
012400     LABEL RECORDS ARE STANDARD                                   01240005
012500     RECORD CONTAINS 60 CHARACTERS                                01250016
012600     BLOCK CONTAINS 0 RECORDS                                     01260005
012700     DATA RECORD IS VENDOR-RECORD.                                01270005
012800                                                                  01280005
012900 01  VENDOR-RECORD           PIC X(60).                           01290016
013000                                                                  01300005
013100 FD  VEND-DEPT-FILE                                               01310005
013200     RECORDING MODE IS F                                          01320005
013300     LABEL RECORDS ARE STANDARD                                   01330005
013400     RECORD CONTAINS 65 CHARACTERS                                01340016
013500     BLOCK CONTAINS 0 RECORDS                                     01350005
013600     DATA RECORD IS VEND-DEPT-RECORD.                             01360005
013700                                                                  01370005
013800 01  VEND-DEPT-RECORD        PIC X(65).                           01380016
013900                                                                  01390005
014000 FD  CC-FILE-TYPE                                                 01400006
014100     RECORDING MODE IS F                                          01410006
014200     BLOCK CONTAINS 0 RECORDS                                     01420006
014300     LABEL RECORDS ARE STANDARD.                                  01430006
014400                                                                  01440006
014500 01  CC-FILE-TYPE-RECORD          PIC X(80).                      01450006
014600                                                                  01460006
014700 FD  FORMATTED-MERCH-HIER-FL                                      01470005
014800     RECORDING MODE IS V                                          01480005
014900     RECORD IS VARYING IN SIZE                                    01490005
015000     FROM 1 TO 200 CHARACTERS                                     01500005
015100     DEPENDING ON PV-BYTE-COUNT                                   01510005
015200     LABEL RECORDS ARE STANDARD                                   01520005
015300     DATA RECORD IS FORMATTED-MERCH-HIER-REC.                     01530005
015400                                                                  01540005
015500 01  FORMATTED-MERCH-HIER-REC.                                    01550005
015600     05  FORM-MRCH-HR-FLD                  PIC X(01)              01560005
015700         OCCURS 200 TIMES                                         01570005
015800              INDEXED BY                                          01580005
015900              FORM-MRCH-HR-LEN.                                   01590005
016000                                                                  01600005
016100*----------------------------------------------------------       01610005
016200 WORKING-STORAGE SECTION.                                         01620005
016300                                                                  01630005
016400 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01640005
016500                                                  COMP SYNC.      01650005
016600     88  AC-INPUT-CONTROL-CARD-ERROR              VALUE +4003.    01660005
016700     88  AC-DB2-ERROR                             VALUE +4013.    01670005
016800     88  AC-INPUT-FILE-EMPTY                      VALUE +4008.    01680005
017000                                                                  01700005
017100*----------------------------------------------------------       01710005
017200* PC- PROGRAM CONSTANTS                                           01720005
017300*----------------------------------------------------------       01730005
017400 01  PC-PROGRAM-CONSTANTS.                                        01740005
017500     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT220'. 01750005
017800     05  PC-CSV-DELIMITER             PIC X(01) VALUE '|'.        01780005
017900     05  PC-NULL-VALUE                PIC X(01) VALUE '~'.        01790005
018000     05  PC-UNDER-SCORE               PIC X(01) VALUE '_'.        01800005
018100     05  PC-DASH                      PIC X(01) VALUE '-'.        01810005
018110     05  PC-COLON                     PIC X(01) VALUE ':'.        01811011
018200     05  PC-ONE-SPACE                 PIC X(01) VALUE ' '.        01820005
018300     05  PC-ONE-ZERO                  PIC X(01) VALUE '0'.        01830005
018400     05  PC-TIME-START                PIC X(08) VALUE '00:00:01'. 01840005
018500     05  PC-TIME-END                  PIC X(08) VALUE '23:59:59'. 01850005
018600     05  PC-FULL-FILE-STR-GRP         PIC X(05) VALUE '99998'.    01860006
018700     05  PC-FULL-FILE-STR-ID          PIC X(05) VALUE '00000'.    01870006
018800     05  PC-CHG-FILE-STR-GRP          PIC X(05) VALUE '01000'.    01880006
018900     05  PC-CHG-FILE-STR-ID           PIC X(05) VALUE '00001'.    01890006
019000     05  PC-FIVE-ZERO                 PIC X(05) VALUE '00000'.    01900005
019100     05  PC-HDR-IND                   PIC X(03) VALUE 'HDR'.      01910005
019110     05  PC-FILE-APPLY-TYPE-FUL       PIC X(01) VALUE 'N'.        01911025
019120     05  PC-FILE-APPLY-TYPE-CHG       PIC X(01) VALUE 'C'.        01912025
019200*----------------------------------------------------------       01920005
019300* PV- PROGRAM VARIABLES                                           01930005
019400*----------------------------------------------------------       01940005
019500 01  PV-PROGRAM-STATUS.                                           01950005
019600     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACES.     01960005
019700     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     01970005
019800     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     01980005
019900     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      01990005
020000     05  PV-SQL-SUB                   PIC S9(4) VALUE +0 COMP.    02000005
020100*                                                                 02010005
020200 01  PV-PROGRAM-VARIABLES.                                        02020005
020300     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 02030005
020400     05  PV-PIPE-COUNT                PIC  9(04) VALUE ZERO.      02040011
020410     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      02041011
020600     05  PV-SQL-SUB                   PIC  9(01) VALUE ZERO.      02060005
020700     05  PV-SPACE                     PIC  X(01).                 02070005
020800     05  PV-DISPLAY-INDEX             PIC S9(04) COMP.            02080005
020900                                                                  02090005
021000     05  PV-VARIABLE-OUTPUT-FIELD.                                02100005
021100         10  PV-BIT-VARIABLE          PIC X(01)                   02110005
021200                                          VALUE SPACES            02120005
021300                                          OCCURS 10 TIMES         02130005
021400                                          INDEXED BY              02140005
021500                                          PV-BIT-IDX              02150005
021600                                          PV-EOF-IDX.             02160005
021700                                                                  02170005
021800     05  PV-VARIABLE-CHAR-FIELD.                                  02180006
021900         10  PV-BIT-CHR-VARIABLE      PIC X(01)                   02190005
022000                                          VALUE SPACES            02200005
022100                                          OCCURS 50 TIMES         02210005
022200                                          INDEXED BY              02220005
022300                                          PV-CHR-BIT-IDX          02230005
022400                                          PV-CHR-EOF-IDX.         02240005
022500                                                                  02250005
022600     05  PV-SAVE-PREV-TIMESTAMP       PIC X(26) VALUE SPACES.     02260005
022700     05  PV-TIMESTAMP                 PIC X(26) VALUE SPACES.     02270005
022800     05  PV-CURRENT-TMST REDEFINES    PV-TIMESTAMP.               02280005
022900         10  PV-CURR-YYYY             PIC 9(04).                  02290005
023000         10  FILLER                   PIC X(01).                  02300005
023100         10  PV-CURR-MO               PIC 9(02).                  02310005
023200         10  FILLER                   PIC X(01).                  02320005
023300         10  PV-CURR-DD               PIC 9(02).                  02330005
023400         10  FILLER                   PIC X(01).                  02340005
023500         10  PV-CURR-HH               PIC 9(02).                  02350005
023600         10  FILLER                   PIC X(01).                  02360005
023700         10  PV-CURR-MM               PIC 9(02).                  02370005
023800         10  FILLER                   PIC X(01).                  02380005
023900         10  PV-CURR-SS               PIC 9(02).                  02390005
024000         10  FILLER                   PIC X(01).                  02400005
024100         10  PV-CURR-SSSSSS           PIC 9(06).                  02410005
024200                                                                  02420005
024300     05  PV-HEADER-TMST.                                          02430005
024400         10  PV-HEADER-YYYY           PIC 9(04)  VALUE ZERO.      02440005
024500         10  PV-HEADER-MO             PIC 9(02)  VALUE ZERO.      02450005
024600         10  PV-HEADER-DD             PIC 9(02)  VALUE ZERO.      02460005
024700         10  PV-HEADER-HH             PIC 9(02)  VALUE ZERO.      02470005
024800         10  PV-HEADER-MM             PIC 9(02)  VALUE ZERO.      02480005
024900         10  PV-HEADER-SS             PIC 9(02)  VALUE ZERO.      02490005
025000                                                                  02500005
025100     05  PV-FILE-DIST-DTE.                                        02510005
025200         10  PV-EFFECT-YYYY           PIC X(04).                  02520005
025300         10  PV-EFFECT-DASH-1         PIC X(01) VALUE '-'.        02530005
025400         10  PV-EFFECT-MM             PIC X(02).                  02540005
025500         10  PV-EFFECT-DASH-2         PIC X(01) VALUE '-'.        02550005
025600         10  PV-EFFECT-DD             PIC X(02).                  02560005
025700                                                                  02570005
025710     05  PV-QUOTIENT                  PIC 9(04)  VALUE ZERO.      02571011
025720     05  PV-RMDR-4                    PIC 9(04)  VALUE ZERO.      02572011
025730     05  PV-RMDR-100                  PIC 9(04)  VALUE ZERO.      02573011
025740                                                                  02574011
025800     05  PV-FORMAT-HDR-DIST-DTE.                                  02580005
025900         10  PV-FORMAT-YYYY           PIC X(04).                  02590005
026000         10  PV-FORMAT-MM             PIC X(02).                  02600005
026100         10  PV-FORMAT-DD             PIC X(02).                  02610005
026200                                                                  02620005
026300     05  PV-FILE-APPLY-TYPE           PIC X(01) VALUE SPACES.     02630025
026301     05  PV-FILE-PROCESS-TYPE         PIC X(03) VALUE SPACES.     02630125
026310     05  PV-STR-GRP-TYP-CDE           PIC 9(05) VALUE ZERO.       02631006
026320     05  PV-STR-GRP-ID-GRP.                                       02632006
026330         10  PV-FIRST-BYTES           PIC 9(05) VALUE ZERO.       02633006
026340         10  PV-STR-GRP-ID            PIC 9(05) VALUE ZERO.       02634006
026350     05  PV-RECORD-ACTION             PIC X(01) VALUE SPACES.     02635006
026351                                                                  02635106
026360     05  PV-INPUT-TIMESTAMP.                                      02636006
026370         10  PV-INP-TMST-YYYY         PIC 9(04).                  02637006
026380         10  FILLER                   PIC X(01).                  02638006
026390         10  PV-INP-TMST-MO           PIC 9(02).                  02639006
026391         10  FILLER                   PIC X(01).                  02639106
026392         10  PV-INP-TMST-DD           PIC 9(02).                  02639206
026393         10  FILLER                   PIC X(01).                  02639306
026394         10  PV-INP-TMST-HH           PIC 9(02).                  02639406
026395         10  FILLER                   PIC X(01).                  02639506
026396         10  PV-INP-TMST-MM           PIC 9(02).                  02639606
026397         10  FILLER                   PIC X(01).                  02639706
026398         10  PV-INP-TMST-SS           PIC 9(02).                  02639806
026399         10  FILLER                   PIC X(01).                  02639906
026400         10  PV-INP-TMST-SSSSSS       PIC 9(06).                  02640006
026401                                                                  02640106
026402     05  PV-OUTPUT-SQL-TIMESTAMP.                                 02640206
026403         10  PV-OUT-TMST-YYYY         PIC 9(04).                  02640306
026404         10  PV-OUT-DASH-1            PIC X(01).                  02640406
026405         10  PV-OUT-TMST-MO           PIC 9(02).                  02640506
026406         10  PV-OUT-DASH-2            PIC X(01).                  02640606
026407         10  PV-OUT-TMST-DD           PIC 9(02).                  02640706
026408         10  PV-OUT-SPACE             PIC X(01).                  02640806
026409         10  PV-OUT-TMST-HH           PIC 9(02).                  02640906
026410         10  PV-OUT-DASH-3            PIC X(01).                  02641006
026411         10  PV-OUT-TMST-MM           PIC 9(02).                  02641106
026412         10  PV-OUT-DASH-4            PIC X(01).                  02641206
026413         10  PV-OUT-TMST-SS           PIC 9(02).                  02641306
026420*----------------------------------------------------------       02642005
026500* PV- PROGRAM COUNT VARIABLES                                     02650005
026600*----------------------------------------------------------       02660005
026700 01  PV-PROGRAM-COUNTERS.                                         02670005
026800     05  PV-DEPT-REC-READ             PIC 9(09) VALUE 0.          02680005
026900     05  PV-MJCL-REC-READ             PIC 9(09) VALUE 0.          02690005
027000     05  PV-SBCL-REC-READ             PIC 9(09) VALUE 0.          02700005
027100     05  PV-VSTY-REC-READ             PIC 9(09) VALUE 0.          02710005
027200     05  PV-VND-REC-READ              PIC 9(09) VALUE 0.          02720005
027300     05  PV-VDPT-REC-READ             PIC 9(09) VALUE 0.          02730005
027310     05  PV-HDR-REC-WRITEN            PIC 9(09) VALUE 0.          02731010
027320     05  PV-DATA-REC-WRITEN           PIC 9(09) VALUE 0.          02732010
027400                                                                  02740005
027500*----------------------------------------------------------------*02750005
027600* PS- PROGRAM SWITCHES                                           *02760005
027700*----------------------------------------------------------------*02770005
027800 01  PS-PROGRAM-SWITCHES.                                         02780005
027900     05  PS-END-OF-DEPT-SW            PIC  X(01) VALUE 'N'.       02790005
028000         88  PS-END-OF-DEPT-FILE                 VALUE 'Y'.       02800005
028100         88  PS-NOT-END-DEPT-FILE                VALUE 'N'.       02810005
028200     05  PS-END-OF-MAJ-CL-SW          PIC  X(01) VALUE 'N'.       02820005
028300         88  PS-END-OF-MAJ-CL-FILE               VALUE 'Y'.       02830005
028400         88  PS-NOT-END-MAJ-CL-FILE              VALUE 'N'.       02840005
028500     05  PS-END-OF-SUB-CL-SW          PIC  X(01) VALUE 'N'.       02850005
028600         88  PS-END-OF-SUB-CL-FILE               VALUE 'Y'.       02860005
028700         88  PS-NOT-END-SUB-CL-FILE              VALUE 'N'.       02870005
028800     05  PS-END-OF-VND-ST-SW          PIC  X(01) VALUE 'N'.       02880005
028900         88  PS-END-OF-VND-ST-FILE               VALUE 'Y'.       02890005
029000         88  PS-NOT-END-VND-ST-FILE              VALUE 'N'.       02900005
029100     05  PS-END-OF-VENDOR-SW          PIC  X(01) VALUE 'N'.       02910005
029200         88  PS-END-OF-VENDOR-FILE               VALUE 'Y'.       02920005
029300         88  PS-NOT-END-VENDOR-FILE              VALUE 'N'.       02930005
029400     05  PS-END-OF-VND-DP-SW          PIC  X(01) VALUE 'N'.       02940005
029500         88  PS-END-OF-VND-DP-FILE               VALUE 'Y'.       02950005
029600         88  PS-NOT-END-VND-DP-FILE              VALUE 'N'.       02960005
029610     05  PS-END-OF-CC-SW              PIC  X(01) VALUE 'N'.       02961009
029620         88  PS-END-OF-CC-TYP-FILE               VALUE 'Y'.       02962009
029630         88  PS-NOT-END-CC-TYP-FILE              VALUE 'N'.       02963009
029700     05  PS-END-OF-PROCES-SW          PIC  X(01) VALUE 'N'.       02970006
029800         88  PS-END-OF-PROCESSING                VALUE 'Y'.       02980006
029900         88  PS-NOT-END-OF-PROCESSING            VALUE 'N'.       02990006
030000                                                                  03000006
030100     05  PS-DEPT-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       03010006
030200         88 PS-DEPT-HDR-WRITEN                   VALUE 'Y'.       03020006
030300         88 PS-DEPT-HDR-NOT-WRITEN               VALUE 'N'.       03030006
030400     05  PS-MJCL-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       03040006
030500         88 PS-MJCL-HDR-WRITEN                   VALUE 'Y'.       03050006
030600         88 PS-MJCL-HDR-NOT-WRITEN               VALUE 'N'.       03060006
030700     05  PS-SBCL-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       03070006
030800         88 PS-SBCL-HDR-WRITEN                   VALUE 'Y'.       03080006
030900         88 PS-SBCL-HDR-NOT-WRITEN               VALUE 'N'.       03090006
031000     05  PS-VEND-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       03100006
031100         88 PS-VEND-HDR-WRITEN                   VALUE 'Y'.       03110006
031200         88 PS-VEND-HDR-NOT-WRITEN               VALUE 'N'.       03120006
031300     05  PS-VDPT-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       03130006
031400         88 PS-VDPT-HDR-WRITEN                   VALUE 'Y'.       03140006
031500         88 PS-VDPT-HDR-NOT-WRITEN               VALUE 'N'.       03150006
031600     05  PS-VSTY-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       03160006
031700         88 PS-VSTY-HDR-WRITEN                   VALUE 'Y'.       03170006
031800         88 PS-VSTY-HDR-NOT-WRITEN               VALUE 'N'.       03180006
031900*----------------------------------------------------------       03190005
032000* COPYBOOK  EPRD217 LAYOUT (HEADER LAYOUT)                        03200005
032100*----------------------------------------------------------       03210005
032200     COPY EPRD217.                                                03220005
032300                                                                  03230005
032400*----------------------------------------------------------       03240005
032500* COPYBOOK  EPRD224 LAYOUT (READ DEPARTMENT FILE)                 03250005
032600*----------------------------------------------------------       03260005
032700     COPY EPRD224.                                                03270005
032800                                                                  03280005
032900*----------------------------------------------------------       03290005
033000* COPYBOOK  EPRD226 LAYOUT (READ MAJOR CLASS FILE)                03300005
033100*----------------------------------------------------------       03310005
033200     COPY EPRD226.                                                03320005
033300                                                                  03330005
033400*----------------------------------------------------------       03340005
033500* COPYBOOK  EPRD227 LAYOUT (READ SUB CLASS FILE)                  03350005
033600*----------------------------------------------------------       03360005
033700     COPY EPRD227.                                                03370005
033800                                                                  03380005
033900*----------------------------------------------------------       03390005
034000* COPYBOOK  EPRD228 LAYOUT (READ VENDOR STYLE FILE)               03400005
034100*----------------------------------------------------------       03410005
034200     COPY EPRD228.                                                03420005
034300                                                                  03430005
034400*----------------------------------------------------------       03440005
034500* COPYBOOK  EPRD229 LAYOUT (READ VENDOR FILE)                     03450005
034600*----------------------------------------------------------       03460005
034700     COPY EPRD229.                                                03470005
034800                                                                  03480005
034900*----------------------------------------------------------       03490005
035000* COPYBOOK  EPRD230 LAYOUT (READ VENDOR DEPARTMENT FILE)          03500005
035100*----------------------------------------------------------       03510005
035200     COPY EPRD230.                                                03520005
035300                                                                  03530005
035400*----------------------------------------------------------       03540006
035500* COPYBOOK  EPRD667 LAYOUT (READ FILE TYPE CONTROL CARD)          03550006
035600*----------------------------------------------------------       03560006
035700     COPY EPRD667.                                                03570006
035800                                                                  03580006
035900*------------------------------------------------------------     03590005
036000* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         03600005
036100*------------------------------------------------------------     03610005
036200     COPY DPWS004.                                                03620005
036300                                                                  03630005
036400*-----------------------------------------------------------      03640005
036500* DB2 MESSAGE AREA                                                03650005
036600*-----------------------------------------------------------      03660005
036700     COPY SQLCA2.                                                 03670005
036800                                                                  03680005
036900*-----------------------------------------------------------      03690005
037000* DB2 COMMUNICATIONS AREA                                         03700005
037100*-----------------------------------------------------------      03710005
037200     EXEC SQL                                                     03720005
037300          INCLUDE SQLCA                                           03730005
037400     END-EXEC.                                                    03740005
037500                                                                  03750005
037600                                                                  03760005
037700*----------------------------------------------------------       03770005
037800 PROCEDURE DIVISION.                                              03780005
037900*----------------------------------------------------------       03790005
038000 0000-MAINLINE.                                                   03800005
038100                                                                  03810005
038200     PERFORM 1000-INITIALIZATION.                                 03820005
038300                                                                  03830005
038400     PERFORM 2000-PROCESS-MERCH-HIER                              03840005
038500             UNTIL PS-END-OF-PROCESSING.                          03850005
038600                                                                  03860005
038700     PERFORM 9200-WRAPUP.                                         03870005
038800                                                                  03880005
038900     GOBACK.                                                      03890005
039000                                                                  03900005
039100*0000-EXIT.                                                       03910005
039300                                                                  03930005
039400*----------------------------------------------------------       03940005
039500* 1000-INITIALIZATION.                                            03950005
039600*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           03960005
039700*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      03970005
039800*     FILES.                                                      03980005
039900*----------------------------------------------------------       03990005
040000 1000-INITIALIZATION.                                             04000005
040100                                                                  04010005
040200     DISPLAY '****************************************'.          04020005
040300     DISPLAY '**          EPKUT220 STARTED          **'.          04030005
040400     DISPLAY '****************************************'.          04040005
040500                                                                  04050005
040600     INITIALIZE PV-PROGRAM-VARIABLES.                             04060005
040700     INITIALIZE PS-PROGRAM-SWITCHES.                              04070005
040800                                                                  04080005
040900     SET PS-NOT-END-DEPT-FILE      TO TRUE.                       04090005
041000     SET PS-NOT-END-MAJ-CL-FILE    TO TRUE.                       04100005
041100     SET PS-NOT-END-SUB-CL-FILE    TO TRUE.                       04110005
041200     SET PS-NOT-END-VND-ST-FILE    TO TRUE.                       04120005
041300     SET PS-NOT-END-VENDOR-FILE    TO TRUE.                       04130005
041400     SET PS-NOT-END-VND-DP-FILE    TO TRUE.                       04140005
041500                                                                  04150005
041600     PERFORM 1100-OPEN-FILES.                                     04160005
041700                                                                  04170005
041800     PERFORM 1200-GET-DB2-TIMESTAMP.                              04180005
041900                                                                  04190005
042000     PERFORM 1300-READ-FILE-TYPE.                                 04200006
042100                                                                  04210006
042200     PERFORM 6000-READ-DEPT-FILE.                                 04220006
042300                                                                  04230006
042400     IF PS-END-OF-DEPT-FILE                                       04240006
042500        DISPLAY ' ****  DEPARTMENT FILE IS EMPTY *****'           04250006
042600     END-IF.                                                      04260006
042700                                                                  04270006
042800     PERFORM 6100-READ-MAJ-CL-FILE.                               04280006
042900                                                                  04290006
043000     IF PS-END-OF-MAJ-CL-FILE                                     04300006
043100        DISPLAY ' ****  MAJOR CLASS FILE IS EMPTY *****'          04310006
043200     END-IF.                                                      04320006
043300                                                                  04330006
043400     PERFORM 6200-READ-SUB-CL-FILE.                               04340006
043500                                                                  04350006
043600     IF PS-END-OF-SUB-CL-FILE                                     04360006
043700        DISPLAY ' ****  SUB CLASS FILE IS EMPTY *****'            04370006
043800     END-IF.                                                      04380006
043900                                                                  04390006
044000     PERFORM 6300-READ-VND-ST-FILE.                               04400006
044100                                                                  04410006
044200     IF PS-END-OF-VND-ST-FILE                                     04420006
044300        DISPLAY ' ****  VENDOR STYLE FILE IS EMPTY *****'         04430006
044400     END-IF.                                                      04440006
044500                                                                  04450006
044600     PERFORM 6400-READ-VENDOR-FILE                                04460006
044700                                                                  04470006
044800     IF PS-END-OF-VENDOR-FILE                                     04480006
044900        DISPLAY ' ****  VENDOR FILE IS EMPTY *****'               04490006
045000     END-IF.                                                      04500006
045100                                                                  04510006
045200     PERFORM 6500-READ-VND-DP-FILE.                               04520006
045300                                                                  04530006
045400     IF PS-END-OF-VND-DP-FILE                                     04540006
045500        DISPLAY ' **** VENDOR DEPT FILE IS EMPTY *****'           04550006
045600     END-IF.                                                      04560006
045700                                                                  04570006
045800     PERFORM 1400-DETERMINE-PROCESS.                              04580006
045900                                                                  04590005
046000*1000-EXIT.                                                       04600005
046200                                                                  04620005
046300*----------------------------------------------------------       04630005
046400* 1100-OPEN-FILES.                                                04640005
046500*     THIS PARAGRAPH OPENS ALL THE FILES IN MODE REQUIRED         04650005
046600*----------------------------------------------------------       04660005
046700 1100-OPEN-FILES.                                                 04670005
046800                                                                  04680005
046900     OPEN INPUT DEPT-FILE                                         04690005
047000                MAJ-CL-FILE                                       04700005
047100                SUB-CL-FILE                                       04710005
047200                VND-STYLE-FILE                                    04720005
047300                VENDOR-FILE                                       04730005
047400                VEND-DEPT-FILE                                    04740006
047500                CC-FILE-TYPE.                                     04750006
047600                                                                  04760005
047700                                                                  04770005
047800     OPEN OUTPUT FORMATTED-MERCH-HIER-FL.                         04780006
047900                                                                  04790005
048000*1100-EXIT.                                                       04800005
048200                                                                  04820005
048300*----------------------------------------------------------       04830005
048400* 1200-GET-DB2-TIMESTAMP.                                         04840005
048500*     THIS PARAGRAPH GETS THE DB2 TIMESTAMP WHICH WILL BE         04850005
048600*     USED TO UPDATE THE CRT-TIMESTAMP ON THE HEADER RECORD       04860005
048700*----------------------------------------------------------       04870005
048800 1200-GET-DB2-TIMESTAMP.                                          04880005
048900                                                                  04890005
049000     EXEC SQL                                                     04900005
049100          SELECT CURRENT TIMESTAMP - 1 DAY                        04910030
049200          INTO  :PV-TIMESTAMP                                     04920005
049300          FROM   SYSIBM.SYSDUMMY1                                 04930005
049400     END-EXEC.                                                    04940005
049500                                                                  04950005
049600     IF SQLCODE NOT EQUAL ZERO                                    04960005
049700        MOVE '1200-GET-DB2-TIMESTAMP' TO PV-PARAGRAPH-NAME        04970005
049800        MOVE 'CANNOT GET CURRENT TIMESTAMP'                       04980005
049900                                    TO PV-DB2-OPERATION           04990005
050000        PERFORM 9800-SQL-ABEND                                    05000005
050100     END-IF.                                                      05010005
050200                                                                  05020005
050300*** SET UP TIMESTAMP    INFORMATION FOR HEADER                    05030005
050400                                                                  05040005
050500     MOVE PV-CURR-YYYY         TO PV-HEADER-YYYY.                 05050005
050600                                                                  05060005
050700     MOVE PV-CURR-MO           TO PV-HEADER-MO.                   05070005
050800                                                                  05080005
050900     MOVE PV-CURR-DD           TO PV-HEADER-DD.                   05090005
051000                                                                  05100005
051100     MOVE PV-CURR-HH           TO PV-HEADER-HH.                   05110005
051200                                                                  05120005
051300     MOVE PV-CURR-MM           TO PV-HEADER-MM.                   05130005
051400                                                                  05140005
051500     MOVE PV-CURR-SS           TO PV-HEADER-SS.                   05150005
051600                                                                  05160005
051610*** SET UP FILE DISTRIBUTION DATE FOR HEADER RECORD               05161006
051620                                                                  05162006
051630     MOVE PV-CURR-YYYY         TO PV-FORMAT-YYYY.                 05163006
051640                                                                  05164006
051650     MOVE PV-CURR-MO           TO PV-FORMAT-MM.                   05165006
051660                                                                  05166006
051670     MOVE PV-CURR-DD           TO PV-FORMAT-DD.                   05167006
051680                                                                  05168006
051700*1200-EXIT.                                                       05170005
051900                                                                  05190005
052000*----------------------------------------------------------       05200006
052100* 1300-READ-FILE-TYPE.                                            05210006
052200*     THIS PARAGRAPH GETS THE DB2 TIMESTAMP WHICH WILL BE         05220006
052300*     USED TO UPDATE THE CRT-TIMESTAMP ON THE HEADER RECORD       05230006
052400*----------------------------------------------------------       05240006
052500 1300-READ-FILE-TYPE.                                             05250006
052600                                                                  05260006
052700     READ CC-FILE-TYPE INTO CC-EPCC667-CONTROL-CARD               05270006
052800         AT END                                                   05280006
052900             SET PS-END-OF-CC-TYP-FILE   TO TRUE.                 05290009
053000                                                                  05300006
053100     DISPLAY '    '                                               05310006
053200     DISPLAY '   FILE TYPE BEING PROCESSED IS : '                 05320006
053300                               CC-EPCC667-CONTROL-CARD-DISPLY.    05330006
053400     DISPLAY '  '.                                                05340006
053500                                                                  05350006
053600     IF PS-END-OF-CC-TYP-FILE                                     05360009
053700         MOVE '1300-READ-FILE-TYPE  '  TO PV-PARAGRAPH-NAME       05370006
053800         MOVE 'EMPTY FILE TYPE   CC '   TO PV-OPERATION-MSG-1     05380006
053900         SET AC-INPUT-CONTROL-CARD-ERROR TO TRUE                  05390006
054000         PERFORM 9910-ABEND                                       05400006
054100     END-IF.                                                      05410006
054200                                                                  05420006
054300     MOVE CC-EPCC667-FILE-TYPE  TO PV-FILE-PROCESS-TYPE.          05430006
054400                                                                  05440006
054500*1300-EXIT.                                                       05450006
054700                                                                  05470006
054800*----------------------------------------------------------       05480006
054900* 1400-DETERMINE-PROCESS                                          05490006
055000*     THIS PARAGRAPH EVALUATES THE READ FLAGS AND THE FILE        05500006
055100*     TYPE TO DETERMINE FURTHER PROCESSING.                       05510006
055200*----------------------------------------------------------       05520006
055300 1400-DETERMINE-PROCESS.                                          05530006
055400                                                                  05540006
055500     IF PV-FILE-PROCESS-TYPE = 'FUL'                              05550006
055600        EVALUATE TRUE                                             05560006
055700            WHEN PS-END-OF-DEPT-FILE                              05570006
055800             AND PS-END-OF-MAJ-CL-FILE                            05580006
055900             AND PS-END-OF-SUB-CL-FILE                            05590006
056000             AND PS-END-OF-VND-ST-FILE                            05600006
056100             AND PS-END-OF-VENDOR-FILE                            05610006
056200             AND PS-END-OF-VND-DP-FILE                            05620006
056300                SET PS-END-OF-PROCESSING TO TRUE                  05630006
056400             WHEN PS-NOT-END-DEPT-FILE                            05640006
056500              AND PS-NOT-END-MAJ-CL-FILE                          05650006
056600              AND PS-NOT-END-SUB-CL-FILE                          05660006
056700              AND PS-NOT-END-VND-ST-FILE                          05670006
056800              AND PS-NOT-END-VENDOR-FILE                          05680006
056900              AND PS-NOT-END-VND-DP-FILE                          05690006
057000                SET PS-NOT-END-OF-PROCESSING TO TRUE              05700006
057100            WHEN OTHER                                            05710006
057200                DISPLAY '  '                                      05720006
057300                DISPLAY ' ERROR IN INPUT FILES SOME HAVE DATA '   05730008
057400                DISPLAY 'OTHERS ARE EMPTY, PROGRAM CANNOT PROCEED'05740008
057500                MOVE '1400-DETERMINE-PROCESS' TO                  05750006
057600                                                 PV-PARAGRAPH-NAME05760006
057700                SET AC-INPUT-FILE-EMPTY       TO TRUE             05770006
057800                PERFORM 9910-ABEND                                05780006
057900        END-EVALUATE                                              05790009
058000     END-IF.                                                      05800006
058100                                                                  05810006
058200     IF PV-FILE-PROCESS-TYPE = 'CHG'                              05820006
058300        EVALUATE TRUE                                             05830006
058400            WHEN PS-END-OF-DEPT-FILE                              05840006
058500             AND PS-END-OF-MAJ-CL-FILE                            05850006
058600             AND PS-END-OF-SUB-CL-FILE                            05860006
058700             AND PS-END-OF-VND-ST-FILE                            05870006
058800             AND PS-END-OF-VENDOR-FILE                            05880006
058900             AND PS-END-OF-VND-DP-FILE                            05890006
059000                SET PS-END-OF-PROCESSING TO TRUE                  05900006
059100            WHEN OTHER                                            05910006
059200                SET PS-NOT-END-OF-PROCESSING TO TRUE              05920006
059300        END-EVALUATE                                              05930009
059400     END-IF.                                                      05940006
059500                                                                  05950006
059600*1400-EXIT.                                                       05960006
059800                                                                  05980006
059900*----------------------------------------------------------       05990006
060000*  2000-PROCESS-MERCH-HIER                                        06000006
060100*     THIS PARAGRAPH READS THE FILES IN A SEQUENCE AND FIRST      06010006
060200*     WRITES THE HEADER RECORD FOLLOWED BY THE DATA RECORD.       06020006
060300*     THE ORDER OF PROCESSING IS THE SAME FOR EACH FILE TYPE      06030006
060400*     AND IS AS FOLLOWS                                           06040006
060500*     1) WRITE THE HEADER RECORD FOR DEPARTMENT AND THEN          06050006
060600*        FORMAT THE DATA RECORDS, READ THE FILE AND WRITE THE     06060006
060700*        FORMATTED DATA RECORDS UNTILL ALL THE RECORDS ARE WRITEN 06070006
060800*     2) FOLLOW THE SAME STEPS FOR MAJOR CLASS FILE               06080006
060900*     3) AFTER FORMATTING MAJOR CLASS, SUB-CLASS FILE IS FORMATTED06090006
061000*     4) VENDOR FILE                                              06100006
061100*     4) VENDOR DEPARTMENT                                        06110006
061200*     4) VENDOR STYLE                                             06120006
061300*----------------------------------------------------------       06130006
061400 2000-PROCESS-MERCH-HIER.                                         06140006
061500                                                                  06150006
061600     SET PS-DEPT-HDR-NOT-WRITEN TO TRUE.                          06160006
061700     SET PS-MJCL-HDR-NOT-WRITEN TO TRUE.                          06170006
061800     SET PS-SBCL-HDR-NOT-WRITEN TO TRUE.                          06180006
061900     SET PS-VEND-HDR-NOT-WRITEN TO TRUE.                          06190006
062000     SET PS-VDPT-HDR-NOT-WRITEN TO TRUE.                          06200006
062100     SET PS-VSTY-HDR-NOT-WRITEN TO TRUE.                          06210006
062200                                                                  06220006
062210     EVALUATE TRUE                                                06221006
062220         WHEN PV-FILE-PROCESS-TYPE = 'FUL'                        06222008
062230            MOVE PC-FULL-FILE-STR-GRP TO PV-STR-GRP-TYP-CDE       06223006
062240            MOVE PC-FULL-FILE-STR-ID  TO PV-STR-GRP-ID            06224006
062250            MOVE PC-FIVE-ZERO         TO PV-FIRST-BYTES           06225006
062251            MOVE PC-FILE-APPLY-TYPE-FUL TO PV-FILE-APPLY-TYPE     06225125
062260         WHEN PV-FILE-PROCESS-TYPE = 'CHG'                        06226006
062271            MOVE PC-CHG-FILE-STR-GRP  TO PV-STR-GRP-TYP-CDE       06227106
062272            MOVE PC-CHG-FILE-STR-ID   TO PV-STR-GRP-ID            06227206
062273            MOVE PC-FIVE-ZERO         TO PV-FIRST-BYTES           06227306
062274            MOVE PC-FILE-APPLY-TYPE-CHG TO PV-FILE-APPLY-TYPE     06227425
062280     END-EVALUATE.                                                06228006
062290                                                                  06229006
062300     PERFORM 2100-FORMAT-WRT-DEPT-FILE                            06230006
062400       UNTIL PS-END-OF-DEPT-FILE.                                 06240006
062500                                                                  06250006
062600     PERFORM 2300-FORMAT-WRT-MJCL-FILE                            06260021
062700       UNTIL PS-END-OF-MAJ-CL-FILE.                               06270006
062800                                                                  06280006
062900     PERFORM 2500-FORMAT-WRT-SBCL-FILE                            06290021
063000       UNTIL PS-END-OF-SUB-CL-FILE.                               06300006
063100                                                                  06310006
063200     PERFORM 2700-FORMAT-WRT-VEND-FILE                            06320021
063300       UNTIL PS-END-OF-VENDOR-FILE.                               06330006
063400                                                                  06340019
063500     PERFORM 2800-FORMAT-WRT-VDPT-FILE                            06350021
063600       UNTIL PS-END-OF-VND-DP-FILE.                               06360006
063700                                                                  06370006
063800     PERFORM 2900-FORMAT-WRT-VSTY-FILE                            06380021
063900       UNTIL PS-END-OF-VND-ST-FILE.                               06390006
064000                                                                  06400006
064010     EVALUATE TRUE                                                06401018
064020         WHEN PS-END-OF-DEPT-FILE                                 06402018
064030          AND PS-END-OF-MAJ-CL-FILE                               06403018
064040          AND PS-END-OF-SUB-CL-FILE                               06404018
064050          AND PS-END-OF-VND-ST-FILE                               06405018
064060          AND PS-END-OF-VENDOR-FILE                               06406018
064070          AND PS-END-OF-VND-DP-FILE                               06407018
064080             SET PS-END-OF-PROCESSING TO TRUE                     06408018
064097         WHEN OTHER                                               06409718
064098             DISPLAY '  '                                         06409818
064099             DISPLAY ' ERROR IN INPUT FILES SOME HAVE DATA '      06409918
064100             DISPLAY 'OTHERS ARE EMPTY, PROGRAM CANNOT PROCEED'   06410018
064101             MOVE '1400-DETERMINE-PROCESS' TO                     06410118
064102                                              PV-PARAGRAPH-NAME   06410218
064103             SET AC-INPUT-FILE-EMPTY       TO TRUE                06410318
064104             PERFORM 9910-ABEND                                   06410418
064105     END-EVALUATE.                                                06410518
064106                                                                  06410618
064110*2000-EXIT.                                                       06411006
064300                                                                  06430006
064400*-------------------------------------------------------------    06440006
064500* 2100-FORMAT-WRT-DEPT-FILE.                                      06450006
064600*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06460006
064700*     RECORD FOR XST_DEPT_STR TABLE.                              06470006
064800*-------------------------------------------------------------    06480006
064900 2100-FORMAT-WRT-DEPT-FILE.                                       06490006
065000                                                                  06500006
065100     IF PS-DEPT-HDR-NOT-WRITEN                                    06510006
065200        SET EP217-XST-DEPT TO TRUE                                06520006
065210        PERFORM 3100-FORMAT-WRT-HEADER-REC                        06521021
065220        SET PS-DEPT-HDR-WRITEN TO TRUE                            06522006
065230     END-IF.                                                      06523006
065240                                                                  06524006
065241     EVALUATE TRUE                                                06524121
065242         WHEN EP224-RECORD-ACTION = 'A'                           06524221
065243           PERFORM 2150-PROCESS-DEPT-ADD                          06524321
065244         WHEN EP224-RECORD-ACTION = 'D'                           06524421
065245           PERFORM 2200-PROCESS-DEPT-DEL                          06524521
065246     END-EVALUATE.                                                06524621
065579                                                                  06557915
065580     PERFORM 4100-WRITE-DETAIL-REC.                               06558020
065581                                                                  06558106
065582     PERFORM 6000-READ-DEPT-FILE.                                 06558206
065584                                                                  06558415
065585*2100-EXIT.                                                       06558515
065600                                                                  06560006
065610*-------------------------------------------------------------    06561021
065620* 2150-PROCESS-DEPT-ADD                                           06562021
065630*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06563021
065640*     RECORD FOR XST_DEPT_STR TABLE.                              06564021
065650*-------------------------------------------------------------    06565021
065660 2150-PROCESS-DEPT-ADD.                                           06566021
065670                                                                  06567021
065671**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06567121
065672                                                                  06567221
065673     SET FORM-MRCH-HR-LEN TO +1.                                  06567321
065674     MOVE 0 TO PV-BYTE-COUNT.                                     06567421
065675     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06567521
065676                                                                  06567621
065677**-- FORMAT RECORD ACTION                                         06567721
065678                                                                  06567821
065679     MOVE EP224-RECORD-ACTION TO  PV-RECORD-ACTION.               06567921
065680     PERFORM 3200-MOVE-DELIMITER.                                 06568021
065681     PERFORM 3600-MOVE-RECORD-ACTION.                             06568121
065682     PERFORM 3200-MOVE-DELIMITER.                                 06568221
065683                                                                  06568321
065684**-- FORMAT DEPT_NBR                                              06568421
065685     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06568521
065686     INITIALIZE PV-TALLY.                                         06568621
065687                                                                  06568721
065688     EVALUATE TRUE                                                06568821
065689         WHEN EP224-DPT-NBR = 0                                   06568921
065690            PERFORM 3700-MOVE-ZERO                                06569021
065691         WHEN OTHER                                               06569121
065692            INSPECT EP224-DPT-NBR  TALLYING PV-TALLY              06569221
065693                FOR LEADING ZERO                                  06569321
065694            SET PV-BIT-IDX TO PV-TALLY                            06569421
065695            SET PV-BIT-IDX UP BY +1                               06569521
065696                                                                  06569621
065697            MOVE EP224-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        06569721
065698                                                                  06569821
065699            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06569921
065700               FROM PV-BIT-IDX BY +1                              06570021
065701               UNTIL PV-EOF-IDX > 4                               06570121
065702     END-EVALUATE.                                                06570221
065703                                                                  06570321
065704     PERFORM 3200-MOVE-DELIMITER.                                 06570421
065705                                                                  06570521
065706**--  FORMAT BUSINESS GROUP NUMBER                                06570621
065707     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06570721
065708     INITIALIZE PV-TALLY.                                         06570821
065709                                                                  06570921
065710     EVALUATE TRUE                                                06571021
065711         WHEN EP224-BUS-GP-NBR = 0                                06571121
065712            PERFORM 3700-MOVE-ZERO                                06571221
065713         WHEN OTHER                                               06571321
065714            INSPECT EP224-BUS-GP-NBR  TALLYING PV-TALLY           06571421
065715                FOR LEADING ZERO                                  06571521
065716            SET PV-BIT-IDX TO PV-TALLY                            06571621
065717            SET PV-BIT-IDX UP BY +1                               06571721
065718                                                                  06571821
065719            MOVE EP224-BUS-GP-NBR TO PV-VARIABLE-OUTPUT-FIELD     06571921
065720                                                                  06572021
065721            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06572121
065722               FROM PV-BIT-IDX BY +1                              06572221
065723               UNTIL PV-EOF-IDX > 3                               06572321
065724     END-EVALUATE.                                                06572421
065725                                                                  06572521
065726     PERFORM 3200-MOVE-DELIMITER.                                 06572621
065727                                                                  06572721
065728**--  FORMAT DEPARTMENT NAME                                      06572821
065729     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06572921
065730                                                                  06573021
065731     EVALUATE TRUE                                                06573121
065732         WHEN EP224-DPT-NAME = SPACES                             06573221
065733             PERFORM 3300-MOVE-SPACE                              06573321
065734         WHEN OTHER                                               06573421
065735             MOVE EP224-DPT-NAME TO PV-VARIABLE-CHAR-FIELD        06573521
065736             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    06573621
065737                FROM 20 BY -1                                     06573721
065738                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         06573821
065739                                                NOT = SPACE       06573921
065740                                                                  06574021
065741             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   06574121
065742             FROM 1 BY 1                                          06574221
065743              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               06574321
065744     END-EVALUATE.                                                06574421
065745                                                                  06574521
065746     PERFORM 3200-MOVE-DELIMITER.                                 06574621
065747                                                                  06574721
065748**-- FORMAT MERCHANDISE LINE CODE                                 06574821
065749     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06574921
065750     MOVE EP224-MDSE-LNE-CDE  TO PV-VARIABLE-CHAR-FIELD.          06575021
065751     SET PV-CHR-EOF-IDX TO +1.                                    06575121
065752                                                                  06575221
065753     PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06575321
065754        FROM 1 BY 1                                               06575421
065755        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX                     06575521
065756                                                                  06575621
065757     PERFORM 3200-MOVE-DELIMITER.                                 06575721
065758                                                                  06575821
065759**-- FORMAT DMA NUMBER                                            06575921
065760                                                                  06576021
065761     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06576121
065762     INITIALIZE PV-TALLY.                                         06576221
065763                                                                  06576321
065764     EVALUATE TRUE                                                06576421
065765         WHEN EP224-DMA-NBR = 0                                   06576521
065766            PERFORM 3700-MOVE-ZERO                                06576621
065767         WHEN OTHER                                               06576721
065768            INSPECT EP224-DMA-NBR  TALLYING PV-TALLY              06576821
065769                FOR LEADING ZERO                                  06576921
065770            SET PV-BIT-IDX TO PV-TALLY                            06577021
065771            SET PV-BIT-IDX UP BY +1                               06577121
065772                                                                  06577221
065773            MOVE EP224-DMA-NBR TO PV-VARIABLE-OUTPUT-FIELD        06577321
065774                                                                  06577421
065775            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06577521
065776               FROM PV-BIT-IDX BY +1                              06577621
065777               UNTIL PV-EOF-IDX > 4                               06577721
065778     END-EVALUATE.                                                06577821
065779                                                                  06577921
065780     PERFORM 3200-MOVE-DELIMITER.                                 06578021
065781                                                                  06578121
065782**-- FORMAT STORE ZONE CODE                                       06578221
065783                                                                  06578321
065784     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06578421
065785                                                                  06578521
065786     EVALUATE TRUE                                                06578621
065787         WHEN EP224-STR-ZONE-CDE = SPACES                         06578721
065788             PERFORM 3300-MOVE-SPACE                              06578821
065789         WHEN OTHER                                               06578921
065790             MOVE EP224-STR-ZONE-CDE TO PV-VARIABLE-CHAR-FIELD    06579021
065791             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    06579121
065792                FROM 5 BY -1                                      06579221
065793                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         06579321
065794                                                NOT = SPACE       06579421
065795                                                                  06579521
065796             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   06579621
065797             FROM 1 BY 1                                          06579721
065798              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               06579821
065799     END-EVALUATE.                                                06579921
065800                                                                  06580021
065801     PERFORM 3200-MOVE-DELIMITER.                                 06580121
065802**-- FORMAT BUYER NUMBER                                          06580221
065803                                                                  06580321
065804     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06580421
065805     INITIALIZE PV-TALLY.                                         06580521
065806                                                                  06580621
065807     EVALUATE TRUE                                                06580721
065808         WHEN EP224-BUYER-NBR = 0                                 06580821
065809            PERFORM 3700-MOVE-ZERO                                06580921
065810         WHEN OTHER                                               06581021
065811            INSPECT EP224-BUYER-NBR  TALLYING PV-TALLY            06581121
065812                FOR LEADING ZERO                                  06581221
065813            SET PV-BIT-IDX TO PV-TALLY                            06581321
065814            SET PV-BIT-IDX UP BY +1                               06581421
065815                                                                  06581521
065816            MOVE EP224-BUYER-NBR TO PV-VARIABLE-OUTPUT-FIELD      06581621
065817                                                                  06581721
065818            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06581821
065819               FROM PV-BIT-IDX BY +1                              06581921
065820               UNTIL PV-EOF-IDX > 4                               06582021
065821     END-EVALUATE.                                                06582121
065822                                                                  06582221
065823     PERFORM 3200-MOVE-DELIMITER.                                 06582321
065824                                                                  06582421
065825**-- FORMAT CONTINUED CLEARANCE EXCLUSION INDICATOR               06582521
065826                                                                  06582621
065827     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06582721
065828     MOVE EP224-CONT-CLR-EXCL-IND  TO PV-VARIABLE-CHAR-FIELD.     06582821
065829     SET PV-CHR-EOF-IDX TO +1.                                    06582921
065830                                                                  06583021
065831     PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06583121
065832        FROM 1 BY 1                                               06583221
065833        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX                     06583321
065834                                                                  06583421
065835     PERFORM 3200-MOVE-DELIMITER.                                 06583521
065836                                                                  06583621
065837**-- FORMAT LAST-UPDATE TIMESTAMP                                 06583721
065838                                                                  06583821
065839     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06583921
065840     INITIALIZE PV-INPUT-TIMESTAMP.                               06584021
065841     INITIALIZE PV-OUTPUT-SQL-TIMESTAMP.                          06584121
065842                                                                  06584221
065843     MOVE EP224-LAST-UPD-TMST  TO PV-INPUT-TIMESTAMP              06584321
065844     PERFORM 3900-CONVERT-TIMESTAMP.                              06584421
065845     SET PV-CHR-EOF-IDX TO +19                                    06584521
065846                                                                  06584621
065847     MOVE PV-OUTPUT-SQL-TIMESTAMP TO PV-VARIABLE-CHAR-FIELD.      06584721
065848     PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06584821
065849        FROM 1 BY 1                                               06584921
065850        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX                     06585021
065851                                                                  06585121
065852     PERFORM 3200-MOVE-DELIMITER.                                 06585221
065853                                                                  06585321
065854**-- FORMAT STORE LAST UPDATE TIMESTAMP                           06585421
065855                                                                  06585521
065856     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06585621
065857     INITIALIZE PV-INPUT-TIMESTAMP.                               06585721
065858     INITIALIZE PV-OUTPUT-SQL-TIMESTAMP.                          06585821
065859                                                                  06585921
065860     MOVE EP224-SOR-LAST-UPD-TMST  TO PV-INPUT-TIMESTAMP          06586021
065861     PERFORM 3900-CONVERT-TIMESTAMP.                              06586121
065862     SET PV-CHR-EOF-IDX TO +19                                    06586221
065863                                                                  06586321
065864     MOVE PV-OUTPUT-SQL-TIMESTAMP TO PV-VARIABLE-CHAR-FIELD.      06586421
065865     PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06586521
065866        FROM 1 BY 1                                               06586621
065867        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX                     06586721
065868                                                                  06586821
065869     PERFORM 3200-MOVE-DELIMITER.                                 06586921
065870*2150-EXIT.                                                       06587021
065872                                                                  06587221
065873*-------------------------------------------------------------    06587321
065874* 2200-PROCESS-DEPT-DEL                                           06587421
065875*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06587521
065876*     RECORD FOR XST_DEPT_STR TABLE.                              06587621
065877*-------------------------------------------------------------    06587721
065878 2200-PROCESS-DEPT-DEL.                                           06587821
065879                                                                  06587921
065880**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06588021
065881                                                                  06588121
065882     SET FORM-MRCH-HR-LEN TO +1.                                  06588221
065883     MOVE 0 TO PV-BYTE-COUNT.                                     06588321
065884     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06588421
065885                                                                  06588521
065886**-- FORMAT RECORD ACTION                                         06588621
065887                                                                  06588721
065888     MOVE EP224-RECORD-ACTION TO  PV-RECORD-ACTION.               06588821
065889     PERFORM 3200-MOVE-DELIMITER.                                 06588921
065890     PERFORM 3600-MOVE-RECORD-ACTION.                             06589021
065891     PERFORM 3200-MOVE-DELIMITER.                                 06589121
065892                                                                  06589221
065893**-- FORMAT DEPT_NBR                                              06589321
065894     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06589421
065895     INITIALIZE PV-TALLY.                                         06589521
065896                                                                  06589621
065897     EVALUATE TRUE                                                06589721
065898         WHEN EP224-DPT-NBR = 0                                   06589821
065899            PERFORM 3700-MOVE-ZERO                                06589921
065900         WHEN OTHER                                               06590021
065901            INSPECT EP224-DPT-NBR  TALLYING PV-TALLY              06590121
065902                FOR LEADING ZERO                                  06590221
065903            SET PV-BIT-IDX TO PV-TALLY                            06590321
065904            SET PV-BIT-IDX UP BY +1                               06590421
065905                                                                  06590521
065906            MOVE EP224-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        06590621
065907                                                                  06590721
065908            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06590821
065909               FROM PV-BIT-IDX BY +1                              06590921
065910               UNTIL PV-EOF-IDX > 4                               06591021
065911     END-EVALUATE.                                                06591121
065912                                                                  06591221
065913     PERFORM 3200-MOVE-DELIMITER.                                 06591321
065914                                                                  06591421
065915**-- FORMAT GROUP NUMBER                                          06591521
065916     PERFORM 3200-MOVE-DELIMITER.                                 06591621
065917                                                                  06591721
065918**-- FORMAT DEPARTMENT NAME                                       06591821
065919     PERFORM 3200-MOVE-DELIMITER.                                 06591921
065920                                                                  06592021
065921**-- FORMAT MERCHANDISE LINE CODE                                 06592121
065922     PERFORM 3200-MOVE-DELIMITER.                                 06592221
065923                                                                  06592321
065924**-- FORMAT DMA NUMBER                                            06592421
065925     PERFORM 3200-MOVE-DELIMITER.                                 06592521
065926                                                                  06592621
065927**-- FORMAT STORE ZONE CODE                                       06592721
065928     PERFORM 3200-MOVE-DELIMITER.                                 06592821
065929                                                                  06592921
065930**-- FORMAT BUYER NUMBER                                          06593021
065931     PERFORM 3200-MOVE-DELIMITER.                                 06593121
065932                                                                  06593221
065933**-- FORMAT CC EXCL IND                                           06593321
065934     PERFORM 3200-MOVE-DELIMITER.                                 06593421
065935                                                                  06593521
065936**-- FORMAT LAST UPDATE TIMESTAMP                                 06593621
065937     PERFORM 3200-MOVE-DELIMITER.                                 06593721
065938                                                                  06593821
065939**-- FORMAT SOR UPDATE TIMESTAMP                                  06593921
065940     PERFORM 3200-MOVE-DELIMITER.                                 06594021
065941                                                                  06594121
065942*2200-EXIT.                                                       06594221
065944                                                                  06594421
065945*-------------------------------------------------------------    06594521
065946* 2300-FORMAT-WRT-MJCL-FILE.                                      06594621
065950*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06595021
066000*     RECORD FOR XST_MAJ_CL_STR TABLE.                            06600006
066100*-------------------------------------------------------------    06610006
066200 2300-FORMAT-WRT-MJCL-FILE.                                       06620021
066300                                                                  06630006
066310     IF PS-MJCL-HDR-NOT-WRITEN                                    06631006
066320        SET EP217-XST-MAJ-CL TO TRUE                              06632006
066330        PERFORM 3100-FORMAT-WRT-HEADER-REC                        06633021
066340        SET PS-MJCL-HDR-WRITEN TO TRUE                            06634006
066350     END-IF.                                                      06635006
066360                                                                  06636006
066361     EVALUATE TRUE                                                06636121
066362         WHEN EP226-RECORD-ACTION = 'A'                           06636223
066363           PERFORM 2350-PROCESS-MAJCL-ADD                         06636321
066364         WHEN EP226-RECORD-ACTION = 'D'                           06636423
066365           PERFORM 2400-PROCESS-MAJCL-DEL                         06636521
066366     END-EVALUATE.                                                06636621
066367                                                                  06636721
066465                                                                  06646506
066466     PERFORM 4100-WRITE-DETAIL-REC.                               06646620
066467                                                                  06646715
066468     PERFORM 6100-READ-MAJ-CL-FILE.                               06646806
066469                                                                  06646906
066470*2300-EXIT.                                                       06647021
066600                                                                  06660006
066610*-------------------------------------------------------------    06661021
066620* 2350-PROCESS-MAJCL-ADD                                          06662021
066630*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06663021
066640*     RECORD FOR XST_DEPT_STR TABLE.                              06664021
066650*-------------------------------------------------------------    06665021
066660 2350-PROCESS-MAJCL-ADD.                                          06666021
066670                                                                  06667021
066671**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06667122
066672                                                                  06667222
066673     SET FORM-MRCH-HR-LEN TO +1.                                  06667322
066674     MOVE 0 TO PV-BYTE-COUNT.                                     06667422
066675     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06667522
066676                                                                  06667622
066677**-- FORMAT RECORD ACTION                                         06667722
066678                                                                  06667822
066679     MOVE EP226-RECORD-ACTION TO  PV-RECORD-ACTION.               06667922
066680     PERFORM 3200-MOVE-DELIMITER.                                 06668022
066681     PERFORM 3600-MOVE-RECORD-ACTION.                             06668122
066682     PERFORM 3200-MOVE-DELIMITER.                                 06668222
066683                                                                  06668322
066684**-- FORMAT DEPT_NBR                                              06668422
066685     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06668522
066686     INITIALIZE PV-TALLY.                                         06668622
066687                                                                  06668722
066688     EVALUATE TRUE                                                06668822
066689         WHEN EP226-DPT-NBR = 0                                   06668922
066690            PERFORM 3700-MOVE-ZERO                                06669022
066691         WHEN OTHER                                               06669122
066692            INSPECT EP226-DPT-NBR  TALLYING PV-TALLY              06669222
066693                FOR LEADING ZERO                                  06669322
066694            SET PV-BIT-IDX TO PV-TALLY                            06669422
066695            SET PV-BIT-IDX UP BY +1                               06669522
066696                                                                  06669622
066697            MOVE EP226-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        06669722
066698                                                                  06669822
066699            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06669922
066700               FROM PV-BIT-IDX BY +1                              06670022
066701               UNTIL PV-EOF-IDX > 4                               06670122
066702     END-EVALUATE.                                                06670222
066703                                                                  06670322
066704     PERFORM 3200-MOVE-DELIMITER.                                 06670422
066705                                                                  06670522
066706**-- FORMAT MAJOR CLASS NUMBER                                    06670622
066707     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06670722
066708     INITIALIZE PV-TALLY.                                         06670822
066709                                                                  06670922
066710     EVALUATE TRUE                                                06671022
066711         WHEN EP226-MAJ-CL-NBR = 0                                06671122
066712            PERFORM 3700-MOVE-ZERO                                06671222
066713         WHEN OTHER                                               06671322
066714            INSPECT EP226-MAJ-CL-NBR  TALLYING PV-TALLY           06671422
066715                FOR LEADING ZERO                                  06671522
066716            SET PV-BIT-IDX TO PV-TALLY                            06671622
066717            SET PV-BIT-IDX UP BY +1                               06671722
066718                                                                  06671822
066719            MOVE EP226-MAJ-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     06671922
066720                                                                  06672022
066721            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06672122
066722               FROM PV-BIT-IDX BY +1                              06672222
066723               UNTIL PV-EOF-IDX > 4                               06672322
066724     END-EVALUATE.                                                06672422
066725                                                                  06672522
066726     PERFORM 3200-MOVE-DELIMITER.                                 06672622
066727                                                                  06672722
066728**--  FORMAT MAJOR CLASS NAME                                     06672822
066729     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06672922
066730                                                                  06673022
066731     EVALUATE TRUE                                                06673122
066732         WHEN EP226-MAJ-CL-NAME = SPACES                          06673222
066733             PERFORM 3300-MOVE-SPACE                              06673322
066734         WHEN OTHER                                               06673422
066735             MOVE EP226-MAJ-CL-NAME TO PV-VARIABLE-CHAR-FIELD     06673522
066736             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    06673622
066737                FROM 20 BY -1                                     06673722
066738                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         06673822
066739                                                NOT = SPACE       06673922
066740                                                                  06674022
066741             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   06674122
066742             FROM 1 BY 1                                          06674222
066743              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               06674322
066744     END-EVALUATE.                                                06674422
066745                                                                  06674522
066746     PERFORM 3200-MOVE-DELIMITER.                                 06674622
066747*2350-EXIT.                                                       06674721
066749                                                                  06674921
066750*-------------------------------------------------------------    06675021
066751* 2400-PROCESS-MAJCL-DEL                                          06675121
066752*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06675221
066753*     RECORD FOR XST_DEPT_STR TABLE.                              06675321
066754*-------------------------------------------------------------    06675421
066755 2400-PROCESS-MAJCL-DEL.                                          06675521
066756                                                                  06675621
066757**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06675722
066758                                                                  06675822
066759     SET FORM-MRCH-HR-LEN TO +1.                                  06675922
066760     MOVE 0 TO PV-BYTE-COUNT.                                     06676022
066761     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06676122
066762                                                                  06676222
066763**-- FORMAT RECORD ACTION                                         06676322
066764                                                                  06676422
066765     MOVE EP226-RECORD-ACTION TO  PV-RECORD-ACTION.               06676522
066766     PERFORM 3200-MOVE-DELIMITER.                                 06676622
066767     PERFORM 3600-MOVE-RECORD-ACTION.                             06676722
066768     PERFORM 3200-MOVE-DELIMITER.                                 06676822
066769                                                                  06676922
066770**-- FORMAT DEPT_NBR                                              06677022
066771     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06677122
066772     INITIALIZE PV-TALLY.                                         06677222
066773                                                                  06677322
066774     EVALUATE TRUE                                                06677422
066775         WHEN EP226-DPT-NBR = 0                                   06677522
066776            PERFORM 3700-MOVE-ZERO                                06677622
066777         WHEN OTHER                                               06677722
066778            INSPECT EP226-DPT-NBR  TALLYING PV-TALLY              06677822
066779                FOR LEADING ZERO                                  06677922
066780            SET PV-BIT-IDX TO PV-TALLY                            06678022
066781            SET PV-BIT-IDX UP BY +1                               06678122
066782                                                                  06678222
066783            MOVE EP226-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        06678322
066784                                                                  06678422
066785            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06678522
066786               FROM PV-BIT-IDX BY +1                              06678622
066787               UNTIL PV-EOF-IDX > 4                               06678722
066788     END-EVALUATE.                                                06678822
066789                                                                  06678922
066790     PERFORM 3200-MOVE-DELIMITER.                                 06679022
066791                                                                  06679122
066792**-- FORMAT MAJOR CLASS NUMBER                                    06679222
066793     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06679322
066794     INITIALIZE PV-TALLY.                                         06679422
066795                                                                  06679522
066796     EVALUATE TRUE                                                06679622
066797         WHEN EP226-MAJ-CL-NBR = 0                                06679722
066798            PERFORM 3700-MOVE-ZERO                                06679822
066799         WHEN OTHER                                               06679922
066800            INSPECT EP226-MAJ-CL-NBR  TALLYING PV-TALLY           06680022
066801                FOR LEADING ZERO                                  06680122
066802            SET PV-BIT-IDX TO PV-TALLY                            06680222
066803            SET PV-BIT-IDX UP BY +1                               06680322
066804                                                                  06680422
066805            MOVE EP226-MAJ-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     06680522
066806                                                                  06680622
066807            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06680722
066808               FROM PV-BIT-IDX BY +1                              06680822
066809               UNTIL PV-EOF-IDX > 4                               06680922
066810     END-EVALUATE.                                                06681022
066811                                                                  06681122
066812     PERFORM 3200-MOVE-DELIMITER.                                 06681222
066813                                                                  06681322
066814**--  FORMAT MAJOR CLASS NAME                                     06681422
066815     PERFORM 3200-MOVE-DELIMITER.                                 06681522
066816                                                                  06681622
066817*2400-EXIT.                                                       06681721
066819                                                                  06681921
066820                                                                  06682006
066830*-------------------------------------------------------------    06683006
066900* 2500-FORMAT-WRT-SBCL-FILE.                                      06690021
067000*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06700006
067100*     RECORD FOR XST_SUB_CL_STR TABLE.                            06710006
067200*-------------------------------------------------------------    06720006
067300 2500-FORMAT-WRT-SBCL-FILE.                                       06730021
067400                                                                  06740006
067410     IF PS-SBCL-HDR-NOT-WRITEN                                    06741006
067420        SET EP217-XST-SUB-CL TO TRUE                              06742006
067430        PERFORM 3100-FORMAT-WRT-HEADER-REC                        06743021
067440        SET PS-SBCL-HDR-WRITEN TO TRUE                            06744006
067450     END-IF.                                                      06745006
067460                                                                  06746006
067462     EVALUATE TRUE                                                06746222
067463         WHEN EP227-RECORD-ACTION = 'A'                           06746322
067464           PERFORM 2550-PROCESS-SUBCL-ADD                         06746422
067465         WHEN EP227-RECORD-ACTION = 'D'                           06746522
067466           PERFORM 2600-PROCESS-SUBCL-DEL                         06746622
067467     END-EVALUATE.                                                06746722
067468                                                                  06746822
067619     PERFORM 4100-WRITE-DETAIL-REC.                               06761920
067620                                                                  06762015
067621     PERFORM 6200-READ-SUB-CL-FILE.                               06762112
067622                                                                  06762206
067623*2500-EXIT.                                                       06762321
067700                                                                  06770006
067710*-------------------------------------------------------------    06771021
067720* 2550-PROCESS-SUBCL-ADD                                          06772021
067730*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06773021
067740*     RECORD FOR XST_DEPT_STR TABLE.                              06774021
067750*-------------------------------------------------------------    06775021
067760 2550-PROCESS-SUBCL-ADD.                                          06776021
067770                                                                  06777021
067771**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06777122
067772                                                                  06777222
067773     SET FORM-MRCH-HR-LEN TO +1.                                  06777322
067774     MOVE 0 TO PV-BYTE-COUNT.                                     06777422
067775     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06777522
067776                                                                  06777622
067777**-- FORMAT RECORD ACTION                                         06777722
067778                                                                  06777822
067779     MOVE EP227-RECORD-ACTION TO  PV-RECORD-ACTION.               06777922
067780     PERFORM 3200-MOVE-DELIMITER.                                 06778022
067781     PERFORM 3600-MOVE-RECORD-ACTION.                             06778122
067782     PERFORM 3200-MOVE-DELIMITER.                                 06778222
067783                                                                  06778322
067784**-- FORMAT DEPT_NBR                                              06778422
067785     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06778522
067786     INITIALIZE PV-TALLY.                                         06778622
067787                                                                  06778722
067788     EVALUATE TRUE                                                06778822
067789         WHEN EP227-DPT-NBR = 0                                   06778922
067790            PERFORM 3700-MOVE-ZERO                                06779022
067791         WHEN OTHER                                               06779122
067792            INSPECT EP227-DPT-NBR  TALLYING PV-TALLY              06779222
067793                FOR LEADING ZERO                                  06779322
067794            SET PV-BIT-IDX TO PV-TALLY                            06779422
067795            SET PV-BIT-IDX UP BY +1                               06779522
067796                                                                  06779622
067797            MOVE EP227-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        06779722
067798                                                                  06779822
067799            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06779922
067800               FROM PV-BIT-IDX BY +1                              06780022
067801               UNTIL PV-EOF-IDX > 4                               06780122
067802     END-EVALUATE.                                                06780222
067803                                                                  06780322
067804     PERFORM 3200-MOVE-DELIMITER.                                 06780422
067805                                                                  06780522
067806**-- FORMAT MAJOR CLASS NUMBER                                    06780622
067807     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06780722
067808     INITIALIZE PV-TALLY.                                         06780822
067809                                                                  06780922
067810     EVALUATE TRUE                                                06781022
067811         WHEN EP227-MAJ-CL-NBR = 0                                06781122
067812            PERFORM 3700-MOVE-ZERO                                06781222
067813         WHEN OTHER                                               06781322
067814            INSPECT EP227-MAJ-CL-NBR  TALLYING PV-TALLY           06781422
067815                FOR LEADING ZERO                                  06781522
067816            SET PV-BIT-IDX TO PV-TALLY                            06781622
067817            SET PV-BIT-IDX UP BY +1                               06781722
067818                                                                  06781822
067819            MOVE EP227-MAJ-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     06781922
067820                                                                  06782022
067821            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06782122
067822               FROM PV-BIT-IDX BY +1                              06782222
067823               UNTIL PV-EOF-IDX > 4                               06782322
067824     END-EVALUATE.                                                06782422
067825                                                                  06782522
067826     PERFORM 3200-MOVE-DELIMITER.                                 06782622
067827                                                                  06782722
067828**-- FORMAT SUB CLASS NUMBER                                      06782822
067829     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06782922
067830     INITIALIZE PV-TALLY.                                         06783022
067831                                                                  06783122
067832     EVALUATE TRUE                                                06783222
067833         WHEN EP227-SUB-CL-NBR = 0                                06783322
067834            PERFORM 3700-MOVE-ZERO                                06783422
067835         WHEN OTHER                                               06783522
067836            INSPECT EP227-SUB-CL-NBR  TALLYING PV-TALLY           06783622
067837                FOR LEADING ZERO                                  06783722
067838            SET PV-BIT-IDX TO PV-TALLY                            06783822
067839            SET PV-BIT-IDX UP BY +1                               06783922
067840                                                                  06784022
067841            MOVE EP227-SUB-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     06784122
067842                                                                  06784222
067843            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06784322
067844               FROM PV-BIT-IDX BY +1                              06784422
067845               UNTIL PV-EOF-IDX > 4                               06784522
067846     END-EVALUATE.                                                06784622
067847                                                                  06784722
067848     PERFORM 3200-MOVE-DELIMITER.                                 06784822
067849                                                                  06784922
067850**--  FORMAT SUB CLASS NAME                                       06785022
067851     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06785122
067852                                                                  06785222
067853     EVALUATE TRUE                                                06785322
067854         WHEN EP227-SUB-CL-NAME = SPACES                          06785422
067855             PERFORM 3300-MOVE-SPACE                              06785522
067856         WHEN OTHER                                               06785622
067857             MOVE EP227-SUB-CL-NAME TO PV-VARIABLE-CHAR-FIELD     06785722
067858             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    06785822
067859                FROM 20 BY -1                                     06785922
067860                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         06786022
067861                                                NOT = SPACE       06786122
067862                                                                  06786222
067863             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   06786322
067864             FROM 1 BY 1                                          06786422
067865              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               06786522
067866     END-EVALUATE.                                                06786622
067867                                                                  06786722
067868     PERFORM 3200-MOVE-DELIMITER.                                 06786822
067869                                                                  06786922
067870**--  FORMAT POS DESCRIPTION                                      06787022
067871     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06787122
067872                                                                  06787222
067873     EVALUATE TRUE                                                06787322
067874         WHEN EP227-POS-DESC = SPACES                             06787422
067875             PERFORM 3300-MOVE-SPACE                              06787522
067876         WHEN OTHER                                               06787622
067877             MOVE EP227-POS-DESC TO PV-VARIABLE-CHAR-FIELD        06787722
067878             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    06787822
067879                FROM 30 BY -1                                     06787922
067880                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         06788022
067881                                                NOT = SPACE       06788122
067882                                                                  06788222
067883             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   06788322
067884             FROM 1 BY 1                                          06788422
067885              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               06788522
067886     END-EVALUATE.                                                06788622
067887                                                                  06788722
067888     PERFORM 3200-MOVE-DELIMITER.                                 06788822
067889                                                                  06788922
067890**--  FORMAT DISCOUNT ELIGIBILITY INDICATOR                       06789022
067891     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06789122
067892                                                                  06789222
067893     MOVE EP227-DISC-ELIG-IND TO PV-VARIABLE-CHAR-FIELD.          06789322
067894     SET PV-CHR-EOF-IDX TO +1.                                    06789422
067895                                                                  06789522
067896     PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06789622
067897     FROM 1 BY 1                                                  06789722
067898      UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX                       06789822
067899                                                                  06789922
067900     PERFORM 3200-MOVE-DELIMITER.                                 06790022
067901                                                                  06790122
067902*2550-EXIT.                                                       06790221
067904                                                                  06790421
067905*-------------------------------------------------------------    06790521
067906* 2600-PROCESS-SUBCL-DEL                                          06790621
067907*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06790721
067908*     RECORD FOR XST_DEPT_STR TABLE.                              06790821
067909*-------------------------------------------------------------    06790921
067910 2600-PROCESS-SUBCL-DEL.                                          06791021
067911                                                                  06791121
067912**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06791222
067913                                                                  06791322
067914     SET FORM-MRCH-HR-LEN TO +1.                                  06791422
067915     MOVE 0 TO PV-BYTE-COUNT.                                     06791522
067916     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06791622
067917                                                                  06791722
067918**-- FORMAT RECORD ACTION                                         06791822
067919                                                                  06791922
067920     MOVE EP227-RECORD-ACTION TO  PV-RECORD-ACTION.               06792022
067921     PERFORM 3200-MOVE-DELIMITER.                                 06792122
067922     PERFORM 3600-MOVE-RECORD-ACTION.                             06792222
067923     PERFORM 3200-MOVE-DELIMITER.                                 06792322
067924                                                                  06792422
067925**-- FORMAT DEPT_NBR                                              06792522
067926     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06792622
067927     INITIALIZE PV-TALLY.                                         06792722
067928                                                                  06792822
067929     EVALUATE TRUE                                                06792922
067930         WHEN EP227-DPT-NBR = 0                                   06793022
067931            PERFORM 3700-MOVE-ZERO                                06793122
067932         WHEN OTHER                                               06793222
067933            INSPECT EP227-DPT-NBR  TALLYING PV-TALLY              06793322
067934                FOR LEADING ZERO                                  06793422
067935            SET PV-BIT-IDX TO PV-TALLY                            06793522
067936            SET PV-BIT-IDX UP BY +1                               06793622
067937                                                                  06793722
067938            MOVE EP227-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        06793822
067939                                                                  06793922
067940            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06794022
067941               FROM PV-BIT-IDX BY +1                              06794122
067942               UNTIL PV-EOF-IDX > 4                               06794222
067943     END-EVALUATE.                                                06794322
067944                                                                  06794422
067945     PERFORM 3200-MOVE-DELIMITER.                                 06794522
067946                                                                  06794622
067947**-- FORMAT MAJOR CLASS NUMBER                                    06794722
067948     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06794822
067949     INITIALIZE PV-TALLY.                                         06794922
067950                                                                  06795022
067951     EVALUATE TRUE                                                06795122
067952         WHEN EP227-MAJ-CL-NBR = 0                                06795222
067953            PERFORM 3700-MOVE-ZERO                                06795322
067954         WHEN OTHER                                               06795422
067955            INSPECT EP227-MAJ-CL-NBR  TALLYING PV-TALLY           06795522
067956                FOR LEADING ZERO                                  06795622
067957            SET PV-BIT-IDX TO PV-TALLY                            06795722
067958            SET PV-BIT-IDX UP BY +1                               06795822
067959                                                                  06795922
067960            MOVE EP227-MAJ-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     06796022
067961                                                                  06796122
067962            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06796222
067963               FROM PV-BIT-IDX BY +1                              06796322
067964               UNTIL PV-EOF-IDX > 4                               06796422
067965     END-EVALUATE.                                                06796522
067966                                                                  06796622
067967     PERFORM 3200-MOVE-DELIMITER.                                 06796722
067968                                                                  06796822
067969**-- FORMAT SUB CLASS NUMBER                                      06796922
067970     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06797022
067971     INITIALIZE PV-TALLY.                                         06797122
067972                                                                  06797222
067973     EVALUATE TRUE                                                06797322
067974         WHEN EP227-SUB-CL-NBR = 0                                06797422
067975            PERFORM 3700-MOVE-ZERO                                06797522
067976         WHEN OTHER                                               06797622
067977            INSPECT EP227-SUB-CL-NBR  TALLYING PV-TALLY           06797722
067978                FOR LEADING ZERO                                  06797822
067979            SET PV-BIT-IDX TO PV-TALLY                            06797922
067980            SET PV-BIT-IDX UP BY +1                               06798022
067981                                                                  06798122
067982            MOVE EP227-SUB-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     06798222
067983                                                                  06798322
067984            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06798422
067985               FROM PV-BIT-IDX BY +1                              06798522
067986               UNTIL PV-EOF-IDX > 4                               06798622
067987     END-EVALUATE.                                                06798722
067988                                                                  06798822
067989     PERFORM 3200-MOVE-DELIMITER.                                 06798922
067990                                                                  06799022
067991**--  FORMAT SUB CLASS NAME                                       06799122
067992     PERFORM 3200-MOVE-DELIMITER.                                 06799222
067993                                                                  06799322
067994**--  FORMAT POS DESCRIPTION                                      06799422
067995     PERFORM 3200-MOVE-DELIMITER.                                 06799522
067996                                                                  06799622
067997**--  FORMAT DISC ELIGIBILITY INDICATOR                           06799722
067998     PERFORM 3200-MOVE-DELIMITER.                                 06799822
067999                                                                  06799922
068000*2600-EXIT.                                                       06800022
068002                                                                  06800222
068003*-------------------------------------------------------------    06800322
068004* 2700-FORMAT-WRT-VEND-FILE.                                      06800422
068010*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06801022
068100*     RECORD FOR XST_VND TABLE.                                   06810006
068200*-------------------------------------------------------------    06820006
068300 2700-FORMAT-WRT-VEND-FILE.                                       06830021
068400                                                                  06840006
068410     IF PS-VEND-HDR-NOT-WRITEN                                    06841006
068420        SET EP217-XST-VEND   TO TRUE                              06842006
068430        PERFORM 3100-FORMAT-WRT-HEADER-REC                        06843021
068440        SET PS-VEND-HDR-WRITEN TO TRUE                            06844006
068450     END-IF.                                                      06845006
068460                                                                  06846006
068470**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06847006
068480                                                                  06848006
068490     SET FORM-MRCH-HR-LEN TO +1.                                  06849006
068491     MOVE 0 TO PV-BYTE-COUNT.                                     06849106
068492     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06849206
068493                                                                  06849306
068494**-- FORMAT RECORD ACTION                                         06849406
068495                                                                  06849506
068496     MOVE EP229-RECORD-ACTION TO  PV-RECORD-ACTION.               06849606
068497     PERFORM 3200-MOVE-DELIMITER.                                 06849721
068498     PERFORM 3600-MOVE-RECORD-ACTION.                             06849821
068499     PERFORM 3200-MOVE-DELIMITER.                                 06849921
068500                                                                  06850006
068501**-- FORMAT VENDOR ID                                             06850106
068502     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06850206
068503     INITIALIZE PV-TALLY.                                         06850306
068504                                                                  06850406
068505     EVALUATE TRUE                                                06850506
068506         WHEN EP229-VENDOR-ID = 0                                 06850606
068507            PERFORM 3700-MOVE-ZERO                                06850721
068508         WHEN OTHER                                               06850806
068509            INSPECT EP229-VENDOR-ID  TALLYING PV-TALLY            06850906
068510                FOR LEADING ZERO                                  06851006
068511            SET PV-BIT-IDX TO PV-TALLY                            06851106
068512            SET PV-BIT-IDX UP BY +1                               06851206
068513                                                                  06851306
068514            MOVE EP229-VENDOR-ID TO PV-VARIABLE-OUTPUT-FIELD      06851406
068515                                                                  06851506
068516            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06851621
068517               FROM PV-BIT-IDX BY +1                              06851706
068518               UNTIL PV-EOF-IDX > 10                              06851821
068519     END-EVALUATE.                                                06851906
068520                                                                  06852006
068521     PERFORM 3200-MOVE-DELIMITER.                                 06852121
068522                                                                  06852206
068523**--  FORMAT VENDOR NAME                                          06852306
068524     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06852406
068525                                                                  06852506
068526     EVALUATE TRUE                                                06852606
068527         WHEN EP229-VENDOR-NAME = SPACES                          06852706
068528             PERFORM 3300-MOVE-SPACE                              06852821
068529         WHEN OTHER                                               06852906
068530             MOVE EP229-VENDOR-NAME TO PV-VARIABLE-CHAR-FIELD     06853006
068531             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    06853121
068532                FROM 30 BY -1                                     06853206
068533                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         06853306
068534                                                NOT = SPACE       06853406
068535                                                                  06853506
068536             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   06853621
068537             FROM 1 BY 1                                          06853706
068538              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               06853806
068539     END-EVALUATE.                                                06853906
068540                                                                  06854006
068541     PERFORM 3200-MOVE-DELIMITER.                                 06854121
068542                                                                  06854206
068543     PERFORM 4100-WRITE-DETAIL-REC.                               06854320
068544                                                                  06854415
068545     PERFORM 6400-READ-VENDOR-FILE.                               06854506
068546                                                                  06854606
068550*2700-EXIT.                                                       06855021
068700                                                                  06870006
068800*-------------------------------------------------------------    06880006
068900* 2800-FORMAT-WRT-VDPT-FILE.                                      06890021
069000*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06900006
069100*     RECORD FOR XST_VND_DEPT_STR TABLE.                          06910006
069200*-------------------------------------------------------------    06920006
069300 2800-FORMAT-WRT-VDPT-FILE.                                       06930021
069400                                                                  06940006
069410     IF PS-VDPT-HDR-NOT-WRITEN                                    06941017
069420        SET EP217-XST-VND-DEPT TO TRUE                            06942006
069430        PERFORM 3100-FORMAT-WRT-HEADER-REC                        06943021
069440        SET PS-VDPT-HDR-WRITEN TO TRUE                            06944006
069450     END-IF.                                                      06945006
069460                                                                  06946006
069470**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  06947006
069480                                                                  06948006
069490     SET FORM-MRCH-HR-LEN TO +1.                                  06949006
069491     MOVE 0 TO PV-BYTE-COUNT.                                     06949106
069492     INITIALIZE FORMATTED-MERCH-HIER-REC.                         06949206
069493                                                                  06949306
069494**-- FORMAT RECORD ACTION                                         06949406
069495                                                                  06949506
069496     MOVE EP230-RECORD-ACTION TO  PV-RECORD-ACTION.               06949606
069497     PERFORM 3200-MOVE-DELIMITER.                                 06949721
069498     PERFORM 3600-MOVE-RECORD-ACTION.                             06949821
069499     PERFORM 3200-MOVE-DELIMITER.                                 06949921
069500                                                                  06950006
069501**-- FORMAT VENDOR ID                                             06950106
069502     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06950206
069503     INITIALIZE PV-TALLY.                                         06950306
069504                                                                  06950406
069505     EVALUATE TRUE                                                06950506
069506         WHEN EP230-VENDOR-ID = 0                                 06950606
069507            PERFORM 3700-MOVE-ZERO                                06950721
069508         WHEN OTHER                                               06950806
069509            INSPECT EP230-VENDOR-ID  TALLYING PV-TALLY            06950906
069510                FOR LEADING ZERO                                  06951006
069511            SET PV-BIT-IDX TO PV-TALLY                            06951106
069512            SET PV-BIT-IDX UP BY +1                               06951206
069513                                                                  06951306
069514            MOVE EP230-VENDOR-ID TO PV-VARIABLE-OUTPUT-FIELD      06951406
069515                                                                  06951506
069516            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06951621
069517               FROM PV-BIT-IDX BY +1                              06951706
069518               UNTIL PV-EOF-IDX > 10                              06951821
069519     END-EVALUATE.                                                06951906
069520                                                                  06952006
069521     PERFORM 3200-MOVE-DELIMITER.                                 06952121
069522                                                                  06952206
069523**-- FORMAT DEPT_NBR                                              06952306
069524     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06952406
069525     INITIALIZE PV-TALLY.                                         06952506
069526                                                                  06952606
069527     EVALUATE TRUE                                                06952706
069528         WHEN EP230-DPT-NBR = 0                                   06952806
069529            PERFORM 3700-MOVE-ZERO                                06952921
069530         WHEN OTHER                                               06953006
069531            INSPECT EP230-DPT-NBR  TALLYING PV-TALLY              06953106
069532                FOR LEADING ZERO                                  06953206
069533            SET PV-BIT-IDX TO PV-TALLY                            06953306
069534            SET PV-BIT-IDX UP BY +1                               06953406
069535                                                                  06953506
069536            MOVE EP230-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        06953606
069537                                                                  06953706
069538            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     06953821
069539               FROM PV-BIT-IDX BY +1                              06953906
069540               UNTIL PV-EOF-IDX > 4                               06954006
069541     END-EVALUATE.                                                06954106
069542                                                                  06954206
069543     PERFORM 3200-MOVE-DELIMITER.                                 06954321
069544                                                                  06954406
069545**-- FORMAT DC RETURN CODE                                        06954506
069546                                                                  06954606
069547     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06954706
069548     EVALUATE TRUE                                                06954806
069549         WHEN EP230-DC-RETURN-CDE = SPACES                        06954906
069550             PERFORM 3300-MOVE-SPACE                              06955021
069551         WHEN OTHER                                               06955106
069552            MOVE EP230-DC-RETURN-CDE TO PV-VARIABLE-CHAR-FIELD    06955206
069553            SET PV-CHR-EOF-IDX TO +2                              06955306
069554                                                                  06955406
069555            PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX    06955521
069556               FROM 1 BY 1                                        06955606
069557               UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX              06955706
069558     END-EVALUATE.                                                06955806
069559                                                                  06955906
069560     PERFORM 3200-MOVE-DELIMITER.                                 06956021
069561                                                                  06956106
069562**-- FORMAT LAST-UPDATE TIMESTAMP                                 06956206
069563                                                                  06956306
069564     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06956406
069565     INITIALIZE PV-INPUT-TIMESTAMP.                               06956506
069566     INITIALIZE PV-OUTPUT-SQL-TIMESTAMP.                          06956606
069567                                                                  06956706
069568     MOVE EP230-LAST-UPD-TMST  TO PV-INPUT-TIMESTAMP              06956806
069569     PERFORM 3900-CONVERT-TIMESTAMP.                              06956921
069570     SET PV-CHR-EOF-IDX TO +19                                    06957006
069571                                                                  06957106
069572     MOVE PV-OUTPUT-SQL-TIMESTAMP TO PV-VARIABLE-CHAR-FIELD.      06957206
069573     PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06957321
069574        FROM 1 BY 1                                               06957406
069575        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX                     06957506
069576                                                                  06957606
069577     PERFORM 3200-MOVE-DELIMITER.                                 06957721
069578                                                                  06957806
069579     PERFORM 4100-WRITE-DETAIL-REC.                               06957920
069580                                                                  06958015
069581     PERFORM 6500-READ-VND-DP-FILE.                               06958106
069582                                                                  06958206
069590*2800-EXIT.                                                       06959021
069700                                                                  06970006
069800*-------------------------------------------------------------    06980006
069900* 2900-FORMAT-WRT-VSTY-FILE.                                      06990021
070000*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   07000006
070100*     RECORD FOR XST_VND_STYL_STR TABLE.                          07010006
070200*-------------------------------------------------------------    07020006
070300 2900-FORMAT-WRT-VSTY-FILE.                                       07030021
070310                                                                  07031006
070320     IF PS-VSTY-HDR-NOT-WRITEN                                    07032006
070330        SET EP217-XST-VND-STYL TO TRUE                            07033006
070340        PERFORM 3100-FORMAT-WRT-HEADER-REC                        07034021
070350        SET PS-VSTY-HDR-WRITEN TO TRUE                            07035006
070360     END-IF.                                                      07036006
070370                                                                  07037006
070372     EVALUATE TRUE                                                07037222
070373         WHEN EP228-RECORD-ACTION = 'A'                           07037322
070374           PERFORM 2950-PROCESS-VNDST-ADD                         07037422
070375         WHEN EP228-RECORD-ACTION = 'D'                           07037522
070376           PERFORM 3000-PROCESS-VNDST-DEL                         07037622
070377     END-EVALUATE.                                                07037722
070378                                                                  07037822
070655                                                                  07065507
070656     PERFORM 4100-WRITE-DETAIL-REC.                               07065620
070657                                                                  07065715
070658     PERFORM 6300-READ-VND-ST-FILE.                               07065807
070659                                                                  07065907
070660                                                                  07066007
070661*2900-EXIT.                                                       07066121
070700                                                                  07070006
070701*-------------------------------------------------------------    07070121
070702* 2950-PROCESS-VNDST-ADD                                          07070221
070703*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   07070321
070704*     RECORD FOR XST_DEPT_STR TABLE.                              07070421
070705*-------------------------------------------------------------    07070521
070706 2950-PROCESS-VNDST-ADD.                                          07070621
070707                                                                  07070721
070708**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  07070822
070709                                                                  07070922
070710     SET FORM-MRCH-HR-LEN TO +1.                                  07071022
070711     MOVE 0 TO PV-BYTE-COUNT.                                     07071122
070712     INITIALIZE FORMATTED-MERCH-HIER-REC.                         07071222
070713                                                                  07071322
070714**-- FORMAT RECORD ACTION                                         07071422
070715                                                                  07071522
070716     MOVE EP228-RECORD-ACTION TO  PV-RECORD-ACTION.               07071622
070717     PERFORM 3200-MOVE-DELIMITER.                                 07071722
070718     PERFORM 3600-MOVE-RECORD-ACTION.                             07071822
070719     PERFORM 3200-MOVE-DELIMITER.                                 07071922
070720                                                                  07072022
070721**-- FORMAT STYLE ID                                              07072122
070722     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07072222
070723     INITIALIZE PV-TALLY.                                         07072322
070724                                                                  07072422
070725     EVALUATE TRUE                                                07072522
070726         WHEN EP228-STYLE-ID = 0                                  07072622
070727            PERFORM 3700-MOVE-ZERO                                07072722
070728         WHEN OTHER                                               07072822
070729            INSPECT EP228-STYLE-ID   TALLYING PV-TALLY            07072922
070730                FOR LEADING ZERO                                  07073022
070731            SET PV-BIT-IDX TO PV-TALLY                            07073122
070732            SET PV-BIT-IDX UP BY +1                               07073222
070733                                                                  07073322
070734            MOVE EP228-STYLE-ID  TO PV-VARIABLE-OUTPUT-FIELD      07073422
070735                                                                  07073522
070736            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07073622
070737               FROM PV-BIT-IDX BY +1                              07073722
070738               UNTIL PV-EOF-IDX > 8                               07073822
070739     END-EVALUATE.                                                07073922
070740                                                                  07074022
070741     PERFORM 3200-MOVE-DELIMITER.                                 07074122
070742                                                                  07074222
070743**-- FORMAT DEPT_NBR                                              07074322
070744     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07074422
070745     INITIALIZE PV-TALLY.                                         07074522
070746                                                                  07074622
070747     EVALUATE TRUE                                                07074722
070748         WHEN EP228-DPT-NBR = 0                                   07074822
070749            PERFORM 3700-MOVE-ZERO                                07074922
070750         WHEN OTHER                                               07075022
070751            INSPECT EP228-DPT-NBR  TALLYING PV-TALLY              07075122
070752                FOR LEADING ZERO                                  07075222
070753            SET PV-BIT-IDX TO PV-TALLY                            07075322
070754            SET PV-BIT-IDX UP BY +1                               07075422
070755                                                                  07075522
070756            MOVE EP228-DPT-NBR TO PV-VARIABLE-OUTPUT-FIELD        07075622
070757                                                                  07075722
070758            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07075822
070759               FROM PV-BIT-IDX BY +1                              07075922
070760               UNTIL PV-EOF-IDX > 4                               07076022
070761     END-EVALUATE.                                                07076122
070762                                                                  07076222
070763     PERFORM 3200-MOVE-DELIMITER.                                 07076322
070764                                                                  07076422
070765**-- FORMAT MAJOR CLASS NUMBER                                    07076522
070766     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07076622
070767     INITIALIZE PV-TALLY.                                         07076722
070768                                                                  07076822
070769     EVALUATE TRUE                                                07076922
070770         WHEN EP228-MAJ-CL-NBR = 0                                07077022
070771            PERFORM 3700-MOVE-ZERO                                07077122
070772         WHEN OTHER                                               07077222
070773            INSPECT EP228-MAJ-CL-NBR  TALLYING PV-TALLY           07077322
070774                FOR LEADING ZERO                                  07077422
070775            SET PV-BIT-IDX TO PV-TALLY                            07077522
070776            SET PV-BIT-IDX UP BY +1                               07077622
070777                                                                  07077722
070778            MOVE EP228-MAJ-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     07077822
070779                                                                  07077922
070780            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07078022
070781               FROM PV-BIT-IDX BY +1                              07078122
070782               UNTIL PV-EOF-IDX > 4                               07078222
070783     END-EVALUATE.                                                07078322
070784                                                                  07078422
070785     PERFORM 3200-MOVE-DELIMITER.                                 07078522
070786                                                                  07078622
070787**-- FORMAT SUB CLASS NUMBER                                      07078722
070788     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07078822
070789     INITIALIZE PV-TALLY.                                         07078922
070790                                                                  07079022
070791     EVALUATE TRUE                                                07079122
070792         WHEN EP228-SUB-CL-NBR = 0                                07079222
070793            PERFORM 3700-MOVE-ZERO                                07079322
070794         WHEN OTHER                                               07079422
070795            INSPECT EP228-SUB-CL-NBR  TALLYING PV-TALLY           07079522
070796                FOR LEADING ZERO                                  07079622
070797            SET PV-BIT-IDX TO PV-TALLY                            07079722
070798            SET PV-BIT-IDX UP BY +1                               07079822
070799                                                                  07079922
070800            MOVE EP228-SUB-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     07080022
070801                                                                  07080122
070802            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07080222
070803               FROM PV-BIT-IDX BY +1                              07080322
070804               UNTIL PV-EOF-IDX > 4                               07080422
070805     END-EVALUATE.                                                07080522
070806                                                                  07080622
070807     PERFORM 3200-MOVE-DELIMITER.                                 07080722
070808                                                                  07080822
070809**-- FORMAT VENDOR STYLE ID                                       07080922
070810     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07081022
070811     INITIALIZE PV-TALLY.                                         07081122
070812                                                                  07081222
070813     EVALUATE TRUE                                                07081322
070814         WHEN EP228-VS-ID = 0                                     07081422
070815            PERFORM 3700-MOVE-ZERO                                07081522
070816         WHEN OTHER                                               07081622
070817            INSPECT EP228-VS-ID  TALLYING PV-TALLY                07081722
070818                FOR LEADING ZERO                                  07081822
070819            SET PV-BIT-IDX TO PV-TALLY                            07081922
070820            SET PV-BIT-IDX UP BY +1                               07082022
070821                                                                  07082122
070822            MOVE EP228-VS-ID TO PV-VARIABLE-OUTPUT-FIELD          07082222
070823                                                                  07082322
070824            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07082422
070825               FROM PV-BIT-IDX BY +1                              07082522
070826               UNTIL PV-EOF-IDX > 10                              07082622
070827     END-EVALUATE.                                                07082722
070828                                                                  07082822
070829     PERFORM 3200-MOVE-DELIMITER.                                 07082922
070830                                                                  07083022
070831**--  FORMAT VENDOR STYL NUMBER                                   07083122
070832     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07083222
070833                                                                  07083322
070834     EVALUATE TRUE                                                07083422
070835         WHEN EP228-VND-STYL-NBR = SPACES                         07083522
070836             PERFORM 3300-MOVE-SPACE                              07083622
070837         WHEN OTHER                                               07083722
070838             MOVE EP228-VND-STYL-NBR TO PV-VARIABLE-CHAR-FIELD    07083822
070839             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    07083922
070840                FROM 20 BY -1                                     07084022
070841                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         07084122
070842                                                NOT = SPACE       07084222
070843                                                                  07084322
070844             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   07084422
070845             FROM 1 BY 1                                          07084522
070846              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               07084622
070847     END-EVALUATE.                                                07084722
070848                                                                  07084822
070849     PERFORM 3200-MOVE-DELIMITER.                                 07084922
070850                                                                  07085022
070851**--  FORMAT VENDOR STYL DESCRIPTION                              07085122
070852     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07085222
070853                                                                  07085322
070854     EVALUATE TRUE                                                07085422
070855         WHEN EP228-VND-STYL-DESC = SPACES                        07085522
070856             PERFORM 3300-MOVE-SPACE                              07085622
070857         WHEN OTHER                                               07085722
070858             MOVE EP228-VND-STYL-DESC TO PV-VARIABLE-CHAR-FIELD   07085822
070859             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    07085922
070860                FROM 30 BY -1                                     07086022
070861                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         07086122
070862                                                NOT = SPACE       07086222
070863                                                                  07086322
070864             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   07086422
070865             FROM 1 BY 1                                          07086522
070866              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               07086622
070867     END-EVALUATE.                                                07086722
070868                                                                  07086822
070869     PERFORM 3200-MOVE-DELIMITER.                                 07086922
070870                                                                  07087022
070871**-- FORMAT VENDOR ID                                             07087122
070872     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07087222
070873     INITIALIZE PV-TALLY.                                         07087322
070874                                                                  07087422
070875     EVALUATE TRUE                                                07087522
070876         WHEN EP228-VND-ID = 0                                    07087622
070877            PERFORM 3700-MOVE-ZERO                                07087722
070878         WHEN OTHER                                               07087822
070879            INSPECT EP228-VND-ID  TALLYING PV-TALLY               07087922
070880                FOR LEADING ZERO                                  07088022
070881            SET PV-BIT-IDX TO PV-TALLY                            07088122
070882            SET PV-BIT-IDX UP BY +1                               07088222
070883                                                                  07088322
070884            MOVE EP228-VND-ID TO PV-VARIABLE-OUTPUT-FIELD         07088422
070885                                                                  07088522
070886            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07088622
070887               FROM PV-BIT-IDX BY +1                              07088722
070888               UNTIL PV-EOF-IDX > 10                              07088822
070889     END-EVALUATE.                                                07088922
070890                                                                  07089022
070891     PERFORM 3200-MOVE-DELIMITER.                                 07089122
070892                                                                  07089222
070893**-- FORMAT STKR NBR                                              07089322
070894     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07089422
070895     INITIALIZE PV-TALLY.                                         07089522
070896                                                                  07089622
070897     EVALUATE TRUE                                                07089722
070898         WHEN EP228-STKR-NBR = 0                                  07089822
070899            PERFORM 3700-MOVE-ZERO                                07089922
070900         WHEN OTHER                                               07090022
070901            INSPECT EP228-STKR-NBR  TALLYING PV-TALLY             07090122
070902                FOR LEADING ZERO                                  07090222
070903            SET PV-BIT-IDX TO PV-TALLY                            07090322
070904            SET PV-BIT-IDX UP BY +1                               07090422
070905                                                                  07090522
070906            MOVE EP228-STKR-NBR TO PV-VARIABLE-OUTPUT-FIELD       07090622
070907                                                                  07090722
070908            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07090822
070909               FROM PV-BIT-IDX BY +1                              07090922
070910               UNTIL PV-EOF-IDX > 10                              07091022
070911     END-EVALUATE.                                                07091122
070912                                                                  07091222
070913     PERFORM 3200-MOVE-DELIMITER.                                 07091322
070914                                                                  07091422
070915**--  FORMAT RETAIL CLASS DESCRIPTION                             07091522
070916     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07091622
070917                                                                  07091722
070918     EVALUATE TRUE                                                07091822
070919         WHEN EP228-RTL-CLASS-DESC = SPACES                       07091922
070920             PERFORM 3300-MOVE-SPACE                              07092022
070921         WHEN OTHER                                               07092122
070922             MOVE EP228-RTL-CLASS-DESC TO PV-VARIABLE-CHAR-FIELD  07092222
070923             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    07092322
070924                FROM 20 BY -1                                     07092422
070925                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         07092522
070926                                                NOT = SPACE       07092622
070927                                                                  07092722
070928             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   07092822
070929             FROM 1 BY 1                                          07092922
070930              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               07093022
070931     END-EVALUATE.                                                07093122
070932                                                                  07093222
070933     PERFORM 3200-MOVE-DELIMITER.                                 07093322
070934                                                                  07093422
070935**--  FORMAT LABEL NAME                                           07093522
070936     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07093622
070937                                                                  07093722
070938     EVALUATE TRUE                                                07093822
070939         WHEN EP228-LABEL-NAME = SPACES                           07093922
070940             PERFORM 3300-MOVE-SPACE                              07094022
070941         WHEN OTHER                                               07094122
070942             MOVE EP228-LABEL-NAME TO PV-VARIABLE-CHAR-FIELD      07094222
070943             PERFORM 3800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    07094322
070944                FROM 20 BY -1                                     07094422
070945                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         07094522
070946                                                NOT = SPACE       07094622
070947                                                                  07094722
070948             PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   07094822
070949             FROM 1 BY 1                                          07094922
070950              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               07095022
070951     END-EVALUATE.                                                07095122
070952                                                                  07095222
070953     PERFORM 3200-MOVE-DELIMITER.                                 07095322
070954                                                                  07095422
070955**--  FORMAT ELECTRONIC SHELF LABEL INDICATOR                     07095522
070956     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07095622
070957                                                                  07095722
070958     MOVE EP228-ELECT-SHLF-LBL-IND TO PV-VARIABLE-CHAR-FIELD.     07095822
070959     SET PV-CHR-EOF-IDX  TO +1.                                   07095922
070960                                                                  07096022
070961     PERFORM 3500-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           07096122
070962        FROM 1 BY 1                                               07096222
070963        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    07096322
070964                                                                  07096422
070965     PERFORM 3200-MOVE-DELIMITER.                                 07096522
070966*2950-EXIT.                                                       07096621
070968                                                                  07096821
070969*-------------------------------------------------------------    07096921
070970* 3000-PROCESS-VNDST-DEL                                          07097021
070971*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   07097121
070972*     RECORD FOR XST_DEPT_STR TABLE.                              07097221
070973*-------------------------------------------------------------    07097321
070974 3000-PROCESS-VNDST-DEL.                                          07097421
070975                                                                  07097521
070976**-- INITIALIZE VARIABLES TO WRITE DETAIL RECORD                  07097622
070977                                                                  07097722
070978     SET FORM-MRCH-HR-LEN TO +1.                                  07097822
070979     MOVE 0 TO PV-BYTE-COUNT.                                     07097922
070980     INITIALIZE FORMATTED-MERCH-HIER-REC.                         07098022
070981                                                                  07098122
070982**-- FORMAT RECORD ACTION                                         07098222
070983                                                                  07098322
070984     MOVE EP228-RECORD-ACTION TO  PV-RECORD-ACTION.               07098422
070985     PERFORM 3200-MOVE-DELIMITER.                                 07098522
070986     PERFORM 3600-MOVE-RECORD-ACTION.                             07098622
070987     PERFORM 3200-MOVE-DELIMITER.                                 07098722
070988                                                                  07098822
070989**-- FORMAT STYLE ID                                              07098922
070990     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07099022
070991     INITIALIZE PV-TALLY.                                         07099122
070992                                                                  07099222
070993     EVALUATE TRUE                                                07099322
070994         WHEN EP228-STYLE-ID = 0                                  07099422
070995            PERFORM 3700-MOVE-ZERO                                07099522
070996         WHEN OTHER                                               07099622
070997            INSPECT EP228-STYLE-ID   TALLYING PV-TALLY            07099722
070998                FOR LEADING ZERO                                  07099822
070999            SET PV-BIT-IDX TO PV-TALLY                            07099922
071000            SET PV-BIT-IDX UP BY +1                               07100022
071001                                                                  07100122
071002            MOVE EP228-STYLE-ID  TO PV-VARIABLE-OUTPUT-FIELD      07100222
071003                                                                  07100322
071004            PERFORM 3400-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     07100422
071005               FROM PV-BIT-IDX BY +1                              07100522
071006               UNTIL PV-EOF-IDX > 8                               07100622
071007     END-EVALUATE.                                                07100722
071008                                                                  07100822
071009     PERFORM 3200-MOVE-DELIMITER.                                 07100922
071010**-- FORMAT DEPT                                                  07101022
071012     PERFORM 3200-MOVE-DELIMITER.                                 07101222
071013                                                                  07101322
071014**-- FORMAT MAJ_CL                                                07101422
071015     PERFORM 3200-MOVE-DELIMITER.                                 07101522
071016                                                                  07101622
071017**-- FORMAT SUB_CL                                                07101722
071018     PERFORM 3200-MOVE-DELIMITER.                                 07101822
071019                                                                  07101922
071020**-- FORMAT VENDOR STYLE ID                                       07102022
071021     PERFORM 3200-MOVE-DELIMITER.                                 07102122
071022                                                                  07102222
071023**-- FORMAT VENDOR STYLE NUMBER                                   07102322
071024     PERFORM 3200-MOVE-DELIMITER.                                 07102422
071025                                                                  07102522
071026**-- FORMAT VENDOR STYLE DESCRIPTION                              07102622
071027     PERFORM 3200-MOVE-DELIMITER.                                 07102722
071028                                                                  07102822
071029**-- FORMAT VENDOR ID                                             07102922
071030     PERFORM 3200-MOVE-DELIMITER.                                 07103022
071031                                                                  07103122
071032**-- FORMAT STKR NUMBER                                           07103222
071033     PERFORM 3200-MOVE-DELIMITER.                                 07103322
071034                                                                  07103422
071035**-- FORMAT RETAIL CLASSIFICATION DESCRIPTION                     07103522
071036     PERFORM 3200-MOVE-DELIMITER.                                 07103622
071037                                                                  07103722
071038**-- FORMAT LABEL NAME                                            07103822
071039     PERFORM 3200-MOVE-DELIMITER.                                 07103922
071040                                                                  07104022
071041**-- FORMAT ESL INDICATOR                                         07104122
071042     PERFORM 3200-MOVE-DELIMITER.                                 07104222
071043                                                                  07104322
071044*3000-EXIT.                                                       07104422
071046                                                                  07104622
071047*-------------------------------------------------------------    07104722
071048* 3100-FORMAT-WRT-HEADER-REC.                                     07104822
071049*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   07104922
071050*     RECORD FOR XST_VND_STYL_STR TABLE.                          07105022
071051*-------------------------------------------------------------    07105122
071052 3100-FORMAT-WRT-HEADER-REC.                                      07105222
071053                                                                  07105322
071054     MOVE PC-HDR-IND             TO EP217-HDR-INDICATOR.          07105422
071055     MOVE PV-STR-GRP-TYP-CDE     TO EP217-STR-GRP-TYP.            07105522
071056     MOVE PV-STR-GRP-ID-GRP      TO EP217-STR-GRP-ID.             07105622
071057     MOVE PC-FIVE-ZERO           TO EP217-EXCO-STR-NBR.           07105722
071058     MOVE PV-FORMAT-HDR-DIST-DTE TO EP217-FILE-DIST-DATE.         07105822
071059     MOVE PV-FILE-APPLY-TYPE     TO EP217-FILE-TYPE-APPLY.        07105925
071060     SET EP217-FILE-MERCH-HIER   TO TRUE.                         07106025
071061     MOVE PV-FILE-PROCESS-TYPE   TO EP217-FILE-NAME-TYPE.         07106125
071062     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-1.           07106225
071063     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-2.           07106325
071064     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-3.           07106425
071065     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-4.           07106525
071066     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-5.           07106625
071067     MOVE PV-HEADER-TMST         TO EP217-CRT-TIMESTAMP.          07106725
071068                                                                  07106825
071069     PERFORM 4000-WRITE-HEADER-REC.                               07106925
071070                                                                  07107025
071071*3100-EXIT.                                                       07107125
071073                                                                  07107325
071074*-----------------------------------------------------------------07107425
071075* 3200-MOVE-DELIMITER                                             07107525
071076*  THIS PARAGRAPH WILL MOVE '|' TO THE OUTPUT FILE VARIABLE       07107625
071077*----------------------------------------------------------------*07107725
071078 3200-MOVE-DELIMITER.                                             07107825
071079                                                                  07107925
071080     MOVE PC-CSV-DELIMITER                                        07108025
071081       TO FORM-MRCH-HR-FLD(FORM-MRCH-HR-LEN).                     07108125
071082     SET FORM-MRCH-HR-LEN                                         07108225
071083       UP BY +1.                                                  07108325
071084     ADD 1                                                        07108425
071085       TO PV-BYTE-COUNT.                                          07108525
071086                                                                  07108625
071087*3200-EXIT.                                                       07108725
071089                                                                  07108925
071090*-----------------------------------------------------------------07109025
071091* 3300-MOVE-SPACE                                                 07109125
071092*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       07109225
071093*----------------------------------------------------------------*07109325
071094 3300-MOVE-SPACE.                                                 07109425
071095                                                                  07109525
071096     MOVE PC-ONE-SPACE                                            07109625
071097       TO FORM-MRCH-HR-FLD(FORM-MRCH-HR-LEN).                     07109725
071098     SET FORM-MRCH-HR-LEN                                         07109825
071099       UP BY +1.                                                  07109925
071100     ADD 1                                                        07110025
071101       TO PV-BYTE-COUNT.                                          07110125
071102                                                                  07110225
071103*3300-EXIT.                                                       07110325
071105                                                                  07110525
071106*-----------------------------------------------------------------07110625
071107* 3400-MOVE-NUMERIC-DATA                                          07110725
071108*  THIS PARAGRAPH WILL NUMERIC DATA TO THE OUTPUT FILE VARIABLE   07110825
071109*----------------------------------------------------------------*07110925
071110 3400-MOVE-NUMERIC-DATA.                                          07111025
071111                                                                  07111125
071112     MOVE PV-BIT-VARIABLE(PV-EOF-IDX)                             07111225
071113       TO FORM-MRCH-HR-FLD(FORM-MRCH-HR-LEN).                     07111325
071114     SET FORM-MRCH-HR-LEN                                         07111425
071115       UP BY +1.                                                  07111525
071116     ADD 1                                                        07111625
071117       TO PV-BYTE-COUNT.                                          07111725
071118                                                                  07111825
071119*3400-EXIT.                                                       07111925
071121                                                                  07112125
071122*-----------------------------------------------------------------07112225
071123* 3500-MOVE-CHAR-DATA                                             07112325
071124*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       07112425
071125*----------------------------------------------------------------*07112525
071126 3500-MOVE-CHAR-DATA.                                             07112625
071127                                                                  07112725
071128     MOVE PV-BIT-CHR-VARIABLE(PV-CHR-BIT-IDX)                     07112825
071129       TO FORM-MRCH-HR-FLD(FORM-MRCH-HR-LEN).                     07112925
071130     SET FORM-MRCH-HR-LEN                                         07113025
071131       UP BY +1.                                                  07113125
071132     ADD 1                                                        07113225
071133       TO PV-BYTE-COUNT.                                          07113325
071134                                                                  07113425
071135*3500-EXIT.                                                       07113525
071137*-----------------------------------------------------------------07113725
071138* 3600-MOVE-RECORD-ACTION                                         07113825
071139*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       07113925
071140*----------------------------------------------------------------*07114025
071141 3600-MOVE-RECORD-ACTION.                                         07114125
071142                                                                  07114225
071143     MOVE PV-RECORD-ACTION                                        07114325
071144       TO FORM-MRCH-HR-FLD(FORM-MRCH-HR-LEN).                     07114425
071145     SET FORM-MRCH-HR-LEN                                         07114525
071146       UP BY +1.                                                  07114625
071147     ADD 1                                                        07114725
071148       TO PV-BYTE-COUNT.                                          07114825
071149                                                                  07114925
071150*3600-EXIT.                                                       07115025
071152                                                                  07115225
071153*-----------------------------------------------------------------07115325
071154* 3700-MOVE-ZERO                                                  07115425
071155*  THIS PARAGRAPH WILL MOVE '0' TO THE OUTPUT FILE VARIABLE       07115525
071156*----------------------------------------------------------------*07115625
071157 3700-MOVE-ZERO.                                                  07115725
071158                                                                  07115825
071159     MOVE PC-ONE-ZERO                                             07115925
071160       TO FORM-MRCH-HR-FLD(FORM-MRCH-HR-LEN).                     07116025
071161     SET FORM-MRCH-HR-LEN                                         07116125
071162       UP BY +1.                                                  07116225
071163     ADD 1                                                        07116325
071164       TO PV-BYTE-COUNT.                                          07116425
071165                                                                  07116525
071166*3700-EXIT.                                                       07116625
071168                                                                  07116825
071169*-------------------------------------------------------------    07116925
071170* 3800-FIND-DATA-END.                                             07117025
071171*  THIS PARAGRAPH IS USED IN A LOOP TO DETERMINE THE LENGTH OF    07117125
071172*  THE STRING.                                                    07117225
071173*-------------------------------------------------------------    07117325
071174 3800-FIND-DATA-END.                                              07117425
071175                                                                  07117525
071176     MOVE ' '                                                     07117625
071177       TO PV-SPACE.                                               07117725
071178                                                                  07117825
071179*3800-EXIT.                                                       07117925
071181                                                                  07118125
071182*-----------------------------------------------------------------07118225
071183* 3900-CONVERT-TIMESTAMP.                                         07118325
071184*  THIS PARAGRAPH WILL CONVERT THE INPUT TIMESTAMP(DB2 FORMAT) TO 07118425
071185*  SQL ACCEPTABLE FORMAT.                                         07118525
071186*----------------------------------------------------------------*07118625
071187 3900-CONVERT-TIMESTAMP.                                          07118725
071188                                                                  07118825
071189     MOVE PV-INP-TMST-YYYY  TO   PV-OUT-TMST-YYYY.                07118925
071190     MOVE PC-DASH           TO   PV-OUT-DASH-1.                   07119025
071191     MOVE PV-INP-TMST-MO    TO   PV-OUT-TMST-MO.                  07119125
071192     MOVE PC-DASH           TO   PV-OUT-DASH-2.                   07119225
071193     MOVE PV-INP-TMST-DD    TO   PV-OUT-TMST-DD.                  07119325
071194     MOVE PC-ONE-SPACE      TO   PV-OUT-SPACE.                    07119425
071195     MOVE PV-INP-TMST-HH    TO   PV-OUT-TMST-HH.                  07119525
071196     MOVE PC-COLON          TO   PV-OUT-DASH-3.                   07119625
071197     MOVE PV-INP-TMST-MM    TO   PV-OUT-TMST-MM.                  07119725
071198     MOVE PC-COLON          TO   PV-OUT-DASH-4.                   07119825
071199     MOVE PV-INP-TMST-SS    TO   PV-OUT-TMST-SS.                  07119925
071200                                                                  07120025
071201*3900-EXIT.                                                       07120125
071203*-------------------------------------------------------------    07120325
071204* 4000-WRITE-HEADER-REC.                                          07120425
071205*     FORMAT AND WRITE THE HEADER RECORD.                         07120525
071206*-------------------------------------------------------------    07120625
071207 4000-WRITE-HEADER-REC.                                           07120725
071208                                                                  07120825
071209     PERFORM 5000-INCR-HEADER-TIMESTAMP.                          07120925
071210                                                                  07121025
071211     MOVE 64                                                      07121125
071212       TO PV-BYTE-COUNT.                                          07121225
071213     WRITE FORMATTED-MERCH-HIER-REC                               07121325
071214       FROM EP217-HEADER-RECORD.                                  07121425
071215                                                                  07121525
071216     ADD 1 TO PV-HDR-REC-WRITEN.                                  07121625
071217                                                                  07121725
071218*4000-EXIT.                                                       07121825
071220                                                                  07122025
071221                                                                  07122125
071222*-------------------------------------------------------------    07122225
071223* 4100-WRITE-DETAIL-REC.                                          07122325
071224*    WRITE THE FORMATTED DETAIL RECORD.                           07122425
071225*-------------------------------------------------------------    07122525
071226 4100-WRITE-DETAIL-REC.                                           07122625
071227                                                                  07122725
071228     WRITE FORMATTED-MERCH-HIER-REC.                              07122825
071229                                                                  07122925
071230     ADD 1 TO PV-DATA-REC-WRITEN.                                 07123025
071231                                                                  07123125
071232*4100-EXIT.                                                       07123225
071234                                                                  07123425
071235*-------------------------------------------------------------    07123525
071236* 5000-INCR-HEADER-TIMESTAMP.                                     07123625
071237*     THIS PARAGRAPH WILL INCREMENT THE TIMESTAMP BY 1 SECOND     07123725
071238*     THIS WOULD ENSURE THE HEADER RECORDS TO BE 1 SECOND APART   07123825
071240*     WHICH IS MID-TIER REQUIREMENT.                              07124022
071300*-------------------------------------------------------------    07130005
071400 5000-INCR-HEADER-TIMESTAMP.                                      07140005
071500                                                                  07150005
071600     ADD 1                                                        07160005
071700       TO PV-HEADER-SS.                                           07170005
071800     IF PV-HEADER-SS GREATER 59                                   07180005
071900         MOVE ZERO                                                07190005
072000           TO PV-HEADER-SS                                        07200005
072100         ADD 1                                                    07210005
072200           TO PV-HEADER-MM                                        07220005
072300     END-IF.                                                      07230005
072400                                                                  07240005
072500     IF PV-HEADER-MM GREATER 59                                   07250005
072600         MOVE ZERO                                                07260005
072700           TO PV-HEADER-MM                                        07270005
072800         ADD 1                                                    07280005
072900           TO PV-HEADER-HH                                        07290005
073000     END-IF.                                                      07300005
073100                                                                  07310005
073200     IF PV-HEADER-HH GREATER 23                                   07320005
073300         MOVE ZERO                                                07330005
073400           TO PV-HEADER-HH                                        07340005
073500         ADD 1                                                    07350005
073600           TO PV-HEADER-DD                                        07360005
073700     END-IF.                                                      07370005
073800                                                                  07380005
073900     IF PV-HEADER-MO = 01                                         07390005
074000       OR PV-HEADER-MO = 03                                       07400005
074100         OR PV-HEADER-MO = 05                                     07410005
074200           OR PV-HEADER-MO = 07                                   07420005
074300             OR PV-HEADER-MO = 08                                 07430005
074400               OR PV-HEADER-MO = 10                               07440005
074500                 OR PV-HEADER-MO = 12                             07450005
074600         IF PV-HEADER-DD GREATER 31                               07460005
074700             MOVE 1                                               07470005
074800               TO PV-HEADER-DD                                    07480005
074900             ADD 1                                                07490005
075000               TO PV-HEADER-MO                                    07500005
075100         END-IF                                                   07510005
075200     ELSE                                                         07520005
075300         IF PV-HEADER-MO = 04                                     07530005
075400           OR PV-HEADER-MO = 06                                   07540005
075500             OR PV-HEADER-MO = 09                                 07550005
075600               OR PV-HEADER-MO = 11                               07560005
075700             IF PV-HEADER-DD GREATER 30                           07570005
075800                 MOVE 1                                           07580005
075900                   TO PV-HEADER-DD                                07590005
076000                 ADD 1                                            07600005
076100                   TO PV-HEADER-MO                                07610005
076200             END-IF                                               07620005
076300         ELSE                                                     07630005
076400             IF PV-HEADER-MO = 02                                 07640005
076500                 DIVIDE PV-HEADER-YYYY BY 100                     07650005
076600                   GIVING PV-QUOTIENT                             07660005
076700                     REMAINDER PV-RMDR-100                        07670005
076800                 DIVIDE PV-HEADER-YYYY BY 4                       07680005
076900                   GIVING PV-QUOTIENT                             07690005
077000                     REMAINDER PV-RMDR-4                          07700005
077100                 IF PV-RMDR-100 = 0                               07710005
077200                     IF PV-HEADER-DD GREATER 28                   07720005
077300                         MOVE 1                                   07730005
077400                           TO PV-HEADER-DD                        07740005
077500                         ADD 1                                    07750005
077600                           TO PV-HEADER-MO                        07760005
077700                     END-IF                                       07770005
077800                 ELSE                                             07780005
077900                     IF PV-RMDR-4 = 0                             07790005
078000                         IF PV-HEADER-DD GREATER 29               07800005
078100                             MOVE 1                               07810005
078200                               TO PV-HEADER-DD                    07820005
078300                             ADD 1                                07830005
078400                               TO PV-HEADER-MO                    07840005
078500                         END-IF                                   07850005
078600                     ELSE                                         07860005
078700                         IF PV-HEADER-DD GREATER 28               07870005
078800                             MOVE 1                               07880005
078900                               TO PV-HEADER-DD                    07890005
079000                             ADD 1                                07900005
079100                               TO PV-HEADER-MO                    07910005
079200                         END-IF                                   07920005
079300                     END-IF                                       07930005
079400                 END-IF                                           07940005
079500             END-IF                                               07950005
079600         END-IF                                                   07960005
079700     END-IF.                                                      07970005
079800                                                                  07980005
079900     IF PV-HEADER-MO GREATER 12                                   07990005
080000         MOVE 1                                                   08000005
080100           TO PV-HEADER-MO                                        08010005
080200         ADD 1                                                    08020005
080300           TO PV-HEADER-YYYY                                      08030005
080400     END-IF.                                                      08040005
080500                                                                  08050005
080600*5000-EXIT.                                                       08060005
080800                                                                  08080005
080900*----------------------------------------------------------       08090005
081000* 6000-READ-DEPT-FILE                                             08100005
081100*     THIS PARAGRAPH READS DATA THE DEPT-FILE (INP01)             08110005
081200*     INTO COPYBOOK EPRD224                                       08120005
081300*----------------------------------------------------------       08130005
081400 6000-READ-DEPT-FILE.                                             08140005
081500                                                                  08150005
081600     READ DEPT-FILE                                               08160005
081700         INTO EP224-MH-DEPT-RECORD                                08170005
081800       AT END                                                     08180005
081900          SET PS-END-OF-DEPT-FILE TO TRUE                         08190011
082000     END-READ.                                                    08200005
082100                                                                  08210005
082400     IF PS-NOT-END-DEPT-FILE                                      08240005
082410        ADD +1 TO PV-DEPT-REC-READ                                08241027
082500        MOVE 0 TO PV-PIPE-COUNT                                   08250005
082600        PERFORM 6050-CHECK-INP01-FOR-PIPES                        08260005
082700     END-IF.                                                      08270005
082800                                                                  08280005
082900*6000-EXIT.                                                       08290005
083100                                                                  08310005
083120*----------------------------------------------------------       08312007
083130* 6050-CHECK-INP01-FOR-PIPES                                      08313007
083140*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 08314007
083150*     REPLACES PIPES WITH SPACE.                                  08315007
083160*----------------------------------------------------------       08316007
083170 6050-CHECK-INP01-FOR-PIPES.                                      08317007
083180                                                                  08318007
083190     INSPECT EP224-MH-DEPT-RECORD                                 08319007
083191          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     08319107
083192                                                                  08319207
083193     IF PV-PIPE-COUNT > 0                                         08319307
083194        INSPECT EP224-MH-DEPT-RECORD                              08319407
083195            REPLACING ALL '|'  BY  ' '                            08319507
083196        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  08319607
083197                ' | WITH A SPACE '                                08319707
083198        DISPLAY EP224-MH-DEPT-RECORD                              08319807
083199     END-IF.                                                      08319907
083200                                                                  08320007
083201*6050-EXIT.                                                       08320107
083203                                                                  08320307
083210*----------------------------------------------------------       08321005
083300* 6100-READ-MAJ-CL-FILE                                           08330005
083400*     THIS PARAGRAPH READS DATA THE MAJ-CL-FILE (INP02)           08340005
083500*     INTO COPYBOOK EPRD226                                       08350005
083600*----------------------------------------------------------       08360005
083700 6100-READ-MAJ-CL-FILE.                                           08370005
083800                                                                  08380005
083900     READ MAJ-CL-FILE                                             08390005
084000         INTO EP226-MH-MAJ-CL-RECORD                              08400005
084100       AT END                                                     08410005
084200          SET PS-END-OF-MAJ-CL-FILE TO TRUE                       08420005
084300     END-READ.                                                    08430005
084600                                                                  08460005
084700     IF PS-NOT-END-MAJ-CL-FILE                                    08470005
084710        ADD +1 TO PV-MJCL-REC-READ                                08471027
084800        MOVE 0 TO PV-PIPE-COUNT                                   08480005
084900        PERFORM 6150-CHECK-INP02-FOR-PIPES                        08490007
085000     END-IF.                                                      08500005
085100                                                                  08510005
085200*6100-EXIT.                                                       08520005
085400                                                                  08540005
085410*----------------------------------------------------------       08541007
085420* 6150-CHECK-INP02-FOR-PIPES                                      08542007
085430*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 08543007
085440*     REPLACES PIPES WITH SPACE.                                  08544007
085450*----------------------------------------------------------       08545007
085460 6150-CHECK-INP02-FOR-PIPES.                                      08546007
085470                                                                  08547007
085480     INSPECT EP226-MH-MAJ-CL-RECORD                               08548007
085490          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     08549007
085491                                                                  08549107
085492     IF PV-PIPE-COUNT > 0                                         08549207
085493        INSPECT EP226-MH-MAJ-CL-RECORD                            08549307
085494            REPLACING ALL '|'  BY  ' '                            08549407
085495        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  08549507
085496                ' | WITH A SPACE '                                08549607
085497        DISPLAY EP226-MH-MAJ-CL-RECORD                            08549707
085498     END-IF.                                                      08549807
085499                                                                  08549907
085500*6150-EXIT.                                                       08550007
085502                                                                  08550207
085510*----------------------------------------------------------       08551005
085600* 6200-READ-SUB-CL-FILE                                           08560005
085700*     THIS PARAGRAPH READS DATA THE SUB-CL-FILE (INP03)           08570005
085800*     INTO COPYBOOK EPRD227                                       08580005
085900*----------------------------------------------------------       08590005
086000 6200-READ-SUB-CL-FILE.                                           08600005
086100                                                                  08610005
086110     READ SUB-CL-FILE                                             08611007
086120         INTO EP227-MH-SUB-CL-RECORD                              08612007
086130       AT END                                                     08613007
086140          SET PS-END-OF-SUB-CL-FILE TO TRUE                       08614007
086150     END-READ.                                                    08615007
086180                                                                  08618007
086190     IF PS-NOT-END-SUB-CL-FILE                                    08619007
086191        ADD +1 TO PV-SBCL-REC-READ                                08619127
086192        MOVE 0 TO PV-PIPE-COUNT                                   08619207
086193        PERFORM 6250-CHECK-INP03-FOR-PIPES                        08619307
086194     END-IF.                                                      08619407
086195                                                                  08619507
086200*6200-EXIT.                                                       08620005
086400                                                                  08640005
086410*----------------------------------------------------------       08641007
086420* 6250-CHECK-INP03-FOR-PIPES                                      08642007
086430*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 08643007
086440*     REPLACES PIPES WITH SPACE.                                  08644007
086450*----------------------------------------------------------       08645007
086460 6250-CHECK-INP03-FOR-PIPES.                                      08646007
086470                                                                  08647007
086480     INSPECT EP227-MH-SUB-CL-RECORD                               08648007
086490          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     08649007
086491                                                                  08649107
086492     IF PV-PIPE-COUNT > 0                                         08649207
086493        INSPECT EP227-MH-SUB-CL-RECORD                            08649307
086494            REPLACING ALL '|'  BY  ' '                            08649407
086495        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  08649507
086496                ' | WITH A SPACE '                                08649607
086497        DISPLAY EP227-MH-SUB-CL-RECORD                            08649707
086498     END-IF.                                                      08649807
086499                                                                  08649907
086500*6250-EXIT.                                                       08650007
086502                                                                  08650207
086510*----------------------------------------------------------       08651005
086600* 6300-READ-VND-ST-FILE                                           08660005
086700*     THIS PARAGRAPH READS DATA THE VND-ST-FILE (INP04)           08670005
086800*     INTO COPYBOOK EPRD228                                       08680005
086900*----------------------------------------------------------       08690005
087000 6300-READ-VND-ST-FILE.                                           08700005
087100                                                                  08710005
087110     READ VND-STYLE-FILE                                          08711007
087120         INTO EP228-MH-VND-STYL-RECORD                            08712007
087130       AT END                                                     08713007
087140          SET PS-END-OF-VND-ST-FILE TO TRUE                       08714007
087150     END-READ.                                                    08715007
087180                                                                  08718007
087190     IF PS-NOT-END-VND-ST-FILE                                    08719007
087191        ADD +1 TO PV-VSTY-REC-READ                                08719127
087192        MOVE 0 TO PV-PIPE-COUNT                                   08719207
087193        PERFORM 6350-CHECK-INP04-FOR-PIPES                        08719307
087194     END-IF.                                                      08719407
087195                                                                  08719507
087200*6300-EXIT.                                                       08720005
087400                                                                  08740005
087410*----------------------------------------------------------       08741007
087420* 6350-CHECK-INP04-FOR-PIPES                                      08742007
087430*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 08743007
087440*     REPLACES PIPES WITH SPACE.                                  08744007
087450*----------------------------------------------------------       08745007
087460 6350-CHECK-INP04-FOR-PIPES.                                      08746007
087470                                                                  08747007
087480     INSPECT EP228-MH-VND-STYL-RECORD                             08748007
087490          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     08749007
087491                                                                  08749107
087492     IF PV-PIPE-COUNT > 0                                         08749207
087493        INSPECT EP228-MH-VND-STYL-RECORD                          08749307
087494            REPLACING ALL '|'  BY  ' '                            08749407
087495        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  08749507
087496                ' | WITH A SPACE '                                08749607
087497        DISPLAY EP228-MH-VND-STYL-RECORD                          08749707
087498     END-IF.                                                      08749807
087499                                                                  08749907
087500*6350-EXIT.                                                       08750007
087502                                                                  08750207
087510*----------------------------------------------------------       08751005
087600* 6400-READ-VENDOR-FILE                                           08760005
087700*     THIS PARAGRAPH READS DATA THE VENDOR-FILE (INP05)           08770005
087800*     INTO COPYBOOK EPRD229                                       08780005
087900*----------------------------------------------------------       08790005
088000 6400-READ-VENDOR-FILE.                                           08800005
088100                                                                  08810005
088110     READ VENDOR-FILE                                             08811007
088120         INTO EP229-MH-VND-RECORD                                 08812007
088130       AT END                                                     08813007
088140          SET PS-END-OF-VENDOR-FILE TO TRUE                       08814007
088150     END-READ.                                                    08815007
088160                                                                  08816007
088190     IF PS-NOT-END-VENDOR-FILE                                    08819007
088191        ADD +1 TO PV-VND-REC-READ                                 08819127
088192        MOVE 0 TO PV-PIPE-COUNT                                   08819207
088193        PERFORM 6450-CHECK-INP05-FOR-PIPES                        08819307
088194     END-IF.                                                      08819407
088195                                                                  08819507
088200*6400-EXIT.                                                       08820005
088400                                                                  08840005
088420*----------------------------------------------------------       08842007
088430* 6450-CHECK-INP05-FOR-PIPES                                      08843007
088440*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 08844007
088450*     REPLACES PIPES WITH SPACE.                                  08845007
088460*----------------------------------------------------------       08846007
088470 6450-CHECK-INP05-FOR-PIPES.                                      08847007
088480                                                                  08848007
088490     INSPECT EP229-MH-VND-RECORD                                  08849007
088491          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     08849107
088492                                                                  08849207
088493     IF PV-PIPE-COUNT > 0                                         08849307
088494        INSPECT EP229-MH-VND-RECORD                               08849407
088495            REPLACING ALL '|'  BY  ' '                            08849507
088496        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  08849607
088497                ' | WITH A SPACE '                                08849707
088498        DISPLAY EP229-MH-VND-RECORD                               08849807
088499     END-IF.                                                      08849907
088500                                                                  08850007
088501*6450-EXIT.                                                       08850107
088503                                                                  08850307
088510*----------------------------------------------------------       08851005
088600* 6500-READ-VND-DP-FILE                                           08860005
088700*     THIS PARAGRAPH READS DATA THE VND-DP-FILE (INP06)           08870005
088800*     INTO COPYBOOK EPRD230                                       08880005
088900*----------------------------------------------------------       08890005
089000 6500-READ-VND-DP-FILE.                                           08900005
089100                                                                  08910005
089110     READ VEND-DEPT-FILE                                          08911007
089120         INTO EP230-MH-VND-DEPT-RECORD                            08912007
089130       AT END                                                     08913007
089140          SET PS-END-OF-VND-DP-FILE TO TRUE                       08914007
089150     END-READ.                                                    08915007
089160                                                                  08916007
089190     IF PS-NOT-END-VND-DP-FILE                                    08919007
089191        ADD +1 TO PV-VDPT-REC-READ                                08919127
089192        MOVE 0 TO PV-PIPE-COUNT                                   08919207
089193        PERFORM 6550-CHECK-INP06-FOR-PIPES                        08919307
089194     END-IF.                                                      08919407
089195                                                                  08919507
089200*6500-EXIT.                                                       08920005
089400                                                                  08940005
089410*----------------------------------------------------------       08941007
089420* 6550-CHECK-INP06-FOR-PIPES                                      08942007
089430*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 08943007
089440*     REPLACES PIPES WITH SPACE.                                  08944007
089450*----------------------------------------------------------       08945007
089460 6550-CHECK-INP06-FOR-PIPES.                                      08946007
089470                                                                  08947007
089480     INSPECT EP230-MH-VND-DEPT-RECORD                             08948007
089490          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     08949007
089491                                                                  08949107
089492     IF PV-PIPE-COUNT > 0                                         08949207
089493        INSPECT EP230-MH-VND-DEPT-RECORD                          08949307
089494            REPLACING ALL '|'  BY  ' '                            08949407
089495        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  08949507
089496                ' | WITH A SPACE '                                08949607
089497        DISPLAY EP230-MH-VND-DEPT-RECORD                          08949707
089498     END-IF.                                                      08949807
089499                                                                  08949907
089500*6450-EXIT.                                                       08950007
089502                                                                  08950207
089510******************************************************************08951005
089600*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *08960005
089700******************************************************************08970005
089800 9200-WRAPUP.                                                     08980005
089900     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.08990005
090000                                                                  09000005
090100     PERFORM 9920-DISPLAY-TOTALS.                                 09010005
090200                                                                  09020005
090300     DISPLAY '****************************************'.          09030005
090400     DISPLAY '**          EPKUT220 END              **'.          09040005
090500     DISPLAY '****************************************'.          09050005
090600                                                                  09060005
090700     CLOSE DEPT-FILE                                              09070005
090800           MAJ-CL-FILE                                            09080005
090900           SUB-CL-FILE                                            09090005
091000           VND-STYLE-FILE                                         09100005
091100           VENDOR-FILE                                            09110005
091200           VEND-DEPT-FILE.                                        09120005
091300                                                                  09130005
091400     CLOSE FORMATTED-MERCH-HIER-FL.                               09140005
091500                                                                  09150005
091600*9200-EXIT.  EXIT.                                                09160005
091700*---------------------------------------------------------        09170005
091800* 9800-SQL-ABEND.                                                 09180005
091900*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.09190005
092000*---------------------------------------------------------        09200005
092100 9800-SQL-ABEND.                                                  09210005
092200                                                                  09220005
092300     SET AC-DB2-ERROR TO TRUE.                                    09230005
092400                                                                  09240005
092500     DISPLAY '** ABEND     **'.                                   09250005
092600     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                09260005
092700     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              09270005
092800     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               09280005
092900                                                                  09290005
093000     COPY DPPD004.                                                09300005
093100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         09310005
093200                                                                  09320005
093300*9800-EXIT.                                                       09330005
093500                                                                  09350005
093600******************************************************************09360005
093700*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   09370005
093800******************************************************************09380005
093900 9910-ABEND.                                                      09390005
094000                                                                  09400005
094100     PERFORM 9920-DISPLAY-TOTALS.                                 09410005
094200                                                                  09420005
094300     DISPLAY '** ABEND           **'.                             09430005
094400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          09440005
094500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        09450005
094600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       09460005
094700     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       09470005
094800                                                                  09480005
094900     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         09490005
095000                                                                  09500005
095100*9910-EXIT.  EXIT.                                                09510005
095200******************************************************************09520005
095300*     DISPLAY END OF JOB TOTALS                                  *09530005
095400******************************************************************09540005
095500 9920-DISPLAY-TOTALS.                                             09550005
095600                                                                  09560005
095700     DISPLAY '************************************************'.  09570019
095800     DISPLAY '** STATISTICS FOR MERCHANDISE HIERARCHY FILES **'.  09580019
095900     DISPLAY '************************************************'.  09590019
096000                                                                  09600005
096100     DISPLAY '**   DEPARTMENT RECORDS READ  ====> '               09610005
096200             PV-DEPT-REC-READ                                     09620011
096300             ' **'.                                               09630005
096400     DISPLAY '**  MAJOR CLASS RECORDS READ  ====> '               09640005
096500             PV-MJCL-REC-READ                                     09650011
096600             ' **'.                                               09660005
096700     DISPLAY '**   SUB  CLASS RECORDS READ  ====> '               09670005
096800             PV-SBCL-REC-READ                                     09680011
096900             ' **'.                                               09690005
096910     DISPLAY '** VENDOR STYLE RECORDS READ  ====> '               09691011
096920             PV-VSTY-REC-READ                                     09692011
096930             ' **'.                                               09693011
096940     DISPLAY '**   VENDOR     RECORDS READ  ====> '               09694011
096950             PV-VND-REC-READ                                      09695011
096960             ' **'.                                               09696011
096970     DISPLAY '** VENDOR DEPT  RECORDS READ  ====> '               09697011
096980             PV-VDPT-REC-READ                                     09698011
096990             ' **'.                                               09699011
096991     DISPLAY '                                     '.             09699111
096992     DISPLAY '** TOTAL HEADER RECORDS WRITEN ====> '              09699211
096993             PV-HDR-REC-WRITEN                                    09699311
096994             ' **'.                                               09699411
096995     DISPLAY '** TOTAL DATA RECORDS WRITEN   ====> '              09699511
096996             PV-DATA-REC-WRITEN                                   09699611
096997             ' **'.                                               09699711
097000     DISPLAY '****************************************'.          09700005
097100                                                                  09710005
097200*9920-EXIT.  EXIT.                                                09720005
097300                                                                  09730005
