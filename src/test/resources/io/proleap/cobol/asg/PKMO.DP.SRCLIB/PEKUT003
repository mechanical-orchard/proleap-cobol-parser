000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400 PROGRAM-ID.    PEKUT003.                                         00040000
000500 AUTHOR.        PRITHIVIRAJ SUBRAMANIAN.                          00050000
000600 INSTALLATION.  KOHLS.                                            00060000
000700 DATE-WRITTEN   FEBRUARY, 2014.                                   00070000
000800 DATE-COMPILED.                                                   00080000
000900***************************************************************** 00090000
001000*  THIS PROGRAM COMPARES THE PERM ACTUALS FILE WITH MUC TABLE     00100000
001100*  EXTRACT  FILE , IF THE PRICE CHANGE ID IN BOTH THE FILE        00110000
001200*  MATCHES AND IF THE PRICE CHANGE TYPE CODE OF ACTUAL FILE IS MDA00120000
001300*  THEN CHANGE TYPE CODE TO MUC AND WRITE IT TO THE OUTPUT FILE IF00130000
001400*  IF IT DOESN'T MATCH THEN WRITE THE RECORD DIRECTLY TO THE      00140000
001500*  OUTPUT FILE.                                                   00150000
001600* ****************************************************************00160000
001700* CHANGE DESCRIPTION                                              00170000
001800* ****************************************************************00180000
001900* DATE  02/10/2014                                                00190000
002000*  CHANGE MADE: INITIAL VERSION.                                  00200000
002100* MADE BY: PRITHIVIRAJ S (COGNIZANT)    TKID: TKMAJC7             00210000
002100* CR NO : CHG0081217                                              00211000
002200***************************************************************** 00212000
002300 ENVIRONMENT DIVISION.                                            00213000
002400 CONFIGURATION SECTION.                                           00214000
002500 SOURCE-COMPUTER.        IBM-3090.                                00215000
002600 OBJECT-COMPUTER.        IBM-3090.                                00216000
002700 INPUT-OUTPUT SECTION.                                            00217000
002800*                                                                 00218000
002900 FILE-CONTROL.                                                    00219000
003000*                                                                 00220000
003100     SELECT INPUT-PERM-ACTUALS                                    00230000
003200         ASSIGN TO INP01.                                         00240000
003300*                                                                 00250000
003400     SELECT  INPUT-MUC-FILE                                       00260000
003500         ASSIGN TO INP02.                                         00270000
003600*                                                                 00280000
003700     SELECT COMP-OUT-FILE                                         00290000
003800         ASSIGN TO OUT01.                                         00300000
003900*                                                                 00310000
004000***************************************************************** 00320000
004100 DATA DIVISION.                                                   00330000
004200***************************************************************** 00340000
004300 FILE SECTION.                                                    00350000
004400*                                                                 00360000
004500 FD  INPUT-PERM-ACTUALS                                           00370000
004600     RECORDING MODE IS F                                          00380000
004700     BLOCK CONTAINS 0 RECORDS                                     00390000
004800     LABEL RECORDS ARE STANDARD.                                  00400000
004900*                                                                 00410000
005000 01  PERM-ACTUALS-REC             PIC X(100).                     00420000
005100*                                                                 00430000
005200 FD  INPUT-MUC-FILE                                               00440000
005300     RECORDING MODE IS F                                          00450000
005400     BLOCK CONTAINS 0 RECORDS                                     00460000
005500     LABEL RECORDS ARE STANDARD.                                  00470000
005600*                                                                 00480000
005700 01  MUC-DATA-REC                  PIC X(011).                    00490000
005800*                                                                 00500000
005900 FD  COMP-OUT-FILE                                                00510000
006000     RECORDING MODE IS F                                          00520000
006100     BLOCK CONTAINS 0 RECORDS                                     00530000
006200     LABEL RECORDS ARE STANDARD.                                  00540000
006300*                                                                 00550000
006400 01  COMP-OUT-REC                 PIC X(100).                     00560000
006500*                                                                 00570000
006600***************************************************************** 00580000
006700 WORKING-STORAGE SECTION.                                         00590000
006800*                                                                 00600000
006900 01  PS-PROGRAM-SWITCHES.                                         00610000
007000     05  PS-EOF-MUC-SW                PIC X(01)  VALUE 'N'.       00620000
007100         88  PS-EOF-MUC-YES                      VALUE 'Y'.       00630000
007200         88  PS-EOF-MUC-NO                       VALUE 'N'.       00640000
007300     05  PS-EOF-ACTUAL-SW             PIC X(01)  VALUE 'N'.       00650000
007400         88  PS-EOF-ACTUAL-YES                   VALUE 'Y'.       00660000
007500         88  PS-EOF-ACTUAL-NO                    VALUE 'N'.       00670000
007600     05  PS-MATCH-SW                  PIC X(01)  VALUE 'N'.       00680000
007700         88  PS-MATCH-YES                        VALUE 'Y'.       00690000
007800         88  PS-MATCH-NO                         VALUE 'N'.       00700000
007900*                                                                 00710000
008000 01  PC-PROGRAM-CONSTANTS.                                        00720000
008100     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'PEKUT003'.00730000
008200*                                                                 00740000
008300 01  PV-PROGRAM-VARIABLES.                                        00750000
008400     05  PV-RECS-READ-ACTUAL          PIC  9(09) VALUE  0.        00760000
008500     05  PV-RECS-READ-MUC             PIC  9(09) VALUE  0.        00770000
008600     05  PV-RECS-WRITE-ACTUAL         PIC  9(09) VALUE  0.        00780000
008700     05  PV-RECS-WRITE-MUC            PIC  9(09) VALUE  0.        00790000
008800*                                                                 00800000
008900 01  PV-ABEND-FIELDS.                                             00810000
009000     05  PV-ABEND-PROGRAM             PIC  X(08) VALUE 'PEKUT003'.00820000
009100     05  FILLER                       PIC  X(01) VALUE SPACES.    00830000
009200     05  PV-ABEND-PARAGRAPH           PIC  X(50) VALUE SPACES.    00840000
009300     05  FILLER                       PIC  X(01) VALUE SPACES.    00850000
009400     05  PV-ABEND-MESSAGE             PIC  X(50) VALUE SPACES.    00860000
009500     05  FILLER                       PIC  X(01) VALUE SPACES.    00870000
009510     05  PV-ABEND-MESSAGE1            PIC  X(50) VALUE SPACES.    00880000
009520     05  FILLER                       PIC  X(01) VALUE SPACES.    00890000
009530     05  PV-ABEND-MESSAGE2            PIC  X(50) VALUE SPACES.    00900000
009540     05  FILLER                       PIC  X(01) VALUE SPACES.    00910000
009600     05  PV-OPERATION-ATTEMPTED       PIC  X(50) VALUE SPACE.     00920000
009700     05  FILLER                       PIC  X(01) VALUE SPACES.    00930000
009800     05  PV-ABEND-CODE                PIC  S9(04) VALUE +0  COMP. 00940000
009900*                                                                 00950000
010000 01  PV-TABLE.                                                    00960000
010100     05 PV-MUC                        OCCURS 99999 TIMES INDEXED  00970000
010200                                      BY PV-INX.                  00980000
010300        10 PV-MUC-PRCHG-ID               PIC  9(10) VALUE ZEROES. 00990000
010400        10 FILLER                        PIC  X(01) VALUE SPACES. 01000000
010500***************************************************************** 01010000
010600*  INPUT LAYOUT FOR MUC FILE                                    * 01020000
010700***************************************************************** 01030000
010800 01  WS-MUC-REC.                                                  01040000
010900     05 WS-MUC-PRCHG-ID               PIC  9(10) VALUE ZEROES.    01050000
011000     05 FILLER                        PIC  X(01) VALUE SPACES.    01060000
011100                                                                  01070000
011200***************************************************************** 01080000
011300     COPY PERD110.                                                01090000
011400*                                                                 01100000
011500***************************************************************** 01110000
011600 PROCEDURE DIVISION.                                              01120000
011700***************************************************************** 01130000
011800     DISPLAY '**** BEGINNING PEKUT003 ****'.                      01140000
011900     DISPLAY ' '.                                                 01150000
012000*                                                                 01160000
012100 0000-MAIN-PARA.                                                  01170000
012200     PERFORM 1000-INITIALIZATION.                                 01180000
012300     PERFORM 2000-MAIN-PROCESS.                                   01190000
012400     PERFORM 9000-EOJ.                                            01200000
012500*                                                                 01210000
012600        STOP RUN.                                                 01220000
012700*                                                                 01230000
012800***************************************************************** 01240000
012900*  INITIALIZE PARA                                                01250000
013000***************************************************************** 01260000
013100 1000-INITIALIZATION.                                             01270000
013200*                                                                 01280000
013300     MOVE '1000-INITIALIZATION ' TO PV-ABEND-PARAGRAPH.           01290000
013400*                                                                 01300000
013500     OPEN INPUT  INPUT-PERM-ACTUALS                               01310000
013600                 INPUT-MUC-FILE                                   01320000
013700          OUTPUT COMP-OUT-FILE.                                   01330000
013800*                                                                 01340000
013900     INITIALIZE PV-PROGRAM-VARIABLES.                             01350000
014000     INITIALIZE MUC-DATA-REC.                                     01360000
014100     INITIALIZE PE110-RECORD.                                     01370000
014200*                                                                 01380000
014300***************************************************************** 01390000
014400*  MAIN PROCESS PARA                                              01400000
014500***************************************************************** 01410000
014600 2000-MAIN-PROCESS.                                               01420000
014700*                                                                 01430000
014800     MOVE '2000-MAIN-PROCESS ' TO PV-ABEND-PARAGRAPH.             01440000
014900*                                                                 01450000
015000      PERFORM 2150-READ-MUC-FILE                                  01460000
015100        UNTIL PS-EOF-MUC-YES                                      01470000
015200                                                                  01480000
015300      PERFORM UNTIL PS-EOF-ACTUAL-YES                             01490000
015500        PERFORM 2100-READ-PERM-ACTUAL-FILE                        01500000
015510          IF PV-RECS-READ-ACTUAL = 0 AND                          01510000
015520                PV-RECS-READ-MUC > 0                              01520000
015530             MOVE 'PERM ACTUAL FILE IS EMPTY'                     01530000
015540                            TO    PV-ABEND-MESSAGE                01540000
015550             MOVE 'PLEASE CHECK THE STATUS OF PRICE CHANGE'       01550000
015560                            TO    PV-ABEND-MESSAGE1               01551000
015570             MOVE '       IN PERM/XM TABLE AND CORRECT AS NEEDED' 01552000
015571                            TO    PV-ABEND-MESSAGE2               01553000
015572             PERFORM 9999-ABEND                                   01554000
015580        END-IF                                                    01555000
015600          IF PE110-PRCHG-ID IS NOT NUMERIC                        01556000
015700             MOVE 'PRICE CHANGE ID IS NOT NUMERIC'                01557000
015800                            TO        PV-ABEND-MESSAGE            01558000
015830           PERFORM 9999-ABEND                                     01559000
016000         END-IF                                                   01560000
016100            IF PE110-PRCHG-TYP-CDE = 'MDA' AND                    01570000
016200               PS-EOF-ACTUAL-NO                                   01580000
016300                 SET PS-MATCH-NO   TO TRUE                        01590000
016400                 PERFORM 2200-CHECK-MUC-FILE                      01600000
016500            ELSE                                                  01610000
016600             IF  PS-EOF-ACTUAL-NO                                 01620000
016700               WRITE COMP-OUT-REC FROM PE110-RECORD               01630000
016800               ADD 1               TO PV-RECS-WRITE-ACTUAL        01640000
016900             END-IF                                               01650000
017000            END-IF                                                01660000
017100      END-PERFORM.                                                01670000
017200*                                                                 01680000
017300***************************************************************** 01690000
017400*  READ PERM ACTUAL EXTRACT FILE                                * 01700000
017500***************************************************************** 01710000
017600 2100-READ-PERM-ACTUAL-FILE.                                      01720000
017700*                                                                 01730000
017800     MOVE '2100-READ-PERM-ACTUAL-FILE ' TO PV-ABEND-PARAGRAPH.    01740000
017900*                                                                 01750000
018000       READ INPUT-PERM-ACTUALS                                    01760000
018100          INTO PE110-RECORD                                       01770000
018200       AT END                                                     01780000
018300          SET PS-EOF-ACTUAL-YES      TO TRUE                      01790000
018400       END-READ.                                                  01800000
018500*                                                                 01810000
018600       IF PS-EOF-ACTUAL-NO                                        01820000
018700            ADD 1                   TO PV-RECS-READ-ACTUAL        01830000
018800       END-IF.                                                    01840000
018900*                                                                 01850000
019000***************************************************************** 01860000
019100*  READ MUC EXTRACT FILE                                        * 01870000
019200***************************************************************** 01880000
019300 2150-READ-MUC-FILE.                                              01890000
019400*                                                                 01900000
019500     MOVE '2150-READ-MUC-FILE '     TO PV-ABEND-PARAGRAPH.        01910000
019600*                                                                 01920000
019700       READ INPUT-MUC-FILE                                        01930000
019800          INTO WS-MUC-REC                                         01940000
019900       AT END                                                     01950000
020000          SET PS-EOF-MUC-YES        TO TRUE                       01960000
020100       NOT AT END                                                 01970000
020200         IF WS-MUC-PRCHG-ID IS NOT NUMERIC                        01980000
020300           MOVE 'PRICE CHANGE ID IS NOT NUMERIC'  TO              01990000
020400                                   PV-ABEND-MESSAGE               02000000
020500           PERFORM 9999-ABEND                                     02010000
020600         END-IF                                                   02020000
020610         IF PS-EOF-MUC-NO                                         02030000
020620            ADD 1                   TO PV-RECS-READ-MUC           02040000
020630         END-IF                                                   02050000
020700         PERFORM 2151-MOVE-FILE                                   02060000
020800       END-READ.                                                  02070000
020900*                                                                 02080000
021300*                                                                 02090000
021400***************************************************************** 02100000
021500* MOVE FILE VARIABLES TO TEMP TABLE                               02110000
021600***************************************************************** 02120000
021700 2151-MOVE-FILE.                                                  02130000
021800*                                                                 02140000
021900     MOVE '2151-MOVE-FILE ' TO PV-ABEND-PARAGRAPH.                02150000
022000       IF PV-RECS-READ-MUC > 99999                                02160000
022100        MOVE 'INTERNAL TABLE OVERFLOW'                            02170000
022200                            TO    PV-ABEND-MESSAGE                02180000
022210        MOVE 'INCREASE THE INTERNAL TABLE SIZE GREATER THAN 99999'02190000
022220                            TO    PV-ABEND-MESSAGE1               02200000
022300          PERFORM 9999-ABEND                                      02210000
022400       END-IF                                                     02220000
022500     MOVE WS-MUC-REC TO PV-MUC(PV-INX)                            02230000
022600     SET PV-INX UP BY 1.                                          02240000
022700*                                                                 02250000
022800***************************************************************** 02260000
022900* CHECK MUC FILE AND CHANGE MDA TO MUC FOR MATCHING RECS          02270000
023000***************************************************************** 02280000
023100 2200-CHECK-MUC-FILE.                                             02290000
023200*                                                                 02300000
023300     MOVE '2200-CHECK-MUC-FILE ' TO PV-ABEND-PARAGRAPH.           02310000
023400*                                                                 02320000
023500     SET PV-INX                TO 1                               02330000
023600       SEARCH PV-MUC                                              02340000
023700        WHEN PV-MUC-PRCHG-ID(PV-INX) = PE110-PRCHG-ID             02350000
023800        SET PS-MATCH-YES             TO TRUE                      02360000
023900       END-SEARCH.                                                02370000
024000*                                                                 02380000
024100     IF PS-MATCH-YES                                              02390000
024200         MOVE 'MUC'                TO PE110-PRCHG-TYP-CDE         02400000
024300         WRITE COMP-OUT-REC        FROM PE110-RECORD              02410000
024400         ADD 1                     TO PV-RECS-WRITE-MUC           02420000
024500     ELSE                                                         02430000
024700         WRITE COMP-OUT-REC        FROM PE110-RECORD              02440000
024800         ADD 1                     TO PV-RECS-WRITE-ACTUAL        02450000
024900     END-IF.                                                      02460000
025000*                                                                 02470000
025100***************************************************************** 02480000
025200*  END OF JOB OPERATIONS                                        * 02490000
025300***************************************************************** 02500000
025400 9000-EOJ.                                                        02510000
025500*                                                                 02520000
025600     MOVE '9000-EOJ ' TO PV-ABEND-PARAGRAPH.                      02530000
025700*                                                                 02540000
025800     CLOSE INPUT-PERM-ACTUALS                                     02550000
025900           INPUT-MUC-FILE                                         02560000
026000           COMP-OUT-FILE.                                         02570000
026100*                                                                 02580000
026200*                                                                 02590000
026300      DISPLAY 'ACTUAL REC READ COUNT    : ' PV-RECS-READ-ACTUAL.  02600000
026400      DISPLAY 'MUC REC READ COUNT       : ' PV-RECS-READ-MUC.     02610000
026500      DISPLAY 'ACTUAL REC WRITE COUNT   : ' PV-RECS-WRITE-ACTUAL. 02620000
026600      DISPLAY 'MUC RECORD WRITE COUNT   : ' PV-RECS-WRITE-MUC.    02630000
026700*                                                                 02640000
026800******************************************************************02650000
026900*  THIS ROUTINE FORCES AN ABEND                                   02660000
027000******************************************************************02670000
027100 9999-ABEND.                                                      02680000
027200                                                                  02690000
027300     MOVE +4013 TO PV-ABEND-CODE.                                 02700000
027400     DISPLAY 'PARA : ' PV-ABEND-PARAGRAPH.                        02710000
027500     DISPLAY 'CODE : ' PV-ABEND-CODE.                             02720000
027600     DISPLAY 'ERROR: ' PV-ABEND-MESSAGE.                          02730000
027610     DISPLAY 'MSG  : ' PV-ABEND-MESSAGE1.                         02740000
027620     DISPLAY PV-ABEND-MESSAGE2.                                   02750000
027700     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         02760000
