000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030001
000400 PROGRAM-ID.             RCKUT129.                                00040001
000500 AUTHOR.                 PATRICK BURKE.                           00050001
000600 INSTALLATION.           KOHLS.                                   00060001
000700 DATE-WRITTEN            MARCH, 2004.                             00070001
000800 DATE-COMPILED.                                                   00080001
000900                                                                  00090001
001000******************************************************************00100001
001100* THIS MODULE WILL DETERMINE WHEN A TRAILER IS CLOSED IF THE      00110001
001200* RECEIVERS ATTACHED CAN BE VERIFIED. FOR PBS ORDERS THE VEM      00120001
001300* (VERIFICATION ELIGIBILITY MODULE - RCKUT124) WILL BE CALLED TO  00130001
001400* SEE IF THE ORDER CAN BE VERIFIED AND IF IT CANNOT DUE TO AN OPEN00140001
001500* SYSTEM AUDIT THEN MODULE SUKCS762 WILL BE CALLED TO AUTO        00150002
001600* ADJUST SYSTEM PROMPTED AUDITS.                                  00160001
001700******************************************************************00170001
001800                                                                  00180001
001900******************************************************************00190001
002000 ENVIRONMENT DIVISION.                                            00200001
002100******************************************************************00210001
002200                                                                  00220001
002300******************************************************************00230001
002400 DATA DIVISION.                                                   00240001
002500******************************************************************00250001
002600                                                                  00260001
002700******************************************************************00270001
002800 WORKING-STORAGE SECTION.                                         00280001
002900******************************************************************00290001
003000*----------------------------------------------------------------*00300001
003100**  SECURITY SUBROUTINE PARAMETERS                                00310001
003200*----------------------------------------------------------------*00320001
003300     COPY DPWS008.                                                00330001
003400                                                                  00340001
003500******************************************************************00350007
003600*      THIS COPYBOOK IS USED FOR THE VERIFICATION ELIGIBILITY    *00360007
003700*  MODULE.  THIS MODULE WILL BE USED TO DETERMINE IF AN ORDER    *00370007
003800*  CAN BE VERIFIED.  (RCKUT124)                                  *00380007
003900******************************************************************00390007
004000     COPY RCWS038.                                                00400007
004100                                                                  00410007
004200***************************************************************** 00420007
004300*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00430007
004400*  THE AUTO CONFIRMATION MODULE (RCKUT125).                     * 00440007
004500***************************************************************** 00450007
004600     COPY RCWS041.                                                00460007
004700                                                                  00470007
004800***************************************************************** 00480010
004900*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00490010
005000*  THE AUTO VERIFICATION MODULE (RCKUT127).                     * 00500010
005100***************************************************************** 00510010
005200     COPY RCWS040.                                                00520010
005300                                                                  00530010
005400***************************************************************** 00540010
005500*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00550010
005600*  THE ADJUST SYSTEM AUDIT MODULE (SUKCS762).                     00560010
005700***************************************************************** 00570010
005800     COPY SUWS047.                                                00580010
005900                                                                  00590010
006000***************************************************************** 00600010
006100*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00610010
006200*  THE VERIFICATION TRANSACTION (PCKCS200).                     * 00620007
006300***************************************************************** 00630007
006400     COPY RCWS289.                                                00640007
006500                                                                  00650007
007100***************************************************************** 00710010
007200*    STANDARD COMMAREA.                                         * 00720010
007300*---------------------------------------------------------------* 00730010
007400     COPY DPWS020.                                                00740010
007500     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                00750010
007600                                                                  00760010
007700         10  INTER-APPL-COMM-AREA       PIC X(200).               00770010
007800     COPY RCWS815.                                                00780010
007900                                                                  00790009
008000***************************************************************** 00800009
008100*                                                                 00810001
008200 01  DK-DB2-KEYS.                                                 00820001
008300     05  DK-PO-NBR                       PIC S9(09) COMP SYNC.    00830001
008400     05  DK-REC-SEQ-NBR                  PIC S9(09) COMP SYNC.    00840001
008500     05  DK-TRIP-ID                      PIC S9(09) COMP.         00850009
008600     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00860001
008700     05  DK-FCLTY-ID                     PIC S9(04) COMP.         00870001
008800     05  DK-USER-ID                      PIC X(08).               00880017
008900                                                                  00890001
009000 01  PC-PROGRAM-CONSTANTS.                                        00900001
009100     05  PC-DEFAULT-TMST           PIC X(26)  VALUE               00910001
009200                                  '9999-09-09-09.09.09.999999'.   00920001
009300     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'RCKUT129'.   00930001
009400     05  PC-DEFAULT-DATE           PIC X(10)  VALUE '9999-09-09'. 00940001
009500     05  PC-AUTOVE-MODULE          PIC X(08)  VALUE 'RCKUT127'.   00950004
009600     05  PC-AUTOVE-MODULE-LENGTH   PIC S9(04) VALUE  +400         00960001
009700                                                    COMP SYNC.    00970001
009800     05  PC-RCKUT124               PIC X(08)  VALUE 'RCKUT124'.   00980006
009900     05  PC-VERIF-ELIGIBILITY-PGM  PIC X(08)  VALUE 'RCKUT124'.   00990008
010000     05  PC-FULLCASE-CONFIRM-PGM   PIC X(08)  VALUE 'RCKUT125'.   01000008
010100     05  PC-CONFIRM-BY-RECEIVER    PIC X(08)  VALUE 'RCKUT136'.   01010014
010200                                                                  01020006
010300     05  PC-MAX-ITEMS              PIC S9(09) VALUE +1000000      01030004
010400                                                    COMP-3.       01040004
010500                                                                  01050001
010600                                                                  01060001
010700 01  PS-PROGRAM-SWITCHES.                                         01070001
010800     05  PS-ERROR-SW                    PIC  X(01)  VALUE  'N'.   01080001
010900         88  PS-NO-ERROR                            VALUE  'N'.   01090001
011000         88  PS-ERROR                               VALUE  'Y'.   01100001
011100     05  PS-END-CSR-SW                  PIC  X(01)   VALUE 'N'.   01110036
011200         88  PS-END-CSR-YES                          VALUE 'Y'.   01120036
011300         88  PS-END-CSR-NO                           VALUE 'N'.   01130036
011400     05  PS-REC-ATCHD-TRLR-SW           PIC  X(01)   VALUE 'N'.   01140018
011500         88  PS-REC-ATCHD-TRLR                       VALUE 'Y'.   01150018
011600         88  PS-REC-ATCHD-TRLR-NO                    VALUE 'N'.   01160018
011700                                                                  01170001
011800 01  PV-PROGRAM-VARIABLES.                                        01180001
011900     05  PV-NULL-IND                    PIC S9(04)  VALUE +0      01190001
012000                                                    COMP SYNC.    01200001
012100     05  PV-NOTIF-NBR                    PIC S9(9) VALUE ZERO     01210001
012200                                                COMP SYNC.        01220001
012300     05  PV-CURRENT-TIMESTAMP            PIC X(26)   VALUE SPACES.01230001
012400     05  PV-FROM-PARAGRAPH               PIC X(35) VALUE SPACES.  01240001
012500     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01250001
012600                                                COMP SYNC.        01260001
012700     05  PV-CICS-RESP                    PIC S9(04)  VALUE +0     01270008
012800                                                COMP SYNC.        01280001
012900     05  PV-READ-COUNT                   PIC S9(09)  VALUE +0     01290004
013000                                                COMP-3.           01300004
013100     05  PV-DISPLAY-SQLCODE              PIC -9(05) VALUE ZEROES. 01310001
013200     05  PV-DISP-SHIPT-UNT-ID            PIC 9(18).               01320001
013300     05  PV-DISP-PO                      PIC 9(09).               01330001
013400     05  PV-DISP-RCVR-SEQ-NBR            PIC 9(04).               01340001
013500     05  PV-DISP-OPER-UNT-ID             PIC 9(04).               01350004
013600     05  PV-DISP-DEPT                    PIC X(03).               01360004
013700     05  PV-DISPLAY-CICS-RESP            PIC 999999999-           01370001
013800                                                 VALUE ZEROS.     01380001
013900     05  PV-DISPLAY-OPER-UNT-ID       PIC  9(04).                 01390014
014000     05  PV-DISPLAY-FCLTY-ID          PIC  9(04).                 01400014
014100     05  PV-DISPLAY-PO-NBR            PIC  9(09).                 01410014
014200     05  PV-DISPLAY-RCVR-SEQ-NBR      PIC  9(09).                 01420014
014300     05  PV-DISPLAY-LNE-NBR           PIC  9(04).                 01430014
014400     05  PV-DISPLAY-PREPK-ID          PIC  9(04).                 01440014
014500     05  PV-DISPLAY-TRIP-ID           PIC  9(09).                 01450014
014600*                                                                 01460014
014700     05  PV-CICS-RESPONSE             PIC S9(04)  VALUE +0        01470014
014800                                           COMP SYNC.             01480014
014900     05  PV-CICS-MSG-AREA             PIC  X(80)  VALUE SPACES.   01490014
015000                                                                  01500018
015100     05  PV-DB2-COUNT-REC-TRLR        PIC S9(04)  VALUE +0        01510018
015200                                            COMP.                 01520018
015300*---------------------------------------------------------------* 01530014
015400*    ABEND PROCESSING COPYBOOK.                                 * 01540014
015500*---------------------------------------------------------------* 01550014
015600     COPY DPWS013.                                                01560014
015700*                                                                 01570014
015800*----------------------------------------------------------------*01580001
015900*    SQL AND COBOL DECLARATIONS FOR THE PURCHASE ORDER TABLE      01590001
016000*----------------------------------------------------------------*01600001
016100     EXEC SQL                                                     01610001
016200          INCLUDE TPURCHS                                         01620001
016300     END-EXEC.                                                    01630001
016400*----------------------------------------------------------------*01640001
016500*    SQL AND COBOL DECLARATIONS FOR THE RECEIVER TABLE (TRECEIV)  01650001
016600*----------------------------------------------------------------*01660001
016700     EXEC SQL                                                     01670001
016800          INCLUDE TRECEIV                                         01680001
016900     END-EXEC.                                                    01690001
017000*---------------------------------------------------------------* 01700001
017100*    DB2 AREA FOR SHIPMENT TABLE                                * 01710001
017200*---------------------------------------------------------------* 01720001
017300     EXEC SQL                                                     01730001
017400          INCLUDE TSHIPMT                                         01740001
017500     END-EXEC.                                                    01750001
017600*---------------------------------------------------------------* 01760001
017700*    DB2 AREA FOR SHIPMENT PO TABLE                             * 01770001
017800*---------------------------------------------------------------* 01780001
017900     EXEC SQL                                                     01790001
018000          INCLUDE TSHPTPO                                         01800001
018100     END-EXEC.                                                    01810001
018200*---------------------------------------------------------------* 01820001
018300*    DB2 AREA FOR THE PACKSLIP TABLE                            * 01830001
018400*---------------------------------------------------------------* 01840001
018500     EXEC SQL                                                     01850001
018600          INCLUDE TPKSLIP                                         01860001
018700     END-EXEC.                                                    01870001
018800*---------------------------------------------------------------* 01880001
018900*    DB2 AREA FOR VEHICLE TRIP TABLE                            * 01890001
019000*---------------------------------------------------------------* 01900001
019100     EXEC SQL                                                     01910001
019200          INCLUDE TVHTRIP                                         01920001
019300     END-EXEC.                                                    01930001
019400*----------------------------------------------------------------*01940001
019500*  SQL AND COBOL DECLARATIONS FOR PARMS (TKRPRPM)                 01950001
019600*----------------------------------------------------------------*01960001
019700     EXEC SQL                                                     01970001
019800          INCLUDE TKRPRPM                                         01980001
019900     END-EXEC.                                                    01990001
020000                                                                  02000001
020100*----------------------------------------------------------------*02010001
020200*  DCLGEN LAYOUT AND COBOL DECLARATION FOR LOGISTICS DOMAIN       02020001
020300*  LOCATION MASTER TABLE                                          02030001
020400*----------------------------------------------------------------*02040001
020500     EXEC SQL                                                     02050001
020600         INCLUDE XLT00010                                         02060001
020700     END-EXEC.                                                    02070001
020800******************************************************************02080001
020900******************************************************************02090001
021000*  COMMUNICATIONS AREA FOR DB2                                    02100001
021100******************************************************************02110001
021200     EXEC SQL                                                     02120001
021300         INCLUDE SQLCA                                            02130001
021400     END-EXEC.                                                    02140001
021500                                                                  02150001
021600*---------------------------------------------------------------* 02160001
021700*  CURSOR TO SELECT RECEIVERS                                   * 02170001
021800*---------------------------------------------------------------* 02180001
021900                                                                  02190001
022000     EXEC SQL                                                     02200001
022100          DECLARE RCVR-CSR CURSOR WITH HOLD FOR                   02210020
022200          SELECT C.PO_NBR                                         02220001
022300                ,C.REC_SEQ_NBR                                    02230001
022400                ,E.STATUS_CDE                                     02240001
022500                ,E.PACK_BY_ST_IND                                 02250001
022600                ,E.FRE_ASTRA_IND                                  02260001
022700                ,E.PKGNG_CDE                                      02270017
022800            FROM  TVHTRIP A                                       02280001
022900                , TSHIPMT B                                       02290001
023000                , TSHPTPO C                                       02300001
023100                , TRECEIV E                                       02310001
023200            WHERE A.TRIP_ID           = :DK-TRIP-ID               02320001
023300              AND A.TRIP_ID           = B.TRIP_ID                 02330001
023400              AND C.SHIPT_ID          = B.SHIPT_ID                02340001
023500              AND C.PRIM_SHIPT_IND    = 'Y'                       02350001
023600              AND C.PO_NBR            = E.ORD_NBR                 02360001
023700              AND C.REC_SEQ_NBR       = E.REC_SEQ_NBR             02370001
023800              AND E.VER_STATUS_CDE    = 'A'                       02380001
023900              AND E.STATUS_CDE     IN ('IP' , 'CM')               02390001
024000                                                                  02400001
024100     END-EXEC.                                                    02410001
024200                                                                  02420001
024300******************************************************************02430001
024400 LINKAGE SECTION.                                                 02440001
024500 01  DFHCOMMAREA.                                                 02450010
024600     05  FILLER                       OCCURS 1 TO 4072 TIMES      02460010
024700                                      DEPENDING ON EIBCALEN.      02470010
024800         10  FILLER                   PIC X.                      02480010
024900                                                                  02490010
025000******************************************************************02500001
025100 PROCEDURE DIVISION.                                              02510010
025200                                                                  02520010
025300     SET RC041-SUCCESSFUL        TO TRUE                          02530016
025400     INITIALIZE DCLTVHTRIP                                        02540003
025500                DCLTSHIPMT                                        02550003
025600                DCLTSHPTPO                                        02560003
025700                DCLTPKSLIP                                        02570003
025800                DCLTRECEIV.                                       02580003
025900                                                                  02590001
026000******************************************************************02600001
026100 0000-PROGRAM-MAINLINE.                                           02610001
026200     INITIALIZE PV-PROGRAM-VARIABLES                              02620017
026300                RC041-FIELDS.                                     02630017
026400                                                                  02640017
026500     SET PS-NO-ERROR TO TRUE.                                     02650001
026600     MOVE 'N'                   TO  PS-ERROR-SW                   02660001
026700                                    RC040-AUTO-VE-SW.             02670001
026800     MOVE DFHCOMMAREA              TO RC041-FIELDS.               02680017
026900                                                                  02690001
027000     PERFORM 1000-CONTROL-PROCESSING.                             02700006
027100                                                                  02710001
027200     PERFORM 9998-RETURN.                                         02720001
027300                                                                  02730001
027400 1000-CONTROL-PROCESSING.                                         02740006
027500                                                                  02750001
027600     MOVE RC041-TRIP-ID          TO DK-TRIP-ID.                   02760015
027700     MOVE RC041-OPER-UNT-ID      TO DK-OPER-UNT-ID.               02770015
027800     MOVE RC041-FCLTY-ID         TO DK-FCLTY-ID.                  02780015
027900     MOVE RC041-USER-ID          TO DK-USER-ID.                   02790017
028000                                                                  02800038
028100     PERFORM 9300-CHECK-LOGGING.                                  02810039
028200                                                                  02820039
028300     IF KRPRPM-FUNC-TXT = 'Y'                                     02830039
028400          MOVE RC041-PO-NBR TO     PV-DISPLAY-PO-NBR              02840039
028500          MOVE RC041-REC-SEQ-NBR TO PV-DISPLAY-RCVR-SEQ-NBR       02850039
028600          MOVE RC041-PO-LNE-NBR TO PV-DISPLAY-LNE-NBR             02860039
028700          STRING   ' RCKUT129 '                                   02870039
028800                   ' CALLED BY-'                                  02880039
028900                   RC041-PROGRAM-NAME                             02890039
029000                   ' PO = '                                       02900039
029100                   PV-DISPLAY-PO-NBR '-'                          02910039
029200                   PV-DISPLAY-RCVR-SEQ-NBR '-'                    02920039
029300                   PV-DISPLAY-LNE-NBR                             02930039
029400                   DELIMITED BY SIZE                              02940039
029500                                      INTO PV-CICS-MSG-AREA       02950039
029600          PERFORM 9999-WRITE-TO-CSSL                              02960039
029700      END-IF.                                                     02970039
029800                                                                  02980001
029900     PERFORM 4010-OPEN-CURSOR.                                    02990006
030000                                                                  03000006
030100     PERFORM 4300-PROCESS-CURSOR                                  03010006
030200        UNTIL PS-END-CSR-YES.                                     03020036
030300                                                                  03030006
030400     PERFORM 4020-CLOSE-CURSOR.                                   03040006
030500                                                                  03050001
030600*----------------------------------------------------------------*03060001
030700*    CALL TO (AUTOVE) AUTOVERIFICATION MODULE (RCKUT127)          03070001
030800*----------------------------------------------------------------*03080001
030900 2300-CALL-AUTOVE-MODULE.                                         03090001
031000                                                                  03100001
031100     INITIALIZE RC040-FIELDS.                                     03110001
031200     MOVE DK-OPER-UNT-ID       TO RC040-SIGNON-LOCATION.          03120017
031300     MOVE DK-PO-NBR            TO RC040-PO-NBR                    03130007
031400     MOVE DK-REC-SEQ-NBR       TO RC040-PO-RCVR                   03140007
031500     MOVE DK-USER-ID           TO RC040-USER-ID.                  03150021
031600     MOVE 'RCKUT129'           TO RC040-CALLING-PROGRAM.          03160008
031700                                                                  03170001
031800     CALL RC040-AUTOVE-CHECK-PGM USING  DFHEIBLK                  03180001
031900                                        RC040-COMMAREA            03190001
032000                                        RC040-FIELDS.             03200001
032100                                                                  03210001
032200     EVALUATE TRUE                                                03220015
032300         WHEN RC040-SUCCESSFUL                                    03230015
032400             CONTINUE                                             03240015
032500         WHEN OTHER                                               03250015
032600              MOVE '2300-CALL-AUTOVE-MODULE'                      03260015
032700                                   TO DP013-PARAGRAPH             03270015
032800              MOVE 'CALL RCKUT127 AUTOVE MOD  '                   03280015
032900                                   TO DP013-MESSAGE-TEXT (1)      03290015
033000              MOVE RC040-SQLCA     TO DP013-SQLCA                 03300015
033100              MOVE 'TKRPRPM '      TO DP013-DB2-TABLE-NAME (1)    03310015
033200              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           03320015
033300              MOVE DK-REC-SEQ-NBR                                 03330015
033400                                   TO PV-DISPLAY-RCVR-SEQ-NBR     03340015
033500              STRING 'PO = '                                      03350015
033600                     PV-DISPLAY-PO-NBR                            03360015
033700                     ' RECV = '                                   03370015
033800                     PV-DISPLAY-RCVR-SEQ-NBR                      03380015
033900                     DELIMITED BY SIZE                            03390015
034000                                 INTO DP013-MESSAGE-TEXT (2)      03400015
034100              MOVE RC040-CRA-RET-MSG                              03410015
034200                                   TO DP013-MESSAGE-TEXT (3)      03420015
034300              SET DP013-DB2-ABEND  TO TRUE                        03430015
034400              PERFORM DP013-0000-PROCESS-ABEND                    03440015
034500     END-EVALUATE.                                                03450015
034600/                                                                 03460001
034700******************************************************************03470005
034800 2400-CHECK-DC-AUTO-VE.                                           03480005
034900                                                                  03490001
035000     EXEC SQL                                                     03500001
035100          SELECT   FUNC_TXT                                       03510001
035200            INTO  :KRPRPM-FUNC-TXT                                03520001
035300            FROM                                                  03530001
035400                  TKRPRPM A                                       03540001
035500            WHERE                                                 03550001
035600                  LOC_ID            = :KRPRPM-LOC-ID              03560001
035700              AND SYS_PRC_FUNC_CDE  = 'AUTOVE'                    03570001
035800              AND FUNC_PRC_STAT_CDE = 'AC'                        03580001
035900              AND INTFC_SYS_CDE     = 'KHL'                       03590001
036000              AND FUNC_BEG_TMST    <=   :RECEIV-CRE-TMST          03600001
036100              AND FUNC_END_TMST    >=   :RECEIV-CRE-TMST          03610001
036200     END-EXEC.                                                    03620001
036300                                                                  03630001
036400     EVALUATE TRUE                                                03640001
036500         WHEN SQLCODE = ZERO                                      03650001
036600              IF KRPRPM-FUNC-TXT   = 'Y'                          03660001
036700                 SET RC040-AUTO-VE-YES TO TRUE                    03670001
036800              ELSE                                                03680001
036900                 SET RC040-AUTO-VE-NO TO TRUE                     03690001
037000              END-IF                                              03700001
037100         WHEN SQLCODE = +100                                      03710001
037200              SET RC040-AUTO-VE-NO TO TRUE                        03720001
037300         WHEN SQLWARN0 NOT = SPACES                               03730001
037400         WHEN SQLCODE  NOT = ZERO                                 03740001
037500             SET RC040-INVALID-SQL    TO TRUE                     03750015
037600             MOVE RC040-PO-NBR        TO PV-DISP-PO               03760015
037700             MOVE RC040-PO-RCVR       TO PV-DISP-RCVR-SEQ-NBR     03770001
037800             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       03780001
037900             STRING   ' RCKUT127-2400-'                           03790001
038000                      ' CALLED BY-'                               03800001
038100                      RC040-CALLING-PROGRAM                       03810001
038200                      ' PO='                                      03820001
038300                      PV-DISP-PO                                  03830001
038400                      ' RCVR='                                    03840001
038500                      PV-DISP-RCVR-SEQ-NBR                        03850001
038600                      'SQLCODE'                                   03860001
038700                      PV-DISPLAY-SQLCODE                          03870001
038800                      DELIMITED BY SIZE                           03880001
038900                                      INTO RC040-CRA-RET-MSG      03890001
039000             MOVE '2400-'        TO RC040-CRA-REQ-ID              03900001
039100             PERFORM 9998-RETURN                                  03910001
039200     END-EVALUATE.                                                03920001
039300                                                                  03930001
039400******************************************************************03940005
039500*  CALL TO VEM (VERIFICATION ELIGIBILITY MODULE - RCKUT124)       03950006
039600******************************************************************03960005
039700 2500-CALL-RCKUT124-VEM.                                          03970005
039800                                                                  03980005
039900     INITIALIZE RC038-FIELDS.                                     03990025
040000     MOVE DK-PO-NBR            TO RC038-PO-NBR                    04000007
040100     MOVE DK-REC-SEQ-NBR       TO RC038-REC-SEQ-NBR.              04010012
040200     MOVE DK-USER-ID           TO RC038-USER-ID.                  04020021
040300     MOVE DK-OPER-UNT-ID       TO RC038-OPER-UNT-ID.              04030028
040400     MOVE DK-FCLTY-ID          TO RC038-FCLTY-ID.                 04040028
040500     MOVE 'RCKUT129'           TO RC038-PROGRAM-NAME.             04050012
040600     SET RC038-PBS             TO TRUE.                           04060007
040700     MOVE 'Y'                  TO RC038-VERIFY-SW.                04070019
040800                                                                  04080019
040900     MOVE RC040-AUTO-VE-SW     TO RC038-AUTOVE-PO-SW.             04090039
041000                                                                  04100039
041100     MOVE LENGTH OF RC038-FIELDS         TO PV-COMMAREA-LENGTH.   04110039
041200                                                                  04120039
041300     EXEC CICS                                                    04130039
041400         LINK PROGRAM  (PC-RCKUT124)                              04140039
041500              COMMAREA (RC038-FIELDS)                             04150039
041600              LENGTH   (PV-COMMAREA-LENGTH)                       04160039
041700              RESP     (PV-CICS-RESP)                             04170039
041800     END-EXEC.                                                    04180039
041900                                                                  04190039
042000     EVALUATE TRUE                                                04200039
042100         WHEN PV-CICS-RESP = DFHRESP (NORMAL)                     04210039
042200             IF  RC038-INVALID-SQL     OR                         04220039
042300                 RC038-DATABASE-BUSY                              04230039
042400                 STRING ' RCKUT129 - '        DELIMITED BY SIZE   04240039
042500                        ' RETURN MESSAGE - '  DELIMITED BY SIZE   04250039
042600                        RC038-SUCCESS-IND     DELIMITED BY SIZE   04260039
042700                                   INTO DP013-MESSAGE-TEXT(1)     04270039
042800                 SET DP013-DB2-ABEND         TO TRUE              04280039
042900                 SET DP013-NO-ROLLBACK       TO TRUE              04290039
043000                 MOVE '2500-CALL-RCKUT124-VEM' TO DP013-PARAGRAPH 04300039
043100                 PERFORM DP013-0000-PROCESS-ABEND                 04310039
043200             END-IF                                               04320039
043300         WHEN OTHER                                               04330039
043400             MOVE PV-CICS-RESP          TO PV-DISPLAY-CICS-RESP   04340039
043500             STRING ' RCKUT129 (OTHER) -' DELIMITED BY SIZE       04350039
043600                    ' CICS RESP = '       DELIMITED BY SIZE       04360039
043700                    PV-DISPLAY-CICS-RESP  DELIMITED BY SIZE       04370039
043800                               INTO DP013-MESSAGE-TEXT(1)         04380039
043900             SET DP013-DB2-ABEND         TO TRUE                  04390039
044000             SET DP013-NO-ROLLBACK       TO TRUE                  04400039
044100             MOVE '2500-CALL-RCKUT124-VEM' TO DP013-PARAGRAPH     04410039
044200             PERFORM DP013-0000-PROCESS-ABEND                     04420039
044300                                                                  04430039
044400     END-EVALUATE.                                                04440039
044500                                                                  04450039
044600/                                                                 04460005
044700******************************************************************04470008
044800*    CHECK TO DETERMINE IF THIS CAN BE AUTOMATICALLY ADJUSTED    *04480008
044900*    BY CALLING THE SUKCS762 MODULE.                             *04490008
045000******************************************************************04500008
045100 3000-CALL-ADJUST-SYST-AUDIT.                                     04510008
045200                                                                  04520008
045300     INITIALIZE SU047-COMMAREA-REC.                               04530008
045400     MOVE DK-PO-NBR               TO  SU047-PO-NBR.               04540013
045500     MOVE DK-REC-SEQ-NBR          TO  SU047-REC-SEQ-NBR.          04550008
045600     MOVE DK-OPER-UNT-ID          TO  SU047-OPER-UNT-ID.          04560040
045610     MOVE 1                       TO  SU047-FCLTY-ID.             04561041
045700     MOVE DK-USER-ID              TO  SU047-USER-ID.              04570021
045800     MOVE RECEIV-PKGNG-CDE        TO  SU047-PKGNG-CDE.            04580030
045900     MOVE RECEIV-PACK-BY-ST-IND   TO  SU047-PBS-IND.              04590030
046000                                                                  04600030
046100     MOVE 'RCKUT129'              TO  SU047-CALLING-PROGRAM.      04610030
046200                                                                  04620030
046300     MOVE LENGTH OF SU047-COMMAREA-REC   TO PV-COMMAREA-LENGTH.   04630033
046400                                                                  04640033
046500     EXEC CICS                                                    04650033
046600         LINK PROGRAM  (SU047-MODULE-NAME)                        04660034
046700              COMMAREA (SU047-COMMAREA-REC)                       04670033
046800              LENGTH   (PV-COMMAREA-LENGTH)                       04680033
046900              RESP     (PV-CICS-RESPONSE)                         04690033
047000     END-EXEC.                                                    04700033
047100                                                                  04710033
047200     EVALUATE TRUE                                                04720030
047300         WHEN SU047-SUCCESSFUL                                    04730030
047400            CONTINUE                                              04740030
047500                                                                  04750032
047600         WHEN SU047-DATABASE-BUSY                                 04760030
047700            MOVE DK-PO-NBR              TO PV-DISP-PO             04770030
047800            MOVE DK-REC-SEQ-NBR         TO PV-DISP-RCVR-SEQ-NBR   04780030
047900            STRING ' RCKUT129 - CALL TO '       DELIMITED BY SIZE 04790030
048000                   SU047-MODULE-NAME            DELIMITED BY SIZE 04800030
048100                   ' PO/RCVR: '                 DELIMITED BY SIZE 04810030
048200                  PV-DISP-PO                    DELIMITED BY SIZE 04820030
048300                  '-'                           DELIMITED BY SIZE 04830030
048400                  PV-DISP-RCVR-SEQ-NBR          DELIMITED BY SIZE 04840030
048500                  SU047-SUCCESS-IND '-'         DELIMITED BY SIZE 04850030
048600                  SU047-SQLCODE                 DELIMITED BY SIZE 04860030
048700                                      INTO PV-CICS-MSG-AREA       04870030
048800            PERFORM 9999-WRITE-TO-CSSL                            04880030
048900            STRING ' RCKUT129 - SQLCA - '       DELIMITED BY SIZE 04890030
049000                   SU047-SQLCA                  DELIMITED BY SIZE 04900030
049100                                      INTO PV-CICS-MSG-AREA       04910030
049200            PERFORM 9999-WRITE-TO-CSSL                            04920030
049300            STRING ' RCKUT129 - RET MSG -'      DELIMITED BY SIZE 04930030
049400                   SU047-CRA-RET-MSG            DELIMITED BY SIZE 04940030
049500                                      INTO PV-CICS-MSG-AREA       04950030
049600            PERFORM 9999-WRITE-TO-CSSL                            04960030
049700            MOVE '3000-CALL-ADJUST-SYST-AUDIT' TO DP013-PARAGRAPH 04970030
049800            MOVE 'AUTOMATIC ADJUSTMNTS- ' TO DP013-MESSAGE-TEXT(1)04980030
049900            MOVE DK-PO-NBR              TO PV-DISP-PO             04990030
050000            MOVE DK-REC-SEQ-NBR         TO PV-DISP-RCVR-SEQ-NBR   05000030
050100            STRING ' RCVR: '             DELIMITED BY SIZE        05010030
050200                   PV-DISP-PO            DELIMITED BY SIZE        05020030
050300                    '-'                  DELIMITED BY SIZE        05030030
050400                    PV-DISP-RCVR-SEQ-NBR DELIMITED BY SIZE        05040030
050500                                     INTO DP013-MESSAGE-TEXT (2)  05050030
050600             MOVE SQLCA               TO DP013-SQLCA              05060030
050700             MOVE 'RCKUT129'          TO DP013-DB2-TABLE-NAME (1) 05070030
050800             SET DP013-ROLLBACK                                   05080030
050900                 DP013-DB2-ABEND      TO TRUE                     05090030
051000             PERFORM 9999-WRITE-TO-CSSL                           05100030
051100         WHEN OTHER                                               05110030
051200            MOVE DK-PO-NBR              TO PV-DISP-PO             05120030
051300            MOVE DK-REC-SEQ-NBR         TO PV-DISP-RCVR-SEQ-NBR   05130030
051400            STRING ' RCKUT129 - CALL TO '       DELIMITED BY SIZE 05140030
051500                   SU047-MODULE-NAME            DELIMITED BY SIZE 05150030
051600                   ' PO/RCVR: '                 DELIMITED BY SIZE 05160030
051700                  PV-DISP-PO                    DELIMITED BY SIZE 05170030
051800                  '-'                           DELIMITED BY SIZE 05180030
051900                  PV-DISP-RCVR-SEQ-NBR          DELIMITED BY SIZE 05190030
052000                  SU047-SUCCESS-IND '-'         DELIMITED BY SIZE 05200008
052100                  SU047-SQLCODE                 DELIMITED BY SIZE 05210008
052200                                      INTO PV-CICS-MSG-AREA       05220008
052300            PERFORM 9999-WRITE-TO-CSSL                            05230015
052400            STRING ' RCKUT129 - SQLCA - '       DELIMITED BY SIZE 05240015
052500                   SU047-SQLCA                  DELIMITED BY SIZE 05250008
052600                                      INTO PV-CICS-MSG-AREA       05260008
052700            PERFORM 9999-WRITE-TO-CSSL                            05270015
052800            STRING ' RCKCS129 - RET MSG -'      DELIMITED BY SIZE 05280015
052900                   SU047-CRA-RET-MSG            DELIMITED BY SIZE 05290008
053000                                      INTO PV-CICS-MSG-AREA       05300008
053100            PERFORM 9999-WRITE-TO-CSSL                            05310015
053200            MOVE '3000-CALL-ADJUST-SYST-AUDIT' TO DP013-PARAGRAPH 05320008
053300            MOVE 'AUTOMATIC ADJUSTMNTS- ' TO DP013-MESSAGE-TEXT(1)05330008
053400            MOVE DK-PO-NBR              TO PV-DISP-PO             05340015
053500            MOVE DK-REC-SEQ-NBR         TO PV-DISP-RCVR-SEQ-NBR   05350015
053600            STRING ' RCVR: '             DELIMITED BY SIZE        05360008
053700                   PV-DISP-PO            DELIMITED BY SIZE        05370015
053800                    '-'                  DELIMITED BY SIZE        05380015
053900                   PV-DISP-RCVR-SEQ-NBR  DELIMITED BY SIZE        05390015
054000                                     INTO DP013-MESSAGE-TEXT (2)  05400008
054100             MOVE SQLCA               TO DP013-SQLCA              05410008
054200             MOVE 'RCKUT129'          TO DP013-DB2-TABLE-NAME (1) 05420015
054300             SET DP013-ROLLBACK                                   05430008
054400                 DP013-DB2-ABEND      TO TRUE                     05440008
054500             PERFORM 9999-WRITE-TO-CSSL                           05450015
054600     END-EVALUATE.                                                05460008
054700/                                                                 05470014
054800******************************************************************05480014
054900* THIS MODULE WILL PROCESS AT PO/RCVR LEVEL AND CALL THE          05490014
055000* CONFIRMATION MODULE FOR EACH LINE OF THE RECEIVER.              05500014
055100******************************************************************05510014
055200 3500-RCKUT136-CONFIRM-RCVR.                                      05520014
055300                                                                  05530014
055400     INITIALIZE RC041-FIELDS.                                     05540014
055500     MOVE DK-PO-NBR                 TO RC041-PO-NBR               05550015
055600     MOVE DK-REC-SEQ-NBR            TO RC041-REC-SEQ-NBR          05560015
055700     MOVE DK-OPER-UNT-ID            TO RC041-OPER-UNT-ID          05570015
055800     MOVE DK-FCLTY-ID               TO RC041-FCLTY-ID             05580015
055900     MOVE RECEIV-PKGNG-CDE          TO RC041-PKGNG-CDE            05590014
056000     MOVE RECEIV-PACK-BY-ST-IND     TO RC041-PBS-IND              05600014
056100     MOVE DK-USER-ID                TO RC041-USER-ID              05610021
056200     MOVE PC-CURRENT-PROGRAM-NAME   TO RC041-PROGRAM-NAME         05620014
056300     SET RC041-VERIFY-YES                                         05630014
056400         RC041-PROCESS-BY-LINE      TO TRUE                       05640026
056500                                                                  05650014
056600     MOVE LENGTH OF RC041-FIELDS    TO PV-COMMAREA-LENGTH.        05660014
056700                                                                  05670014
056800     EXEC CICS                                                    05680014
056900         LINK PROGRAM  (PC-CONFIRM-BY-RECEIVER)                   05690014
057000              COMMAREA (RC041-FIELDS)                             05700014
057100              LENGTH   (PV-COMMAREA-LENGTH)                       05710014
057200              RESP     (PV-CICS-RESPONSE)                         05720014
057300     END-EXEC.                                                    05730014
057400                                                                  05740014
057500     EVALUATE TRUE                                                05750014
057600            WHEN RC041-SUCCESSFUL                                 05760014
057700                 CONTINUE                                         05770014
057800            WHEN RC041-INVALID-SQL                                05780014
057900            WHEN RC041-DATABASE-BUSY                              05790014
058000                 MOVE '3500-RCKUT136-CONFIRM-RCVR '               05800014
058100                                      TO DP013-PARAGRAPH          05810014
058200                 MOVE 'CALL RCKUT136 CONFIRMATION  '              05820014
058300                                      TO DP013-MESSAGE-TEXT (1)   05830014
058400                 MOVE RC041-SQLCA     TO DP013-SQLCA              05840014
058500                 MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR        05850015
058600                 MOVE DK-REC-SEQ-NBR                              05860015
058700                                      TO PV-DISPLAY-RCVR-SEQ-NBR  05870014
058800                 STRING 'PO = '                                   05880014
058900                        PV-DISPLAY-PO-NBR                         05890014
059000                        ' RECV = '                                05900014
059100                        PV-DISPLAY-RCVR-SEQ-NBR                   05910014
059200                        DELIMITED BY SIZE                         05920014
059300                                    INTO DP013-MESSAGE-TEXT (2)   05930014
059400                 MOVE RC041-CRA-RET-MSG                           05940014
059500                                      TO DP013-MESSAGE-TEXT (3)   05950014
059600                 SET DP013-DB2-ABEND  TO TRUE                     05960014
059700                 PERFORM DP013-0000-PROCESS-ABEND                 05970014
059800         WHEN OTHER                                               05980014
059900              MOVE '3500-RCKUT136-CONFIRM-RECVR '                 05990014
060000                                   TO DP013-PARAGRAPH             06000014
060100              MOVE 'CALL RCKUT136 CONFIRMATION  '                 06010014
060200                                   TO DP013-MESSAGE-TEXT (1)      06020014
060300              MOVE RC041-SQLCA     TO DP013-SQLCA                 06030014
060400              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           06040015
060500              MOVE DK-REC-SEQ-NBR                                 06050015
060600                                   TO PV-DISPLAY-RCVR-SEQ-NBR     06060014
060700              STRING 'PO = '                                      06070014
060800                     PV-DISPLAY-PO-NBR                            06080014
060900                     ' RECV = '                                   06090014
061000                     PV-DISPLAY-RCVR-SEQ-NBR                      06100014
061100                     DELIMITED BY SIZE                            06110014
061200                                 INTO DP013-MESSAGE-TEXT (2)      06120014
061300              MOVE RC041-CRA-RET-MSG                              06130014
061400                                   TO DP013-MESSAGE-TEXT (3)      06140014
061500              SET DP013-DB2-ABEND  TO TRUE                        06150014
061600              PERFORM DP013-0000-PROCESS-ABEND                    06160014
061700                                                                  06170014
061800       END-EVALUATE.                                              06180014
061900*----------------------------------------------------------------*06190003
062000* OPEN THE RCVR CURSOR.                                          *06200003
062100*----------------------------------------------------------------*06210003
062200                                                                  06220003
062300 4010-OPEN-CURSOR.                                                06230003
062400                                                                  06240003
062500         EXEC SQL                                                 06250003
062600             OPEN RCVR-CSR                                        06260003
062700         END-EXEC                                                 06270003
062800                                                                  06280003
062900         EVALUATE TRUE                                            06290003
063000             WHEN SQLCODE = +0                                    06300003
063100                  CONTINUE                                        06310003
063200             WHEN SQLCODE = -904                                  06320003
063300             WHEN SQLCODE = -913                                  06330003
063400                  CONTINUE                                        06340003
063500             WHEN SQLWARN0 NOT = SPACE                            06350003
063600             WHEN SQLCODE  NOT = +0                               06360003
063700                  MOVE '4010-OPEN-CURSOR'                         06370003
063800                                   TO DP013-PARAGRAPH             06380003
063900                  MOVE 'OPEN RCVR-CSR CURSOR'                     06390003
064000                                   TO DP013-MESSAGE-TEXT (1)      06400003
064100                  MOVE SQLCA       TO DP013-SQLCA                 06410003
064200                  MOVE 'TVHTRIP'   TO DP013-DB2-TABLE-NAME (1)    06420003
064300                  MOVE 'TSHIPMT'   TO DP013-DB2-TABLE-NAME (2)    06430003
064400                  MOVE 'TSHPTPO'   TO DP013-DB2-TABLE-NAME (3)    06440003
064500                  SET DP013-DB2-ABEND                             06450003
064600                                   TO TRUE                        06460003
064700                  PERFORM DP013-0000-PROCESS-ABEND                06470003
064800         END-EVALUATE.                                            06480015
064900                                                                  06490003
065000/                                                                 06500003
065100*----------------------------------------------------------------*06510003
065200* CLOSE THE RCVR CURSOR                                          *06520003
065300*----------------------------------------------------------------*06530003
065400                                                                  06540003
065500 4020-CLOSE-CURSOR.                                               06550003
065600                                                                  06560003
065700     EXEC SQL                                                     06570003
065800         CLOSE RCVR-CSR                                           06580003
065900     END-EXEC.                                                    06590003
066000                                                                  06600003
066100     EVALUATE TRUE                                                06610003
066200         WHEN SQLCODE = +0                                        06620003
066300              CONTINUE                                            06630003
066400         WHEN SQLWARN0 NOT = SPACE                                06640003
066500         WHEN SQLCODE  NOT = +0                                   06650003
066600              MOVE '4020-CLOSE-CURSOR'                            06660003
066700                                   TO DP013-PARAGRAPH             06670003
066800              MOVE 'CLOSE RCVR-CSR CURSOR'                        06680003
066900                                   TO DP013-MESSAGE-TEXT (1)      06690003
067000              MOVE SQLCA           TO DP013-SQLCA                 06700003
067100              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    06710003
067200              MOVE 'TSTATCD'       TO DP013-DB2-TABLE-NAME (2)    06720003
067300              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (3)    06730003
067400              SET DP013-DB2-ABEND  TO TRUE                        06740003
067500              PERFORM DP013-0000-PROCESS-ABEND                    06750003
067600     END-EVALUATE.                                                06760003
067700                                                                  06770003
067800/                                                                 06780003
067900******************************************************************06790004
068000*                                                                 06800004
068100******************************************************************06810004
068200 4300-PROCESS-CURSOR.                                             06820005
068300                                                                  06830004
068400     PERFORM                                                      06840004
068500         VARYING PV-READ-COUNT                                    06850004
068600         FROM 1 BY 1                                              06860004
068700         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    06870004
068800            OR (PS-END-CSR-YES))                                  06880036
068900                                                                  06890004
069000         PERFORM 4310-FETCH                                       06900004
069100                                                                  06910036
069200         IF PS-END-CSR-NO                                         06920036
069300            PERFORM 4326-REC-TRNSCRBD                             06930036
069400            IF PS-REC-ATCHD-TRLR                                  06940036
069500               PERFORM 2300-CALL-AUTOVE-MODULE                    06950036
069600                 IF RC040-AUTO-VE-YES                             06960036
069700                     IF RECEIV-PACK-BY-ST-IND = 'Y'               06970036
069800                         PERFORM 2500-CALL-RCKUT124-VEM           06980036
069900                           IF RC038-VERIFY-YES                    06990036
070000                               PERFORM 5000-START-VERIFY-MODULE   07000036
070100                           ELSE                                   07010036
070200                             IF RC038-OPEN-SYSTEM-AUDIT           07020005
070300                               PERFORM 3000-CALL-ADJUST-SYST-AUDIT07030008
070400                           END-IF                                 07040036
070500                     ELSE                                         07050036
070600                          PERFORM 3500-RCKUT136-CONFIRM-RCVR      07060036
070700                     END-IF                                       07070036
070800                 END-IF                                           07080036
070900            END-IF                                                07090036
071000         END-IF                                                   07100036
071100     END-PERFORM.                                                 07110036
071200                                                                  07120036
071300     PERFORM 8000-COMMIT.                                         07130036
071400                                                                  07140036
071500*----------------------------------------------------------------*07150036
071600*    FETCH A RCVR ROW                                            *07160036
071700*----------------------------------------------------------------*07170036
071800 4310-FETCH.                                                      07180036
071900                                                                  07190036
072000     EXEC SQL                                                     07200036
072100         FETCH RCVR-CSR                                           07210036
072200          INTO :SHPTPO-PO-NBR                                     07220036
072300              ,:SHPTPO-REC-SEQ-NBR                                07230036
072400              ,:RECEIV-STATUS-CDE                                 07240013
072500              ,:RECEIV-PACK-BY-ST-IND                             07250013
072600              ,:RECEIV-FRE-ASTRA-IND                              07260013
072700              ,:RECEIV-PKGNG-CDE                                  07270017
072800     END-EXEC.                                                    07280013
072900                                                                  07290013
073000     EVALUATE TRUE                                                07300013
073100         WHEN SQLCODE = +0                                        07310013
073200              MOVE SHPTPO-PO-NBR         TO DK-PO-NBR             07320013
073300              MOVE SHPTPO-REC-SEQ-NBR    TO DK-REC-SEQ-NBR        07330013
073400         WHEN SQLCODE = +100                                      07340013
073500              SET PS-END-CSR-YES                                  07350036
073600                                   TO TRUE                        07360013
073700         WHEN SQLWARN0 NOT = SPACE                                07370013
073800         WHEN SQLCODE < +0                                        07380013
073900         WHEN SQLCODE > +0                                        07390013
074000              MOVE '4310-FETCH-CURSOR'                            07400013
074100                                   TO DP013-PARAGRAPH             07410013
074200              MOVE 'FETCH RCVR CURSOR'                            07420013
074300                                   TO DP013-MESSAGE-TEXT (1)      07430013
074400              MOVE SQLCA           TO DP013-SQLCA                 07440013
074500              MOVE 'TPURCHS'       TO DP013-DB2-TABLE-NAME (1)    07450013
074600              MOVE 'TSTATCD'       TO DP013-DB2-TABLE-NAME (2)    07460013
074700              MOVE 'TRECEIV'       TO DP013-DB2-TABLE-NAME (3)    07470013
074800              SET DP013-DB2-ABEND  TO TRUE                        07480013
074900              PERFORM DP013-0000-PROCESS-ABEND                    07490013
075000     END-EVALUATE.                                                07500013
075100                                                                  07510013
075200/                                                                 07520013
075300******************************************************************07530018
075400* CHECK IF PACKSLIPS ATTACHED TO RECEIVER IS TRANSCRIBED.         07540018
075500******************************************************************07550018
075600                                                                  07560018
075700 4326-REC-TRNSCRBD.                                               07570018
075800     INITIALIZE        PV-DB2-COUNT-REC-TRLR.                     07580018
075900                                                                  07590018
076000     EXEC SQL                                                     07600018
076100          SELECT  COUNT(*)                                        07610018
076200          INTO  :PV-DB2-COUNT-REC-TRLR                            07620018
076300          FROM   TPKSLIP A                                        07630018
076400          WHERE A.PO_NBR        = :DK-PO-NBR                      07640018
076500            AND A.REC_SEQ_NBR   = :DK-REC-SEQ-NBR                 07650018
076600            AND A.VER_STAT_CDE  = 'A'                             07660018
076700            AND A.PKSL_STAT_CDE = 'AC'                            07670018
076800     END-EXEC                                                     07680018
076900                                                                  07690018
077000                                                                  07700018
077100     EVALUATE TRUE                                                07710018
077200         WHEN SQLCODE = ZERO                                      07720018
077300              IF PV-DB2-COUNT-REC-TRLR > 0                        07730018
077400                 SET PS-REC-ATCHD-TRLR     TO TRUE                07740018
077500              ELSE                                                07750018
077600                 SET PS-REC-ATCHD-TRLR-NO  TO TRUE                07760018
077700              END-IF                                              07770018
077800         WHEN SQLCODE = +100                                      07780018
077900              SET PS-REC-ATCHD-TRLR-NO     TO TRUE                07790018
078000         WHEN SQLWARN0 NOT = SPACE                                07800018
078100         WHEN SQLCODE NOT = ZERO                                  07810018
078200              MOVE '4326-REC-TRNSCRBD'                            07820018
078300                               TO DP013-PARAGRAPH                 07830018
078400              MOVE 'CHECK TRANSCRIBED PACKSLIPS'                  07840018
078500                               TO DP013-MESSAGE-TEXT (1)          07850018
078600              MOVE DK-PO-NBR       TO PV-DISPLAY-PO-NBR           07860018
078700              MOVE DK-REC-SEQ-NBR                                 07870018
078800                                    TO PV-DISPLAY-RCVR-SEQ-NBR    07880018
078900              STRING 'PO = '                                      07890018
079000                        PV-DISPLAY-PO-NBR                         07900018
079100                        ' RECV = '                                07910018
079200                        PV-DISPLAY-RCVR-SEQ-NBR                   07920018
079300                        DELIMITED BY SIZE                         07930018
079400                                    INTO DP013-MESSAGE-TEXT (2)   07940018
079500              MOVE SQLCA       TO DP013-SQLCA                     07950018
079600              SET DP013-DB2-ABEND                                 07960018
079700                               TO TRUE                            07970018
079800              PERFORM DP013-0000-PROCESS-ABEND                    07980018
079900     END-EVALUATE.                                                07990018
080000                                                                  08000018
080100                                                                  08010018
080200*----------------------------------------------------------------*08020013
080300 5000-START-VERIFY-MODULE.                                        08030013
080400     INITIALIZE RC289-COMMAREA-FOR-E200.                          08040013
080500                                                                  08050013
080600     MOVE DK-PO-NBR              TO RC289-ORD-NBR.                08060013
080700     MOVE DK-REC-SEQ-NBR         TO RC289-RCVR-SEQ-NBR.           08070013
080800     MOVE PC-CURRENT-PROGRAM-NAME TO RC289-CALLING-PROGRAM.       08080022
080900     MOVE RC041-USER-ID           TO RC289-USER-ID.               08090023
081000     SET  RC289-VERIF-TRLR-UNLOAD TO TRUE.                        08100023
081100                                                                  08110023
081200     EXEC CICS                                                    08120023
081300          START TRANSID ('E200')                                  08130023
081400               FROM (RC289-COMMAREA-FOR-E200)                     08140023
081500     END-EXEC.                                                    08150023
081600                                                                  08160023
081700******************************************************************08170023
081800*-----------------------------------------------------------------08180023
081900*  COMMIT DATA TO DB2.                                            08190023
082000*-----------------------------------------------------------------08200023
082100 8000-COMMIT.                                                     08210023
082200                                                                  08220023
082300     EXEC SQL                                                     08230023
082400          COMMIT                                                  08240023
082500     END-EXEC.                                                    08250023
082600                                                                  08260023
082700     EVALUATE TRUE                                                08270023
082800        WHEN SQLCODE = 0                                          08280023
082900             CONTINUE                                             08290023
083000        WHEN OTHER                                                08300023
083100             DISPLAY 'UNABLE TO COMMIT DATA'                      08310023
083200     END-EVALUATE.                                                08320023
083300/                                                                 08330023
083400 9300-CHECK-LOGGING.                                              08340037
083500     EXEC SQL                                                     08350037
083600         SELECT FUNC_TXT                                          08360037
083700           INTO :KRPRPM-FUNC-TXT                                  08370037
083800           FROM TKRPRPM                                           08380037
083900          WHERE SYS_PRC_FUNC_CDE  = 'RC129D'                      08390037
084000            AND LOC_ID            = :DK-OPER-UNT-ID               08400037
084100            AND INTFC_SYS_CDE     = 'KHL'                         08410037
084200            AND FUNC_PRC_STAT_CDE = 'AC'                          08420037
084300     END-EXEC.                                                    08430037
084400                                                                  08440037
084500     EVALUATE TRUE                                                08450037
084600         WHEN SQLCODE = ZERO                                      08460037
084700         WHEN SQLCODE = +100                                      08470037
084800              CONTINUE                                            08480037
084900         WHEN SQLWARN0 NOT = SPACE                                08490037
085000         WHEN SQLCODE NOT = ZERO                                  08500037
085100             SET PS-ERROR                                         08510037
085200                 RC041-INVALID-SQL    TO TRUE                     08520037
085300             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       08530037
085400             MOVE DK-OPER-UNT-ID      TO PV-DISP-OPER-UNT-ID      08540037
085500             STRING   ' RCKUT129-9300-'                           08550037
085600                      ' CALLED BY-'                               08560037
085700                      RC041-PROGRAM-NAME                          08570037
085800                      '  SQLCODE='                                08580037
085900                      PV-DISPLAY-SQLCODE                          08590037
086000                      ' OPER = '                                  08600037
086100                      PV-DISP-OPER-UNT-ID                         08610037
086200                      DELIMITED BY SIZE                           08620037
086300                                      INTO PV-CICS-MSG-AREA       08630037
086400             PERFORM 9999-WRITE-TO-CSSL                           08640037
086500     END-EVALUATE.                                                08650037
086600                                                                  08660037
086700*-----------------------------------------------------------------08670023
086800*  RETURN TO CALLING PROGRAM                                      08680023
086900*-----------------------------------------------------------------08690023
087000 9998-RETURN.                                                     08700006
087100                                                                  08710001
087200     MOVE SQLCA                         TO RC040-SQLCA.           08720001
087300     GOBACK.                                                      08730001
087400                                                                  08740014
087500******************************************************************08750014
087600 9999-WRITE-TO-CSSL.                                              08760014
087700        MOVE LENGTH OF PV-CICS-MSG-AREA                           08770014
087800            TO PV-COMMAREA-LENGTH                                 08780014
087900        EXEC CICS                                                 08790014
088000            WRITEQ TD                                             08800014
088100                QUEUE   ('CSSL')                                  08810014
088200                FROM    (PV-CICS-MSG-AREA)                        08820014
088300                LENGTH  (PV-COMMAREA-LENGTH)                      08830014
088400                RESP    (PV-CICS-RESPONSE)                        08840014
088500        END-EXEC.                                                 08850014
088600*----------------------------------------------------------------*08860014
088700*    ABEND PROCESSOR MODULE                                      *08870014
088800*----------------------------------------------------------------*08880014
088900     COPY DPPD013.                                                08890014
