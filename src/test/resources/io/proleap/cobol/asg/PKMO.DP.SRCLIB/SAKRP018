000100***************************************************************** 00010004
000200 IDENTIFICATION DIVISION.                                         00020004
000300***************************************************************** 00030004
000400                                                                  00040004
000500 PROGRAM-ID.             SAKRP018.                                00050004
000600 AUTHOR.                 MATTHEW STIFF.                           00060004
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070004
000800 DATE-WRITTEN            MAY 1999.                                00080004
000900 DATE-COMPILED.                                                   00090004
001000                                                                  00100004
001100***************************************************************** 00110004
001200* * * *>>>   THIS PROGRAM MUST BE COMPILED COBOL/390   <<<* * * * 00120004
001300***************************************************************** 00130004
001400*                                                                 00140004
001500*  THIS PROGRAM WILL CREATE A DAILY NOVUS CORRECTIONS AUDIT REPORT00150004
001600*                                                                 00160004
001700*   INPUT: INP01 - CONTAINS POS DATE, WHICH IS USED AS THE        00170004
001800*                  PROCESS DATE TO CREATE THE REPORT.             00180004
001900*  OUTPUT: RPT01 - REPORT SHOWING NOVUS CORRECTIONS BY SALES DATE.00190004
002000*                                                                 00200004
002100***************************************************************** 00210004
002200*                                                                 00220004
002300*  THIS PROGRAM USES THE TEPDKEY TABLE TO JOIN THE TEPTRN,        00230004
002400*  TEPTND, AND TEPCRD TABLES.  THE TEPDKEY TABLE CONTAINS ALL     00240004
002500*  KEY INFORMATION FOR TRANSACTIONS THAT HAVE BEEN PROCESSED FOR  00250004
002600*  A PROCESSING DAY THAT DO NOT HAVE SALES DATES FOR THAT         00260004
002700*  PROCESSING DAY.  THE MOST COMMON EXAMPLE OF THIS IS A SALES    00270004
002800*  CORRECTION.                                                    00280004
002900*                                                                 00290004
003000*  THE REPORT USES DATA FROM THE TEPTND, TEPCRD, AND TEPTRN       00300004
003100*  TABLES.  A DETAIL LINE IS WRITTEN FOR EACH ROW FETCHED.        00310004
003200*  THE RPEORT BREAKS ON STORE NUMBER AND ALSO SALES DATE.         00320004
003300*  WHEN A NEW STORE IS ENCOUNTERED, THE STORE TABLE IS READ TO    00330004
003400*  GET THE DISCOVER MERCHANT NUMBER FOR THAT STORE.  WHEN A NEW   00340004
003500*  SALES DATE IS ENCOUNTERED, THE DATE IS PASSED TO THE CALENDAR  00350004
003600*  TO BE CHANGED INTO GREGORIAN FORMAT.                           00360004
003700*                                                                 00370004
003800*  WHEN THE FETCH IS COMPLETE, A TOTAL LINE IS PRINTED AT THE     00380004
003900*  END OF THE REPORT.                                             00390004
004000*                                                                 00400004
004100***************************************************************** 00410004
004200* CHANGED: 09/22/04                                               00420004
004300* PROJECT: XS DOMAIN CONSTRAINTS    WR/IR#: WR27107               00430004
004400* PROGRAMMER:  THOMAS HANSON                                      00440004
004500* DESCRIPTION: REPLACED TSTR000 WITH XST_LOC_ATTR TABLE.          00450004
004600*              PER USER REQUEST, REMOVED MERCH_NBR FROM RPT.      00460004
004100***************************************************************** 00461006
004200* CHANGED: 01/12/05  WR/IR#: WR28146    PAUL OMAN                 00462007
004300* PROJECT: MASK CREDIT CARD NUMBERS                               00463006
004500* DESCRIPTION: ONLY SHOW LAST 4 POSITIONS OF CREDIT CARD NUMBER.  00465006
004700***************************************************************** 00470004
004800 ENVIRONMENT DIVISION.                                            00480004
004900***************************************************************** 00490004
005000                                                                  00500004
005100 CONFIGURATION SECTION.                                           00510004
005200                                                                  00520004
005300 SOURCE-COMPUTER.        IBM-3090.                                00530004
005400                                                                  00540004
005500 OBJECT-COMPUTER.        IBM-3090.                                00550004
005600                                                                  00560004
005700 INPUT-OUTPUT SECTION.                                            00570004
005800                                                                  00580004
005900 FILE-CONTROL.                                                    00590004
006000                                                                  00600004
006100     SELECT POS-DATE-CARD-FILE                                    00610004
006200         ASSIGN TO INP01.                                         00620004
006300                                                                  00630004
006400     SELECT NOVUS-REPORT-FILE                                     00640004
006500         ASSIGN TO RPT01.                                         00650004
006600                                                                  00660004
006700 EJECT                                                            00670004
006800******************************************************************00680004
006900 DATA DIVISION.                                                   00690004
007000******************************************************************00700004
007100                                                                  00710004
007200 FILE SECTION.                                                    00720004
007300                                                                  00730004
007400 FD  POS-DATE-CARD-FILE                                           00740004
007500     RECORDING MODE IS F                                          00750004
007600     BLOCK CONTAINS 0 RECORDS                                     00760004
007700     LABEL RECORDS ARE STANDARD.                                  00770004
007800                                                                  00780004
007900 01  POS-DATE-CARD-RECORD            PIC X(80).                   00790004
008000                                                                  00800004
008100 FD  NOVUS-REPORT-FILE                                            00810004
008200     RECORDING MODE IS F                                          00820004
008300     BLOCK CONTAINS 0  RECORDS.                                   00830004
008400                                                                  00840004
008500 01  NOVUS-REPORT-RECORD             PIC  X(132).                 00850004
008600                                                                  00860004
008700 EJECT                                                            00870004
008800******************************************************************00880004
008900 WORKING-STORAGE SECTION.                                         00890004
009000******************************************************************00900004
009100 01  FILLER                            PIC X(50)  VALUE           00910004
009200     ' *** WORKING STORAGE STARTS HERE FOR SAKRP018 *** '.        00920004
009300                                                                  00930004
009400******************************************************************00940004
009500* RECORD LAYOUT FOR INPUT DATE CARD (POS DATE)                    00950004
009600******************************************************************00960004
009700 01  CC-CONTROL-CARD.                                             00970004
009800     05  CC-CONTROL-CARD-DISPLAY.                                 00980004
009900         10  CC-CONTROL-NAME     PIC X(14)    VALUE SPACE.        00990004
010000             88  CC-VALID-CONTROL-NAME        VALUE               01000004
010100                 'P.O.S. DATE = '.                                01010004
010200         10  CC-POS-DATE-MMDDYY  PIC 9(6)     VALUE ZERO.         01020004
010300     05  FILLER                  PIC X(60)    VALUE SPACE.        01030004
010400                                                                  01040004
010500******************************************************************01050004
010600*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01060004
010700******************************************************************01070004
010800     COPY DPWS500.                                                01080004
010900                                                                  01090004
011000 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01100004
011100                                                  COMP SYNC.      01110004
011200     88  AC-CONTROL-CARD-ERROR                    VALUE +4003.    01120004
011300     88  AC-DB2-ERROR                             VALUE +4013.    01130004
011400     88  AC-CALENDAR-ROUTINE-ERROR                VALUE +4019.    01140004
011500                                                                  01150004
011600                                                                  01160004
011700 EJECT                                                            01170004
011800 01  PS-PROGRAM-SWITCHES.                                         01180004
011900     05  PS-END-OF-CURSOR-SW           PIC X(01)  VALUE 'N'.      01190004
012000         88  PS-END-OF-CURSOR                     VALUE 'Y'.      01200004
012100     05  PS-END-OF-CARD-FILE-SW        PIC X(01)  VALUE 'N'.      01210004
012200         88  PS-END-OF-CARD-FILE                  VALUE 'Y'.      01220004
012300                                                                  01230004
012400 01  PC-CONSTANTS.                                                01240004
012500     05  PC-LINE-LIMIT               PIC S9(04)    VALUE +60.     01250004
012600     05  PC-ROW-NOT-FOUND            PIC S9(04)    VALUE +100     01260004
012700                                                   COMP SYNC.     01270004
012800     05  PC-CURRENT-PROGRAM-NAME     PIC  X(08)    VALUE          01280004
012900                                                   'SAKRP018'.    01290004
013000     05  PC-REPORT-NBR-1             PIC  9(01)    VALUE 1.       01300004
013100     05  PC-DISCOVER-TENDER-TYPE     PIC  X(02)    VALUE '07'.    01310004
013200     05  PC-NEGATIVE-ONE             PIC S9(02)    VALUE -1       01320004
013300                                                   COMP.          01330004
013400     05  PC-SYSTEM-CORRECTION        PIC  X(01)    VALUE 'S'.     01340004
013500     05  PC-REVERSAL-CORRECTION      PIC  X(01)    VALUE 'R'.     01350004
013600                                                                  01360004
013700 EJECT                                                            01370004
013800 01  PV-MISC-COUNT-FIELDS            COMP-3.                      01380004
013900     05  PV-PAGE-CNT                 PIC S9(05)    VALUE ZERO.    01390004
014000     05  PV-LINE-CNT                 PIC S9(03)    VALUE ZERO.    01400004
014100     05  PV-LINE-CNT-AHEAD           PIC S9(03)    VALUE ZERO.    01410004
014200     05  PV-CURSOR-CNT               PIC S9(07)    VALUE ZERO.    01420004
014300                                                                  01430004
014400******************************************************************01440004
014500*  ACCUMULATORS TO HOLD STORE AND COMPANY DOLLAR AMOUNTS.         01450004
014600******************************************************************01460004
014700 01  PA-PROGRAM-ACCUMULATORS.                                     01470004
014800     05  PA-STORE-SALES-AMOUNT       PIC S9(07)V99  VALUE ZERO    01480004
014900                                         COMP-3.                  01490004
015000     05  PA-STORE-RETURN-AMOUNT      PIC S9(07)V99  VALUE ZERO    01500004
015100                                         COMP-3.                  01510004
015200     05  PA-COMPANY-SALES-AMOUNT     PIC S9(07)V99  VALUE ZERO    01520004
015300                                         COMP-3.                  01530004
015400     05  PA-COMPANY-RETURN-AMOUNT    PIC S9(07)V99  VALUE ZERO    01540004
015500                                         COMP-3.                  01550004
015600                                                                  01560004
015700 01  PV-MISC-FIELDS.                                              01570004
015800     05  PV-PRINT-RECORD             PIC X(132)    VALUE SPACE.   01580004
015900     05  PV-LINE-SPACING             PIC S9(04)    VALUE ZERO     01590004
016000                                                   COMP SYNC.     01600004
016100     05  PV-PARAGRAPH-NAME           PIC  X(30)    VALUE SPACE.   01610004
016200     05  PV-OPERATION-MSG-1          PIC  X(40)    VALUE SPACE.   01620004
016300     05  PV-OPERATION-MSG-2          PIC  X(40)    VALUE SPACE.   01630004
016400     05  PV-DB2-OPERATION            PIC  X(30)    VALUE SPACE.   01640004
016500     05  PV-EDIT-MASK                PIC  Z,ZZZ,ZZ9.              01650004
016600     05  PV-HOLD-STORE               PIC  S9(04)  COMP VALUE ZERO.01660004
016700     05  PV-HOLD-SALES-DATE          PIC   X(10)  VALUE SPACE.    01670004
016800     05  PV-AMOUNT                   PIC  S9(07)V99 COMP-3        01680004
016900                                          VALUE ZERO.             01690004
017000     05  PV-AMOUNT-FORMATTED         PIC   ZZ,ZZ9.99-.            01700004
017100*    05  PV-MERCH-NMBR               PIC   9(15)  VALUE ZERO.     01710004
017200                                                                  01720004
017300 01  PV-DATE-AND-TIME-FIELDS.                                     01730004
017400     05  PV-POS-CCYY-MM-DD           PIC X(10)     VALUE SPACE.   01740004
017500     05  FILLER REDEFINES PV-POS-CCYY-MM-DD.                      01750004
017600         10  PV-POS-CCYY             PIC X(04).                   01760004
017700         10  FILLER                  PIC X(01).                   01770004
017800         10  PV-POS-MM               PIC X(02).                   01780004
017900         10  FILLER                  PIC X(01).                   01790004
018000         10  PV-POS-DD               PIC X(02).                   01800004
018100     05  PV-CURR-DATE-CCYYMMDD.                                   01810004
018200         10  PV-CURR-DATE-CCYY       PIC  9(04).                  01820004
018300         10  PV-CURR-DATE-MM         PIC  9(02).                  01830004
018400         10  PV-CURR-DATE-DD         PIC  9(02).                  01840004
018500     05  PV-CURR-TIME.                                            01850004
018600         10  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.    01860004
018700         10  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.    01870004
018800         10  PV-CURR-TIME-SSHH       PIC  9(04)    VALUE ZERO.    01880004
018900     05  PV-POS-DATE-FORMATTED       PIC  X(10)    VALUE SPACE.   01890004
019000     05  PV-SLS-DATE-FORMATTED       PIC  X(10)    VALUE SPACE.   01900004
019100 EJECT                                                            01910004
019200******************************************************************01920004
019300*  TOP OF PAGE HEADING LINE FOR PRINTING A 132 CHARACTER REPORT.  01930004
019400******************************************************************01940004
019500     COPY DPWS132.                                                01950004
019600                                                                  01960004
019700******************************************************************01970004
019800*  HEADING LINES FOR THE CORPORATE SETTLEMENTS REPORT.            01980004
019900******************************************************************01990004
020000 01  HL2-HEADING-LINE-2.                                          02000004
020100     05  FILLER                      PIC  X(39)    VALUE SPACE.   02010004
020200     05  FILLER                      PIC  X(06)    VALUE          02020004
020300                                          'NOVUS '.               02030004
020400     05  FILLER                      PIC  X(12)    VALUE          02040004
020500                                          'CORRECTIONS '.         02050004
020600     05  FILLER                      PIC  X(10)    VALUE          02060004
020700                                          'AUDIT FOR '.           02070004
020800     05  FILLER                      PIC  X(11)    VALUE          02080004
020900                                          'PROCESSING '.          02090004
021000     05  FILLER                      PIC  X(06)    VALUE          02100004
021100                                          'DATE: '.               02110004
021200     05  HL2-DATE                    PIC  X(10)    VALUE SPACE.   02120004
021300     05  FILLER                      PIC  X(38)    VALUE SPACE.   02130004
021400                                                                  02140004
021500 01  HL3-HEADING-LINE-3.                                          02150004
021600     05  FILLER                      PIC  X(45)    VALUE ALL '-'. 02160004
021700     05  FILLER                      PIC  X(09)    VALUE          02170004
021800                                          ' STORE # '.            02180004
021900     05  HL3-STORE                   PIC  Z999.                   02190004
022000*    05  FILLER                      PIC  X(03)    VALUE SPACE.   02200004
022100*    05  FILLER                      PIC  X(11)    VALUE          02210004
022200*                                         'MERCHANT # '.          02220004
022300*    05  HL3-MERCHANT                PIC  X(15)    VALUE SPACE.   02230004
022400     05  FILLER                      PIC  X(01)    VALUE SPACE.   02240004
022500     05  FILLER                      PIC  X(73)    VALUE ALL '-'. 02250004
022600                                                                  02260004
022700 01  HL4-HEADING-LINE-4.                                          02270004
022800     05  FILLER                      PIC  X(50)    VALUE SPACE.   02280004
022900     05  FILLER                      PIC  X(04)    VALUE 'AUTH'.  02290004
023000     05  FILLER                      PIC  X(78)    VALUE SPACE.   02300004
023100                                                                  02310004
023200 01  HL5-HEADING-LINE-5.                                          02320004
023300     05  FILLER                      PIC  X(08)    VALUE SPACE.   02330004
023400     05  FILLER                      PIC  X(10)    VALUE          02340004
023500                                                   'SALES DATE'.  02350004
023600     05  FILLER                      PIC  X(04)    VALUE SPACE.   02360004
023700     05  FILLER                      PIC  X(05)    VALUE 'REG #'. 02370004
023800     05  FILLER                      PIC  X(02)    VALUE SPACE.   02380004
023900     05  FILLER                      PIC  X(07)    VALUE          02390004
024000                                                   'TRANS #'.     02400004
024100     05  FILLER                      PIC  X(02)    VALUE SPACE.   02410004
024200     05  FILLER                      PIC  X(08)    VALUE          02420004
024300                                                   'ASSOC ID'.    02430004
024400     05  FILLER                      PIC  X(02)    VALUE SPACE.   02440004
024500     05  FILLER                      PIC  X(06)    VALUE          02450004
024600                                                   'NUMBER'.      02460004
024700     05  FILLER                      PIC  X(11)    VALUE SPACE.   02470004
024800     05  FILLER                      PIC  X(06)    VALUE          02480004
024900                                                   'ACCT #'.      02490004
025000     05  FILLER                      PIC  X(12)    VALUE SPACE.   02500004
025100     05  FILLER                      PIC  X(04)    VALUE          02510004
025200                                                   'CODE'.        02520004
025300     05  FILLER                      PIC  X(08)    VALUE SPACE.   02530004
025400     05  FILLER                      PIC  X(05)    VALUE          02540004
025500                                                   'SALES'.       02550004
025600     05  FILLER                      PIC  X(06)    VALUE SPACE.   02560004
025700     05  FILLER                      PIC  X(07)    VALUE          02570004
025800                                                   'RETURNS'.     02580004
025900     05  FILLER                      PIC  X(04)    VALUE SPACE.   02590004
026000     05  FILLER                      PIC  X(10)    VALUE          02600004
026100                                                   'NET AMOUNT'.  02610004
026200     05  FILLER                      PIC  X(03)    VALUE SPACE.   02620004
026300                                                                  02630004
026400 01  HL6-HEADING-LINE-6.                                          02640004
026500     05  FILLER                      PIC  X(04)    VALUE SPACE.   02650004
026600     05  FILLER                      PIC  X(08)    VALUE          02660004
026700                                          'STORE # '.             02670004
026800     05  HL6-STORE                   PIC  Z999.                   02680004
026900     05  FILLER                      PIC  X(11)    VALUE          02690004
027000                                          ' TOTAL FOR '.          02700004
027100     05  HL6-DATE                    PIC  X(10)    VALUE SPACE.   02710004
027200     05  FILLER                      PIC  X(54)    VALUE SPACE.   02720004
027300     05  HL6-SALES-TOTAL             PIC  X(10)    VALUE SPACE.   02730004
027400     05  FILLER                      PIC  X(03)    VALUE SPACE.   02740004
027500     05  HL6-RETURN-TOTAL            PIC  X(10)    VALUE SPACE.   02750004
027600     05  FILLER                      PIC  X(04)    VALUE SPACE.   02760004
027700     05  HL6-NET-AMOUNT              PIC  X(10)    VALUE SPACE.   02770004
027800     05  FILLER                      PIC  X(04)    VALUE SPACE.   02780004
027900                                                                  02790004
028000******************************************************************02800004
028100*  DETAIL LINE PRINTED ON THE REPORT.                             02810004
028200******************************************************************02820004
028300 01  DL1-DETAIL-LINE-1.                                           02830004
028400     05  FILLER                      PIC  X(08)    VALUE SPACE.   02840004
028500     05  DL1-SALES-DATE              PIC  X(10)    VALUE SPACE.   02850004
028600     05  FILLER                      PIC  X(04)    VALUE SPACE.   02860004
028700     05  DL1-REGISTER                PIC  9(04)    VALUE ZERO.    02870004
028800     05  FILLER                      PIC  X(04)    VALUE SPACE.   02880004
028900     05  DL1-TRANSACTION             PIC  9(04)    VALUE ZERO.    02890004
029000     05  FILLER                      PIC  X(04)    VALUE SPACE.   02900004
029100     05  DL1-ASSOC-ID                PIC  X(08)    VALUE SPACE.   02910004
029200     05  FILLER                      PIC  X(02)    VALUE SPACE.   02920004
029300     05  DL1-AUTH-NBR                PIC  X(06)    VALUE SPACE.   02930004
029400     05  FILLER                      PIC  X(04)    VALUE SPACE.   02940004
029500     05  DL1-NOVUS-NBR.                                           02950004
029600         10  DL1-NOVUS-NBR-FIRST-4   PIC  X(04)    VALUE SPACE.   02960004
029700         10  FILLER                  PIC  X(01)    VALUE '-'.     02970004
029800         10  DL1-NOVUS-NBR-SECOND-4  PIC  X(04)    VALUE SPACE.   02980004
029900         10  FILLER                  PIC  X(01)    VALUE '-'.     02990004
030000         10  DL1-NOVUS-NBR-THIRD-4   PIC  X(04)    VALUE SPACE.   03000004
030100         10  FILLER                  PIC  X(01)    VALUE '-'.     03010004
030200         10  DL1-NOVUS-NBR-LAST-4    PIC  X(04)    VALUE SPACE.   03020004
030300     05  FILLER                      PIC  X(07)    VALUE SPACE.   03030004
030400     05  DL1-CODE                    PIC  X(01)    VALUE SPACE.   03040004
030500     05  FILLER                      PIC  X(06)    VALUE SPACE.   03050004
030600     05  DL1-SALES-AMOUNT            PIC  X(10)    VALUE SPACE.   03060004
030700     05  FILLER                      PIC  X(03)    VALUE SPACE.   03070004
030800     05  DL1-RETURN-AMOUNT           PIC  X(10)    VALUE SPACE.   03080004
030900     05  FILLER                      PIC  X(18)    VALUE SPACE.   03090004
031000                                                                  03100004
031100 EJECT                                                            03110004
031200******************************************************************03120004
031300*  TOTAL LINE PRINTED AT THE END OF THE REPORT                    03130004
031400******************************************************************03140004
031500 01 TL1-TOTAL-LINE-1.                                             03150004
031600    05  FILLER                       PIC X(01) VALUE SPACE.       03160004
031700    05  FILLER                       PIC X(08) VALUE              03170004
031800                                         'COMPANY '.              03180004
031900    05  FILLER                       PIC X(10) VALUE              03190004
032000                                         'TOTAL FOR '.            03200004
032100    05  FILLER                       PIC X(04) VALUE              03210004
032200                                         'ALL '.                  03220004
032300    05  FILLER                       PIC X(12) VALUE              03230004
032400                                         'CORRECTIONS '.          03240004
032500    05  FILLER                       PIC X(11) VALUE              03250004
032600                                         'ENTERED ON '.           03260004
032700    05  TL1-DATE                     PIC X(10) VALUE SPACE.       03270004
032800    05  FILLER                       PIC X(34) VALUE SPACE.       03280004
032900    05  TL1-SALES-AMOUNT             PIC ZZZ,ZZ9.99-.             03290004
033000    05  FILLER                       PIC X(02) VALUE SPACE.       03300004
033100    05  TL1-RETURN-AMOUNT            PIC ZZZ,ZZ9.99-.             03310004
033200    05  FILLER                       PIC X(03) VALUE SPACE.       03320004
033300    05  TL1-NET-AMOUNT               PIC ZZZ,ZZ9.99-.             03330004
033400    05  FILLER                       PIC X(04) VALUE SPACE.       03340004
033500                                                                  03350004
033600******************************************************************03360004
033700*  WS FIELDS FOR SQLCA MESSAGE ROUTINE                            03370004
033800******************************************************************03380004
033900     COPY DPWS004.                                                03390004
034000 EJECT                                                            03400004
034100******************************************************************03410004
034200*  DB2 COMMUNICATION AREA.                                        03420004
034300******************************************************************03430004
034400     EXEC SQL                                                     03440004
034500          INCLUDE SQLCA                                           03450004
034600     END-EXEC.                                                    03460004
034700 EJECT                                                            03470004
034800******************************************************************03480004
034900*  DB2 TABLE TEPPART - PARTITION TABLE                            03490004
035000******************************************************************03500004
035100     EXEC SQL                                                     03510004
035200          INCLUDE TEPPART                                         03520004
035300     END-EXEC.                                                    03530004
035400 EJECT                                                            03540004
035500******************************************************************03550004
035600*  DB2 TABLE TEPTRN - TRANSACTION TABLE                           03560004
035700******************************************************************03570004
035800     EXEC SQL                                                     03580004
035900          INCLUDE TEPTRN                                          03590004
036000     END-EXEC.                                                    03600004
036100 EJECT                                                            03610004
036200******************************************************************03620004
036300*  DB2 TABLE TEPTND - TENDER TABLE                                03630004
036400******************************************************************03640004
036500     EXEC SQL                                                     03650004
036600          INCLUDE TEPTND                                          03660004
036700     END-EXEC.                                                    03670004
036800 EJECT                                                            03680004
036900******************************************************************03690004
037000*  DB2 TABLE TEPCRD - CREDIT TENDER TABLE                         03700004
037100******************************************************************03710004
037200     EXEC SQL                                                     03720004
037300          INCLUDE TEPCRD                                          03730004
037400     END-EXEC.                                                    03740004
037500 EJECT                                                            03750004
037600******************************************************************03760004
037700*  DB2 TABLE TEPDKEY - CURRENT PROCESSING DAY KEYS                03770004
037800******************************************************************03780004
037900     EXEC SQL                                                     03790004
038000          INCLUDE TEPDKEY                                         03800004
038100     END-EXEC.                                                    03810004
038200 EJECT                                                            03820004
038300******************************************************************03830004
038400*  DB2 TABLE TEPSAT - SALES AUDIT USER ID TABLE                   03840004
038500******************************************************************03850004
038600     EXEC SQL                                                     03860004
038700          INCLUDE TEPSAT                                          03870004
038800     END-EXEC.                                                    03880004
038900 EJECT                                                            03890004
039000******************************************************************03900004
039100*  DB2 TABLE XST_LOC_ATTR - STORE LOCATION ATTRIBUTE TABLE        03910004
039200******************************************************************03920004
039300*    EXEC SQL                                                     03930004
039400*         INCLUDE XST00025                                        03940004
039500*    END-EXEC.                                                    03950004
039600*EJECT                                                            03960004
039700******************************************************************03970004
039800*  CURSOR TO RETRIEVE NOVUS CORRECTION DATA                       03980004
039900******************************************************************03990004
040000     EXEC SQL                                                     04000004
040100       DECLARE NOVUS-CURSOR CURSOR FOR                            04010004
040200            SELECT  T.PARTN_NBR                                   04020004
040300                   ,T.STR_NBR                                     04030004
040400                   ,T.RGST_ID                                     04040004
040500                   ,T.TRN_NBR                                     04050004
040600                   ,T.STRT_TM                                     04060004
040700                   ,T.SLS_CORR_SEQ_NBR                            04070004
040800                   ,TRN_STAT_CDE                                  04080004
040900                   ,T.SLS_DTE                                     04090004
041000                   ,ASSOC_ID                                      04100004
041100                   ,TNDR_ID                                       04110004
041200                   ,TNDR_AMT                                      04120004
041300                   ,AUTH_NBR                                      04130004
041400            FROM    TEPDKEY D                                     04140004
041500                   ,TEPTRN T                                      04150004
041600                   ,TEPTND N                                      04160004
041700                   ,TEPCRD C                                      04170004
041800                   ,TEPPART A                                     04180004
041900            WHERE   D.PRCG_DTE         = :EPDKEY-PRCG-DTE         04190004
042000              AND   D.SLS_DTE          = A.SLS_DTE                04200004
042100              AND   A.PARTN_NBR        = T.PARTN_NBR              04210004
042200              AND   D.STR_NBR          = T.STR_NBR                04220004
042300              AND   D.RGST_ID          = T.RGST_ID                04230004
042400              AND   D.TRN_NBR          = T.TRN_NBR                04240004
042500              AND   D.STRT_TM          = T.STRT_TM                04250004
042600              AND   D.SLS_CORR_SEQ_NBR = T.SLS_CORR_SEQ_NBR       04260004
042700              AND   T.PARTN_NBR        = N.PARTN_NBR              04270004
042800              AND   T.STR_NBR          = N.STR_NBR                04280004
042900              AND   T.RGST_ID          = N.RGST_ID                04290004
043000              AND   T.TRN_NBR          = N.TRN_NBR                04300004
043100              AND   T.STRT_TM          = N.STRT_TM                04310004
043200              AND   T.SLS_CORR_SEQ_NBR = N.SLS_CORR_SEQ_NBR       04320004
043300              AND   N.PARTN_NBR        = C.PARTN_NBR              04330004
043400              AND   N.STR_NBR          = C.STR_NBR                04340004
043500              AND   N.RGST_ID          = C.RGST_ID                04350004
043600              AND   N.TRN_NBR          = C.TRN_NBR                04360004
043700              AND   N.STRT_TM          = C.STRT_TM                04370004
043800              AND   N.SLS_CORR_SEQ_NBR = C.SLS_CORR_SEQ_NBR       04380004
043900              AND   N.TNDR_SEQ_NBR     = C.TNDR_SEQ_NBR           04390004
044000              AND   D.SLS_CORR_SEQ_NBR <> 0                       04400004
044100              AND   VOID_ABRT_CDE      = 'N'                      04410004
044200              AND   TRN_STAT_CDE       IN ('V', 'R', 'L', 'Z')    04420004
044300              AND   TNDR_TYP_CDE       = :PC-DISCOVER-TENDER-TYPE 04430004
044400              AND   TNDR_VOID_IND      = 'N'                      04440004
044500              AND   STTLMNT_PRCD_CDE   = 'P'                      04450004
044600           ORDER BY T.STR_NBR                                     04460004
044700                   ,T.SLS_DTE                                     04470004
044800                   ,T.RGST_ID                                     04480004
044900                   ,T.TRN_NBR                                     04490004
045000           WITH UR                                                04500004
045100     END-EXEC.                                                    04510004
045200                                                                  04520004
045300***************************************************************** 04530004
045400* PROCEDURE DIVISION.                                           * 04540004
045500***************************************************************** 04550004
045600 PROCEDURE DIVISION.                                              04560004
045700                                                                  04570004
045800******************************************************************04580004
045900* 0000-MAINLINE-PARAGRAPH                                         04590004
046000*      PRODUCE NOVUS CORRECTIONS REPORT                           04600004
046100******************************************************************04610004
046200 0000-MAINLINE-PARAGRAPH.                                         04620004
046300                                                                  04630004
046400     PERFORM 1000-INITIALIZE-PROGRAM.                             04640004
046500                                                                  04650004
046600     PERFORM 2000-PRODUCE-REPORT-LINES                            04660004
046700         UNTIL PS-END-OF-CURSOR.                                  04670004
046800                                                                  04680004
046900     IF PV-CURSOR-CNT           GREATER THAN ZERO                 04690004
047000         PERFORM 5200-PRINT-STORE-TOTAL-LINE                      04700004
047100     END-IF.                                                      04710004
047200                                                                  04720004
047300     PERFORM 4000-PRINT-REPORT-TOTALS.                            04730004
047400                                                                  04740004
047500     DISPLAY '****************************************'           04750004
047600     DISPLAY '*************** SAKRP018 ***************'           04760004
047700     DISPLAY '****************************************'           04770004
047800     MOVE PV-CURSOR-CNT          TO PV-EDIT-MASK                  04780004
047900     INSPECT PV-EDIT-MASK REPLACING LEADING SPACE BY '.'          04790004
048000     DISPLAY 'CORRECTION ROWS FETCHED........'                    04800004
048100         PV-EDIT-MASK                                             04810004
048200     DISPLAY '****************************************'           04820004
048300     DISPLAY '****************************************'           04830004
048400     DISPLAY '****************************************'           04840004
048500                                                                  04850004
048600     STOP RUN.                                                    04860004
048700                                                                  04870004
048800 EJECT                                                            04880004
048900                                                                  04890004
049000******************************************************************04900004
049100* 1000-INITIALIZE-PROGRAM                                         04910004
049200*     OPEN FILES, PROCESS CONTROL CARD, FORMAT REPORT HEADINGS,   04920004
049300*     OPEN NOVUS-CUROSR, ATTEMPT FIRST FETCH OF CURSOR            04930004
049400******************************************************************04940004
049500 1000-INITIALIZE-PROGRAM.                                         04950004
049600                                                                  04960004
049700     OPEN INPUT  POS-DATE-CARD-FILE                               04970004
049800          OUTPUT NOVUS-REPORT-FILE.                               04980004
049900                                                                  04990004
050000     PERFORM 1100-PROCESS-CONTROL-CARD.                           05000004
050100                                                                  05010004
050200     PERFORM 1200-FORMAT-HEADINGS.                                05020004
050300                                                                  05030004
050400     PERFORM 1300-PREPARE-FOR-REPORT.                             05040004
050500                                                                  05050004
050600******************************************************************05060004
050700* 1100-PROCESS-CONTROL-CARD                                       05070004
050800*     READ CONTROL CARD TO GET POS DATE IN MMDDYY FORMAT.  CALL   05080004
050900*     DATE ROUTINE TO CONVERT DATE TO A CCYY-MM-DD PROCESS DATE.  05090004
051000******************************************************************05100004
051100 1100-PROCESS-CONTROL-CARD.                                       05110004
051200                                                                  05120004
051300     PERFORM 1110-READ-POS-DATE-CARD-FILE.                        05130004
051400     CLOSE POS-DATE-CARD-FILE.                                    05140004
051500     IF PS-END-OF-CARD-FILE                                       05150004
051600         MOVE '1100-PROCESS-CONTROL-CARD'  TO PV-PARAGRAPH-NAME   05160004
051700         MOVE 'NO CONTROL CARD TO PROCESS' TO PV-OPERATION-MSG-1  05170004
051800         SET AC-CONTROL-CARD-ERROR TO TRUE                        05180004
051900         PERFORM 9999-ABEND                                       05190004
052000     END-IF.                                                      05200004
052100     DISPLAY PC-CURRENT-PROGRAM-NAME                              05210004
052200             ' - CONTROL CARD = (' CC-CONTROL-CARD-DISPLAY  ')'.  05220004
052300     PERFORM 1115-CONVERT-INPUT-DATE.                             05230004
052400 EJECT                                                            05240004
052500                                                                  05250004
052600******************************************************************05260004
052700* 1110-READ-POS-DATE-CARD-FILE                                    05270004
052800*     READ DATE CONTROL CARD.                                     05280004
052900******************************************************************05290004
053000 1110-READ-POS-DATE-CARD-FILE.                                    05300004
053100     READ POS-DATE-CARD-FILE INTO CC-CONTROL-CARD                 05310004
053200        AT END                                                    05320004
053300           SET PS-END-OF-CARD-FILE TO TRUE.                       05330004
053400                                                                  05340004
053500******************************************************************05350004
053600* 1115-CONVERT-INPUT-DATE                                         05360004
053700*     CALL KOHLS CALENDAR ROUTINE:                                05370004
053800*         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            05380004
053900*       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 05390004
054000******************************************************************05400004
054100                                                                  05410004
054200 1115-CONVERT-INPUT-DATE.                                         05420004
054300                                                                  05430004
054400     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              05440004
054500                                                                  05450004
054600     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   05460004
054700     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   05470004
054800     SET  DPG52-LK-DTE-GREG            TO TRUE.                   05480004
054900     MOVE CC-POS-DATE-MMDDYY           TO DPG52-LK-DATE-INPUT.    05490004
055000     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    05500004
055100                                             DPG54 DPG55 DPG56.   05510004
055200     EVALUATE TRUE                                                05520004
055300         WHEN DPG54-SEVERE-ERROR                                  05530004
055400         WHEN DPG54-DATE-INVALID                                  05540004
055500             MOVE '1115-CONVERT-INPUT-DATE'                       05550004
055600                                   TO PV-PARAGRAPH-NAME           05560004
055700             MOVE 'ERROR CONVERTING INPUT CARD DATE'              05570004
055800                                   TO PV-OPERATION-MSG-1          05580004
055900             SET AC-CALENDAR-ROUTINE-ERROR                        05590004
056000                                   TO TRUE                        05600004
056100             MOVE DPG54-ERROR-MESSAGE                             05610004
056200                                   TO PV-OPERATION-MSG-2          05620004
056300             PERFORM 9999-ABEND                                   05630004
056400     END-EVALUATE.                                                05640004
056500                                                                  05650004
056600     MOVE DPG55-DB2-ISO-DATE-FMT   TO PV-POS-CCYY-MM-DD           05660004
056700                                      EPDKEY-PRCG-DTE.            05670004
056800     MOVE DPG55-GREG-CC-DATE-FMT   TO PV-POS-DATE-FORMATTED.      05680004
056900 EJECT                                                            05690004
057000******************************************************************05700004
057100* 1200-FORMAT-HEADINGS                                            05710004
057200*     GET CURRENT DATE AND TIME FROM SYSTEM.                      05720004
057300*     FORMAT REPORT FIELDS IN THE TOP PAGE HEADING LINE.          05730004
057400*     FORMAT HEADING LINE 2 WITH CONVERTED POS DATE.              05740004
057500******************************************************************05750004
057600 1200-FORMAT-HEADINGS.                                            05760004
057700                                                                  05770004
057800     MOVE FUNCTION CURRENT-DATE (1:8)                             05780004
057900                                   TO PV-CURR-DATE-CCYYMMDD.      05790004
058000     ACCEPT PV-CURR-TIME FROM TIME.                               05800004
058100                                                                  05810004
058200     MOVE PV-CURR-DATE-MM          TO DP132-RUN-MONTH.            05820004
058300     MOVE PV-CURR-DATE-DD          TO DP132-RUN-DAY.              05830004
058400     MOVE PV-CURR-DATE-CCYY        TO DP132-RUN-YEAR.             05840004
058500                                                                  05850004
058600     MOVE PV-CURR-TIME-HH          TO DP132-RUN-HOUR.             05860004
058700     MOVE PV-CURR-TIME-MM          TO DP132-RUN-MINUTE.           05870004
058800     MOVE PC-CURRENT-PROGRAM-NAME  TO DP132-PROGRAM-NAME.         05880004
058900     MOVE PC-REPORT-NBR-1          TO DP132-REPORT-NUMBER.        05890004
059000                                                                  05900004
059100     MOVE PV-POS-DATE-FORMATTED    TO HL2-DATE.                   05910004
059200 EJECT                                                            05920004
059300                                                                  05930004
059400******************************************************************05940004
059500* 1300-PREPARE FOR REPORT                                         05950004
059600*     - OPEN THE CURSOR                                           05960004
059700*     - FETCH FIRST RECORD                                        05970004
059800*     - IF RECORD                                                 05980004
059900******************************************************************05990004
060000 1300-PREPARE-FOR-REPORT.                                         06000004
060100                                                                  06010004
060200     PERFORM 8000-PRINT-HEADINGS.                                 06020004
060300     PERFORM 2100-OPEN-NOVUS-CURSOR.                              06030004
060400     PERFORM 2200-FETCH-NOVUS-CURSOR.                             06040004
060500     IF PS-END-OF-CURSOR                                          06050004
060600         DISPLAY '*** NO DATA PRESENT FOR NOVUS CORRECTIONS ***'  06060004
060700                 '*** ON SALES DATE '                             06070004
060800     ELSE                                                         06080004
060900         PERFORM 2500-PROCESS-FIRST-RECORD                        06090004
061000     END-IF.                                                      06100004
061100                                                                  06110004
061200******************************************************************06120004
061300* 2000-PRODUCE-REPORT-LINES                                       06130004
061400*  PRODUCE THE ACTUAL REPORT LINES                                06140004
061500******************************************************************06150004
061600 2000-PRODUCE-REPORT-LINES.                                       06160004
061700                                                                  06170004
061800     IF EPTRN-STR-NBR              = PV-HOLD-STORE                06180004
061900         CONTINUE                                                 06190004
062000     ELSE                                                         06200004
062100         PERFORM 3000-STORE-BREAK                                 06210004
062200     END-IF.                                                      06220004
062300                                                                  06230004
062400     IF EPTRN-SLS-DTE              = PV-HOLD-SALES-DATE           06240004
062500         CONTINUE                                                 06250004
062600     ELSE                                                         06260004
062700         PERFORM 3500-SALES-DATE-BREAK                            06270004
062800     END-IF.                                                      06280004
062900                                                                  06290004
063000     PERFORM 5000-PRINT-DETAIL-LINE.                              06300004
063100     PERFORM 2200-FETCH-NOVUS-CURSOR.                             06310004
063200                                                                  06320004
063300******************************************************************06330004
063400* 2100-OPEN-NOVUS-CURSOR.                                         06340004
063500*     OPEN NOVUS CURSOR                                           06350004
063600******************************************************************06360004
063700 2100-OPEN-NOVUS-CURSOR.                                          06370004
063800                                                                  06380004
063900     EXEC SQL                                                     06390004
064000          OPEN NOVUS-CURSOR                                       06400004
064100     END-EXEC.                                                    06410004
064200                                                                  06420004
064300     EVALUATE TRUE                                                06430004
064400         WHEN SQLCODE = ZERO                                      06440004
064500              CONTINUE                                            06450004
064600         WHEN SQLWARN0 NOT EQUAL SPACE                            06460004
064700         WHEN SQLCODE NOT EQUAL ZERO                              06470004
064800             MOVE '2100-OPEN NOVUS CURSOR'                        06480004
064900                                   TO PV-PARAGRAPH-NAME           06490004
065000             MOVE 'ERROR ON OPEN OF NOVUS-CURSOR'                 06500004
065100                                   TO PV-DB2-OPERATION            06510004
065200             PERFORM 9100-SQL-ABEND                               06520004
065300     END-EVALUATE.                                                06530004
065400 EJECT                                                            06540004
065500******************************************************************06550004
065600* 2200-FETCH-SUMMARY-CURSOR                                       06560004
065700*   -FETCH ROWS THAT QUALIFY FOR THE REPORT                       06570004
065800******************************************************************06580004
065900 2200-FETCH-NOVUS-CURSOR.                                         06590004
066000                                                                  06600004
066100     EXEC SQL                                                     06610004
066200          FETCH NOVUS-CURSOR                                      06620004
066300           INTO :EPTRN-PARTN-NBR                                  06630004
066400               ,:EPTRN-STR-NBR                                    06640004
066500               ,:EPTRN-RGST-ID                                    06650004
066600               ,:EPTRN-TRN-NBR                                    06660004
066700               ,:EPTRN-STRT-TM                                    06670004
066800               ,:EPTRN-SLS-CORR-SEQ-NBR                           06680004
066900               ,:EPTRN-TRN-STAT-CDE                               06690004
067000               ,:EPTRN-SLS-DTE                                    06700004
067100               ,:EPTRN-ASSOC-ID                                   06710004
067200               ,:EPTND-TNDR-ID                                    06720004
067300               ,:EPTND-TNDR-AMT                                   06730004
067400               ,:EPCRD-AUTH-NBR                                   06740004
067500     END-EXEC.                                                    06750004
067600                                                                  06760004
067700     EVALUATE TRUE                                                06770004
067800         WHEN SQLCODE = ZERO                                      06780004
067900             ADD 1                 TO PV-CURSOR-CNT               06790004
068000         WHEN SQLCODE = PC-ROW-NOT-FOUND                          06800004
068100             SET PS-END-OF-CURSOR  TO TRUE                        06810004
068200         WHEN SQLWARN0 NOT EQUAL SPACE                            06820004
068300         WHEN SQLCODE NOT EQUAL ZERO                              06830004
068400             MOVE '2200-FETCH-NOVUS-CURSOR'                       06840004
068500                                   TO PV-PARAGRAPH-NAME           06850004
068600             MOVE 'ERROR ON FETCH OF SETTLEMENT-CURSOR'           06860004
068700                                   TO PV-DB2-OPERATION            06870004
068800             PERFORM 9100-SQL-ABEND                               06880004
068900     END-EVALUATE.                                                06890004
069000 EJECT                                                            06900004
069100******************************************************************06910004
069200* 2300-CLOSE-NOVUS-CURSOR                                         06920004
069300*   -CLOSE THE CURSOR                                             06930004
069400******************************************************************06940004
069500 2300-CLOSE-NOVUS-CURSOR.                                         06950004
069600                                                                  06960004
069700     EXEC SQL                                                     06970004
069800          CLOSE NOVUS-CURSOR                                      06980004
069900     END-EXEC.                                                    06990004
070000                                                                  07000004
070100     EVALUATE TRUE                                                07010004
070200         WHEN SQLCODE = ZERO                                      07020004
070300              CONTINUE                                            07030004
070400         WHEN SQLWARN0 NOT EQUAL SPACE                            07040004
070500         WHEN SQLCODE NOT EQUAL ZERO                              07050004
070600             MOVE '2300-CLOSE-NOVUS-CURSOR'                       07060004
070700                                   TO PV-PARAGRAPH-NAME           07070004
070800             MOVE 'ERROR ON CLOSE OF NOVUS-CURSOR'                07080004
070900                                   TO PV-DB2-OPERATION            07090004
071000             PERFORM 9100-SQL-ABEND                               07100004
071100     END-EVALUATE.                                                07110004
071200 EJECT                                                            07120004
071300                                                                  07130004
071400******************************************************************07140004
071500*  FIRST RECORD PROCESSING.  WRITE THE HEADER RECORDS AND MOVE    07150004
071600*  THE DATA INTO THE APPROPRIATE FIELDS.                          07160004
071700******************************************************************07170004
071800 2500-PROCESS-FIRST-RECORD.                                       07180004
071900                                                                  07190004
072000     MOVE EPTRN-STR-NBR            TO PV-HOLD-STORE.              07200004
072100     MOVE EPTRN-SLS-DTE            TO PV-HOLD-SALES-DATE.         07210004
072200*    PERFORM 3010-GET-MERCHANT-NUMBER.                            07220004
072300     PERFORM 5100-PRINT-STORE-MERCHANT-LINE.                      07230004
072400     PERFORM 3510-FORMAT-SALES-DATE.                              07240004
072500                                                                  07250004
072600******************************************************************07260004
072700*  PRINT THE STORE TOTAL WHEN A BREAK ON THE STORE NUMBER OCCURS  07270004
072800******************************************************************07280004
072900 3000-STORE-BREAK.                                                07290004
073000                                                                  07300004
073100     PERFORM 5200-PRINT-STORE-TOTAL-LINE.                         07310004
073200*    PERFORM 3010-GET-MERCHANT-NUMBER.                            07320004
073300     PERFORM 5100-PRINT-STORE-MERCHANT-LINE.                      07330004
073400                                                                  07340004
073500*** THE SALES DATE SHOULD ALWAYS BE PRINTED UNDER THE NEW STORE   07350004
073600*** INFORMATION.  THIS CHECKS TO SEE IF WE HAVE A DIFFERENT SALES 07360004
073700*** DATE WITH THE NEW STORE.                                      07370004
073800                                                                  07380004
073900     IF EPTRN-SLS-DTE              = PV-HOLD-SALES-DATE           07390004
074000         CONTINUE                                                 07400004
074100     ELSE                                                         07410004
074200         MOVE EPTRN-SLS-DTE        TO PV-HOLD-SALES-DATE          07420004
074300         PERFORM 3510-FORMAT-SALES-DATE                           07430004
074400     END-IF.                                                      07440004
074500                                                                  07450004
074600     MOVE ZERO TO                  PA-STORE-SALES-AMOUNT          07460004
074700                                   PA-STORE-RETURN-AMOUNT.        07470004
074800     MOVE EPTRN-STR-NBR            TO PV-HOLD-STORE.              07480004
074900                                                                  07490004
075000***************************************************************** 07500004
075100*  GET THE MERCHANT NUMBER FOR THE STORE                          07510004
075200***************************************************************** 07520004
075300*3010-GET-MERCHANT-NUMBER.                                        07530004
075400*                                                                 07540004
075500*    EXEC SQL                                                     07550004
075600*        SELECT  DSCVR_MERCH_NBR                                  07560004
075700*        INTO    :XST00025-DSCVR-MERCH-NBR                        07570004
075800*        FROM    XST_LOC_ATTR                                     07580004
075900*        WHERE   LOC_NBR = :EPTRN-STR-NBR                         07590004
076000*        WITH UR                                                  07600004
076100*    END-EXEC.                                                    07610004
076200*                                                                 07620004
076300*    EVALUATE TRUE                                                07630004
076400*        WHEN SQLCODE = ZERO                                      07640004
076500*            MOVE XST00025-DSCVR-MERCH-NBR                        07650004
076600*                                  TO PV-MERCH-NMBR               07660004
076700*        WHEN SQLWARN0 NOT EQUAL SPACE                            07670004
076800*        WHEN SQLCODE NOT EQUAL ZERO                              07680004
076900*            MOVE '3010-GET-MERCHANT-NUMBER'                      07690004
077000*                                  TO PV-PARAGRAPH-NAME           07700004
077100*            MOVE 'ERROR ON GETTING MERCHANT NUMBER'              07710004
077200*                                  TO PV-DB2-OPERATION            07720004
077300*            PERFORM 9100-SQL-ABEND                               07730004
077400*    END-EVALUATE.                                                07740004
077500*                                                                 07750004
077600***************************************************************** 07760004
077700*  PRINT THE REQUIRED DATA ON A BREAK IN SALES DATE               07770004
077800***************************************************************** 07780004
077900 3500-SALES-DATE-BREAK.                                           07790004
078000                                                                  07800004
078100     PERFORM 5200-PRINT-STORE-TOTAL-LINE.                         07810004
078200     MOVE ZERO                     TO PA-STORE-SALES-AMOUNT       07820004
078300                                      PA-STORE-RETURN-AMOUNT.     07830004
078400     MOVE EPTRN-SLS-DTE            TO PV-HOLD-SALES-DATE.         07840004
078500     PERFORM 3510-FORMAT-SALES-DATE.                              07850004
078600                                                                  07860004
078700****************************************************************  07870004
078800*  CALL CALENDAR ROUTINE TO CONVERT THE SALES DATE FROM DB2       07880004
078900*  FORMAT INTO GREGORIAN FORMATTED FORMAT                         07890004
079000****************************************************************  07900004
079100 3510-FORMAT-SALES-DATE.                                          07910004
079200                                                                  07920004
079300     INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              07930004
079400                                                                  07940004
079500     SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   07950004
079600     SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   07960004
079700     SET  DPG52-LK-DTE-ISO-FMT         TO TRUE.                   07970004
079800     MOVE EPTRN-SLS-DTE                TO DPG52-LK-DATE-INPUT.    07980004
079900     CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    07990004
080000                                             DPG54 DPG55 DPG56.   08000004
080100     EVALUATE TRUE                                                08010004
080200         WHEN DPG54-SEVERE-ERROR                                  08020004
080300         WHEN DPG54-DATE-INVALID                                  08030004
080400             MOVE '3510-FORMAT-SALES-DATEE'                       08040004
080500                                   TO PV-PARAGRAPH-NAME           08050004
080600             MOVE 'ERROR CONVERTING SALES DATE'                   08060004
080700                                   TO PV-OPERATION-MSG-1          08070004
080800             SET AC-CALENDAR-ROUTINE-ERROR TO TRUE                08080004
080900             MOVE DPG54-ERROR-MESSAGE                             08090004
081000                                   TO PV-OPERATION-MSG-2          08100004
081100             PERFORM 9999-ABEND                                   08110004
081200     END-EVALUATE.                                                08120004
081300     MOVE DPG55-GREG-CC-DATE-FMT   TO PV-SLS-DATE-FORMATTED.      08130004
081400                                                                  08140004
081500******************************************************************08150004
081600* 4000-PRINT-REPORT-TOTALS                                        08160004
081700*     PRINT REPORT TOTALS (IF DATA WAS PRESENT & REPORT CREATED), 08170004
081800*     CLOSE REPORT FILE.                                          08180004
081900******************************************************************08190004
082000 4000-PRINT-REPORT-TOTALS.                                        08200004
082100                                                                  08210004
082200     PERFORM 2300-CLOSE-NOVUS-CURSOR.                             08220004
082300     MOVE PV-POS-DATE-FORMATTED    TO TL1-DATE.                   08230004
082400     MOVE PA-COMPANY-SALES-AMOUNT                                 08240004
082500                                   TO TL1-SALES-AMOUNT.           08250004
082600     MOVE PA-COMPANY-RETURN-AMOUNT                                08260004
082700                                   TO TL1-RETURN-AMOUNT.          08270004
082800     COMPUTE PV-AMOUNT             = PA-COMPANY-RETURN-AMOUNT     08280004
082900                                   + PA-COMPANY-SALES-AMOUNT.     08290004
083000     MOVE PV-AMOUNT                TO TL1-NET-AMOUNT.             08300004
083100     MOVE +4                       TO PV-LINE-SPACING.            08310004
083200     MOVE TL1-TOTAL-LINE-1         TO PV-PRINT-RECORD.            08320004
083300     PERFORM 8200-WRITE-REPORT-LINE.                              08330004
083400     CLOSE NOVUS-REPORT-FILE.                                     08340004
083500 EJECT                                                            08350004
083600                                                                  08360004
083700******************************************************************08370004
083800* 5000-PRINT-DETAIL-LINE                                          08380004
083900*     FORMAT AND PRINT REPORT DETAIL LINE.                        08390004
084000******************************************************************08400004
084100 5000-PRINT-DETAIL-LINE.                                          08410004
084200                                                                  08420004
084300     IF PV-LINE-CNT             > PC-LINE-LIMIT                   08430004
084400         PERFORM 8000-PRINT-HEADINGS                              08440004
084500     END-IF.                                                      08450004
084600                                                                  08460004
084700     INITIALIZE                    DL1-SALES-AMOUNT               08470004
084800                                   DL1-RETURN-AMOUNT              08480004
084900                                   DL1-ASSOC-ID                   08490004
085000                                   DL1-CODE.                      08500004
085100     MOVE PV-SLS-DATE-FORMATTED    TO DL1-SALES-DATE.             08510004
085200     MOVE EPTRN-RGST-ID            TO DL1-REGISTER.               08520004
085300     MOVE EPTRN-TRN-NBR            TO DL1-TRANSACTION.            08530004
085400     MOVE ALL '*'                  TO DL1-NOVUS-NBR-FIRST-4.      08540008
085500     MOVE ALL '*'                  TO DL1-NOVUS-NBR-SECOND-4.     08550008
085600     MOVE ALL '*'                  TO DL1-NOVUS-NBR-THIRD-4.      08560008
085700     MOVE EPTND-TNDR-ID (13:4)     TO DL1-NOVUS-NBR-LAST-4.       08570004
085800     MOVE EPCRD-AUTH-NBR           TO DL1-AUTH-NBR.               08580004
085900                                                                  08590004
086000     EVALUATE TRUE                                                08600004
086100         WHEN EPTND-TNDR-AMT       > ZERO                         08610004
086200             MOVE EPTND-TNDR-AMT   TO PV-AMOUNT-FORMATTED         08620004
086300             MOVE PV-AMOUNT-FORMATTED                             08630004
086400                                   TO DL1-SALES-AMOUNT            08640004
086500             MOVE SPACE            TO DL1-RETURN-AMOUNT           08650004
086600             ADD EPTND-TNDR-AMT    TO PA-STORE-SALES-AMOUNT       08660004
086700                                                                  08670004
086800         WHEN EPTND-TNDR-AMT       < ZERO                         08680004
086900             MOVE EPTND-TNDR-AMT   TO PV-AMOUNT-FORMATTED         08690004
087000             MOVE PV-AMOUNT-FORMATTED                             08700004
087100                                   TO DL1-RETURN-AMOUNT           08710004
087200             MOVE SPACE            TO DL1-SALES-AMOUNT            08720004
087300             ADD EPTND-TNDR-AMT    TO PA-STORE-RETURN-AMOUNT      08730004
087400                                                                  08740004
087500         WHEN OTHER                                               08750004
087600             MOVE ZERO             TO PV-AMOUNT-FORMATTED         08760004
087700             MOVE PV-AMOUNT-FORMATTED                             08770004
087800                                   TO DL1-RETURN-AMOUNT           08780004
087900                                      DL1-SALES-AMOUNT            08790004
088000     END-EVALUATE.                                                08800004
088100                                                                  08810004
088200**** A LATE TRANSACTION, INDICATED BY A -1 SEQUENCE NUMBER, WILL N08820004
088300**** HAVE A SALES AUDIT USER ID.  A REGULAR CORRECTION WILL HVAE A08830004
088400**** SALES AUDIT USER ID.                                         08840004
088500                                                                  08850004
088600     IF EPTRN-SLS-CORR-SEQ-NBR     < ZERO                         08860004
088700         MOVE PC-SYSTEM-CORRECTION TO DL1-CODE                    08870004
088800     ELSE                                                         08880004
088900         IF EPTRN-TRN-STAT-CDE     = PC-REVERSAL-CORRECTION       08890004
089000             MOVE PC-REVERSAL-CORRECTION                          08900004
089100                                   TO DL1-CODE                    08910004
089200         END-IF                                                   08920004
089300         PERFORM 5010-SELECT-SLS-AUD-USER-ID                      08930004
089400     END-IF.                                                      08940004
089500                                                                  08950004
089600     MOVE DL1-DETAIL-LINE-1        TO PV-PRINT-RECORD.            08960004
089700                                                                  08970004
089800**** FOLLOWING CODE CHECKS IF THE LAST LINE PRINTED WAS SINGLE    08980004
089900**** SPACED (LIKE A DETAIL LINE) OR GREATER THAN SINGLE SPACED    08990004
090000**** (LIKE A HEADING LINE).  IF LAST LINE WAS NOT SINGLE SPACED,  09000004
090100**** PRINT THE DETAIL LINE DOUBLE SPACED.                         09010004
090200                                                                  09020004
090300     IF PV-LINE-SPACING            > +1                           09030004
090400         MOVE +2                   TO  PV-LINE-SPACING            09040004
090500     ELSE                                                         09050004
090600         MOVE +1                   TO  PV-LINE-SPACING            09060004
090700     END-IF.                                                      09070004
090800     PERFORM 8200-WRITE-REPORT-LINE.                              09080004
090900     MOVE +1                       TO  PV-LINE-SPACING.           09090004
091000 EJECT                                                            09100004
091100                                                                  09110004
091200***************************************************************** 09120004
091300* 5010-SELECT-SLS-AUD-USER-ID                                     09130004
091400*   - SELECT THE SALES AUDIT USER ID WHEN THE SALES CORRECTION    09140004
091500*     CORRECTION SEQUNCE NUMBER IS GREATER THAN ZERO              09150004
091600***************************************************************** 09160004
091700 5010-SELECT-SLS-AUD-USER-ID.                                     09170004
091800                                                                  09180004
091900     EXEC SQL                                                     09190004
092000         SELECT SLS_AUD_USR_ID                                    09200004
092100           INTO :EPSAT-SLS-AUD-USR-ID                             09210004
092200           FROM TEPSAT                                            09220004
092300          WHERE PARTN_NBR          = :EPTRN-PARTN-NBR             09230004
092400            AND STR_NBR            = :EPTRN-STR-NBR               09240004
092500            AND RGST_ID            = :EPTRN-RGST-ID               09250004
092600            AND TRN_NBR            = :EPTRN-TRN-NBR               09260004
092700            AND STRT_TM            = :EPTRN-STRT-TM               09270004
092800            AND SLS_CORR_SEQ_NBR   = :EPTRN-SLS-CORR-SEQ-NBR      09280004
092900         WITH UR                                                  09290004
093000     END-EXEC.                                                    09300004
093100                                                                  09310004
093200     EVALUATE TRUE                                                09320004
093300         WHEN SQLCODE = ZERO                                      09330004
093400             MOVE EPSAT-SLS-AUD-USR-ID                            09340004
093500                                   TO DL1-ASSOC-ID                09350004
093600         WHEN SQLCODE = PC-ROW-NOT-FOUND                          09360004
093700             MOVE 'UNKNOWN'        TO DL1-ASSOC-ID                09370004
093800         WHEN SQLWARN0 NOT EQUAL SPACE                            09380004
093900         WHEN SQLCODE NOT EQUAL ZERO                              09390004
094000             MOVE '5010-SELECT-SLS-AUD-USER-ID'                   09400004
094100                                   TO PV-PARAGRAPH-NAME           09410004
094200             MOVE 'ERROR ON SELECTING SLS AUD USER ID'            09420004
094300                                   TO PV-DB2-OPERATION            09430004
094400             PERFORM 9100-SQL-ABEND                               09440004
094500     END-EVALUATE.                                                09450004
094600                                                                  09460004
094700***************************************************************** 09470004
094800*  PRINT THE LINE CONTAINING THE STORE ANDMERCHANT NUMBER         09480004
094900***************************************************************** 09490004
095000 5100-PRINT-STORE-MERCHANT-LINE.                                  09500004
095100                                                                  09510004
095200**** FOLLOWING CODE CHECKS FOR ENOUGH ROOM ON THE PAGE TO         09520004
095300**** PRINT THE STORE / MERCHANT LINE, SALES DATE LINE,            09530004
095400**** AND AT LEAST ONE DETAIL LINE.                                09540004
095500                                                                  09550004
095600     MOVE PV-LINE-CNT              TO  PV-LINE-CNT-AHEAD.         09560004
095700     ADD +8                        TO  PV-LINE-CNT-AHEAD.         09570004
095800     IF PV-LINE-CNT-AHEAD          > PC-LINE-LIMIT                09580004
095900         PERFORM 8000-PRINT-HEADINGS                              09590004
096000     END-IF.                                                      09600004
096100                                                                  09610004
096200     MOVE EPTRN-STR-NBR            TO HL3-STORE.                  09620004
096300*    MOVE PV-MERCH-NMBR            TO HL3-MERCHANT.               09630004
096400     MOVE +4                       TO PV-LINE-SPACING.            09640004
096500     MOVE HL3-HEADING-LINE-3       TO PV-PRINT-RECORD.            09650004
096600     PERFORM 8200-WRITE-REPORT-LINE.                              09660004
096700                                                                  09670004
096800******************************************************************09680004
096900*  PRINT THE STORE TOTAL LINE INFORMATION                         09690004
097000******************************************************************09700004
097100 5200-PRINT-STORE-TOTAL-LINE.                                     09710004
097200                                                                  09720004
097300     IF PV-LINE-CNT                > PC-LINE-LIMIT                09730004
097400         PERFORM 8000-PRINT-HEADINGS                              09740004
097500     END-IF.                                                      09750004
097600                                                                  09760004
097700     MOVE PV-HOLD-STORE            TO HL6-STORE.                  09770004
097800     MOVE PV-SLS-DATE-FORMATTED    TO HL6-DATE.                   09780004
097900                                                                  09790004
098000     IF PA-STORE-SALES-AMOUNT      > ZERO                         09800004
098100         MOVE PA-STORE-SALES-AMOUNT                               09810004
098200                                   TO PV-AMOUNT-FORMATTED         09820004
098300         MOVE PV-AMOUNT-FORMATTED  TO HL6-SALES-TOTAL             09830004
098400     ELSE                                                         09840004
098500         MOVE SPACE                TO HL6-SALES-TOTAL             09850004
098600     END-IF.                                                      09860004
098700                                                                  09870004
098800     ADD  PA-STORE-SALES-AMOUNT    TO PA-COMPANY-SALES-AMOUNT.    09880004
098900                                                                  09890004
099000     IF PA-STORE-RETURN-AMOUNT     < ZERO                         09900004
099100         MOVE PA-STORE-RETURN-AMOUNT                              09910004
099200                                   TO PV-AMOUNT-FORMATTED         09920004
099300         MOVE PV-AMOUNT-FORMATTED  TO HL6-RETURN-TOTAL            09930004
099400     ELSE                                                         09940004
099500         MOVE SPACE                TO HL6-RETURN-TOTAL            09950004
099600     END-IF.                                                      09960004
099700                                                                  09970004
099800     ADD PA-STORE-RETURN-AMOUNT    TO PA-COMPANY-RETURN-AMOUNT.   09980004
099900     COMPUTE PV-AMOUNT             = PA-STORE-RETURN-AMOUNT       09990004
100000                                   + PA-STORE-SALES-AMOUNT.       10000004
100100     MOVE PV-AMOUNT                TO PV-AMOUNT-FORMATTED.        10010004
100200     MOVE PV-AMOUNT-FORMATTED      TO HL6-NET-AMOUNT.             10020004
100300     MOVE +2                       TO PV-LINE-SPACING.            10030004
100400     MOVE HL6-HEADING-LINE-6       TO PV-PRINT-RECORD.            10040004
100500     PERFORM 8200-WRITE-REPORT-LINE.                              10050004
100600                                                                  10060004
100700******************************************************************10070004
100800* 8000-PRINT-HEADINGS                                             10080004
100900*     PRINT THE HEADINGS FOR THE REPORT.                          10090004
101000******************************************************************10100004
101100 8000-PRINT-HEADINGS.                                             10110004
101200                                                                  10120004
101300     ADD +1                        TO PV-PAGE-CNT.                10130004
101400     MOVE PV-PAGE-CNT TO DP132-PAGE-NUMBER.                       10140004
101500     MOVE DP132-STANDRD-HEADER-132-COLS                           10150004
101600                                   TO PV-PRINT-RECORD.            10160004
101700     PERFORM 8100-WRITE-RPT-TOP-OF-PAGE.                          10170004
101800                                                                  10180004
101900     MOVE HL2-HEADING-LINE-2       TO PV-PRINT-RECORD.            10190004
102000     MOVE +1                       TO PV-LINE-SPACING.            10200004
102100     PERFORM 8200-WRITE-REPORT-LINE.                              10210004
102200                                                                  10220004
102300     MOVE +2                       TO PV-LINE-SPACING.            10230004
102400     MOVE HL4-HEADING-LINE-4       TO PV-PRINT-RECORD.            10240004
102500     PERFORM 8200-WRITE-REPORT-LINE.                              10250004
102600                                                                  10260004
102700     MOVE +1                       TO PV-LINE-SPACING.            10270004
102800     MOVE HL5-HEADING-LINE-5       TO PV-PRINT-RECORD.            10280004
102900     PERFORM 8200-WRITE-REPORT-LINE.                              10290004
103000     MOVE +2                       TO PV-LINE-SPACING.            10300004
103100                                                                  10310004
103200 EJECT                                                            10320004
103300******************************************************************10330004
103400* 8100-WRITE-RPT-TOP-OF-PAGE                                      10340004
103500*     WRITE FIRST REPORT LINE AFTER PAGE BREAK.                   10350004
103600******************************************************************10360004
103700 8100-WRITE-RPT-TOP-OF-PAGE.                                      10370004
103800                                                                  10380004
103900     WRITE NOVUS-REPORT-RECORD                                    10390004
104000       FROM PV-PRINT-RECORD                                       10400004
104100         AFTER ADVANCING PAGE.                                    10410004
104200     MOVE +1                       TO PV-LINE-CNT.                10420004
104300 EJECT                                                            10430004
104400******************************************************************10440004
104500* 8200-WRITE-REPORT-LINE                                          10450004
104600*     WRITE REPORT LINE AFTER ADVANCING LINE SPACING.             10460004
104700******************************************************************10470004
104800 8200-WRITE-REPORT-LINE.                                          10480004
104900                                                                  10490004
105000                                                                  10500004
105100     WRITE NOVUS-REPORT-RECORD                                    10510004
105200       FROM PV-PRINT-RECORD                                       10520004
105300         AFTER ADVANCING PV-LINE-SPACING.                         10530004
105400                                                                  10540004
105500     ADD PV-LINE-SPACING TO PV-LINE-CNT.                          10550004
105600 EJECT                                                            10560004
105700******************************************************************10570004
105800* 9100-SQL-ABEND                                                  10580004
105900*     ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.10590004
106000******************************************************************10600004
106100 9100-SQL-ABEND.                                                  10610004
106200     DISPLAY '** ABEND     **'.                                   10620004
106300     DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        10630004
106400     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              10640004
106500     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               10650004
106600                                                                  10660004
106700******************************************************************10670004
106800* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     10680004
106900* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      10690004
107000******************************************************************10700004
107100     COPY DPPD004.                                                10710004
107200                                                                  10720004
107300     SET AC-DB2-ERROR TO TRUE.                                    10730004
107400     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         10740004
107500                                                                  10750004
107600******************************************************************10760004
107700* 9999-ABEND                                                      10770004
107800*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  10780004
107900******************************************************************10790004
108000 9999-ABEND.                                                      10800004
108100     DISPLAY '** ABEND           **'.                             10810004
108200     DISPLAY '** PROGRAM         ** = ' PC-CURRENT-PROGRAM-NAME.  10820004
108300     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        10830004
108400     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       10840004
108500     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       10850004
108600     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         10860004
