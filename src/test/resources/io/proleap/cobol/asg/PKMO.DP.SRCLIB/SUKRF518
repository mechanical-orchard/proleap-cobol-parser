000100******************************************************************00010018
000200 IDENTIFICATION DIVISION.                                         00020018
000300******************************************************************00030018
000400                                                                  00040018
000500 PROGRAM-ID.             SUKRF518.                                00050018
000600 AUTHOR.                 MICHAEL WALTERS.                         00060018
000700 INSTALLATION.           KOHLS.                                   00070018
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080018
000900 DATE-COMPILED.                                                   00090018
001000                                                                  00100018
001100******************************************************************00110018
001200* THIS IS THE UPC SCAN SCREEN.  IT WILL ALLOW THE USER TO SCAN    00120018
001300* IN THE UPC THAT IS TO BE AUDITED.                               00130018
001400******************************************************************00140018
RFAUDT* 10/08/13 - JIM ARENDT   - CHG0068598  TKID: TKMA357            *00150047
RFAUDT* - ADDED CODE TO ALLOW FOR TRANSFERRING TO NEW SCREEN SUKRF710  *00160028
RFAUDT*   WHEN PROCESSING AN RFID AUDIT.                               *00170025
001600******************************************************************00180018
001601* 02/14/23 - JEAN KURK    - CHG0281369                           *00181083
001602* - CHANGE CALL OF UPC CHECK DIGIT ROUTINE TO BE DYNAMIC         *00182084
001600******************************************************************00184083
001700 ENVIRONMENT DIVISION.                                            00190018
001800******************************************************************00200018
001900                                                                  00210018
002000******************************************************************00220018
002100 DATA DIVISION.                                                   00230018
002200******************************************************************00240018
002300                                                                  00250018
002400******************************************************************00260018
002500 WORKING-STORAGE SECTION.                                         00270018
002600******************************************************************00280018
002700 01  CA-COMMAREA.                                                 00290018
002800     COPY SUWS006.                                                00300018
002900    05  CA-PROGRAM-COMMAREA.                                      00310018
003000        10 CA-SCANNED-UPC                PIC X(15).               00320018
003100        10 CA-RETURN-MSG                 PIC X(19).               00330018
003200        10 CA-RETURN-ERROR-IND           PIC X(01) VALUE 'N'.     00340018
003300           88  CA-RETURN-ERROR                     VALUE 'Y'.     00350018
003400           88  CA-NO-RETURN-ERROR                  VALUE 'N'.     00360018
003500                                                                  00370018
003600 01  DK-DB2-KEYS.                                                 00380018
003700     05  DK-AUDIT-CNTL-NBR               PIC S9(09) COMP.         00390018
003800     05  DK-SHIP-UNIT-NBR                PIC S9(18) COMP-3.       00400018
003900     05  DK-SCN-TMST                     PIC  X(26).              00410018
004000*                                                                 00420018
004100 01  PC-PROGRAM-CONSTANTS.                                        00430018
004200     05  PC-CARTON-AUDIT-GROUP-CODE      PIC  X(03)  VALUE ' CA'. 00440018
004300     05  PC-MAX-RETRIES                 PIC S9(03)   VALUE 10     00450018
004400                                                     COMP-3.      00460018
004500     05  PC-NO-UPC-VILN-SEQ              PIC S9(04)  VALUE 0.     00470018
004600     05  PC-NO-BARCODE-SEQ               PIC S9(04)  VALUE 0.     00480018
004700     05  PC-DAMAGED-BARCODE-SEQ          PIC S9(04)  VALUE 0.     00490018
004800     05  PC-NO-TAG-SEQ                   PIC S9(04)  VALUE 0.     00500018
004900     05  PC-01                           PIC  X(02)  VALUE '01'.  00510018
005000     05  PC-INPROCESS                    PIC  X(02)  VALUE 'IP'.  00520018
005100     05  PC-COMPLETE                     PIC  X(02)  VALUE 'CM'.  00530018
005200     05  PC-POSTPONED                    PIC  X(02)  VALUE 'PP'.  00540018
005300     05  PC-E                            PIC  X(01)  VALUE 'E'.   00550018
RFAUDT** 12/05/13 JHA  BEG                                              00560064
RFAUDT     05  PC-O                            PIC  X(01)  VALUE 'O'.   00570043
RFAUDT     05  PC-S                            PIC  X(01)  VALUE 'S'.   00580043
RFAUDT** 12/05/13 JHA  END                                              00590064
005400     05  PC-STARTED-STATUS               PIC  X(18)  VALUE        00600018
005500         'IS ALREADY STARED '.                                    00610018
005600     05  PC-CLOSED-STATUS                PIC  X(18)  VALUE        00620018
005700         'IS ALREADY CLOSED '.                                    00630018
005800     05  PC-REPORT-PGM                   PIC  X(08)  VALUE        00640018
005900         'SUKRP002'.                                              00650018
006000     05  PC-CARTON-CLOSE-SCREEN          PIC  X(08)  VALUE        00660018
006100         'SUKRF515'.                                              00670018
006200     05  PC-PRTR-VALIDATION-PGM          PIC  X(08)  VALUE        00680018
006300         'DPKCS060'.                                              00690018
006400     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00700018
006500         'SUKRF518'.                                              00710018
006600     05  PC-UPC-INFO-SCREEN              PIC  X(08)  VALUE        00720018
006700         'SUKRF513'.                                              00730018
006800     05  PC-SKU-ENTER-SCREEN             PIC  X(08)  VALUE        00740018
006900         'SUKRF521'.                                              00750018
007000     05  PC-DATA-INFO-SCREEN             PIC  X(08)  VALUE        00760018
007100         'SUKRF519'.                                              00770018
RFAUDT* 10/08/13 JHA BEG                                                00780027
RFAUDT     05  PC-RFID-SKU-ENTRY-SCREEN        PIC  X(08)  VALUE        00790024
RFAUDT         'SUKRF710'.                                              00800028
RFAUDT* 10/08/13 JHA END                                                00810027
007200     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S518'.00820018
007300     05  PC-MAXIMUM-UPC-FIELD-LENGTH     PIC S9(4)    VALUE +15.  00830018
      ***INC1281249 START                                               00840081
           05  PC-MAXIMUM-UPC-E-DATA-DIGITS    PIC S9(4)    VALUE +7.   00841081
      ***INC1281249 END                                                 00842081
007500     05  PC-UPC-E-TO-UPC-A-MASK-1        PIC S9(4)    VALUE +1.   00850018
007600     05  PC-UPC-E-TO-UPC-A-MASK-2        PIC S9(4)    VALUE +2.   00860018
007700     05  PC-UPC-E-TO-UPC-A-MASK-3        PIC S9(4)    VALUE +3.   00870018
007800     05  PC-UPC-E-TO-UPC-A-MASK-4        PIC S9(4)    VALUE +4.   00880018
007900*                                                                 00890018
008000*    05  PC-F7-TKT-F8-CLS-KEY            PIC X(19)   VALUE        00900060
008100*                                        'F7-NO TKT F8-CLS PK'.   00910060
008000     05  PC-F8-CLS-KEY                   PIC X(19)   VALUE        00920057
008100                                         ' F8 - CLS PK       '.   00930063
008200*    05  PC-F7-NO-TICKET-KEY             PIC X(19)   VALUE        00940060
008300*                                        ' F7 - NO TICKET    '.   00950060
008400     05  PC-PREPACK-CLOSE-REQ-MSG        PIC  X(19)  VALUE        00960018
008500         'CLOSE PREPK TO CONT'.                                   00970018
008600     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE               00980018
008700                                           'TRANS NOT AVAILABLE'. 00990018
008800     05  PC-PREPACK-CLOSED-MSG           PIC  X(19)  VALUE        01000018
008900         'PREPACK CLOSED     '.                                   01010018
009000     05  PC-X                            PIC  X(01)  VALUE 'X'.   01020018
009100     05  PC-P                            PIC  X(01)  VALUE 'P'.   01030018
009200**PREPACK ERRORS                                                  01040018
009300     05  PC-MISSING-ITEM-IN-PACK         PIC  X(20)  VALUE        01050018
009400         'MISSING ITEM ERROR  '.                                  01060018
009500     05  PC-WRONG-ITEM-IN-PACK           PIC  X(20)  VALUE        01070018
009600         'WRONG ITEM ERROR    '.                                  01080018
009700     05  PC-SYSTEM-KEYED-QTY-MISMTCH     PIC  X(20)  VALUE        01090018
009800         'KEYED QTY MISMATCH  '.                                  01100018
009900     05  PC-WRONG-RATIO-IN-PACK          PIC  X(20)  VALUE        01110018
010000         'WRONG RATIO ERROR   '.                                  01120018
010100                                                                  01130018
010200                                                                  01140018
010300 01  PS-PROGRAM-SWITCHES.                                         01150018
010400     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   01160018
010500         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   01170018
010600         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   01180018
010700     05  PS-AUDIT-NBR-IND                PIC  X(01)  VALUE 'N'.   01190018
010800         88  PS-AUDIT-NBR-NOT-EXISTS                 VALUE 'N'.   01200018
010900         88  PS-AUDIT-NBR-EXISTS                     VALUE 'Y'.   01210018
011000     05  PS-FIRST-PREPK-FETCH-SW         PIC  X(01)  VALUE 'Y'.   01220018
011100         88  PS-FIRST-PREPK-FETCH                    VALUE 'Y'.   01230018
011200         88  PS-NOT-FIRST-PREPK-FETCH                VALUE 'N'.   01240018
011300     05  PS-PREPACK-ERROR-FOUND-SW       PIC  X(01)  VALUE 'N'.   01250018
011400         88  PS-PREPACK-ERROR-FOUND                  VALUE 'Y'.   01260018
011500         88  PS-NO-PREPACK-ERROR-FOUND               VALUE 'N'.   01270018
011600     05  PS-EO-PREPK-CSR-SW              PIC  X(01)  VALUE 'N'.   01280018
011700         88  PS-EO-PREPK-CSR                         VALUE 'Y'.   01290018
011800         88  PS-NOT-EO-PREPK-CSR                     VALUE 'N'.   01300018
011900     05  PS-EO-SUEXCP-CSR-SW             PIC  X(01)  VALUE 'N'.   01310018
012000         88  PS-EO-SUEXCP-CSR                        VALUE 'Y'.   01320018
012100         88  PS-NOT-EO-SUEXCP-CSR                    VALUE 'N'.   01330018
012200     05  PS-EO-PREPK-UPC-CSR-SW          PIC  X(01)  VALUE 'N'.   01340018
012300         88  PS-EO-PREPK-UPC-CSR                     VALUE 'Y'.   01350018
012400         88  PS-NOT-EO-PREPK-UPC-CSR                 VALUE 'N'.   01360018
012500                                                                  01370018
012600 01  PV-PROGRAM-VARIABLES.                                        01380018
012700     05  PV-DISP-AUDIT-CNTL-NBR          PIC  9(09).              01390018
012800     05  PV-DISP-SHIP-UNIT-NBR           PIC  9(18).              01400018
012900     05  PV-LEADING-0-COUNT              PIC S9(04)  VALUE ZERO   01410018
013000                                                     COMP.        01410179
      ***INC1281249 START                                               01411082
           05  PV-TRAILNG-0-COUNT              PIC S9(04)  VALUE ZERO   01411182
                                                           COMP.        01412082
      ***INC1281249 END                                                 01413082
013100     05  PV-UPC-LENGTH                   PIC S9(04)  VALUE ZERO   01430018
013200                                                     COMP.        01440018
      ***INC1281249 START                                               01450082
           05  PV-UPC-E                        PIC  9(07)  VALUE ZERO.  01450182
           05  PV-UPC-A                        PIC  9(12)  VALUE ZERO.  01451082
           05  PV-CHECK-DIGIT                  PIC  9(01)  VALUE ZERO.  01452082
      ***INC1281249 END                                                 01453082
013400     05  PV-RETRY-COUNTER                PIC S9(04)  VALUE ZERO   01460018
013500                                                     COMP SYNC.   01470018
013600     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   01480018
013700                                                     COMP.        01490018
013800     05  PV-CLOSED-DAYS                  PIC S9(04)  VALUE ZERO   01500018
013900                                                     COMP.        01510018
014000     05  PV-CLOSED-HOURS                 PIC S9(02)  VALUE ZERO   01520018
014100                                                     COMP.        01530018
014200     05  PV-CLOSED-MINUTES               PIC S9(02)  VALUE ZERO   01540018
014300                                                     COMP.        01550018
014400     05  PV-TOTAL-CLOSED-MINUTES         PIC S9(09)  VALUE ZERO   01560018
014500                                                     COMP.        01570018
014600     05  PV-EXP-QTY                      PIC S9(09)  VALUE ZERO   01580018
014700                                                     COMP.        01590018
014800     05  PV-EXP-QTY-SHRT                 PIC 9(04)   VALUE ZERO.  01600018
014900                                                                  01610018
015000     05  PV-SCN-QTY                      PIC S9(09)  VALUE ZERO   01620018
015100                                                     COMP.        01630018
015200*GB                                                               01640018
015300     05  PV-UNION-TYPE                   PIC  X(01).              01650018
015400     05  PV-PREPK-ID                     PIC  S9(4) COMP.         01660018
015500     05  PV-RATIO-AUD-QTY                PIC S9(09)  VALUE ZERO   01670018
015600                                                     COMP.        01680018
015700     05  PV-CRTN-PACK-QTY                PIC S9(09)  VALUE ZERO   01690018
015800                                                     COMP.        01700018
015900     05  PV-PREV-UNION-TYPE              PIC  X(01).              01710018
016000     05  PV-PREV-ITM-NBR                 PIC  S9(15)V COMP-3.     01720018
016100     05  PV-PREV-RATIO-AUD-QTY           PIC S9(09)  VALUE ZERO   01730018
016200                                                     COMP.        01740018
016300     05  PV-EXPND-NBR-ROWS               PIC S9(09)  VALUE ZERO   01750018
016400                                                     COMP.        01760018
016500     05  PV-SUAUPC-INSERT-COUNT          PIC S9(09) VALUE ZERO    01770018
016600                                                     COMP.        01780018
016700     05  PV-PREPACK-ERROR-MESSAGE        PIC  X(20) VALUE SPACES. 01790018
016800                                                                  01800018
016900*GB                                                               01810018
017000     05  PV-SCN-QTY-SHRT                 PIC 9(04)   VALUE ZERO.  01820018
017100     05  PV-SYSID                        PIC  X(04)  VALUE SPACE. 01830018
017200     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 01840018
017300     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  01850018
017400                                                     COMP SYNC.   01860018
017500     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 01870018
017600     05  PV-OPER-UNT-ID                  PIC S9(04)  VALUE ZEROS  01880018
017700                                                     COMP.        01890018
017800     05  PV-FCLTY-ID                     PIC S9(04)  VALUE ZEROS  01900018
017900                                                     COMP.        01910018
018000     05  PV-TS-ITEM                      PIC S9(04)  VALUE ZERO   01920018
018100                                                     COMP.        01930018
018200     05  PV-SIGN-ON-INFO-LENGTH          PIC S9(04)  VALUE ZERO   01940018
018300                                                     COMP SYNC.   01950018
018400     05  PV-DISPLAY-KEYS.                                         01960018
018500         10 FILLER                       PIC X(12)                01970018
018600            VALUE 'KEY VALUES: '.                                 01980018
018700         10 PV-DISP-AUD-CNTL-NBR         PIC 9(09).               01990018
018800         10 FILLER                       PIC X(04)                02000018
018900            VALUE ' -- '.                                         02010018
019000         10 PV-DISP-SHIPT-UNT-ID         PIC 9(18).               02020018
019100         10 FILLER                       PIC X(04)                02030018
019200            VALUE ' -- '.                                         02040018
019300         10 PV-DISP-UPC-NBR              PIC 9(15).               02050018
019400         10 FILLER                       PIC X(04)                02060018
019500            VALUE ' -- '.                                         02070018
019600         10 PV-DISP-SCN-TMST             PIC X(26).               02080018
026000*                                                                 02090040
RFAUDT 01  PV-DB2-NULL-INDICATORS.                                      02100040
RFAUDT     05  PV-SCN-QTY-NULL            PIC S9(04) COMP VALUE ZEROES. 02110040
RFAUDT     05  PV-EXP-QTY-NULL            PIC S9(04) COMP VALUE ZEROES. 02120040
019700*                                                                 02130018
019800*  WORKING STORAGE NEEDED TO CONVERT A COMPACTED UPC (UPC-E) TO   02140018
019900*  A "NORMAL" UPC (UPC-A) INCLUDING THE EXPANSION MASKS           02150018
020000 01  UW-UPC-WORK-AREA.                                            02160018
020100     05  UW-UPC-E-DATA-DIGITS    PIC X(6)     VALUE SPACES.       02170074
020200     05  UW-UPC-E-DATA-DIGIT     REDEFINES UW-UPC-E-DATA-DIGITS   02180074
020300                                 OCCURS 6 TIMES                   02190074
020400                                 INDEXED BY UW-UPC-E-INDEX        02200074
020500                                 PIC X(1).                        02210074
020600     05  FILLER                  REDEFINES UW-UPC-E-DATA-DIGITS.  02220074
020700         10  FILLER              PIC X(5).                        02230074
020800         10  UW-UPC-E-COMPRESSION-FORMAT                          02240018
020900                                 PIC X(1).                        02250018
021000             88  UW-UPC-E-COMPRESSION-FORMAT-1                    02260018
021100                                              VALUE '0', '1', '2'.02270018
021200             88  UW-UPC-E-COMPRESSION-FORMAT-2                    02280018
021300                                              VALUE '3'.          02290018
021400             88  UW-UPC-E-COMPRESSION-FORMAT-3                    02300018
021500                                              VALUE '4'.          02310018
021600             88  UW-UPC-E-COMPRESSION-FORMAT-4                    02320018
021700                                              VALUE '5', '6', '7',02330018
021800                                                    '8', '9'.     02340018
021900     05  UW-UPC-A                PIC 9(11)    VALUE ZERO.         02350079
022000     05  UW-UPC-A-DIGIT          REDEFINES UW-UPC-A               02360018
022100                                 OCCURS 11 TIMES                  02370079
022200                                 INDEXED BY UW-UPC-A-INDEX        02380018
022300                                 PIC 9(1).                        02390077
022400                                                                  02400018
022500*    EXPANSION MASKS:  THESE MASKS HAVE 6 NUMBERS REPRESENTING THE02410018
022600*    DIGITS OF A UPC-E NUMBER.  EACH NUMBER IN THE MASK REPRESENTS02420018
022700*    POSITION OF THE UPC-A IT IS SUPPOSED TO TAKE.  IE...THE FIRST02430018
022800*    '02 03 09 10 11 04 ' TELLS THE EXPANSION ROUTINE THE FOLLOING02440018
022900*                                                                 02450018
023000*     POS 1 OF UPC-E    GOES TO    POS 02 OF UPC-A                02460018
023100*     POS 2 OF UPC-E    GOES TO    POS 03 OF UPC-A                02470018
023200*     POS 3 OF UPC-E    GOES TO    POS 09 OF UPC-A                02480018
023300*     POS 4 OF UPC-E    GOES TO    POS 10 OF UPC-A                02490018
023400*     POS 5 OF UPC-E    GOES TO    POS 11 OF UPC-A                02500018
023500*     POS 6 OF UPC-E    GOES TO    POS 04 OF UPC-A                02510018
023600 01  UE-UPC-E-TO-UPC-A-MASK-AREA.                                 02520018
023700     05  UE-UPC-E-TO-UPC-A-MASK-DATA.                             02530018
023800         10  FILLER              PIC X(18)    VALUE               02540018
      ***INC1281249 START                                               02550082
                   '01 02 08 09 10 03 '.                                02551082
      ***INC1281249 END                                                 02552082
024000         10  FILLER              PIC X(18)    VALUE               02560018
      ***INC1281249 START                                               02570082
                   '01 02 03 09 10 00 '.                                02571082
      ***INC1281249 END                                                 02572082
024200         10  FILLER              PIC X(18)    VALUE               02580018
      ***INC1281249 START                                               02590082
                   '01 02 03 04 10 00 '.                                02591082
      ***INC1281249 END                                                 02592082
024400         10  FILLER              PIC X(18)    VALUE               02600018
      ***INC1281249 START                                               02610082
                   '01 02 03 04 05 10 '.                                02611082
      ***INC1281249 END                                                 02612082
024600     05  UE-UPC-E-TO-UPC-A-MASK-TABLE                             02620018
024700                                 REDEFINES                        02630018
024800                                     UE-UPC-E-TO-UPC-A-MASK-DATA. 02640018
024900         10  UE-UPC-E-TO-UPC-A-MASK-ENTRY                         02650018
025000                                 OCCURS 4 TIMES                   02660018
025100                                 INDEXED BY UE-MASK-INDEX.        02670018
025200             15  UE-UPC-E-DIGIT-LOCATION-ENTRY                    02680074
025300                                 OCCURS 6 TIMES                   02690073
025400                                 INDEXED BY UE-LOCATION-INDEX.    02700018
025500                 20  UE-UPC-E-DIGIT-LOC-IN-UPC-A                  02710018
025600                                 PIC 9(2).                        02720018
025700                     88  UE-UPC-E-DIGIT-NOT-IN-UPC-A              02730018
025800                                              VALUE 00.           02740018
025900                 20  FILLER      PIC X(1).                        02750018
026000                                                                  02760018
026100******************************************************************02770018
026200*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      02780018
026300******************************************************************02790018
026400     COPY DFHAID.                                                 02800018
026500                                                                  02810018
026600******************************************************************02820018
026700*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                02830018
026800******************************************************************02840018
026900     COPY DPWS013.                                                02850018
027000                                                                  02860018
027100******************************************************************02870018
027200*  SENDING/RECEIVING AREA FOR THE UPC CHECK DIGIT ROUTINE         02880018
027300******************************************************************02890018
027400     COPY DPWS040I.                                               02900018
027500                                                                  02910018
027600******************************************************************02920018
027700*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 02930018
027800*****************************************************************.02940018
027900     COPY DPWS010I.                                               02950018
028000                                                                  02960018
028100******************************************************************02970018
028200*  GENERATED DSECT FOR THE SUKM518 MAPSET                         02980018
028300******************************************************************02990018
028400     COPY SUKM518.                                                03000018
028500                                                                  03010018
028600******************************************************************03020018
028700*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   03030018
028800******************************************************************03040018
028900     COPY DPWS015.                                                03050018
029000                                                                  03060018
029100*----------------------------------------------------------------*03070018
029200* HELP SCREEN COMMAREA                                            03080018
029300     COPY PCWS192.                                                03090018
029400*----------------------------------------------------------------*03100018
029500* HELP SCREEN WORK AREA                                           03110018
029600     COPY PCWS188.                                                03120018
029700                                                                  03130018
029800******************************************************************03140018
029900*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      03150018
030000*  TO BE DISPLAYED ON THE LRT                                     03160018
030100******************************************************************03170018
030200     COPY SUWS005.                                                03180018
030300                                                                  03190018
030400******************************************************************03200018
030500*  COPYBOOK FOR UPC VALIDATION MODULE                             03210018
030600******************************************************************03220018
030700     COPY XLWS087.                                                03230018
030800                                                                  03240018
030900******************************************************************03250018
031000*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03260018
031100*  AUDIT CONTENT TABLE (TSUAUPC)                                  03270018
031200******************************************************************03280018
031300     EXEC SQL                                                     03290018
031400         INCLUDE TSUAUPC                                          03300018
031500     END-EXEC.                                                    03310018
031600                                                                  03320018
031700******************************************************************03330022
031800*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03340022
031900*  AUDIT TRANSATIONS(CARTONS) TABLE (1SUATRN)                     03350022
032000******************************************************************03360022
032100     EXEC SQL                                                     03370022
032200         INCLUDE TSUATRN                                          03380022
032300     END-EXEC.                                                    03390022
032400                                                                  03400022
032500******************************************************************03410018
032600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03420018
032700*  ITEM AUDIT EXCEPTION TABLE (TSUEXCP)                           03430018
032800******************************************************************03440018
032900     EXEC SQL                                                     03450018
033000         INCLUDE TSUEXCP                                          03460018
033100     END-EXEC.                                                    03470018
033200                                                                  03480018
033300******************************************************************03490018
033400*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      03500018
033500*  UPC ASSOICATION (TSHUUPC)                                      03510018
033600******************************************************************03520018
033700     EXEC SQL                                                     03530018
033800         INCLUDE TSHUUPC                                          03540018
033900     END-EXEC.                                                    03550018
034000                                                                  03560018
034100******************************************************************03570018
034200*  DCLGEN LAYOUT AND COBOL DECLARATION                            03580018
034300******************************************************************03590018
034400     EXEC SQL                                                     03600018
034500         INCLUDE TRECITM                                          03610018
034600     END-EXEC.                                                    03620018
034700                                                                  03630018
034800******************************************************************03640018
034900*  DCLGEN LAYOUT AND COBOL DECLARATION FOR XLV_UPC                03650018
035000******************************************************************03660018
035100     EXEC SQL                                                     03670018
035200         INCLUDE XLV00003                                         03680018
035300     END-EXEC.                                                    03690018
035400                                                                  03700018
035500******************************************************************03710018
035600*  DCLGEN LAYOUT AND COBOL DECLARATION FOR XLT_SKU                03720018
035700******************************************************************03730018
035800     EXEC SQL                                                     03740018
035900         INCLUDE XLT00003                                         03750018
036000     END-EXEC.                                                    03760018
036100                                                                  03770018
036200******************************************************************03780018
036300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR AUDIT CARTON EXCEPTION 03790018
036400******************************************************************03800018
036500     EXEC SQL                                                     03810018
036600         INCLUDE TCTEXCP                                          03820018
036700     END-EXEC.                                                    03830018
036800                                                                  03840018
036900******************************************************************03850018
037000*  COMMUNICATIONS AREA FOR DB2                                    03860018
037100******************************************************************03870018
037200     EXEC SQL                                                     03880018
037300         INCLUDE SQLCA                                            03890018
037400     END-EXEC.                                                    03900018
037500                                                                  03910018
037600*================================================================*03920018
037700* PREPACK CURSOR                                            *     03930018
037800*================================================================*03940018
037900     EXEC SQL                                                     03950018
038000          DECLARE PRE_PACK_CSR CURSOR FOR                         03960018
038100              SELECT ITM_NBR, 'A'                                 03970018
038200                   , PREPK_ID, SUM(PREPK_RATO_QTY)                03980018
038300                   , ((SUM(SHPD_QTY)) / (SUM(PREPK_RATO_QTY)))    03990018
038400              FROM TSHUUPC A                                      04000018
038500                 , TRECITM B                                      04010018
038600              WHERE B.ORD_NBR = A.TRN_NBR                         04020018
038700                AND A.SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR            04030018
038800                AND B.REC_SEQ_NBR = :RECITM-REC-SEQ-NBR           04040018
038900                AND B.ORD_LNE_NBR = A.TRN_LNE_NBR                 04050018
039000              GROUP BY ITM_NBR, PREPK_ID                          04060018
039100              UNION                                               04070018
039200              SELECT C.ITM_NBR, 'B', 0, SUM(A.SCND_UNT_QTY) ,0    04080018
039300                FROM TSUAUPC A                                    04090018
039400                    ,XLV_UPC B                                    04100018
039500                    ,XLT_SKU C                                    04110018
039600               WHERE A.UPC_NBR = B.UPC_NBR                        04120018
039700                 AND B.INTR_UPC_ID = C.INTR_UPC_ID                04130018
039800                 AND A.SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR           04140018
039900                 AND A.AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR          04150018
040000                 GROUP BY ITM_NBR                                 04160018
040100                 ORDER BY 1, 2                                    04170018
040200     END-EXEC.                                                    04180018
040300                                                                  04190018
040400*================================================================*04200018
040500* CURSOR TO SELECT SCANNED ITEMS FROM TSUAUPC FOR PREPK PROCESS * 04210018
040600*================================================================*04220018
040700     EXEC SQL                                                     04230018
040800          DECLARE PREPK_UPC_CSR CURSOR WITH HOLD FOR              04240018
040900              SELECT  AUD_CNTL_NBR                                04250018
041000                    , SHIPT_UNT_ID                                04260018
041100                    , UPC_NBR                                     04270018
041200                    , SCN_TMST                                    04280018
041300                    , AUD_USR_ID                                  04290018
041400                    , DEPT_NBR                                    04300018
041500                    , MAJ_CL_NBR                                  04310018
041600                    , SUB_CL_NBR                                  04320018
041700                    , SKU_NBR                                     04330018
041800                    , ITM_DESC                                    04340018
041900                    , VND_STYL_DESC                               04350018
042000                    , UPC_CLOR_DESC                               04360018
042100                    , UPC_SIZE_DESC                               04370018
042200                    , UPC_RTL_AMT                                 04380018
042300                    , UPC_CERTD_IND                               04390018
042400                    , SCND_UNT_QTY                                04400018
042500                    , SCN_TYP_CDE                                 04410018
RFAUDT*      10/10/13 JHA BEG                                           04420029
RFAUDT                    , RFID_TGD_QTY                                04430029
RFAUDT*      10/10/13 JHA END                                           04440029
042600              FROM TSUAUPC                                        04450018
042700              WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR             04460018
042800                AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR              04470018
042900                AND SCN_TYP_CDE  = :PC-P                          04480018
043000     END-EXEC.                                                    04490018
043100                                                                  04500018
043200     EXEC SQL DECLARE SUEXCP_CSR CURSOR FOR                       04510018
043300         SELECT AUD_CNTL_NBR                                      04520018
043400              , SHIPT_UNT_ID                                      04530018
043500              , UPC_NBR                                           04540018
043600              , SCN_TMST                                          04550018
043700              , VILN_GP_CDE                                       04560018
043800              , VILN_GP_SEQ_NBR                                   04570018
043900              , OVRRID_SYS_DAT_TXT                                04580018
044000           FROM TSUEXCP                                           04590018
044100         WHERE                                                    04600018
044200                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             04610018
044300           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              04620018
044400           AND  SCN_TMST         = :DK-SCN-TMST                   04630018
044500     END-EXEC.                                                    04640018
044600                                                                  04650018
044700******************************************************************04660018
044800 LINKAGE SECTION.                                                 04670018
044900******************************************************************04680018
045000 01  DFHCOMMAREA.                                                 04690018
045100     05  FILLER                         OCCURS  1 TO 4072 TIMES   04700018
045200                                        DEPENDING ON EIBCALEN.    04710018
045300         10  FILLER                     PIC X.                    04720018
045400                                                                  04730018
045500                                                                  04740018
045600******************************************************************04750018
045700 PROCEDURE DIVISION.                                              04760018
045800******************************************************************04770018
045900 0000-PROGRAM-MAINLINE.                                           04780018
046000     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           04790018
046100     MOVE LOW-VALUES   TO  SU518AI.                               04800018
046200                                                                  04810018
046300     EVALUATE TRUE                                                04820018
046400*        IF CONTROL IS BEING RETURNED TO THIS PROGRAM WITH AN     04830038
046500*        ERROR, JUST DISPLAY THE SCREEN WITH THE ERROR MSG        04840018
046600         WHEN CA-RETURN-ERROR                                     04850018
046700             SET SU006-PROCESS-SCREEN                             04860018
046800                 CA-NO-RETURN-ERROR    TO  TRUE                   04870018
046900             MOVE CA-RETURN-MSG        TO AMSGLNO                 04880018
047000             MOVE CA-SCANNED-UPC       TO AUPCO                   04890018
047100             IF  SU006-PREPK-ITYPE-PKGNG-CDE                      04900057
047200              AND SU006-PREPACK-NOT-CLOSED                        04910057
RFAUDT*              IF SU006-RFID-AUD-ONLY                             04920060
047300                 MOVE PC-F8-CLS-KEY        TO AFKEYO              04930057
      *              ELSE                                               04940060
047300*                MOVE PC-F7-TKT-F8-CLS-KEY TO AFKEYO              04950060
      *              END-IF                                             04960060
047400             ELSE                                                 04970057
RFAUDT*              IF SU006-RFID-AUD-ONLY                             04980060
RFAUDT                 MOVE SPACES            TO AFKEYO                 04990057
RFAUDT*              ELSE                                               05000060
047500*                MOVE PC-F7-NO-TICKET-KEY  TO AFKEYO              05010060
047600*              END-IF                                             05020060
RFAUDT             END-IF                                               05030057
047700                                                                  05040018
047800             PERFORM 8000-SEND-MAP                                05050018
047900             PERFORM 8200-RETURN-TRANID                           05060018
048000                                                                  05070018
048100****************************************************************  05080018
048200* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        05090018
048300****************************************************************  05100018
048400         WHEN EIBTRNID = 'Z278'                                   05110018
048500             MOVE DFHCOMMAREA          TO PC192-COMMAREA          05120018
048600             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             05130018
048700             SET SU006-PROCESS-SCREEN  TO TRUE                    05140018
048800             PERFORM 1000-INITIALIZE                              05150018
RFAUDT* 10/15/13 JHA BEG                                                05160036
RFAUDT             IF  SU006-PREPK-ITYPE-PKGNG-CDE                      05170057
RFAUDT              AND SU006-PREPACK-NOT-CLOSED                        05180057
RFAUDT*              IF SU006-RFID-AUD-ONLY                             05190060
047300                 MOVE PC-F8-CLS-KEY        TO AFKEYO              05200057
      *              ELSE                                               05210060
047300*                MOVE PC-F7-TKT-F8-CLS-KEY TO AFKEYO              05220060
      *              END-IF                                             05230060
RFAUDT             ELSE                                                 05240057
RFAUDT*              IF SU006-RFID-AUD-ONLY                             05250060
RFAUDT                 MOVE SPACES                  TO AFKEYO           05260057
RFAUDT*              ELSE                                               05270060
RFAUDT*                MOVE PC-F7-NO-TICKET-KEY  TO AFKEYO              05280060
RFAUDT*              END-IF                                             05290060
RFAUDT             END-IF                                               05300045
RFAUDT* 10/15/13 JHA END                                                05310036
048900             PERFORM 8000-SEND-MAP                                05320018
049000             PERFORM 8200-RETURN-TRANID                           05330018
049100                                                                  05340018
049200         WHEN EIBCALEN = ZERO                                     05350018
049300         WHEN EIBAID = DFHCLEAR                                   05360018
049400         WHEN SU006-INITIALIZE-SCREEN                             05370018
049500             PERFORM 1000-INITIALIZE                              05380018
049600                                                                  05390018
049700             IF  SU006-PREPK-ITYPE-PKGNG-CDE                      05400057
049800             AND SU006-PREPACK-NOT-CLOSED                         05410057
RFAUDT*              IF SU006-RFID-AUD-ONLY                             05420060
047300                 MOVE PC-F8-CLS-KEY        TO AFKEYO              05430057
      *              ELSE                                               05440060
047300*                MOVE PC-F7-TKT-F8-CLS-KEY TO AFKEYO              05450060
      *              END-IF                                             05460060
050000             ELSE                                                 05470057
RFAUDT*              IF SU006-RFID-AUD-ONLY                             05480060
RFAUDT                 MOVE SPACES                  TO AFKEYO           05490057
RFAUDT*              ELSE                                               05500060
050100*                MOVE PC-F7-NO-TICKET-KEY  TO AFKEYO              05510060
050200*              END-IF                                             05520060
RFAUDT             END-IF                                               05530045
050300                                                                  05540018
050400             PERFORM 8000-SEND-MAP                                05550018
050500             PERFORM 8200-RETURN-TRANID                           05560018
050600                                                                  05570018
050700*        IF ENTER WAS PUSHED, VALIDATE UPC, THEN XFER TO THE UPC  05580018
050800*        INFO SCREEN FOR SYSTEM LOOKUP                            05590018
050900         WHEN EIBAID = DFHENTER                                   05600018
051000             PERFORM 1200-RECEIVE-MAP                             05610018
051100             PERFORM 1300-EDIT-SELECTION                          05620018
051200                                                                  05630018
RFAUDT* 10/08/13 JHA BEG                                                05640027
RFAUDT             IF SU006-RFID-AUDIT                                  05650030
RFAUDT                MOVE PC-RFID-SKU-ENTRY-SCREEN                     05660025
RFAUDT                                         TO PV-TRANSFER-PROGRAM   05670025
RFAUDT             ELSE                                                 05680025
051300                MOVE PC-UPC-INFO-SCREEN  TO PV-TRANSFER-PROGRAM   05690025
RFAUDT             END-IF                                               05700025
RFAUDT* 10/08/13 JHA END                                                05710027
051400             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                05720018
051500                                                                  05730018
051600         WHEN EIBAID = DFHPF1                                     05740018
051700              PERFORM 1400-HELP-SCREEN                            05750018
051800                                                                  05760018
051900*        EXIT F-KEY WAS PRESSED                                   05770018
052000         WHEN EIBAID = DFHPF3                                     05780018
052100            IF SU006-PREPK-ITYPE-PKGNG-CDE                        05790018
052200            AND SU006-PREPACK-NOT-CLOSED                          05800018
052300               MOVE PC-PREPACK-CLOSE-REQ-MSG   TO  AMSGLNO        05810018
052400            ELSE                                                  05820018
052500               MOVE PC-CARTON-CLOSE-SCREEN                        05830018
052600                                      TO  PV-TRANSFER-PROGRAM     05840018
052700               PERFORM 2100-XCTL-TO-SELECTED-PROGRAM              05850018
052800            END-IF                                                05860018
052900*        NO UPC F-KEY WAS PRESSED - SET THE COMMAREA INDICATOR TO 05870018
053000*        CREATE A "NO UPC" EXCEPTION, AND XCTL TO THE SKU ENTER   05880018
053100*        SCREEN                                                   05890018
      **** PF4 REMOVED AT USERS REQUEST AS PART OF RFID AUDIT PROJECT.  05900058
053200*        WHEN EIBAID = DFHPF4                                     05910058
      **  12/5/2013  JHA  BEG                                           05920038
      *             IF  SU006-MANUAL-GENERATED-AUDIT                    05930058
      *             AND SU006-RFID-AUD-ONLY                             05940058
      *                 MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO AMSGLNO     05950058
      *             ELSE                                                05960058
      **  12/5/2013  JHA  END                                           05970038
053300*               SET SU006-MISSING-UPC-ERROR TO TRUE               05980058
053500*               MOVE PC-SKU-ENTER-SCREEN    TO PV-TRANSFER-PROGRAM05990058
053600*               PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             06000058
      *             END-IF                                              06010058
053700*                                                                 06020058
      **** PF4 REMOVED AT USERS REQUEST AS PART OF RFID AUDIT PROJECT.  06030058
      **** PF5 REMOVED AT USERS REQUEST AS PART OF RFID AUDIT PROJECT.  06040058
053800*        NO BARCODE F-KEY WAS PRESSED - VALIDATE THE ENTERED UPC, 06050018
053900*        SET THE COMMAREA INDICATOR TO CREATE A "NO BARCODE"      06060018
054000*        EXCEPTION, AND XCTL TO THE UPC INFO SCREEN FOR LOOKUP    06070018
054100*        WHEN EIBAID = DFHPF5                                     06080058
RFAUDT**  12/5/2013  JHA  BEG                                           06090064
      *             IF  SU006-MANUAL-GENERATED-AUDIT                    06100058
      *             AND SU006-RFID-AUD-ONLY                             06110058
      *                 MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO AMSGLNO     06120058
      *             ELSE                                                06130058
RFAUDT**  12/5/2013  JHA  END                                           06140064
054200*                 PERFORM 1200-RECEIVE-MAP                        06150058
054300*                 PERFORM 1300-EDIT-SELECTION                     06160058
054500*                 SET SU006-BARCODE-MISSING-ERROR TO TRUE         06170058
054600*                                                                 06180058
RFAUDT**10/08/13 JHA BEG                                                06190058
RFAUDT*                 IF SU006-RFID-AUDIT                             06200058
RFAUDT*                    MOVE PC-RFID-SKU-ENTRY-SCREEN                06210058
RFAUDT*                                        TO PV-TRANSFER-PROGRAM   06220058
RFAUDT*                 ELSE                                            06230058
054700*                    MOVE PC-UPC-INFO-SCREEN                      06240058
RFAUDT*                                        TO PV-TRANSFER-PROGRAM   06250058
RFAUDT*                 END-IF                                          06260058
RFAUDT**10/08/13 JHA END                                                06270058
054800*                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM           06280058
RFAUDT*             END-IF                                              06290058
054900*                                                                 06300058
      **** PF5 REMOVED AT USERS REQUEST AS PART OF RFID AUDIT PROJECT.  06310058
055000*        DAMAGED BARCODE F-KEY WAS PRESSED - VALIDATE THE ENTERED 06320018
055100*        UPC, SET THE COMMAREA INDICATOR TO CREATE A "DAMAGED     06330018
055200*        BARCODE" EXCEPTION, AND XCTL TO THE UPC INFO SCREEN      06340018
055300         WHEN EIBAID = DFHPF6                                     06350018
RFAUDT**  12/5/2013  JHA  BEG                                           06360064
                    IF  SU006-MANUAL-GENERATED-AUDIT                    06370038
                    AND SU006-RFID-AUD-ONLY                             06380038
                        MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO AMSGLNO     06390038
                    ELSE                                                06400038
RFAUDT**  12/5/2013  JHA  END                                           06410064
055400                  PERFORM 1200-RECEIVE-MAP                        06420038
055500                  PERFORM 1300-EDIT-SELECTION                     06430038
055700                  SET SU006-DAMAGED-BARCODE-ERROR                 06440038
055800                                        TO TRUE                   06450018
055900                                                                  06460018
RFAUDT* 10/08/13 JHA BEG                                                06470027
RFAUDT                  IF SU006-RFID-AUDIT                             06480038
RFAUDT                     MOVE PC-RFID-SKU-ENTRY-SCREEN                06490038
RFAUDT                                         TO PV-TRANSFER-PROGRAM   06500025
RFAUDT                  ELSE                                            06510038
056000                     MOVE PC-UPC-INFO-SCREEN                      06520038
RFAUDT                                         TO PV-TRANSFER-PROGRAM   06530038
RFAUDT                  END-IF                                          06540038
RFAUDT* 10/08/13 JHA END                                                06550027
056100                  PERFORM 2100-XCTL-TO-SELECTED-PROGRAM           06560038
RFAUDT              END-IF                                              06570038
056200                                                                  06580018
056300*        NO TAG F-KEY WAS PRESSED - SET THE COMMAREA              06590018
056400*        COMMAREA INDICATOR TO CREATE A "NO TAG" EXXCEPTION,      06600018
056500*        AND XCTL TO THE DATA INFO SCREEN                         06610018
      **** PF7 REMOVED AT USERS REQUEST AS PART OF RFID AUDIT PROJECT.  06620058
056600*        WHEN EIBAID = DFHPF7                                     06630058
056700*                                                                 06640058
RFAUDT**  12/5/2013  JHA  BEG                                           06650064
      *             IF  SU006-MANUAL-GENERATED-AUDIT                    06660058
      *             AND SU006-RFID-AUD-ONLY                             06670058
      *                 MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO AMSGLNO     06680058
      *             ELSE                                                06690058
RFAUDT**  12/5/2013  JHA  END                                           06700064
056800*                 SET SU006-NO-TICKET-ERROR TO TRUE               06710058
056900*                 MOVE ZERO                 TO SU006-NUMERIC-SKU  06720058
057000*                                                                 06730058
057100*                 MOVE PC-DATA-INFO-SCREEN                        06740058
057100*                                           TO PV-TRANSFER-PROGRAM06750058
057200*                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM           06760058
      *             END-IF                                              06770058
057300*                                                                 06780058
      **** PF7 REMOVED AT USERS REQUEST AS PART OF RFID AUDIT PROJECT.  06790058
057400**FOR I- PREPACKS, CLOSE THE PREPACK BEING SCANNED                06800018
057500**                                                                06810018
057600         WHEN EIBAID = DFHPF8                                     06820018
057700            IF SU006-PREPK-ITYPE-PKGNG-CDE                        06830018
057800            AND SU006-PREPACK-NOT-CLOSED                          06840018
057900               MOVE SU006-SHIP-UNIT-NBR-X                         06850018
058000                                     TO DK-SHIP-UNIT-NBR          06860018
058100               MOVE SU006-REC-SEQ-NBR TO                          06870018
058200                                     RECITM-REC-SEQ-NBR           06880018
058300               MOVE SU006-AUDIT-CNTL-NBR-X TO                     06890018
058400                                     DK-AUDIT-CNTL-NBR            06900018
058500               PERFORM 6000-VALIDATE-SCANNED-PREPK                06910018
058600               IF PS-PREPACK-ERROR-FOUND                          06920018
058700                  SET SU006-AUD-ERR TO TRUE                       06930018
058800                  PERFORM 6325-INSERT-TCTEXCP                     06940018
058900               END-IF                                             06950018
059000               COMPUTE PV-EXPND-NBR-ROWS =                        06960018
059100                                 (SU006-KEYED-PACK-QTY - 1)       06970018
059200               PERFORM 6350-EXPAND-SCND-UNITS                     06980018
059300               SET SU006-PREPACK-CLOSED TO TRUE                   06990018
RFAUDT*              IF SU006-RFID-AUD-ONLY                             07000060
RFAUDT                  MOVE SPACES               TO AFKEYO             07010045
RFAUDT*              ELSE                                               07020060
059400*                 MOVE PC-F7-NO-TICKET-KEY  TO AFKEYO             07030060
RFAUDT*              END-IF                                             07040060
059500               MOVE PC-PREPACK-CLOSED-MSG   TO AMSGLNO            07050045
RFAUDT               IF SU006-QC-AND-RFID-AUD                           07060051
                       AND SU006-SYSTEM-GENERATED-AUDIT                 07070056
RFAUDT                 SET PS-NO-PREPACK-ERROR-FOUND TO TRUE            07080051
RFAUDT                 MOVE SU006-SHIP-UNIT-NBR-X                       07090051
RFAUDT                                       TO DK-SHIP-UNIT-NBR        07100051
RFAUDT                 MOVE SU006-REC-SEQ-NBR TO                        07110051
RFAUDT                                       RECITM-REC-SEQ-NBR         07120051
RFAUDT                 MOVE SU006-RFID-AUDIT-CNTL-NBR-X TO              07130051
RFAUDT                                       DK-AUDIT-CNTL-NBR          07140051
RFAUDT                 PERFORM 6000-VALIDATE-SCANNED-PREPK              07150051
RFAUDT                 IF PS-PREPACK-ERROR-FOUND                        07160051
RFAUDT                    SET SU006-AUD-ERR TO TRUE                     07170051
RFAUDT                    PERFORM 6325-INSERT-TCTEXCP                   07180051
RFAUDT                 END-IF                                           07190051
RFAUDT                 COMPUTE PV-EXPND-NBR-ROWS =                      07200051
RFAUDT                                   (SU006-KEYED-PACK-QTY - 1)     07210051
RFAUDT                 SET PS-NOT-EO-PREPK-UPC-CSR TO TRUE              07220053
RFAUDT                 PERFORM 6350-EXPAND-SCND-UNITS                   07230051
RFAUDT               END-IF                                             07240051
059600            ELSE                                                  07250018
059700               MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO       07260018
059800            END-IF                                                07270018
059900                                                                  07280018
060000         WHEN OTHER                                               07290018
060100             IF  SU006-PREPK-ITYPE-PKGNG-CDE                      07300057
060200              AND SU006-PREPACK-NOT-CLOSED                        07310057
RFAUDT               IF SU006-RFID-AUD-ONLY                             07320057
047300                 MOVE PC-F8-CLS-KEY        TO AFKEYO              07330057
                     ELSE                                               07340057
047300                 MOVE SPACE                TO AFKEYO              07350058
      *** COMMENTED OUT WHEN PF7 WAS REMOVED                            07360058
047300*                MOVE PC-F7-TKT-F8-CLS-KEY TO AFKEYO              07370059
      *** COMMENTED OUT WHEN PF7 WAS REMOVED                            07380058
                     END-IF                                             07390057
060400             ELSE                                                 07400057
RFAUDT               IF SU006-RFID-AUD-ONLY                             07410057
RFAUDT                 MOVE SPACES                  TO AFKEYO           07420057
RFAUDT               ELSE                                               07430057
047300                 MOVE SPACE                TO AFKEYO              07440058
      *** COMMENTED OUT WHEN PF7 WAS REMOVED                            07450058
060500*                MOVE PC-F7-NO-TICKET-KEY  TO AFKEYO              07460058
      *** COMMENTED OUT WHEN PF7 WAS REMOVED                            07470058
060600               END-IF                                             07480057
RFAUDT             END-IF                                               07490045
060700                                                                  07500018
060800             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         07510018
060900                                                                  07520018
061000     END-EVALUATE.                                                07530018
061100                                                                  07540018
061200     PERFORM 8100-SEND-DATA-ONLY.                                 07550018
061300     PERFORM 8200-RETURN-TRANID.                                  07560018
061400                                                                  07570018
061500     GOBACK.                                                      07580018
061600******************************************************************07590018
061700*  1000-INITIALIZE                                               *07600018
061800*  RESET ALL COMMAREA VALUES                                     *07610018
061900******************************************************************07620018
062000 1000-INITIALIZE.                                                 07630018
062100     INITIALIZE CA-PROGRAM-COMMAREA                               07640018
062200                SU006-ITEM-ERROR-INDICATORS.                      07650018
062300     SET SU006-PROCESS-SCREEN  TO  TRUE.                          07660018
062400     MOVE +0                   TO  SU006-PGM-MSG-NBR.             07670018
062500     MOVE SU006-SHIP-UNIT-NBR-X TO ACARTONO.                      07680018
062600     MOVE SPACES               TO  SU006-UPC-X                    07690018
062700                                   CA-SCANNED-UPC                 07700018
062800                                   SU006-SKU-NBR                  07710018
062900                                   SU006-SCN-TMST.                07720018
063000                                                                  07730018
089700*   GET THE EXPECTED AND SCANNED QUANTITY                         07740040
RFAUDT     IF SU006-RFID-AUD-ONLY                                       07750040
RFAUDT        PERFORM 1010-CHCK-RFID-ONLY-QTYS                          07760040
RFAUDT     ELSE                                                         07770040
063200        PERFORM 1020-GET-EXP-QTY                                  07780040
063500        PERFORM 1040-GET-SCN-QTY                                  07790040
RFAUDT     END-IF.                                                      07800040
063600                                                                  07810018
RFAUDT** 12/05/2013 JHA  BEG                                            07820064
           IF SU006-RFID-AUD-ONLY                                       07830044
               MOVE 'RFID'            TO AEXPFLDO                       07840049
               MOVE SPACES            TO AFEY4O                         07850049
                                         AFEY5O                         07860038
                                         AFEY6O                         07870038
                                         AEXPQTYO                       07880049
              MOVE 'TAG' TO ASCNTGDCO                                   07890055
           ELSE                                                         07900038
               MOVE 'SCN' TO ASCNTGDCO                                  07910054
               MOVE ' EXP'            TO AEXPFLDO                       07920050
               MOVE SPACE             TO AFEY4O                         07930059
                                         AFEY5O                         07940059
                                         AFEY6O                         07950059
      *        MOVE 'F4 - NO UPC      '                                 07960059
      *                               TO AFEY4O                         07970059
      *        MOVE 'F5 - NO BARCODE  '                                 07980059
      *                               TO AFEY5O                         07990059
               MOVE 'F6 - DAMAGED BCDE'                                 08000062
                                      TO AFEY6O                         08010062
           END-IF.                                                      08020038
063700*                                                                 08030018
RFAUDT******************************************************************08040040
RFAUDT* 1010-CHCK-RFID-ONLY-QTYS.                                       08050040
RFAUDT*  FOR RFID ONLY AUDITS - REPLACE THE SHIP QTY WITH THE SCAN QTY  08060040
RFAUDT*  AND REPLACE THE SCAN QUANTITY WITH THE TAG QTY.                08070040
RFAUDT******************************************************************08080040
RFAUDT 1010-CHCK-RFID-ONLY-QTYS.                                        08090040
RFAUDT                                                                  08100040
RFAUDT     MOVE SU006-AUDIT-CNTL-NBR TO DK-AUDIT-CNTL-NBR.              08110046
RFAUDT     MOVE SU006-SHIP-UNIT-NBR  TO DK-SHIP-UNIT-NBR.               08120046
RFAUDT                                                                  08130040
RFAUDT     EXEC SQL                                                     08140040
RFAUDT        SELECT SUM(RFID_TGD_QTY)                                  08150048
RFAUDT          INTO :PV-EXP-QTY                                        08160048
RFAUDT               :PV-EXP-QTY-NULL                                   08170048
RFAUDT          FROM TSUAUPC                                            08180040
RFAUDT         WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR                  08190040
RFAUDT           AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                   08200040
RFAUDT          WITH UR                                                 08210040
RFAUDT     END-EXEC.                                                    08220040
RFAUDT                                                                  08230040
RFAUDT     EVALUATE TRUE                                                08240040
RFAUDT        WHEN SQLCODE = ZERO                                       08250040
RFAUDT             IF PV-EXP-QTY-NULL < 0                               08260040
RFAUDT                MOVE ZERO               TO PV-EXP-QTY-SHRT        08270040
RFAUDT                MOVE PV-EXP-QTY-SHRT    TO ASCNQTYO               08280040
RFAUDT             ELSE                                                 08290040
RFAUDT                MOVE PV-EXP-QTY         TO PV-EXP-QTY-SHRT        08300040
RFAUDT                MOVE PV-EXP-QTY-SHRT    TO ASCNQTYO               08310040
RFAUDT             END-IF                                               08320040
RFAUDT                                                                  08330040
RFAUDT        WHEN SQLCODE = +100                                       08340040
RFAUDT            MOVE ZERO                    TO PV-EXP-QTY-SHRT       08350040
RFAUDT            MOVE PV-EXP-QTY-SHRT         TO ASCNQTYO              08360040
RFAUDT                                                                  08370040
RFAUDT        WHEN OTHER                                                08380040
RFAUDT            MOVE '1010-CHCK-RFID-ONLY-QTYS'                       08390040
RFAUDT                                         TO DP013-PARAGRAPH       08400040
RFAUDT            MOVE 'SELECT OF TSUAUPC'     TO DP013-MESSAGE-TEXT (1)08410040
RFAUDT            MOVE DK-AUDIT-CNTL-NBR       TO DP013-MESSAGE-TEXT (2)08420041
RFAUDT            MOVE DK-SHIP-UNIT-NBR        TO DP013-MESSAGE-TEXT (3)08430041
RFAUDT            MOVE SQLCA                   TO DP013-SQLCA           08440040
RFAUDT            MOVE 'TSUAUPC'               TO                       08450040
RFAUDT                                         DP013-DB2-TABLE-NAME (1) 08460040
RFAUDT            SET DP013-DB2-ABEND          TO TRUE                  08470040
RFAUDT            SET DP013-NO-ROLLBACK        TO TRUE                  08480040
RFAUDT            PERFORM 9999-WRITE-CICS-LOG-MSG                       08490040
RFAUDT            MOVE PM-DB2-FATAL-ERROR-MSG  TO AMSGLNO               08500040
RFAUDT            MOVE -1                      TO AUPCL                 08510041
RFAUDT            PERFORM 8100-SEND-DATA-ONLY                           08520040
RFAUDT            PERFORM 8200-RETURN-TRANID                            08530040
RFAUDT     END-EVALUATE.                                                08540040
RFAUDT                                                                  08550040
RFAUDT** 12/05/2013 JHA  END                                            08560064
063800******************************************************************08570018
063900* 1020-GET-EXP-QTY                                               *08580018
064000*    SELECT THE QUANTITY EXPECTED IN THE CARTON                  *08590018
064100******************************************************************08600018
064200 1020-GET-EXP-QTY.                                                08610018
064300                                                                  08620018
064400     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              08630018
064500                                                                  08640018
064600     EXEC SQL                                                     08650018
064700          SELECT SUM(SHPD_QTY)                                    08660018
064800            INTO :PV-EXP-QTY                                      08670018
064900            FROM TSHUUPC                                          08680018
065000            WHERE SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                08690018
065100     END-EXEC.                                                    08700018
065200                                                                  08710018
065300     IF SQLCODE = ZERO                                            08720018
065400        MOVE PV-EXP-QTY      TO PV-EXP-QTY-SHRT                   08730018
065500        MOVE PV-EXP-QTY-SHRT TO AEXPQTYO                          08740018
065600     ELSE                                                         08750018
065700        IF SQLCODE = +100 OR                                      08760018
065800           SQLCODE = -305                                         08770018
065900           MOVE ZERO          TO AEXPQTYO                         08780018
066000        ELSE                                                      08790018
066100             MOVE '1020-GET-EXP-QTY'                              08800018
066200                                         TO DP013-PARAGRAPH       08810018
066300             MOVE 'SELECT OF TSHUUPC'    TO DP013-MESSAGE-TEXT (1)08820018
066400             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (2)08830018
066500             MOVE SQLCA                  TO DP013-SQLCA           08840018
066600             MOVE 'TSHUUPC'            TO DP013-DB2-TABLE-NAME (1)08850018
066700             SET DP013-DB2-ABEND         TO TRUE                  08860018
066800             SET DP013-NO-ROLLBACK       TO TRUE                  08870018
066900             PERFORM 9999-WRITE-CICS-LOG-MSG                      08880018
067000                                                                  08890018
067100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               08900018
067200             MOVE -1                     TO AUPCL                 08910018
067300             PERFORM 8100-SEND-DATA-ONLY                          08920018
067400             PERFORM 8200-RETURN-TRANID                           08930018
067500        END-IF                                                    08940018
067600     END-IF.                                                      08950018
067700                                                                  08960018
067800*                                                                 08970018
067900******************************************************************08980018
068000* 1040-GET-SCN-QTY                                               *08990018
068100*    SELECT THE QUANTITY AUDITED IN THE CARTON                   *09000018
068200******************************************************************09010018
068300 1040-GET-SCN-QTY.                                                09020018
068400                                                                  09030018
068500     MOVE SU006-AUDIT-CNTL-NBR  TO DK-AUDIT-CNTL-NBR.             09040018
068600     MOVE SU006-SHIP-UNIT-NBR   TO DK-SHIP-UNIT-NBR.              09050018
068700*GB 12/27/01 BEG                                                  09060018
068800*    EXEC SQL                                                     09070018
068900*         SELECT COUNT(*)                                         09080018
069000*           INTO :PV-SCN-QTY                                      09090018
069100*           FROM TSUAUPC                                          09100018
069200*           WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR               09110018
069300*             AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                09120018
069400*    END-EXEC.                                                    09130018
069500* GB 12/27/01 END                                                 09140018
069600                                                                  09150018
069700     EXEC SQL                                                     09160018
069800          SELECT SUM(SCND_UNT_QTY)                                09170018
069900            INTO :PV-SCN-QTY                                      09180018
070000            FROM TSUAUPC                                          09190018
070100            WHERE AUD_CNTL_NBR = :DK-AUDIT-CNTL-NBR               09200018
070200              AND SHIPT_UNT_ID = :DK-SHIP-UNIT-NBR                09210018
RFAUDT** 12/05/13 JHA  BEG                                              09220043
RFAUDT              AND SCN_TYP_CDE IN (:PC-O, :PC-P, :PC-S, :PC-X)     09230043
RFAUDT** 12/05/13 JHA  END                                              09240043
070400     END-EXEC.                                                    09250018
070500                                                                  09260018
070600     IF SQLCODE = ZERO                                            09270018
070700        MOVE PV-SCN-QTY       TO PV-SCN-QTY-SHRT                  09280018
070800        MOVE PV-SCN-QTY-SHRT  TO ASCNQTYO                         09290018
070900     ELSE                                                         09300018
071000        IF SQLCODE = +100 OR                                      09310018
071100           SQLCODE = -305                                         09320018
071200           MOVE ZERO          TO ASCNQTYO                         09330018
071300        ELSE                                                      09340018
071400             MOVE '1040-GET-SCN-QTY'                              09350018
071500                                         TO DP013-PARAGRAPH       09360018
071600             MOVE 'SELECT OF TSUAUPC'    TO DP013-MESSAGE-TEXT (1)09370018
071700             MOVE DK-AUDIT-CNTL-NBR      TO DP013-MESSAGE-TEXT (2)09380018
071800             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (3)09390018
071900             MOVE SQLCA                  TO DP013-SQLCA           09400018
072000             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)09410018
072100             SET DP013-DB2-ABEND         TO TRUE                  09420018
072200             SET DP013-NO-ROLLBACK       TO TRUE                  09430018
072300             PERFORM 9999-WRITE-CICS-LOG-MSG                      09440018
072400                                                                  09450018
072500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               09460018
072600             MOVE -1                     TO AUPCL                 09470018
072700             PERFORM 8100-SEND-DATA-ONLY                          09480018
072800             PERFORM 8200-RETURN-TRANID                           09490018
072900        END-IF                                                    09500018
073000     END-IF.                                                      09510018
073100                                                                  09520018
073200*                                                                 09530018
073300 1200-RECEIVE-MAP.                                                09540018
073400                                                                  09550018
073500     INITIALIZE AUPCI.                                            09560018
073600                                                                  09570018
073700     EXEC CICS                                                    09580018
073800         RECEIVE                                                  09590018
073900             MAP     ('SU518A')                                   09600018
074000             MAPSET  ('SUKM518')                                  09610018
074100             RESP    (PV-CICS-RESPONSE)                           09620018
074200     END-EXEC.                                                    09630018
074300                                                                  09640018
074400     EVALUATE TRUE                                                09650018
074500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 09660018
074600              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  09670018
074700         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                09680018
074800              CONTINUE                                            09690018
074900         WHEN OTHER                                               09700018
075000              MOVE '1200-RECEIVE-MAP'                             09710018
075100                                     TO DP013-PARAGRAPH           09720018
075200              MOVE 'UNABLE TO RECEIVE MAP'                        09730018
075300                                     TO DP013-MESSAGE-TEXT (1)    09740018
075400              SET DP013-LOGIC-ABEND  TO TRUE                      09750018
075500              SET DP013-NO-ROLLBACK  TO TRUE                      09760018
075600              PERFORM 9999-WRITE-CICS-LOG-MSG                     09770018
075700     END-EVALUATE.                                                09780018
075800*                                                                 09790018
075900 1210-RECEIVE-SCREEN-FIELDS.                                      09800018
076000*                                                                 09810018
076100     IF  AUPCL    > ZERO                                          09820018
076200         MOVE AUPCI                  TO CA-SCANNED-UPC            09830018
076300                                        SU006-UPC-X               09840018
076400     ELSE IF  AUPCF    = DP015-ERASE-EOF                          09850018
076500         MOVE SPACES                 TO CA-SCANNED-UPC            09860018
076600                                        SU006-UPC-X               09870018
076700                                        AUPCO                     09880018
076800     END-IF.                                                      09890018
076900*                                                                 09900018
077000**************************************************************    09910018
077100* EDIT ALL ENTERABLE FIELDS (UPC NUMBER)                     *    09920018
077200**************************************************************    09930018
077300 1300-EDIT-SELECTION.                                             09940018
077400                                                                  09950018
077500*    IF NOTHING WAS ENTERED IN THE UPC FIELD AND THE UPC IS       09960018
077600*    REQUIRED FOR THE REQUESTED FUNCTION, SEND AN ERROR           09970018
077700     IF SU006-UPC-X = SPACES                                      09980018
077800     AND (EIBAID = DFHPF5                                         09990018
077900      OR  EIBAID = DFHPF6                                         10000018
078000      OR  EIBAID = DFHENTER)                                      10010018
078100             MOVE PM-UPC-REQUIRED-MSG                             10020018
078200                                   TO AMSGLNO                     10030018
078300             PERFORM 8100-SEND-DATA-ONLY                          10040018
078400             PERFORM 8200-RETURN-TRANID                           10050018
078500     END-IF.                                                      10060018
078600                                                                  10070018
078700     PERFORM 3000-GET-STAT-CDE.                                   10080022
078800     IF SUATRN-UNT-AUD-STAT-CDE = 'CM'                            10090022
078900         MOVE PM-SHIP-UNIT-CLOSE-MSG                              10100022
079000                                   TO AMSGLNO                     10110022
079100         PERFORM 8100-SEND-DATA-ONLY                              10120022
079200         PERFORM 8200-RETURN-TRANID                               10130022
079300     END-IF.                                                      10140022
079400     INITIALIZE DP010I-NUMERIC-EDIT-AREA.                         10150018
079500*    CHECK TO MAKE SURE THE UPC IS NUMERIC                        10160018
079600     MOVE SU006-UPC-X                TO DP010I-UNEDITED-FIELD.    10170018
079700     MOVE 15                         TO DP010I-MAXIMUM-DIGITS.    10180018
079800     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  10190018
079900     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     10200018
080000                                                                  10210018
080100     CALL DP010I-NUMERIC-EDIT-ROUTINE                             10220018
080200                     USING DP010I-NUMERIC-EDIT-AREA.              10230018
080300                                                                  10240018
080400     IF  DP010I-ERROR-DETECTED                                    10250018
080500         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       10260018
080600                                     TO AMSGLNO                   10270018
080700         PERFORM 8100-SEND-DATA-ONLY                              10280018
080800         PERFORM 8200-RETURN-TRANID                               10290018
080900     ELSE                                                         10300018
081000         MOVE DP010I-NUM-FIELD-15-DIG-2-DEC                       10310018
081100                                     TO SU006-UPC                 10320018
081200     END-IF.                                                      10330018
081300                                                                  10340018
081400*    DETERMINE THE LENGTH OF THE ENTERED/SCANNED NUMBER           10350018
081500     INITIALIZE PV-LEADING-0-COUNT.                               10360018
081500     INITIALIZE PV-TRAILNG-0-COUNT.                               10361079
081600     INSPECT SU006-UPC-X                                          10370018
081700          TALLYING PV-LEADING-0-COUNT                             10380018
081800          FOR LEADING '0'.                                        10390018
081900     COMPUTE PV-UPC-LENGTH     =                                  10400018
082000               (PC-MAXIMUM-UPC-FIELD-LENGTH -                     10410018
082100               PV-LEADING-0-COUNT).                               10420018
082200                                                                  10430018
082300*    IF THE UPC IS COMPACTED, EXPAND IT....                       10440018
082400     IF PV-UPC-LENGTH = PC-MAXIMUM-UPC-E-DATA-DIGITS              10450018
082500         MOVE SU006-UPC            TO PV-UPC-E                    10460018
      ***INC1281249 START                                               10470082
               MOVE PV-UPC-E(1:6)        TO UW-UPC-E-DATA-DIGITS        10470182
               COMPUTE PC-MAXIMUM-UPC-E-DATA-DIGITS =                   10471082
                       PC-MAXIMUM-UPC-E-DATA-DIGITS - 1                 10472082
      ***INC1281249 END                                                 10473082
082700                                                                  10480018
082800         PERFORM 5100-EXPAND-UPC-E-TO-UPC-A                       10490018
      ***INC1281249 START                                               10491082
               MOVE PV-UPC-E(7:1)        TO UW-UPC-A(11:1)              10491182
               DISPLAY 'UPC-A'              UW-UPC-A                    10492082
      ***INC1281249 END                                                 10493082
082900                                                                  10500018
083000*        RUN THE EXPANDED UPC THROUGH THE VALIDATION ROUTINE      10510018
083100*        TO CALCULATE THE CHECK DIGIT                             10520018
083200         INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS                  10531076
083300         SET DP040I-COMP-CHECK-DIGIT-OPTION                       10540018
083400                                   TO TRUE                        10550018
083500         MOVE UW-UPC-A             TO DP040I-UPC-CODE             10560018
083600         CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                      10570083
083600                         USING DP040I-UPC-CHECK-DIGIT-PARMS       10571083
083700                                                                  10580018
083800         IF DP040I-NO-ERROR-DETECTED                              10590018
083900             MOVE DP040I-COMPUTED-UPC-CHK-DIGIT                   10600018
084000                                   TO DP040I-UPC-CHECK-DIGIT      10610018
084100             MOVE DP040I-UPC-CODE  TO SU006-UPC                   10620018
084200         ELSE                                                     10630018
084300             MOVE PM-UPC-NOT-VALID-MSG                            10640018
084400                                   TO  AMSGLNO                    10650018
084500             PERFORM 8100-SEND-DATA-ONLY                          10660018
084600             PERFORM 8200-RETURN-TRANID                           10670018
084700         END-IF                                                   10680018
084800                                                                  10690018
084900*    ....OTHERWISE CHECK TO MAKE SURE IT IS A VALID UPC           10700018
085000     ELSE                                                         10710018
085100         INITIALIZE DP040I-UPC-CHECK-DIGIT-PARMS                  10720018
085200         SET DP040I-COMP-CHECK-DIGIT-OPTION                       10730018
085300                                   TO TRUE                        10740018
085400         MOVE SU006-UPC            TO DP040I-UPC-CODE             10750018
085500                                                                  10760018
085600         CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                      10770083
085600                          USING DP040I-UPC-CHECK-DIGIT-PARMS      10771083
085700                                                                  10780018
085800         IF DP040I-COMPUTED-UPC-CHK-DIGIT = DP040I-UPC-CHECK-DIGIT10790018
085900             CONTINUE                                             10800018
086000         ELSE                                                     10810018
086100             MOVE PM-UPC-NOT-VALID-MSG                            10820018
086200                                   TO AMSGLNO                     10830018
086300             PERFORM 8100-SEND-DATA-ONLY                          10840018
086400             PERFORM 8200-RETURN-TRANID                           10850018
086500         END-IF                                                   10860018
086600     END-IF.                                                      10870018
086700                                                                  10880018
086800*   CALL THE UPC VALIDATION ROUTINE                               10890019
086900                                                                  10900019
087000     IF SU006-OPER-UNT-ID = 85                                    10910021
087100         MOVE CA-SCANNED-UPC         TO XL087-UPC                 10920020
087200         MOVE 'SUKRF518'             TO XL087-CALLING-PROGRAM     10930020
087300                                                                  10940020
087400         CALL XL087-LOCATION-MODULE USING DFHEIBLK                10950020
087500                                          XL087-COMMAREA          10960020
087600                                          XL087-RECORD            10970020
087700     END-IF.                                                      10980021
087800                                                                  10990019
087900                                                                  11000018
088000 1400-HELP-SCREEN.                                                11010018
088100     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      11020018
088200     MOVE 'SUKRF518'                  TO PC192-PROGRAM-NAME       11030018
088300     COPY PCPD188.                                                11040018
088400     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      11050018
088500     PERFORM 4200-XCTL-TO-HELP.                                   11060018
088600                                                                  11070018
088700***************************************************************** 11080018
088800*   2100-XCTL-TO-SELECTED-PROGRAM.                              * 11090018
088900* TRANSFER CONTROL TO ANOTHER PROGRAM                           * 11100018
089000***************************************************************** 11110018
089100 2100-XCTL-TO-SELECTED-PROGRAM.                                   11120018
089200     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      11130018
089300     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        11140018
089400     MOVE PC-CURRENT-PROGRAM-NAME  TO  SU006-LAST-PROGRAM.        11150018
089500                                                                  11160018
089600     EXEC CICS                                                    11170018
089700         XCTL                                                     11180018
089800             PROGRAM   (PV-TRANSFER-PROGRAM)                      11190018
089900             COMMAREA  (CA-COMMAREA)                              11200018
090000             LENGTH    (PV-COMMAREA-LENGTH)                       11210018
090100             RESP      (PV-CICS-RESPONSE)                         11220018
090200     END-EXEC.                                                    11230018
090300                                                                  11240018
090400     EVALUATE TRUE                                                11250018
090500         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 11260018
090600              CONTINUE                                            11270018
090700         WHEN OTHER                                               11280018
090800              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                11290018
090900                                     TO DP013-PARAGRAPH           11300018
091000              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       11310018
091100                                     TO DP013-MESSAGE-TEXT (1)    11320018
091200              MOVE PV-TRANSFER-PROGRAM                            11330018
091300                                     TO DP013-MESSAGE-TEXT (2)    11340018
091400              SET DP013-CICS-ABEND   TO TRUE                      11350018
091500              SET DP013-NO-ROLLBACK  TO TRUE                      11360018
091600              PERFORM 9999-WRITE-CICS-LOG-MSG                     11370018
091700              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     11380018
091800                                     TO AMSGLNO                   11390018
091900              SET SU006-PROCESS-SCREEN TO TRUE                    11400018
092000              PERFORM 8100-SEND-DATA-ONLY                         11410018
092100              PERFORM 8200-RETURN-TRANID                          11420018
092200     END-EVALUATE.                                                11430018
092300                                                                  11440018
092400 3000-GET-STAT-CDE.                                               11450022
092500                                                                  11460022
092600     MOVE SU006-AUDIT-CNTL-NBR-X   TO DK-AUDIT-CNTL-NBR.          11470023
092700     MOVE SU006-SHIP-UNIT-NBR-X    TO DK-SHIP-UNIT-NBR            11480023
092800                                                                  11490023
092900     EXEC SQL                                                     11500022
093000         SELECT                                                   11510022
093100            UNT_AUD_STAT_CDE                                      11520022
093200         INTO                                                     11530022
093300                :SUATRN-UNT-AUD-STAT-CDE                          11540022
093400         FROM                                                     11550022
093500                TSUATRN                                           11560022
093600         WHERE                                                    11570022
093700                AUD_CNTL_NBR     = :DK-AUDIT-CNTL-NBR             11580022
093800           AND  SHIPT_UNT_ID     = :DK-SHIP-UNIT-NBR              11590022
093900     END-EXEC.                                                    11600022
094000                                                                  11610022
094100     EVALUATE TRUE                                                11620022
094200         WHEN SQLCODE = ZERO                                      11630022
094300             CONTINUE                                             11640022
094400                                                                  11650022
094500         WHEN SQLWARN0 NOT = SPACES                               11660022
094600         WHEN SQLCODE < ZERO                                      11670022
094700         WHEN SQLCODE > ZERO                                      11680022
094800             MOVE '3000-GET-STAT-CDE'                             11690022
094900                 TO DP013-PARAGRAPH                               11700022
095000             MOVE 'SELECT OF TSUATRN TABLE'                       11710022
095100                 TO DP013-MESSAGE-TEXT (1)                        11720022
095200             MOVE SU006-AUDIT-CNTL-NBR-X                          11730022
095300                 TO DP013-MESSAGE-TEXT (2)                        11740022
095400             MOVE SU006-SHIP-UNIT-NBR-X                           11750022
095500                 TO DP013-MESSAGE-TEXT (3)                        11760022
095600             MOVE SQLCA            TO DP013-SQLCA                 11770022
095700             MOVE 'TSUATRN'        TO DP013-DB2-TABLE-NAME (1)    11780022
095800             SET DP013-DB2-ABEND   TO TRUE                        11790022
095900***          SET DP013-NO-ROLLBACK TO TRUE                        11800022
096000             PERFORM 9999-WRITE-CICS-LOG-MSG                      11810022
096100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               11820022
096200             PERFORM 8100-SEND-DATA-ONLY                          11830022
096300             PERFORM 8200-RETURN-TRANID                           11840022
096400     END-EVALUATE.                                                11850022
096500                                                                  11860022
096600*                                                                 11870018
096700 4200-XCTL-TO-HELP.                                               11880018
096800                                                                  11890018
096900     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      11900018
097000     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    11910018
097100     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    11920018
097200                                                                  11930018
097300     EXEC CICS                                                    11940018
097400         XCTL                                                     11950018
097500             PROGRAM   (PV-TRANSFER-PROGRAM)                      11960018
097600             COMMAREA  (PC192-COMMAREA)                           11970018
097700             LENGTH    (PV-COMMAREA-LENGTH)                       11980018
097800             RESP      (PV-CICS-RESPONSE)                         11990018
097900     END-EXEC.                                                    12000018
098000                                                                  12010018
098100     EVALUATE TRUE                                                12020018
098200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 12030018
098300              CONTINUE                                            12040018
098400         WHEN OTHER                                               12050018
098500             MOVE '4200-XCTL-TO-HELP '                            12060018
098600                 TO DP013-PARAGRAPH                               12070018
098700             MOVE 'SUKRF518 - UNABLE TO XCTL TO PROGRAM: '        12080018
098800                 TO DP013-MESSAGE-TEXT (1)                        12090018
098900             MOVE PV-TRANSFER-PROGRAM                             12100018
099000                 TO DP013-MESSAGE-TEXT (2)                        12110018
099100             SET DP013-CICS-ABEND  TO TRUE                        12120018
099200             SET DP013-ROLLBACK TO TRUE                           12130018
099300             PERFORM 9999-WRITE-CICS-LOG-MSG                      12140018
099400             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             12150018
099500             SET SU006-PROCESS-SCREEN TO TRUE                     12160018
099600             PERFORM 8000-SEND-MAP                                12170018
099700             PERFORM 8200-RETURN-TRANID                           12180018
099800     END-EVALUATE.                                                12190018
099900******************************************************************12200018
100000*  EXPAND A UPC-E COMPRESSED FORMAT TO THE EXPANDED UPC-A        *12210018
100100*  REPRESENTATION.  ONLY UPC-A FORMATS ARE STORED IN THE STORE   *12220018
100200*  AND CORPORATE MERCHANDISE ID REPOSITORIES.  DETERMINE THE     *12230018
100300*  COMPRESSION FORMAT BY THE ID CHARACTERISTICS, AND EXPAND      *12240018
100400*  ACCORDING TO THAT FORMAT'S SPECIFICATIONS.                    *12250018
100500******************************************************************12260018
100600                                                                  12270018
100700 5100-EXPAND-UPC-E-TO-UPC-A.                                      12280018
100800                                                                  12290018
100900*    DETERMINE WHICH EXPANSTION MASK TO USE.                      12300018
101000*    TYPE "F 'MASKS' FIRST" FOR MORE INFO                         12310018
101100     EVALUATE TRUE                                                12320018
101200         WHEN UW-UPC-E-COMPRESSION-FORMAT-1                       12330018
101300             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-1        12340018
101400         WHEN UW-UPC-E-COMPRESSION-FORMAT-2                       12350018
101500             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-2        12360018
101600         WHEN UW-UPC-E-COMPRESSION-FORMAT-3                       12370018
101700             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-3        12380018
101800         WHEN UW-UPC-E-COMPRESSION-FORMAT-4                       12390018
101900             SET UE-MASK-INDEX TO PC-UPC-E-TO-UPC-A-MASK-4        12400018
102000     END-EVALUATE.                                                12410018
102100                                                                  12420018
102200     INITIALIZE UW-UPC-A.                                         12430018
102300                                                                  12440018
102400*    MOVE EACH DIGIT OF UPC-E TO ITS CORRESPONDING POSITION IN    12450018
102500*    UPC-A (DEPENDING ON THE MASK)                                12460018
102600     PERFORM                                                      12470018
102700             VARYING UW-UPC-E-INDEX                               12480018
102800             FROM 1 BY 1                                          12490018
102900             UNTIL UW-UPC-E-INDEX > PC-MAXIMUM-UPC-E-DATA-DIGITS  12500075
103000         SET UE-LOCATION-INDEX TO UW-UPC-E-INDEX                  12510018
103100         IF (NOT UE-UPC-E-DIGIT-NOT-IN-UPC-A                      12520018
103200                               (UE-MASK-INDEX, UE-LOCATION-INDEX))12530018
103300             SET UW-UPC-A-INDEX TO                                12540018
103400                       UE-UPC-E-DIGIT-LOC-IN-UPC-A                12550018
103500                               (UE-MASK-INDEX, UE-LOCATION-INDEX) 12560018
103600             MOVE UW-UPC-E-DATA-DIGIT (UW-UPC-E-INDEX) TO         12570018
103700                       UW-UPC-A-DIGIT (UW-UPC-A-INDEX)            12580018
103800         END-IF                                                   12590018
103900     END-PERFORM.                                                 12600018
104000*5100-EXIT.                                                       12610018
104100                                                                  12620018
104200                                                                  12630018
104300                                                                  12640018
104400*================================================================*12650018
104500* CURSOR PROCESSING TO VALIDATE INNER PREPACKS                   *12660018
104600*================================================================*12670018
104700 6000-VALIDATE-SCANNED-PREPK.                                     12680018
104800                                                                  12690018
104900     PERFORM 6100-OPEN-PREPK-CSR                                  12700018
105000     PERFORM 6200-FETCH-PREPK-CSR                                 12710018
105100       UNTIL PS-EO-PREPK-CSR OR PS-PREPACK-ERROR-FOUND            12720018
105200     PERFORM 6300-CLOSE-PREPK-CSR.                                12730018
105300                                                                  12740018
105400                                                                  12750018
105500******************************************************************12760018
105600 6100-OPEN-PREPK-CSR.                                             12770018
105700                                                                  12780018
105800         EXEC SQL                                                 12790018
105900              OPEN PRE_PACK_CSR                                   12800018
106000         END-EXEC                                                 12810018
106100                                                                  12820018
106200                                                                  12830018
106300         EVALUATE TRUE                                            12840018
106400             WHEN SQLCODE = ZERO                                  12850018
106500                 CONTINUE                                         12860018
106600             WHEN SQLWARN0 NOT = SPACES                           12870018
106700             WHEN SQLCODE < ZERO                                  12880018
106800             WHEN SQLCODE > ZERO                                  12890018
106900             MOVE '6100-OPEN-PREPK-CSR'                           12900018
107000                                         TO DP013-PARAGRAPH       12910018
107100             MOVE 'OPEN PREPACK CSR '    TO DP013-MESSAGE-TEXT (1)12920018
107200             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (2)12930018
107300             MOVE SQLCA                  TO DP013-SQLCA           12940018
107400             MOVE 'TSHUUPC'            TO DP013-DB2-TABLE-NAME (1)12950018
107500             SET DP013-DB2-ABEND         TO TRUE                  12960018
107600             SET DP013-NO-ROLLBACK       TO TRUE                  12970018
107700             PERFORM 9999-WRITE-CICS-LOG-MSG                      12980018
107800                                                                  12990018
107900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               13000018
108000             MOVE -1                     TO AUPCL                 13010018
108100             PERFORM 8100-SEND-DATA-ONLY                          13020018
108200             PERFORM 8200-RETURN-TRANID                           13030018
108300         END-EVALUATE.                                            13040018
108400                                                                  13050018
108900******************************************************************13060037
109000 6200-FETCH-PREPK-CSR.                                            13070018
109200                                                                  13080018
109300     EXEC SQL                                                     13090018
109400        FETCH   PRE_PACK_CSR                                      13100018
109500        INTO   :RECITM-ITM-NBR                                    13110018
109600              ,:PV-UNION-TYPE                                     13120018
109700              ,:PV-PREPK-ID                                       13130018
109800              ,:PV-RATIO-AUD-QTY                                  13140018
109900              ,:PV-CRTN-PACK-QTY                                  13150018
110000     END-EXEC.                                                    13160018
110100* FOR EACH ITEM NUMBER SELECTED FROM THE 'A' PORTION OF THE UNION 13170018
110200* IT SHOULD ALSO BE FOUND ON THE 'B' PORTION OF THE UNION         13180018
110300* ALSO, THE ITEM NUMBER AND THE RATIO/QTY FOUND ON THE 'B' SHOULD 13190018
110400* MATCH WHAT WAS FOUND ON THE 'A'                                 13200018
110500* THE ASSUMPTION IS THAT THE ROWS ON TSHUUPC HAVE BEEN VALIDATED  13210018
110600* THROUGH THE CASEPACK SPLIT APPLICATION, AND THIS CURSOR WILL    13220018
110700* MAKE ADDITIONAL VALIDATION CHECK FOR UPC'S THAT WERE SUBSTITUTED13230018
110800* BY THE VENDOR, BUT ARE STILL VALID AT THE ITEM(SKU) LEVEL       13240018
110900                                                                  13250018
111000     EVALUATE TRUE                                                13260018
111100       WHEN SQLCODE = ZEROS                                       13270018
111200            SET PS-NO-PREPACK-ERROR-FOUND TO TRUE                 13280018
111300                                                                  13290018
111400            IF PS-FIRST-PREPK-FETCH                               13300018
111500* FIRST CARTON CANNOT BE A 'B'                                    13310018
111600               IF PV-UNION-TYPE = 'B'                             13320018
111700**WRONG ITEM IN PACK                                              13330018
111800                  SET PS-PREPACK-ERROR-FOUND TO TRUE              13340018
111900                  MOVE PC-WRONG-ITEM-IN-PACK TO                   13350018
112000                                         PV-PREPACK-ERROR-MESSAGE 13360018
112100               ELSE                                               13370018
112200                   IF PV-CRTN-PACK-QTY  = SU006-KEYED-PACK-QTY    13380018
112300                      MOVE RECITM-ITM-NBR TO                      13390018
112400                                     PV-PREV-ITM-NBR              13400018
112500                      MOVE PV-UNION-TYPE TO                       13410018
112600                                     PV-PREV-UNION-TYPE           13420018
112700                      MOVE PV-RATIO-AUD-QTY TO                    13430018
112800                                     PV-PREV-RATIO-AUD-QTY        13440018
112900                      SET PS-NOT-FIRST-PREPK-FETCH   TO TRUE      13450018
113000                   ELSE                                           13460018
113100**SYSTEM QTY DOES NOT MATCHED KEYED QTY                           13470018
113200                      SET PS-PREPACK-ERROR-FOUND TO TRUE          13480018
113300                      MOVE PC-SYSTEM-KEYED-QTY-MISMTCH TO         13490018
113400                                         PV-PREPACK-ERROR-MESSAGE 13500018
113500                   END-IF                                         13510018
113600               END-IF                                             13520018
113700            ELSE                                                  13530018
113800              IF PV-UNION-TYPE = PV-PREV-UNION-TYPE               13540018
113900**MISSING ITEM FROM PACK                                          13550018
114000                    SET PS-PREPACK-ERROR-FOUND TO TRUE            13560018
114100                    MOVE PC-MISSING-ITEM-IN-PACK TO               13570018
114200                                         PV-PREPACK-ERROR-MESSAGE 13580018
114300              ELSE                                                13590018
114400                IF PV-UNION-TYPE = 'B'                            13600018
114500                   IF RECITM-ITM-NBR = PV-PREV-ITM-NBR            13610018
114600                      IF PV-RATIO-AUD-QTY = PV-PREV-RATIO-AUD-QTY 13620018
114700                        MOVE PV-UNION-TYPE  TO PV-PREV-UNION-TYPE 13630018
114800                        MOVE RECITM-ITM-NBR TO PV-PREV-ITM-NBR    13640018
114900                        MOVE PV-RATIO-AUD-QTY TO                  13650018
115000                                             PV-PREV-RATIO-AUD-QTY13660018
115100                      ELSE                                        13670018
115200                        SET PS-PREPACK-ERROR-FOUND TO TRUE        13680018
115300                        MOVE PC-WRONG-RATIO-IN-PACK TO            13690018
115400                                         PV-PREPACK-ERROR-MESSAGE 13700018
115500**WRONG RATIO ERROR                                               13710018
115600                      END-IF                                      13720018
115700                   ELSE                                           13730018
115800**WRONG RATIO ERROR                                               13740018
115900                       SET PS-PREPACK-ERROR-FOUND TO TRUE         13750018
116000                       MOVE PC-WRONG-RATIO-IN-PACK TO             13760018
116100                                         PV-PREPACK-ERROR-MESSAGE 13770018
116200                   END-IF                                         13780018
116300                ELSE                                              13790018
116400                   MOVE PV-UNION-TYPE  TO PV-PREV-UNION-TYPE      13800018
116500                   MOVE RECITM-ITM-NBR TO PV-PREV-ITM-NBR         13810018
116600                   MOVE PV-RATIO-AUD-QTY TO PV-PREV-RATIO-AUD-QTY 13820018
116700                END-IF                                            13830018
116800              END-IF                                              13840018
116900            END-IF                                                13850018
117000                                                                  13860018
117100       WHEN SQLCODE = +100                                        13870018
117200                SET  PS-EO-PREPK-CSR     TO TRUE                  13880018
117300*CHECK TO SEE IF LAST PREPACK IS AN 'A' WITH NO 'B'               13890018
117400                IF PV-UNION-TYPE  = 'A'                           13900018
117500**MISSING ITEM FROM PACK                                          13910018
117600                   SET PS-PREPACK-ERROR-FOUND TO TRUE             13920018
117700                   MOVE PC-MISSING-ITEM-IN-PACK TO                13930018
117800                                         PV-PREPACK-ERROR-MESSAGE 13940018
117900                END-IF                                            13950018
118000       WHEN OTHER                                                 13960018
118100             MOVE '6200-FETCH-PREPK-CSR'                          13970018
118200                                         TO DP013-PARAGRAPH       13980018
118300             MOVE 'FETCH PREPACK CSR'    TO DP013-MESSAGE-TEXT (1)13990018
118400             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (2)14000018
118500             MOVE SQLCA                  TO DP013-SQLCA           14010018
118600             MOVE 'TSHUUPC'            TO DP013-DB2-TABLE-NAME (1)14020018
118700             SET DP013-DB2-ABEND         TO TRUE                  14030018
118800             SET DP013-NO-ROLLBACK       TO TRUE                  14040018
118900             PERFORM 9999-WRITE-CICS-LOG-MSG                      14050018
119000                                                                  14060018
119100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               14070018
119200             MOVE -1                     TO AUPCL                 14080018
119300             PERFORM 8100-SEND-DATA-ONLY                          14090018
119400             PERFORM 8200-RETURN-TRANID                           14100018
119500     END-EVALUATE.                                                14110018
119600                                                                  14120018
108900******************************************************************14130037
119800 6300-CLOSE-PREPK-CSR.                                            14140018
119900                                                                  14150018
120000     EXEC SQL                                                     14160037
120100          CLOSE PRE_PACK_CSR                                      14170037
120200     END-EXEC.                                                    14180037
120300                                                                  14190018
120500     EVALUATE TRUE                                                14200037
120600        WHEN SQLCODE = ZERO                                       14210037
120700             CONTINUE                                             14220037
120400                                                                  14230037
120800        WHEN SQLWARN0 NOT = SPACES                                14240037
120900        WHEN SQLCODE < ZERO                                       14250037
121000        WHEN SQLCODE > ZERO                                       14260037
121100             MOVE '6300-CLOSE-PREPK-CSR' TO DP013-PARAGRAPH       14270037
121300             MOVE 'FETCH PREPACK CSR'    TO DP013-MESSAGE-TEXT (1)14280018
121400             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (2)14290018
121500             MOVE SQLCA                  TO DP013-SQLCA           14300018
121600             MOVE 'TSHUUPC'            TO DP013-DB2-TABLE-NAME (1)14310018
121700             SET DP013-DB2-ABEND         TO TRUE                  14320018
121800             SET DP013-NO-ROLLBACK       TO TRUE                  14330018
121900             PERFORM 9999-WRITE-CICS-LOG-MSG                      14340018
122000                                                                  14350018
122100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               14360018
122200             MOVE -1                     TO AUPCL                 14370018
122300             PERFORM 8100-SEND-DATA-ONLY                          14380018
122400             PERFORM 8200-RETURN-TRANID                           14390018
122500         END-EVALUATE.                                            14400018
122900                                                                  14410018
108900******************************************************************14420037
123000 6325-INSERT-TCTEXCP.                                             14430018
123100                                                                  14440018
123200     MOVE SU006-AUDIT-CNTL-NBR-X   TO CTEXCP-AUD-CNTL-NBR.        14450037
123300     MOVE SU006-SHIP-UNIT-NBR-X    TO CTEXCP-SHIPT-UNT-ID.        14460037
123400     MOVE '36'                     TO CTEXCP-VILN-GP-SEQ-NBR.     14470037
123500     MOVE PV-PREPACK-ERROR-MESSAGE TO CTEXCP-OVRRID-SYS-DAT-TXT.  14480037
123700                                                                  14490018
123800     EXEC SQL                                                     14500018
123900         INSERT INTO TCTEXCP                                      14510018
124000               (AUD_CNTL_NBR,                                     14520018
124100                SHIPT_UNT_ID,                                     14530018
124200                VILN_GP_CDE,                                      14540018
124300                VILN_GP_SEQ_NBR,                                  14550018
124400                OVRRID_SYS_DAT_TXT)                               14560018
124500         VALUES                                                   14570018
124600               (:CTEXCP-AUD-CNTL-NBR                              14580018
124700              , :CTEXCP-SHIPT-UNT-ID                              14590018
124800              , 'VA'                                              14600018
124900              , :CTEXCP-VILN-GP-SEQ-NBR                           14610018
125000              , :CTEXCP-OVRRID-SYS-DAT-TXT)                       14620018
125100     END-EXEC.                                                    14630018
125200                                                                  14640018
125300     EVALUATE TRUE                                                14650018
125400         WHEN SQLCODE = ZERO                                      14660018
125400         WHEN SQLCODE = -803                                      14670056
125500             CONTINUE                                             14680018
125600         WHEN SQLWARN0 NOT = SPACES                               14690018
125700         WHEN SQLCODE NOT EQUAL ZERO                              14700018
125800             MOVE '6325-INSERT-TCTEXCP'                           14710018
125900                             TO DP013-PARAGRAPH                   14720018
126000             MOVE 'INSERT TCTEXCP      '                          14730018
126100                             TO DP013-MESSAGE-TEXT(1)             14740018
126200             MOVE CTEXCP-SHIPT-UNT-ID                             14750018
126300                             TO DP013-MESSAGE-TEXT(2)             14760018
126400             MOVE SQLCA      TO DP013-SQLCA                       14770018
126500             MOVE 'TCTEXCP'  TO DP013-DB2-TABLE-NAME(1)           14780018
126600             SET DP013-DB2-ABEND                                  14790018
126700                             TO TRUE                              14800018
126800             SET DP013-NO-ROLLBACK                                14810018
126900                             TO TRUE                              14820018
127000             PERFORM 9999-WRITE-CICS-LOG-MSG                      14830018
127100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               14840018
127200             PERFORM 8100-SEND-DATA-ONLY                          14850018
127300             PERFORM 8200-RETURN-TRANID                           14860018
127400     END-EVALUATE.                                                14870018
127500                                                                  14880018
108900******************************************************************14890037
127700 6350-EXPAND-SCND-UNITS.                                          14900018
127800                                                                  14910018
127900     PERFORM 6400-OPEN-PREPK-UPC-CSR.                             14920018
128000     PERFORM 6500-FETCH-PREPK-UPC-CSR                             14930018
128100       UNTIL PS-EO-PREPK-UPC-CSR                                  14940018
128200     PERFORM 6600-CLOSE-PREPK-UPC-CSR.                            14950018
128300                                                                  14960018
128500******************************************************************14970018
128600 6400-OPEN-PREPK-UPC-CSR.                                         14980018
128700                                                                  14990018
128800     EXEC SQL                                                     15000037
128900          OPEN PREPK_UPC_CSR                                      15010037
129000     END-EXEC.                                                    15020037
129100                                                                  15030018
129300     EVALUATE TRUE                                                15040037
129400         WHEN SQLCODE = ZERO                                      15050037
129500              CONTINUE                                            15060037
128500                                                                  15070037
129600         WHEN SQLWARN0 NOT = SPACES                               15080037
129700         WHEN SQLCODE < ZERO                                      15090037
129800         WHEN SQLCODE > ZERO                                      15100037
129900             MOVE '6400-OPEN-PREPK-UPC-CSR'                       15110018
130000                                         TO DP013-PARAGRAPH       15120018
130100             MOVE 'OPEN EXP UPC CSR '    TO DP013-MESSAGE-TEXT (1)15130018
130200             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (2)15140018
130300             MOVE SQLCA                  TO DP013-SQLCA           15150018
130400             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)15160018
130500             SET DP013-DB2-ABEND         TO TRUE                  15170018
130600             SET DP013-NO-ROLLBACK       TO TRUE                  15180018
130700             PERFORM 9999-WRITE-CICS-LOG-MSG                      15190018
130800                                                                  15200018
130900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               15210018
131000             MOVE -1                     TO AUPCL                 15220018
131100             PERFORM 8100-SEND-DATA-ONLY                          15230018
131200             PERFORM 8200-RETURN-TRANID                           15240018
131300         END-EVALUATE.                                            15250018
131400                                                                  15260018
128500******************************************************************15270037
132000 6500-FETCH-PREPK-UPC-CSR.                                        15280018
132200                                                                  15290018
132300     EXEC SQL                                                     15300018
132400        FETCH   PREPK_UPC_CSR                                     15310018
132500        INTO   :SUAUPC-AUD-CNTL-NBR                               15320018
132600              ,:SUAUPC-SHIPT-UNT-ID                               15330018
132700              ,:SUAUPC-UPC-NBR                                    15340018
132800              ,:SUAUPC-SCN-TMST                                   15350018
132900              ,:SUAUPC-AUD-USR-ID                                 15360018
133000              ,:SUAUPC-DEPT-NBR                                   15370018
133100              ,:SUAUPC-MAJ-CL-NBR                                 15380018
133200              ,:SUAUPC-SUB-CL-NBR                                 15390018
133300              ,:SUAUPC-SKU-NBR                                    15400018
133400              ,:SUAUPC-ITM-DESC                                   15410018
133500              ,:SUAUPC-VND-STYL-DESC                              15420018
133600              ,:SUAUPC-UPC-CLOR-DESC                              15430018
133700              ,:SUAUPC-UPC-SIZE-DESC                              15440018
133800              ,:SUAUPC-UPC-RTL-AMT                                15450018
133900              ,:SUAUPC-UPC-CERTD-IND                              15460018
134000              ,:SUAUPC-SCND-UNT-QTY                               15470018
134100              ,:SUAUPC-SCN-TYP-CDE                                15480018
RFAUDT*      10/10/13 JHA BEG                                           15490029
RFAUDT              ,:SUAUPC-RFID-TGD-QTY                               15500029
RFAUDT*      10/10/13 JHA END                                           15510029
134200     END-EXEC.                                                    15520018
134300                                                                  15530018
134400     EVALUATE TRUE                                                15540018
134500       WHEN SQLCODE = ZEROS                                       15550018
134600            PERFORM 6540-PROCESS-TSUAUPC-INSERTS                  15560018
134700                                                                  15570018
134800       WHEN SQLCODE = +100                                        15580018
134900            SET  PS-EO-PREPK-UPC-CSR TO TRUE                      15590018
128500                                                                  15600037
135000       WHEN OTHER                                                 15610018
135100             MOVE '6500-FETCH-PREPK-UPC-CSR'                      15620018
135200                                         TO DP013-PARAGRAPH       15630018
135300             MOVE 'FETCH EXP UPC CSR'    TO DP013-MESSAGE-TEXT (1)15640018
135400             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (2)15650018
135500             MOVE SQLCA                  TO DP013-SQLCA           15660018
135600             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)15670018
135700             SET DP013-DB2-ABEND         TO TRUE                  15680018
135800             SET DP013-NO-ROLLBACK       TO TRUE                  15690018
135900             PERFORM 9999-WRITE-CICS-LOG-MSG                      15700018
136000                                                                  15710018
136100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               15720018
136200             MOVE -1                     TO AUPCL                 15730018
136300             PERFORM 8100-SEND-DATA-ONLY                          15740018
136400             PERFORM 8200-RETURN-TRANID                           15750018
136500     END-EVALUATE.                                                15760018
136600                                                                  15770018
128500******************************************************************15780037
136700 6540-PROCESS-TSUAUPC-INSERTS.                                    15790018
136800                                                                  15800018
136900     MOVE SUAUPC-AUD-CNTL-NBR    TO DK-AUDIT-CNTL-NBR.            15810018
137000     MOVE SUAUPC-SHIPT-UNT-ID    TO DK-SHIP-UNIT-NBR.             15820018
137100     MOVE SUAUPC-SCN-TMST        TO DK-SCN-TMST.                  15830018
137200                                                                  15840018
137300     INITIALIZE PV-SUAUPC-INSERT-COUNT.                           15850018
137400     PERFORM                                                      15860018
137500         VARYING PV-SUAUPC-INSERT-COUNT                           15870018
137600         FROM 1 BY 1                                              15880018
137700         UNTIL PV-SUAUPC-INSERT-COUNT > PV-EXPND-NBR-ROWS         15890018
137800            PERFORM 6550-INSERT-SUAUPC-XPNDED                     15900018
137900            PERFORM 6560-PROCESS-SUEXCP-RECORDS                   15910018
138000     END-PERFORM.                                                 15920018
138100                                                                  15930018
128500******************************************************************15940037
138200 6550-INSERT-SUAUPC-XPNDED.                                       15950018
138400* INSERT ROWS TO TSUAUPC BASED ON THE NUMBER OF PREPACKS          15960037
138500* PREVIOUSLY ENTERED IN SUKRF540                                  15970037
128500******************************************************************15980037
138700                                                                  15990018
138800**   MOVE SPACES                        TO SUAUPC-SKU-DEPT-NBR    16000018
138900**                                         SUAUPC-SKU-CL-NBR      16010018
139000**                                         SUAUPC-SKU-SEQ-NBR.    16020018
139100*    CONTINUE TO TRY INSERTING UNTIL SUCCESSFUL...IF -803 SQLCODE,16030018
139200*    RETRY WITH THE NEW TIMESTAMP (PART OF THE KEY)               16040018
139300     PERFORM                                                      16050018
139400         WITH TEST AFTER                                          16060018
139500         VARYING PV-RETRY-COUNTER                                 16070018
139600         FROM 1 BY 1                                              16080018
139700         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               16090018
139800                   OR (SQLCODE = ZERO))                           16100018
139900                                                                  16110018
140000         EXEC SQL                                                 16120018
140100             SET :SUAUPC-SCN-TMST = CURRENT TIMESTAMP             16130018
140200         END-EXEC                                                 16140018
140300                                                                  16150018
140400         EXEC SQL                                                 16160018
140500             INSERT INTO TSUAUPC                                  16170018
140600                 ( AUD_CNTL_NBR                                   16180018
140700                  ,SHIPT_UNT_ID                                   16190018
140800                  ,UPC_NBR                                        16200018
140900                  ,SCN_TMST                                       16210018
141000                  ,AUD_USR_ID                                     16220018
141100                  ,DEPT_NBR                                       16230018
141200                  ,MAJ_CL_NBR                                     16240018
141300                  ,SUB_CL_NBR                                     16250018
141400                  ,SKU_NBR                                        16260018
141500                  ,ITM_DESC                                       16270018
141600                  ,VND_STYL_DESC                                  16280018
141700                  ,UPC_CLOR_DESC                                  16290018
141800                  ,UPC_SIZE_DESC                                  16300018
141900                  ,UPC_RTL_AMT                                    16310018
142000                  ,UPC_CERTD_IND                                  16320018
142100                  ,SCND_UNT_QTY                                   16330018
142200                  ,SCN_TYP_CDE                                    16340018
RFAUDT*      10/10/13 JHA BEG                                           16350029
RFAUDT                  ,RFID_TGD_QTY                                   16360029
RFAUDT*      10/10/13 JHA END                                           16370029
142300                 )                                                16380018
142400             VALUES                                               16390018
142500                 (                                                16400018
142600                    :SUAUPC-AUD-CNTL-NBR                          16410018
142700                  , :SUAUPC-SHIPT-UNT-ID                          16420018
142800                  , :SUAUPC-UPC-NBR                               16430018
142900                  , :SUAUPC-SCN-TMST                              16440018
143000                  , :SUAUPC-AUD-USR-ID                            16450018
143100                  , :SUAUPC-DEPT-NBR                              16460018
143200                  , :SUAUPC-MAJ-CL-NBR                            16470018
143300                  , :SUAUPC-SUB-CL-NBR                            16480018
143400                  , :SUAUPC-SKU-NBR                               16490018
143500                  , :SUAUPC-ITM-DESC                              16500018
143600                  , :SUAUPC-VND-STYL-DESC                         16510018
143700                  , :SUAUPC-UPC-CLOR-DESC                         16520018
143800                  , :SUAUPC-UPC-SIZE-DESC                         16530018
143900                  , :SUAUPC-UPC-RTL-AMT                           16540018
144000                  , :SUAUPC-UPC-CERTD-IND                         16550018
144100                  , :SUAUPC-SCND-UNT-QTY                          16560018
144200                  , :PC-X                                         16570018
RFAUDT*      10/10/13 JHA BEG                                           16580029
RFAUDT                  , :SUAUPC-RFID-TGD-QTY                          16590029
RFAUDT*      10/10/13 JHA END                                           16600029
144300                 )                                                16610018
144400         END-EXEC                                                 16620018
144500                                                                  16630018
144600         EVALUATE TRUE                                            16640018
144700             WHEN SQLCODE = ZERO                                  16650018
144800                 MOVE SUAUPC-SCN-TMST        TO SU006-SCN-TMST    16660018
144900             WHEN SQLCODE = -803                                  16670018
145000                 CONTINUE                                         16680018
145100             WHEN SQLWARN0 NOT = SPACES                           16690018
145200             WHEN SQLCODE < ZERO                                  16700018
145300             WHEN SQLCODE > ZERO                                  16710018
145400                 MOVE '6550-INSERT-SUAUPC-XPNDED'                 16720018
145500                                             TO DP013-PARAGRAPH   16730018
145600                 MOVE 'INSERT TSUAUPC'  TO DP013-MESSAGE-TEXT(1)  16740018
145700                 MOVE SUAUPC-AUD-CNTL-NBR                         16750018
145800                                        TO PV-DISP-AUD-CNTL-NBR   16760018
145900                 MOVE SUAUPC-SHIPT-UNT-ID                         16770018
146000                                        TO PV-DISP-SHIPT-UNT-ID   16780018
146100                 MOVE SUAUPC-UPC-NBR    TO PV-DISP-UPC-NBR        16790018
146200                 MOVE SUAUPC-SCN-TMST   TO PV-DISP-SCN-TMST       16800018
146300                 MOVE PV-DISPLAY-KEYS   TO DP013-MESSAGE-TEXT(2)  16810018
146400                 MOVE SQLCA                  TO DP013-SQLCA       16820018
146500                 MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME(1) 16830018
146600                 SET DP013-DB2-ABEND         TO TRUE              16840018
146700                 SET DP013-NO-ROLLBACK       TO TRUE              16850018
146800                 PERFORM 9999-WRITE-CICS-LOG-MSG                  16860018
146900                 MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO           16870018
147000                 PERFORM 8100-SEND-DATA-ONLY                      16880018
147100                 PERFORM 8200-RETURN-TRANID                       16890018
147200         END-EVALUATE                                             16900018
147300     END-PERFORM.                                                 16910018
147400                                                                  16920018
128500******************************************************************16930037
147500 6560-PROCESS-SUEXCP-RECORDS.                                     16940018
147400                                                                  16950037
147600     PERFORM 6560-OPEN-SUEXCP-CSR.                                16960018
147700     PERFORM 6570-FETCH-SUEXCP-CSR                                16970037
147800         UNTIL PS-EO-SUEXCP-CSR.                                  16980037
147900     PERFORM 6590-CLOSE-SUEXCP.                                   16990018
148000                                                                  17000018
148100******************************************************************17010018
148200 6560-OPEN-SUEXCP-CSR.                                            17020018
148300                                                                  17030018
148400     EXEC SQL                                                     17040037
148500          OPEN SUEXCP_CSR                                         17050037
148600     END-EXEC.                                                    17060037
148700                                                                  17070018
148900     EVALUATE TRUE                                                17080037
149000         WHEN SQLCODE = ZERO                                      17090037
149100              SET PS-NOT-EO-SUEXCP-CSR TO TRUE                    17100037
148700                                                                  17110037
149200         WHEN SQLWARN0 NOT = SPACES                               17120037
149300         WHEN SQLCODE < ZERO                                      17130037
149400         WHEN SQLCODE > ZERO                                      17140037
149500             MOVE '6560-OPEN-SUEXCP-CSR'                          17150018
149600                                         TO DP013-PARAGRAPH       17160018
149700             MOVE 'OPEN SUEXCP CSR'      TO DP013-MESSAGE-TEXT (1)17170018
149800             MOVE DK-AUDIT-CNTL-NBR      TO PV-DISP-AUDIT-CNTL-NBR17180018
149900             MOVE PV-DISP-AUDIT-CNTL-NBR TO DP013-MESSAGE-TEXT (2)17190018
150000             MOVE DK-SHIP-UNIT-NBR       TO PV-DISP-SHIP-UNIT-NBR 17200018
150100             MOVE PV-DISP-SHIP-UNIT-NBR  TO DP013-MESSAGE-TEXT (3)17210018
150200             MOVE DK-SCN-TMST            TO DP013-MESSAGE-TEXT (4)17220018
150300             MOVE SQLCA                  TO DP013-SQLCA           17230018
150400             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME (1)17240018
150500             SET DP013-DB2-ABEND         TO TRUE                  17250018
150600             SET DP013-NO-ROLLBACK       TO TRUE                  17260018
150700             PERFORM 9999-WRITE-CICS-LOG-MSG                      17270018
150800                                                                  17280018
150900             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               17290018
151000             MOVE -1                     TO AUPCL                 17300018
151100             PERFORM 8100-SEND-DATA-ONLY                          17310018
151200             PERFORM 8200-RETURN-TRANID                           17320018
151300         END-EVALUATE.                                            17330018
151400                                                                  17340018
151500 EJECT                                                            17350018
151600                                                                  17360018
151700*----------------------------------------------------------------*17370018
151800*                                                                *17380018
151900*----------------------------------------------------------------*17390018
152000 6570-FETCH-SUEXCP-CSR.                                           17400018
152100                                                                  17410018
152200                                                                  17420018
152300     EXEC SQL                                                     17430018
152400        FETCH   SUEXCP_CSR                                        17440018
152500        INTO                                                      17450018
152600               :SUEXCP-AUD-CNTL-NBR                               17460018
152700             , :SUEXCP-SHIPT-UNT-ID                               17470018
152800             , :SUEXCP-UPC-NBR                                    17480018
152900             , :SUEXCP-SCN-TMST                                   17490018
153000             , :SUEXCP-VILN-GP-CDE                                17500018
153100             , :SUEXCP-VILN-GP-SEQ-NBR                            17510018
153200             , :SUEXCP-OVRRID-SYS-DAT-TXT                         17520018
153300     END-EXEC.                                                    17530018
153400                                                                  17540018
153500     EVALUATE TRUE                                                17550018
153600       WHEN SQLCODE = ZEROS                                       17560018
153700            PERFORM 6580-INSERT-SUEXCP                            17570018
153800                                                                  17580018
153900       WHEN SQLCODE = +100                                        17590018
154000            SET  PS-EO-SUEXCP-CSR TO TRUE                         17600018
154100       WHEN OTHER                                                 17610018
154200             MOVE '6570-FETCH-SUEXCP-CSR'                         17620018
154300                                         TO DP013-PARAGRAPH       17630018
154400             MOVE 'FETCH EXP UPC CSR'    TO DP013-MESSAGE-TEXT (1)17640018
154500             MOVE DK-AUDIT-CNTL-NBR      TO PV-DISP-AUDIT-CNTL-NBR17650018
154600             MOVE PV-DISP-AUDIT-CNTL-NBR TO DP013-MESSAGE-TEXT (2)17660018
154700             MOVE DK-SHIP-UNIT-NBR       TO PV-DISP-SHIP-UNIT-NBR 17670018
154800             MOVE PV-DISP-SHIP-UNIT-NBR  TO DP013-MESSAGE-TEXT (3)17680018
154900             MOVE DK-SCN-TMST            TO DP013-MESSAGE-TEXT (4)17690018
155000             MOVE SQLCA                  TO DP013-SQLCA           17700018
155100             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME (1)17710018
155200             SET DP013-DB2-ABEND         TO TRUE                  17720018
155300             SET DP013-NO-ROLLBACK       TO TRUE                  17730018
155400             PERFORM 9999-WRITE-CICS-LOG-MSG                      17740018
155500                                                                  17750018
155600             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               17760018
155700             MOVE -1                     TO AUPCL                 17770018
155800             PERFORM 8100-SEND-DATA-ONLY                          17780018
155900             PERFORM 8200-RETURN-TRANID                           17790018
156000     END-EVALUATE.                                                17800018
156100                                                                  17810018
156200                                                                  17820018
156300 6580-INSERT-SUEXCP.                                              17830018
156400                                                                  17840018
156500     EXEC SQL                                                     17850018
156600         INSERT  INTO  TSUEXCP                                    17860018
156700                (AUD_CNTL_NBR                                     17870018
156800               , SHIPT_UNT_ID                                     17880018
156900               , UPC_NBR                                          17890018
157000               , SCN_TMST                                         17900018
157100               , VILN_GP_CDE                                      17910018
157200               , VILN_GP_SEQ_NBR                                  17920018
157300               , OVRRID_SYS_DAT_TXT)                              17930018
157400         VALUES                                                   17940018
157500               (:SUEXCP-AUD-CNTL-NBR                              17950018
157600              , :SUEXCP-SHIPT-UNT-ID                              17960018
157700              , :SUEXCP-UPC-NBR                                   17970018
157800              , :SUAUPC-SCN-TMST                                  17980018
157900              , :SUEXCP-VILN-GP-CDE                               17990018
158000              , :SUEXCP-VILN-GP-SEQ-NBR                           18000018
158100              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       18010018
158200     END-EXEC.                                                    18020018
158300                                                                  18030018
158400     EVALUATE TRUE                                                18040018
158500         WHEN SQLCODE = ZERO                                      18050018
158600             CONTINUE                                             18060018
158700                                                                  18070018
158800         WHEN SQLWARN0 NOT = SPACES                               18080018
158900         WHEN SQLCODE < ZERO                                      18090018
159000         WHEN SQLCODE > ZERO                                      18100018
159100             MOVE '6580-INSERT-SUEXCP'                            18110018
159200                 TO DP013-PARAGRAPH                               18120018
159300             MOVE 'INSERT TO TSUEXCP TABLE'                       18130018
159400                 TO DP013-MESSAGE-TEXT (1)                        18140018
159500             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(2) 18150018
159600             MOVE SQLCA                  TO DP013-SQLCA           18160018
159700             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME(1) 18170018
159800             SET DP013-DB2-ABEND         TO TRUE                  18180018
159900             SET DP013-NO-ROLLBACK       TO TRUE                  18190018
160000             PERFORM 9999-WRITE-CICS-LOG-MSG                      18200018
160100             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               18210018
160200             PERFORM 8100-SEND-DATA-ONLY                          18220018
160300             PERFORM 8200-RETURN-TRANID                           18230018
160400     END-EVALUATE.                                                18240018
160500                                                                  18250018
160600 6590-CLOSE-SUEXCP.                                               18260018
160700                                                                  18270018
160800         EXEC SQL                                                 18280018
160900             CLOSE SUEXCP_CSR                                     18290018
161000         END-EXEC                                                 18300018
161100                                                                  18310018
161200                                                                  18320018
161300         EVALUATE TRUE                                            18330018
161400           WHEN SQLCODE = ZERO                                    18340018
161500               CONTINUE                                           18350018
161600           WHEN SQLWARN0 NOT = SPACES                             18360018
161700           WHEN SQLCODE < ZERO                                    18370018
161800           WHEN SQLCODE > ZERO                                    18380018
161900             MOVE '6590-CLOSE-SUEXCP'                             18390018
162000                                         TO DP013-PARAGRAPH       18400018
162100             MOVE 'CLOSE SUEXCP CSR'     TO DP013-MESSAGE-TEXT (1)18410018
162200             MOVE DK-AUDIT-CNTL-NBR      TO PV-DISP-AUDIT-CNTL-NBR18420018
162300             MOVE PV-DISP-AUDIT-CNTL-NBR TO DP013-MESSAGE-TEXT (2)18430018
162400             MOVE DK-SHIP-UNIT-NBR       TO PV-DISP-SHIP-UNIT-NBR 18440018
162500             MOVE PV-DISP-SHIP-UNIT-NBR  TO DP013-MESSAGE-TEXT (3)18450018
162600             MOVE DK-SCN-TMST            TO DP013-MESSAGE-TEXT (4)18460018
162700             MOVE SQLCA                  TO DP013-SQLCA           18470018
162800             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME (1)18480018
162900             SET DP013-DB2-ABEND         TO TRUE                  18490018
163000             SET DP013-NO-ROLLBACK       TO TRUE                  18500018
163100             PERFORM 9999-WRITE-CICS-LOG-MSG                      18510018
163200                                                                  18520018
163300             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               18530018
163400             MOVE -1                     TO AUPCL                 18540018
163500             PERFORM 8100-SEND-DATA-ONLY                          18550018
163600             PERFORM 8200-RETURN-TRANID                           18560018
163700         END-EVALUATE.                                            18570018
163800                                                                  18580018
163900                                                                  18590018
164000                                                                  18600018
164100                                                                  18610018
164200 6600-CLOSE-PREPK-UPC-CSR.                                        18620018
164300                                                                  18630018
164400         EXEC SQL                                                 18640018
164500             CLOSE PREPK_UPC_CSR                                  18650018
164600         END-EXEC                                                 18660018
164700                                                                  18670018
164800                                                                  18680018
164900         EVALUATE TRUE                                            18690018
165000           WHEN SQLCODE = ZERO                                    18700018
165100               CONTINUE                                           18710018
165200           WHEN SQLWARN0 NOT = SPACES                             18720018
165300           WHEN SQLCODE < ZERO                                    18730018
165400           WHEN SQLCODE > ZERO                                    18740018
165500             MOVE '6600-CLOSE-PREPK-UPC-CSR'                      18750018
165600                                         TO DP013-PARAGRAPH       18760018
165700             MOVE 'CLOSE PREPACK CSR'    TO DP013-MESSAGE-TEXT (1)18770018
165800             MOVE DK-SHIP-UNIT-NBR       TO DP013-MESSAGE-TEXT (2)18780018
165900             MOVE SQLCA                  TO DP013-SQLCA           18790018
166000             MOVE 'TSUAUPC'            TO DP013-DB2-TABLE-NAME (1)18800018
166100             SET DP013-DB2-ABEND         TO TRUE                  18810018
166200             SET DP013-NO-ROLLBACK       TO TRUE                  18820018
166300             PERFORM 9999-WRITE-CICS-LOG-MSG                      18830018
166400                                                                  18840018
166500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               18850018
166600             MOVE -1                     TO AUPCL                 18860018
166700             PERFORM 8100-SEND-DATA-ONLY                          18870018
166800             PERFORM 8200-RETURN-TRANID                           18880018
166900         END-EVALUATE.                                            18890018
167000                                                                  18900018
167100                                                                  18910018
167200 EJECT                                                            18920018
167300******************************************************************18930018
167400*  8000-SEND-MAP                                                 *18940018
167500*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *18950018
167600******************************************************************18960018
167700 8000-SEND-MAP.                                                   18970018
167800     EXEC CICS                                                    18980018
167900         SEND                                                     18990018
168000             MAP     ('SU518A')                                   19000018
168100             MAPSET  ('SUKM518')                                  19010018
168200             ERASE                                                19020018
168300             RESP    (PV-CICS-RESPONSE)                           19030018
168400     END-EXEC.                                                    19040018
168500                                                                  19050018
168600     EVALUATE TRUE                                                19060018
168700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 19070018
168800             CONTINUE                                             19080018
168900         WHEN OTHER                                               19090018
169000             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            19100018
169100             MOVE 'UNABLE TO SEND MAP'                            19110018
169200                                    TO DP013-MESSAGE-TEXT (1)     19120018
169300             SET DP013-CICS-ABEND   TO TRUE                       19130018
169400             SET DP013-NO-ROLLBACK  TO TRUE                       19140018
169500             PERFORM 9999-WRITE-CICS-LOG-MSG                      19150018
169600     END-EVALUATE.                                                19160018
169700*                                                                 19170018
169800 8100-SEND-DATA-ONLY.                                             19180018
169900                                                                  19190018
170000     EXEC CICS                                                    19200018
170100         SEND                                                     19210018
170200             MAP       ('SU518A')                                 19220018
170300             MAPSET    ('SUKM518')                                19230018
170400             CURSOR                                               19240018
170500             DATAONLY                                             19250018
170600             RESP      (PV-CICS-RESPONSE)                         19260018
170700     END-EXEC.                                                    19270018
170800                                                                  19280018
170900     EVALUATE TRUE                                                19290018
171000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 19300018
171100             CONTINUE                                             19310018
171200         WHEN OTHER                                               19320018
171300             MOVE '8100-SEND-DATA-ONLY'                           19330018
171400                                    TO DP013-PARAGRAPH            19340018
171500             MOVE 'UNABLE TO SEND DATA'                           19350018
171600                                    TO DP013-MESSAGE-TEXT (1)     19360018
171700             SET DP013-CICS-ABEND   TO TRUE                       19370018
171800             SET DP013-NO-ROLLBACK  TO TRUE                       19380018
171900             PERFORM 9999-WRITE-CICS-LOG-MSG                      19390018
172000     END-EVALUATE.                                                19400018
172100*                                                                 19410018
172200 8200-RETURN-TRANID.                                              19420018
172300     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          19430018
172400                                                                  19440018
172500     EXEC CICS                                                    19450018
172600         RETURN                                                   19460018
172700             TRANSID   (PC-CURRENT-TRANID)                        19470018
172800             COMMAREA  (CA-COMMAREA)                              19480018
172900             LENGTH    (PV-COMMAREA-LENGTH)                       19490018
173000             RESP      (PV-CICS-RESPONSE)                         19500018
173100     END-EXEC.                                                    19510018
173200                                                                  19520018
173300     EVALUATE TRUE                                                19530018
173400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 19540018
173500             CONTINUE                                             19550018
173600         WHEN OTHER                                               19560018
173700             MOVE '8200-RETURN-TRANID'                            19570018
173800                                    TO DP013-PARAGRAPH            19580018
173900             MOVE 'UNABLE TO RETURN TO TRANID'                    19590018
174000                                    TO DP013-MESSAGE-TEXT (1)     19600018
174100             SET DP013-CICS-ABEND   TO TRUE                       19610018
174200             SET DP013-NO-ROLLBACK  TO TRUE                       19620018
174300             PERFORM 9999-WRITE-CICS-LOG-MSG                      19630018
174400     END-EVALUATE.                                                19640018
174500*                                                                 19650018
174600*                                                                 19660018
174700 9999-WRITE-CICS-LOG-MSG.                                         19670018
174800     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            19680018
174900     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           19690018
175000     INITIALIZE DP013-SRC-TASK-NUMBER                             19700018
175100                DP013-STACK.                                      19710018
175200     SET DP013-LINK-RETURN           TO TRUE.                     19720018
175300                                                                  19730018
175400     EXEC CICS                                                    19740018
175500         LINK                                                     19750018
175600             PROGRAM   (DP013-NAME)                               19760018
175700             COMMAREA  (DP013-PARAMETERS)                         19770018
175800             LENGTH    (DP013-LENGTH)                             19780018
175900     END-EXEC.                                                    19790018
176000                                                                  19800018
176100*----------------------------------------------------------------*19810018
176200*    ABEND PROCESSOR MODULE                                      *19820018
176300*----------------------------------------------------------------*19830018
176400                                                                  19840018
176500     COPY DPPD014.                                                19850018
176600                                                                  19860018
