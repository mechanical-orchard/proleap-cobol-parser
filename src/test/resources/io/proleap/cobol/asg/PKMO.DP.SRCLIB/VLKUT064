000200*----------------------------------------------------------------*00020001
000300 IDENTIFICATION DIVISION.                                         00030001
000400*----------------------------------------------------------------*00040001
000500                                                                  00050001
000600 PROGRAM-ID.    VLKUT064.                                         00060001
000700 AUTHOR.        DENISE HAHN.                                      00070001
000800 INSTALLATION.  KOHLS.                                            00080001
000900 DATE-WRITTEN   MARCH 2021.                                       00090001
001000 DATE-COMPILED.                                                   00100001
001100                                                                  00110001
001110*----------------------------------------------------------------*00111001
001300*  EXTRACT ASN HEADER RECORDS FROM TASNHDR AND TASNORD.          *00130001
001400*  FILE WILL BE SENT TO COMPLIANCE VENDOR (TRAVERSE SYSTEMS)     *00140001
001500*----------------------------------------------------------------*00150001
ST3504***************************************************************** 00160011
ST3504* CHANGE LOG:                                                     00170011
ST3504*                                                                 00172011
ST3504* DATE  12/01/2023                                                00179911
ST3504*    CHANGE MADE:BUSINESS HAS REQUESTED TO INCLUDE SCAC CODE      00180011
ST3504*    VALUE IN THE FILE THAT WE SEND TO TRAVERSE SYSTEM.           00180111
ST3504*    HENCE ADDED CARR_ID_CDE(SCAC) COLUMN IN THE SELECT OF THE    00180211
ST3504*    ASN-CSR TO FETCH THE SCAC VALUE FROM TASNHDR TABLE AND THEN  00180311
ST3504*    WRITTEN TO ASNHDR UNLOAD FILE.THIS ASNHDR UNLOAD FILE WILL BE00180411
ST3504*    USED IN VLKUT039 PROGRAM TO CREATE THE ASNHDR AND DETAIL     00180511
ST3504*    FILE FOR TRAVERSE SYSTEM.                                    00180611
ST3504*                                                                 00180711
ST3504*    CODING TAG: ST3504                                           00180812
ST3504*    MADE BY: SARVESWARAN KANNAN      WR/IR #: CHG0297605         00180913
ST3504***************************************************************** 00181011
001810*----------------------------------------------------------------*00182011
002000 ENVIRONMENT DIVISION.                                            00200001
002010*----------------------------------------------------------------*00201001
002200                                                                  00220001
002300 CONFIGURATION SECTION.                                           00230001
002400                                                                  00240001
002500 SOURCE-COMPUTER.        IBM-3090.                                00250001
002600 OBJECT-COMPUTER.        IBM-3090.                                00260001
002700                                                                  00270001
002800 INPUT-OUTPUT SECTION.                                            00280001
002900                                                                  00290001
003000 FILE-CONTROL.                                                    00300001
003100                                                                  00310001
003200     SELECT VL-CNTL-FILE                                          00320001
003300         ASSIGN TO INP01.                                         00330001
003400                                                                  00340001
003500     SELECT EXTRACT-OUT-FILE                                      00350001
003600         ASSIGN TO OUT01.                                         00360001
003700                                                                  00370001
003800*----------------------------------------------------------------*00380001
003900 DATA DIVISION.                                                   00390001
004000*----------------------------------------------------------------*00400001
004100                                                                  00410001
004200 FILE SECTION.                                                    00420001
004300*                                                                 00430001
004400 FD  VL-CNTL-FILE                                                 00440001
004500     RECORDING MODE IS F                                          00450001
004600     LABEL RECORDS ARE STANDARD                                   00460001
004700     BLOCK CONTAINS 0 RECORDS.                                    00470001
004800 01  VL-CNTL-FILE-RECORD            PIC  X(80).                   00480001
004900*                                                                 00490001
005000*                                                                 00500001
005100 FD  EXTRACT-OUT-FILE                                             00510001
005200     RECORDING MODE IS F                                          00520001
005300     BLOCK CONTAINS 0 RECORDS                                     00530001
005400     LABEL RECORDS ARE STANDARD.                                  00540001
005500                                                                  00550001
005600 01  EXTRACT-OUT-RECORD             PIC X(225).                   00560001
005700                                                                  00570001
005800                                                                  00580001
005900*---------------------------------------------------------------* 00590001
006000 WORKING-STORAGE SECTION.                                         00600001
006010*---------------------------------------------------------------* 00601001
006300*                                                                 00630001
006400 01  ABEND-CODE                      PIC S9(04)    VALUE +0       00640001
006500                                                   COMP SYNC.     00650001
006600                                                                  00660001
006700*---------------------------------------------------------------* 00670001
006800*    INPUT CONTROL CARD                                           00680001
006810*---------------------------------------------------------------* 00681001
007000 01  CC-CONTROL-CARD.                                             00700001
007500     05  CC-FROM-TIMESTAMP           PIC X(26)     VALUE SPACES.  00750001
007600     05  FILLER                      PIC X(01)     VALUE SPACES.  00760001
007610     05  CC-TO-TIMESTAMP             PIC X(26)     VALUE SPACES.  00761001
007620     05  FILLER                      PIC X(27)     VALUE SPACES.  00762001
009100                                                                  00910001
010000 01  PC-PROGRAM-CONSTANTS.                                        01000001
010300     05  PC-MAX-RETRIES              PIC S9(04)    VALUE +3       01030001
010400                                                   COMP SYNC.     01040001
010500 01  PS-PROGRAM-SWITCHES.                                         01050001
010600     05  PS-EOF-CNTL-FILE-SW         PIC  X(01)    VALUE 'N'.     01060001
010700         88  PS-EOF-CNTL-FILE                      VALUE 'Y'.     01070001
010800         88  PS-NOT-EOF-CNTL-FILE                  VALUE 'N'.     01080001
010900     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     01090001
011000         88  PS-END-OF-CURSOR                      VALUE 'Y'.     01100001
011100         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     01110001
012700                                                                  01270001
012800 01  PV-PROGRAM-VARIABLES.                                        01280001
012900     05  PV-COUNTER                  PIC S9(09)    VALUE ZERO     01290002
012901                                                   COMP SYNC.     01290102
012910     05  PV-COUNT                    PIC S9(09)    VALUE ZERO.    01291002
013100     05  PV-NULL-IND-1               PIC S9(04)    VALUE ZEROS    01310001
013200                                                    COMP SYNC.    01320001
013300     05  PV-NULL-IND-2               PIC S9(04)    VALUE ZEROS    01330001
013400                                                    COMP SYNC.    01340001
013500     05  PV-NULL-IND-3               PIC S9(04)    VALUE ZEROS    01350001
013600                                                    COMP SYNC.    01360001
ST3504     05  PV-NULL-IND-4               PIC S9(04)    VALUE ZEROS    01370011
ST3504                                                    COMP SYNC.    01380011
014200     05  PV-FROM-TIMESTAMP           PIC X(26)     VALUE SPACES.  01420002
014210     05  PV-TO-TIMESTAMP             PIC X(26)     VALUE SPACES.  01421002
014300     05  PV-DISP-COUNT               PIC ZZZ,ZZZ,ZZ9.             01430001
014400                                                                  01440001
024600                                                                  02460001
024700 01  PV-ABEND-VARIABLES.                                          02470002
024800     05  PV-SQLCODE                  PIC S9(9).                   02480002
024900     05  PV-DISPLAY-SQLCODE          PIC -999.                    02490002
025000     05  PV-ABEND-PROGRAM            PIC X(08) VALUE 'VLKUT064'.  02500002
025100     05  PV-ABEND-PARAGRAPH          PIC X(30) VALUE SPACES.      02510002
025200     05  PV-ABEND-OPER-MESSAGE-1     PIC X(79) VALUE SPACES.      02520002
025300     05  PV-ABEND-OPER-MESSAGE-2     PIC X(79) VALUE SPACES.      02530002
025400     05  PV-ABEND-OPER-MESSAGE-3     PIC X(79) VALUE SPACES.      02540002
025500     05  PV-ABEND-OPER-MESSAGE-4     PIC X(79) VALUE SPACES.      02550002
025600     05  PV-ABEND-TABLE-1            PIC X(19) VALUE SPACES.      02560002
025700     05  PV-ABEND-TABLE-2            PIC X(19) VALUE SPACES.      02570002
025800     05  PV-ABEND-TABLE-3            PIC X(19) VALUE SPACES.      02580002
025900     05  PV-ABEND-TABLE-4            PIC X(19) VALUE SPACES.      02590002
026000                                                                  02600001
026100*---------------------------------------------------------------* 02610001
026300** OUTPUT FILE LAYOUT                                           **02630001
026310*---------------------------------------------------------------* 02631001
026500     COPY VLRD043.                                                02650001
026700                                                                  02670001
026701*---------------------------------------------------------------* 02670101
026702** ASN HEADER                                                   **02670201
026703*---------------------------------------------------------------* 02670301
026704     EXEC SQL                                                     02670401
026705          INCLUDE TASNHDR                                         02670501
026706     END-EXEC.                                                    02670601
026707                                                                  02670701
026708*---------------------------------------------------------------* 02670801
026709*  ASN DETAIL                                                     02670901
026710*---------------------------------------------------------------* 02671001
026711     EXEC SQL                                                     02671101
026712         INCLUDE TASNORD                                          02671201
026713     END-EXEC.                                                    02671301
026714                                                                  02671401
026720*---------------------------------------------------------------* 02672001
026900** DB2 FORMATTED MESSAGE AREA                                   **02690001
026910*---------------------------------------------------------------* 02691001
027100     COPY DPWS004.                                                02710001
027300                                                                  02730001
027310*---------------------------------------------------------------* 02731001
027500** COMMUNICATIONS AREA FOR DB2                                  **02750001
027510*---------------------------------------------------------------* 02751001
027700     EXEC SQL                                                     02770001
027800          INCLUDE SQLCA                                           02780001
027900     END-EXEC.                                                    02790001
028100                                                                  02810001
028200*---------------------------------------------------------------* 02820001
033200* ASN CURSOR                                                      03320001
033210*---------------------------------------------------------------* 03321001
033400     EXEC SQL                                                     03340001
033500          DECLARE ASN-CSR  CURSOR FOR                             03350001
033600            SELECT A.ASNHDR_NBR                                   03360001
033700                 , A.SHIP_DTE                                     03370001
033800                 , A.EDIISA_CNTL_TMST                             03380001
033900                 , B.ASNHDR_ID                                    03390001
034000                 , B.PO_NBR                                       03400001
034100                 , B.CART_SHIP_QTY                                03410001
034200                 , B.LOC_NBR                                      03420001
034300                 , A.BOL_NBR                                      03430001
034400                 , A.PRO_NBR                                      03440002
034500                 , A.CARR_AUTH_ID                                 03450001
ST3504                 , A.CARR_ID_CDE                                  03460011
035000              FROM TASNHDR A                                      03500001
035100                 , TASNORD B                                      03510001
035200             WHERE A.ASNHDR_TMST  >=  :PV-FROM-TIMESTAMP          03520002
035300               AND A.ASNHDR_TMST  <=  :PV-TO-TIMESTAMP            03530002
035500               AND A.ASNHDR_ID     =  B.ASNHDR_ID                 03550001
035600               AND B.MTCH_PO_CDE  <>  'U'                         03560001
035700             ORDER BY A.ASNHDR_NBR                                03570001
037100                    , B.PO_NBR                                    03710001
037200                    , B.LOC_NBR                                   03720001
038400              WITH UR                                             03840001
039200     END-EXEC.                                                    03920001
039300                                                                  03930001
039400                                                                  03940001
039500*---------------------------------------------------------------* 03950001
045500 PROCEDURE DIVISION.                                              04550001
045510*---------------------------------------------------------------* 04551001
045700                                                                  04570001
045710*---------------------------------------------------------------* 04571001
045900* 0000-PROGRAM-MAINLINE                                           04590001
046010*---------------------------------------------------------------* 04601001
046200 0000-PROGRAM-MAINLINE.                                           04620001
046300                                                                  04630001
046301     OPEN INPUT VL-CNTL-FILE                                      04630108
046302         OUTPUT EXTRACT-OUT-FILE.                                 04630208
046303                                                                  04630308
046310     DISPLAY '* START - VLKUT064'.                                04631001
046320     DISPLAY '*'.                                                 04632001
046330                                                                  04633001
046400     PERFORM 1000-INITIALIZE.                                     04640001
046500                                                                  04650001
047500     PERFORM 2000-PROCESS-ASN-CSR                                 04750001
047600       UNTIL PS-END-OF-CURSOR.                                    04760001
047700                                                                  04770001
047800     DISPLAY  '*'.                                                04780001
047810     MOVE  PV-COUNT   TO  PV-DISP-COUNT.                          04781001
047900     DISPLAY  '* OUTPUT COUNT:'  PV-DISP-COUNT.                   04790001
050500     DISPLAY  ' '.                                                05050001
052800                                                                  05280001
052900     CLOSE VL-CNTL-FILE                                           05290001
053000           EXTRACT-OUT-FILE.                                      05300001
053800                                                                  05380001
053900     STOP RUN.                                                    05390001
054000                                                                  05400001
054300                                                                  05430001
054310*---------------------------------------------------------------* 05431001
054500*  INITIALIZATION PARAGRAPH                                       05450001
054510*---------------------------------------------------------------* 05451001
054700 1000-INITIALIZE.                                                 05470001
054800                                                                  05480001
056000     PERFORM 7000-READ-CNVYR-CNTL-REC.                            05600001
056100                                                                  05610001
056110     MOVE   CC-FROM-TIMESTAMP    TO  PV-FROM-TIMESTAMP.           05611002
056120     MOVE   CC-TO-TIMESTAMP      TO  PV-TO-TIMESTAMP.             05612002
056130                                                                  05613001
056140     SET  PS-NOT-END-OF-CURSOR   TO  TRUE.                        05614001
056200     PERFORM 2050-OPEN-ASN-CSR.                                   05620002
056220     PERFORM 2060-FETCH-ASN-CSR.                                  05622002
056300                                                                  05630001
056400                                                                  05640001
056500*---------------------------------------------------------------* 05650001
069800*  PROCESS CURSOR UNTIL THEN OF FILE                              06980001
069900*---------------------------------------------------------------* 06990001
070700 2000-PROCESS-ASN-CSR.                                            07070001
070800                                                                  07080001
071300     MOVE SPACES                   TO  VL043-ASN-EXT-RECORD.      07130001
071301                                                                  07130101
071302     MOVE ASNHDR-ASNHDR-NBR        TO  VL043-ASNHDR-NBR.          07130201
071303     MOVE ASNHDR-SHIP-DTE          TO  VL043-SHIP-DTE.            07130301
071304     MOVE ASNHDR-EDIISA-CNTL-TMST  TO  VL043-EDIISA-CNTL-TMST.    07130401
071305     MOVE ASNORD-ASNHDR-ID         TO  VL043-ASNHDR-ID.           07130501
071306     MOVE ASNORD-PO-NBR            TO  VL043-PO-NBR.              07130601
071307     MOVE ASNORD-CART-SHIP-QTY     TO  VL043-CART-SHIP-QTY.       07130701
071308     MOVE ASNORD-LOC-NBR           TO  VL043-LOC-NBR.             07130801
071309     MOVE ASNHDR-BOL-NBR           TO  VL043-BOL-NBR.             07130901
071310     MOVE ASNHDR-PRO-NBR           TO  VL043-PRO-NBR.             07131001
071320     MOVE ASNHDR-CARR-AUTH-ID      TO  VL043-CARR-AUTH-ID.        07132001
ST3504     MOVE ASNHDR-CARR-ID-CDE       TO  VL043-CARR-ID-CDE.         07132111
071321                                                                  07132209
071322     PERFORM 8000-WRITE-OUTPUT-REC.                               07132309
071323                                                                  07132409
071324     PERFORM 2060-FETCH-ASN-CSR.                                  07132509
071500                                                                  07150001
072000                                                                  07200001
072100*---------------------------------------------------------------* 07210001
072300* OPEN ASN CURSOR                                                 07230001
072310*---------------------------------------------------------------* 07231001
072500 2050-OPEN-ASN-CSR.                                               07250001
072600                                                                  07260001
072700     PERFORM WITH TEST AFTER                                      07270001
072800       VARYING PV-COUNTER FROM 1 BY 1                             07280001
072900         UNTIL (PV-COUNTER > PC-MAX-RETRIES                       07290001
073000                OR                                                07300001
073100                SQLCODE = ZERO)                                   07310001
073200                                                                  07320001
073300         EXEC SQL                                                 07330001
073400              OPEN ASN-CSR                                        07340001
073500         END-EXEC                                                 07350001
073600                                                                  07360001
073700         EVALUATE TRUE                                            07370001
073800             WHEN SQLCODE = +0                                    07380001
073900             WHEN SQLCODE = -904                                  07390001
074000             WHEN SQLCODE = -911                                  07400001
074100             WHEN SQLCODE = -913                                  07410001
074200                 CONTINUE                                         07420001
074300             WHEN SQLWARN0 NOT EQUAL SPACE                        07430001
074400             WHEN SQLCODE NOT EQUAL ZERO                          07440001
074500                 MOVE '2050-OPEN-ASN-CSR'                         07450001
074600                                      TO PV-ABEND-PARAGRAPH       07460001
074700                 MOVE 'ERROR OPENING ASN CURSOR'                  07470001
074800                                      TO PV-ABEND-OPER-MESSAGE-1  07480001
074900                 STRING PV-FROM-TIMESTAMP '-'                     07490004
074910                        PV-TO-TIMESTAMP  DELIMITED BY SIZE        07491004
075000                                    INTO PV-ABEND-OPER-MESSAGE-2  07500004
075500                 MOVE 'TASNHDR'       TO PV-ABEND-TABLE-1         07550001
075600                 MOVE 'TASNORD'       TO PV-ABEND-TABLE-2         07560001
075900                 PERFORM 9100-SQL-ABEND                           07590001
076000         END-EVALUATE                                             07600001
076100     END-PERFORM.                                                 07610001
076200                                                                  07620001
076300     IF  PV-COUNTER > PC-MAX-RETRIES                              07630001
076400         MOVE '2050-OPEN-ASN-CSR'                                 07640001
076500                                      TO PV-ABEND-PARAGRAPH       07650001
076600         MOVE 'MAX RETRIES ERROR OPENING ASN CURSOR'              07660001
076700                                      TO PV-ABEND-OPER-MESSAGE-1  07670001
076800         STRING PV-FROM-TIMESTAMP '-'                             07680005
076900                PV-TO-TIMESTAMP          DELIMITED BY SIZE        07690005
077000                                    INTO PV-ABEND-OPER-MESSAGE-2  07700005
077300         MOVE 'TASNHDR'               TO PV-ABEND-TABLE-1         07730001
077400         MOVE 'TASNORD'               TO PV-ABEND-TABLE-2         07740001
077700         PERFORM 9100-SQL-ABEND                                   07770001
077800     END-IF.                                                      07780001
077900                                                                  07790001
078000                                                                  07800001
078010*---------------------------------------------------------------* 07801001
078200* FETCH A ROW FROM THE AUDIT CONTROL GROUP CURSOR.               *07820001
078210*---------------------------------------------------------------* 07821001
078400 2060-FETCH-ASN-CSR.                                              07840001
078500                                                                  07850001
078600     EXEC SQL                                                     07860001
078700          FETCH ASN-CSR                                           07870001
078800           INTO :ASNHDR-ASNHDR-NBR                                07880001
078900               ,:ASNHDR-SHIP-DTE                                  07890001
079000               ,:ASNHDR-EDIISA-CNTL-TMST                          07900001
079100               ,:ASNORD-ASNHDR-ID                                 07910001
079200               ,:ASNORD-PO-NBR                                    07920001
079210               ,:ASNORD-CART-SHIP-QTY                             07921001
079220               ,:ASNORD-LOC-NBR                                   07922001
079300               ,:ASNHDR-BOL-NBR      :PV-NULL-IND-1               07930001
079400               ,:ASNHDR-PRO-NBR      :PV-NULL-IND-2               07940001
079500               ,:ASNHDR-CARR-AUTH-ID :PV-NULL-IND-3               07950001
ST3504               ,:ASNHDR-CARR-ID-CDE  :PV-NULL-IND-4               07951011
079600     END-EXEC.                                                    07960001
079700                                                                  07970001
079800     EVALUATE TRUE                                                07980001
079900       WHEN SQLCODE = ZERO                                        07990001
079910             IF  PV-NULL-IND-1  =  -1                             07991001
079920                 MOVE SPACES  TO  ASNHDR-BOL-NBR                  07992001
079930             END-IF                                               07993001
079940             IF  PV-NULL-IND-2  =  -1                             07994001
079950                 MOVE SPACES  TO  ASNHDR-PRO-NBR                  07995001
079960             END-IF                                               07996001
079970             IF  PV-NULL-IND-3  =  -1                             07997001
079980                 MOVE SPACES  TO  ASNHDR-CARR-AUTH-ID             07998001
079990             END-IF                                               07999001
ST3504             IF  PV-NULL-IND-4  =  -1                             08000011
ST3504                 MOVE SPACES  TO  ASNHDR-CARR-ID-CDE              08010011
ST3504             END-IF                                               08020011
081000                                                                  08100001
081100       WHEN SQLCODE = +100                                        08110001
081200           SET PS-END-OF-CURSOR      TO TRUE                      08120001
081210                                                                  08121001
081300       WHEN SQLWARN0 NOT EQUAL SPACE                              08130001
081400       WHEN SQLCODE NOT EQUAL ZERO                                08140001
081500           MOVE '2060-FETCH-ASN-CSR'                              08150001
081600                                     TO PV-ABEND-PARAGRAPH        08160001
081700           MOVE 'FETCH ASN CURSOR ROW'                            08170001
081800                                     TO PV-ABEND-OPER-MESSAGE-1   08180001
081900           STRING PV-FROM-TIMESTAMP '-'                           08190005
082000                  PV-TO-TIMESTAMP       DELIMITED BY SIZE         08200005
082100                                   INTO PV-ABEND-OPER-MESSAGE-2   08210005
082400           MOVE 'TASNHDR'            TO PV-ABEND-TABLE-1          08240001
082500           MOVE 'TASNORD'            TO PV-ABEND-TABLE-2          08250001
082800           PERFORM 9100-SQL-ABEND                                 08280001
082900     END-EVALUATE.                                                08290001
083000                                                                  08300001
083100                                                                  08310001
083110*---------------------------------------------------------------* 08311001
083300* CLOSE THE CONVEYOR VENDOR CURSOR                                08330001
083310*---------------------------------------------------------------* 08331001
083500 2070-CLOSE-ASN-CSR.                                              08350001
083600                                                                  08360001
083700     PERFORM                                                      08370001
083800         WITH TEST AFTER                                          08380001
083900         VARYING PV-COUNTER                                       08390001
084000         FROM 1 BY 1                                              08400001
084100         UNTIL ((PV-COUNTER > PC-MAX-RETRIES)                     08410001
084200                   OR (SQLCODE = ZERO))                           08420001
084300         EXEC SQL                                                 08430001
084400             CLOSE ASN-CSR                                        08440001
084500         END-EXEC                                                 08450001
084600                                                                  08460001
084700         EVALUATE TRUE                                            08470001
084800             WHEN SQLCODE = +0                                    08480001
084900             WHEN SQLCODE = -904                                  08490001
085000             WHEN SQLCODE = -911                                  08500001
085100             WHEN SQLCODE = -913                                  08510001
085200                 CONTINUE                                         08520001
085300             WHEN SQLWARN0 NOT EQUAL SPACE                        08530001
085400             WHEN SQLCODE NOT EQUAL ZERO                          08540001
085500                 MOVE '2070-CLOSE-ASN-CSR'                        08550001
085600                                      TO PV-ABEND-PARAGRAPH       08560001
085700                 MOVE 'ERROR CLOSING ASN CURSOR'                  08570001
085800                                      TO PV-ABEND-OPER-MESSAGE-1  08580001
085900                 STRING PV-FROM-TIMESTAMP '-'                     08590005
086000                        PV-TO-TIMESTAMP  DELIMITED BY SIZE        08600005
086100                                    INTO PV-ABEND-OPER-MESSAGE-2  08610007
086500                 MOVE 'TASNHDR'       TO PV-ABEND-TABLE-1         08650001
086600                 MOVE 'TASNORD'       TO PV-ABEND-TABLE-2         08660001
086900                 PERFORM 9100-SQL-ABEND                           08690001
087000         END-EVALUATE                                             08700001
087100     END-PERFORM.                                                 08710001
087200                                                                  08720001
087300     IF  PV-COUNTER > PC-MAX-RETRIES                              08730001
087400         MOVE '2070-CLOSE-ASN-CSR'                                08740001
087500                                      TO PV-ABEND-PARAGRAPH       08750001
087600         MOVE 'MAX RETRIES ERROR CLOSING ASN CURSOR'              08760001
087700                                      TO PV-ABEND-OPER-MESSAGE-1  08770001
087800         STRING PV-FROM-TIMESTAMP '-'                             08780005
087900                PV-TO-TIMESTAMP          DELIMITED BY SIZE        08790005
088000                                    INTO PV-ABEND-OPER-MESSAGE-2  08800006
088300         MOVE 'TASNHDR'               TO PV-ABEND-TABLE-1         08830001
088400         MOVE 'TASNORD'               TO PV-ABEND-TABLE-2         08840002
088700         PERFORM 9100-SQL-ABEND                                   08870001
088800     END-IF.                                                      08880001
088900                                                                  08890001
089000                                                                  08900001
190100*----------------------------------------------------------------*19010001
190200*  READ CONTROL RECORD                                            19020001
190300*----------------------------------------------------------------*19030001
190400 7000-READ-CNVYR-CNTL-REC.                                        19040001
190410                                                                  19041001
190500     READ VL-CNTL-FILE                                            19050001
190600         INTO CC-CONTROL-CARD                                     19060001
190700             AT END                                               19070001
190800                 SET PS-EOF-CNTL-FILE TO TRUE.                    19080001
190900                                                                  19090001
191000         DISPLAY '*'.                                             19100001
191100         DISPLAY '* FROM:' CC-FROM-TIMESTAMP.                     19110001
191110         DISPLAY '* TO:  ' CC-TO-TIMESTAMP.                       19111001
191200         DISPLAY '*'.                                             19120001
191700                                                                  19170001
191800                                                                  19180001
191810*----------------------------------------------------------------*19181001
191820*  WRITE OUTPUT RECORD                                            19182001
191830*----------------------------------------------------------------*19183001
191840 8000-WRITE-OUTPUT-REC.                                           19184001
191850                                                                  19185001
191860     WRITE EXTRACT-OUT-RECORD                                     19186001
191870      FROM VL043-ASN-EXT-RECORD.                                  19187001
191880                                                                  19188001
191890     ADD  1  TO  PV-COUNT.                                        19189001
191891                                                                  19189101
191897                                                                  19189701
191898*----------------------------------------------------------------*19189801
191900*                                                                 19190001
191902*----------------------------------------------------------------*19190201
192000 9100-SQL-ABEND.                                                  19200001
192400     MOVE SQLCODE    TO PV-SQLCODE.                               19240001
192500     MOVE PV-SQLCODE TO PV-DISPLAY-SQLCODE.                       19250001
192600                                                                  19260001
192700     DISPLAY '9100-SQL-ABEND'.                                    19270001
192800     DISPLAY '** ABEND              **'.                          19280001
192900     DISPLAY '** SQLCODE            ** = ' PV-DISPLAY-SQLCODE.    19290001
193000     DISPLAY '** PROGRAM            ** = ' PV-ABEND-PROGRAM.      19300002
193100     DISPLAY '** PARAGRAPH          ** = ' PV-ABEND-PARAGRAPH.    19310001
193200     DISPLAY '** TABLE(S) AFFECTED  ** = ' PV-ABEND-TABLE-1.      19320001
193300     DISPLAY '**                    ** = ' PV-ABEND-TABLE-2.      19330001
193400     DISPLAY '**                    ** = ' PV-ABEND-TABLE-3.      19340001
193500     DISPLAY '**                    ** = ' PV-ABEND-TABLE-4.      19350001
193600     DISPLAY '** OPERATION          ** = ' PV-ABEND-OPER-MESSAGE-119360001
193700     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-219370001
193800     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-319380001
193900     DISPLAY '**                    ** = ' PV-ABEND-OPER-MESSAGE-419390001
194000     DISPLAY '**                    ** = '                        19400001
194100                                                                  19410001
194110*---------------------------------------------------------------* 19411001
194300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    19430001
194400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         19440001
194500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     19450001
194600* FORMAT.                                                         19460001
194610*---------------------------------------------------------------* 19461001
194800     COPY DPPD004.                                                19480001
194900                                                                  19490001
195000     MOVE +4013                  TO ABEND-CODE.                   19500001
195100     CALL 'ILBOABN0' USING ABEND-CODE.                            19510001
