000100*-----------------------*                                         00010099
000200 IDENTIFICATION DIVISION.                                         00020099
000300*-----------------------*                                         00030099
000400 PROGRAM-ID.    CEKCS614.                                         00040099
000500 AUTHOR.        JOE LAROSA.                                       00050099
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060099
000700 DATE-WRITTEN.  JULY 2000.                                        00070099
000800 DATE-COMPILED.                                                   00080099
000900*---------------------------------------------------------------* 00090099
001000*    S614 - CENTRAL STOCK STORE ADJUSTMENT LIST                 * 00100099
001100*---------------------------------------------------------------* 00110099
263455* CHANGED 10/29/2021    BY JIM HUNTER      WR: CHG0263455         00111099
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00112099
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00113099
263455*----------------------------------------------------------------*00114099
CICS  * CHANGED 10/20/2022    BY JIM HUNTER      WR: CHG0276924         00115099
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00116099
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00117099
CICS  *-----------------------------------------------------------------00118099
001200 ENVIRONMENT DIVISION.                                            00120099
001300 DATA DIVISION.                                                   00130099
001400                                                                  00140099
001500 WORKING-STORAGE SECTION.                                         00150099
001600 01  PS-PROGRAM-SWITCHES.                                         00160099
001700     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00170099
001800         88  PS-NO-ERROR                            VALUE 'Y'.    00180099
001900         88  PS-ERROR                               VALUE 'N'.    00190099
002000     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE 'N'.    00200099
002100         88  PS-SOFT-ABORT-ERROR                    VALUE 'Y'.    00210099
002200         88  PS-NO-SOFT-ABORT-ERROR                 VALUE 'N'.    00220099
002300     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00230099
002400         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00240099
002500         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00250099
002600     05  PS-LIST-END-SW                 PIC  X(01)  VALUE 'N'.    00260099
002700         88  PS-LIST-END                            VALUE 'Y'.    00270099
002800         88  PS-NO-LIST-END                         VALUE 'N'.    00280099
002900                                                                  00290099
003000 01  DK-DB2-KEYS.                                                 00300099
003100     15  DK-PULL-NUMBER            PIC S9(09)  VALUE ZERO COMP.   00310099
003200     15  DK-LINE-NUMBER            PIC S9(04)  VALUE ZERO COMP.   00320099
003300     15  DK-STR-NUMBER             PIC S9(04)  VALUE ZERO COMP.   00330099
003400                                                                  00340099
003500 01  PC-PROGRAM-CONSTANTS.                                        00350099
003600     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CE614A  '.  00360099
003700     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CEKM614 '.  00370099
003800     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CEKCS614'.  00380099
003900     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00390099
004000     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00400099
004100                                                                  00410099
004200     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +10          00420099
004300                                               COMP SYNC.         00430099
004400     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00440099
004500                                               COMP SYNC.         00450099
004600     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00460099
004700                                               COMP-3.            00470099
004800     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00480099
004900                                               COMP SYNC.         00490099
005000     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00500099
005100                                               COMP-3.            00510099
005200     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00520099
005300     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00530099
005400     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00540099
005500     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00550099
005600                                                                  00560099
005700*----------------------------------------------------------------*00570099
005800*  SYSTEM MESSAGES                                               *00580099
005900*----------------------------------------------------------------*00590099
006000*   00005 = INVALID VALUE                                        *00600099
006100*   00008 = MUST BE NUMERIC                                      *00610099
006200*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00620099
006300*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00630099
006400*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00640099
006500*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00650099
006600*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00660099
006700*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00670099
006800*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00680099
006900*   00069 - TOP OF LIST                                          *00690099
007000*   00070 - BOTTOM OF LIST                                       *00700099
007100*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00710099
007200*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00720099
007300*   00279 - MORE ITEMS TO DISPLAY                                *00730099
007400*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00740099
007500*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00750099
007600*   02234 = PRINT REQUEST HAS BEEN COMPLETED FOR SELECTED LIME(S)*00760099
007700*   02238 = PRINT PROBLEM, TRY AGAIN - LINES UP TO THIS POINT    *00770099
007800*   02245 = CANNOT UPDATE ACTUAL UNITS - PULL LINE ITEM HAS BEEN *00780099
007900*   02252 = UPDATE REQUEST HAS BEEN COMPLETED FOR SELECTED LINE(S*00790099
008000*   02229 = YOU DO NOT HAVE AUTHORITY TO ADD STORE DISTRIBUTION   00800099
008100*   02333 = CANNOT ADD STORE DISTRIBUTION - STATUS IS POSTED/DISTR00810099
008200*   02355 = CANNOT ADJUST STORE DISTRIBUTION - LINE STATUS IS NEW 00820099
008300*   99901 = INVALID COMMAND WAS ENTERED                          *00830099
008400*----------------------------------------------------------------*00840099
008500     05  PC-TSYMSG-NUMBERS.                                       00850099
008600         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00860099
008700         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00870099
008800         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00880099
008900         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00890099
009000         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00900099
009100         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00910099
009200         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00920099
009300         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00930099
009400         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00940099
009500         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00950099
009600         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00960099
009700         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00970099
009800         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00980099
009900         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  00990099
010000         10  PC-TSYMSG-00746            PIC  9(05)  VALUE 00746.  01000099
010100         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  01010099
010200         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01020099
010300         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  01030099
010400         10  PC-TSYMSG-02234            PIC  9(05)  VALUE 02234.  01040099
010500         10  PC-TSYMSG-02238            PIC  9(05)  VALUE 02238.  01050099
010600         10  PC-TSYMSG-02245            PIC  9(05)  VALUE 02245.  01060099
010700         10  PC-TSYMSG-02252            PIC  9(05)  VALUE 02252.  01070099
010800         10  PC-TSYMSG-02329            PIC  9(05)  VALUE 02329.  01080099
010900         10  PC-TSYMSG-02333            PIC  9(05)  VALUE 02333.  01090099
011000         10  PC-TSYMSG-02355            PIC  9(05)  VALUE 02355.  01100099
011100         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01110099
011200*                                                                 01120099
011300 01  PV-PROGRAM-VARIABLES.                                        01130099
011400     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01140099
011500                                        COMP SYNC.                01150099
011600     05  PV-SUB                         PIC S9(04)  VALUE +0      01160099
011700                                                    COMP SYNC.    01170099
011800     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01180099
011900                                                    COMP SYNC.    01190099
012000     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01200099
012100                                                    COMP-3.       01210099
012200     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01220099
012300                                                    COMP-3.       01230099
012400     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01240099
012500                                                    COMP-3.       01250099
012600     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01260099
012700                                                    COMP-3.       01270099
012800     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01280099
012900                                                    COMP-3.       01290099
013000     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01300099
013100                                                    COMP-3.       01310099
013200     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01320099
013300                                                    COMP-3.       01330099
013400     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01340099
013500                                                    COMP SYNC.    01350099
013600     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01360099
013700                                                    COMP SYNC.    01370099
013800     05  PV-ITEM                        PIC S9(04)  VALUE +0      01380099
013900                                                    COMP SYNC.    01390099
014000     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01400099
014100                                                    COMP SYNC.    01410099
014200     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01420099
014300                                                    COMP SYNC.    01430099
014400     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01440099
014500                                                    COMP SYNC.    01450099
014600     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01460099
014700                                                    COMP SYNC.    01470099
014800     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01480099
014900                                                    COMP SYNC.    01490099
015000     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01500099
015100                                                    COMP SYNC.    01510099
015200     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01520099
015300                                                    COMP SYNC.    01530099
015400     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      01540099
015500                                                    COMP SYNC.    01550099
015600     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01560099
015700                                                    COMP SYNC.    01570099
015800     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      01580099
015900                                                    COMP.         01590099
016000     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      01600099
016100                                                    COMP.         01610099
016200     05  PV-SOFT-ABORT-MSG.                                       01620099
016300         10  FILLER            PIC X(12) VALUE ' CEKCS614 - '.    01630099
016400         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       01640099
016500         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    01650099
016600         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    01660099
016700         10  PV-SOFT-PARAGRAPH PIC X(30).                         01670099
016800     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     01680099
016900                                                     COMP SYNC.   01690099
017000     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 01700099
017100     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 01710099
017200                                                                  01720099
017300     05  PV-SKU-10.                                               01730099
017400         10  PV-SKU-10-1            PIC X(03).                    01740099
017500         10  PV-SKU-A               PIC X(01).                    01750099
017600         10  PV-SKU-10-2            PIC X(02).                    01760099
017700         10  PV-SKU-B               PIC X(01).                    01770099
017800         10  PV-SKU-10-3            PIC X(03).                    01780099
017900     05  PV-SKU-8.                                                01790099
018000         10  PV-SKU-8-1             PIC X(03).                    01800099
018100         10  PV-SKU-8-2             PIC X(02).                    01810099
018200         10  PV-SKU-8-3             PIC X(03).                    01820099
018300     05  PV-CEPLAU-ADJUST-QTY       PIC S9(09) VALUE ZEROES COMP. 01830099
018400     05  PV-CEPLAU-TMST.                                          01840099
018500         10   PV-CEPLAU-CC          PIC X(02).                    01850099
018600         10   PV-CEPLAU-YY          PIC X(02).                    01860099
018700         10   FILLER                PIC X(01).                    01870099
018800         10   PV-CEPLAU-MM          PIC X(02).                    01880099
018900         10   FILLER                PIC X(01).                    01890099
019000         10   PV-CEPLAU-DD          PIC X(02).                    01900099
019100         10   FILLER                PIC X(01).                    01910099
019200         10   PV-CEPLAU-HR          PIC X(02).                    01920099
019300         10   FILLER                PIC X(01).                    01930099
019400         10   PV-CEPLAU-MIN         PIC X(02).                    01940099
019500         10   FILLER                PIC X(10).                    01950099
019600                                                                  01960099
019700     05  PV-CEPLAU-TMST-FORMAT.                                   01970099
019800         10   PV-CEPLAU-MM-F        PIC X(02).                    01980099
019900         10   FILLER                PIC X(01)   VALUE '/'.        01990099
020000         10   PV-CEPLAU-DD-F        PIC X(02).                    02000099
020100         10   FILLER                PIC X(01)   VALUE '/'.        02010099
020200         10   PV-CEPLAU-CC-F        PIC X(02).                    02020099
020300         10   PV-CEPLAU-YY-F        PIC X(02).                    02030099
020400         10   FILLER                PIC X(01)   VALUE SPACES.     02040099
020500         10   PV-CEPLAU-HR-F        PIC X(02).                    02050099
020600         10   FILLER                PIC X(01)   VALUE ':'.        02060099
020700         10   PV-CEPLAU-MIN-F       PIC X(02).                    02070099
020800     05  PV-CEPLAU-TMST-DISPLAY REDEFINES PV-CEPLAU-TMST-FORMAT   02080099
020900                                    PIC X(16).                    02090099
021000     05  PV-DISPLAY-ZERO                 PIC  Z(03)9.             02100099
021100                                                                  02110099
021200     05  PV-SELECT-LIST-SEQ              PIC  X(01) VALUE SPACES. 02120099
021300     05  PV-SEL-TERM-ID                  PIC  X(04).              02130099
021400     05  PV-SEL-TASK-NUMBER              PIC  9(05).              02140099
021500     05  PV-SEL-SEQ                      PIC  9(01).              02150099
021600                                                                  02160099
021700******************************************************************02170099
021800**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02180099
021900**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02190099
022000**  APPLICATION-SPECIFIC COMMAREA.                              **02200099
022100******************************************************************02210099
022200 01  LQW-LIST-QUEUE-WORK-AREA.                                    02220099
022300     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02230099
022400     05  LQW-ITEM-ENTRIES               OCCURS 10 TIMES           02240099
022500                                        INDEXED BY LQW-IDX.       02250099
022600         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02260099
022700         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02270099
022800         10  LQW-SELECTED-SW            PIC  X(01).               02280099
022900             88  LQW-SELECT                         VALUE 'S'.    02290099
023000             88  LQW-DESELECT                       VALUE ' '.    02300099
023100         10  LQW-ACTION                 PIC  X(03).               02310099
023200             88  LQW-DEL                            VALUE 'DEL'.  02320099
023300             88  LQW-INQ                            VALUE 'INQ'.  02330099
023400             88  LQW-UPD                            VALUE 'UPD'.  02340099
023500             88  LQW-ERR                            VALUE 'ERR'.  02350099
023600         10  LQW-STORE-NUMBER           PIC  9(04).               02360099
023700         10  LQW-DATE-TIME              PIC  X(16).               02370099
023800         10  LQW-ADJ-TMST               PIC  X(26).               02380099
023900         10  LQW-ADJ-UNITS              PIC  Z(05)-.              02390099
024000         10  LQW-BEF-UNITS              PIC  Z(05).               02400099
024100         10  LQW-AFT-UNITS              PIC  Z(05).               02410099
024200         10  LQW-ADJ-BY                 PIC  X(08).               02420099
024300         10  LQW-BATCH-NBR              PIC  X(03).               02430099
024400                                                                  02440099
024500*---------------------------------------------------------------* 02450099
024600* SELECTON QUEUE LAYOUT                                         * 02460099
024700*---------------------------------------------------------------* 02470099
024800     COPY CEWS003.                                                02480099
024900                                                                  02490099
025000*---------------------------------------------------------------* 02500099
025100*    MAP LAYOUT                                                 * 02510099
025200*---------------------------------------------------------------* 02520099
025300     COPY CEKM614.                                                02530099
025400                                                                  02540099
025500 01  MR-OCCURS-LAYOUT REDEFINES CE614AO.                          02550099
025600     05  FILLER                         PIC X(159).               02560099
025700     05  MR-SCROLL-AREA                 OCCURS 10 TIMES.          02570099
025800         10  MR-SELECTL                 PIC S9(04) COMP.          02580099
025900         10  MR-SELECTA                 PIC  X(01).               02590099
026000         10  MR-SELECTC                 PIC  X(01).               02600099
026100         10  MR-SELECTH                 PIC  X(01).               02610099
026200         10  MR-SELECTI                 PIC  X(01).               02620099
026300                                                                  02630099
026400         10  MR-ACTIONL                 PIC S9(04) COMP.          02640099
026500         10  MR-ACTIONA                 PIC  X(01).               02650099
026600         10  MR-ACTIONC                 PIC  X(01).               02660099
026700         10  MR-ACTIONH                 PIC  X(01).               02670099
026800         10  MR-ACTION                  PIC  X(03).               02680099
026900                                                                  02690099
027000         10  MR-STORE-NUMBERL           PIC S9(04) COMP.          02700099
027100         10  MR-STORE-NUMBERA           PIC  X(01).               02710099
027200         10  MR-STORE-NUMBERC           PIC  X(01).               02720099
027300         10  MR-STORE-NUMBERH           PIC  X(01).               02730099
027400         10  MR-STORE-NUMBER-X.                                   02740099
027500             15  MR-STORE-NUMBER        PIC  Z(04).               02750099
027600                                                                  02760099
027700         10  MR-DATE-TIMEL              PIC S9(04) COMP.          02770099
027800         10  MR-DATE-TIMEA              PIC  X(01).               02780099
027900         10  MR-DATE-TIMEC              PIC  X(01).               02790099
028000         10  MR-DATE-TIMEH              PIC  X(01).               02800099
028100         10  MR-DATE-TIME               PIC  X(16).               02810099
028200                                                                  02820099
028300         10  MR-ADJ-UNITSL              PIC S9(04) COMP.          02830099
028400         10  MR-ADJ-UNITSA              PIC  X(01).               02840099
028500         10  MR-ADJ-UNITSC              PIC  X(01).               02850099
028600         10  MR-ADJ-UNITSH              PIC  X(01).               02860099
028700         10  MR-ADJ-UNITS               PIC  Z(5)-.               02870099
028800                                                                  02880099
028900         10  MR-BEF-UNITSL              PIC S9(04) COMP.          02890099
029000         10  MR-BEF-UNITSA              PIC  X(01).               02900099
029100         10  MR-BEF-UNITSC              PIC  X(01).               02910099
029200         10  MR-BEF-UNITSH              PIC  X(01).               02920099
029300         10  MR-BEF-UNITS               PIC  Z(4)9.               02930099
029400                                                                  02940099
029500         10  MR-AFT-UNITSL              PIC S9(04) COMP.          02950099
029600         10  MR-AFT-UNITSA              PIC  X(01).               02960099
029700         10  MR-AFT-UNITSC              PIC  X(01).               02970099
029800         10  MR-AFT-UNITSH              PIC  X(01).               02980099
029900         10  MR-AFT-UNITS               PIC  Z(4)9.               02990099
030000                                                                  03000099
030100         10  MR-ADJ-BYL                 PIC S9(04) COMP.          03010099
030200         10  MR-ADJ-BYA                 PIC  X(01).               03020099
030300         10  MR-ADJ-BYC                 PIC  X(01).               03030099
030400         10  MR-ADJ-BYH                 PIC  X(01).               03040099
030500         10  MR-ADJ-BY                  PIC  X(08).               03050099
030600                                                                  03060099
030700         10  MR-BATCH-NBRL              PIC S9(04) COMP.          03070099
030800         10  MR-BATCH-NBRA              PIC  X(01).               03080099
030900         10  MR-BATCH-NBRC              PIC  X(01).               03090099
031000         10  MR-BATCH-NBRH              PIC  X(01).               03100099
031100         10  MR-BATCH-NBR               PIC  X(03).               03110099
031200                                                                  03120099
031300     05  FILLER                         PIC  X(12).               03130099
031400                                                                  03140099
031500*----------------------------------------------------------------*03150099
031600**  SECURITY SUBROUTINE PARAMETERS                                03160099
031700*----------------------------------------------------------------*03170099
031800     COPY DPWS008.                                                03180099
031900                                                                  03190099
032000*---------------------------------------------------------------* 03200099
032100*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03210099
032200*---------------------------------------------------------------* 03220099
032300     COPY DPWS015.                                                03230099
032400                                                                  03240099
032500*---------------------------------------------------------------* 03250099
032600*    FUNCTION KEYS COPYBOOK.                                    * 03260099
032700*---------------------------------------------------------------* 03270099
032800     COPY DPWS016.                                                03280099
032900                                                                  03290099
033000*---------------------------------------------------------------* 03300099
033100*    NUMERIC EDIT LAYOUT.                                       * 03310099
033200*---------------------------------------------------------------* 03320099
033300     COPY DPWS010I.                                               03330099
033400                                                                  03340099
033500*---------------------------------------------------------------* 03350099
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 03361099
033700*---------------------------------------------------------------* 03370099
033800     COPY DPWS030.                                                03380099
CICS       COPY DPWS930.                                                03381099
033900                                                                  03390099
034000*---------------------------------------------------------------* 03400099
034100*    STANDARD COMMAREA.                                         * 03410099
034200*---------------------------------------------------------------* 03420099
034300     COPY DPWS020.                                                03430099
034400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                03440099
034500         10  INTER-APPL-COMM-AREA       PIC X(200).               03450099
034600     COPY CEWS002.                                                03460099
034700*---------------------------------------------------------------* 03470099
034800*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 03480099
034900*---------------------------------------------------------------* 03490099
035000         10  ASC-SPECIFIC-COMMAREA.                               03500099
035100             15  ASC-CS-LOC                   PIC  9(04).         03510099
035200             15  ASC-PULL-NBR                 PIC  9(09).         03520099
035300             15  ASC-LINE-NBR                 PIC  9(04).         03530099
035400             15  ASC-KEY-STORE-NBR            PIC  9(04).         03540099
035500             15  ASC-KEY-STORE-NBR-N          PIC  9(04).         03550099
035600             15  ASC-KEY-STORE-NBR-A REDEFINES                    03560099
035700                 ASC-KEY-STORE-NBR-N          PIC  X(04).         03570099
035800             15  ASC-SKU-NUMBER               PIC  X(08).         03580099
035900             15  ASC-SKU-RETAIL               PIC S9(05)V99.      03590099
036000                                                                  03600099
036100             15  ASC-MANIFEST-UNTS            PIC S9(05).         03610099
036200             15  ASC-ADJUST-UNTS              PIC  Z(05)-.        03620099
036300             15  ASC-DISTRB-UNTS              PIC S9(05).         03630099
036400             15  ASC-DISTRB-RETAIL            PIC S9(07)V99.      03640099
036410             15  ASC-DISPLAY-SW               PIC  X(01).         03641099
036420                 88  ASC-DISPLAY-ALL               VALUE 'A'.     03642099
036430                 88  ASC-DISPLAY-ONE               VALUE 'B'.     03643099
036500*-----------------------------------------------------------------03644099
036600             15  ASC-BLK-SUB                  PIC S9(04) COMP     03645099
036700                                                         SYNC.    03646099
036800             15  ASC-ITEM-SUB                 PIC S9(04) COMP     03647099
036900                                                         SYNC.    03648099
037000             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  03649099
037100             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  03650099
037200             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03660099
037300             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03670099
037400             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03680099
037500             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03690099
037600                                                         SYNC.    03700099
037700             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03710099
037800                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03720099
037900                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03730099
038000             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03740099
038100                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03750099
038200                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03760099
038300             15  ASC-LIST-QUEUE-NAME.                             03770099
038400                 20  ASC-LIST-TERM-ID         PIC  X(04).         03780099
038500                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03790099
038600                 20  ASC-LIST-SEQ             PIC  9(01).         03800099
038700                                                                  03810099
038800             15  ASC-START-ITEM-REQUEST.                          03820099
038900                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03830099
039000                                                                  03840099
039100             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03850099
039200             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03860099
039300             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03870099
039400                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03880099
039500             15  ASC-SEL-QUEUE-NAME-IN        PIC X(08).          03890099
039600             15  ASC-SEL-QUEUE-NAME.                              03900099
039700                 20  ASC-SEL-TERM-ID          PIC  X(04).         03910099
039800                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03920099
039900                 20  ASC-SEL-SEQ              PIC  9(01).         03930099
040000             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03940099
040100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03950099
040200                 20  ASC-BLOCK-MODIFIED-SW         PIC  X(01).    03960099
040300                     88  ASC-BLOCK-NOT-MODIFIED        VALUE 'N'. 03970099
040400                     88  ASC-BLOCK-MODIFIED            VALUE 'Y'. 03980099
040500                                                                  03990099
040600                 20  ASC-ITEM-ARRAY.                              04000099
040700                     25  ASC-ITEM-ENTRIES OCCURS 10 TIMES.        04010099
040800                         30  ASC-LIST-ITEM-NUMBER  PIC S9(09)     04020099
040900                                                       COMP-3.    04030099
041000                         30  ASC-TEMP-SELECTED-SW  PIC  X(01).    04040099
041100                             88  ASC-VALID-SELECT      VALUE ' '  04050099
041200                                                             'S'. 04060099
041300                             88  ASC-TEMP-NO-SELECT    VALUE ' '. 04070099
041400                             88  ASC-TEMP-SELECT       VALUE 'S'. 04080099
041500                         30  ASC-SELECTED-SW       PIC  X(01).    04090099
041600                             88  ASC-NO-SELECT         VALUE ' '. 04100099
041700                             88  ASC-SELECT            VALUE 'S'. 04110099
041800                         30  ASC-ACTION            PIC  X(03).    04120099
041900                         30  ASC-STORE-NUMBER      PIC  9(04).    04130099
042000                         30  ASC-DATE-TIME         PIC  X(16).    04140099
042100                         30  ASC-ADJ-TMST          PIC  X(26).    04150099
042200                         30  ASC-ADJ-UNITS-X       PIC  X(06).    04160099
042300                         30  ASC-ADJ-UNITS-R REDEFINES            04170099
042400                             ASC-ADJ-UNITS-X.                     04180099
042500                             35  ASC-ADJ-UNITS     PIC  Z(05)-.   04190099
042600                         30  ASC-BEF-UNITS-X       PIC  X(05).    04200099
042700                         30  ASC-BEF-UNITS-R REDEFINES            04210099
042800                             ASC-BEF-UNITS-X.                     04220099
042900                             35  ASC-BEF-UNITS     PIC  9(05).    04230099
043000                         30  ASC-AFT-UNITS-X       PIC  X(05).    04240099
043100                         30  ASC-AFT-UNITS-R REDEFINES            04250099
043200                             ASC-AFT-UNITS-X.                     04260099
043300                             35  ASC-AFT-UNITS     PIC  9(05).    04270099
043400                         30  ASC-ADJ-BY            PIC  X(08).    04280099
043500                         30  ASC-BATCH-NBR         PIC  X(03).    04290099
043600                                                                  04300099
043700*---------------------------------------------------------------* 04310099
043800*    ABEND PROCESSING COPYBOOK.                                 * 04320099
043900*---------------------------------------------------------------* 04330099
044000     COPY DPWS013.                                                04340099
044100                                                                  04350099
044200*---------------------------------------------------------------* 04360099
044300*    TCEPLRQ - CENTRAL STOCK PULL REQUESTS                      * 04370099
044400*---------------------------------------------------------------* 04380099
044500     EXEC SQL                                                     04390099
044600          INCLUDE TCEPLRQ                                         04400099
044700     END-EXEC.                                                    04410099
044800                                                                  04420099
044900*---------------------------------------------------------------* 04430099
045000*    TCEPLDS - CENTRAL STOCK PULL DISTRIBUTION                  * 04440099
045100*---------------------------------------------------------------* 04450099
045200     EXEC SQL                                                     04460099
045300          INCLUDE TCEPLDS                                         04470099
045400     END-EXEC.                                                    04480099
045500                                                                  04490099
045600*---------------------------------------------------------------* 04500099
045700*    TCEPLIT - CENTRAL STOCK PULL ITEMS                         * 04510099
045800*---------------------------------------------------------------* 04520099
045900     EXEC SQL                                                     04530099
046000          INCLUDE TCEPLIT                                         04540099
046100     END-EXEC.                                                    04550099
046200                                                                  04560099
046300*---------------------------------------------------------------* 04570099
046400*    TCEPLST - CENTRAL STOCK PULL STATUS                        * 04580099
046500*---------------------------------------------------------------* 04590099
046600     EXEC SQL                                                     04600099
046700          INCLUDE TCEPLST                                         04610099
046800     END-EXEC.                                                    04620099
046900                                                                  04630099
047000*---------------------------------------------------------------* 04640099
047100*    TCEPLMF - CENTRAL STOCK MANIFEST                           * 04650099
047200*---------------------------------------------------------------* 04660099
047300     EXEC SQL                                                     04670099
047400          INCLUDE TCEPLMF                                         04680099
047500     END-EXEC.                                                    04690099
047600                                                                  04700099
047700*---------------------------------------------------------------* 04710099
047800*    TCEPLAU - CENTRAL STOCK ADJUST AUDIT                       * 04720099
047900*---------------------------------------------------------------* 04730099
048000     EXEC SQL                                                     04740099
048100          INCLUDE TCEPLAU                                         04750099
048200     END-EXEC.                                                    04760099
048300                                                                  04770099
049100*---------------------------------------------------------------* 04780099
049200*    DB2 AREA FOR COMMUNICATIONS                                * 04790099
049300*---------------------------------------------------------------* 04800099
049400     EXEC SQL                                                     04810099
049500          INCLUDE SQLCA                                           04820099
049600     END-EXEC.                                                    04830099
049700                                                                  04840099
049800*---------------------------------------------------------------* 04850099
049900*    ADJUSTMENT AUDIT CURSOR (FOR ONE STORE)                    * 04860099
050000*---------------------------------------------------------------* 04870099
050100     EXEC SQL                                                     04880099
050200          DECLARE CEPLAU-CSR-STR CURSOR FOR                       04890099
050300              SELECT  CNSTK_REQ_PL_NBR                            04900099
050400                     ,PL_LNE_NBR                                  04910099
050500                     ,STR_NBR                                     04920099
050600                     ,ADJ_TMST                                    04930099
050700                     ,BEF_ADJ_UNT_QTY                             04940099
050800                     ,AFT_ADJ_UNT_QTY                             04950099
050900                     ,ADJ_BY_USR_ID                               04960099
051000                     ,EXPRT_PRC_BTCH_ID                           04970099
051100                     ,ADJ_RSN_DESC                                04980099
051200                FROM  TCEPLAU                                     04990099
051300               WHERE  CNSTK_REQ_PL_NBR = :DK-PULL-NUMBER          05000099
051400                 AND  PL_LNE_NBR       = :DK-LINE-NUMBER          05010099
051500                 AND  STR_NBR          = :DK-STR-NUMBER           05020099
051600            ORDER BY  ADJ_TMST                                    05030099
051700     END-EXEC.                                                    05040099
051800                                                                  05050099
051900*---------------------------------------------------------------* 05060099
052000*    ADJUSTMENT AUDIT CURSOR (FOR ALL STORES)                   * 05070099
052100*---------------------------------------------------------------* 05080099
052200     EXEC SQL                                                     05090099
052300          DECLARE CEPLAU-CSR-ALL CURSOR FOR                       05100099
052400              SELECT  CNSTK_REQ_PL_NBR                            05110099
052500                     ,PL_LNE_NBR                                  05120099
052600                     ,STR_NBR                                     05130099
052700                     ,ADJ_TMST                                    05140099
052800                     ,BEF_ADJ_UNT_QTY                             05150099
052900                     ,AFT_ADJ_UNT_QTY                             05160099
053000                     ,ADJ_BY_USR_ID                               05170099
053100                     ,EXPRT_PRC_BTCH_ID                           05180099
053200                     ,ADJ_RSN_DESC                                05190099
053300                FROM  TCEPLAU                                     05200099
053400               WHERE  CNSTK_REQ_PL_NBR = :DK-PULL-NUMBER          05210099
053500                 AND  PL_LNE_NBR       = :DK-LINE-NUMBER          05220099
053600***              AND  STR_NBR          = :DK-STR-NUMBER           05230099
053700            ORDER BY  ADJ_TMST                                    05240099
053800     END-EXEC.                                                    05250099
053900                                                                  05260099
054000*---------------------------------------------------------------* 05270099
054100*---------------------------------------------------------------* 05280099
054200 LINKAGE SECTION.                                                 05290099
054300                                                                  05300099
054400 01  DFHCOMMAREA.                                                 05310099
054500     05  FILLER                         OCCURS  1 TO 4072 TIMES   05320099
054600                                        DEPENDING ON EIBCALEN.    05330099
054700         10  FILLER                     PIC X.                    05340099
054800                                                                  05350099
054900/*****************************************************************05360099
055000******************************************************************05370099
055100 PROCEDURE DIVISION.                                              05380099
055200******************************************************************05390099
055300**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05400099
055400**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05410099
055500**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05420099
055600******************************************************************05430099
055700 0000-MAIN-MODULE.                                                05440099
055800                                                                  05450099
055900     INITIALIZE DP030-CICS-API-FIELDS.                            05460099
056000     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05470099
056100     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05480099
056200     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05490099
056300     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05500099
056400     MOVE LENGTH OF CE614AI        TO DP030-MAP-LENGTH (1).       05510099
056500     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05520099
056600     PERFORM 0001-CALL-CICS-ARCH-API.                             05530099
056700                                                                  05540099
056800     PERFORM 1000-CONTROL-PROCESSING                              05550099
056900                                                                  05560099
057000     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05570099
057100     PERFORM 0001-CALL-CICS-ARCH-API.                             05580099
057200                                                                  05590099
057300******************************************************************05600099
057400**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05610099
057500**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05620099
057600******************************************************************05630099
057700 0001-CALL-CICS-ARCH-API.                                         05640099
057800                                                                  05650099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05661099
058000                                    DFHCOMMAREA                   05670099
058100                                    DP030-CICS-API-FIELDS         05680099
058200                                    DP020-STANDARD-COMMAREA       05690099
058300                                    CE614AI.                      05700099
058400                                                                  05710099
058500     IF DP030-RC-CALL-SUCCESSFUL                                  05720099
058600         CONTINUE                                                 05730099
058700     ELSE                                                         05740099
058800         SET DP013-NO-ROLLBACK                                    05750099
058900             DP013-XCTL-DISPLAY-RESTART                           05760099
059000             DP013-CICS-ABEND      TO TRUE                        05770099
059100         MOVE '0001-CALL-CICS-ARCH-API'                           05780099
059200                                   TO DP013-PARAGRAPH             05790099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05811099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05812099
059500         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05820099
059600         PERFORM DP013-0000-PROCESS-ABEND                         05830099
059700     END-IF.                                                      05840099
059800                                                                  05850099
059900*----------------------------------------------------------------*05860099
060000* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05870099
060100* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05880099
060200*                                                                *05890099
060300* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05900099
060400*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05910099
060500*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *05920099
060600*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *05930099
060700*----------------------------------------------------------------*05940099
060800 1000-CONTROL-PROCESSING.                                         05950099
060900                                                                  05960099
061000     EVALUATE TRUE                                                05970099
061100         WHEN DP020-NEXT-ACT-INITIAL                              05980099
061200             INITIALIZE ASC-SPECIFIC-COMMAREA                     05990099
061300             MOVE EIBTRMID          TO ASC-LIST-TERM-ID           06000099
061400                                       ASC-SEL-TERM-ID            06010099
061500             MOVE DP020-SRC-TASK-NUMBER                           06020099
061600                                    TO ASC-LIST-TASK-NUMBER       06030099
061700                                       ASC-SEL-TASK-NUMBER        06040099
061800             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               06050099
061900             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                06060099
062000             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06070099
062100             IF PS-COMMAREA-NOT-VALID                             06080099
062200                 SET DP020-NEXT-ACT-APPL-ERROR                    06090099
062300                                    TO TRUE                       06100099
062400             ELSE                                                 06110099
062401                 IF  ASC-DISPLAY-ALL                              06120099
062410                     PERFORM 7000-DISPLAY-ALL-STORES              06130099
062420                 ELSE                                             06140099
062500                     PERFORM 4000-BUILD-INITIAL-PANEL             06150099
062600                 END-IF                                           06160099
062610             END-IF                                               06170099
062700                                                                  06180099
062800         WHEN DP020-NEXT-ACT-READ-MAP                             06190099
062900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06200099
063000             PERFORM 2000-PROCESS-PANEL                           06210099
063100                                                                  06220099
063200         WHEN DP020-NEXT-ACT-RETURN                               06230099
063300             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06240099
063400             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    06250099
063500             PERFORM 2050-DELETE-LIST-QUEUE                       06260099
063600             MOVE ASC-KEY-STORE-NBR                               06270099
063700               TO ASC-KEY-STORE-NBR-N                             06280099
063710             IF  ASC-DISPLAY-ALL                                  06290099
063720                 PERFORM 7000-DISPLAY-ALL-STORES                  06300099
063730             ELSE                                                 06310099
063800                 PERFORM 4000-BUILD-INITIAL-PANEL                 06320099
063810             END-IF                                               06330099
063900                                                                  06340099
064000         WHEN OTHER                                               06350099
064100             SET DP013-LOGIC-ABEND TO TRUE                        06360099
064200             SET DP013-NO-ROLLBACK TO TRUE                        06370099
064300             MOVE '1000-CONTROL-PROCESSING'                       06380099
064400                                   TO DP013-PARAGRAPH             06390099
064500             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06400099
064600                                   TO DP013-MESSAGE-TEXT(1)       06410099
064700             PERFORM DP013-0000-PROCESS-ABEND                     06420099
064800     END-EVALUATE.                                                06430099
064900                                                                  06440099
065000*----------------------------------------------------------------*06450099
065100* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06460099
065200* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06470099
065300*----------------------------------------------------------------*06480099
065400 1100-PROCESS-INTER-APPL-COMM.                                    06490099
065500                                                                  06500099
065600     SET PS-COMMAREA-VALID         TO TRUE.                       06510099
065700     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06520099
065800                                                                  06530099
065900     IF CE002-NUMBER-OF-SELECTED-ITEMS > 0                        06540099
066000         MOVE CE002-CS-LOCATION        TO ASC-CS-LOC              06550099
066100         MOVE CE002-PULL-NBR           TO ASC-PULL-NBR            06560099
066200         MOVE CE002-LNE-NBR            TO ASC-LINE-NBR            06570099
066800         MOVE CE002-SKU-NBR            TO ASC-SKU-NUMBER          06580099
066900         MOVE CE002-SKU-RETAIL         TO ASC-SKU-RETAIL          06590099
066910         MOVE CE002-DISPLAY-SW         TO ASC-DISPLAY-SW          06600099
067000         MOVE CE002-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  06610099
067100         MOVE CE002-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME-IN   06620099
067200         SET ASC-USE-SELECTION-QUEUE   TO TRUE                    06630099
067300         PERFORM 1120-PREPARE-LIST-ENTRY                          06640099
067400     ELSE                                                         06650099
067500         MOVE PC-TSYMSG-00057       TO DP020-MSG-NUMBER           06660099
067600         SET  PS-COMMAREA-NOT-VALID TO TRUE                       06670099
067700     END-IF.                                                      06680099
067800                                                                  06690099
067900*----------------------------------------------------------------*06700099
068000*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*06710099
068100*----------------------------------------------------------------*06720099
068200 1120-PREPARE-LIST-ENTRY.                                         06730099
068300                                                                  06740099
068400     MOVE CE003-MAX-ITEMS          TO ASC-SEL-SUB.                06750099
068500     MOVE ZERO                     TO ASC-SEL-ITEM.               06760099
068600     PERFORM 1130-GET-NEXT-RECORD.                                06770099
068700                                                                  06780099
068800*----------------------------------------------------------------*06790099
068900 1130-GET-NEXT-RECORD.                                            06800099
069000                                                                  06810099
069100     ADD +1 TO ASC-SEL-SUB.                                       06820099
069200                                                                  06830099
069300     IF ASC-SEL-SUB > CE003-MAX-ITEMS                             06840099
069400         ADD  +1 TO ASC-SEL-ITEM                                  06850099
069500         MOVE +1 TO ASC-SEL-SUB                                   06860099
069600     END-IF.                                                      06870099
069700                                                                  06880099
069800     IF ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                 06890099
069900         PERFORM 9100-READ-SEL-QUEUE                              06900099
070000         IF  CE003-ITEM (ASC-SEL-SUB) > ZERO                      06910099
070100             MOVE CE003-STR-NBR      (ASC-SEL-SUB)                06920099
070200                  TO ASC-KEY-STORE-NBR                            06930099
070300                     ASC-KEY-STORE-NBR-N                          06940099
070310             IF  CE002-DISPLAY-ALL                                06950099
070320                 MOVE  CE003-LINE-NUMBER (ASC-SEL-SUB)            06960099
070330                   TO  ASC-LINE-NBR                               06970099
070340             END-IF                                               06980099
070400             SET CE003-INQ (ASC-SEL-SUB) TO TRUE                  06990099
070500             PERFORM 9200-REWRITE-SEL-QUEUE                       07000099
070510             MOVE CE003-LINE-SKU(ASC-SEL-SUB) TO ASC-SKU-NUMBER   07010099
070520             MOVE CE003-LINE-SKU-RETAIL (ASC-SEL-SUB)             07020099
070530                                              TO ASC-SKU-RETAIL   07030099
070600         ELSE                                                     07040099
070700             SUBTRACT +1 FROM ASC-SEL-SUB                         07050099
070800             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07060099
070900             SET DP020-MSG-INFORMATIONAL                          07070099
071000                 PS-LIST-END      TO TRUE                         07080099
071100         END-IF                                                   07090099
071200     ELSE                                                         07100099
071300         SUBTRACT +1 FROM ASC-SEL-ITEM                            07110099
071400         MOVE CE003-MAX-ITEMS     TO ASC-SEL-SUB                  07120099
071500         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07130099
071600         SET DP020-MSG-INFORMATIONAL                              07140099
071700             PS-LIST-END          TO TRUE                         07150099
071800     END-IF.                                                      07160099
071900                                                                  07170099
072000*----------------------------------------------------------------*07180099
072100*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07190099
072200*    PROCESSED.                                                  *07200099
072300*----------------------------------------------------------------*07210099
072400 1140-GET-PREV-RECORD.                                            07220099
072500                                                                  07230099
072600     SUBTRACT +1 FROM ASC-SEL-SUB.                                07240099
072700                                                                  07250099
072800     IF ASC-SEL-SUB < +1                                          07260099
072900         SUBTRACT +1 FROM ASC-SEL-ITEM                            07270099
073000         MOVE CE003-MAX-ITEMS     TO ASC-SEL-SUB                  07280099
073100     END-IF.                                                      07290099
073200                                                                  07300099
073300     IF ASC-SEL-ITEM > ZERO                                       07310099
073400         PERFORM 9100-READ-SEL-QUEUE                              07320099
073500         MOVE CE003-STR-NBR      (ASC-SEL-SUB)                    07330099
073600           TO ASC-KEY-STORE-NBR                                   07340099
073700              ASC-KEY-STORE-NBR-N                                 07350099
073810         IF  CE002-DISPLAY-ALL                                    07360099
073820             MOVE  CE003-LINE-NUMBER (ASC-SEL-SUB)                07370099
073830               TO  ASC-LINE-NBR                                   07380099
073840         END-IF                                                   07381099
073850         SET CE003-INQ (ASC-SEL-SUB) TO TRUE                      07382099
073900         PERFORM 9200-REWRITE-SEL-QUEUE                           07383099
073910         MOVE CE003-LINE-SKU(ASC-SEL-SUB) TO ASC-SKU-NUMBER       07384099
073950         MOVE CE003-LINE-SKU-RETAIL (ASC-SEL-SUB)                 07385099
073960                                          TO ASC-SKU-RETAIL       07386099
074000     ELSE                                                         07387099
074100         MOVE +1              TO ASC-SEL-ITEM                     07388099
074200                                 ASC-SEL-SUB                      07389099
074300         MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER                 07390099
074400         SET DP020-MSG-INFORMATIONAL                              07400099
074500             PS-LIST-END      TO TRUE                             07410099
074600     END-IF.                                                      07420099
074700                                                                  07430099
074800*----------------------------------------------------------------*07440099
074900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *07450099
075000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *07460099
075100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *07470099
075200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *07480099
075300* FUNCTION KEYS CAN GET THIS FAR.                                *07490099
075400*----------------------------------------------------------------*07500099
075500 2000-PROCESS-PANEL.                                              07510099
075600                                                                  07520099
075700     EVALUATE TRUE                                                07530099
075800         WHEN DP020-SRC-AID = DP016-CLEAR                         07540099
075900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    07550099
076000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07560099
076100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07570099
076200                                                                  07580099
076300*F5=REFRESH                                                       07590099
076400         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    07600099
076500             PERFORM 2050-DELETE-LIST-QUEUE                       07610099
076600             MOVE ASC-KEY-STORE-NBR                               07620099
076700               TO ASC-KEY-STORE-NBR-N                             07630099
076710             IF  ASC-DISPLAY-ALL                                  07640099
076720                 PERFORM 7000-DISPLAY-ALL-STORES                  07650099
076730             ELSE                                                 07660099
076800                 PERFORM 4000-BUILD-INITIAL-PANEL                 07670099
076810             END-IF                                               07680099
076900                                                                  07690099
077000*F9=DE-SELECT ALL                                                 07700099
077100         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    07710099
077200             PERFORM 2140-DESELECT-ALL-ITEMS                      07720099
077300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07730099
077400                                                                  07740099
077500*F21=SELECT ALL                                                   07750099
077600         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07760099
077700             PERFORM 2150-SELECT-ALL-ITEMS                        07770099
077800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07780099
077900                                                                  07790099
078000*F20=NEXT SELECTION                                               07800099
078100         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             07810099
078200             IF ASC-USE-SELECTION-QUEUE                           07820099
078300                 PERFORM 1130-GET-NEXT-RECORD                     07830099
078400                 IF PS-LIST-END                                   07840099
078500                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07850099
078600                     SET PS-NO-LIST-END TO TRUE                   07860099
078700                 ELSE                                             07870099
078800                     PERFORM 2050-DELETE-LIST-QUEUE               07880099
078900                     PERFORM 3200-RESET-ATTRIBUTES                07890099
079000                     MOVE ASC-KEY-STORE-NBR                       07900099
079100                       TO ASC-KEY-STORE-NBR-N                     07910099
079110                     IF  ASC-DISPLAY-ALL                          07911099
079120                         PERFORM 7000-DISPLAY-ALL-STORES          07912099
079130                     ELSE                                         07913099
079200                         PERFORM 4000-BUILD-INITIAL-PANEL         07914099
079300                     END-IF                                       07915099
079310                 END-IF                                           07916099
079400             ELSE                                                 07917099
079500                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07918099
079600*                --- BOTTOM OF LIST ---                           07919099
079700                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         07920099
079800                 SET DP020-MSG-INFORMATIONAL TO TRUE              07930099
079900             END-IF                                               07940099
080000                                                                  07950099
080100*F19=PREV SELECTION                                               07960099
080200         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             07970099
080300             IF ASC-USE-SELECTION-QUEUE                           07980099
080400                 PERFORM 1140-GET-PREV-RECORD                     07990099
080500                 IF PS-LIST-END                                   08000099
080600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08010099
080700                     SET PS-NO-LIST-END TO TRUE                   08020099
080800                 ELSE                                             08030099
080900                     PERFORM 2050-DELETE-LIST-QUEUE               08040099
081000                     PERFORM 3200-RESET-ATTRIBUTES                08050099
081100                     MOVE ASC-KEY-STORE-NBR                       08060099
081200                       TO ASC-KEY-STORE-NBR-N                     08070099
081210                     IF  ASC-DISPLAY-ALL                          08080099
081220                         PERFORM 7000-DISPLAY-ALL-STORES          08090099
081230                     ELSE                                         08100099
081300                         PERFORM 4000-BUILD-INITIAL-PANEL         08110099
081400                     END-IF                                       08120099
081410                 END-IF                                           08130099
081500             ELSE                                                 08140099
081600                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08150099
081700*                --- TOP OF LIST ---                              08160099
081800                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         08170099
081900                 SET DP020-MSG-INFORMATIONAL TO TRUE              08180099
082000             END-IF                                               08190099
082100                                                                  08200099
082200         WHEN OTHER                                               08210099
082300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08220099
082400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08230099
082500                                                                  08240099
082600             IF PS-NO-ERROR                                       08250099
082700                 SET DP030-CONTINUE-GO TO TRUE                    08260099
082800                 PERFORM 2100-CHECK-FUNCTION-KEY                  08270099
082900             ELSE                                                 08280099
083000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08290099
083100                 SET DP030-OVERRIDE-GO TO TRUE                    08300099
083200             END-IF                                               08310099
083300     END-EVALUATE.                                                08320099
083400                                                                  08330099
083500*----------------------------------------------------------------*08340099
083600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08350099
083700*----------------------------------------------------------------*08360099
083800 2050-DELETE-LIST-QUEUE.                                          08370099
083900                                                                  08380099
084000     EXEC CICS                                                    08390099
084100         DELETEQ TS                                               08400099
084200             QUEUE (ASC-LIST-QUEUE-NAME)                          08410099
084300             RESP  (PV-CICS-RESP)                                 08420099
084400     END-EXEC.                                                    08430099
084500                                                                  08440099
084600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       08450099
084700        (PV-CICS-RESP = DFHRESP(QIDERR))                          08460099
084800         CONTINUE                                                 08470099
084900     ELSE                                                         08480099
085000         SET DP013-CICS-ABEND      TO TRUE                        08490099
085100         SET DP013-NO-ROLLBACK     TO TRUE                        08500099
085200                                                                  08510099
085300         MOVE '2050-DELETE-LIST-QUEUE'                            08520099
085400                                   TO DP013-PARAGRAPH             08530099
085500         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    08540099
085600                                   TO DP013-MESSAGE-TEXT (1)      08550099
085700         PERFORM DP013-0000-PROCESS-ABEND                         08560099
085800     END-IF.                                                      08570099
085900                                                                  08580099
086000     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  08590099
086100                                                                  08600099
086200*----------------------------------------------------------------*08610099
086300* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*08620099
086400* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *08630099
086500* CICS ARCHITECTURE API.                                         *08640099
086600*----------------------------------------------------------------*08650099
086700 2100-CHECK-FUNCTION-KEY.                                         08660099
086800                                                                  08670099
086900     EVALUATE TRUE                                                08680099
087000* F13 - DISPLAY ALL STORES (LOCAL-FUNC-01)                        08690099
087100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              08700099
087200             PERFORM 2050-DELETE-LIST-QUEUE                       08710099
087300             PERFORM 7000-DISPLAY-ALL-STORES                      08720099
087400                                                                  08730099
087500* F24=ADJ RSN  (CEKCS615 - ADJUSTMENT REASON) (LOCAL-FUNC-03)     08740099
087600         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              08750099
087700             INITIALIZE CE002-INTER-APPL-COMMAREA                 08760099
087800             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    08770099
087900               TO CE002-NUMBER-OF-SELECTED-ITEMS                  08780099
088000             MOVE ASC-CS-LOC       TO CE002-CS-LOCATION           08790099
088100             MOVE ASC-PULL-NBR     TO CE002-PULL-NBR              08800099
088200             MOVE ASC-LINE-NBR     TO CE002-LNE-NBR               08810099
088300             MOVE ASC-SKU-NUMBER   TO CE002-SKU-NBR               08820099
088400             MOVE ASC-SKU-RETAIL   TO CE002-SKU-RETAIL            08830099
088500             PERFORM 5000-PREPARE-SEL-QUEUE                       08840099
088600                                                                  08850099
088700*F6=FIRST PAGE                                                    08860099
088800         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  08870099
088900             MOVE +1               TO PV-TOP-ITEM                 08880099
089000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08890099
089100                                                                  08900099
089200*F7=PREVIOUS PAGE                                                 08910099
089300         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   08920099
089400             PERFORM 3200-RESET-ATTRIBUTES                        08930099
089500             PERFORM 2110-BROWSE-BACKWARD                         08940099
089600             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08950099
089700                                                                  08960099
089800*F8=NEXT PAGE                                                     08970099
089900         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   08980099
090000             PERFORM 3200-RESET-ATTRIBUTES                        08990099
090100             PERFORM 2120-BROWSE-FORWARD                          09000099
090200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09010099
090300                                                                  09020099
090400* ENTER KEY                                                       09030099
090500         WHEN DP020-SRC-AID = DP016-ENTER                         09040099
090600             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   09050099
090700             IF PS-ERROR                                          09060099
090800                 CONTINUE                                         09070099
090900             ELSE                                                 09080099
091000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09090099
091100             END-IF                                               09100099
091200                                                                  09110099
091300         WHEN OTHER                                               09120099
091400             SET DP013-NO-ROLLBACK                                09130099
091500                 DP013-XCTL-DISPLAY-RESTART                       09140099
091600                 DP013-CICS-ABEND  TO TRUE                        09150099
091700             MOVE '2100-CHECK-FUNCTION-KEY'                       09160099
091800                                   TO DP013-PARAGRAPH             09170099
091900             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      09180099
092000                                   TO DP013-MESSAGE-TEXT (1)      09190099
092100             PERFORM DP013-0000-PROCESS-ABEND                     09200099
092200     END-EVALUATE.                                                09210099
092300                                                                  09220099
092400*----------------------------------------------------------------*09230099
092500*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *09240099
092600*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *09250099
092700*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *09260099
092800*    MESSAGE.                                                    *09270099
092900*----------------------------------------------------------------*09280099
093000 2110-BROWSE-BACKWARD.                                            09290099
093100                                                                  09300099
093200     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    09310099
093300         GIVING PV-TOP-ITEM.                                      09320099
093400                                                                  09330099
093500     IF  ((PV-TOP-ITEM < +1)                                      09340099
093600       OR (PV-TOP-ITEM = +1))                                     09350099
093700         MOVE +1                   TO PV-TOP-ITEM                 09360099
093800*        -- TOP OF LIST --                                        09370099
093900         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            09380099
094000         SET DP020-MSG-INFORMATIONAL TO TRUE                      09390099
094100     END-IF.                                                      09400099
094200                                                                  09410099
094300*----------------------------------------------------------------*09420099
094400*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *09430099
094500*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *09440099
094600*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *09450099
094700*----------------------------------------------------------------*09460099
094800 2120-BROWSE-FORWARD.                                             09470099
094900                                                                  09480099
095000     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              09490099
095100         GIVING PV-TOP-ITEM.                                      09500099
095200                                                                  09510099
095300     IF PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                    09520099
095400         MOVE ASC-ITEM-AT-TOP-OF-PANEL   TO PV-TOP-ITEM           09530099
095500*        -- BOTTOM OF LIST --                                     09540099
095600         MOVE PC-TSYMSG-00070            TO DP020-MSG-NUMBER      09550099
095700         SET DP020-MSG-INFORMATIONAL     TO TRUE                  09560099
095800     ELSE                                                         09570099
095900         COMPUTE PV-BOTTOM-ITEM =                                 09580099
096000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 09590099
096100         IF PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ             09600099
096200*            -- BOTTOM OF LIST --                                 09610099
096300             MOVE PC-TSYMSG-00070        TO DP020-MSG-NUMBER      09620099
096400             SET DP020-MSG-INFORMATIONAL TO TRUE                  09630099
096500         END-IF                                                   09640099
096600     END-IF.                                                      09650099
096700                                                                  09660099
096800*----------------------------------------------------------------*09670099
096900*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *09680099
097000*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *09690099
097100*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *09700099
097200*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *09710099
097300*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *09720099
097400*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *09730099
097500*----------------------------------------------------------------*09740099
097600 2130-CHECK-FOR-JUMP-BROWSE.                                      09750099
097700                                                                  09760099
097800     SET PS-NO-ERROR TO TRUE.                                     09770099
097900                                                                  09780099
098000     IF (ASC-START-ITEM-REQUEST = SPACE)                          09790099
098100         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             09800099
098200     ELSE                                                         09810099
098300         MOVE ASC-START-ITEM-REQUEST   TO DP010I-UNEDITED-FIELD   09820099
098400         MOVE PC-MSG-NUMBER-LENGTH     TO DP010I-MAXIMUM-DIGITS   09830099
098500         MOVE +0                       TO DP010I-MAXIMUM-DECIMALS 09840099
098600         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  09850099
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         09861099
263455              USING DP010I-NUMERIC-EDIT-AREA                      09862099
098800         IF NOT DP010I-ERROR-DETECTED                             09870099
098900             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N09880099
099000             IF ASC-START-ITEM-REQUEST-N > ZERO                   09890099
099100                 IF ASC-START-ITEM-REQUEST-N >                    09900099
099200                                          ASC-NUMBER-OF-ITEMS-READ09910099
099300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         09920099
099400                     COMPUTE PV-TOP-ITEM =                        09930099
099500                             ASC-NUMBER-OF-ITEMS-READ             09940099
099600                             - PC-ITEMS-PER-PANEL + 1             09950099
099700                     IF PV-TOP-ITEM < +1                          09960099
099800                         MOVE +1   TO PV-TOP-ITEM                 09970099
099900                         MOVE PC-TSYMSG-00070                     09980099
100000                                   TO DP020-MSG-NUMBER            09990099
100100                         SET DP020-MSG-INFORMATIONAL TO TRUE      10000099
100200                     END-IF                                       10010099
100300                 ELSE                                             10020099
100400                     MOVE ASC-START-ITEM-REQUEST-N                10030099
100500                                   TO PV-TOP-ITEM                 10040099
100600                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      10050099
100700                     COMPUTE PV-BOTTOM-ITEM =                     10060099
100800                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     10070099
100900                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ10080099
101000*                        -- BOTTOM OF LIST --                     10090099
101100                         MOVE PC-TSYMSG-00070                     10100099
101200                                   TO DP020-MSG-NUMBER            10110099
101300                         SET DP020-MSG-INFORMATIONAL TO TRUE      10120099
101400                     END-IF                                       10130099
101500                 END-IF                                           10140099
101600             ELSE                                                 10150099
101700*                --- VALUE OUT OF RANGE ----                      10160099
101800                 MOVE PC-TSYMSG-00101        TO DP020-MSG-NUMBER  10170099
101900                 MOVE -1                     TO ASTRTITL          10180099
102000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              10190099
102100                 MOVE DP015-REVERSE          TO ASTRTITH          10200099
102200                 MOVE DP015-RED              TO ASTRTITC          10210099
102300                 MOVE DP015-UNP-NUM-BRT-MDT  TO ASTRTITA          10220099
102400                 SET DP020-MSG-FATAL         TO TRUE              10230099
102500                 SET PS-ERROR                TO TRUE              10240099
102600             END-IF                                               10250099
102700         ELSE                                                     10260099
102800             MOVE PC-TSYMSG-00008            TO DP020-MSG-NUMBER  10270099
102900             MOVE -1                         TO ASTRTITL          10280099
103000             SET DP030-SET-CURSOR-APPL-1     TO TRUE              10290099
103100             MOVE DP015-REVERSE              TO ASTRTITH          10300099
103200             MOVE DP015-RED                  TO ASTRTITC          10310099
103300             MOVE DP015-UNP-NUM-BRT-MDT                           10320099
103400                                             TO ASTRTITA          10330099
103500             SET DP020-MSG-FATAL             TO TRUE              10340099
103600             SET PS-ERROR                    TO TRUE              10350099
103700         END-IF                                                   10360099
103800     END-IF.                                                      10370099
103900                                                                  10380099
104000*----------------------------------------------------------------*10390099
104100*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *10400099
104200*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *10410099
104300*----------------------------------------------------------------*10420099
104400 2140-DESELECT-ALL-ITEMS.                                         10430099
104500     MOVE +1                       TO ASC-BLK-SUB.                10440099
104600                                                                  10450099
104700     PERFORM 2141-CLEAR-SELECTED-INDS                             10460099
104800         VARYING ASC-ITEM-SUB                                     10470099
104900         FROM 1 BY 1                                              10480099
105000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10490099
105100                                                                  10500099
105200     ADD +1                        TO ASC-BLK-SUB.                10510099
105300                                                                  10520099
105400     PERFORM 2141-CLEAR-SELECTED-INDS                             10530099
105500         VARYING ASC-ITEM-SUB                                     10540099
105600         FROM 1 BY 1                                              10550099
105700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10560099
105800                                                                  10570099
105900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               10580099
106000                                   TO PV-LIST-ITEM-NUMBER.        10590099
106100                                                                  10600099
106200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10610099
106300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10620099
106400                                                                  10630099
106500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10640099
106600        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      10650099
106700         MOVE +1                   TO ASC-BLK-SUB                 10660099
106800                                                                  10670099
106900         PERFORM 5100-WRITE-TEMP-STORAGE                          10680099
107000                                                                  10690099
107100         MOVE +1                   TO PV-BLOCK-NUMBER             10700099
107200                                                                  10710099
107300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10720099
107400             PV-FIRST-BLOCK-IN-ARRAY - 1                          10730099
107500                                                                  10740099
107600         PERFORM                                                  10750099
107700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10760099
107800                                                                  10770099
107900             PERFORM 4410-READ-TEMP-STORAGE                       10780099
108000                                                                  10790099
108100             PERFORM 2141-CLEAR-SELECTED-INDS                     10800099
108200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 10810099
108300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10820099
108400                                                                  10830099
108500             PERFORM 5100-WRITE-TEMP-STORAGE                      10840099
108600                                                                  10850099
108700             ADD +1                TO PV-BLOCK-NUMBER             10860099
108800                                                                  10870099
108900         END-PERFORM                                              10880099
109000                                                                  10890099
109100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10900099
109200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10910099
109300                                                                  10920099
109400         PERFORM                                                  10930099
109500           UNTIL PV-NEXT-BLOCK-IN-ARRAY >                         10940099
109600                 ASC-HIGHEST-BLOCK-WRITTEN                        10950099
109700                                                                  10960099
109800             MOVE PV-NEXT-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER       10970099
109900             PERFORM 4410-READ-TEMP-STORAGE                       10980099
110000             PERFORM 2141-CLEAR-SELECTED-INDS                     10990099
110100               VARYING ASC-ITEM-SUB FROM 1 BY 1                   11000099
110200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11010099
110300             PERFORM 5100-WRITE-TEMP-STORAGE                      11020099
110400             ADD +1 TO PV-NEXT-BLOCK-IN-ARRAY                     11030099
110500         END-PERFORM                                              11040099
110600                                                                  11050099
110700         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          11060099
110800         PERFORM 4410-READ-TEMP-STORAGE                           11070099
110900     END-IF.                                                      11080099
111000                                                                  11090099
111100     MOVE +0 TO ASC-NUMBER-OF-SELECTED-ITEMS.                     11100099
111200                                                                  11110099
111300     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11120099
111400                                                                  11130099
111500*----------------------------------------------------------------*11140099
111600*    MARK EACH ITEM AS BEING NOT SELECTED.                       *11150099
111700*----------------------------------------------------------------*11160099
111800 2141-CLEAR-SELECTED-INDS.                                        11170099
111900                                                                  11180099
112000     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)            11190099
112100             NOT EQUAL ZERO                                       11200099
112200         IF NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)           11210099
112300             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          11220099
112400                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    11230099
112500                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          11240099
112600         END-IF                                                   11250099
112700     END-IF.                                                      11260099
112800                                                                  11270099
112900*----------------------------------------------------------------*11280099
113000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *11290099
113100*  FOR ALL ITEMS.                                                *11300099
113200*----------------------------------------------------------------*11310099
113300 2150-SELECT-ALL-ITEMS.                                           11320099
113400                                                                  11330099
113500     MOVE +1                       TO ASC-BLK-SUB.                11340099
113600                                                                  11350099
113700     PERFORM 2151-SET-SELECTED-INDS                               11360099
113800         VARYING ASC-ITEM-SUB                                     11370099
113900         FROM 1 BY 1                                              11380099
114000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11390099
114100                                                                  11400099
114200     ADD +1                        TO ASC-BLK-SUB.                11410099
114300                                                                  11420099
114400     PERFORM 2151-SET-SELECTED-INDS                               11430099
114500         VARYING ASC-ITEM-SUB                                     11440099
114600         FROM 1 BY 1                                              11450099
114700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 11460099
114800                                                                  11470099
114900     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               11480099
115000                                   TO PV-LIST-ITEM-NUMBER.        11490099
115100                                                                  11500099
115200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            11510099
115300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    11520099
115400                                                                  11530099
115500     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     11540099
115600        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    11550099
115700         MOVE +1                   TO ASC-BLK-SUB                 11560099
115800                                                                  11570099
115900         PERFORM 5100-WRITE-TEMP-STORAGE                          11580099
116000                                                                  11590099
116100         MOVE +1                   TO PV-BLOCK-NUMBER             11600099
116200                                                                  11610099
116300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         11620099
116400             PV-FIRST-BLOCK-IN-ARRAY - 1                          11630099
116500                                                                  11640099
116600         PERFORM                                                  11650099
116700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       11660099
116800                                                                  11670099
116900             PERFORM 4410-READ-TEMP-STORAGE                       11680099
117000                                                                  11690099
117100             PERFORM 2151-SET-SELECTED-INDS                       11700099
117200                 VARYING ASC-ITEM-SUB                             11710099
117300                 FROM 1 BY 1                                      11720099
117400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11730099
117500                                                                  11740099
117600             PERFORM 5100-WRITE-TEMP-STORAGE                      11750099
117700                                                                  11760099
117800             ADD +1                TO PV-BLOCK-NUMBER             11770099
117900                                                                  11780099
118000         END-PERFORM                                              11790099
118100                                                                  11800099
118200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11810099
118300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11820099
118400                                                                  11830099
118500         PERFORM                                                  11840099
118600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11850099
118700                   ASC-HIGHEST-BLOCK-WRITTEN                      11860099
118800                                                                  11870099
118900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11880099
119000                                   TO PV-BLOCK-NUMBER             11890099
119100                                                                  11900099
119200             PERFORM 4410-READ-TEMP-STORAGE                       11910099
119300                                                                  11920099
119400             PERFORM 2151-SET-SELECTED-INDS                       11930099
119500                 VARYING ASC-ITEM-SUB                             11940099
119600                 FROM 1 BY 1                                      11950099
119700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11960099
119800                                                                  11970099
119900             PERFORM 5100-WRITE-TEMP-STORAGE                      11980099
120000                                                                  11990099
120100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12000099
120200                                                                  12010099
120300         END-PERFORM                                              12020099
120400                                                                  12030099
120500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             12040099
120600                                   TO PV-BLOCK-NUMBER             12050099
120700                                                                  12060099
120800         PERFORM 4410-READ-TEMP-STORAGE                           12070099
120900     END-IF.                                                      12080099
121000                                                                  12090099
121100                                                                  12100099
121200     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             12110099
121300                       ASC-NUMBER-OF-SELECTED-ITEMS.              12120099
121400                                                                  12130099
121500     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12140099
121600                                                                  12150099
121700*----------------------------------------------------------------*12160099
121800*    MARK EACH ITEM AS BEING SELECTED.                           *12170099
121900*----------------------------------------------------------------*12180099
122000 2151-SET-SELECTED-INDS.                                          12190099
122100                                                                  12200099
122200     IF ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZERO 12210099
122300         IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)              12220099
122400             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             12230099
122500                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        12240099
122600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)          TO TRUE 12250099
122700         END-IF                                                   12260099
122800     END-IF.                                                      12270099
122900                                                                  12280099
123000******************************************************************12290099
123100** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **12300099
123200** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **12310099
123300******************************************************************12320099
123400 2200-MOVE-SCREEN-TO-COMMAREA.                                    12330099
123500                                                                  12340099
123600     MOVE PV-TOP-ITEM  TO PV-ITEM-IN-USE.                         12350099
123700     MOVE +1           TO PV-SUB.                                 12360099
123800                                                                  12370099
123900     PERFORM 3100-SET-SUBSCRIPTS.                                 12380099
124000     IF ASTRTITL > ZERO                                           12390099
124100         MOVE ASTRTITI TO ASC-START-ITEM-REQUEST                  12400099
124200     ELSE                                                         12410099
124300         IF ASTRTITF = DP015-ERASE-EOF                            12420099
124400             INITIALIZE ASC-START-ITEM-REQUEST                    12430099
124500         END-IF                                                   12440099
124600     END-IF.                                                      12450099
124700                                                                  12460099
124800     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          12470099
124900       VARYING PV-SUB FROM 1 BY 1                                 12480099
125000         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      12490099
125100                                                                  12500099
125200******************************************************************12510099
125300** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**12520099
125400******************************************************************12530099
125500 2210-MOVE-LINES-TO-COMMAREA.                                     12540099
125600                                                                  12550099
125700     IF MR-SELECTL (PV-SUB) > ZERO                                12560099
125800         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             12570099
125900         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        12580099
126000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12590099
126100     ELSE                                                         12600099
126200         IF MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                 12610099
126300             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         12620099
126400             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        12630099
126500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      12640099
126600         END-IF                                                   12650099
126700     END-IF.                                                      12660099
126800                                                                  12670099
126900     ADD +1                        TO ASC-ITEM-SUB.               12680099
127000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         12690099
127100         ADD +1                    TO ASC-BLK-SUB                 12700099
127200         MOVE +1                   TO ASC-ITEM-SUB                12710099
127300     END-IF.                                                      12720099
127400                                                                  12730099
127500******************************************************************12740099
127600** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12750099
127700** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12760099
127800******************************************************************12770099
127900 3000-EDIT-DATA-IN-COMMAREA.                                      12780099
128000                                                                  12790099
128100     SET PS-NO-ERROR               TO TRUE.                       12800099
128200     PERFORM 3200-RESET-ATTRIBUTES.                               12810099
128300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12820099
128400**                                                                12830099
128500* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12840099
128600* EDITTING IS DONE FROM THE BOTTOM UP.                            12850099
128700**                                                                12860099
128800     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12870099
128900         ASC-ITEMS-DISPLAYED - 1.                                 12880099
129000     PERFORM 3100-SET-SUBSCRIPTS.                                 12890099
129100     PERFORM 3300-EDIT-SELECTIONS                                 12900099
129200       VARYING PV-SUB FROM PV-SUB BY -1                           12910099
129300         UNTIL PV-SUB < +1.                                       12920099
129400                                                                  12930099
129500*----------------------------------------------------------------*12940099
129600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *12950099
129700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*12960099
129800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *12970099
129900*                                                                *12980099
130000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *12990099
130100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13000099
130200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13010099
130300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13020099
130400*----------------------------------------------------------------*13030099
130500 3100-SET-SUBSCRIPTS.                                             13040099
130600                                                                  13050099
130700     COMPUTE ASC-ITEM-SUB =                                       13060099
130800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13070099
130900                                                                  13080099
131000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13090099
131100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13100099
131200                                                                  13110099
131300         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13120099
131400     ELSE                                                         13130099
131500         MOVE +1                     TO ASC-BLK-SUB               13140099
131600     END-IF.                                                      13150099
131700                                                                  13160099
131800******************************************************************13170099
131900** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13180099
132000******************************************************************13190099
132100 3200-RESET-ATTRIBUTES.                                           13200099
132200                                                                  13210099
132300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13220099
132400     MOVE DP015-GREEN              TO ASTRTITC.                   13230099
132500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   13240099
132600                                                                  13250099
132700     PERFORM                                                      13260099
132800       VARYING PV-SUB FROM 1 BY 1                                 13270099
132900         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        13280099
133000                                                                  13290099
133100         MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)        13300099
133200         MOVE DP015-GREEN           TO MR-SELECTC (PV-SUB)        13310099
133300         MOVE DP015-UNDERLINE       TO MR-SELECTH (PV-SUB)        13320099
133400                                                                  13330099
133500         MOVE DP015-PRO-NOR-OFF     TO MR-ADJ-UNITSA (PV-SUB)     13340099
133600                                       MR-BEF-UNITSA (PV-SUB)     13350099
133700                                       MR-AFT-UNITSA (PV-SUB)     13360099
133800     END-PERFORM.                                                 13370099
133900                                                                  13380099
134000******************************************************************13390099
134100** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **13400099
134200** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **13410099
134300** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **13420099
134400** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **13430099
134500******************************************************************13440099
134600 3300-EDIT-SELECTIONS.                                            13450099
134700                                                                  13460099
134800     EVALUATE TRUE                                                13470099
134900         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13480099
135000             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         13490099
135100                 CONTINUE                                         13500099
135200         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         13510099
135300             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        13520099
135400                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   13530099
135500                 MOVE ASC-TEMP-SELECTED-SW                        13540099
135600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13550099
135700                                TO ASC-SELECTED-SW                13560099
135800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13570099
135900             END-IF                                               13580099
136000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     13590099
136100                 = SPACE                                          13600099
136200             EVALUATE TRUE                                        13610099
136300                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       13620099
136400                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS13630099
136500                     MOVE SPACE TO ASC-SELECTED-SW                13640099
136600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  13650099
136700             END-EVALUATE                                         13660099
136800         WHEN OTHER                                               13670099
136900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           13680099
137000             SET DP020-MSG-FATAL    TO TRUE                       13690099
137100             MOVE -1                TO MR-SELECTL (PV-SUB)        13700099
137200             SET DP030-SET-CURSOR-APPL-1                          13710099
137300                                    TO TRUE                       13720099
137400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        13730099
137500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        13740099
137600             SET PS-ERROR TO TRUE                                 13750099
137700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            13760099
137800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     13770099
137900                 MOVE SPACE         TO ASC-SELECTED-SW            13780099
138000                                        (ASC-BLK-SUB ASC-ITEM-SUB)13790099
138100             END-IF                                               13800099
138200     END-EVALUATE.                                                13810099
138300                                                                  13820099
138400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 13830099
138500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               13840099
138600     IF  ASC-ITEM-SUB < 1                                         13850099
138700         SUBTRACT +1 FROM ASC-BLK-SUB                             13860099
138800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                13870099
138900     END-IF.                                                      13880099
139000                                                                  13890099
139100*----------------------------------------------------------------*13900099
139200*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *13910099
139300*    INITIALIZE ALL COUNTERS AND FLAGS.                          *13920099
139400*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *13930099
139500*    DISPLAY THE PANEL TO USER.                                  *13940099
139600*----------------------------------------------------------------*13950099
139700 4000-BUILD-INITIAL-PANEL.                                        13960099
139800                                                                  13970099
139900     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            13980099
140000                                 ASC-BLOCK-ENTRIES (2).           13990099
140100     MOVE +1                 TO ASC-BLK-SUB.                      14000099
140200     SET ASC-ITEMS-LEFT-ON-DB                                     14010099
140300                             TO TRUE.                             14020099
140400                                                                  14030099
140500     MOVE +0                 TO ASC-ITEM-SUB                      14040099
140600                                ASC-NUMBER-OF-ITEMS-READ          14050099
140700                                ASC-NUMBER-OF-SELECTED-ITEMS      14060099
140800                                ASC-HIGHEST-BLOCK-WRITTEN         14070099
140900                                ASC-ITEM-AT-TOP-OF-PANEL.         14080099
141000                                                                  14090099
141100     PERFORM 4100-PREPARE-DBKEYS.                                 14100099
141200                                                                  14110099
141300     PERFORM 4500-GET-CEPLDS-QTY.                                 14120099
141400     PERFORM 4510-GET-CEPLMF-QTY.                                 14130099
141500                                                                  14140099
141600     PERFORM 4520-GET-CEPLAU-QTY.                                 14150099
141700                                                                  14160099
141800     PERFORM 4010-OPEN-CSR-STR.                                   14170099
141900     PERFORM 4300-READ-ITEMS-FROM-DB.                             14180099
142000     PERFORM 4020-CLOSE-CSR-STR.                                  14190099
142100                                                                  14200099
142200     MOVE +1                   TO  PV-TOP-ITEM.                   14210099
142300     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          14220099
142400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    14230099
142500         SET DP020-MSG-FATAL   TO  TRUE                           14240099
142600         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               14250099
142700     ELSE                                                         14260099
142800         MOVE -1               TO MR-SELECTL (1)                  14270099
142900         SET DP030-SET-CURSOR-APPL-1                              14280099
143000                               TO TRUE                            14290099
143100         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     14300099
143200     END-IF.                                                      14310099
143300                                                                  14320099
143400*----------------------------------------------------------------*14330099
143500* OPEN THE TCEPLAU STORE CURSOR.                                 *14340099
143600*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *14350099
143700*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *14360099
143800*   USER.                                                        *14370099
143900*----------------------------------------------------------------*14380099
144000 4010-OPEN-CSR-STR.                                               14390099
144100                                                                  14400099
144200     PERFORM WITH TEST AFTER                                      14410099
144300       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       14420099
144400         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               14430099
144500            OR (SQLCODE = ZERO))                                  14440099
144600                                                                  14450099
144700         MOVE 'CURSOR:  CEPLAU-CSR-STR' TO DP013-MESSAGE-TEXT (2) 14460099
144800                                                                  14470099
144900         EXEC SQL                                                 14480099
145000              OPEN CEPLAU-CSR-STR                                 14490099
145100         END-EXEC                                                 14500099
145200                                                                  14510099
145300         EVALUATE TRUE                                            14520099
145400             WHEN SQLCODE = ZERO                                  14530099
145500             WHEN SQLCODE = -904                                  14540099
145600             WHEN SQLCODE = -913                                  14550099
145700                 CONTINUE                                         14560099
145800             WHEN SQLWARN0 NOT = SPACES                           14570099
145900             WHEN SQLCODE < ZERO                                  14580099
146000             WHEN SQLCODE > ZERO                                  14590099
146100                 MOVE '4010-OPEN-CSR-STR'                         14600099
146200                                   TO DP013-PARAGRAPH             14610099
146300                 MOVE 'OPEN CEPLAU CURSOR FOR A GIVEN STORE'      14620099
146400                                   TO DP013-MESSAGE-TEXT (1)      14630099
146500                 MOVE SQLCA        TO DP013-SQLCA                 14640099
146600                 MOVE 'TCEPLAU '   TO DP013-DB2-TABLE-NAME (1)    14650099
146700                 SET DP013-DB2-ABEND                              14660099
146800                     DP013-XCTL-DISPLAY-RESTART TO TRUE           14670099
146900                 PERFORM DP013-0000-PROCESS-ABEND                 14680099
147000         END-EVALUATE                                             14690099
147100     END-PERFORM                                                  14700099
147200*                                                                 14710099
147300     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         14720099
147400         MOVE '4010-OPEN-CSR-STR'  TO DP013-PARAGRAPH             14730099
147500         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   14740099
147600                                   TO DP013-MESSAGE-TEXT (1)      14750099
147700         MOVE SQLCA                TO DP013-SQLCA                 14760099
147800         MOVE 'TCEPLAU '           TO DP013-DB2-TABLE-NAME (1)    14770099
147900         SET DP013-DB2-ABEND                                      14780099
148000             DP013-XCTL-DISPLAY-RESTART                           14790099
148100                                   TO TRUE                        14800099
148200         PERFORM DP013-0000-PROCESS-ABEND                         14810099
148300     END-IF.                                                      14820099
148400                                                                  14830099
148500*----------------------------------------------------------------*14840099
148600* CLOSE THE TCEPLAU STORE CURSOR.                                *14850099
148700*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *14860099
148800*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *14870099
148900*   USER.                                                        *14880099
149000*----------------------------------------------------------------*14890099
149100 4020-CLOSE-CSR-STR.                                              14900099
149200                                                                  14910099
149300     EXEC SQL                                                     14920099
149400          CLOSE CEPLAU-CSR-STR                                    14930099
149500     END-EXEC.                                                    14940099
149600                                                                  14950099
149700     EVALUATE TRUE                                                14960099
149800         WHEN SQLCODE = ZERO                                      14970099
149900             CONTINUE                                             14980099
150000         WHEN SQLWARN0 NOT = SPACES                               14990099
150100         WHEN SQLCODE < ZERO                                      15000099
150200         WHEN SQLCODE > ZERO                                      15010099
150300             MOVE '4020-CLOSE-CSR-STR'                            15020099
150400                               TO DP013-PARAGRAPH                 15030099
150500             MOVE 'CLOSE CEPLAU STORE CURSOR'                     15040099
150600                               TO DP013-MESSAGE-TEXT (1)          15050099
150700             MOVE SQLCA        TO DP013-SQLCA                     15060099
150800             MOVE 'TCEPLAU '   TO DP013-DB2-TABLE-NAME (1)        15070099
150900             SET DP013-DB2-ABEND                                  15080099
151000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               15090099
151100             PERFORM DP013-0000-PROCESS-ABEND                     15100099
151200     END-EVALUATE.                                                15110099
151300                                                                  15120099
151400*----------------------------------------------------------------*15130099
151500*    SET UP THE HOST VARIABLES.                                  *15140099
151600*----------------------------------------------------------------*15150099
151700 4100-PREPARE-DBKEYS.                                             15160099
151800                                                                  15170099
151900     MOVE ASC-PULL-NBR         TO DK-PULL-NUMBER.                 15180099
152000     MOVE ASC-LINE-NBR         TO DK-LINE-NUMBER.                 15190099
152100     MOVE ASC-KEY-STORE-NBR    TO DK-STR-NUMBER.                  15200099
152200                                                                  15210099
152300*----------------------------------------------------------------*15220099
152400*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *15230099
152500*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *15240099
152600*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *15250099
152700*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *15260099
152800*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *15270099
152900*                                                                *15280099
153000*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *15290099
153100*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *15300099
153200*    UPON INITIALIZATION.                                        *15310099
153300*----------------------------------------------------------------*15320099
153400 4300-READ-ITEMS-FROM-DB.                                         15330099
153500                                                                  15340099
153600     PERFORM                                                      15350099
153700       VARYING PV-READ-COUNT FROM 1 BY 1                          15360099
153800         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    15370099
153900            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         15380099
154000                                                                  15390099
154100         PERFORM 4310-FETCH                                       15400099
154200                                                                  15410099
154300         IF ASC-ITEMS-LEFT-ON-DB                                  15420099
154400             IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                 15430099
154500                 ADD  +1  TO ASC-ITEM-SUB                         15440099
154600             ELSE                                                 15450099
154700                 ADD  +1  TO ASC-BLK-SUB                          15460099
154800                 MOVE +1  TO ASC-ITEM-SUB                         15470099
154900                                                                  15480099
155000                 IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY          15490099
155100                     MOVE +1  TO ASC-BLK-SUB                      15500099
155200                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           15510099
155300                     PERFORM 5100-WRITE-TEMP-STORAGE              15520099
155400                     MOVE ASC-BLOCK-ENTRIES                       15530099
155500                                         (PC-MAX-BLOCKS-IN-ARRAY) 15540099
155600                       TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)          15550099
155700                     ADD +1   TO ASC-BLK-SUB                      15560099
155800                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   15570099
155900                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      15580099
156000                              TO TRUE                             15590099
156100                 END-IF                                           15600099
156200             END-IF                                               15610099
156300                                                                  15620099
156400             ADD  +1 TO ASC-NUMBER-OF-ITEMS-READ                  15630099
156500             MOVE ASC-NUMBER-OF-ITEMS-READ                        15640099
156600               TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) 15650099
156700                                                                  15660099
156800             MOVE CEPLAU-STR-NBR                                  15670099
156900               TO ASC-STORE-NUMBER     (ASC-BLK-SUB ASC-ITEM-SUB) 15680099
157000                                                                  15690099
157100             MOVE CEPLAU-ADJ-TMST                                 15700099
157200               TO ASC-ADJ-TMST         (ASC-BLK-SUB ASC-ITEM-SUB) 15710099
157300                  PV-CEPLAU-TMST                                  15720099
157400             MOVE PV-CEPLAU-CC    TO PV-CEPLAU-CC-F               15730099
157500             MOVE PV-CEPLAU-YY    TO PV-CEPLAU-YY-F               15740099
157600             MOVE PV-CEPLAU-MM    TO PV-CEPLAU-MM-F               15750099
157700             MOVE PV-CEPLAU-DD    TO PV-CEPLAU-DD-F               15760099
157800             MOVE PV-CEPLAU-HR    TO PV-CEPLAU-HR-F               15770099
157900             MOVE PV-CEPLAU-MIN   TO PV-CEPLAU-MIN-F              15780099
158000             MOVE PV-CEPLAU-TMST-DISPLAY                          15790099
158100               TO ASC-DATE-TIME        (ASC-BLK-SUB ASC-ITEM-SUB) 15800099
158200                                                                  15810099
158300*            COMPUTE PV-CEPLAU-ADJUST-QTY                         15820099
158400*                  = CEPLAU-BEF-ADJ-UNT-QTY                       15830099
158500*                  - CEPLAU-AFT-ADJ-UNT-QTY                       15840099
158600             COMPUTE PV-CEPLAU-ADJUST-QTY                         15850099
158700                   = CEPLAU-AFT-ADJ-UNT-QTY                       15860099
158800                   - CEPLAU-BEF-ADJ-UNT-QTY                       15870099
158900                                                                  15880099
159000             MOVE PV-CEPLAU-ADJUST-QTY                            15890099
159100               TO ASC-ADJ-UNITS        (ASC-BLK-SUB ASC-ITEM-SUB) 15900099
159200                                                                  15910099
159300             MOVE CEPLAU-BEF-ADJ-UNT-QTY                          15920099
159400               TO ASC-BEF-UNITS        (ASC-BLK-SUB ASC-ITEM-SUB) 15930099
159500             MOVE CEPLAU-AFT-ADJ-UNT-QTY                          15940099
159600               TO ASC-AFT-UNITS        (ASC-BLK-SUB ASC-ITEM-SUB) 15950099
159700             MOVE CEPLAU-ADJ-BY-USR-ID                            15960099
159800               TO ASC-ADJ-BY           (ASC-BLK-SUB ASC-ITEM-SUB) 15970099
159900             MOVE CEPLAU-EXPRT-PRC-BTCH-ID                        15980099
160000               TO ASC-BATCH-NBR        (ASC-BLK-SUB ASC-ITEM-SUB) 15990099
160100         END-IF                                                   16000099
160200     END-PERFORM.                                                 16010099
160300                                                                  16020099
160400     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          16030099
160500         MOVE +1               TO ASC-BLK-SUB                     16040099
160600         PERFORM 5100-WRITE-TEMP-STORAGE                          16050099
160700         ADD +1                TO ASC-BLK-SUB                     16060099
160800         PERFORM 5100-WRITE-TEMP-STORAGE                          16070099
160900                                                                  16080099
161000         MOVE 1                TO ASC-BLK-SUB                     16090099
161100                                  PV-BLOCK-NUMBER                 16100099
161200         PERFORM 4410-READ-TEMP-STORAGE                           16110099
161300         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             16120099
161400             MOVE 2            TO ASC-BLK-SUB                     16130099
161500                                  PV-BLOCK-NUMBER                 16140099
161600             PERFORM 4410-READ-TEMP-STORAGE                       16150099
161700         END-IF                                                   16160099
161800     END-IF.                                                      16170099
161900                                                                  16180099
162000*----------------------------------------------------------------*16190099
162100*    FETCH THE STORE CURSOR.                                     *16200099
162200*----------------------------------------------------------------*16210099
162300 4310-FETCH.                                                      16220099
162400                                                                  16230099
162500     EXEC SQL                                                     16240099
162600          FETCH CEPLAU-CSR-STR                                    16250099
162700           INTO :CEPLAU-CNSTK-REQ-PL-NBR                          16260099
162800              , :CEPLAU-PL-LNE-NBR                                16270099
162900              , :CEPLAU-STR-NBR                                   16280099
163000              , :CEPLAU-ADJ-TMST                                  16290099
163100              , :CEPLAU-BEF-ADJ-UNT-QTY                           16300099
163200              , :CEPLAU-AFT-ADJ-UNT-QTY                           16310099
163300              , :CEPLAU-ADJ-BY-USR-ID                             16320099
163400              , :CEPLAU-EXPRT-PRC-BTCH-ID                         16330099
163500              , :CEPLAU-ADJ-RSN-DESC                              16340099
163600     END-EXEC.                                                    16350099
163700                                                                  16360099
163800     EVALUATE TRUE                                                16370099
163900         WHEN SQLCODE = ZERO                                      16380099
164000             CONTINUE                                             16390099
164100                                                                  16400099
164200         WHEN SQLCODE = +100                                      16410099
164300             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  16420099
164400                                                                  16430099
164500         WHEN SQLWARN0 NOT = SPACE                                16440099
164600         WHEN SQLCODE NOT = ZERO                                  16450099
164700             MOVE '4310-FETCH-CURSOR'                             16460099
164800                                 TO DP013-PARAGRAPH               16470099
164900             MOVE 'FETCH CEPLAU STORE CURSOR'                     16480099
165000                                 TO DP013-MESSAGE-TEXT (1)        16490099
165100             MOVE SQLCA          TO DP013-SQLCA                   16500099
165200             SET DP013-DB2-ABEND TO TRUE                          16510099
165300             PERFORM DP013-0000-PROCESS-ABEND                     16520099
165400     END-EVALUATE.                                                16530099
165500                                                                  16540099
165600*----------------------------------------------------------------*16550099
165700* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *16560099
165800*----------------------------------------------------------------*16570099
165900 4400-MOVE-COMMAREA-TO-SCREEN.                                    16580099
166000                                                                  16590099
166100     IF (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))              16600099
166200       AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))            16610099
166300        OR (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))            16620099
166400         MOVE +1    TO ASC-BLK-SUB                                16630099
166500         PERFORM 5100-WRITE-TEMP-STORAGE                          16640099
166600         ADD +1     TO ASC-BLK-SUB                                16650099
166700         PERFORM 5100-WRITE-TEMP-STORAGE                          16660099
166800         DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL                 16670099
166900             GIVING PV-BLOCK-NUMBER                               16680099
167000             REMAINDER PV-REMAINDER                               16690099
167100         IF PV-REMAINDER > ZERO                                   16700099
167200             ADD +1 TO PV-BLOCK-NUMBER                            16710099
167300         END-IF                                                   16720099
167400         MOVE +1    TO ASC-BLK-SUB                                16730099
167500         PERFORM 4410-READ-TEMP-STORAGE                           16740099
167600         ADD +1     TO ASC-BLK-SUB                                16750099
167700                       PV-BLOCK-NUMBER                            16760099
167800         PERFORM 4410-READ-TEMP-STORAGE                           16770099
167900     END-IF.                                                      16780099
168000                                                                  16790099
168100     MOVE +1        TO ASC-BLK-SUB.                               16800099
168200     COMPUTE ASC-ITEM-SUB =                                       16810099
168300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              16820099
168400         + PC-ITEMS-PER-PANEL).                                   16830099
168500                                                                  16840099
168600     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16850099
168700         ADD +1     TO ASC-BLK-SUB                                16860099
168800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16870099
168900     END-IF.                                                      16880099
169000                                                                  16890099
169100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           16900099
169200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                16910099
169300                                                                  16920099
169400     PERFORM 4420-FORMAT-LIST-LINES                               16930099
169500       VARYING PV-SUB FROM PC-ITEMS-PER-PANEL BY -1               16940099
169600         UNTIL PV-SUB < +1.                                       16950099
169700                                                                  16960099
169800     COMPUTE ASC-ITEMS-DISPLAYED =                                16970099
169900         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          16980099
170000                                                                  16990099
170100     MOVE PV-TOP-ITEM                TO ASC-ITEM-AT-TOP-OF-PANEL  17000099
170200                                        ASTRTITO.                 17010099
170300     MOVE ASC-ITEM-AT-BOT-OF-PANEL   TO AENDITO.                  17020099
170400     MOVE ASC-NUMBER-OF-ITEMS-READ   TO ATOTITO.                  17030099
170500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            17040099
170600                                     TO ASELITO.                  17050099
170700                                                                  17060099
170800     MOVE ASC-CS-LOC                 TO PV-DISPLAY-ZERO.          17070099
170900     MOVE PV-DISPLAY-ZERO            TO ALOCIDO.                  17080099
171000                                                                  17090099
171100     MOVE ASC-KEY-STORE-NBR   TO PV-DISPLAY-ZERO                  17100099
171200                                 DK-STR-NUMBER.                   17110099
171300     IF ASC-KEY-STORE-NBR-A = ' ALL'                              17120099
171400         MOVE ' ALL'          TO ASTRNOO                          17130099
171500     ELSE                                                         17140099
171600         MOVE PV-DISPLAY-ZERO TO ASTRNOO                          17150099
171700     END-IF.                                                      17160099
171800                                                                  17170099
171900     MOVE ASC-PULL-NBR               TO APULNOO                   17180099
172000                                        DK-PULL-NUMBER.           17190099
172100     MOVE ASC-LINE-NBR               TO ALNENOO                   17200099
172200                                        DK-LINE-NUMBER.           17210099
172300                                                                  17220099
172400     MOVE ASC-SKU-NUMBER             TO ASKUO.                    17230099
172500     MOVE ASC-SKU-RETAIL             TO ASKRETO.                  17240099
172600                                                                  17250099
172700     MOVE ASC-MANIFEST-UNTS          TO AMFUNTO.                  17260099
172800     MOVE ASC-ADJUST-UNTS            TO AADJUNTO.                 17270099
172900     MOVE ASC-DISTRB-UNTS            TO ADSUNTO.                  17280099
173000     MOVE ASC-DISTRB-RETAIL          TO ADSRTLO.                  17290099
173100                                                                  17300099
173200     IF DP020-MSG-NUMBER-X = SPACE                                17310099
173300         IF ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ   17320099
173400*            --- MORE ITEMS TO DISPLAY ----                       17330099
173500             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            17340099
173600             SET DP020-MSG-INFORMATIONAL TO TRUE                  17350099
173700         END-IF                                                   17360099
173800     END-IF.                                                      17370099
173900                                                                  17380099
174000*----------------------------------------------------------------*17390099
174100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *17400099
174200*----------------------------------------------------------------*17410099
174300 4410-READ-TEMP-STORAGE.                                          17420099
174400                                                                  17430099
174500     EXEC CICS                                                    17440099
174600         READQ TS                                                 17450099
174700             QUEUE (ASC-LIST-QUEUE-NAME)                          17460099
174800             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               17470099
174900             ITEM  (PV-BLOCK-NUMBER)                              17480099
175000             RESP  (PV-CICS-RESP)                                 17490099
175100     END-EXEC.                                                    17500099
175200                                                                  17510099
175300     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       17520099
175400       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     17530099
175500         CONTINUE                                                 17540099
175600     ELSE                                                         17550099
175700         SET DP013-CICS-ABEND     TO TRUE                         17560099
175800         SET DP013-NO-ROLLBACK    TO TRUE                         17570099
175900         MOVE '4410-READ-TEMP-STORAGE'                            17580099
176000                                  TO DP013-PARAGRAPH              17590099
176100         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      17600099
176200                                  TO DP013-MESSAGE-TEXT(1)        17610099
176300         PERFORM DP013-0000-PROCESS-ABEND                         17620099
176400     END-IF.                                                      17630099
176500                                                                  17640099
176600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             17650099
176700                                                                  17660099
176800     IF PV-CICS-RESP = DFHRESP (ITEMERR)                          17670099
176900         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               17680099
177000     END-IF.                                                      17690099
177100                                                                  17700099
177200*----------------------------------------------------------------*17710099
177300*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *17720099
177400*----------------------------------------------------------------*17730099
177500 4420-FORMAT-LIST-LINES.                                          17740099
177600                                                                  17750099
177700     IF ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ       17760099
177800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                17770099
177900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           17780099
178000                                    MR-ADJ-UNITSA (PV-SUB)        17790099
178100                                    MR-BEF-UNITSA (PV-SUB)        17800099
178200                                    MR-AFT-UNITSA (PV-SUB)        17810099
178300         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           17820099
178400         MOVE ZEROES             TO MR-STORE-NUMBER (PV-SUB)      17830099
178500                                    MR-ADJ-UNITS (PV-SUB)         17840099
178600                                    MR-BEF-UNITS (PV-SUB)         17850099
178700                                    MR-AFT-UNITS (PV-SUB)         17860099
178800         MOVE SPACES             TO MR-DATE-TIME (PV-SUB)         17870099
178900                                    MR-ADJ-BY (PV-SUB)            17880099
179000                                    MR-BATCH-NBR (PV-SUB)         17890099
179100     ELSE                                                         17900099
179200         IF ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)       17910099
179300                                                   > SPACE        17920099
179400             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17930099
179500                                 TO MR-SELECTI (PV-SUB)           17940099
179600         ELSE                                                     17950099
179700             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      17960099
179800                                 TO MR-SELECTI (PV-SUB)           17970099
179900         END-IF                                                   17980099
180000                                                                  17990099
180100         IF DP030-SET-CURSOR-TRAILER                              18000099
180200             IF ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 18010099
180300                 > SPACE)                                         18020099
180400               OR (PV-SUB = 1))                                   18030099
180500                SET DP030-SET-CURSOR-APPL-1 TO TRUE               18040099
180600                MOVE -1          TO MR-SELECTL (PV-SUB)           18050099
180700             END-IF                                               18060099
180800         END-IF                                                   18070099
180900                                                                  18080099
181000         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               18090099
181100                                 TO MR-ACTION (PV-SUB)            18100099
181200         MOVE ASC-STORE-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)         18110099
181300                                 TO MR-STORE-NUMBER (PV-SUB)      18120099
181400         MOVE ASC-DATE-TIME (ASC-BLK-SUB ASC-ITEM-SUB)            18130099
181500                                 TO MR-DATE-TIME (PV-SUB)         18140099
181600         MOVE ASC-ADJ-UNITS (ASC-BLK-SUB ASC-ITEM-SUB)            18150099
181700                                 TO MR-ADJ-UNITS (PV-SUB)         18160099
181800         MOVE ASC-BEF-UNITS (ASC-BLK-SUB ASC-ITEM-SUB)            18170099
181900                                 TO MR-BEF-UNITS (PV-SUB)         18180099
182000         MOVE ASC-AFT-UNITS (ASC-BLK-SUB ASC-ITEM-SUB)            18190099
182100                                 TO MR-AFT-UNITS (PV-SUB)         18200099
182200         MOVE ASC-ADJ-BY (ASC-BLK-SUB ASC-ITEM-SUB)               18210099
182300                                 TO MR-ADJ-BY (PV-SUB)            18220099
182400         MOVE ASC-BATCH-NBR (ASC-BLK-SUB ASC-ITEM-SUB)            18230099
182500                                 TO MR-BATCH-NBR (PV-SUB)         18240099
182600     END-IF.                                                      18250099
182700                                                                  18260099
182800     SUBTRACT +1 FROM ASC-ITEM-SUB                                18270099
182900     IF ASC-ITEM-SUB < + 1                                        18280099
183000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  18290099
183100         MOVE +1                 TO ASC-BLK-SUB                   18300099
183200     END-IF.                                                      18310099
183300                                                                  18320099
183400*----------------------------------------------------------------*18330099
183500* GET STORE DISTRIBUTION QUANTITY                                *18340099
183600*----------------------------------------------------------------*18350099
183700 4500-GET-CEPLDS-QTY.                                             18360099
183800                                                                  18370099
183900     INITIALIZE PV-NULL-IND-1.                                    18380099
184000                                                                  18390099
184100     EXEC SQL                                                     18400099
184200          SELECT  ACTL_DISTRB_QTY                                 18410099
184300            INTO  :CEPLDS-ACTL-DISTRB-QTY :PV-NULL-IND-1          18420099
184400            FROM  TCEPLDS                                         18430099
184500           WHERE  CNSTK_REQ_PL_NBR = :DK-PULL-NUMBER              18440099
184600             AND  PL_LNE_NBR       = :DK-LINE-NUMBER              18450099
184700             AND  STR_NBR          = :DK-STR-NUMBER               18460099
184800     END-EXEC.                                                    18470099
184900                                                                  18480099
185000     EVALUATE TRUE                                                18490099
185100         WHEN SQLCODE = +0                                        18500099
185200             IF PV-NULL-IND-1 < +0                                18510099
185300                 MOVE ZEROES TO ASC-DISTRB-UNTS                   18520099
185400                                ASC-DISTRB-RETAIL                 18530099
185500             ELSE                                                 18540099
185600                 MOVE CEPLDS-ACTL-DISTRB-QTY TO ASC-DISTRB-UNTS   18550099
185700                 COMPUTE ASC-DISTRB-RETAIL ROUNDED                18560099
185800                       = ASC-DISTRB-UNTS                          18570099
185900                       * ASC-SKU-RETAIL                           18580099
186000             END-IF                                               18590099
186100                                                                  18600099
186200         WHEN SQLCODE = +100                                      18610099
186300             MOVE ZEROES TO ASC-DISTRB-UNTS                       18620099
186400                            ASC-DISTRB-RETAIL                     18630099
186500                                                                  18640099
186600         WHEN SQLCODE = -904                                      18650099
186700         WHEN SQLCODE = -911                                      18660099
186800         WHEN SQLCODE = -913                                      18670099
186900             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    18680099
187000             MOVE '4500-GET-CEPLDS-QTY'     TO PV-SOFT-PARAGRAPH  18690099
187100             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  18700099
187200             MOVE LENGTH OF PV-CICS-MSG-AREA2                     18710099
187300               TO PV-COMMAREA-LENGTH                              18720099
187400             EXEC CICS                                            18730099
187500                  WRITEQ TD                                       18740099
187600                   QUEUE  ('CSSL')                                18750099
187700                    FROM  (PV-CICS-MSG-AREA2)                     18760099
187800                  LENGTH  (PV-COMMAREA-LENGTH)                    18770099
187900                    RESP  (PV-CICS-RESP)                          18780099
188000             END-EXEC                                             18790099
188100             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          18800099
188200             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              18810099
188300             PERFORM 9900-SOFT-ABORT                              18820099
188400                                                                  18830099
188500         WHEN OTHER                                               18840099
188600             MOVE '4500-GET-CEPLDS-QTY'  TO DP013-PARAGRAPH       18850099
188700             MOVE 'GET PULL DISTRIBTION' TO DP013-MESSAGE-TEXT (1)18860099
188800             MOVE SQLCA                  TO DP013-SQLCA           18870099
188900             MOVE 'TCEPLDS ' TO DP013-DB2-TABLE-NAME (1)          18880099
189000             SET DP013-DB2-ABEND                                  18890099
189100                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18900099
189200             PERFORM DP013-0000-PROCESS-ABEND                     18910099
189300     END-EVALUATE.                                                18920099
189400                                                                  18930099
189500*----------------------------------------------------------------*18940099
189600* GET ALL STORE DISTRIBUTION QUANTITIES                          *18950099
189700*----------------------------------------------------------------*18960099
189800 4501-GET-CEPLDS-QTY.                                             18970099
189900                                                                  18980099
190000     INITIALIZE PV-NULL-IND-1.                                    18990099
190100                                                                  19000099
190200     EXEC SQL                                                     19010099
190300          SELECT SUM(ACTL_DISTRB_QTY)                             19020099
190400            INTO  :CEPLDS-ACTL-DISTRB-QTY :PV-NULL-IND-1          19030099
190500            FROM  TCEPLDS                                         19040099
190600           WHERE  CNSTK_REQ_PL_NBR = :DK-PULL-NUMBER              19050099
190700             AND  PL_LNE_NBR       = :DK-LINE-NUMBER              19060099
190800***          AND  STR_NBR          = :DK-STR-NUMBER               19070099
190900     END-EXEC.                                                    19080099
191000                                                                  19090099
191100     EVALUATE TRUE                                                19100099
191200         WHEN SQLCODE = +0                                        19110099
191300             IF PV-NULL-IND-1 < +0                                19120099
191400                 MOVE ZEROES TO ASC-DISTRB-UNTS                   19130099
191500                                ASC-DISTRB-RETAIL                 19140099
191600             ELSE                                                 19150099
191700                 MOVE CEPLDS-ACTL-DISTRB-QTY TO ASC-DISTRB-UNTS   19160099
191800                 COMPUTE ASC-DISTRB-RETAIL ROUNDED                19170099
191900                       = ASC-DISTRB-UNTS                          19180099
192000                       * ASC-SKU-RETAIL                           19190099
192100             END-IF                                               19200099
192200                                                                  19210099
192300         WHEN SQLCODE = +100                                      19220099
192400             MOVE ZEROES TO ASC-DISTRB-UNTS                       19230099
192500                            ASC-DISTRB-RETAIL                     19240099
192600                                                                  19250099
192700         WHEN SQLCODE = -904                                      19260099
192800         WHEN SQLCODE = -911                                      19270099
192900         WHEN SQLCODE = -913                                      19280099
193000             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    19290099
193100             MOVE '4501-GET-CEPLDS-QTY'     TO PV-SOFT-PARAGRAPH  19300099
193200             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  19310099
193300             MOVE LENGTH OF PV-CICS-MSG-AREA2                     19320099
193400               TO PV-COMMAREA-LENGTH                              19330099
193500             EXEC CICS                                            19340099
193600                  WRITEQ TD                                       19350099
193700                   QUEUE  ('CSSL')                                19360099
193800                    FROM  (PV-CICS-MSG-AREA2)                     19370099
193900                  LENGTH  (PV-COMMAREA-LENGTH)                    19380099
194000                    RESP  (PV-CICS-RESP)                          19390099
194100             END-EXEC                                             19400099
194200             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          19410099
194300             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              19420099
194400             PERFORM 9900-SOFT-ABORT                              19430099
194500                                                                  19440099
194600         WHEN OTHER                                               19450099
194700             MOVE '4501-GET-CEPLDS-QTY'  TO DP013-PARAGRAPH       19460099
194800             MOVE 'GET PULL DISTRIBTION' TO DP013-MESSAGE-TEXT (1)19470099
194900             MOVE SQLCA                  TO DP013-SQLCA           19480099
195000             MOVE 'TCEPLDS ' TO DP013-DB2-TABLE-NAME (1)          19490099
195100             SET DP013-DB2-ABEND                                  19500099
195200                 DP013-XCTL-DISPLAY-RESTART TO TRUE               19510099
195300             PERFORM DP013-0000-PROCESS-ABEND                     19520099
195400     END-EVALUATE.                                                19530099
195500                                                                  19540099
195600*----------------------------------------------------------------*19550099
195700* GET STORE MANIFEST QUANTITY                                    *19560099
195800*----------------------------------------------------------------*19570099
195900 4510-GET-CEPLMF-QTY.                                             19580099
196000                                                                  19590099
196100     INITIALIZE PV-NULL-IND-2.                                    19600099
196200                                                                  19610099
196300     EXEC SQL                                                     19620099
196400        SELECT SUM(MFST_UNT_QTY)                                  19630099
196500          INTO  :CEPLMF-MFST-UNT-QTY :PV-NULL-IND-2               19640099
196600          FROM  TCEPLMF                                           19650099
196700         WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NUMBER              19660099
196800           AND  PL_LNE_NBR         = :DK-LINE-NUMBER              19670099
196900           AND  STR_NBR            = :DK-STR-NUMBER               19680099
197000     END-EXEC.                                                    19690099
197100                                                                  19700099
197200     EVALUATE TRUE                                                19710099
197300         WHEN SQLCODE = ZERO                                      19720099
197400             IF PV-NULL-IND-2 < +0                                19730099
197500                 MOVE ZEROES TO ASC-MANIFEST-UNTS                 19740099
197600             ELSE                                                 19750099
197700                 MOVE CEPLMF-MFST-UNT-QTY TO ASC-MANIFEST-UNTS    19760099
197800             END-IF                                               19770099
197900                                                                  19780099
198000         WHEN SQLCODE = -904                                      19790099
198100         WHEN SQLCODE = -911                                      19800099
198200         WHEN SQLCODE = -913                                      19810099
198300             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    19820099
198400             MOVE '4510-GET-CEPLMF-QTY'     TO PV-SOFT-PARAGRAPH  19830099
198500             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  19840099
198600             MOVE LENGTH OF PV-CICS-MSG-AREA2                     19850099
198700               TO PV-COMMAREA-LENGTH                              19860099
198800             EXEC CICS                                            19870099
198900                  WRITEQ TD                                       19880099
199000                   QUEUE  ('CSSL')                                19890099
199100                    FROM  (PV-CICS-MSG-AREA2)                     19900099
199200                  LENGTH  (PV-COMMAREA-LENGTH)                    19910099
199300                    RESP  (PV-CICS-RESP)                          19920099
199400             END-EXEC                                             19930099
199500             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          19940099
199600             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              19950099
199700             PERFORM 9900-SOFT-ABORT                              19960099
199800         WHEN OTHER                                               19970099
199900             MOVE '4510-GET-CEPLMF-QTY' TO DP013-PARAGRAPH        19980099
200000             MOVE 'GET MANIFEST UNITS'  TO DP013-MESSAGE-TEXT (1) 19990099
200100             MOVE SQLCA                 TO DP013-SQLCA            20000099
200200             MOVE 'TCEPLMF ' TO DP013-DB2-TABLE-NAME (1)          20010099
200300             SET DP013-DB2-ABEND                                  20020099
200400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20030099
200500             PERFORM DP013-0000-PROCESS-ABEND                     20040099
200600     END-EVALUATE.                                                20050099
200700                                                                  20060099
200800*----------------------------------------------------------------*20070099
200900* GET ALL STORE MANIFEST QUANTITIES                              *20080099
201000*----------------------------------------------------------------*20090099
201100 4511-GET-CEPLMF-QTY.                                             20100099
201200                                                                  20110099
201300     INITIALIZE PV-NULL-IND-2.                                    20120099
201400                                                                  20130099
201500     EXEC SQL                                                     20140099
201600        SELECT SUM(MFST_UNT_QTY)                                  20150099
201700          INTO  :CEPLMF-MFST-UNT-QTY :PV-NULL-IND-2               20160099
201800          FROM  TCEPLMF                                           20170099
201900         WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NUMBER              20180099
202000           AND  PL_LNE_NBR         = :DK-LINE-NUMBER              20190099
202100***        AND  STR_NBR            = :DK-STR-NUMBER               20200099
202200     END-EXEC.                                                    20210099
202300                                                                  20220099
202400     EVALUATE TRUE                                                20230099
202500         WHEN SQLCODE = ZERO                                      20240099
202600             IF PV-NULL-IND-2 < +0                                20250099
202700                 MOVE ZEROES TO ASC-MANIFEST-UNTS                 20260099
202800             ELSE                                                 20270099
202900                 MOVE CEPLMF-MFST-UNT-QTY TO ASC-MANIFEST-UNTS    20280099
203000             END-IF                                               20290099
203100                                                                  20300099
203200         WHEN SQLCODE = -904                                      20310099
203300         WHEN SQLCODE = -911                                      20320099
203400         WHEN SQLCODE = -913                                      20330099
203500             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    20340099
203600             MOVE '4511-GET-CEPLMF-QTY'     TO PV-SOFT-PARAGRAPH  20350099
203700             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  20360099
203800             MOVE LENGTH OF PV-CICS-MSG-AREA2                     20370099
203900               TO PV-COMMAREA-LENGTH                              20380099
204000             EXEC CICS                                            20390099
204100                  WRITEQ TD                                       20400099
204200                   QUEUE  ('CSSL')                                20410099
204300                    FROM  (PV-CICS-MSG-AREA2)                     20420099
204400                  LENGTH  (PV-COMMAREA-LENGTH)                    20430099
204500                    RESP  (PV-CICS-RESP)                          20440099
204600             END-EXEC                                             20450099
204700             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          20460099
204800             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              20470099
204900             PERFORM 9900-SOFT-ABORT                              20480099
205000         WHEN OTHER                                               20490099
205100             MOVE '4511-GET-CEPLMF-QTY' TO DP013-PARAGRAPH        20500099
205200             MOVE 'GET MANIFEST UNITS'  TO DP013-MESSAGE-TEXT (1) 20510099
205300             MOVE SQLCA                 TO DP013-SQLCA            20520099
205400             MOVE 'TCEPLMF ' TO DP013-DB2-TABLE-NAME (1)          20530099
205500             SET DP013-DB2-ABEND                                  20540099
205600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               20550099
205700             PERFORM DP013-0000-PROCESS-ABEND                     20560099
205800     END-EVALUATE.                                                20570099
205900                                                                  20580099
206000*----------------------------------------------------------------*20590099
206100* GET STORE ADJUSTMENT QUANTITY                                  *20600099
206200*----------------------------------------------------------------*20610099
206300 4520-GET-CEPLAU-QTY.                                             20620099
206400                                                                  20630099
206500     INITIALIZE PV-NULL-IND-1                                     20640099
206600                PV-NULL-IND-2                                     20650099
206700                CEPLAU-BEF-ADJ-UNT-QTY                            20660099
206800                CEPLAU-AFT-ADJ-UNT-QTY.                           20670099
206900                                                                  20680099
207000     EXEC SQL                                                     20690099
207100        SELECT  SUM(BEF_ADJ_UNT_QTY)                              20700099
207200             ,  SUM(AFT_ADJ_UNT_QTY)                              20710099
207300          INTO :CEPLAU-BEF-ADJ-UNT-QTY :PV-NULL-IND-1             20720099
207400             , :CEPLAU-AFT-ADJ-UNT-QTY :PV-NULL-IND-2             20730099
207500          FROM  TCEPLAU                                           20740099
207600         WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NUMBER              20750099
207700           AND  PL_LNE_NBR         = :DK-LINE-NUMBER              20760099
207800           AND  STR_NBR            = :DK-STR-NUMBER               20770099
207900     END-EXEC.                                                    20780099
208000                                                                  20790099
208100     EVALUATE TRUE                                                20800099
208200         WHEN SQLCODE = ZERO                                      20810099
208300             COMPUTE ASC-ADJUST-UNTS = CEPLAU-AFT-ADJ-UNT-QTY     20820099
208400                                     - CEPLAU-BEF-ADJ-UNT-QTY     20830099
208500                                                                  20840099
208600         WHEN SQLCODE = -904                                      20850099
208700         WHEN SQLCODE = -911                                      20860099
208800         WHEN SQLCODE = -913                                      20870099
208900             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    20880099
209000             MOVE '4520-GET-CEPLAU-QTY'     TO PV-SOFT-PARAGRAPH  20890099
209100             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  20900099
209200             MOVE LENGTH OF PV-CICS-MSG-AREA2                     20910099
209300               TO PV-COMMAREA-LENGTH                              20920099
209400             EXEC CICS                                            20930099
209500                  WRITEQ TD                                       20940099
209600                   QUEUE  ('CSSL')                                20950099
209700                    FROM  (PV-CICS-MSG-AREA2)                     20960099
209800                  LENGTH  (PV-COMMAREA-LENGTH)                    20970099
209900                    RESP  (PV-CICS-RESP)                          20980099
210000             END-EXEC                                             20990099
210100             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          21000099
210200             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              21010099
210300             PERFORM 9900-SOFT-ABORT                              21020099
210400         WHEN OTHER                                               21030099
210500             MOVE '4520-GET-CEPLAU-QTY'  TO DP013-PARAGRAPH       21040099
210600             MOVE 'GET ADJUSTMENT UNITS' TO DP013-MESSAGE-TEXT (1)21050099
210700             MOVE SQLCA                  TO DP013-SQLCA           21060099
210800             MOVE 'TCEPLAU ' TO DP013-DB2-TABLE-NAME (1)          21070099
210900             SET DP013-DB2-ABEND                                  21080099
211000                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21090099
211100             PERFORM DP013-0000-PROCESS-ABEND                     21100099
211200     END-EVALUATE.                                                21110099
211300                                                                  21120099
211400*----------------------------------------------------------------*21130099
211500* GET ALL STORE ADJUSTMENT QUANTITIES                            *21140099
211600*----------------------------------------------------------------*21150099
211700 4521-GET-CEPLAU-QTY.                                             21160099
211800                                                                  21170099
211900     INITIALIZE PV-NULL-IND-1                                     21180099
212000                PV-NULL-IND-2                                     21190099
212100                CEPLAU-BEF-ADJ-UNT-QTY                            21200099
212200                CEPLAU-AFT-ADJ-UNT-QTY.                           21210099
212300                                                                  21220099
212400     EXEC SQL                                                     21230099
212500        SELECT  SUM(BEF_ADJ_UNT_QTY)                              21240099
212600             ,  SUM(AFT_ADJ_UNT_QTY)                              21250099
212700          INTO :CEPLAU-BEF-ADJ-UNT-QTY :PV-NULL-IND-1             21260099
212800             , :CEPLAU-AFT-ADJ-UNT-QTY :PV-NULL-IND-2             21270099
212900          FROM  TCEPLAU                                           21280099
213000         WHERE  CNSTK_REQ_PL_NBR   = :DK-PULL-NUMBER              21290099
213100           AND  PL_LNE_NBR         = :DK-LINE-NUMBER              21300099
213200***        AND  STR_NBR            = :DK-STR-NUMBER               21310099
213300     END-EXEC.                                                    21320099
213400                                                                  21330099
213500     EVALUATE TRUE                                                21340099
213600         WHEN SQLCODE = ZERO                                      21350099
213700             COMPUTE ASC-ADJUST-UNTS = CEPLAU-AFT-ADJ-UNT-QTY     21360099
213800                                     - CEPLAU-BEF-ADJ-UNT-QTY     21370099
213900                                                                  21380099
214000         WHEN SQLCODE = -904                                      21390099
214100         WHEN SQLCODE = -911                                      21400099
214200         WHEN SQLCODE = -913                                      21410099
214300             MOVE SQLCODE                   TO PV-SOFT-SQLCODE    21420099
214400             MOVE '4521-GET-CEPLAU-QTY'     TO PV-SOFT-PARAGRAPH  21430099
214500             MOVE PV-SOFT-ABORT-MSG         TO PV-CICS-MSG-AREA2  21440099
214600             MOVE LENGTH OF PV-CICS-MSG-AREA2                     21450099
214700               TO PV-COMMAREA-LENGTH                              21460099
214800             EXEC CICS                                            21470099
214900                  WRITEQ TD                                       21480099
215000                   QUEUE  ('CSSL')                                21490099
215100                    FROM  (PV-CICS-MSG-AREA2)                     21500099
215200                  LENGTH  (PV-COMMAREA-LENGTH)                    21510099
215300                    RESP  (PV-CICS-RESP)                          21520099
215400             END-EXEC                                             21530099
215500             MOVE  PC-TSYMSG-00984  TO  DP020-MSG-NUMBER          21540099
215600             SET  DP020-NEXT-ACT-APPL-ERROR  TO TRUE              21550099
215700             PERFORM 9900-SOFT-ABORT                              21560099
215800         WHEN OTHER                                               21570099
215900             MOVE '4521-GET-CEPLAU-QTY'  TO DP013-PARAGRAPH       21580099
216000             MOVE 'GET ADJUSTMENT UNITS' TO DP013-MESSAGE-TEXT (1)21590099
216100             MOVE SQLCA                  TO DP013-SQLCA           21600099
216200             MOVE 'TCEPLAU ' TO DP013-DB2-TABLE-NAME (1)          21610099
216300             SET DP013-DB2-ABEND                                  21620099
216400                 DP013-XCTL-DISPLAY-RESTART TO TRUE               21630099
216500             PERFORM DP013-0000-PROCESS-ABEND                     21640099
216600     END-EVALUATE.                                                21650099
216700                                                                  21660099
216800*----------------------------------------------------------------*21670099
216900* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *21680099
217000* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *21690099
217100* FOR THE SELECTED ITEMS QUEUE.                                  *21700099
217200*                                                                *21710099
217300* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *21720099
217400* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *21730099
217500* THE ARRAY IS FULL.                                             *21740099
217600*----------------------------------------------------------------*21750099
217700 5000-PREPARE-SEL-QUEUE.                                          21760099
217800                                                                  21770099
217900     MOVE +1                   TO  ASC-BLK-SUB.                   21780099
218000     PERFORM 5100-WRITE-TEMP-STORAGE.                             21790099
218100     ADD +1                    TO  ASC-BLK-SUB.                   21800099
218200     PERFORM 5100-WRITE-TEMP-STORAGE.                             21810099
218300                                                                  21820099
218400     MOVE ASC-SEL-QUEUE-NAME   TO  CE002-SEL-QUEUE-NAME.          21830099
218500     PERFORM 6010-DELETE-SEL-QUEUE.                               21840099
218600                                                                  21850099
218700     SET ASC-UPDATE-TSQ        TO  TRUE.                          21860099
218800                                                                  21870099
218900     SET CE003-IDX             TO  1.                             21880099
219000     MOVE ZERO                 TO CE002-NUMBER-OF-TS-ITEMS.       21890099
219100     INITIALIZE CE003-SELECTED-ITEM-ARRAY.                        21900099
219200                                                                  21910099
219300     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           21920099
219400       VARYING PV-ITEM FROM 1 BY 1                                21930099
219500         UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.         21940099
219600                                                                  21950099
219700     IF CE003-IDX > 1                                             21960099
219800         PERFORM 5205-WRITE-SEL-QUEUE                             21970099
219900         ADD  +1 TO CE002-NUMBER-OF-TS-ITEMS                      21980099
220000     END-IF.                                                      21990099
220100                                                                  22000099
220200*----------------------------------------------------------------*22010099
220300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22020099
220400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22030099
220500*----------------------------------------------------------------*22040099
220600 5100-WRITE-TEMP-STORAGE.                                         22050099
220700                                                                  22060099
220800     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22070099
220900                                   TO PV-LIST-ITEM-NUMBER.        22080099
221000     COMPUTE PV-BLOCK-NUMBER =                                    22090099
221100         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22100099
221200                                                                  22110099
221300     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22120099
221400     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22130099
221500         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22140099
221600             PERFORM 5105-REWRITE-ASC-LISTQ                       22150099
221700         END-IF                                                   22160099
221800     ELSE                                                         22170099
221900         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22180099
222000         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22190099
222100         PERFORM 5110-WRITE-ASC-LISTQ                             22200099
222200         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22210099
222300     END-IF.                                                      22220099
222400                                                                  22230099
222500     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22240099
222600                                                                  22250099
222700******************************************************************22260099
222800** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22270099
222900** SPECIFIC COMMAREA.                                           **22280099
223000******************************************************************22290099
223100 5105-REWRITE-ASC-LISTQ.                                          22300099
223200                                                                  22310099
223300     EXEC CICS                                                    22320099
223400         WRITEQ TS                                                22330099
223500             QUEUE (ASC-LIST-QUEUE-NAME)                          22340099
223600             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22350099
223700             ITEM  (PV-BLOCK-NUMBER)                              22360099
223800             REWRITE                                              22370099
223900             RESP  (PV-CICS-RESP)                                 22380099
224000     END-EXEC.                                                    22390099
224100                                                                  22400099
224200     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22410099
224300         CONTINUE                                                 22420099
224400     ELSE                                                         22430099
224500         SET DP013-CICS-ABEND            TO TRUE                  22440099
224600         SET DP013-NO-ROLLBACK           TO TRUE                  22450099
224700         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22460099
224800         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22470099
224900                                         TO DP013-MESSAGE-TEXT(1) 22480099
225000         PERFORM DP013-0000-PROCESS-ABEND                         22490099
225100     END-IF.                                                      22500099
225200                                                                  22510099
225300******************************************************************22520099
225400** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22530099
225500** SPECIFIC COMMAREA.                                           **22540099
225600******************************************************************22550099
225700 5110-WRITE-ASC-LISTQ.                                            22560099
225800                                                                  22570099
225900     EXEC CICS                                                    22580099
226000         WRITEQ TS                                                22590099
226100             QUEUE (ASC-LIST-QUEUE-NAME)                          22600099
226200             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22610099
226300             ITEM  (PV-BLOCK-NUMBER)                              22620099
226400             RESP  (PV-CICS-RESP)                                 22630099
226500     END-EXEC.                                                    22640099
226600     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22650099
226700         SET DP013-CICS-ABEND      TO TRUE                        22660099
226800         SET DP013-NO-ROLLBACK     TO TRUE                        22670099
226900         MOVE '5110-WRITE-ASC-LISTQ'                              22680099
227000                                   TO DP013-PARAGRAPH             22690099
227100         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           22700099
227200                                   TO DP013-MESSAGE-TEXT(1)       22710099
227300         PERFORM DP013-0000-PROCESS-ABEND                         22720099
227400     END-IF.                                                      22730099
227500                                                                  22740099
227600*----------------------------------------------------------------*22750099
227700* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *22760099
227800* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *22770099
227900*----------------------------------------------------------------*22780099
228000 5200-FILL-SEL-QUEUE-RECORD.                                      22790099
228100                                                                  22800099
228200     PERFORM 6112-READ-LIST-QUEUE.                                22810099
228300                                                                  22820099
228400     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        22830099
228500         PERFORM                                                  22840099
228600           VARYING LQW-IDX FROM 1 BY 1                            22850099
228700             UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        22860099
228800                OR LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      22870099
228900                                                                  22880099
229000             IF LQW-SELECT (LQW-IDX)                              22890099
229100                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              22900099
229200                             TO CE003-ITEM         (CE003-IDX)    22910099
229300                 MOVE SPACE  TO CE003-ACTION-SW    (CE003-IDX)    22920099
229400                 MOVE ASC-PULL-NBR                                22930099
229500                             TO CE003-PULL-NUMBER  (CE003-IDX)    22940099
229600                 MOVE ASC-CS-LOC                                  22950099
229700                             TO CE003-CS-LOCATION  (CE003-IDX)    22960099
229800                 MOVE ASC-SKU-NUMBER                              22970099
229900                             TO CE003-LINE-SKU     (CE003-IDX)    22980099
230000                 MOVE ASC-LINE-NBR                                22990099
230100                             TO CE003-LINE-ITEM    (CE003-IDX)    23000099
230200                 MOVE LQW-STORE-NUMBER (LQW-IDX)                  23010099
230300                             TO CE003-STR-NBR      (CE003-IDX)    23020099
230400                 MOVE LQW-ADJ-TMST (LQW-IDX)                      23030099
230500                             TO CE003-ADJ-TMST     (CE003-IDX)    23040099
230600                                                                  23050099
230700                 SET CE003-IDX UP BY 1                            23060099
230800                 IF CE003-IDX > CE003-MAX-ITEMS                   23070099
230900                     PERFORM 5205-WRITE-SEL-QUEUE                 23080099
231000                     ADD +1        TO CE002-NUMBER-OF-TS-ITEMS    23090099
231100                     INITIALIZE CE003-SELECTED-ITEM-ARRAY         23100099
231200                     SET CE003-IDX TO  1                          23110099
231300                 END-IF                                           23120099
231400             END-IF                                               23130099
231500         END-PERFORM                                              23140099
231600     END-IF.                                                      23150099
231700                                                                  23160099
231800*----------------------------------------------------------------*23170099
231900*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23180099
232000*----------------------------------------------------------------*23190099
232100 5205-WRITE-SEL-QUEUE.                                            23200099
232200                                                                  23210099
232300     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CE003-SELECTED-ITEMS.   23220099
232400                                                                  23230099
232500     EXEC CICS                                                    23240099
232600          WRITEQ TS                                               23250099
232700              QUEUE (ASC-SEL-QUEUE-NAME)                          23260099
232800              FROM  (CE003-SELECT-RECORD)                         23270099
232900              ITEM  (PV-SEL-QUEUE-ITEM)                           23280099
233000              RESP  (PV-CICS-RESP)                                23290099
233100     END-EXEC.                                                    23300099
233200                                                                  23310099
233300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23320099
233400         CONTINUE                                                 23330099
233500     ELSE                                                         23340099
233600         SET DP013-CICS-ABEND      TO TRUE                        23350099
233700         SET DP013-NO-ROLLBACK     TO TRUE                        23360099
233800         MOVE '5205-WRITE-SEL-QUEUE'                              23370099
233900                                   TO DP013-PARAGRAPH             23380099
234000         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23390099
234100                                   TO DP013-MESSAGE-TEXT(1)       23400099
234200         PERFORM DP013-0000-PROCESS-ABEND                         23410099
234300     END-IF.                                                      23420099
234400                                                                  23430099
234500******************************************************************23440099
234600** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **23450099
234700** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **23460099
234800** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **23470099
234900** THE USER.                                                    **23480099
235000******************************************************************23490099
235100 6000-REFRESH-PANEL-FROM-TEMP.                                    23500099
235200                                                                  23510099
235300     IF  ASC-UPDATE-TSQ                                           23520099
235400         SET ASC-NO-TSQ-UPDATE TO TRUE                            23530099
235500         MOVE ZERO                 TO PV-SAVE-ITEM                23540099
235600                                      PV-SEL-QUEUE-ITEM           23550099
235700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23560099
235800                                   TO PV-HOLD-SELECTED-ITEMS      23570099
235900         MOVE +1                   TO PV-ITEMS-PROCESSED          23580099
236000         PERFORM 6100-UPDATE-TSQ                                  23590099
236100             UNTIL PV-ITEMS-PROCESSED >                           23600099
236200                                     PV-HOLD-SELECTED-ITEMS       23610099
236300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23620099
236400                    ASC-BLOCK-ENTRIES (2)                         23630099
236500     END-IF.                                                      23640099
236600                                                                  23650099
236700*----------------------------------------------------------------*23660099
236800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *23670099
236900*----------------------------------------------------------------*23680099
237000 6010-DELETE-SEL-QUEUE.                                           23690099
237100                                                                  23700099
237200     EXEC CICS                                                    23710099
237300         DELETEQ TS                                               23720099
237400             QUEUE (ASC-SEL-QUEUE-NAME)                           23730099
237500             RESP  (PV-CICS-RESP)                                 23740099
237600     END-EXEC.                                                    23750099
237700*                                                                 23760099
237800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      23770099
237900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         23780099
238000         CONTINUE                                                 23790099
238100     ELSE                                                         23800099
238200         SET DP013-CICS-ABEND TO TRUE                             23810099
238300         SET DP013-NO-ROLLBACK TO TRUE                            23820099
238400         MOVE '6010-DELETE-SEL-QUEUE'                             23830099
238500                        TO DP013-PARAGRAPH                        23840099
238600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         23850099
238700                        TO DP013-MESSAGE-TEXT (1)                 23860099
238800         PERFORM DP013-0000-PROCESS-ABEND                         23870099
238900     END-IF.                                                      23880099
239000                                                                  23890099
239100*----------------------------------------------------------------*23900099
239200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *23910099
239300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *23920099
239400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *23930099
239500*    THE TEMP QUEUE.                                             *23940099
239600*----------------------------------------------------------------*23950099
239700 6100-UPDATE-TSQ.                                                 23960099
239800                                                                  23970099
239900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             23980099
240000     PERFORM 6105-READ-SEL-QUEUE.                                 23990099
240100     PERFORM                                                      24000099
240200         VARYING CE003-IDX                                        24010099
240300         FROM 1 BY 1                                              24020099
240400         UNTIL ((PV-ITEMS-PROCESSED >                             24030099
240500                              PV-HOLD-SELECTED-ITEMS)             24040099
240600         OR (CE003-IDX GREATER THAN CE003-MAX-ITEMS))             24050099
240700         IF  CE003-ACTION-SW (CE003-IDX) > SPACE                  24060099
240800             PERFORM 6110-PROCESS-ITEMS                           24070099
240900         END-IF                                                   24080099
241000         ADD +1                TO PV-ITEMS-PROCESSED              24090099
241100     END-PERFORM.                                                 24100099
241200     PERFORM 6111-WRITE-LIST-QUEUE.                               24110099
241300                                                                  24120099
241400*----------------------------------------------------------------*24130099
241500*    READ THE LIST QUEUE RECORD.                                 *24140099
241600*----------------------------------------------------------------*24150099
241700 6105-READ-SEL-QUEUE.                                             24160099
241800                                                                  24170099
241900     EXEC CICS                                                    24180099
242000          READQ TS                                                24190099
242100              QUEUE (ASC-SEL-QUEUE-NAME)                          24200099
242200              INTO  (CE003-SELECT-RECORD)                         24210099
242300              ITEM  (PV-SEL-QUEUE-ITEM)                           24220099
242400              RESP  (PV-CICS-RESP)                                24230099
242500     END-EXEC.                                                    24240099
242600                                                                  24250099
242700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24260099
242800         CONTINUE                                                 24270099
242900     ELSE                                                         24280099
243000         SET DP013-CICS-ABEND      TO  TRUE                       24290099
243100         SET DP013-NO-ROLLBACK     TO  TRUE                       24300099
243200         MOVE '6105-READ-SEL-QUEUE'                               24310099
243300                                   TO  DP013-PARAGRAPH            24320099
243400         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24330099
243500                                   TO  DP013-MESSAGE-TEXT(1)      24340099
243600         PERFORM DP013-0000-PROCESS-ABEND                         24350099
243700     END-IF.                                                      24360099
243800                                                                  24370099
243900*----------------------------------------------------------------*24380099
244000*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24390099
244100*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24400099
244200*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24410099
244300*----------------------------------------------------------------*24420099
244400 6110-PROCESS-ITEMS.                                              24430099
244500                                                                  24440099
244600     COMPUTE PV-ITEM = 1 + ((CE003-ITEM (CE003-IDX) - 1)          24450099
244700                     / PC-ITEMS-PER-PANEL).                       24460099
244800                                                                  24470099
244900     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24480099
245000         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24490099
245100             PERFORM 6111-WRITE-LIST-QUEUE                        24500099
245200         END-IF                                                   24510099
245300         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24520099
245400                                                                  24530099
245500         PERFORM 6112-READ-LIST-QUEUE                             24540099
245600         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24550099
245700             CONTINUE                                             24560099
245800         END-IF                                                   24570099
245900     END-IF.                                                      24580099
246000                                                                  24590099
246100     COMPUTE PV-SUB = (CE003-ITEM (CE003-IDX)                     24600099
246200                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24610099
246300     SET LQW-DESELECT (PV-SUB)             TO  TRUE.              24620099
246400     MOVE LQW-SELECTED-SW (PV-SUB)                                24630099
246500                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24640099
246600     EVALUATE TRUE                                                24650099
246700         WHEN CE003-INQ (CE003-IDX)                               24660099
246800              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24670099
246900                                                                  24680099
247000         WHEN CE003-UPD (CE003-IDX)                               24690099
247100              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             24700099
247200                                                                  24710099
247300         WHEN CE003-DEL (CE003-IDX)                               24720099
247400              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             24730099
247500                                                                  24740099
247600         WHEN CE003-ERR (CE003-IDX)                               24750099
247700              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             24760099
247800     END-EVALUATE.                                                24770099
247900                                                                  24780099
248000     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                24790099
248100                                                                  24800099
248200*----------------------------------------------------------------*24810099
248300*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *24820099
248400*----------------------------------------------------------------*24830099
248500 6111-WRITE-LIST-QUEUE.                                           24840099
248600                                                                  24850099
248700     EXEC CICS                                                    24860099
248800         WRITEQ TS                                                24870099
248900             QUEUE (ASC-LIST-QUEUE-NAME)                          24880099
249000             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     24890099
249100             ITEM  (PV-SAVE-ITEM)                                 24900099
249200             REWRITE                                              24910099
249300             RESP  (PV-CICS-RESP)                                 24920099
249400     END-EXEC.                                                    24930099
249500*                                                                 24940099
249600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24950099
249700         CONTINUE                                                 24960099
249800     ELSE                                                         24970099
249900         SET DP013-CICS-ABEND  TO  TRUE                           24980099
250000         SET DP013-NO-ROLLBACK TO  TRUE                           24990099
250100         MOVE '6111-WRITE-LIST-QUEUE'                             25000099
250200                               TO  DP013-PARAGRAPH                25010099
250300         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25020099
250400                               TO  DP013-MESSAGE-TEXT(1)          25030099
250500         PERFORM DP013-0000-PROCESS-ABEND                         25040099
250600     END-IF.                                                      25050099
250700                                                                  25060099
250800*----------------------------------------------------------------*25070099
250900*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25080099
251000*----------------------------------------------------------------*25090099
251100 6112-READ-LIST-QUEUE.                                            25100099
251200                                                                  25110099
251300     EXEC CICS                                                    25120099
251400         READQ TS                                                 25130099
251500             QUEUE (ASC-LIST-QUEUE-NAME)                          25140099
251600             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25150099
251700             ITEM  (PV-ITEM)                                      25160099
251800             RESP  (PV-CICS-RESP)                                 25170099
251900     END-EXEC.                                                    25180099
252000*                                                                 25190099
252100     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25200099
252200         CONTINUE                                                 25210099
252300     ELSE                                                         25220099
252400         SET DP013-CICS-ABEND        TO TRUE                      25230099
252500         SET DP013-NO-ROLLBACK       TO TRUE                      25240099
252600         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25250099
252700         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25260099
252800                                     TO DP013-MESSAGE-TEXT(1)     25270099
252900         PERFORM DP013-0000-PROCESS-ABEND                         25280099
253000     END-IF.                                                      25290099
253100                                                                  25300099
253200*----------------------------------------------------------------*25310099
253300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *25320099
253400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *25330099
253500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *25340099
253600*    DISPLAY THE PANEL TO USER.                                  *25350099
253700*----------------------------------------------------------------*25360099
253800 7000-DISPLAY-ALL-STORES.                                         25370099
253900                                                                  25380099
254000     INITIALIZE ASC-BLOCK-ENTRIES (1)                             25390099
254100                ASC-BLOCK-ENTRIES (2).                            25400099
254200     MOVE +1 TO ASC-BLK-SUB.                                      25410099
254300     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            25420099
254400     MOVE +0                  TO ASC-ITEM-SUB                     25430099
254500                                 ASC-NUMBER-OF-ITEMS-READ         25440099
254600                                 ASC-NUMBER-OF-SELECTED-ITEMS     25450099
254700                                 ASC-HIGHEST-BLOCK-WRITTEN        25460099
254800                                 ASC-ITEM-AT-TOP-OF-PANEL.        25470099
254900                                                                  25480099
255000     PERFORM 4100-PREPARE-DBKEYS.                                 25490099
255100     MOVE ' ALL' TO ASC-KEY-STORE-NBR-A.                          25500099
255200                                                                  25510099
255300     PERFORM 4501-GET-CEPLDS-QTY.                                 25520099
255400     PERFORM 4511-GET-CEPLMF-QTY.                                 25530099
255500                                                                  25540099
255600     PERFORM 4521-GET-CEPLAU-QTY.                                 25550099
255700                                                                  25560099
255800     PERFORM 7100-OPEN-CSR-ALL.                                   25570099
255900     PERFORM 7300-READ-ITEMS-FROM-DB.                             25580099
256000     PERFORM 7200-CLOSE-CSR-ALL.                                  25590099
256100                                                                  25600099
256200     MOVE +1 TO PV-TOP-ITEM.                                      25610099
256300     IF ASC-NUMBER-OF-ITEMS-READ = ZERO                           25620099
256400         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    25630099
256500         SET DP020-MSG-FATAL           TO TRUE                    25640099
256600         MOVE PC-TSYMSG-00050          TO DP020-MSG-NUMBER        25650099
256700     ELSE                                                         25660099
256800         MOVE -1                       TO MR-SELECTL (1)          25670099
256900         SET DP030-SET-CURSOR-APPL-1   TO TRUE                    25680099
257000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     25690099
257100     END-IF.                                                      25700099
257200                                                                  25710099
257300*----------------------------------------------------------------*25720099
257400* OPEN THE TCEPLAU CURSOR FOR ALL STORES.                        *25730099
257500*----------------------------------------------------------------*25740099
257600 7100-OPEN-CSR-ALL.                                               25750099
257700                                                                  25760099
257800     PERFORM WITH TEST AFTER                                      25770099
257900       VARYING PV-RETRY-COUNTER FROM 1 BY 1                       25780099
258000         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               25790099
258100            OR (SQLCODE = ZERO))                                  25800099
258200                                                                  25810099
258300         MOVE 'CURSOR:  CEPLAU-CSR-STR' TO DP013-MESSAGE-TEXT (2) 25820099
258400                                                                  25830099
258500         EXEC SQL                                                 25840099
258600              OPEN CEPLAU-CSR-ALL                                 25850099
258700         END-EXEC                                                 25860099
258800                                                                  25870099
258900         EVALUATE TRUE                                            25880099
259000             WHEN SQLCODE = ZERO                                  25890099
259100             WHEN SQLCODE = -904                                  25900099
259200             WHEN SQLCODE = -913                                  25910099
259300                 CONTINUE                                         25920099
259400             WHEN SQLWARN0 NOT = SPACES                           25930099
259500             WHEN SQLCODE < ZERO                                  25940099
259600             WHEN SQLCODE > ZERO                                  25950099
259700                 MOVE '7100-OPEN-CSR-ALL'                         25960099
259800                                   TO DP013-PARAGRAPH             25970099
259900                 MOVE 'OPEN CEPLAU CURSOR FOR ALL STORE'          25980099
260000                                   TO DP013-MESSAGE-TEXT (1)      25990099
260100                 MOVE SQLCA        TO DP013-SQLCA                 26000099
260200                 MOVE 'TCEPLAU '   TO DP013-DB2-TABLE-NAME (1)    26010099
260300                 SET DP013-DB2-ABEND                              26020099
260400                     DP013-XCTL-DISPLAY-RESTART TO TRUE           26030099
260500                 PERFORM DP013-0000-PROCESS-ABEND                 26040099
260600         END-EVALUATE                                             26050099
260700     END-PERFORM                                                  26060099
260800*                                                                 26070099
260900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         26080099
261000         MOVE '7100-OPEN-CSR-ALL'  TO DP013-PARAGRAPH             26090099
261100         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   26100099
261200                                   TO DP013-MESSAGE-TEXT (1)      26110099
261300         MOVE SQLCA                TO DP013-SQLCA                 26120099
261400         MOVE 'TCEPLAU '           TO DP013-DB2-TABLE-NAME (1)    26130099
261500         SET DP013-DB2-ABEND                                      26140099
261600             DP013-XCTL-DISPLAY-RESTART                           26150099
261700                                   TO TRUE                        26160099
261800         PERFORM DP013-0000-PROCESS-ABEND                         26170099
261900     END-IF.                                                      26180099
262000                                                                  26190099
262100*----------------------------------------------------------------*26200099
262200* CLOSE THE TCEPLAU CURSOR.                                      *26210099
262300*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *26220099
262400*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *26230099
262500*   USER.                                                        *26240099
262600*----------------------------------------------------------------*26250099
262700 7200-CLOSE-CSR-ALL.                                              26260099
262800                                                                  26270099
262900     EXEC SQL                                                     26280099
263000          CLOSE CEPLAU-CSR-ALL                                    26290099
263100     END-EXEC.                                                    26300099
263200                                                                  26310099
263300     EVALUATE TRUE                                                26320099
263400         WHEN SQLCODE = ZERO                                      26330099
263500             CONTINUE                                             26340099
263600         WHEN SQLWARN0 NOT = SPACES                               26350099
263700         WHEN SQLCODE < ZERO                                      26360099
263800         WHEN SQLCODE > ZERO                                      26370099
263900             MOVE '7200-CLOSE-CSR-ALL'                            26380099
264000                               TO DP013-PARAGRAPH                 26390099
264100             MOVE 'CLOSE CEPLAU CURSOR FOR ALL STORES'            26400099
264200                               TO DP013-MESSAGE-TEXT (1)          26410099
264300             MOVE SQLCA        TO DP013-SQLCA                     26420099
264400             MOVE 'TCEPLAU '   TO DP013-DB2-TABLE-NAME (1)        26430099
264500             SET DP013-DB2-ABEND                                  26440099
264600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               26450099
264700             PERFORM DP013-0000-PROCESS-ABEND                     26460099
264800     END-EVALUATE.                                                26470099
264900                                                                  26480099
265000*----------------------------------------------------------------*26490099
265100*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *26500099
265200*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *26510099
265300*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *26520099
265400*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *26530099
265500*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *26540099
265600*                                                                *26550099
265700*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *26560099
265800*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *26570099
265900*    UPON INITIALIZATION.                                        *26580099
266000*----------------------------------------------------------------*26590099
266100 7300-READ-ITEMS-FROM-DB.                                         26600099
266200                                                                  26610099
266300     PERFORM                                                      26620099
266400       VARYING PV-READ-COUNT FROM 1 BY 1                          26630099
266500         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    26640099
266600            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         26650099
266700                                                                  26660099
266800         PERFORM 7310-FETCH                                       26670099
266900                                                                  26680099
267000         IF ASC-ITEMS-LEFT-ON-DB                                  26690099
267100             IF ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                 26700099
267200                 ADD  +1  TO ASC-ITEM-SUB                         26710099
267300             ELSE                                                 26720099
267400                 ADD  +1  TO ASC-BLK-SUB                          26730099
267500                 MOVE +1  TO ASC-ITEM-SUB                         26740099
267600                                                                  26750099
267700                 IF ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY          26760099
267800                     MOVE +1  TO ASC-BLK-SUB                      26770099
267900                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           26780099
268000                     PERFORM 5100-WRITE-TEMP-STORAGE              26790099
268100                     MOVE ASC-BLOCK-ENTRIES                       26800099
268200                                         (PC-MAX-BLOCKS-IN-ARRAY) 26810099
268300                       TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB)          26820099
268400                     ADD +1   TO ASC-BLK-SUB                      26830099
268500                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   26840099
268600                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      26850099
268700                              TO TRUE                             26860099
268800                 END-IF                                           26870099
268900             END-IF                                               26880099
269000                                                                  26890099
269100             ADD  +1 TO ASC-NUMBER-OF-ITEMS-READ                  26900099
269200             MOVE ASC-NUMBER-OF-ITEMS-READ                        26910099
269300               TO ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB) 26920099
269400                                                                  26930099
269500             MOVE CEPLAU-STR-NBR                                  26940099
269600               TO ASC-STORE-NUMBER     (ASC-BLK-SUB ASC-ITEM-SUB) 26950099
269700                                                                  26960099
269800             MOVE CEPLAU-ADJ-TMST                                 26970099
269900               TO ASC-ADJ-TMST         (ASC-BLK-SUB ASC-ITEM-SUB) 26980099
270000                  PV-CEPLAU-TMST                                  26990099
270100             MOVE PV-CEPLAU-CC    TO PV-CEPLAU-CC-F               27000099
270200             MOVE PV-CEPLAU-YY    TO PV-CEPLAU-YY-F               27010099
270300             MOVE PV-CEPLAU-MM    TO PV-CEPLAU-MM-F               27020099
270400             MOVE PV-CEPLAU-DD    TO PV-CEPLAU-DD-F               27030099
270500             MOVE PV-CEPLAU-HR    TO PV-CEPLAU-HR-F               27040099
270600             MOVE PV-CEPLAU-MIN   TO PV-CEPLAU-MIN-F              27050099
270700             MOVE PV-CEPLAU-TMST-DISPLAY                          27060099
270800               TO ASC-DATE-TIME        (ASC-BLK-SUB ASC-ITEM-SUB) 27070099
270900                                                                  27080099
271000*            COMPUTE PV-CEPLAU-ADJUST-QTY                         27090099
271100*                  = CEPLAU-BEF-ADJ-UNT-QTY                       27100099
271200*                  - CEPLAU-AFT-ADJ-UNT-QTY                       27110099
271300             COMPUTE PV-CEPLAU-ADJUST-QTY                         27120099
271400                   = CEPLAU-AFT-ADJ-UNT-QTY                       27130099
271500                   - CEPLAU-BEF-ADJ-UNT-QTY                       27140099
271600                                                                  27150099
271700             MOVE PV-CEPLAU-ADJUST-QTY                            27160099
271800               TO ASC-ADJ-UNITS        (ASC-BLK-SUB ASC-ITEM-SUB) 27170099
271900                                                                  27180099
272000             MOVE CEPLAU-BEF-ADJ-UNT-QTY                          27190099
272100               TO ASC-BEF-UNITS        (ASC-BLK-SUB ASC-ITEM-SUB) 27200099
272200             MOVE CEPLAU-AFT-ADJ-UNT-QTY                          27210099
272300               TO ASC-AFT-UNITS        (ASC-BLK-SUB ASC-ITEM-SUB) 27220099
272400             MOVE CEPLAU-ADJ-BY-USR-ID                            27230099
272500               TO ASC-ADJ-BY           (ASC-BLK-SUB ASC-ITEM-SUB) 27240099
272600             MOVE CEPLAU-EXPRT-PRC-BTCH-ID                        27250099
272700               TO ASC-BATCH-NBR        (ASC-BLK-SUB ASC-ITEM-SUB) 27260099
272800         END-IF                                                   27270099
272900     END-PERFORM.                                                 27280099
273000                                                                  27290099
273100     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          27300099
273200         MOVE +1               TO ASC-BLK-SUB                     27310099
273300         PERFORM 5100-WRITE-TEMP-STORAGE                          27320099
273400         ADD +1                TO ASC-BLK-SUB                     27330099
273500         PERFORM 5100-WRITE-TEMP-STORAGE                          27340099
273600                                                                  27350099
273700         MOVE 1                TO ASC-BLK-SUB                     27360099
273800                                  PV-BLOCK-NUMBER                 27370099
273900         PERFORM 4410-READ-TEMP-STORAGE                           27380099
274000         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             27390099
274100             MOVE 2            TO ASC-BLK-SUB                     27400099
274200                                  PV-BLOCK-NUMBER                 27410099
274300             PERFORM 4410-READ-TEMP-STORAGE                       27420099
274400         END-IF                                                   27430099
274500     END-IF.                                                      27440099
274600                                                                  27450099
274700*----------------------------------------------------------------*27460099
274800*    FETCH THE CURSOR FOR ALL STORES.                            *27470099
274900*----------------------------------------------------------------*27480099
275000 7310-FETCH.                                                      27490099
275100                                                                  27500099
275200     EXEC SQL                                                     27510099
275300          FETCH CEPLAU-CSR-ALL                                    27520099
275400           INTO :CEPLAU-CNSTK-REQ-PL-NBR                          27530099
275500              , :CEPLAU-PL-LNE-NBR                                27540099
275600              , :CEPLAU-STR-NBR                                   27550099
275700              , :CEPLAU-ADJ-TMST                                  27560099
275800              , :CEPLAU-BEF-ADJ-UNT-QTY                           27570099
275900              , :CEPLAU-AFT-ADJ-UNT-QTY                           27580099
276000              , :CEPLAU-ADJ-BY-USR-ID                             27590099
276100              , :CEPLAU-EXPRT-PRC-BTCH-ID                         27600099
276200              , :CEPLAU-ADJ-RSN-DESC                              27610099
276300     END-EXEC.                                                    27620099
276400                                                                  27630099
276500     EVALUATE TRUE                                                27640099
276600         WHEN SQLCODE = ZERO                                      27650099
276700             CONTINUE                                             27660099
276800                                                                  27670099
276900         WHEN SQLCODE = +100                                      27680099
277000             SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                  27690099
277100                                                                  27700099
277200         WHEN SQLWARN0 NOT = SPACE                                27710099
277300         WHEN SQLCODE NOT = ZERO                                  27720099
277400             MOVE '7310-FETCH-CURSOR'                             27730099
277500                                 TO DP013-PARAGRAPH               27740099
277600             MOVE 'FETCH CEPLAU CURSOR FOR ALL STORES'            27750099
277700                                 TO DP013-MESSAGE-TEXT (1)        27760099
277800             MOVE SQLCA          TO DP013-SQLCA                   27770099
277900             SET DP013-DB2-ABEND TO TRUE                          27780099
278000             PERFORM DP013-0000-PROCESS-ABEND                     27790099
278100     END-EVALUATE.                                                27800099
278200                                                                  27810099
278300*----------------------------------------------------------------*27820099
278400* READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *27830099
278500*----------------------------------------------------------------*27840099
278600 9100-READ-SEL-QUEUE.                                             27850099
278700                                                                  27860099
278800     EXEC CICS                                                    27870099
278900         READQ TS                                                 27880099
279000             QUEUE (ASC-SEL-QUEUE-NAME-IN)                        27890099
279100             INTO  (CE003-SELECT-RECORD)                          27900099
279200             ITEM  (ASC-SEL-ITEM)                                 27910099
279300             RESP  (PV-CICS-RESP)                                 27920099
279400     END-EXEC.                                                    27930099
279500     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        27940099
279600         CONTINUE                                                 27950099
279700     ELSE                                                         27960099
279800         SET DP013-LOGIC-ABEND                                    27970099
279900             DP013-NO-ROLLBACK   TO   TRUE                        27980099
280000         MOVE '9100-READ-SEL-QUEUE'                               27990099
280100                                 TO   DP013-PARAGRAPH             28000099
280200         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   28010099
280300                                 TO   DP013-MESSAGE-TEXT (1)      28020099
280400         PERFORM DP013-0000-PROCESS-ABEND                         28030099
280500     END-IF.                                                      28040099
280600                                                                  28050099
280700*----------------------------------------------------------------*28060099
280800* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *28070099
280900*----------------------------------------------------------------*28080099
281000 9200-REWRITE-SEL-QUEUE.                                          28090099
281100                                                                  28100099
281200     EXEC CICS                                                    28110099
281300          WRITEQ TS                                               28120099
281400              QUEUE  (ASC-SEL-QUEUE-NAME-IN)                      28130099
281500              FROM   (CE003-SELECT-RECORD)                        28140099
281600              ITEM   (ASC-SEL-ITEM)                               28150099
281700              RESP   (PV-CICS-RESP)                               28160099
281800              REWRITE                                             28170099
281900     END-EXEC.                                                    28180099
282000                                                                  28190099
282100     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   28200099
282200         SET DP013-CICS-ABEND                                     28210099
282300             DP013-NO-ROLLBACK     TO TRUE                        28220099
282400         MOVE '9200-REWRITE-SEL-QUEUE'                            28230099
282500                                   TO DP013-PARAGRAPH             28240099
282600         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   28250099
282700                                   TO DP013-MESSAGE-TEXT (1)      28260099
282800         PERFORM DP013-0000-PROCESS-ABEND                         28270099
282900     END-IF.                                                      28280099
283000                                                                  28290099
283100*----------------------------------------------------------------*28300099
283200*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *28310099
283300*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *28320099
283400*----------------------------------------------------------------*28330099
283500 9900-SOFT-ABORT.                                                 28340099
283600                                                                  28350099
283700     EXEC CICS SYNCPOINT                                          28360099
283800         ROLLBACK                                                 28370099
283900     END-EXEC.                                                    28380099
284000                                                                  28390099
284100     SET PS-ERROR                                                 28400099
284200         PS-SOFT-ABORT-ERROR                                      28410099
284300         DP020-MSG-FATAL     TO TRUE.                             28420099
284400                                                                  28430099
284500*----------------------------------------------------------------*28440099
284600*    ABEND PROCESSOR MODULE                                      *28450099
284700*----------------------------------------------------------------*28460099
284800     COPY DPPD013.                                                28470099
