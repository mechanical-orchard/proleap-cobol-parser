000100 IDENTIFICATION DIVISION.                                         00010000
000200                                                                  00020000
000300 PROGRAM-ID.      SVKUT101.                                       00030001
000400 AUTHOR.          JOE GARDETTO.                                   00040000
000500 INSTALLATION.    KOHLS DEPARTMENT STORES.                        00050000
000600 DATE-WRITTEN.    03/17/2014.                                     00060020
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900******************************************************************00090000
001000*     EXTRACT STORED VALUE TRANS FROM SVT_KOHLS_CRD_TXN           00100022
001100*=================================================================00110000
001200*                                                                 00120000
001300*   THE PROGRAM WILL EXTRACT ROWS FROM THE STORED VALUE           00130001
001300*   TRANSACTION TABLE THE SALES DATE IS BETWEEN THE DATES         00131022
001300*   INDICATED ON THE INPUT CONTROL CARD AND THE ACTIVITY          00131122
001300*   STATUS IS READY (1) OR PREPARED/AUDIT (2) AND ACTIVITY        00131222
001300*   TYPE IS TENDER (3) AND ACTIVTY TYPE IS 3 BETWEEN THE          00131322
      *   SALES DATES INDICATED IN THE INPUT CONTROL CARD.              00132022
      *   THESE TRANSACTIONS WILL THEN BE FED INTO AN UPDATE PROGRAM    00133022
001400*   TO CHANGE THE ACTIVITY STATUS TO 3.                           00140022
001600*                                                                 00162501
001700*========================== CHANGE LOG ===========================00163001
001800*  AUTH         BY          DATE              DESCRIPTION         00170000
001900*=================================================================00180000
002000* CHG0077708 JOE GARDETTO 03-17-14   WR42471 - NEW PROGRAM.       00190020
002200******************************************************************00210000
002300                                                                  00220000
002400 ENVIRONMENT DIVISION.                                            00230000
002500 CONFIGURATION SECTION.                                           00240000
002600                                                                  00250000
002700 SOURCE-COMPUTER.        IBM-3090.                                00260000
002800 OBJECT-COMPUTER.        IBM-3090.                                00270000
002900                                                                  00280000
003000 INPUT-OUTPUT SECTION.                                            00290000
003100 FILE-CONTROL.                                                    00300000
                                                                        00300110
           SELECT DATE-CARD-FILE                                        00301013
               ASSIGN TO INP01.                                         00302010
003200                                                                  00310000
003400     SELECT SV-CRD-EXTR-FILE ASSIGN TO OUT01.                     00321005
003500                                                                  00330000
003600 DATA DIVISION.                                                   00340000
003700 FILE SECTION.                                                    00350000
                                                                        00350110
       FD  DATE-CARD-FILE                                               00351010
           RECORDING MODE IS F                                          00352010
           BLOCK CONTAINS 0 RECORDS                                     00353010
           LABEL RECORDS ARE STANDARD.                                  00354010
                                                                        00355010
       01  DATE-CARD-RECORD                 PIC X(80).                  00356010
                                                                        00360010
004600 FD  SV-CRD-EXTR-FILE                                             00370005
004700     RECORDING MODE IS F                                          00380000
004800     BLOCK CONTAINS 0 RECORDS                                     00390000
004900     LABEL RECORDS ARE STANDARD.                                  00400000
005000                                                                  00410000
005100 01  SV-CRD-EXTR-REC                  PIC  X(38).                 00421005
005200                                                                  00430000
005300******************************************************************00440000
005400*                       WORKING STORAGE                           00450000
005500******************************************************************00460000
005600 WORKING-STORAGE SECTION.                                         00470000
005700                                                                  00480000
005800 01  W-START                          PIC  X(40)                  00490000
005900     VALUE 'SVKUT101 - WORKING STORAGE BEGINS HERE'.              00500001
006000                                                                  00510000
      ******************************************************************00511010
      * RECORD LAYOUT FOR INPUT DATE CARD                               00512010
      ******************************************************************00513010
       01  CC-CONTROL-CARD.                                             00514010
           05  CC-CONTROL-CARD-DISPLAY.                                 00515010
               10  CC-CONTROL-NAME     PIC X(14)    VALUE               00516010
                                                    'P.O.S. DATE = '.   00517010
               10  CC-FROM-DATE-MMDDYY.                                 00518014
                   15  CC-FROM-DATE-MM PIC 9(2)     VALUE ZERO.         00519014
                   15  CC-FROM-DATE-DD PIC 9(2)     VALUE ZERO.         00519114
                   15  CC-FROM-DATE-YY PIC 9(2)     VALUE ZERO.         00519214
               10  FILLER              PIC X(01)    VALUE SPACE.        00519314
               10  CC-TO-DATE-MMDDYY.                                   00519414
                   15  CC-TO-DATE-MM   PIC 9(2)     VALUE ZERO.         00519514
                   15  CC-TO-DATE-DD   PIC 9(2)     VALUE ZERO.         00519614
                   15  CC-TO-DATE-YY   PIC 9(2)     VALUE ZERO.         00519714
           05  FILLER                  PIC X(53)    VALUE SPACE.        00519814
                                                                        00519914
       01  PV-FROM-CCYY-MM-DD          PIC X(10).                       00520014
       01  PV-TO-CCYY-MM-DD            PIC X(10).                       00520114
                                                                        00520914
006100***************************************************************** 00521000
006200*                         SWITCHES                                00530000
006300***************************************************************** 00540000
006400 01  PS-PROGRAM-SWITCHES.                                         00550000
006500     05  PS-END-OF-CARD-FILE-SW       PIC  X(01) VALUE 'N'.       00560000
006600         88  PS-END-OF-CARD-FILE                 VALUE 'Y'.       00570000
006700     05  PS-END-OF-SV-CRD-CSR-SW      PIC  X(01) VALUE 'N'.       00601002
006800         88  PS-END-OF-SV-CRD-CSR                VALUE 'Y'.       00602002
               88  PS-NOT-END-OF-SV-CRD-CSR            VALUE 'N'.       00603002
006900                                                                  00610000
007000***************************************************************** 00620000
007100*                       ACCUMULATORS                              00630000
007200***************************************************************** 00640000
007300 01  PV-PROGRAM-COUNTERS.                                         00650000
007800     05  PV-SVCT-READ                 PIC  9(11) VALUE ZEROS.     00711022
007900     05  PV-SVCT-WRITTEN              PIC  9(11) VALUE ZEROS.     00712022
           05  PV-SVCT-TOT-DLRS             PIC  S9(7)V9(2) COMP-3      00713027
                                                       VALUE ZEROS.     00720027
008100******************************************************************00730000
008200*                        CONSTANTS                                00740000
008300******************************************************************00750000
008400 01  PC-PROGRAM-CONSTANTS.                                        00760000
008500     05  PC-PROGRAM-NAME              PIC  X(08) VALUE 'SVKUT101'.00770001
008900     05  PC-ROW-FOUND                 PIC S9(04) VALUE +0         00810000
009000                                                 COMP SYNC.       00820000
009100     05  PC-ROW-NOT-FOUND             PIC S9(04) VALUE +100       00830000
009200                                                 COMP SYNC.       00840000
009300                                                                  00850000
009400******************************************************************00860000
009500*                      PROGRAM VARIABLES                          00870000
009600******************************************************************00880000
009700 01  PV-ABEND-FIELDS.                                             00890000
009900     05  PV-PARAGRAPH-NAME            PIC  X(30) VALUE SPACE.     00900000
010000     05  PV-OPERATION-MSG-1           PIC  X(40) VALUE SPACE.     00910000
010100     05  PV-OPERATION-MSG-2           PIC  X(40) VALUE SPACE.     00920000
010200     05  PV-DB2-OPERATION             PIC  X(30) VALUE SPACE.     00930000
           05  PV-CRD-NBR                   PIC  S9(12)V COMP-3.        00942004
           05  PV-TRN-AUTH-TMST             PIC  X(26).                 00943004
000600     05  PV-ACTVY-STAT-CDE            PIC  S9(1)V COMP-3.         00944024
           05  PV-APP-AUTH-AMT              PIC  S9(7)V9(2) COMP-3.     00945028
           05  PV-SVCT-TOT-DLRS-EDITED      PIC   -,---,--9.99          00946029
                                                       VALUE ZEROS.     00947027
014600                                                                  00951027
014700******************************************************************00960000
014800*               SYSTEM TIME AND DATE VARIABLES                    00970000
014900******************************************************************00980000
015000 01  SYS-DATE-TIME.                                               00990000
015100     05  SYS-DATE                     PIC  X(08) VALUE SPACES.    01000000
015200     05  SYS-TIME                     PIC  X(08) VALUE SPACES.    01010000
015300                                                                  01020000
015400 01  ST-BEG-TIME.                                                 01030000
015500     05  ST-BEG-HR                    PIC  9(02) VALUE ZEROS.     01040000
015600     05  FILLER                       PIC  X(01) VALUE ':'.       01050000
015700     05  ST-BEG-MN                    PIC  9(02) VALUE ZEROS.     01060000
015800                                                                  01070000
015900 01  ST-END-TIME.                                                 01080000
016000     05  ST-END-HR                    PIC  9(02) VALUE ZEROS.     01090000
016100     05  FILLER                       PIC  X(01) VALUE ':'.       01100000
016200     05  ST-END-MN                    PIC  9(02) VALUE ZEROS.     01110000
016300                                                                  01120000
016400 01  SD-EDIT-DATE.                                                01130000
016500     05  SD-MONTH                     PIC  9(02) VALUE ZEROS.     01140000
016600     05  FILLER                       PIC  X(01) VALUE '-'.       01150000
016700     05  SD-DAY                       PIC  9(02) VALUE ZEROS.     01160000
016800     05  FILLER                       PIC  X(01) VALUE '-'.       01170000
016900     05  SD-CENT                      PIC  9(02) VALUE ZEROS.     01180000
017000     05  SD-YEAR                      PIC  9(02) VALUE ZEROS.     01190000
017100                                                                  01200000
017200******************************************************************01210000
017300*                        ERROR HANDLING                           01220000
017400******************************************************************01230000
017500 01  ABEND-CODE                       PIC S9(04) VALUE ZERO       01240000
017600                                                 COMP SYNC.       01250000
017700     88  AC-CONTROL-CARD-ERROR             VALUE +4003.           01260000
017800     88  AC-DB2-ERROR                      VALUE +4013.           01270000
017900     88  AC-CALENDAR-ROUTINE-ERROR         VALUE +4019.           01280000
018000                                                                  01290000
018100******************************************************************01300000
018200**COPYBOOKS                                                       01310000
018300******************************************************************01320000
018400***SV CARD EXTRACT OUTPUT RECORD                                  01330005
018500     COPY SVRD074.                                                01340004
018600                                                                  01350000
018700***VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01360000
018800     COPY DPWS004.                                                01370000
018900                                                                  01380000
035100******************************************************************01401012
035200*  PARAMETER LIST FOR THE CALENDAR ROUTINE (DPKUT500)             01402012
035300******************************************************************01403012
035400     COPY DPWS500.                                                01404012
                                                                        01404112
019300***DB2 ABEND COPYBOOK                                             01405012
019400     COPY DPWS900.                                                01406012
019500                                                                  01410000
019600***DB2 MESSAGE AREA                                               01420000
019700     COPY SQLCA2.                                                 01430000
019800                                                                  01440000
019900***DB2 COMMUNICATIONS AREA                                        01450000
020000     EXEC SQL                                                     01460000
020100          INCLUDE SQLCA                                           01470000
020200     END-EXEC.                                                    01480000
020300                                                                  01490000
043500******************************************************************01570002
043600*    RD-KOHL'S STORED VALUE CARD ACTIVITY TABLE                  *01571002
043700******************************************************************01572002
043800     EXEC SQL                                                     01573002
043900         INCLUDE SVT00002                                         01574002
044000     END-EXEC.                                                    01575002
044100                                                                  01576002
021300******************************************************************01590000
021400* SV CARD UPDATE                                                  01600004
021500******************************************************************01610000
           EXEC SQL                                                     01620002
             DECLARE SV-CRD-CURSOR CURSOR FOR                           01751102
              SELECT SVC.CRD_NBR                                        01751602
                    ,SVC.TRN_AUTH_TMST                                  01751702
                    ,SVC.ACTVY_STAT_CDE                                 01751824
                    ,SVC.APP_AUTH_AMT                                   01751927
              FROM SVT_KOHLS_CRD_TXN SVC                                01752102
               WHERE STR_NBR = 873                                      01752926
                 AND POS_DTE BETWEEN :PV-FROM-CCYY-MM-DD                01753119
                                 AND :PV-TO-CCYY-MM-DD                  01753219
                 AND ACTVY_TYP_CDE = 3                                  01753615
                 AND ACTVY_STAT_CDE IN (1,2)                            01753818
                 AND TRN_VOID_IND = 'N'                                 01754017
              WITH UR                                                   01755015
023300     END-EXEC.                                                    01761002
023500                                                                  01780000
023600 PROCEDURE DIVISION.                                              01790000
023700******************************************************************01800000
023800* MAINLINE-PROCESSING                                             01810000
023900******************************************************************01820000
024000                                                                  01830000
024100     PERFORM 1000-INITIALIZE.                                     01840000
024300     PERFORM 2000-RETRIEVE-ROWS                                   01860000
024400       UNTIL PS-END-OF-SV-CRD-CSR.                                01870002
024500                                                                  01880000
024600     PERFORM 5200-CLOSE-SV-CRD-CURSOR.                            01890003
024700                                                                  01900000
024800     PERFORM 9999-CONTROLS.                                       01910000
024900                                                                  01920000
025000     GOBACK.                                                      01930000
025100                                                                  01940000
025200                                                                  01950000
025300******************************************************************01960000
025400* PREFORMS TASK INITIATION                                        01970000
025500******************************************************************01980000
025600 1000-INITIALIZE.                                                 01990000
025700                                                                  02000000
025900     OPEN INPUT  DATE-CARD-FILE                                   02010011
025900          OUTPUT SV-CRD-EXTR-FILE.                                02011010
026000                                                                  02020000
026100     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 02030000
026200                                                                  02040000
026300     MOVE SYS-TIME (1:2) TO ST-BEG-HR.                            02050000
026400     MOVE SYS-TIME (3:2) TO ST-BEG-MN.                            02060000
026500                                                                  02070000
026600     MOVE SYS-DATE (1:2) TO SD-CENT.                              02080000
026700     MOVE SYS-DATE (3:2) TO SD-YEAR.                              02090000
026800     MOVE SYS-DATE (5:2) TO SD-MONTH.                             02100000
026900     MOVE SYS-DATE (7:2) TO SD-DAY.                               02110000
                                                                        02120010
           READ DATE-CARD-FILE INTO CC-CONTROL-CARD                     02121013
              AT END                                                    02122010
                 SET PS-END-OF-CARD-FILE TO TRUE.                       02123010
                                                                        02124010
           DISPLAY 'SVKUT101 CONTROL CARD: ' CC-CONTROL-CARD.           02125010
                                                                        02126010
           IF PS-END-OF-CARD-FILE                                       02129010
              DISPLAY '** ABEND ** ' PC-PROGRAM-NAME                    02129110
              DISPLAY 'DATE CONTROL CARD EMPTY'                         02129210
              SET AC-CONTROL-CARD-ERROR TO TRUE                         02129310
              CALL 'ILBOABN0' USING ABEND-CODE                          02129413
           END-IF.                                                      02129510
                                                                        02129610
           PERFORM 1115-CONVERT-INPUT-DATE.                             02129710
                                                                        02132610
           IF PS-NOT-END-OF-SV-CRD-CSR                                  02133010
027500         PERFORM 5000-OPEN-SV-CRD-CURSOR                          02140003
027600         PERFORM 5100-FETCH-SV-CRD-CURSOR                         02151003
           END-IF.                                                      02160000
                                                                        02170010
      ******************************************************************02171010
      *     CALL KOHLS CALENDAR ROUTINE:                                02172010
      *         PASS: CONTROL CARD POS DATE (MMDDYY FORMAT).            02173010
      *       RETURN: ACTUAL CALENDAR DB2 ISO DATE (CCYY-MM-DD FORMAT). 02174010
      ******************************************************************02175010
       1115-CONVERT-INPUT-DATE.                                         02176010
                                                                        02177010
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02178010
                                                                        02179010
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   02179110
           SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   02179210
           SET  DPG52-LK-DTE-GREG            TO TRUE.                   02179310
           MOVE CC-FROM-DATE-MMDDYY          TO DPG52-LK-DATE-INPUT.    02179414
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    02179510
                                                   DPG54 DPG55 DPG56.   02179610
           EVALUATE TRUE                                                02179710
               WHEN DPG54-SEVERE-ERROR                                  02179810
                  DISPLAY '** ABEND ** ' PC-PROGRAM-NAME                02179910
                  DISPLAY 'DATE CONTROL CARD INVALID'                   02180010
                  SET AC-CONTROL-CARD-ERROR TO TRUE                     02180110
                  CALL 'ILBOABN0' USING ABEND-CODE                      02180213
           END-EVALUATE.                                                02180310
                                                                        02180410
           MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-FROM-CCYY-MM-DD.     02180814
                                                                        02181014
           INITIALIZE DPG51 DPG52 DPG53 DPG54 DPG55 DPG56.              02181114
                                                                        02181214
           SET  DPG51-ACTUAL-CALENDAR-ONLY   TO TRUE.                   02182014
           SET  DPG51-DO-NOT-INCR-DECR-DATE  TO TRUE.                   02182114
           SET  DPG52-LK-DTE-GREG            TO TRUE.                   02182214
           MOVE CC-TO-DATE-MMDDYY            TO DPG52-LK-DATE-INPUT.    02182314
           CALL DP500-KOHLS-CALENDAR-ROUTINE USING DPG51 DPG52 DPG53    02182414
                                                   DPG54 DPG55 DPG56.   02182514
           EVALUATE TRUE                                                02182614
               WHEN DPG54-SEVERE-ERROR                                  02182714
                  DISPLAY '** ABEND ** ' PC-PROGRAM-NAME                02182814
                  DISPLAY 'DATE CONTROL CARD INVALID'                   02182914
                  SET AC-CONTROL-CARD-ERROR TO TRUE                     02183014
                  CALL 'ILBOABN0' USING ABEND-CODE                      02183114
           END-EVALUATE.                                                02183214
                                                                        02183314
           MOVE DPG55-DB2-ISO-DATE-FMT       TO PV-TO-CCYY-MM-DD.       02183614
                                                                        02183714
           DISPLAY 'DATE RANGE: ' PV-FROM-CCYY-MM-DD                    02183814
                   ' TO '         PV-TO-CCYY-MM-DD.                     02183914
                                                                        02184014
                                                                        02185014
039900***************************************************************** 02190000
040000* RETREIVE ROWS FROM SVT_KOHLS_CRD_TXN TABLE                      02200025
040100***************************************************************** 02210000
040200 2000-RETRIEVE-ROWS.                                              02220000
040300                                                                  02230000
040400     INITIALIZE SVRD074-SVCRD-REC.                                02240005
040500                                                                  02250000
041000     MOVE PV-CRD-NBR           TO SVRD074-CRD-NBR.                02260005
041000     MOVE PV-TRN-AUTH-TMST     TO SVRD074-TRN-AUTH-TMST.          02270005
041000     MOVE PV-ACTVY-STAT-CDE    TO SVRD074-ACTVY-STAT-CDE.         02290024
044700     ADD  PV-APP-AUTH-AMT      TO PV-SVCT-TOT-DLRS.               02292027
                                                                        02293027
041100     PERFORM 8000-WRITE-SV-CRD-EXTR-REC.                          02300005
041200                                                                  02310000
041300     PERFORM 5100-FETCH-SV-CRD-CURSOR.                            02320003
041400                                                                  02330000
041500                                                                  02340000
041600******************************************************************02350000
041700* OPEN SV-CRD-CURSOR CURSOR                                       02360003
041800******************************************************************02370000
041900 5000-OPEN-SV-CRD-CURSOR.                                         02381003
042000                                                                  02390000
042100     EXEC SQL                                                     02400000
042200          OPEN SV-CRD-CURSOR                                      02410003
042300     END-EXEC.                                                    02420000
042400                                                                  02430000
042500     EVALUATE TRUE                                                02440000
042600         WHEN SQLCODE = PC-ROW-FOUND                              02450000
042700              CONTINUE                                            02460000
042800                                                                  02470000
042900         WHEN SQLWARN0 NOT EQUAL SPACE                            02480000
043000         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      02490000
043100             MOVE '5000-OPEN-SV-CRD-CURSOR'                       02500003
043200                                            TO PV-PARAGRAPH-NAME  02510000
043300             MOVE 'ERROR ON OPEN OF SV-CRD-CURSOR'                02520003
043400                                            TO PV-DB2-OPERATION   02530000
043500             PERFORM 9100-SQL-ABEND                               02540000
043600     END-EVALUATE.                                                02550000
043700                                                                  02560000
043800                                                                  02570000
043900******************************************************************02580000
044000* FETCH SV-CRD-CURSOR RECORD.                                     02590003
044100******************************************************************02600000
044200 5100-FETCH-SV-CRD-CURSOR.                                        02610003
044300                                                                  02620000
044400     EXEC SQL                                                     02630000
044500         FETCH SV-CRD-CURSOR                                      02640003
044600             INTO :PV-CRD-NBR                                     02650004
044700                 ,:PV-TRN-AUTH-TMST                               02660004
044700                 ,:PV-ACTVY-STAT-CDE                              02670024
044700                 ,:PV-APP-AUTH-AMT                                02671027
045000     END-EXEC.                                                    02680000
045100                                                                  02690000
045200     EVALUATE TRUE                                                02700000
045300         WHEN SQLCODE = PC-ROW-FOUND                              02710000
                   SET PS-NOT-END-OF-SV-CRD-CSR TO TRUE                 02721003
045500             ADD 1    TO PV-SVCT-READ                             02730022
045600                                                                  02740000
045700         WHEN SQLCODE = PC-ROW-NOT-FOUND                          02750000
                   SET PS-END-OF-SV-CRD-CSR TO TRUE                     02761003
045900                                                                  02770000
046000         WHEN SQLWARN0 NOT EQUAL SPACE                            02780000
046100         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      02790000
046200             MOVE '5100-FETCH-SV-CRD-CURSOR'                      02800003
046300                                            TO PV-PARAGRAPH-NAME  02810000
046400             MOVE 'ERROR ON FETCH OF SV-CRD-CURSOR'               02820003
046500                                            TO PV-DB2-OPERATION   02830000
046600             PERFORM 9100-SQL-ABEND                               02840000
046700     END-EVALUATE.                                                02850000
046800                                                                  02860000
046900                                                                  02870000
047000******************************************************************02880000
047100* CLOSE SV-CRD-CURSOR CURSOR                                      02890003
047200******************************************************************02900000
047300 5200-CLOSE-SV-CRD-CURSOR.                                        02911003
047400                                                                  02920000
047500     EXEC SQL                                                     02930000
047600          CLOSE SV-CRD-CURSOR                                     02940003
047700     END-EXEC.                                                    02950000
047800                                                                  02960000
047900     EVALUATE TRUE                                                02970000
048000         WHEN SQLCODE = PC-ROW-FOUND                              02980000
048100              CONTINUE                                            02990000
048200                                                                  03000000
048300         WHEN SQLWARN0 NOT EQUAL SPACE                            03010000
048400         WHEN SQLCODE NOT EQUAL PC-ROW-FOUND                      03020000
048500             MOVE '5200-CLOSE-SV-CRD-CURSOR'                      03030003
048600                                            TO PV-PARAGRAPH-NAME  03040000
048700             MOVE 'ERROR ON CLOSE OF SV-CRD-CURSOR'               03050003
048800                                            TO PV-DB2-OPERATION   03060000
048900             PERFORM 9100-SQL-ABEND                               03070000
049000     END-EVALUATE.                                                03080000
049100                                                                  03090000
049200                                                                  03100000
049300****************************************************************  03110000
049400* WRITE OUTPUT RECORD                                             03120000
049500****************************************************************  03130000
049600 8000-WRITE-SV-CRD-EXTR-REC.                                      03140005
049700                                                                  03150000
049800     WRITE SV-CRD-EXTR-REC FROM SVRD074-SVCRD-REC.                03160005
049900                                                                  03170000
050000     ADD +1 TO PV-SVCT-WRITTEN.                                   03180022
050100                                                                  03190000
050200                                                                  03200000
050300******************************************************************03210000
050400* ABEND PROGRAM WHEN AN SQL ERROR CODE OR WARNING CODE OCCURS.    03220000
050500******************************************************************03230000
050600 9100-SQL-ABEND.                                                  03240000
050700                                                                  03250000
050800     PERFORM 9900-END-OF-JOB-ROUTINE.                             03260000
050900                                                                  03270000
051000     DISPLAY '** ABEND     **'.                                   03280000
051100     DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                03290000
051200     DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              03300000
051300     DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               03310000
051400                                                                  03320000
051500******************************************************************03330000
051600* COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     03340000
051700* TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      03350000
051800******************************************************************03360000
051900     COPY DPPD004.                                                03370000
052000                                                                  03380000
052100     SET AC-DB2-ERROR TO TRUE.                                    03390000
052200                                                                  03400000
052300     CALL 'ILBOABN0' USING ABEND-CODE.                            03410000
052400                                                                  03420000
052500                                                                  03430000
052600******************************************************************03440000
052700* ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                      03450000
052800******************************************************************03460000
052900 9200-ABEND.                                                      03470000
053000                                                                  03480000
053100     PERFORM 9900-END-OF-JOB-ROUTINE.                             03490000
053200                                                                  03500000
053300     DISPLAY '** ABEND           **'.                             03510000
053400     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          03520000
053500     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        03530000
053600     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       03540000
053700     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       03550000
053800                                                                  03560000
053900     CALL 'ILBOABN0' USING ABEND-CODE.                            03570000
054000                                                                  03580000
054100                                                                  03590000
054200******************************************************************03600000
054300* PREFORMS TASK TERMINATION PROCESSING                            03610000
054400******************************************************************03620000
054500 9900-END-OF-JOB-ROUTINE.                                         03630000
054600                                                                  03640000
054700     CLOSE DATE-CARD-FILE                                         03650010
054700           SV-CRD-EXTR-FILE.                                      03651010
054900                                                                  03660000
055000     PERFORM 9999-CONTROLS.                                       03670000
055100                                                                  03680000
055200                                                                  03690000
055300******************************************************************03700000
055400* DISPLAY CONTROLS FROM THE PROGRAM                               03710000
055500******************************************************************03720000
055600 9999-CONTROLS.                                                   03730000
055700                                                                  03740000
055800     MOVE FUNCTION CURRENT-DATE TO SYS-DATE-TIME.                 03750000
           MOVE PV-SVCT-TOT-DLRS  TO PV-SVCT-TOT-DLRS-EDITED            03751027
055900                                                                  03760000
056000     MOVE SYS-TIME (1:2) TO ST-END-HR.                            03770000
056100     MOVE SYS-TIME (3:2) TO ST-END-MN.                            03780000
056200                                                                  03790000
056300     DISPLAY '                    '.                              03800000
056400     DISPLAY '**********************'.                            03810000
056500     DISPLAY '   SVKUT101 CONTROLS  '.                            03820001
056600     DISPLAY '**********************'.                            03830000
056700     DISPLAY 'RUN DATE  = ' SD-EDIT-DATE.                         03840000
056800     DISPLAY 'BEG TIME  = ' ST-BEG-TIME.                          03850000
056900     DISPLAY 'END TIME  = ' ST-END-TIME.                          03860000
057000     DISPLAY '======================'.                            03870000
057100     DISPLAY 'SVCT READ     = ' PV-SVCT-READ.                     03880022
057100     DISPLAY 'SVCT WRITTEN  = ' PV-SVCT-WRITTEN.                  03880122
057100     DISPLAY 'SVCT DOLLARS  = ' PV-SVCT-TOT-DLRS-EDITED.          03880227
057200     DISPLAY '                '.                                  03890000
057300                                                                  03900000
057400                                                                  03910000
