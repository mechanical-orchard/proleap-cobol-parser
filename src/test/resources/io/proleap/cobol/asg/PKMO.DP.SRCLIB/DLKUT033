000100***************************************************************** 00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300***************************************************************** 00030000
000400                                                                  00040000
000500 PROGRAM-ID.             DLKUT033.                                00050000
000600 AUTHOR.                 GERMAN BANDA.                            00060000
000700 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00070000
000800 DATE-WRITTEN            NOVEMBER, 2009.                          00080000
000900 DATE-COMPILED.                                                   00090000
001000***************************************************************** 00100000
001100***************************************************************** 00110000
001200*                                                               * 00120000
001300*  THIS PROGRAM WILL TAKE IN THE EXTRACT FILE OF LABOR          * 00130000
001400*  ASSIGNMENTS (DLT_ASGMT) AND BUMP IT AGAINST                    00140000
001720*  SHIPPING ASSIGNMENTS TO DETERMINE IF                         * 00172000
001730*  THE CORRESPONDING SHIPPING EVENTS FOUND IN THE               * 00173000
001740*  PCT_BUS_EVNT_EXPRT TABLE CAN BE UPDATED TO A 'C' STATUS      * 00174000
001750*  SO THAT EVENTS CAN BE EXTRACTED AND SENT TO DLX. *             00175000
001800***************************************************************** 00180000
002200***************************************************************** 00220000
002300 ENVIRONMENT DIVISION.                                            00230000
002400***************************************************************** 00240000
002500                                                                  00250000
002600 CONFIGURATION SECTION.                                           00260000
002700                                                                  00270000
002800 SOURCE-COMPUTER.        IBM-3090.                                00280000
002900 OBJECT-COMPUTER.        IBM-3090.                                00290000
003000                                                                  00300000
003100 INPUT-OUTPUT SECTION.                                            00310000
003200                                                                  00320000
003300 FILE-CONTROL.                                                    00330000
003400*                                                                 00340000
003500     SELECT SHIP-ASSIGN-EXTRACT-FILE                              00350001
003600         ASSIGN TO INP01.                                         00360000
003700                                                                  00370000
003710     SELECT EAI-ASSIGN-EXTRACT-FILE                               00371001
003720         ASSIGN TO INP02.                                         00372001
003730                                                                  00373001
003800     SELECT EXTRACT-FILE-OUT                                      00380000
003900         ASSIGN TO OUT01.                                         00390000
004000*                                                                 00400000
004100***************************************************************** 00410000
004200 DATA DIVISION.                                                   00420000
004300***************************************************************** 00430000
004400*                                                                 00440000
004500 FILE SECTION.                                                    00450000
004600*                                                                 00460000
004700 FD  SHIP-ASSIGN-EXTRACT-FILE                                     00470000
004800     LABEL RECORDS ARE STANDARD                                   00480000
004900     RECORDING MODE IS F                                          00490000
005000     BLOCK CONTAINS 0 RECORDS                                     00500000
005100     RECORD CONTAINS 29 CHARACTERS.                               00510007
005200 01  SHIP-ASSIGN-EXTRACT-REC         PIC X(29).                   00520000
005300                                                                  00530000
005400 FD  EAI-ASSIGN-EXTRACT-FILE                                      00540000
005500     LABEL RECORDS ARE STANDARD                                   00550000
005600     RECORDING MODE IS F                                          00560000
005700     BLOCK CONTAINS 0 RECORDS                                     00570000
005800     RECORD CONTAINS 80 CHARACTERS.                               00580007
005900 01  EAI-ASSIGN-EXTRACT-REC          PIC X(80).                   00590000
006000                                                                  00600000
006010 FD  EXTRACT-FILE-OUT                                             00601000
006020     LABEL RECORDS ARE STANDARD                                   00602000
006030     RECORDING MODE IS F                                          00603000
006040     BLOCK CONTAINS 0 RECORDS                                     00604000
006050     RECORD CONTAINS 80 CHARACTERS.                               00605007
006060 01  EXTRACT-RECORD-OUT              PIC X(80).                   00606000
006070                                                                  00607000
006100*                                                                 00610000
006200                                                                  00620000
006300 WORKING-STORAGE SECTION.                                         00630000
006400**************************************************************    00640000
006500* FORMAT OF THE CONTROL CARD INFORMATION PASSED INTO THE PGM *    00650000
006600**************************************************************    00660000
006700                                                                  00670000
006800 01  PROGRAM-SWITCHES.                                            00680000
006900     05  PS-EOF-INPUT-SW             PIC  X(03)    VALUE 'BOF'.   00690000
007000         88  PS-EOF-INPUT                          VALUE 'EOF'.   00700000
007010     05  PS-EOF-INPUT-2-SW           PIC  X(03)    VALUE 'BOF'.   00701000
007020         88  PS-EOF-INPUT-2                        VALUE 'EOF'.   00702000
007100     05  PS-EMPTY-FILE-SW            PIC  X(01)    VALUE 'N'.     00710000
007200         88  PS-EMPTY-FILE                         VALUE 'Y'.     00720000
007210     05  PS-EMPTY-FILE-2-SW          PIC  X(01)    VALUE 'N'.     00721000
007220         88  PS-EMPTY-FILE-2                       VALUE 'Y'.     00722000
007300     05  PS-END-OF-CURSOR-SW         PIC  X(01)    VALUE 'N'.     00730000
007400         88  PS-END-OF-CURSOR                      VALUE 'Y'.     00740000
007500         88  PS-NOT-END-OF-CURSOR                  VALUE 'N'.     00750000
008200     05  PS-END-OF-EXTRACT-SW        PIC  X(01)    VALUE 'N'.     00820000
008300         88  PS-END-OF-EXTRACT                     VALUE 'Y'.     00830000
008400     05  PS-COUNT-ADDTL-SW           PIC  X(01)    VALUE 'N'.     00840023
008500         88  PS-COUNT-ADDTL-YES                    VALUE 'Y'.     00850023
008600         88  PS-COUNT-ADDTL-NO                     VALUE 'N'.     00860023
009900*                                                                 00990000
010000 01  PC-CONSTANTS.                                                01000000
010100     05  PC-1                        PIC S9(03)    VALUE +1       01010000
010200                                                   COMP-3.        01020000
010300     05  PC-2                        PIC S9(03)    VALUE +2       01030000
010400                                                   COMP-3.        01040000
010500     05  PC-3                        PIC S9(03)    VALUE +3       01050000
010600                                                   COMP-3.        01060000
011900     05  PC-DLKUT033                 PIC  X(08)    VALUE          01190000
012000         'DLKUT033'.                                              01200000
012790*                                                                 01279000
012800 01  PV-DL011-SHIP-ASGMT-EXTRACT.                                 01280000
012900     05  PV-DL011-ASGMT-STRT-DTE         PIC X(10).               01290000
013000     05  PV-DL011-ASGMT-NBR-TXT          PIC X(10).               01300000
013100     05  PV-DL011-ASGMT-NBR-SEQ-NBR      PIC 9(09).               01310000
013600*                                                                 01360000
013700 01  PV-DL015-EAI-KEY-REC-LAYOUT.                                 01370000
013800     05  PV-DL015-EVNT-EXPRT-ID        PIC S9(09)  COMP.          01380000
013900     05  PV-L015-APP-ID-EXPORT-CDE     PIC  X(02).                01390000
014000         88  PV-DL015-PC-APP-ID           VALUE  'PC'.            01400000
014100         88  PV-DL015-SU-APP-ID           VALUE  'SU'.            01410000
014200         88  PV-DL015-VALID-APP-ID        VALUES 'PC', 'SU'.      01420000
014300     05  PV-DL015-EXTRACT-TIMESTAMP    PIC  X(26).                01430000
014400     05  PV-DL015-EXTRACT-DTL-TXT.                                01440000
014410         10  PV-DL015-ASGMT-STRT-DTE         PIC X(10).           01441000
014420         10  PV-DL015-ASGMT-NBR-TXT          PIC X(10).           01442000
014430         10  PV-DL015-ASGMT-NBR-SEQ-NBR      PIC 9(09).           01443000
014500*                                                                 01450000
015000 01  PV-MISC-FIELDS.                                              01500000
015010     05  PV-DL011-IN-COUNT           PIC S9(09)    COMP.          01501004
015020     05  PV-DL015-IN-COUNT          PIC S9(09)    COMP.           01502004
015030     05  PV-DL015-OUT-COUNT          PIC S9(09)    COMP.          01503004
015040     05  PV-NO-MATCH-COUNT           PIC S9(09)    COMP.          01504004
015050     05  PV-REC-AFTER-END-SHP        PIC S9(09)    COMP.          01505026
015060     05  PV-REC-AFTER-END-ASG        PIC S9(09)    COMP.          01506026
015100     05  PV-HOLD-INPUT-RECORD         PIC X(200)    VALUE SPACES. 01510000
017400     05  PV-ABEND-CODE               PIC S9(04)    VALUE ZERO     01740000
017500                                                   COMP SYNC.     01750000
017600     05  PV-ABEND-PARAGRAPH          PIC  X(30)    VALUE SPACES.  01760000
018900     05  PV-TODAYS-DATE.                                          01890000
019000         10  PV-TODAYS-DATE-YY       PIC  9(02)    VALUE ZERO.    01900000
019100         10  PV-TODAYS-DATE-MM       PIC  9(02)    VALUE ZERO.    01910000
019200         10  PV-TODAYS-DATE-DD       PIC  9(02)    VALUE ZERO.    01920000
019300     05  PV-TODAYS-TIME.                                          01930000
019400         10  PV-TODAYS-TIME-HH       PIC  9(02)    VALUE ZERO.    01940000
019500         10  PV-TODAYS-TIME-MM       PIC  9(02)    VALUE ZERO.    01950000
019600         10  PV-TODAYS-TIME-SS       PIC  9(02)    VALUE ZERO.    01960000
019700         10  FILLER                  PIC  9(02)    VALUE ZERO.    01970000
019800     05  PV-DB2-DATE.                                             01980000
019900         10  PV-DB2-DATE-CC          PIC  X(02)    VALUE ZERO.    01990000
020000         10  PV-DB2-DATE-YY          PIC  X(02)    VALUE ZERO.    02000000
020100         10  FILLER                  PIC  X(01)    VALUE ZERO.    02010000
020200         10  PV-DB2-DATE-MM          PIC  X(02)    VALUE ZERO.    02020000
020300         10  FILLER                  PIC  X(01)    VALUE ZERO.    02030000
020400         10  PV-DB2-DATE-DD          PIC  X(02)    VALUE ZERO.    02040000
022400*                                                                 02240000
022500     COPY DLRD011.                                                02250000
022510*                                                                 02251000
022520     COPY DLRD015.                                                02252000
022600 EJECT                                                            02260000
022700                                                                  02270000
022800*                                                                 02280000
022900 PROCEDURE DIVISION.                                              02290000
023000*                                                                 02300000
023100 0000-MAINLINE-PROCESSING.                                        02310000
023200******************************************************************02320000
023300* THIS IS THE MAIN DRIVER FOR THE PROGRAM.                        02330000
023400*                                                                 02340000
023500* THE PROGRAM WILL ALWAYS READ THE INPUT RECORD INTO A PV AREA    02350000
023600* AND THEN MOVE TO THE DLRD015 INCLUDE AS NEEDED AND ALWAYS       02360000
023700* WRITE FROM THE DLRD015 AREA.                                    02370000
023800******************************************************************02380000
023900     DISPLAY  "***** START DLKUT033  ****"                        02390020
024000     PERFORM 0100-INITIALIZATION.                                 02400000
024100                                                                  02410000
024200     PERFORM 1200-PROCESS-EXTRACT                                 02420000
024300         UNTIL PS-EOF-INPUT OR                                    02430000
024400               PS-EOF-INPUT-2                                     02440000
024401                                                                  02440124
024403                                                                  02440324
024410     IF NOT PS-EOF-INPUT                                          02441010
024411        SET PS-COUNT-ADDTL-YES TO TRUE                            02441123
024420        PERFORM 2200-READ-EXTRACT-01                              02442010
024430        UNTIL PS-EOF-INPUT.                                       02443012
024500                                                                  02450012
024501     IF NOT PS-EOF-INPUT-2                                        02450110
024502        SET PS-COUNT-ADDTL-YES TO TRUE                            02450223
024504        PERFORM 2400-READ-EXTRACT-02                              02450410
024505        UNTIL PS-EOF-INPUT-2.                                     02450512
024506                                                                  02450612
024507                                                                  02450711
024510     PERFORM 9000-EOJ-ROUTINE.                                    02451006
024520                                                                  02452006
025700     GOBACK.                                                      02570000
025800                                                                  02580000
025900                                                                  02590000
026000 0100-INITIALIZATION.                                             02600000
026100******************************************************************02610000
026200**  PERFORM THE INITIAL PROCESSING FOR THE PROGRAM.               02620000
026300******************************************************************02630000
026400                                                                  02640000
026500     OPEN INPUT  SHIP-ASSIGN-EXTRACT-FILE                         02650002
026510                 EAI-ASSIGN-EXTRACT-FILE                          02651002
026600          OUTPUT EXTRACT-FILE-OUT.                                02660000
026602                                                                  02660204
026603     INITIALIZE  PV-DL011-IN-COUNT                                02660304
026604                 PV-DL015-IN-COUNT                                02660404
026605                 PV-DL015-OUT-COUNT                               02660504
026606                 PV-NO-MATCH-COUNT                                02660626
026607                 PV-REC-AFTER-END-SHP                             02660727
026608                 PV-REC-AFTER-END-ASG.                            02660826
026609                                                                  02660926
026610     SET PS-COUNT-ADDTL-NO TO TRUE.                               02661024
026611                                                                  02661104
026620                                                                  02662000
026800     PERFORM 2200-READ-EXTRACT-01.                                02680003
026810     PERFORM 2400-READ-EXTRACT-02.                                02681000
026900                                                                  02690000
027000     IF  PS-EOF-INPUT                                             02700000
027100         SET PS-EMPTY-FILE TO TRUE                                02710000
027110         DISPLAY '** SHIP ASSIGN EXTRACT IS EMPTY **'             02711000
027111     END-IF                                                       02711110
027130                                                                  02713000
027131     IF  PS-EOF-INPUT-2                                           02713100
027132         SET PS-EMPTY-FILE-2 TO TRUE                              02713200
027133         DISPLAY '** EAI EXTRACT IS EMPTY **'                     02713300
027136     END-IF.                                                      02713602
027170                                                                  02717000
028500                                                                  02850000
028600 1200-PROCESS-EXTRACT.                                            02860000
028700******************************************************************02870000
028800**  PROCESS THE INPUT FILE                                        02880000
029300******************************************************************02930000
029400                                                                  02940000
029500     IF  DL011-SHIP-ASGMT-EXTRACT = DL015-EXTRACT-DTL-TXT         02950008
029510         PERFORM 8400-WRITE-EXTRACT-OUTPUT                        02951000
029520         PERFORM 2400-READ-EXTRACT-02                             02952000
029700     ELSE                                                         02970000
029705         ADD +1 TO PV-NO-MATCH-COUNT                              02970504
029710         IF DL011-SHIP-ASGMT-EXTRACT   <                          02971008
029720                             DL015-EXTRACT-DTL-TXT                02972008
029730            PERFORM 2200-READ-EXTRACT-01                          02973003
029740         ELSE                                                     02974022
029742            IF DL011-SHIP-ASGMT-EXTRACT  >                        02974222
029743                             DL015-EXTRACT-DTL-TXT                02974322
029744               PERFORM 2400-READ-EXTRACT-02                       02974422
029745            END-IF                                                02974522
029750         END-IF                                                   02975022
030100     END-IF.                                                      03010000
030500                                                                  03050000
033900                                                                  03390000
034000 2200-READ-EXTRACT-01.                                            03400000
034100******************************************************************03410000
034200**  READS THE INPUT RECORD IN THE PV AREA.                        03420000
034300******************************************************************03430000
034400                                                                  03440000
034500     READ SHIP-ASSIGN-EXTRACT-FILE                                03450000
034510               INTO DL011-SHIP-ASGMT-EXTRACT                      03451008
034600        AT END                                                    03460000
034700           SET PS-EOF-INPUT TO TRUE.                              03470000
034701                                                                  03470110
034710         IF NOT PS-EOF-INPUT                                      03471010
034720            ADD +1 TO PV-DL011-IN-COUNT                           03472010
034730         END-IF.                                                  03473010
034731                                                                  03473123
034732         IF PS-COUNT-ADDTL-YES                                    03473226
034733            ADD +1 TO PV-REC-AFTER-END-ASG                        03473326
034900         END-IF.                                                  03490026
034901                                                                  03490123
034910 2400-READ-EXTRACT-02.                                            03491000
034920******************************************************************03492000
034930**  READS THE INPUT RECORD IN THE PV AREA.                        03493000
034940******************************************************************03494000
034950                                                                  03495000
034960     READ EAI-ASSIGN-EXTRACT-FILE                                 03496000
034970                    INTO DL015-EAI-KEY-RECORD-LAYOUT              03497009
034980        AT END                                                    03498000
034990           SET PS-EOF-INPUT-2 TO TRUE.                            03499000
034991                                                                  03499100
034992         IF NOT PS-EOF-INPUT-2                                    03499210
034993            ADD +1 TO PV-DL015-IN-COUNT                           03499310
034994         END-IF.                                                  03499410
034995                                                                  03499516
034996         IF PS-COUNT-ADDTL-YES                                    03499623
034997            ADD +1 TO PV-REC-AFTER-END-SHP                        03499726
034998         END-IF.                                                  03499823
034999                                                                  03499900
035000 8400-WRITE-EXTRACT-OUTPUT.                                       03500000
035100******************************************************************03510000
035200*     WRITE THE COMBINED EXTRACT RECORD FROM THE DLRD015 AREA.   *03520002
035300******************************************************************03530000
035400     ADD +1 TO PV-DL015-OUT-COUNT.                                03540004
035500     WRITE EXTRACT-RECORD-OUT                                     03550000
035600      FROM DL015-EAI-KEY-RECORD-LAYOUT.                           03560000
035700                                                                  03570000
035800 9000-EOJ-ROUTINE.                                                03580006
035810     DISPLAY  '** SHIP ASGMT RECORDS READ * ' PV-DL011-IN-COUNT   03581004
035820     DISPLAY  '** SHIP EVENT RECORDS READ * ' PV-DL015-IN-COUNT   03582004
035830     DISPLAY  '** SHIP EVENT MATCH COUNT  * ' PV-DL015-OUT-COUNT  03583004
035840     DISPLAY  '** SHIP EVENT NO MATCH     * ' PV-NO-MATCH-COUNT   03584004
035841     DISPLAY  '** SHIP EVENT REC AFTER EO SHP FILE '              03584128
035842                                        PV-REC-AFTER-END-SHP      03584227
035843     DISPLAY  '** SHIP ASGMT REC AFTER EO ASGMT FILE '            03584328
035844                                PV-REC-AFTER-END-ASG              03584427
035850                                                                  03585004
035860                                                                  03586004
035870                                                                  03587004
035900     CLOSE SHIP-ASSIGN-EXTRACT-FILE                               03590004
036000           EAI-ASSIGN-EXTRACT-FILE                                03600004
036100           EXTRACT-FILE-OUT.                                      03610004
036200                                                                  03620004
