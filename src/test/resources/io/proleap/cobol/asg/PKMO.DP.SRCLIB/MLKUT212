       IDENTIFICATION DIVISION.                                                 
       PROGRAM-ID.    MLKUT212.                                                 
       AUTHOR.        B. GRAHAM - STRATAGEM.                                    
       INSTALLATION.  KOHLS DEPARTMENT STORES.                                  
       DATE-WRITTEN.  11/22/06.                                                 
       DATE-COMPILED.                                                           
                                                                        00070000
      ******************************************************************00080000
      * THIS PROGRAM WILL FORMAT A COMMA DELIMITED FILE FOR DOWNLOADING 00090000
      * THE RESULTS OF SMOOTHING FOR RECONCILEMENT.                     00100000
      * THE INPUT IS IN MLKRD070 FORMAT                                         
      * PROCESSING WILL BE DIFFERENT BASED UPON OUTLYER INDICATOR.      00110000
      *CHANGE HISTORY:                                                          
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES                   
      * ------- ---------- ----------- --------------------------------         
G28582* 28582   03-12-2007 ROD JANSSEN CMU OVERRIDE DEFAULTS TO ZEROS.          
G28582*                                WHY?                                     
I28582* 28582   03-19-2007 ROD JANSSEN ADD TEST ID FOR SMOOTHING LEVEL          
257901* 257901  06-01-2021 SRINIVASAN  INCREASED THE LENGTH OF LABEL SEQ        
257901*                                NUMBER FROM 4 TO 5 TO AVOID THE          
257901*                                TRUNCATION OF LABEL SEQ NUMBER           
257901*                                WHICH IS GREATER THAN 4 DIGITS.          
257901*                                CHANGE NUMBER : CHG0257901               
      ******************************************************************00230000
                                                                        00240000
       ENVIRONMENT DIVISION.                                            00260000
       CONFIGURATION SECTION.                                           00290000
       SOURCE-COMPUTER.        IBM-3090.                                00310000
       OBJECT-COMPUTER.        IBM-3090.                                00320000
       INPUT-OUTPUT SECTION.                                            00340000
       FILE-CONTROL.                                                    00360000
                                                                        00370000
           SELECT DETAIL-IN-FILE                                        00400000
               ASSIGN TO INP01.                                         00410000
           SELECT RECONCILE-OUT-FILE                                    00440014
               ASSIGN TO OUT01.                                         00450014
                                                                        00460014
       DATA DIVISION.                                                   00480000
       FILE SECTION.                                                    00510000
                                                                        00560000
       FD  DETAIL-IN-FILE                                               00570000
           RECORDING  MODE IS F                                         00580000
           BLOCK CONTAINS 0 RECORDS.                                    00590000
       01  DETAIL-IN-REC                         PIC X(400).            00610000
                                                                        00620000
       FD  RECONCILE-OUT-FILE                                           00630000
           RECORDING  MODE IS F                                         00640000
           BLOCK CONTAINS 0 RECORDS.                                    00650000
I28582 01  RECONCILE-OUT-REC                     PIC X(1021).           00660000
                                                                        00670000
      /*****************************************************************00731014
       WORKING-STORAGE SECTION.                                         00740000
      ******************************************************************00741014
                                                                        00750000
       01  ABEND-CODE                            PIC S9(4) VALUE ZEROS  00760000
                                                       COMP SYNC.       00770000
                                                                        00780000
       01  PA-PROGRAM-ACCUMULATORS.                                     00790000
                                                                        00800000
           05  PA-DETAIL-IN-CNT                  PIC S9(09) VALUE +0    00810000
                                                        COMP-3.         00820000
           05  PA-RECON-OUT-CNT                  PIC S9(09) VALUE +0    00830000
                                                        COMP-3.         00840000
           05  PA-BYPASS-CNT                     PIC S9(09) VALUE +0    00830000
                                                        COMP-3.         00840000
           05  PA-WORK-CNT                       PIC S9(09) VALUE +0    00830000
                                                        COMP-3.         00840000
                                                                        01270000
       01  PC-PROGRAM-CONSTANTS.                                        01280000
           05 PC-PROGRAM-NAME                    PIC  X(08)             01290000
                                                      VALUE 'MLKUT212'. 01300000
           05 PC-UNKNOWN                         PIC  X(08)             01290000
                                                      VALUE '????????'. 01300000
           05 PC-4090                            PIC S9(08) COMP SYNC   01310000
                                                      VALUE +4090.      01320000
           05 PC-4095                            PIC S9(08) COMP SYNC   01310000
                                                      VALUE +4095.      01320000
           05 PC-3                               PIC  S9(05) COMP-3     01330000
                                                      VALUE +3.         01340000
           05  PC-TITLE-RECORD.                                         01340000
            10 FILLER VALUE 'FISCAL,'              PIC X(07).           01340000
            10 FILLER VALUE 'DEPT,'                PIC X(05).           01340000
            10 FILLER VALUE 'BRND,'                PIC X(05).           01340000
            10 FILLER VALUE 'DESCRIPTION,'         PIC X(12).           01340000
            10 FILLER VALUE 'VEND,'                PIC X(05).           01340000
            10 FILLER VALUE 'DESCRIPTION,'         PIC X(12).           01340000
            10 FILLER VALUE 'DKEY,'                PIC X(05).           01340000
            10 FILLER VALUE 'IND,'                 PIC X(04).           01340000
            10 FILLER VALUE 'CURR RCPT NET COST,'  PIC X(19).           01340000
            10 FILLER VALUE 'CURR RCPT RTL,'       PIC X(14).           01340000
            10 FILLER VALUE 'CURR PADJ NET COST,'  PIC X(19).           01340000
            10 FILLER VALUE 'CURR PADJ RTL,'       PIC X(14).           01340000
            10 FILLER VALUE 'CURR SLS COST,'       PIC X(14).           01340000
            10 FILLER VALUE 'CURR SLS RTL,'        PIC X(13).           01340000
            10 FILLER VALUE 'CURR SHNK RTL,'       PIC X(14).           01340000
            10 FILLER VALUE 'CURR MKND RTL,'       PIC X(14).           01340000
RWJ         10 FILLER VALUE 'CURR INV ADJ RTL,'    PIC X(17).           01340000
            10 FILLER VALUE 'CURR TRANSFER IN,'    PIC X(17).           01340000
            10 FILLER VALUE 'CURR TRANSFER OUT,'   PIC X(18).           01340000
            10 FILLER VALUE 'EOP COST,'            PIC X(09).           01340000
            10 FILLER VALUE 'EOP RTL,'             PIC X(08).           01340000
            10 FILLER VALUE 'BOP COST,'            PIC X(09).           01340000
            10 FILLER VALUE 'BOP RTL,'             PIC X(08).           01340000
            10 FILLER VALUE 'ADJ GRO MRGN,'        PIC X(13).           01340000
            10 FILLER VALUE 'ADJ1,'                PIC X(05).           01340000
            10 FILLER VALUE 'ADJ2,'                PIC X(05).           01340000
            10 FILLER VALUE 'ADJ3,'                PIC X(05).           01340000
            10 FILLER VALUE 'BI @ COST,'           PIC X(10).           01340000
            10 FILLER VALUE 'BI @ RETAIL,'         PIC X(12).           01340000
            10 FILLER VALUE 'CUMM COST,'           PIC X(10).           01340000
            10 FILLER VALUE 'CUMM RETAIL,'         PIC X(12).           01340000
            10 FILLER VALUE 'CUMM %,'              PIC X(07).           01340000
            10 FILLER VALUE 'EI @ COST,'           PIC X(10).           01340000
            10 FILLER VALUE 'EI @ RETAIL,'         PIC X(12).           01340000
            10 FILLER VALUE 'COGS,'                PIC X(05).           01340000
            10 FILLER VALUE 'MARGIN $S,'           PIC X(10).           01340000
            10 FILLER VALUE 'MARGIN %,'            PIC X(09).           01340000
            10 FILLER VALUE 'VARIANCE,'            PIC X(09).           01340000
            10 FILLER VALUE 'PREV END INV RTL,'    PIC X(17).           01340000
            10 FILLER VALUE 'PREV END INV COST,'   PIC X(18).           01340000
            10 FILLER VALUE 'CURR END INV RTL,'    PIC X(17).           01340000
            10 FILLER VALUE 'CURR END INV COST,'   PIC X(18).           01340000
            10 FILLER VALUE 'CURR GRO MRGN,'       PIC X(14).           01340000
            10 FILLER VALUE 'SEAS RCPT RTL,'       PIC X(14).           01340000
            10 FILLER VALUE 'SEAS RCPT NET COST,'  PIC X(19).           01340000
            10 FILLER VALUE 'SEAS PADJ RTL,'       PIC X(14).           01340000
            10 FILLER VALUE 'SEAS PADJ NET COST,'  PIC X(19).           01340000
            10 FILLER VALUE 'SEAS MKUP RTL,'       PIC X(14).           01340000
            10 FILLER VALUE 'SEAS TRANSFER IN,'    PIC X(17).           01340000
            10 FILLER VALUE 'SEAS TRANSFER OUT,'   PIC X(18).           01340000
            10 FILLER VALUE 'BEG SEAS INV RTL,'    PIC X(17).           01340000
            10 FILLER VALUE 'BEG SEAS INV COST,'   PIC X(18).           01340000
            10 FILLER VALUE 'TOTAL SHNK RTL,'      PIC X(15).           01340000
            10 FILLER VALUE 'TOTAL SHNK SLS RTL,'  PIC X(19).           01340000
            10 FILLER VALUE 'INV COST ADJ1,'       PIC X(14).           01340000
            10 FILLER VALUE 'INV COST ADJ2,'       PIC X(14).           01340000
            10 FILLER VALUE 'END INV COST1,'       PIC X(14).           01340000
            10 FILLER VALUE 'END INV COST2,'       PIC X(14).           01340000
            10 FILLER VALUE 'SEAS INV COST ADJ1,'  PIC X(19).           01340000
            10 FILLER VALUE 'SEAS INV COST ADJ2,'  PIC X(19).           01340000
            10 FILLER VALUE 'CUM TO DTE PUR RTL,'  PIC X(19).           01340000
            10 FILLER VALUE 'CUM TO DTE PUR COST,' PIC X(20).           01340000
            10 FILLER VALUE 'CURR CUM MKUP %,'     PIC X(16).           01340000
            10 FILLER VALUE 'TGT CUM MKUP %,'      PIC X(15).           01340000
I28582      10 FILLER VALUE 'ADJ1 ID,'             PIC X(08).           01340000
I28582      10 FILLER VALUE 'ADJ2 ID,'             PIC X(08).           01340000
I28582      10 FILLER VALUE 'ADJ3 ID,'             PIC X(08).           01340000
I28582      10 FILLER VALUE 'ADJ4 ID,'             PIC X(08).           01340000
       01  PS-PROGRAM-SWITCHES.                                         01420000
           05  PS-DETAIL-IN-AT-END-SW            PIC  X(01) VALUE 'N'.  01440000
               88  PS-DETAIL-IN-AT-END-NO                   VALUE 'N'.  01450000
               88  PS-DETAIL-IN-AT-END-YES                  VALUE 'Y'.  01460000
                                                                        01680000
       01  PV-PROGRAM-VARIABLES.                                        01690000
                                                                        01680000
           05  PV-ML-LWST-ID-9                   PIC  9(09)             01710000
                                                        VALUE ZEROS.    01840000
           05  PV-LBL-SEQ-NBR                    PIC S9(04) COMP        01710000
                                                        VALUE ZEROS.    01840000
257901     05  PV-LBL-SEQ-NBR-9                  PIC  9(05)             01710000
                                                        VALUE ZEROS.    01840000
           05  PV-ENT-ID                         PIC S9(09) COMP        01710000
                                                        VALUE ZEROS.    01840000
           05  PV-ENT-ID-9                       PIC  9(09)             01710000
                                                        VALUE ZEROS.    01840000
           05  PV-PARAGRAPH-NAME       PIC X(30)    VALUE SPACES.               
           05  PV-DB2-OPER-ATTEMPTED   PIC X(30)    VALUE SPACES.               
           05  PV-WORK-AMT                       PIC S9(11)V99 COMP-3           
                                                    VALUE ZEROS.        01680000
       01  PV-OUTPUT-RECON-REC.                                         01840000
           05  PV-OUT-FSCL-END-DTE           PIC  X(10) VALUE SPACES.   01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-DEPT-NBR               PIC  9(04) VALUE ZEROS.    01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-LBL-SEQ-NBR            PIC  9(09) VALUE ZEROS.    01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-BRAND-NAME             PIC  X(20) VALUE SPACES.   01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-ENT-ID                 PIC  9(09) VALUE ZEROS.    01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-VENDOR-NAME            PIC  X(30) VALUE SPACES.   01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-ML-LWST-ID             PIC  9(09) VALUE ZEROS.    01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-OUTLYER-CANDI-DESC     PIC  X(10) VALUE SPACES.   01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-01                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-02                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-03                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-04                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-05                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-06                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-07                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-08                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-09                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-10                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-11                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-12                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-13                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-14                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-15                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-16                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-17                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-18                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-19                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-20                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-21                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-22                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-23                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-24                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-25                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-26                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-27                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-28                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-29                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-30                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-31                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-32                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-33                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-34                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-35                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-36                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-37                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-38                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-39                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-40                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-41                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-42                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-43                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-44                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-45                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-46                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-47                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-48                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-49                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-50                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-51                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-52                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-53                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-54                 PIC  -9(11).99.            01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-55                 PIC  -9(04).9(07).         01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
           05  PV-OUT-AMT-56                 PIC  -9(04).9(07).         01840000
           05  FILLER                        PIC  X(01) VALUE ','.      01840000
I28582     05  PV-OUT-ADJ1-IND               PIC  X(01) VALUE SPACE.    01840000
I28582     05  FILLER                        PIC  X(01) VALUE ','.      01840000
I28582     05  PV-OUT-ADJ2-IND               PIC  X(01) VALUE SPACE.    01840000
I28582     05  FILLER                        PIC  X(01) VALUE ','.      01840000
I28582     05  PV-OUT-ADJ3-IND               PIC  X(01) VALUE SPACE.    01840000
I28582     05  FILLER                        PIC  X(01) VALUE ','.      01840000
I28582     05  PV-OUT-ADJ4-IND               PIC  X(01) VALUE SPACE.    01840000
I28582     05  FILLER                        PIC  X(01) VALUE ','.      01840000
                                                                        02280000
      ******************************************************************02420000
      *  MLRD070 DETAIL IN RECORD                                       02430000
      ******************************************************************02440000
           COPY MLRD070.                                                02460000
                                                                        02470000
      ***************************************************************** 02390036
      * ERROR MESSAGE AREA FOR DB2                                      02400036
      ***************************************************************** 02410036
           COPY DPWS004.                                                02420036
                                                                        02430036
      *************************************************************     02440036
      *    DB2 TVSCHVL (GET BRAND NAME)                           *     02450036
      *************************************************************     02460036
           EXEC SQL                                                     02470036
               INCLUDE TVSCHVL                                          02480036
           END-EXEC.                                                    02490036
                                                                        02430036
      *************************************************************     02440036
      *    DB2 XMT_VND (GET VENDOR NAME)                          *     02450036
      *************************************************************     02460036
           EXEC SQL                                                     02470036
               INCLUDE XMT00000                                         02480036
           END-EXEC.                                                    02490036
                                                                                
      ******************************************************************        
      * DB2 - MLV_BRND_VND.                                                     
      ******************************************************************        
           EXEC SQL                                                             
               INCLUDE MLV00000                                                 
           END-EXEC.                                                            
                                                                                
      *************************************************************     02440036
      *    DB2 COMMUNICATION AREA                                 *     02450036
      *************************************************************     02460036
           EXEC SQL                                                     02470036
               INCLUDE SQLCA                                            02480036
           END-EXEC.                                                    02490036
      ******************************************************************02480000
       PROCEDURE DIVISION.                                              02490000
      ******************************************************************02500000
                                                                        02510000
       0000-MAINLINE.                                                   02520000
                                                                        02530000
           PERFORM 1000-INITIALIZE.                                     02540000
                                                                        02550000
           PERFORM 1100-PROCESS-INPUT                                   02560000
               UNTIL PS-DETAIL-IN-AT-END-YES.                           02570000
                                                                        02580000
           PERFORM 9000-END-PROCESSING.                                 02590000
                                                                        02600000
           STOP RUN.                                                    02630000
                                                                        02631014
      ******************************************************************02640000
      *  PERFORM THE NECESSARY INITIALIZATION STEPS                     02650000
      ******************************************************************02660000
                                                                        02670000
       1000-INITIALIZE.                                                 02680000
                                                                        02690000
           OPEN  INPUT DETAIL-IN-FILE                                   02700000
                OUTPUT RECONCILE-OUT-FILE.                              02720014
                                                                        02880000
           WRITE RECONCILE-OUT-REC  FROM PC-TITLE-RECORD.                       
           ADD +1 TO PA-RECON-OUT-CNT.                                  06950000
                                                                        02880000
      ******************************************************************02890000
      *  PROCESS THE INPUT FILES.                                       02900000
      ******************************************************************02910000
       1100-PROCESS-INPUT.                                              02930000
                                                                        02940000
           PERFORM 8000-READ-INPUT.                                     02950000
                                                                        02960000
           IF PS-DETAIL-IN-AT-END-NO                                    02970000
                   INITIALIZE PV-OUTPUT-RECON-REC                               
                   PERFORM 2000-PROCESS-COMMON                          02980000
                   PERFORM 3000-PROCESS-BY-OUTLYER-IND                  02980000
                   PERFORM 8500-WRITE-RECONCILE                         02980000
           END-IF.                                                      02990000
                                                                        03450000
      ******************************************************************02890000
      *  2000-PROCESS-COMMON (COMMON FORMATTING)                        02900000
      ******************************************************************02910000
       2000-PROCESS-COMMON.                                             02980000
                                                                        08160014
           MOVE ML070-OUTLYER-CANDI-IND   TO                            08160014
                                          PV-OUT-OUTLYER-CANDI-DESC.    08160014
      *    USE IF TO CHANGE TO A DESC IF NECESSARY                      08160014
           MOVE ML070-FSCL-END-DTE        TO  PV-OUT-FSCL-END-DTE.              
           MOVE ML070-DEPT-NBR            TO  PV-OUT-DEPT-NBR.          08160014
                                                                        08160014
           PERFORM 2100-GET-BV-VIEW.                                    08160014
                                                                        08160014
           IF SQLCODE = +0                                                      
               PERFORM 2200-GET-BRAND-NAME                              08160014
               PERFORM 2300-GET-VENDOR-NAME                             08160014
           END-IF.                                                      08160014
                                                                        08160014
           MOVE PV-LBL-SEQ-NBR            TO  PV-OUT-LBL-SEQ-NBR.               
           MOVE PV-ENT-ID                 TO  PV-OUT-ENT-ID.                    
           MOVE ML070-ML-LWST-ID          TO  PV-OUT-ML-LWST-ID.                
           MOVE ML070-CURR-RCPT-NET-COST-AMT                            08160014
                                          TO  PV-OUT-AMT-01.            08160014
           MOVE ML070-CURR-RCPT-RTL-AMT   TO  PV-OUT-AMT-02.            08160014
           MOVE ML070-CURR-PADJ-NET-COST-AMT                            08160014
                                          TO  PV-OUT-AMT-03.            08160014
           COMPUTE PV-WORK-AMT =                                        08160014
               ML070-CURR-PADJ-RTL-AMT + ML070-CURR-MKUP-RTL-AMT.       08160014
           MOVE PV-WORK-AMT               TO  PV-OUT-AMT-04.            08160014
           MOVE ML070-CURR-SLS-COST-AMT   TO  PV-OUT-AMT-05.            08160014
           MOVE ML070-CURR-SLS-RTL-AMT    TO  PV-OUT-AMT-06.            08160014
           MOVE ML070-CURR-SHNK-RTL-AMT   TO  PV-OUT-AMT-07.            08160014
           MOVE ML070-CURR-MKDN-RTL-AMT   TO  PV-OUT-AMT-08.            08160014
           MOVE ML070-CURR-INV-ADJ-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-09.            08160014
           MOVE ML070-CURR-XFER-IN-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-10.            08160014
           MOVE ML070-CURR-XFER-OUT-RTL-AMT                             08160014
                                          TO  PV-OUT-AMT-11.            08160014
           MOVE ML070-END-INV-COST-AMT2                                 08160014
                                          TO  PV-OUT-AMT-12             08160014
           MOVE ML070-CURR-END-INV-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-13             08160014
           MOVE ML070-PREV-END-INV-COST-AMT                             08160014
                                          TO  PV-OUT-AMT-14             08160014
           MOVE ML070-PREV-END-INV-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-15             08160014
           MOVE ML070-ADJ-GRO-MRGN-AMT    TO  PV-OUT-AMT-16.            08160014
                                                                        08160014
      * PV-OUT-AMT-17 THROUGH 19 ARE IN OUTLYER SPECIFIC CODE           08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-20.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-21.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-22.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-23.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-24.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-25.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-26.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-27.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-28.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-29.            08160014
           MOVE ZEROS                     TO  PV-OUT-AMT-30.            08160014
           MOVE ML070-PREV-END-INV-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-31.            08160014
           MOVE ML070-PREV-END-INV-COST-AMT                             08160014
                                          TO  PV-OUT-AMT-32.            08160014
           MOVE ML070-CURR-END-INV-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-33.            08160014
           MOVE ML070-CURR-END-INV-COST-AMT                             08160014
                                          TO  PV-OUT-AMT-34.            08160014
           MOVE ML070-CURR-GRO-MRGN-AMT                                 08160014
                                          TO  PV-OUT-AMT-35.            08160014
           MOVE ML070-SEAS-RCPT-RTL-AMT                                 08160014
                                          TO  PV-OUT-AMT-36.            08160014
           MOVE ML070-SEAS-RCPT-NET-COST-AMT                            08160014
                                          TO  PV-OUT-AMT-37.            08160014
           MOVE ML070-SEAS-PADJ-RTL-AMT                                 08160014
                                          TO  PV-OUT-AMT-38.            08160014
           MOVE ML070-SEAS-PADJ-NET-COST-AMT                            08160014
                                          TO  PV-OUT-AMT-39.            08160014
           MOVE ML070-SEAS-MKUP-RTL-AMT                                 08160014
                                          TO  PV-OUT-AMT-40.            08160014
           MOVE ML070-SEAS-XFER-IN-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-41.            08160014
           MOVE ML070-SEAS-XFER-OUT-RTL-AMT                             08160014
                                          TO  PV-OUT-AMT-42.            08160014
           MOVE ML070-BEG-SEAS-INV-RTL-AMT                              08160014
                                          TO  PV-OUT-AMT-43.            08160014
           MOVE ML070-BEG-SEAS-INV-COST-AMT                             08160014
                                          TO  PV-OUT-AMT-44.            08160014
           MOVE ML070-SHNK-RTL-AMT                                      08160014
                                          TO  PV-OUT-AMT-45.            08160014
           MOVE ML070-SHNK-SLS-RTL-AMT                                  08160014
                                          TO  PV-OUT-AMT-46.            08160014
           MOVE ML070-INV-COST-ADJ1                                     08160014
                                          TO  PV-OUT-AMT-47.            08160014
           MOVE ML070-INV-COST-ADJ2                                     08160014
                                          TO  PV-OUT-AMT-48.            08160014
           MOVE ML070-END-INV-COST-AMT1                                 08160014
                                          TO  PV-OUT-AMT-49.            08160014
           MOVE ML070-END-INV-COST-AMT2                                 08160014
                                          TO  PV-OUT-AMT-50.            08160014
           MOVE ML070-SEAS-INV-COST-ADJ1                                08160014
                                          TO  PV-OUT-AMT-51.            08160014
           MOVE ML070-SEAS-INV-COST-ADJ2                                08160014
                                          TO  PV-OUT-AMT-52.            08160014
           MOVE ML070-CUM-TO-DATE-PURCH-RTL                             08160014
                                          TO  PV-OUT-AMT-53.            08160014
           MOVE ML070-CUM-TO-DATE-PURCH-COST                            08160014
                                          TO  PV-OUT-AMT-54.            08160014
           MOVE ML070-CURR-CUM-MKUP-PCT                                 08160014
                                          TO  PV-OUT-AMT-55.            08160014
           MOVE ML070-TGT-CUM-MKUP-PCT                                  08160014
                                          TO  PV-OUT-AMT-56.            08160014
I28582     MOVE ML070-LVL1-SMOOTH-IND     TO  PV-OUT-ADJ1-IND.          08160014
I28582     MOVE ML070-LVL2-SMOOTH-IND     TO  PV-OUT-ADJ2-IND.          08160014
I28582     MOVE ML070-LVL3-SMOOTH-IND     TO  PV-OUT-ADJ3-IND.          08160014
I28582     MOVE ML070-LVL4-SMOOTH-IND     TO  PV-OUT-ADJ4-IND.          08160014
                                                                        03450000
      ******************************************************************02890000
      *  2100-GET-BV-VIEW FROM MLV_BRND_VND                             02900000
      ******************************************************************02910000
       2100-GET-BV-VIEW.                                                08160014
                                                                        08160014
           EXEC SQL                                                             
              SELECT   LBL_SEQ_NBR                                              
                      ,ENT_ID                                                   
                INTO  :MLV00000-LBL-SEQ-NBR,                                    
                      :MLV00000-ENT-ID                                          
                FROM   MLV_BRND_VND                                             
               WHERE   ML_LO_MDSE_LVL_ID = :ML070-ML-LWST-ID                    
              WITH UR                                                           
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               MOVE MLV00000-LBL-SEQ-NBR TO PV-LBL-SEQ-NBR                      
               MOVE MLV00000-ENT-ID      TO PV-ENT-ID                           
           ELSE                                                                 
               IF SQLCODE = +100                                                
                   MOVE ML070-ML-LWST-ID   TO PV-ML-LWST-ID-9                   
                   DISPLAY 'UNKNOWN BV VIEW FOR ' PV-ML-LWST-ID-9               
                   MOVE PC-UNKNOWN         TO PV-OUT-BRAND-NAME                 
                   MOVE PC-UNKNOWN         TO PV-OUT-VENDOR-NAME                
                   MOVE ZEROS              TO PV-LBL-SEQ-NBR                    
                   MOVE ZEROS              TO PV-ENT-ID                         
                   MOVE PC-4090            TO RETURN-CODE                       
           ELSE                                                                 
               MOVE 'SELECT MLV_BRND_VND ' TO PV-DB2-OPER-ATTEMPTED             
               MOVE '2100-GET-BV-VIEW   ' TO PV-PARAGRAPH-NAME                  
               PERFORM 9950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                        03450000
      ******************************************************************02890000
      *  2200-GET-BRAND-NAME FROM TVSCHVL                               02900000
      ******************************************************************02910000
       2200-GET-BRAND-NAME.                                             08160014
                                                                        08160014
           EXEC SQL                                                             
              SELECT   CHARTC_VAL_DESC                                          
                INTO  :VSCHVL-CHARTC-VAL-DESC                                   
                FROM   TVSCHVL                                                  
               WHERE   CHARTC_CDE = :PC-3                                       
                 AND   CHARTC_SEQ_NBR = :PV-LBL-SEQ-NBR                         
              WITH UR                                                           
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               INSPECT VSCHVL-CHARTC-VAL-DESC                                   
                                REPLACING ALL ',' BY ' '                        
               MOVE VSCHVL-CHARTC-VAL-DESC TO PV-OUT-BRAND-NAME                 
           ELSE                                                                 
               IF SQLCODE = +100                                                
                   MOVE PC-UNKNOWN         TO PV-OUT-BRAND-NAME                 
                   MOVE PV-LBL-SEQ-NBR     TO PV-LBL-SEQ-NBR-9                  
                   DISPLAY 'UNKNOWN BRAND FOR ' PV-LBL-SEQ-NBR-9                
                   MOVE PC-4090            TO RETURN-CODE                       
           ELSE                                                                 
               MOVE 'SELECT TVSCHVL     ' TO PV-DB2-OPER-ATTEMPTED              
               MOVE '2200-GET-BRAND-NAME' TO PV-PARAGRAPH-NAME                  
               PERFORM 9950-SQL-ABEND                                           
           END-IF.                                                              
                                                                                
                                                                                
      ******************************************************************02890000
      *  2300-GET-VENDOR-NAME FROM XMT_VND                              02900000
      ******************************************************************02910000
       2300-GET-VENDOR-NAME.                                            08160014
                                                                        08160014
           EXEC SQL                                                             
              SELECT   PRIM_VND_NM                                              
                INTO  :XMT00000-PRIM-VND-NM                                     
                FROM   XMT_VND                                                  
               WHERE   ENT_ID = :PV-ENT-ID                                      
              WITH UR                                                           
           END-EXEC.                                                            
                                                                                
           IF SQLCODE = +0                                                      
               INSPECT XMT00000-PRIM-VND-NM                                     
                                      REPLACING ALL ',' BY ' '                  
               MOVE XMT00000-PRIM-VND-NM   TO PV-OUT-VENDOR-NAME                
           ELSE                                                                 
               IF SQLCODE = +100                                                
                   MOVE PC-UNKNOWN         TO PV-OUT-VENDOR-NAME                
                   MOVE PV-ENT-ID          TO PV-ENT-ID-9                       
                   DISPLAY 'UNKNOWN VENDOR FOR ' PV-ENT-ID-9                    
                   MOVE PC-4090            TO RETURN-CODE                       
           ELSE                                                                 
               MOVE 'SELECT XMT_VND     ' TO PV-DB2-OPER-ATTEMPTED              
               MOVE '2300-GET-VENDOR-NAME ' TO PV-PARAGRAPH-NAME                
               PERFORM 9950-SQL-ABEND                                           
           END-IF.                                                              
                                                                        08160014
                                                                        03450000
      ******************************************************************02890000
      *  3000-PROCESS-BY-OUTLYER-IND (EXCEPTION FORMATTING)             02900000
      ******************************************************************02910000
       3000-PROCESS-BY-OUTLYER-IND.                                     08160014
                                                                        08160014
G28582     MOVE ML070-INV-COST-ADJ1   TO  PV-OUT-AMT-17.                08160014
G28582     MOVE ML070-INV-COST-ADJ2   TO  PV-OUT-AMT-18.                08160014
G28582     MOVE ZEROS                 TO  PV-OUT-AMT-19.                08160014
G28582                                                                  08160014
G28582*    IF ML070-OUTLYER-CMU-SMOOTH OR                               08160014
G28582*       ML070-OUTLYER-GM-SMOOTH                                   08160014
G28582*        MOVE ML070-INV-COST-ADJ1                                 08160014
G28582*                                   TO  PV-OUT-AMT-17             08160014
G28582*        MOVE ML070-INV-COST-ADJ2   TO  PV-OUT-AMT-18             08160014
G28582*        MOVE ZEROS                 TO  PV-OUT-AMT-19             08160014
G28582*    ELSE                                                         08160014
G28582*    IF ML070-NON-SMOOTH-CANDIDATE                                08160014
G28582*        MOVE ZEROS                 TO  PV-OUT-AMT-17             08160014
G28582*        MOVE ML070-INV-COST-ADJ2   TO  PV-OUT-AMT-18             08160014
G28582*        MOVE ML070-INV-COST-ADJ1                                 08160014
G28582*                                   TO  PV-OUT-AMT-19             08160014
G28582*    ELSE                                                         08160014
G28582*        MOVE ZEROS                 TO  PV-OUT-AMT-17             08160014
G28582*        MOVE ML070-INV-COST-ADJ2   TO  PV-OUT-AMT-18             08160014
G28582*        IF ML070-NONOUTLYER-CANDIDATE                                    
G28582*            MOVE ML070-INV-COST-ADJ1                             08160014
G28582*                                   TO  PV-OUT-AMT-19             08160014
G28582*        END-IF                                                   08160014
G28582*    END-IF.                                                      08160014
G28582*                                                                 08160014
G28582*                                                                 08160014
      ******************************************************************09330014
      * 8000-READ-INPUT.                                                09340014
      ******************************************************************09350014
       8000-READ-INPUT.                                                 06560000
                                                                        06860000
           READ DETAIL-IN-FILE INTO ML070-COMMON-RECALC-EXTRACT         06870000
               AT END                                                   06880000
                   SET PS-DETAIL-IN-AT-END-YES TO TRUE.                 06890000
                                                                        06930000
           IF PS-DETAIL-IN-AT-END-NO                                    06940000
               ADD +1 TO PA-DETAIL-IN-CNT                               06950000
           END-IF.                                                      07120000
                                                                        09390014
      ******************************************************************09330014
      * 8500-WRITE-RECONCILE.                                           09340014
      ******************************************************************09350014
       8500-WRITE-RECONCILE.                                            09360014
                                                                        09370014
           WRITE RECONCILE-OUT-REC FROM PV-OUTPUT-RECON-REC.            09380014
                                                                        06550000
           ADD +1 TO PA-RECON-OUT-CNT.                                  06950000
                                                                        06550000
      ******************************************************************09400000
      *  PERFORM THE NECESSARY END PROCESSING STEPS                     09410000
      ******************************************************************09420000
                                                                        09430000
       9000-END-PROCESSING.                                             09440000
                                                                        09450000
           CLOSE DETAIL-IN-FILE                                         09520000
                 RECONCILE-OUT-FILE.                                    09530014
                                                                        09550000
           DISPLAY '*************************************************'  09560000
           DISPLAY 'PA-DETAIL-IN     ' PA-DETAIL-IN-CNT.                09570000
           DISPLAY 'PA-BYPASS        ' PA-BYPASS-CNT.                   09570000
           DISPLAY 'PA-RECON-OUT-CNT ' PA-RECON-OUT-CNT.                09590000
           COMPUTE PA-WORK-CNT = PA-RECON-OUT-CNT + PA-BYPASS-CNT       09590000
                                                  - 1.                  09590000
           IF PA-WORK-CNT = PA-DETAIL-IN-CNT                            09590000
               DISPLAY 'IN BALANCE'                                     09590000
           ELSE                                                         09590000
               DISPLAY 'OUT OF BALANCE'                                 09590000
               MOVE PC-4095 TO RETURN-CODE                              09590000
           DISPLAY '*************************************************'. 09620000
                                                                        09630000
                                                                        06910036
      ***************************************************************   06920036
      *    SQL ABEND PROCESSING                                     *   06930036
      ***************************************************************   06940036
       9950-SQL-ABEND.                                                  06950036
                                                                        06960036
           DISPLAY '** ABEND     **'.                                   06970036
           DISPLAY '** PROGRAM   = ' PC-PROGRAM-NAME.                   06980036
           DISPLAY '** PARAGRAPH = ' PV-PARAGRAPH-NAME.                 06990036
           DISPLAY '** OPERATION = ' PV-DB2-OPER-ATTEMPTED.             07000036
                                                                        07010036
           COPY DPPD004.                                                07020036
                                                                        07030036
           CALL 'ILBOABN0'  USING ABEND-CODE.                           07040036
                                                                        07050036
                                                                        09700000
       9999-OTHER-ABEND.                                                09710000
                                                                        09720000
           DISPLAY '**  ABEND     **'.                                  09730000
           DISPLAY '**  PROGRAM   **  = ' PC-PROGRAM-NAME.              09740000
           DISPLAY '************************************************'.  09750000
           CALL 'ILBOABN0' USING ABEND-CODE.                            09760000
