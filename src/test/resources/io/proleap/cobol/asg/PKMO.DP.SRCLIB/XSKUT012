       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.      XSKUT012.                                       00020099
       AUTHOR.          KOHLS DEPARTMENT STORES.                        00030000
       INSTALLATION.    KOHLS DEPARTMENT STORES.                        00040000
       DATE-WRITTEN.    09/29/2002.                                     00050000
       DATE-COMPILED.                                                   00060000
      ******************************************************************00070000
      **XS MQ VSM TABLE UPDATES - MESSAGE UPDATES FOR THE TABLES        00080000
      **                          XST_VND_STYL                          00090000
      **                          XST_SKU                               00100000
      **                          XST_UPC                               00110000
      **                          XST_SKU_LOC                           00120000
      **                          XST_SKU_ATTR                          00130000
      **                          XST_SKU_LOC_ATTR                      00140000
      ******************************************************************00150000
      **THIS PROGRAM EVALUATES THE MESSAGE TYPE SENT BY VSM IN COPYBOOK 00160000
      **     FORMAT IMRD008 AND THEN CALLS THE PROGRAM TO EXECUTE THE   00170000
      **     BUSINESS LOGIC ASSOCIATED WITH THAT MESSAGE TYPE.          00180000
      ******************************************************************00190000
      *DATE:09/29/2002   MADE BY:JULIE SMITH INITIAL PROGRAM WRITE      00200000
REMOVE*DATE:11/15/2002   MADE BY:DISPLAYS FOR ERROR ISSUES MOVED TO     00210000
REMOVE*                  1 PROGRAM DENOTED BY REMOVE.                   00220000
010103*DATE:01/01/2003   MADE BY:JULIE SMITH COMMENT OUT MESSAGE #30    00230000
010103*DATE:01/14/2003   MADE BY:JULIE SMITH FIXES                      00240000
010103*DATE:02/28/2003   MADE BY:SANDY POTTER ADD MESSAGES 70,75,80 & 4000250000
010103*DATE:07/08/2003   MADE BY:SANDY POTTER ADD MESSAGES 997 & 000    00260000
010103*DATE:07/31/2003   MADE BY:SANDY POTTER REMOVE *** DISPLAY LINE   00270000
010103*DATE:09/18/2003   MADE BY:SANDY POTTER ADD DB2 ROLLBACK          00280000
010103*DATE:07/25/2005   MADE BY:SANDY POTTER ADD MSG 996, COMMENT 045  00281000
CL3132*DATE:08/06/2010   MADE BY:COGNIZANT    FINE TUNED PROGRAM FOR    00282099
CL3132*                                       PERFORMANCE IMPROVEMENT   00283099
      ******************************************************************00290000
       ENVIRONMENT DIVISION.                                            00300000
       CONFIGURATION SECTION.                                           00310000
       SOURCE-COMPUTER.        IBM-3090.                                00320000
       OBJECT-COMPUTER.        IBM-3090.                                00330000
       INPUT-OUTPUT SECTION.                                            00340000
       FILE-CONTROL.                                                    00350000
                                                                        00360000
           SELECT CONTROL-CARD-1                                        00370000
                  ASSIGN TO INP01.                                      00380000
           SELECT CONTROL-CARD-2                                        00390000
                  ASSIGN TO INP02.                                      00400000
           SELECT CONTROL-CARD-3                                        00410000
                  ASSIGN TO INP03.                                      00420000
           SELECT MESSAGE-LOG                                           00430000
                  ASSIGN TO OUT01.                                      00440000
                                                                        00450000
       DATA DIVISION.                                                   00460000
       FILE SECTION.                                                    00470000
                                                                        00480000
       FD  CONTROL-CARD-1                                               00490000
           RECORDING MODE F                                             00500000
           BLOCK CONTAINS 0 RECORDS                                     00510000
           LABEL RECORDS ARE OMITTED                                    00520000
           DATA RECORD IS CONTROL-CARD-1-RECORD.                        00530000
       01  CONTROL-CARD-1-RECORD           PIC X(080).                  00540000
                                                                        00550000
       FD  CONTROL-CARD-2                                               00560000
           RECORDING MODE F                                             00570000
           BLOCK CONTAINS 0 RECORDS                                     00580000
           LABEL RECORDS ARE OMITTED                                    00590000
           DATA RECORD IS CONTROL-CARD-2-RECORD.                        00600000
       01  CONTROL-CARD-2-RECORD           PIC X(080).                  00610000
                                                                        00620000
       FD  CONTROL-CARD-3                                               00630000
           RECORDING MODE F                                             00640000
           BLOCK CONTAINS 0 RECORDS                                     00650000
           LABEL RECORDS ARE OMITTED                                    00660000
           DATA RECORD IS CONTROL-CARD-3-RECORD.                        00670000
       01  CONTROL-CARD-3-RECORD           PIC X(080).                  00680000
                                                                        00690000
       FD  MESSAGE-LOG                                                  00700000
           RECORDING MODE F                                             00710000
           BLOCK CONTAINS 0 RECORDS                                     00720000
           LABEL RECORDS ARE OMITTED                                    00730000
           DATA RECORD IS MESSAGE-LOG-RECORD.                           00740000
       01  MESSAGE-LOG-RECORD              PIC X(450).                  00750000
                                                                        00760000
       WORKING-STORAGE SECTION.                                         00770000
      ******************************************************************00780000
      **PROGRAM SWITCHES                                                00790000
      ******************************************************************00800000
       01  PS-PROGRAM-SWITCHES.                                         00810000
           05  PS-PROCESS-INDICATOR-SW         PIC X(01)   VALUE 'Y'.   00820000
               88  PS-PROCESS-COMPLETE                     VALUE 'N'.   00830000
               88  PS-PROCESS-CONTINUE                     VALUE 'Y'.   00840000
           05  PS-ACTION-IND                   PIC 9(02)   VALUE 00.    00850000
               88  PS-ACTION-REVERSE                       VALUE 01.    00860000
      ***USED WHEN ROW ALREADY EXISTS                                   00870000
               88  PS-ACTION-NOTHING                       VALUE 02.    00880000
      ******************************************************************00890000
      **CONTROL CARD 1 RECORD LAYOUT - QUEUE MANAGER NAME               00900000
      ******************************************************************00910000
       01  CC-CONTROL-CARD-1-LAYOUT.                                    00920000
           05  CC-QUEUE-MANAGER-NAME      PIC X(48)   VALUE SPACES.     00930000
           05  FILLER                     PIC X(32)   VALUE SPACES.     00940000
      ******************************************************************00950000
      **CONTROL CARD 2 RECORD LAYOUT - ITEM QUEUE NAME                  00960000
      ******************************************************************00970000
       01  CC-CONTROL-CARD-2-LAYOUT.                                    00980000
           05  CC-ITEM-QUEUE-NAME         PIC X(48)   VALUE SPACES.     00990000
           05  FILLER                     PIC X(32)   VALUE SPACES.     01000000
      ******************************************************************01010000
      **CONTROL CARD 3 RECORD LAYOUT - ITEM ERROR QUEUE NAME            01020000
      ******************************************************************01030000
       01  CC-CONTROL-CARD-3-LAYOUT.                                    01040000
           05  CC-ITEM-ERROR-QUEUE-NAME   PIC X(48)   VALUE SPACES.     01050000
           05  FILLER                     PIC X(32)   VALUE SPACES.     01060000
      ******************************************************************01070000
      **PROGRAM VARIABLES                                               01080000
      ******************************************************************01090000
       01  PV-PROGRAM-VARIABLES.                                        01100000
           05  PV-DISPLAY-SQLCODE         PIC 9999-   VALUE ZEROS.      01110000
CL3132     05  PV-MSG080-RECORD.                                        01111099
CL3132         10  PV-MSG080-REC1          PIC X(450) VALUE SPACES.     01112099
CL3132         10  PV-MSG080-REC2          PIC X(450) VALUE SPACES.     01113099
CL3132         10  PV-MSG080-REC3          PIC X(450) VALUE SPACES.     01114099
                                                                        01115000
       01  PV-XS-MESSAGES                 PIC 9(03).                    01120000
           88  PV-XS-MSGS-END-OF-PROGRAM              VALUE 000.        01130000
      ******************************************************************01140000
      **PROGRAM CONSTANTS                                               01150000
      ******************************************************************01160000
       01  PC-PROGRAM-CONSTANTS.                                        01170000
           05  PC-CURRENT-PROGRAM-NAME    PIC X(08)   VALUE 'XSKUT012'. 01180000
           05  PC-CALLED-PROGRAM          PIC X(08).                    01190000
               88  PC-CALLED-XSKUP005                 VALUE 'XSKUP005'. 01200000
               88  PC-CALLED-XSKUP006                 VALUE 'XSKUP006'. 01210000
               88  PC-CALLED-XSKUP007                 VALUE 'XSKUP007'. 01220000
               88  PC-CALLED-XSKUP008                 VALUE 'XSKUP008'. 01230000
               88  PC-CALLED-XSKUP009                 VALUE 'XSKUP009'. 01240000
               88  PC-CALLED-XSKUP011                 VALUE 'XSKUP011'. 01250000
               88  PC-CALLED-XSKUP010                 VALUE 'XSKUP010'. 01260000
               88  PC-CALLED-XSKUP012                 VALUE 'XSKUP012'. 01270000
               88  PC-CALLED-XSKUP013                 VALUE 'XSKUP013'. 01280000
               88  PC-CALLED-XSKUP014                 VALUE 'XSKUP014'. 01290000
               88  PC-CALLED-XSKUP015                 VALUE 'XSKUP015'. 01300000
               88  PC-CALLED-XSKUP016                 VALUE 'XSKUP016'. 01310000
               88  PC-CALLED-XSKUP019                 VALUE 'XSKUP019'. 01320000
               88  PC-CALLED-XSKUP020                 VALUE 'XSKUP020'. 01330000
               88  PC-CALLED-XSKUP021                 VALUE 'XSKUP021'. 01340000
               88  PC-CALLED-XSKUP022                 VALUE 'XSKUP022'. 01350000
               88  PC-CALLED-XSKUP023                 VALUE 'XSKUP023'. 01360000
               88  PC-CALLED-XSKUP024                 VALUE 'XSKUP024'. 01370000
               88  PC-CALLED-XSKUP046                 VALUE 'XSKUP046'. 01380000
               88  PC-CALLED-XSKUP048                 VALUE 'XSKUP048'. 01390000
               88  PC-CALLED-XSKUP049                 VALUE 'XSKUP049'. 01400000
               88  PC-CALLED-XSKUP064                 VALUE 'XSKUP064'. 01410000
      ******************************************************************01420000
      **MQ WORKING STORAGE                                              01430000
      ******************************************************************01440000
       01  MQV-WORKING-STORAGE.                                         01450000
           05  MQV-MQCONN                 PIC  X(08) VALUE 'CSQBCONN'.  01460000
           05  MQV-MQOPEN                 PIC  X(08) VALUE 'CSQBOPEN'.  01470000
           05  MQV-MQPUT                  PIC  X(08) VALUE 'CSQBPUT'.   01480000
           05  MQV-MQGET                  PIC  X(08) VALUE 'CSQBGET'.   01490000
           05  MQV-MQCMIT                 PIC  X(08) VALUE 'CSQBCOMM'.  01500000
           05  MQV-MQBACK                 PIC  X(08) VALUE 'CSQBBACK'.  01510000
           05  MQV-MQCLOSE                PIC  X(08) VALUE 'CSQBCLOS'.  01520000
           05  MQV-MQDISC                 PIC  X(08) VALUE 'CSQBDISC'.  01530000
           05  MQV-MQCHECK                PIC  X(08) VALUE 'MQR2C'.     01540000
           05  MQV-HCONN                  PIC S9(09) BINARY VALUE 0.    01550000
           05  MQV-COMPLETION-CODE        PIC S9(09) BINARY.            01560000
           05  MQV-REASON                 PIC S9(09) BINARY.            01570000
           05  MQV-OPEN-OPTIONS           PIC S9(09) BINARY.            01580000
           05  MQV-ITEM-HANDLE            PIC S9(09) BINARY VALUE 0.    01590000
           05  MQV-ERROR-HANDLE           PIC S9(09) BINARY VALUE 0.    01600000
           05  MQV-REASON-TEXT            PIC X(30)  VALUE SPACES.      01610000
           05  MQV-MSGBUFFER              PIC X(450) VALUE SPACES.      01620000
           05  MQV-MSG                    PIC X(450) VALUE SPACES.      01630000
           05  MQV-ERRMSGBUF              PIC X(500) VALUE SPACES.      01640000
           05  MQV-MSG-LENGTH             PIC S9(09) BINARY VALUE +450. 01650000
           05  MQV-DATA-LENGTH            PIC S9(09) BINARY.            01660000
      ******************************************************************01670000
      **COPYBOOKS                                                       01680000
      ******************************************************************01690000
      ***INPUT FILE LAYOUT - VSM ITEM MESSAGE COPYBOOK                  01700000
           COPY IMRD008.                                                01710000
      ***VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004        01720000
           COPY DPWS004.                                                01730000
      ***DB2 ABEND COPYBOOK                                             01740000
           COPY DPWS900.                                                01750000
      ***DB2 MESSAGE AREA                                               01760000
           COPY SQLCA2.                                                 01770000
      ***OBJECT-DESCRIPTOR.                                             01780000
       01  MQM-OBJECT-DESCRIPTOR.                                       01790000
           COPY CMQODV.                                                 01800000
      ***MESSAGE-DESCRIPTOR.                                            01810000
       01  MQM-MESSAGE-DESCRIPTOR.                                      01820000
           COPY CMQMDV.                                                 01830000
      ***GET-MESSAGE-OPTIONS.                                           01840000
       01  MQM-GET-MESSAGE-OPTIONS.                                     01850000
           COPY CMQGMOV.                                                01860000
      ***PUT-MESSAGE-OPTIONS.                                           01870000
       01  MQM-PUT-MESSAGE-OPTIONS.                                     01880000
           COPY CMQPMOV.                                                01890000
      ***CONSTANTS.                                                     01900000
       01  MQM-CONSTANTS.                                               01910000
           COPY CMQV.                                                   01920000
      ******************************************************************01930000
      **PROGRAM COUNTERS                                                01940000
      ******************************************************************01950000
       01  PC-PROGRAM-COUNTERS.                                         01960000
           05  PC-MESSAGE-FROM-QUEUE        PIC 9(08) VALUE ZEROS.      01970000
           05  PC-MESSAGES-WRITTEN-TO-FILE  PIC 9(08) VALUE ZEROS.      01980000
           05  PC-MESSAGES-TO-ERROR-QUEUE   PIC 9(08) VALUE ZEROS.      01990000
           05  PC-MESSAGE-000               PIC 9(08) VALUE ZEROS.      02000000
           05  PC-MESSAGE-005               PIC 9(08) VALUE ZEROS.      02010000
           05  PC-MESSAGE-010               PIC 9(08) VALUE ZEROS.      02020000
           05  PC-MESSAGE-015               PIC 9(08) VALUE ZEROS.      02030000
           05  PC-MESSAGE-020               PIC 9(08) VALUE ZEROS.      02040000
           05  PC-MESSAGE-025               PIC 9(08) VALUE ZEROS.      02050000
           05  PC-MESSAGE-030               PIC 9(08) VALUE ZEROS.      02060000
           05  PC-MESSAGE-031               PIC 9(08) VALUE ZEROS.      02070000
           05  PC-MESSAGE-040               PIC 9(08) VALUE ZEROS.      02080000
           05  PC-MESSAGE-041               PIC 9(08) VALUE ZEROS.      02090000
      *    05  PC-MESSAGE-045               PIC 9(08) VALUE ZEROS.      02100000
           05  PC-MESSAGE-050               PIC 9(08) VALUE ZEROS.      02110000
           05  PC-MESSAGE-055               PIC 9(08) VALUE ZEROS.      02120000
           05  PC-MESSAGE-060               PIC 9(08) VALUE ZEROS.      02130000
           05  PC-MESSAGE-070               PIC 9(08) VALUE ZEROS.      02140000
           05  PC-MESSAGE-075               PIC 9(08) VALUE ZEROS.      02150000
           05  PC-MESSAGE-080               PIC 9(08) VALUE ZEROS.      02160000
           05  PC-MESSAGE-085               PIC 9(08) VALUE ZEROS.      02170000
           05  PC-MESSAGE-087               PIC 9(08) VALUE ZEROS.      02180000
           05  PC-MESSAGE-089               PIC 9(08) VALUE ZEROS.      02190000
           05  PC-MESSAGE-095               PIC 9(08) VALUE ZEROS.      02200000
           05  PC-MESSAGE-100               PIC 9(08) VALUE ZEROS.      02210000
           05  PC-MESSAGE-120               PIC 9(08) VALUE ZEROS.      02220000
           05  PC-MESSAGE-996               PIC 9(08) VALUE ZEROS.      02230000
           05  PC-MESSAGE-997               PIC 9(08) VALUE ZEROS.      02231000
           05  PC-MESSAGE-998               PIC 9(08) VALUE ZEROS.      02240000
           05  PC-MESSAGE-UNKNOWN           PIC 9(08) VALUE ZEROS.      02250000
           05  PC-MESSAGE-DISPLAY-CNT       PIC 9(08) VALUE ZEROS.      02260000
CL3132     05  PC-MSG080-CNT                PIC S9(04) COMP.            02263099
CL3132     05  PC-GROUP-CNT                 PIC  9(02) VALUE ZEROS.     02264099
CL3132******************************************************************02270099
CL3132**ERROR HANDLING                                                  02280099
      ******************************************************************02290000
       01  PV-MISC-ABEND-FIELDS.                                        02300000
           05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      02310000
           05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      02320000
           05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      02330000
           05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      02340000
       01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP SYNC. 02350000
           88  ABEND-4001-WRITE-ERROR            VALUE +4001.           02360000
           88  ABEND-4002-READ-ERROR             VALUE +4002.           02370000
           88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           02380000
           88  ABEND-4004-TABLE-ERROR            VALUE +4004.           02390000
           88  ABEND-4005-OPEN-ERROR             VALUE +4005.           02400000
           88  ABEND-4006-CLOSE-ERROR            VALUE +4006.           02410000
           88  ABEND-4007-SEQUENCE-ERROR         VALUE +4007.           02420000
           88  ABEND-4008-DATA-ERROR             VALUE +4008.           02430000
           88  ABEND-4009-KEY-DATA-ERROR         VALUE +4009.           02440000
           88  ABEND-4013-DB2-ERROR              VALUE +4013.           02450000
           88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           02460000
           88  ABEND-4444-FORCED-ABEND           VALUE +4444.           02470000
      ******************************************************************02480000
      ** RETURN CODE HANDLING, WHEN NON ZERO VALUE IS USED              02490000
      ******************************************************************02500000
       01  PV-RETURN-CODE              PIC S9(4) VALUE ZEROS COMP SYNC. 02510000
           88  PV-RETURN-4094-END-PRICES-MSG     VALUE +4094.           02520000
           88  PV-RETURN-4095-END-DAY-MSG        VALUE +4095.           02530000
      ******************************************************************02540000
      **TABLE INCLUSIONS                                                02550000
      ******************************************************************02560000
      ***DB2 COMMUNICATIONS AREA                                        02570000
           EXEC SQL                                                     02580000
                INCLUDE SQLCA                                           02590000
           END-EXEC.                                                    02600000
      ***TABLE XST_SKU                                                  02610000
           EXEC SQL                                                     02620000
                INCLUDE XST00010                                        02630000
           END-EXEC.                                                    02640000
      ***TABLE XST_UPC                                                  02650000
           EXEC SQL                                                     02660000
                INCLUDE XST00012                                        02670000
           END-EXEC.                                                    02680000
      ***TABLE XST_VND_STYL                                             02690000
           EXEC SQL                                                     02700000
                INCLUDE XST00013                                        02710000
           END-EXEC.                                                    02720000
      ***TABLE XST_SKU_ATTR                                             02730000
           EXEC SQL                                                     02740000
                INCLUDE XST00011                                        02750000
           END-EXEC.                                                    02760000
      ***TABLE XST_SKU_LOC                                              02770000
           EXEC SQL                                                     02780000
                INCLUDE XST00008                                        02790000
           END-EXEC.                                                    02800000
      ***TABLE XST_SKU_LOC_ATTR                                         02810000
           EXEC SQL                                                     02820000
                INCLUDE XST00025                                        02830000
           END-EXEC.                                                    02840000
      ******************************************************************02850000
      **LINKAGE VARIABLES                                               02860000
      ******************************************************************02870000
       01  LV-LINKAGE-VARIABLES.                                        02880000
           05  LV-RETURN-CODE               PIC S9(04) VALUE ZEROS.     02890000
           05  LV-ACTION-IND                PIC  9(02) VALUE ZEROS.     02900000
           05  LV-CURRENT-TIMESTAMP         PIC  X(26) VALUE SPACES.    02910000
           05  LV-IMRD008-RECORD            PIC X(450) VALUE SPACES.    02920000
                                                                        02930000
       PROCEDURE DIVISION.                                              02940000
      ***************************************************************** 02950000
                                                                        02960000
           PERFORM 1000-INITIALIZATION.                                 02970000
           PERFORM 2000-PROCESS-RECORDS                                 02980000
                   UNTIL PS-PROCESS-COMPLETE.                           02990000
           PERFORM 9999-WRAPUP.                                         03000000
           GOBACK.                                                      03010000
                                                                        03020000
       EJECT.                                                           03030000
      ******************************************************************03040000
      **INITIALIZATION AREA - SETUP QUEUES FOR PROCESSING               03050000
      ******************************************************************03060000
       1000-INITIALIZATION.                                             03070000
                                                                        03080000
           MOVE '1000-INITIALIZATION' TO PV-PARAGRAPH-NAME.             03090000
                                                                        03100000
           OPEN INPUT  CONTROL-CARD-1                                   03110000
                       CONTROL-CARD-2                                   03120000
                       CONTROL-CARD-3                                   03130000
                OUTPUT MESSAGE-LOG.                                     03140000
                                                                        03150000
           PERFORM 9999-READ-CONTROL-CARD-1.                            03160000
           PERFORM 9999-READ-CONTROL-CARD-2.                            03170000
           PERFORM 9999-READ-CONTROL-CARD-3.                            03180000
                                                                        03190000
           IF  CC-QUEUE-MANAGER-NAME    =  SPACES                       03200000
            OR CC-ITEM-QUEUE-NAME       =  SPACES                       03210000
            OR CC-ITEM-ERROR-QUEUE-NAME =  SPACES                       03220000
               DISPLAY 'EMPTY CONTROL CARD'                             03230000
               DISPLAY 'QUEUE MANAGER NAME    ' CC-QUEUE-MANAGER-NAME   03240000
               DISPLAY 'ITEM QUEUE NAME       ' CC-ITEM-QUEUE-NAME      03250000
               DISPLAY 'ITEM ERROR QUEUE NAME ' CC-ITEM-ERROR-QUEUE-NAME03260000
               PERFORM 9999-MQ-ABEND                                    03270000
           END-IF.                                                      03280000
                                                                        03290000
CL3132     INITIALIZE  PC-MSG080-CNT                                    03291099
CL3132                 PC-GROUP-CNT                                     03292099
CL3132                 PV-MSG080-RECORD.                                03293099
CL3132                                                                  03295099
CL3132     PERFORM 1100-CONNECT-TO-QMGR.                                03300099
           PERFORM 1200-OPEN-ITEM-QUEUE.                                03310000
           PERFORM 1300-OPEN-ITEM-ERROR-QUEUE.                          03320000
                                                                        03330000
           PERFORM 9999-RETRIEVE-MESSAGE.                               03340000
                                                                        03350000
       EJECT.                                                           03360000
      ******************************************************************03370000
      **CONNECT TO THE QUEUE MANAGER                                    03380000
      ******************************************************************03390000
       1100-CONNECT-TO-QMGR.                                            03400000
                                                                        03410000
           MOVE '1100-CONNECT-TO-QMGR'       TO PV-PARAGRAPH-NAME.      03420000
                                                                        03430000
           CALL MQV-MQCONN USING CC-QUEUE-MANAGER-NAME                  03440000
                                 MQV-HCONN                              03450000
                                 MQV-COMPLETION-CODE                    03460000
                                 MQV-REASON.                            03470000
                                                                        03480000
           EVALUATE TRUE                                                03490000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        03500000
                   DISPLAY 'SUCCESSFULLY CONNECTED TO: '                03510000
                                                  CC-QUEUE-MANAGER-NAME 03520000
              WHEN OTHER                                                03530000
                   CALL MQV-MQCHECK USING MQV-REASON                    03540000
                                          MQV-REASON-TEXT               03550000
                   DISPLAY 'UNABLE TO CONNECT TO ' CC-QUEUE-MANAGER-NAME03560000
                   MOVE 'UNABLE TO CONNECT'  TO PV-OPERATION-MSG-1      03570000
                   PERFORM 9999-MQ-ABEND                                03580000
           END-EVALUATE.                                                03590000
                                                                        03600000
       EJECT.                                                           03610000
      ******************************************************************03620000
      **OPEN THE ITEM QUEUE                                             03630000
      ******************************************************************03640000
       1200-OPEN-ITEM-QUEUE.                                            03650000
                                                                        03660000
           MOVE '1200-OPEN-ITEM-QUEUE' TO PV-PARAGRAPH-NAME.            03670000
                                                                        03680000
           MOVE CC-ITEM-QUEUE-NAME       TO MQOD-OBJECTNAME             03690000
           MOVE CC-QUEUE-MANAGER-NAME    TO MQOD-OBJECTQMGRNAME.        03700000
                                                                        03710000
           COMPUTE MQV-OPEN-OPTIONS      = MQOO-INPUT-SHARED            03720000
                                         + MQOO-OUTPUT                  03730000
                                         + MQOO-SET-IDENTITY-CONTEXT    03740000
                                         + MQOO-FAIL-IF-QUIESCING.      03750000
                                                                        03760000
           CALL MQV-MQOPEN USING MQV-HCONN                              03770000
                                 MQM-OBJECT-DESCRIPTOR                  03780000
                                 MQV-OPEN-OPTIONS                       03790000
                                 MQV-ITEM-HANDLE                        03800000
                                 MQV-COMPLETION-CODE                    03810000
                                 MQV-REASON.                            03820000
                                                                        03830000
           EVALUATE TRUE                                                03840000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        03850000
                   DISPLAY 'SUCCESSFULLY OPENED QUEUE: '                03860000
                                                      CC-ITEM-QUEUE-NAME03870000
              WHEN OTHER                                                03880000
                   CALL MQV-MQCHECK USING MQV-REASON                    03890000
                                         MQV-REASON-TEXT                03900000
                   DISPLAY 'CANNOT OPEN QUEUE ' CC-QUEUE-MANAGER-NAME   03910000
                   MOVE 'CANNOT OPEN QUEUE'  TO PV-OPERATION-MSG-1      03920000
                   PERFORM 9999-DISCONNECT-QMGR                         03930000
                   PERFORM 9999-MQ-ABEND                                03940000
           END-EVALUATE.                                                03950000
                                                                        03960000
       EJECT.                                                           03970000
      ******************************************************************03980000
      **OPEN THE ITEM ERROR QUEUE                                       03990000
      ******************************************************************04000000
       1300-OPEN-ITEM-ERROR-QUEUE.                                      04010000
                                                                        04020000
           MOVE '1300-OPEN-ITEM-ERROR-QUEUE' TO PV-PARAGRAPH-NAME.      04030000
                                                                        04040000
           MOVE CC-ITEM-ERROR-QUEUE-NAME     TO MQOD-OBJECTNAME         04050000
           MOVE CC-QUEUE-MANAGER-NAME        TO MQOD-OBJECTQMGRNAME.    04060000
                                                                        04070000
           COMPUTE MQV-OPEN-OPTIONS      = MQOO-INPUT-SHARED            04080000
                                         + MQOO-OUTPUT                  04090000
                                         + MQOO-SET-IDENTITY-CONTEXT    04100000
                                         + MQOO-FAIL-IF-QUIESCING.      04110000
                                                                        04120000
           CALL MQV-MQOPEN USING MQV-HCONN                              04130000
                                 MQM-OBJECT-DESCRIPTOR                  04140000
                                 MQV-OPEN-OPTIONS                       04150000
                                 MQV-ERROR-HANDLE                       04160000
                                 MQV-COMPLETION-CODE                    04170000
                                 MQV-REASON.                            04180000
                                                                        04190000
           EVALUATE TRUE                                                04200000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        04210000
                   DISPLAY 'SUCCESSFULLY OPENED QUEUE: '                04220000
                                                CC-ITEM-ERROR-QUEUE-NAME04230000
              WHEN OTHER                                                04240000
                   CALL MQV-MQCHECK USING MQV-REASON                    04250000
                                          MQV-REASON-TEXT               04260000
                   MOVE 'CANNOT OPEN QUEUE'  TO PV-OPERATION-MSG-1      04270000
                   PERFORM 9999-DISCONNECT-QMGR                         04280000
                   PERFORM 9999-MQ-ABEND                                04290000
           END-EVALUATE.                                                04300000
                                                                        04310000
       EJECT.                                                           04320000
      ******************************************************************04330000
      **READ ITEM MESSAGE AND BASED ON BUSINESS EVENT CALL PROGRAM      04340000
      **     TO EXECUTE BUSINESS LOGIC.                                 04350000
      ******************************************************************04360000
       2000-PROCESS-RECORDS.                                            04370000
                                                                        04380000
           MOVE '2000-PROCESS-RECORDS'         TO PV-PARAGRAPH-NAME.    04390000
                                                                        04400000
      *INITIALIZE VARIABLES FOR EACH MESSAGE RETRIEVED                  04410000
           INITIALIZE MESSAGE-LOG-RECORD.                               04420000
           INITIALIZE LV-LINKAGE-VARIABLES.                             04430000
           INITIALIZE DCLXST00010.                                      04440000
           INITIALIZE DCLXST00012.                                      04450000
           INITIALIZE DCLXST00013.                                      04460000
           MOVE IM008-BUSINESS-EVENT-ID TO PV-XS-MESSAGES.              04470000
REMOVE*    DISPLAY '**************************************'.            04480000
                                                                        04490000
           EVALUATE TRUE                                                04500099
                                                                        04510099
      **005 - STYLE ADD                                                 04520099
              WHEN IM008-BUS-EVENT-STYLE-ADD                            04530099
                   ADD +1                      TO PC-MESSAGE-005        04540099
                   SET PC-CALLED-XSKUP005      TO TRUE                  04550000
                   PERFORM 2100-CALL-PROGRAM                            04560000
REMOVE             DISPLAY 'XSKUP005 - STYLE ID = '                     04570000
REMOVE                     IM008-ITEM-KEY-RMS-STYL-ID ' SQLCODE '       04580000
REMOVE                     PV-DISPLAY-SQLCODE                           04590000
                                                                        04600000
      **010 - STYLE RECLASS                                             04610000
              WHEN IM008-BUS-EVENT-STYLE-RECLASS                        04620000
                   ADD +1                      TO PC-MESSAGE-010        04630000
                   SET PC-CALLED-XSKUP006      TO TRUE                  04640000
                   PERFORM 2100-CALL-PROGRAM                            04650000
REMOVE             DISPLAY 'XSKUP006 - STYLE ID = '                     04660000
REMOVE                      IM008-ITEM-KEY-RMS-STYL-ID ' SQLCODE '      04670000
REMOVE                      PV-DISPLAY-SQLCODE                          04680000
                                                                        04690000
      **015 - STYLE ATTRIBUTES UPDATE                                   04700000
              WHEN IM008-BUS-EVENT-STYLE-ATTR-CHG                       04710000
                   ADD +1                      TO PC-MESSAGE-015        04720000
                   SET PC-CALLED-XSKUP021      TO TRUE                  04730000
                   PERFORM 2100-CALL-PROGRAM                            04740000
REMOVE             DISPLAY 'XSKUP021 - STYLE ID = '                     04750000
REMOVE                      IM008-ITEM-KEY-RMS-STYL-ID ' SQLCODE '      04760000
REMOVE                      PV-DISPLAY-SQLCODE                          04770000
                                                                        04780000
      **020 - STYLE ATTRIBUTES UPDATE                                   04790000
              WHEN IM008-BUS-EVENT-SUPPLIER-CHG                         04800000
                   ADD +1                      TO PC-MESSAGE-020        04810000
                   SET PC-CALLED-XSKUP022      TO TRUE                  04820000
                   PERFORM 2100-CALL-PROGRAM                            04830000
REMOVE             DISPLAY 'XSKUP022 - STYLE ID = '                     04840000
REMOVE                      IM008-ITEM-KEY-RMS-STYL-ID ' SQLCODE '      04850000
REMOVE                      PV-DISPLAY-SQLCODE                          04860000
                                                                        04870000
      **025 - STYLE VENDOR PRODUCT NUMBER CHANGE                        04880000
              WHEN IM008-BUS-EVENT-VPN-CHG                              04890000
                   ADD +1                      TO PC-MESSAGE-025        04900000
                   SET PC-CALLED-XSKUP023      TO TRUE                  04910000
                   PERFORM 2100-CALL-PROGRAM                            04920000
REMOVE             DISPLAY 'XSKUP023 - STYLE ID = '                     04930000
REMOVE                      IM008-ITEM-KEY-RMS-STYL-ID ' SQLCODE '      04940000
REMOVE                      PV-DISPLAY-SQLCODE                          04950000
                                                                        04960000
      **030 - STYLE DELETE                                              04970000
              WHEN IM008-BUS-EVENT-STYLE-DELETE                         04980000
                   ADD +1                      TO PC-MESSAGE-030        04990000
                   SET PC-CALLED-XSKUP007      TO TRUE                  05000000
                   PERFORM 2100-CALL-PROGRAM                            05010000
REMOVE             DISPLAY 'XSKUP007 - STYLE ID = '                     05020000
REMOVE                      IM008-ITEM-KEY-RMS-STYL-ID ' SQLCODE '      05030000
REMOVE                      PV-DISPLAY-SQLCODE                          05040000
                                                                        05050000
010103**031 - SKU DELETE                                                05060000
              WHEN IM008-BUS-EVENT-STYLE-SKU-DEL                        05070000
                   ADD +1                      TO PC-MESSAGE-031        05080000
                   SET PC-CALLED-XSKUP008      TO TRUE                  05090000
                   PERFORM 2100-CALL-PROGRAM                            05100000
REMOVE             DISPLAY 'XSKUP008 - INTRNL UPC ID = '                05110000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05120000
REMOVE                      PV-DISPLAY-SQLCODE                          05130000
                                                                        05140000
      **040 - SKU ADD                                                   05150000
              WHEN IM008-BUS-EVENT-SKU-ADD                              05160000
                   ADD +1                      TO PC-MESSAGE-040        05170000
                   SET PC-CALLED-XSKUP011      TO TRUE                  05180000
                   PERFORM 2100-CALL-PROGRAM                            05190000
REMOVE             DISPLAY 'XSKUP011 - INTRNL UPC ID = '                05200000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05210000
REMOVE                      PV-DISPLAY-SQLCODE                          05220000
                                                                        05230000
      **041 - SKU ADD2 - OTHER ATTRIBUTES                               05240000
              WHEN IM008-BUS-EVENT-SKU-ADD2                             05250000
                   ADD +1                      TO PC-MESSAGE-041        05260000
                   SET PC-CALLED-XSKUP046      TO TRUE                  05270000
                   PERFORM 2100-CALL-PROGRAM                            05280000
REMOVE             DISPLAY 'XSKUP046 - INTRNL UPC ID = '                05290000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05300000
REMOVE                      PV-DISPLAY-SQLCODE                          05310000
                                                                        05320000
JLSJLS**045 - SKU RECLASS                                               05330000
      *       WHEN IM008-BUS-EVENT-SKU-RECL-RENUM                       05340000
      *            ADD +1                      TO PC-MESSAGE-045        05350000
      *            SET PC-CALLED-XSKUP009      TO TRUE                  05360000
      *            PERFORM 2100-CALL-PROGRAM                            05370000
REMOVE*            DISPLAY 'XSKUP009 - INTRNL UPC ID = '                05380000
REMOVE*                     IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05390000
REMOVE*                     PV-DISPLAY-SQLCODE                          05400000
                                                                        05410000
      **050 - SKU COLOR/SIZE CHANGE                                     05420000
              WHEN IM008-BUS-EVENT-SKU-CLR-SZ-CHG                       05430000
                   ADD +1                      TO PC-MESSAGE-050        05440000
                   SET PC-CALLED-XSKUP012      TO TRUE                  05450000
                   PERFORM 2100-CALL-PROGRAM                            05460000
REMOVE             DISPLAY 'XSKUP012 - INTRNL UPC ID = '                05470000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05480000
REMOVE                      PV-DISPLAY-SQLCODE                          05490000
                                                                        05500000
      **055 - SKU ATTRIBUTES CHANGE                                     05510000
              WHEN IM008-BUS-EVENT-SKU-ATTR-CHG                         05520000
                   ADD +1                      TO PC-MESSAGE-055        05530000
                   SET PC-CALLED-XSKUP013      TO TRUE                  05540000
                   PERFORM 2100-CALL-PROGRAM                            05550000
REMOVE             DISPLAY 'XSKUP013 - INTRNL UPC ID = '                05560000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05570000
REMOVE                      PV-DISPLAY-SQLCODE                          05580000
                                                                        05590000
      **060 - SKU PACKAGING ATTRIBUTES CHANGE                           05600000
              WHEN IM008-BUS-EVENT-SKU-PKG-CHG                          05610000
                   ADD +1                      TO PC-MESSAGE-060        05620000
                   SET PC-CALLED-XSKUP014      TO TRUE                  05630000
                   PERFORM 2100-CALL-PROGRAM                            05640000
REMOVE             DISPLAY 'XSKUP014 - INTRNL UPC ID = '                05650000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05660000
REMOVE                      PV-DISPLAY-SQLCODE                          05670000
                                                                        05680000
      **070 - SKU LANDED COST CHANGE                                    05690000
              WHEN IM008-BUS-EVENT-SKU-COST-CHG                         05700000
                   ADD +1                      TO PC-MESSAGE-070        05710000
                   SET PC-CALLED-XSKUP064      TO TRUE                  05720000
                   PERFORM 2100-CALL-PROGRAM                            05730000
REMOVE*            DISPLAY 'XSKUP064 - INTRNL UPC ID = '                05740000
REMOVE*                     IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05750000
REMOVE*                     PV-DISPLAY-SQLCODE                          05760000
                                                                        05770000
      **075 - SKU RETAIL OR STATUS CHANGE (CORPORATE)                   05780000
              WHEN IM008-BUS-EVENT-RTL-STATUS-CHG                       05790000
                   ADD +1                      TO PC-MESSAGE-075        05800000
                   SET PC-CALLED-XSKUP048      TO TRUE                  05810000
                   PERFORM 2100-CALL-PROGRAM                            05820000
REMOVE*            DISPLAY 'XSKUP048 - INTRNL UPC ID = '                05830000
REMOVE*                     IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05840000
REMOVE*                     PV-DISPLAY-SQLCODE                          05850000
                                                                        05860000
      **080 - SKU STORE RETAIL OR STATUS CHANGE                         05870000
              WHEN IM008-BUS-EVENT-STR-RTL-ST-CHG                       05880000
                                                                        05880100
                   ADD +1                      TO PC-MESSAGE-080        05881000
CL3132                                            PC-MSG080-CNT         05882099
CL3132             EVALUATE PC-MSG080-CNT                               05891099
CL3132                WHEN +1                                           05892099
CL3132                   MOVE IMRD008-RECORD TO PV-MSG080-REC1          05893099
CL3132                WHEN +2                                           05894099
CL3132                   MOVE IMRD008-RECORD TO PV-MSG080-REC2          05895099
CL3132                WHEN +3                                           05896099
CL3132                   MOVE IMRD008-RECORD TO PV-MSG080-REC3          05897099
CL3132                   MOVE PC-MSG080-CNT  TO PC-GROUP-CNT            05898099
CL3132                   MOVE +0             TO PC-MSG080-CNT           05899099
CL3132                   SET PC-CALLED-XSKUP049      TO TRUE            05899199
CL3132                   PERFORM 2110-CALL-XSKUP049                     05899299
CL3132                   MOVE +0             TO PC-GROUP-CNT            05899399
CL3132                WHEN OTHER                                        05899499
CL3132                   DISPLAY 'ERROR IN GROUPING MSG080 MESSAGE'     05899599
CL3132             END-EVALUATE                                         05899699
                                                                        05899700
REMOVE*            DISPLAY 'XSKUP049 - INTRNL UPC ID = '                05920000
REMOVE*                     IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      05930000
REMOVE*                     PV-DISPLAY-SQLCODE                          05940000
                                                                        05950000
      **085 - WEB ITEM ADD                                              05960000
              WHEN IM008-BUS-EVENT-WEB-ITEM-ADD                         05970000
                   ADD +1                      TO PC-MESSAGE-085        05980000
                   SET PC-CALLED-XSKUP015      TO TRUE                  05990000
                   PERFORM 2100-CALL-PROGRAM                            06000000
REMOVE             DISPLAY 'XSKUP015 - INTRNL UPC ID = '                06010000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      06020000
REMOVE                      PV-DISPLAY-SQLCODE                          06030000
                                                                        06040000
      **087 - WEB ATTRIBUTES CHANGE                                     06050000
              WHEN IM008-BUS-EVENT-WEB-ATTR-CHG                         06060000
                   ADD +1                      TO PC-MESSAGE-087        06070000
                   SET PC-CALLED-XSKUP024      TO TRUE                  06080000
                   PERFORM 2100-CALL-PROGRAM                            06090000
REMOVE             DISPLAY 'XSKUP024 - INTRNL UPC ID = '                06100000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      06110000
REMOVE                      PV-DISPLAY-SQLCODE                          06120000
                                                                        06130000
      **089 - WEB ITEM DELETE                                           06140000
              WHEN IM008-BUS-EVENT-WEB-ITEM-DEL                         06150000
                   ADD +1                      TO PC-MESSAGE-089        06160000
                   SET PC-CALLED-XSKUP016      TO TRUE                  06170000
                   PERFORM 2100-CALL-PROGRAM                            06180000
REMOVE             DISPLAY 'XSKUP016 - INTRNL UPC ID = '                06190000
REMOVE                      IM008-ITEM-KEY-INTR-UPC-ID ' SQLCODE '      06200000
REMOVE                      PV-DISPLAY-SQLCODE                          06210000
                                                                        06220000
      **095 - VENDOR UPC ADD                                            06230000
              WHEN IM008-BUS-EVENT-UPC-ADD                              06240000
                   ADD +1                      TO PC-MESSAGE-095        06250000
                   SET PC-CALLED-XSKUP010      TO TRUE                  06260000
                   PERFORM 2100-CALL-PROGRAM                            06270000
REMOVE             DISPLAY 'XSKUP010 - UPC ID = '                       06280000
REMOVE                      IM008-ITEM-KEY-UPC-ID ' SQLCODE '           06290000
REMOVE                      PV-DISPLAY-SQLCODE                          06300000
                                                                        06310000
      **100 - VENDOR UPC MOVE                                           06320000
              WHEN IM008-BUS-EVENT-UPC-MOVE                             06330000
                   ADD +1                      TO PC-MESSAGE-100        06340000
                   SET PC-CALLED-XSKUP019      TO TRUE                  06350000
                   PERFORM 2100-CALL-PROGRAM                            06360000
REMOVE             DISPLAY 'XSKUP019 - UPC ID = '                       06370000
REMOVE                      IM008-ITEM-KEY-UPC-ID ' SQLCODE '           06380000
REMOVE                      PV-DISPLAY-SQLCODE                          06390000
                                                                        06400000
      **120 - UPC DELETE                                                06410000
              WHEN IM008-BUS-EVENT-UPC-DELETE                           06420000
                   ADD +1                      TO PC-MESSAGE-120        06430000
                   SET PC-CALLED-XSKUP020      TO TRUE                  06440000
                   PERFORM 2100-CALL-PROGRAM                            06450000
REMOVE             DISPLAY 'XSKUP020 - UPC ID = '                       06460000
REMOVE                      IM008-ITEM-KEY-UPC-ID ' SQLCODE '           06470000
REMOVE                      PV-DISPLAY-SQLCODE                          06480000
                                                                        06490000
      **996 - END OF SKU LOC HIGH VOLUME MESSAGES - FORCED OR NORMAL    06500000
              WHEN IM008-CC-SKU-LOC-END-OF-DAY                          06510000
      *PS-PROCESS-COMPLETE INDICATOR IS SET WHEN THE MESSAGE IS         06520000
      *   RETRIEVED BECAUSE FOR THE PROGRAM TO END ALL MESSAGES MUST BE 06530000
      *   READ FROM QUEUE AND AN END PROCESS BUS EVENT MUST BE RECVD.   06540000
      *   THIS MESSAGE MEANS THE BATCH OF PRICE CHANGES IS DONE.  THE   06550000
      *   PROGRAM ENDS IN THIS CASE, SO THE EP PLU EXTRACT PROCESS WILL 06560000
      *   KNOW THAT IT CAN START.                                       06570000
      *   USED ONLY WHEN VOLUMES WARRANT USE OF 6-UP CONCURRENT MESSAGE 06571000
      *   PROCESSING.                                                   06572000
CL3132*                                                                 06572199
CL3132**080 - SKU LOC LEFT OVER MESSAGES                                06572299
CL3132*                                                                 06572399
CL3132             IF PC-MSG080-CNT > 0                                 06572499
CL3132                MOVE PC-MSG080-CNT          TO PC-GROUP-CNT       06572599
CL3132                SET PC-CALLED-XSKUP049      TO TRUE               06572699
CL3132                                                                  06572799
CL3132                 IF PC-MSG080-CNT = +1                            06572899
CL3132                   INITIALIZE PV-MSG080-REC2                      06572999
CL3132                   INITIALIZE PV-MSG080-REC3                      06573099
CL3132                   PERFORM 2110-CALL-XSKUP049                     06573199
CL3132                   MOVE +0             TO PC-GROUP-CNT            06573399
CL3132                   MOVE +0             TO PC-MSG080-CNT           06573499
CL3132                 END-IF                                           06573599
CL3132                                                                  06573699
CL3132                 IF PC-MSG080-CNT = +2                            06573799
CL3132                       INITIALIZE PV-MSG080-REC3                  06573899
CL3132                       PERFORM 2110-CALL-XSKUP049                 06573999
CL3132                   MOVE +0             TO PC-GROUP-CNT            06574099
CL3132                   MOVE +0             TO PC-MSG080-CNT           06574199
CL3132                 END-IF                                           06574299
CL3132                                                                  06574399
CL3132             END-IF                                               06575099
                   ADD +1                      TO PC-MESSAGE-996        06581099
                   SET PS-PROCESS-COMPLETE     TO TRUE                  06590099
                   PERFORM 2400-BACKUP-MESSAGE                          06600099
                                                                        06610099
      *            * SETS RETURN CODE TO 4094 TO SIGNAL WHAT CAUSED *   06620000
      *            * THE PROGRAM TO END.                            *   06630000
                   SET PV-RETURN-4094-END-PRICES-MSG TO TRUE            06640000
                                                                        06650000
      **997 - END OF PRICE CHANGE BATCH - FORCED OR NORMAL              06651000
              WHEN IM008-PERM-UPDATES-END-OF-DAY                        06652000
      *PS-PROCESS-COMPLETE INDICATOR IS SET WHEN THE MESSAGE IS         06653000
      *   RETRIEVED BECAUSE FOR THE PROGRAM TO END ALL MESSAGES MUST BE 06654000
      *   READ FROM QUEUE AND AN END PROCESS BUS EVENT MUST BE RECVD.   06655000
      *   THIS MESSAGE MEANS THE BATCH OF PRICE CHANGES IS DONE.  THE   06656000
      *   PROGRAM ENDS IN THIS CASE, SO THE EP PLU EXTRACT PROCESS WILL 06657000
      *   KNOW THAT IT CAN START.                                       06658000
CL3132**080 - SKU LOC LEFT OVER MESSAGES                                06658199
CL3132*                                                                 06658299
CL3132             IF PC-MSG080-CNT > 0                                 06658399
CL3132                MOVE PC-MSG080-CNT          TO PC-GROUP-CNT       06658499
CL3132                SET PC-CALLED-XSKUP049      TO TRUE               06658599
CL3132                                                                  06658699
CL3132                 IF PC-MSG080-CNT = +1                            06658799
CL3132                   INITIALIZE PV-MSG080-REC2                      06658899
CL3132                   INITIALIZE PV-MSG080-REC3                      06658999
CL3132                   PERFORM 2110-CALL-XSKUP049                     06659099
CL3132                   MOVE +0             TO PC-GROUP-CNT            06659199
CL3132                   MOVE +0             TO PC-MSG080-CNT           06659299
CL3132                 END-IF                                           06659399
CL3132                                                                  06659499
CL3132                 IF PC-MSG080-CNT = +2                            06659599
CL3132                       INITIALIZE PV-MSG080-REC3                  06659699
CL3132                       PERFORM 2110-CALL-XSKUP049                 06659799
CL3132                   MOVE +0             TO PC-GROUP-CNT            06659899
CL3132                   MOVE +0             TO PC-MSG080-CNT           06659999
CL3132                 END-IF                                           06660099
CL3132                                                                  06660199
CL3132             END-IF                                               06660299
                   ADD +1                      TO PC-MESSAGE-997        06660300
                   SET PS-PROCESS-COMPLETE     TO TRUE                  06660400
                   PERFORM 2400-BACKUP-MESSAGE                          06660500
                                                                        06660600
      *            * SETS RETURN CODE TO 4094 TO SIGNAL WHAT CAUSED *   06660700
      *            * THE PROGRAM TO END.                            *   06660800
                   SET PV-RETURN-4094-END-PRICES-MSG TO TRUE            06660900
                                                                        06661000
      **998 - END OF DAY  - FORCED OR NORMAL                            06662000
              WHEN IM008-ITM-DOMAIN-END-OF-DAY                          06670000
      *PS-PROCESS-COMPLETE INDICATOR IS SET WHEN THE MESSAGE IS         06680000
      *   RETRIEVED BECAUSE FOR THE PROGRAM TO END ALL MESSAGES MUST BE 06690000
      *   READ FROM QUEUE AND AN END PROCESS BUS EVENT MUST BE RECVD.   06700000
      *   THIS MESSAGE MEANS THE SOR END OF DAY HAS OCCURED AND EXTRACT 06710000
      *   FILES HAVE BEEN CREATED.  THE PROCESS ENDS SO THAT INTEGRITY  06720000
      *   CHECK PROCESSES CAN START.                                    06730000
CL3132**080 - SKU LOC LEFT OVER MESSAGES                                06731099
CL3132*                                                                 06732099
CL3132             IF PC-MSG080-CNT > 0                                 06733099
CL3132                MOVE PC-MSG080-CNT          TO PC-GROUP-CNT       06734099
CL3132                SET PC-CALLED-XSKUP049      TO TRUE               06735099
CL3132                                                                  06736099
CL3132                 IF PC-MSG080-CNT = +1                            06737099
CL3132                   INITIALIZE PV-MSG080-REC2                      06738099
CL3132                   INITIALIZE PV-MSG080-REC3                      06739099
CL3132                   PERFORM 2110-CALL-XSKUP049                     06739199
CL3132                   MOVE +0             TO PC-GROUP-CNT            06739299
CL3132                   MOVE +0             TO PC-MSG080-CNT           06739399
CL3132                 END-IF                                           06739499
CL3132                                                                  06739599
CL3132                 IF PC-MSG080-CNT = +2                            06739699
CL3132                       INITIALIZE PV-MSG080-REC3                  06739799
CL3132                       PERFORM 2110-CALL-XSKUP049                 06739899
CL3132                   MOVE +0             TO PC-GROUP-CNT            06739999
CL3132                   MOVE +0             TO PC-MSG080-CNT           06740099
CL3132                 END-IF                                           06740199
CL3132                                                                  06740299
CL3132             END-IF                                               06740399
                   ADD +1                      TO PC-MESSAGE-998        06741000
                   SET PS-PROCESS-COMPLETE     TO TRUE                  06750000
011403             PERFORM 2400-BACKUP-MESSAGE                          06760000
                                                                        06770000
      *            * SETS RETURN CODE TO 4095 TO SIGNAL WHAT CAUSED *   06780000
      *            * THE PROGRAM TO END.                            *   06790000
                   SET PV-RETURN-4095-END-DAY-MSG TO TRUE               06800000
                                                                        06810000
      **000 - FORCED END TO PROCESS BY OPERATIONS                       06820000
              WHEN PV-XS-MSGS-END-OF-PROGRAM                            06830000
      *PS-PROCESS-COMPLETE INDICATOR IS SET WHEN THE MESSAGE IS         06840000
      *   RETRIEVED BECAUSE FOR THE PROGRAM TO END ALL MESSAGES MUST BE 06850000
      *   READ FROM QUEUE AND AN END PROCESS BUS EVENT MUST BE RECVD.   06860000
      *   THIS MESSAGE DOES NOT COME FROM THE SOR!                      06870000
      *   IT IS ONLY USED WHEN THERE IS AN OPERATIONAL NEED TO END THE  06880000
      *   STARTED TASK.                                                 06890000
CL3132**080 - SKU LOC LEFT OVER MESSAGES                                06891099
CL3132*                                                                 06892099
CL3132             IF PC-MSG080-CNT > 0                                 06893099
CL3132                MOVE PC-MSG080-CNT          TO PC-GROUP-CNT       06894099
CL3132                SET PC-CALLED-XSKUP049      TO TRUE               06895099
CL3132                                                                  06896099
CL3132                 IF PC-MSG080-CNT = +1                            06897099
CL3132                   INITIALIZE PV-MSG080-REC2                      06898099
CL3132                   INITIALIZE PV-MSG080-REC3                      06899099
CL3132                   PERFORM 2110-CALL-XSKUP049                     06899199
CL3132                   MOVE +0             TO PC-GROUP-CNT            06899299
CL3132                   MOVE +0             TO PC-MSG080-CNT           06899399
CL3132                 END-IF                                           06899499
CL3132                                                                  06899599
CL3132                 IF PC-MSG080-CNT = +2                            06899699
CL3132                       INITIALIZE PV-MSG080-REC3                  06899799
CL3132                       PERFORM 2110-CALL-XSKUP049                 06899899
CL3132                   MOVE +0             TO PC-GROUP-CNT            06899999
CL3132                   MOVE +0             TO PC-MSG080-CNT           06900099
CL3132                 END-IF                                           06900199
CL3132                                                                  06900299
CL3132             END-IF                                               06900399
                   ADD +1                      TO PC-MESSAGE-000        06901000
                   SET PS-PROCESS-COMPLETE     TO TRUE                  06910000
011403             PERFORM 2400-BACKUP-MESSAGE                          06920000
                                                                        06930000
      **    - OTHER                                                     06940000
              WHEN OTHER                                                06950000
      *            * MESSAGE IS UNEXPECTED AND CANNOT BE PROCESSED. *   06960000
      *            * IT IS MOVED TO THE ERROR QUEUE.                *   06970000
                   DISPLAY 'UNPROCESSED EVENT ID - '                    06980000
                            IM008-BUSINESS-EVENT-ID                     06990000
                   ADD +1                      TO PC-MESSAGE-UNKNOWN    07000000
                   PERFORM 2500-PUT-ON-ERROR-QUEUE                      07010000
                   PERFORM 2300-COMMIT-MESSAGE                          07020000
                                                                        07030000
           END-EVALUATE.                                                07040000
                                                                        07050000
           IF  PS-PROCESS-CONTINUE                                      07060000
      *        ** DISPLAY INTERIM COUNTS EVERY 10,000 MESSAGES *        07070000
               IF PC-MESSAGE-DISPLAY-CNT = 10000                        07080000
                   PERFORM 9999-DISPLAY-STATISTICS                      07090000
                   MOVE ZERO TO PC-MESSAGE-DISPLAY-CNT                  07100000
               END-IF                                                   07110000
                                                                        07120000
               PERFORM 9999-RETRIEVE-MESSAGE                            07130000
           END-IF.                                                      07140000
                                                                        07150000
       EJECT.                                                           07160000
      ******************************************************************07170000
      **CALL PROGRAM TO EXECUTE MESSAGE                                 07180000
      ******************************************************************07190000
       2100-CALL-PROGRAM.                                               07200000
                                                                        07210000
           MOVE '2100-CALL-PROGRAM' TO PV-PARAGRAPH-NAME.               07220000
                                                                        07230000
           PERFORM 2150-SELECT-TIMESTAMP.                               07240000
                                                                        07250000
           MOVE IMRD008-RECORD      TO LV-IMRD008-RECORD.               07260000
                                                                        07270000
           CALL PC-CALLED-PROGRAM USING LV-IMRD008-RECORD               07280000
                                        LV-RETURN-CODE                  07290000
                                        LV-ACTION-IND                   07300000
                                        LV-CURRENT-TIMESTAMP.           07310000
                                                                        07320000
REMOVE     MOVE LV-RETURN-CODE      TO PV-DISPLAY-SQLCODE.              07330000
                                                                        07340000
           EVALUATE TRUE                                                07350000
              WHEN LV-RETURN-CODE EQUAL ZEROS                           07360000
                                                                        07370000
                   MOVE LV-ACTION-IND TO PS-ACTION-IND                  07380000
                   EVALUATE TRUE                                        07390000
                      WHEN  PS-ACTION-REVERSE                           07400000
                            DISPLAY 'REVERSE ACTION PERFORMED '         07410000
                                     PC-CALLED-PROGRAM                  07420000
                      WHEN  PS-ACTION-NOTHING                           07430000
                            DISPLAY 'NO ACTION PERFORMED '              07440000
                                     PC-CALLED-PROGRAM                  07450000
                   END-EVALUATE                                         07460000
                                                                        07470000
                                                                        07473000
                   PERFORM 2200-COMMIT-DATA                             07480000
                   PERFORM 2300-COMMIT-MESSAGE                          07490000
                   PERFORM 2400-BACKUP-MESSAGE                          07500000
                                                                        07500100
CL3132        WHEN LV-RETURN-CODE NOT EQUAL ZEROS                       07510099
                   MOVE LV-RETURN-CODE TO PV-DISPLAY-SQLCODE            07520000
                   DISPLAY '!!! MESSAGE ID '                            07530000
                           IM008-BUSINESS-EVENT-ID                      07540000
                           ' HAD A NON-ZERO RETURN CODE OF '            07550000
                           PV-DISPLAY-SQLCODE                           07560000
                   PERFORM 2500-PUT-ON-ERROR-QUEUE                      07570000
                   PERFORM 2250-ROLLBACK-DATA                           07580000
                   PERFORM 2300-COMMIT-MESSAGE                          07590000
           END-EVALUATE.                                                07600000
                                                                        07610000
       EJECT.                                                           07620000
CL3132******************************************************************07621099
CL3132**CALL PROGRAM TO EXECUTE MESSAGE                                 07622099
CL3132******************************************************************07623099
CL3132 2110-CALL-XSKUP049.                                              07624099
CL3132                                                                  07625099
CL3132     MOVE '2110-CALL-XSKUP049' TO PV-PARAGRAPH-NAME.              07626099
CL3132                                                                  07627099
CL3132     PERFORM 2150-SELECT-TIMESTAMP.                               07628099
CL3132                                                                  07629299
CL3132     CALL PC-CALLED-PROGRAM USING PV-MSG080-RECORD                07629399
CL3132                                  LV-RETURN-CODE                  07629499
CL3132                                  LV-ACTION-IND                   07629599
CL3132                                  LV-CURRENT-TIMESTAMP            07629699
CL3132                                  PC-GROUP-CNT.                   07629799
CL3132                                                                  07629899
CL3132     MOVE LV-RETURN-CODE      TO PV-DISPLAY-SQLCODE.              07629999
CL3132                                                                  07630099
CL3132     EVALUATE TRUE                                                07630199
CL3132        WHEN LV-RETURN-CODE EQUAL ZEROS                           07630299
CL3132                                                                  07630399
CL3132             MOVE LV-ACTION-IND TO PS-ACTION-IND                  07630499
CL3132             EVALUATE TRUE                                        07630599
CL3132                WHEN  PS-ACTION-REVERSE                           07630699
CL3132                      DISPLAY 'REVERSE ACTION PERFORMED '         07630799
CL3132                               PC-CALLED-PROGRAM                  07630899
CL3132                WHEN  PS-ACTION-NOTHING                           07630999
CL3132                      DISPLAY 'NO ACTION PERFORMED '              07631099
CL3132                               PC-CALLED-PROGRAM                  07631199
CL3132             END-EVALUATE                                         07631299
CL3132                                                                  07631399
CL3132                                                                  07631699
CL3132             PERFORM 2200-COMMIT-DATA                             07631799
CL3132             PERFORM 2300-COMMIT-MESSAGE                          07631899
CL3132             PERFORM 2450-BACKUP-MESSAGE                          07632099
CL3132                                                                  07632199
CL3132        WHEN LV-RETURN-CODE NOT EQUAL ZEROS                       07632399
CL3132        IF PV-MSG080-REC1 NOT EQUAL SPACES                        07632499
CL3132             MOVE LV-RETURN-CODE TO PV-DISPLAY-SQLCODE            07632599
CL3132             MOVE PV-MSG080-REC1 TO IMRD008-RECORD                07632699
CL3132             DISPLAY '!!! MESSAGE ID '                            07632799
CL3132                     IM008-BUSINESS-EVENT-ID                      07632899
CL3132                     '!!! INTR UPC ID '                           07632999
CL3132                     IM008-ITEM-KEY-INTR-UPC-ID                   07633099
CL3132                     ' HAD A NON-ZERO RETURN CODE OF '            07633199
CL3132                     PV-DISPLAY-SQLCODE                           07633299
CL3132             PERFORM 2500-PUT-ON-ERROR-QUEUE                      07633599
CL3132        END-IF                                                    07633699
CL3132        IF PV-MSG080-REC2 NOT EQUAL SPACES                        07633799
CL3132             MOVE LV-RETURN-CODE TO PV-DISPLAY-SQLCODE            07633899
CL3132             MOVE PV-MSG080-REC2 TO IMRD008-RECORD                07633999
CL3132             DISPLAY '!!! MESSAGE ID '                            07634099
CL3132                     IM008-BUSINESS-EVENT-ID                      07634199
CL3132                     '!!! INTR UPC ID '                           07634299
CL3132                     IM008-ITEM-KEY-INTR-UPC-ID                   07634399
CL3132                     ' HAD A NON-ZERO RETURN CODE OF '            07634499
CL3132                     PV-DISPLAY-SQLCODE                           07634599
CL3132             PERFORM 2500-PUT-ON-ERROR-QUEUE                      07634799
CL3132        END-IF                                                    07634899
CL3132        IF PV-MSG080-REC3 NOT EQUAL SPACES                        07634999
CL3132             MOVE LV-RETURN-CODE TO PV-DISPLAY-SQLCODE            07635099
CL3132             MOVE PV-MSG080-REC3 TO IMRD008-RECORD                07635199
CL3132             DISPLAY '!!! MESSAGE ID '                            07635299
CL3132                     IM008-BUSINESS-EVENT-ID                      07635399
CL3132                     '!!! INTR UPC ID '                           07635499
CL3132                     IM008-ITEM-KEY-INTR-UPC-ID                   07635599
CL3132                     ' HAD A NON-ZERO RETURN CODE OF '            07635699
CL3132                     PV-DISPLAY-SQLCODE                           07635799
CL3132             PERFORM 2500-PUT-ON-ERROR-QUEUE                      07635899
CL3132          END-IF                                                  07635999
CL3132             PERFORM 2250-ROLLBACK-DATA                           07636099
CL3132             PERFORM 2300-COMMIT-MESSAGE                          07636199
CL3132     END-EVALUATE.                                                07636299
                                                                        07636399
       EJECT.                                                           07636499
      ******************************************************************07637099
      **RETRIEVE TIME FROM DB2                                          07640000
      ******************************************************************07650000
       2150-SELECT-TIMESTAMP.                                           07660000
                                                                        07670000
           MOVE '2150-SELECT-TIMESTAMP' TO PV-PARAGRAPH-NAME.           07680000
                                                                        07690000
           EXEC SQL                                                     07700000
                SELECT CURRENT TIMESTAMP                                07710000
                INTO  :LV-CURRENT-TIMESTAMP                             07720000
                FROM   SYSIBM.SYSDUMMY1                                 07730000
           END-EXEC.                                                    07740000
                                                                        07750000
           EVALUATE TRUE                                                07760000
              WHEN  SQLCODE = ZEROS                                     07770000
                    CONTINUE                                            07780000
              WHEN  OTHER                                               07790000
                    PERFORM 9999-SQL-ABEND-ROUTINE                      07800000
           END-EVALUATE.                                                07810000
                                                                        07820000
       EJECT.                                                           07830000
      ****************************************************************  07840000
      *COMMIT DATA TO DB                                                07850000
      ****************************************************************  07860000
       2200-COMMIT-DATA.                                                07870000
                                                                        07880000
           MOVE '2200-COMMIT-DATA' TO PV-PARAGRAPH-NAME.                07890000
                                                                        07900000
           EXEC SQL                                                     07910000
                COMMIT                                                  07920000
           END-EXEC.                                                    07930000
                                                                        07940000
           EVALUATE TRUE                                                07950000
              WHEN SQLCODE = 0                                          07960000
                   CONTINUE                                             07970000
              WHEN OTHER                                                07980000
                   DISPLAY 'UNABLE TO COMMIT DATA'                      07990000
                   PERFORM 9999-BACK-OUT-MQV-CHANGES                    08000000
                   PERFORM 9999-DISCONNECT-QMGR                         08010000
                   PERFORM 9999-SQL-ABEND-ROUTINE                       08020000
           END-EVALUATE.                                                08030000
                                                                        08040000
       EJECT.                                                           08050000
      ****************************************************************  08060000
      * ROLLBACK ANY CHANGES TO DB2 DUE TO UNSUCCESSFUL MESSAGE         08070000
      ****************************************************************  08080000
       2250-ROLLBACK-DATA.                                              08090000
                                                                        08100000
           MOVE '2250-ROLLBACK-DATA' TO PV-PARAGRAPH-NAME.              08110000
                                                                        08120000
           EXEC SQL                                                     08130000
                ROLLBACK                                                08140000
           END-EXEC.                                                    08150000
                                                                        08160000
           EVALUATE TRUE                                                08170000
              WHEN SQLCODE = 0                                          08180000
                   CONTINUE                                             08190000
              WHEN OTHER                                                08200000
                   DISPLAY 'UNABLE TO ROLLBACK DATA'                    08210000
                   PERFORM 9999-BACK-OUT-MQV-CHANGES                    08220000
                   PERFORM 9999-DISCONNECT-QMGR                         08230000
                   PERFORM 9999-SQL-ABEND-ROUTINE                       08240000
           END-EVALUATE.                                                08250000
                                                                        08260000
       EJECT.                                                           08270000
      ******************************************************************08280000
      **REMOVES MESSAGE FROM QUEUE                                      08290000
      ******************************************************************08300000
       2300-COMMIT-MESSAGE.                                             08310000
                                                                        08320000
           MOVE '2300-COMMIT-MESSAGE'          TO PV-PARAGRAPH-NAME.    08330000
                                                                        08340000
           CALL MQV-MQCMIT USING MQV-HCONN                              08350000
                                 MQV-COMPLETION-CODE                    08360000
                                 MQV-REASON.                            08370000
                                                                        08380000
           EVALUATE TRUE                                                08390000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        08400000
                   CONTINUE                                             08410000
              WHEN OTHER                                                08420000
                   CALL MQV-MQCHECK USING MQV-REASON                    08430000
                                          MQV-REASON-TEXT               08440000
                   MOVE 'ERROR COMMITING DATA' TO PV-OPERATION-MSG-1    08450000
                   PERFORM 9999-BACK-OUT-MQV-CHANGES                    08460000
                   PERFORM 9999-DISCONNECT-QMGR                         08470000
                   PERFORM 9999-MQ-ABEND                                08480000
           END-EVALUATE.                                                08490000
                                                                        08500000
       EJECT.                                                           08510000
      ******************************************************************08520000
      **WRITES MESSAGE TO A LOG IN CASE RECOVERY IS NEEDED              08530000
      ******************************************************************08540000
       2400-BACKUP-MESSAGE.                                             08550000
                                                                        08560000
           MOVE '2400-BACKUP-MESSAGE' TO PV-PARAGRAPH-NAME.             08570000
                                                                        08580000
           MOVE MQV-MSGBUFFER TO MESSAGE-LOG-RECORD.                    08590000
           WRITE MESSAGE-LOG-RECORD.                                    08600000
                                                                        08610000
CL3132******************************************************************08611099
CL3132**WRITES MESSAGE TO A LOG IN CASE RECOVERY IS NEEDED              08612099
CL3132******************************************************************08613099
CL3132 2450-BACKUP-MESSAGE.                                             08614099
CL3132                                                                  08615099
CL3132     MOVE '2450-BACKUP-MESSAGE' TO PV-PARAGRAPH-NAME.             08616099
CL3132                                                                  08617099
CL3132     IF PV-MSG080-REC1 NOT EQUAL SPACES                           08617199
CL3132        MOVE PV-MSG080-REC1     TO MESSAGE-LOG-RECORD             08618099
CL3132        WRITE MESSAGE-LOG-RECORD                                  08619099
CL3132     END-IF                                                       08619199
CL3132     IF PV-MSG080-REC2 NOT EQUAL SPACES                           08619299
CL3132        MOVE PV-MSG080-REC2     TO MESSAGE-LOG-RECORD             08619399
CL3132        WRITE MESSAGE-LOG-RECORD                                  08619499
CL3132     END-IF                                                       08619599
CL3132     IF PV-MSG080-REC3 NOT EQUAL SPACES                           08619699
CL3132        MOVE PV-MSG080-REC3     TO MESSAGE-LOG-RECORD             08619799
CL3132        WRITE MESSAGE-LOG-RECORD                                  08619899
CL3132     END-IF.                                                      08619999
                                                                        08620099
       EJECT.                                                           08621000
      ******************************************************************08630000
      **PUTS MESSAGE THAT HAD ERROR ON ERROR QUEUE                      08640000
      ******************************************************************08650000
       2500-PUT-ON-ERROR-QUEUE.                                         08660000
                                                                        08670000
           MOVE '2500-PUT-ON-ERROR-QUEUE' TO PV-PARAGRAPH-NAME.         08680000
                                                                        08690000
           MOVE CC-ITEM-ERROR-QUEUE-NAME  TO MQOD-OBJECTNAME            08700000
           MOVE CC-QUEUE-MANAGER-NAME     TO MQOD-OBJECTQMGRNAME.       08710000
                                                                        08720000
           MOVE IMRD008-RECORD            TO MQV-ERRMSGBUF.             08730000
           MOVE MQMI-NONE                 TO MQMD-MSGID.                08750000
           MOVE +450                      TO MQV-MSG-LENGTH.            08760000
           MOVE MQFMT-STRING              TO MQMD-FORMAT.               08770000
           COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT.                   08780000
                                                                        08790000
                                                                        08800000
           CALL MQV-MQPUT USING MQV-HCONN                               08810000
                                MQV-ERROR-HANDLE                        08820000
                                MQM-MESSAGE-DESCRIPTOR                  08830000
                                MQM-PUT-MESSAGE-OPTIONS                 08840000
                                MQV-MSG-LENGTH                          08850000
                                MQV-ERRMSGBUF                           08860000
                                MQV-COMPLETION-CODE                     08870000
                                MQV-REASON.                             08880000
                                                                        08890000
           EVALUATE TRUE                                                08900000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        08910000
                   ADD +1                 TO PC-MESSAGES-TO-ERROR-QUEUE 08920000
              WHEN OTHER                                                08930000
                   DISPLAY 'UNABLE TO WRITE TO ITEM ERROR QUEUE'        08940000
                   CALL MQV-MQCHECK USING MQV-REASON                    08950000
                                          MQV-REASON-TEXT               08960000
                   MOVE 'MQBACK ERROR'      TO PV-OPERATION-MSG-1       08970000
                   PERFORM 9999-DISCONNECT-QMGR                         08980000
                   PERFORM 9999-MQ-ABEND                                08990000
           END-EVALUATE.                                                09000000
                                                                        09010000
       EJECT.                                                           09020000
      ******************************************************************09030000
      **RETRIEVES NEXT MESSAGE FROM THE ITEM QUEUE                      09040000
      ******************************************************************09050000
       9999-RETRIEVE-MESSAGE.                                           09060000
                                                                        09070000
           MOVE '9999-RETRIEVE-MESSAGE' TO PV-PARAGRAPH-NAME.           09080000
                                                                        09090000
           INITIALIZE MQV-MSGBUFFER                                     09100000
                      MQV-ERRMSGBUF                                     09110000
                      MQV-MSG.                                          09120000
                                                                        09130000
           MOVE MQMI-NONE            TO MQMD-MSGID.                     09140000
           MOVE MQCI-NONE            TO MQMD-CORRELID.                  09150000
           MOVE MQFMT-STRING         TO MQMD-FORMAT.                    09160000
           MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.             09170000
                                                                        09180000
           COMPUTE MQGMO-OPTIONS  = MQGMO-SYNCPOINT +                   09190000
                                    MQGMO-WAIT.                         09200000
                                                                        09210000
           COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  09220000
                                     MQGMO-CONVERT   +                  09230000
                                     MQGMO-ACCEPT-TRUNCATED-MSG +       09240000
                                     MQGMO-WAIT.                        09250000
                                                                        09260000
           CALL MQV-MQGET USING MQV-HCONN                               09270000
                                MQV-ITEM-HANDLE                         09280000
                                MQM-MESSAGE-DESCRIPTOR                  09290000
                                MQM-GET-MESSAGE-OPTIONS                 09300000
                                MQV-MSG-LENGTH                          09310000
                                MQV-MSGBUFFER                           09320000
                                MQV-DATA-LENGTH                         09330000
                                MQV-COMPLETION-CODE                     09340000
                                MQV-REASON.                             09350000
                                                                        09360000
           IF  MQV-COMPLETION-CODE = MQCC-OK                            09370000
               ADD +1             TO PC-MESSAGE-FROM-QUEUE              09380000
               ADD +1             TO PC-MESSAGE-DISPLAY-CNT             09390000
               INITIALIZE IMRD008-RECORD                                09400000
               MOVE MQV-MSGBUFFER TO IMRD008-RECORD                     09410000
           ELSE                                                         09420000
               EVALUATE TRUE                                            09430000
                  WHEN MQV-REASON = MQRC-NO-MSG-AVAILABLE               09440000
                       CONTINUE                                         09450000
                  WHEN OTHER                                            09460000
                       CALL MQV-MQCHECK USING MQV-REASON                09470000
                                              MQV-REASON-TEXT           09480000
                       MOVE 'ERROR RETRIEVING MESSAGE'                  09490000
                                             TO PV-OPERATION-MSG-1      09500000
                       PERFORM 9999-BACK-OUT-MQV-CHANGES                09510000
                       PERFORM 9999-DISCONNECT-QMGR                     09520000
                       PERFORM 9999-MQ-ABEND                            09530000
               END-EVALUATE                                             09540000
           END-IF.                                                      09550000
                                                                        09560000
       EJECT.                                                           09570000
      ***************************************************************** 09580000
      **ROLLBACK MQ CHANGES                                             09590000
      ***************************************************************** 09600000
       9999-BACK-OUT-MQV-CHANGES.                                       09610000
                                                                        09620000
           MOVE '9999-BACK-OUT-MQV-CHANGES' TO PV-PARAGRAPH-NAME.       09630000
                                                                        09640000
           CALL MQV-MQBACK USING MQV-HCONN                              09650000
                                 MQV-COMPLETION-CODE                    09660000
                                 MQV-REASON.                            09670000
                                                                        09680000
           EVALUATE TRUE                                                09690000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        09700000
                   CONTINUE                                             09710000
              WHEN OTHER                                                09720000
                   CALL MQV-MQCHECK USING MQV-REASON                    09730000
                                          MQV-REASON-TEXT               09740000
                   MOVE 'MQBACK ERROR'  TO PV-OPERATION-MSG-1           09750000
                   PERFORM 9999-DISCONNECT-QMGR                         09760000
                   PERFORM 9999-MQ-ABEND                                09770000
           END-EVALUATE.                                                09780000
                                                                        09790000
       EJECT.                                                           09800000
      ***************************************************************** 09810000
      **DISCONNECT FROM THE QUEUE MANAGER                               09820000
      ***************************************************************** 09830000
       9999-DISCONNECT-QMGR.                                            09840000
                                                                        09850000
           CALL MQV-MQDISC USING MQV-HCONN                              09860000
                                 MQV-COMPLETION-CODE                    09870000
                                 MQV-REASON.                            09880000
                                                                        09890000
           EVALUATE TRUE                                                09900000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        09910000
                   CONTINUE                                             09920000
              WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                09930000
                   CALL MQV-MQCHECK USING MQV-REASON                    09940000
                                          MQV-REASON-TEXT               09950000
                   MOVE 'MQDISC ERROR'       TO PV-OPERATION-MSG-1      09960000
                   PERFORM 9999-MQ-ABEND                                09970000
           END-EVALUATE.                                                09980000
                                                                        09990000
       EJECT.                                                           10000000
      ***************************************************************** 10010000
      **CLOSE XS ITEM AND XS ITEM ERROR QUEUE                           10020000
      ***************************************************************** 10030000
       9999-CLOSE-QUEUES.                                               10040000
                                                                        10050000
           CALL MQV-MQCLOSE USING MQV-HCONN                             10060000
                                  MQV-ITEM-HANDLE                       10070000
                                  MQCO-NONE                             10080000
                                  MQV-COMPLETION-CODE                   10090000
                                  MQV-REASON.                           10100000
                                                                        10110000
           EVALUATE TRUE                                                10120000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        10130000
                   CONTINUE                                             10140000
              WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                10150000
                   CALL MQV-MQCHECK USING MQV-REASON                    10160000
                                          MQV-REASON-TEXT               10170000
                   MOVE 'CANNOT CLOSE ITEM QUEUE' TO PV-OPERATION-MSG-1 10180000
                   PERFORM 9999-MQ-ABEND                                10190000
           END-EVALUATE.                                                10200000
                                                                        10210000
           CALL MQV-MQCLOSE USING MQV-HCONN                             10220000
                                  MQV-ERROR-HANDLE                      10230000
                                  MQCO-NONE                             10240000
                                  MQV-COMPLETION-CODE                   10250000
                                  MQV-REASON.                           10260000
                                                                        10270000
           EVALUATE TRUE                                                10280000
              WHEN MQV-COMPLETION-CODE = MQCC-OK                        10290000
                   CONTINUE                                             10300000
              WHEN MQV-COMPLETION-CODE NOT EQUAL MQCC-OK                10310000
                   CALL MQV-MQCHECK USING MQV-REASON                    10320000
                                          MQV-REASON-TEXT               10330000
                   MOVE 'CANNOT CLOSE ERROR QUEUE' TO PV-OPERATION-MSG-110340000
                   PERFORM 9999-MQ-ABEND                                10350000
           END-EVALUATE.                                                10360000
                                                                        10370000
       EJECT.                                                           10380000
      ***************************************************************** 10390000
      **READ CONTROL CARD 1                                             10400000
      ***************************************************************** 10410000
       9999-READ-CONTROL-CARD-1.                                        10420000
                                                                        10430000
           READ CONTROL-CARD-1 INTO CC-CONTROL-CARD-1-LAYOUT.           10440000
                                                                        10450000
       EJECT.                                                           10460000
      ***************************************************************** 10470000
      **READ CONTROL CARD 2                                             10480000
      ***************************************************************** 10490000
       9999-READ-CONTROL-CARD-2.                                        10500000
                                                                        10510000
           READ CONTROL-CARD-2 INTO CC-CONTROL-CARD-2-LAYOUT.           10520000
                                                                        10530000
       EJECT.                                                           10540000
      ***************************************************************** 10550000
      **READ CONTROL CARD 3                                             10560000
      ***************************************************************** 10570000
       9999-READ-CONTROL-CARD-3.                                        10580000
                                                                        10590000
           READ CONTROL-CARD-3 INTO CC-CONTROL-CARD-3-LAYOUT.           10600000
                                                                        10610000
       EJECT.                                                           10620000
      ****************************************************************  10630000
      *END OF PROGRAM ROUTINE                                           10640000
      ****************************************************************  10650000
       9999-WRAPUP.                                                     10660000
                                                                        10670000
           PERFORM 9999-CLOSE-QUEUES.                                   10680000
           PERFORM 9999-DISCONNECT-QMGR.                                10690000
                                                                        10700000
           CLOSE CONTROL-CARD-1                                         10710000
                 CONTROL-CARD-2                                         10720000
                 CONTROL-CARD-3                                         10730000
                 MESSAGE-LOG.                                           10740000
                                                                        10750000
           PERFORM 9999-DISPLAY-STATISTICS.                             10760000
           MOVE PV-RETURN-CODE TO RETURN-CODE.                          10770000
                                                                        10780000
       EJECT.                                                           10790000
      ****************************************************************  10800000
      *DISPLAY PROGRAM STATISTICS FOR THIS RUN                          10810000
      ****************************************************************  10820000
       9999-DISPLAY-STATISTICS.                                         10830000
                                                                        10840000
           DISPLAY '*********************************************'.     10850000
           DISPLAY 'PROGRAM NAME: ' PC-CURRENT-PROGRAM-NAME.            10860000
           DISPLAY '*********************************************'.     10870000
           DISPLAY 'MESSAGES FROM QUEUE:     ' PC-MESSAGE-FROM-QUEUE.   10880000
           DISPLAY 'MESSAGES BACKED UP:      '                          10890000
                   PC-MESSAGES-WRITTEN-TO-FILE.                         10891000
           DISPLAY 'MESSAGES ON ERROR QUEUE: '                          10900000
                   PC-MESSAGES-TO-ERROR-QUEUE.                          10901000
           DISPLAY ' '.                                                 10910000
           DISPLAY 'MESSAGE 005 COUNTER: '  PC-MESSAGE-005.             10911000
           DISPLAY 'MESSAGE 010 COUNTER: '  PC-MESSAGE-010.             10920000
           DISPLAY 'MESSAGE 015 COUNTER: '  PC-MESSAGE-015.             10930000
           DISPLAY 'MESSAGE 020 COUNTER: '  PC-MESSAGE-020.             10940000
           DISPLAY 'MESSAGE 025 COUNTER: '  PC-MESSAGE-025.             10950000
           DISPLAY 'MESSAGE 030 COUNTER: '  PC-MESSAGE-030.             10960000
           DISPLAY 'MESSAGE 031 COUNTER: '  PC-MESSAGE-031.             10970000
           DISPLAY 'MESSAGE 040 COUNTER: '  PC-MESSAGE-040.             10980000
           DISPLAY 'MESSAGE 041 COUNTER: '  PC-MESSAGE-041.             10990000
      *    DISPLAY 'MESSAGE 045 COUNTER: '  PC-MESSAGE-045.             11000000
           DISPLAY 'MESSAGE 050 COUNTER: '  PC-MESSAGE-050.             11010000
           DISPLAY 'MESSAGE 055 COUNTER: '  PC-MESSAGE-055.             11020000
           DISPLAY 'MESSAGE 060 COUNTER: '  PC-MESSAGE-060.             11030000
           DISPLAY 'MESSAGE 070 COUNTER: '  PC-MESSAGE-070.             11040000
           DISPLAY 'MESSAGE 075 COUNTER: '  PC-MESSAGE-075.             11050000
           DISPLAY 'MESSAGE 080 COUNTER: '  PC-MESSAGE-080.             11060000
           DISPLAY 'MESSAGE 085 COUNTER: '  PC-MESSAGE-085.             11070000
           DISPLAY 'MESSAGE 087 COUNTER: '  PC-MESSAGE-087.             11080000
           DISPLAY 'MESSAGE 089 COUNTER: '  PC-MESSAGE-089.             11090000
           DISPLAY 'MESSAGE 095 COUNTER: '  PC-MESSAGE-095.             11100000
           DISPLAY 'MESSAGE 100 COUNTER: '  PC-MESSAGE-100.             11110000
           DISPLAY 'MESSAGE 120 COUNTER: '  PC-MESSAGE-120.             11120000
           DISPLAY ' '.                                                 11121000
           DISPLAY 'MESSAGE 996 COUNTER: '  PC-MESSAGE-996.             11130000
           DISPLAY 'MESSAGE 997 COUNTER: '  PC-MESSAGE-997.             11131000
           DISPLAY 'MESSAGE 998 COUNTER: '  PC-MESSAGE-998.             11140000
           DISPLAY 'MESSAGE 000 COUNTER: '  PC-MESSAGE-000.             11150000
           DISPLAY ' '.                                                 11151000
           DISPLAY 'UNKNOWN MESSAGES FROM QUEUE: ' PC-MESSAGE-UNKNOWN.  11160000
           DISPLAY '*********************************************'.     11170000
                                                                        11180000
       EJECT.                                                           11190000
      ******************************************************************11200000
      **MQ ABEND ROUTINE                                                11210000
      ******************************************************************11220000
       9999-MQ-ABEND.                                                   11230000
                                                                        11240000
           DISPLAY '**** ABEND *************************************'.  11250000
           DISPLAY '** MQSERIES ERROR **'.                              11260000
           DISPLAY '** PROGRAM:    ' PC-CURRENT-PROGRAM-NAME.           11270000
           DISPLAY '** ABEND CODE: ' ABEND-CODE.                        11280000
           DISPLAY '** PARAGRAPH:  ' PV-PARAGRAPH-NAME.                 11290000
           DISPLAY '** MESSAGE:    ' PV-OPERATION-MSG-1.                11300000
           DISPLAY '** COMP CODE:  ' MQV-COMPLETION-CODE.               11310000
           DISPLAY '** RSN CODE:   ' MQV-REASON.                        11320000
           DISPLAY '** RSN TEXT:   ' MQV-REASON-TEXT.                   11330000
           DISPLAY '************************************************'.  11340000
           MOVE +4013 TO ABEND-CODE.                                    11350000
           CALL 'ILBOABN0' USING ABEND-CODE.                            11360000
                                                                        11370000
       EJECT.                                                           11380000
      ******************************************************************11390000
      **SQL ABEND ROUTINE                                               11400000
      ******************************************************************11410000
       9999-SQL-ABEND-ROUTINE.                                          11420000
                                                                        11430000
           DISPLAY '** ABEND     **'.                                   11440000
           DISPLAY '** PROGRAM   ** = ' PC-CURRENT-PROGRAM-NAME.        11450000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              11460000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               11470000
      ******************************************************************11480000
      * COPY BOOK CONTAINING PROCEDURE DIVISION STATEMENTS REQUIRED     11490000
      * TO UTILIZE SQLCA MESSAGE DISPLAY MODULE 'DSNTIAR' FOLLOWS.      11500000
      ******************************************************************11510000
           COPY DPPD004.                                                11520000
           SET ABEND-4013-DB2-ERROR TO TRUE.                            11530000
           CALL 'ILBOABN0' USING ABEND-CODE.                            11540000
                                                                        11550000
       EJECT.                                                           11560000
