000100*------------------------------------------------------------     00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300*------------------------------------------------------------     00030000
000400 PROGRAM-ID.    EPKUT215.                                         00040001
000500 AUTHOR.        MEDHA CHOUDHURY.                                  00050000
000600 DATE-WRITTEN.  FEB 09, 2008.                                     00060002
000700                                                                  00070000
000800*-------------------------------------------------------------*   00080002
000900*    CUSTOMER INCENTIVE DATA FORMATTER                        *   00090002
001000*-------------------------------------------------------------*   00100002
001100*    THIS PROGRAM WILL READ IN THE NEW CUSTOMER INCENTIVE     *   00110002
001200*    (PROMOTIONS) DATA FILES AND WILL FORMAT THE RECORDS BY   *   00120002
001300*    ADDING HEADERS AND SEPARATING EACH COLUMN WITH PIPE.     *   00130002
001400*                                                                 00140002
001500*    POS 2009 FALL - PRICING INFRASTRUCTURE PROJECT WR# 35484 *   00150002
001600*                                                             *   00160002
001700*------------------------------------------------------------ *   00170002
001800*  INPUT:                                                     *   00180002
001900*        CUST-INCTV-FILE                  EPRD212             *   00190002
002000*                                                             *   00200002
002100*        CUST-INCTV-SECT-FL               EPRD213             *   00210002
002200*                                                             *   00220002
002300*        CUST-INCTV-PARM-FL               EPRD214             *   00230002
002400*                                                             *   00240002
002500*        CUST-INCTV-MDSE-FL               EPRD215             *   00250002
002600*                                                             *   00260002
002610*        CC-DATE                          EPRD111             *   00261030
002620*                                                             *   00262030
002700*  OUTPUT:                                                    *   00270002
002800*        CUST-INCTV-FORMATTED             EPRD217             *   00280002
002900*                                      (HEADER RECORD LAYOUT) *   00290002
002800*        LAST-HEADER-TIME                 EPRD232             *   00291041
003000*-------------------------------------------------------------*   00300002
003100* HISTORY LOG:                                                *   00310002
003200*                                                             *   00320002
003300*-------------------------------------------------------------*   00330002
003400* DATE: FEB 09 2009                                           *   00340002
003500* WR/IR#: WR #35484                                           *   00350002
003600* PROGRAMMER: MEDHA CHOUDHURY                                 *   00360002
003700* DESCRIPTION: INITIAL PROGRAM CREATION                       *   00370002
003800*-------------------------------------------------------------*   00380002
003900* DATE:   07/30/2010                                          *   00390046
004000* WR/IR#:   WR #38172                                         *   00400046
004100* PROGRAMMER:  CHERI PARMLEY                                  *   00410046
004200* DESCRIPTION: ADDED OUT03 TO WRITE OUT LAST HEADER DATE      *   00420046
004300* FOR INPUT TO EPKUT194                                       *   00430046
004400*-------------------------------------------------------------*   00440002
004500****************************************************************  00450002
004600 ENVIRONMENT DIVISION.                                            00460002
004700****************************************************************  00470002
004800 CONFIGURATION SECTION.                                           00480002
004900 SOURCE-COMPUTER. IBM-3090.                                       00490002
005000 OBJECT-COMPUTER. IBM-3090.                                       00500002
005100                                                                  00510002
005200 INPUT-OUTPUT SECTION.                                            00520002
005300                                                                  00530002
005400 FILE-CONTROL.                                                    00540002
005500                                                                  00550002
005600     SELECT CUST-INCTV-FILE                                       00560002
005700       ASSIGN TO INP01.                                           00570002
005800                                                                  00580002
005900     SELECT CUST-INCTV-SECT-FILE                                  00590002
006000       ASSIGN TO INP02.                                           00600002
006100                                                                  00610002
006200     SELECT CUST-INCTV-PARM-FILE                                  00620002
006300       ASSIGN TO INP03.                                           00630002
006400                                                                  00640002
006500     SELECT CUST-INCTV-MDSE-FILE                                  00650002
006600       ASSIGN TO INP04.                                           00660002
006700                                                                  00670002
006710     SELECT CC-DATE                                               00671029
006720       ASSIGN TO INP05.                                           00672029
006730                                                                  00673029
006800     SELECT FORMATTED-CUST-INCTV-FL                               00680002
006900       ASSIGN TO OUT01.                                           00690002
007000                                                                  00700002
006800     SELECT LAST-HEADER-TIME                                      00701041
006900       ASSIGN TO OUT02.                                           00702041
007100****************************************************************  00710002
007200 DATA DIVISION.                                                   00720002
007300****************************************************************  00730002
007400 FILE SECTION.                                                    00740002
007500                                                                  00750002
007600 FD  CUST-INCTV-FILE                                              00760002
007700     RECORDING MODE IS F                                          00770002
007800     LABEL RECORDS ARE STANDARD                                   00780002
007900     DATA RECORD IS CUST-INCTV-REC.                               00790002
008000                                                                  00800002
008100 01  CUST-INCTV-REC                                PIC X(130).    00810002
008200*  COPYBOOK IS EPRD212                                            00820002
008300                                                                  00830002
008400 FD  CUST-INCTV-SECT-FILE                                         00840002
008500     RECORDING MODE IS F                                          00850002
008600     LABEL RECORDS ARE STANDARD                                   00860002
008700     DATA RECORD IS CUST-INCTV-SECT-REC.                          00870002
008800                                                                  00880002
008900 01  CUST-INCTV-SECT-REC                           PIC X(130).    00890002
009000*  COPYBOOK IS EPRD213                                            00900002
009100                                                                  00910002
009200 FD  CUST-INCTV-PARM-FILE                                         00920002
009300     RECORDING MODE IS F                                          00930002
009400     LABEL RECORDS ARE STANDARD                                   00940002
009500     DATA RECORD IS CUST-INCTV-PARM-REC.                          00950002
009600                                                                  00960002
009700 01  CUST-INCTV-PARM-REC                           PIC X(130).    00970002
009800*  COPYBOOK IS EPRD214                                            00980002
009900                                                                  00990002
010000 FD  CUST-INCTV-MDSE-FILE                                         01000002
010100     RECORDING MODE IS F                                          01010002
010200     LABEL RECORDS ARE STANDARD                                   01020002
010300     DATA RECORD IS CUST-INCTV-MDSE-REC.                          01030002
010400                                                                  01040002
010500 01  CUST-INCTV-MDSE-REC                           PIC X(120).    01050002
010600*  COPYBOOK IS EPRD215                                            01060002
010610                                                                  01061029
010620 FD  CC-DATE                                                      01062029
010630     RECORDING MODE IS F                                          01063029
010640     BLOCK CONTAINS 0 RECORDS                                     01064029
010650     LABEL RECORDS ARE STANDARD.                                  01065029
010660                                                                  01066029
010670 01  CC-DATE-RECORD   PIC X(80).                                  01067029
010700                                                                  01070002
010620 FD  LAST-HEADER-TIME                                             01071042
010630     RECORDING MODE IS F                                          01072043
010640     BLOCK CONTAINS 0 RECORDS                                     01073040
010650     LABEL RECORDS ARE OMITTED                                    01074044
           DATA RECORD IS CC-TIME-RECORD.                               01074143
010660                                                                  01075040
010670 01  CC-TIME-RECORD   PIC X(80).                                  01076040
010700                                                                  01077040
010800 FD  FORMATTED-CUST-INCTV-FL                                      01080002
010900     RECORDING MODE IS V                                          01090002
011000     RECORD IS VARYING IN SIZE                                    01100002
011100     FROM 1 TO 200 CHARACTERS                                     01110002
011200     DEPENDING ON PV-BYTE-COUNT                                   01120002
011300     LABEL RECORDS ARE STANDARD                                   01130002
011400     DATA RECORD IS FORMATTED-CUST-INCTV-REC.                     01140002
011500                                                                  01150002
011600 01  FORMATTED-CUST-INCTV-REC.                                    01160002
011700     05  FORM-CST-IN-FLD                           PIC X(01)      01170007
011800         OCCURS 200 TIMES                                         01180002
011900              INDEXED BY                                          01190002
012000              FORM-CST-IN-LEN.                                    01200002
012100                                                                  01210002
012200*----------------------------------------------------------       01220002
012300 WORKING-STORAGE SECTION.                                         01230002
012400                                                                  01240002
012500 01  AC-ABEND-CODE                     PIC S9(04) VALUE ZERO      01250002
012600                                                  COMP SYNC.      01260002
012700     88  AC-INPUT-CONTROL-CARD-ERROR              VALUE +4003.    01270002
012900     88  AC-INPUT-FILE-EMPTY                      VALUE +4008.    01290002
013100                                                                  01310002
013200*----------------------------------------------------------       01320002
013300* PC- PROGRAM CONSTANTS                                           01330002
013400*----------------------------------------------------------       01340002
013500 01  PC-PROGRAM-CONSTANTS.                                        01350002
013600     05  PC-PROGRAM-NAME              PIC X(08) VALUE 'EPKUT215'. 01360002
013700     05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   01370002
013800     05  PC-FIELD-LENGTH              PIC S9(03) VALUE +10 COMP-3.01380002
013900     05  PC-CSV-DELIMITER             PIC X(01) VALUE '|'.        01390002
014000     05  PC-NULL-VALUE                PIC X(01) VALUE '~'.        01400002
014100     05  PC-UNDER-SCORE               PIC X(01) VALUE '_'.        01410002
014200     05  PC-DASH                      PIC X(01) VALUE '-'.        01420002
014300     05  PC-ONE-SPACE                 PIC X(01) VALUE ' '.        01430002
014400     05  PC-ONE-ZERO                  PIC X(01) VALUE '0'.        01440002
014500     05  PC-TIME-START                PIC X(08) VALUE '00:00:01'. 01450002
014600     05  PC-TIME-END                  PIC X(08) VALUE '23:59:59'. 01460002
014700     05  PC-STORE-SPECIFIC-GRP        PIC X(05) VALUE '05000'.    01470002
014800     05  PC-FIVE-ZERO                 PIC X(05) VALUE '00000'.    01480002
014900     05  PC-HDR-IND                   PIC X(03) VALUE 'HDR'.      01490002
015000                                                                  01500002
015010*----------------------------------------------------------       01501029
015020* TIME                                                            01502029
015030*----------------------------------------------------------       01503029
015040 01  PC-TIME.                                                     01504029
015050     05  PC-TIME-HHMM                 PIC X(04).                  01505029
015060     05  PC-TIME-SS                   PIC X(02).                  01506029
015070                                                                  01507029
015080 01  PV-TIME-CALC                     PIC 9(06).                  01508029
015090                                                                  01509029
015091 01  PV-TIME.                                                     01509129
015092     05  PV-TIME-HH                   PIC 9(02).                  01509229
015093     05  PV-TIME-MM                   PIC 9(02).                  01509329
015094     05  PV-TIME-SS                   PIC 9(02).                  01509429
015095                                                                  01509529
015096 01  PV-CURR-TIME.                                                01509629
015097     05  PV-CURR-TIME-HH         PIC  9(02)    VALUE ZERO.        01509729
015098     05  PV-CURR-TIME-MM         PIC  9(02)    VALUE ZERO.        01509829
015099     05  PV-CURR-TIME-SS         PIC  9(02)    VALUE ZERO.        01509929
015100     05  PV-CURR-TIME-SSHH       PIC  9(02)    VALUE ZERO.        01510029
015101                                                                  01510129
015102 01  PV-HEADER-TIMESTAMP.                                         01510230
015103     05 PV-HDR-TMST-DATE.                                         01510330
015104        10  PV-HDR-YYYY           PIC X(04).                      01510430
015105        10  PV-HDR-MM             PIC X(02).                      01510530
015106        10  PV-HDR-DD             PIC X(02).                      01510630
015107     05 PV-HDR-TMST-TIME          PIC X(06).                      01510730
015111                                                                  01511130
015120*----------------------------------------------------------       01512030
015200* PV- PROGRAM VARIABLES                                           01520002
015300*----------------------------------------------------------       01530002
015400 01  PV-PROGRAM-STATUS.                                           01540002
015500     05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACES.     01550002
015600     05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACES.     01560002
015700     05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACES.     01570002
015800     05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      01580002
015900     05  PV-SQL-SUB                   PIC S9(4) VALUE +0 COMP.    01590002
016000*                                                                 01600002
016100 01  PV-PROGRAM-VARIABLES.                                        01610002
016200     05  PV-TALLY                     PIC S9(03) COMP-3 VALUE +0. 01620002
016300     05  PV-BYTE-COUNT                PIC  9(04) VALUE ZERO.      01630002
016500     05  PV-SQL-SUB                   PIC  9(01) VALUE ZERO.      01650002
016600     05  PV-SPACE                     PIC  X(01).                 01660002
016700     05  PV-DISPLAY-INDEX             PIC S9(04) COMP.            01670002
016800                                                                  01680002
016900     05  PV-VARIABLE-OUTPUT-FIELD.                                01690002
017000         10  PV-BIT-VARIABLE          PIC X(01)                   01700002
017100                                          VALUE SPACES            01710002
017200                                          OCCURS 10 TIMES         01720007
017300                                          INDEXED BY              01730002
017400                                          PV-BIT-IDX              01740002
017500                                          PV-EOF-IDX.             01750002
017600                                                                  01760002
017700     05  PV-VARIABLE-CHAR-FIELD.                                  01770002
017800         10  PV-BIT-CHR-VARIABLE      PIC X(01)                   01780002
017900                                          VALUE SPACES            01790002
018000                                          OCCURS 50 TIMES         01800006
018100                                          INDEXED BY              01810002
018200                                          PV-CHR-BIT-IDX          01820002
018300                                          PV-CHR-EOF-IDX.         01830002
018400                                                                  01840002
021700     05  PV-PROMO-DATE.                                           02170030
021800         10  PV-PROMO-YYYY            PIC X(04).                  02180030
021900         10  PV-PROMO-DASH-1          PIC X(01) VALUE '-'.        02190030
022000         10  PV-PROMO-MM              PIC X(02).                  02200030
022100         10  PV-PROMO-DASH-2          PIC X(01) VALUE '-'.        02210030
022101         10  PV-PROMO-DD              PIC X(02).                  02210130
022102                                                                  02210230
022103     05  PV-BATCH-DATE.                                           02210330
022104         10  PV-BATCH-YYYY            PIC X(04).                  02210430
022106         10  PV-BATCH-MM              PIC X(02).                  02210630
022108         10  PV-BATCH-DD              PIC X(02).                  02210830
022109                                                                  02210930
022110     05  PV-FILE-TYPE                 PIC X(03) VALUE SPACES.     02211026
022200     05  PV-STR-GRP-TYP-CDE           PIC 9(05) VALUE ZERO.       02220003
022300     05  PV-STR-GRP-ID-GRP.                                       02230003
022400         10  PV-FIRST-BYTES           PIC 9(05) VALUE ZERO.       02240003
022500         10  PV-STR-GRP-ID            PIC 9(05) VALUE ZERO.       02250003
022600     05  PV-FILE-DIST-HDR-DTE         PIC X(08) VALUE SPACES.     02260013
022800     05  PV-RECORD-ACTION             PIC X(01) VALUE SPACES.     02280007
022810     05  PV-APPLY-IND                 PIC X(01) VALUE SPACES.     02281010
022900     05  PV-SYS-OF-REC-ID             PIC 9(10) VALUE ZEROES.     02290007
023000     05  PV-SRC-SYS-ID                PIC X(02) VALUE SPACES.     02300007
023100                                                                  02310003
023150     05  PV-ELECT-SLF-TOPR-CD.                                    02315024
023160         10 PV-ESL-FIRST-ZERO         PIC X(01) VALUE SPACES.     02316024
023170         10 PV-ESL-CDE                PIC X(02) VALUE SPACES.     02317024
023180                                                                  02318024
023200*----------------------------------------------------------       02320002
023300* PV- PROGRAM COUNT VARIABLES                                     02330002
023400*----------------------------------------------------------       02340002
023500 01  PV-PROGRAM-COUNTERS.                                         02350002
023600     05  PV-DTL-REC-WRITEN            PIC 9(09) VALUE 0.          02360013
023700     05  PV-HDR-REC-WRITEN            PIC 9(09) VALUE 0.          02370002
023800     05  PV-CINCTV-REC-RD             PIC 9(09) VALUE 0.          02380003
023900     05  PV-CINCTV-SECT-REC-RD        PIC 9(09) VALUE 0.          02390003
024000     05  PV-CINCTV-PARM-REC-RD        PIC 9(09) VALUE 0.          02400003
024100     05  PV-CINCTV-MDSE-REC-RD        PIC 9(09) VALUE 0.          02410003
024200     05  PV-PIPE-COUNT                PIC 9(04) VALUE 0.          02420002
024300                                                                  02430002
024400*----------------------------------------------------------------*02440002
024500* PS- PROGRAM SWITCHES                                           *02450002
024600*----------------------------------------------------------------*02460002
024700 01  PS-PROGRAM-SWITCHES.                                         02470002
024800     05  PS-END-OF-CINCTV-SW          PIC  X(01) VALUE 'N'.       02480002
024900         88  PS-END-OF-CINCTV-FILE               VALUE 'Y'.       02490002
025000         88  PS-NOT-END-CINCTV-FILE              VALUE 'N'.       02500002
025100     05  PS-END-OF-CINC-SEC-SW        PIC  X(01) VALUE 'N'.       02510003
025200         88  PS-END-OF-CINCTV-SEC-FL             VALUE 'Y'.       02520003
025300         88  PS-NOT-END-CINCTV-SEC-FL            VALUE 'N'.       02530003
025400     05  PS-END-OF-CINC-PRM-SW        PIC  X(01) VALUE 'N'.       02540003
025500         88  PS-END-OF-CINCTV-PRM-FL             VALUE 'Y'.       02550003
025600         88  PS-NOT-END-CINCTV-PRM-FL            VALUE 'N'.       02560003
025700     05  PS-END-OF-CINC-MDS-SW        PIC  X(01) VALUE 'N'.       02570003
025800         88  PS-END-OF-CINCTV-MDS-FL             VALUE 'Y'.       02580003
025900         88  PS-NOT-END-CINCTV-MDS-FL            VALUE 'N'.       02590003
026000     05  PS-END-OF-PROCES-SW          PIC  X(01) VALUE 'N'.       02600002
026100         88  PS-END-OF-PROCESSING                VALUE 'Y'.       02610002
026200         88  PS-NOT-END-OF-PROCESSING            VALUE 'N'.       02620002
026300     05  PS-READY-TRACE-SW            PIC  X(01) VALUE 'N'.       02630002
026400         88 PS-READY-TRACE                       VALUE 'Y'.       02640002
026500         88 PS-RESET-TRACE                       VALUE 'N'.       02650002
026600     05  PS-END-OF-DATE-SW            PIC X(01)  VALUE 'N'.       02660030
026610         88  PS-END-OF-DATE-FILE                 VALUE 'Y'.       02661030
026640                                                                  02664030
026700     05  PS-CINC-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       02670004
026800         88 PS-CINC-HDR-WRITEN                   VALUE 'Y'.       02680004
026900         88 PS-CINC-HDR-NOT-WRITEN               VALUE 'N'.       02690004
027000     05  PS-SECTN-HDR-WRITEN-SW       PIC  X(01) VALUE 'N'.       02700004
027100         88 PS-SECTN-HDR-WRITEN                  VALUE 'Y'.       02710004
027200         88 PS-SECTN-HDR-NOT-WRITEN              VALUE 'N'.       02720004
027300     05  PS-PARM-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       02730004
027400         88 PS-PARM-HDR-WRITEN                   VALUE 'Y'.       02740004
027500         88 PS-PARM-HDR-NOT-WRITEN               VALUE 'N'.       02750004
027600     05  PS-MDSE-HDR-WRITEN-SW        PIC  X(01) VALUE 'N'.       02760004
027700         88 PS-MDSE-HDR-WRITEN                   VALUE 'Y'.       02770004
027800         88 PS-MDSE-HDR-NOT-WRITEN               VALUE 'N'.       02780004
027900                                                                  02790004
028000*----------------------------------------------------------       02800002
028100* COPYBOOK  EPRD217 LAYOUT (HEADER LAYOUT)                        02810002
028200*----------------------------------------------------------       02820002
028300     COPY EPRD217.                                                02830002
028400                                                                  02840002
028500*----------------------------------------------------------       02850002
028600* COPYBOOK  EPRD212 LAYOUT                                        02860002
028700*----------------------------------------------------------       02870002
028800     COPY EPRD212.                                                02880002
028900                                                                  02890002
029000*----------------------------------------------------------       02900002
029100* COPYBOOK  EPRD213 LAYOUT                                        02910002
029200*----------------------------------------------------------       02920002
029300     COPY EPRD213.                                                02930002
029400                                                                  02940002
029500*----------------------------------------------------------       02950002
029600* COPYBOOK  EPRD214 LAYOUT                                        02960002
029700*----------------------------------------------------------       02970002
029800     COPY EPRD214.                                                02980002
029900                                                                  02990002
030000*----------------------------------------------------------       03000002
030100* COPYBOOK  EPRD215 LAYOUT                                        03010002
030200*----------------------------------------------------------       03020002
030300     COPY EPRD215.                                                03030002
030400                                                                  03040002
030410*----------------------------------------------------------       03041030
030420* DATE - PROMOTION SYSTEM DATE                                    03042030
030430*----------------------------------------------------------       03043030
030440     COPY EPRD111.                                                03044030
030450                                                                  03045030
028000*----------------------------------------------------------       03046040
028100* COPYBOOK  EPRD232 LAYOUT - LAST TIME                            03047040
028200*----------------------------------------------------------       03048040
028300     COPY EPRD232.                                                03049040
028400                                                                  03049140
030500*------------------------------------------------------------     03050002
030600* VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         03060002
030700*------------------------------------------------------------     03070002
030800     COPY DPWS004.                                                03080002
030900                                                                  03090002
032300*----------------------------------------------------------       03230002
032400 PROCEDURE DIVISION.                                              03240002
032500*----------------------------------------------------------       03250002
032600 0000-MAINLINE.                                                   03260002
032700                                                                  03270002
032800     PERFORM 1000-INITIALIZATION.                                 03280002
032900                                                                  03290002
033000     PERFORM 2000-PROCESS-CUST-INCTV                              03300002
033100             UNTIL PS-END-OF-PROCESSING.                          03310002
033200                                                                  03320002
033300     PERFORM 9200-WRAPUP.                                         03330002
033400                                                                  03340002
033500     GOBACK.                                                      03350002
033600                                                                  03360002
033700*0000-EXIT.                                                       03370002
033900                                                                  03390002
034000*----------------------------------------------------------       03400002
034100* 1000-INITIALIZATION.                                            03410002
034200*     INITIALIZES VARIABLES, OPENS ANY FILES, AND READS           03420002
034300*     THE INPUT FILES, SAVES VARIABLES, AND CLOSES THE INPUT      03430002
034400*     FILES.                                                      03440002
034500*----------------------------------------------------------       03450002
034600 1000-INITIALIZATION.                                             03460014
034700                                                                  03470002
034800     DISPLAY '****************************************'.          03480002
034900     DISPLAY '**          EPKUT215 STARTED          **'.          03490034
035000     DISPLAY '****************************************'.          03500002
035100                                                                  03510002
035200     INITIALIZE PV-PROGRAM-VARIABLES.                             03520002
035300     INITIALIZE PS-PROGRAM-SWITCHES.                              03530004
035400                                                                  03540002
035500     SET PS-NOT-END-CINCTV-FILE      TO TRUE.                     03550002
035510     SET PS-NOT-END-CINCTV-SEC-FL    TO TRUE.                     03551021
035520     SET PS-NOT-END-CINCTV-PRM-FL    TO TRUE.                     03552021
035530     SET PS-NOT-END-CINCTV-MDS-FL    TO TRUE.                     03553021
035600                                                                  03560002
035700     PERFORM 1100-OPEN-FILES.                                     03570002
035800                                                                  03580002
035900     PERFORM 1200-GET-TIME.                                       03590029
036000                                                                  03600002
036010     PERFORM 1400-READ-DATE-CC.                                   03601030
036020                                                                  03602030
036100     PERFORM 6000-READ-CINCTV-FILE.                               03610002
036200                                                                  03620002
036300     IF PS-END-OF-CINCTV-FILE                                     03630002
036400        DISPLAY '** CUSTOMER INCENTIVE EXTRACT FILE IS EMPTY **'  03640002
036500     END-IF.                                                      03650002
036600                                                                  03660002
036700     PERFORM 6200-READ-CINCTV-SECT-FILE.                          03670003
036800                                                                  03680003
036900     IF PS-END-OF-CINCTV-SEC-FL                                   03690003
037000        DISPLAY '** CUSTOMER INCENTIVE SECTION FILE IS EMPTY **'  03700003
037100     END-IF.                                                      03710003
037200                                                                  03720003
037300     PERFORM 6400-READ-CINCTV-PARM-FILE.                          03730003
037400                                                                  03740003
037500     IF PS-END-OF-CINCTV-PRM-FL                                   03750003
037600        DISPLAY '** CUSTOMER INCENTIVE PARM FILE IS EMPTY **'     03760003
037700     END-IF.                                                      03770003
037800                                                                  03780003
037900     PERFORM 6600-READ-CINCTV-MDSE-FILE.                          03790003
038000                                                                  03800003
038100     IF PS-END-OF-CINCTV-MDS-FL                                   03810003
038200        DISPLAY '** CUSTOMER INCENTIVE MDSE FILE IS EMPTY **'     03820003
038300     END-IF.                                                      03830003
038400                                                                  03840003
038500     PERFORM 1300-DETERMINE-PROCESS.                              03850003
038600                                                                  03860003
038700*1000-EXIT.                                                       03870002
038900                                                                  03890002
039000*----------------------------------------------------------       03900002
039100* 1100-OPEN-FILES.                                                03910002
039200*     THIS PARAGRAPH OPENS ALL THE FILES IN MODE REQUIRED         03920002
039300*----------------------------------------------------------       03930002
039400 1100-OPEN-FILES.                                                 03940002
039500                                                                  03950002
039600     OPEN INPUT CUST-INCTV-FILE                                   03960002
039700                CUST-INCTV-SECT-FILE                              03970002
039800                CUST-INCTV-PARM-FILE                              03980002
039900                CUST-INCTV-MDSE-FILE                              03990030
039910                CC-DATE.                                          03991045
040100                                                                  04010002
040200     OPEN OUTPUT FORMATTED-CUST-INCTV-FL                          04020045
039910                LAST-HEADER-TIME.                                 04021045
040300                                                                  04030002
040400*1100-EXIT.                                                       04040002
040600                                                                  04060002
040700*----------------------------------------------------------       04070002
040800* 1200-GET-TIME.                                                  04080029
040900*     THIS PARAGRAPH GETS THE TIME FROM SYSTEM                    04090029
041000*     USED TO UPDATE THE CRT-TIMESTAMP ON THE HEADER RECORD       04100002
041100*----------------------------------------------------------       04110002
041200 1200-GET-TIME.                                                   04120029
041300                                                                  04130002
041400     ACCEPT PV-CURR-TIME FROM TIME.                               04140029
041500                                                                  04150029
041600     MOVE PV-CURR-TIME-HH TO PV-TIME-HH.                          04160029
041700     MOVE PV-CURR-TIME-MM TO PV-TIME-MM.                          04170029
041800     MOVE PV-CURR-TIME-SS TO PV-TIME-SS.                          04180029
041900                                                                  04190029
042000     MOVE PV-TIME TO PV-TIME-CALC.                                04200029
042100                                                                  04210029
044000                                                                  04400002
044100*1200-EXIT.                                                       04410002
044300                                                                  04430002
044400*----------------------------------------------------------       04440003
044500* 1300-DETERMINE-PROCESS                                          04450003
044600*     THIS PARAGRAPH BASED ON THE READ FLAGS DETERMINES           04460003
044700*     PROCESSING                                                  04470003
044800*     - IF ALL THE INPUT FILES ARE EMPTY, DISPLAY AND END THE     04480003
044900*       PROGRAM SUCCESSFULY                                       04490003
045000*     - IF ONLY THE MERCHANDISE FILE IS NOT EMPTY , PROCESS FILE  04500028
045100*     - IF ONE OF THE INPUT FILES IS EMPTY, BUT THE OTHERS NOT    04510003
045200*       THEN ABEND.                                               04520003
045300*----------------------------------------------------------       04530003
045400 1300-DETERMINE-PROCESS.                                          04540003
045500                                                                  04550003
045600     EVALUATE TRUE                                                04560003
045700         WHEN PS-END-OF-CINCTV-FILE                               04570003
045800          AND PS-END-OF-CINCTV-SEC-FL                             04580003
045900          AND PS-END-OF-CINCTV-PRM-FL                             04590003
046000          AND PS-END-OF-CINCTV-MDS-FL                             04600003
046100             SET PS-END-OF-PROCESSING TO TRUE                     04610003
046200                                                                  04620003
046210         WHEN PS-END-OF-CINCTV-FILE                               04621019
046220          AND PS-END-OF-CINCTV-SEC-FL                             04622019
046230          AND PS-END-OF-CINCTV-PRM-FL                             04623019
046240          AND PS-NOT-END-CINCTV-MDS-FL                            04624020
046241                                                                  04624121
046250             SET PS-NOT-END-OF-PROCESSING TO TRUE                 04625019
046251             MOVE EP215-STR-GRP-TYP-CDE TO PV-STR-GRP-TYP-CDE     04625119
046252             MOVE EP215-STR-GRP-ID TO PV-STR-GRP-ID-GRP           04625219
046253             MOVE EP215-STR-FILE-LIST-DTE TO PV-FILE-DIST-HDR-DTE 04625319
046254             MOVE EP215-FILE-ACT-TYP TO PV-FILE-TYPE              04625419
046255             MOVE EP215-APPLY-IND TO PV-APPLY-IND                 04625519
046260                                                                  04626019
046310         WHEN PS-NOT-END-CINCTV-FILE                              04631028
046320          AND PS-NOT-END-CINCTV-SEC-FL                            04632028
046330          AND PS-NOT-END-CINCTV-PRM-FL                            04633028
046340          AND PS-NOT-END-CINCTV-MDS-FL                            04634028
046400             SET PS-NOT-END-OF-PROCESSING TO TRUE                 04640003
046500             PERFORM 3000-DETERMINE-HDR-STR-GRP                   04650007
046501                                                                  04650128
046510         WHEN OTHER                                               04651028
046520             DISPLAY '  '                                         04652028
046530             DISPLAY ' ERROR IN INPUT FILES SOME HAVE DATA OTHER' 04653028
046540             DISPLAY ' IS EMPTY ,PROGRAM CANNOT PROCEED'          04654028
046550             MOVE '1300-DETERMINE-PROCESS' TO                     04655028
046560                                              PV-PARAGRAPH-NAME   04656028
046570             SET AC-INPUT-FILE-EMPTY       TO TRUE                04657028
046580             PERFORM 9910-ABEND                                   04658028
046600                                                                  04660003
046700     END-EVALUATE.                                                04670003
046800                                                                  04680003
046900*1300-EXIT.                                                       04690003
047100                                                                  04710003
047101******************************************************************04710130
047102* 1400-READ-DATE-CC                                               04710230
047103******************************************************************04710330
047104 1400-READ-DATE-CC.                                               04710430
047105                                                                  04710530
047106     READ CC-DATE INTO EP111-CC-CONTROL-CARD                      04710630
047107         AT END                                                   04710730
047108             SET PS-END-OF-DATE-FILE TO TRUE.                     04710830
047109                                                                  04710930
047110     IF PS-END-OF-DATE-FILE                                       04711030
047111         MOVE '1100-PROCESS-DATE-CC    '  TO PV-PARAGRAPH-NAME    04711130
047112         MOVE 'EMPTY DATE CC        '   TO PV-OPERATION-MSG-1     04711230
047113         SET AC-INPUT-CONTROL-CARD-ERROR TO TRUE                  04711331
047114         PERFORM 9910-ABEND                                       04711430
047115     ELSE                                                         04711532
047116         DISPLAY '-----------------------------------------'      04711632
047117         DISPLAY EP111-CC-CONTROL-CARD-DISPLY                     04711732
047118         DISPLAY '------------------------------------------'     04711832
047119         DISPLAY ' '                                              04711932
047120     END-IF.                                                      04712030
047121                                                                  04712130
047122*                                                                 04712230
047123*-- CONVERT FORMAT OF DATE FROM CCYY-MM-DD TO CCYYMMDD            04712330
047124*                                                                 04712430
047125     MOVE EP111-CC-CRNT-DTE TO PV-PROMO-DATE.                     04712530
047126     MOVE PV-PROMO-YYYY TO PV-BATCH-YYYY.                         04712630
047127     MOVE PV-PROMO-MM TO PV-BATCH-MM.                             04712731
047128     MOVE PV-PROMO-DD TO PV-BATCH-DD.                             04712831
047129                                                                  04712930
047130*1400-EXIT.                                                       04713030
047140                                                                  04714030
047200*----------------------------------------------------------       04720003
047300* 2000-PROCESS-CUST-INCTV                                         04730003
047400* ----------------------------                                    04740003
047500* WHEN THE PROCESSING REACHES THIS PARAGRAPH FOR THE FIRST TIME   04750003
047600* IT ALREADY HAS THE FIRST RECORD READ FOR ALL THE FILES          04760003
047700* FORMATTING THE HEADERS FOR THE OFFERS IN FOLLOWING ORDER        04770003
047800*                                                                 04780003
047900* (1) FORMAT THE INC_DT_XXX HEADER AND THEN WRITE ALL THE DATA    04790003
048000*     RECORDS FOLLOWING IT FOR THE TABLE XST_CUST_INCTV FOR STORE 04800003
048100*     GROUP                                                       04810003
048200*     (THIS WOULD ALSO INVOLVE READING THE CUSTOMER INCENTIVE DATA04820003
048300*      FILE (INP01))                                              04830003
048400*                                                                 04840003
048500* (2) FORMAT THE INC_RA_XXX HEADER AND THEN WRITE ALL THE CUSTOMER04850003
048600*     INCENTIVE SECTION DATA FOLLOWING IT FOR THE STORE GROUP     04860003
048700*     (THIS WOULD ALSO INVOLVE READING THE CINCTV SECT FILE INP02)04870003
048800*                                                                 04880003
048900* (3) FORMAT THE INC_BT_XXX HEADER AND THEN WRITE ALL THE CUSTOMER04890003
049000*     INCENTIVE PARM DATA FOLLOWING IT FOR THE STORE GROUP        04900003
049100*     (THIS WOULD ALSO INVOLVE READING THE CINCTV PARM FILE INP03)04910003
049200*                                                                 04920003
049300* (4) FORMAT THE INC_MD_XXX HEADER AND THEN WRITE ALL THE CUSTOMER04930003
049400*     INCENTIVE MDSE DATA FOLLOWING IT FOR THE STORE GROUP        04940003
049500*     (THIS WOULD ALSO INVOLVE READING THE CINCTV MDSE FILE INP04)04950003
049600*                                                                 04960003
049700*----------------------------------------------------------       04970003
049800 2000-PROCESS-CUST-INCTV.                                         04980003
049900                                                                  04990003
050000**-- INITIALIZE VARIABLES                                         05000006
050100                                                                  05010006
050200     SET PS-CINC-HDR-NOT-WRITEN TO TRUE.                          05020004
050300     SET PS-SECTN-HDR-NOT-WRITEN  TO TRUE                         05030004
050400     SET PS-PARM-HDR-NOT-WRITEN TO TRUE.                          05040004
050500     SET PS-MDSE-HDR-NOT-WRITEN  TO TRUE.                         05050004
050600                                                                  05060006
050700     SET FORM-CST-IN-LEN TO +1.                                   05070006
050800     MOVE 0 TO PV-BYTE-COUNT.                                     05080006
050900     INITIALIZE FORMATTED-CUST-INCTV-REC.                         05090006
051000                                                                  05100004
051100**-- FORMAT INC_DT_XXX HEADER AND THE DETAIL RECORDS              05110006
051200                                                                  05120006
051300     PERFORM 2100-FORMAT-WRT-CINCTV                               05130004
051400        UNTIL EP212-STR-GRP-TYP-CDE NOT = PV-STR-GRP-TYP-CDE      05140009
051500           OR EP212-STR-GRP-ID NOT = PV-STR-GRP-ID-GRP            05150006
051510           OR EP212-STR-FILE-LIST-DTE NOT = PV-FILE-DIST-HDR-DTE  05151027
051600           OR PS-END-OF-CINCTV-FILE.                              05160006
051700                                                                  05170006
051800**-- FORMAT INC_RA_XXX HEADER AND THE DETAIL RECORDS              05180006
051900                                                                  05190006
052000     PERFORM 2200-FORMAT-WRT-CINCTV-SECT                          05200006
052100        UNTIL EP213-STR-GRP-TYP-CDE NOT = PV-STR-GRP-TYP-CDE      05210009
052200           OR EP213-STR-GRP-ID NOT = PV-STR-GRP-ID-GRP            05220006
052210           OR EP213-STR-FILE-LIST-DTE NOT = PV-FILE-DIST-HDR-DTE  05221027
052300           OR PS-END-OF-CINCTV-SEC-FL.                            05230006
052400                                                                  05240006
052500**-- FORMAT INC_BT_XXX HEADER AND THE DETAIL RECORDS              05250006
052600                                                                  05260006
052700     PERFORM 2300-FORMAT-WRT-CINCTV-PARM                          05270006
052800        UNTIL EP214-STR-GRP-TYP-CDE NOT = PV-STR-GRP-TYP-CDE      05280009
052900           OR EP214-STR-GRP-ID NOT = PV-STR-GRP-ID-GRP            05290006
052910           OR EP214-STR-FILE-LIST-DTE NOT = PV-FILE-DIST-HDR-DTE  05291027
053000           OR PS-END-OF-CINCTV-PRM-FL.                            05300006
053100                                                                  05310006
053200**-- FORMAT INC_MD_XXX HEADER AND THE DETAIL RECORDS              05320006
053300                                                                  05330006
053400     PERFORM 2400-FORMAT-WRT-CINCTV-MDSE                          05340006
053500        UNTIL EP215-STR-GRP-TYP-CDE NOT = PV-STR-GRP-TYP-CDE      05350009
053600           OR EP215-STR-GRP-ID NOT = PV-STR-GRP-ID-GRP            05360006
053610           OR EP215-STR-FILE-LIST-DTE NOT = PV-FILE-DIST-HDR-DTE  05361027
053700           OR PS-END-OF-CINCTV-MDS-FL.                            05370006
053800                                                                  05380006
053900     EVALUATE TRUE                                                05390006
054000         WHEN PS-END-OF-CINCTV-FILE                               05400006
054100          AND PS-END-OF-CINCTV-SEC-FL                             05410006
054200          AND PS-END-OF-CINCTV-PRM-FL                             05420006
054300          AND PS-END-OF-CINCTV-MDS-FL                             05430006
054400             SET PS-END-OF-PROCESSING TO TRUE                     05440006
054500                                                                  05450006
054510         WHEN PS-END-OF-CINCTV-FILE                               05451022
054520          AND PS-END-OF-CINCTV-SEC-FL                             05452022
054530          AND PS-END-OF-CINCTV-PRM-FL                             05453022
054540          AND PS-NOT-END-CINCTV-MDS-FL                            05454022
054550                                                                  05455022
054560             SET PS-NOT-END-OF-PROCESSING TO TRUE                 05456022
054570             MOVE EP215-STR-GRP-TYP-CDE TO PV-STR-GRP-TYP-CDE     05457022
054580             MOVE EP215-STR-GRP-ID TO PV-STR-GRP-ID-GRP           05458022
054590             MOVE EP215-STR-FILE-LIST-DTE TO PV-FILE-DIST-HDR-DTE 05459022
054591             MOVE EP215-FILE-ACT-TYP TO PV-FILE-TYPE              05459122
054592             MOVE EP215-APPLY-IND TO PV-APPLY-IND                 05459222
054595                                                                  05459522
054600         WHEN OTHER                                               05460006
054700             PERFORM 3000-DETERMINE-HDR-STR-GRP                   05470006
054800                                                                  05480006
054900     END-EVALUATE.                                                05490006
055000                                                                  05500006
055100*2000-EXIT.                                                       05510006
055300                                                                  05530006
055400*-------------------------------------------------------------    05540006
055500* 2100-FORMAT-WRT-CINCTV.                                         05550006
055600*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   05560006
055700*     RECORD FOR XST_CUST_INCTV TABLE.                            05570006
055800*-------------------------------------------------------------    05580004
055900 2100-FORMAT-WRT-CINCTV.                                          05590004
056000                                                                  05600004
056100     IF PS-CINC-HDR-NOT-WRITEN                                    05610004
056200        SET EP217-XST-DETAIL TO TRUE                              05620006
056300        PERFORM 2500-MOVE-VALUES-AND-WRITE-HDR                    05630009
056400        SET PS-CINC-HDR-WRITEN  TO TRUE                           05640004
056500     END-IF.                                                      05650004
056600                                                                  05660004
056700*-- INITIALIZE VARIABLES FOR DETAIL RECORD                        05670006
056800                                                                  05680006
056900     SET FORM-CST-IN-LEN TO +1.                                   05690006
057000     MOVE 0 TO PV-BYTE-COUNT.                                     05700006
057100     INITIALIZE FORMATTED-CUST-INCTV-REC.                         05710006
057200                                                                  05720006
057300*-- FORMAT RECORD ACTION                                          05730007
057400                                                                  05740007
057500     MOVE EP212-RECORD-ACTION TO PV-RECORD-ACTION.                05750007
057600     PERFORM 3100-MOVE-DELIMITER.                                 05760007
057700     PERFORM 3900-MOVE-RECORD-ACTION.                             05770007
057800     PERFORM 3100-MOVE-DELIMITER.                                 05780007
057900                                                                  05790007
058000*-- FORMAT SYS-OF-REC-ID         NOT NULL                         05800007
058100                                                                  05810007
058200     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         05820007
058300     INITIALIZE PV-TALLY.                                         05830007
058400                                                                  05840007
058500     EVALUATE TRUE                                                05850007
058600         WHEN EP212-SYS-OF-REC-ID  = 0                            05860007
058700             PERFORM 2700-MOVE-ZERO                               05870007
058800         WHEN OTHER                                               05880007
058900             MOVE EP212-SYS-OF-REC-ID TO PV-SYS-OF-REC-ID         05890007
059000             PERFORM 3200-MOVE-SYS-REC-ID                         05900007
059100     END-EVALUATE.                                                05910007
059200                                                                  05920007
059300     PERFORM 3100-MOVE-DELIMITER.                                 05930007
059400                                                                  05940007
059500*-- FORMAT SYSTEM IDENTIFIER     NOT NULL                         05950007
059600     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           05960007
059700                                                                  05970007
059800     MOVE EP212-SYS-IDENTIFIER TO PV-SRC-SYS-ID.                  05980039
059900     PERFORM 3300-MOVE-SRC-SYS-ID.                                05990039
060000     PERFORM 3100-MOVE-DELIMITER.                                 06000007
060100                                                                  06010007
060200*-- FORMAT SCHEME CODE           NOT NULL                         06020007
060300     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06030007
060400                                                                  06040007
060500     MOVE EP212-PROMO-SCHEME-CDE TO  PV-VARIABLE-CHAR-FIELD.      06050039
060600                                                                  06060007
060700     PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX            06070007
060800        FROM 4 BY -1                                              06080007
060900        UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX) NOT = SPACE.    06090039
061000                                                                  06100007
061100     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06110007
061200        FROM 1 BY 1                                               06120007
061300        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    06130039
061400                                                                  06140007
061500     PERFORM 3100-MOVE-DELIMITER.                                 06150007
061600                                                                  06160007
061700*-- FORMAT INCTV-TYP-CDE         NOT NULL                         06170007
061800     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06180007
061900                                                                  06190007
062000     MOVE EP212-INCTV-TYP-CDE TO PV-VARIABLE-CHAR-FIELD.          06200039
062100     PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX            06210007
062200        FROM 3 BY -1                                              06220007
062300        UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX) NOT = SPACE.    06230039
062400                                                                  06240007
062500     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06250007
062600        FROM 1 BY 1                                               06260007
062700        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    06270039
062800                                                                  06280007
062900     PERFORM 3100-MOVE-DELIMITER.                                 06290007
063000                                                                  06300007
063100*-- FORMAT INCTV NAME            NOT NULL                         06310007
063200                                                                  06320007
063300     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06330007
063400                                                                  06340007
063500     EVALUATE TRUE                                                06350007
063600         WHEN EP212-INCTV-NM = SPACES                             06360007
063700            PERFORM 3500-MOVE-SPACE                               06370007
063800         WHEN OTHER                                               06380007
063900             MOVE EP212-INCTV-NM TO PV-VARIABLE-CHAR-FIELD        06390007
064000             PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    06400007
064100                FROM 50 BY -1                                     06410007
064200                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         06420007
064300                                                NOT = SPACE       06430007
064400                                                                  06440007
064500             PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   06450007
064600             FROM 1 BY 1                                          06460007
064700              UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX               06470007
064800     END-EVALUATE.                                                06480007
064900                                                                  06490007
065000     PERFORM 3100-MOVE-DELIMITER.                                 06500007
065100                                                                  06510007
065200*-- FORMAT INCTV-TRGR-TYPE-CDE   NOT NULL                         06520007
065300                                                                  06530007
065400     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           06540007
065500                                                                  06550007
065600     MOVE EP212-INCTV-TRGR-TYP-CDE TO PV-VARIABLE-CHAR-FIELD      06560007
065700                                                                  06570007
065800     SET PV-CHR-EOF-IDX TO +3                                     06580007
065900     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           06590007
066000        FROM 1 BY 1                                               06600007
066100         UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                   06610007
066200                                                                  06620007
066300     PERFORM 3100-MOVE-DELIMITER.                                 06630007
066400                                                                  06640007
066500*-- FORMAT GROUP ID              NOT NULL                         06650007
066600     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         06660007
066700     INITIALIZE PV-TALLY.                                         06670007
066800                                                                  06680007
066900     EVALUATE TRUE                                                06690007
067000         WHEN EP212-SYS-OF-REC-GP-ID = 0                          06700007
067100             PERFORM 2700-MOVE-ZERO                               06710007
067200         WHEN OTHER                                               06720007
067300             INSPECT EP212-SYS-OF-REC-GP-ID TALLYING PV-TALLY     06730007
067400                FOR LEADING ZEROES                                06740007
067500             SET PV-BIT-IDX TO PV-TALLY                           06750007
067600             SET PV-BIT-IDX UP BY +1                              06760007
067700             MOVE EP212-SYS-OF-REC-GP-ID TO                       06770007
067800                                        PV-VARIABLE-OUTPUT-FIELD  06780007
067900             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    06790007
068000                FROM PV-BIT-IDX BY +1                             06800007
068100                UNTIL PV-EOF-IDX > 10                             06810007
068200     END-EVALUATE.                                                06820007
068300                                                                  06830007
068400     PERFORM 3100-MOVE-DELIMITER.                                 06840007
068401                                                                  06840113
068410     PERFORM 4000-WRITE-DTL-RECORD.                               06841013
068500                                                                  06850007
068510     PERFORM 6000-READ-CINCTV-FILE.                               06851014
068600                                                                  06860007
068700*2100-EXIT.                                                       06870007
068900                                                                  06890007
069000*-------------------------------------------------------------    06900007
069100* 2200-FORMAT-WRT-CINCTV-SECT                                     06910007
069200*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   06920007
069300*     RECORD FOR XST_CUST_INCTV_SECT TABLE.                       06930007
069400*-------------------------------------------------------------    06940007
069500 2200-FORMAT-WRT-CINCTV-SECT.                                     06950007
069600                                                                  06960007
069700     IF PS-SECTN-HDR-NOT-WRITEN                                   06970007
069800        SET EP217-XST-FIL-SECT TO TRUE                            06980007
069900        PERFORM 2500-MOVE-VALUES-AND-WRITE-HDR                    06990009
070000        SET PS-SECTN-HDR-WRITEN TO TRUE                           07000007
070100     END-IF.                                                      07010007
070200                                                                  07020007
070210*    DISPLAY '  REACHED HERE AFTER WRITING HEADER IN SECT '       07021028
070300*-- INITIALIZE VARIABLES FOR DETAIL RECORD                        07030007
070400                                                                  07040007
070500     SET FORM-CST-IN-LEN TO +1.                                   07050007
070600     MOVE 0 TO PV-BYTE-COUNT.                                     07060007
070700     INITIALIZE FORMATTED-CUST-INCTV-REC.                         07070007
070800                                                                  07080007
070900*-- FORMAT RECORD ACTION                                          07090007
071000                                                                  07100007
071100     MOVE EP213-RECORD-ACTION TO PV-RECORD-ACTION.                07110007
071200     PERFORM 3100-MOVE-DELIMITER.                                 07120007
071300     PERFORM 3900-MOVE-RECORD-ACTION.                             07130007
071400     PERFORM 3100-MOVE-DELIMITER.                                 07140007
071500                                                                  07150007
071600*-- FORMAT SYS-OF-REC-ID         NOT NULL                         07160007
071700     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         07170007
071800     INITIALIZE PV-TALLY.                                         07180007
071900                                                                  07190007
072000     EVALUATE TRUE                                                07200007
072100         WHEN EP213-SYS-OF-REC-ID  = 0                            07210007
072200             PERFORM 2700-MOVE-ZERO                               07220007
072300         WHEN OTHER                                               07230007
072400             MOVE EP213-SYS-OF-REC-ID TO PV-SYS-OF-REC-ID         07240007
072500             PERFORM 3200-MOVE-SYS-REC-ID                         07250007
072600     END-EVALUATE.                                                07260007
072700                                                                  07270007
072800     PERFORM 3100-MOVE-DELIMITER.                                 07280007
072900                                                                  07290007
073000*-- FORMAT SYSTEM IDENTIFIER     NOT NULL                         07300007
073100                                                                  07310007
073200     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07320007
073300                                                                  07330007
073400     MOVE EP213-SYS-IDENTIFIER TO PV-SRC-SYS-ID.                  07340039
073500     PERFORM 3300-MOVE-SRC-SYS-ID.                                07350039
073600     PERFORM 3100-MOVE-DELIMITER.                                 07360007
073700                                                                  07370007
073800*-- FORMAT SECTION TYPE CODE     NOT NULL                         07380007
073900                                                                  07390007
074000     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07400007
074100                                                                  07410007
074200     MOVE EP213-INCTV-SECT-TYP-CDE TO PV-VARIABLE-CHAR-FIELD.     07420007
074300     SET PV-CHR-EOF-IDX TO +1.                                    07430039
074400                                                                  07440007
074500     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           07450007
074600        FROM 1 BY 1                                               07460007
074700        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    07470039
074800                                                                  07480007
074900     PERFORM 3100-MOVE-DELIMITER.                                 07490007
075000                                                                  07500007
075100*-- FORMAT EFF BEG TMST          NOT NULL                         07510007
075200                                                                  07520007
075300     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07530007
075400                                                                  07540007
075500     MOVE EP213-INCTV-BEG-TMST     TO PV-VARIABLE-CHAR-FIELD.     07550007
075600                                                                  07560007
075700     PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX            07570007
075800        FROM 19 BY -1                                             07580007
075900        UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)  NOT = SPACE.   07590039
076000                                                                  07600007
076100     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           07610007
076200        FROM 1 BY 1                                               07620007
076300        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    07630039
076400                                                                  07640007
076500     PERFORM 3100-MOVE-DELIMITER.                                 07650007
076600                                                                  07660007
076700*-- FORMAT EFF END TMST          NOT NULL                         07670007
076800                                                                  07680007
076900     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07690007
077000                                                                  07700007
077100     MOVE EP213-INCTV-END-TMST     TO PV-VARIABLE-CHAR-FIELD.     07710007
077200                                                                  07720007
077300     PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX            07730007
077400        FROM 19 BY -1                                             07740007
077500        UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)  NOT = SPACE.   07750039
077600                                                                  07760007
077700     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           07770007
077800        FROM 1 BY 1                                               07780007
077900        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    07790039
078000                                                                  07800007
078100     PERFORM 3100-MOVE-DELIMITER.                                 07810007
078200                                                                  07820007
078300*-- FORMAT BUY CONNECTOR CODE        NULL                         07830007
078400                                                                  07840007
078500     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           07850007
078600                                                                  07860007
078700     EVALUATE TRUE                                                07870007
078800         WHEN EP213-BUY-CNCTR-CDE = '~'                           07880007
078900             PERFORM 2900-MOVE-NULL-VALUE                         07890007
079000         WHEN EP213-BUY-CNCTR-CDE = SPACES                        07900007
079100             PERFORM 3500-MOVE-SPACE                              07910007
079200         WHEN OTHER                                               07920007
079300             MOVE EP213-BUY-CNCTR-CDE TO PV-VARIABLE-CHAR-FIELD   07930007
079400                                                                  07940007
079500             PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    07950007
079600                FROM 3 BY -1                                      07960007
079700                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         07970007
079800                                                      NOT = SPACE 07980007
079900                                                                  07990007
080000             PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   08000007
080100                FROM 1 BY 1                                       08010007
080200                UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX             08020007
080300     END-EVALUATE.                                                08030007
080400                                                                  08040007
080500     PERFORM 3100-MOVE-DELIMITER.                                 08050007
080600                                                                  08060007
080700*-- FORMAT GET CONNECTOR CODE        NULL                         08070007
080800                                                                  08080007
080900     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           08090007
081000                                                                  08100007
081100     EVALUATE TRUE                                                08110007
081200         WHEN EP213-GET-CNCTR-CDE = '~'                           08120007
081300             PERFORM 2900-MOVE-NULL-VALUE                         08130007
081400         WHEN EP213-GET-CNCTR-CDE = SPACES                        08140007
081500             PERFORM 3500-MOVE-SPACE                              08150007
081600         WHEN OTHER                                               08160007
081700             MOVE EP213-GET-CNCTR-CDE TO PV-VARIABLE-CHAR-FIELD   08170007
081800                                                                  08180007
081900             PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    08190007
082000                FROM 3 BY -1                                      08200007
082100                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         08210007
082200                                                      NOT = SPACE 08220007
082300                                                                  08230007
082400             PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   08240007
082500                FROM 1 BY 1                                       08250007
082600                UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX             08260007
082700     END-EVALUATE.                                                08270007
082800                                                                  08280007
082900     PERFORM 3100-MOVE-DELIMITER.                                 08290007
083000                                                                  08300007
083100*-- FORMAT CUSTFACG SHRT DESC        NULL                         08310007
083200                                                                  08320007
083300     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           08330007
083400                                                                  08340007
083500     EVALUATE TRUE                                                08350007
083600         WHEN EP213-CUST-SHRT-DESC = '~'                          08360007
083700             PERFORM 2900-MOVE-NULL-VALUE                         08370007
083800         WHEN EP213-CUST-SHRT-DESC = SPACES                       08380007
083900             PERFORM 3500-MOVE-SPACE                              08390007
084000         WHEN OTHER                                               08400007
084100             MOVE EP213-CUST-SHRT-DESC TO PV-VARIABLE-CHAR-FIELD  08410007
084200                                                                  08420007
084300             PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    08430007
084400                FROM 20 BY -1                                     08440007
084500                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         08450007
084600                                                       NOT = SPACE08460007
084700                                                                  08470007
084800             PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   08480007
084900                FROM 1 BY 1                                       08490007
085000                UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX             08500007
085100     END-EVALUATE.                                                08510007
085200                                                                  08520007
085300     PERFORM 3100-MOVE-DELIMITER.                                 08530007
085400                                                                  08540007
085500*-- FORMAT LIMIT PER TRAN QTY    NOT NULL                         08550007
085600                                                                  08560007
085700     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         08570007
085800     INITIALIZE PV-TALLY.                                         08580007
085900                                                                  08590007
086000     EVALUATE TRUE                                                08600007
086100         WHEN EP213-LMT-PER-TRN-QTY  = 0                          08610007
086200             PERFORM 2700-MOVE-ZERO                               08620007
086300         WHEN OTHER                                               08630007
086400             INSPECT EP213-LMT-PER-TRN-QTY  TALLYING PV-TALLY     08640007
086500                FOR LEADING ZEROES                                08650007
086600             SET PV-BIT-IDX TO PV-TALLY                           08660007
086700             SET PV-BIT-IDX UP BY +1                              08670007
086800             MOVE EP213-LMT-PER-TRN-QTY  TO                       08680007
086900                                        PV-VARIABLE-OUTPUT-FIELD  08690007
087000             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    08700007
087100                FROM PV-BIT-IDX BY +1                             08710007
087200                UNTIL PV-EOF-IDX > 5                              08720018
087300     END-EVALUATE.                                                08730007
087400                                                                  08740007
087500     PERFORM 3100-MOVE-DELIMITER.                                 08750007
087600                                                                  08760007
087610     PERFORM 4000-WRITE-DTL-RECORD.                               08761013
087620                                                                  08762013
087630     PERFORM 6200-READ-CINCTV-SECT-FILE.                          08763014
087640                                                                  08764014
087700*2200-EXIT.                                                       08770007
087900                                                                  08790007
088000*-------------------------------------------------------------    08800007
088100* 2300-FORMAT-WRT-CINCTV-PARM                                     08810007
088200*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   08820007
088300*     RECORD FOR XST_CUST_INCTV_PARM TABLE.                       08830007
088400*-------------------------------------------------------------    08840007
088500 2300-FORMAT-WRT-CINCTV-PARM.                                     08850007
088600                                                                  08860007
088700     IF PS-PARM-HDR-NOT-WRITEN                                    08870007
088800        SET EP217-XST-FIL-PARM TO TRUE                            08880007
088900        PERFORM 2500-MOVE-VALUES-AND-WRITE-HDR                    08890009
089000        SET PS-PARM-HDR-WRITEN  TO TRUE                           08900007
089100     END-IF.                                                      08910007
089200                                                                  08920007
089210*    DISPLAY '  REACHED HERE AFTER WRITING HEADER IN PARM '       08921028
089300*-- INITIALIZE VARIABLES FOR DETAIL RECORD                        08930007
089400                                                                  08940007
089500     SET FORM-CST-IN-LEN TO +1.                                   08950007
089600     MOVE 0 TO PV-BYTE-COUNT.                                     08960007
089700     INITIALIZE FORMATTED-CUST-INCTV-REC.                         08970007
089800                                                                  08980007
089900*-- FORMAT RECORD ACTION                                          08990007
090000                                                                  09000007
090100     MOVE EP214-RECORD-ACTION TO PV-RECORD-ACTION.                09010007
090200     PERFORM 3100-MOVE-DELIMITER.                                 09020007
090300     PERFORM 3900-MOVE-RECORD-ACTION.                             09030007
090400     PERFORM 3100-MOVE-DELIMITER.                                 09040007
090500                                                                  09050007
090600*-- FORMAT SYS-OF-REC-ID         NOT NULL                         09060007
090700     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         09070007
090800     INITIALIZE PV-TALLY.                                         09080007
090900                                                                  09090007
091000     EVALUATE TRUE                                                09100007
091100         WHEN EP214-SYS-OF-REC-ID  = 0                            09110007
091200             PERFORM 2700-MOVE-ZERO                               09120007
091300         WHEN OTHER                                               09130007
091400             MOVE EP214-SYS-OF-REC-ID TO PV-SYS-OF-REC-ID         09140007
091500             PERFORM 3200-MOVE-SYS-REC-ID                         09150007
091600     END-EVALUATE.                                                09160007
091700                                                                  09170007
091800     PERFORM 3100-MOVE-DELIMITER.                                 09180007
091900                                                                  09190007
092000*-- FORMAT SYSTEM IDENTIFIER     NOT NULL                         09200007
092100                                                                  09210007
092200     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09220007
092300                                                                  09230007
092400     MOVE EP214-SYS-IDENTIFIER TO PV-SRC-SYS-ID.                  09240039
092500     PERFORM 3300-MOVE-SRC-SYS-ID.                                09250039
092600     PERFORM 3100-MOVE-DELIMITER.                                 09260007
092700                                                                  09270007
092800*-- FORMAT SECTION TYPE CODE     NOT NULL                         09280007
092900                                                                  09290007
093000     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09300007
093100                                                                  09310007
093200     MOVE EP214-INCTV-SECT-TYP-CDE TO PV-VARIABLE-CHAR-FIELD.     09320007
093300     SET PV-CHR-EOF-IDX TO +1.                                    09330039
093400                                                                  09340007
093500     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           09350007
093600        FROM 1 BY 1                                               09360007
093700        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    09370039
093800                                                                  09380007
093900     PERFORM 3100-MOVE-DELIMITER.                                 09390007
094000                                                                  09400007
094100*-- FORMAT SYS-OF-REC-SUB-ID     NOT NULL                         09410007
094200                                                                  09420007
094300     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         09430007
094400     INITIALIZE PV-TALLY.                                         09440007
094500                                                                  09450007
094600     EVALUATE TRUE                                                09460007
094700         WHEN EP214-SYS-REC-SUB-ID = 0                            09470007
094800             PERFORM 2700-MOVE-ZERO                               09480007
094900         WHEN OTHER                                               09490007
095000             INSPECT EP214-SYS-REC-SUB-ID  TALLYING PV-TALLY      09500007
095100                FOR LEADING ZEROES                                09510007
095200             SET PV-BIT-IDX TO PV-TALLY                           09520007
095300             SET PV-BIT-IDX UP BY +1                              09530007
095400             MOVE EP214-SYS-REC-SUB-ID  TO                        09540007
095500                                        PV-VARIABLE-OUTPUT-FIELD  09550007
095600             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    09560007
095700                FROM PV-BIT-IDX BY +1                             09570007
095800                UNTIL PV-EOF-IDX > 10                             09580007
095900     END-EVALUATE.                                                09590007
096000                                                                  09600007
096100     PERFORM 3100-MOVE-DELIMITER.                                 09610007
096200                                                                  09620007
096300*-- FORMAT SELN-TYP-CDE          NOT NULL                         09630007
096400                                                                  09640007
096500     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           09650007
096600                                                                  09660007
096700     EVALUATE TRUE                                                09670007
096800         WHEN EP213-GET-CNCTR-CDE = SPACES                        09680007
096900             PERFORM 3500-MOVE-SPACE                              09690007
097000         WHEN OTHER                                               09700007
097100             MOVE EP214-SELN-TYP-CDE  TO PV-VARIABLE-CHAR-FIELD   09710007
097200                                                                  09720007
097300             PERFORM 2800-FIND-DATA-END VARYING PV-CHR-EOF-IDX    09730007
097400                FROM 3 BY -1                                      09740007
097500                UNTIL PV-BIT-CHR-VARIABLE(PV-CHR-EOF-IDX)         09750007
097600                                                      NOT = SPACE 09760007
097700                                                                  09770007
097800             PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX   09780007
097900                FROM 1 BY 1                                       09790007
098000                UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX             09800007
098100     END-EVALUATE.                                                09810007
098200                                                                  09820007
098300     PERFORM 3100-MOVE-DELIMITER.                                 09830007
098400                                                                  09840007
098500*-- FORMAT TIER LVL NUM          NOT NULL                         09850007
098600                                                                  09860007
098700     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         09870007
098800     INITIALIZE PV-TALLY.                                         09880007
098900                                                                  09890007
099000     EVALUATE TRUE                                                09900007
099100         WHEN EP214-TIER-LVL-NBR = 0                              09910007
099200             PERFORM 2700-MOVE-ZERO                               09920007
099300         WHEN OTHER                                               09930007
099400             INSPECT EP214-TIER-LVL-NBR TALLYING PV-TALLY         09940007
099500                FOR LEADING ZEROES                                09950007
099600             SET PV-BIT-IDX TO PV-TALLY                           09960007
099700             SET PV-BIT-IDX UP BY +1                              09970007
099800             MOVE EP214-TIER-LVL-NBR TO                           09980007
099900                                        PV-VARIABLE-OUTPUT-FIELD  09990007
100000             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10000007
100100                FROM PV-BIT-IDX BY +1                             10010007
100200                UNTIL PV-EOF-IDX > 5                              10020015
100300     END-EVALUATE.                                                10030007
100400                                                                  10040007
100500     PERFORM 3100-MOVE-DELIMITER.                                 10050007
100600                                                                  10060007
100700*-- FORMAT INCTV-BUY-QTY             NULL                         10070007
100800                                                                  10080007
100900     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10090007
101000     INITIALIZE PV-TALLY.                                         10100007
101100                                                                  10110007
101200     EVALUATE TRUE                                                10120007
101300         WHEN EP214-INCTV-BUY-QTY-NL = '~'                        10130007
101400             PERFORM 2900-MOVE-NULL-VALUE                         10140009
101500         WHEN EP214-INCTV-BUY-QTY = 0                             10150007
101600             PERFORM 2700-MOVE-ZERO                               10160007
101700         WHEN OTHER                                               10170007
101800             INSPECT EP214-INCTV-BUY-QTY TALLYING PV-TALLY        10180007
101900                FOR LEADING ZEROES                                10190007
102000             SET PV-BIT-IDX TO PV-TALLY                           10200007
102100             SET PV-BIT-IDX UP BY +1                              10210007
102200             MOVE EP214-INCTV-BUY-QTY TO                          10220007
102300                                        PV-VARIABLE-OUTPUT-FIELD  10230007
102400             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10240007
102500                FROM PV-BIT-IDX BY +1                             10250007
102600                UNTIL PV-EOF-IDX > 5                              10260008
102700     END-EVALUATE.                                                10270007
102800                                                                  10280007
102900     PERFORM 3100-MOVE-DELIMITER.                                 10290007
103000                                                                  10300007
103100*-- FORMAT INCTV-BUY-AMT             NULL                         10310007
103200                                                                  10320007
103300     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10330007
103400     INITIALIZE PV-TALLY.                                         10340007
103500                                                                  10350007
103600     EVALUATE TRUE                                                10360007
103700         WHEN EP214-INCTV-BUY-AMT-NL = '~'                        10370007
103800             PERFORM 2900-MOVE-NULL-VALUE                         10380009
103900         WHEN EP214-INCTV-BUY-AMT = 0                             10390007
103910             MOVE '.00' TO PV-VARIABLE-OUTPUT-FIELD               10391008
104000             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10400008
104010                FROM 1 BY 1                                       10401008
104020                UNTIL PV-EOF-IDX > 3                              10402008
104100         WHEN OTHER                                               10410007
104200             INSPECT EP214-INCTV-BUY-AMT TALLYING PV-TALLY        10420008
104300                FOR LEADING ZEROES                                10430007
104400             SET PV-BIT-IDX TO PV-TALLY                           10440007
104401                                                                  10440108
104410             EVALUATE TRUE                                        10441008
104420                 WHEN PV-BIT-IDX < 7                              10442008
104421                    SET PV-BIT-IDX UP BY +1                       10442108
104422                 WHEN PV-BIT-IDX = 8                              10442208
104423                    SET PV-BIT-IDX DOWN BY +1                     10442308
104424             END-EVALUATE                                         10442408
104425                                                                  10442508
104600             MOVE EP214-INCTV-BUY-AMT TO                          10460008
104700                                        PV-VARIABLE-OUTPUT-FIELD  10470007
104800             PERFORM 3700-MOVE-AMOUNT-DATA  VARYING PV-EOF-IDX    10480015
104900                FROM PV-BIT-IDX BY +1                             10490007
105000                UNTIL PV-EOF-IDX > 9                              10500008
105100     END-EVALUATE.                                                10510007
105200                                                                  10520007
105300     PERFORM 3100-MOVE-DELIMITER.                                 10530007
105310                                                                  10531008
105400*-- FORMAT INCTV-BUY-TOL-AMT         NULL                         10540007
105500                                                                  10550007
105510     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10551008
105520     INITIALIZE PV-TALLY.                                         10552008
105530                                                                  10553008
105540     EVALUATE TRUE                                                10554008
105550         WHEN EP214-INCTV-BUY-TOL-AMT-NL = '~'                    10555008
105560             PERFORM 2900-MOVE-NULL-VALUE                         10556009
105570         WHEN EP214-INCTV-BUY-TOL-AMT = 0                         10557008
105580             MOVE '.00' TO PV-VARIABLE-OUTPUT-FIELD               10558008
105590             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10559008
105591                FROM 1 BY 1                                       10559108
105592                UNTIL PV-EOF-IDX > 3                              10559208
105593         WHEN OTHER                                               10559308
105594             INSPECT EP214-INCTV-BUY-TOL-AMT TALLYING PV-TALLY    10559408
105595                FOR LEADING ZEROES                                10559508
105596             SET PV-BIT-IDX TO PV-TALLY                           10559608
105597                                                                  10559708
105598             EVALUATE TRUE                                        10559808
105599                 WHEN PV-BIT-IDX < 7                              10559908
105600                    SET PV-BIT-IDX UP BY +1                       10560008
105601                 WHEN PV-BIT-IDX = 8                              10560108
105602                    SET PV-BIT-IDX DOWN BY +1                     10560208
105603             END-EVALUATE                                         10560308
105604                                                                  10560408
105605             MOVE EP214-INCTV-BUY-TOL-AMT TO                      10560508
105606                                        PV-VARIABLE-OUTPUT-FIELD  10560608
105607             PERFORM 3700-MOVE-AMOUNT-DATA VARYING PV-EOF-IDX     10560715
105608                FROM PV-BIT-IDX BY +1                             10560808
105609                UNTIL PV-EOF-IDX > 9                              10560908
105610     END-EVALUATE.                                                10561008
105611                                                                  10561108
105612     PERFORM 3100-MOVE-DELIMITER.                                 10561208
105613                                                                  10561308
105620*-- FORMAT INCTV-GET-QTY             NULL                         10562007
105700                                                                  10570007
105710     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10571008
105720     INITIALIZE PV-TALLY.                                         10572008
105730                                                                  10573008
105740     EVALUATE TRUE                                                10574008
105750         WHEN EP214-INCTV-GET-QTY-NL = '~'                        10575008
105760             PERFORM 2900-MOVE-NULL-VALUE                         10576009
105770         WHEN EP214-INCTV-GET-QTY = 0                             10577008
105780             PERFORM 2700-MOVE-ZERO                               10578008
105790         WHEN OTHER                                               10579008
105791             INSPECT EP214-INCTV-GET-QTY TALLYING PV-TALLY        10579108
105792                FOR LEADING ZEROES                                10579208
105793             SET PV-BIT-IDX TO PV-TALLY                           10579308
105794             SET PV-BIT-IDX UP BY +1                              10579408
105795             MOVE EP214-INCTV-GET-QTY TO                          10579508
105796                                        PV-VARIABLE-OUTPUT-FIELD  10579608
105797             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10579708
105798                FROM PV-BIT-IDX BY +1                             10579808
105799                UNTIL PV-EOF-IDX > 5                              10579908
105800     END-EVALUATE.                                                10580008
105801                                                                  10580108
105802     PERFORM 3100-MOVE-DELIMITER.                                 10580208
105803                                                                  10580308
105810*-- FORMAT INCTV-PCT-OFF-PCT         NULL                         10581007
105900                                                                  10590007
105910     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10591008
105920     INITIALIZE PV-TALLY.                                         10592008
105930                                                                  10593008
105940     EVALUATE TRUE                                                10594008
105950         WHEN EP214-INCTV-PCT-OFF-NL = '~'                        10595008
105960             PERFORM 2900-MOVE-NULL-VALUE                         10596009
105970         WHEN EP214-INCTV-PCT-OFF = 0                             10597008
105980             PERFORM 2700-MOVE-ZERO                               10598008
105990         WHEN OTHER                                               10599008
105991             INSPECT EP214-INCTV-PCT-OFF TALLYING PV-TALLY        10599108
105992                FOR LEADING ZEROES                                10599208
105993             SET PV-BIT-IDX TO PV-TALLY                           10599308
105994             SET PV-BIT-IDX UP BY +1                              10599408
105995             MOVE EP214-INCTV-PCT-OFF TO                          10599515
105996                                        PV-VARIABLE-OUTPUT-FIELD  10599608
105997             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10599708
105998                FROM PV-BIT-IDX BY +1                             10599808
105999                UNTIL PV-EOF-IDX > 3                              10599908
106000     END-EVALUATE.                                                10600008
106001                                                                  10600108
106002     PERFORM 3100-MOVE-DELIMITER.                                 10600208
106003                                                                  10600308
106010*-- FORMAT INCTV-DOL-OFF-AMT         NULL                         10601007
106100                                                                  10610007
106110     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10611008
106120     INITIALIZE PV-TALLY.                                         10612008
106130                                                                  10613008
106140     EVALUATE TRUE                                                10614008
106150         WHEN EP214-INCTV-DOL-OFF-AMT-NL = '~'                    10615008
106160             PERFORM 2900-MOVE-NULL-VALUE                         10616009
106170         WHEN EP214-INCTV-DOL-OFF-AMT = 0                         10617008
106180             MOVE '.00' TO PV-VARIABLE-OUTPUT-FIELD               10618008
106190             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10619008
106191                FROM 1 BY 1                                       10619108
106192                UNTIL PV-EOF-IDX > 3                              10619208
106193         WHEN OTHER                                               10619308
106194             INSPECT EP214-INCTV-DOL-OFF-AMT TALLYING PV-TALLY    10619408
106195                FOR LEADING ZEROES                                10619508
106196             SET PV-BIT-IDX TO PV-TALLY                           10619608
106197                                                                  10619708
106198             EVALUATE TRUE                                        10619808
106199                 WHEN PV-BIT-IDX < 7                              10619908
106200                    SET PV-BIT-IDX UP BY +1                       10620008
106201                 WHEN PV-BIT-IDX = 8                              10620108
106202                    SET PV-BIT-IDX DOWN BY +1                     10620208
106203             END-EVALUATE                                         10620308
106204                                                                  10620408
106205             MOVE EP214-INCTV-DOL-OFF-AMT TO                      10620508
106206                                        PV-VARIABLE-OUTPUT-FIELD  10620608
106207             PERFORM 3700-MOVE-AMOUNT-DATA VARYING PV-EOF-IDX     10620715
106208                FROM PV-BIT-IDX BY +1                             10620808
106209                UNTIL PV-EOF-IDX > 9                              10620908
106210     END-EVALUATE.                                                10621008
106211                                                                  10621108
106212     PERFORM 3100-MOVE-DELIMITER.                                 10621208
106213                                                                  10621308
106220*-- FORMAT INCTV-PRC-PNT-AMT         NULL                         10622007
106221                                                                  10622108
106230     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10623008
106240     INITIALIZE PV-TALLY.                                         10624008
106250                                                                  10625008
106260     EVALUATE TRUE                                                10626008
106270         WHEN EP214-INCTV-PRC-PNT-AMT-NL = '~'                    10627008
106280             PERFORM 2900-MOVE-NULL-VALUE                         10628009
106290         WHEN EP214-INCTV-PRC-PNT-AMT = 0                         10629008
106291             MOVE '.00' TO PV-VARIABLE-OUTPUT-FIELD               10629108
106292             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10629208
106293                FROM 1 BY 1                                       10629308
106294                UNTIL PV-EOF-IDX > 3                              10629408
106295         WHEN OTHER                                               10629508
106296             INSPECT EP214-INCTV-PRC-PNT-AMT TALLYING PV-TALLY    10629608
106297                FOR LEADING ZEROES                                10629708
106298             SET PV-BIT-IDX TO PV-TALLY                           10629808
106299                                                                  10629908
106300             EVALUATE TRUE                                        10630008
106301                 WHEN PV-BIT-IDX < 7                              10630108
106302                    SET PV-BIT-IDX UP BY +1                       10630208
106303                 WHEN PV-BIT-IDX = 8                              10630308
106304                    SET PV-BIT-IDX DOWN BY +1                     10630408
106305             END-EVALUATE                                         10630508
106306                                                                  10630608
106307             MOVE EP214-INCTV-PRC-PNT-AMT TO                      10630708
106308                                        PV-VARIABLE-OUTPUT-FIELD  10630808
106309             PERFORM 3700-MOVE-AMOUNT-DATA VARYING PV-EOF-IDX     10630915
106310                FROM PV-BIT-IDX BY +1                             10631008
106311                UNTIL PV-EOF-IDX > 9                              10631108
106312     END-EVALUATE.                                                10631208
106313                                                                  10631308
106314     PERFORM 3100-MOVE-DELIMITER.                                 10631408
106320                                                                  10632007
106330     PERFORM 4000-WRITE-DTL-RECORD.                               10633013
106340                                                                  10634013
106350     PERFORM 6400-READ-CINCTV-PARM-FILE.                          10635014
106360                                                                  10636014
106400*2300-EXIT.                                                       10640007
106600                                                                  10660007
106700*-------------------------------------------------------------    10670007
106800* 2400-FORMAT-WRT-CINCTV-MDSE                                     10680007
106900*     THIS PARAGRAPH WILL ADD HEADER RECORD AND FORMAT THE DATA   10690007
107000*     RECORD FOR XST_CUST_INCTV_MDSE TABLE.                       10700007
107100*-------------------------------------------------------------    10710007
107200 2400-FORMAT-WRT-CINCTV-MDSE.                                     10720007
107300                                                                  10730007
107400     IF PS-MDSE-HDR-NOT-WRITEN                                    10740007
107500        SET EP217-XST-FIL-MDSE-SET TO TRUE                        10750007
107600        PERFORM 2500-MOVE-VALUES-AND-WRITE-HDR                    10760009
107700        SET PS-MDSE-HDR-WRITEN  TO TRUE                           10770007
107800     END-IF.                                                      10780007
107900                                                                  10790007
108000*-- INITIALIZE VARIABLES FOR DETAIL RECORD                        10800007
108100                                                                  10810007
108200     SET FORM-CST-IN-LEN TO +1.                                   10820007
108300     MOVE 0 TO PV-BYTE-COUNT.                                     10830007
108400     INITIALIZE FORMATTED-CUST-INCTV-REC.                         10840007
108500                                                                  10850007
108510*-- FORMAT RECORD ACTION                                          10851008
108520                                                                  10852008
108530     MOVE EP215-RECORD-ACTION TO PV-RECORD-ACTION.                10853008
108540     PERFORM 3100-MOVE-DELIMITER.                                 10854008
108550     PERFORM 3900-MOVE-RECORD-ACTION.                             10855008
108560     PERFORM 3100-MOVE-DELIMITER.                                 10856008
108570                                                                  10857008
108600*-- FORMAT MDSE-SET-ID           NOT NULL                         10860007
108700                                                                  10870007
108710     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10871008
108720     INITIALIZE PV-TALLY.                                         10872008
108730                                                                  10873008
108740     EVALUATE TRUE                                                10874008
108750         WHEN EP215-INCTV-MDSE-SET-ID = 0                         10875008
108760             PERFORM 2700-MOVE-ZERO                               10876008
108770         WHEN OTHER                                               10877008
108780             INSPECT EP215-INCTV-MDSE-SET-ID TALLYING PV-TALLY    10878008
108790                FOR LEADING ZEROES                                10879008
108791             SET PV-BIT-IDX TO PV-TALLY                           10879108
108792             SET PV-BIT-IDX UP BY +1                              10879208
108793             MOVE EP215-INCTV-MDSE-SET-ID TO                      10879308
108794                                        PV-VARIABLE-OUTPUT-FIELD  10879408
108795             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10879508
108796                FROM PV-BIT-IDX BY +1                             10879608
108797                UNTIL PV-EOF-IDX > 10                             10879708
108798     END-EVALUATE.                                                10879808
108799                                                                  10879908
108800     PERFORM 3100-MOVE-DELIMITER.                                 10880008
108801                                                                  10880108
108810*-- FORMAT SYS-OF-REC-ID         NOT NULL                         10881007
108900                                                                  10890007
108910     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10891008
108920     INITIALIZE PV-TALLY.                                         10892008
108930                                                                  10893008
108940     EVALUATE TRUE                                                10894008
108950         WHEN EP215-SYS-OF-REC-ID  = 0                            10895008
108960             PERFORM 2700-MOVE-ZERO                               10896008
108970         WHEN OTHER                                               10897008
108980             MOVE EP215-SYS-OF-REC-ID TO PV-SYS-OF-REC-ID         10898008
108990             PERFORM 3200-MOVE-SYS-REC-ID                         10899008
108991     END-EVALUATE.                                                10899108
108992                                                                  10899208
108993     PERFORM 3100-MOVE-DELIMITER.                                 10899308
108994                                                                  10899408
109000*-- FORMAT SYSTEM IDENTIFIER     NOT NULL                         10900007
109110                                                                  10911008
109120     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           10912008
109130                                                                  10913008
109140     MOVE EP215-SYS-IDENTIFIER TO PV-SRC-SYS-ID.                  10914039
109150     PERFORM 3300-MOVE-SRC-SYS-ID.                                10915039
109160     PERFORM 3100-MOVE-DELIMITER.                                 10916008
109170                                                                  10917008
109200*-- FORMAT SECTION TYPE CODE     NOT NULL                         10920007
109300                                                                  10930007
109310     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           10931008
109320                                                                  10932008
109330     MOVE EP215-INCTV-SECT-TYP-CDE TO PV-VARIABLE-CHAR-FIELD.     10933008
109340     SET PV-CHR-EOF-IDX TO +1.                                    10934039
109350                                                                  10935008
109360     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           10936008
109370        FROM 1 BY 1                                               10937008
109380        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    10938039
109390                                                                  10939008
109391     PERFORM 3100-MOVE-DELIMITER.                                 10939108
109392                                                                  10939208
109400*-- FORMAT SYS-OF-REC-SUB-ID     NOT NULL                         10940007
109500                                                                  10950007
109510     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10951008
109520     INITIALIZE PV-TALLY.                                         10952008
109530                                                                  10953008
109540     EVALUATE TRUE                                                10954008
109550         WHEN EP215-SYS-REC-SUB-ID = 0                            10955008
109560             PERFORM 2700-MOVE-ZERO                               10956008
109570         WHEN OTHER                                               10957008
109580             INSPECT EP215-SYS-REC-SUB-ID  TALLYING PV-TALLY      10958008
109590                FOR LEADING ZEROES                                10959008
109591             SET PV-BIT-IDX TO PV-TALLY                           10959108
109592             SET PV-BIT-IDX UP BY +1                              10959208
109593             MOVE EP215-SYS-REC-SUB-ID  TO                        10959308
109594                                        PV-VARIABLE-OUTPUT-FIELD  10959408
109595             PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX    10959508
109596                FROM PV-BIT-IDX BY +1                             10959608
109597                UNTIL PV-EOF-IDX > 10                             10959708
109598     END-EVALUATE.                                                10959808
109599                                                                  10959908
109600     PERFORM 3100-MOVE-DELIMITER.                                 10960008
109601                                                                  10960108
109610*-- FORMAT MDSE-HIER-CDE         NOT NULL                         10961007
109700                                                                  10970007
109710     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           10971008
109720                                                                  10972008
109730     EVALUATE TRUE                                                10973008
109740         WHEN EP215-MDSE-HIER-CDE = SPACES                        10974008
109750            PERFORM 3500-MOVE-SPACE                               10975008
109760         WHEN OTHER                                               10976008
109770            MOVE EP215-MDSE-HIER-CDE TO PV-VARIABLE-CHAR-FIELD    10977008
109780            SET PV-CHR-EOF-IDX TO +3                              10978008
109790            PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX    10979008
109791               FROM 1 BY 1                                        10979108
109792               UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX              10979208
109793     END-EVALUATE.                                                10979308
109794                                                                  10979408
109795     PERFORM 3100-MOVE-DELIMITER.                                 10979508
109796                                                                  10979608
109800*-- FORMAT DEPT-NUM                  NULL                         10980007
109810                                                                  10981008
109820     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         10982008
109830     INITIALIZE PV-TALLY.                                         10983008
109840                                                                  10984008
109850     EVALUATE TRUE                                                10985008
109860         WHEN EP215-DEPT-NBR-NL = '~'                             10986008
109870            PERFORM 2900-MOVE-NULL-VALUE                          10987008
109880         WHEN EP215-DEPT-NBR = 0                                  10988008
109890            PERFORM 2700-MOVE-ZERO                                10989008
109891         WHEN OTHER                                               10989108
109892            INSPECT EP215-DEPT-NBR  TALLYING PV-TALLY             10989208
109893                FOR LEADING ZEROES                                10989308
109894            SET PV-BIT-IDX TO PV-TALLY                            10989408
109895            SET PV-BIT-IDX UP BY +1                               10989508
109896                                                                  10989608
109897            MOVE EP215-DEPT-NBR TO PV-VARIABLE-OUTPUT-FIELD       10989708
109898                                                                  10989808
109899            PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     10989908
109900               FROM PV-BIT-IDX BY +1                              10990008
109901               UNTIL PV-EOF-IDX > 4                               10990108
109902     END-EVALUATE.                                                10990208
109903                                                                  10990308
109904     PERFORM 3100-MOVE-DELIMITER.                                 10990408
109910                                                                  10991007
110000*-- FORMAT MAJ-CL-NBR                NULL                         11000007
110010                                                                  11001008
110020     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         11002008
110030     INITIALIZE PV-TALLY.                                         11003008
110040                                                                  11004008
110050     EVALUATE TRUE                                                11005008
110060         WHEN EP215-MAJ-CL-NBR-NL = '~'                           11006008
110070            PERFORM 2900-MOVE-NULL-VALUE                          11007008
110080         WHEN EP215-MAJ-CL-NBR = 0                                11008008
110090            PERFORM 2700-MOVE-ZERO                                11009008
110091         WHEN OTHER                                               11009108
110092            INSPECT EP215-MAJ-CL-NBR  TALLYING PV-TALLY           11009208
110093                FOR LEADING ZEROES                                11009308
110094            SET PV-BIT-IDX TO PV-TALLY                            11009408
110095            SET PV-BIT-IDX UP BY +1                               11009508
110096                                                                  11009608
110097            MOVE EP215-MAJ-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     11009708
110098                                                                  11009808
110099            PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     11009908
110100               FROM PV-BIT-IDX BY +1                              11010008
110101               UNTIL PV-EOF-IDX > 4                               11010108
110102     END-EVALUATE.                                                11010208
110103                                                                  11010308
110104     PERFORM 3100-MOVE-DELIMITER.                                 11010408
110110                                                                  11011007
110200*-- FORMAT SUB-CL-NBR                NULL                         11020008
110300                                                                  11030007
110320     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         11032008
110330     INITIALIZE PV-TALLY.                                         11033008
110340                                                                  11034008
110350     EVALUATE TRUE                                                11035008
110360         WHEN EP215-SUB-CL-NBR-NL = '~'                           11036008
110370            PERFORM 2900-MOVE-NULL-VALUE                          11037008
110380         WHEN EP215-SUB-CL-NBR = 0                                11038008
110390            PERFORM 2700-MOVE-ZERO                                11039008
110391         WHEN OTHER                                               11039108
110392            INSPECT EP215-SUB-CL-NBR  TALLYING PV-TALLY           11039208
110393                FOR LEADING ZEROES                                11039308
110394            SET PV-BIT-IDX TO PV-TALLY                            11039408
110395            SET PV-BIT-IDX UP BY +1                               11039508
110396                                                                  11039608
110397            MOVE EP215-SUB-CL-NBR TO PV-VARIABLE-OUTPUT-FIELD     11039708
110398                                                                  11039808
110399            PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     11039908
110400               FROM PV-BIT-IDX BY +1                              11040008
110401               UNTIL PV-EOF-IDX > 4                               11040108
110402     END-EVALUATE.                                                11040208
110403                                                                  11040308
110404     PERFORM 3100-MOVE-DELIMITER.                                 11040408
110405                                                                  11040508
110410*-- FORMAT STYLE-IDENTIFIER          NULL                         11041007
110500                                                                  11050007
110510     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         11051008
110520     INITIALIZE PV-TALLY.                                         11052008
110530                                                                  11053008
110540     EVALUATE TRUE                                                11054008
110550         WHEN EP215-STYLE-ID-NL = '~'                             11055008
110560            PERFORM 2900-MOVE-NULL-VALUE                          11056008
110570         WHEN EP215-STYLE-ID = 0                                  11057008
110580            PERFORM 2700-MOVE-ZERO                                11058008
110590         WHEN OTHER                                               11059008
110591            INSPECT EP215-STYLE-ID  TALLYING PV-TALLY             11059108
110592                FOR LEADING ZEROES                                11059208
110593            SET PV-BIT-IDX TO PV-TALLY                            11059308
110594            SET PV-BIT-IDX UP BY +1                               11059408
110595                                                                  11059508
110596            MOVE EP215-STYLE-ID TO PV-VARIABLE-OUTPUT-FIELD       11059608
110597                                                                  11059708
110598            PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     11059808
110599               FROM PV-BIT-IDX BY +1                              11059908
110600               UNTIL PV-EOF-IDX > 8                               11060008
110601     END-EVALUATE.                                                11060108
110602                                                                  11060208
110603     PERFORM 3100-MOVE-DELIMITER.                                 11060308
110604                                                                  11060408
110610*-- FORMAT SKU-NUMBER                NULL                         11061007
110700                                                                  11070007
110710     INITIALIZE PV-VARIABLE-OUTPUT-FIELD.                         11071008
110720     INITIALIZE PV-TALLY.                                         11072008
110730                                                                  11073008
110740     EVALUATE TRUE                                                11074008
110750         WHEN EP215-SKU-NBR-NL = '~'                              11075008
110760            PERFORM 2900-MOVE-NULL-VALUE                          11076008
110770         WHEN EP215-SKU-NBR = 0                                   11077008
110780            PERFORM 2700-MOVE-ZERO                                11078008
110790         WHEN OTHER                                               11079008
110791            INSPECT EP215-SKU-NBR  TALLYING PV-TALLY              11079108
110792                FOR LEADING ZEROES                                11079208
110793            SET PV-BIT-IDX TO PV-TALLY                            11079308
110794            SET PV-BIT-IDX UP BY +1                               11079408
110795                                                                  11079508
110796            MOVE EP215-SKU-NBR TO PV-VARIABLE-OUTPUT-FIELD        11079608
110797                                                                  11079708
110798            PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX     11079808
110799               FROM PV-BIT-IDX BY +1                              11079908
110800               UNTIL PV-EOF-IDX > 8                               11080008
110801     END-EVALUATE.                                                11080108
110802                                                                  11080208
110803     PERFORM 3100-MOVE-DELIMITER.                                 11080308
110804                                                                  11080408
110810*-- FORMAT IE-IND                NOT NULL                         11081007
110910                                                                  11091008
110920     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           11092008
110930                                                                  11093008
110940     MOVE EP215-MDSE-IE-IND TO PV-VARIABLE-CHAR-FIELD.            11094009
110950     SET PV-CHR-EOF-IDX TO +1.                                    11095039
110960                                                                  11096008
110970     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           11097008
110980        FROM 1 BY 1                                               11098008
110990        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    11099039
110991                                                                  11099108
110992     PERFORM 3100-MOVE-DELIMITER.                                 11099208
110993                                                                  11099308
111000*-- FORMAT TKT-CLOR-CDE              NULL                         11100007
111100                                                                  11110007
111110     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           11111008
111120                                                                  11112008
111121     EVALUATE TRUE                                                11112108
111122         WHEN EP215-TKT-CLOR-CDE = '~'                            11112208
111123            PERFORM 2900-MOVE-NULL-VALUE                          11112308
111124         WHEN EP215-TKT-CLOR-CDE = SPACES                         11112408
111125            PERFORM 3200-MOVE-SYS-REC-ID                          11112510
111126         WHEN OTHER                                               11112608
111127            MOVE EP215-TKT-CLOR-CDE TO PV-VARIABLE-CHAR-FIELD     11112708
111128            SET PV-CHR-EOF-IDX TO +2                              11112808
111129            PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX    11112908
111130               FROM 1 BY 1                                        11113008
111131               UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX              11113108
111132     END-EVALUATE.                                                11113208
111133                                                                  11113308
111134     PERFORM 3100-MOVE-DELIMITER.                                 11113408
111140                                                                  11114008
111200*-- FORMAT ELECT-SHLF-LABEL-TOPR     NULL                         11120007
111210                                                                  11121008
111220     INITIALIZE PV-VARIABLE-CHAR-FIELD.                           11122008
111230                                                                  11123008
111240     EVALUATE TRUE                                                11124008
111250         WHEN EP215-ELECT-SLF-TOPR-CD = '~'                       11125008
111260            PERFORM 2900-MOVE-NULL-VALUE                          11126008
111270         WHEN EP215-ELECT-SLF-TOPR-CD = SPACES                    11127008
111280            PERFORM 3500-MOVE-SPACE                               11128017
111290         WHEN OTHER                                               11129008
111291            MOVE EP215-ELECT-SLF-TOPR-CD TO PV-ELECT-SLF-TOPR-CD  11129125
111292                                                                  11129225
111293            IF PV-ESL-FIRST-ZERO = '0'                            11129324
111294               MOVE PV-ESL-CDE TO PV-VARIABLE-CHAR-FIELD          11129424
111295               SET PV-CHR-EOF-IDX TO +2                           11129524
111296            ELSE                                                  11129624
111297               MOVE EP215-ELECT-SLF-TOPR-CD TO                    11129724
111298                                            PV-VARIABLE-CHAR-FIELD11129824
111299               SET PV-CHR-EOF-IDX TO +3                           11129924
111300            END-IF                                                11130024
111303                                                                  11130324
111304            PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX    11130408
111305               FROM 1 BY 1                                        11130508
111306               UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX              11130608
111307     END-EVALUATE.                                                11130708
111308                                                                  11130808
111309     PERFORM 3100-MOVE-DELIMITER.                                 11130908
111310                                                                  11131007
111320     PERFORM 4000-WRITE-DTL-RECORD.                               11132013
111330                                                                  11133013
111340     PERFORM 6600-READ-CINCTV-MDSE-FILE.                          11134014
111350                                                                  11135014
111400*2400-EXIT.                                                       11140007
111600                                                                  11160007
111700*-------------------------------------------------------------    11170007
111800* 2500-MOVE-VALUES-AND-WRITE-HDR                                  11180007
111900*     FORMAT AND WRITE THE HEADER RECORD                          11190007
112000*-------------------------------------------------------------    11200007
112100 2500-MOVE-VALUES-AND-WRITE-HDR.                                  11210007
112200                                                                  11220007
112900     MOVE PC-HDR-IND             TO EP217-HDR-INDICATOR.          11290007
113000     MOVE PV-STR-GRP-TYP-CDE     TO EP217-STR-GRP-TYP.            11300009
113100     MOVE PV-STR-GRP-ID-GRP      TO EP217-STR-GRP-ID.             11310013
113200     MOVE PC-FIVE-ZERO           TO EP217-EXCO-STR-NBR.           11320007
113300     MOVE PV-FILE-DIST-HDR-DTE   TO EP217-FILE-DIST-DATE.         11330013
113400     SET EP217-FILE-PROMO        TO TRUE.                         11340007
113500     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-1.           11350007
113600     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-2.           11360007
113700     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-3.           11370007
113800     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-4.           11380007
113900     MOVE PC-UNDER-SCORE         TO EP217-UNDERSCORE-5.           11390007
114000                                                                  11400007
114100     IF PV-STR-GRP-TYP-CDE = PC-STORE-SPECIFIC-GRP                11410009
114200         MOVE PV-STR-GRP-ID          TO EP217-STORE-NBR           11420007
114300     ELSE                                                         11430007
114400         MOVE PC-FIVE-ZERO           TO EP217-STORE-NBR           11440007
114500     END-IF.                                                      11450007
114600                                                                  11460007
114700     MOVE PV-APPLY-IND        TO EP217-FILE-TYPE-APPLY.           11470007
114800     MOVE PV-FILE-TYPE        TO EP217-FILE-NAME-TYPE.            11480007
114801                                                                  11480130
114802*--  FORMAT THE TIMESTAMP PART OF THE HEADER RECORD               11480230
114803                                                                  11480330
114812     MOVE PV-BATCH-DATE          TO PV-HDR-TMST-DATE.             11481230
114813     MOVE PV-TIME-CALC           TO PV-HDR-TMST-TIME.             11481330
114814                                                                  11481430
114820     MOVE PV-HEADER-TIMESTAMP    TO EP217-CRT-TIMESTAMP.          11482030
114900                                                                  11490007
115000     PERFORM 2600-WRITE-HDR-RECORD.                               11500007
115100                                                                  11510007
115200*2500-EXIT.                                                       11520007
115400                                                                  11540007
115500*-------------------------------------------------------------    11550007
115600* 2600-WRITE-HDR-RECORD                                           11560007
115700*     FORMAT AND WRITE THE HEADER RECORD                          11570007
115800*-------------------------------------------------------------    11580007
115900 2600-WRITE-HDR-RECORD.                                           11590007
116000                                                                  11600007
116100     PERFORM 5100-CALC-TIME.                                      11610030
116200                                                                  11620007
116300     MOVE 64                                                      11630007
116400       TO PV-BYTE-COUNT.                                          11640007
116500     WRITE FORMATTED-CUST-INCTV-REC                               11650007
116600       FROM EP217-HEADER-RECORD.                                  11660007
116700                                                                  11670007
116800     ADD 1 TO PV-HDR-REC-WRITEN.                                  11680007
116900                                                                  11690007
117000*2600-EXIT.                                                       11700007
117200                                                                  11720007
117300*-----------------------------------------------------------------11730007
117400* 2700-MOVE-ZERO                                                  11740007
117500*  THIS PARAGRAPH WILL MOVE '0' TO THE OUTPUT FILE VARIABLE       11750007
117600*----------------------------------------------------------------*11760007
117700 2700-MOVE-ZERO.                                                  11770007
117800                                                                  11780007
117900     MOVE PC-ONE-ZERO                                             11790007
118000       TO FORM-CST-IN-FLD(FORM-CST-IN-LEN).                       11800007
118100     SET FORM-CST-IN-LEN                                          11810007
118200       UP BY +1.                                                  11820007
118300     ADD 1                                                        11830007
118400       TO PV-BYTE-COUNT.                                          11840007
118500                                                                  11850007
118600*2700-EXIT.                                                       11860007
118800                                                                  11880007
118900*-------------------------------------------------------------    11890007
119000* 2800-FIND-DATA-END.                                             11900007
119100*  THIS PARAGRAPH IS USED IN A LOOP TO DETERMINE THE LENGTH OF    11910007
119200*  THE STRING.                                                    11920007
119300*-------------------------------------------------------------    11930007
119400 2800-FIND-DATA-END.                                              11940007
119500                                                                  11950007
119600     MOVE ' '                                                     11960007
119700       TO PV-SPACE.                                               11970007
119800                                                                  11980007
119900*2800-EXIT.                                                       11990007
120100                                                                  12010007
120200*-----------------------------------------------------------------12020007
120300* 2900-MOVE-NULL-VALUE                                            12030007
120400*  THIS PARAGRAPH WILL MOVE '0' TO THE OUTPUT FILE VARIABLE       12040007
120500*----------------------------------------------------------------*12050007
120600 2900-MOVE-NULL-VALUE.                                            12060007
120700                                                                  12070007
120800     MOVE PC-NULL-VALUE                                           12080007
120900       TO FORM-CST-IN-FLD(FORM-CST-IN-LEN).                       12090007
121000     SET FORM-CST-IN-LEN                                          12100007
121100       UP BY +1.                                                  12110007
121200     ADD 1                                                        12120007
121300       TO PV-BYTE-COUNT.                                          12130007
121400                                                                  12140007
121500*2900-EXIT.                                                       12150007
121700                                                                  12170007
121800*-------------------------------------------------------------    12180007
121900* 3000-DETERMINE-HDR-STR-GRP                                      12190007
122000*  THIS PARAGRPH DETERMINED THE STORE GROUP AND DATE THAT SHOULD  12200036
122010*  BE POPULATED ON THE HEADER, AND ALSO DRIVES THE 2000- PARAGRAPH12201036
122011*  DIFFERENT CASES ARE EXPLAINED BELOW :                          12201136
122012*                                                                 12201236
122020*  1) WHEN THE HEADER OF ALL THE FOUR FILES ARE THE SAME, THE     12202036
122030*     VALUES ARE POPULATED FROM INCENTIVE FILE, THESE ARE FOR ADD 12203036
122040*     RECORDS WHERE DATA IS SENT FOR ALL THE TABLES.              12204036
122050*  2) THERE IS A POSSIBILITY IN CORRECTIONS FILE WHEN THERE IS    12205036
122060*     UPDATE (A/D) TO ONLY THE MERCHANDISE TABLE, THIS IS         12206036
122070*     HANDELED BY SECOND EVALUATE.                                12207036
122100*-------------------------------------------------------------    12210007
122200 3000-DETERMINE-HDR-STR-GRP.                                      12220007
122330                                                                  12233016
122340*                                                                 12234036
122350*-- ADD RECORDS FOR ALL THE TABLES                                12235036
122360*                                                                 12236036
122400     EVALUATE TRUE                                                12240007
122500         WHEN EP212-XST-CINCTV-HDR = EP213-XST-CINC-SECT-HDR      12250007
122600          AND EP213-XST-CINC-SECT-HDR = EP214-XST-CINC-PARM-HDR   12260007
122700          AND EP214-XST-CINC-PARM-HDR = EP215-XST-CINC-MDSE-HDR   12270007
122800              MOVE EP212-STR-GRP-TYP-CDE TO PV-STR-GRP-TYP-CDE    12280007
122900              MOVE EP212-STR-GRP-ID TO PV-STR-GRP-ID-GRP          12290007
123000              MOVE EP212-STR-FILE-LIST-DTE TO PV-FILE-DIST-HDR-DTE12300013
123100              MOVE EP212-FILE-ACT-TYP TO PV-FILE-TYPE             12310007
123200              MOVE EP212-APPLY-IND TO PV-APPLY-IND                12320007
123201*                                                                 12320136
123210*-- ONLY MERCHANDISE ROW ADD/DELETE                               12321036
123220*                                                                 12322036
123300         WHEN EP212-XST-CINCTV-HDR = EP213-XST-CINC-SECT-HDR      12330007
123400          AND EP213-XST-CINC-SECT-HDR = EP214-XST-CINC-PARM-HDR   12340007
123500         AND EP214-XST-CINC-PARM-HDR NOT = EP215-XST-CINC-MDSE-HDR12350007
123501                                                                  12350116
123510             EVALUATE TRUE                                        12351016
123520                 WHEN EP212-STR-HIER-CDE > EP215-STR-HIER-CDE     12352036
123521                    MOVE EP215-STR-GRP-TYP-CDE TO                 12352136
123522                                               PV-STR-GRP-TYP-CDE 12352236
123523                    MOVE EP215-STR-GRP-ID  TO PV-STR-GRP-ID-GRP   12352336
123524                    MOVE EP215-STR-FILE-LIST-DTE  TO              12352436
123525                                     PV-FILE-DIST-HDR-DTE         12352536
123526                    MOVE EP215-FILE-ACT-TYP TO PV-FILE-TYPE       12352636
123527                    MOVE EP215-APPLY-IND TO PV-APPLY-IND          12352736
123528                                                                  12352836
123529                 WHEN EP212-STR-HIER-CDE = EP215-STR-HIER-CDE     12352936
123530                  AND EP212-STR-FILE-LIST-DTE >                   12353036
123531                                       EP215-STR-FILE-LIST-DTE    12353136
123533                    MOVE EP215-STR-GRP-TYP-CDE TO                 12353336
123534                                               PV-STR-GRP-TYP-CDE 12353436
123535                    MOVE EP215-STR-GRP-ID  TO PV-STR-GRP-ID-GRP   12353536
123536                    MOVE EP215-STR-FILE-LIST-DTE  TO              12353636
123537                                     PV-FILE-DIST-HDR-DTE         12353736
123538                    MOVE EP215-FILE-ACT-TYP TO PV-FILE-TYPE       12353836
123539                    MOVE EP215-APPLY-IND TO PV-APPLY-IND          12353936
123540                                                                  12354036
123552                                                                  12355226
123553                 WHEN EP212-STR-HIER-CDE = EP215-STR-HIER-CDE     12355316
123554                  AND EP212-STR-FILE-LIST-DTE =                   12355426
123555                                       EP215-STR-FILE-LIST-DTE    12355526
123560                  AND EP212-STR-GRP-ID > EP215-STR-GRP-ID         12356016
123570                     MOVE EP215-STR-GRP-ID  TO PV-STR-GRP-ID-GRP  12357016
123571                     MOVE EP215-STR-GRP-TYP-CDE TO                12357126
123572                                                PV-STR-GRP-TYP-CDE12357226
123573                     MOVE EP215-STR-FILE-LIST-DTE TO              12357326
123574                                              PV-FILE-DIST-HDR-DTE12357426
123575                     MOVE EP215-FILE-ACT-TYP TO PV-FILE-TYPE      12357526
123576                     MOVE EP215-APPLY-IND TO PV-APPLY-IND         12357626
123577                WHEN OTHER                                        12357736
123578                     DISPLAY '  '                                 12357836
123579                     DISPLAY ' ERROR IN INPUT FILES'              12357936
123580                     DISPLAY ' PROGRAM CANNOT PROCEED'            12358036
123581                     MOVE '3000-DETERMINE-HDR-STR-GRP' TO         12358136
123582                                              PV-PARAGRAPH-NAME   12358236
123583                     DISPLAY ' EP212-HDR-INFORMATION : '          12358336
123584                             EP212-XST-CINCTV-HDR                 12358436
123585                     DISPLAY ' EP215-HDR-INFORMATION : '          12358536
123586                             EP215-XST-CINC-MDSE-HDR              12358636
123587                     DISPLAY ' EP212-DTL-RECORD '                 12358736
123588                             EP212-XST-CINCTV-DTL                 12358836
123589                     DISPLAY ' EP215-DTL-RECORD : '               12358936
123590                             EP215-XST-CINC-MDSE-DTL              12359036
123591                     SET AC-INPUT-FILE-EMPTY       TO TRUE        12359136
123592                     PERFORM 9910-ABEND                           12359236
123594                                                                  12359436
123600             END-EVALUATE                                         12360036
123810                                                                  12381016
123900         WHEN OTHER                                               12390007
124010             DISPLAY '  '                                         12401036
124020             DISPLAY ' ERROR IN INPUT FILES SOME HAVE DATA OTHER' 12402036
124030             DISPLAY ' IS EMPTY ,PROGRAM CANNOT PROCEED'          12403036
124031             MOVE '3000-DETERMINE-HDR-STR-GRP' TO                 12403136
124050                                              PV-PARAGRAPH-NAME   12405036
124060             SET AC-INPUT-FILE-EMPTY       TO TRUE                12406036
124070             PERFORM 9910-ABEND                                   12407036
124100                                                                  12410007
124200     END-EVALUATE.                                                12420007
124300                                                                  12430007
124400*3000-EXIT.                                                       12440007
124600                                                                  12460007
124700*-----------------------------------------------------------------12470007
124800* 3100-MOVE-DELIMITER                                             12480007
124900*  THIS PARAGRAPH WILL MOVE '0' TO THE OUTPUT FILE VARIABLE       12490007
125000*----------------------------------------------------------------*12500007
125100 3100-MOVE-DELIMITER.                                             12510007
125200                                                                  12520007
125300     MOVE PC-CSV-DELIMITER                                        12530007
125400       TO FORM-CST-IN-FLD(FORM-CST-IN-LEN).                       12540007
125500     SET FORM-CST-IN-LEN                                          12550007
125600       UP BY +1.                                                  12560007
125700     ADD 1                                                        12570007
125800       TO PV-BYTE-COUNT.                                          12580007
125900                                                                  12590007
126000*3100-EXIT.                                                       12600007
126200                                                                  12620007
126300*-----------------------------------------------------------------12630007
126400* 3200-MOVE-SYS-REC-ID                                            12640007
126500*  THIS PARAGRAPH WILL MOVE SYS-OF-REC-ID TO OUTPUT FILE VARIABLE 12650007
126600*----------------------------------------------------------------*12660007
126700 3200-MOVE-SYS-REC-ID.                                            12670007
126800                                                                  12680007
126900     INSPECT PV-SYS-OF-REC-ID   TALLYING PV-TALLY                 12690007
127000        FOR LEADING ZEROES.                                       12700010
127100     SET PV-BIT-IDX TO PV-TALLY.                                  12710010
127200     SET PV-BIT-IDX UP BY +1.                                     12720010
127300     MOVE PV-SYS-OF-REC-ID TO PV-VARIABLE-OUTPUT-FIELD.           12730010
127400     PERFORM 3600-MOVE-NUMERIC-DATA VARYING PV-EOF-IDX            12740007
127500        FROM PV-BIT-IDX BY +1                                     12750007
127600        UNTIL PV-EOF-IDX > 10.                                    12760010
127700*3200-EXIT.                                                       12770007
127900                                                                  12790007
128000*-----------------------------------------------------------------12800007
128100* 3300-MOVE-SRC-SYS-ID                                            12810007
128200*  THIS PARAGRAPH WILL MOVE SYS-OF-REC-ID TO OUTPUT FILE VARIABLE 12820007
128300*----------------------------------------------------------------*12830007
128400 3300-MOVE-SRC-SYS-ID.                                            12840007
128500                                                                  12850007
128600     MOVE PV-SRC-SYS-ID  TO PV-VARIABLE-CHAR-FIELD.               12860010
128700                                                                  12870007
128800     SET PV-CHR-EOF-IDX TO +2.                                    12880010
128900                                                                  12890007
129000     PERFORM 3800-MOVE-CHAR-DATA VARYING PV-CHR-BIT-IDX           12900007
129100        FROM 1 BY 1                                               12910007
129200        UNTIL PV-CHR-BIT-IDX > PV-CHR-EOF-IDX.                    12920010
129300                                                                  12930007
129400*3300-EXIT.                                                       12940007
129600                                                                  12960007
129700*-----------------------------------------------------------------12970007
129800* 3500-MOVE-SPACE                                                 12980007
129900*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       12990007
130000*----------------------------------------------------------------*13000007
130100 3500-MOVE-SPACE.                                                 13010007
130200                                                                  13020007
130300     MOVE PC-ONE-SPACE                                            13030007
130400       TO FORM-CST-IN-FLD(FORM-CST-IN-LEN).                       13040007
130500     SET FORM-CST-IN-LEN                                          13050007
130600       UP BY +1.                                                  13060007
130700     ADD 1                                                        13070007
130800       TO PV-BYTE-COUNT.                                          13080007
130900                                                                  13090007
131000*3500-EXIT.                                                       13100007
131200                                                                  13120007
131300*-----------------------------------------------------------------13130007
131400* 3600-MOVE-NUMERIC-DATA                                          13140007
131500*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       13150007
131600*----------------------------------------------------------------*13160007
131700 3600-MOVE-NUMERIC-DATA.                                          13170007
131800                                                                  13180007
131900     MOVE PV-BIT-VARIABLE(PV-EOF-IDX)                             13190007
132000       TO FORM-CST-IN-FLD(FORM-CST-IN-LEN).                       13200007
132100     SET FORM-CST-IN-LEN                                          13210007
132200       UP BY +1.                                                  13220007
132300     ADD 1                                                        13230007
132400       TO PV-BYTE-COUNT.                                          13240007
132500                                                                  13250007
132600*3600-EXIT.                                                       13260007
132800                                                                  13280007
132900*-----------------------------------------------------------------13290007
133000* 3700-MOVE-AMOUNT-DATA                                           13300007
133100*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       13310007
133200*----------------------------------------------------------------*13320007
133300 3700-MOVE-AMOUNT-DATA.                                           13330007
133400                                                                  13340007
133500     IF PV-EOF-IDX = 7                                            13350007
133600       MOVE PV-BIT-VARIABLE(PV-EOF-IDX)                           13360007
133700         TO FORM-CST-IN-FLD(FORM-CST-IN-LEN)                      13370007
133800                                                                  13380007
133900       SET FORM-CST-IN-LEN                                        13390007
134000         UP BY +1                                                 13400007
134100       ADD 1                                                      13410007
134200         TO PV-BYTE-COUNT                                         13420007
134300                                                                  13430007
134400       MOVE '.'  TO FORM-CST-IN-FLD(FORM-CST-IN-LEN)              13440007
134500     ELSE                                                         13450007
134600       MOVE PV-BIT-VARIABLE(PV-EOF-IDX)                           13460007
134700         TO FORM-CST-IN-FLD(FORM-CST-IN-LEN)                      13470007
134800     END-IF.                                                      13480007
134900                                                                  13490007
135000     SET FORM-CST-IN-LEN                                          13500007
135100       UP BY +1.                                                  13510007
135200     ADD 1                                                        13520007
135300       TO PV-BYTE-COUNT.                                          13530007
135400                                                                  13540007
135500*3700-EXIT.                                                       13550007
135700                                                                  13570007
135800*-----------------------------------------------------------------13580007
135900* 3800-MOVE-CHAR-DATA                                             13590007
136000*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       13600007
136100*----------------------------------------------------------------*13610007
136200 3800-MOVE-CHAR-DATA.                                             13620007
136300                                                                  13630007
136400     MOVE PV-BIT-CHR-VARIABLE(PV-CHR-BIT-IDX)                     13640007
136500       TO FORM-CST-IN-FLD(FORM-CST-IN-LEN).                       13650007
136600     SET FORM-CST-IN-LEN                                          13660007
136700       UP BY +1.                                                  13670007
136800     ADD 1                                                        13680007
136900       TO PV-BYTE-COUNT.                                          13690007
137000                                                                  13700007
137100*3800-EXIT.                                                       13710007
137300                                                                  13730007
137400*-----------------------------------------------------------------13740007
137500* 3900-MOVE-RECORD-ACTION                                         13750007
137600*  THIS PARAGRAPH WILL MOVE ' ' TO THE OUTPUT FILE VARIABLE       13760007
137700*----------------------------------------------------------------*13770007
137800 3900-MOVE-RECORD-ACTION.                                         13780007
137900                                                                  13790007
138000     MOVE PV-RECORD-ACTION                                        13800007
138100       TO FORM-CST-IN-FLD(FORM-CST-IN-LEN).                       13810007
138200     SET FORM-CST-IN-LEN                                          13820007
138300       UP BY +1.                                                  13830007
138400     ADD 1                                                        13840007
138500       TO PV-BYTE-COUNT.                                          13850007
138600                                                                  13860007
138700*3900-EXIT.                                                       13870007
138900                                                                  13890007
138910*-------------------------------------------------------------    13891013
138920* 4000-WRITE-DTL-RECORD                                           13892013
138930*     FORMAT AND WRITE THE HEADER RECORD                          13893013
138940*-------------------------------------------------------------    13894013
138950 4000-WRITE-DTL-RECORD.                                           13895013
138960                                                                  13896013
138992     WRITE FORMATTED-CUST-INCTV-REC.                              13899213
138994                                                                  13899413
138995     ADD 1 TO PV-DTL-REC-WRITEN.                                  13899513
138996                                                                  13899613
138997*2600-EXIT.                                                       13899713
149000                                                                  14900002
149010******************************************************************14901030
149020* 5100-CALC-TIME.                                                 14902030
149030*     ADD 1 SECOND TO TIME FOR EACH HEADER RECORD WRITTEN         14903030
149040******************************************************************14904030
149050 5100-CALC-TIME.                                                  14905030
149060                                                                  14906030
149070     MOVE PV-TIME-CALC TO PV-TIME.                                14907030
149080                                                                  14908030
149090     IF PV-TIME-SS = 59                                           14909030
149091        IF PV-TIME-MM = 59                                        14909130
149092           IF PV-TIME-HH = 24                                     14909230
149093              MOVE ZEROES TO PV-TIME-HH                           14909330
149094           ELSE                                                   14909430
149095              ADD +1 TO PV-TIME-HH                                14909530
149096           END-IF                                                 14909630
149097           MOVE ZEROES TO PV-TIME-MM                              14909730
149098        ELSE                                                      14909830
149099           ADD +1 TO PV-TIME-MM                                   14909930
149100        END-IF                                                    14910030
149101        MOVE ZEROES TO PV-TIME-SS                                 14910130
149102     ELSE                                                         14910230
149103        ADD +1 TO PV-TIME-SS                                      14910330
149104     END-IF.                                                      14910430
149105                                                                  14910530
149106     MOVE PV-TIME TO PV-TIME-CALC.                                14910630
149107                                                                  14910730
149109                                                                  14910930
149110*----------------------------------------------------------       14911002
149200* 6000-READ-CINCTV-FILE                                           14920002
149300*     THIS PARAGRAPH READS DATA FROM CUST-INCTV-FILE (INP01)      14930003
149400*     INTO COPYBOOK EPRD212                                       14940003
149500*----------------------------------------------------------       14950002
149600 6000-READ-CINCTV-FILE.                                           14960002
149700                                                                  14970002
149800     READ CUST-INCTV-FILE                                         14980003
149900         INTO EP212-XST-CUST-INCTV                                14990003
150000     AT END                                                       15000002
150100         SET PS-END-OF-CINCTV-FILE TO TRUE                        15010003
150200     END-READ.                                                    15020002
150400                                                                  15040002
150500     IF PS-NOT-END-CINCTV-FILE                                    15050003
150600        MOVE 0 TO PV-PIPE-COUNT                                   15060002
150700        PERFORM 6100-CHECK-INP01-FOR-PIPES                        15070002
150710        ADD +1 TO PV-CINCTV-REC-RD                                15071039
150800     END-IF.                                                      15080002
150900                                                                  15090002
151000*6000-EXIT.                                                       15100002
151200                                                                  15120002
151300*----------------------------------------------------------       15130002
151400* 6100-CHECK-INP01-FOR-PIPES                                      15140002
151500*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 15150002
151600*     REPLACES PIPES WITH SPACE.                                  15160002
151700*----------------------------------------------------------       15170002
151800 6100-CHECK-INP01-FOR-PIPES.                                      15180002
151900                                                                  15190002
152000     INSPECT EP212-XST-CUST-INCTV                                 15200003
152100          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     15210002
152200                                                                  15220002
152300     IF PV-PIPE-COUNT > 0                                         15230002
152400        INSPECT EP212-XST-CUST-INCTV                              15240003
152500            REPLACING ALL '|'  BY  ' '                            15250002
152600        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  15260002
152700                ' | WITH A SPACE '                                15270002
152800        DISPLAY EP212-XST-CUST-INCTV                              15280003
152900     END-IF.                                                      15290002
153000                                                                  15300002
153100*6100-EXIT.                                                       15310002
153300                                                                  15330003
153400*----------------------------------------------------------       15340003
153500* 6200-READ-CINCTV-SECT-FILE                                      15350003
153600*     THIS PARAGRAPH READS DATA FROM CUST-INCTV-FILE (INP01)      15360003
153700*     INTO COPYBOOK EPRD212                                       15370003
153800*----------------------------------------------------------       15380003
153900 6200-READ-CINCTV-SECT-FILE.                                      15390003
154000                                                                  15400003
154100     READ CUST-INCTV-SECT-FILE                                    15410003
154200         INTO EP213-XST-CUST-INCTV-SECT-RCD                       15420003
154300     AT END                                                       15430003
154400         SET PS-END-OF-CINCTV-SEC-FL TO TRUE                      15440003
154500     END-READ.                                                    15450003
154700                                                                  15470003
154800     IF PS-NOT-END-CINCTV-SEC-FL                                  15480003
154810        ADD +1 TO PV-CINCTV-SECT-REC-RD                           15481039
154900        MOVE 0 TO PV-PIPE-COUNT                                   15490003
155000        PERFORM 6300-CHECK-INP02-FOR-PIPES                        15500003
155100     END-IF.                                                      15510003
155200                                                                  15520003
155300*6200-EXIT.                                                       15530003
155500                                                                  15550003
155600*----------------------------------------------------------       15560003
155700* 6300-CHECK-INP02-FOR-PIPES                                      15570003
155800*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 15580003
155900*     REPLACES PIPES WITH SPACE.                                  15590003
156000*----------------------------------------------------------       15600003
156100 6300-CHECK-INP02-FOR-PIPES.                                      15610003
156200                                                                  15620003
156300     INSPECT EP213-XST-CUST-INCTV-SECT-RCD                        15630003
156400          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     15640003
156500                                                                  15650003
156600     IF PV-PIPE-COUNT > 0                                         15660003
156700        INSPECT EP213-XST-CUST-INCTV-SECT-RCD                     15670003
156800            REPLACING ALL '|'  BY  ' '                            15680003
156900        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  15690003
157000                ' | WITH A SPACE '                                15700003
157100        DISPLAY EP213-XST-CUST-INCTV-SECT-RCD                     15710003
157200     END-IF.                                                      15720003
157300                                                                  15730003
157400*6300-EXIT.                                                       15740003
157600                                                                  15760003
157700*----------------------------------------------------------       15770003
157800* 6400-READ-CINCTV-PARM-FILE                                      15780003
157900*     THIS PARAGRAPH READS DATA FROM CUST-INCTV-FILE (INP01)      15790003
158000*     INTO COPYBOOK EPRD212                                       15800003
158100*----------------------------------------------------------       15810003
158200 6400-READ-CINCTV-PARM-FILE.                                      15820003
158300                                                                  15830003
158400     READ CUST-INCTV-PARM-FILE                                    15840003
158500         INTO EP214-XST-CUST-INCTV-PARM-RCD                       15850003
158600     AT END                                                       15860003
158700         SET PS-END-OF-CINCTV-PRM-FL TO TRUE                      15870003
158800     END-READ.                                                    15880003
159000                                                                  15900003
159100     IF PS-NOT-END-CINCTV-PRM-FL                                  15910003
159110        ADD +1 TO PV-CINCTV-PARM-REC-RD                           15911039
159200        MOVE 0 TO PV-PIPE-COUNT                                   15920003
159300        PERFORM 6500-CHECK-INP03-FOR-PIPES                        15930003
159400     END-IF.                                                      15940003
159500                                                                  15950003
159600*6400-EXIT.                                                       15960003
159800                                                                  15980003
159900*----------------------------------------------------------       15990003
160000* 6500-CHECK-INP03-FOR-PIPES                                      16000003
160100*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 16010003
160200*     REPLACES PIPES WITH SPACE.                                  16020003
160300*----------------------------------------------------------       16030003
160400 6500-CHECK-INP03-FOR-PIPES.                                      16040003
160500                                                                  16050003
160600     INSPECT EP214-XST-CUST-INCTV-PARM-RCD                        16060003
160700          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     16070003
160800                                                                  16080003
160900     IF PV-PIPE-COUNT > 0                                         16090003
161000        INSPECT EP214-XST-CUST-INCTV-PARM-RCD                     16100003
161100            REPLACING ALL '|'  BY  ' '                            16110003
161200        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  16120003
161300                ' | WITH A SPACE '                                16130003
161400        DISPLAY EP214-XST-CUST-INCTV-PARM-RCD                     16140003
161500     END-IF.                                                      16150003
161600                                                                  16160003
161700*6500-EXIT.                                                       16170003
161900                                                                  16190003
162000*----------------------------------------------------------       16200003
162100* 6600-READ-CINCTV-MDSE-FILE                                      16210003
162200*     THIS PARAGRAPH READS DATA FROM CUST-INCTV-FILE (INP04)      16220003
162300*     INTO COPYBOOK EPRD215                                       16230003
162400*----------------------------------------------------------       16240003
162500 6600-READ-CINCTV-MDSE-FILE.                                      16250003
162600                                                                  16260003
162700     READ CUST-INCTV-MDSE-FILE                                    16270003
162800         INTO EP215-XST-CUST-INCTV-MDSE-RCD                       16280003
162900     AT END                                                       16290003
163000         SET PS-END-OF-CINCTV-MDS-FL TO TRUE                      16300003
163100     END-READ.                                                    16310003
163300                                                                  16330003
163400     IF PS-NOT-END-CINCTV-MDS-FL                                  16340003
163410        ADD +1 TO PV-CINCTV-MDSE-REC-RD                           16341039
163500        MOVE 0 TO PV-PIPE-COUNT                                   16350003
163600        PERFORM 6700-CHECK-INP04-FOR-PIPES                        16360003
163700     END-IF.                                                      16370003
163800                                                                  16380003
163900*6600-EXIT.                                                       16390003
164100                                                                  16410003
164200*----------------------------------------------------------       16420003
164300* 6700-CHECK-INP04-FOR-PIPES                                      16430003
164400*     THIS PARAGRAPH CHECKS THE RECORDS READ FOR ANY PIPE (|) AND 16440003
164500*     REPLACES PIPES WITH SPACE.                                  16450003
164600*----------------------------------------------------------       16460003
164700 6700-CHECK-INP04-FOR-PIPES.                                      16470003
164800                                                                  16480003
164900     INSPECT EP215-XST-CUST-INCTV-MDSE-RCD                        16490003
165000          TALLYING PV-PIPE-COUNT FOR ALL '|'.                     16500003
165100                                                                  16510003
165200     IF PV-PIPE-COUNT > 0                                         16520003
165300        INSPECT EP215-XST-CUST-INCTV-MDSE-RCD                     16530003
165400            REPLACING ALL '|'  BY  ' '                            16540003
165500        DISPLAY ' INPUT OFFER RECORD HAD PIPES IN IT, REPLACING'  16550003
165600                ' | WITH A SPACE '                                16560003
165700        DISPLAY EP215-XST-CUST-INCTV-MDSE-RCD                     16570003
165800     END-IF.                                                      16580003
165900                                                                  16590003
166000*6700-EXIT.                                                       16600003
166200******************************************************************16620003
166300*     CLOSES ALL FILES AND DISPLAYS ANY NEEDED INFORMATION.      *16630003
166400******************************************************************16640002
166500 9200-WRAPUP.                                                     16650002
166600     MOVE '9200-WRAPUP                     ' TO PV-PARAGRAPH-NAME.16660002
166700                                                                  16670002
115000     PERFORM 9210-WRITE-TIME-RECORD.                              16671040
166800     PERFORM 9920-DISPLAY-TOTALS.                                 16680002
166900                                                                  16690002
167000     DISPLAY '****************************************'.          16700002
167100     DISPLAY '**          EPKUT215 END              **'.          16710034
167200     DISPLAY '****************************************'.          16720002
167300                                                                  16730002
167410     CLOSE CUST-INCTV-FILE                                        16741009
167420           CUST-INCTV-SECT-FILE                                   16742011
167430           CUST-INCTV-PARM-FILE                                   16743011
167440           CUST-INCTV-MDSE-FILE.                                  16744011
167460                                                                  16746009
167470     CLOSE FORMATTED-CUST-INCTV-FL                                16747040
167470           LAST-HEADER-TIME.                                      16748042
167700                                                                  16770002
167800*9200-EXIT.  EXIT.                                                16780002
169700                                                                  16970002
115500*-------------------------------------------------------------    16971040
115600* 9210-WRITE-TIME-RECORD                                          16972040
115700*     WRITE THE LAST TIME FROM HEADER RECORD                      16973040
115800*-------------------------------------------------------------    16974040
115900 9210-WRITE-TIME-RECORD.                                          16975040
116000                                                                  16976040
           MOVE SPACE TO EP232-TIME-RECORD.                             16976140
                                                                        16976240
           MOVE PV-TIME-CALC TO EP232-HEADER-TIME.                      16976340
116500     WRITE CC-TIME-RECORD                                         16977040
116600       FROM EP232-TIME-RECORD.                                    16978040
116700                                                                  16979040
117000*9210-EXIT.                                                       16979140
117200                                                                  16979240
169800******************************************************************16980002
169900*     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.              *   16990002
170000******************************************************************17000002
170100 9910-ABEND.                                                      17010002
170200                                                                  17020002
170300     PERFORM 9920-DISPLAY-TOTALS.                                 17030002
170400                                                                  17040002
170500     DISPLAY '** ABEND           **'.                             17050002
170600     DISPLAY '** PROGRAM         ** = ' PC-PROGRAM-NAME.          17060002
170700     DISPLAY '** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.        17070002
170800     DISPLAY '** OPERATION       ** = ' PV-OPERATION-MSG-1.       17080002
170900     DISPLAY '**                 ** = ' PV-OPERATION-MSG-2.       17090002
171000                                                                  17100002
171100     CALL 'ILBOABN0' USING AC-ABEND-CODE.                         17110002
171200                                                                  17120002
171300*9910-EXIT.  EXIT.                                                17130002
171400******************************************************************17140002
171500*     DISPLAY END OF JOB TOTALS                                  *17150002
171600******************************************************************17160002
171700 9920-DISPLAY-TOTALS.                                             17170002
171800                                                                  17180002
171900     DISPLAY '***********************************************'.   17190009
172000     DISPLAY '** STATISTICS FOR CUSTOMER INCENTIVE FILE    **'.   17200009
172100     DISPLAY '***********************************************'.   17210009
172200                                                                  17220002
172300     DISPLAY '**   CUST INCENTIVE EXTRACT RECORDS READ ====> '    17230035
172400             PV-CINCTV-REC-RD                                     17240009
172500             ' **'.                                               17250002
172600     DISPLAY '**  CINCTV SECTION EXTRACT RECORDS READ  ====> '    17260035
172700             PV-CINCTV-SECT-REC-RD                                17270009
172800             ' **'.                                               17280002
172810     DISPLAY '**  CINCTV PARM EXTRACT RECORDS READ     ====> '    17281035
172820             PV-CINCTV-PARM-REC-RD                                17282009
172830             ' **'.                                               17283009
172840     DISPLAY '**  CINCTV MDSE EXTRACT RECORDS READ     ====> '    17284035
172850             PV-CINCTV-MDSE-REC-RD                                17285009
172860             ' **'.                                               17286009
172870     DISPLAY '  '.                                                17287035
172871     DISPLAY '**  TOTAL HEADER RECORDS WRITEN          ====> '    17287135
172880             PV-HDR-REC-WRITEN                                    17288035
172890             ' **'.                                               17289035
172900     DISPLAY '**  TOTAL DETAIL RECORDS WRITEN          ====> '    17290035
173000             PV-DTL-REC-WRITEN                                    17300035
173100             ' **'.                                               17310035
173200     DISPLAY '****************************************'.          17320002
173300                                                                  17330002
173400*9920-EXIT.  EXIT.                                                17340002
173500                                                                  17350002
