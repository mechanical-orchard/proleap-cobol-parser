000100 IDENTIFICATION DIVISION.                                         00010001
000200 PROGRAM-ID.    APKRP119.                                         00020001
000300 AUTHOR.        NANCY EILBES.                                     00030001
000400 INSTALLATION.  KOHLS.                                            00040001
000500 DATE-WRITTEN   NOVEMBER 2003.                                    00050001
000600 DATE-COMPILED.                                                   00060001
000700                                                                  00070001
000800*----------------------------------------------------------------*00080014
000900*  VENDOR MARKDOWN ALLOWANCE ACTIVITY AND AGREEMENTS REPORT      *00090014
000910*  COBOL                                                         *00091014
001000*                                                                *00100001
001100*  THE PURPOSE OF THIS PROGRAM IS TO CREATE A REPORT OF PURCHASE *00110001
001200*  ACTIVITY, ADJUSTMENTS AND VENDOR ALLOWANCE AGREEMENTS.        *00120001
001210*                                                                *00121014
001220*  THE PROGRAM USES THE EXTRACT FILE CREATED IN PROGRAM APKUT118 *00122014
001230*  WHICH HAS BEEN SORTED TO INCLUDE EITHER ALL ACTIVITY PLUS THE *00123014
001240*  MARKDOWN ALLOWANCE AGREEMENTS WITH THEIR ASSOCIATED ACTIVITY, *00124014
001241*  OR ELSE JUST THE MARKDOWN AGREEMENTS WITH THEIR ASSOCIATED    *00124114
001250*  ACTIVITY - BOTH VERSIONS ARE CREATED ON A REGULAR BASIS SO    *00125014
001260*  THAT THE SET-UP OF AGREEMENTS AND TAKING OF APPROPRIATE       *00126014
001270*  DEDUCTIONS CAN BE MONITORED.                                  *00127014
001300*----------------------------------------------------------------*00130014
001310* INPUT:                                                         *00131014
001330*  1. AGREEMENT ACTIVITY EXTRACT FILE         APRD081            *00133014
001331*  2. DATES USED CONTROL CARD                                    *00133114
001332*                                                                *00133214
001333* OUTPUT:                                                        *00133314
001334*  1. MARKDOWN ALLOWANCE ACTIVITY AND AGREEMENT REPORT.          *00133414
001340*  2. MARKDOWN ALLOWANCE ACTIVITY AND AGREEMENT TEXT FILE.       *00134014
001350*                                                                *00135014
001360*----------------------------------------------------------------*00136014
001400* CHANGE LOG:                                                    *00140001
001410*   DATE 11/05/2003                                              *00141014
001420*       CHANGE MADE: INITIAL VERSION.                            *00142014
001430*       MADE BY: NANCY EILBES            WR/IR #: WR25421        *00143014
001440*                                                                *00144014
001450*   DATE 04/22/2004                                              *00145020
001460*       CHANGE MADE: INCREASED LRECL ON FILE USING APRD081       *00146020
001461*       COPYBOOK.  NO LOGIC CHANGES WERE NECESSARY.              *00146120
001470*       MADE BY: NANCY EILBES            WR/IR #: WR26677        *00147020
001480*                                                                *00148020
001500******************************************************************00150001
001600 ENVIRONMENT DIVISION.                                            00160001
001700 CONFIGURATION SECTION.                                           00170001
001800 SOURCE-COMPUTER.        IBM-3090.                                00180001
001900 OBJECT-COMPUTER.        IBM-3090.                                00190001
002000                                                                  00200001
002100 INPUT-OUTPUT SECTION.                                            00210001
002200 FILE-CONTROL.                                                    00220001
002300                                                                  00230001
002400     SELECT ACTIVITY-EXTRACT-FILE        ASSIGN TO INP01.         00240001
002500     SELECT TEXT-OUTPUT-FILE             ASSIGN TO OUT01.         00250011
002510     SELECT REPORT-FILE                  ASSIGN TO RPT01.         00251011
002600                                                                  00260001
002700 DATA DIVISION.                                                   00270001
002800 FILE SECTION.                                                    00280001
002900                                                                  00290001
003000 FD  ACTIVITY-EXTRACT-FILE                                        00300001
003100     RECORDING MODE IS F                                          00310001
003200     LABEL RECORDS ARE STANDARD                                   00320001
003300     BLOCK CONTAINS 0 RECORDS.                                    00330001
003400 01  ACTIVITY-EXTRACT-RECORD         PIC  X(250).                 00340020
003500                                                                  00350001
003600 FD  TEXT-OUTPUT-FILE                                             00360012
003700     RECORDING MODE IS F                                          00370001
003800     LABEL RECORDS ARE STANDARD                                   00380001
003900     BLOCK CONTAINS 0 RECORDS                                     00390001
004000     DATA RECORD IS TEXT-OUT-REC.                                 00400011
004100 01  TEXT-OUT-REC                PIC  X(170).                     00410018
004110                                                                  00411011
004120 FD  REPORT-FILE                                                  00412011
004130     RECORDING MODE IS F                                          00413011
004140     LABEL RECORDS ARE STANDARD                                   00414011
004150     BLOCK CONTAINS 0 RECORDS                                     00415011
004160     DATA RECORD IS REPORT-REC.                                   00416011
004170 01  REPORT-REC                  PIC  X(200).                     00417011
004200                                                                  00420001
004300 WORKING-STORAGE SECTION.                                         00430001
004400                                                                  00440001
004500 01  PC-PROGRAM-CONSTANTS.                                        00450001
004600     05  PC-PROGRAM-NAME     PIC X(08) VALUE 'APKRP119'.          00460001
004700                                                                  00470001
004800 01  PS-PROGRAM-SWITCHES.                                         00480001
004900     05  PS-END-OF-EXTRACT-SW        PIC X(01) VALUE 'N'.         00490001
005000         88  PS-END-OF-EXTRACT                 VALUE 'Y'.         00500001
005100                                                                  00510001
005200 01  CONTROL-CARD-ONE.                                            00520015
005300     05  CC-BEGIN-DTE            PIC X(10).                       00530010
005400     05  FILLER                  PIC X.                           00540010
005500     05  CC-END-DTE              PIC X(10).                       00550010
005600     05  FILLER                  PIC X(59).                       00560010
005610                                                                  00561015
005620 01  CONTROL-CARD-TWO.                                            00562015
005630     05  CC-SUBHEADING           PIC X(40).                       00563015
005660     05  FILLER                  PIC X(40).                       00566015
005700                                                                  00570010
005800 01  PV-REPORT-CONTROLS.                                          00580010
005900     05  PV-LINE-COUNT           PIC S999       VALUE +0.         00590010
006000     05  PC-LINES-PER-PAGE-MAX   PIC S999       VALUE +79.        00600004
006100     05  PV-PAGE-COUNT           PIC S9(05)     VALUE +0.         00610001
006200                                                                  00620001
006300 01  PV-PROGRAM-VARIABLES.                                        00630001
006400     05  PV-EARNED-ALW-AMT           PIC S9(12)V9(2) COMP-3.      00640008
006500     05  PV-UNTAKEN-AMT              PIC S9(12)V9(2) COMP-3.      00650008
006600     05  DM-GROSS-AMT                PIC S9(14)V99  VALUE ZERO.   00660001
006700     05  DM-GROSS-RTV-AMT            PIC S9(14)V99  VALUE ZERO.   00670001
006800     05  DM-GROSS-DSC-AMT            PIC S9(14)V99  VALUE ZERO.   00680001
006900     05  DM-GROSS-RTV-DSC-AMT        PIC S9(14)V99  VALUE ZERO.   00690001
007000     05  DM-EARNED                   PIC S9(14)V99  VALUE ZERO.   00700001
007100     05  DM-ACTUAL-TAKEN             PIC S9(14)V99  VALUE ZERO.   00710001
007200     05  DM-UNTAKEN-AMT              PIC S9(14)V99  VALUE ZERO.   00720009
007300     05  TOT-GROSS-AMT               PIC S9(14)V99  VALUE ZERO.   00730009
007400     05  TOT-GROSS-RTV-AMT           PIC S9(14)V99  VALUE ZERO.   00740009
007500     05  TOT-GROSS-DSC-AMT           PIC S9(14)V99  VALUE ZERO.   00750009
007600     05  TOT-GROSS-RTV-DSC-AMT       PIC S9(14)V99  VALUE ZERO.   00760009
007700     05  TOT-EARNED                  PIC S9(14)V99  VALUE ZERO.   00770009
007800     05  TOT-ACTUAL-TAKEN            PIC S9(14)V99  VALUE ZERO.   00780009
007900     05  TOT-UNTAKEN-AMT             PIC S9(14)V99  VALUE ZERO.   00790009
008000     05  SAVE-DMA-NBR                PIC X(02)      VALUE SPACES. 00800011
008100     05  SAVE-VND-NBR                PIC X(09)      VALUE SPACES. 00810011
008200     05  SAVE-DEPT-NBR               PIC X(03)      VALUE SPACES. 00820011
008300     05  PV-DISCOUNT-PCT-EXPD        PIC 999V99     VALUE ZERO.   00830011
008400     05  PV-INPUT-EXTRACT-CNT        PIC 9(9)       VALUE ZERO.   00840011
008500     05  OUTPUT-COUNT                PIC 9(9)       VALUE ZERO.   00850011
008600                                                                  00860001
008700     05  PV-CURRENT-DATE.                                         00870001
008800         10  PV-CURRENT-CCYY.                                     00880001
008900             15  PV-CURRENT-CC     PIC  9(02)   VALUE ZEROES.     00890001
009000             15  PV-CURRENT-YEAR   PIC  9(02)   VALUE ZEROES.     00900001
009100         10  PV-CURRENT-MONTH      PIC  9(02)   VALUE ZEROES.     00910001
009200         10  PV-CURRENT-DAY        PIC  9(02)   VALUE ZEROES.     00920001
009300     05  PV-CURRENT-TIME.                                         00930001
009400         10  PV-CURRENT-HOUR       PIC  9(02)   VALUE ZEROES.     00940001
009500         10  PV-CURRENT-MINUTE     PIC  9(02)   VALUE ZEROES.     00950001
009600         10  FILLER                PIC  9(02)   VALUE ZEROES.     00960001
009700                                                                  00970001
009800                                                                  00980001
009900*----------------------------------------------------------------*00990001
010000*    STANDARD HEADER LAYOUT                                       01000001
010100*----------------------------------------------------------------*01010001
010200     COPY DPWS200O.                                               01020001
010300                                                                  01030001
010400                                                                  01040001
010500*---------------------------------------------------------------* 01050001
010600*  RECORD LAYOUT FOR RECEIVER                                     01060001
010700*---------------------------------------------------------------* 01070001
010800     COPY APRD081.                                                01080001
010900                                                                  01090001
010910                                                                  01091011
010911*---------------------------------------------------------------* 01091111
010912*  RECORD LAYOUT FOR TEXT OUTPUT FILE                             01091211
010913*---------------------------------------------------------------* 01091311
010914     COPY APRD082.                                                01091418
011020                                                                  01102001
011100*----------------------------------------------------------------*01110001
011200*    REPORT LAYOUT                                                01120001
011300*----------------------------------------------------------------*01130001
011400                                                                  01140001
011500 01  HEADING-LINE-1.                                              01150008
011600     05  FILLER                  PIC  X(71)     VALUE SPACES.     01160008
011700     05  H1-TITLE                PIC  X(58)     VALUE             01170008
011800     'PURCHASE ACTIVITY AND VENDOR MARKDOWN ALLOWANCE AGREEMENTS'.01180008
011900     05  FILLER                  PIC  X(71)     VALUE SPACES.     01190008
012000                                                                  01200001
012100 01  HEADING-LINE-2.                                              01210008
012200     05  FILLER                  PIC  X(80)     VALUE SPACES.     01220008
012300     05  FILLER                  PIC  X(11) VALUE                 01230008
012400                                                  'FOR FISCAL '.  01240008
012500     05  H2-BEGIN-DTE            PIC  X(10).                      01250008
012600     05  FILLER                  PIC  X(09) VALUE ' THROUGH '.    01260008
012700     05  H2-END-DTE              PIC  X(10).                      01270008
012800     05  FILLER                  PIC  X(80)     VALUE SPACES.     01280008
012900                                                                  01290001
012920 01  HEADING-LINE-3.                                              01292015
012930     05  FILLER                  PIC  X(80) VALUE SPACES.         01293016
012940     05  H3-SUBHEADING           PIC  X(40).                      01294015
012950     05  FILLER                  PIC  X(80) VALUE SPACES.         01295016
012960                                                                  01296015
013000 01  HEADING-LINE-4.                                              01300015
013100     05  FILLER                  PIC X(30) VALUE 'VENDOR NAME'.   01310001
013200     05  FILLER                  PIC X(02) VALUE SPACES.          01320009
013300     05  FILLER                  PIC X(09) VALUE 'VENDOR # '.     01330009
013400     05  FILLER                  PIC X(02) VALUE SPACES.          01340009
013500     05  FILLER                  PIC X(03) VALUE 'DPT'.           01350009
013600     05  FILLER                  PIC X(08) VALUE SPACES.          01360009
013700     05  FILLER                  PIC X(10) VALUE ' RECEIPTS'.     01370009
013800     05  FILLER                  PIC X(08) VALUE SPACES.          01380009
013900     05  FILLER                  PIC X(10) VALUE 'NET OF RTV'.    01390009
014000     05  FILLER                  PIC X(06) VALUE SPACES.          01400009
014100     05  FILLER                  PIC X(12) VALUE 'NET OF DISC'.   01410009
014200     05  FILLER                  PIC X(07) VALUE SPACES.          01420009
014300     05  FILLER                  PIC X(11) VALUE                  01430009
014400                                            'NET OF BOTH'.        01440009
014500     05  FILLER                  PIC X(02) VALUE SPACES.          01450009
014600     05  FILLER                  PIC X(5)  VALUE ' PCNT'.         01460009
014700     05  FILLER                  PIC X(01) VALUE SPACES.          01470009
014800     05  FILLER                  PIC X(03) VALUE 'RTV'.           01480008
014900     05  FILLER                  PIC X(01) VALUE SPACES.          01490009
015000     05  FILLER                  PIC X(03) VALUE 'DSC'.           01500001
015100     05  FILLER                  PIC X(01) VALUE SPACES.          01510009
015200     05  FILLER                  PIC X(11) VALUE SPACES.          01520009
015300     05  FILLER                  PIC X(07) VALUE 'EARNED'.        01530001
015400     05  FILLER                  PIC X(07) VALUE SPACES.          01540009
015500     05  FILLER                  PIC X(13) VALUE 'ACTUAL TAKEN'.  01550001
015600     05  FILLER                  PIC X(06) VALUE SPACES.          01560009
015700     05  FILLER                  PIC X(12) VALUE ' DIFFERENCE'.   01570011
015800                                                                  01580001
015900 01  BLANK-LINE                  PIC X(200) VALUE SPACES.         01590009
016000                                                                  01600001
016100 01  DETAIL-LINE.                                                 01610008
016200     05  DL-VENDOR-NAME          PIC X(30) VALUE SPACES.          01620009
016300     05  FILLER                  PIC X(02) VALUE SPACES.          01630009
016400     05  DL-VENDOR-NBR           PIC X(09) VALUE SPACES.          01640009
016500     05  FILLER                  PIC X(02) VALUE SPACES.          01650009
016600     05  DL-DEPT-NBR             PIC X(03) VALUE SPACES.          01660009
016700     05  FILLER                  PIC X(02) VALUE SPACES.          01670009
016800     05  DL-GROSS-AMT            PIC -(12).99.                    01680008
016900     05  FILLER                  PIC X(03) VALUE SPACES.          01690009
017000     05  DL-GROSS-RTV-AMT        PIC -(12).99.                    01700008
017100     05  FILLER                  PIC X(03) VALUE SPACES.          01710009
017200     05  DL-GROSS-DSC-AMT        PIC -(12).99.                    01720008
017300     05  FILLER                  PIC X(03) VALUE SPACES.          01730009
017400     05  DL-GROSS-RTV-DSC-AMT    PIC -(12).99.                    01740008
017500     05  FILLER                  PIC X(02) VALUE SPACES.          01750009
017600     05  DL-DISCOUNT-PCT         PIC ZZ9.99.                      01760008
017700     05  FILLER                  PIC X(02) VALUE SPACES.          01770009
017800     05  DL-RTV-IND              PIC X(01).                       01780008
017900     05  FILLER                  PIC X(03) VALUE SPACES.          01790009
018000     05  DL-DSC-IND              PIC X(01).                       01800008
018100     05  FILLER                  PIC X(02) VALUE SPACES.          01810009
018200     05  FILLER                  PIC X(02) VALUE SPACES.          01820009
018300     05  DL-EARNED               PIC -(12).99.                    01830008
018400     05  FILLER                  PIC X(03) VALUE SPACES.          01840009
018500     05  FILLER                  PIC X(02) VALUE SPACES.          01850009
018600     05  DL-ACTUAL-TAKEN         PIC -(12).99.                    01860008
018700     05  FILLER                  PIC X(03) VALUE SPACES.          01870009
018800     05  DL-UNTAKEN-AMT          PIC -(12).99.                    01880008
018900                                                                  01890001
019000 01  DMA-HEADER-LINE.                                             01900008
019100     05  FILLER                  PIC X(10) VALUE 'DIVISION: '.    01910008
019200     05  DHD-DMA-NBR             PIC X(02) VALUE SPACES.          01920009
019300                                                                  01930001
019400 01  DASH-LINE.                                                   01940008
019500     05  FILLER                  PIC X(46) VALUE SPACES.          01950011
019600     05  FILLER                  PIC X(18) VALUE ALL '-'.         01960011
019800     05  FILLER                  PIC X(02) VALUE SPACES.          01980011
019900     05  FILLER                  PIC X(16) VALUE ALL '-'.         01990011
020100     05  FILLER                  PIC X(02) VALUE SPACES.          02010011
020200     05  FILLER                  PIC X(16) VALUE ALL '-'.         02020011
020400     05  FILLER                  PIC X(02) VALUE SPACES.          02040011
020500     05  FILLER                  PIC X(16) VALUE ALL '-'.         02050011
020700     05  FILLER                  PIC X(18) VALUE SPACES.          02070011
020800     05  FILLER                  PIC X(16) VALUE ALL '-'.         02080011
021000     05  FILLER                  PIC X(04) VALUE SPACES.          02100011
021100     05  FILLER                  PIC X(16) VALUE ALL '-'.         02110011
021300     05  FILLER                  PIC X(02) VALUE SPACES.          02130011
021400     05  FILLER                  PIC X(16) VALUE ALL '-'.         02140011
021600                                                                  02160001
021700 01  DMA-TOTAL-LINE.                                              02170008
021800     05  FILLER                  PIC X(25) VALUE                  02180009
021900                                 '     TOTALS FOR DIVISION '.     02190009
022000     05  DTOT-DMA-NBR            PIC X(02).                       02200008
022100     05  FILLER                  PIC X(1)  VALUE ':'.             02210009
022200     05  FILLER                  PIC X(18) VALUE SPACES.          02220009
022300     05  DTOT-GROSS-AMT          PIC -(14).99.                    02230008
022400     05  FILLER                  PIC X(03) VALUE SPACES.          02240009
022500     05  DTOT-GROSS-RTV-AMT      PIC -(12).99.                    02250008
022600     05  FILLER                  PIC X(03) VALUE SPACES.          02260009
022700     05  DTOT-GROSS-DSC-AMT      PIC -(12).99.                    02270008
022800     05  FILLER                  PIC X(03) VALUE SPACES.          02280009
022900     05  DTOT-GROSS-RTV-DSC-AMT  PIC -(12).99.                    02290008
023000     05  FILLER                  PIC X(19) VALUE SPACES.          02300009
023100     05  DTOT-EARNED             PIC -(12).99.                    02310008
023200     05  FILLER                  PIC X(05) VALUE SPACES.          02320009
023300     05  DTOT-ACTUAL-TAKEN       PIC -(12).99.                    02330008
023400     05  FILLER                  PIC X(03) VALUE SPACES.          02340009
023500     05  DTOT-UNTAKEN-AMT        PIC -(12).99.                    02350008
023600                                                                  02360001
023700 01  GRAND-TOTAL-LINE.                                            02370008
023800     05  FILLER                  PIC X(41) VALUE                  02380009
023900                                           '     GRAND TOTALS:'.  02390009
024000     05  FILLER                  PIC X(05) VALUE SPACES.          02400009
024100     05  TL-GROSS-AMT            PIC -(14).99.                    02410001
024200     05  FILLER                  PIC X(03) VALUE SPACES.          02420009
024300     05  TL-GROSS-RTV-AMT        PIC -(12).99.                    02430001
024400     05  FILLER                  PIC X(03) VALUE SPACES.          02440009
024500     05  TL-GROSS-DSC-AMT        PIC -(12).99.                    02450001
024600     05  FILLER                  PIC X(03) VALUE SPACES.          02460009
024700     05  TL-GROSS-RTV-DSC-AMT    PIC -(12).99.                    02470001
024800     05  FILLER                  PIC X(19) VALUE SPACES.          02480009
024900     05  TL-EARNED               PIC -(12).99.                    02490001
025000     05  FILLER                  PIC X(05) VALUE SPACES.          02500009
025100     05  TL-ACTUAL-TAKEN         PIC -(12).99.                    02510001
025200     05  FILLER                  PIC X(03) VALUE SPACES.          02520009
025300     05  TL-UNTAKEN-AMT          PIC -(12).99.                    02530009
025400                                                                  02540001
025500 01  END-OF-REPORT.                                               02550001
025600     05  FILLER                  PIC  X(83) VALUE SPACES.         02560009
025700     05  FILLER                  PIC  X(33) VALUE                 02570009
025800                              '***  E N D  O F  R E P O R T  ***'.02580009
025900     05  FILLER                  PIC  X(84) VALUE SPACES.         02590009
026000                                                                  02600001
026100 PROCEDURE DIVISION.                                              02610001
026200                                                                  02620001
026300 A100-PROGRAM-MAINLINE.                                           02630001
026400                                                                  02640001
026500     PERFORM B100-INITIALIZE.                                     02650001
026600                                                                  02660001
026700     PERFORM B200-CREATE-REPORT                                   02670011
026800         UNTIL PS-END-OF-EXTRACT.                                 02680001
026900                                                                  02690001
027000     PERFORM B300-EOJ-ROUTINE.                                    02700001
027100                                                                  02710001
027200     GOBACK.                                                      02720001
027300                                                                  02730001
027400                                                                  02740001
027500******************************************************************02750001
027600*  INITIALIZATIONS                                               *02760001
027700******************************************************************02770001
027800 B100-INITIALIZE.                                                 02780001
028000                                                                  02800001
028100     OPEN INPUT  ACTIVITY-EXTRACT-FILE                            02810001
028200          OUTPUT TEXT-OUTPUT-FILE                                 02820013
028210                 REPORT-FILE.                                     02821013
028300                                                                  02830001
028400*    FORMAT HEADING DATA                                          02840001
028500     MOVE FUNCTION CURRENT-DATE TO PV-CURRENT-DATE.               02850009
028600     MOVE PV-CURRENT-MONTH      TO DP200O-RUN-MONTH.              02860009
028700     MOVE PV-CURRENT-DAY        TO DP200O-RUN-DAY.                02870009
028800     MOVE PV-CURRENT-YEAR       TO DP200O-RUN-YEAR.               02880009
028900                                                                  02890001
029000     ACCEPT PV-CURRENT-TIME FROM TIME.                            02900009
029100     MOVE PV-CURRENT-HOUR       TO DP200O-RUN-HOUR.               02910009
029200     MOVE PV-CURRENT-MINUTE     TO DP200O-RUN-MINUTE.             02920009
029300     MOVE PC-PROGRAM-NAME       TO DP200O-PROGRAM-NAME.           02930009
029400     MOVE 1                     TO DP200O-REPORT-NUMBER.          02940009
029500                                                                  02950001
029600     ACCEPT CONTROL-CARD-ONE.                                     02960015
029700     MOVE CC-BEGIN-DTE          TO H2-BEGIN-DTE.                  02970009
029800     MOVE CC-END-DTE            TO H2-END-DTE.                    02980009
029810                                                                  02981015
029820     ACCEPT CONTROL-CARD-TWO.                                     02982015
029830     MOVE CC-SUBHEADING         TO H3-SUBHEADING.                 02983015
029900                                                                  02990009
030000     PERFORM R100-READ-EXTRACT-FILE.                              03000001
030100     MOVE AP081-DMA-NBR  TO SAVE-DMA-NBR.                         03010009
030200     PERFORM W100-WRITE-HEADINGS.                                 03020009
030500                                                                  03050001
030600******************************************************************03060001
030700*  CREATE REPORT DETAIL LINES FROM INPUT FILE.  FILE CAN CONTAIN  03070011
030710*  2 RECORDS FOR THE SAME VENDOR/DEPT; ONE WITH THE AGREEMENT INFO03071011
030720*  AND THE SECOND WITHOUT.  IN THIS CASE, ONLY THE FIRST RECORD   03072011
030730*  IS PROCESSED.  IF A SECOND RECORD IS FOUND FOR A VENDOR/DEPT,  03073011
030740*  IT IS BYPASSED (ANOTHER READ IS DONE WITHOUT CREATING A LINE). 03074011
030800******************************************************************03080001
030900 B200-CREATE-REPORT.                                              03090011
031000                                                                  03100001
031100     IF SAVE-DMA-NBR = AP081-DMA-NBR                              03110005
031200        CONTINUE                                                  03120005
031300     ELSE                                                         03130005
031400        PERFORM D100-POPULATE-DMA-LINE                            03140011
031500        MOVE AP081-DMA-NBR TO SAVE-DMA-NBR                        03150001
031600        PERFORM W200-WRITE-DMA-HEADER                             03160001
031700     END-IF.                                                      03170001
031800                                                                  03180001
031900     IF  AP081-VENDOR-NBR = SAVE-VND-NBR                          03190006
032000     AND AP081-DEPT-NBR = SAVE-DEPT-NBR                           03200005
032100         CONTINUE                                                 03210005
032200     ELSE                                                         03220005
032300         PERFORM C100-POPULATE-REPORT-RECORD                      03230005
032310         PERFORM C200-POPULATE-TEXT-RECORD                        03231019
032400         PERFORM W300-WRITE-REPORT-RECORD                         03240005
032500         MOVE AP081-VENDOR-NBR TO SAVE-VND-NBR                    03250006
032600         MOVE AP081-DEPT-NBR TO SAVE-DEPT-NBR                     03260005
032700     END-IF.                                                      03270005
032800                                                                  03280001
032900     PERFORM R100-READ-EXTRACT-FILE.                              03290001
033000                                                                  03300001
033100                                                                  03310001
033200******************************************************************03320001
033300*  CLOSE CURSOR & OUTPUT FILE, DISPLAY END OF RUN MESSAGE.       *03330001
033400******************************************************************03340001
033500 B300-EOJ-ROUTINE.                                                03350001
033600                                                                  03360001
033700     PERFORM D100-POPULATE-DMA-LINE.                              03370011
033800     PERFORM D200-POPULATE-TOTAL-LINE.                            03380011
033900     PERFORM W400-WRITE-EOR.                                      03390001
034000                                                                  03400001
034100     CLOSE ACTIVITY-EXTRACT-FILE                                  03410001
034200           TEXT-OUTPUT-FILE                                       03420013
034210           REPORT-FILE.                                           03421013
034300                                                                  03430001
034400     DISPLAY 'RECORDS READ            = ' PV-INPUT-EXTRACT-CNT.   03440001
034500     DISPLAY 'RECORDS TO OUTPUT FILE  = ' OUTPUT-COUNT.           03450001
034600                                                                  03460001
039010******************************************************************03901011
039020*  FORMAT REPORT DETAIL                                           03902011
039030******************************************************************03903011
039040 C100-POPULATE-REPORT-RECORD.                                     03904011
039050                                                                  03905011
039060     MOVE AP081-VENDOR-NAME         TO DL-VENDOR-NAME.            03906011
039070     MOVE AP081-VENDOR-NBR          TO DL-VENDOR-NBR.             03907011
039080     MOVE AP081-DEPT-NBR            TO DL-DEPT-NBR.               03908011
039090     MOVE AP081-AGR-RTV-IND         TO DL-RTV-IND.                03909011
039091     MOVE AP081-AGR-DSC-IND         TO DL-DSC-IND.                03909111
039092                                                                  03909211
039093     MOVE AP081-OTHER-ACTVTY-AMT    TO DL-ACTUAL-TAKEN.           03909317
039094     COMPUTE PV-DISCOUNT-PCT-EXPD = AP081-AGR-DISC-PCT * 100.     03909411
039095     MOVE PV-DISCOUNT-PCT-EXPD      TO DL-DISCOUNT-PCT.           03909511
039096                                                                  03909611
039097     MOVE AP081-GROSS-PURCHS-AMT    TO DL-GROSS-AMT.              03909711
039098     MOVE AP081-PRCH-NET-RTV-AMT    TO DL-GROSS-RTV-AMT.          03909811
039099     MOVE AP081-PRCH-NET-DSC-AMT    TO DL-GROSS-DSC-AMT.          03909911
039100     MOVE AP081-PRCH-NET-ALL-AMT    TO DL-GROSS-RTV-DSC-AMT.      03910011
039101                                                                  03910111
039102     IF  AP081-AGR-RTV-IND = 'Y'                                  03910211
039103         IF  AP081-AGR-DSC-IND = 'Y'                              03910311
039104             COMPUTE PV-EARNED-ALW-AMT =                          03910411
039105                AP081-PRCH-NET-ALL-AMT * AP081-AGR-DISC-PCT       03910511
039106         ELSE                                                     03910611
039107             COMPUTE PV-EARNED-ALW-AMT =                          03910711
039108                AP081-PRCH-NET-RTV-AMT * AP081-AGR-DISC-PCT       03910811
039109     ELSE                                                         03910911
039110         IF  AP081-AGR-DSC-IND = 'Y'                              03911011
039111             COMPUTE PV-EARNED-ALW-AMT =                          03911111
039112                AP081-PRCH-NET-DSC-AMT * AP081-AGR-DISC-PCT       03911211
039113         ELSE                                                     03911311
039114             COMPUTE PV-EARNED-ALW-AMT =                          03911411
039115                AP081-GROSS-PURCHS-AMT * AP081-AGR-DISC-PCT       03911511
039116     END-IF.                                                      03911611
039117                                                                  03911711
039118     MOVE PV-EARNED-ALW-AMT         TO DL-EARNED.                 03911811
039119                                                                  03911911
039120     COMPUTE PV-UNTAKEN-AMT =                                     03912011
039121             PV-EARNED-ALW-AMT + AP081-OTHER-ACTVTY-AMT.          03912117
039122     MOVE PV-UNTAKEN-AMT            TO DL-UNTAKEN-AMT.            03912211
039123                                                                  03912311
039130     ADD AP081-GROSS-PURCHS-AMT    TO DM-GROSS-AMT.               03913011
039200     ADD AP081-PRCH-NET-RTV-AMT    TO DM-GROSS-RTV-AMT.           03920008
039300     ADD AP081-PRCH-NET-DSC-AMT    TO DM-GROSS-DSC-AMT.           03930008
039400     ADD AP081-PRCH-NET-ALL-AMT    TO DM-GROSS-RTV-DSC-AMT.       03940008
039500     ADD PV-EARNED-ALW-AMT         TO DM-EARNED.                  03950008
039600     ADD AP081-OTHER-ACTVTY-AMT    TO DM-ACTUAL-TAKEN.            03960017
039700     ADD PV-UNTAKEN-AMT            TO DM-UNTAKEN-AMT.             03970009
039800                                                                  03980001
039801******************************************************************03980111
039802*  FORMAT TEXT RECORD                                             03980211
039803******************************************************************03980311
039804 C200-POPULATE-TEXT-RECORD.                                       03980419
039805                                                                  03980511
039806     MOVE AP081-DMA-NBR             TO AP082-DMA-NBR.             03980618
039807     MOVE AP081-VENDOR-NAME         TO AP082-VENDOR-NAME.         03980718
039808     MOVE AP081-VENDOR-NBR          TO AP082-VENDOR-NBR.          03980818
039809     MOVE AP081-DEPT-NBR            TO AP082-DEPT-NBR.            03980918
039810     MOVE AP081-AGR-RTV-IND         TO AP082-RTV-IND.             03981018
039811     MOVE AP081-AGR-DSC-IND         TO AP082-DSC-IND.             03981118
039812     MOVE AP081-OTHER-ACTVTY-AMT    TO AP082-ACTUAL-TAKEN.        03981218
039814     MOVE PV-DISCOUNT-PCT-EXPD      TO AP082-DISCOUNT-PCT.        03981418
039816     MOVE AP081-GROSS-PURCHS-AMT    TO AP082-GROSS-AMT.           03981618
039817     MOVE AP081-PRCH-NET-RTV-AMT    TO AP082-GROSS-RTV-AMT.       03981718
039818     MOVE AP081-PRCH-NET-DSC-AMT    TO AP082-GROSS-DSC-AMT.       03981818
039819     MOVE AP081-PRCH-NET-ALL-AMT    TO AP082-GROSS-RTV-DSC-AMT.   03981918
039837     MOVE PV-EARNED-ALW-AMT         TO AP082-EARNED.              03983718
039841     MOVE PV-UNTAKEN-AMT            TO AP082-UNTAKEN-AMT.         03984118
039842                                                                  03984211
039843     PERFORM W500-WRITE-TEXT-FILE.                                03984312
039844                                                                  03984411
039845******************************************************************03984511
039846*  FORMAT DMA DETAIL                                              03984611
039847******************************************************************03984711
039848 D100-POPULATE-DMA-LINE.                                          03984811
039850                                                                  03985011
039860     MOVE SAVE-DMA-NBR          TO DTOT-DMA-NBR.                  03986011
039870     MOVE DM-GROSS-AMT          TO DTOT-GROSS-AMT.                03987011
039880     MOVE DM-GROSS-RTV-AMT      TO DTOT-GROSS-RTV-AMT.            03988011
039890     MOVE DM-GROSS-DSC-AMT      TO DTOT-GROSS-DSC-AMT.            03989011
039891     MOVE DM-GROSS-RTV-DSC-AMT  TO DTOT-GROSS-RTV-DSC-AMT.        03989111
039892     MOVE DM-EARNED             TO DTOT-EARNED.                   03989211
039893     MOVE DM-ACTUAL-TAKEN       TO DTOT-ACTUAL-TAKEN.             03989311
039894     MOVE DM-UNTAKEN-AMT TO DTOT-UNTAKEN-AMT.                     03989411
039895                                                                  03989511
039896     WRITE REPORT-REC FROM DASH-LINE                              03989611
039897       AFTER ADVANCING +1 LINES.                                  03989711
039898                                                                  03989811
039899     WRITE REPORT-REC FROM DMA-TOTAL-LINE                         03989911
039900       AFTER ADVANCING +1 LINES.                                  03990011
039901                                                                  03990111
039902     ADD +2          TO  PV-LINE-COUNT.                           03990211
039903                                                                  03990311
039904     ADD DM-GROSS-AMT         TO TOT-GROSS-AMT.                   03990411
039905     ADD DM-GROSS-RTV-AMT     TO TOT-GROSS-RTV-AMT.               03990511
039906     ADD DM-GROSS-DSC-AMT     TO TOT-GROSS-DSC-AMT.               03990611
039907     ADD DM-GROSS-RTV-DSC-AMT TO TOT-GROSS-RTV-DSC-AMT.           03990711
039908     ADD DM-EARNED            TO TOT-EARNED.                      03990811
039909     ADD DM-ACTUAL-TAKEN      TO TOT-ACTUAL-TAKEN.                03990911
039910     ADD DM-UNTAKEN-AMT       TO TOT-UNTAKEN-AMT.                 03991011
039911                                                                  03991111
039912     MOVE ZEROES TO DM-GROSS-AMT                                  03991211
039913                    DM-GROSS-RTV-AMT                              03991311
039914                    DM-GROSS-DSC-AMT                              03991411
039915                    DM-GROSS-RTV-DSC-AMT                          03991511
039916                    DM-EARNED                                     03991611
039917                    DM-ACTUAL-TAKEN                               03991711
039918                    DM-UNTAKEN-AMT.                               03991811
039919                                                                  03991911
039920     IF (PV-LINE-COUNT + 3) > PC-LINES-PER-PAGE-MAX               03992011
039921         PERFORM W100-WRITE-HEADINGS                              03992111
039922     END-IF.                                                      03992211
039923                                                                  03992311
039924                                                                  03992411
039925******************************************************************03992511
039926*  FORMAT TOTAL DETAIL                                            03992611
039927******************************************************************03992711
039928 D200-POPULATE-TOTAL-LINE.                                        03992811
039929                                                                  03992911
039930     MOVE TOT-GROSS-AMT         TO TL-GROSS-AMT.                  03993011
039931     MOVE TOT-GROSS-RTV-AMT     TO TL-GROSS-RTV-AMT.              03993111
039932     MOVE TOT-GROSS-DSC-AMT     TO TL-GROSS-DSC-AMT.              03993211
039933     MOVE TOT-GROSS-RTV-DSC-AMT TO TL-GROSS-RTV-DSC-AMT.          03993311
039934     MOVE TOT-EARNED            TO TL-EARNED.                     03993411
039935     MOVE TOT-ACTUAL-TAKEN      TO TL-ACTUAL-TAKEN.               03993511
039936     MOVE TOT-UNTAKEN-AMT       TO TL-UNTAKEN-AMT.                03993611
039937                                                                  03993711
039938     WRITE REPORT-REC FROM GRAND-TOTAL-LINE                       03993811
039939       AFTER ADVANCING +2 LINES.                                  03993911
039940                                                                  03994011
039941     ADD +2          TO  PV-LINE-COUNT.                           03994111
039942                                                                  03994211
039950                                                                  03995001
040000******************************************************************04000001
040100*   READ  INPUT EXTRACT FILE                                     *04010001
040200******************************************************************04020001
040300 R100-READ-EXTRACT-FILE.                                          04030001
040400                                                                  04040001
040500     INITIALIZE AP081-VNDAGR-EXTRACT.                             04050001
040600                                                                  04060001
040700     READ ACTIVITY-EXTRACT-FILE INTO AP081-VNDAGR-EXTRACT         04070001
040800       AT END SET PS-END-OF-EXTRACT TO TRUE.                      04080001
040900                                                                  04090001
041000     IF PS-END-OF-EXTRACT                                         04100001
041100         CONTINUE                                                 04110001
041200     ELSE                                                         04120001
041300         ADD +1 TO PV-INPUT-EXTRACT-CNT                           04130001
041400     END-IF.                                                      04140001
041500                                                                  04150001
041600                                                                  04160001
047800*----------------------------------------------------------------*04780001
047900*    WRITE PAGE HEADING LINES                                    *04790001
048000*----------------------------------------------------------------*04800001
048100 W100-WRITE-HEADINGS.                                             04810001
048200                                                                  04820001
048300     ADD +1                      TO PV-PAGE-COUNT.                04830001
048400     MOVE PV-PAGE-COUNT          TO DP200O-PAGE-NUMBER.           04840001
048500                                                                  04850001
048600     WRITE REPORT-REC FROM DP200O-STANDRD-HEADER-200-COLS         04860001
048700       AFTER ADVANCING PAGE.                                      04870001
048800                                                                  04880001
048900     WRITE REPORT-REC FROM HEADING-LINE-1                         04890008
049000       AFTER ADVANCING +1 LINES.                                  04900009
049100                                                                  04910001
049200     WRITE REPORT-REC FROM HEADING-LINE-2                         04920008
049300       AFTER ADVANCING +1 LINES.                                  04930001
049400                                                                  04940001
049500     WRITE REPORT-REC FROM HEADING-LINE-3                         04950009
049600       AFTER ADVANCING +1 LINES.                                  04960015
049710                                                                  04971015
049720     WRITE REPORT-REC FROM HEADING-LINE-4                         04972015
049730       AFTER ADVANCING +2 LINES.                                  04973015
049740                                                                  04974015
049800     WRITE REPORT-REC FROM BLANK-LINE                             04980008
049900       AFTER ADVANCING +1 LINES.                                  04990001
050000                                                                  05000009
050100     MOVE SAVE-DMA-NBR TO DHD-DMA-NBR.                            05010009
050200                                                                  05020009
050300     WRITE REPORT-REC FROM DMA-HEADER-LINE                        05030009
050400       AFTER ADVANCING +1 LINES.                                  05040009
050500                                                                  05050009
050600     WRITE REPORT-REC FROM BLANK-LINE                             05060009
050700       AFTER ADVANCING +1 LINES.                                  05070009
050800                                                                  05080009
050900     MOVE +9                     TO PV-LINE-COUNT.                05090015
051000                                                                  05100009
051100*----------------------------------------------------------------*05110001
051200*    WRITE DMA HEADER LINE                                       *05120001
051300*----------------------------------------------------------------*05130001
051400 W200-WRITE-DMA-HEADER.                                           05140001
051500                                                                  05150001
051600     IF (PV-LINE-COUNT + 4) > PC-LINES-PER-PAGE-MAX               05160009
051700         PERFORM W100-WRITE-HEADINGS                              05170001
051800     END-IF.                                                      05180001
051900                                                                  05190001
052000     MOVE SAVE-DMA-NBR TO DHD-DMA-NBR.                            05200008
052100                                                                  05210001
052200     WRITE REPORT-REC FROM DMA-HEADER-LINE                        05220008
052300       AFTER ADVANCING +2 LINES.                                  05230001
052400                                                                  05240009
052500     WRITE REPORT-REC FROM BLANK-LINE                             05250009
052600       AFTER ADVANCING +1 LINES.                                  05260009
052700                                                                  05270001
052800     ADD  +3                     TO PV-LINE-COUNT.                05280009
052900                                                                  05290001
053000******************************************************************05300001
053100*  WRITE OUT REPORT DETAIL LINE                                  *05310001
053200******************************************************************05320001
053300 W300-WRITE-REPORT-RECORD.                                        05330001
053400                                                                  05340001
053500     IF PV-LINE-COUNT > PC-LINES-PER-PAGE-MAX                     05350001
053600         PERFORM W100-WRITE-HEADINGS                              05360001
053700     END-IF.                                                      05370001
053800                                                                  05380001
053900     WRITE REPORT-REC FROM DETAIL-LINE                            05390008
054000       AFTER ADVANCING +1 LINES.                                  05400001
054100                                                                  05410001
054200     ADD +1          TO  PV-LINE-COUNT.                           05420001
054300                                                                  05430001
054400     INITIALIZE DETAIL-LINE.                                      05440008
054500                                                                  05450001
054600                                                                  05460001
054700*----------------------------------------------------------------*05470001
054800*    WRITE END OF REPORT LINE                                    *05480001
054900*----------------------------------------------------------------*05490001
055000 W400-WRITE-EOR.                                                  05500001
055100                                                                  05510001
055200     IF (PV-LINE-COUNT + 3) > PC-LINES-PER-PAGE-MAX               05520001
055300         MOVE SPACES TO DMA-HEADER-LINE                           05530009
055400                        SAVE-DMA-NBR                              05540009
055500         PERFORM W100-WRITE-HEADINGS                              05550001
055600     END-IF.                                                      05560001
055700                                                                  05570001
055800     WRITE REPORT-REC FROM END-OF-REPORT                          05580001
055900       AFTER ADVANCING +3 LINES.                                  05590001
056000                                                                  05600001
056010*----------------------------------------------------------------*05601011
056020*    WRITE RECORDS TO TEXT FILE.                                 *05602011
056030*----------------------------------------------------------------*05603011
056040 W500-WRITE-TEXT-FILE.                                            05604011
056100                                                                  05610001
056110     WRITE TEXT-OUT-REC FROM AP082-TEXT-RECORD.                   05611018
056200     ADD 1 TO OUTPUT-COUNT.                                       05620011
