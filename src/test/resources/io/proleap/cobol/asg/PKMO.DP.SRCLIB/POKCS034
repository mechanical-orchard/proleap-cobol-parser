000100 IDENTIFICATION DIVISION.                                         00010099
000200 PROGRAM-ID.    POKCS034.                                         00020099
000300 AUTHOR.        TOM RUSKA. G&R.                                   00030099
000400 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040099
000500 DATE-WRITTEN.  09-03-93.                                         00050099
000600 DATE-COMPILED.                                                   00060099
000700                                                                  00070099
000800*---------------------------------------------------------------* 00080099
000900*    W034 - PURCHASE ITEM SUMMARY LIST                          * 00090099
001000*                                                               * 00100099
001100*    THIS PROGRAM GENERATES A LIST OF PO LINE ITEMS ASSOCIATED  * 00110099
001200*    WITH A PURCHASE ORDER. THE USER CAN SELECT A SPECIFIC LINE * 00120099
001300*    TO INQUIRE ON IT OR PASS THAT LINE ITEM TO THE STORE       * 00130099
001400*    ALLOCATION SCREEN.                                         * 00140099
001500*                                                               * 00150099
001600*---------------------------------------------------------------* 00160099
001700*   05/25/99  TKMA318   CHRIS KUNSTAMNN  WR 4560                  00170099
001800*                                                                 00180099
001900*  CHANGED 'PERFORM 6100-UPDATE-TSQ UNTIL ' STMT TO USE           00190099
002000* PV-HOLD-SELECTED-ITEMS INSTEAD OF ASC-NUMBER-OF-SELECTED-ITEMS  00200099
002100* ASC-NUMBER-OF-SELECTED-ITEMS IS DECREMENTED IN THE 6110- PP.    00210099
002200*                                                                 00220099
002300*---------------------------------------------------------------* 00230099
002400***************************************************************** 00240099
002500* DATE     WHO      DESCRIPTION                                 * 00250099
002600* 090199   TKMA318  WR #4560, PRODUCT PACKAGING                 * 00260099
002700*                   ADDED CODE FOR NEW FKEYS F23/F24            * 00270099
002800*                   (INNER/MULTI).  ADDED CODE TO PUT A YELLOW  * 00280099
002900*                   ASTERISK NEXT TO PO LINES THAT ARE IN A PK  * 00290099
003000***************************************************************** 00300099
003100* DATE     WHO      DESCRIPTION                                 * 00310099
003200* 011701   TKMA537  WR #21643, E-COMMERCE EDITS                 * 00320099
003300*                   ADDED CODE TO HIGHLIGHT WEB ITEMS IN RED    * 00330099
003400***************************************************************** 00340099
003500* DATE     WHO      DESCRIPTION                                 * 00350099
003600* 042903   TK21263  WR #24803, NI-SKU CONVERSION                * 00360099
003700*                  -ALL THE REFERENCES OF 3 DIGIT DEPARTMENT,   * 00370099
003800*                   2 DIGIT AND 3 DIGIT SEQUENCE NUMBER ARE     * 00380099
003900*                   REPLACED BY 2 DIGIT MAJOR CLASS , 2 DIGIT   * 00390099
004000*                   SUB CLASS AND 8 DIGIT SKU.                  * 00400099
004100*                  -ALL THE COPYBOOKS TSK, TUPCSKU ARE REMOVED. * 00410099
004200*                  -COPYBOOKS XLT00003, XLT00004, XLT00006      * 00420099
004300*                   ARE ADDED.                                  * 00430099
004400*                  -TABLES XLT_SKU, XLT_VND_STYL ARE INCLUDED   * 00440099
004500*                   IN DECLARE ITEM-CSR CURSOR.                 * 00450099
004600*                  -CHANGES ARE MADE IN THE COPYBOOK POWS017    * 00460099
004700*                   ACCORDINGLY AND THE PROGRAM WAS RECOMPILED  * 00470099
004800*                   TO BRING THE NEW CHANGES.                   * 00480099
004900*                  -IN PARAGRAPH 4426-CHECK-TWEBUPC, THE TABLES * 00490099
005000*                   TWEBITM AND TUPCPLS ARE NOT REPLACED BY     * 00500099
005100*                   XLV_WEB_SKU AND XLV_SKU_STR BECAUSE OF      * 00510099
005200*                   PERFORMANCE ISSUES.                         * 00520099
005300***************************************************************** 00530099
005400* DATE     WHO      DESCRIPTION                                 * 00540099
005500* 06/25/03 TKMA643  WR #24803, REMOVED REFERENCE TO SIZE RATIO  * 00550099
005600*                   SCREEN (POKCS085)                           * 00560099
005700***************************************************************** 00570099
005710* DATE     WHO      DESCRIPTION                                   00580099
005720* 07/17/03 TKMA888  ADDED VER_STATUS_CDE = 'A' FOR TPURCHS        00590099
005721*                   TO ELIMINATE MULTIPLE ROWS RETURNED ON JOIN   00600099
005730*                   OF TPURCHS & TPURITM.       WR 23521          00610099
005740***************************************************************** 00620099
P5207 * DATE     WHO      DESCRIPTION                                   00630099
P5207 * 11/18/13 TKMAKZD  COMMENTED OUT THE MULTIPACK PROGRAM CALL      00640099
P5207 *                   FOR MULTI PACKS. CHANGE TAG : P5207           00650099
P5207 *                                           CR# :CHG0081355       00660099
005790***************************************************************** 00670099
C98147* DATE     WHO      DESCRIPTION                                   00680099
C98147* 11/07/14 TKMAB17  EXPANDED PO NUMBER TO 8 DIGITS                00690099
C98147*                                    CHANGE TAG :C98147           00700099
C98147*                                           CR# :CHG0098147       00710099
C98147***************************************************************** 00720099
C66632***************************************************************** 00721099
C66632* DATE     WHO        DESCRIPTION                                 00722099
C66632* 05/05/17 COGNIZANT  IN-RTE FIELD WAS NOT POPULATING AS THE      00723099
C66632*                     8 DIGIT PO NUMBER WAS NOT HANDLED IN THE    00724099
C66632*                     PARAGRAPH 4370-GET-ASN-INFO.                00724199
C66632*                                           CR# :CHG0166632       00725099
C98147***************************************************************** 00726099
263126*    CHANGED 10/27/2021    BY JIM HUNTER      WR: CHG0263126      00727099
263126*    CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE  00728099
263126*    MAKING THE CALL DYNAMIC VS STATIC.                           00729099
263126******************************************************************00729199
CICS  *  CHANGED 11/11/2022    BY BARB SCHULTZ    WR: CHG0278485      * 00730099
CICS  *                                                               * 00730199
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL   * 00730299
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.    * 00730399
CICS  *---------------------------------------------------------------* 00731099
005900/                                                                 00740099
006000 ENVIRONMENT DIVISION.                                            00750099
006100                                                                  00760099
006200 DATA DIVISION.                                                   00770099
006300                                                                  00780099
006400 WORKING-STORAGE SECTION.                                         00790099
006500                                                                  00800099
006600 01  DK-DB2-KEYS.                                                 00810099
006700     05  DK-PO-NBR                 PIC S9(9) COMP VALUE +0.       00820099
006800     05  DK-PO-LNE-NBR             PIC S9(9) COMP VALUE +0.       00830099
006900     05  DK-ENT-ID                 PIC S9(9) COMP VALUE +0.       00840099
007000     05  DK-DEPT-NBR               PIC X(03) VALUE SPACES.        00850099
007100                                                                  00860099
007200 01  PC-PROGRAM-CONSTANTS.                                        00870099
007300     05  PC-CURRENT-MAP-NAME            PIC  X(08)  VALUE         00880099
007400                                                    'PO034A  '.   00890099
007500     05  PC-CURRENT-MAPSET-NAME         PIC  X(08)  VALUE         00900099
007600                                                    'POKM034 '.   00910099
007700     05  PC-CURRENT-PROGRAM-NAME        PIC  X(08)  VALUE         00920099
007800                                                    'POKCS034'.   00930099
007900     05  PC-APPL-MAP                    PIC S9(04)  VALUE  +1     00940099
008000                                                    COMP.         00950099
008100     05  PC-LIST-QUEUE-SEQ              PIC  9(01)  VALUE 1.      00960099
008200     05  PC-SEL-QUEUE-SEQ               PIC  9(01)  VALUE 2.      00970099
008300     05  PC-CRIT-SPEC-FORMAT            PIC  X(01)  VALUE '1'.    00980099
008400     05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +5      00990099
008500                                                    COMP SYNC.    01000099
008600     05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      01010099
008700                                                    COMP SYNC.    01020099
008800     05  PC-MAX-ITEMS                   PIC S9(09)  VALUE         01030099
008900                                                    +1000000      01040099
009000                                                    COMP-3.       01050099
009100     05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +7      01060099
009200                                                    COMP SYNC.    01070099
009300     05  PC-MAX-RETRIES                 PIC S9(03)  VALUE +3      01080099
009400                                                    COMP-3.       01090099
009500     05  PC-MAX-RETRIES-2               PIC S9(03)  VALUE +2      01100099
009600                                                    COMP-3.       01110099
009700     05  PC-PERCENT                     PIC  X(01)  VALUE '%'.    01120099
009800     05  PC-MULTIPLE-UPC                PIC X(15)  VALUE          01130099
009900         'MORE THAN 1 UPC'.                                       01140099
010000     05  PC-NO-VENDOR-UPC               PIC X(15)  VALUE          01150099
010100         'NO VENDOR UPC  '.                                       01160099
010200     05  PC-MIN-UPC                     PIC S9(15)V               01170099
010300                                         VALUE +000400000000000   01180099
010400                                                   COMP-3.        01190099
010500     05  PC-MAX-UPC                     PIC S9(15)V               01200099
010600                                         VALUE +000409999999999   01210099
010700                                                   COMP-3.        01220099
010800     05  PC-TSYMSG-NUMBERS.                                       01230099
010900         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01240099
011000         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01250099
011100         10  PC-TSYMSG-00017            PIC  9(05)  VALUE 00017.  01260099
011200         10  PC-TSYMSG-00047            PIC  9(05)  VALUE 00047.  01270099
011300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01280099
011400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01290099
011500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01300099
011600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01310099
011700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01320099
011800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01330099
011900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01340099
012000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01350099
012100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01360099
012200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01370099
012300         10  PC-TSYMSG-00168            PIC  9(05)  VALUE 00168.  01380099
012400         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01390099
012500         10  PC-TSYMSG-00310            PIC  9(05)  VALUE 00310.  01400099
012600         10  PC-TSYMSG-00330            PIC  9(05)  VALUE 00330.  01410099
012700         10  PC-TSYMSG-00461            PIC  9(05)  VALUE 00461.  01420099
012800         10  PC-TSYMSG-00486            PIC  9(05)  VALUE 00486.  01430099
012900         10  PC-TSYMSG-00587            PIC  9(05)  VALUE 00587.  01440099
013000         10  PC-TSYMSG-00588            PIC  9(05)  VALUE 00588.  01450099
013100         10  PC-TSYMSG-01773            PIC  9(05)  VALUE 01773.  01460099
013200                                                                  01470099
013300 01  PS-PROGRAM-SWITCHES.                                         01480099
013400     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01490099
013500         88  PS-NO-ERROR                            VALUE 'Y'.    01500099
013600         88  PS-ERROR                               VALUE 'N'.    01510099
013700     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01520099
013800         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01530099
013900         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01540099
014000     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01550099
014100         88  PS-DONE                                VALUE 'Y'.    01560099
014200         88  PS-NOT-DONE                            VALUE 'N'.    01570099
014300     05  PS-SKIP-SW                     PIC  X(01)  VALUE 'N'.    01580099
014400         88  PS-DONT-SKIP                           VALUE 'N'.    01590099
014500         88  PS-SKIP                                VALUE 'Y'.    01600099
014600                                                                  01610099
014700 01  PV-PROGRAM-VARIABLES.                                        01620099
014800     05  PV-SUB                         PIC S9(04)  VALUE +0      01630099
014900                                                    COMP SYNC.    01640099
015000     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01650099
015100                                                    COMP SYNC.    01660099
015200     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01670099
015300                                                    COMP-3.       01680099
015400     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01690099
015500                                                    COMP-3.       01700099
015600     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01710099
015700                                                    COMP-3.       01720099
015800     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01730099
015900                                                    COMP-3.       01740099
016000     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01750099
016100                                                    COMP-3.       01760099
016200     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01770099
016300                                                    COMP-3.       01780099
016400     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01790099
016500                                                    COMP-3.       01800099
016600     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01810099
016700                                                    COMP SYNC.    01820099
016800     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01830099
016900                                                    COMP SYNC.    01840099
017000     05  PV-ITEM                        PIC S9(04)  VALUE +0      01850099
017100                                                    COMP SYNC.    01860099
017200     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01870099
017300                                                    COMP SYNC.    01880099
017400     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01890099
017500                                                    COMP SYNC.    01900099
017600     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01910099
017700                                                    COMP SYNC.    01920099
017800     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01930099
017900                                                    COMP SYNC.    01940099
018000     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01950099
018100                                                    COMP SYNC.    01960099
018200     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01970099
018300                                                    COMP SYNC.    01980099
018400     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01990099
018500                                                    COMP SYNC.    02000099
018600     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      02010099
018700                                                    COMP SYNC.    02020099
018800     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      02030099
018900                                                    COMP SYNC.    02040099
019000     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      02050099
019100                                                    COMP SYNC.    02060099
019200     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02070099
019300                                                    COMP SYNC.    02080099
019400     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02090099
019500                                                    COMP SYNC.    02100099
019600     05  PV-DB2-COUNT                   PIC S9(09)  VALUE +0      02110099
019700                                                    COMP-3.       02120099
019800     05  PV-VER-QTY-NULL                PIC S9(04)  VALUE +0      02130099
019900                                                    COMP SYNC.    02140099
020000     05  PV-ASN-QTY-NULL                PIC S9(04)  VALUE +0      02150099
020100                                                    COMP SYNC.    02160099
020200     05  PV-ALLOC-NULL                  PIC S9(04)  VALUE +0      02170099
020300                                                    COMP SYNC.    02180099
020400     05  PV-ALLOC-ALLPLN-NULL           PIC S9(04)  VALUE +0      02190099
020500                                                    COMP SYNC.    02200099
020600     05  PV-PO-LNE-NBR                  PIC S9(09)  VALUE +0      02210099
020700                                                    COMP.         02220099
020800     05  PV-ASN-PO-LN-NBR               PIC S9(03)V VALUE +0      02230099
020900                                                    COMP-3.       02240099
021000     05  PV-ASN-PO-NBR                  PIC X(22)   VALUE SPACES. 02250099
021100     05  PV-ASN-PO-NBR-6                PIC X(22)   VALUE SPACES. 02260099
C66632     05  PV-ASN-PO-NBR-8                PIC X(22)   VALUE SPACES. 02261099
021200     05  PV-PO-NBR9                     PIC 9(10)   VALUE ZEROES. 02270099
021300     05  PV-UPC-NBR                     PIC 9(15).                02280099
021400     05  PV-UPC-NBR-X REDEFINES PV-UPC-NBR                        02290099
021500                                        PIC X(15).                02300099
021600     05  PV-UPC-NBR-DISPLAY             PIC X(16)   VALUE SPACES. 02310099
021700     05  PV-AD-DATE-10.                                           02320099
021800         10  PV-AD-DATE-CC         PIC X(02).                     02330099
021900         10  PV-AD-DATE.                                          02340099
022000             15  PV-AD-DATE-YY     PIC X(02).                     02350099
022100             15  FILLER            PIC X(01)    VALUE '-'.        02360099
022200             15  PV-AD-DATE-MM     PIC X(02).                     02370099
022300             15  FILLER            PIC X(01)    VALUE '-'.        02380099
022400             15  PV-AD-DATE-DD     PIC X(02).                     02390099
022500     05  PV-SLASH-DATE.                                           02400099
022600         10  PV-SL-DATE.                                          02410099
022700             15  PV-SL-DATE-MM     PIC X(02).                     02420099
022800             15  FILLER            PIC X(01)    VALUE '/'.        02430099
022900             15  PV-SL-DATE-DD     PIC X(02).                     02440099
023000             15  FILLER            PIC X(01)    VALUE '/'.        02450099
023100             15  PV-SL-DATE-YY     PIC X(02).                     02460099
023200         10  PV-SL-DATE-CC         PIC X(02).                     02470099
023300     05  PV-NULL-INDICATORS.                                      02480099
023400         10 PV-MAJ-CL-NBR-IND      PIC S9(04) COMP VALUE +0.      02490099
023500         10 PV-SUB-CL-NBR-IND      PIC S9(04) COMP VALUE +0.      02500099
023600         10 PV-SKU-NBR-IND         PIC S9(04) COMP VALUE +0.      02510099
023700         10 PV-VS-NBR-IND          PIC S9(04) COMP VALUE +0.      02520099
023800         10 PV-SKU-DESC-IND        PIC S9(04) COMP VALUE +0.      02530099
023900     05  PV-TEMP-SKU.                                             02540099
024000         10  PV-TEMP-DEPT          PIC 9(03)       VALUE 0.       02550099
024100         10  PV-TEMP-CLASS         PIC 9(02)       VALUE 0.       02560099
024200         10  PV-TEMP-SEQ           PIC 9(03)       VALUE 0.       02570099
024300     05  PV-SKU REDEFINES PV-TEMP-SKU                             02580099
024400                                   PIC 9(08).                     02590099
024500     05  PV-TEMP-MAJ-CL.                                          02600099
024600         10  PV-TEMP-MAJ-CL-1      PIC 9(01)       VALUE 0.       02610099
024700         10  FILLER                PIC 9(01)       VALUE 0.       02620099
024800     05  PV-MAJ-CLASS REDEFINES PV-TEMP-MAJ-CL                    02630099
024900                                   PIC 9(02).                     02640099
025000                                                                  02650099
025100*---------------------------------------------------------------* 02660099
025200*   THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   * 02670099
025300*   THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           * 02680099
025400*   APPLICATION-SPECIFIC COMMAREA.                              * 02690099
025500*---------------------------------------------------------------* 02700099
025600 01  LQW-LIST-QUEUE-WORK-AREA.                                    02710099
025700     05  LQW-BLOCK-MODIFIED             PIC X(01)   VALUE SPACE.  02720099
025800     05  LQW-ITEM-ENTRIES               OCCURS 5 TIMES            02730099
025900                                        INDEXED BY LQW-IDX.       02740099
026000         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02750099
026100         10  LQW-TEMP-SELECTED-SW       PIC X(01).                02760099
026200         10  LQW-SELECTED-SW            PIC X(01).                02770099
026300             88  LQW-SELECT                         VALUE 'S'.    02780099
026400             88  LQW-DESELECT                       VALUE ' '.    02790099
026500         10  LQW-PO-LNE-NBR             PIC 9(03).                02800099
026600         10  LQW-APP-PO-LNE-NBR         PIC 9(03).                02810099
026700         10  LQW-PO-LNE-VAR-NBR         PIC 9(03).                02820099
026800         10  LQW-MAJ-CL-NBR             PIC X(02).                02830099
026900         10  LQW-SUB-CL-NBR             PIC X(02).                02840099
027000         10  LQW-SKU-NBR                PIC X(08).                02850099
027100         10  LQW-VEND-STYL-NAME         PIC X(20).                02860099
027200         10  LQW-STATUS-CDE             PIC X(02).                02870099
027300         10  LQW-UNT-QTY                PIC 9(06).                02880099
027400         10  LQW-QTY-IN-RTE             PIC 9(06).                02890099
027500         10  LQW-QTY-RCV                PIC 9(06).                02900099
027600         10  LQW-ALLOC                  PIC X(04).                02910099
027700         10  LQW-PO-PREPK-ID            PIC S9(04) COMP.          02920099
027800         10  LQW-UPC                    PIC X(16).                02930099
027900         10  LQW-VEND-DESC              PIC X(30).                02940099
028000         10  LQW-AD-EVNT-DTE            PIC X(08).                02950099
028100                                                                  02960099
028200/                                                                 02970099
028300*---------------------------------------------------------------* 02980099
028400*  RECORD LAYOUT FOR THE LIST SELECTION TEMP STORAGE QUEUE.     * 02990099
028500*---------------------------------------------------------------* 03000099
028600                                                                  03010099
028700     COPY POWS012.                                                03020099
028800                                                                  03030099
028900/                                                                 03040099
029000*---------------------------------------------------------------* 03050099
029100*    MAP LAYOUT                                                 * 03060099
029200*---------------------------------------------------------------* 03070099
029300                                                                  03080099
029400     COPY POKM034.                                                03090099
029500                                                                  03100099
029600 01  MR-OCCURS-LAYOUT                   REDEFINES  PO034AO.       03110099
029700     05  FILLER                         PIC X(48).                03120099
029800                                                                  03130099
029900     05  FILLER                         PIC X(05).                03140099
030000     05  MR-PO-NBR-X.                                             03150099
C98147         10  MR-PO-NBR                  PIC Z(8).                 03160099
030200                                                                  03170099
030300     05  FILLER                         PIC X(05).                03180099
030400     05  MR-DEPT-NBR                    PIC X(3).                 03190099
030500                                                                  03200099
030600     05  FILLER                         PIC X(05).                03210099
030700     05  MR-ENT-NAME-DESC               PIC X(30).                03220099
030800                                                                  03230099
030900     05  FILLER                         PIC X(05).                03240099
031000     05  MR-TOT-UNT-QTY-X.                                        03250099
031100         10  MR-TOT-UNT-QTY             PIC Z(7).                 03260099
031200                                                                  03270099
031300     05  FILLER                         PIC X(05).                03280099
031400     05  MR-TOT-SKUS-QTY-X.                                       03290099
031500         10  MR-TOT-SKUS-QTY            PIC Z(3).                 03300099
031600                                                                  03310099
031700     05  MR-SCROLL-AREA                 OCCURS 5 TIMES.           03320099
031800         10  MR-SELECTL                 PIC S9(04) COMP.          03330099
031900         10  MR-SELECTA                 PIC X(01).                03340099
032000         10  MR-SELECTC                 PIC X(01).                03350099
032100         10  MR-SELECTH                 PIC X(01).                03360099
032200         10  MR-SELECT                  PIC X(01).                03370099
032300                                                                  03380099
032400         10  FILLER                     PIC X(05).                03390099
032500         10  MR-PO-LNE-NBR-X.                                     03400099
032600             15  MR-PO-LNE-NBR          PIC ZZZ.                  03410099
032700                                                                  03420099
032800         10  MR-MAJ-CL-NBRL             PIC S9(04) COMP.          03430099
032900         10  MR-MAJ-CL-NBRA             PIC X(01).                03440099
033000         10  MR-MAJ-CL-NBRC             PIC X(01).                03450099
033100         10  MR-MAJ-CL-NBRH             PIC X(01).                03460099
033200         10  MR-MAJ-CL-NBR-X.                                     03470099
033300             15  MR-MAJ-CL-NBR          PIC X(02).                03480099
033400                                                                  03490099
033500         10  MR-SUB-CL-NBRL             PIC S9(04) COMP.          03500099
033600         10  MR-SUB-CL-NBRA             PIC X(01).                03510099
033700         10  MR-SUB-CL-NBRC             PIC X(01).                03520099
033800         10  MR-SUB-CL-NBRH             PIC X(01).                03530099
033900         10  MR-SUB-CL-NBR-X.                                     03540099
034000             15  MR-SUB-CL-NBR          PIC X(02).                03550099
034100                                                                  03560099
034200         10  MR-SKU-NBRL                PIC S9(04) COMP.          03570099
034300         10  MR-SKU-NBRA                PIC X(01).                03580099
034400         10  MR-SKU-NBRC                PIC X(01).                03590099
034500         10  MR-SKU-NBRH                PIC X(01).                03600099
034600         10  MR-SKU-NBR-X.                                        03610099
034700             15  MR-SKU-NBR             PIC X(08).                03620099
034800                                                                  03630099
034900         10  FILLER                     PIC X(05).                03640099
035000         10  MR-VEND-STYL-NAME          PIC X(20).                03650099
035100                                                                  03660099
035200         10  FILLER                     PIC X(05).                03670099
035300         10  MR-STATUS-CDE              PIC X(02).                03680099
035400                                                                  03690099
035500         10  FILLER                     PIC X(05).                03700099
035600         10  MR-UNT-QTY-X.                                        03710099
035700             15  MR-UNT-QTY             PIC Z(6).                 03720099
035800                                                                  03730099
035900         10  FILLER                     PIC X(05).                03740099
036000         10  MR-QTY-IN-RTE-X.                                     03750099
036100             15  MR-QTY-IN-RTE          PIC Z(6).                 03760099
036200                                                                  03770099
036300         10  FILLER                     PIC X(05).                03780099
036400         10  MR-QTY-REC-X.                                        03790099
036500             15  MR-QTY-REC             PIC Z(6).                 03800099
036600                                                                  03810099
036700         10  FILLER                     PIC X(05).                03820099
036800         10  MR-ALLOC                   PIC X(04).                03830099
036900                                                                  03840099
037000         10  FILLER                     PIC X(05).                03850099
037100         10  MR-PACK-IND                PIC X(01).                03860099
037200                                                                  03870099
037300         10  FILLER                     PIC X(05).                03880099
037400         10  MR-UPC-NBR                 PIC X(16).                03890099
037500                                                                  03900099
037600         10  FILLER                     PIC X(05).                03910099
037700         10  MR-VEND-DESC               PIC X(30).                03920099
037800                                                                  03930099
037900         10  FILLER                     PIC X(05).                03940099
038000         10  MR-AD-EVNT-DTE             PIC X(08).                03950099
038100                                                                  03960099
038200/                                                                 03970099
038300*---------------------------------------------------------------* 03980099
038400*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03990099
038500*---------------------------------------------------------------* 04000099
038600                                                                  04010099
038700     COPY DPWS015.                                                04020099
038800                                                                  04030099
038900*---------------------------------------------------------------* 04040099
039000*    FUNCTION KEYS COPYBOOK.                                    * 04050099
039100*---------------------------------------------------------------* 04060099
039200                                                                  04070099
039300     COPY DPWS016.                                                04080099
039400                                                                  04090099
039500*---------------------------------------------------------------* 04100099
039600*    NUMERIC EDIT LAYOUT.                                       * 04110099
039700*---------------------------------------------------------------* 04120099
039800                                                                  04130099
039900     COPY DPWS010I.                                               04140099
040000                                                                  04150099
040100/                                                                 04160099
040200*---------------------------------------------------------------* 04170099
CICS  * PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.             * 04180099
040400*---------------------------------------------------------------* 04190099
040500                                                                  04200099
040600     COPY DPWS030.                                                04210099
CICS       COPY DPWS930.                                                04220099
040700                                                                  04221099
040800/                                                                 04230099
040900*---------------------------------------------------------------* 04240099
041000*    STANDARD COMMAREA.                                         * 04250099
041100*---------------------------------------------------------------* 04260099
041200                                                                  04270099
041300     COPY DPWS020.                                                04280099
041400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04290099
041500                                                                  04300099
041600*---------------------------------------------------------------* 04310099
041700* INTER-APPLICATION COMMAREA.                                   * 04320099
041800*---------------------------------------------------------------* 04330099
041900                                                                  04340099
042000         10  INTER-APPL-COMM-AREA       PIC X(200).               04350099
042100     COPY POWS013.                                                04360099
042200     COPY POWS017.                                                04370099
042300*---------------------------------------------------------------* 04380099
042400*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04390099
042500*---------------------------------------------------------------* 04400099
042600         10  ASC-SPECIFIC-COMMAREA.                               04410099
042700             15  ASC-LIST-KEYS.                                   04420099
042800                 20  ASC-KEY-PO-NBR        PIC S9(9) COMP.        04430099
042900                 20  ASC-KEY-ENT-ID        PIC S9(9) COMP.        04440099
043000                 20  ASC-KEY-DEPT-NBR      PIC X(3).              04450099
043100                 20  ASC-KEY-ENT-NAME-DESC PIC X(30).             04460099
043200             15  ASC-BLOCK-ENTRIES      OCCURS 2 TIMES.           04470099
043300                 20  ASC-BLOCK-MODIFIED-SW                        04480099
043400                                        PIC X(01).                04490099
043500                     88  ASC-BLOCK-NOT-MODIFIED    VALUE 'N'.     04500099
043600                     88  ASC-BLOCK-MODIFIED        VALUE 'Y'.     04510099
043700                                                                  04520099
043800                 20  ASC-ITEM-ARRAY.                              04530099
043900                     25  ASC-ITEM-ENTRIES OCCURS 5 TIMES.         04540099
044000                         30  ASC-LIST-ITEM-NUMBER                 04550099
044100                                        PIC S9(09) COMP-3.        04560099
044200                         30  ASC-TEMP-SELECTED-SW                 04570099
044300                                        PIC X(01).                04580099
044400                             88  ASC-VALID-SELECT  VALUE ' '      04590099
044500                                                         'S'      04600099
044600                                                         'B'      04610099
044700                                                         'E'.     04620099
044800                             88  ASC-TEMP-NO-SELECT               04630099
044900                                                   VALUE ' '.     04640099
045000                             88  ASC-TEMP-SELECT   VALUE 'S'.     04650099
045100                             88  ASC-TEMP-BEGIN    VALUE 'B'.     04660099
045200                             88  ASC-TEMP-END      VALUE 'E'.     04670099
045300                         30  ASC-SELECTED-SW                      04680099
045400                                        PIC X(01).                04690099
045500                             88  ASC-NO-SELECT     VALUE ' '.     04700099
045600                             88  ASC-SELECT        VALUE 'S'.     04710099
045700                             88  ASC-BEGIN         VALUE 'B'.     04720099
045800                             88  ASC-END           VALUE 'E'.     04730099
045900                         30  ASC-PO-LNE-NBR     PIC 9(03).        04740099
046000                         30  ASC-APP-PO-LNE-NBR PIC 9(03).        04750099
046100                         30  ASC-PO-LNE-VAR-NBR PIC 9(03).        04760099
046200                         30  ASC-MAJ-CL-NBR     PIC 9(02).        04770099
046300                         30  ASC-SUB-CL-NBR     PIC 9(02).        04780099
046400                         30  ASC-SKU-NBR        PIC 9(08).        04790099
046500                         30  ASC-VEND-STYL-NAME PIC X(20).        04800099
046600                         30  ASC-STATUS-CDE     PIC X(02).        04810099
046700                         30  ASC-UNT-QTY        PIC 9(06).        04820099
046800                         30  ASC-QTY-IN-RTE     PIC 9(06).        04830099
046900                         30  ASC-QTY-IN-RTE-X REDEFINES           04840099
047000                             ASC-QTY-IN-RTE     PIC X(06).        04850099
047100                         30  ASC-QTY-REC        PIC 9(06).        04860099
047200                         30  ASC-ALLOC          PIC X(04).        04870099
047300                         30  ASC-PO-PREPK-ID    PIC S9(4) COMP.   04880099
047400                         30  ASC-UPC-NBR        PIC X(16).        04890099
047500                         30  ASC-VEND-DESC      PIC X(30).        04900099
047600                         30  ASC-AD-EVNT-DTE    PIC X(08).        04910099
047700                                                                  04920099
047800             15  ASC-BLK-SUB            PIC S9(04) COMP SYNC.     04930099
047900             15  ASC-ITEM-SUB           PIC S9(04) COMP SYNC.     04940099
048000             15  ASC-NUMBER-OF-ITEMS-READ                         04950099
048100                                        PIC S9(09) COMP-3.        04960099
048200             15  ASC-NUMBER-OF-SELECTED-ITEMS                     04970099
048300                                        PIC S9(09) COMP-3.        04980099
048400             15  ASC-ITEMS-DISPLAYED    PIC S9(03) COMP-3.        04990099
048500             15  ASC-ITEM-AT-TOP-OF-PANEL                         05000099
048600                                        PIC S9(09) COMP-3.        05010099
048700             15  ASC-ITEM-AT-BOT-OF-PANEL                         05020099
048800                                        PIC S9(09) COMP-3.        05030099
048900             15  ASC-HIGHEST-BLOCK-WRITTEN                        05040099
049000                                        PIC S9(04) COMP SYNC.     05050099
049100             15  ASC-START-OF-SELECTED-RANGE                      05060099
049200                                        PIC S9(09) COMP-3.        05070099
049300             15  ASC-END-OF-SELECTED-RANGE                        05080099
049400                                        PIC S9(09) COMP-3.        05090099
049500             15  ASC-ITEMS-LEFT-INDICATOR                         05100099
049600                                        PIC X(01).                05110099
049700                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     05120099
049800                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     05130099
049900             15  ASC-TEMP-QUEUE-UPDATE-SW                         05140099
050000                                        PIC X(01).                05150099
050100                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     05160099
050200                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     05170099
050300             15  ASC-LIST-QUEUE-NAME.                             05180099
050400                 20  ASC-LIST-TERM-ID   PIC X(04).                05190099
050500                 20  ASC-LIST-TASK-NUMBER                         05200099
050600                                        PIC S9(05) COMP-3.        05210099
050700                 20  ASC-LIST-SEQ       PIC 9(01).                05220099
050800             15  ASC-SEL-QUEUE-NAME.                              05230099
050900                 20  ASC-SEL-TERM-ID    PIC X(04).                05240099
051000                 20  ASC-SEL-TASK-NUMBER                          05250099
051100                                        PIC S9(05) COMP-3.        05260099
051200                 20  ASC-SEL-SEQ        PIC 9(01).                05270099
051300                                                                  05280099
051400             15  ASC-CURSOR-SW          PIC X(01).                05290099
051500                 88  ASC-NO-CURSOR                 VALUE 'N'.     05300099
051600                 88  ASC-ITEM-CURSOR               VALUE 'I'.     05310099
051700                 88  ASC-APP-ITEM-CURSOR           VALUE 'A'.     05320099
051800             15  ASC-START-ITEM-REQUEST.                          05330099
051900                 20  ASC-START-ITEM-REQUEST-N                     05340099
052000                                        PIC 9(07).                05350099
052100             15  ASC-TOT-UNT-QTY        PIC 9(07).                05360099
052200             15  ASC-TOT-SKUS-QTY       PIC 9(03).                05370099
052300             15  ASC-PO-TYP-CDE         PIC X(02).                05380099
052400             15  ASC-CRE-BY-UID         PIC X(08).                05390099
052500*  ADDED 05-12-99 FOR PRODUCT PREPACKAGING PROJECT                05400099
052600             15  ASC-PO-PKGNG-CDE       PIC X(01).                05410099
052700         10  FILLER                     PIC X(1457).              05420099
052800/                                                                 05430099
052900*---------------------------------------------------------------* 05440099
053000*    ABEND PROCESSING COPYBOOK                                  * 05450099
053100*---------------------------------------------------------------* 05460099
053200                                                                  05470099
053300     COPY DPWS013.                                                05480099
053400                                                                  05490099
053500/                                                                 05500099
053600*---------------------------------------------------------------* 05510099
053700*    DB2 AREA FOR THE PURCHASE ORDER TABLE                      * 05520099
053800*---------------------------------------------------------------* 05530099
053900     EXEC SQL                                                     05540099
054000          INCLUDE TPURCHS                                         05550099
054100     END-EXEC.                                                    05560099
054200                                                                  05570099
054300/                                                                 05580099
054400*---------------------------------------------------------------* 05590099
054500*    DB2 AREA FOR THE PURCHASE ORDER LINE ITEM TABLE            * 05600099
054600*---------------------------------------------------------------* 05610099
054700     EXEC SQL                                                     05620099
054800          INCLUDE TPURITM                                         05630099
054900     END-EXEC.                                                    05640099
055000                                                                  05650099
055100/                                                                 05660099
055200*---------------------------------------------------------------* 05670099
055300*    DB2 AREA FOR THE ENTERPRISE NAME TABLE                     * 05680099
055400*---------------------------------------------------------------* 05690099
055500     EXEC SQL                                                     05700099
055600          INCLUDE TENTNME                                         05710099
055700     END-EXEC.                                                    05720099
055800                                                                  05730099
055900/                                                                 05740099
056000*---------------------------------------------------------------* 05750099
056100*    DB2 AREA FOR THE SKU TABLE                                 * 05760099
056200*---------------------------------------------------------------* 05770099
056300     EXEC SQL                                                     05780099
056400          INCLUDE XLT00003                                        05790099
056500     END-EXEC.                                                    05800099
056600                                                                  05810099
056700/                                                                 05820099
056800*---------------------------------------------------------------* 05830099
056900*    DB2 AREA FOR THE UPC TABLE                                 * 05840099
057000*---------------------------------------------------------------* 05850099
057100     EXEC SQL                                                     05860099
057200          INCLUDE XLT00006                                        05870099
057300     END-EXEC.                                                    05880099
057400                                                                  05890099
057500/                                                                 05900099
057600*---------------------------------------------------------------* 05910099
057700*    DB2 AREA FOR VENOR STYLE TABLE                             * 05920099
057800*---------------------------------------------------------------* 05930099
057900     EXEC SQL                                                     05940099
058000          INCLUDE XLT00004                                        05950099
058100     END-EXEC.                                                    05960099
058200*---------------------------------------------------------------* 05970099
058300*    DB2 AREA FOR THE STORE ALLOCATIONS                         * 05980099
058400*---------------------------------------------------------------* 05990099
058500     EXEC SQL                                                     06000099
058600          INCLUDE TMESTDS                                         06010099
058700     END-EXEC.                                                    06020099
058800                                                                  06030099
058900/                                                                 06040099
059000*---------------------------------------------------------------* 06050099
059100*    DB2 AREA FOR THE PLAN  ALLOCATIONS                         * 06060099
059200*---------------------------------------------------------------* 06070099
059300     EXEC SQL                                                     06080099
059400          INCLUDE TALLPLN                                         06090099
059500     END-EXEC.                                                    06100099
059600                                                                  06110099
059700/                                                                 06120099
060600*---------------------------------------------------------------* 06130099
060700*    DB2 AREA FOR THE RECEIVING STORE DISTRIBUTION TABLE        * 06140099
060800*---------------------------------------------------------------* 06150099
060900     EXEC SQL                                                     06160099
061000          INCLUDE TRECDIS                                         06170099
061100     END-EXEC.                                                    06180099
061200                                                                  06190099
061300/                                                                 06200099
061400*---------------------------------------------------------------* 06210099
061500*    DB2 AREA FOR THE ASN TASDTPL TABLE                         * 06220099
061600*---------------------------------------------------------------* 06230099
061700     EXEC SQL                                                     06240099
061800          INCLUDE TASDTPL                                         06250099
061900     END-EXEC.                                                    06260099
062000                                                                  06270099
062100/                                                                 06280099
062200*---------------------------------------------------------------* 06290099
062300*    DB2 AREA FOR TWEBITM TABLE                                 * 06300099
062400*---------------------------------------------------------------* 06310099
062500     EXEC SQL                                                     06320099
062600          INCLUDE TWEBITM                                         06330099
062700     END-EXEC.                                                    06340099
062800                                                                  06350099
062900/                                                                 06360099
063000*---------------------------------------------------------------* 06370099
063100*    DB2 AREA FOR TUPCPLS TABLE                                 * 06380099
063200*---------------------------------------------------------------* 06390099
063300     EXEC SQL                                                     06400099
063400          INCLUDE TUPCPLS                                         06410099
063500     END-EXEC.                                                    06420099
063600                                                                  06430099
063700/                                                                 06440099
063800*---------------------------------------------------------------* 06450099
063900*    DB2 AREA FOR COMMUNICATIONS                                * 06460099
064000*---------------------------------------------------------------* 06470099
064100     EXEC SQL                                                     06480099
064200          INCLUDE SQLCA                                           06490099
064300     END-EXEC.                                                    06500099
064400                                                                  06510099
064500/                                                                 06520099
064600*---------------------------------------------------------------* 06530099
064700*  CURSOR TO SELECT LINE ITEMS WHEN PO IS NOT APPROVED          * 06540099
064800*---------------------------------------------------------------* 06550099
064900                                                                  06560099
065000     EXEC SQL                                                     06570099
065100          DECLARE ITEM-CSR CURSOR FOR                             06580099
065200          SELECT DISTINCT P.PO_LNE_NBR                            06590099
065300                ,V.MAJ_CL_NBR                                     06600099
065400                ,V.SUB_CL_NBR                                     06610099
065500                ,S.SKU_NBR                                        06620099
065600                ,V.VS_NBR                                         06630099
065700                ,S.SKU_DESC                                       06640099
065800                ,P.STATUS_CDE                                     06650099
065900                ,P.UNT_QTY                                        06660099
066000                ,P.AD_EVNT_DTE                                    06670099
066100                ,P.APP_PO_LNE_NBR                                 06680099
066200                ,T.DEPT_NBR                                       06690099
066300                ,P.CL_NBR                                         06700099
066400                ,P.VEND_STYL_NAME                                 06710099
066500                ,P.SKU_DESC                                       06720099
066600                ,P.SKU_SEQ_NBR                                    06730099
066700            FROM TPURCHS T                                        06740099
066800               , TPURITM P LEFT OUTER JOIN                        06750099
066900                 XLT_SKU S ON P.ITM_NBR = S.ITM_NBR               06760099
067000                 LEFT OUTER JOIN                                  06770099
067100                 XLT_VND_STYL V ON S.STYL_ID = V.STYL_ID          06780099
067200          WHERE P.PO_NBR         = :PURITM-PO-NBR                 06790099
067300          AND   P.PO_NBR       = T.PO_NBR                         06800099
067400            AND T.VER_STATUS_CDE = 'A'                            06810099
067410            AND P.VER_STATUS_CDE = 'A'                            06820099
067420          ORDER BY                                                06830099
067430                PO_LNE_NBR                                        06840099
067440     END-EXEC.                                                    06850099
067450                                                                  06860099
067460/                                                                 06870099
067470*---------------------------------------------------------------* 06880099
067480*  CURSOR TO SELECT LINE ITEMS WHEN PO IS APPROVED              * 06890099
067490*---------------------------------------------------------------* 06900099
067500                                                                  06910099
067600     EXEC SQL                                                     06920099
067700          DECLARE APP-ITEM-CSR CURSOR FOR                         06930099
067800          SELECT DISTINCT P.PO_LNE_NBR                            06940099
067900                ,P.APP_PO_LNE_NBR                                 06950099
068000                ,V.MAJ_CL_NBR                                     06960099
068100                ,V.SUB_CL_NBR                                     06970099
068200                ,S.SKU_NBR                                        06980099
068300                ,V.VS_NBR                                         06990099
068400                ,S.SKU_DESC                                       07000099
068500                ,P.STATUS_CDE                                     07010099
068600                ,P.UNT_QTY                                        07020099
068700                ,P.AD_EVNT_DTE                                    07030099
068800                ,T.DEPT_NBR                                       07040099
068900                ,P.CL_NBR                                         07050099
069000                ,P.VEND_STYL_NAME                                 07060099
069100                ,P.SKU_DESC                                       07070099
069200                ,P.SKU_SEQ_NBR                                    07080099
069300            FROM TPURCHS T                                        07090099
069400               , TPURITM P LEFT OUTER JOIN                        07100099
069500                 XLT_SKU S ON P.ITM_NBR = S.ITM_NBR               07110099
069600                 LEFT OUTER JOIN                                  07120099
069700                 XLT_VND_STYL V ON S.STYL_ID = V.STYL_ID          07130099
069800          WHERE P.PO_NBR         = :PURITM-PO-NBR                 07140099
069900            AND T.PO_NBR       = P.PO_NBR                         07150099
070000            AND P.VER_STATUS_CDE = 'A'                            07160099
070100            AND T.VER_STATUS_CDE = 'A'                            07170099
070200          ORDER BY                                                07180099
070300                APP_PO_LNE_NBR                                    07190099
070400     END-EXEC.                                                    07200099
070500                                                                  07210099
070600/                                                                 07220099
070700 LINKAGE SECTION.                                                 07230099
070800                                                                  07240099
070900 01  DFHCOMMAREA.                                                 07250099
071000     05  FILLER                         OCCURS  1 TO 4072 TIMES   07260099
071100                                        DEPENDING ON EIBCALEN.    07270099
071200         10  FILLER                     PIC X.                    07280099
071300                                                                  07290099
071400/                                                                 07300099
071500 PROCEDURE DIVISION.                                              07310099
071600*---------------------------------------------------------------* 07320099
071700*   THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. * 07330099
071800*   FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  * 07340099
071900*   PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. * 07350099
072000*---------------------------------------------------------------* 07360099
072100 0000-MAIN-MODULE.                                                07370099
072200                                                                  07380099
072300     INITIALIZE DP030-CICS-API-FIELDS.                            07390099
072400                                                                  07400099
072500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       07410099
072600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          07420099
072700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         07430099
072800                                                                  07440099
072900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       07450099
073000                                                                  07460099
073100     MOVE LENGTH OF PO034AI        TO DP030-MAP-LENGTH (1).       07470099
073200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     07480099
073300                                                                  07490099
073400     PERFORM 0001-CALL-CICS-ARCH-API.                             07500099
073500     PERFORM 1000-CONTROL-PROCESSING                              07510099
073600                                                                  07520099
073700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     07530099
073800     PERFORM 0001-CALL-CICS-ARCH-API.                             07540099
073900                                                                  07550099
074000*---------------------------------------------------------------* 07560099
074100*   THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   * 07570099
074200*   AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         * 07580099
074300*---------------------------------------------------------------* 07590099
074400 0001-CALL-CICS-ARCH-API.                                         07600099
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      07610099
074600                                    DFHCOMMAREA                   07620099
074700                                    DP030-CICS-API-FIELDS         07630099
074800                                    DP020-STANDARD-COMMAREA       07640099
074900                                    PO034AI.                      07650099
075000                                                                  07660099
075100     IF  DP030-RC-CALL-SUCCESSFUL                                 07670099
075200         CONTINUE                                                 07680099
075300     ELSE                                                         07690099
075400         SET DP013-NO-ROLLBACK                                    07700099
075500             DP013-XCTL-DISPLAY-RESTART                           07710099
075600             DP013-CICS-ABEND      TO TRUE                        07720099
075700         MOVE '0001-CALL-CICS-ARCH-API'                           07730099
075800                                   TO DP013-PARAGRAPH             07740099
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O07750099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      07760099
076100         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      07770099
076200         PERFORM DP013-0000-PROCESS-ABEND                         07780099
076300     END-IF.                                                      07790099
076400                                                                  07800099
076500*----------------------------------------------------------------*07810099
076600* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *07820099
076700* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *07830099
076800*                                                                *07840099
076900* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *07850099
077000*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *07860099
077100*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *07870099
077200*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *07880099
077300*----------------------------------------------------------------*07890099
077400                                                                  07900099
077500 1000-CONTROL-PROCESSING.                                         07910099
077600                                                                  07920099
077700     EVALUATE TRUE                                                07930099
077800         WHEN DP020-NEXT-ACT-INITIAL                              07940099
077900             INITIALIZE ASC-SPECIFIC-COMMAREA                     07950099
078000             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            07960099
078100                                      ASC-SEL-TERM-ID             07970099
078200             MOVE DP020-SRC-TASK-NUMBER                           07980099
078300                                   TO ASC-LIST-TASK-NUMBER        07990099
078400                                      ASC-SEL-TASK-NUMBER         08000099
078500             MOVE PC-LIST-QUEUE-SEQ                               08010099
078600                                   TO ASC-LIST-SEQ                08020099
078700             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 08030099
078800             PERFORM 1100-PROCESS-INTER-APPL-COMM                 08040099
078900             IF  PS-COMMAREA-NOT-VALID                            08050099
079000                 SET DP020-NEXT-ACT-APPL-ERROR                    08060099
079100                                   TO TRUE                        08070099
079200             ELSE                                                 08080099
079300                 PERFORM 4000-BUILD-INITIAL-PANEL                 08090099
079400             END-IF                                               08100099
079500                                                                  08110099
079600         WHEN DP020-NEXT-ACT-READ-MAP                             08120099
079700             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08130099
079800                                   TO PV-TOP-ITEM                 08140099
079900             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   08150099
080000             PERFORM 2000-PROCESS-PANEL                           08160099
080100                                                                  08170099
080200         WHEN DP020-NEXT-ACT-RETURN                               08180099
080300             MOVE ASC-ITEM-AT-TOP-OF-PANEL                        08190099
080400                                   TO PV-TOP-ITEM                 08200099
080500             MOVE ASC-KEY-PO-NBR   TO DK-PO-NBR                   08210099
080600             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    08220099
080700             PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 08230099
080800             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08240099
080900             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08250099
081000                                                                  08260099
081100         WHEN OTHER                                               08270099
081200             SET DP013-LOGIC-ABEND TO TRUE                        08280099
081300             SET DP013-NO-ROLLBACK TO TRUE                        08290099
081400             MOVE '1000-CONTROL-PROCESSING'                       08300099
081500                                   TO DP013-PARAGRAPH             08310099
081600             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    08320099
081700                                   TO DP013-MESSAGE-TEXT(1)       08330099
081800             PERFORM DP013-0000-PROCESS-ABEND                     08340099
081900     END-EVALUATE.                                                08350099
082000                                                                  08360099
082100/                                                                 08370099
082200*----------------------------------------------------------------*08380099
082300* MOVE DATA PASSED THROUGH THE INTER-APPL COMMAREA               *08390099
082400*----------------------------------------------------------------*08400099
082500                                                                  08410099
082600 1100-PROCESS-INTER-APPL-COMM.                                    08420099
082700                                                                  08430099
082800     SET PS-COMMAREA-VALID         TO TRUE.                       08440099
082900     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     08450099
083000                                                                  08460099
083100     IF  PO017-PO-NBR = ZEROES                                    08470099
083200         MOVE PC-TSYMSG-00461    TO DP020-MSG-NUMBER              08480099
083300         SET PS-ERROR                                             08490099
083400             PS-COMMAREA-NOT-VALID                                08500099
083500             DP020-NEXT-ACT-APPL-ERROR                            08510099
083600             DP020-MSG-FATAL     TO TRUE                          08520099
083700     ELSE                                                         08530099
083800         MOVE PO017-PO-NBR       TO ASC-KEY-PO-NBR                08540099
083900                                    DK-PO-NBR                     08550099
084000         PERFORM 1110-GET-PO-INFO                                 08560099
084100         IF  PURCHS-STATUS-CDE = 'WK' OR 'PA' OR 'RJ' OR 'RS'     08570099
084200                                      OR 'FE'                     08580099
084300             SET ASC-ITEM-CURSOR TO TRUE                          08590099
084400         ELSE                                                     08600099
084500             SET ASC-APP-ITEM-CURSOR                              08610099
084600                                 TO TRUE                          08620099
084700         END-IF                                                   08630099
084800         PERFORM 1120-GET-PRIMARY-ENT-NAME-DESC                   08640099
084900     END-IF.                                                      08650099
085000                                                                  08660099
085100/                                                                 08670099
085200*----------------------------------------------------------------*08680099
085300*    READ PURCHASE ORDER HEADER                                  *08690099
085400*----------------------------------------------------------------*08700099
085500 1110-GET-PO-INFO.                                                08710099
085600                                                                  08720099
085700     PERFORM                                                      08730099
085800         WITH TEST AFTER                                          08740099
085900         VARYING PV-RETRY-COUNTER                                 08750099
086000         FROM 1 BY 1                                              08760099
086100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               08770099
086200             OR (SQLCODE = +0))                                   08780099
086300                                                                  08790099
086400         EXEC SQL                                                 08800099
086500              SELECT PO_TYP_CDE                                   08810099
086600                    ,DEPT_NBR                                     08820099
086700                    ,ENT_ID                                       08830099
086800                    ,TOT_UNT_QTY                                  08840099
086900                    ,TOT_SKUS_QTY                                 08850099
087000                    ,STATUS_CDE                                   08860099
087100                    ,PKGNG_CDE                                    08870099
087200                    ,CRE_BY_UID                                   08880099
087300                INTO :PURCHS-PO-TYP-CDE                           08890099
087400                    ,:PURCHS-DEPT-NBR                             08900099
087500                    ,:PURCHS-ENT-ID                               08910099
087600                    ,:PURCHS-TOT-UNT-QTY                          08920099
087700                    ,:PURCHS-TOT-SKUS-QTY                         08930099
087800                    ,:PURCHS-STATUS-CDE                           08940099
087900                    ,:PURCHS-PKGNG-CDE                            08950099
088000                    ,:PURCHS-CRE-BY-UID                           08960099
088100                FROM TPURCHS                                      08970099
088200               WHERE PO_NBR         = :DK-PO-NBR                  08980099
088300                 AND VER_STATUS_CDE = 'A'                         08990099
088400         END-EXEC                                                 09000099
088500                                                                  09010099
088600         EVALUATE TRUE                                            09020099
088700             WHEN SQLCODE = +0                                    09030099
088800                  MOVE PURCHS-PO-TYP-CDE                          09040099
088900                                 TO ASC-PO-TYP-CDE                09050099
089000                  MOVE PURCHS-CRE-BY-UID                          09060099
089100                                 TO ASC-CRE-BY-UID                09070099
089200                  MOVE PURCHS-DEPT-NBR                            09080099
089300                                 TO ASC-KEY-DEPT-NBR              09090099
089400                                    DK-DEPT-NBR                   09100099
089500                  MOVE PURCHS-ENT-ID                              09110099
089600                                 TO ASC-KEY-ENT-ID                09120099
089700                                    DK-ENT-ID                     09130099
089800                  MOVE PURCHS-TOT-UNT-QTY                         09140099
089900                                 TO ASC-TOT-UNT-QTY               09150099
090000                  MOVE PURCHS-TOT-SKUS-QTY                        09160099
090100                                 TO ASC-TOT-SKUS-QTY              09170099
090200*  ADDED 05-12-99 FOR PRODUCT PREPACKAGING PROJECT                09180099
090300                  MOVE PURCHS-PKGNG-CDE                           09190099
090400                                 TO ASC-PO-PKGNG-CDE              09200099
090500                                                                  09210099
090600             WHEN SQLCODE = -904                                  09220099
090700             WHEN SQLCODE = -913                                  09230099
090800                  CONTINUE                                        09240099
090900                                                                  09250099
091000             WHEN SQLWARN0 NOT = SPACES                           09260099
091100             WHEN SQLCODE < +0                                    09270099
091200             WHEN SQLCODE > +0                                    09280099
091300                  MOVE '1110-GET-PO-INFO'                         09290099
091400                                  TO DP013-PARAGRAPH              09300099
091500                  MOVE 'UNSUCCESSFUL SELECT ON PO HEADER'         09310099
091600                                  TO DP013-MESSAGE-TEXT (1)       09320099
091700                  MOVE SQLCA      TO DP013-SQLCA                  09330099
091800                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (1)     09340099
091900                  SET DP013-DB2-ABEND                             09350099
092000                      DP013-XCTL-DISPLAY-RESTART                  09360099
092100                                  TO TRUE                         09370099
092200                  PERFORM DP013-0000-PROCESS-ABEND                09380099
092300         END-EVALUATE                                             09390099
092400     END-PERFORM.                                                 09400099
092500                                                                  09410099
092600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        09420099
092700         MOVE '1110-GET-PO-INFO'  TO DP013-PARAGRAPH              09430099
092800         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO NBR'         09440099
092900                                  TO DP013-MESSAGE-TEXT (1)       09450099
093000         MOVE SQLCA               TO DP013-SQLCA                  09460099
093100         MOVE 'TPURCHS '          TO DP013-DB2-TABLE-NAME (1)     09470099
093200         SET DP013-DB2-ABEND                                      09480099
093300             DP013-XCTL-DISPLAY-RESTART                           09490099
093400                                  TO TRUE                         09500099
093500         PERFORM DP013-0000-PROCESS-ABEND                         09510099
093600     END-IF.                                                      09520099
093700                                                                  09530099
093800/                                                                 09540099
093900*----------------------------------------------------------------*09550099
094000*  RETRIEVE THE PRIMARY VENDOR NAME                               09560099
094100*----------------------------------------------------------------*09570099
094200                                                                  09580099
094300 1120-GET-PRIMARY-ENT-NAME-DESC.                                  09590099
094400                                                                  09600099
094500     PERFORM                                                      09610099
094600         WITH TEST AFTER                                          09620099
094700         VARYING PV-RETRY-COUNTER                                 09630099
094800         FROM 1 BY 1                                              09640099
094900         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09650099
095000             OR (SQLCODE = +0))                                   09660099
095100                                                                  09670099
095200         EXEC SQL                                                 09680099
095300              SELECT ENT_NAME_DESC                                09690099
095400                INTO :ENTNME-ENT-NAME-DESC                        09700099
095500                FROM TENTNME                                      09710099
095600               WHERE ENT_ID   = :DK-ENT-ID                        09720099
095700                 AND TYPE_CDE = '01'                              09730099
095800         END-EXEC                                                 09740099
095900                                                                  09750099
096000         EVALUATE TRUE                                            09760099
096100             WHEN SQLCODE = +0                                    09770099
096200                  MOVE ENTNME-ENT-NAME-DESC                       09780099
096300                                  TO ASC-KEY-ENT-NAME-DESC        09790099
096400             WHEN SQLCODE = -904                                  09800099
096500             WHEN SQLCODE = -913                                  09810099
096600                  CONTINUE                                        09820099
096700                                                                  09830099
096800             WHEN SQLWARN0 NOT = SPACES                           09840099
096900             WHEN SQLCODE < +0                                    09850099
097000             WHEN SQLCODE > +0                                    09860099
097100                  MOVE '1120-GET-PRIMARY-ENT-NAME-DESC'           09870099
097200                                  TO DP013-PARAGRAPH              09880099
097300                  MOVE 'UNSUCCESSFUL SELECT ENTERPRISE NAME'      09890099
097400                                  TO DP013-MESSAGE-TEXT (1)       09900099
097500                  MOVE SQLCA      TO DP013-SQLCA                  09910099
097600                  MOVE 'TENTNME ' TO DP013-DB2-TABLE-NAME (1)     09920099
097700                  SET DP013-DB2-ABEND                             09930099
097800                      DP013-XCTL-DISPLAY-RESTART                  09940099
097900                                  TO TRUE                         09950099
098000                  PERFORM DP013-0000-PROCESS-ABEND                09960099
098100         END-EVALUATE                                             09970099
098200     END-PERFORM.                                                 09980099
098300                                                                  09990099
098400     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        10000099
098500         MOVE '1120-GET-PRIMARY-NAME'                             10010099
098600                                  TO DP013-PARAGRAPH              10020099
098700         MOVE 'MAX RETRIES EXCEEDED ON SELECT ENTERPRISE NAME'    10030099
098800                                  TO DP013-MESSAGE-TEXT (1)       10040099
098900         MOVE SQLCA               TO DP013-SQLCA                  10050099
099000         MOVE 'TENTNME '          TO DP013-DB2-TABLE-NAME (1)     10060099
099100         SET DP013-DB2-ABEND                                      10070099
099200             DP013-XCTL-DISPLAY-RESTART                           10080099
099300                                  TO TRUE                         10090099
099400         PERFORM DP013-0000-PROCESS-ABEND                         10100099
099500     END-IF.                                                      10110099
099600                                                                  10120099
099700/                                                                 10130099
099800*----------------------------------------------------------------*10140099
099900* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10150099
100000* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10160099
100100* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10170099
100200* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10180099
100300* FUNCTION KEYS CAN GET THIS FAR.                                *10190099
100400*----------------------------------------------------------------*10200099
100500                                                                  10210099
100600 2000-PROCESS-PANEL.                                              10220099
100700     EVALUATE TRUE                                                10230099
100800         WHEN DP020-SRC-AID = DP016-CLEAR                         10240099
100900             MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10250099
101000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10260099
101100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10270099
101200                                                                  10280099
101300         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10290099
101400             PERFORM 2050-DELETE-LIST-QUEUE                       10300099
101500             PERFORM 4000-BUILD-INITIAL-PANEL                     10310099
101600                                                                  10320099
101700         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   10330099
101800             PERFORM 2140-DESELECT-ALL-ITEMS                      10340099
101900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10350099
102000                                                                  10360099
102100         WHEN DP020-FK-SELECT-ALL (DP020-SRC-AID)                 10370099
102200              PERFORM 2150-SELECT-ALL-ITEMS                       10380099
102300              PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                10390099
102400                                                                  10400099
102500         WHEN OTHER                                               10410099
102600             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 10420099
102700             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10430099
102800             IF  PS-NO-ERROR                                      10440099
102900                 SET DP030-CONTINUE-GO TO TRUE                    10450099
103000                 PERFORM 2100-CHECK-FUNCTION-KEY                  10460099
103100             ELSE                                                 10470099
103200                 SET DP030-OVERRIDE-GO TO TRUE                    10480099
103300             END-IF                                               10490099
103400     END-EVALUATE.                                                10500099
103500                                                                  10510099
103600/                                                                 10520099
103700*----------------------------------------------------------------*10530099
103800*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10540099
103900*----------------------------------------------------------------*10550099
104000 2050-DELETE-LIST-QUEUE.                                          10560099
104100                                                                  10570099
104200     EXEC CICS                                                    10580099
104300         DELETEQ TS                                               10590099
104400           QUEUE (ASC-LIST-QUEUE-NAME)                            10600099
104500            RESP (PV-CICS-RESP)                                   10610099
104600     END-EXEC.                                                    10620099
104700                                                                  10630099
104800     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       10640099
104900        (PV-CICS-RESP = DFHRESP(QIDERR))                          10650099
105000         CONTINUE                                                 10660099
105100     ELSE                                                         10670099
105200         SET DP013-CICS-ABEND      TO TRUE                        10680099
105300         SET DP013-NO-ROLLBACK     TO TRUE                        10690099
105400                                                                  10700099
105500         MOVE '2050-DELETE-LIST-QUEUE'                            10710099
105600                                   TO DP013-PARAGRAPH             10720099
105700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    10730099
105800                                   TO DP013-MESSAGE-TEXT (1)      10740099
105900         PERFORM DP013-0000-PROCESS-ABEND                         10750099
106000     END-IF.                                                      10760099
106100                                                                  10770099
106200     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  10780099
106300                                                                  10790099
106400/                                                                 10800099
106500*----------------------------------------------------------------*10810099
106600* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*10820099
106700* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *10830099
106800* CICS ARCHITECTURE API.                                         *10840099
106900*----------------------------------------------------------------*10850099
107000 2100-CHECK-FUNCTION-KEY.                                         10860099
107100                                                                  10870099
107200     EVALUATE TRUE                                                10880099
107300         WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 10890099
107400              IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO             10900099
107500                  INITIALIZE PO013-INTER-APPL-COMMAREA            10910099
107600                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               10920099
107700                                TO PO013-NUMBER-OF-SELECTED-ITEMS 10930099
107800                  MOVE ASC-KEY-PO-NBR TO PO013-PO-NBR             10940099
107900                  MOVE ASC-KEY-DEPT-NBR TO PO013-DEPT-NBR         10950099
108000                  MOVE ASC-KEY-ENT-ID TO PO013-ENT-ID             10960099
108100                  PERFORM 5000-PREPARE-SEL-QUEUE                  10970099
108200              ELSE                                                10980099
108300                  SET DP030-OVERRIDE-GO                           10990099
108400                      DP020-MSG-WARNING                           11000099
108500                                TO TRUE                           11010099
108600                  MOVE PC-TSYMSG-00057                            11020099
108700                                TO DP020-MSG-NUMBER               11030099
108800              END-IF                                              11040099
108900* GOING TO SIZE RATIO SCREEN                                      11050099
109000*        WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              11060099
109100*                                                                 11070099
109200*             IF  ASC-PO-TYP-CDE = 'IN' OR                        11080099
109300*                 (ASC-PO-TYP-CDE = 'EC' AND                      11090099
109400*                         ASC-CRE-BY-UID = 'INFOREM') OR          11100099
109500*                 ASC-PO-TYP-CDE = 'VN'                           11110099
109600*                 SET DP030-OVERRIDE-GO                           11120099
109700*                     DP020-MSG-FATAL TO TRUE                     11130099
109800*                 MOVE PC-TSYMSG-01773 TO DP020-MSG-NUMBER        11140099
109900*             ELSE                                                11150099
110000*                 IF  ASC-NUMBER-OF-SELECTED-ITEMS = 1            11160099
110100*                     INITIALIZE PO013-INTER-APPL-COMMAREA        11170099
110200*                     MOVE ASC-KEY-PO-NBR  TO PO013-PO-NBR        11180099
110300*                     MOVE ASC-KEY-DEPT-NBR TO PO013-DEPT-NBR     11190099
110400*                     MOVE ASC-KEY-ENT-NAME-DESC                  11200099
110500*                                           TO PO013-VENDOR-NAME  11210099
110600*                     PERFORM 5000-PREPARE-SEL-QUEUE              11220099
110700*                 ELSE                                            11230099
110800*                     SET DP030-OVERRIDE-GO                       11240099
110900*                         DP020-MSG-FATAL                         11250099
111000*                                   TO TRUE                       11260099
111100*                     MOVE PC-TSYMSG-00057                        11270099
111200*                                   TO DP020-MSG-NUMBER           11280099
111300*                 END-IF                                          11290099
111400*             END-IF                                              11300099
111500                                                                  11310099
111600* GOING TO SIZE DETAIL SCREEN                                     11320099
111700*        WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              11330099
111800*            INITIALIZE PO013-INTER-APPL-COMMAREA                 11340099
111900*            MOVE ASC-KEY-PO-NBR  TO PO013-PO-NBR                 11350099
112000*            MOVE ASC-KEY-DEPT-NBR TO PO013-DEPT-NBR              11360099
112100*            MOVE ASC-KEY-ENT-NAME-DESC TO PO013-VENDOR-NAME      11370099
112200                                                                  11380099
112300* GOING TO LINE QTY SUMMARY SCREEN                                11390099
112400         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              11400099
112500                  INITIALIZE PO013-INTER-APPL-COMMAREA            11410099
112600                  MOVE ASC-NUMBER-OF-SELECTED-ITEMS               11420099
112700                                TO PO013-NUMBER-OF-SELECTED-ITEMS 11430099
112800                  MOVE ASC-KEY-PO-NBR TO PO013-PO-NBR             11440099
112900                  MOVE ASC-KEY-DEPT-NBR TO PO013-DEPT-NBR         11450099
113000                  MOVE ASC-KEY-ENT-ID TO PO013-ENT-ID             11460099
113100                  MOVE ASC-KEY-ENT-NAME-DESC TO PO013-VENDOR-NAME 11470099
113200                  PERFORM 5000-PREPARE-SEL-QUEUE                  11480099
113300* GOING TO INNER PACK SCREEN                                      11490099
113400         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              11500099
113500             INITIALIZE PO013-INTER-APPL-COMMAREA                 11510099
113600             MOVE ASC-NUMBER-OF-SELECTED-ITEMS                    11520099
113700                                TO PO013-NUMBER-OF-SELECTED-ITEMS 11530099
113800             MOVE ASC-KEY-PO-NBR   TO PO013-PO-NBR                11540099
113900             MOVE ASC-KEY-DEPT-NBR TO PO013-DEPT-NBR              11550099
114000             MOVE ASC-PO-PKGNG-CDE TO PO013-PO-PKGNG-CDE          11560099
114100             PERFORM 6010-DELETE-SEL-QUEUE                        11570099
115200                                                                  11580099
115300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  11590099
115400             MOVE +1               TO PV-TOP-ITEM                 11600099
115500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11610099
115600             PERFORM 3200-RESET-ATTRIBUTES                        11620099
115700                                                                  11630099
115800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   11640099
115900             PERFORM 2110-BROWSE-BACKWARD                         11650099
116000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11660099
116100             PERFORM 3200-RESET-ATTRIBUTES                        11670099
116200                                                                  11680099
116300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   11690099
116400             PERFORM 2120-BROWSE-FORWARD                          11700099
116500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11710099
116600             PERFORM 3200-RESET-ATTRIBUTES                        11720099
116700                                                                  11730099
116800         WHEN DP020-SRC-AID = DP016-ENTER                         11740099
116900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   11750099
117000             IF  PS-ERROR                                         11760099
117100                 CONTINUE                                         11770099
117200             ELSE                                                 11780099
117300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11790099
117400             END-IF                                               11800099
117500                                                                  11810099
117600         WHEN OTHER                                               11820099
117700             SET DP013-NO-ROLLBACK                                11830099
117800                 DP013-XCTL-DISPLAY-RESTART                       11840099
117900                 DP013-CICS-ABEND  TO TRUE                        11850099
118000             MOVE '2100-CHECK-FUNCTION-KEY'                       11860099
118100                                   TO DP013-PARAGRAPH             11870099
118200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      11880099
118300                                   TO DP013-MESSAGE-TEXT (1)      11890099
118400             PERFORM DP013-0000-PROCESS-ABEND                     11900099
118500     END-EVALUATE.                                                11910099
118600                                                                  11920099
118700/                                                                 11930099
118800*----------------------------------------------------------------*11940099
118900*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11950099
119000*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11960099
119100*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11970099
119200*    MESSAGE.                                                    *11980099
119300*----------------------------------------------------------------*11990099
119400                                                                  12000099
119500 2110-BROWSE-BACKWARD.                                            12010099
119600                                                                  12020099
119700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    12030099
119800         GIVING PV-TOP-ITEM.                                      12040099
119900                                                                  12050099
120000     IF  ((PV-TOP-ITEM < +1)                                      12060099
120100       OR (PV-TOP-ITEM = +1))                                     12070099
120200         MOVE +1                   TO PV-TOP-ITEM                 12080099
120300*        -- TOP OF LIST --                                        12090099
120400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            12100099
120500         SET DP020-MSG-INFORMATIONAL                              12110099
120600                                   TO TRUE                        12120099
120700     END-IF.                                                      12130099
120800                                                                  12140099
120900/                                                                 12150099
121000*----------------------------------------------------------------*12160099
121100*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *12170099
121200*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *12180099
121300*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *12190099
121400*----------------------------------------------------------------*12200099
121500                                                                  12210099
121600 2120-BROWSE-FORWARD.                                             12220099
121700                                                                  12230099
121800     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              12240099
121900         GIVING PV-TOP-ITEM.                                      12250099
122000                                                                  12260099
122100     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   12270099
122200         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12280099
122300                                   TO PV-TOP-ITEM                 12290099
122400*        -- BOTTOM OF LIST --                                     12300099
122500         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12310099
122600         SET DP020-MSG-INFORMATIONAL                              12320099
122700                                   TO TRUE                        12330099
122800     ELSE                                                         12340099
122900         COMPUTE PV-BOTTOM-ITEM =                                 12350099
123000             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 12360099
123100         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            12370099
123200*            -- BOTTOM OF LIST --                                 12380099
123300             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            12390099
123400             SET DP020-MSG-INFORMATIONAL                          12400099
123500                                   TO TRUE                        12410099
123600         END-IF                                                   12420099
123700     END-IF.                                                      12430099
123800                                                                  12440099
123900/                                                                 12450099
124000*----------------------------------------------------------------*12460099
124100*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12470099
124200*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12480099
124300*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12490099
124400*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *12500099
124500*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12510099
124600*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12520099
124700*----------------------------------------------------------------*12530099
124800                                                                  12540099
124900 2130-CHECK-FOR-JUMP-BROWSE.                                      12550099
125000                                                                  12560099
125100     SET PS-NO-ERROR               TO TRUE.                       12570099
125200     IF (ASC-START-ITEM-REQUEST = SPACE)                          12580099
125300         MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12590099
125400                                   TO PV-TOP-ITEM                 12600099
125500     ELSE                                                         12610099
125600         MOVE ASC-START-ITEM-REQUEST                              12620099
125700                                   TO DP010I-UNEDITED-FIELD       12630099
125800         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       12640099
125900         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     12650099
126000         SET DP010I-NEGATIVE-NOT-ALLOWED                          12660099
126100                                   TO TRUE                        12670099
263126         CALL DP010I-NUMERIC-EDIT-ROUTINE                         12681099
263126              USING DP010I-NUMERIC-EDIT-AREA                      12682099
126300                                                                  12690099
126400         IF  NOT DP010I-ERROR-DETECTED                            12700099
126500             MOVE DP010I-NUMERIC-FIELD                            12710099
126600                                   TO ASC-START-ITEM-REQUEST-N    12720099
126700             IF  ASC-START-ITEM-REQUEST-N > ZERO                  12730099
126800                 IF  ASC-START-ITEM-REQUEST-N >                   12740099
126900                                          ASC-NUMBER-OF-ITEMS-READ12750099
127000                     MOVE SPACE TO ASC-START-ITEM-REQUEST         12760099
127100                     COMPUTE PV-TOP-ITEM =                        12770099
127200                             ASC-NUMBER-OF-ITEMS-READ             12780099
127300                             - PC-ITEMS-PER-PANEL + 1             12790099
127400                     IF  PV-TOP-ITEM < +1                         12800099
127500                         MOVE +1   TO PV-TOP-ITEM                 12810099
127600                         MOVE PC-TSYMSG-00070                     12820099
127700                                   TO DP020-MSG-NUMBER            12830099
127800                         SET DP020-MSG-INFORMATIONAL              12840099
127900                                   TO TRUE                        12850099
128000                     END-IF                                       12860099
128100                 ELSE                                             12870099
128200                     MOVE ASC-START-ITEM-REQUEST-N                12880099
128300                                   TO PV-TOP-ITEM                 12890099
128400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      12900099
128500                     COMPUTE PV-BOTTOM-ITEM =                     12910099
128600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12920099
128700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ12930099
128800*                        -- BOTTOM OF LIST --                     12940099
128900                         MOVE PC-TSYMSG-00070                     12950099
129000                                   TO DP020-MSG-NUMBER            12960099
129100                         SET DP020-MSG-INFORMATIONAL              12970099
129200                                   TO TRUE                        12980099
129300                     END-IF                                       12990099
129400                 END-IF                                           13000099
129500             ELSE                                                 13010099
129600*                --- VALUE OUT OF RANGE ----                      13020099
129700                 MOVE PC-TSYMSG-00101                             13030099
129800                                   TO DP020-MSG-NUMBER            13040099
129900                 MOVE -1           TO ASTRTITL                    13050099
130000                 SET DP030-SET-CURSOR-APPL-1                      13060099
130100                                   TO TRUE                        13070099
130200                 MOVE DP015-REVERSE                               13080099
130300                                   TO ASTRTITH                    13090099
130400                 MOVE DP015-RED    TO ASTRTITC                    13100099
130500                 MOVE DP015-UNP-NUM-BRT-MDT                       13110099
130600                                   TO ASTRTITA                    13120099
130700                 SET DP020-MSG-FATAL                              13130099
130800                                   TO TRUE                        13140099
130900                 SET PS-ERROR      TO TRUE                        13150099
131000             END-IF                                               13160099
131100                                                                  13170099
131200         ELSE                                                     13180099
131300             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            13190099
131400             MOVE -1               TO ASTRTITL                    13200099
131500             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13210099
131600             MOVE DP015-REVERSE    TO ASTRTITH                    13220099
131700             MOVE DP015-RED        TO ASTRTITC                    13230099
131800             MOVE DP015-UNP-NUM-BRT-MDT                           13240099
131900                                   TO ASTRTITA                    13250099
132000             SET DP020-MSG-FATAL   TO TRUE                        13260099
132100             SET PS-ERROR          TO TRUE                        13270099
132200         END-IF                                                   13280099
132300     END-IF.                                                      13290099
132400                                                                  13300099
132500/                                                                 13310099
132600*----------------------------------------------------------------*13320099
132700*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *13330099
132800*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *13340099
132900*----------------------------------------------------------------*13350099
133000 2140-DESELECT-ALL-ITEMS.                                         13360099
133100                                                                  13370099
133200     MOVE +1                       TO ASC-BLK-SUB.                13380099
133300                                                                  13390099
133400     PERFORM 2141-CLEAR-SELECTED-INDS                             13400099
133500         VARYING ASC-ITEM-SUB                                     13410099
133600         FROM 1 BY 1                                              13420099
133700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13430099
133800                                                                  13440099
133900     ADD +1                        TO ASC-BLK-SUB.                13450099
134000                                                                  13460099
134100     PERFORM 2141-CLEAR-SELECTED-INDS                             13470099
134200         VARYING ASC-ITEM-SUB                                     13480099
134300         FROM 1 BY 1                                              13490099
134400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13500099
134500                                                                  13510099
134600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               13520099
134700                                   TO PV-LIST-ITEM-NUMBER.        13530099
134800                                                                  13540099
134900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13550099
135000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13560099
135100                                                                  13570099
135200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13580099
135300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      13590099
135400         MOVE +1                   TO ASC-BLK-SUB                 13600099
135500                                                                  13610099
135600         PERFORM 5100-WRITE-TEMP-STORAGE                          13620099
135700                                                                  13630099
135800         MOVE +1                   TO PV-BLOCK-NUMBER             13640099
135900                                                                  13650099
136000         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13660099
136100             PV-FIRST-BLOCK-IN-ARRAY - 1                          13670099
136200                                                                  13680099
136300         PERFORM                                                  13690099
136400             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13700099
136500                                                                  13710099
136600             PERFORM 4410-READ-TEMP-STORAGE                       13720099
136700                                                                  13730099
136800             PERFORM 2141-CLEAR-SELECTED-INDS                     13740099
136900                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 13750099
137000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13760099
137100                                                                  13770099
137200             PERFORM 5100-WRITE-TEMP-STORAGE                      13780099
137300                                                                  13790099
137400             ADD +1                TO PV-BLOCK-NUMBER             13800099
137500                                                                  13810099
137600         END-PERFORM                                              13820099
137700                                                                  13830099
137800         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13840099
137900             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13850099
138000                                                                  13860099
138100         PERFORM                                                  13870099
138200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13880099
138300                   ASC-HIGHEST-BLOCK-WRITTEN                      13890099
138400                                                                  13900099
138500             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13910099
138600                                   TO PV-BLOCK-NUMBER             13920099
138700                                                                  13930099
138800             PERFORM 4410-READ-TEMP-STORAGE                       13940099
138900                                                                  13950099
139000             PERFORM 2141-CLEAR-SELECTED-INDS                     13960099
139100                 VARYING ASC-ITEM-SUB                             13970099
139200                 FROM 1 BY 1                                      13980099
139300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13990099
139400                                                                  14000099
139500             PERFORM 5100-WRITE-TEMP-STORAGE                      14010099
139600                                                                  14020099
139700             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      14030099
139800                                                                  14040099
139900         END-PERFORM                                              14050099
140000                                                                  14060099
140100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             14070099
140200                                   TO PV-BLOCK-NUMBER             14080099
140300                                                                  14090099
140400         PERFORM 4410-READ-TEMP-STORAGE                           14100099
140500     END-IF.                                                      14110099
140600                                                                  14120099
140700                                                                  14130099
140800     MOVE +0                       TO ASC-NUMBER-OF-SELECTED-ITEMS14140099
140900     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE.14150099
141000     MOVE +0                       TO ASC-END-OF-SELECTED-RANGE.  14160099
141100                                                                  14170099
141200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        14180099
141300                                                                  14190099
141400/                                                                 14200099
141500*----------------------------------------------------------------*14210099
141600*    MARK EACH ITEM AS BEING NOT SELECTED.                       *14220099
141700*----------------------------------------------------------------*14230099
141800                                                                  14240099
141900 2141-CLEAR-SELECTED-INDS.                                        14250099
142000                                                                  14260099
142100     IF  ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB ASC-ITEM-SUB)          14270099
142200             NOT EQUAL ZERO                                       14280099
142300         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14290099
142400             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          14300099
142500                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    14310099
142600                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14320099
142700                                   TO TRUE                        14330099
142800         END-IF                                                   14340099
142900     END-IF.                                                      14350099
143000                                                                  14360099
143100/                                                                 14370099
143200*----------------------------------------------------------------*14380099
143300*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *14390099
143400*  FOR ALL ITEMS.                                                *14400099
143500*----------------------------------------------------------------*14410099
143600                                                                  14420099
143700 2150-SELECT-ALL-ITEMS.                                           14430099
143800                                                                  14440099
143900     MOVE +1                       TO ASC-BLK-SUB.                14450099
144000                                                                  14460099
144100     PERFORM 2151-SET-SELECTED-INDS                               14470099
144200         VARYING ASC-ITEM-SUB                                     14480099
144300         FROM 1 BY 1                                              14490099
144400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14500099
144500                                                                  14510099
144600     ADD +1                        TO ASC-BLK-SUB.                14520099
144700                                                                  14530099
144800     PERFORM 2151-SET-SELECTED-INDS                               14540099
144900         VARYING ASC-ITEM-SUB                                     14550099
145000         FROM 1 BY 1                                              14560099
145100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 14570099
145200                                                                  14580099
145300     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               14590099
145400                                   TO PV-LIST-ITEM-NUMBER.        14600099
145500                                                                  14610099
145600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            14620099
145700         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    14630099
145800                                                                  14640099
145900     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     14650099
146000        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    14660099
146100         MOVE +1                   TO ASC-BLK-SUB                 14670099
146200                                                                  14680099
146300         PERFORM 5100-WRITE-TEMP-STORAGE                          14690099
146400                                                                  14700099
146500         MOVE +1                   TO PV-BLOCK-NUMBER             14710099
146600                                                                  14720099
146700         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         14730099
146800             PV-FIRST-BLOCK-IN-ARRAY - 1                          14740099
146900                                                                  14750099
147000         PERFORM                                                  14760099
147100             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       14770099
147200                                                                  14780099
147300             PERFORM 4410-READ-TEMP-STORAGE                       14790099
147400                                                                  14800099
147500             PERFORM 2151-SET-SELECTED-INDS                       14810099
147600                 VARYING ASC-ITEM-SUB                             14820099
147700                 FROM 1 BY 1                                      14830099
147800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          14840099
147900                                                                  14850099
148000             PERFORM 5100-WRITE-TEMP-STORAGE                      14860099
148100                                                                  14870099
148200             ADD +1                TO PV-BLOCK-NUMBER             14880099
148300         END-PERFORM                                              14890099
148400                                                                  14900099
148500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         14910099
148600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     14920099
148700                                                                  14930099
148800         PERFORM                                                  14940099
148900             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       14950099
149000                   ASC-HIGHEST-BLOCK-WRITTEN                      14960099
149100                                                                  14970099
149200             MOVE PV-NEXT-BLOCK-IN-ARRAY                          14980099
149300                                   TO PV-BLOCK-NUMBER             14990099
149400                                                                  15000099
149500             PERFORM 4410-READ-TEMP-STORAGE                       15010099
149600                                                                  15020099
149700             PERFORM 2151-SET-SELECTED-INDS                       15030099
149800                 VARYING ASC-ITEM-SUB                             15040099
149900                 FROM 1 BY 1                                      15050099
150000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          15060099
150100                                                                  15070099
150200             PERFORM 5100-WRITE-TEMP-STORAGE                      15080099
150300                                                                  15090099
150400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      15100099
150500         END-PERFORM                                              15110099
150600                                                                  15120099
150700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             15130099
150800                                   TO PV-BLOCK-NUMBER             15140099
150900                                                                  15150099
151000         PERFORM 4410-READ-TEMP-STORAGE                           15160099
151100     END-IF.                                                      15170099
151200                                                                  15180099
151300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             15190099
151400          ASC-NUMBER-OF-SELECTED-ITEMS.                           15200099
151500                                                                  15210099
151600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        15220099
151700                                                                  15230099
151800/                                                                 15240099
151900*----------------------------------------------------------------*15250099
152000*    MARK EACH ITEM AS BEING SELECTED.                           *15260099
152100*----------------------------------------------------------------*15270099
152200                                                                  15280099
152300 2151-SET-SELECTED-INDS.                                          15290099
152400                                                                  15300099
152500     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           15310099
152600             NOT EQUAL ZERO                                       15320099
152700         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             15330099
152800             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             15340099
152900                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        15350099
153000                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  15360099
153100                                   TO TRUE                        15370099
153200         END-IF                                                   15380099
153300     END-IF.                                                      15390099
153400                                                                  15400099
153500/                                                                 15410099
153600*----------------------------------------------------------------*15420099
153700*  MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE     *15430099
153800*  SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM.  *15440099
153900*----------------------------------------------------------------*15450099
154000 2200-MOVE-SCREEN-TO-COMMAREA.                                    15460099
154100                                                                  15470099
154200     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             15480099
154300     MOVE +1                       TO PV-SUB.                     15490099
154400                                                                  15500099
154500     PERFORM 3100-SET-SUBSCRIPTS.                                 15510099
154600                                                                  15520099
154700     IF  ASTRTITL > ZERO                                          15530099
154800         MOVE ASTRTITI             TO ASC-START-ITEM-REQUEST      15540099
154900     ELSE                                                         15550099
155000         IF  ASTRTITF = DP015-ERASE-EOF                           15560099
155100             INITIALIZE ASC-START-ITEM-REQUEST                    15570099
155200         END-IF                                                   15580099
155300     END-IF.                                                      15590099
155400                                                                  15600099
155500     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          15610099
155600         VARYING PV-SUB                                           15620099
155700         FROM 1 BY 1                                              15630099
155800         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      15640099
155900                                                                  15650099
156000/                                                                 15660099
156100*----------------------------------------------------------------*15670099
156200*  MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA *15680099
156300*----------------------------------------------------------------*15690099
156400 2210-MOVE-LINES-TO-COMMAREA.                                     15700099
156500                                                                  15710099
156600     IF  MR-SELECTL (PV-SUB) > ZERO                               15720099
156700         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB)                     15730099
156800                                   TO TRUE                        15740099
156900         MOVE MR-SELECT (PV-SUB)   TO ASC-TEMP-SELECTED-SW        15750099
157000                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15760099
157100     ELSE                                                         15770099
157200         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                15780099
157300             SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         15790099
157400             MOVE SPACE            TO ASC-TEMP-SELECTED-SW        15800099
157500                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      15810099
157600         END-IF                                                   15820099
157700     END-IF.                                                      15830099
157800                                                                  15840099
157900     ADD +1                        TO ASC-ITEM-SUB.               15850099
158000                                                                  15860099
158100     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15870099
158200         ADD +1                    TO ASC-BLK-SUB                 15880099
158300         MOVE +1                   TO ASC-ITEM-SUB                15890099
158400     END-IF.                                                      15900099
158500                                                                  15910099
158600/                                                                 15920099
158700*----------------------------------------------------------------*15930099
158800*  EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE       *15940099
158900*  COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY).  *15950099
159000*----------------------------------------------------------------*15960099
159100 3000-EDIT-DATA-IN-COMMAREA.                                      15970099
159200                                                                  15980099
159300     SET PS-NO-ERROR               TO TRUE.                       15990099
159400                                                                  16000099
159500     PERFORM 3200-RESET-ATTRIBUTES.                               16010099
159600                                                                  16020099
159700     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     16030099
159800**                                                                16040099
159900* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              16050099
160000* EDITTING IS DONE FROM THE BOTTOM UP.                            16060099
160100**                                                                16070099
160200     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       16080099
160300         ASC-ITEMS-DISPLAYED - 1.                                 16090099
160400                                                                  16100099
160500     PERFORM 3100-SET-SUBSCRIPTS.                                 16110099
160600     PERFORM 3300-EDIT-SELECTIONS                                 16120099
160700         VARYING PV-SUB                                           16130099
160800         FROM PV-SUB BY -1                                        16140099
160900         UNTIL PV-SUB < +1                                        16150099
161000                                                                  16160099
161100     IF  PS-NO-ERROR                                              16170099
161200         PERFORM 3400-CHECK-RANGE-SEQUENCE                        16180099
161300     END-IF.                                                      16190099
161400                                                                  16200099
161500     IF  ((PS-NO-ERROR)                                           16210099
161600       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   16220099
161700       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    16230099
161800             PERFORM 3500-MARK-RANGE-AS-SELECTED                  16240099
161900     END-IF.                                                      16250099
162000                                                                  16260099
162100/                                                                 16270099
162200*----------------------------------------------------------------*16280099
162300*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *16290099
162400*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*16300099
162500*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *16310099
162600*                                                                *16320099
162700*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *16330099
162800*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *16340099
162900*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *16350099
163000*    US IN THE 2ND BLOCK OF THE ARRAY.                           *16360099
163100*----------------------------------------------------------------*16370099
163200                                                                  16380099
163300 3100-SET-SUBSCRIPTS.                                             16390099
163400                                                                  16400099
163500     COMPUTE ASC-ITEM-SUB =                                       16410099
163600         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        16420099
163700                                                                  16430099
163800     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16440099
163900         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16450099
164000                                                                  16460099
164100         MOVE PC-MAX-BLOCKS-IN-ARRAY                              16470099
164200                                   TO ASC-BLK-SUB                 16480099
164300     ELSE                                                         16490099
164400         MOVE +1                   TO ASC-BLK-SUB                 16500099
164500     END-IF.                                                      16510099
164600                                                                  16520099
164700*----------------------------------------------------------------*16530099
164800*  RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.      *16540099
164900*----------------------------------------------------------------*16550099
165000                                                                  16560099
165100 3200-RESET-ATTRIBUTES.                                           16570099
165200                                                                  16580099
165300     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   16590099
165400     MOVE DP015-GREEN              TO ASTRTITC.                   16600099
165500     MOVE DP015-UNDERLINE          TO ASTRTITH.                   16610099
165600                                                                  16620099
165700     IF DP020-NEXT-ACT-RETURN                                     16630099
165800     OR DP020-NEXT-ACT-READ-MAP                                   16640099
165900        PERFORM                                                   16650099
166000            VARYING PV-SUB                                        16660099
166100            FROM 1 BY 1                                           16670099
166200            UNTIL PV-SUB > ASC-ITEMS-DISPLAYED                    16680099
166300            MOVE DP015-UNP-ALP-NOR-OFF                            16690099
166400                                      TO MR-SELECTA (PV-SUB)      16700099
166500            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      16710099
166600            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      16720099
166700        END-PERFORM                                               16730099
166800     ELSE                                                         16740099
166900        PERFORM                                                   16750099
167000            VARYING PV-SUB                                        16760099
167100            FROM 1 BY 1                                           16770099
167200            UNTIL PV-SUB > PC-ITEMS-PER-PANEL                     16780099
167300            MOVE DP015-UNP-ALP-NOR-OFF                            16790099
167400                                      TO MR-SELECTA (PV-SUB)      16800099
167500            MOVE DP015-GREEN          TO MR-SELECTC (PV-SUB)      16810099
167600            MOVE DP015-UNDERLINE      TO MR-SELECTH (PV-SUB)      16820099
167700        END-PERFORM                                               16830099
167800     END-IF.                                                      16840099
167900                                                                  16850099
168000/                                                                 16860099
168100*----------------------------------------------------------------*16870099
168200*  EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS     *16880099
168300*  WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'    *16890099
168400*  IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR     *16900099
168500*  WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.              *16910099
168600*----------------------------------------------------------------*16920099
168700 3300-EDIT-SELECTIONS.                                            16930099
168800                                                                  16940099
168900     EVALUATE TRUE                                                16950099
169000         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16960099
169100             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16970099
169200                 CONTINUE                                         16980099
169300                                                                  16990099
169400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         17000099
169500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        17010099
169600                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS17020099
169700                 MOVE ASC-TEMP-SELECTED-SW                        17030099
169800                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17040099
169900                                   TO ASC-SELECTED-SW             17050099
170000                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17060099
170100             END-IF                                               17070099
170200                                                                  17080099
170300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     17090099
170400                 = SPACE                                          17100099
170500             EVALUATE TRUE                                        17110099
170600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       17120099
170700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS17130099
170800                     MOVE SPACE    TO ASC-SELECTED-SW             17140099
170900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17150099
171000                                                                  17160099
171100                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        17170099
171200                     MOVE ZERO     TO ASC-START-OF-SELECTED-RANGE 17180099
171300                     MOVE SPACE    TO ASC-SELECTED-SW             17190099
171400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17200099
171500                                                                  17210099
171600                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          17220099
171700                     MOVE ZERO     TO ASC-END-OF-SELECTED-RANGE   17230099
171800                     MOVE SPACE    TO ASC-SELECTED-SW             17240099
171900                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17250099
172000             END-EVALUATE                                         17260099
172100                                                                  17270099
172200         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           17280099
172300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17290099
172400                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17300099
172500             END-IF                                               17310099
172600             PERFORM 3310-EDIT-RANGE                              17320099
172700                                                                  17330099
172800         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             17340099
172900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17350099
173000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17360099
173100             END-IF                                               17370099
173200             PERFORM 3310-EDIT-RANGE                              17380099
173300                                                                  17390099
173400         WHEN OTHER                                               17400099
173500             MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER            17410099
173600             SET DP020-MSG-FATAL   TO TRUE                        17420099
173700             MOVE -1               TO MR-SELECTL (PV-SUB)         17430099
173800             SET DP030-SET-CURSOR-APPL-1                          17440099
173900                                   TO TRUE                        17450099
174000             MOVE DP015-RED        TO MR-SELECTC (PV-SUB)         17460099
174100             MOVE DP015-REVERSE    TO MR-SELECTH (PV-SUB)         17470099
174200             SET PS-ERROR          TO TRUE                        17480099
174300             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17490099
174400                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     17500099
174500                 MOVE SPACE        TO ASC-SELECTED-SW             17510099
174600                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17520099
174700             END-IF                                               17530099
174800     END-EVALUATE.                                                17540099
174900                                                                  17550099
175000     SUBTRACT +1 FROM PV-ITEM-IN-USE.                             17560099
175100     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17570099
175200                                                                  17580099
175300     IF  ASC-ITEM-SUB < 1                                         17590099
175400         SUBTRACT +1 FROM ASC-BLK-SUB                             17600099
175500         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                17610099
175600     END-IF.                                                      17620099
175700                                                                  17630099
175800*----------------------------------------------------------------*17640099
175900*  IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A       *17650099
176000*  RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1     *17660099
176100*  ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) *17670099
176200*  THE ENDING.                                                   *17680099
176300*----------------------------------------------------------------*17690099
176400 3310-EDIT-RANGE.                                                 17700099
176500                                                                  17710099
176600     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                17720099
176700         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   17730099
176800             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)17740099
176900                                   TO ASC-SELECTED-SW             17750099
177000                                        (ASC-BLK-SUB ASC-ITEM-SUB)17760099
177100             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 17770099
177200         ELSE                                                     17780099
177300             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     17790099
177400                 CONTINUE                                         17800099
177500             ELSE                                                 17810099
177600*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        17820099
177700                 MOVE PC-TSYMSG-00054                             17830099
177800                                   TO DP020-MSG-NUMBER            17840099
177900                 SET DP020-MSG-FATAL                              17850099
178000                                   TO TRUE                        17860099
178100                 MOVE -1           TO MR-SELECTL (PV-SUB)         17870099
178200                 SET DP030-SET-CURSOR-APPL-1                      17880099
178300                                   TO TRUE                        17890099
178400                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         17900099
178500                 MOVE DP015-UNDERLINE                             17910099
178600                                   TO MR-SELECTH (PV-SUB)         17920099
178700                 SET PS-ERROR      TO TRUE                        17930099
178800             END-IF                                               17940099
178900         END-IF                                                   17950099
179000     ELSE                                                         17960099
179100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17970099
179200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17980099
179300                                   TO ASC-SELECTED-SW             17990099
179400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   18000099
179500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   18010099
179600         ELSE                                                     18020099
179700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       18030099
179800                 CONTINUE                                         18040099
179900             ELSE                                                 18050099
180000*                -- ONLY ONE END-OF-RANGE ALLOWED --              18060099
180100                 MOVE PC-TSYMSG-00055                             18070099
180200                                   TO DP020-MSG-NUMBER            18080099
180300                 SET DP020-MSG-FATAL                              18090099
180400                                   TO TRUE                        18100099
180500                 MOVE -1           TO MR-SELECTL (PV-SUB)         18110099
180600                 SET DP030-SET-CURSOR-APPL-1                      18120099
180700                                   TO TRUE                        18130099
180800                 SET PS-ERROR      TO TRUE                        18140099
180900             END-IF                                               18150099
181000         END-IF                                                   18160099
181100     END-IF.                                                      18170099
181200                                                                  18180099
181300*----------------------------------------------------------------*18190099
181400*  IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,     *18200099
181500*  MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.   *18210099
181600*----------------------------------------------------------------*18220099
181700 3400-CHECK-RANGE-SEQUENCE.                                       18230099
181800                                                                  18240099
181900     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       18250099
182000       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      18260099
182100       AND  ASC-START-OF-SELECTED-RANGE >                         18270099
182200                                         ASC-END-OF-SELECTED-RANGE18280099
182300*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                18290099
182400         MOVE PC-TSYMSG-00052      TO DP020-MSG-NUMBER            18300099
182500         SET DP020-MSG-FATAL       TO TRUE                        18310099
182600         SET PS-ERROR              TO TRUE                        18320099
182700         PERFORM 3410-POSITION-AT-ERROR                           18330099
182800     END-IF.                                                      18340099
182900                                                                  18350099
183000*----------------------------------------------------------------*18360099
183100*  BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE     *18370099
183200*  PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR  *18380099
183300*  SHOULD BE POSITIONED ON A RANGE ERROR.                        *18390099
183400*----------------------------------------------------------------*18400099
183500 3410-POSITION-AT-ERROR.                                          18410099
183600                                                                  18420099
183700     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       18430099
183800                                                                  18440099
183900     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18450099
184000                    - PV-TOP-ITEM + 1.                            18460099
184100                                                                  18470099
184200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18480099
184300         CONTINUE                                                 18490099
184400     ELSE                                                         18500099
184500         MOVE -1                   TO MR-SELECTL (PV-SUB)         18510099
184600         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18520099
184700         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18530099
184800     END-IF.                                                      18540099
184900                                                                  18550099
185000     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18560099
185100                    - PV-TOP-ITEM + 1.                            18570099
185200                                                                  18580099
185300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18590099
185400         CONTINUE                                                 18600099
185500     ELSE                                                         18610099
185600         MOVE -1                   TO MR-SELECTL (PV-SUB)         18620099
185700         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18630099
185800         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18640099
185900     END-IF.                                                      18650099
186000                                                                  18660099
186100/                                                                 18670099
186200*----------------------------------------------------------------*18680099
186300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *18690099
186400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *18700099
186500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *18710099
186600*----------------------------------------------------------------*18720099
186700                                                                  18730099
186800 3500-MARK-RANGE-AS-SELECTED.                                     18740099
186900                                                                  18750099
187000     MOVE +1                       TO ASC-BLK-SUB.                18760099
187100                                                                  18770099
187200     PERFORM 3510-MARK-SELECTED-INDS                              18780099
187300         VARYING ASC-ITEM-SUB                                     18790099
187400         FROM 1 BY 1                                              18800099
187500         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18810099
187600                                                                  18820099
187700     ADD +1                        TO ASC-BLK-SUB.                18830099
187800                                                                  18840099
187900     PERFORM 3510-MARK-SELECTED-INDS                              18850099
188000         VARYING ASC-ITEM-SUB                                     18860099
188100         FROM 1 BY 1                                              18870099
188200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18880099
188300                                                                  18890099
188400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18900099
188500                                   TO PV-LIST-ITEM-NUMBER.        18910099
188600                                                                  18920099
188700     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18930099
188800         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         18940099
188900               PC-ITEMS-PER-PANEL).                               18950099
189000                                                                  18960099
189100     MOVE ASC-START-OF-SELECTED-RANGE                             18970099
189200                                   TO PV-START-OF-SELECTED-RANGE. 18980099
189300                                                                  18990099
189400     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            19000099
189500         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  19010099
189600               PC-ITEMS-PER-PANEL).                               19020099
189700                                                                  19030099
189800     MOVE ASC-END-OF-SELECTED-RANGE                               19040099
189900                                   TO PV-END-OF-SELECTED-RANGE.   19050099
190000                                                                  19060099
190100     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             19070099
190200         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    19080099
190300               PC-ITEMS-PER-PANEL).                               19090099
190400                                                                  19100099
190500     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             19110099
190600         PV-FIRST-BLOCK-IN-ARRAY + 1.                             19120099
190700                                                                  19130099
190800     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    19140099
190900        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        19150099
191000         MOVE +1                   TO ASC-BLK-SUB                 19160099
191100         PERFORM 5100-WRITE-TEMP-STORAGE                          19170099
191200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         19180099
191300             PV-FIRST-BLOCK-IN-ARRAY - 1                          19190099
191400                                                                  19200099
191500         PERFORM                                                  19210099
191600             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      19220099
191700                   PV-PREV-BLOCK-IN-ARRAY                         19230099
191800             MOVE PV-FIRST-BLOCK-IN-RANGE                         19240099
191900                                   TO PV-BLOCK-NUMBER             19250099
192000             PERFORM 4410-READ-TEMP-STORAGE                       19260099
192100             PERFORM 3510-MARK-SELECTED-INDS                      19270099
192200                 VARYING ASC-ITEM-SUB                             19280099
192300                 FROM 1 BY 1                                      19290099
192400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19300099
192500             PERFORM 5100-WRITE-TEMP-STORAGE                      19310099
192600             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     19320099
192700         END-PERFORM                                              19330099
192800                                                                  19340099
192900         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         19350099
193000             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     19360099
193100         PERFORM                                                  19370099
193200             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       19380099
193300                   PV-LAST-BLOCK-IN-RANGE                         19390099
193400             MOVE PV-NEXT-BLOCK-IN-ARRAY                          19400099
193500                                   TO PV-BLOCK-NUMBER             19410099
193600             PERFORM 4410-READ-TEMP-STORAGE                       19420099
193700             PERFORM 3510-MARK-SELECTED-INDS                      19430099
193800                 VARYING ASC-ITEM-SUB                             19440099
193900                 FROM 1 BY 1                                      19450099
194000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          19460099
194100             PERFORM 5100-WRITE-TEMP-STORAGE                      19470099
194200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      19480099
194300         END-PERFORM                                              19490099
194400                                                                  19500099
194500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             19510099
194600                                   TO PV-BLOCK-NUMBER             19520099
194700         PERFORM 4410-READ-TEMP-STORAGE                           19530099
194800     END-IF.                                                      19540099
194900                                                                  19550099
195000     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19560099
195100                                      ASC-END-OF-SELECTED-RANGE.  19570099
195200                                                                  19580099
195300/                                                                 19590099
195400*----------------------------------------------------------------*19600099
195500* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *19610099
195600*----------------------------------------------------------------*19620099
195700                                                                  19630099
195800 3510-MARK-SELECTED-INDS.                                         19640099
195900                                                                  19650099
196000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) >         19660099
196100         ASC-START-OF-SELECTED-RANGE)                             19670099
196200     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =         19680099
196300         ASC-START-OF-SELECTED-RANGE)                             19690099
196400                                                                  19700099
196500         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) <     19710099
196600             ASC-END-OF-SELECTED-RANGE)                           19720099
196700         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB) =     19730099
196800             ASC-END-OF-SELECTED-RANGE)                           19740099
196900                                                                  19750099
197000             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19760099
197100                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   19770099
197200                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   19780099
197300                                   TO TRUE                        19790099
197400                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              19800099
197500                                   TO TRUE                        19810099
197600                 ADD +1            TO ASC-NUMBER-OF-SELECTED-ITEMS19820099
197700             END-IF                                               19830099
197800         END-IF                                                   19840099
197900     END-IF.                                                      19850099
198000                                                                  19860099
198100/                                                                 19870099
198200*----------------------------------------------------------------*19880099
198300*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *19890099
198400*    INITIALIZE ALL COUNTERS AND FLAGS.                          *19900099
198500*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19910099
198600*    DISPLAY THE PANEL TO USER.                                  *19920099
198700*----------------------------------------------------------------*19930099
198800                                                                  19940099
198900 4000-BUILD-INITIAL-PANEL.                                        19950099
199000                                                                  19960099
199100     INITIALIZE ASC-BLOCK-ENTRIES (1)                             19970099
199200                ASC-BLOCK-ENTRIES (2).                            19980099
199300                                                                  19990099
199400     MOVE +1                       TO ASC-BLK-SUB.                20000099
199500                                                                  20010099
199600     SET ASC-ITEMS-LEFT-ON-DB      TO TRUE.                       20020099
199700                                                                  20030099
199800     MOVE +0                       TO ASC-ITEM-SUB                20040099
199900                                      ASC-NUMBER-OF-ITEMS-READ    20050099
200000                                      ASC-NUMBER-OF-SELECTED-ITEMS20060099
200100                                      ASC-HIGHEST-BLOCK-WRITTEN   20070099
200200                                      ASC-START-OF-SELECTED-RANGE 20080099
200300                                      ASC-END-OF-SELECTED-RANGE   20090099
200400                                      ASC-ITEM-AT-TOP-OF-PANEL.   20100099
200500                                                                  20110099
200600     PERFORM 4100-PREPARE-CURSOR.                                 20120099
200700                                                                  20130099
200800     MOVE ZEROES                   TO PV-PO-LNE-NBR.              20140099
200900                                                                  20150099
201000     PERFORM 4010-OPEN-CURSOR.                                    20160099
201100                                                                  20170099
201200     PERFORM 4300-READ-ITEMS-FROM-DB.                             20180099
201300                                                                  20190099
201400     PERFORM 4020-CLOSE-CURSOR.                                   20200099
201500                                                                  20210099
201600     MOVE +1                       TO PV-TOP-ITEM.                20220099
201700                                                                  20230099
201800     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          20240099
201900         SET DP020-NEXT-ACT-APPL-ERROR                            20250099
202000                                   TO TRUE                        20260099
202100         SET DP020-MSG-FATAL       TO TRUE                        20270099
202200         MOVE PC-TSYMSG-00050      TO DP020-MSG-NUMBER            20280099
202300     ELSE                                                         20290099
202400         MOVE -1                   TO MR-SELECTL (1)              20300099
202500         SET DP030-SET-CURSOR-APPL-1                              20310099
202600                                   TO TRUE                        20320099
202700         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     20330099
202800     END-IF.                                                      20340099
202900                                                                  20350099
203000/                                                                 20360099
203100*----------------------------------------------------------------*20370099
203200* OPEN THE PO LINE ITEM CURSOR                                   *20380099
203300*----------------------------------------------------------------*20390099
203400                                                                  20400099
203500 4010-OPEN-CURSOR.                                                20410099
203600                                                                  20420099
203700     PERFORM                                                      20430099
203800         WITH TEST AFTER                                          20440099
203900         VARYING PV-RETRY-COUNTER                                 20450099
204000         FROM 1 BY 1                                              20460099
204100         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               20470099
204200            OR (SQLCODE = +0))                                    20480099
204300                                                                  20490099
204400         EVALUATE TRUE                                            20500099
204500                                                                  20510099
204600             WHEN ASC-ITEM-CURSOR                                 20520099
204700                  EXEC SQL                                        20530099
204800                      OPEN ITEM-CSR                               20540099
204900                  END-EXEC                                        20550099
205000                                                                  20560099
205100             WHEN ASC-APP-ITEM-CURSOR                             20570099
205200                  EXEC SQL                                        20580099
205300                      OPEN APP-ITEM-CSR                           20590099
205400                  END-EXEC                                        20600099
205500                                                                  20610099
205600         END-EVALUATE                                             20620099
205700                                                                  20630099
205800         EVALUATE TRUE                                            20640099
205900             WHEN SQLCODE = +0                                    20650099
206000                  CONTINUE                                        20660099
206100             WHEN SQLCODE = -904                                  20670099
206200             WHEN SQLCODE = -913                                  20680099
206300                  CONTINUE                                        20690099
206400             WHEN SQLWARN0 NOT = SPACE                            20700099
206500             WHEN SQLCODE  NOT = +0                               20710099
206600                  MOVE '4010-OPEN-CURSOR'                         20720099
206700                                   TO DP013-PARAGRAPH             20730099
206800                  MOVE 'OPEN APP/ITEM-CSR CURSOR'                 20740099
206900                                   TO DP013-MESSAGE-TEXT (1)      20750099
207000                  MOVE SQLCA       TO DP013-SQLCA                 20760099
207100                  MOVE 'TPURITM'   TO DP013-DB2-TABLE-NAME (1)    20770099
207200                  SET DP013-DB2-ABEND                             20780099
207300                                   TO TRUE                        20790099
207400                  PERFORM DP013-0000-PROCESS-ABEND                20800099
207500         END-EVALUATE                                             20810099
207600     END-PERFORM.                                                 20820099
207700                                                                  20830099
207800     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        20840099
207900         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             20850099
208000         MOVE 'MAX RETRIES EXCEEDED FOR OPEN CURSOR'              20860099
208100                                   TO DP013-MESSAGE-TEXT (1)      20870099
208200         MOVE SQLCA                TO DP013-SQLCA                 20880099
208300         SET DP013-DB2-ABEND       TO TRUE                        20890099
208400         PERFORM DP013-0000-PROCESS-ABEND                         20900099
208500     END-IF.                                                      20910099
208600                                                                  20920099
208700/                                                                 20930099
208800*----------------------------------------------------------------*20940099
208900* CLOSE THE PO LINE ITEM CURSOR                                  *20950099
209000*----------------------------------------------------------------*20960099
209100                                                                  20970099
209200 4020-CLOSE-CURSOR.                                               20980099
209300                                                                  20990099
209400     EVALUATE TRUE                                                21000099
209500                                                                  21010099
209600         WHEN ASC-ITEM-CURSOR                                     21020099
209700              EXEC SQL                                            21030099
209800                  CLOSE ITEM-CSR                                  21040099
209900              END-EXEC                                            21050099
210000                                                                  21060099
210100         WHEN ASC-APP-ITEM-CURSOR                                 21070099
210200              EXEC SQL                                            21080099
210300                  CLOSE APP-ITEM-CSR                              21090099
210400              END-EXEC                                            21100099
210500                                                                  21110099
210600     END-EVALUATE.                                                21120099
210700                                                                  21130099
210800     EVALUATE TRUE                                                21140099
210900         WHEN SQLCODE = +0                                        21150099
211000              CONTINUE                                            21160099
211100                                                                  21170099
211200         WHEN SQLWARN0 NOT = SPACE                                21180099
211300         WHEN SQLCODE  NOT = +0                                   21190099
211400              MOVE '4020-CLOSE-CURSOR'                            21200099
211500                                   TO DP013-PARAGRAPH             21210099
211600              MOVE 'CLOSE APP/ITEM-CSR CURSOR'                    21220099
211700                                   TO DP013-MESSAGE-TEXT (1)      21230099
211800              MOVE SQLCA           TO DP013-SQLCA                 21240099
211900              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    21250099
212000              SET DP013-DB2-ABEND  TO TRUE                        21260099
212100              PERFORM DP013-0000-PROCESS-ABEND                    21270099
212200     END-EVALUATE.                                                21280099
212300                                                                  21290099
212400/                                                                 21300099
212500*----------------------------------------------------------------*21310099
212600*    DEPENDING ON WHAT WAS PASSED IN THE COMMAREA, SETUP THE     *21320099
212700*    DB2 KEYS IN PREPARATION FOR THE OPEN CURSROR.               *21330099
212800*----------------------------------------------------------------*21340099
212900                                                                  21350099
213000 4100-PREPARE-CURSOR.                                             21360099
213100                                                                  21370099
213200     INITIALIZE DCLTPURITM.                                       21380099
213300     MOVE ASC-KEY-PO-NBR         TO PURITM-PO-NBR.                21390099
213400                                                                  21400099
213500/                                                                 21410099
213600*----------------------------------------------------------------*21420099
213700*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *21430099
213800*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *21440099
213900*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *21450099
214000*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *21460099
214100*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *21470099
214200*                                                                *21480099
214300*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *21490099
214400*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *21500099
214500*    UPON INITIALIZATION.                                        *21510099
214600*----------------------------------------------------------------*21520099
214700                                                                  21530099
214800 4300-READ-ITEMS-FROM-DB.                                         21540099
214900                                                                  21550099
215000     PERFORM                                                      21560099
215100         VARYING PV-READ-COUNT                                    21570099
215200         FROM 1 BY 1                                              21580099
215300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    21590099
215400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         21600099
215500                                                                  21610099
215600         PERFORM 4310-FETCH                                       21620099
215700                                                                  21630099
215800         IF  ASC-ITEMS-LEFT-ON-DB                                 21640099
215900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                21650099
216000                 ADD +1            TO ASC-ITEM-SUB                21660099
216100             ELSE                                                 21670099
216200                 ADD +1            TO ASC-BLK-SUB                 21680099
216300                 MOVE +1           TO ASC-ITEM-SUB                21690099
216400                                                                  21700099
216500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         21710099
216600                     MOVE +1       TO ASC-BLK-SUB                 21720099
216700                     SET ASC-BLOCK-MODIFIED (1)                   21730099
216800                                   TO TRUE                        21740099
216900                     PERFORM 5100-WRITE-TEMP-STORAGE              21750099
217000                     MOVE ASC-BLOCK-ENTRIES                       21760099
217100                               (PC-MAX-BLOCKS-IN-ARRAY)           21770099
217200                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 21780099
217300                     ADD +1        TO ASC-BLK-SUB                 21790099
217400                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   21800099
217500                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      21810099
217600                                   TO TRUE                        21820099
217700                 END-IF                                           21830099
217800             END-IF                                               21840099
217900             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    21850099
218000             MOVE ASC-NUMBER-OF-ITEMS-READ                        21860099
218100                                   TO ASC-LIST-ITEM-NUMBER        21870099
218200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21880099
218300             IF  ASC-ITEM-CURSOR                                  21890099
218400                 ADD +1            TO PV-PO-LNE-NBR               21900099
218500                 MOVE PV-PO-LNE-NBR                               21910099
218600                                   TO ASC-PO-LNE-VAR-NBR          21920099
218700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21930099
218800                 MOVE ZEROES       TO ASC-APP-PO-LNE-NBR          21940099
218900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21950099
219000             ELSE                                                 21960099
219100                 MOVE ZEROES       TO ASC-PO-LNE-VAR-NBR          21970099
219200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  21980099
219300                 MOVE PURITM-APP-PO-LNE-NBR                       21990099
219400                                   TO ASC-APP-PO-LNE-NBR          22000099
219500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22010099
219600             END-IF                                               22020099
219700             MOVE PURITM-PO-LNE-NBR                               22030099
219800                                   TO ASC-PO-LNE-NBR              22040099
219900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22050099
220000             IF  PV-SKU-NBR-IND = -1                              22060099
220100                 MOVE PURITM-CL-NBR TO ASC-SUB-CL-NBR             22070099
220200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22080099
220300                 MOVE  PURCHS-DEPT-NBR  TO PV-TEMP-DEPT           22090099
220400                 MOVE  PURITM-CL-NBR    TO PV-TEMP-CLASS          22100099
220500                 MOVE  PURITM-SKU-SEQ-NBR TO PV-TEMP-SEQ          22110099
220600                 MOVE  PV-SKU           TO ASC-SKU-NBR            22120099
220700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22130099
220800                 MOVE  PURITM-CL-NBR(1:1) TO PV-TEMP-MAJ-CL-1     22140099
220900                 MOVE  PV-MAJ-CLASS     TO ASC-MAJ-CL-NBR         22150099
221000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22160099
221100                MOVE PURITM-VEND-STYL-NAME TO                     22170099
221200                                      ASC-VEND-STYL-NAME          22180099
221300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22190099
221400                 MOVE PURITM-SKU-DESC TO ASC-VEND-DESC            22200099
221500                                    (ASC-BLK-SUB ASC-ITEM-SUB)    22210099
221600             ELSE                                                 22220099
221700                 MOVE XLT00004-MAJ-CL-NBR                         22230099
221800                                   TO ASC-MAJ-CL-NBR              22240099
221900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22250099
222000                 MOVE XLT00004-SUB-CL-NBR                         22260099
222100                                   TO ASC-SUB-CL-NBR              22270099
222200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22280099
222300                 MOVE XLT00003-SKU-NBR TO ASC-SKU-NBR             22290099
222400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22300099
222500                 MOVE XLT00004-VS-NBR                             22310099
222600                                   TO ASC-VEND-STYL-NAME          22320099
222700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22330099
222800                 MOVE XLT00003-SKU-DESC                           22340099
222900                                   TO ASC-VEND-DESC               22350099
223000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22360099
223100             END-IF                                               22370099
223200             MOVE PURITM-STATUS-CDE                               22380099
223300                                   TO ASC-STATUS-CDE              22390099
223400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22400099
223500             MOVE PURITM-UNT-QTY   TO ASC-UNT-QTY                 22410099
223600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22420099
223700             MOVE PURITM-AD-EVNT-DTE                              22430099
223800                                    TO PV-AD-DATE-10              22440099
223900             IF  PV-AD-DATE-10 = '0001-01-01'                     22450099
224000                 MOVE SPACES        TO ASC-AD-EVNT-DTE            22460099
224100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22470099
224200             ELSE                                                 22480099
224300                 MOVE PV-AD-DATE-CC TO PV-SL-DATE-CC              22490099
224400                 MOVE PV-AD-DATE-YY TO PV-SL-DATE-YY              22500099
224500                 MOVE PV-AD-DATE-MM TO PV-SL-DATE-MM              22510099
224600                 MOVE PV-AD-DATE-DD TO PV-SL-DATE-DD              22520099
224700                 MOVE PV-SLASH-DATE TO ASC-AD-EVNT-DTE            22530099
224800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22540099
224900             END-IF                                               22550099
225000             IF PV-SKU-NBR-IND = +0                               22560099
225100               PERFORM 4340-GET-UPC-INFO                          22570099
225200             ELSE                                                 22580099
225300               MOVE PC-NO-VENDOR-UPC                              22590099
225400                                   TO PV-UPC-NBR-DISPLAY          22600099
225500             END-IF                                               22610099
225600             MOVE PV-UPC-NBR-DISPLAY                              22620099
225700                                   TO ASC-UPC-NBR                 22630099
225800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22640099
225900             INITIALIZE MESTDS-STR-DISTRO-QTY                     22650099
226000             PERFORM 4350-CHECK-ALLOC                             22660099
226100             PERFORM 4355-CHECK-ALLOC-ALLPLN                      22670099
226200*            EVALUATE TRUE                                        22680099
226300*              WHEN MESTDS-STR-DISTRO-QTY = ZEROES                22690099
226400*                MOVE 'NO'         TO ASC-ALLOC                   22700099
226500*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  22710099
226600*              WHEN MESTDS-STR-DISTRO-QTY = PURITM-UNT-QTY        22720099
226700*                MOVE 'YES'        TO ASC-ALLOC                   22730099
226800*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  22740099
226900*              WHEN MESTDS-STR-DISTRO-QTY > PURITM-UNT-QTY        22750099
227000*                MOVE 'OVER'       TO ASC-ALLOC                   22760099
227100*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  22770099
227200*              WHEN OTHER                                         22780099
227300*                MOVE 'PART'       TO ASC-ALLOC                   22790099
227400*                                     (ASC-BLK-SUB ASC-ITEM-SUB)  22800099
227500*            END-EVALUATE                                         22810099
227600             IF ALLPLN-CURR-SPLIT-QTY > ZERO                      22820099
227700                IF ALLPLN-CURR-SPLIT-QTY > PURITM-UNT-QTY         22830099
227800                    MOVE 'OVER'    TO  ASC-ALLOC                  22840099
227900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22850099
228000                ELSE                                              22860099
228100                 IF MESTDS-STR-DISTRO-QTY = ALLPLN-CURR-SPLIT-QTY 22870099
228200                     AND ALLPLN-CURR-SPLIT-QTY = PURITM-UNT-QTY   22880099
228300                       MOVE 'YES'    TO  ASC-ALLOC                22890099
228400                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22900099
228500                 ELSE                                             22910099
228600                      IF ALLPLN-CURR-SPLIT-QTY < PURITM-UNT-QTY   22920099
228700                       MOVE 'PART'   TO  ASC-ALLOC                22930099
228800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  22940099
228900                      END-IF                                      22950099
229000                      IF (MESTDS-STR-DISTRO-QTY NOT > 0 OR        22960099
229100              MESTDS-STR-DISTRO-QTY NOT = ALLPLN-CURR-SPLIT-QTY)  22970099
229200                       AND ALLPLN-CURR-SPLIT-QTY = PURITM-UNT-QTY 22980099
229300                                                                  22990099
229400                       MOVE 'SPLT'   TO  ASC-ALLOC                23000099
229500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23010099
229600                      END-IF                                      23020099
229700                 END-IF                                           23030099
229800                END-IF                                            23040099
229900             ELSE                                                 23050099
230000                 MOVE 'NO '        TO  ASC-ALLOC                  23060099
230100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  23070099
230200             END-IF                                               23080099
230300             PERFORM 4360-GET-RCVG-INFO                           23090099
230400             PERFORM 4370-GET-ASN-INFO                            23100099
230500         END-IF                                                   23110099
230600     END-PERFORM.                                                 23120099
230700                                                                  23130099
230800     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          23140099
230900         MOVE +1                   TO ASC-BLK-SUB                 23150099
231000         PERFORM 5100-WRITE-TEMP-STORAGE                          23160099
231100         ADD +1                    TO ASC-BLK-SUB                 23170099
231200         PERFORM 5100-WRITE-TEMP-STORAGE                          23180099
231300                                                                  23190099
231400         MOVE 1                    TO ASC-BLK-SUB                 23200099
231500                                      PV-BLOCK-NUMBER             23210099
231600         PERFORM 4410-READ-TEMP-STORAGE                           23220099
231700         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             23230099
231800             MOVE 2                TO ASC-BLK-SUB                 23240099
231900                                      PV-BLOCK-NUMBER             23250099
232000             PERFORM 4410-READ-TEMP-STORAGE                       23260099
232100         END-IF                                                   23270099
232200     END-IF.                                                      23280099
232300                                                                  23290099
232400/                                                                 23300099
232500*----------------------------------------------------------------*23310099
232600*    FETCH A VENDOR ROW                                          *23320099
232700*----------------------------------------------------------------*23330099
232800                                                                  23340099
232900 4310-FETCH.                                                      23350099
233000                                                                  23360099
233100     INITIALIZE PURITM-APP-PO-LNE-NBR                             23370099
233200              , XLT00004-MAJ-CL-NBR                               23380099
233300              , XLT00004-SUB-CL-NBR                               23390099
233400              , XLT00003-SKU-NBR                                  23400099
233500              , XLT00004-VS-NBR                                   23410099
233600              , XLT00003-SKU-DESC                                 23420099
233700              , PURITM-STATUS-CDE                                 23430099
233800              , PURITM-UNT-QTY                                    23440099
233900              , PURITM-AD-EVNT-DTE                                23450099
234000              , PURCHS-DEPT-NBR                                   23460099
234100              , PURITM-CL-NBR                                     23470099
234200              , PURITM-VEND-STYL-NAME                             23480099
234300              , PURITM-SKU-DESC                                   23490099
234400              , PURITM-SKU-SEQ-NBR                                23500099
234500              , PV-NULL-INDICATORS.                               23510099
234600                                                                  23520099
234700     EVALUATE TRUE                                                23530099
234800                                                                  23540099
234900         WHEN ASC-ITEM-CURSOR                                     23550099
235000              EXEC SQL                                            23560099
235100                  FETCH ITEM-CSR                                  23570099
235200                  INTO :PURITM-PO-LNE-NBR                         23580099
235300                      ,:XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND     23590099
235400                      ,:XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND     23600099
235500                      ,:XLT00003-SKU-NBR:PV-SKU-NBR-IND           23610099
235600                      ,:XLT00004-VS-NBR:PV-VS-NBR-IND             23620099
235700                      ,:XLT00003-SKU-DESC:PV-SKU-DESC-IND         23630099
235800                      ,:PURITM-STATUS-CDE                         23640099
235900                      ,:PURITM-UNT-QTY                            23650099
236000                      ,:PURITM-AD-EVNT-DTE                        23660099
236100                      ,:PURITM-APP-PO-LNE-NBR                     23670099
236200                      ,:PURCHS-DEPT-NBR                           23680099
236300                      ,:PURITM-CL-NBR                             23690099
236400                      ,:PURITM-VEND-STYL-NAME                     23700099
236500                      ,:PURITM-SKU-DESC                           23710099
236600                      ,:PURITM-SKU-SEQ-NBR                        23720099
236700               END-EXEC                                           23730099
236800                                                                  23740099
236900         WHEN ASC-APP-ITEM-CURSOR                                 23750099
237000              EXEC SQL                                            23760099
237100                  FETCH APP-ITEM-CSR                              23770099
237200                  INTO :PURITM-PO-LNE-NBR                         23780099
237300                      ,:PURITM-APP-PO-LNE-NBR                     23790099
237400                      ,:XLT00004-MAJ-CL-NBR:PV-MAJ-CL-NBR-IND     23800099
237500                      ,:XLT00004-SUB-CL-NBR:PV-SUB-CL-NBR-IND     23810099
237600                      ,:XLT00003-SKU-NBR:PV-SKU-NBR-IND           23820099
237700                      ,:XLT00004-VS-NBR:PV-VS-NBR-IND             23830099
237800                      ,:XLT00003-SKU-DESC:PV-SKU-DESC-IND         23840099
237900                      ,:PURITM-STATUS-CDE                         23850099
238000                      ,:PURITM-UNT-QTY                            23860099
238100                      ,:PURITM-AD-EVNT-DTE                        23870099
238200                      ,:PURCHS-DEPT-NBR                           23880099
238300                      ,:PURITM-CL-NBR                             23890099
238400                      ,:PURITM-VEND-STYL-NAME                     23900099
238500                      ,:PURITM-SKU-DESC                           23910099
238600                      ,:PURITM-SKU-SEQ-NBR                        23920099
238700               END-EXEC                                           23930099
238800                                                                  23940099
238900     END-EVALUATE                                                 23950099
239000                                                                  23960099
239100     EVALUATE TRUE                                                23970099
239200         WHEN SQLCODE = +0                                        23980099
239300              CONTINUE                                            23990099
239400         WHEN SQLCODE = +100                                      24000099
239500              SET ASC-NO-ITEMS-LEFT-ON-DB                         24010099
239600                                   TO TRUE                        24020099
239700         WHEN SQLWARN0 NOT = SPACE                                24030099
239800         WHEN SQLCODE < +0                                        24040099
239900         WHEN SQLCODE > +0                                        24050099
240000              MOVE '4310-FETCH-CURSOR'                            24060099
240100                                   TO DP013-PARAGRAPH             24070099
240200              MOVE 'FETCH APP/ITEM CURSOR'                        24080099
240300                                   TO DP013-MESSAGE-TEXT (1)      24090099
240400              MOVE SQLCA           TO DP013-SQLCA                 24100099
240500              MOVE 'TPURITM'       TO DP013-DB2-TABLE-NAME (1)    24110099
240600              MOVE 'XLT_SKU'       TO DP013-DB2-TABLE-NAME(2)     24120099
240700              MOVE 'XLT_VND_STYL'  TO DP013-DB2-TABLE-NAME (3)    24130099
240800              SET DP013-DB2-ABEND  TO TRUE                        24140099
240900              PERFORM DP013-0000-PROCESS-ABEND                    24150099
241000     END-EVALUATE.                                                24160099
241100                                                                  24170099
241200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        24180099
241300         MOVE '4310-FETCH-CURSOR'  TO DP013-PARAGRAPH             24190099
241400         MOVE 'MAX RETRIES EXCEEDED FOR FETCH CURSOR'             24200099
241500                                   TO DP013-MESSAGE-TEXT (1)      24210099
241600         MOVE SQLCA                TO DP013-SQLCA                 24220099
241700         SET DP013-DB2-ABEND                                      24230099
241800             DP013-XCTL-DISPLAY-RESTART                           24240099
241900                                   TO TRUE                        24250099
242000         PERFORM DP013-0000-PROCESS-ABEND                         24260099
242100     END-IF.                                                      24270099
242200                                                                  24280099
242300/                                                                 24290099
242400*----------------------------------------------------------------*24300099
242500* SELECT A ROW FROM THE DB2 TUPCSKU TABLE.                       *24310099
242600*----------------------------------------------------------------*24320099
242700 4340-GET-UPC-INFO.                                               24330099
242800                                                                  24340099
242900     EXEC SQL                                                     24350099
243000         SELECT                                                   24360099
243100              A.UPC_NBR                                           24370099
243200          INTO :XLT00006-UPC-NBR                                  24380099
243300          FROM XLT_UPC A                                          24390099
243400              ,XLT_SKU B                                          24400099
243500         WHERE SKU_NBR       = :XLT00003-SKU-NBR                  24410099
243600           AND B.INTR_UPC_ID = A.INTR_UPC_ID                      24420099
243700           AND UPC_TYP_CDE   = 'V'                                24430099
243800     END-EXEC.                                                    24440099
243900                                                                  24450099
244000     EVALUATE TRUE                                                24460099
244100         WHEN SQLCODE = +0                                        24470099
244200           MOVE XLT00006-UPC-NBR TO PV-UPC-NBR                    24480099
244300           STRING PV-UPC-NBR-X(3:2)  DELIMITED BY SIZE            24490099
244400                  '-'                DELIMITED BY SIZE            24500099
244500                  PV-UPC-NBR-X(5:5)  DELIMITED BY SIZE            24510099
244600                  '-'                DELIMITED BY SIZE            24520099
244700                  PV-UPC-NBR-X(10:5) DELIMITED BY SIZE            24530099
244800                  '-'                DELIMITED BY SIZE            24540099
244900                  PV-UPC-NBR-X(15:1) DELIMITED BY SIZE            24550099
245000                               INTO PV-UPC-NBR-DISPLAY            24560099
245100                                                                  24570099
245200         WHEN SQLCODE = +100                                      24580099
245300           MOVE PC-NO-VENDOR-UPC TO PV-UPC-NBR-DISPLAY            24590099
245400                                                                  24600099
245500         WHEN SQLCODE = -811                                      24610099
245600           MOVE PC-MULTIPLE-UPC  TO PV-UPC-NBR-DISPLAY            24620099
245700                                                                  24630099
245800         WHEN SQLWARN0 NOT = SPACES                               24640099
245900         WHEN SQLCODE < +0                                        24650099
246000         WHEN SQLCODE > +0                                        24660099
246100             MOVE '4340-GET-UPC-INFO'                             24670099
246200                               TO DP013-PARAGRAPH                 24680099
246300             MOVE 'SELECT UPC INFO  '                             24690099
246400                               TO DP013-MESSAGE-TEXT (1)          24700099
246500             MOVE SQLCA        TO DP013-SQLCA                     24710099
246600             MOVE 'XLT_UPC'    TO DP013-DB2-TABLE-NAME (1)        24720099
246700             MOVE 'XLT_SKU'    TO DP013-DB2-TABLE-NAME (2)        24730099
246800             SET DP013-DB2-ABEND                                  24740099
246900                 DP013-XCTL-DISPLAY-RESTART                       24750099
247000                               TO TRUE                            24760099
247100             PERFORM DP013-0000-PROCESS-ABEND                     24770099
247200     END-EVALUATE.                                                24780099
247300                                                                  24790099
247400/                                                                 24800099
247500 4350-CHECK-ALLOC.                                                24810099
247600                                                                  24820099
247700     MOVE PURITM-PO-LNE-NBR TO MESTDS-PO-LNE-NBR.                 24830099
247800                                                                  24840099
247900     EXEC SQL                                                     24850099
248000         SELECT SUM(STR_DISTRO_QTY)                               24860099
248100          INTO :MESTDS-STR-DISTRO-QTY:PV-ALLOC-NULL               24870099
248200          FROM TMESTDS                                            24880099
248300         WHERE PO_NBR     = :ASC-KEY-PO-NBR                       24890099
248400           AND PO_LNE_NBR = :MESTDS-PO-LNE-NBR                    24900099
248500     END-EXEC.                                                    24910099
248600                                                                  24920099
248700     EVALUATE TRUE                                                24930099
248800         WHEN SQLCODE = +0                                        24940099
248900         WHEN SQLCODE = -305                                      24950099
249000             CONTINUE                                             24960099
249100                                                                  24970099
249200         WHEN SQLWARN0 NOT = SPACES                               24980099
249300         WHEN SQLCODE < +0                                        24990099
249400         WHEN SQLCODE > +0                                        25000099
249500             MOVE '4350-CHECK-ALLOC'                              25010099
249600                               TO DP013-PARAGRAPH                 25020099
249700             MOVE 'SELECT STORE ALLOCATIONS'                      25030099
249800                               TO DP013-MESSAGE-TEXT (1)          25040099
249900             MOVE SQLCA        TO DP013-SQLCA                     25050099
250000             MOVE 'TMESTDS'    TO DP013-DB2-TABLE-NAME (1)        25060099
250100             SET DP013-DB2-ABEND                                  25070099
250200                 DP013-XCTL-DISPLAY-RESTART                       25080099
250300                               TO TRUE                            25090099
250400             PERFORM DP013-0000-PROCESS-ABEND                     25100099
250500     END-EVALUATE.                                                25110099
250600                                                                  25120099
250700/                                                                 25130099
250800*----------------------------------------------------------------*25140099
250900 4355-CHECK-ALLOC-ALLPLN.                                         25150099
251000                                                                  25160099
251100     MOVE ZERO  TO ALLPLN-CURR-SPLIT-QTY.                         25170099
251200     EXEC SQL                                                     25180099
251300         SELECT SUM(CURR_SPLIT_QTY)                               25190099
251400          INTO :ALLPLN-CURR-SPLIT-QTY:PV-ALLOC-ALLPLN-NULL        25200099
251500          FROM TALLPLN                                            25210099
251600         WHERE PO_NBR     = :ASC-KEY-PO-NBR                       25220099
251700           AND PO_LNE_NBR = :PURITM-PO-LNE-NBR                    25230099
251800     END-EXEC.                                                    25240099
251900                                                                  25250099
252000     EVALUATE TRUE                                                25260099
252100         WHEN SQLCODE = +0                                        25270099
252200         WHEN SQLCODE = -305                                      25280099
252300             CONTINUE                                             25290099
252400                                                                  25300099
252500         WHEN SQLWARN0 NOT = SPACES                               25310099
252600         WHEN SQLCODE < +0                                        25320099
252700         WHEN SQLCODE > +0                                        25330099
252800             MOVE '4355-CHECK-ALLOC-ALLPLN'                       25340099
252900                               TO DP013-PARAGRAPH                 25350099
253000             MOVE 'SELECT STORE ALLOCATIONS'                      25360099
253100                               TO DP013-MESSAGE-TEXT (1)          25370099
253200             MOVE SQLCA        TO DP013-SQLCA                     25380099
253300             MOVE 'TALLPLN'    TO DP013-DB2-TABLE-NAME (1)        25390099
253400             SET DP013-DB2-ABEND                                  25400099
253500                 DP013-XCTL-DISPLAY-RESTART                       25410099
253600                               TO TRUE                            25420099
253700             PERFORM DP013-0000-PROCESS-ABEND                     25430099
253800     END-EVALUATE.                                                25440099
253900                                                                  25450099
254000/                                                                 25460099
254100*----------------------------------------------------------------*25470099
254200 4360-GET-RCVG-INFO.                                              25480099
254300                                                                  25490099
254400     EXEC SQL                                                     25500099
254500         SELECT SUM(AP_VERIFY_ITM_QTY)                            25510099
254600          INTO :RECDIS-AP-VERIFY-ITM-QTY:PV-VER-QTY-NULL          25520099
254700          FROM TRECDIS                                            25530099
254800          WHERE ORD_NBR = :ASC-KEY-PO-NBR                         25540099
254900           AND  ORD_LNE_NBR = :PURITM-APP-PO-LNE-NBR              25550099
255000           AND  VER_STATUS_CDE = 'A'                              25560099
255100     END-EXEC.                                                    25570099
255200                                                                  25580099
255300     EVALUATE TRUE                                                25590099
255400         WHEN SQLCODE = +0                                        25600099
255500             IF PV-VER-QTY-NULL < ZERO                            25610099
255600                MOVE ZEROES           TO                          25620099
255700                         ASC-QTY-REC  (ASC-BLK-SUB ASC-ITEM-SUB)  25630099
255800             ELSE                                                 25640099
255900                MOVE RECDIS-AP-VERIFY-ITM-QTY TO                  25650099
256000                         ASC-QTY-REC  (ASC-BLK-SUB ASC-ITEM-SUB)  25660099
256100                                                                  25670099
256200             END-IF                                               25680099
256300                                                                  25690099
256400         WHEN SQLWARN0 NOT = SPACES                               25700099
256500         WHEN SQLCODE < +0                                        25710099
256600         WHEN SQLCODE > +0                                        25720099
256700             MOVE '4360-GET-RCVG-INFO'                            25730099
256800                               TO DP013-PARAGRAPH                 25740099
256900             MOVE 'SELECT VERIFIED QTY     '                      25750099
257000                               TO DP013-MESSAGE-TEXT (1)          25760099
257100             MOVE SQLCA        TO DP013-SQLCA                     25770099
257200             MOVE 'TRECDIS'    TO DP013-DB2-TABLE-NAME (1)        25780099
257300             SET DP013-DB2-ABEND                                  25790099
257400                 DP013-XCTL-DISPLAY-RESTART                       25800099
257500                               TO TRUE                            25810099
257600             PERFORM DP013-0000-PROCESS-ABEND                     25820099
257700     END-EVALUATE.                                                25830099
257800                                                                  25840099
257900/                                                                 25850099
258000*----------------------------------------------------------------*25860099
258100 4370-GET-ASN-INFO.                                               25870099
258200                                                                  25880099
258300     MOVE ZEROES          TO PV-PO-NBR9.                          25890099
258400     MOVE SPACES          TO PV-ASN-PO-NBR                        25900099
258500                             PV-ASN-PO-NBR-6                      25910099
258500                             PV-ASN-PO-NBR-8.                     25911099
258600     MOVE PURITM-APP-PO-LNE-NBR TO PV-ASN-PO-LN-NBR.              25920099
258700     MOVE ASC-KEY-PO-NBR TO PV-PO-NBR9.                           25930099
258800                                                                  25940099
C66632       MOVE PV-PO-NBR9(4:7) TO PV-ASN-PO-NBR                      25970099
C66632       MOVE PV-PO-NBR9(5:6) TO PV-ASN-PO-NBR-6                    25980099
C66632       MOVE PV-PO-NBR9(3:8) TO PV-ASN-PO-NBR-8                    25981099
259800                                                                  26040099
259900                                                                  26050099
260000     PERFORM                                                      26060099
260100       WITH TEST AFTER                                            26070099
260200       VARYING PV-RETRY-COUNTER                                   26080099
260300       FROM 1 BY 1                                                26090099
260400       UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES-2)               26100099
260500           OR (SQLCODE = +0))                                     26110099
260600                                                                  26120099
260700       EXEC SQL                                                   26130099
260800           SELECT SUM(ASSOC_QTY)                                  26140099
260900            INTO :ASDTPL-ASSOC-QTY:PV-ASN-QTY-NULL                26150099
261000            FROM TASDTPL                                          26160099
C66632            WHERE PO_NBR IN ( :PV-ASN-PO-NBR , :PV-ASN-PO-NBR-6,  26170099
C66632-                             :PV-ASN-PO-NBR-8)                   26171099
261200            AND   PO_LN_NBR = :PV-ASN-PO-LN-NBR                   26180099
261300       END-EXEC                                                   26190099
261400                                                                  26200099
261500       EVALUATE TRUE                                              26210099
261600         WHEN SQLCODE = +0                                        26220099
261700           IF PV-ASN-QTY-NULL < ZERO                              26230099
261800             MOVE ZEROES           TO                             26240099
261900                   ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB)      26250099
262000           ELSE                                                   26260099
262100             MOVE ASDTPL-ASSOC-QTY         TO                     26270099
262200                      ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB)   26280099
262300             IF ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB)         26290099
262400                      < ASC-QTY-REC  (ASC-BLK-SUB ASC-ITEM-SUB)   26300099
262500               MOVE ZERO TO                                       26310099
262600                         ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB)26320099
262700             ELSE                                                 26330099
262800                                                                  26340099
262900               COMPUTE                                            26350099
263000                  ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB) =     26360099
263100                    ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB) -   26370099
263200                    ASC-QTY-REC  (ASC-BLK-SUB ASC-ITEM-SUB)       26380099
263300                                                                  26390099
263400             END-IF                                               26400099
263500           END-IF                                                 26410099
263600                                                                  26420099
263700         WHEN SQLCODE = -913 OR -904                              26430099
263800           MOVE '??????' TO ASC-QTY-IN-RTE-X                      26440099
263900                                (ASC-BLK-SUB ASC-ITEM-SUB)        26450099
264000                                                                  26460099
264100         WHEN SQLWARN0 NOT = SPACES                               26470099
264200         WHEN SQLCODE < +0                                        26480099
264300         WHEN SQLCODE > +0                                        26490099
264400           MOVE '4360-GET-RCVG-INFO'                              26500099
264500                             TO DP013-PARAGRAPH                   26510099
264600           MOVE 'SELECT VERIFIED QTY     '                        26520099
264700                             TO DP013-MESSAGE-TEXT (1)            26530099
264800           MOVE SQLCA        TO DP013-SQLCA                       26540099
264900           MOVE 'TASDTPL'    TO DP013-DB2-TABLE-NAME (1)          26550099
265000           SET DP013-DB2-ABEND                                    26560099
265100               DP013-XCTL-DISPLAY-RESTART                         26570099
265200                             TO TRUE                              26580099
265300           PERFORM DP013-0000-PROCESS-ABEND                       26590099
265400       END-EVALUATE                                               26600099
265500     END-PERFORM.                                                 26610099
265600                                                                  26620099
265700/                                                                 26630099
265800*----------------------------------------------------------------*26640099
265900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *26650099
266000*----------------------------------------------------------------*26660099
266100                                                                  26670099
266200 4400-MOVE-COMMAREA-TO-SCREEN.                                    26680099
266300                                                                  26690099
266400     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             26700099
266500         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          26710099
266600         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          26720099
266700             MOVE +1               TO ASC-BLK-SUB                 26730099
266800             PERFORM 5100-WRITE-TEMP-STORAGE                      26740099
266900             ADD +1                TO ASC-BLK-SUB                 26750099
267000             PERFORM 5100-WRITE-TEMP-STORAGE                      26760099
267100             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             26770099
267200                 GIVING PV-BLOCK-NUMBER                           26780099
267300                 REMAINDER PV-REMAINDER                           26790099
267400             IF  PV-REMAINDER > ZERO                              26800099
267500                 ADD +1            TO PV-BLOCK-NUMBER             26810099
267600             END-IF                                               26820099
267700             MOVE +1               TO ASC-BLK-SUB                 26830099
267800             PERFORM 4410-READ-TEMP-STORAGE                       26840099
267900             ADD +1                TO ASC-BLK-SUB                 26850099
268000                                      PV-BLOCK-NUMBER             26860099
268100             PERFORM 4410-READ-TEMP-STORAGE                       26870099
268200     END-IF.                                                      26880099
268300                                                                  26890099
268400     MOVE +1                       TO ASC-BLK-SUB.                26900099
268500                                                                  26910099
268600     COMPUTE ASC-ITEM-SUB =                                       26920099
268700         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              26930099
268800         + PC-ITEMS-PER-PANEL).                                   26940099
268900                                                                  26950099
269000     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        26960099
269100         ADD +1                    TO ASC-BLK-SUB                 26970099
269200         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            26980099
269300     END-IF.                                                      26990099
269400                                                                  27000099
269500     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           27010099
269600         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                27020099
269700                                                                  27030099
269800     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        27040099
269900     PERFORM 4420-FORMAT-LIST-LINES                               27050099
270000         VARYING PV-SUB                                           27060099
270100         FROM PC-ITEMS-PER-PANEL BY -1                            27070099
270200         UNTIL PV-SUB < +1.                                       27080099
270300                                                                  27090099
270400     COMPUTE ASC-ITEMS-DISPLAYED =                                27100099
270500         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          27110099
270600                                                                  27120099
270700     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    27130099
270800                                      ASTRTITO.                   27140099
270900                                                                  27150099
271000     MOVE ASC-KEY-PO-NBR           TO MR-PO-NBR.                  27160099
271100     MOVE ASC-KEY-DEPT-NBR         TO MR-DEPT-NBR.                27170099
271200     MOVE ASC-KEY-ENT-NAME-DESC    TO MR-ENT-NAME-DESC.           27180099
271300     MOVE ASC-TOT-UNT-QTY          TO MR-TOT-UNT-QTY.             27190099
271400     MOVE ASC-TOT-SKUS-QTY         TO MR-TOT-SKUS-QTY.            27200099
271500                                                                  27210099
271600     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    27220099
271700     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    27230099
271800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            27240099
271900                                   TO ASELITO.                    27250099
272000                                                                  27260099
272100     IF  DP020-MSG-NUMBER-X = SPACE                               27270099
272200         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  27280099
272300*            --- MORE ITEMS TO DISPLAY ----                       27290099
272400             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            27300099
272500             SET DP020-MSG-INFORMATIONAL                          27310099
272600                                   TO TRUE                        27320099
272700         END-IF                                                   27330099
272800     END-IF.                                                      27340099
272900                                                                  27350099
273000*----------------------------------------------------------------*27360099
273100*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *27370099
273200*----------------------------------------------------------------*27380099
273300                                                                  27390099
273400 4410-READ-TEMP-STORAGE.                                          27400099
273500                                                                  27410099
273600     EXEC CICS                                                    27420099
273700         READQ TS                                                 27430099
273800             QUEUE (ASC-LIST-QUEUE-NAME)                          27440099
273900             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               27450099
274000             ITEM  (PV-BLOCK-NUMBER)                              27460099
274100             RESP  (PV-CICS-RESP)                                 27470099
274200     END-EXEC.                                                    27480099
274300                                                                  27490099
274400     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       27500099
274500       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     27510099
274600         CONTINUE                                                 27520099
274700     ELSE                                                         27530099
274800         SET DP013-CICS-ABEND      TO TRUE                        27540099
274900         SET DP013-NO-ROLLBACK     TO TRUE                        27550099
275000         MOVE '4410-READ-TEMP-STORAGE'                            27560099
275100                                   TO DP013-PARAGRAPH             27570099
275200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      27580099
275300                                   TO DP013-MESSAGE-TEXT(1)       27590099
275400         PERFORM DP013-0000-PROCESS-ABEND                         27600099
275500     END-IF.                                                      27610099
275600                                                                  27620099
275700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      27630099
275800                                   TO TRUE.                       27640099
275900                                                                  27650099
276000     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         27660099
276100         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               27670099
276200     END-IF.                                                      27680099
276300                                                                  27690099
276400/                                                                 27700099
276500*----------------------------------------------------------------*27710099
276600*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *27720099
276700*----------------------------------------------------------------*27730099
276800                                                                  27740099
276900 4420-FORMAT-LIST-LINES.                                          27750099
277000                                                                  27760099
277100     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      27770099
277200         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                27780099
277300         MOVE DP015-ASK-DRK-OFF    TO MR-SELECTA (PV-SUB)         27790099
277400         MOVE SPACES               TO MR-PO-NBR-X                 27800099
277500                                      MR-DEPT-NBR                 27810099
277600                                      MR-ENT-NAME-DESC            27820099
277700                                      MR-TOT-UNT-QTY-X            27830099
277800                                      MR-TOT-SKUS-QTY-X           27840099
277900                                      MR-SELECT  (PV-SUB)         27850099
278000                                      MR-PO-LNE-NBR-X (PV-SUB)    27860099
278100                                      MR-MAJ-CL-NBR-X (PV-SUB)    27870099
278200                                      MR-SUB-CL-NBR-X (PV-SUB)    27880099
278300                                      MR-SKU-NBR-X (PV-SUB)       27890099
278400                                      MR-VEND-STYL-NAME (PV-SUB)  27900099
278500                                      MR-STATUS-CDE (PV-SUB)      27910099
278600                                      MR-UNT-QTY-X (PV-SUB)       27920099
278700                                      MR-QTY-IN-RTE-X (PV-SUB)    27930099
278800                                      MR-QTY-REC-X (PV-SUB)       27940099
278900                                      MR-ALLOC (PV-SUB)           27950099
279000                                      MR-PACK-IND (PV-SUB)        27960099
279100                                      MR-UPC-NBR  (PV-SUB)        27970099
279200                                      MR-VEND-DESC (PV-SUB)       27980099
279300                                      MR-AD-EVNT-DTE (PV-SUB)     27990099
279400     ELSE                                                         28000099
279500         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      28010099
279600                                                   > SPACE        28020099
279700             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 28030099
279800                                   TO MR-SELECT (PV-SUB)          28040099
279900         ELSE                                                     28050099
280000             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      28060099
280100                                   TO MR-SELECT (PV-SUB)          28070099
280200         END-IF                                                   28080099
280300                                                                  28090099
280400         IF  DP030-SET-CURSOR-TRAILER                             28100099
280500             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)28110099
280600                 > SPACE)                                         28120099
280700               OR (PV-SUB = 1))                                   28130099
280800                SET DP030-SET-CURSOR-APPL-1 TO TRUE               28140099
280900                MOVE -1            TO MR-SELECTL (PV-SUB)         28150099
281000             END-IF                                               28160099
281100         END-IF                                                   28170099
281200                                                                  28180099
281300         IF  PV-TOP-ITEM NOT = ASC-ITEM-AT-TOP-OF-PANEL           28190099
281400             IF  ASC-ITEM-CURSOR                                  28200099
281500                 MOVE ASC-PO-LNE-VAR-NBR                          28210099
281600                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28220099
281700                                   TO MR-PO-LNE-NBR (PV-SUB)      28230099
281800             ELSE                                                 28240099
281900                 MOVE ASC-APP-PO-LNE-NBR                          28250099
282000                                       (ASC-BLK-SUB ASC-ITEM-SUB) 28260099
282100                                   TO MR-PO-LNE-NBR (PV-SUB)      28270099
282200             END-IF                                               28280099
282300             MOVE ASC-MAJ-CL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)       28290099
282400                                   TO MR-MAJ-CL-NBR (PV-SUB)      28300099
282500             MOVE ASC-SUB-CL-NBR (ASC-BLK-SUB ASC-ITEM-SUB)       28310099
282600                                   TO MR-SUB-CL-NBR (PV-SUB)      28320099
282700             MOVE ASC-SKU-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          28330099
282800                                   TO MR-SKU-NBR (PV-SUB)         28340099
282900             MOVE ASC-PO-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB)       28350099
283000                                   TO DK-PO-LNE-NBR               28360099
283100             PERFORM 4426-CHECK-TWEBUPC                           28370099
283200                                                                  28380099
283300             IF PV-DB2-COUNT > 0                                  28390099
283400                MOVE DP015-RED  TO MR-MAJ-CL-NBRC (PV-SUB)        28400099
283500                                   MR-SUB-CL-NBRC (PV-SUB)        28410099
283600                                   MR-SKU-NBRC (PV-SUB)           28420099
283700             ELSE                                                 28430099
283800                MOVE DP015-BLUE TO MR-MAJ-CL-NBRC (PV-SUB)        28440099
283900                                   MR-SUB-CL-NBRC (PV-SUB)        28450099
284000                                   MR-SKU-NBRC (PV-SUB)           28460099
284100             END-IF                                               28470099
284200                                                                  28480099
284300             MOVE ASC-VEND-STYL-NAME (ASC-BLK-SUB ASC-ITEM-SUB)   28490099
284400                                   TO MR-VEND-STYL-NAME (PV-SUB)  28500099
284500             MOVE ASC-STATUS-CDE (ASC-BLK-SUB ASC-ITEM-SUB)       28510099
284600                                   TO MR-STATUS-CDE (PV-SUB)      28520099
284700             MOVE ASC-UNT-QTY (ASC-BLK-SUB ASC-ITEM-SUB)          28530099
284800                                   TO MR-UNT-QTY (PV-SUB)         28540099
284900             IF ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB) =       28550099
285000                                 '??????'                         28560099
285100                 MOVE ASC-QTY-IN-RTE-X (ASC-BLK-SUB ASC-ITEM-SUB) 28570099
285200                                   TO MR-QTY-IN-RTE-X (PV-SUB)    28580099
285300             ELSE                                                 28590099
285400                 MOVE ASC-QTY-IN-RTE (ASC-BLK-SUB ASC-ITEM-SUB)   28600099
285500                                       TO MR-QTY-IN-RTE (PV-SUB)  28610099
285600             END-IF                                               28620099
285700             MOVE ASC-QTY-REC (ASC-BLK-SUB ASC-ITEM-SUB)          28630099
285800                                   TO MR-QTY-REC (PV-SUB)         28640099
285900             MOVE ASC-ALLOC (ASC-BLK-SUB ASC-ITEM-SUB)            28650099
286000                                   TO MR-ALLOC (PV-SUB)           28660099
286100             IF ASC-PO-PKGNG-CDE = 'M' OR 'I'                     28670099
286200                PERFORM 4425-GET-PO-PREPK-ID                      28680099
286300                IF ASC-PO-PREPK-ID (ASC-BLK-SUB ASC-ITEM-SUB) > 0 28690099
286400                       MOVE '*'     TO MR-PACK-IND (PV-SUB)       28700099
286500                ELSE                                              28710099
286600                       MOVE SPACES  TO MR-PACK-IND (PV-SUB)       28720099
286700                END-IF                                            28730099
286800             ELSE                                                 28740099
286900                MOVE SPACES         TO MR-PACK-IND (PV-SUB)       28750099
287000             END-IF                                               28760099
287100             MOVE ASC-UPC-NBR (ASC-BLK-SUB ASC-ITEM-SUB)          28770099
287200                                   TO MR-UPC-NBR (PV-SUB)         28780099
287300             MOVE ASC-VEND-DESC (ASC-BLK-SUB ASC-ITEM-SUB)        28790099
287400                                   TO MR-VEND-DESC (PV-SUB)       28800099
287500             MOVE ASC-AD-EVNT-DTE (ASC-BLK-SUB ASC-ITEM-SUB)      28810099
287600                                   TO MR-AD-EVNT-DTE (PV-SUB)     28820099
287700         END-IF                                                   28830099
287800     END-IF.                                                      28840099
287900                                                                  28850099
288000     SUBTRACT +1 FROM ASC-ITEM-SUB.                               28860099
288100                                                                  28870099
288200     IF  ASC-ITEM-SUB < + 1                                       28880099
288300         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                28890099
288400         MOVE +1                   TO ASC-BLK-SUB                 28900099
288500     END-IF.                                                      28910099
288600                                                                  28920099
288700 4425-GET-PO-PREPK-ID.                                            28930099
288800                                                                  28940099
288900     MOVE ASC-PO-LNE-NBR (ASC-BLK-SUB ASC-ITEM-SUB) TO            28950099
289000           DK-PO-LNE-NBR.                                         28960099
289100                                                                  28970099
289200     PERFORM                                                      28980099
289300         WITH TEST AFTER                                          28990099
289400         VARYING PV-RETRY-COUNTER                                 29000099
289500         FROM 1 BY 1                                              29010099
289600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29020099
289700             OR (SQLCODE = +0)                                    29030099
289800             OR (SQLCODE = +100))                                 29040099
289900                                                                  29050099
290000         EXEC SQL                                                 29060099
290100              SELECT PO_PREPK_ID                                  29070099
290200                INTO :PURITM-PO-PREPK-ID                          29080099
290300                FROM TPURITM                                      29090099
290400                WHERE  PO_NBR         = :DK-PO-NBR                29100099
290500                  AND  PO_LNE_NBR     = :DK-PO-LNE-NBR            29110099
290600                  AND  VER_STATUS_CDE = 'A'                       29120099
290700         END-EXEC                                                 29130099
290800                                                                  29140099
290900         EVALUATE TRUE                                            29150099
291000             WHEN SQLCODE = +0                                    29160099
291100                  MOVE PURITM-PO-PREPK-ID TO                      29170099
291200                       ASC-PO-PREPK-ID (ASC-BLK-SUB ASC-ITEM-SUB) 29180099
291300             WHEN SQLCODE = +100                                  29190099
291400                  MOVE ZEROES TO                                  29200099
291500                       ASC-PO-PREPK-ID (ASC-BLK-SUB ASC-ITEM-SUB) 29210099
291600             WHEN SQLCODE = -904                                  29220099
291700             WHEN SQLCODE = -913                                  29230099
291800                  CONTINUE                                        29240099
291900                                                                  29250099
292000             WHEN SQLWARN0 NOT = SPACES                           29260099
292100             WHEN SQLCODE < +0                                    29270099
292200             WHEN SQLCODE > +0                                    29280099
292300                  MOVE '4425-GET-PO-PREPK-ID'                     29290099
292400                                  TO DP013-PARAGRAPH              29300099
292500                  MOVE 'UNSUCCESSFUL SELECT ON TPURITM'           29310099
292600                                  TO DP013-MESSAGE-TEXT (1)       29320099
292700                  MOVE SQLCA      TO DP013-SQLCA                  29330099
292800                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (1)     29340099
292900                  SET DP013-DB2-ABEND                             29350099
293000                      DP013-XCTL-DISPLAY-RESTART                  29360099
293100                                  TO TRUE                         29370099
293200                  PERFORM DP013-0000-PROCESS-ABEND                29380099
293300         END-EVALUATE                                             29390099
293400     END-PERFORM.                                                 29400099
293500                                                                  29410099
293600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        29420099
293700         MOVE '4425-GET-PO-PREPK-ID'                              29430099
293800                                  TO DP013-PARAGRAPH              29440099
293900         MOVE 'MAX RETRIES EXCEEDED ON SELECT FOR PO PREPK ID'    29450099
294000                                  TO DP013-MESSAGE-TEXT (1)       29460099
294100         MOVE SQLCA               TO DP013-SQLCA                  29470099
294200         MOVE 'TPURITM '          TO DP013-DB2-TABLE-NAME (1)     29480099
294300         SET DP013-DB2-ABEND                                      29490099
294400             DP013-XCTL-DISPLAY-RESTART                           29500099
294500                                  TO TRUE                         29510099
294600         PERFORM DP013-0000-PROCESS-ABEND                         29520099
294700     END-IF.                                                      29530099
294800*----------------------------------------------------------------*29540099
294900* DETERMINE IF LINE ITEM IS ON TWEBUPC TABLE                     *29550099
295000*----------------------------------------------------------------*29560099
295100* NOTE: TUPCPLS AND TWEBITM TABLES ARE NOT REPLACED BY LOGISTICS *29570099
295200*       DOMAIN TABLES BECAUSE OF PERFORMANCE ISSUES RELATED TO   *29580099
295300*       VIEWS XLV_SKU_STR AND XLV_WEB_SKU.                       *29590099
295400*----------------------------------------------------------------*29600099
295500 4426-CHECK-TWEBUPC.                                              29610099
295600*                                                                 29620099
295700     MOVE ASC-KEY-PO-NBR TO PURCHS-PO-NBR.                        29630099
295800     MOVE DK-PO-LNE-NBR  TO PURITM-PO-LNE-NBR.                    29640099
295900     PERFORM                                                      29650099
296000         WITH TEST AFTER                                          29660099
296100         VARYING PV-RETRY-COUNTER                                 29670099
296200         FROM 1 BY 1                                              29680099
296300         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               29690099
296400             OR (SQLCODE = +0) OR (SQLCODE = +100))               29700099
296500         EXEC SQL                                                 29710099
296600              SELECT COUNT(*)                                     29720099
296700               INTO :PV-DB2-COUNT                                 29730099
296800               FROM TWEBITM A                                     29740099
296900                   ,TUPCPLS C                                     29750099
297000                   ,TPURITM E                                     29760099
297100                   ,TPURCHS F                                     29770099
297200             WHERE F.PO_NBR = :PURCHS-PO-NBR                      29780099
297300               AND F.PO_NBR = E.PO_NBR                            29790099
297400               AND F.VER_STATUS_CDE = 'A'                         29800099
297500               AND E.VER_STATUS_CDE = 'A'                         29810099
297600               AND E.PO_LNE_NBR = :PURITM-PO-LNE-NBR              29820099
297700               AND E.ITM_NBR = C.ITM_NBR                          29830099
297800               AND C.STR_NBR = 0                                  29840099
297900               AND ((C.EFF_BEG_TMST <= CURRENT TIMESTAMP AND      29850099
298000                     C.EFF_END_TMST IS NULL) OR                   29860099
298100                    (C.EFF_BEG_TMST <= CURRENT TIMESTAMP AND      29870099
298200                     C.EFF_END_TMST > CURRENT TIMESTAMP))         29880099
298300               AND   C.UPC_ID = A.INTR_UPC_ID                     29890099
298400               AND  (A.EFF_BEG_TMST <= CURRENT TIMESTAMP          29900099
298500                       AND A.EFF_END_TMST IS NULL)                29910099
298600         END-EXEC                                                 29920099
298700         EVALUATE TRUE                                            29930099
298800             WHEN SQLCODE = +0                                    29940099
298900             WHEN SQLCODE = +100                                  29950099
299000             WHEN SQLCODE = -904                                  29960099
299100             WHEN SQLCODE = -913                                  29970099
299200                  CONTINUE                                        29980099
299300             WHEN SQLWARN0 NOT = SPACES                           29990099
299400             WHEN SQLCODE < +0                                    30000099
299500             WHEN SQLCODE > +0                                    30010099
299600                  MOVE '4426-CHECK-TWEBUPC '                      30020099
299700                                  TO DP013-PARAGRAPH              30030099
299800                  MOVE 'UNSUCCESSFUL SELECT COUNT(*)'             30040099
299900                                  TO DP013-MESSAGE-TEXT (1)       30050099
300000                  MOVE SQLCA      TO DP013-SQLCA                  30060099
300100                  MOVE 'TWEBITM ' TO DP013-DB2-TABLE-NAME (1)     30070099
300200                  MOVE 'TUPCPLS ' TO DP013-DB2-TABLE-NAME (2)     30080099
300300                  MOVE 'TPURITM ' TO DP013-DB2-TABLE-NAME (3)     30090099
300400                  MOVE 'TPURCHS ' TO DP013-DB2-TABLE-NAME (4)     30100099
300500                  SET DP013-DB2-ABEND                             30110099
300600                  DP013-XCTL-DISPLAY-RESTART                      30120099
300700                                  TO TRUE                         30130099
300800                  PERFORM DP013-0000-PROCESS-ABEND                30140099
300900         END-EVALUATE                                             30150099
301000     END-PERFORM.                                                 30160099
301100                                                                  30170099
301200     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        30180099
301300         MOVE '4426-CHECK-TWEBUPC' TO DP013-PARAGRAPH             30190099
301400         MOVE 'MAX RETRIES EXCEEDED FOR SELECT OF TWEBUPC'        30200099
301500                                   TO DP013-MESSAGE-TEXT (1)      30210099
301600         MOVE SQLCA               TO DP013-SQLCA                  30220099
301700         MOVE 'TWEBUPC '          TO DP013-DB2-TABLE-NAME (1)     30230099
301800         SET DP013-DB2-ABEND                                      30240099
301900             DP013-XCTL-DISPLAY-RESTART                           30250099
302000                                  TO TRUE                         30260099
302100         PERFORM DP013-0000-PROCESS-ABEND                         30270099
302200     END-IF.                                                      30280099
302300                                                                  30290099
302400                                                                  30300099
302500*----------------------------------------------------------------*30310099
302600*  IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF    *30320099
302700*  RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,       *30330099
302800*  ISSUE A WARNING.                                              *30340099
302900*----------------------------------------------------------------*30350099
303000 4430-CHECK-FOR-BEGIN-AND-END.                                    30360099
303100                                                                  30370099
303200     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       30380099
303300         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     30390099
303400*            -- NO END-OF-RANGE SPECFIED ---                      30400099
303500             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            30410099
303600             SET DP020-MSG-WARNING TO TRUE                        30420099
303700             PERFORM 4431-POSITION-AT-WARNING                     30430099
303800         END-IF                                                   30440099
303900     ELSE                                                         30450099
304000         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     30460099
304100*            -- NO BEGINNING-OF-RANGE SPECFIED ---                30470099
304200             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            30480099
304300             SET DP020-MSG-WARNING TO TRUE                        30490099
304400             PERFORM 4431-POSITION-AT-WARNING                     30500099
304500         END-IF                                                   30510099
304600     END-IF.                                                      30520099
304700                                                                  30530099
304800*----------------------------------------------------------------*30540099
304900*  ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,   *30550099
305000*  DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE    *30560099
305100*  IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND         *30570099
305200*  POSITION THE CURSOR THERE.                                    *30580099
305300*----------------------------------------------------------------*30590099
305400 4431-POSITION-AT-WARNING.                                        30600099
305500                                                                  30610099
305600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 30620099
305700                    - PV-TOP-ITEM + 1.                            30630099
305800                                                                  30640099
305900     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30650099
306000         CONTINUE                                                 30660099
306100     ELSE                                                         30670099
306200         SET DP030-SET-CURSOR-APPL-1                              30680099
306300                                   TO TRUE                        30690099
306400         MOVE -1                   TO MR-SELECTL (PV-SUB)         30700099
306500         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30710099
306600         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30720099
306700     END-IF.                                                      30730099
306800                                                                  30740099
306900     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   30750099
307000                    - PV-TOP-ITEM + 1.                            30760099
307100                                                                  30770099
307200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      30780099
307300         CONTINUE                                                 30790099
307400     ELSE                                                         30800099
307500         SET DP030-SET-CURSOR-APPL-1                              30810099
307600                                   TO TRUE                        30820099
307700         MOVE -1                   TO MR-SELECTL (PV-SUB)         30830099
307800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         30840099
307900         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         30850099
308000     END-IF.                                                      30860099
308100                                                                  30870099
308200/                                                                 30880099
308300*----------------------------------------------------------------*30890099
308400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *30900099
308500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *30910099
308600* FOR THE SELECTED ITEMS QUEUE.                                  *30920099
308700*                                                                *30930099
308800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *30940099
308900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *30950099
309000* THE ARRAY IS FULL.                                             *30960099
309100*----------------------------------------------------------------*30970099
309200                                                                  30980099
309300 5000-PREPARE-SEL-QUEUE.                                          30990099
309400                                                                  31000099
309500     MOVE +1                       TO ASC-BLK-SUB.                31010099
309600     PERFORM 5100-WRITE-TEMP-STORAGE.                             31020099
309700     ADD +1                        TO ASC-BLK-SUB.                31030099
309800     PERFORM 5100-WRITE-TEMP-STORAGE.                             31040099
309900                                                                  31050099
310000     MOVE ASC-SEL-QUEUE-NAME       TO PO013-SEL-QUEUE-NAME.       31060099
310100     PERFORM 6010-DELETE-SEL-QUEUE.                               31070099
310200                                                                  31080099
310300     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO                      31090099
310400         SET ASC-UPDATE-TSQ        TO TRUE                        31100099
310500     END-IF.                                                      31110099
310600                                                                  31120099
310700     SET PO012-IDX                 TO 1.                          31130099
310800     MOVE ZERO                     TO PO013-NUMBER-OF-TS-ITEMS.   31140099
310900     INITIALIZE PO012-SELECTED-ITEM-ARRAY.                        31150099
311000                                                                  31160099
311100     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           31170099
311200             VARYING PV-ITEM                                      31180099
311300             FROM 1 BY 1                                          31190099
311400             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     31200099
311500                                                                  31210099
311600     IF  PO012-IDX > 1                                            31220099
311700         PERFORM 5205-WRITE-SEL-QUEUE                             31230099
311800         ADD +1                    TO PO013-NUMBER-OF-TS-ITEMS    31240099
311900     END-IF.                                                      31250099
312000                                                                  31260099
312100/                                                                 31270099
312200*----------------------------------------------------------------*31280099
312300*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *31290099
312400*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *31300099
312500*----------------------------------------------------------------*31310099
312600                                                                  31320099
312700 5100-WRITE-TEMP-STORAGE.                                         31330099
312800                                                                  31340099
312900     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     31350099
313000                                   TO PV-LIST-ITEM-NUMBER.        31360099
313100     COMPUTE PV-BLOCK-NUMBER =                                    31370099
313200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    31380099
313300                                                                  31390099
313400     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             31400099
313500     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             31410099
313600         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      31420099
313700             PERFORM 5105-REWRITE-ASC-LISTQ                       31430099
313800         END-IF                                                   31440099
313900     ELSE                                                         31450099
314000         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       31460099
314100         ASC-HIGHEST-BLOCK-WRITTEN + 1                            31470099
314200         PERFORM 5110-WRITE-ASC-LISTQ                             31480099
314300         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   31490099
314400     END-IF.                                                      31500099
314500                                                                  31510099
314600     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)                      31520099
314700                                   TO TRUE.                       31530099
314800                                                                  31540099
314900/                                                                 31550099
315000*----------------------------------------------------------------*31560099
315100*  REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-     *31570099
315200*  SPECIFIC COMMAREA.                                            *31580099
315300*----------------------------------------------------------------*31590099
315400 5105-REWRITE-ASC-LISTQ.                                          31600099
315500                                                                  31610099
315600     EXEC CICS                                                    31620099
315700         WRITEQ TS                                                31630099
315800             QUEUE (ASC-LIST-QUEUE-NAME)                          31640099
315900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31650099
316000             ITEM  (PV-BLOCK-NUMBER)                              31660099
316100             REWRITE                                              31670099
316200             RESP  (PV-CICS-RESP)                                 31680099
316300     END-EXEC.                                                    31690099
316400                                                                  31700099
316500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           31710099
316600         CONTINUE                                                 31720099
316700     ELSE                                                         31730099
316800         SET DP013-CICS-ABEND      TO TRUE                        31740099
316900         SET DP013-NO-ROLLBACK     TO TRUE                        31750099
317000         MOVE '5105-REWRITE-ASC-LISTQ'                            31760099
317100                                   TO DP013-PARAGRAPH             31770099
317200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     31780099
317300                                   TO DP013-MESSAGE-TEXT(1)       31790099
317400         PERFORM DP013-0000-PROCESS-ABEND                         31800099
317500     END-IF.                                                      31810099
317600                                                                  31820099
317700/                                                                 31830099
317800*----------------------------------------------------------------*31840099
317900*  WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-       *31850099
318000*  SPECIFIC COMMAREA.                                            *31860099
318100*----------------------------------------------------------------*31870099
318200 5110-WRITE-ASC-LISTQ.                                            31880099
318300                                                                  31890099
318400     EXEC CICS                                                    31900099
318500         WRITEQ TS                                                31910099
318600             QUEUE (ASC-LIST-QUEUE-NAME)                          31920099
318700             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               31930099
318800             ITEM  (PV-BLOCK-NUMBER)                              31940099
318900             RESP  (PV-CICS-RESP)                                 31950099
319000     END-EXEC.                                                    31960099
319100                                                                  31970099
319200     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      31980099
319300         SET DP013-CICS-ABEND      TO TRUE                        31990099
319400         SET DP013-NO-ROLLBACK     TO TRUE                        32000099
319500         MOVE '5110-WRITE-ASC-LISTQ'                              32010099
319600                                   TO DP013-PARAGRAPH             32020099
319700         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           32030099
319800                                   TO DP013-MESSAGE-TEXT(1)       32040099
319900         PERFORM DP013-0000-PROCESS-ABEND                         32050099
320000     END-IF.                                                      32060099
320100                                                                  32070099
320200/                                                                 32080099
320300*----------------------------------------------------------------*32090099
320400* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *32100099
320500* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *32110099
320600*----------------------------------------------------------------*32120099
320700                                                                  32130099
320800 5200-FILL-SEL-QUEUE-RECORD.                                      32140099
320900                                                                  32150099
321000     PERFORM 6112-READ-LIST-QUEUE.                                32160099
321100                                                                  32170099
321200     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       32180099
321300         PERFORM                                                  32190099
321400         VARYING LQW-IDX                                          32200099
321500         FROM 1 BY 1                                              32210099
321600         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            32220099
321700           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          32230099
321800                                                                  32240099
321900             IF  LQW-SELECT (LQW-IDX)                             32250099
322000                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              32260099
322100                                   TO PO012-ITEM (PO012-IDX)      32270099
322200                 MOVE LQW-PO-LNE-NBR (LQW-IDX)                    32280099
322300                           TO PO012-PO-LNE-NBR (PO012-IDX)        32290099
322400                              PO013-PO-LNE-NBR                    32300099
322500                 MOVE LQW-APP-PO-LNE-NBR (LQW-IDX)                32310099
322600                           TO PO012-APP-PO-LNE-NBR (PO012-IDX)    32320099
322700                 MOVE LQW-PO-LNE-VAR-NBR (LQW-IDX)                32330099
322800                           TO PO012-PO-LNE-VAR-NBR (PO012-IDX)    32340099
322900                 MOVE 'I'          TO PO012-ACTION-SW (PO012-IDX) 32350099
323000                 SET PO012-IDX UP BY 1                            32360099
323100                 IF  PO012-IDX > PO012-MAX-ITEMS                  32370099
323200                     PERFORM 5205-WRITE-SEL-QUEUE                 32380099
323300                     ADD +1        TO PO013-NUMBER-OF-TS-ITEMS    32390099
323400                     INITIALIZE PO012-SELECTED-ITEM-ARRAY         32400099
323500                     SET PO012-IDX TO 1                           32410099
323600                 END-IF                                           32420099
323700             END-IF                                               32430099
323800         END-PERFORM                                              32440099
323900     END-IF.                                                      32450099
324000                                                                  32460099
324100/                                                                 32470099
324200*----------------------------------------------------------------*32480099
324300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *32490099
324400*----------------------------------------------------------------*32500099
324500                                                                  32510099
324600 5205-WRITE-SEL-QUEUE.                                            32520099
324700                                                                  32530099
324800     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            32540099
324900                                   TO PO012-SELECTED-ITEMS.       32550099
325000                                                                  32560099
325100     EXEC CICS                                                    32570099
325200          WRITEQ TS                                               32580099
325300              QUEUE (ASC-SEL-QUEUE-NAME)                          32590099
325400              FROM  (PO012-PO-SELECT-RECORD)                      32600099
325500              ITEM  (PV-SEL-QUEUE-ITEM)                           32610099
325600              RESP  (PV-CICS-RESP)                                32620099
325700     END-EXEC.                                                    32630099
325800                                                                  32640099
325900     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          32650099
326000         CONTINUE                                                 32660099
326100     ELSE                                                         32670099
326200         SET DP013-CICS-ABEND      TO TRUE                        32680099
326300         SET DP013-NO-ROLLBACK     TO TRUE                        32690099
326400         MOVE '5205-WRITE-SEL-QUEUE'                              32700099
326500                                   TO DP013-PARAGRAPH             32710099
326600         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          32720099
326700                                   TO DP013-MESSAGE-TEXT(1)       32730099
326800         PERFORM DP013-0000-PROCESS-ABEND                         32740099
326900     END-IF.                                                      32750099
327000                                                                  32760099
327100/                                                                 32770099
327200*----------------------------------------------------------------*32780099
327300*  WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION,  *32790099
327400*  SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT  *32800099
327500*  THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO     *32810099
327600*  THE USER.                                                     *32820099
327700*----------------------------------------------------------------*32830099
327800 6000-REFRESH-PANEL-FROM-TEMP.                                    32840099
327900                                                                  32850099
328000     IF  ASC-UPDATE-TSQ                                           32860099
328100         SET ASC-NO-TSQ-UPDATE     TO TRUE                        32870099
328200         MOVE ZERO                 TO PV-SAVE-ITEM                32880099
328300                                      PV-SEL-QUEUE-ITEM           32890099
328400         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        32900099
328500                                   TO PV-HOLD-SELECTED-ITEMS      32910099
328600            PERFORM 6100-UPDATE-TSQ                               32920099
328700                UNTIL PV-ITEMS-PROCESSED >                        32930099
328800                                      ASC-NUMBER-OF-SELECTED-ITEMS32940099
328900         PERFORM 6010-DELETE-SEL-QUEUE                            32950099
329000         INITIALIZE ASC-BLOCK-ENTRIES (1)                         32960099
329100                    ASC-BLOCK-ENTRIES (2)                         32970099
329200     END-IF.                                                      32980099
329300                                                                  32990099
329400/                                                                 33000099
329500*----------------------------------------------------------------*33010099
329600*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *33020099
329700*----------------------------------------------------------------*33030099
329800 6010-DELETE-SEL-QUEUE.                                           33040099
329900                                                                  33050099
330000     EXEC CICS                                                    33060099
330100         DELETEQ TS                                               33070099
330200             QUEUE (ASC-SEL-QUEUE-NAME)                           33080099
330300             RESP  (PV-CICS-RESP)                                 33090099
330400     END-EXEC.                                                    33100099
330500                                                                  33110099
330600     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      33120099
330700         (PV-CICS-RESP = DFHRESP(QIDERR)))                        33130099
330800         CONTINUE                                                 33140099
330900     ELSE                                                         33150099
331000         SET DP013-CICS-ABEND      TO TRUE                        33160099
331100         SET DP013-NO-ROLLBACK     TO TRUE                        33170099
331200         MOVE '6010-DELETE-SEL-QUEUE'                             33180099
331300                                   TO DP013-PARAGRAPH             33190099
331400         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         33200099
331500                                   TO DP013-MESSAGE-TEXT (1)      33210099
331600         PERFORM DP013-0000-PROCESS-ABEND                         33220099
331700     END-IF.                                                      33230099
331800                                                                  33240099
331900/                                                                 33250099
332000*----------------------------------------------------------------*33260099
332100*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *33270099
332200*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *33280099
332300*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *33290099
332400*    THE TEMP QUEUE.                                             *33300099
332500*----------------------------------------------------------------*33310099
332600                                                                  33320099
332700 6100-UPDATE-TSQ.                                                 33330099
332800                                                                  33340099
332900     ADD 1                         TO PV-SEL-QUEUE-ITEM.          33350099
333000     PERFORM 6105-READ-SEL-QUEUE.                                 33360099
333100                                                                  33370099
333200     PERFORM                                                      33380099
333300         VARYING PO012-IDX                                        33390099
333400         FROM 1 BY 1                                              33400099
333500         UNTIL ((PV-ITEMS-PROCESSED >                             33410099
333600                              PV-HOLD-SELECTED-ITEMS)             33420099
333700         OR (PO012-IDX GREATER THAN PO012-MAX-ITEMS))             33430099
333800         IF  PO012-ACTION-SW (PO012-IDX) > SPACE                  33440099
333900             PERFORM 6110-PROCESS-ITEMS                           33450099
334000         END-IF                                                   33460099
334100         ADD +1                    TO PV-ITEMS-PROCESSED          33470099
334200     END-PERFORM.                                                 33480099
334300                                                                  33490099
334400     PERFORM 6111-WRITE-LIST-QUEUE.                               33500099
334500/                                                                 33510099
334600*----------------------------------------------------------------*33520099
334700*    READ THE LIST QUEUE RECORD.                                 *33530099
334800*----------------------------------------------------------------*33540099
334900                                                                  33550099
335000 6105-READ-SEL-QUEUE.                                             33560099
335100                                                                  33570099
335200     EXEC CICS                                                    33580099
335300          READQ TS                                                33590099
335400              QUEUE (ASC-SEL-QUEUE-NAME)                          33600099
335500              INTO  (PO012-PO-SELECT-RECORD)                      33610099
335600              ITEM  (PV-SEL-QUEUE-ITEM)                           33620099
335700              RESP  (PV-CICS-RESP)                                33630099
335800     END-EXEC.                                                    33640099
335900                                                                  33650099
336000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          33660099
336100         CONTINUE                                                 33670099
336200     ELSE                                                         33680099
336300         SET DP013-CICS-ABEND      TO TRUE                        33690099
336400         SET DP013-NO-ROLLBACK     TO TRUE                        33700099
336500         MOVE '6105-READ-SEL-QUEUE'                               33710099
336600                                   TO DP013-PARAGRAPH             33720099
336700         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           33730099
336800                                   TO DP013-MESSAGE-TEXT(1)       33740099
336900         PERFORM DP013-0000-PROCESS-ABEND                         33750099
337000     END-IF.                                                      33760099
337100                                                                  33770099
337200/                                                                 33780099
337300*----------------------------------------------------------------*33790099
337400*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*33800099
337500*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*33810099
337600*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *33820099
337700*----------------------------------------------------------------*33830099
337800                                                                  33840099
337900 6110-PROCESS-ITEMS.                                              33850099
338000                                                                  33860099
338100     COMPUTE PV-ITEM = 1 + ((PO012-ITEM (PO012-IDX) - 1)          33870099
338200                     / PC-ITEMS-PER-PANEL).                       33880099
338300                                                                  33890099
338400     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           33900099
338500         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          33910099
338600             PERFORM 6111-WRITE-LIST-QUEUE                        33920099
338700         END-IF                                                   33930099
338800         MOVE PV-ITEM              TO PV-SAVE-ITEM                33940099
338900                                                                  33950099
339000         PERFORM 6112-READ-LIST-QUEUE                             33960099
339100         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               33970099
339200             CONTINUE                                             33980099
339300         END-IF                                                   33990099
339400     END-IF.                                                      34000099
339500                                                                  34010099
339600     COMPUTE PV-SUB = (PO012-ITEM (PO012-IDX)                     34020099
339700                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              34030099
339800                                                                  34040099
339900     SET LQW-DESELECT (PV-SUB)     TO TRUE.                       34050099
340000     MOVE LQW-SELECTED-SW (PV-SUB) TO LQW-TEMP-SELECTED-SW        34060099
340100                                     (PV-SUB).                    34070099
340200     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                34080099
340300                                                                  34090099
340400/                                                                 34100099
340500*----------------------------------------------------------------*34110099
340600*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *34120099
340700*----------------------------------------------------------------*34130099
340800                                                                  34140099
340900 6111-WRITE-LIST-QUEUE.                                           34150099
341000                                                                  34160099
341100     EXEC CICS                                                    34170099
341200         WRITEQ TS                                                34180099
341300             QUEUE (ASC-LIST-QUEUE-NAME)                          34190099
341400             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     34200099
341500             ITEM  (PV-SAVE-ITEM)                                 34210099
341600             REWRITE                                              34220099
341700             RESP  (PV-CICS-RESP)                                 34230099
341800     END-EXEC.                                                    34240099
341900                                                                  34250099
342000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34260099
342100         CONTINUE                                                 34270099
342200     ELSE                                                         34280099
342300         SET DP013-CICS-ABEND      TO TRUE                        34290099
342400         SET DP013-NO-ROLLBACK     TO TRUE                        34300099
342500         MOVE '6111-WRITE-LIST-QUEUE'                             34310099
342600                                   TO DP013-PARAGRAPH             34320099
342700         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  34330099
342800                                   TO DP013-MESSAGE-TEXT(1)       34340099
342900         PERFORM DP013-0000-PROCESS-ABEND                         34350099
343000     END-IF.                                                      34360099
343100                                                                  34370099
343200/                                                                 34380099
343300*----------------------------------------------------------------*34390099
343400*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*34400099
343500*----------------------------------------------------------------*34410099
343600                                                                  34420099
343700 6112-READ-LIST-QUEUE.                                            34430099
343800                                                                  34440099
343900     EXEC CICS                                                    34450099
344000         READQ TS                                                 34460099
344100             QUEUE (ASC-LIST-QUEUE-NAME)                          34470099
344200             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     34480099
344300             ITEM  (PV-ITEM)                                      34490099
344400             RESP  (PV-CICS-RESP)                                 34500099
344500     END-EXEC.                                                    34510099
344600                                                                  34520099
344700     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          34530099
344800         CONTINUE                                                 34540099
344900     ELSE                                                         34550099
345000         SET DP013-CICS-ABEND      TO TRUE                        34560099
345100         SET DP013-NO-ROLLBACK     TO TRUE                        34570099
345200         MOVE '6112-READ-LIST-QUEUE'                              34580099
345300                                   TO DP013-PARAGRAPH             34590099
345400         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    34600099
345500                                   TO DP013-MESSAGE-TEXT(1)       34610099
345600         PERFORM DP013-0000-PROCESS-ABEND                         34620099
345700     END-IF.                                                      34630099
345800                                                                  34640099
345900/                                                                 34650099
346000*----------------------------------------------------------------*34660099
346100*    ABEND PROCESSOR MODULE                                      *34670099
346200*----------------------------------------------------------------*34680099
346300                                                                  34690099
346400     COPY DPPD013.                                                34700099
