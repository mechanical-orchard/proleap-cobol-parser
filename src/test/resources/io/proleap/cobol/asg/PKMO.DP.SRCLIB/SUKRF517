000100******************************************************************00010000
000200 IDENTIFICATION DIVISION.                                         00020000
000300******************************************************************00030000
000400                                                                  00040000
000500 PROGRAM-ID.             SUKRF517.                                00050000
000600 AUTHOR.                 MICHAEL WALTERS.                         00060000
000700 INSTALLATION.           KOHLS.                                   00070000
000800 DATE-WRITTEN            SEPTEMBER, 1997.                         00080000
000900 DATE-COMPILED.                                                   00090000
001000                                                                  00100000
001100******************************************************************00110000
001200* THIS PROGRAM DISPLAYS THE TICKET NO MATCH SCREEN WHICH WILL     00120000
001300* ALLOW THE USER TO ENTER DATA THAT IS ON THE TICKET, BUT DOESN'T 00130000
001400* MATCH THE SYSTEM DATA                                           00140000
001500******************************************************************00150000
001600                                                                  00160000
001700******************************************************************00170000
001800 ENVIRONMENT DIVISION.                                            00180000
001900******************************************************************00190000
002000                                                                  00200000
002100******************************************************************00210000
002200 DATA DIVISION.                                                   00220000
002300******************************************************************00230000
002400                                                                  00240000
002500******************************************************************00250000
002600 WORKING-STORAGE SECTION.                                         00260000
002700******************************************************************00270000
002800 01 CA-COMMAREA.                                                  00280000
002900     COPY SUWS006.                                                00290008
003000* * * * * * * * * * * *  PLEASE NOTE * * * * * * * * * * * *      00300000
003100* THE COMMAREA FROM HERE....                                      00310000
003200    05 CA-SUKRF513-COMMAREA.                                      00320000
003300       10 FILLER                            PIC X(35).            00330000
003400       10 CA-SYSTEM-RETAIL-X                PIC X(08).            00340000
003500       10 CA-SYSTEM-RETAIL        REDEFINES CA-SYSTEM-RETAIL-X    00341000
003600                                            PIC ZZZZ9.99.         00342000
003700                                                                  00343000
003800       10 CA-SYSTEM-SKU-DESC                PIC X(19).            00344000
003900       10 CA-SYSTEM-COLOR                   PIC X(10).            00345000
004000       10 CA-SYSTEM-SIZE                    PIC X(10).            00346000
004100       10 CA-SYSTEM-STYLE                   PIC X(19).            00347000
004200* ... TO HERE IS COPIED FROM SUKRF513, AND IS THEN SENT ALONG TO  00348000
004300* SUKRF522 AND SUKRF524                                           00349000
004400*     -- ANY CHANGED TO THIS AREA IN ANY OF THE PROGRAM MUST      00350000
004500* BE COPIED TO ALL THREE                                          00360000
004600    05 CA-PROGRAM-COMMAREA.                                       00370000
004700       10 CA-SCREEN-FIELDS.                                       00380000
004800          15 CA-SCRN-RETAIL-X              PIC X(08).             00390000
004900          15 CA-SCRN-RETAIL      REDEFINES CA-SCRN-RETAIL-X       00400000
005000                                           PIC ZZZZ9.99.          00410000
005100          15 CA-SCRN-RETAIL-INT  REDEFINES CA-SCRN-RETAIL-X       00420000
005200                                           PIC 9(08).             00430000
005300                                                                  00440000
005400          15 CA-SCRN-COLOR                 PIC X(10).             00450000
005500          15 CA-SCRN-SIZE                  PIC X(10).             00460000
005600          15 CA-SCRN-SKU-X.                                       00470000
005700             20 CA-SCRN-DEPT-X             PIC X(03).             00480000
005800             20 FILLER                     PIC X(1) VALUE '-'.    00490000
005900             20 CA-SCRN-MAJ-CLS-X          PIC X(02).             00500001
006000             20 FILLER                     PIC X(1) VALUE '-'.    00510000
006100             20 CA-SCRN-SUB-CLS-X          PIC X(02).             00520001
006200          15 CA-SCRN-SKU         REDEFINES CA-SCRN-SKU-X.         00530000
006300             20 CA-SCRN-DEPT               PIC 9(03).             00540000
006400             20 FILLER                     PIC X(1).              00550000
006500             20 CA-SCRN-MAJ-CLASS          PIC 9(02).             00560001
006600             20 FILLER                     PIC X(1).              00570000
006700             20 CA-SCRN-SUB-CLASS          PIC 9(02).             00580001
006800          15 CA-SCRN-STYLE                 PIC X(12).             00590000
006900*                                                                 00600000
007000 01  PS-PROGRAM-SWITCHES.                                         00610007
007100     05  PS-DATABASE-CONTENTION-SW       PIC  X(01)  VALUE 'N'.   00620007
007200         88  PS-DATABASE-CONTENTION-NO               VALUE 'N'.   00620107
007300         88  PS-DATABASE-CONTENTION-YES              VALUE 'Y'.   00620207
007400     05  PS-BLACKOUT-SW                  PIC X(01)  VALUE 'N'.    00620308
007500         88  PS-BLACKOUT-YES                        VALUE 'Y'.    00620408
007600         88  PS-BLACKOUT-NO                         VALUE 'N'.    00620508
007700                                                                  00620608
007800*                                                                 00621007
007900 01  PC-PROGRAM-CONSTANTS.                                        00622007
008000     05  PC-CARTON-AUDIT-GROUP-CODE      PIC  X(03)  VALUE 'VA'.  00623007
008100     05  PC-TKT-ERR-DPT-VILN-SEQ         PIC S9(04)  VALUE 13     00630000
008200                                                     COMP.        00631000
008300     05  PC-TKT-ERR-CLASS-VILN-SEQ       PIC S9(04)  VALUE 21     00632000
008400                                                     COMP.        00633000
008500     05  PC-TKT-ERR-SKU-VILN-SEQ         PIC S9(04)  VALUE 22     00634000
008600                                                     COMP.        00635000
008700     05  PC-TKT-ERR-RETAIL-VILN-SEQ      PIC S9(04)  VALUE 14     00636000
008800                                                     COMP.        00637000
008900     05  PC-TKT-ERR-COLOR-VILN-SEQ       PIC S9(04)  VALUE 15     00638000
009000                                                     COMP.        00639000
009100     05  PC-TKT-ERR-SIZE-VILNE-SEQ       PIC S9(04)  VALUE 16     00640000
009200                                                     COMP.        00650000
009300     05  PC-TKT-ERR-STYLE-VILN-SEQ       PIC S9(04)  VALUE 24     00660000
009400                                                     COMP.        00670000
009500     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00680000
009600         'SUKRF517'.                                              00690000
009700     05  PC-MDSE-NO-MATCH-SCREEN         PIC  X(08)  VALUE        00700000
009800         'SUKRF522'.                                              00710000
009900     05  PC-TKT-EXCEPTION-SCREEN         PIC  X(08)  VALUE        00720000
010000         'SUKRF524'.                                              00730000
010100     05  PC-UPC-SCAN-PROGRAM             PIC  X(08)  VALUE        00740000
010200         'SUKRF518'.                                              00740100
010300     05  PC-UPC-KEY-QTY-PROGRAM          PIC  X(08)  VALUE        00740200
010400         'SUKRF537'.                                              00740300
010500     05  PC-CURRENT-TRANID               PIC  X(04)  VALUE 'S517'.00740400
010600     05  PC-TRANS-UNAVAILABLE-MSG   PIC X(19) VALUE               00740503
010700                                           'TRANS NOT AVAILABLE'. 00740603
010800                                                                  00740700
010900 01  PV-PROGRAM-VARIABLES.                                        00740800
011000     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE ZERO   00740900
011100                                                     COMP SYNC.   00741000
011200     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00741100
011300                                                     COMP SYNC.   00741200
011400     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00742000
011500     05  PV-DECIMAL-COUNT                PIC S9(04)  VALUE ZERO   00743000
011600                                                     COMP.        00744000
011700     05  PV-DISPLAY-KEYS.                                         00745000
011800         10 FILLER                       PIC X(12)                00746000
011900            VALUE 'KEY VALUES: '.                                 00747000
012000         10 PV-DISP-AUD-CNTL-NBR         PIC 9(09).               00748000
012100         10 FILLER                       PIC X(04)                00749000
012200            VALUE ' -- '.                                         00750000
012300         10 PV-DISP-SHIPT-UNT-ID         PIC 9(18).               00760000
012400         10 FILLER                       PIC X(04)                00770000
012500            VALUE ' -- '.                                         00780000
012600         10 PV-DISP-UPC-NBR              PIC 9(15).               00790000
012700         10 FILLER                       PIC X(04)                00800000
012800            VALUE ' -- '.                                         00810000
012900         10 PV-DISP-SCN-TMST             PIC X(26).               00820000
013000     05  PV-SHORT-STYLE                  PIC X(12).               00830000
013100                                                                  00830100
013200 01  DK-DB2-KEYS.                                                 00830200
013300     05  DK-UPC-NUMBER                   PIC S9(15) COMP-3.       00830300
013400*                                                                 00830400
013500******************************************************************00830500
013600*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      00830600
013700******************************************************************00830700
013800     COPY DFHAID.                                                 00830800
013900                                                                  00830900
014000                                                                  00831000
014100******************************************************************00832000
014200*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA                00833000
014300******************************************************************00834000
014400     COPY DPWS013.                                                00835008
014500                                                                  00836000
014600******************************************************************00837000
014700*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 00838000
014800*****************************************************************.00839000
014900     COPY DPWS010I.                                               00840008
015000                                                                  00850000
015100******************************************************************00860000
015200*  GENERATED DSECT FOR THE SUKM517 MAPSET                         00870000
015300******************************************************************00880000
015400     COPY SUKM517.                                                00890008
015500                                                                  00900000
015600******************************************************************00910000
015700*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   00920000
015800******************************************************************00930000
015900     COPY DPWS015.                                                00940008
016000                                                                  00950000
016100*----------------------------------------------------------------*00951003
016200* HELP SCREEN COMMAREA                                            00952003
016300     COPY PCWS192.                                                00953003
016400*----------------------------------------------------------------*00954003
016500* HELP SCREEN WORK AREA                                           00955003
016600     COPY PCWS188.                                                00956003
016700                                                                  00957003
016800******************************************************************00960000
016900*  COPY BOOK CONTAINING ERROR/WARNING/INFORMATIONAL MESSAGES      00970000
017000*  TO BE DISPLAYED ON THE LRT                                     00980000
017100******************************************************************00990000
017200     COPY SUWS005.                                                01000008
017300                                                                  01010000
017400******************************************************************01020000
017500*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT AUDIT01030000
017600*  TABLE (TSUATRN)                                                01040000
017700******************************************************************01050000
017800     EXEC SQL                                                     01060000
017900         INCLUDE TSUATRN                                          01070000
018000     END-EXEC.                                                    01080000
018100                                                                  01090000
018200******************************************************************01100000
018300*  DCLGEN LAYOUT AND COBOL DECLARATION FOR THE SHIPPING UNIT      01110000
018400*  CONTENT AUDIT TABLE (TSUEXCP)                                  01120000
018500******************************************************************01130000
018600     EXEC SQL                                                     01140000
018700         INCLUDE TSUEXCP                                          01150000
018800     END-EXEC.                                                    01160000
018900                                                                  01170000
019000     EXEC SQL                                                     01180000
019100         INCLUDE TSUAUPC                                          01190000
019200     END-EXEC.                                                    01200000
019300                                                                  01210000
019400*  DCLGEN FOR THE XLT_UPC TABLE                                   01211005
019500     EXEC SQL                                                     01212005
019600         INCLUDE XLT00006                                         01213005
019700     END-EXEC.                                                    01214005
019800                                                                  01215005
019900     EXEC SQL                                                     01220000
020000         INCLUDE TUPC                                             01230000
020100     END-EXEC.                                                    01240000
020200                                                                  01250000
020300     EXEC SQL                                                     01260000
020400         INCLUDE TUPCSKU                                          01270000
020500     END-EXEC.                                                    01280000
020600                                                                  03070022
020700*  WST_INTGRTN_TYP                                                03030022
020800     EXEC SQL                                                     03040022
020900         INCLUDE WST00008                                         03050022
021000     END-EXEC.                                                    03060022
021100                                                                  03070022
021200*  WST_ATTR_DEFN                                                  03030022
021300     EXEC SQL                                                     03040022
021400         INCLUDE WST00009                                         03050022
021500     END-EXEC.                                                    03060022
021600                                                                  03070022
021700*  WST_ATTR_ELEM                                                  03030022
021800     EXEC SQL                                                     03040022
021900         INCLUDE WST00010                                         03050022
022000     END-EXEC.                                                    03060022
022100                                                                  03070022
022200******************************************************************01300000
022300*  COMMUNICATIONS AREA FOR DB2                                    01310000
022400******************************************************************01320000
022500     EXEC SQL                                                     01330000
022600         INCLUDE SQLCA                                            01340000
022700     END-EXEC.                                                    01350000
022800                                                                  01360000
022900                                                                  01370000
023000                                                                  01380000
023100******************************************************************01390000
023200 LINKAGE SECTION.                                                 01400000
023300******************************************************************01410000
023400 01  DFHCOMMAREA.                                                 01420000
023500     05  FILLER                         OCCURS  1 TO 4072 TIMES   01430000
023600                                        DEPENDING ON EIBCALEN.    01440000
023700         10  FILLER                     PIC X.                    01450000
023800                                                                  01460000
023900                                                                  01470000
024000******************************************************************01480000
024100 PROCEDURE DIVISION.                                              01490000
024200******************************************************************01500000
024300 0000-PROGRAM-MAINLINE.                                           01510000
024400     MOVE DFHCOMMAREA  TO  CA-COMMAREA.                           01520000
024500     MOVE LOW-VALUES   TO  SU517AI.                               01530000
024600                                                                  01540000
024700     EVALUATE TRUE                                                01550000
024800****************************************************************  01551004
024900* DPKRF278 IS THE PGM FOR THE HELP SCREEN.                        01552004
025000****************************************************************  01553004
025100         WHEN EIBTRNID = 'Z278'                                   01554004
025200             MOVE DFHCOMMAREA          TO PC192-COMMAREA          01555004
025300             MOVE PC192-HOST-SAVE-AREA TO CA-COMMAREA             01556004
025400             SET SU006-PROCESS-SCREEN  TO TRUE                    01557004
025500             PERFORM 1000-SETUP-SCREEN                            01558004
025600             PERFORM 8000-SEND-MAP                                01559004
025700             PERFORM 8200-RETURN-TRANID                           01559104
025800                                                                  01559204
025900         WHEN EIBCALEN = ZERO                                     01560000
026000         WHEN EIBAID = DFHCLEAR                                   01570000
026100         WHEN SU006-INITIALIZE-SCREEN                             01580000
026200             SET SU006-PROCESS-SCREEN TO TRUE                     01590000
026300             PERFORM 1000-SETUP-SCREEN                            01600000
026400                                                                  01610000
026500             PERFORM 8000-SEND-MAP                                01620000
026600             PERFORM 8200-RETURN-TRANID                           01630000
026700                                                                  01640000
026800         WHEN EIBAID = DFHENTER                                   01650000
026900             PERFORM 1200-RECEIVE-MAP                             01660000
027000             PERFORM 1300-EDIT-SELECTION                          01670000
027100                                                                  01680000
027200             MOVE SU006-SHIP-UNIT-NBR-X TO AMSGLNO                01690000
027300                                                                  01700000
027400*        THE CONTINUE KEY WAS PRESSED...GET ANY CHANGES FROM THE  01710000
027500*        SCREEN, CREATE THE APPROPRIATE EXCEPTION AND CONTINUE TO 01720000
027600*        MERCHANDISE NO MATCH SCREEN                              01730000
027700         WHEN EIBAID = DFHPF2                                     01740000
027800             PERFORM 1200-RECEIVE-MAP                             01750000
027900             PERFORM 1300-EDIT-SELECTION                          01760000
028000                                                                  01770000
028100             PERFORM 1500-CHECK-EXCEPTIONS                        01780000
028200                                                                  01790000
028300             MOVE PC-MDSE-NO-MATCH-SCREEN                         01800000
028400                                        TO  PV-TRANSFER-PROGRAM   01810000
028500             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                01820000
028600                                                                  01830000
028700         WHEN EIBAID = DFHPF3                                     01840000
028800             IF SU006-BULK-CSPK-PKGNG-CDE                         01850000
028900                MOVE PC-UPC-KEY-QTY-PROGRAM                       01860000
029000                                      TO  PV-TRANSFER-PROGRAM     01870000
029100                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             01880000
029200             ELSE                                                 01890000
029300                MOVE PC-UPC-SCAN-PROGRAM                          01900000
029400                                      TO  PV-TRANSFER-PROGRAM     01910000
029500                PERFORM 2100-XCTL-TO-SELECTED-PROGRAM             01920000
029600             END-IF                                               01920100
029700*        THE TICKET ERROR KEY WAS PRESSED... GET ANY CHANGED FROM 01920200
029800*        THE SCREEN, CREATE THE APPROPRIATE EXCEPTIONS AND CONT.  01920300
029900*        TO THE TICKET EXCEPTION SCREEN                           01920400
030000         WHEN EIBAID = DFHPF9                                     01920500
030100             PERFORM 1200-RECEIVE-MAP                             01920600
030200             PERFORM 1300-EDIT-SELECTION                          01920700
030300             MOVE PC-TKT-EXCEPTION-SCREEN                         01920800
030400                                        TO  PV-TRANSFER-PROGRAM   01920900
030500             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                01921000
030600                                                                  01921100
030700         WHEN EIBAID = DFHPF1                                     01921203
030800              PERFORM 1400-HELP-SCREEN                            01921303
030900                                                                  01921403
031000         WHEN OTHER                                               01921500
031100             MOVE PM-UNRECOGNIZED-PF-KEY-MSG  TO  AMSGLNO         01921600
031200                                                                  01921700
031300     END-EVALUATE.                                                01921800
031400                                                                  01921900
031500     PERFORM 8100-SEND-DATA-ONLY.                                 01922000
031600     PERFORM 8200-RETURN-TRANID.                                  01922100
031700                                                                  01922200
031800     GOBACK.                                                      01922300
031900****************************************************************  01923000
032000* 1000-SETUP-SCREEN                                               01924000
032100*    INITIAL SETUP OF AUDIT NUMBER AND STATUS                     01925000
032200****************************************************************  01926000
032300 1000-SETUP-SCREEN.                                               01927000
032400                                                                  01928000
032500     IF SU006-LAST-PROGRAM = PC-TKT-EXCEPTION-SCREEN              01929000
032600        MOVE CA-SCRN-DEPT-X     TO ADEPTO                         01930000
032700        MOVE CA-SCRN-MAJ-CLS-X TO AMJCLSO                         01940001
032800        MOVE CA-SCRN-SUB-CLS-X  TO ASBCLSO                        01950002
032900        MOVE CA-SCRN-RETAIL-X TO ARETAILO                         01960000
033000        MOVE CA-SCRN-SIZE       TO ASIZEO                         01970000
033100        MOVE CA-SCRN-COLOR      TO ACOLORO                        01980000
033200        MOVE CA-SCRN-STYLE      TO ASTYLEO                        01990000
033300     ELSE                                                         02000000
033400*    MOVE SYSTEM INFORMATION TO THE SCREEN                        02010000
033500        MOVE SU006-SKU-DPT         TO ADEPTO                      02020001
033600                                      CA-SCRN-DEPT                02030001
033700        MOVE SU006-SKU-MAJ-CLASS   TO AMJCLSO                     02040001
033800                                      CA-SCRN-MAJ-CLASS           02050002
033900        MOVE SU006-SKU-SUB-CLASS   TO ASBCLSO                     02060001
034000                                      CA-SCRN-SUB-CLASS           02070002
034100        MOVE CA-SYSTEM-RETAIL-X TO ARETAILO                       02080000
034200                                      CA-SCRN-RETAIL-X            02090000
034300        MOVE CA-SYSTEM-SIZE        TO ASIZEO                      02100000
034400                                      CA-SCRN-SIZE                02110000
034500        MOVE CA-SYSTEM-COLOR       TO ACOLORO                     02120000
034600                                      CA-SCRN-COLOR               02130000
034700        MOVE CA-SYSTEM-STYLE       TO ASTYLEO                     02140000
034800                                      CA-SCRN-STYLE               02150000
034900     END-IF.                                                      02160000
035000                                                                  02170000
035100     MOVE SU006-SHIP-UNIT-NBR-X TO AMSGLNO.                       02180000
035200*                                                                 02190000
035300*                                                                 02200000
035400 1200-RECEIVE-MAP.                                                02210000
035500     EXEC CICS                                                    02220000
035600         RECEIVE                                                  02230000
035700             MAP     ('SU517A')                                   02240000
035800             MAPSET  ('SUKM517')                                  02250000
035900             RESP    (PV-CICS-RESPONSE)                           02260000
036000     END-EXEC.                                                    02270000
036100                                                                  02280000
036200     EVALUATE TRUE                                                02290000
036300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 02300000
036400              PERFORM 1210-RECEIVE-SCREEN-FIELDS                  02310000
036500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                02320000
036600              CONTINUE                                            02330000
036700         WHEN OTHER                                               02340000
036800              MOVE '1200-RECEIVE-MAP'                             02350000
036900                                     TO DP013-PARAGRAPH           02360000
037000              MOVE 'UNABLE TO RECEIVE MAP'                        02370000
037100                                     TO DP013-MESSAGE-TEXT (1)    02380000
037200              SET DP013-LOGIC-ABEND  TO TRUE                      02390000
037300              SET DP013-NO-ROLLBACK  TO TRUE                      02400000
037400              PERFORM 9999-WRITE-CICS-LOG-MSG                     02410000
037500     END-EVALUATE.                                                02420000
037600*                                                                 02430000
037700 1210-RECEIVE-SCREEN-FIELDS.                                      02440000
037800*                                                                 02450000
037900     IF  ADEPTL   > ZERO                                          02460000
038000         MOVE ADEPTI                 TO CA-SCRN-DEPT-X            02470000
038100         MOVE 0                      TO ADEPTL                    02480000
038200     ELSE IF  ADEPTF   = DP015-ERASE-EOF                          02490000
038300         MOVE SPACES                 TO CA-SCRN-DEPT-X            02500000
038400                                        ADEPTO                    02510000
038500     END-IF.                                                      02520000
038600*                                                                 02530000
038700     IF  AMJCLSL  > ZERO                                          02540002
038800         MOVE AMJCLSI                TO CA-SCRN-MAJ-CLS-X         02550002
038900         MOVE 0                      TO AMJCLSL                   02560001
039000     ELSE IF  AMJCLSF  = DP015-ERASE-EOF                          02570001
039100         MOVE SPACES                 TO CA-SCRN-MAJ-CLS-X         02580001
039200                                        AMJCLSO                   02590001
039300     END-IF.                                                      02600000
039400*                                                                 02610000
039500     IF  ASBCLSL  > ZERO                                          02620001
039600         MOVE ASBCLSI                TO CA-SCRN-SUB-CLS-X         02630001
039700         MOVE 0                      TO ASBCLSL                   02640001
039800     ELSE IF  ASBCLSF  = DP015-ERASE-EOF                          02650001
039900         MOVE SPACES                 TO CA-SCRN-SUB-CLS-X         02660001
040000                                        ASBCLSO                   02670001
040100     END-IF.                                                      02680000
040200*                                                                 02690000
040300                                                                  02700000
040400     IF  ARETAILL > ZERO                                          02710000
040500         MOVE ARETAILI               TO CA-SCRN-RETAIL-X          02720000
040600     ELSE IF  ARETAILF = DP015-ERASE-EOF                          02730000
040700         MOVE SPACES                 TO CA-SCRN-RETAIL-X          02740000
040800                                        ARETAILO                  02750000
040900     END-IF.                                                      02760000
041000*                                                                 02770000
041100     IF  ASIZEL > ZERO                                            02780000
041200         MOVE ASIZEI                 TO CA-SCRN-SIZE              02790000
041300         MOVE 0                      TO ASIZEL                    02791000
041400     ELSE IF  ASIZEF = DP015-ERASE-EOF                            02792000
041500         MOVE SPACES                 TO CA-SCRN-SIZE              02793000
041600                                        ASIZEO                    02794000
041700     END-IF.                                                      02795000
041800*                                                                 02796000
041900     IF  ACOLORL > ZERO                                           02797000
042000         MOVE ACOLORI                TO CA-SCRN-COLOR             02798000
042100         MOVE 0                      TO ACOLORL                   02799000
042200     ELSE IF  ACOLORF = DP015-ERASE-EOF                           02800000
042300         MOVE SPACES                 TO CA-SCRN-COLOR             02810000
042400                                        ACOLORO                   02820000
042500     END-IF.                                                      02830000
042600                                                                  02840000
042700     IF  ASTYLEL > ZERO                                           02850000
042800         MOVE ASTYLEI                TO CA-SCRN-STYLE             02860000
042900         MOVE 0                      TO ASTYLEL                   02861000
043000     ELSE IF  ASTYLEF = DP015-ERASE-EOF                           02862000
043100         MOVE SPACES                 TO CA-SCRN-STYLE             02863000
043200                                        ASTYLEO                   02864000
043300     END-IF.                                                      02865000
043400*                                                                 02866000
043500**************************************************************    02867000
043600* EDIT ALL ENTERABLE FIELDS (UPC NUMBER)                     *    02868000
043700**************************************************************    02869000
043800 1300-EDIT-SELECTION.                                             02870000
043900                                                                  02880000
044000                                                                  02890000
044100*    CHECK TO MAKE SURE THE DEPT IS NUMERIC                       02900000
044200     INITIALIZE DP010I-NUMERIC-EDIT-AREA.                         02910000
044300     MOVE CA-SCRN-DEPT-X             TO DP010I-UNEDITED-FIELD.    02920000
044400     MOVE 3                          TO DP010I-MAXIMUM-DIGITS.    02930000
044500     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  02940000
044600     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     02950000
044700                                                                  02960000
044800     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02970000
044900                     USING DP010I-NUMERIC-EDIT-AREA.              02980000
045000                                                                  02990000
045100     IF  DP010I-ERROR-DETECTED                                    03000000
045200         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       03010000
045300                                     TO AMSGLNO                   03020000
045400         MOVE -1                     TO ADEPTL                    03030000
045500         PERFORM 8100-SEND-DATA-ONLY                              03040000
045600         PERFORM 8200-RETURN-TRANID                               03050000
045700     ELSE                                                         03060000
045800         MOVE DP010I-NUMERIC-FIELD   TO CA-SCRN-DEPT              03070000
045900         MOVE CA-SCRN-DEPT-X         TO ADEPTO                    03080000
046000     END-IF.                                                      03090000
046100                                                                  03100000
046200                                                                  03110000
046300*    CHECK TO MAKE SURE THE CLASS IS NUMERIC                      03120000
046400     INITIALIZE DP010I-NUMERIC-EDIT-AREA.                         03130000
046500     MOVE CA-SCRN-MAJ-CLS-X          TO DP010I-UNEDITED-FIELD.    03140001
046600     MOVE 2                          TO DP010I-MAXIMUM-DIGITS.    03150000
046700     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03160000
046800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03170000
046900                                                                  03180000
047000     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03190000
047100                     USING DP010I-NUMERIC-EDIT-AREA.              03200000
047200                                                                  03210000
047300     IF  DP010I-ERROR-DETECTED                                    03220000
047400         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       03230000
047500                                     TO AMSGLNO                   03240000
047600         MOVE -1                     TO AMJCLSL                   03250001
047700         PERFORM 8100-SEND-DATA-ONLY                              03260000
047800         PERFORM 8200-RETURN-TRANID                               03270000
047900     ELSE                                                         03280000
048000         MOVE DP010I-NUMERIC-FIELD   TO CA-SCRN-MAJ-CLASS         03290001
048100         MOVE CA-SCRN-MAJ-CLS-X      TO AMJCLSO                   03300001
048200     END-IF.                                                      03310000
048300                                                                  03320000
048400                                                                  03330000
048500*    CHECK TO MAKE SURE THE SEQ IS NUMERIC                        03340000
048600     INITIALIZE DP010I-NUMERIC-EDIT-AREA.                         03350000
048700     MOVE CA-SCRN-SUB-CLS-X          TO DP010I-UNEDITED-FIELD.    03360001
048800     MOVE 2                          TO DP010I-MAXIMUM-DIGITS.    03370001
048900     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  03380000
049000     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03390000
049100                                                                  03400000
049200     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03410000
049300                     USING DP010I-NUMERIC-EDIT-AREA.              03420000
049400                                                                  03430000
049500     IF  DP010I-ERROR-DETECTED                                    03440000
049600         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       03450000
049700                                     TO AMSGLNO                   03460000
049800         MOVE -1                     TO ASBCLSL                   03470001
049900         PERFORM 8100-SEND-DATA-ONLY                              03480000
050000         PERFORM 8200-RETURN-TRANID                               03490000
050100     ELSE                                                         03500000
050200         MOVE DP010I-NUMERIC-FIELD   TO CA-SCRN-SUB-CLASS         03510001
050300         MOVE CA-SCRN-SUB-CLS-X      TO ASBCLSO                   03520001
050400     END-IF.                                                      03530000
050500                                                                  03540000
050600*    DETERMINE IF THERE IS A DECIMAL POINT OR NOT, AND VALIDATE   03550000
050700*    NUMERIC ACCORDINGLY                                          03560000
050800     MOVE +0                      TO PV-DECIMAL-COUNT.            03570000
050900     INSPECT CA-SCRN-RETAIL-X TALLYING PV-DECIMAL-COUNT           03580000
051000            FOR ALL '.'.                                          03590000
051100                                                                  03600000
051200*    CHECK TO MAKE SURE THE RETAIL IS NUMERIC                     03610000
051300     INITIALIZE DP010I-NUMERIC-EDIT-AREA.                         03620000
051400     MOVE CA-SCRN-RETAIL-X        TO DP010I-UNEDITED-FIELD.       03630000
051500                                                                  03640000
051600*    IF THERE IS A DECIMAL POINT, VALIDATE FOR 2 DECIMALS         03650000
051700     IF PV-DECIMAL-COUNT > 0                                      03660000
051800         MOVE 5                   TO DP010I-MAXIMUM-DIGITS        03670000
051900         MOVE 2                   TO DP010I-MAXIMUM-DECIMALS      03680000
052000     ELSE                                                         03681000
052100         MOVE 7                   TO DP010I-MAXIMUM-DIGITS        03682000
052200         MOVE 0                   TO DP010I-MAXIMUM-DECIMALS      03683000
052300     END-IF.                                                      03684000
052400                                                                  03685000
052500     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     03686000
052600                                                                  03687000
052700     CALL DP010I-NUMERIC-EDIT-ROUTINE                             03688000
052800                     USING DP010I-NUMERIC-EDIT-AREA.              03689000
052900                                                                  03690000
053000     IF  DP010I-ERROR-DETECTED                                    03700000
053100         MOVE PM-NUMERIC-VALUE-REQUIRED-MSG                       03710000
053200                                  TO AMSGLNO                      03720000
053300         MOVE -1                  TO ARETAILL                     03730000
053400         PERFORM 8100-SEND-DATA-ONLY                              03740000
053500         PERFORM 8200-RETURN-TRANID                               03750000
053600     ELSE                                                         03750100
053700         IF PV-DECIMAL-COUNT > 0                                  03750200
053800             MOVE DP010I-NUMERIC-FIELD  TO CA-SCRN-RETAIL         03750300
053900         ELSE                                                     03750400
054000*            COMPUTE DECIMAL POSITION IF IT ISN'T ALREADY THERE   03750500
054100             COMPUTE CA-SCRN-RETAIL = DP010I-NUMERIC-FIELD / 100  03750600
054200         END-IF                                                   03750700
054300         MOVE CA-SCRN-RETAIL-X          TO ARETAILO               03750800
054400     END-IF.                                                      03750900
054500                                                                  03751000
054600                                                                  03752000
054700 1400-HELP-SCREEN.                                                03752103
054800     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      03752203
054900     MOVE 'SUKRF517'                  TO PC192-PROGRAM-NAME       03752303
055000     COPY PCPD188.                                                03752403
055100     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      03752503
055200     PERFORM 4200-XCTL-TO-HELP.                                   03752603
055300                                                                  03752703
055400                                                                  03753000
055500***************************************************************** 03754000
055600*   1500-CHECK-EXCEPTIONS                                       * 03755000
055700* COMPARE THE SCREEN VALUES WITH THE SYSTEM VALUES TO DETERMINE * 03756000
055800* WHICH EXCEPTIONS TO CREATE                                    * 03757000
055900***************************************************************** 03758000
056000 1500-CHECK-EXCEPTIONS.                                           03759000
056100                                                                  03760000
056200       IF CA-SYSTEM-RETAIL = CA-SCRN-RETAIL                       03770000
056300           CONTINUE                                               03780000
056400       ELSE                                                       03790000
056500           MOVE PC-TKT-ERR-RETAIL-VILN-SEQ                        03800000
056600                             TO SUEXCP-VILN-GP-SEQ-NBR            03810000
056700           MOVE CA-SCRN-RETAIL-X                                  03820000
056800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         03830000
056900           PERFORM 1501-CREATE-EXCEPTION                          03840000
057000       END-IF.                                                    03850000
057100                                                                  03860000
057200       IF CA-SYSTEM-COLOR  = CA-SCRN-COLOR                        03870000
057300           CONTINUE                                               03880000
057400       ELSE                                                       03890000
057500           MOVE PC-TKT-ERR-COLOR-VILN-SEQ                         03900000
057600                             TO SUEXCP-VILN-GP-SEQ-NBR            03910000
057700           MOVE CA-SCRN-COLOR                                     03920000
057800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         03930000
057900           PERFORM 1501-CREATE-EXCEPTION                          03940000
058000       END-IF.                                                    03950000
058100                                                                  03960000
058200       IF CA-SYSTEM-SIZE   = CA-SCRN-SIZE                         03970000
058300           CONTINUE                                               03980000
058400       ELSE                                                       03990000
058500           MOVE PC-TKT-ERR-SIZE-VILNE-SEQ                         04000000
058600                             TO SUEXCP-VILN-GP-SEQ-NBR            04010000
058700           MOVE CA-SCRN-SIZE TO SUEXCP-OVRRID-SYS-DAT-TXT         04020000
058800           PERFORM 1501-CREATE-EXCEPTION                          04030000
058900       END-IF.                                                    04040000
059000                                                                  04050000
059100       MOVE CA-SYSTEM-STYLE TO PV-SHORT-STYLE.                    04060000
059200                                                                  04070000
059300       IF PV-SHORT-STYLE  = CA-SCRN-STYLE                         04080000
059400           CONTINUE                                               04090000
059500       ELSE                                                       04100000
059600           MOVE PC-TKT-ERR-STYLE-VILN-SEQ                         04110000
059700                             TO SUEXCP-VILN-GP-SEQ-NBR            04120000
059800           MOVE CA-SCRN-STYLE TO SUEXCP-OVRRID-SYS-DAT-TXT        04130000
059900           PERFORM 1501-CREATE-EXCEPTION                          04140000
060000       END-IF.                                                    04150000
060100                                                                  04160000
060200       IF SU006-SKU-DPT    = CA-SCRN-DEPT                         04170001
060300           CONTINUE                                               04180000
060400       ELSE                                                       04190000
060500           MOVE PC-TKT-ERR-DPT-VILN-SEQ                           04200000
060600                             TO SUEXCP-VILN-GP-SEQ-NBR            04210000
060700           MOVE CA-SCRN-DEPT-X                                    04220000
060800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         04230000
060900           PERFORM 1501-CREATE-EXCEPTION                          04240000
061000       END-IF.                                                    04240100
061100                                                                  04240200
061200       IF SU006-SKU-MAJ-CLASS = CA-SCRN-MAJ-CLASS                 04240302
061300           CONTINUE                                               04240400
061400       ELSE                                                       04240500
061500           MOVE PC-TKT-ERR-CLASS-VILN-SEQ                         04240600
061600                             TO SUEXCP-VILN-GP-SEQ-NBR            04240700
061700           MOVE CA-SCRN-MAJ-CLS-X                                 04240801
061800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         04240900
061900           PERFORM 1501-CREATE-EXCEPTION                          04241000
062000       END-IF.                                                    04241100
062100                                                                  04241200
062200       IF SU006-SKU-SUB-CLASS = CA-SCRN-SUB-CLASS                 04241302
062300           CONTINUE                                               04241400
062400       ELSE                                                       04241500
062500           MOVE PC-TKT-ERR-SKU-VILN-SEQ                           04241600
062600                             TO SUEXCP-VILN-GP-SEQ-NBR            04241700
062700           MOVE CA-SCRN-SUB-CLS-X                                 04241801
062800                             TO SUEXCP-OVRRID-SYS-DAT-TXT         04241900
062900           PERFORM 1501-CREATE-EXCEPTION                          04242000
063000       END-IF.                                                    04243000
063100*                                                                 04243100
063200       IF SU006-SKU-DPT    = CA-SCRN-DEPT AND                     04243201
063300          SU006-SKU-MAJ-CLASS = CA-SCRN-MAJ-CLASS AND             04243302
063400          SU006-SKU-SUB-CLASS = CA-SCRN-SUB-CLASS                 04243402
063500          IF SU006-UPC-NOT-CERTIFIED                              04243500
063600                                                                          
063700*     DO NOT EVEN ATTEMPT TO CERTIFY A TUPC                               
063800*     DURING THE TIME THAT DB MAINTENANCE IS BEING DONE.                  
063900             PERFORM 7300-GET-BLACKOUT                            04243608
064000             IF PS-BLACKOUT-NO                                    04243708
064100                 MOVE 'Y'         TO SUAUPC-UPC-CERTD-IND         04243808
064200                 PERFORM 1700-CERTIFY-UPC                         04243908
064300                 PERFORM 1710-UPDATE-AUDIT-ROW                    04244008
064400             END-IF                                               04244108
064500                                                                          
064600          END-IF                                                  04244208
064700       END-IF.                                                    04244308
064800                                                                  04245000
064900***************************************************************** 04246000
065000*   1501-CREATE-EXCEPTION                                       * 04247000
065100* CREATE THE APPROPRIATE EXCEPTION..........                    * 04248000
065200***************************************************************** 04249000
065300 1501-CREATE-EXCEPTION.                                           04250000
065400     MOVE PC-CARTON-AUDIT-GROUP-CODE TO SUEXCP-VILN-GP-CDE,       04260000
065500     MOVE SU006-AUDIT-CNTL-NBR       TO SUEXCP-AUD-CNTL-NBR.      04270000
065600     MOVE SU006-SHIP-UNIT-NBR        TO SUEXCP-SHIPT-UNT-ID.      04280000
065700     MOVE SU006-SCN-TMST             TO SUEXCP-SCN-TMST.          04290000
065800     MOVE SU006-UPC                  TO SUEXCP-UPC-NBR.           04300000
065900                                                                  04310000
066000     EXEC SQL                                                     04320000
066100         INSERT  INTO  TSUEXCP                                    04330000
066200                (AUD_CNTL_NBR                                     04340000
066300               , SHIPT_UNT_ID                                     04350000
066400               , UPC_NBR                                          04360000
066500               , SCN_TMST                                         04370000
066600               , VILN_GP_CDE                                      04380000
066700               , VILN_GP_SEQ_NBR                                  04390000
066800               , OVRRID_SYS_DAT_TXT)                              04400000
066900         VALUES                                                   04410000
067000             (                                                    04420000
067100                :SUEXCP-AUD-CNTL-NBR                              04430000
067200              , :SUEXCP-SHIPT-UNT-ID                              04440000
067300              , :SUEXCP-UPC-NBR                                   04450000
067400              , :SUEXCP-SCN-TMST                                  04460000
067500              , :SUEXCP-VILN-GP-CDE                               04470000
067600              , :SUEXCP-VILN-GP-SEQ-NBR                           04480000
067700              , :SUEXCP-OVRRID-SYS-DAT-TXT)                       04490000
067800     END-EXEC                                                     04500000
067900                                                                  04510000
068000     EVALUATE TRUE                                                04520000
068100         WHEN SQLCODE = ZERO                                      04530000
068200             CONTINUE                                             04540000
068300                                                                  04550000
068400         WHEN SQLWARN0 NOT = SPACES                               04560000
068500         WHEN SQLCODE < ZERO                                      04570000
068600         WHEN SQLCODE > ZERO                                      04580000
068700             MOVE '1501-CREATE-EXCEPTION'                         04590000
068800                 TO DP013-PARAGRAPH                               04600000
068900             MOVE 'INSERT TO TSUEXCP TABLE'                       04610000
069000                 TO DP013-MESSAGE-TEXT (1)                        04620000
069100             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 04630000
069200             MOVE SQLCA                  TO DP013-SQLCA           04640000
069300             MOVE 'TSUEXCP'            TO DP013-DB2-TABLE-NAME(1) 04650000
069400             SET DP013-DB2-ABEND         TO TRUE                  04660000
069500             SET DP013-NO-ROLLBACK       TO TRUE                  04670000
069600             PERFORM 9999-WRITE-CICS-LOG-MSG                      04680000
069700             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               04690000
069800             PERFORM 8100-SEND-DATA-ONLY                          04700000
069900             PERFORM 8200-RETURN-TRANID                           04710000
070000     END-EVALUATE.                                                04720000
070100                                                                  04730000
070200*    IF THE CURRENT SHIPPING UNIT AUDIT RECORD DOES NOT HAVE ANY  04740000
070300*    EXCEPTIONS CREATED YET, SET THE INDICATOR TO SAY THAT IT     04750000
070400*    DOES NOW                                                     04760000
070500     IF SU006-NO-AUD-ERR                                          04770000
070600         PERFORM 1600-UPDATE-SHIP-UNIT                            04780000
070700     END-IF.                                                      04790000
070800                                                                  04800000
070900                                                                  04810000
071000***************************************************************** 04820000
071100*   1600-UPDATE-SHIP-UNIT                                       * 04830000
071200* UPDATE THE AUDIT ERROR INDICATOR TO SAY THERE ARE EXCEPTIONS  * 04840000
071300* FOR THIS SHIPPING UNIT AUDIT                                  * 04850000
071400***************************************************************** 04860000
071500 1600-UPDATE-SHIP-UNIT.                                           04870000
071600                                                                  04880000
071700     MOVE SU006-AUDIT-CNTL-NBR TO SUATRN-AUD-CNTL-NBR.            04890000
071800     MOVE SU006-SHIP-UNIT-NBR TO SUATRN-SHIPT-UNT-ID.             04900000
071900                                                                  04910000
072000     EXEC SQL                                                     04920000
072100         UPDATE TSUATRN                                           04930000
072200            SET UNT_AUD_ERR_IND = 'Y'                             04940000
072300         WHERE   AUD_CNTL_NBR = :SUATRN-AUD-CNTL-NBR              04950000
072400           AND   SHIPT_UNT_ID = :SUATRN-SHIPT-UNT-ID              04960000
072500     END-EXEC                                                     04970000
072600                                                                  04980000
072700     EVALUATE TRUE                                                04990000
072800         WHEN SQLCODE = ZERO                                      05000000
072900             SET SU006-AUD-ERR TO TRUE                            05010000
073000                                                                  05020000
073100         WHEN SQLWARN0 NOT = SPACES                               05030000
073200         WHEN SQLCODE < ZERO                                      05040000
073300         WHEN SQLCODE > ZERO                                      05050000
073400             MOVE '1600-UPDATE-SHIP-UNIT'                         05060000
073500                 TO DP013-PARAGRAPH                               05070000
073600             MOVE 'UPDATE THE AUDIT ERROR CODE'                   05080000
073700                 TO DP013-MESSAGE-TEXT (1)                        05090000
073800             MOVE SU006-AUDIT-CNTL-NBR-X TO DP013-MESSAGE-TEXT(2) 05100000
073900             MOVE SU006-SHIP-UNIT-NBR-X  TO DP013-MESSAGE-TEXT(3) 05110000
074000             MOVE SQLCA                  TO DP013-SQLCA           05120000
074100             MOVE 'TSUATRN'            TO DP013-DB2-TABLE-NAME(1) 05130000
074200             SET DP013-DB2-ABEND         TO TRUE                  05140000
074300             SET DP013-NO-ROLLBACK       TO TRUE                  05150000
074400             PERFORM 9999-WRITE-CICS-LOG-MSG                      05160000
074500             MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO               05170000
074600             PERFORM 8100-SEND-DATA-ONLY                          05180000
074700             PERFORM 8200-RETURN-TRANID                           05190000
074800     END-EVALUATE.                                                05200000
074900                                                                  05210000
075000***************************************************************** 05220000
075100*   1700-CERTIFY-UPC                                            * 05230000
075200* UPDATE THE UPC CERTIFICATION FLAG TO 'Y' ON BOTH TUPC AND     * 05240000
075300* TUPCSKU TABLES                                                * 05250000
075400***************************************************************** 05260000
075500 1700-CERTIFY-UPC.                                                05270000
075600                                                                  05280000
075700     MOVE SU006-UPC           TO DK-UPC-NUMBER.                   05290000
075800     SET  PS-DATABASE-CONTENTION-NO  TO  TRUE.                    05291007
075900                                                                  05300000
076000     EXEC SQL                                                     05310000
076100         UPDATE TUPC                                              05320000
076200            SET CERTD_IND             = 'Y'                       05330000
076300              , CERTD_DTE             =  CURRENT DATE             05340000
076400              , LAST_UPD_BY_USR_ID   = :SU006-USERID              05350000
076500              , LAST_UPD_TMST        =  CURRENT TIMESTAMP         05360000
076600         WHERE  UPC_NBR              = :DK-UPC-NUMBER             05370000
076700     END-EXEC                                                     05380000
076800                                                                  05390000
076900     EVALUATE TRUE                                                05400000
077000         WHEN SQLCODE = ZERO                                      05410000
077100             PERFORM 1701-UPDATE-XLT-UPC                          05420005
077200                                                                  05430000
077300         WHEN SQLCODE = -904                                      05431007
077400         WHEN SQLCODE = -913                                      05431107
077500              SET  PS-DATABASE-CONTENTION-YES  TO  TRUE           05432007
077600                                                                  05433007
077700         WHEN SQLWARN0 NOT = SPACES                               05440000
077800         WHEN SQLCODE < ZERO                                      05450000
077900         WHEN SQLCODE > ZERO                                      05460000
078000             MOVE '1700-CERTIFY-UPC'                              05470000
078100                 TO DP013-PARAGRAPH                               05480000
078200             MOVE SU006-UPC-X            TO DP013-MESSAGE-TEXT(1) 05490000
078300             MOVE SQLCA                  TO DP013-SQLCA           05500000
078400             MOVE 'TUPC   '            TO DP013-DB2-TABLE-NAME(1) 05510000
078500             SET DP013-DB2-ABEND         TO TRUE                  05520000
078600             SET DP013-NO-ROLLBACK       TO TRUE                  05530000
078700             PERFORM 9999-WRITE-CICS-LOG-MSG                      05540000
078800*            MOVE PM-DB2-FATAL-ERROR-MSG TO CA-RETURN-MSG         05550000
078900*            SET CA-RETURN-ERROR         TO TRUE                  05560000
079000                                                                  05570000
079100*            RETURN TO THE PROGRAM THAT CALLED IT                 05580000
079200             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   05590000
079300             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                05600000
079400     END-EVALUATE.                                                05610000
079500                                                                  05620000
079600     IF  PS-DATABASE-CONTENTION-NO                                05621007
079700         EXEC SQL                                                 05630007
079800             UPDATE TUPCSKU                                       05640007
079900                SET CERT_IND   = 'Y'                              05650007
080000                  , CERT_DTE   = CURRENT DATE                     05660007
080100             WHERE UPC_NBR    = :DK-UPC-NUMBER                    05670007
080200         END-EXEC                                                 05680007
080300                                                                  05690000
080400         EVALUATE TRUE                                            05700007
080500             WHEN SQLCODE = ZERO                                  05710007
080600                 CONTINUE                                         05720007
080700                                                                  05730000
080800             WHEN SQLWARN0 NOT = SPACES                           05740007
080900             WHEN SQLCODE < ZERO                                  05750007
081000             WHEN SQLCODE > ZERO                                  05760007
081100                 MOVE '1700-CERTIFY-UPC'                          05770007
081200                     TO DP013-PARAGRAPH                           05780007
081300                 MOVE SU006-UPC-X        TO DP013-MESSAGE-TEXT(1) 05790007
081400                 MOVE SQLCA              TO DP013-SQLCA           05800007
081500                 MOVE 'TUPCSKU'        TO DP013-DB2-TABLE-NAME(1) 05810007
081600                 SET DP013-DB2-ABEND     TO TRUE                  05820007
081700                 SET DP013-NO-ROLLBACK   TO TRUE                  05830007
081800                 PERFORM 9999-WRITE-CICS-LOG-MSG                  05840007
081900*                MOVE PM-DB2-FATAL-ERROR-MSG TO SU006-RETURN-MSG  05850007
082000*                SET SU006-RETURN-ERROR  TO TRUE                  05860007
082100                                                                  05870000
082200*                RETURN TO THE PROGRAM THAT CALLED IT             05880007
082300                 MOVE SU006-LAST-PROGRAM TO PV-TRANSFER-PROGRAM   05890007
082400                 PERFORM 2100-XCTL-TO-SELECTED-PROGRAM            05900007
082500         END-EVALUATE                                             05910007
082600     END-IF.                                                      05910107
082700                                                                  05910207
082800                                                                  05910307
082900 1701-UPDATE-XLT-UPC.                                             05910407
083000                                                                  05910507
083100     EXEC SQL                                                     05910607
083200         UPDATE XLT_UPC                                           05910707
083300            SET CERTD_IND             = 'Y'                       05910807
083400              , CERTD_DTE             =  CURRENT DATE             05910907
083500         WHERE  UPC_NBR              = :DK-UPC-NUMBER             05911007
083600     END-EXEC                                                     05911107
083700                                                                  05911207
083800     EVALUATE TRUE                                                05911307
083900         WHEN SQLCODE = ZERO                                      05911407
084000             CONTINUE                                             05911507
084100                                                                  05911607
084200         WHEN SQLWARN0 NOT = SPACES                               05911707
084300         WHEN SQLCODE < ZERO                                      05911807
084400         WHEN SQLCODE > ZERO                                      05911907
084500             MOVE '1701-UPDATE-XLT-UPC '                          05912007
084600                 TO DP013-PARAGRAPH                               05912107
084700             MOVE SU006-UPC-X            TO DP013-MESSAGE-TEXT(1) 05912207
084800             MOVE SQLCA                  TO DP013-SQLCA           05912307
084900             MOVE 'XLT_UPC'            TO DP013-DB2-TABLE-NAME(1) 05912407
085000             SET DP013-DB2-ABEND         TO TRUE                  05912507
085100             SET DP013-NO-ROLLBACK       TO TRUE                  05912607
085200             PERFORM 9999-WRITE-CICS-LOG-MSG                      05912707
085300*            MOVE PM-DB2-FATAL-ERROR-MSG TO SU006-RETURN-MSG      05912807
085400*            SET SU006-RETURN-ERROR      TO TRUE                  05912907
085500                                                                  05913007
085600*            RETURN TO THE PROGRAM THAT CALLED IT                 05913107
085700             MOVE SU006-LAST-PROGRAM    TO  PV-TRANSFER-PROGRAM   05913207
085800             PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                05913307
085900     END-EVALUATE.                                                05914205
086000                                                                  05914305
086100                                                                  05914405
086200***************************************************************** 05914500
086300*   1710-UPDATE-AUDIT-ROW                                       * 05914600
086400* THE UPC WAS CERTIFIED, UPDATE THE CERTIFICATION INIDICATOR ON * 05914700
086500* TSUAUPC.                                                      * 05914800
086600***************************************************************** 05914900
086700 1710-UPDATE-AUDIT-ROW.                                           05915000
086800                                                                  05915100
086900      MOVE SU006-AUDIT-CNTL-NBR TO SUAUPC-AUD-CNTL-NBR.           05915200
087000      MOVE SU006-SHIP-UNIT-NBR TO SUAUPC-SHIPT-UNT-ID.            05915300
087100      MOVE SU006-UPC          TO SUAUPC-UPC-NBR.                  05915400
087200                                                                  05915500
087300         EXEC SQL                                                 05915600
087400             UPDATE TSUAUPC                                       05916000
087500             SET UPC_CERTD_IND  = :SUAUPC-UPC-CERTD-IND           05917000
087600             WHERE AUD_CNTL_NBR = :SUAUPC-AUD-CNTL-NBR            05918000
087700               AND SHIPT_UNT_ID = :SUAUPC-SHIPT-UNT-ID            05919000
087800               AND UPC_NBR      = :SUAUPC-UPC-NBR                 05920000
087900               AND SCN_TMST     = :SU006-SCN-TMST                 05930000
088000         END-EXEC                                                 05940000
088100                                                                  05950000
088200         EVALUATE TRUE                                            05960000
088300             WHEN SQLCODE = ZERO                                  05970000
088400                 CONTINUE                                         05980000
088500             WHEN SQLWARN0 NOT = SPACES                           05990000
088600             WHEN SQLCODE < ZERO                                  06000000
088700             WHEN SQLCODE > ZERO                                  06010000
088800                 MOVE '1410-CREATE-AUDIT-ROW'                     06020000
088900                                             TO DP013-PARAGRAPH   06030000
089000                 MOVE 'UPDATE TSUAUPC'  TO DP013-MESSAGE-TEXT(1)  06040000
089100                 MOVE SU006-AUDIT-CNTL-NBR                        06050000
089200                                        TO PV-DISP-AUD-CNTL-NBR   06060000
089300                 MOVE SU006-SHIP-UNIT-NBR                         06070000
089400                                        TO PV-DISP-SHIPT-UNT-ID   06080000
089500                 MOVE SU006-UPC         TO PV-DISP-UPC-NBR        06090000
089600                 MOVE SU006-SCN-TMST    TO PV-DISP-SCN-TMST       06100000
089700                 MOVE PV-DISPLAY-KEYS   TO DP013-MESSAGE-TEXT(2)  06110000
089800                 MOVE SQLCA                  TO DP013-SQLCA       06120000
089900                 MOVE 'TSUAUPC'        TO DP013-DB2-TABLE-NAME(1) 06130000
090000                 SET DP013-DB2-ABEND         TO TRUE              06140000
090100                 SET DP013-NO-ROLLBACK       TO TRUE              06150000
090200                 PERFORM 9999-WRITE-CICS-LOG-MSG                  06160000
090300                 MOVE PM-DB2-FATAL-ERROR-MSG TO AMSGLNO           06170000
090400                 PERFORM 8100-SEND-DATA-ONLY                      06180000
090500                 PERFORM 8200-RETURN-TRANID                       06190000
090600         END-EVALUATE.                                            06200000
090700                                                                  06200100
090800***************************************************************** 06200200
090900*                                                               * 06200300
091000***************************************************************** 06200400
091100 2100-XCTL-TO-SELECTED-PROGRAM.                                   06200500
091200     SET SU006-INITIALIZE-SCREEN   TO  TRUE.                      06200600
091300     MOVE LENGTH OF CA-COMMAREA    TO  PV-COMMAREA-LENGTH.        06200700
091400                                                                  06200800
091500     EXEC CICS                                                    06200900
091600         XCTL                                                     06201000
091700             PROGRAM   (PV-TRANSFER-PROGRAM)                      06201100
091800             COMMAREA  (CA-COMMAREA)                              06201200
091900             LENGTH    (PV-COMMAREA-LENGTH)                       06201300
092000             RESP      (PV-CICS-RESPONSE)                         06201400
092100     END-EXEC.                                                    06201500
092200                                                                  06201600
092300     EVALUATE TRUE                                                06201700
092400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06201800
092500              CONTINUE                                            06201900
092600         WHEN OTHER                                               06202000
092700              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                06202100
092800                                     TO DP013-PARAGRAPH           06202200
092900              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       06202300
093000                                     TO DP013-MESSAGE-TEXT (1)    06202400
093100              MOVE PV-TRANSFER-PROGRAM                            06202500
093200                                     TO DP013-MESSAGE-TEXT (2)    06202600
093300              SET DP013-CICS-ABEND   TO TRUE                      06202700
093400              SET DP013-NO-ROLLBACK  TO TRUE                      06202800
093500              PERFORM 9999-WRITE-CICS-LOG-MSG                     06202900
093600              MOVE PM-TRANS-NOT-AVAILABLE-MSG                     06203000
093700                                     TO AMSGLNO                   06203100
093800              SET SU006-PROCESS-SCREEN TO TRUE                    06203200
093900              PERFORM 8100-SEND-DATA-ONLY                         06203300
094000              PERFORM 8200-RETURN-TRANID                          06203400
094100     END-EVALUATE.                                                06203500
094200                                                                  06203600
094300                                                                  06203700
094400*                                                                 06203803
094500 4200-XCTL-TO-HELP.                                               06203903
094600                                                                  06204003
094700     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH.      06204103
094800     SET  SU006-INITIALIZE-SCREEN     TO TRUE.                    06204203
094900     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA.    06204303
095000                                                                  06204403
095100     EXEC CICS                                                    06204503
095200         XCTL                                                     06204603
095300             PROGRAM   (PV-TRANSFER-PROGRAM)                      06204703
095400             COMMAREA  (PC192-COMMAREA)                           06204803
095500             LENGTH    (PV-COMMAREA-LENGTH)                       06204903
095600             RESP      (PV-CICS-RESPONSE)                         06205003
095700     END-EXEC.                                                    06205103
095800                                                                  06205203
095900     EVALUATE TRUE                                                06205303
096000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06205403
096100              CONTINUE                                            06205503
096200         WHEN OTHER                                               06205603
096300             MOVE '4200-XCTL-TO-HELP '                            06205703
096400                 TO DP013-PARAGRAPH                               06205803
096500             MOVE 'SUKRF517 - UNABLE TO XCTL TO PROGRAM: '        06205903
096600                 TO DP013-MESSAGE-TEXT (1)                        06206003
096700             MOVE PV-TRANSFER-PROGRAM                             06206103
096800                 TO DP013-MESSAGE-TEXT (2)                        06206203
096900             SET DP013-CICS-ABEND  TO TRUE                        06206303
097000             SET DP013-ROLLBACK TO TRUE                           06206403
097100             PERFORM 9999-WRITE-CICS-LOG-MSG                      06206503
097200             MOVE PC-TRANS-UNAVAILABLE-MSG TO AMSGLNO             06206603
097300             SET SU006-PROCESS-SCREEN TO TRUE                     06206703
097400             PERFORM 8000-SEND-MAP                                06206803
097500             PERFORM 8200-RETURN-TRANID                           06206903
097600     END-EVALUATE.                                                06207003
097700                                                                  06207100
097800 7300-GET-BLACKOUT.                                               06207208
097900                                                                  06207308
098000     SET PS-BLACKOUT-NO               TO TRUE                     06207408
098100                                                                  06207508
098200     EXEC SQL                                                     06207608
098300         SELECT 'Y'                                               06207708
098400         INTO                                                     06207808
098500             :PS-BLACKOUT-SW                                      06207908
098600          FROM WST_INTGRTN_TYP   A                                06208008
098700             , WST_ATTR_DEFN   B                                  06208108
098800             , WST_ATTR_ELEM   C                                  06208208
098900             , WST_ATTR_ELEM   D                                  06208308
099000         WHERE  A.INTGRTN_TYP_CDE    =  'TUPCNOUPD'               06208408
099100            AND A.INTGRTN_TYP_CDE    =  B.INTGRTN_TYP_CDE         06208508
099200            AND B.ATTR_DEFN_SEQ_NBR  =  1                         06208608
099300            AND B.INTGRTN_TYP_CDE    =  C.INTGRTN_TYP_CDE         06208708
099400            AND C.ATTR_DEFN_SEQ_NBR  =  1                         06208808
099500            AND B.INTGRTN_TYP_CDE    =  D.INTGRTN_TYP_CDE         06208908
099600            AND D.ATTR_DEFN_SEQ_NBR  =  2                         06209008
099700            AND D.ATTR_ELEM_SEQ_NBR  =  C.ATTR_ELEM_SEQ_NBR       06209108
099800            AND CURRENT TIME >= TIME(C.ATTR_ELEM_TXT)             06209208
099900            AND CURRENT TIME <= TIME(D.ATTR_ELEM_TXT)             06209308
100000         WITH UR                                                  06209408
100100                                                                  06209508
100200     END-EXEC                                                     06209608
100300                                                                  06209708
100400     EVALUATE TRUE                                                06209808
100500         WHEN SQLCODE = ZERO                                      06209908
100600         WHEN SQLCODE = +100                                      06210008
100700             CONTINUE                                             06210108
100800                                                                  06210208
100900         WHEN SQLWARN0 NOT = SPACES                               06210308
101000         WHEN SQLCODE < ZERO                                      06210408
101100         WHEN SQLCODE > ZERO                                      06210508
101200             MOVE '7300-GET-BLACKOUT'                             06210608
101300                                   TO DP013-PARAGRAPH             06210708
101400             MOVE 'SELECT FROM INTEGRATION TBLS'                  06210808
101500                                   TO DP013-MESSAGE-TEXT (1)      06210908
101600             MOVE SQLCA            TO DP013-SQLCA                 06211008
101700             MOVE 'WST_INTGRTN_TYP' TO DP013-DB2-TABLE-NAME (1)   06211108
101800             MOVE 'WST_ATTR_DEFN' TO DP013-DB2-TABLE-NAME (2)     06211208
101900             MOVE 'WST_ATTR_ELEM' TO DP013-DB2-TABLE-NAME (3)     06211308
102000             SET DP013-DB2-ABEND   TO TRUE                        06211408
102100             SET DP013-NO-ROLLBACK TO TRUE                        06211508
102200             PERFORM 9999-WRITE-CICS-LOG-MSG                      06211608
102300     END-EVALUATE.                                                06211708
102400/                                                                 06211808
102500******************************************************************06211900
102600*  8000-SEND-MAP                                                 *06212000
102700*  SEND THE REFRESHED MAP IMAGE TO THE SCREEN                    *06212100
102800******************************************************************06212200
102900 8000-SEND-MAP.                                                   06212300
103000     EXEC CICS                                                    06212400
103100         SEND                                                     06212500
103200             MAP     ('SU517A')                                   06212600
103300             MAPSET  ('SUKM517')                                  06212700
103400             ERASE                                                06212800
103500             RESP    (PV-CICS-RESPONSE)                           06212900
103600     END-EXEC.                                                    06213000
103700                                                                  06213100
103800     EVALUATE TRUE                                                06213200
103900         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06213300
104000             CONTINUE                                             06213400
104100         WHEN OTHER                                               06213500
104200             MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH            06213600
104300             MOVE 'UNABLE TO SEND MAP'                            06213700
104400                                    TO DP013-MESSAGE-TEXT (1)     06213800
104500             SET DP013-CICS-ABEND   TO TRUE                       06213900
104600             SET DP013-NO-ROLLBACK  TO TRUE                       06214000
104700             PERFORM 9999-WRITE-CICS-LOG-MSG                      06214100
104800     END-EVALUATE.                                                06214200
104900*                                                                 06214300
105000 8100-SEND-DATA-ONLY.                                             06214400
105100                                                                  06214500
105200     EXEC CICS                                                    06214600
105300         SEND                                                     06214700
105400             MAP       ('SU517A')                                 06214800
105500             MAPSET    ('SUKM517')                                06214900
105600             CURSOR                                               06215000
105700             DATAONLY                                             06215100
105800             RESP      (PV-CICS-RESPONSE)                         06215200
105900     END-EXEC.                                                    06215300
106000                                                                  06215400
106100     EVALUATE TRUE                                                06215500
106200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06215600
106300             CONTINUE                                             06215700
106400         WHEN OTHER                                               06215800
106500             MOVE '8100-SEND-DATA-ONLY'                           06215900
106600                                    TO DP013-PARAGRAPH            06216000
106700             MOVE 'UNABLE TO SEND DATA'                           06216100
106800                                    TO DP013-MESSAGE-TEXT (1)     06216200
106900             SET DP013-CICS-ABEND   TO TRUE                       06216300
107000             SET DP013-NO-ROLLBACK  TO TRUE                       06216400
107100             PERFORM 9999-WRITE-CICS-LOG-MSG                      06216500
107200     END-EVALUATE.                                                06216600
107300*                                                                 06216700
107400 8200-RETURN-TRANID.                                              06216800
107500     MOVE LENGTH OF CA-COMMAREA  TO  PV-COMMAREA-LENGTH.          06216900
107600                                                                  06217000
107700     EXEC CICS                                                    06218000
107800         RETURN                                                   06220000
107900             TRANSID   (PC-CURRENT-TRANID)                        06230000
108000             COMMAREA  (CA-COMMAREA)                              06240000
108100             LENGTH    (PV-COMMAREA-LENGTH)                       06250000
108200             RESP      (PV-CICS-RESPONSE)                         06260000
108300     END-EXEC.                                                    06270000
108400                                                                  06280000
108500     EVALUATE TRUE                                                06290000
108600         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 06300000
108700             CONTINUE                                             06310000
108800         WHEN OTHER                                               06320000
108900             MOVE '8200-RETURN-TRANID'                            06330000
109000                                    TO DP013-PARAGRAPH            06340000
109100             MOVE 'UNABLE TO RETURN TO TRANID'                    06350000
109200                                    TO DP013-MESSAGE-TEXT (1)     06360000
109300             SET DP013-CICS-ABEND   TO TRUE                       06370000
109400             SET DP013-NO-ROLLBACK  TO TRUE                       06380000
109500             PERFORM 9999-WRITE-CICS-LOG-MSG                      06390000
109600     END-EVALUATE.                                                06400000
109700*                                                                 06410000
109800*                                                                 06420000
109900 9999-WRITE-CICS-LOG-MSG.                                         06430000
110000     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            06440000
110100     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           06450000
110200     INITIALIZE DP013-SRC-TASK-NUMBER                             06460000
110300                DP013-STACK.                                      06470000
110400     SET DP013-LINK-RETURN           TO TRUE.                     06480000
110500                                                                  06490000
110600     EXEC CICS                                                    06500000
110700         LINK                                                     06510000
110800             PROGRAM   (DP013-NAME)                               06520000
110900             COMMAREA  (DP013-PARAMETERS)                         06530000
111000             LENGTH    (DP013-LENGTH)                             06540000
111100     END-EXEC.                                                    06550000
111200                                                                  06560000
111300*----------------------------------------------------------------*06570000
111400*    ABEND PROCESSOR MODULE                                      *06580000
111500*----------------------------------------------------------------*06590000
111600                                                                  06600000
111700     COPY DPPD014.                                                06610008
111800                                                                  06620000
