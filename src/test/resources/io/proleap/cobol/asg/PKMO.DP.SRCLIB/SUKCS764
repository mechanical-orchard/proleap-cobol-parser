000100******************************************************************00010020
000200 IDENTIFICATION DIVISION.                                         00020040
000300******************************************************************00030020
000400                                                                  00040020
000500 PROGRAM-ID.             SUKCS764.                                00050020
000600 AUTHOR.                 GERMAN BANDA.                            00060020
000700 INSTALLATION.           KOHLS.                                   00070020
000800 DATE-WRITTEN            DECEMBER, 2003.                          00080020
000900 DATE-COMPILED.                                                   00090020
001000                                                                  00100020
001100******************************************************************00110020
001200* THIS PROGRAM WILL DETERMINE IF THE UNITS HAVE BEEN SATISFIED    00120020
001300* FOR A TRIGGER OF CONFIRMATION/VERIFICATION.                     00130020
001400******************************************************************00140020
001500                                                                  00150020
001600******************************************************************00160020
001700 ENVIRONMENT DIVISION.                                            00170020
001800******************************************************************00180020
001900                                                                  00190020
002000******************************************************************00200020
002100 DATA DIVISION.                                                   00210020
002200******************************************************************00220020
002300                                                                  00230020
002400******************************************************************00240020
002500 WORKING-STORAGE SECTION.                                         00250020
002600******************************************************************00260020
002700                                                                  00270020
002800                                                                  00280020
002900******************************************************************00290020
003000*      THIS COPYBOOK IS USED FOR THE VERIFICATION ELIGIBILITY    *00300020
003100*  MODULE.  THIS MODULE WILL BE USED TO DETERMINE IF AN ORDER    *00310020
003200*  CAN BE VERIFIED.  (RCKUT124)                                  *00320020
003300******************************************************************00330020
003400     COPY RCWS038.                                                00340020
003500*---------------------------------------------------------------* 00350020
003600*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00360020
003700*  THE AUTO CONFIRMATION MODULE (RCKUT125).                     * 00370020
003800*---------------------------------------------------------------* 00380020
003900     COPY RCWS041.                                                00390020
004000                                                                  00400020
004100*---------------------------------------------------------------* 00410020
004200*  RECORD LAYOUT FOR THE COMMAREA BEING USED TO PASS DATA TO    * 00420020
004300*  THE VERIFICATION TRANSACTION (PCKCS200).                     * 00430020
004400*---------------------------------------------------------------* 00440020
004500     COPY RCWS289.                                                00450020
004600                                                                  00460020
004700*----------------------------------------------------------------*00470020
004800**  SECURITY SUBROUTINE PARAMETERS                                00480020
004900*----------------------------------------------------------------*00490020
005000     COPY DPWS008.                                                00500020
005100                                                                  00510020
005200                                                                  00520020
005300*                                                                 00530020
005400 01  DK-DB2-KEYS.                                                 00540020
005500     05  DK-PO-NBR                       PIC S9(09) COMP SYNC.    00550020
005600     05  DK-REC-SEQ-NBR                  PIC S9(09) COMP SYNC.    00560020
005700     05  DK-PO-LNE-NBR                   PIC S9(09) COMP.         00570020
005800     05  DK-PO-LNE-NBR-2                 PIC S9(09) COMP.         00580020
005900     05  DK-PREPK-ID                     PIC S9(04) COMP.         00590020
006000     05  DK-OPER-UNT-ID                  PIC S9(04) COMP.         00600020
006100     05  DK-FCLTY-ID                     PIC S9(04) COMP.         00610020
006200                                                                  00620020
006300 01  PC-PROGRAM-CONSTANTS.                                        00630020
006400     05  PC-DEFAULT-TMST           PIC X(26)  VALUE               00640020
006500                                  '9999-09-09-09.09.09.999999'.   00650020
006600     05  PC-CURRENT-PROGRAM-NAME   PIC X(08)  VALUE 'SUKCS764'.   00660020
006700     05  PC-LOGGING-PROGRAM-NAME   PIC X(08)  VALUE 'SUKPV702'.   00670020
006800     05  PC-VERIF-ELIGIBILITY-PGM  PIC X(08)  VALUE 'RCKUT124'.   00680020
006900     05  PC-FULLCASE-CONFIRM-PGM   PIC X(08)  VALUE 'RCKUT125'.   00690020
007000     05  PC-AUTOVE-PARM-PROGRAM    PIC X(08)  VALUE 'RCKUT127'.   00700020
007100     05  PC-DEFAULT-DATE           PIC X(10)  VALUE '9999-09-09'. 00710020
007200                                                                  00720020
007300                                                                  00730020
007400 01  PS-PROGRAM-SWITCHES.                                         00740020
007500     05  PS-ERROR-SW                    PIC  X(01)  VALUE  'N'.   00750020
007600         88  PS-NO-ERROR                            VALUE  'N'.   00760020
007700         88  PS-ERROR                               VALUE  'Y'.   00770020
007800     05  PS-LOG-MESSAGE-SW              PIC  X       VALUE 'N'.   00780020
007900         88  PS-LOG-MESSAGE                          VALUE 'Y'.   00790020
008000         88  PS-NO-LOG-MESSAGE                       VALUE 'N'.   00800020
008100     05  PS-BEFORE-ONLY-LOGGING-SW      PIC  X       VALUE 'N'.   00810020
008200         88  PS-BEFORE-ONLY-LOGGING                  VALUE 'Y'.   00820020
008300         88  PS-NOT-BEFORE-ONLY-LOGGING              VALUE 'N'.   00830020
008400                                                                  00840020
008500 01  PV-PROGRAM-VARIABLES.                                        00850020
008600     05  PV-DB2-VRTL-LABEL-COUNT         PIC S9(09)   VALUE +0    00860020
008700                                                      COMP-3.     00870020
008800     05  PV-DB2-PBS-COUNT                PIC S9(09)   VALUE +0    00880020
008900                                                      COMP-3.     00890020
009000     05  PV-NULL-IND                    PIC S9(04)  VALUE +0      00900020
009100                                                    COMP SYNC.    00910020
009200     05  PV-RACF-FUNCTION-NAME          PIC  X(08).               00920020
009300     05  PV-CICS-MSG-AREA                PIC  X(100) VALUE SPACE. 00930020
009400     05  PV-NOTIF-NBR                    PIC S9(9) VALUE ZERO     00940020
009500                                                COMP SYNC.        00950020
009600     05  PV-CURRENT-TIMESTAMP            PIC X(26)   VALUE SPACES.00960020
009700     05  PV-FROM-PARAGRAPH               PIC X(35) VALUE SPACES.  00970020
009800     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     00980020
009900                                                COMP SYNC.        00990020
010000     05  PV-CICS-RESPONSE                PIC S9(04)  VALUE +0     01000020
010100                                                COMP SYNC.        01010020
010200     05  PV-DISPLAY-SQLCODE              PIC -9(05) VALUE ZEROES. 01020020
010300     05  PV-DISP-SHIPT-UNT-ID            PIC 9(18).               01030020
010400     05  PV-DISP-PO                      PIC 9(09).               01040020
010500     05  PV-DISP-RCVR-SEQ-NBR            PIC 9(04).               01050020
010600     05  PV-DISP-OPER-UNT-ID             PIC   9(04).             01060020
010700     05  PV-DISPLAY-CICS-RESP            PIC 999999999-           01070020
010800                                                 VALUE ZEROS.     01080020
010900                                                                  01090020
011000*----------------------------------------------------------------*01100020
011100     EXEC SQL                                                     01110020
011200          INCLUDE TKRPRPM                                         01120020
011300     END-EXEC.                                                    01130020
011400*----------------------------------------------------------------*01140020
011500*    SQL AND COBOL DECLARATIONS FOR THE RECEIVER TABLE (TRECEIV)  01150020
011600*----------------------------------------------------------------*01160020
011700     EXEC SQL                                                     01170020
011800          INCLUDE TRECEIV                                         01180020
011900     END-EXEC.                                                    01190020
012000*----------------------------------------------------------------*01200020
012100*  SQL AND COBOL DECLARATIONS FOR THE PKSLIP TABLE                01210020
012200*----------------------------------------------------------------*01220020
012300     EXEC SQL                                                     01230020
012400          INCLUDE TPKSLIP                                         01240020
012500     END-EXEC.                                                    01250020
012600*----------------------------------------------------------------*01260020
012700*  SQL AND COBOL DECLARATIONS                                     01270020
012800*----------------------------------------------------------------*01280020
012900     EXEC SQL                                                     01290020
013000          INCLUDE TINPKSU                                         01300020
013100     END-EXEC.                                                    01310020
013200*----------------------------------------------------------------*01320020
013300*  SQL AND COBOL DECLARATIONS FOR THE SHIPPING UNIT TABLE         01330020
013400*----------------------------------------------------------------*01340020
013500     EXEC SQL                                                     01350020
013600          INCLUDE TSHPUNT                                         01360020
013700     END-EXEC.                                                    01370020
013800*----------------------------------------------------------------*01380020
013900*  SQL AND COBOL DECLARATIONS FOR THE SHIPPING UNIT LOCATION TABLE01390020
014000*----------------------------------------------------------------*01400020
014100     EXEC SQL                                                     01410020
014200          INCLUDE TSHUNLO                                         01420020
014300     END-EXEC.                                                    01430020
014400*----------------------------------------------------------------*01440020
014500*  SQL AND COBOL DECLARATIONS FOR THE VIRTUAL LABEL DATE TABLE    01450020
014600*----------------------------------------------------------------*01460020
014700     EXEC SQL                                                     01470020
014800          INCLUDE TLBVRDA                                         01480020
014900     END-EXEC.                                                    01490020
015000******************************************************************01500020
015100*----------------------------------------------------------------*01510020
015200*  SQL AND COBOL DECLARATIONS FOR THE DISTRIBUTION HEADER TABLE   01520020
015300*----------------------------------------------------------------*01530020
015400     EXEC SQL                                                     01540020
015500          INCLUDE TDISTHD                                         01550020
015600     END-EXEC.                                                    01560020
015700*----------------------------------------------------------------*01570020
015800*  SQL AND COBOL DECLARATIONS FOR THE CROSS REF TABLE             01580020
015900*----------------------------------------------------------------*01590020
016000     EXEC SQL                                                     01600020
016100          INCLUDE TSULBXF                                         01610020
016200     END-EXEC.                                                    01620020
016300******************************************************************01630020
016400******************************************************************01640020
016500*  COMMUNICATIONS AREA FOR DB2                                    01650020
016600******************************************************************01660020
016700     EXEC SQL                                                     01670020
016800         INCLUDE SQLCA                                            01680020
016900     END-EXEC.                                                    01690020
017000                                                                  01700020
017100******************************************************************01710020
017200 LINKAGE SECTION.                                                 01720020
017300 01  DFHCOMMAREA.                                                 01730020
017400     05  FILLER                         OCCURS  1 TO 4072 TIMES   01740020
017500                                      DEPENDING ON EIBCALEN.      01750020
017600         10  FILLER                   PIC X.                      01760020
017700******************************************************************01770020
017800                                                                  01780020
017900******************************************************************01790020
018000 PROCEDURE DIVISION.                                              01800020
018100******************************************************************01810020
018200 0000-PROGRAM-MAINLINE.                                           01820020
018300                                                                  01830020
018400     MOVE LENGTH RC041-FIELDS TO PV-COMMAREA-LENGTH.              01840020
018500                                                                  01850020
018600     EXEC CICS                                                    01860020
018700         RETRIEVE                                                 01870020
018800         INTO(RC041-FIELDS)                                       01880020
018900         LENGTH(PV-COMMAREA-LENGTH)                               01890020
019000         RESP(PV-CICS-RESPONSE)                                   01900020
019100     END-EXEC.                                                    01910020
019200                                                                  01920020
019300     SET PS-NO-ERROR TO TRUE.                                     01930020
019400                                                                  01940020
019500     MOVE RC041-OPER-UNT-ID TO DK-OPER-UNT-ID.                    01950020
019600                                                                  01960020
019700     PERFORM 9300-CHECK-LOGGING.                                  01970020
019800                                                                  01980020
019900     IF KRPRPM-FUNC-TXT = 'Y'                                     01990020
020000         MOVE RC041-PO-NBR    TO  PV-DISP-PO                      02000020
020100         MOVE RC041-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR         02010020
020200         STRING   ' SUKCS764-START'                               02020020
020300                  ' CALLED BY-'                                   02030020
020400                  RC041-PROGRAM-NAME                              02040020
020500                  ' PO='                                          02050020
020600                  PV-DISP-PO                                      02060020
020700                  ' RCVR='                                        02070020
020800                  PV-DISP-RCVR-SEQ-NBR                            02080020
020900                  DELIMITED BY SIZE                               02090020
021000                              INTO PV-CICS-MSG-AREA               02100020
021100         PERFORM 9999-WRITE-TO-CSSL                               02110020
021200     END-IF.                                                      02120020
021300                                                                  02130020
021400                                                                  02140020
021500     IF PV-CICS-RESPONSE = DFHRESP(NORMAL)                        02150020
021600        PERFORM 1000-PROCESS-CONF-VERFY                           02160020
021700     END-IF                                                       02170020
021800                                                                  02180020
021900     EXEC CICS                                                    02190020
022000         RETURN                                                   02200020
022100     END-EXEC.                                                    02210020
022200                                                                  02220020
022300     GOBACK.                                                      02230020
022400                                                                  02240020
022500 1000-PROCESS-CONF-VERFY.                                         02250020
022600                                                                  02260020
022700     SET  PS-NO-ERROR            TO TRUE.                         02270020
022800     MOVE RC041-PO-NBR           TO DK-PO-NBR.                    02280020
022900     MOVE RC041-REC-SEQ-NBR      TO DK-REC-SEQ-NBR.               02290020
023000     MOVE RC041-PO-LNE-NBR       TO DK-PO-LNE-NBR                 02300020
023100                                    DK-PO-LNE-NBR-2.              02310020
023200     MOVE RC041-PREPACK-ID       TO DK-PREPK-ID.                  02320020
023300     SET  RC041-VERIFY-YES                                        02330020
023400          RC041-PROCESS-BY-LINE  TO TRUE.                         02340020
023500                                                                  02350020
023600     EVALUATE TRUE                                                02360020
023700         WHEN RC041-BULK-CASE                                     02370020
023800         WHEN RC041-PREPACK                                       02380020
023900             PERFORM 2000-PROCESS-BULK-CASE                       02390020
024000             IF RC041-SUCCESSFUL                                  02400021
024100               IF PV-DB2-VRTL-LABEL-COUNT = 0                     02410036
024200                  PERFORM 3400-DISTHD-CONFIRM-TMST                02420021
024300                  IF DISTHD-FCSE-CNFRMN-TMST = PC-DEFAULT-TMST    02430021
024400                     PERFORM 3500-CONFIRM-MODULE                  02440021
024500                  END-IF                                          02450021
024600               END-IF                                             02460021
024700             END-IF                                               02470021
024800         WHEN RC041-PBS                                           02480021
024900             PERFORM 3000-PROCESS-PBS                             02490021
025000             IF RC041-SUCCESSFUL                                  02500021
025100               IF PV-DB2-PBS-COUNT = 0                            02510025
025200                  PERFORM 4000-VEM-MODULE                         02520021
025300                  IF RC038-VERIFY-YES                             02530021
025400                     PERFORM 5000-START-VERIFY-MODULE             02540021
025500                  END-IF                                          02550021
025600               END-IF                                             02560021
025700             END-IF                                               02570021
025800     END-EVALUATE.                                                02580020
025900                                                                  02590020
026000                                                                  02600020
026100 2000-PROCESS-BULK-CASE.                                          02610020
026200                                                                  02620020
026300     IF RC041-PREPACK                                             02630020
026400        MOVE ZEROES TO DK-PO-LNE-NBR                              02640020
026500     END-IF.                                                      02650020
026600                                                                  02660020
026700     MOVE ZEROES           TO PV-DB2-VRTL-LABEL-COUNT.            02670036
026800                                                                  02680020
026900     EXEC SQL                                                     02690020
027000*       SELECT COUNT(*)                                           02700040
027100        SELECT 1                                                  02710036
027200        INTO   :PV-DB2-VRTL-LABEL-COUNT                           02720036
027300        FROM TLBVRDA A                                            02730020
027400        WHERE  A.PO_NBR                =  :DK-PO-NBR              02740020
027500          AND  A.RCVR_SEQ_NBR          =  :DK-REC-SEQ-NBR         02750020
027600          AND  A.PO_LNE_NBR            =  :DK-PO-LNE-NBR          02760020
027700          AND  A.PREPK_ID              =  :DK-PREPK-ID            02770020
027800          AND  A.LBL_ASG_IND           =  'N'                     02780020
027900          AND  A.LBL_TYP_CDE           =  'M'                     02790020
028000          AND  A.CART_LBL_TYP_CDE  <> 'P'                         02800020
028100               FETCH FIRST 1 ROW ONLY                             02810031
028200          WITH UR                                                 02820038
028300     END-EXEC.                                                    02830020
028400                                                                  02840020
028500     EVALUATE TRUE                                                02850020
028600         WHEN SQLCODE = ZERO                                      02860020
028700              CONTINUE                                            02870020
028710         WHEN SQLCODE = +100                                      02871042
028720              MOVE 0  TO  PV-DB2-VRTL-LABEL-COUNT                 02872041
028800         WHEN SQLWARN0 NOT = SPACES                               02880020
028900         WHEN SQLCODE  NOT = ZERO                                 02890020
029000             SET RC041-INVALID-SQL     TO TRUE                    02900020
029100             MOVE SQLCODE              TO PV-DISPLAY-SQLCODE      02910022
029200             MOVE RC041-PO-NBR    TO  PV-DISP-PO                  02920020
029300             MOVE RC041-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR     02930020
029400             STRING   ' SUKCS764-2000-'                           02940020
029500                      ' CALLED BY-'                               02950020
029600                      RC041-PROGRAM-NAME                          02960020
029700                      ' PO='                                      02970020
029800                      PV-DISP-PO                                  02980020
029900                      ' RCVR='                                    02990020
030000                      PV-DISP-RCVR-SEQ-NBR                        03000020
030100                      'SQLCODE = '                                03010022
030200                      PV-DISPLAY-SQLCODE                          03020022
030300                      DELIMITED BY SIZE                           03030020
030400                                      INTO PV-CICS-MSG-AREA       03040020
030500             PERFORM 9999-WRITE-TO-CSSL                           03050020
030600             MOVE PV-CICS-MSG-AREA      TO RC041-CRA-RET-MSG      03060020
030700             SET RC041-INVALID-SQL      TO TRUE                   03070020
030800     END-EVALUATE.                                                03080020
030900                                                                  03090020
031000 3000-PROCESS-PBS.                                                03100020
031100                                                                  03110020
031200     MOVE ZEROES           TO PV-DB2-PBS-COUNT.                   03120020
031300                                                                  03130020
031400     EXEC SQL                                                     03140020
031500        SELECT 1                                                  03150024
031600        INTO  :PV-DB2-PBS-COUNT                                   03160020
031700        FROM TPKSLIP A                                            03170020
031800           , TINPKSU B                                            03180020
031900           , TSHPUNT C                                            03190020
032000        WHERE  A.PO_NBR                =  :DK-PO-NBR              03200020
032100          AND  A.REC_SEQ_NBR           =  :DK-REC-SEQ-NBR         03210020
032200          AND  A.VER_STAT_CDE          =  'A'                     03220020
032300          AND  A.PO_NBR                =  B.PO_NBR                03230020
032400          AND  A.SEQ_NBR               =  B.SEQ_NBR               03240020
032500          AND  B.SHIPT_UNT_ID          =  C.SHIPT_UNT_ID          03250020
032600          AND  C.ACTV_IND              =  'A'                     03260020
032700          AND  NOT EXISTS                                         03270020
032800               (SELECT D.SHIPT_UNT_ID                             03280020
032900                FROM   TSHUNLO  D                                 03290020
033000                   ,   TSULBXF  E                                 03300020
033100                WHERE B.SHIPT_UNT_ID   =  D.SHIPT_UNT_ID          03310020
033200                  AND   B.SHIPT_UNT_ID   =  E.SHIPT_UNT_ID        03320020
033300                  AND SCN_LOC_ID         = 'RECV'                 03330020
033400                  AND ACTV_CDE           = 'A' )                  03340020
033500               FETCH FIRST 1 ROW ONLY                             03350024
033600          WITH UR                                                 03360038
033700     END-EXEC.                                                    03370020
033800                                                                  03380020
033900     EVALUATE TRUE                                                03390020
034000         WHEN SQLCODE = ZERO                                      03400020
034100         WHEN SQLCODE = +100                                      03410026
034200              CONTINUE                                            03420020
034300         WHEN SQLWARN0 NOT = SPACES                               03430020
034400         WHEN SQLCODE  NOT = ZERO                                 03440020
034500             SET RC041-INVALID-SQL     TO TRUE                    03450020
034600             MOVE SQLCODE              TO PV-DISPLAY-SQLCODE      03460023
034700             MOVE RC041-PO-NBR    TO  PV-DISP-PO                  03470020
034800             MOVE RC041-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR     03480020
034900             STRING   ' SUKCS764-3000-'                           03490021
035000                      ' CALLED BY-'                               03500020
035100                      RC041-PROGRAM-NAME                          03510020
035200                      ' PO='                                      03520020
035300                      PV-DISP-PO                                  03530020
035400                      ' RCVR='                                    03540020
035500                      PV-DISP-RCVR-SEQ-NBR                        03550020
035600                      'SQLCODE = '                                03560023
035700                      PV-DISPLAY-SQLCODE                          03570023
035800                      DELIMITED BY SIZE                           03580020
035900                                      INTO PV-CICS-MSG-AREA       03590020
036000             PERFORM 9999-WRITE-TO-CSSL                           03600020
036100             MOVE PV-CICS-MSG-AREA      TO RC041-CRA-RET-MSG      03610020
036200             SET RC041-INVALID-SQL      TO TRUE                   03620020
036300     END-EVALUATE.                                                03630020
036400                                                                  03640020
036500 3400-DISTHD-CONFIRM-TMST.                                        03650020
036600                                                                  03660020
036700                                                                  03670020
036800     EXEC SQL                                                     03680020
036900        SELECT FCSE_CNFRMN_TMST                                   03690020
037000        INTO  :DISTHD-FCSE-CNFRMN-TMST                            03700020
037100        FROM TDISTHD A                                            03710020
037200        WHERE ORD_NBR                  = :DK-PO-NBR               03720020
037300          AND RCVR_SEQ_NBR             = :DK-REC-SEQ-NBR          03730020
037400          AND ORD_LNE_NBR              = :DK-PO-LNE-NBR-2         03740020
037500          WITH UR                                                 03750020
037600     END-EXEC.                                                    03760020
037700                                                                  03770020
037800     EVALUATE TRUE                                                03780020
037900         WHEN SQLCODE = ZERO                                      03790020
038000         WHEN SQLCODE = +100                                      03800020
038100              CONTINUE                                            03810020
038200         WHEN SQLWARN0 NOT = SPACES                               03820020
038300         WHEN SQLCODE  NOT = ZERO                                 03830020
038400             SET RC041-INVALID-SQL     TO TRUE                    03840020
038500             MOVE RC041-PO-NBR    TO  PV-DISP-PO                  03850020
038600             MOVE RC041-REC-SEQ-NBR   TO PV-DISP-RCVR-SEQ-NBR     03860020
038700             STRING   ' SUKCS764-3400-'                           03870020
038800                      ' CALLED BY-'                               03880020
038900                      RC041-PROGRAM-NAME                          03890020
039000                      ' PO='                                      03900020
039100                      PV-DISP-PO                                  03910020
039200                      ' RCVR='                                    03920020
039300                      PV-DISP-RCVR-SEQ-NBR                        03930020
039400                      DELIMITED BY SIZE                           03940020
039500                                      INTO PV-CICS-MSG-AREA       03950020
039600             PERFORM 9999-WRITE-TO-CSSL                           03960020
039700             MOVE PV-CICS-MSG-AREA      TO RC041-CRA-RET-MSG      03970020
039800             SET RC041-INVALID-SQL      TO TRUE                   03980020
039900     END-EVALUATE.                                                03990020
040000                                                                  04000020
040100 3500-CONFIRM-MODULE.                                             04010020
040200                                                                  04020020
040300     MOVE LENGTH OF RC041-FIELDS    TO PV-COMMAREA-LENGTH.        04030020
040400                                                                  04040020
040500     EXEC CICS                                                    04050020
040600         LINK PROGRAM  (PC-FULLCASE-CONFIRM-PGM)                  04060020
040700              COMMAREA (RC041-FIELDS)                             04070020
040800              LENGTH   (PV-COMMAREA-LENGTH)                       04080020
040900              RESP     (PV-CICS-RESPONSE)                         04090020
041000     END-EXEC.                                                    04100020
041100                                                                  04110020
041200     EVALUATE TRUE                                                04120020
041300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04130020
041400             IF  RC041-INVALID-SQL     OR                         04140020
041500                 RC041-DATABASE-BUSY                              04150020
041600                 STRING ' SUKCS764 - '        DELIMITED BY SIZE   04160020
041700                        '3500-CONFIRM-MODULE' DELIMITED BY SIZE   04170020
041800                        ' RETURN MESSAGE - '  DELIMITED BY SIZE   04180020
041900                        RC041-SUCCESS-IND     DELIMITED BY SIZE   04190020
042000                                         INTO RC038-CRA-RET-MSG   04200020
042100                 PERFORM 9999-WRITE-TO-CSSL                       04210020
042200                 SET RC041-NOT-SUCCESSFUL TO TRUE                 04220020
042300                                                                  04230020
042400             END-IF                                               04240020
042500         WHEN OTHER                                               04250020
042600             STRING ' RCKUT125 (OTHER) -' DELIMITED BY SIZE       04260020
042700                    '3500-CONFIRM-MODULE' DELIMITED BY SIZE       04270020
042800                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       04280020
042900                    RC041-SUCCESS-IND     DELIMITED BY SIZE       04290020
043000                                         INTO RC038-CRA-RET-MSG   04300020
043100             PERFORM 9999-WRITE-TO-CSSL                           04310020
043200             SET RC041-NOT-SUCCESSFUL TO TRUE                     04320020
043300                                                                  04330020
043400     END-EVALUATE.                                                04340020
043500                                                                  04350020
043600 4000-VEM-MODULE.                                                 04360020
043700                                                                  04370020
043800     INITIALIZE RC038-FIELDS.                                     04380020
043900     MOVE RC041-PO-NBR              TO RC038-PO-NBR               04390020
044000     MOVE RC041-REC-SEQ-NBR         TO RC038-REC-SEQ-NBR          04400020
044100     MOVE RC041-PO-LNE-NBR          TO RC038-PO-LNE-NBR           04410020
044200     MOVE RC041-PREPACK-ID          TO RC038-PREPACK-ID           04420020
044300     MOVE RC041-OPER-UNT-ID         TO RC038-OPER-UNT-ID          04430020
044400     MOVE RC041-FCLTY-ID            TO RC038-FCLTY-ID             04440020
044500     MOVE RC041-PKGNG-CDE           TO RC038-PKGNG-CDE            04450020
044600     MOVE RC041-PBS-IND             TO RC038-PBS-IND              04460020
044700     MOVE RC041-USER-ID             TO RC038-USER-ID              04470020
044800     MOVE RC041-PROGRAM-NAME        TO RC038-PROGRAM-NAME         04480020
044900     MOVE RC041-VERIFY-SW           TO RC038-VERIFY-SW            04490020
045000     MOVE RC041-RCVR-OPER-UNT-ID    TO RC038-RCVR-OPER-UNT-ID     04500020
045100     SET  RC041-PROCESS-BY-RCVR     TO TRUE                       04510020
045200                                                                  04520020
045300     MOVE LENGTH OF RC038-FIELDS         TO PV-COMMAREA-LENGTH.   04530020
045400                                                                  04540020
045500     EXEC CICS                                                    04550020
045600         LINK PROGRAM  (PC-VERIF-ELIGIBILITY-PGM)                 04560020
045700              COMMAREA (RC038-FIELDS)                             04570020
045800              LENGTH   (PV-COMMAREA-LENGTH)                       04580020
045900              RESP     (PV-CICS-RESPONSE)                         04590020
046000     END-EXEC.                                                    04600020
046100                                                                  04610020
046200     EVALUATE TRUE                                                04620020
046300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04630020
046400             IF  RC038-INVALID-SQL     OR                         04640020
046500                 RC038-DATABASE-BUSY                              04650020
046600                 STRING ' RCKUT124 - '        DELIMITED BY SIZE   04660020
046700                        '4000-VEM-MODULE  '   DELIMITED BY SIZE   04670020
046800                        ' RETURN MESSAGE - '  DELIMITED BY SIZE   04680020
046900                        RC038-SUCCESS-IND     DELIMITED BY SIZE   04690020
047000                                         INTO RC038-CRA-RET-MSG   04700020
047100                 PERFORM 9999-WRITE-TO-CSSL                       04710020
047200                 SET RC038-NOT-SUCCESSFUL TO TRUE                 04720020
047300                                                                  04730020
047400             END-IF                                               04740020
047500         WHEN OTHER                                               04750020
047600             STRING ' RCKUT124 (OTHER) -' DELIMITED BY SIZE       04760020
047700                    '4000-VEM-MODULE  '   DELIMITED BY SIZE       04770020
047800                    ' RETURN MESSAGE - '  DELIMITED BY SIZE       04780020
047900                    RC038-SUCCESS-IND     DELIMITED BY SIZE       04790020
048000                                         INTO RC038-CRA-RET-MSG   04800020
048100             PERFORM 9999-WRITE-TO-CSSL                           04810020
048200             SET RC038-NOT-SUCCESSFUL TO TRUE                     04820020
048300                                                                  04830020
048400     END-EVALUATE.                                                04840020
048500                                                                  04850020
048600*----------------------------------------------------------------*04860020
048700 5000-START-VERIFY-MODULE.                                        04870020
048800     INITIALIZE RC289-COMMAREA-FOR-E200.                          04880020
048900                                                                  04890020
049000     MOVE DK-PO-NBR              TO RC289-ORD-NBR.                04900020
049100     MOVE DK-REC-SEQ-NBR         TO RC289-RCVR-SEQ-NBR.           04910020
049200     MOVE DK-PO-LNE-NBR          TO RC289-ORD-LNE-NBR.            04920020
049300     MOVE RC041-PROGRAM-NAME     TO RC289-CALLING-PROGRAM.        04930020
049400     SET  RC289-VERIF-CHECK-IN   TO TRUE.                         04940020
049500                                                                  04950020
049600     EXEC CICS                                                    04960020
049700          START TRANSID ('E200')                                  04970020
049800               FROM (RC289-COMMAREA-FOR-E200)                     04980020
049900     END-EXEC.                                                    04990020
050000                                                                  05000020
050100 9300-CHECK-LOGGING.                                              05010020
050200     EXEC SQL                                                     05020020
050300         SELECT FUNC_TXT                                          05030020
050400           INTO :KRPRPM-FUNC-TXT                                  05040020
050500           FROM TKRPRPM                                           05050020
050600          WHERE SYS_PRC_FUNC_CDE  = 'SU764D'                      05060020
050700            AND LOC_ID            = :DK-OPER-UNT-ID               05070020
050800            AND INTFC_SYS_CDE     = 'KHL'                         05080020
050900            AND FUNC_PRC_STAT_CDE = 'AC'                          05090020
051000            WITH UR                                               05100038
051100     END-EXEC.                                                    05110020
051200                                                                  05120020
051300     EVALUATE TRUE                                                05130020
051400         WHEN SQLCODE = ZERO                                      05140020
051500         WHEN SQLCODE = +100                                      05150020
051600              CONTINUE                                            05160020
051700         WHEN SQLWARN0 NOT = SPACE                                05170020
051800         WHEN SQLCODE NOT = ZERO                                  05180020
051900             SET PS-ERROR                                         05190020
052000                 RC041-INVALID-SQL    TO TRUE                     05200020
052100             MOVE SQLCODE             TO PV-DISPLAY-SQLCODE       05210020
052200             MOVE DK-OPER-UNT-ID      TO PV-DISP-OPER-UNT-ID      05220020
052300             STRING   ' SUKCS764-9300-'                           05230020
052400                      ' CALLED BY-'                               05240020
052500                      RC041-PROGRAM-NAME                          05250020
052600                      '  SQLCODE='                                05260020
052700                      PV-DISPLAY-SQLCODE                          05270020
052800                      ' OPER = '                                  05280020
052900                      PV-DISP-OPER-UNT-ID                         05290020
053000                      DELIMITED BY SIZE                           05300020
053100                                      INTO RC041-CRA-RET-MSG      05310020
053200             MOVE RC041-CRA-RET-MSG       TO PV-CICS-MSG-AREA     05320020
053300             PERFORM 9999-WRITE-TO-CSSL                           05330020
053400     END-EVALUATE.                                                05340020
053500                                                                  05350020
053600                                                                  05360020
053700*-----------------------------------------------------------------05370020
053800*  RETURN TO CALLING PROGRAM                                      05380020
053900*-----------------------------------------------------------------05390020
054000 9998-RETURN.                                                     05400020
054100                                                                  05410020
054200     MOVE SQLCA                         TO RC041-SQLCA            05420020
054300                                           PV-CICS-MSG-AREA.      05430020
054400     PERFORM 9999-WRITE-TO-CSSL.                                  05440020
054500     MOVE RC041-FIELDS                  TO DFHCOMMAREA.           05450020
054600                                                                  05460020
054700     EXEC CICS                                                    05470020
054800          RETURN                                                  05480020
054900     END-EXEC.                                                    05490020
055000                                                                  05500020
055100 9999-WRITE-TO-CSSL.                                              05510020
055200                                                                  05520020
055300     MOVE LENGTH OF PV-CICS-MSG-AREA  TO PV-COMMAREA-LENGTH.      05530020
055400                                                                  05540020
055500     EXEC CICS                                                    05550020
055600          WRITEQ TD                                               05560020
055700           QUEUE   ('CSSL')                                       05570020
055800            FROM   (PV-CICS-MSG-AREA)                             05580020
055900          LENGTH   (PV-COMMAREA-LENGTH)                           05590020
056000            RESP   (PV-CICS-RESPONSE)                             05600020
056100     END-EXEC.                                                    05610020
056200                                                                  05620020
