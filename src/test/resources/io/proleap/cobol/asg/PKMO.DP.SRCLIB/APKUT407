000100 IDENTIFICATION DIVISION.                                         00010018
000200 PROGRAM-ID.     APKUT407.                                        00020018
000300 AUTHOR.         JILL JUEL.                                       00030018
000400 DATE-WRITTEN.   JUNE 19, 2000.                                   00040018
000500 DATE-COMPILED.                                                   00050018
000600*************************************************************     00060018
000700*    COBOL 2                                                *     00070018
000800*                                                           *     00080018
000900*    THIS PROGRAM BUMPS THE TMIITEM/TPREQIT MERGED FILE     *     00090018
001000*    AND THE UNLOAD OF TVNDINV TABLE TO CREATE THE PO       *     00100018
001100*    DETAIL FILE.                                           *     00110018
001200*                                                           *     00120018
001300* INPUT:                                                    *     00130018
001400* 1.  TMIITEM/TPREQIT MERGED FILE                           *     00140018
001500* 2.  TVNDINV UNLOAD FILE                                   *     00150018
001600*                                                           *     00160018
001700* OUTPUT:                                                   *     00170018
001800* 1.  PO DETAIL FILE                                        *     00180018
001900*                                                           *     00190018
002000*************************************************************     00200018
002100* CHANGE LOG:                                               *     00210018
002200*                                                           *     00220018
002300* 06/19/2000  INITIAL VERSION.                              *     00230018
002400* 10/03/2000  JILL JUEL                       WR# 20741     *     00240018
002500*       ADDED CODE TO MATCH RECORDS BY PAYT-REQ-LNE-NBR.    *     00250018
002600*                                                           *     00260018
002700*  DATE  05/02/2003                                         *     00270018
002800*      CHANGE MADE: CHANGE NEEDED FOR ARK PO NI-SKU.        *     00280018
002900*      REMOVED DEPT-NBR, CL-CDE, AND SKU-SEQ-NBR FROM       *     00290018
003000*      APRD407 COPYBOOK AND THIS PROGRAM.                   *     00300018
003100*      MADE BY: ROLLIN KRING            WR/IR #: WR22557    *     00310018
003200*                                                           *     00320021
003300*  DATE  06/13/2003                                         *     00330021
003400*      CHANGE MADE: MODIFIED CODE TO NOT BYPASS RECORDS THAT*     00340021
003500*      DO NOT HAVE A MATCH FROM THE TVNDINV INPUT FILE.     *     00350021
003600*      THE TVNDINV DATABASE DOES NOT HAS A ROW FOR EVERY    *     00360021
003700*      TMIITEM/TPREQIT ROW.  NOW WHEN THIS SITUATION OCCURS *     00370021
003800*      IN THE MERGING OF THESE FILES THE TMIITEM/TPREQIT    *     00380021
003900*      WILL BE MOVED TO THE OUTPUT RECORD LAYOUT AND WRITTEN*     00390021
004000*      TO THE OUTPUT FILE.                                  *     00400021
004100*      MADE BY: MIKE BESKE              WR/IR #: WR24481    *     00410021
004200*************************************************************     00420018
004300                                                                  00430018
004400 ENVIRONMENT DIVISION.                                            00440018
004500                                                                  00450018
004600 INPUT-OUTPUT SECTION.                                            00460018
004700                                                                  00470018
004800 FILE-CONTROL.                                                    00480018
004900                                                                  00490018
005000     SELECT INPUT-MERGE-FILE                                      00500018
005100         ASSIGN TO UT-S-INP01.                                    00510018
005200                                                                  00520018
005300     SELECT INPUT-TVNDINV-FILE                                    00530018
005400         ASSIGN TO UT-S-INP02.                                    00540018
005500                                                                  00550018
005600     SELECT PO-DETAIL-FILE                                        00560018
005700         ASSIGN TO UT-S-OUT01.                                    00570018
005800                                                                  00580018
005900 DATA DIVISION.                                                   00590018
006000                                                                  00600018
006100 FILE SECTION.                                                    00610018
006200                                                                  00620018
006300 FD  INPUT-MERGE-FILE                                             00630018
006400     LABEL RECORDS  ARE STANDARD                                  00640018
006500     RECORDING MODE IS  F                                         00650018
006600     RECORD CONTAINS 33 CHARACTERS                                00660018
006700     BLOCK CONTAINS 0 RECORDS.                                    00670018
006800 01  INPUT-MERGE-RECORD          PIC X(33).                       00680018
006900                                                                  00690018
007000 FD  INPUT-TVNDINV-FILE                                           00700018
007100     LABEL RECORDS  ARE STANDARD                                  00710018
007200     RECORDING MODE IS  F                                         00720018
007300     RECORD CONTAINS 136 CHARACTERS                               00730018
007400     BLOCK CONTAINS 0 RECORDS.                                    00740018
007500 01  INPUT-TVNDINV-RECORD        PIC X(136).                      00750018
007600                                                                  00760018
007700 FD  PO-DETAIL-FILE                                               00770018
007800     LABEL RECORDS  ARE STANDARD                                  00780018
007900     RECORDING MODE IS  F                                         00790018
008000     RECORD CONTAINS 161 CHARACTERS                               00800018
008100     BLOCK CONTAINS 0 RECORDS.                                    00810018
008200 01  PO-DETAIL-RECORD            PIC X(161).                      00820018
008300                                                                  00830018
008400***************************                                       00840018
008500 WORKING-STORAGE SECTION.                                         00850018
008600***************************                                       00860018
008700 01  WS-SWITCH-AREA.                                              00870018
008800     05  WS-MERGE-EOF-SW              PIC X(01)  VALUE 'N'.       00880018
008900         88  MERGE-EOF                           VALUE 'Y'.       00890018
009000         88  NOT-MERGE-EOF                       VALUE 'N'.       00900018
009100     05  WS-TVNDINV-EOF-SW            PIC X(01)  VALUE 'N'.       00910018
009200         88  TVNDINV-EOF                         VALUE 'Y'.       00920018
009300         88  NOT-TVNDINV-EOF                     VALUE 'N'.       00930018
009400                                                                  00940018
009500 01  WS-PROGRAM-COUNTERS.                                         00950018
009600     05  MERGE-FILE-COUNT             PIC  9(11) VALUE ZEROS.     00960018
009700     05  TVNDINV-COUNT                PIC  9(11) VALUE ZEROS.     00970018
009800     05  INV-DETAIL-COUNT             PIC  9(11) VALUE ZEROS.     00980018
009900     05  SKIP-REC-COUNT               PIC  9(11) VALUE ZEROS.     00990018
010000                                                                  01000018
010100 01  WS-TVNDINV.                                                  01010018
010200     05 VNDINV-PAYT-REQ-SEQ-NBR       PIC  S9(9) COMP.            01020018
010300     05 VNDINV-PAYT-REQ-LNE-NBR       PIC  S9(9) COMP.            01030018
010400     05 VNDINV-UPC-EAN-QUAL-CDE       PIC   X(1).                 01040018
010500     05 VNDINV-UPC-EAN-CDE            PIC   X(15).                01050018
010600     05 VNDINV-VEND-STYL-CDE          PIC   X(20).                01060018
010700     05 VNDINV-COLOR-CDE              PIC   X(4).                 01070018
010800     05 VNDINV-COLOR-DESC             PIC   X(25).                01080018
010900     05 VNDINV-SIZE-CDE               PIC   X(5).                 01090018
011000     05 VNDINV-SIZE-DESC              PIC   X(25).                01100018
011100     05 VNDINV-SKU-DESC               PIC   X(25).                01110018
011200     05 VNDINV-FILLER                 PIC   X(8).                 01120018
011300                                                                  01130018
011400***************************************************************** 01140018
011500**  THIS IS THE LAYOUT FOR THE MERGER OF TMIITEM AND TPREQIT   ** 01150018
011600**  UNLOAD FILES.                                              ** 01160018
011700***************************************************************** 01170018
011800     COPY APRD406.                                                01180018
011900                                                                  01190018
012000***************************************************************** 01200018
012100**  THIS IS THE LAYOUT FOR THE PO DETAIL FILE.                 ** 01210018
012200***************************************************************** 01220018
012300     COPY APRD407.                                                01230018
012400                                                                  01240018
012500 01  ABEND-CODE                    PIC S9(4) COMP SYNC            01250018
012600                                             VALUE ZEROS.         01260018
012700                                                                  01270018
012800 01  WS-RETRY-COUNT                PIC S9(4) COMP VALUE ZERO.     01280018
012900 01  WS-RETRY-MAX                  PIC S9(4) COMP VALUE 3.        01290018
013000                                                                  01300018
013100 01  WS-ABEND-FIELDS.                                             01310018
013200     05  AA-ABEND-LIT            PIC  X(40)     VALUE             01320018
013300             '*****       ABEND'.                                 01330018
013400     05  AA-PROGRAM-LIT          PIC  X(40)     VALUE             01340018
013500             '*****   PROGRAM: APKUT407'.                         01350018
013600     05  AA-PARAGRAPH-LIT.                                        01360018
013700         10  FILLER              PIC  X(17)     VALUE             01370018
013800             '***** PARAGRAPH: '.                                 01380018
013900         10  AA-PARAGRAPH-NAME   PIC  X(35)     VALUE SPACES.     01390018
014000     05  AA-MESSAGE-LINE.                                         01400018
014100         10  FILLER              PIC  X(06)     VALUE '*****'.    01410018
014200         10  AA-MESSAGE          PIC  X(80)     VALUE SPACES.     01420018
014300                                                                  01430018
014400**********************                                            01440018
014500 PROCEDURE DIVISION.                                              01450018
014600**********************                                            01460018
014700                                                                  01470018
014800     PERFORM B100-INITIALIZATION.                                 01480018
014900                                                                  01490018
015000     PERFORM B200-CREATE-PO-DETAIL                                01500018
015100       UNTIL MERGE-EOF AND                                        01510018
015200             TVNDINV-EOF.                                         01520018
015300                                                                  01530018
015400     PERFORM B300-TERMINATION.                                    01540018
015500                                                                  01550018
015600     GOBACK.                                                      01560018
015700                                                                  01570018
015800*************************************************************     01580018
015900*  INITIALIZATION ROUTINE                                   *     01590018
016000*************************************************************     01600018
016100 B100-INITIALIZATION.                                             01610018
016200                                                                  01620018
016300     DISPLAY ' '.                                                 01630018
016400     DISPLAY '*---------- PROGRAM:  APKUT407 ----------*'         01640018
016500     DISPLAY 'SYSTEM DATE ' FUNCTION CURRENT-DATE(1:8)            01650018
016600                  '  TIME ' FUNCTION CURRENT-DATE(9:6).           01660018
016700                                                                  01670018
016800     OPEN INPUT INPUT-MERGE-FILE                                  01680018
016900                INPUT-TVNDINV-FILE                                01690018
017000         OUTPUT PO-DETAIL-FILE.                                   01700018
017100                                                                  01710018
017200     PERFORM R100-READ-MERGE-FILE.                                01720018
017300     PERFORM R200-READ-TVNDINV.                                   01730018
017400                                                                  01740018
017500     IF  MERGE-EOF                                                01750018
017600         MOVE 'B100-INITIALIZATION'       TO AA-PARAGRAPH-NAME    01760018
017700         MOVE 'EMPTY MERGE FILE '         TO AA-MESSAGE           01770018
017800         PERFORM Z998-ABEND                                       01780018
017900     END-IF.                                                      01790018
018000                                                                  01800018
018100     IF  TVNDINV-EOF                                              01810018
018200         MOVE 'B100-INITIALIZATION'       TO AA-PARAGRAPH-NAME    01820018
018300         MOVE 'EMPTY TVNDINV INPUT FILE ' TO AA-MESSAGE           01830018
018400         PERFORM Z998-ABEND                                       01840018
018500     END-IF.                                                      01850018
018600                                                                  01860018
018700 EJECT                                                            01870018
018800                                                                  01880018
018900*************************************************************     01890018
019000*  MAIN PROCESSING FOR CREATING PO DETAIL FILE              *     01900018
019100*************************************************************     01910018
019200 B200-CREATE-PO-DETAIL.                                           01920018
019300                                                                  01930018
019400     IF AP406-PAYT-REQ-SEQ-NBR = VNDINV-PAYT-REQ-SEQ-NBR          01940018
019500        IF AP406-PAYT-REQ-LNE-NBR = VNDINV-PAYT-REQ-LNE-NBR       01950018
019600           PERFORM M100-MOVE-MERGE-DETAIL                         01960020
019700           MOVE VNDINV-UPC-EAN-QUAL-CDE TO AP407-UPC-EAN-QUAL-CDE 01970018
019800           MOVE VNDINV-UPC-EAN-CDE      TO AP407-UPC-EAN-CDE      01980018
019900           MOVE VNDINV-VEND-STYL-CDE    TO AP407-VEND-STYL-CDE    01990018
020000           MOVE VNDINV-COLOR-CDE        TO AP407-COLOR-CDE        02000018
020100           MOVE VNDINV-COLOR-DESC       TO AP407-COLOR-DESC       02010018
020200           MOVE VNDINV-SIZE-CDE         TO AP407-SIZE-CDE         02020018
020300           MOVE VNDINV-SIZE-DESC        TO AP407-SIZE-DESC        02030018
020400           MOVE VNDINV-SKU-DESC         TO AP407-SKU-DESC         02040018
020500           PERFORM W100-WRITE-PO-DETAIL                           02050020
020600           PERFORM R100-READ-MERGE-FILE                           02060018
020700           PERFORM R200-READ-TVNDINV                              02070018
020800        ELSE                                                      02080018
020900           IF AP406-PAYT-REQ-LNE-NBR > VNDINV-PAYT-REQ-LNE-NBR    02090018
021000              ADD 1 TO SKIP-REC-COUNT                             02100018
021100              PERFORM R200-READ-TVNDINV                           02110018
021200           ELSE                                                   02120018
021300              PERFORM M100-MOVE-MERGE-DETAIL                      02130020
021400              PERFORM W100-WRITE-PO-DETAIL                        02140020
021500              PERFORM R100-READ-MERGE-FILE                        02150018
021600           END-IF                                                 02160018
021700        END-IF                                                    02170018
021800     ELSE                                                         02180018
021900        IF AP406-PAYT-REQ-SEQ-NBR > VNDINV-PAYT-REQ-SEQ-NBR       02190018
022000           ADD 1 TO SKIP-REC-COUNT                                02200018
022100           PERFORM R200-READ-TVNDINV                              02210018
022200        ELSE                                                      02220018
022300           PERFORM M100-MOVE-MERGE-DETAIL                         02230020
022400           PERFORM W100-WRITE-PO-DETAIL                           02240020
022500           PERFORM R100-READ-MERGE-FILE                           02250020
022600        END-IF                                                    02260020
022700     END-IF.                                                      02270020
022800                                                                  02280020
022900 EJECT                                                            02290020
023000                                                                  02300020
023100*************************************************************     02310020
023200*  TERMINATION ROUTINE                                      *     02320020
023300*************************************************************     02330020
023400 B300-TERMINATION.                                                02340020
023500     CLOSE INPUT-MERGE-FILE                                       02350020
023600           INPUT-TVNDINV-FILE                                     02360020
023700           PO-DETAIL-FILE.                                        02370020
023800                                                                  02380020
023900     DISPLAY '*****************************************'.         02390020
024000     DISPLAY '**        TOTALS FOR APKUT407          **'.         02400020
024100     DISPLAY '*****************************************'.         02410020
024200     DISPLAY 'TOTAL MERGE READ      = ' MERGE-FILE-COUNT.         02420020
024300     DISPLAY 'TOTAL TVNDINV READ    = ' TVNDINV-COUNT.            02430020
024400     DISPLAY 'TOTAL RECORDS WRITTEN = ' INV-DETAIL-COUNT.         02440020
024500     DISPLAY 'SKIPPED RECORDS       = ' SKIP-REC-COUNT.           02450020
024600     DISPLAY '*****************************************'.         02460020
024700                                                                  02470020
024800*************************************************************     02480020
024900*  MOVE MERGE FILE DETAIL TO OUTPUT COPYBOOK                *     02490020
025000*************************************************************     02500020
025100 M100-MOVE-MERGE-DETAIL.                                          02510020
025200     INITIALIZE AP407-PO-DETAIL-RECORD.                           02520020
025300     MOVE AP406-PAYT-REQ-SEQ-NBR  TO AP407-PAYT-REQ-SEQ-NBR.      02530020
025400     MOVE AP406-PAYT-REQ-LNE-NBR  TO AP407-PAYT-REQ-LNE-NBR.      02540020
025500     MOVE AP406-UNT-COST-SEL-CDE  TO AP407-UNT-COST-SEL-CDE.      02550020
025600     MOVE AP406-PO-NBR            TO AP407-PO-NBR.                02560020
025700     MOVE AP406-VER-NBR           TO AP407-VER-NBR.               02570020
025800     MOVE AP406-PO-LNE-NBR        TO AP407-PO-LNE-NBR.            02580020
025900     MOVE AP406-PAY-REQ-LNE-QTY   TO AP407-PAY-REQ-LNE-QTY.       02590020
026000     MOVE AP406-QTY-UNT-OF-MSMT   TO AP407-QTY-UNT-OF-MSMT.       02600020
026100     MOVE AP406-UNT-COST-AMT      TO AP407-UNT-COST-AMT.          02610020
026200                                                                  02620020
026300*************************************************************     02630020
026400*  READ MERGE FILE                                          *     02640020
026500*************************************************************     02650020
026600 R100-READ-MERGE-FILE.                                            02660020
026700                                                                  02670020
026800     READ INPUT-MERGE-FILE INTO AP406-TMIITEM-TPREQIT-RECORD      02680020
026900       AT END                                                     02690020
027000          SET  MERGE-EOF  TO TRUE                                 02700020
027100          MOVE +999999999 TO AP406-PAYT-REQ-SEQ-NBR               02710020
027200       NOT AT END                                                 02720020
027300          ADD 1 TO MERGE-FILE-COUNT                               02730020
027400     END-READ.                                                    02740020
027500                                                                  02750020
027600*************************************************************     02760020
027700*  READ TPREQIT FILE                                        *     02770020
027800*************************************************************     02780020
027900 R200-READ-TVNDINV.                                               02790020
028000                                                                  02800020
028100     READ INPUT-TVNDINV-FILE INTO WS-TVNDINV                      02810020
028200       AT END                                                     02820020
028300          SET TVNDINV-EOF TO TRUE                                 02830020
028400          MOVE +999999999 TO VNDINV-PAYT-REQ-SEQ-NBR              02840020
028500       NOT AT END                                                 02850020
028600          ADD 1 TO TVNDINV-COUNT                                  02860020
028700     END-READ.                                                    02870020
028800                                                                  02880020
028900*************************************************************     02890020
029000*  WRITE PO DETAIL FILE                                     *     02900020
029100*************************************************************     02910020
029200 W100-WRITE-PO-DETAIL.                                            02920020
029300                                                                  02930020
029400     WRITE PO-DETAIL-RECORD                                       02940020
029500           FROM AP407-PO-DETAIL-RECORD.                           02950020
029600     ADD 1 TO INV-DETAIL-COUNT.                                   02960020
029700                                                                  02970020
029800*************************************************************     02980020
029900*    ABEND ROUTINE FOR NON DB2 ERRORS                       *     02990020
030000*************************************************************     03000020
030100 Z998-ABEND.                                                      03010020
030200                                                                  03020020
030300     DISPLAY ' '.                                                 03030020
030400     DISPLAY AA-ABEND-LIT.                                        03040020
030500     DISPLAY AA-PROGRAM-LIT.                                      03050020
030600     DISPLAY AA-PARAGRAPH-LIT.                                    03060020
030700     DISPLAY AA-MESSAGE.                                          03070020
030800                                                                  03080020
030900     CALL 'ILBOABN0' USING ABEND-CODE.                            03090020
031000                                                                  03100020
031100                                                                  03110020
