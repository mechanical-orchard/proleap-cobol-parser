000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    TMKUT500.                                         00020001
000300 AUTHOR.        THERESE RAMSEYER.                                 00030000
000400                                                                  00040000
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050000
000600 DATE-WRITTEN.  JANUARY 2005.                                     00060001
000700 DATE-COMPILED.                                                   00070000
000800                                                                  00080000
000900 ENVIRONMENT DIVISION.                                            00090000
001000 CONFIGURATION SECTION.                                           00100000
001100 SOURCE-COMPUTER. IBM-3090.                                       00110000
001200 OBJECT-COMPUTER. IBM-3090.                                       00120000
001300                                                                  00130000
001400****************************************************************  00140000
001800*                                                                 00180099
001900*(1) THE WAIT TIME UNIT ON THE CONTROL TABLE IS COMING IN THE     00190099
002000*    FORMAT: HHMM (4 BYTES FROM TEXT FIELD ON TKRPRPM)            00200099
002100*    FOR CALCULATIONS:                                            00210099
002200*    THE TIME UNIT SHOULD BE REPRESENTED AS HOURS AND MINUTES WITH00220099
002300*    A LEADING ZERO IF NECESSARY TO COMPLETE 4 BYTES W/O A COLON. 00230099
002400*    EXAMPLES: 4 HOURS & 30 MINUTES = 0430                        00240099
002500*                                                                 00250099
002600*(2) THIS PROGRAM OPENS A CURSOR ON RCT_AUTOACKNL_TRBL AND        00260099
002700*    RETRIEVES ALL ROWS IN 'WAIT' STATUS.                         00270099
002800*                                                                 00280099
002900*(3) THE MAIN PROCESSING IN 5000- MUST BE SET UP TO BE ABLE TO    00290099
003000*    SKIP CURRENT PO AND GET THE NEXT, OR UPDATE THE CURRENT      00300099
003010*    RCT_AUTOACKNL_TRBL ROW TO 'ERROR' AND GET THE NEXT PO IN     00301099
003020*    WAIT STATUS. ALL OF THIS IS INTENDED TO KEEP THE PROCESSING  00302099
003030*    FROM ABENDING, AND JUST KEEP RECYCLING THE ROWS BACK INTO    00303099
003040*    WAIT STATUS SO THEY GET PICKED UP IN THE NEXT RUN.           00304099
003050*                                                                 00305099
003051*(4) CHECK THE PARAGRAPHS FOR MUCH MORE DETAIL ON PROCESSING.     00305199
003052*                                                                 00305299
003200****************************************************************  00320000
003300                                                                  00330000
003400 DATA DIVISION.                                                   00340000
003500 WORKING-STORAGE SECTION.                                         00350000
003600                                                                  00360000
003700 01  PROGRAM-VARIABLES.                                           00370000
003800     05  PV-WAIT-TIME-TEXT        PIC X(04)  VALUE SPACES.        00380099
003900     05  PV-PARA                  PIC X(05)  VALUE SPACES.        00390099
004000     05  PV-USER-ID               PIC X(08)  VALUE SPACES.        00400000
004100     05  PV-DISP-SQLCODE          PIC ZZZZZZZZ9-.                 00410099
004200     05  PV-DISP-TM007-SQLCODE    PIC ZZZZZZZZ9-.                 00420099
004300     05  PV-CURRENT-TMST          PIC X(26)  VALUE SPACES.        00430012
004400     05  PV-CURRENT-DATE          PIC X(10)  VALUE SPACES.        00440012
004500     05  PV-CURRENT-PARA          PIC X(30)  VALUE SPACES.        00450099
004600     05  PV-DB2-CURRENT-HOUR        PIC S9(09) COMP VALUE +0.     00460099
004700     05  PV-DB2-AUTOACKNL-BEG-HOUR  PIC S9(09) COMP VALUE +0.     00470068
004800     05  PV-DB2-ABS-VALUE-HOUR      PIC S9(09) COMP VALUE +0.     00480099
004900     05  PV-DB2-CURRENT-DAY         PIC S9(09) COMP VALUE +0.     00490099
005000     05  PV-DB2-AUTOACKNL-BEG-DAY   PIC S9(09) COMP VALUE +0.     00500099
005100     05  PV-ELAPSED-TIME            PIC S9(09) COMP VALUE +0.     00510068
005200     05  PV-TIME-UNIT-S9            PIC S9(09) COMP VALUE +0.     00520070
005300     05  PV-TIME-UNIT-9             PIC  9(09) VALUE 0.           00530072
005400     05  PV-RETRY-COUNTER         PIC S9(04) VALUE +0 COMP.       00540000
005500     05  PV-HOLD-PO-NBR           PIC S9(09) VALUE +0 COMP.       00550011
005600     05  PV-ABEND-PARAGRAPH              PIC  X(30)  VALUE SPACE. 00560080
005700     05  PV-DB2-OPER-ATTEMPTED           PIC  X(30)  VALUE SPACE. 00570081
005800 01  ABEND-CODE                          PIC S9(04)  VALUE ZERO   00580083
005900                                                     COMP SYNC.   00590083
006000                                                                  00600000
006100 01  PS-SWITCHES.                                                 00610000
006200     05  PS-DONE-PROCESSING-SW        PIC X(01)  VALUE 'N'.       00620011
006300         88  PS-DONE                             VALUE 'Y'.       00630011
006400         88  PS-NOT-DONE                         VALUE 'N'.       00640011
006500     05  PS-END-OF-CSR-SW             PIC X(01)  VALUE 'N'.       00650011
006600         88  PS-END-OF-PO-CSR-YES                VALUE 'Y'.       00660011
006700         88  PS-END-OF-PO-CSR-NO                 VALUE 'N'.       00670011
006800     05  PS-GET-NEW-PO-SW             PIC X(01)  VALUE 'N'.       00680085
006900         88  PS-GET-NEW-PO-YES                   VALUE 'Y'.       00690085
007000         88  PS-GET-NEW-PO-NO                    VALUE 'N'.       00700085
007100     05  PS-TRBL-SATISFIED-SW         PIC X(01)  VALUE 'N'.       00710092
007200         88  PS-TRBL-SATISFIED-YES               VALUE 'Y'.       00720092
007300         88  PS-TRBL-SATISFIED-NO                VALUE 'N'.       00730092
007400     05  PS-GET-NEXT-PO-RCVR-SW       PIC X(01)  VALUE 'N'.       00740080
007500         88  PS-GET-NEXT-PO-RCVR-YES             VALUE 'Y'.       00750080
007600         88  PS-GET-NEXT-PO-RCVR-NO              VALUE 'N'.       00760080
007700     05  PS-PO-RCVR-ON-AUTOACKNL-SW   PIC X(01)  VALUE 'N'.       00770011
007800         88  PS-PO-RCVR-ON-AUTOACKNL-YES         VALUE 'Y'.       00780011
007900         88  PS-PO-RCVR-ON-AUTOACKNL-NO          VALUE 'N'.       00790011
008000     05  PS-AUTOACKNL-MAINTAIN-IND-SW PIC X(01)  VALUE ' '.       00800011
008100         88  PS-UPDATE-AUTOACKNL                 VALUE 'U'.       00810011
008200         88  PS-INSERT-AUTOACKNL                 VALUE 'I'.       00820011
008300     05  PS-WAIT-TIME-SW              PIC X(01)  VALUE 'N'.       00830030
008400         88  PS-WAIT-TIME-EXCEEDED-YES           VALUE 'Y'.       00840012
008500         88  PS-WAIT-TIME-EXCEEDED-NO            VALUE 'N'.       00850012
008600     05  PS-RESOLUTION-SW             PIC X(01)  VALUE 'N'.       00860031
008700         88  PS-RESOLUTION-FAILED-YES            VALUE 'Y'.       00870031
008800         88  PS-RESOLUTION-FAILED-NO             VALUE 'N'.       00880031
008900                                                                  00890012
009000*    THE WAIT TIME UNIT ON THE CONTROL TABLE IS COMING IN THE     00900099
009100*    FORMAT: HHMM (4 BYTES FROM TEXT FIELD ON TKRPRPM)            00910099
009200*    FOR CALCULATIONS:                                            00920099
009300*    THE TIME UNIT SHOULD BE REPRESENTED AS HOURS AND MINUTES WITH00930099
009400*    A LEADING ZERO IF NECESSARY TO COMPLETE 4 BYTES W/O A COLON. 00940099
009500*    EXAMPLES: 4 HOURS & 30 MINUTES = 0430                        00950099
009600                                                                  00960099
009700 01  PC-CONSTANTS.                                                00970000
009800     05  PC-WAIT-TIME-UNIT           PIC  X(04)      VALUE SPACE. 00980099
009900     05  PC-FCLTY-ID                 PIC S9(4) COMP VALUE +1.     00990099
010000     05  PC-COMMAREA                 PIC  X(01)      VALUE SPACE. 01000099
010100     05  PC-MAX-RETRIES           PIC S9(04) VALUE +3 COMP.       01010000
010200     05  PC-CURRENT-PROGRAM       PIC X(08)  VALUE 'TMKUT500'.    01020096
010300     05  PC-RAND-PGM              PIC X(08)  VALUE 'DPKUT902'.    01030032
010400     05  PC-AUTOACKNL-MODULE      PIC X(08)  VALUE 'TMKUP501'.    01040011
010500     05  PC-RESOLVE-CREATE-MODULE PIC X(08)  VALUE 'TMKUP520'.    01050099
010600     05  PC-REDISTRO-MODULE       PIC X(08)  VALUE 'TMKUP502'.    01060099
010700     05  PC-WAIT                  PIC X(05)  VALUE 'WAIT '.       01070001
010800     05  PC-FAIL                  PIC X(05)  VALUE 'FAIL '.       01080012
010900     05  PC-CMPLT                 PIC X(05)  VALUE 'CMPLT'.       01090012
011000     05  PC-IF                    PIC X(02)  VALUE 'IF'.          01100012
011100     05  PC-FB                    PIC X(02)  VALUE 'FB'.          01110012
011200     05  PC-FBP                   PIC X(03)  VALUE 'FBP'.         01120012
011300     05  PC-Y                     PIC X(01)  VALUE 'Y'.           01130012
011400     05  PC-U                     PIC X(01)  VALUE 'U'.           01140011
011500     05  PC-I                     PIC X(01)  VALUE 'I'.           01150011
011600     05  PC-LOC-ID                PIC S9(04) COMP VALUE 90.       01160099
011700     05  PC-INTFC-SYS-CDE         PIC X(03)  VALUE 'KHL'.         01170099
011800     05  PC-SYS-PRC-FUNC-CDE      PIC X(06)  VALUE 'TMACK '.      01180099
011900     05  PC-FUNC-PRC-STAT-CDE     PIC X(02)  VALUE 'AC'.          01190099
012000     05  PC-DEFAULT-TMST          PIC X(26)  VALUE                01200011
012100                                  '9999-09-09-09.09.09.999999'.   01210003
012200                                                                  01220001
012300*  RANDOM NUMBER AREA.                                            01230011
012400     COPY DPWS902.                                                01240011
012500                                                                  01250011
012600*  COMMAREA FOR TROUBLE PROCESSING.                               01260099
012700     COPY TMWS500.                                                01270099
012800                                                                  01280099
012900****************************************************************  01290000
013000*  TABLE DECLARATIONS                                          *  01300000
013100****************************************************************  01310000
013200                                                                  01320000
013300* DB2 - AUTO-ACKNOWLEDGE TROUBLE                                  01330001
013400*       RCT_AUTOACKNL_TRBL                                        01340001
013500     EXEC SQL                                                     01350000
013600         INCLUDE RCT00020                                         01360001
013700     END-EXEC.                                                    01370000
013800                                                                  01380000
013900* DB2 - PARAMETERS                                                01390099
014000     EXEC SQL                                                     01400001
014100         INCLUDE TKRPRPM                                          01410099
014200     END-EXEC.                                                    01420001
014300                                                                  01430001
014400* DB2 - TROUBLE NOTIFICATION                                      01440099
014500     EXEC SQL                                                     01450099
014600         INCLUDE TTRBNTF                                          01460099
014700     END-EXEC.                                                    01470099
014800                                                                  01480099
014900* DB2 - TROUBLE REASON                                            01490001
015000     EXEC SQL                                                     01500000
015100         INCLUDE TTRBRSN                                          01510001
015200     END-EXEC.                                                    01520000
015300                                                                  01530000
015400* DB2 - TROUBLE REPORT CONTROL                                    01540022
015500     EXEC SQL                                                     01550022
015600         INCLUDE TTRBRCN                                          01560022
015700     END-EXEC.                                                    01570022
015800                                                                  01580022
015900* DB2 - PURCHASE ORDER                                            01590022
016000     EXEC SQL                                                     01600022
016100         INCLUDE TPURCHS                                          01610022
016200     END-EXEC.                                                    01620022
016300                                                                  01630022
016400* DB2 - SEASONAL SET                                              01640095
016500     EXEC SQL                                                     01650020
016600         INCLUDE TSEASET                                          01660020
016700     END-EXEC.                                                    01670020
016800                                                                  01680020
016900* DB2 - RECEIVNG                                                  01690021
017000     EXEC SQL                                                     01700021
017100         INCLUDE TRECEIV                                          01710021
017200     END-EXEC.                                                    01720021
017300                                                                  01730021
017400* DB2 COMMUNICATIONS AREA                                         01740011
017500     EXEC SQL                                                     01750000
017600          INCLUDE SQLCA                                           01760000
017700     END-EXEC.                                                    01770000
017800                                                                  01780000
017900*  CURSOR DECLARATION FOR PO-CSR                                  01790011
018000     EXEC SQL                                                     01800011
018100          DECLARE PO-CSR CURSOR WITH HOLD FOR                     01810099
018200          SELECT  B.PO_NBR                                        01820011
018300               ,  B.REC_SEQ_NBR                                   01830011
018400               ,  B.NOTIF_NBR                                     01840011
018400               ,  B.OPER_UNT_ID                                   01841099
018500               ,  B.TRBL_RSN_CDE                                  01850099
018600               ,  A.AUTOACKNL_IND                                 01860015
018700          FROM   TTRBRSN  A                                       01870015
018800                ,TTRBNTF  B                                       01880015
018900                ,RCT_AUTOACKNL_TRBL C                             01890015
019000          WHERE  A.TRBL_RSN_CDE        =  B.TRBL_RSN_CDE          01900011
019100          AND    B.NOTIF_NBR           =  C.NOTIF_NBR             01910011
019200          AND    C.AUTOACKNL_STAT_CDE  =  :PC-WAIT                01920011
020100     END-EXEC.                                                    02010011
020200** 4216404AND   (B.NOTIF_NBR           =  19605371                02020099
020300** 4216064    OR B.NOTIF_NBR           =  616684371)              02030099
020400                                                                  02040011
020500*         AND   (B.NOTIF_NBR           =  36371244                02050099
020600*             OR B.NOTIF_NBR           = 116989234                02060099
020700*             OR B.NOTIF_NBR           = 220076244                02070099
020800*  4210212    OR B.NOTIF_NBR           = 511193244                02080099
020900*             OR B.NOTIF_NBR           = 616881234                02090099
021000*             OR B.NOTIF_NBR           = 696775234                02100099
021100*             OR B.NOTIF_NBR           = 822299244)               02110099
021110*  4138245    OR B.NOTIF_NBR           = 929974473)               02111099
021120*  4191600    OR B.NOTIF_NBR           = 468919331)               02112099
021130*  4133562    OR B.NOTIF_NBR           = 322645380)               02113099
021140*  4226109-1  OR B.NOTIF_NBR           = 556110171)               02114099
021200                                                                  02120099
021300 LINKAGE SECTION.                                                 02130000
021400                                                                  02140099
021500     COPY TMRD007.                                                02150099
021600                                                                  02160000
021700******************************************************************02170000
021800 PROCEDURE DIVISION USING TM007-COMMUNICATIONS-AREA.              02180051
021900******************************************************************02190000
022000 0000-MAINLINE.                                                   02200000
022100                                                                  02210000
022200     SET TM007-CALL-SUCCESSFUL  TO TRUE.                          02220036
022300     MOVE PC-CURRENT-PROGRAM   TO TM007-CALLED-MODULE.            02230098
022400                                                                  02240000
022500     PERFORM 0500-GET-TIME-UNIT.                                  02250099
022600                                                                  02260099
022700     MOVE KRPRPM-FUNC-TXT      TO PV-WAIT-TIME-TEXT.              02270099
022800     MOVE PV-WAIT-TIME-TEXT (1:2)                                 02280099
022900                               TO PC-WAIT-TIME-UNIT (1:2).        02290099
023000     MOVE PV-WAIT-TIME-TEXT (3:2)                                 02300099
023100                               TO PC-WAIT-TIME-UNIT (3:2).        02310099
023200     MOVE PC-WAIT-TIME-UNIT    TO TM007-WAIT-TIME-UNIT.           02320099
023300                                                                  02330079
023400     PERFORM 4000-OPEN-PO-CSR.                                    02340099
023500                                                                  02350099
023600     PERFORM 4100-FETCH-PO-CSR.                                   02360099
023700                                                                  02370099
023800     IF PS-END-OF-PO-CSR-NO                                       02380099
023900        PERFORM 5000-PROCESS-PO                                   02390099
024000          UNTIL PS-END-OF-PO-CSR-YES                              02400099
024100             OR PS-DONE                                           02410099
024200     END-IF.                                                      02420099
024300                                                                  02430099
024400     PERFORM 4200-CLOSE-PO-CSR.                                   02440099
024500                                                                  02450000
024600     GOBACK.                                                      02460000
024700                                                                  02470000
024800******************************************************************02480099
024900**  GET THE TIME UNIT PARAMETER FROM  A CONTROL TABLE.          **02490099
025000******************************************************************02500099
025100 0500-GET-TIME-UNIT.                                              02510099
025200     MOVE '0500-GET-TIME-UNIT'  TO PV-CURRENT-PARA.               02520099
025300                                                                  02530099
025400     INITIALIZE DCLTKRPRPM.                                       02540099
025500                                                                  02550099
025600     MOVE PC-LOC-ID             TO KRPRPM-LOC-ID.                 02560099
025700     MOVE PC-INTFC-SYS-CDE      TO KRPRPM-INTFC-SYS-CDE.          02570099
025800     MOVE PC-SYS-PRC-FUNC-CDE   TO KRPRPM-SYS-PRC-FUNC-CDE.       02580099
025900     MOVE PC-FUNC-PRC-STAT-CDE  TO KRPRPM-FUNC-PRC-STAT-CDE.      02590099
026000                                                                  02600099
026100     PERFORM                                                      02610099
026200         WITH TEST AFTER                                          02620099
026300         VARYING PV-RETRY-COUNTER                                 02630099
026400         FROM 1 BY 1                                              02640099
026500         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  02650099
026600            OR SQLCODE = ZERO                                     02660099
026700            OR SQLCODE = +100                                     02670099
026800            OR SQLCODE = -904                                     02680099
026900            OR SQLCODE = -911                                     02690099
027000            OR SQLCODE = -913                                     02700099
027100                                                                  02710099
027200           EXEC SQL                                               02720099
027300              SELECT FUNC_TXT                                     02730099
027400              INTO :KRPRPM-FUNC-TXT                               02740099
027500              FROM TKRPRPM                                        02750099
027600              WHERE LOC_ID            = :KRPRPM-LOC-ID            02760099
027700              AND   INTFC_SYS_CDE     = :KRPRPM-INTFC-SYS-CDE     02770099
027800              AND   SYS_PRC_FUNC_CDE  = :KRPRPM-SYS-PRC-FUNC-CDE  02780099
027900              AND   FUNC_PRC_STAT_CDE = :KRPRPM-FUNC-PRC-STAT-CDE 02790099
028000           END-EXEC                                               02800099
028100                                                                  02810099
028200           EVALUATE TRUE                                          02820099
028300               WHEN SQLCODE = 0                                   02830099
028400                   SET TM007-CALL-SUCCESSFUL  TO TRUE             02840099
028500               WHEN SQLCODE = -904                                02850099
028600               WHEN SQLCODE = -911                                02860099
028700               WHEN SQLCODE = -913                                02870099
028800                    IF PV-RETRY-COUNTER > PC-MAX-RETRIES          02880099
028900                       SET TM007-SQL-CONTENTION                   02890099
029000                                       TO TRUE                    02900099
029100                       MOVE SQLCODE    TO TM007-SQLCODE           02910099
029200                       MOVE SQLCA      TO TM007-SQLCA             02920099
029300                    END-IF                                        02930099
029400               WHEN SQLWARN0 NOT = SPACE                          02940099
029500                       SET TM007-SQL-UNRECOVERABLE-ERROR          02950099
029600                                       TO TRUE                    02960099
029700                       MOVE SQLCODE    TO TM007-SQLCODE           02970099
029800                       MOVE SQLCA      TO TM007-SQLCA             02980099
029900               WHEN OTHER                                         02990099
030000                       SET TM007-SQL-UNRECOVERABLE-ERROR          03000099
030100                                       TO TRUE                    03010099
030200                       MOVE SQLCODE    TO TM007-SQLCODE           03020099
030300                       MOVE SQLCA      TO TM007-SQLCA             03030099
030400                                                                  03040099
030500           END-EVALUATE                                           03050099
030600     END-PERFORM.                                                 03060099
030700                                                                  03070099
030800*  EXECUTION STATUS AND ERROR CHECK                               03080099
030900     IF TM007-CALL-SUCCESSFUL                                     03090099
031000        CONTINUE                                                  03100099
031100     ELSE                                                         03110099
031200        PERFORM 8000-DB2-ERROR-CHECK                              03120099
031300     END-IF.                                                      03130099
031400                                                                  03140099
031500******************************************************************03150011
031600**                                                              **03160011
031700******************************************************************03170011
031800 4000-OPEN-PO-CSR.                                                03180011
031900     MOVE '4000-OPEN-PO-CSR'       TO PV-CURRENT-PARA.            03190099
032000                                                                  03200011
032100        EXEC SQL                                                  03210011
032200             OPEN PO-CSR                                          03220011
032300        END-EXEC.                                                 03230011
032400                                                                  03240011
032500        EVALUATE TRUE                                             03250011
032600                                                                  03260011
032700           WHEN SQLCODE = ZERO                                    03270011
032800                SET PS-END-OF-PO-CSR-NO                           03280099
032900                    TM007-CALL-SUCCESSFUL TO TRUE                 03290099
033000                                                                  03300011
033100           WHEN OTHER                                             03310011
033200                SET PS-DONE                                       03320035
033300                    TM007-SQL-UNRECOVERABLE-ERROR TO TRUE         03330099
033400                MOVE SQLCODE    TO TM007-SQLCODE                  03340011
033500                MOVE SQLCA      TO TM007-SQLCA                    03350011
033600        END-EVALUATE.                                             03360011
033700                                                                  03370011
033800*  EXECUTION STATUS AND ERROR CHECK                               03380095
033900     IF TM007-CALL-SUCCESSFUL                                     03390099
034000        CONTINUE                                                  03400099
034100     ELSE                                                         03410099
034200        PERFORM 8000-DB2-ERROR-CHECK                              03420099
034300     END-IF.                                                      03430099
034400                                                                  03440095
034500******************************************************************03450011
034600**                                                              **03460011
034700******************************************************************03470011
034800 4100-FETCH-PO-CSR.                                               03480011
034900     MOVE '4100-FETCH-PO-CSR'      TO PV-CURRENT-PARA.            03490099
035000                                                                  03500011
035100        EXEC SQL                                                  03510011
035200          FETCH PO-CSR                                            03520011
035300           INTO  :TRBNTF-PO-NBR                                   03530011
035400               , :TRBNTF-REC-SEQ-NBR                              03540021
035500               , :TRBNTF-NOTIF-NBR                                03550011
035500               , :TRBNTF-OPER-UNT-ID                              03551099
035600               , :TRBRSN-TRBL-RSN-CDE                             03560099
035700               , :TRBRSN-AUTOACKNL-IND                            03570099
035800        END-EXEC.                                                 03580011
035900                                                                  03590011
036000       EVALUATE TRUE                                              03600011
036100           WHEN SQLCODE = ZERO                                    03610011
036200               SET PS-GET-NEW-PO-NO                               03620099
036300                   TM007-CALL-SUCCESSFUL      TO TRUE             03630099
036400               INITIALIZE TM500-FIELDS                            03640099
109500               MOVE TRBNTF-PO-NBR             TO TM007-PO-NBR     03641099
109500                                                 TM500-PO-NBR     03641199
109600               MOVE TRBNTF-REC-SEQ-NBR        TO TM007-REC-SEQ-NBR03642099
109600                                                 TM500-REC-SEQ-NBR03643099
036500               MOVE TRBNTF-NOTIF-NBR          TO TM007-NOTIF-NBR  03650099
036600                                                 TM500-NOTIF-NBR  03660099
036700           WHEN SQLCODE = +100                                    03670011
036800               SET PS-END-OF-PO-CSR-YES                           03680099
036900                   TM007-CALL-SUCCESSFUL      TO TRUE             03690099
037000                                                                  03700011
037100           WHEN OTHER                                             03710011
037200                SET TM007-SQL-UNRECOVERABLE-ERROR                 03720099
037300                    PS-DONE     TO TRUE                           03730039
037400                MOVE SQLCODE    TO TM007-SQLCODE                  03740011
037500                MOVE SQLCA      TO TM007-SQLCA                    03750011
037600        END-EVALUATE.                                             03760011
037700                                                                  03770011
037800*  EXECUTION STATUS AND ERROR CHECK                               03780095
037900     IF TM007-CALL-SUCCESSFUL                                     03790099
038000        CONTINUE                                                  03800099
038100     ELSE                                                         03810099
038200        PERFORM 8000-DB2-ERROR-CHECK                              03820099
038300     END-IF.                                                      03830099
038400                                                                  03840095
038500******************************************************************03850011
038600**                                                              **03860011
038700******************************************************************03870011
038800 4200-CLOSE-PO-CSR.                                               03880011
038900        MOVE '4200-CLOSE-PO-CSR'      TO PV-CURRENT-PARA.         03890099
039000                                                                  03900011
039100        EXEC SQL                                                  03910011
039200            CLOSE PO-CSR                                          03920011
039300        END-EXEC.                                                 03930011
039400                                                                  03940011
039500        EVALUATE TRUE                                             03950011
039600           WHEN SQLCODE = ZERO                                    03960011
039700                SET TM007-CALL-SUCCESSFUL TO TRUE                 03970099
039800                                                                  03980011
039900           WHEN OTHER                                             03990011
040000                SET TM007-SQL-UNRECOVERABLE-ERROR                 04000099
040100                    PS-DONE              TO TRUE                  04010035
040200                MOVE SQLCODE    TO TM007-SQLCODE                  04020011
040300                MOVE SQLCA      TO TM007-SQLCA                    04030011
040400        END-EVALUATE.                                             04040011
040500                                                                  04050011
040600*  EXECUTION STATUS AND ERROR CHECK                               04060095
040700     IF TM007-CALL-SUCCESSFUL                                     04070099
040800        CONTINUE                                                  04080099
040900     ELSE                                                         04090099
041000        PERFORM 8000-DB2-ERROR-CHECK                              04100099
041100     END-IF.                                                      04110099
041200                                                                  04120095
041300******************************************************************04130011
041400** SPIN THROUGH THE RCT_AUTOACKNL_TRBL TABLE TO GET ALL ROWS    **04140084
041500** THAT ARE AUTO-ACKNOWLEDGE PO'S (IND) AND ARE IN 'WAIT'       **04150084
041600** STATUS.                                                      **04160084
041700******************************************************************04170011
041800 5000-PROCESS-PO.                                                 04180091
041900     MOVE '5000-PROCESS-PO'        TO PV-CURRENT-PARA.            04190099
042000                                                                  04200011
042100**   ONLY AUTO ACKNOWLEDGE REASON CODES SHOULD BE PROCESSED       04210099
042200     IF TRBRSN-AUTOACKNL-IND = PC-Y                               04220011
042300        SET PS-GET-NEW-PO-NO  TO TRUE                             04230099
042400     ELSE                                                         04240099
042500        SET PS-GET-NEW-PO-YES TO TRUE                             04250099
042600     END-IF.                                                      04260099
042700                                                                  04270099
042800**   CHECK TO SEE IF THIS ROW IS ALREADY ON RCT_AUTOACKNL_TRBL    04280099
042900**   (THIS WAS ORIGINALLY FOR CICS PROCESSING)                    04290099
043000**   IF PS-GET-NEW-PO-NO                                          04300099
043100**      PERFORM 6000-CHECK-AUTOACKL                               04310099
043200**   END-IF.                                                      04320099
043300                                                                  04330084
043400**   UPDATE AUTOACKNL IF ROW IS ALREADY THERE, OR INSERT A NEW ROW04340084
043500**   IF PS-GET-NEW-PO-NO                                          04350099
043600**   AND PS-NOT-DONE                                              04360099
043700**      IF  PS-PO-RCVR-ON-AUTOACKNL-YES                           04370099
043800**          SET PS-UPDATE-AUTOACKNL  TO TRUE                      04380099
043900**              PERFORM 6100-UPD-INS-AUTOACKNL-AS-WAIT            04390099
044000**      ELSE                                                      04400099
044100**          SET PS-INSERT-AUTOACKNL  TO TRUE                      04410099
044200**          PERFORM 6100-UPD-INS-AUTOACKNL-AS-WAIT                04420099
044300**      END-IF                                                    04430099
044400**   END-IF.                                                      04440099
044500                                                                  04450084
044600**   GET FIELDS TO CHECK FOR FLOWBACK AND SEASONAL SET TIMING     04460084
044700     IF PS-GET-NEW-PO-NO                                          04470084
044800     AND PS-NOT-DONE                                              04480099
      *KBW                                                              04481099
      *       DISPLAY 'GETTING INFO AS A NEW PO NUMBER '                04482099
      *KBW                                                              04483099
044900        PERFORM 6210-GET-CURRENT-TIMESTAMP                        04490099
045000        PERFORM 6710-GET-OPER-UNT-ID                              04500099
045100        PERFORM 6200-CHECK-FLOWBACK-SEASET                        04510084
045200     END-IF.                                                      04520084
045300                                                                  04530084
045400**   CHECK FOR FLOWBACK AND SEASONAL SET TIMING                   04540084
045500**                                                                04550099
      *KBW                                                              04551099
      *      DISPLAY '*******************************************'      04551199
      *      DISPLAY 'PO-NBR ' TRBNTF-PO-NBR                            04552099
      *      DISPLAY 'PURCHS-PO-TYP ' PURCHS-PO-TYP-CDE                 04552199
      *      DISPLAY 'PURCHS-SEASET-SHRT-NM ' PURCHS-SEASET-SHRT-NM     04552299
      *      DISPLAY '*******************************************'      04552399
      *KBW                                                              04553099
045600     IF PS-GET-NEW-PO-NO                                          04560084
045700     AND PS-NOT-DONE                                              04570099
045800******* IF THIS IS A FLOWBACK PO....                              04580099
045900        IF PURCHS-PO-TYP-CDE = (PC-FB OR PC-IF)                   04590084
046000******* IF THIS PO HAS A SEASONAL SET....                         04600099
046100        AND (PURCHS-SEASET-SHRT-NM (1:2) = PC-FB                  04610099
                   OR PURCHS-SEASET-SHRT-NM (1:5) = 'DATFL'             04611099
046200             OR PURCHS-SEASET-SHRT-NM (1:3) = 'GOR'               04620099
046200             OR PURCHS-SEASET-SHRT-NM (1:3) = PC-FBP)             04620199
                  EVALUATE TRUE                                         04621099
046300**** IF STORE RELEASE DATE IS TODAY....                           04622099
046300**** IF STORE RELEASE DATE IS PAST....                            04654099
046300**** IF STORE RELEASE DATE IS DEFAULT..                           04654199
                      WHEN SEASET-STR-RLSE-BEG-DTE = PV-CURRENT-DATE    04654299
046400                WHEN SEASET-STR-RLSE-BEG-DTE < PV-CURRENT-DATE    04654399
                      WHEN SEASET-STR-RLSE-BEG-DTE = '9999-09-09'       04654499
                           CONTINUE                                     04655099
046300**** IF STORE RELEASE DATE IS IN THE FUTURE....                   04656099
046400                WHEN SEASET-STR-RLSE-BEG-DTE > PV-CURRENT-DATE    04656199
046500                     SET PS-GET-NEW-PO-YES  TO TRUE               04656299
                  END-EVALUATE                                          04657099
046600        END-IF                                                    04660084
046700     END-IF.                                                      04670084
046800                                                                  04680099
                                                                        04681099
046900**** DETERMINE THE WAIT TIME....                                  04690099
047000     IF PS-GET-NEW-PO-NO                                          04700099
047100     AND PS-NOT-DONE                                              04710099
047200        PERFORM 6300-WAIT-TIME-DETERMINATION                      04720099
047300        PERFORM 6305-WAIT-TIME-CALC                               04730099
047400     END-IF.                                                      04740099
047500                                                                  04750084
           INITIALIZE TM007-RETURN-STATUS                               04751099
           INITIALIZE TM007-PROCESS-IND                                 04751199
                                                                        04752099
047600**** HAS WAIT TIME BEEN EXCEEDED ??                               04760099
047700     IF PS-GET-NEW-PO-NO                                          04770099
047800     AND PS-NOT-DONE                                              04780099
047900        IF PS-WAIT-TIME-EXCEEDED-YES                              04790099
048000           PERFORM 6400-UPDATE-AUTOACKNL-AS-FAIL                  04800099
048100           IF PS-GET-NEW-PO-NO                                    04810099
048200              PERFORM 6500-ACKNL-AND-CREATE-NEW-TRBL              04820099
048210              CONTINUE                                            04821099
048300           END-IF                                                 04830099
048400        ELSE                                                      04840099
048500******* WAIT TIME HAS NOT BEEN EXCEEDED                           04850099
048600*******    IS REDISTRO NEEDED ??                                  04860099
048700           IF TRBRSN-TRBL-RSN-CDE = 222                           04870099
048800**DO WE NEED? SET TM007-REDISTRO-REQUIRED TO TRUE                 04880099
048900              PERFORM 6600-PROCESS-REDISTRO                       04890099
049000           ELSE                                                   04900099
049100**                REDISTRO IS NOT NEEDED                          04910099
049200**FUTURE LOGIC    '88' LEVEL IN TMRD007 ???                       04920099
049300**FUTURE LOGIC    PUT FUTURE/REDISTRO LOGIC/PGM CALL HERE!!       04930099
049400              CONTINUE                                            04940099
049500           END-IF                                                 04950099
049600        END-IF                                                    04960099
049700     END-IF.                                                      04970099
049800                                                                  04980089
      **   IN THE CASE WHERE WAIT TIME HAS NOT BEEN EXCEEDED -          04981099
      **       THAT IS (NOT TM007-ACKNL-AND-FAIL):                      04982099
049900**   DETERMINE IF TRBL HAS BEEN SATISFIED                         04990099
050000**   AN 'AUTO-REDISTRO FAILED' MEANS TRBL HAS NOT BEEN SATISFIED  05000099
050100**   & THIS SWITCH IS RETURNED FROM TMKUP502 DURING THE           05010099
050200**   CHECK FOR THE REDISTRO REQUIREMENT.                          05020099
050300     IF PS-GET-NEW-PO-NO                                          05030099
050400     AND PS-NOT-DONE                                              05040099
           AND (NOT TM007-ACKNL-AND-FAIL)                               05041099
050500        IF TM007-AUTO-REDISTRO-FAILED                             05050099
050600           PERFORM 7000-UPDATE-AUTOACKNL-AS-WAIT                  05060099
050700        ELSE                                                      05070099
050800*********  IF REDISTRO WORKED.....                                05080099
050900           PERFORM 6700-ACKNOWLEDGE-TRBL                          05090099
051000           PERFORM 6800-UPDATE-AUTOACK-AS-CMPLT                   05100099
051100        END-IF                                                    05110099
051200     END-IF.                                                      05120099
051300                                                                  05130099
051400**   FETCH THE NEXT PO/RCVR IN WAIT STATUS FROM RCT_AUTOACKNL_TRBL05140084
051500     IF PS-NOT-DONE                                               05150099
051600        PERFORM 8900-DB2-COMMIT                                   05160099
051700        PERFORM 4100-FETCH-PO-CSR                                 05170091
051800     ELSE                                                         05180099
051900        IF PS-END-OF-PO-CSR-YES                                   05190099
052000           PERFORM 8900-DB2-COMMIT                                05200099
052100        END-IF                                                    05210099
052200     END-IF.                                                      05220091
052300                                                                  05230011
052400******************************************************************05240011
052500**                                                              **05250011
052600******************************************************************05260011
052700 6000-CHECK-AUTOACKL.                                             05270011
052800     MOVE '6000-CHECK-AUTOACKL'    TO PV-CURRENT-PARA.            05280099
052900                                                                  05290011
053000     SET PS-PO-RCVR-ON-AUTOACKNL-NO  TO TRUE.                     05300011
053100                                                                  05310011
053200     PERFORM WITH TEST AFTER                                      05320011
053300         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    05330011
053400         UNTIL   SQLCODE = +100 OR                                05340011
053500                 SQLCODE = +0 OR                                  05350011
053600                 PV-RETRY-COUNTER > PC-MAX-RETRIES                05360011
053700                                                                  05370011
053800         EXEC SQL                                                 05380011
053900             SELECT  AUTOACKNL_STAT_CDE                           05390024
054000             INTO   :RCT00020-AUTOACKNL-STAT-CDE                  05400011
054100             FROM    RCT_AUTOACKNL_TRBL                           05410011
054200             WHERE   NOTIF_NBR    = :TRBNTF-NOTIF-NBR             05420099
054300         END-EXEC                                                 05430011
054400                                                                  05440011
054500         EVALUATE TRUE                                            05450041
054600             WHEN SQLCODE = 0                                     05460043
054700                 SET PS-PO-RCVR-ON-AUTOACKNL-YES                  05470099
054800                     TM007-CALL-SUCCESSFUL        TO TRUE         05480099
054900             WHEN SQLCODE  = +100                                 05490046
055000                 SET TM007-CALL-SUCCESSFUL        TO TRUE         05500099
055100             WHEN SQLWARN0 NOT = SPACE                            05510044
055200             WHEN SQLCODE = -904                                  05520045
055300             WHEN SQLCODE = -911                                  05530045
055400             WHEN SQLCODE = -913                                  05540045
055500               SET TM007-SQL-CONTENTION                           05550099
055600                   PS-DONE              TO TRUE                   05560034
055700                MOVE 'DB2 CONTENTION'   TO TM007-RETURN-MSG       05570094
055800                MOVE SQLCODE            TO TM007-SQLCODE          05580034
055900                MOVE SQLCA              TO TM007-SQLCA            05590034
056000             WHEN OTHER                                           05600011
056100               SET TM007-SQL-UNRECOVERABLE-ERROR                  05610099
056200                   PS-DONE              TO TRUE                   05620034
056300                MOVE 'DB2 UNRECOVERABLE ERROR'                    05630093
056400                                        TO TM007-RETURN-MSG       05640094
056500                MOVE SQLCODE            TO TM007-SQLCODE          05650011
056600                MOVE SQLCA              TO TM007-SQLCA            05660011
056700         END-EVALUATE                                             05670011
056800     END-PERFORM.                                                 05680011
056900                                                                  05690011
057000     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         05700011
057100         SET  PS-DONE                                             05710011
057200              TM007-SQL-CONTENTION  TO TRUE                       05720099
057300     END-IF.                                                      05730011
057400                                                                  05740011
057500*  EXECUTION STATUS AND ERROR CHECK                               05750095
057600     IF TM007-CALL-SUCCESSFUL                                     05760099
057700        CONTINUE                                                  05770099
057800     ELSE                                                         05780099
057900        PERFORM 8000-DB2-ERROR-CHECK                              05790099
058000     END-IF.                                                      05800099
058100                                                                  05810095
058200******************************************************************05820011
058300**                                                              **05830011
058400******************************************************************05840011
058500 6050-CALL-RANDOM-NBR-PGM.                                        05850011
058600     MOVE '6050-CALL-RANDOM-NBR-PGM'  TO TM007-RETURNED-PARA.     05860011
058700                                                                  05870011
058800     CALL PC-RAND-PGM USING DP902-RANDNBR-ROUTINE-FIELDS.         05880099
058900                                                                  05890099
059000     IF DP902-SUCCESSFUL                                          05900011
059100         SET TM007-CALL-SUCCESSFUL  TO TRUE                       05910093
059200     ELSE                                                         05920011
059300         SET PS-DONE      TO TRUE                                 05930011
059400     END-IF.                                                      05940011
059500                                                                  05950011
059600*  EXECUTION STATUS AND ERROR CHECK                               05960095
059700     IF TM007-CALL-SUCCESSFUL                                     05970099
059800        CONTINUE                                                  05980099
059900     ELSE                                                         05990099
060000        PERFORM 8000-DB2-ERROR-CHECK                              06000099
060100     END-IF.                                                      06010099
060200                                                                  06020095
060300******************************************************************06030011
060400**                                                              **06040011
060500******************************************************************06050011
060600*6100-UPD-INS-AUTOACKNL-AS-WAIT.                                  06060099
060700*    MOVE '6100-UPD-INS-AUTOACKNL-AS-WAIT' TO PV-CURRENT-PARA.    06070099
060800*                                                                 06080099
060900*  IF THIS CALL IS BAD, USE THIS SWITCH TO GET NEXT CSR RECORD    06090080
061000*    SET PS-GET-NEXT-PO-RCVR-NO    TO TRUE                        06100099
061100*                                                                 06110099
061200*  LOAD KEYS FOR INSERT - OR - UPDATE                             06120080
061300*    MOVE TRBNTF-PO-NBR              TO TM007-PO-NBR.             06130099
061400*    MOVE TRBNTF-REC-SEQ-NBR         TO TM007-REC-SEQ-NBR.        06140099
061500*    MOVE PC-AUTOACKNL-MODULE        TO TM007-CALLED-MODULE.      06150099
061600*    SET TM007-WAIT-STATUS           TO TRUE.                     06160099
061700*                                                                 06170099
061800*  UPDATE RCT_AUTOACKNL_TRBL BY USING CALLED MODULE TMKUP501      06180080
061900*    IF PS-UPDATE-AUTOACKNL                                       06190099
062000*       MOVE TRBNTF-NOTIF-NBR   TO TM007-NOTIF-NBR                06200099
062100*       SET TM007-UPDATE        TO TRUE                           06210099
062200*       CALL PC-AUTOACKNL-MODULE USING                            06220099
062300*                               TM007-COMMUNICATIONS-AREA         06230099
062400*    END-IF.                                                      06240099
062500*                                                                 06250099
062600*  INSERT RCT_AUTOACKNL_TRBL BY USING CALLED MODULE TMKUP501      06260080
062700*    IF PS-INSERT-AUTOACKNL                                       06270099
062800*       MOVE TRBNTF-NOTIF-NBR     TO TM007-NOTIF-NBR              06280099
062900*       SET TM007-INSERT          TO TRUE                         06290099
063000*       CALL PC-AUTOACKNL-MODULE USING                            06300099
063100*                                 TM007-COMMUNICATIONS-AREA       06310099
063200*    END-IF.                                                      06320099
063300*                                                                 06330099
063400*    IF THE CALL WAS BAD, GET NEXT PO - TCR - SOMETHING WRONG WITH06340099
063500*    THIS PROCESSING - WE NEED TO EMAIL OR UPDATE ERROR  ETC !!   06350099
063600*    IF TM007-CALL-SUCCESSFUL                                     06360099
063700*       CONTINUE                                                  06370099
063800*    ELSE                                                         06380099
063900*       EXECUTION STATUS AND ERROR CHECK                          06390099
064000*       IF TM007-CALL-SUCCESSFUL                                  06400099
064100*          CONTINUE                                               06410099
064200*       ELSE                                                      06420099
064300*          PERFORM 8000-DB2-ERROR-CHECK                           06430099
064400*       END-IF.                                                   06440099
064500*       SET PS-GET-NEXT-PO-RCVR-YES  TO TRUE                      06450099
064600*    END-IF.                                                      06460099
064700*                                                                 06470099
064800******************************************************************06480011
064900**                                                              **06490011
065000******************************************************************06500011
065100 6200-CHECK-FLOWBACK-SEASET.                                      06510011
065200     MOVE '6200-CHECK-FLOWBACK-SEASET' TO PV-CURRENT-PARA.        06520099
065300                                                                  06530011
065400     PERFORM WITH TEST AFTER                                      06540011
065500         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    06550011
065600         UNTIL   SQLCODE = +0 OR                                  06560012
065700                 SQLCODE = +100 OR                                06570099
065800                 PV-RETRY-COUNTER > PC-MAX-RETRIES                06580011
065900                                                                  06590011
066000         EXEC SQL                                                 06600011
066100            SELECT  A.PO_TYP_CDE                                  06610012
066200                  , A.SEASET_SHRT_NM                              06620012
066300                  , B.STR_RLSE_BEG_DTE                            06630012
066400            INTO   :PURCHS-PO-TYP-CDE                             06640012
066500                 , :PURCHS-SEASET-SHRT-NM                         06650012
066600                 , :SEASET-STR-RLSE-BEG-DTE                       06660012
066700            FROM    TPURCHS  A                                    06670023
066800                  , TSEASET  B                                    06680023
066900            WHERE   A.VER_STATUS_CDE   = 'A'                      06690012
067000            AND     A.PO_NBR           = :TM007-PO-NBR            06700099
067100            AND     A.SEASET_YR = (CHAR(YEAR(CURRENT TIMESTAMP))) 06710012
067100            AND     A.SEASET_YR =        B.SEASET_YR              06711099
067200            AND     A.SEASET_SHRT_NM   = B.SEASET_SHRT_NM         06720012
067300            AND     B.SEASET_STAT_CDE  = 'A'                      06730099
067400            AND     B.SEASET_TYP_CDE   = 'FB'                     06740099
067500         END-EXEC                                                 06750011
067600                                                                  06760011
067700         EVALUATE TRUE                                            06770042
067800             WHEN SQLCODE = +0                                    06780049
068000                 SET TM007-CALL-SUCCESSFUL  TO TRUE               06781099
067900             WHEN SQLCODE = +100                                  06790099
                       MOVE SPACES TO PURCHS-SEASET-SHRT-NM             06791099
068000                 SET TM007-CALL-SUCCESSFUL  TO TRUE               06800099
068100             WHEN SQLWARN0 NOT = SPACE                            06810011
068200             WHEN SQLCODE = -904                                  06820050
068300             WHEN SQLCODE = -911                                  06830050
068400             WHEN SQLCODE = -913                                  06840050
068500               SET TM007-SQL-CONTENTION                           06850099
068600                   PS-DONE              TO TRUE                   06860035
068700                MOVE SQLCODE            TO TM007-SQLCODE          06870035
068800                MOVE SQLCA              TO TM007-SQLCA            06880035
068900             WHEN OTHER                                           06890011
069000               SET TM007-SQL-UNRECOVERABLE-ERROR                  06900099
069100                   PS-DONE              TO TRUE                   06910012
069200                MOVE SQLCODE            TO TM007-SQLCODE          06920011
069300                MOVE SQLCA              TO TM007-SQLCA            06930011
069400         END-EVALUATE                                             06940011
069500     END-PERFORM.                                                 06950011
069600                                                                  06960011
069700     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         06970011
069800         SET  PS-DONE                                             06980011
069900              TM007-SQL-CONTENTION  TO TRUE                       06990099
070000     END-IF.                                                      07000011
070100                                                                  07010011
070200*  EXECUTION STATUS AND ERROR CHECK                               07020095
070300     IF TM007-CALL-SUCCESSFUL                                     07030099
070400        CONTINUE                                                  07040099
070500     ELSE                                                         07050099
070600        PERFORM 8000-DB2-ERROR-CHECK                              07060099
070700     END-IF.                                                      07070099
070800                                                                  07080095
070900******************************************************************07090012
071000* SET THE CURRENT TIMESTAMP.                                      07100012
071100******************************************************************07110012
071200 6210-GET-CURRENT-TIMESTAMP.                                      07120037
071300                                                                  07130012
071400     EXEC SQL                                                     07140012
071500         SET :PV-CURRENT-TMST = CURRENT TIMESTAMP                 07150012
071600     END-EXEC                                                     07160012
071700                                                                  07170012
071800     EVALUATE TRUE                                                07180012
071900        WHEN SQLCODE = ZERO                                       07190012
072000            MOVE PV-CURRENT-TMST (1:10) TO PV-CURRENT-DATE        07200012
072100            SET TM007-CALL-SUCCESSFUL   TO TRUE                   07210099
072200                                                                  07220012
072300        WHEN SQLWARN0 NOT EQUAL SPACE                             07230012
072400        WHEN SQLCODE NOT EQUAL ZERO                               07240012
072500             SET TM007-SQL-UNRECOVERABLE-ERROR                    07250099
072600                 PS-DONE             TO TRUE                      07260012
072700             MOVE 'DB2 UNRECOVERABLE ERROR'                       07270093
072800                                     TO TM007-RETURN-MSG          07280094
072900             MOVE SQLCODE            TO TM007-SQLCODE             07290012
073000             MOVE SQLCA              TO TM007-SQLCA               07300012
073100     END-EVALUATE.                                                07310012
073200                                                                  07320012
073300*  EXECUTION STATUS AND ERROR CHECK                               07330095
073400     IF TM007-CALL-SUCCESSFUL                                     07340099
073500        CONTINUE                                                  07350099
073600     ELSE                                                         07360099
073700        PERFORM 8000-DB2-ERROR-CHECK                              07370099
073800     END-IF.                                                      07380099
073900                                                                  07390095
074000******************************************************************07400012
074100**                                                              **07410012
074200******************************************************************07420012
074300 6300-WAIT-TIME-DETERMINATION.                                    07430012
074400     MOVE '6300-WAIT-TIME-DETERMINATION' TO PV-CURRENT-PARA.      07440099
074500                                                                  07450012
074600     PERFORM WITH TEST AFTER                                      07460012
074700         VARYING PV-RETRY-COUNTER  FROM 1 BY 1                    07470012
074800         UNTIL   SQLCODE = +0 OR                                  07480012
074900                 PV-RETRY-COUNTER > PC-MAX-RETRIES                07490012
075000                                                                  07500012
075100         EXEC SQL                                                 07510012
075200            SELECT  HOUR(AUTOACKNL_BEG_TMST)                      07520069
075300                 ,  HOUR(CURRENT TIMESTAMP)                       07530069
075400     ,ABS( (DAY(CURRENT TIMESTAMP)) - (DAY(AUTOACKNL_BEG_TMST)) ) 07540099
075500                 ,  DAY(AUTOACKNL_BEG_TMST)                       07550099
075600                 ,  DAY(CURRENT TIMESTAMP)                        07560099
075700            INTO   :PV-DB2-AUTOACKNL-BEG-HOUR                     07570068
075800                ,  :PV-DB2-CURRENT-HOUR                           07580099
075900                ,  :PV-DB2-ABS-VALUE-HOUR                         07590099
076000                ,  :PV-DB2-AUTOACKNL-BEG-DAY                      07600099
076100                ,  :PV-DB2-CURRENT-DAY                            07610099
076200            FROM   RCT_AUTOACKNL_TRBL                             07620027
076300            WHERE  NOTIF_NBR = :TRBNTF-NOTIF-NBR                  07630099
076400         END-EXEC                                                 07640012
076500                                                                  07650012
076600         EVALUATE TRUE                                            07660042
076700             WHEN SQLCODE = ZERO                                  07670050
076800                 SET TM007-CALL-SUCCESSFUL  TO TRUE               07680099
076900             WHEN SQLCODE = +100                                  07690050
077000             WHEN SQLWARN0 NOT = SPACE                            07700012
077100             WHEN SQLCODE = -904                                  07710050
077200             WHEN SQLCODE = -911                                  07720050
077300             WHEN SQLCODE = -913                                  07730050
077400               SET TM007-SQL-CONTENTION                           07740099
077500                   PS-DONE              TO TRUE                   07750035
077600                MOVE 'DB2 CONTENTION'   TO TM007-RETURN-MSG       07760094
077700                MOVE SQLCODE            TO TM007-SQLCODE          07770035
077800                MOVE SQLCA              TO TM007-SQLCA            07780035
077900             WHEN OTHER                                           07790012
078000               SET TM007-SQL-UNRECOVERABLE-ERROR                  07800099
078100                   PS-DONE              TO TRUE                   07810012
078200                MOVE 'DB2 UNRECOVERABLE ERROR'                    07820093
078300                                        TO TM007-RETURN-MSG       07830094
078400                MOVE SQLCODE            TO TM007-SQLCODE          07840012
078500                MOVE SQLCA              TO TM007-SQLCA            07850012
078600         END-EVALUATE                                             07860012
078700     END-PERFORM.                                                 07870012
078800                                                                  07880012
078900     IF PV-RETRY-COUNTER > PC-MAX-RETRIES                         07890012
079000         SET  PS-DONE                                             07900012
079100              TM007-SQL-CONTENTION  TO TRUE                       07910099
079200     END-IF.                                                      07920012
079300                                                                  07930012
079400*  EXECUTION STATUS AND ERROR CHECK                               07940095
079500     IF TM007-CALL-SUCCESSFUL                                     07950099
079600        CONTINUE                                                  07960099
079700     ELSE                                                         07970099
079800        PERFORM 8000-DB2-ERROR-CHECK                              07980099
079900     END-IF.                                                      07990099
080000                                                                  08000095
080100******************************************************************08010052
080200** THE WAIT TIME IS DETERMINED BY SUBTRACTING THE BEGINNING     **08020052
080300** HOUR VALUE FROM THE CURRENT HOUR VALUE (EVEN THOUGH THE      **08030052
080400** CURRENT HOUR VALUE SHOULD BE HIGHER THAN THE BEGINNING VALUE **08040052
080500** MOST OF THE TIME). THIS IS DONE TO KEEP THE CALCULATED       **08050052
080600** HOUR VALUE POSITIVE - SAVING THE STEP TO CHECK FOR NEGATIVE, **08060052
080700** THEN MULTIPLYING BY (-1) BEFORE SUBTRACTING. THE EXCEPTION   **08070052
080800** IS WHEN THE CURRENT TIME IS IN AM (HOURS 1 - 12 INCLUSIVE),  **08080052
080900** AND THE BEGINNING TIME IS IN PM (HOURS 13 - 24 INCLUSIVE).   **08090052
081000** IN THIS CASE, 24 HOURS NEEDS TO BE ADDED TO THE CURRENT      **08100052
081100** HOUR VALUE IN ORDER TO MAKE AN ACCURATE DETERMINATION OF     **08110052
081200** THE ELAPSED TIME AS THAT WOULD INDICATE THAT THE CURRENT     **08120052
081300** TIME WAS REALLY THE NEXT DAY.                                **08130052
081400******************************************************************08140052
081500 6305-WAIT-TIME-CALC.                                             08150052
081600     MOVE '6305-WAIT-TIME-CALC' TO PV-CURRENT-PARA.               08160099
081700                                                                  08170052
081800     SET PS-WAIT-TIME-EXCEEDED-NO     TO TRUE.                    08180052
081900     MOVE PC-WAIT-TIME-UNIT (1:2)     TO PV-TIME-UNIT-9.          08190099
082000     MOVE PV-TIME-UNIT-9              TO PV-TIME-UNIT-S9.         08200072
082100                                                                  08210052
082200*    ONLY NEED TO WORRY ABOUT HOURS IF TIME BETWEEN CURRENT &     08220099
082300*    BEG DATES IS LESS THAN 1 DAY, OTHERWISE WAIT TIME IS EXCEEDED08230099
082400     IF PV-DB2-ABS-VALUE-HOUR >= 1                                08240099
082500        SET PS-WAIT-TIME-EXCEEDED-YES  TO TRUE                    08250099
082600     ELSE                                                         08260099
082700        EVALUATE TRUE                                             08270099
082800*        BOTH TIMES =< 12:00 PM                                   08280099
082900*        (0000 THRU 1200 - ANYTHING BEFORE AND INCLUDING 12:00 PM)08290099
083000            WHEN PV-DB2-CURRENT-HOUR       <= 12                  08300099
083100            AND  PV-DB2-AUTOACKNL-BEG-HOUR <= 12                  08310099
083200                 COMPUTE PV-ELAPSED-TIME =                        08320099
083300                 PV-DB2-CURRENT-HOUR -                            08330099
083400                 PV-DB2-AUTOACKNL-BEG-HOUR                        08340099
083500                 IF PV-ELAPSED-TIME >= PV-TIME-UNIT-S9            08350099
083600                    SET PS-WAIT-TIME-EXCEEDED-YES TO TRUE         08360099
083700                 END-IF                                           08370099
083800                                                                  08380052
083900*        BOTH TIMES > 12:00 PM                                    08390099
084000*       (1201 THRU 2400 - ANYTHING AFTER 12:00 PM AND BEFORE 0000)08400099
084100            WHEN PV-DB2-CURRENT-HOUR       >  12                  08410099
084200            AND  PV-DB2-AUTOACKNL-BEG-HOUR >  12                  08420099
084300                 COMPUTE PV-ELAPSED-TIME =                        08430099
084400                 PV-DB2-CURRENT-HOUR -                            08440099
084500                 PV-DB2-AUTOACKNL-BEG-HOUR                        08450099
084600                 IF PV-ELAPSED-TIME >= PV-TIME-UNIT-S9            08460099
084700                    SET PS-WAIT-TIME-EXCEEDED-YES TO TRUE         08470099
084800                 END-IF                                           08480099
084900                                                                  08490052
085000*        CURRENT IN AM & BEGINNING IN PM                          08500052
085100            WHEN PV-DB2-CURRENT-HOUR       <= 12                  08510099
085200            AND  PV-DB2-AUTOACKNL-BEG-HOUR >  12                  08520099
085300                 COMPUTE PV-ELAPSED-TIME =                        08530099
085400               ((PV-DB2-CURRENT-HOUR + 24) -                      08540099
085500                 PV-DB2-AUTOACKNL-BEG-HOUR)                       08550099
085600                 IF PV-ELAPSED-TIME >= PV-TIME-UNIT-S9            08560099
085700                    SET PS-WAIT-TIME-EXCEEDED-YES TO TRUE         08570099
085800                 END-IF                                           08580099
085900                                                                  08590052
086000*        CURRENT IN PM & BEGINNING IN AM                          08600052
086100            WHEN PV-DB2-CURRENT-HOUR       >  12                  08610099
086200            AND  PV-DB2-AUTOACKNL-BEG-HOUR <= 12                  08620099
086300                 COMPUTE PV-ELAPSED-TIME =                        08630099
086400                 PV-DB2-CURRENT-HOUR -                            08640099
086500                 PV-DB2-AUTOACKNL-BEG-HOUR                        08650099
086600                 IF PV-ELAPSED-TIME >= PV-TIME-UNIT-S9            08660099
086700                    SET PS-WAIT-TIME-EXCEEDED-YES TO TRUE         08670099
086800                 END-IF                                           08680099
086900                                                                  08690099
087000        END-EVALUATE                                              08700099
087100     END-IF.                                                      08710099
087200                                                                  08720052
087300******************************************************************08730052
087400**                                                              **08740012
087500******************************************************************08750012
087600 6400-UPDATE-AUTOACKNL-AS-FAIL.                                   08760012
087700     MOVE '6400-UPDATE-AUTOACKNL-AS-FAIL' TO PV-CURRENT-PARA.     08770099
087800                                                                  08780012
087900     MOVE TRBNTF-PO-NBR              TO TM007-PO-NBR.             08790012
088000     MOVE TRBNTF-REC-SEQ-NBR         TO TM007-REC-SEQ-NBR.        08800040
088100     MOVE PC-AUTOACKNL-MODULE        TO TM007-CALLED-MODULE.      08810094
088200     SET TM007-CALL-SUCCESSFUL                                    08820099
088300         TM007-FAIL-STATUS                                        08831099
088400         TM007-UPDATE                TO TRUE.                     08840099
088500                                                                  08850012
088600     CALL PC-AUTOACKNL-MODULE USING                               08860099
088700                                 TM007-COMMUNICATIONS-AREA.       08870099
088800                                                                  08880012
088900*  EXECUTION STATUS AND ERROR CHECK                               08890099
089000     IF TM007-CALL-SUCCESSFUL                                     08900099
089100        CONTINUE                                                  08910099
089200     ELSE                                                         08920099
089300        PERFORM 8000-DB2-ERROR-CHECK                              08930099
089400     END-IF.                                                      08940099
089500                                                                  08950099
089600******************************************************************08960012
089700**                                                              **08970012
089800******************************************************************08980012
089900 6500-ACKNL-AND-CREATE-NEW-TRBL.                                  08990012
090000     MOVE '6500-ACKNL-AND-CREATE-NEW-TRBL' TO PV-CURRENT-PARA.    09000099
090100                                                                  09010012
090200     MOVE TRBNTF-PO-NBR              TO TM007-PO-NBR              09020099
090300                                        TM500-PO-NBR.             09030099
090400     MOVE TRBNTF-REC-SEQ-NBR         TO TM007-REC-SEQ-NBR         09040099
090500                                        TM500-REC-SEQ-NBR.        09050099
090400     MOVE TRBNTF-OPER-UNT-ID         TO TM007-OPER-UNT-ID         09051099
090500                                        TM500-OPER-UNT-ID.        09052099
090600     MOVE TRBRSN-TRBL-RSN-CDE        TO TM500-TRBL-RSN-CDE.       09060099
090700     MOVE PC-FCLTY-ID                TO TM500-FCLTY-ID.           09070099
090800     MOVE PC-RESOLVE-CREATE-MODULE   TO TM007-CALLED-MODULE.      09080094
090900     SET TM007-FAIL-STATUS                                        09090099
091000         TM007-ACKNL-AND-FAIL                                     09100099
091100         PS-RESOLUTION-FAILED-YES                                 09110099
091200         TM500-ACKNOWLEDGE                                        09120099
091300         TM007-CALL-SUCCESSFUL       TO TRUE.                     09130099
091400                                                                  09140099
091500     IF RECEIV-PKGNG-CDE  = ('I' OR 'M')                          09150099
091600        SET TM500-PACK-LEVEL TO TRUE                              09160099
              MOVE 0               TO TM500-PREPK-ID                    09161099
091700     ELSE                                                         09170099
091800        SET TM500-LINE-LEVEL TO TRUE                              09180099
091900     END-IF.                                                      09190099
092000                                                                  09200012
092100     CALL PC-RESOLVE-CREATE-MODULE USING                          09210099
092200                                   TM500-FIELDS                   09220099
092300                                   TM007-COMMUNICATIONS-AREA.     09230099
092400                                                                  09240012
092500*  EXECUTION STATUS AND ERROR CHECK                               09250099
092600     IF TM007-CALL-SUCCESSFUL                                     09260099
092700        CONTINUE                                                  09270099
092800     ELSE                                                         09280099
092900        PERFORM 8000-DB2-ERROR-CHECK                              09290099
093000     END-IF.                                                      09300099
093100                                                                  09310094
095700******************************************************************09570012
095800**                                                              **09580012
095900******************************************************************09590012
096000 6600-PROCESS-REDISTRO.                                           09600012
096100     MOVE '6600-PROCESS-REDISTRO' TO PV-CURRENT-PARA.             09610099
096100     DISPLAY 'PARAGRAPH NAME = 6600-PROCESS-REDISTRO'             09611099
096200                                                                  09620012
096300     MOVE TRBNTF-PO-NBR              TO TM007-PO-NBR.             09630075
096400     MOVE TRBNTF-REC-SEQ-NBR         TO TM007-REC-SEQ-NBR.        09640040
096500     MOVE PC-REDISTRO-MODULE         TO TM007-CALLED-MODULE.      09650094
096600     SET TM007-FAIL-STATUS                                        09660099
096700         TM007-CALL-SUCCESSFUL                                    09670099
               TM007-DO-CURRENT-PROCESS                                 09671099
096800         PS-RESOLUTION-FAILED-YES    TO TRUE.                     09680099
096900                                                                  09690012
097000     CALL PC-REDISTRO-MODULE USING TM007-COMMUNICATIONS-AREA      09700099
097100                                                                  09710012
      *KBW                                                              09710199
      *    DISPLAY '*********************************************'      09710299
      *    DISPLAY  ' DONE WITH CALLING RE-DISTRO '                     09711099
      *    DISPLAY 'PO NUMBER FOR 007 ' TRBNTF-PO-NBR                   09711199
      *    DISPLAY 'REC NUMBER FOR 007 ' TRBNTF-REC-SEQ-NBR             09711299
      *    DISPLAY 'TM007-RETURN-STATUS ' TM007-RETURN-STATUS           09712099
      *    DISPLAY 'TM007-RETURN-SQL    ' TM007-RETURN-SQL              09713099
      *    DISPLAY 'TM007-RETURN-CODE   ' TM007-RETURN-CODE             09713199
      *    DISPLAY '*********************************************'      09714099
      *KBW                                                              09715099
097200*  EXECUTION STATUS AND ERROR CHECK                               09720099
097300     IF TM007-CALL-SUCCESSFUL                                     09730099
097400        CONTINUE                                                  09740099
097500     ELSE                                                         09750099
097600        PERFORM 8000-DB2-ERROR-CHECK                              09760099
097700     END-IF.                                                      09770099
097800                                                                  09780094
097900******************************************************************09790013
098000**                                                              **09800099
098100**                                                              **09810099
098200**                                                              **09820099
098300******************************************************************09830013
098400 6700-ACKNOWLEDGE-TRBL.                                           09840099
098500     MOVE '6700-ACKNOWLEDGE-TRBL'  TO PV-CURRENT-PARA.            09850099
098600                                                                  09860013
098700     MOVE TRBNTF-PO-NBR              TO TM007-PO-NBR              09870099
098800                                        TM500-PO-NBR.             09880099
098900     MOVE TRBNTF-REC-SEQ-NBR         TO TM007-REC-SEQ-NBR         09890099
099000                                        TM500-REC-SEQ-NBR.        09900099
099100     MOVE TRBRSN-TRBL-RSN-CDE        TO TM500-TRBL-RSN-CDE.       09910099
099200                                                                  09920099
099300     MOVE PC-RESOLVE-CREATE-MODULE   TO TM007-CALLED-MODULE.      09930099
099400     MOVE PC-FCLTY-ID                TO TM500-FCLTY-ID.           09940099
099500                                                                  09950099
099600     SET TM007-FAIL-STATUS                                        09960099
099700         TM007-ACKNL-ONLY                                         09970099
099800         PS-RESOLUTION-FAILED-YES                                 09980099
099900         TM007-CALL-SUCCESSFUL                                    09990099
100000         TM500-ACKNOWLEDGE           TO TRUE.                     10000099
100100                                                                  10010099
100200     IF RECEIV-PKGNG-CDE  = ('I' OR 'M')                          10020099
100300        SET TM500-PACK-LEVEL TO TRUE                              10030099
              MOVE 0               TO TM500-PREPK-ID                    10031099
100400     ELSE                                                         10040099
100500        SET TM500-LINE-LEVEL TO TRUE                              10050099
100600     END-IF.                                                      10060099
100700                                                                  10070099
100800     CALL PC-RESOLVE-CREATE-MODULE USING                          10080099
100900                                   TM500-FIELDS                   10090099
101000                                   TM007-COMMUNICATIONS-AREA.     10100099
101100                                                                  10110099
      *    DISPLAY '*********************************************'      10111099
      *    DISPLAY  ' DONE WITH RESOLVED          '                     10112099
      *    DISPLAY 'PO NUMBER FOR 007 ' TRBNTF-PO-NBR                   10113099
      *    DISPLAY 'REC NUMBER FOR 007 ' TRBNTF-REC-SEQ-NBR             10114099
      *    DISPLAY 'TM007-RETURN-STATUS ' TM007-RETURN-STATUS           10115099
      *    DISPLAY 'TM007-RETURN-SQL    ' TM007-RETURN-SQL              10116099
      *    DISPLAY 'TM007-RETURN-CODE   ' TM007-RETURN-CODE             10117099
      *    DISPLAY '*********************************************'      10118099
101200*  EXECUTION STATUS AND ERROR CHECK                               10120099
101300     IF TM007-CALL-SUCCESSFUL                                     10130099
101400        CONTINUE                                                  10140099
101500     ELSE                                                         10150099
101600        PERFORM 8000-DB2-ERROR-CHECK                              10160099
101700     END-IF.                                                      10170099
101800                                                                  10180099
101900******************************************************************10190013
102000**  GET THE OPER_UNT_ID FROM TRECEIV                            **10200013
102100******************************************************************10210013
102200 6710-GET-OPER-UNT-ID.                                            10220013
102300     MOVE '6710-GET-OPER-UNT-ID' TO PV-CURRENT-PARA.              10230099
102400                                                                  10240013
102500     INITIALIZE DCLTRECEIV.                                       10250013
102600                                                                  10260013
102700     MOVE TRBNTF-PO-NBR         TO RECEIV-ORD-NBR.                10270099
102800     MOVE TRBNTF-REC-SEQ-NBR    TO RECEIV-REC-SEQ-NBR.            10280099
102900                                                                  10290013
103000     PERFORM                                                      10300013
103100         WITH TEST AFTER                                          10310013
103200         VARYING PV-RETRY-COUNTER                                 10320013
103300         FROM 1 BY 1                                              10330013
103400         UNTIL PV-RETRY-COUNTER > PC-MAX-RETRIES                  10340013
103500            OR SQLCODE = ZERO                                     10350013
103600            OR SQLCODE = +100                                     10360013
103700            OR SQLCODE = -904                                     10370013
103800            OR SQLCODE = -911                                     10380013
103900            OR SQLCODE = -913                                     10390013
104000                                                                  10400013
104100           EXEC SQL                                               10410013
104200              SELECT OPER_UNT_ID                                  10420013
104300                   , PKGNG_CDE                                    10430099
104400              INTO  :RECEIV-OPER-UNT-ID                           10440013
104500                   ,:RECEIV-PKGNG-CDE                             10450099
104600              FROM   TRECEIV                                      10460013
104700              WHERE  ORD_NBR      = :RECEIV-ORD-NBR               10470022
104800              AND    REC_SEQ_NBR  = :RECEIV-REC-SEQ-NBR           10480013
104900           END-EXEC                                               10490013
105000                                                                  10500013
105100           EVALUATE TRUE                                          10510013
105200               WHEN SQLCODE = 0                                   10520013
105300                   SET TM007-CALL-SUCCESSFUL TO TRUE              10530099
105400                   MOVE RECEIV-OPER-UNT-ID   TO TM007-OPER-UNT-ID 10540099
105500                                                TM500-OPER-UNT-ID 10550099
105600               WHEN SQLCODE = +100                                10560013
105700                    MOVE 'OPER UNIT ID FOUND'                     10570013
105800                                    TO TM007-RETURN-MSG           10580099
105900                    SET TM007-SQL-UNRECOVERABLE-ERROR TO TRUE     10590099
106000                    MOVE SQLCODE    TO TM007-SQLCODE              10600099
106100                    MOVE SQLCA      TO TM007-SQLCA                10610099
106200               WHEN SQLWARN0 NOT = SPACE                          10620013
106300               WHEN SQLCODE = -904                                10630013
106400               WHEN SQLCODE = -911                                10640013
106500               WHEN SQLCODE = -913                                10650013
106600                    IF PV-RETRY-COUNTER > PC-MAX-RETRIES          10660013
106700                       SET TM007-SQL-UNRECOVERABLE-ERROR          10670099
106800                                       TO TRUE                    10680013
106900                       MOVE SQLCODE    TO TM007-SQLCODE           10690013
107000                       MOVE SQLCA      TO TM007-SQLCA             10700013
107100                    END-IF                                        10710013
107200                                                                  10720013
107300           END-EVALUATE                                           10730013
107400     END-PERFORM.                                                 10740013
107500                                                                  10750013
107600*  EXECUTION STATUS AND ERROR CHECK                               10760095
107700     IF TM007-CALL-SUCCESSFUL                                     10770099
107800        CONTINUE                                                  10780099
107900     ELSE                                                         10790099
108000        PERFORM 8000-DB2-ERROR-CHECK                              10800099
108100     END-IF.                                                      10810099
108200                                                                  10820095
108300******************************************************************10830013
108400**                                                              **10840013
108500******************************************************************10850013
108600 6800-UPDATE-AUTOACK-AS-CMPLT.                                    10860031
108700     MOVE '6800-UPDATE-AUTOACKNL-AS-CMPLT' TO PV-CURRENT-PARA.    10870099
      *KBW                                                              10871099
108500*    DISPLAY '**********************************************'     10872099
      *    DISPLAY 'IN PARAGRAPH 6800-UPDATE-AUTOACK-AS-CMPLT'          10872199
      *    DISPLAY 'TRBNTF-NOTIF-NBR ' TRBNTF-NOTIF-NBR                 10872299
109500*    DISPLAY 'TRBNTF-PO-NBR ' TRBNTF-PO-NBR                       10872399
109600*    DISPLAY 'TRBNTF-REC-SEQ-NBR ' TRBNTF-REC-SEQ-NBR             10872599
      *KBW                                                              10874099
108800                                                                  10880013
108900     MOVE TRBNTF-NOTIF-NBR           TO TM007-NOTIF-NBR.          10890013
109000     SET TM007-CMPLT-STATUS                                       10900099
109100         TM007-UPDATE                                             10910099
109200         TM007-CALL-SUCCESSFUL       TO TRUE.                     10920099
109300                                                                  10930099
109400     MOVE PC-AUTOACKNL-MODULE        TO TM007-CALLED-MODULE.      10940094
109500     MOVE TRBNTF-PO-NBR              TO TM007-PO-NBR.             10950013
109600     MOVE TRBNTF-REC-SEQ-NBR         TO TM007-REC-SEQ-NBR.        10960040
109700                                                                  10970013
109800     CALL PC-AUTOACKNL-MODULE USING                               10980099
109900                                    TM007-COMMUNICATIONS-AREA.    10990099
110000                                                                  11000013
      *KBW                                                              11000199
109500*    DISPLAY 'TRBNTF-PO-NBR ' TRBNTF-PO-NBR                       11001099
109600*    DISPLAY 'TRBNTF-REC-SEQ-NBR ' TRBNTF-REC-SEQ-NBR             11002099
108500*    DISPLAY '**********************************************'     11003099
110100*  EXECUTION STATUS AND ERROR CHECK                               11010099
110200     IF TM007-CALL-SUCCESSFUL                                     11020099
110300        CONTINUE                                                  11030099
110400     ELSE                                                         11040099
110500        PERFORM 8000-DB2-ERROR-CHECK                              11050099
110600     END-IF.                                                      11060099
110700                                                                  11070094
110800******************************************************************11080013
110900**                                                              **11090013
111000******************************************************************11100013
111100 7000-UPDATE-AUTOACKNL-AS-WAIT.                                   11110013
111200     MOVE '7000-UPDATE-AUTOACKNL-AS-WAIT' TO PV-CURRENT-PARA.     11120099
111300                                                                  11130013
111400     MOVE TRBNTF-NOTIF-NBR           TO TM007-NOTIF-NBR.          11140013
111500     SET TM007-WAIT-STATUS                                        11150099
111600         TM007-UPDATE                                             11160099
111700         TM007-CALL-SUCCESSFUL       TO TRUE.                     11170099
111800                                                                  11180099
111900     MOVE PC-AUTOACKNL-MODULE        TO TM007-CALLED-MODULE.      11190094
112000                                                                  11200013
112100     CALL PC-AUTOACKNL-MODULE USING                               11210099
112200                                 TM007-COMMUNICATIONS-AREA.       11220099
112300                                                                  11230013
112400*  EXECUTION STATUS AND ERROR CHECK                               11240099
112500     IF TM007-CALL-SUCCESSFUL                                     11250099
112600        CONTINUE                                                  11260099
112700     ELSE                                                         11270099
112800        PERFORM 8000-DB2-ERROR-CHECK                              11280099
112900     END-IF.                                                      11290099
113000                                                                  11300094
113100******************************************************************11310080
113200**  PROCESSING CONTINUES FOR CONTENTION ERRORS WITH JUST AN     **11320099
113210**  EMAIL NOTIFICATION SENT TO THE IS-TMSUPPORT TEAM. ANY       **11321099
113220**  CIRCUMSTANCES THAT ARE PROBLEMATIC, BUT CAN BE ADDRESSED    **11322099
113230**  BY THE SUPPORT TEAM THE NEXT DAY, WILL BE UPDATED TO ERROR  **11323099
113240**  STATUS IN THE TABLE. THE SUPPORT TEAM WILL HAVE TO MANUALLY **11324099
113250**  UPDATE THE STATUS CODE TO 'WAIT' IN THE RCT_AUTOACKNL_TRBL  **11325099
113260**  TABLE AFTER THE ERROR HAS BEEN ADDRESSED. SYSOUT WILL BE    **11326099
113270**  THE SOUCE FOR THE CALLING PROGRAM AND OTHER INFO.           **11327099
113300******************************************************************11330080
113400 8000-DB2-ERROR-CHECK.                                            11340099
113500     MOVE '8000-DB2-ERROR-CHECK' TO PV-CURRENT-PARA.              11350099
113600                                                                  11360080
113700*  CONTENTION SYSOUT                                              11370095
113800     IF TM007-SQL-CONTENTION                                      11380099
113900*       SET SWITCH TO GET NEXT PO FROM CURSOR                     11390099
114000        SET PS-GET-NEW-PO-YES TO TRUE                             11400099
114100        MOVE TM007-SQLCODE  TO PV-DISP-TM007-SQLCODE              11410099
114200        MOVE SQLCODE        TO PV-DISP-SQLCODE                    11420099
114300        DISPLAY '**********************************'              11430099
114400        DISPLAY '**  UNSUCCESSFUL SQL EXECUTION  **'              11440099
114500        DISPLAY '**        DB2 CONTENTION        **'              11450099
114600        DISPLAY '**********************************'              11460099
114700        DISPLAY '** PO_NBR             : ' TM007-PO-NBR           11470099
114800        DISPLAY '** REC_SEQ_NBR        : ' TM007-REC-SEQ-NBR      11480099
114900        DISPLAY '** NOTIF_NBR          : ' TM007-NOTIF-NBR        11490099
115000        DISPLAY '** SQLCODE            : ' PV-DISP-SQLCODE        11500099
115100        DISPLAY '** SQLCA              : ' SQLCA                  11510099
115200        DISPLAY '** TM007 RETURN CODE  : ' TM007-RETURN-CODE      11520099
115300        DISPLAY '** TM007 SQLCODE      : ' PV-DISP-TM007-SQLCODE  11530099
115400        DISPLAY '** TM007 SQLCA        : ' TM007-SQLCA            11540099
115500        DISPLAY '** CURRENT PROGRAM    : ' PC-CURRENT-PROGRAM     11550099
115600        DISPLAY '** CURRENT PARA       : ' PV-CURRENT-PARA        11560099
115700        DISPLAY '** RETURNED MSG       : ' TM007-RETURN-MSG       11570099
115800        DISPLAY '** RETURNED PARA      : ' TM007-RETURNED-PARA    11580099
115900        DISPLAY '** CALLED MODULE NAME : ' TM007-CALLED-MODULE    11590099
116000        DISPLAY '**********************************'              11600099
116100     END-IF.                                                      11610095
116200                                                                  11620095
116300*  THIS IS TO SEND EMAIL NOTIFICATION OF CONTENTION ISSUES TO     11630095
116400*  IS SUPPORT - ALERTING THEM TO CHECK SYSOUT                     11640095
116500*  -AND- SET SWITCH TO GET CONTINUE PROCESSING BY GETTING NEXT REC11650095
116600     IF TM007-SQL-CONTENTION                                      11660099
116700        SET TM007-EMAIL-CONTENTION    TO TRUE                     11670099
116800        SET PS-GET-NEXT-PO-RCVR-YES   TO TRUE                     11680095
116900     END-IF.                                                      11690095
117000                                                                  11700095
117100*  UNRECOVERABLE ERROR SYSOUT                                     11710095
117200     IF TM007-SQL-UNRECOVERABLE-ERROR                             11720099
117300*       SET SWITCH TO GOBACK TO CALLING PROGAM                    11730099
117400        SET PS-DONE TO TRUE                                       11740099
117500        MOVE TM007-SQLCODE  TO PV-DISP-TM007-SQLCODE              11750099
117600        MOVE SQLCODE        TO PV-DISP-SQLCODE                    11760099
117700        DISPLAY '**********************************'              11770099
117800        DISPLAY '**  UNSUCCESSFUL SQL EXECUTION  **'              11780099
117900        DISPLAY '**   UNRECOVERABLE DB2 ERROR    **'              11790099
118000        DISPLAY '**********************************'              11800099
118100        DISPLAY '** PO_NBR             : ' TM007-PO-NBR           11810099
118200        DISPLAY '** REC_SEQ_NBR        : ' TM007-REC-SEQ-NBR      11820099
118300        DISPLAY '** NOTIF_NBR          : ' TM007-NOTIF-NBR        11830099
118400        DISPLAY '** SQLCODE            : ' PV-DISP-SQLCODE        11840099
118500        DISPLAY '** SQLCA              : ' SQLCA                  11850099
118600        DISPLAY '** TM007 RETURN CODE  : ' TM007-RETURN-CODE      11860099
118700        DISPLAY '** TM007 SQLCODE      : ' PV-DISP-TM007-SQLCODE  11870099
118800        DISPLAY '** TM007 SQLCA        : ' TM007-SQLCA            11880099
118900        DISPLAY '** CURRENT PROGRAM    : ' PC-CURRENT-PROGRAM     11890099
119000        DISPLAY '** CURRENT PARA       : ' PV-CURRENT-PARA        11900099
119100        DISPLAY '** RETURNED MSG       : ' TM007-RETURN-MSG       11910099
119200        DISPLAY '** RETURNED PARA      : ' TM007-RETURNED-PARA    11920099
119300        DISPLAY '** CALLED MODULE NAME : ' TM007-CALLED-MODULE    11930099
119400        DISPLAY '**********************************'              11940099
119500     END-IF.                                                      11950095
119600                                                                  11960095
119700*  DB2 UNRECOVERABLE ERROR:                                       11970099
119800*  EXECUTE A DB2 ROLLBACK, UPDATE THE STATUS TO ERROR             11980095
119900*  ON RCT_AUTOACKNL_TRBL, EXECUTE A DB2 COMMIT TO KEEP THE        11990095
120000*  ERROR STATUS ONLY, THEN RETURN 'UNSUCCESSFUL CALL' TO THE      12000099
120100*  CALLING PROGRAM SO IT CAN ABEND.                               12010099
120200     IF TM007-SQL-UNRECOVERABLE-ERROR                             12020099
120300        PERFORM 8800-DB2-ROLLBACK                                 12030095
120400        PERFORM 8500-ERROR-STATUS-UPD                             12040095
120500        PERFORM 8900-DB2-COMMIT                                   12050095
120600     END-IF.                                                      12060095
120700                                                                  12070095
120800*  SEND AN EMAIL NOTIFICATION TO IS SUPPORT TO ALERT OF ABEND     12080095
120900     IF TM007-SQL-UNRECOVERABLE-ERROR                             12090099
121000        SET TM007-EMAIL-ERROR    TO TRUE                          12100099
121100     END-IF.                                                      12110095
121200                                                                  12120095
121300*  SUCCESSFUL SITUATION - BUT UNSUCCESSFUL CONDITION...EXPAND     12130099
121400     IF TM007-SQL-SUCCESSFUL                                      12140099
121500*       SET SWITCH TO GOBACK TO CALLING PROGAM                    12150099
121600        SET PS-DONE TO TRUE                                       12160099
121700        MOVE TM007-SQLCODE  TO PV-DISP-TM007-SQLCODE              12170099
121800        MOVE SQLCODE        TO PV-DISP-SQLCODE                    12180099
121900        DISPLAY '**********************************'              12190099
122000        DISPLAY '**  UNSUCCESSFUL SQL CONDITION  **'              12200099
122100        DISPLAY '**   WAS ENCOUNTERED IN PGM     **'              12210099
122200        DISPLAY '**********************************'              12220099
122300        DISPLAY '** PO_NBR             : ' TM007-PO-NBR           12230099
122400        DISPLAY '** REC_SEQ_NBR        : ' TM007-REC-SEQ-NBR      12240099
122500        DISPLAY '** NOTIF_NBR          : ' TM007-NOTIF-NBR        12250099
122600        DISPLAY '** SQLCODE            : ' PV-DISP-SQLCODE        12260099
122700        DISPLAY '** SQLCA              : ' SQLCA                  12270099
122800        DISPLAY '** TM007 RETURN CODE  : ' TM007-RETURN-CODE      12280099
122900        DISPLAY '** TM007 SQLCODE      : ' PV-DISP-TM007-SQLCODE  12290099
123000        DISPLAY '** TM007 SQLCA        : ' TM007-SQLCA            12300099
123100        DISPLAY '** CURRENT PROGRAM    : ' PC-CURRENT-PROGRAM     12310099
123200        DISPLAY '** CURRENT PARA       : ' PV-CURRENT-PARA        12320099
123300        DISPLAY '** RETURNED MSG       : ' TM007-RETURN-MSG       12330099
123400        DISPLAY '** RETURNED PARA      : ' TM007-RETURNED-PARA    12340099
123500        DISPLAY '** CALLED MODULE NAME : ' TM007-CALLED-MODULE    12350099
123600        DISPLAY '**********************************'              12360099
123700     END-IF.                                                      12370099
123800                                                                  12380099
123900*  DB2 UNRECOVERABLE ERROR:                                       12390099
124000*  EXECUTE A DB2 ROLLBACK, UPDATE THE STATUS TO ERROR             12400099
124100*  ON RCT_AUTOACKNL_TRBL, EXECUTE A DB2 COMMIT TO KEEP THE        12410099
124200*  ERROR STATUS ONLY, THEN RETURN 'UNSUCCESSFUL CALL' TO THE      12420099
124300*  CALLING PROGRAM SO IT CAN ABEND.                               12430099
124400     IF TM007-SQL-UNRECOVERABLE-ERROR                             12440099
124500        PERFORM 8800-DB2-ROLLBACK                                 12450099
124600        PERFORM 8500-ERROR-STATUS-UPD                             12460099
124700        PERFORM 8900-DB2-COMMIT                                   12470099
124800     END-IF.                                                      12480099
124900                                                                  12490099
125000*  SEND AN EMAIL NOTIFICATION TO IS SUPPORT TO ALERT OF ABEND     12500099
125100     IF TM007-SQL-UNRECOVERABLE-ERROR                             12510099
125200        SET TM007-EMAIL-ERROR  TO TRUE                            12520099
125300     END-IF.                                                      12530099
125400                                                                  12540099
125500******************************************************************12550099
125600**                                                              **12560094
125700******************************************************************12570094
125800 8500-ERROR-STATUS-UPD.                                           12580094
125900     MOVE '8500-ERROR-STATUS-UPD'   TO PV-CURRENT-PARA.           12590099
126000                                                                  12600094
126100*  SET SWITCH TO DISCONTINUE CURRENT PROCESING                    12610099
126200     SET PS-DONE TO TRUE.                                         12620099
126300                                                                  12630099
126400*  UPDATE RCT_AUTOACKNL_TRBL STATUS TO ERROR                      12640080
126500     SET TM007-ERROR-STATUS           TO TRUE.                    12650080
126600                                                                  12660080
126700*  UPDATE RCT_AUTOACKNL_TRBL BY USING CALLED MODULE TMKUP501      12670080
126800     SET TM007-UPDATE        TO TRUE                              12680099
126900     CALL PC-AUTOACKNL-MODULE USING TM007-COMMUNICATIONS-AREA     12690099
127000                                                                  12700080
127100*  IF ANY PROBLEMS WITH THIS UPDATE - CALLING PROGRAM MUST ABEND !12710099
127200     IF TM007-SQL-CONTENTION                                      12720099
127300     OR TM007-SQL-UNRECOVERABLE-ERROR                             12730099
127400        MOVE TM007-SQLCODE  TO PV-DISP-TM007-SQLCODE              12740099
127500        MOVE TM007-SQLCODE  TO PV-DISP-SQLCODE                    12750099
127600        DISPLAY '**********************************'              12760080
127700        DISPLAY '**  UNSUCCESSFUL CALLED MODULE  **'              12770080
127800        DISPLAY '**      FOR ERROR UPDATE        **'              12780080
127900        DISPLAY '**********************************'              12790080
128000        DISPLAY '** PO_NBR             : ' TM007-PO-NBR           12800097
128100        DISPLAY '** REC_SEQ_NBR        : ' TM007-REC-SEQ-NBR      12810097
128200        DISPLAY '** NOTIF_NBR          : ' TM007-NOTIF-NBR        12820097
128300        DISPLAY '** SQLCODE            : ' PV-DISP-SQLCODE        12830099
128400        DISPLAY '** SQLCA              : ' SQLCA                  12840099
128500        DISPLAY '** TM007 RETURN CODE  : ' TM007-RETURN-CODE      12850099
128600        DISPLAY '** TM007 SQLCODE      : ' PV-DISP-TM007-SQLCODE  12860099
128700        DISPLAY '** TM007 SQLCA        : ' TM007-SQLCA            12870099
128800        DISPLAY '** CURRENT PROGRAM    : ' PC-CURRENT-PROGRAM     12880097
128900        DISPLAY '** CURRENT PARA       : ' PV-CURRENT-PARA        12890097
129000        DISPLAY '** CALLED MODULE PARA : ' TM007-RETURNED-PARA    12900097
129100        DISPLAY '** CALLED MODULE      : ' TM007-CALLED-MODULE    12910097
129200        DISPLAY '** RETURNED MSG       : ' TM007-RETURN-MSG       12920097
129300        DISPLAY '**********************************'              12930080
129400     END-IF.                                                      12940080
129500                                                                  12950080
129600*  THIS IS TO SEND EMAIL NOTIFICATION TO IS SUPPORT TO NOTIFY     12960080
129700*  THEM THAT AN ERROR UPDATE WAS UNSUCCESSFUL                     12970080
129800     SET TM007-EMAIL-ERROR  TO TRUE.                              12980099
129900                                                                  12990080
130000******************************************************************13000087
130100**                                                              **13010087
130200******************************************************************13020087
130300 8800-DB2-ROLLBACK.                                               13030096
130400     MOVE '8800-DB2-ROLLBACK'  TO PV-CURRENT-PARA.                13040099
130500                                                                  13050087
130600     EXEC SQL                                                     13060094
130700         ROLLBACK                                                 13070094
130800     END-EXEC.                                                    13080094
130900                                                                  13090094
131000     EVALUATE TRUE                                                13100087
131100       WHEN SQLCODE = ZERO                                        13110087
131110          DISPLAY '**********************************'            13111099
131120          DISPLAY '**  DB2 ROLLBACK PERFORMED      **'            13112099
131130          DISPLAY '**      FROM TMKUT500           **'            13113099
131140          DISPLAY '**********************************'            13114099
131200***        CONTINUE                                               13120099
131300                                                                  13130087
131400       WHEN OTHER                                                 13140087
131500          MOVE 'ROLLBACK FAIL' TO TM007-RETURN-MSG                13150099
131600          MOVE  SQLCODE        TO PV-DISP-SQLCODE                 13160099
131700          MOVE  TM007-SQLCODE  TO PV-DISP-TM007-SQLCODE           13170099
131800          DISPLAY '**********************************'            13180099
131900          DISPLAY '**  DB2 ROLLBACK FAILURE        **'            13190099
132000          DISPLAY '**      FROM TMKUT500           **'            13200099
132100          DISPLAY '**********************************'            13210099
132200          DISPLAY '** SQLCODE            : ' PV-DISP-SQLCODE      13220099
132300          DISPLAY '** SQLCA              : ' SQLCA                13230099
132400          DISPLAY '** TM007 SQLCODE      : ' PV-DISP-TM007-SQLCODE13240099
132500          DISPLAY '** TM007 RETURN CODE  : ' TM007-RETURN-CODE    13250099
132600          DISPLAY '** TM007 SQLCA        : ' TM007-SQLCA          13260099
132700          DISPLAY '**********************************'            13270099
132800     END-EVALUATE.                                                13280087
132900                                                                  13290087
133000******************************************************************13300094
133100**                                                              **13310094
133200******************************************************************13320094
133300 8900-DB2-COMMIT.                                                 13330096
133400     MOVE '8900-DB2-COMMIT'  TO PV-CURRENT-PARA.                  13340099
133500                                                                  13350094
133600     EXEC SQL                                                     13360094
133700         COMMIT                                                   13370094
133800     END-EXEC.                                                    13380094
133900                                                                  13390094
134000     EVALUATE TRUE                                                13400094
134100       WHEN SQLCODE = ZERO                                        13410094
134120          DISPLAY '**  PO/REC/NOTIFY - DB2 COMMIT - TMKUT500 **'  13412099
134140     DISPLAY TM007-PO-NBR'/'TM007-REC-SEQ-NBR'/'TM007-NOTIF-NBR   13412199
                DISPLAY '********************************************'  13412299
134200***        CONTINUE                                               13420099
134300                                                                  13430094
134400       WHEN OTHER                                                 13440094
134500          MOVE TM007-SQLCODE   TO PV-DISP-TM007-SQLCODE           13450099
134600          MOVE SQLCODE         TO PV-DISP-SQLCODE                 13460099
134700          MOVE  SQLCA          TO TM007-SQLCA                     13470099
134800          MOVE 'COMMIT FAIL'   TO TM007-RETURN-MSG                13480099
134900          DISPLAY '**********************************'            13490099
135000          DISPLAY '**    DB2 COMMIT FAILURE        **'            13500099
135100          DISPLAY '**      FROM TMKUT500           **'            13510099
135200          DISPLAY '**********************************'            13520099
135300          DISPLAY '** SQLCODE            : ' PV-DISP-SQLCODE      13530099
135400          DISPLAY '** SQLCA              : ' SQLCA                13540099
135500          DISPLAY '** TM007 SQLCODE      : ' PV-DISP-TM007-SQLCODE13550099
135600          DISPLAY '** TM007 RETURN CODE  : ' TM007-RETURN-CODE    13560099
                DISPLAY '** TM007 NOTIF NBR    : ' TM007-NOTIF-NBR      13561099
135700          DISPLAY '** TM007 SQLCA        : ' TM007-SQLCA          13570099
135800          DISPLAY '**********************************'            13580099
135900     END-EVALUATE.                                                13590094
136000                                                                  13600094
136100******************************************************************13610013
136200**                       END PROGRAM                            **13620008
136300******************************************************************13630000
