000100*-----------------------*                                         00010009
000200 IDENTIFICATION DIVISION.                                         00020009
000300*-----------------------*                                         00030009
000400 PROGRAM-ID.    DPKCS056.                                         00040009
000500 AUTHOR.        CHERI MASTEL - COMPUWARE.                         00050009
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060009
000700 DATE-WRITTEN.  04-28-97.                                         00070009
000800 DATE-COMPILED.                                                   00080009
000900*----------------------------------------------------------------*00090009
001000*    Z056 - CRITERIA SPECIFICATION FOR                           *00100009
001100*           MNEMONIC/MENUITEM VSAM AUDIT LOG                     *00110009
001200*                                                                *00120009
001300*    THIS PROGRAM ALLOWS THE USER TO ENTER DATA TO BE USED BY    *00130009
001400*    SUBSEQUENT PROGRAMS TO BROWSE THE AUDIT LOG.                *00140040
001500*                                                                *00150009
001600*    THERE IS 1 DATA ENTERABLE FIELD ON THE SELECTION SCREEN:    *00160042
001700*    MNEMONIC.  IF NOT ENTERED, ALL MNEMONICS WILL BE SHOWN.     *00170040
001800*                                                                *00180042
001900*    THIS PROGRAM WILL INVOKE THE REQUESTED DESTINATION PROGRAM  *00190042
002000*    WHEN THE 'GO-TO' TYPE FUNCTION IS USED.                     *00200042
002100*    (LOCAL-FUNC-01 THRU LOCAL-FUNC-12, WITH DISPOSITION 'G').   *00210042
002200*----------------------------------------------------------------*00220042
002300                                                                  00230042
002400                                                                  00240042
002500 ENVIRONMENT DIVISION.                                            00250042
002600                                                                  00260042
002700                                                                  00270042
002800 DATA DIVISION.                                                   00280042
002900                                                                  00290042
003000                                                                  00300042
003100 WORKING-STORAGE SECTION.                                         00310042
003200                                                                  00320042
003300 01  PC-PROGRAM-CONSTANTS.                                        00330042
003400     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE  'DP056A  '. 00340042
003500     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE  'DPKM056 '. 00350042
003600     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE  'DPKCS056'. 00360042
003700     05  PC-CALENDAR-PGM           PIC  X(08)  VALUE  'DPKUT500'. 00370042
003800     05  PC-ASTERISK               PIC  X(01)  VALUE  '*'.        00380042
003900     05  PC-DASH                   PIC  X(01)  VALUE  '-'.        00390042
004000     05  PC-TSYMSG-NUMBERS.                                       00400042
004100         10  PC-TSYMSG-00005       PIC  9(05)  VALUE  00005.      00410042
004200         10  PC-TSYMSG-00007       PIC  9(05)  VALUE  00007.      00420042
004300         10  PC-TSYMSG-00008       PIC  9(05)  VALUE  00008.      00430042
004400         10  PC-TSYMSG-00009       PIC  9(05)  VALUE  00009.      00440042
004500         10  PC-TSYMSG-00045       PIC  9(05)  VALUE  00045.      00450042
004600         10  PC-TSYMSG-00050       PIC  9(05)  VALUE  00050.      00460042
004700         10  PC-TSYMSG-00148       PIC  9(05)  VALUE  00148.      00470042
004800         10  PC-TSYMSG-00396       PIC  9(05)  VALUE  00396.      00480042
005800                                                                  00580042
005900 01  PS-PROGRAM-SWITCHES.                                         00590042
006000     05  PS-ERROR-SW               PIC  X(01)  VALUE  'N'.        00600042
006100         88  PS-ERROR                          VALUE  'Y'.        00610042
006200         88  PS-NO-ERROR                       VALUE  'N'.        00620042
006300                                                                  00630042
006400 01  PM-PROGRAM-MESSAGES.                                         00640042
006500     05  PM-ABEND-INFO-A.                                         00650042
006600         10  FILLER                PIC X(15)   VALUE              00660042
006700                                   'DP020-SRC-AID: '.             00670042
006800         10  PM-A-SRC-AID          PIC X(02)   VALUE  SPACE.      00680042
006900         10  FILLER                PIC X(19)   VALUE              00690042
007000                                   '. DP020-FK-ACTION: '.         00700042
007100         10  PM-A-FK-ACTION        PIC X(01)   VALUE  SPACE.      00710042
007200         10  FILLER                PIC X(22)   VALUE              00720042
007300                                   '. DP020-FK-DISPN-IND: '.      00730042
007400         10  PM-A-FK-DISPN         PIC X(01)   VALUE  SPACE.      00740042
007500         10  FILLER                PIC X(01)   VALUE '.'.         00750042
007600         10  FILLER                PIC X(19)   VALUE SPACE.       00760042
007700                                                                  00770042
007800                                                                  00780042
007900*----------------------------------------------------------------*00790042
008000*    MAP LAYOUT                                                  *00800042
008100*----------------------------------------------------------------*00810042
008200     COPY DPKM056.                                                00820042
008300                                                                  00830042
008400*----------------------------------------------------------------*00840042
008500*    ATTRIBUTE SETTINGS COPYBOOK.                                *00850042
008600*----------------------------------------------------------------*00860042
008700     COPY DPWS015.                                                00870042
008800                                                                  00880042
008900*----------------------------------------------------------------*00890042
009000*    FUNCTION KEYS COPYBOOK                                      *00900042
009100*----------------------------------------------------------------*00910042
009200     COPY DPWS016.                                                00920042
009300                                                                  00930042
      *----------------------------------------------------------------*00940046
      *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.           *00950046
      *----------------------------------------------------------------*00960046
                                                                        00970045
           COPY DPWS030.                                                00980045
           COPY DPWS930.                                                00981045
009900                                                                  00990042
010000***************************************************************** 01000042
010100*    STANDARD COMMAREA.                                           01010042
010200***************************************************************** 01020042
010300     COPY DPWS020.                                                01030042
010400     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                01040042
010500                                                                  01050042
010600***************************************************************** 01060042
010700*    INTER-APPLICATION COMMAREA.                                  01070042
010800***************************************************************** 01080042
010900         10  INTER-APPL-COMM-AREA PIC X(200).                     01090042
011000     COPY DPWS062.                                                01100042
011100                                                                  01110042
011200***************************************************************** 01120042
011300*    SPECIFIC COMMMAREA FOR DPKCS056.                             01130042
011400***************************************************************** 01140042
011500         10  ASC-SPECIFIC-COMMAREA.                               01150042
011600*                *----------------------------------------------* 01160042
011700*                * MNEMONIC ENTERED ON SCREEN, OR DEFAULT: '*'  * 01170042
011800*                *----------------------------------------------* 01180042
011900             15  ASC-MNEMONIC                PIC  X(08).          01190042
012000         10  FILLER                          PIC  X(2823).        01200042
012100                                                                  01210042
012200*----------------------------------------------------------------*01220042
012300*    ABEND PROCESSING COPYBOOK.                                  *01230042
012400*----------------------------------------------------------------*01240042
012500     COPY DPWS013.                                                01250042
012600                                                                  01260042
012700                                                                  01270042
012800 LINKAGE SECTION.                                                 01280042
012900                                                                  01290042
013000 01  DFHCOMMAREA.                                                 01300042
013100     05  FILLER                         OCCURS  1 TO 4072 TIMES   01310042
013200                                        DEPENDING ON EIBCALEN.    01320042
013300         10  FILLER                     PIC X.                    01330042
013400                                                                  01340042
013500                                                                  01350042
013600 PROCEDURE DIVISION.                                              01360042
013700***************************************************************** 01370042
013800** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. ** 01380042
013900** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  ** 01390042
014000** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            ** 01400042
014100**                                                             ** 01410042
014200** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  ** 01420042
014300** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       ** 01430042
014400***************************************************************** 01440042
014500 0000-MAIN-MODULE.                                                01450042
014600     INITIALIZE DP030-CICS-API-FIELDS.                            01460042
014700     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       01470042
014800     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          01480042
014900     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         01490042
015000     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       01500042
015100     MOVE LENGTH OF DP056AI        TO DP030-MAP-LENGTH (1).       01510042
015200     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     01520042
015300     PERFORM 0001-CALL-CICS-ARCH-API.                             01530042
015400                                                                  01540042
015500     PERFORM 1000-CONTROL-PROCESSING                              01550042
015600                                                                  01560042
015700     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     01570042
015800     PERFORM 0001-CALL-CICS-ARCH-API.                             01580042
015900                                                                  01590042
016000                                                                  01600042
016100 0001-CALL-CICS-ARCH-API.                                         01610042
016200     CALL DP930-CICS-ARCH-API USING DFHEIBLK                      01620047
016300                                    DFHCOMMAREA                   01630047
016400                                    DP030-CICS-API-FIELDS         01640047
016500                                    DP020-STANDARD-COMMAREA       01650047
016600                                    DP056AI.                      01660047
016700                                                                  01670042
016800     IF  DP030-RC-CALL-SUCCESSFUL                                 01680042
016900         CONTINUE                                                 01690042
017000     ELSE                                                         01700042
017100         SET DP013-NO-ROLLBACK                                    01710042
017200             DP013-XCTL-DISPLAY-RESTART                           01720042
017300             DP013-CICS-ABEND      TO TRUE                        01730042
017400         MOVE 'BEFORE 0000-MAIN-MODULE'                           01740042
017500                                   TO DP013-PARAGRAPH             01750042
017600         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O01760048
017700-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      01770048
017800         MOVE DP030-RETURN-CODE                                   01780042
017900                                   TO DP013-MESSAGE-TEXT (3)      01790042
018000         PERFORM DP013-0000-PROCESS-ABEND                         01800042
018100     END-IF.                                                      01810042
018200                                                                  01820042
018300                                                                  01830042
018400*----------------------------------------------------------------*01840042
018500*    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *01850042
018600*    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *01860042
018700*----------------------------------------------------------------*01870042
018800 1000-CONTROL-PROCESSING.                                         01880042
018900                                                                  01890042
019000     EVALUATE TRUE                                                01900042
019100         WHEN DP020-NEXT-ACT-INITIAL                              01910042
019200             INITIALIZE ASC-SPECIFIC-COMMAREA                     01920042
019300             PERFORM 4000-BUILD-INITIAL-PANEL                     01930042
019400                                                                  01940042
019500         WHEN DP020-NEXT-ACT-READ-MAP                             01950042
019600             PERFORM 2000-FKEY-PROCESSING                         01960042
019700                                                                  01970042
019800         WHEN DP020-NEXT-ACT-RETURN                               01980042
019900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 01990042
020000             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02000042
020100                                                                  02010042
020200         WHEN OTHER                                               02020042
020300             SET DP013-LOGIC-ABEND                                02030042
020400                 DP013-NO-ROLLBACK TO TRUE                        02040042
020500             MOVE '1000-CONTROL-PROCESSING'                       02050042
020600                                   TO  DP013-PARAGRAPH            02060042
020700             MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'   02070042
020800                                   TO  DP013-MESSAGE-TEXT(1)      02080042
020900             MOVE DP020-NEXT-APPL-ACTIVITY                        02090042
021000                                   TO DP013-MESSAGE-TEXT(2)       02100042
021100             PERFORM DP013-0000-PROCESS-ABEND                     02110042
021200     END-EVALUATE.                                                02120042
021300                                                                  02130042
021400                                                                  02140042
021500*----------------------------------------------------------------*02150042
021600* FURTHER DETERMINE PROCESSING PATH BASED ON FUNCTION KEY ACTIONS*02160042
021700* SPECIFIC FUNCTION KEYS LISTED HERE ARE ACTED UPON REGARDLESS OF*02170042
021800* EDITS.                                                         *02180042
021900*----------------------------------------------------------------*02190042
022000                                                                  02200042
022100 2000-FKEY-PROCESSING.                                            02210042
022200                                                                  02220042
022300     EVALUATE TRUE                                                02230042
022400                                                                  02240042
022500         WHEN DP020-SRC-AID = DP016-CLEAR                         02250042
022600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02260042
022700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 02270042
022800                                                                  02280042
022900         WHEN DP020-FK-REFRESH(DP020-SRC-AID)                     02290042
023000             INITIALIZE ASC-SPECIFIC-COMMAREA                     02300042
023100             PERFORM 4000-BUILD-INITIAL-PANEL                     02310042
023200             PERFORM 3200-RESET-ATTRIBUTES                        02320042
023300                                                                  02330042
023400         WHEN OTHER                                               02340042
023500             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 02350042
023600             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   02360042
023700             IF  PS-NO-ERROR                                      02370042
023800                 SET DP030-CONTINUE-GO TO TRUE                    02380042
023900                 PERFORM 2100-CHECK-FUNCTION-KEY                  02390042
024000             ELSE                                                 02400042
024100                 SET DP030-OVERRIDE-GO TO TRUE                    02410042
024200             END-IF                                               02420042
024300     END-EVALUATE.                                                02430042
024400                                                                  02440042
024500                                                                  02450042
024600******************************************************************02460042
024700** ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED     **02470042
024800** FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED **02480042
024900** FROM THE CICS ARCHITECTURE API.                              **02490042
025000******************************************************************02500042
025100 2100-CHECK-FUNCTION-KEY.                                         02510042
025200     EVALUATE TRUE                                                02520042
025300*        WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                 02530042
025400         WHEN DP020-FK-DISPN-GO (DP020-SRC-AID)                   02540042
025500             PERFORM 2110-PREPARE-INTER-APPL-COMM                 02550042
025600                                                                  02560042
025700         WHEN DP020-SRC-AID = DP016-ENTER                         02570042
025800             CONTINUE                                             02580042
025900                                                                  02590042
026000         WHEN OTHER                                               02600042
026100             SET DP013-NO-ROLLBACK                                02610042
026200                 DP013-XCTL-DISPLAY-RESTART                       02620042
026300                 DP013-CICS-ABEND  TO TRUE                        02630042
026400             MOVE '2100-CHECK-FUNCTION-KEY'                       02640042
026500                                   TO DP013-PARAGRAPH             02650042
026600             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      02660042
026700                                   TO DP013-MESSAGE-TEXT (1)      02670042
026800             MOVE 'OR CODE MISSING FROM THIS PROGRAM TO PROCESS:' 02680042
026900                                   TO DP013-MESSAGE-TEXT (2)      02690042
027000             MOVE DP020-SRC-AID    TO PM-A-SRC-AID                02700042
027100             MOVE DP020-FK-ACTION (DP020-SRC-AID)                 02710042
027200                                   TO PM-A-FK-ACTION              02720042
027300             MOVE DP020-FK-DISPN-IND (DP020-SRC-AID)              02730042
027400                                   TO PM-A-FK-DISPN               02740042
027500             MOVE PM-ABEND-INFO-A  TO DP013-MESSAGE-TEXT (3)      02750042
027600             MOVE 'REVIEW PFKEYS SETUP FOR THIS MNEMONIC.'        02760042
027700                                   TO DP013-MESSAGE-TEXT (4)      02770042
027800             PERFORM DP013-0000-PROCESS-ABEND                     02780042
027900     END-EVALUATE.                                                02790042
028000                                                                  02800042
028100                                                                  02810042
028200******************************************************************02820042
028300** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **02830042
028400** INTER-APPLICATION COMMAREA.                                  **02840042
028500******************************************************************02850042
028600 2110-PREPARE-INTER-APPL-COMM.                                    02860042
028700     INITIALIZE DP062-INTER-APPL-COMMAREA.                        02870042
028800     MOVE ASC-MNEMONIC             TO DP062-SEL-MNEMONIC.         02880042
028900                                                                  02890042
029000                                                                  02900042
029100*----------------------------------------------------------------*02910042
029200* MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS IN*02920042
029300* THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN THE  *02930042
029400* APPLICATION-SPECIFIC COMMAREA, NOT ON THE SCREEN.              *02940042
029500*----------------------------------------------------------------*02950042
029600 2200-MOVE-SCREEN-TO-COMMAREA.                                    02960042
029700     IF  AMNEML > ZERO                                            02970042
029800         MOVE AMNEMI               TO ASC-MNEMONIC                02980042
029900     ELSE                                                         02990042
030000         IF  AMNEMF = DP015-ERASE-EOF                             03000042
030100             MOVE SPACE            TO ASC-MNEMONIC                03010042
030200         END-IF                                                   03020042
030300     END-IF.                                                      03030042
030400                                                                  03040042
030500                                                                  03050042
030600*----------------------------------------------------------------*03060042
030700* ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *03070042
030800* CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *03080042
030900* A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE DONE*03090042
031000* IN THE DESTINATION PROGRAM, NOT HERE.                          *03100042
031100*----------------------------------------------------------------*03110042
031200 3000-EDIT-DATA-IN-COMMAREA.                                      03120042
031300     PERFORM 3200-RESET-ATTRIBUTES.                               03130042
031400                                                                  03140042
031500     PERFORM 3010-EDIT-MNEMONIC.                                  03150042
031600                                                                  03160042
031700     IF  PS-NO-ERROR                                              03170042
031800         MOVE -1                   TO AMNEML                      03180042
031900         SET DP030-SET-CURSOR-APPL-1                              03190042
032000                                   TO TRUE                        03200042
032100     END-IF.                                                      03210042
032200                                                                  03220042
032300                                                                  03230042
032400******************************************************************03240042
032500** EDIT THE MNEMONIC ENTERED.                                   **03250042
032600******************************************************************03260042
032700 3010-EDIT-MNEMONIC.                                              03270042
032800     IF  ASC-MNEMONIC > SPACE                                     03280042
032900         CONTINUE                                                 03290042
033000     ELSE                                                         03300042
033100         MOVE PC-ASTERISK            TO ASC-MNEMONIC              03310042
033200     END-IF.                                                      03320042
033300                                                                  03330042
033400                                                                  03340042
033500******************************************************************03350042
033600** MOVE THE DEFAULT ATTRIBUTES TO ALL OF THE OPEN FIELDS ON THE **03360042
033700** MAP.                                                         **03370042
033800******************************************************************03380042
033900 3200-RESET-ATTRIBUTES.                                           03390042
034000     MOVE DP015-UNP-ALP-NOR-OFF    TO AMNEMA.                     03400042
034100     MOVE DP015-GREEN              TO AMNEMC.                     03410042
034200     MOVE DP015-UNDERLINE          TO AMNEMH.                     03420042
034300                                                                  03430042
034400                                                                  03440042
034500*----------------------------------------------------------------*03450042
034600*  POSITION THE CURSOR AT THE APPROPRIATE FIELD.                 *03460042
034700*  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *03470042
034800*  IT HERE.  (IE: PRE-FILLED FIELDS)                             *03480042
034900*----------------------------------------------------------------*03490042
035000 4000-BUILD-INITIAL-PANEL.                                        03500042
035100     SET DP030-SET-CURSOR-APPL-1   TO TRUE                        03510042
035200     MOVE -1                       TO AMNEML.                     03520042
035300                                                                  03530042
035400                                                                  03540042
035500                                                                  03550042
035600*----------------------------------------------------------------*03560042
035700*    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *03570042
035800*----------------------------------------------------------------*03580042
035900 4400-MOVE-COMMAREA-TO-SCREEN.                                    03590042
036000     IF ASC-MNEMONIC  =  PC-ASTERISK                              03600042
036100         MOVE SPACE                TO AMNEMO                      03610042
036200     ELSE                                                         03620042
036300         MOVE ASC-MNEMONIC         TO AMNEMO                      03630042
036400     END-IF.                                                      03640042
036500                                                                  03650042
036600                                                                  03660042
036700*----------------------------------------------------------------*03670042
036800*    ABEND PROCESSOR MODULE                                      *03680042
036900*----------------------------------------------------------------*03690042
037000     COPY DPPD013.                                                03700042
