000100 IDENTIFICATION DIVISION.                                         00010000
000200 PROGRAM-ID.    AHKUT011.                                         00020001
000300 AUTHOR.        CHERI MASTEL.                                     00030000
000400 INSTALLATION.  KOHLS.                                            00040000
000500 DATE-WRITTEN   AUG, 1997.                                        00050000
000600 DATE-COMPILED.                                                   00060000
000700                                                                  00070000
000800******************************************************************00080029
000900*   AHKUT011.  "ARCHIVE HISTORY" PROJECT.  EXTRACT PROGRAM.      *00090029
001000*                                                                *00100029
001100*   PURPOSE:                                                     *00110029
001200*   THIS PROGRAM CREATES AN EXTRACT FILE FROM: TMDINVC.          *00120029
001300*   THIS EXTRACT FILE CONSISTS OF ROWS ELIGIBLE TO BE:           *00130029
001400*   1) LOADED TO THE "ARCHIVE/HISTORY" VERSIONS OF THE TABLES.   *00140029
001500*   2) DELETED FROM THE OPERATIONAL VERSIONS OF THE TABLES.      *00150029
001600*                                                                *00160029
001700*   PROCESSING OVERVIEW:                                         *00170029
001800*   THIS PROGRAM READS A "DRIVER" FILE. FOR EACH RECORD READ,    *00180029
001900*   1) INCREMENT COUNT OF RECORDS READ.                          *00190029
002000*   2) ATTEMPT TO FIND RELATED ROW(S) ON THE TABLE.              *00200029
002100*      2.A) IF NO MATCH(ES):                                     *00210029
002200*           2.A.1) PROCESSING CONTINUES                          *00220029
002300*           2.A.2) DO NOT PERFORM ERROR/REPORTING ROUTINES;      *00230029
002400*                  THIS SYSTEM DOES NOT CLEANSE DATA NOR REPORT  *00240029
002500*                  ON UNCLEAN DATA.  IT SIMPLY MIGRATES          *00250029
002600*                  CONDITIONS OCCURRING IN OPERATIONAL           *00260029
002700*                  TABLES OVER TO THE ARCHIVE/HISTORY TABLES.    *00270029
002800*      2.B) IF MATCH(ES):                                        *00280029
002900*           2.B.1) INCREMENT COUNT OF ROW(S) FOUND.              *00290029
003000*           2.B.2) WRITE THESE ROW(S) TO THE EXTRACT FILE.       *00300029
003100*           2.B.3) INCREMENT COUNT OF RECORDS WRITTEN.           *00310029
003200*           2.B.4) DO NOT REMOVE THE ROW(S) FROM THE TABLE       *00320029
003300*                  AT THIS TIME.  THEY WILL BE REMOVED IN OTHER  *00330029
003400*                  PROCESSING, AFTER HAVING BEEN LOADED TO THE   *00340029
003500*                  ARCHIVE/HISTORY TABLE.                        *00350029
003600*   3) EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *00360029
003700*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *00370029
003800*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *00380029
003810*----------------------------------------------------------------*00381038
003820*  CHANGE LOG:                                                   *00382038
003891* 06/19/07                                                       *00389141
003892*     MATCH BY DC PROJECT.                                       *00389238
003893*     INCREASED SIZE OF INPUT FILE FROM 186 TO 189.  THIS WAS    *00389338
003894*     NEEDED TO ALLOW FOR THE 2 NEW FIELDS IN THE AHRD001        *00389438
003895*     COPYBOOK: DC-NBR AND MTCH-LVL-CDE.                         *00389538
003896* MADE BY: MICHELE RINDFLEISCH                 WR# 32804         *00389640
003897*----------------------------------------------------------------*00389738
003900******************************************************************00390029
004000 ENVIRONMENT DIVISION.                                            00400000
004100 CONFIGURATION SECTION.                                           00410000
004200 SOURCE-COMPUTER.        IBM-3090.                                00420000
004300 OBJECT-COMPUTER.        IBM-3090.                                00430000
004400                                                                  00440000
004500 INPUT-OUTPUT SECTION.                                            00450000
004600 FILE-CONTROL.                                                    00460000
004700                                                                  00470000
004800     SELECT IN-DRIVER-FILE                ASSIGN TO IN01.         00480010
004900     SELECT OUT-EXTRACT-FILE              ASSIGN TO OUT01.        00490010
005000                                                                  00500000
005100******************************************************************00510000
005200 DATA DIVISION.                                                   00520000
005300 FILE SECTION.                                                    00530000
005400                                                                  00540000
005500 FD  IN-DRIVER-FILE                                               00550000
005600     RECORDING MODE IS F                                          00560000
005700     LABEL RECORDS ARE STANDARD                                   00570000
005800     BLOCK CONTAINS 0 RECORDS.                                    00580000
005900 01  IN-DRIVER-RECORD                PIC  X(189).                 00590038
006000                                                                  00600000
006100**** TMDINVC:                                                     00610000
006200 FD  OUT-EXTRACT-FILE                                             00620000
006300     RECORDING MODE IS F                                          00630000
006400     LABEL RECORDS ARE STANDARD                                   00640000
006500     BLOCK CONTAINS 0 RECORDS.                                    00650000
006600 01  OUT-EXTRACT-RECORD              PIC  X(060).                 00660030
006700                                                                  00670000
006800                                                                  00680000
006900                                                                  00690000
007000 WORKING-STORAGE SECTION.                                         00700000
007100                                                                  00710000
007200 01  PC-PROGRAM-CONSTANTS.                                        00720000
007300     05  PC-CURRENT-PROGRAM-NAME     PIC X(08) VALUE 'AHKUT011'.  00730001
007400     05  PC-PGM-PROGRESS-DESC.                                    00740000
007500         10  PC-BEGINNING            PIC X(09) VALUE 'BEGINNING'. 00750000
007600         10  PC-CONTINUING           PIC X(10) VALUE              00760001
007700                                               'CONTINUING'.      00770000
007800         10  PC-ENDING               PIC X(06) VALUE 'ENDING'.    00780000
007900         10  PC-ABENDING             PIC X(08) VALUE 'ABENDING'.  00790000
008000     05  PC-ABEND-INFO.                                           00800000
008100         10  PC-ABEND                PIC X(11) VALUE              00810000
008200                                               '** ABEND **'.     00820000
008300         10  PC-ABEND-MSG-PARA       PIC X(15) VALUE              00830000
008400                                               '- PARA       : '. 00840000
008500         10  PC-ABEND-MSG-DISPLAY-PARA                            00850000
008600                                     PIC X(15) VALUE              00860000
008700                                               '  CALLED PARA: '. 00870000
008800         10  PC-ABEND-MSG-NUMBER     PIC X(15) VALUE              00880000
008900                                               '  FOR ABEND# : '. 00890000
009000         10  PC-ABEND-MSG-DESC       PIC X(15) VALUE              00900000
009100                                               '- ERROR IS   : '. 00910000
009200         10  PC-ABEND-MSG-INDENT-15  PIC X(15) VALUE SPACES.      00920000
009300         10  PC-ABEND-MSG-ACTION     PIC X(15) VALUE              00930000
009400                                               '- ACTION     : '. 00940000
009500     05  PC-HOW-OFTEN-TO-DISPLAY     PIC 9(9)  VALUE 100000.      00950021
009600                                                                  00960000
009700 01  PS-PROGRAM-SWITCHES.                                         00970000
009800     05  PS-IN-DRIVER-EOF-SW         PIC X(01) VALUE 'N'.         00980000
009900         88  PS-IN-DRIVER-EOF                  VALUE 'Y'.         00990000
010000         88  PS-IN-DRIVER-NOT-EOF              VALUE 'N'.         01000000
010100     05  PS-SELECT-HAS-DATA-SW       PIC X(01) VALUE 'N'.         01010035
010200         88  PS-SELECT-HAS-DATA                VALUE 'Y'.         01020035
010300         88  PS-SELECT-HAS-NO-DATA             VALUE 'N'.         01030035
010400                                                                  01040000
010500 01  PV-PROGRAM-VARIABLES.                                        01050000
010600     05  PV-PO-NBR                   PIC S9(9) VALUE 0.           01060036
010700     05  PV-PO-NBR-NUM               PIC  9(9) VALUE 0.           01070036
010800     05  PV-IN-DRIVER-RECS-READ-CNT  PIC  9(9) VALUE 0.           01080001
010900     05  PV-RECS-WITH-MATCHES-CNT    PIC  9(9) VALUE 0.           01090001
011000     05  PV-TABLE-ROW-SELECT-CNT     PIC  9(9) VALUE 0.           01100001
011100     05  PV-EXTRACT-WRITTEN-CNT      PIC  9(9) VALUE 0.           01110001
011200                                                                  01120000
011300     05  PV-PARAGRAPH-NAME           PIC X(30) VALUE SPACES.      01130000
011400     05  PV-DB2-OPERATION-MSG-1      PIC X(79) VALUE SPACES.      01140000
011500     05  PV-DB2-TABLE-NAME           PIC X(18) VALUE SPACES.      01150000
011600     05  PV-DISPLAY-NTH-MULTIPLE     PIC 9(9)  VALUE 0.           01160000
011700     05  PV-DISPLAY-NTH-REMAINDER    PIC 9(9)  VALUE 0.           01170000
011800     05  PV-SQLCODE                  PIC +999  VALUE ZERO.        01180011
011900                                                                  01190004
012000     05  PV-TMST                     PIC X(26) VALUE SPACES.      01200011
012100     05  PV-TIMESTAMP-DETAIL                                      01210011
012200         REDEFINES                                                01220011
012300         PV-TMST.                                                 01230011
012400         10  PV-TIMESTAMP-19.                                     01240011
012500             15  PV-TMS-DATE.                                     01250011
012600                 20  PV-TMS-YEAR.                                 01260011
012700                     25  PV-TMS-CC   PIC X(02).                   01270011
012800                     25  PV-TMS-YY   PIC X(02).                   01280011
012900                 20  FILLER          PIC X(01).                   01290011
013000                 20  PV-TMS-MONTH    PIC X(02).                   01300011
013100                 20  FILLER          PIC X(01).                   01310011
013200                 20  PV-TMS-DAY      PIC X(02).                   01320011
013300             15  FILLER              PIC X(01).                   01330011
013400             15  PV-TMS-HOUR         PIC X(02).                   01340011
013500             15  FILLER              PIC X(01).                   01350011
013600             15  PV-TMS-MINUTE       PIC X(02).                   01360011
013700             15  FILLER              PIC X(01).                   01370011
013800             15  PV-TMS-SECOND       PIC X(02).                   01380011
013900         10  FILLER                  PIC X(01).                   01390011
014000         10  PV-TMS-MSECOND          PIC X(06).                   01400011
014100                                                                  01410007
014200 01  DM-DISPLAY-MESSAGE.                                          01420016
014300     05  DM-01-10.                                                01430016
014400         10  DM-PROGRAM              PIC X(08) VALUE SPACE.       01440016
014500         10  FILLER                  PIC X(02) VALUE ': '.        01450016
014600     05  DM-11-80.                                                01460017
014700         10  FILLER                  PIC X(37) VALUE              01470017
014800                        'SELECT ROWS MATCHING TO DRIVER FILE, '.  01480019
014900         10  FILLER                  PIC X(30) VALUE              01490017
015000                        'CREATING TMDINVC EXTRACT FILE.'.         01500017
015100         10  FILLER                  PIC X(01) VALUE SPACE.       01510016
015200         10  FILLER                  PIC X(02) VALUE ALL '*'.     01520018
015300     05  DM-81-120.                                               01530017
015400         10  FILLER                  PIC X(40) VALUE ALL '*'.     01540017
015500                                                                  01550000
015600 01  DP-DISPLAY-PROGRESS-MSG.                                     01560000
015700     05  DP-PROGRAM                  PIC X(08) VALUE SPACE.       01570000
015800     05  FILLER                      PIC X(02) VALUE SPACE.       01580015
015900     05  DP-STATUS-DESCRIPTION       PIC X(10) VALUE SPACE.       01590007
016000     05  FILLER                      PIC X(04) VALUE ' AT '.      01600000
016100     05  DP-TIMESTAMP-19             PIC X(19) VALUE SPACE.       01610007
016200     05  FILLER                      PIC X(03) VALUE '.  '.       01620005
016300     05  FILLER                      PIC X(03) VALUE              01630008
016400                                         'IN:'.                   01640008
016500     05  DP-IN-CNT                   PIC ZZZ,ZZZ,ZZ9              01650013
016600                                               VALUE ZERO.        01660013
016700     05  FILLER                      PIC X(02) VALUE ', '.        01670000
016800     05  FILLER                      PIC X(14) VALUE              01680005
016900                                         'ROWS SELECTED:'.        01690005
017000     05  DP-ROWS-SELECTED-CNT        PIC ZZZ,ZZZ,ZZ9              01700013
017100                                               VALUE ZERO.        01710013
017200     05  FILLER                      PIC X(02) VALUE ', '.        01720000
017300     05  FILLER                      PIC X(04) VALUE              01730008
017400                                         'OUT:'.                  01740008
017500     05  DP-OUT-CNT                  PIC ZZZ,ZZZ,ZZ9              01750013
017600                                               VALUE ZERO.        01760013
017700     05  FILLER                      PIC X(01) VALUE '.'.         01770000
017800                                                                  01780000
017900 01  ABEND-CODE                      PIC S9(04)                   01790000
018000                                               VALUE ZEROES       01800000
018100                                               COMP SYNC.         01810000
018200                                                                  01820000
018300*---------------------------------------------------------------* 01830000
018400*  DB2 FORMATTED MESSAGE AREA                                     01840000
018500*---------------------------------------------------------------* 01850000
018600     COPY DPWS004.                                                01860011
018700                                                                  01870000
018800                                                                  01880001
018900*---------------------------------------------------------------* 01890001
019000*  AHRD001  - RECORD LAYOUT FOR DRIVER FILE, INPUT.             * 01900024
019100*---------------------------------------------------------------* 01910001
019200     COPY AHRD001.                                                01920024
019300                                                                  01930001
019400                                                                  01940000
019500*---------------------------------------------------------------* 01950000
019600*    DB2 AREA FOR TMDINVC                                       * 01960000
019700*---------------------------------------------------------------* 01970000
019800     EXEC SQL                                                     01980000
019900          INCLUDE TMDINVC                                         01990000
020000     END-EXEC.                                                    02000000
020100                                                                  02010000
020200*---------------------------------------------------------------* 02020000
020300*    DB2 AREA FOR COMMUNICATIONS                                * 02030000
020400*---------------------------------------------------------------* 02040000
020500     EXEC SQL                                                     02050000
020600          INCLUDE SQLCA                                           02060000
020700     END-EXEC.                                                    02070000
020800                                                                  02080000
020900                                                                  02090000
021000 PROCEDURE DIVISION.                                              02100000
021100********************                                              02110000
021200                                                                  02120000
021300 0000-PROGRAM-MAINLINE.                                           02130000
021400                                                                  02140000
021500     PERFORM 1000-INITIALIZE.                                     02150000
021600                                                                  02160000
021700     SET PS-IN-DRIVER-NOT-EOF TO TRUE.                            02170000
021800     PERFORM 2000-PROCESS-DRIVER-FILE                             02180000
021900         UNTIL PS-IN-DRIVER-EOF.                                  02190000
022000                                                                  02200000
022100     PERFORM 6000-EOJ-ROUTINE.                                    02210000
022200     STOP RUN.                                                    02220000
022300                                                                  02230000
022400                                                                  02240000
022500******************************************************************02250029
022600*   INITIALIZATIONS                                              *02260029
022700******************************************************************02270029
022800 1000-INITIALIZE.                                                 02280000
022900                                                                  02290000
023000     MOVE PC-CURRENT-PROGRAM-NAME TO DM-PROGRAM.                  02300016
023100     DISPLAY DM-DISPLAY-MESSAGE.                                  02310016
023200                                                                  02320016
023300     MOVE PC-BEGINNING              TO DP-STATUS-DESCRIPTION.     02330000
023400     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           02340000
023500                                                                  02350000
023600     PERFORM 9000-OPEN-IN-DRIVER-FILE.                            02360000
023700     PERFORM 9700-OPEN-OUT-EXTRACT-FILE.                          02370000
023800                                                                  02380000
023900                                                                  02390000
024000******************************************************************02400029
024100*   1) GET NEXT RECORD FROM DRIVER FILE, AND                     *02410029
024200*      1A- POPULATE KEY (WHERE CLAUSE) FOR TABLE CURSOR          *02420029
024300*      1B- OPEN TABLE CURSOR                                     *02430029
024400*      1C- LOOP THRU TABLE CURSOR TO EXTRACT ALL                 *02440029
024500*          ROWS FOR THIS INPUT DRIVER RECORD                     *02450029
024600*      2) FOR EACH ROW,                                          *02460029
024700*         2A- INCREMENT COUNTS                                   *02470029
024800*         2B- WRITE EXTRACT RECORD                               *02480029
024900*      1D- CLOSE TABLE CURSOR                                    *02490029
025000******************************************************************02500029
025100 2000-PROCESS-DRIVER-FILE.                                        02510000
025200                                                                  02520000
025300     PERFORM 9050-READ-IN-DRIVER-FILE.                            02530000
025400     IF PS-IN-DRIVER-EOF                                          02540000
025500        CONTINUE                                                  02550031
025600     ELSE                                                         02560000
025700        PERFORM 2100-CHECK-PGM-PROGRESS                           02570031
025800        PERFORM 3000-EXTRACT-ROW-FROM-TABLE                       02580031
025900     END-IF.                                                      02590011
026000                                                                  02600000
026100                                                                  02610000
026200******************************************************************02620029
026300*      EVERY NTH RECORD (IE: INITIAL SETTING 1000), REPORT       *02630029
026400*      RECORD COUNT AND CURRENT DATE/TIME.  THIS WILL ASSIST     *02640029
026500*      WITH RUN-TIME ESTIMATE OF TIME REMAINING TO COMPLETE.     *02650029
026600******************************************************************02660029
026700 2100-CHECK-PGM-PROGRESS.                                         02670000
026800     DIVIDE    PV-IN-DRIVER-RECS-READ-CNT                         02680000
026900         BY        PC-HOW-OFTEN-TO-DISPLAY                        02690011
027000         GIVING    PV-DISPLAY-NTH-MULTIPLE                        02700011
027100         REMAINDER PV-DISPLAY-NTH-REMAINDER.                      02710011
027200                                                                  02720000
027300     IF PV-DISPLAY-NTH-REMAINDER = ZERO                           02730000
027400         MOVE PC-CONTINUING         TO DP-STATUS-DESCRIPTION      02740000
027500         PERFORM 6200-DISPLAY-PGM-PROGRESS                        02750011
027600     END-IF.                                                      02760011
027700                                                                  02770000
027800                                                                  02780000
027900******************************************************************02790029
028000*   EXTRACT ROWS FROM TABLE, FOR THE CURRENT DRIVER RECORD       *02800029
028100******************************************************************02810029
028200 3000-EXTRACT-ROW-FROM-TABLE.                                     02820031
028300     INITIALIZE DCLTMDINVC.                                       02830000
028400     PERFORM 9150-SELECT-MDINVC.                                  02840031
028500     IF PS-SELECT-HAS-DATA                                        02850035
028600        PERFORM 9750-WRITE-EXTRACT-RECORD                         02860035
028700        SET PS-SELECT-HAS-NO-DATA TO TRUE                         02870035
028800     END-IF.                                                      02880035
028900                                                                  02890035
029000                                                                  02900035
029100******************************************************************02910035
029200*   DISPLAY END OF RUN MESSAGE, CLOSE THE OUTPUT FILES           *02920035
029300******************************************************************02930035
029400 6000-EOJ-ROUTINE.                                                02940035
029500                                                                  02950035
029600     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           02960035
029700     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         02970035
029800                                                                  02980035
029900     MOVE PC-ENDING                 TO DP-STATUS-DESCRIPTION.     02990035
030000     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           03000035
030100                                                                  03010035
030200                                                                  03020035
030300******************************************************************03030035
030400*   DISPLAY PROGRAM PROGRESS.                                    *03040035
030500******************************************************************03050035
030600 6200-DISPLAY-PGM-PROGRESS.                                       03060035
030700                                                                  03070035
030800     EXEC SQL                                                     03080035
030900          SET :PV-TMST = CURRENT TIMESTAMP                        03090035
031000     END-EXEC.                                                    03100035
031100                                                                  03110035
031200     MOVE PC-CURRENT-PROGRAM-NAME   TO DP-PROGRAM.                03120035
031300     MOVE PV-TIMESTAMP-19           TO DP-TIMESTAMP-19.           03130035
031400     MOVE PV-IN-DRIVER-RECS-READ-CNT                              03140035
031500                                    TO DP-IN-CNT.                 03150035
031600     MOVE PV-TABLE-ROW-SELECT-CNT   TO DP-ROWS-SELECTED-CNT.      03160035
031700     MOVE PV-EXTRACT-WRITTEN-CNT    TO DP-OUT-CNT.                03170035
031800                                                                  03180035
031900     DISPLAY DP-DISPLAY-PROGRESS-MSG.                             03190035
032000                                                                  03200035
032100                                                                  03210035
032200******************************************************************03220035
032300*   FILE AND DB2 TABLE ACCESS PARAGRAPHS.                        *03230035
032400*   90XX- INPUT:  DRIVER FILE                                    *03240035
032500*   91XX- INPUT:  TABLE CURSOR                                   *03250035
032600*   97XX- OUTPUT: TABLE EXTRACT                                  *03260035
032700******************************************************************03270035
032800                                                                  03280035
032900******************************************************************03290035
033000*   OPEN  INPUT DRIVER FILE                                      *03300035
033100******************************************************************03310035
033200 9000-OPEN-IN-DRIVER-FILE.                                        03320035
033300     OPEN  INPUT  IN-DRIVER-FILE.                                 03330035
033400                                                                  03340035
033500                                                                  03350035
033600******************************************************************03360035
033700*   READ  INPUT DRIVER FILE OF ELIGIBLE DATA TO EXTRACT          *03370035
033800******************************************************************03380035
033900 9050-READ-IN-DRIVER-FILE.                                        03390035
034000     READ IN-DRIVER-FILE                                          03400035
034100          INTO AH001-DRIVER-RECORD-LAYOUT                         03410035
034200          AT END                                                  03420035
034300              SET PS-IN-DRIVER-EOF TO TRUE.                       03430035
034400                                                                  03440035
034500     IF PS-IN-DRIVER-EOF                                          03450035
034600         CONTINUE                                                 03460035
034700     ELSE                                                         03470035
034800         ADD +1 TO PV-IN-DRIVER-RECS-READ-CNT                     03480035
034900     END-IF.                                                      03490035
035000                                                                  03500035
035100                                                                  03510035
035200******************************************************************03520035
035300*   CLOSE INPUT DRIVER FILE                                      *03530035
035400******************************************************************03540035
035500 9090-CLOSE-IN-DRIVER-FILE.                                       03550035
035600     CLOSE IN-DRIVER-FILE.                                        03560035
035700                                                                  03570035
035800                                                                  03580035
035900******************************************************************03590035
036000*   FETCH TABLE CURSOR                                           *03600035
036100******************************************************************03610035
036200 9150-SELECT-MDINVC.                                              03620035
036300     EXEC SQL                                                     03630035
036400           SELECT                                                 03640035
036500             PO_NBR                                               03650035
036600            ,INVC_ID                                              03660035
036700            ,BOL_ID                                               03670035
036800            ,VEND_FRGT_PCT                                        03680035
036900            ,KOHLS_FRGT_PCT                                       03690035
037000            ,TERM_SEL_CDE                                         03700035
037100            ,TOT_INVC_PC_QTY                                      03710035
037200            ,IMPRT_CHRG_PRC_CDE                                   03720035
037300            ,PAYT_REQ_SEQ_NBR                                     03730035
037400           INTO                                                   03740035
037500             :MDINVC-PO-NBR                                       03750035
037600            ,:MDINVC-INVC-ID                                      03760035
037700            ,:MDINVC-BOL-ID                                       03770035
037800            ,:MDINVC-VEND-FRGT-PCT                                03780035
037900            ,:MDINVC-KOHLS-FRGT-PCT                               03790035
038000            ,:MDINVC-TERM-SEL-CDE                                 03800035
038100            ,:MDINVC-TOT-INVC-PC-QTY                              03810035
038200            ,:MDINVC-IMPRT-CHRG-PRC-CDE                           03820035
038300            ,:MDINVC-PAYT-REQ-SEQ-NBR                             03830035
038400           FROM TMDINVC                                           03840035
038500          WHERE PO_NBR  = :AH001-B-PO-NBR                         03850035
038600            AND INVC_ID = :AH001-B-INVC-ID                        03860035
038700           WITH  UR                                               03870035
038800     END-EXEC.                                                    03880035
038900                                                                  03890035
039000                                                                  03900035
039100     EVALUATE TRUE                                                03910035
039200         WHEN SQLCODE = ZERO                                      03920035
039300              ADD +1                 TO PV-TABLE-ROW-SELECT-CNT   03930035
039400              SET PS-SELECT-HAS-DATA TO TRUE                      03940035
039500         WHEN SQLCODE = +100                                      03950035
039600              SET PS-SELECT-HAS-NO-DATA TO TRUE                   03960035
039700              MOVE AH001-B-PO-NBR TO PV-PO-NBR                    03970035
039800              MOVE PV-PO-NBR      TO PV-PO-NBR-NUM                03980036
039900              DISPLAY 'NO TMDINVC ROW FOUND FOR'                  03990035
040000              DISPLAY 'PO NBR : ' PV-PO-NBR-NUM                   04000036
040100              DISPLAY 'INVC ID: ' AH001-B-INVC-ID                 04010035
040200         WHEN SQLWARN0 NOT EQUAL SPACE                            04020035
040300         WHEN SQLCODE NOT EQUAL ZERO                              04030035
040400              MOVE '9150-SELECT-MDINVC'                           04040035
040500                                 TO PV-PARAGRAPH-NAME             04050035
040600              MOVE 'SELECT ROW ON TMDINVC'                        04060037
040700                                 TO PV-DB2-OPERATION-MSG-1        04070035
040800              MOVE 'TMDINVC'     TO PV-DB2-TABLE-NAME             04080035
040900              PERFORM 9999-DB2-ABEND                              04090035
041000     END-EVALUATE.                                                04100035
041100                                                                  04110035
041200                                                                  04120035
041300******************************************************************04130035
041400*   OPEN OUTPUT EXTRACT FILE                                     *04140035
041500******************************************************************04150035
041600 9700-OPEN-OUT-EXTRACT-FILE.                                      04160035
041700     OPEN OUTPUT OUT-EXTRACT-FILE.                                04170035
041800                                                                  04180035
041900                                                                  04190035
042000******************************************************************04200035
042100*   WRITE A RECORD TO THE TABLE EXTRACT FILE                     *04210035
042200******************************************************************04220035
042300 9750-WRITE-EXTRACT-RECORD.                                       04230035
042400     WRITE  OUT-EXTRACT-RECORD  FROM  DCLTMDINVC.                 04240035
042500     ADD +1 TO PV-EXTRACT-WRITTEN-CNT.                            04250035
042600                                                                  04260035
042700                                                                  04270035
042800******************************************************************04280035
042900*   CLOSE OUTPUT EXTRACT FILE                                    *04290035
043000******************************************************************04300035
043100 9790-CLOSE-OUT-EXTRACT-FILE.                                     04310035
043200     CLOSE OUT-EXTRACT-FILE.                                      04320035
043300                                                                  04330035
043400                                                                  04340035
043500******************************************************************04350035
043600*   DISPLAY INFORMATION NEEDED FOR DEBUGGING/MAINTENANCE/SUPPORT *04360035
043700*   AND CALL THE ABEND PROCESSOR IN THE EVENT THAT AN            *04370035
043800*   SQL ERROR OR WARNING CODE OCCURS.                            *04380035
043900******************************************************************04390035
044000 9999-DB2-ABEND.                                                  04400035
044100                                                                  04410035
044200     DISPLAY PC-CURRENT-PROGRAM-NAME                              04420035
044300             ' 9999-DB2-ABEND'.                                   04430035
044400     DISPLAY PC-CURRENT-PROGRAM-NAME                              04440035
044500             ' ** ABEND           **'.                            04450035
044600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04460035
044700             ' ** PARAGRAPH       ** = ' PV-PARAGRAPH-NAME.       04470035
044800     DISPLAY PC-CURRENT-PROGRAM-NAME                              04480035
044900             ' ** TABLES AFFECTED ** = ' PV-DB2-TABLE-NAME.       04490035
045000     DISPLAY PC-CURRENT-PROGRAM-NAME                              04500035
045100             ' ** OPERATION       ** = ' PV-DB2-OPERATION-MSG-1.  04510035
045200                                                                  04520035
045300     DISPLAY PC-CURRENT-PROGRAM-NAME                              04530035
045400             ' ** SQLCODE         ** = ' SQLCODE.                 04540035
045500     MOVE SQLCODE TO PV-SQLCODE.                                  04550035
045600     DISPLAY PC-CURRENT-PROGRAM-NAME                              04560035
045700             ' ** PV-SQLCODE      ** = ' PV-SQLCODE '.'.          04570035
045800                                                                  04580035
045900     DISPLAY PC-CURRENT-PROGRAM-NAME                              04590035
046000             ' ** SQLWARN0        ** = ' SQLWARN0 '.'.            04600035
046100                                                                  04610035
046200                                                                  04620035
046300*----------------------------------------------------------------*04630035
046400* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-   *04640035
046500* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE        *04650035
046600* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE    *04660035
046700* FORMAT.                                                        *04670035
046800*----------------------------------------------------------------*04680035
046900     COPY DPPD004.                                                04690035
047000                                                                  04700035
047100     MOVE PC-ABENDING               TO DP-STATUS-DESCRIPTION.     04710035
047200     PERFORM 6200-DISPLAY-PGM-PROGRESS.                           04720035
047300     PERFORM 9090-CLOSE-IN-DRIVER-FILE.                           04730035
047400     PERFORM 9790-CLOSE-OUT-EXTRACT-FILE.                         04740035
047500                                                                  04750035
047600*----------------------------------------------------------------*04760035
047700* CALL ABEND                                                     *04770035
047800*----------------------------------------------------------------*04780035
047900     MOVE +4013                  TO ABEND-CODE.                   04790035
048000     CALL 'ILBOABN0' USING ABEND-CODE.                            04800035
048100*                                                                 04810035
