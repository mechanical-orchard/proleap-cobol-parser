000100 IDENTIFICATION DIVISION.                                         00010099
000110                                                                  00011099
000120 PROGRAM-ID.         DFKUT080                                     00012099
000130 AUTHOR.             JASON LINDEMANN                              00013099
000140 INSTALLATION.       KOHL'S CORPORATION.                          00014099
000150 DATE-WRITTEN.       JUNE 1999.                                   00015099
000160 DATE-COMPILED.                                                   00016099
000170***************************************************************** 00017099
000180* THIS PROGRAM CREATES THE STORE ADMINISTRATION "MONTHLY ACTUAL * 00018099
000190* STORE SALES" USING DB2 TABLE TDADPTS.                         * 00019099
000191* 09/2005 -- PROGRAM CHANGED TO USE THE NEW FLASH TABLES,       * 00019199
000192*            SPECIFICALLY DFT_ML_FINCL_SUM, INSTEAD OF TDADPTS. * 00019299
000200******************************************************************00020099
000300*                                                                 00030099
000400*  CHANGED 02/12/2004 BY STEVEN NOWAK              WR# 26583      00040099
000500*  CHANGE TO TABLE TDADPTS, RECOMPILE TO PULL IN CHNGD DCLGEN     00050099
000600*                                                                 00060099
133115******************************************************************00070099
133115*                                                                 00071099
133115*  CHANGED 02/02/2010 BY COGNIZANT            IR#INC000001133115  00072099
133115*  INCREASED RECORD FROM 158 TO 171 DUE TO CHANGE IN SALES AMOUNT 00073099
133115*  FIELD FROM 11 TO 12 BYTES ON DFRD030.                          00074099
133115******************************************************************00075099
000800 ENVIRONMENT DIVISION.                                            00080099
000900 CONFIGURATION SECTION.                                           00090099
001000                                                                  00100099
001100 SOURCE-COMPUTER.        IBM-370.                                 00110099
001200 OBJECT-COMPUTER.        IBM-370.                                 00120099
001300                                                                  00130099
001400 INPUT-OUTPUT SECTION.                                            00140099
001500 FILE-CONTROL.                                                    00150099
001600                                                                  00160099
001700     SELECT MNTLY-STORE-SALES-FILE                                00170099
001800         ASSIGN TO OUT01.                                         00180099
001900                                                                  00190099
002000 DATA DIVISION.                                                   00200099
002100 FILE SECTION.                                                    00210099
002200                                                                  00220099
002300 FD  MNTLY-STORE-SALES-FILE                                       00230099
002400     RECORDING MODE IS F                                          00240099
002500     LABEL RECORDS ARE STANDARD                                   00250099
133115     RECORD CONTAINS 171 CHARACTERS                               00260099
002700     BLOCK  CONTAINS  0 RECORDS                                   00270099
002800     DATA RECORD IS MNTLY-STORE-SALES-RCD.                        00280099
133115 01  MNTLY-STORE-SALES-RCD       PIC X(171).                      00290099
003000                                                                  00300099
003100                                                                  00310099
003200 WORKING-STORAGE SECTION.                                         00320099
003300                                                                  00330099
003400 01  SWITCHES.                                                    00340099
003500     05  DFT-ML-FINCL-SUM-SW     PIC X      VALUE 'N'.            00350099
003600         88  EOF-DFT-ML-FINCL-SUM           VALUE 'Y'.            00360099
003700         88  NOT-EOF-DFT-ML-FINCL-SUM       VALUE 'N'.            00370099
003800     05  FETCH-SW                PIC X      VALUE 'Y'.            00380099
003900         88  FIRST-FETCH                    VALUE 'Y'.            00390099
004000         88  NOT-FIRST-FETCH                VALUE 'N'.            00400099
004100     05  PRINT-SW                PIC X      VALUE 'Y'.            00410099
004200         88  FIRST-PRINT                    VALUE 'Y'.            00420099
004300         88  NOT-FIRST-PRINT                VALUE 'N'.            00430099
004400                                                                  00440099
004500 01  PROGRAM-VARIABLES.                                           00450099
004600     05  PV-FSCL-YR-BEG-DTE      PIC X(10).                       00460099
004700     05  PV-CURRENT-DTE.                                          00470099
004800         10  PV-CURRENT-YR       PIC X(04).                       00480099
004900         10  FILLER              PIC X(01)      VALUE '-'.        00490099
005000         10  PV-CURRENT-MN       PIC X(02).                       00500099
005100         10  FILLER              PIC X(01)      VALUE '-'.        00510099
005200         10  PV-CURRENT-DY       PIC X(02).                       00520099
005300     05  PV-DATE-TODAY           PIC X(10).                       00530099
005400     05  PV-PFM-END-DTE          PIC X(10).                       00540099
005500     05  PV-FSCL-MN01            PIC X(10).                       00550099
005600     05  PV-RCDS-READ            PIC S9(9)      VALUE 0 COMP-3.   00560099
005700     05  PV-RCDS-WRITTEN         PIC S9(9)      VALUE 0 COMP-3.   00570099
005800     05  PV-DISPLAY-READ         PIC ZZZ,ZZZ,ZZ9.                 00580099
005900     05  PV-DISPLAY-WRITTEN      PIC ZZZ,ZZZ,ZZ9.                 00590099
006000     05  ABEND-CODE              PIC S9(4)      VALUE 0 COMP SYNC.00600099
006100     05  PV-SAVE-STORE-NUM       PIC 9(4).                        00610099
006200     05  PV-FSCL-MN02            PIC X(10).                       00620099
006300     05  PV-FSCL-MN03            PIC X(10).                       00630099
006400     05  PV-FSCL-MN04            PIC X(10).                       00640099
006500     05  PV-FSCL-MN05            PIC X(10).                       00650099
006600     05  PV-FSCL-MN06            PIC X(10).                       00660099
006700     05  PV-FSCL-MN07            PIC X(10).                       00670099
006800     05  PV-FSCL-MN08            PIC X(10).                       00680099
006900     05  PV-FSCL-MN09            PIC X(10).                       00690099
007000     05  PV-FSCL-MN10            PIC X(10).                       00700099
007100     05  PV-FSCL-MN11            PIC X(10).                       00710099
007200     05  PV-FSCL-MN12            PIC X(10).                       00720099
007300     05  PV-FSCL-MN13            PIC X(10).                       00730099
007400     05  PV-SALES-MN01           PIC S9(9)V9(2) VALUE 0 COMP-3.   00740099
007500     05  PV-SALES-MN02           PIC S9(9)V9(2) VALUE 0 COMP-3.   00750099
007600     05  PV-SALES-MN03           PIC S9(9)V9(2) VALUE 0 COMP-3.   00760099
007700     05  PV-SALES-MN04           PIC S9(9)V9(2) VALUE 0 COMP-3.   00770099
007800     05  PV-SALES-MN05           PIC S9(9)V9(2) VALUE 0 COMP-3.   00780099
007900     05  PV-SALES-MN06           PIC S9(9)V9(2) VALUE 0 COMP-3.   00790099
008000     05  PV-SALES-MN07           PIC S9(9)V9(2) VALUE 0 COMP-3.   00800099
008100     05  PV-SALES-MN08           PIC S9(9)V9(2) VALUE 0 COMP-3.   00810099
008200     05  PV-SALES-MN09           PIC S9(9)V9(2) VALUE 0 COMP-3.   00820099
008300     05  PV-SALES-MN10           PIC S9(9)V9(2) VALUE 0 COMP-3.   00830099
008400     05  PV-SALES-MN11           PIC S9(9)V9(2) VALUE 0 COMP-3.   00840099
008500     05  PV-SALES-MN12           PIC S9(9)V9(2) VALUE 0 COMP-3.   00850099
008600                                                                  00860099
008700 01  OUTPUT-FILE-HEADER-LINE.                                     00870099
008800     05  FILLER                  PIC X(05)      VALUE 'STORE'.    00880099
008900     05  FILLER                  PIC X(01)      VALUE ','.        00890099
009000     05  FILLER                  PIC X(10)      VALUE             00900099
009100                                                'STORE NAME'.     00910099
009200     05  FILLER                  PIC X(01)      VALUE ','.        00920099
009300     05  FILLER                  PIC X(09)      VALUE 'FEBRUARY '.00930099
009400     05  FILLER                  PIC X(01)      VALUE ','.        00940099
009500     05  FILLER                  PIC X(09)      VALUE 'MARCH    '.00950099
009600     05  FILLER                  PIC X(01)      VALUE ','.        00960099
009700     05  FILLER                  PIC X(09)      VALUE 'APRIL    '.00970099
009800     05  FILLER                  PIC X(01)      VALUE ','.        00980099
009900     05  FILLER                  PIC X(09)      VALUE 'MAY      '.00990099
010000     05  FILLER                  PIC X(01)      VALUE ','.        01000099
010100     05  FILLER                  PIC X(09)      VALUE 'JUNE     '.01010099
010200     05  FILLER                  PIC X(01)      VALUE ','.        01020099
010300     05  FILLER                  PIC X(09)      VALUE 'JULY     '.01030099
010400     05  FILLER                  PIC X(01)      VALUE ','.        01040099
010500     05  FILLER                  PIC X(09)      VALUE 'AUGUST   '.01050099
010600     05  FILLER                  PIC X(01)      VALUE ','.        01060099
010700     05  FILLER                  PIC X(09)      VALUE 'SEPTEMBER'.01070099
010800     05  FILLER                  PIC X(01)      VALUE ','.        01080099
010900     05  FILLER                  PIC X(09)      VALUE 'OCTOBER  '.01090099
011000     05  FILLER                  PIC X(01)      VALUE ','.        01100099
011100     05  FILLER                  PIC X(09)      VALUE 'NOVEMBER '.01110099
011200     05  FILLER                  PIC X(01)      VALUE ','.        01120099
011300     05  FILLER                  PIC X(09)      VALUE 'DECEMBER '.01130099
011400     05  FILLER                  PIC X(01)      VALUE ','.        01140099
011500     05  FILLER                  PIC X(09)      VALUE 'JANUARY  '.01150099
011600     05  FILLER                  PIC X(23)      VALUE SPACES.     01160099
011700                                                                  01170099
011800******************************************************************01180099
011900*    LAYOUT FORMAT FOR THE SALES DOWNLOAD FILE.                  *01190099
012000******************************************************************01200099
012100     COPY DFRD030.                                                01210099
012200                                                                  01220099
012300******************************************************************01230099
012400*    DATE TABLE FOR FISCAL DATE INFORMATION.                     *01240099
012500******************************************************************01250099
012600     EXEC SQL                                                     01260099
012700        INCLUDE TDTATTR                                           01270099
012800     END-EXEC.                                                    01280099
012900                                                                  01290099
013000******************************************************************01300099
013100*    DAILY SALES TABLE FOR EACH DEPARTMENT (DFT_ML_FINCL_SUM)    *01310099
013200******************************************************************01320099
013300     EXEC SQL                                                     01330099
013400        INCLUDE DFT00002                                          01340099
013500     END-EXEC.                                                    01350099
013600                                                                  01360099
013700******************************************************************01370099
013800*    DB2 TABLE XST_LOC - STORE LOCATION TABLE                    *01380099
013900******************************************************************01390099
014000     EXEC SQL                                                     01400099
014100         INCLUDE XST00001                                         01410099
014200     END-EXEC.                                                    01420099
014300                                                                  01430099
014400******************************************************************01440099
014500*   DB2 COMMUNICATION AREA1.                                     *01450099
014600******************************************************************01460099
014700     EXEC SQL                                                     01470099
014800        INCLUDE SQLCA                                             01480099
014900     END-EXEC.                                                    01490099
015000                                                                  01500099
015100***************************************************************** 01510099
015200*   DB2 COMMUNICATION AREA2                                     * 01520099
015300***************************************************************** 01530099
015400     COPY SQLCA2.                                                 01540099
015500                                                                  01550099
015600***************************************************************** 01560099
015700*   STORE SALES CURSOR DECLARATION.                             * 01570099
015800***************************************************************** 01580099
015900     EXEC SQL                                                     01590099
016000       DECLARE STORE_SALES CURSOR FOR                             01600099
016100        SELECT SLS_DTE                                            01610099
016200              ,STR_NBR                                            01620099
016300              ,DLY_DOL_AMT                                        01630099
016500        FROM DFT_ML_FINCL_SUM                                     01650099
016600        WHERE SLS_DTE      BETWEEN :PV-FSCL-YR-BEG-DTE            01660099
016700                               AND :PV-PFM-END-DTE                01670099
016710         AND  DLY_DOL_AMT       <> 0                              01671099
016800        ORDER BY STR_NBR, SLS_DTE                                 01680099
016900     END-EXEC.                                                    01690099
017000                                                                  01700099
017100     EJECT                                                        01710099
017200 PROCEDURE DIVISION.                                              01720099
017300 M0000-MAINLINE.                                                  01730099
017400                                                                  01740099
017500     PERFORM A1000-INITIALIZATION                                 01750099
017600        THRU A1000-EXIT.                                          01760099
017700                                                                  01770099
017800     PERFORM B1000-BUILD-MNTLY-SALES                              01780099
017900        THRU B1000-EXIT                                           01790099
018000        UNTIL EOF-DFT-ML-FINCL-SUM.                               01800099
018100                                                                  01810099
018200     PERFORM C1000-CLOSE-FILES                                    01820099
018300        THRU C1000-EXIT.                                          01830099
018400                                                                  01840099
018500 M0000-EXIT.                                                      01850099
018600     EXIT.                                                        01860099
018700     STOP RUN.                                                    01870099
018800                                                                  01880099
018900******************************************************************01890099
019000 A1000-INITIALIZATION.                                            01900099
019100                                                                  01910099
019200     OPEN OUTPUT MNTLY-STORE-SALES-FILE.                          01920099
019300                                                                  01930099
019400     INITIALIZE DF030-STORE-NBR                                   01940099
019500                DF030-STORE-NAME                                  01950099
019600                DF030-STORE-SALES-MN01                            01960099
019700                DF030-STORE-SALES-MN02                            01970099
019800                DF030-STORE-SALES-MN03                            01980099
019900                DF030-STORE-SALES-MN04                            01990099
020000                DF030-STORE-SALES-MN05                            02000099
020100                DF030-STORE-SALES-MN06                            02010099
020200                DF030-STORE-SALES-MN07                            02020099
020300                DF030-STORE-SALES-MN08                            02030099
020400                DF030-STORE-SALES-MN09                            02040099
020500                DF030-STORE-SALES-MN10                            02050099
020600                DF030-STORE-SALES-MN11                            02060099
020700                DF030-STORE-SALES-MN12.                           02070099
020800                                                                  02080099
020900     PERFORM A1100-COMPUTE-DATE-INFO                              02090099
021000        THRU A1100-EXIT.                                          02100099
021100                                                                  02110099
021200     EXEC SQL                                                     02120099
021300         OPEN STORE_SALES                                         02130099
021400     END-EXEC.                                                    02140099
021500                                                                  02150099
021600     IF SQLCODE < 0                                               02160099
021700         DISPLAY 'OPEN UNSUCCESSFUL FOR DFT_ML_FINCL_SUM'         02170099
021800         PERFORM U9980-SQL-ERROR                                  02180099
021900            THRU U9980-EXIT                                       02190099
022000     END-IF.                                                      02200099
022100                                                                  02210099
022200     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               02220099
022300           SQLWARN0 = 'W'                                         02230099
022400         DISPLAY 'OPEN WARNING FOR DFT_ML_FINCL_SUM'              02240099
022500         PERFORM U9990-SQL-WARNING                                02250099
022600            THRU U9990-EXIT                                       02260099
022700     END-IF.                                                      02270099
022800                                                                  02280099
022900 A1000-EXIT.                                                      02290099
023000     EXIT.                                                        02300099
023100                                                                  02310099
023200***************************************************************** 02320099
023300 A1100-COMPUTE-DATE-INFO.                                         02330099
023400                                                                  02340099
023500     MOVE FUNCTION CURRENT-DATE (1:4) TO PV-CURRENT-YR.           02350099
023600     MOVE FUNCTION CURRENT-DATE (5:6) TO PV-CURRENT-MN.           02360099
023700     MOVE FUNCTION CURRENT-DATE (7:8) TO PV-CURRENT-DY.           02370099
023800     MOVE PV-CURRENT-DTE  TO PV-DATE-TODAY.                       02380099
023900     DISPLAY 'PROCESSING DATE: ' PV-DATE-TODAY.                   02390099
024000                                                                  02400099
024100     EXEC SQL                                                     02410099
024200       SELECT                                                     02420099
024300          PFM_END_DTE                                             02430099
024400       INTO                                                       02440099
024500          :PV-PFM-END-DTE                                         02450099
024600       FROM                                                       02460099
024700          TDTATTR                                                 02470099
024800       WHERE                                                      02480099
024900          KY_DTE = :PV-DATE-TODAY                                 02490099
025000     END-EXEC.                                                    02500099
025100                                                                  02510099
025200     EXEC SQL                                                     02520099
025300       SELECT                                                     02530099
025400         FSCL_YR_BEG_DTE                                          02540099
025500       INTO                                                       02550099
025600         :PV-FSCL-YR-BEG-DTE                                      02560099
025700       FROM                                                       02570099
025800         TDTATTR                                                  02580099
025900       WHERE                                                      02590099
026000         KY_DTE = :PV-PFM-END-DTE                                 02600099
026100     END-EXEC.                                                    02610099
026200     DISPLAY 'FSCL YR BEG DATE: ' PV-FSCL-YR-BEG-DTE.             02620099
026300                                                                  02630099
026400     EXEC SQL                                                     02640099
026500       SELECT                                                     02650099
026600          FSCL_MN_END_DTE                                         02660099
026700       INTO                                                       02670099
026800          :PV-FSCL-MN01                                           02680099
026900       FROM                                                       02690099
027000          TDTATTR                                                 02700099
027100       WHERE                                                      02710099
027200          KY_DTE  = :PV-FSCL-YR-BEG-DTE                           02720099
027300     END-EXEC.                                                    02730099
027400     DISPLAY 'END FSCL MN01: ' PV-FSCL-MN01.                      02740099
027500                                                                  02750099
027600     IF PV-FSCL-MN01 <= PV-DATE-TODAY                             02760099
027700      EXEC SQL                                                    02770099
027800       SELECT                                                     02780099
027900          NFM_END_DTE                                             02790099
028000       INTO                                                       02800099
028100          :PV-FSCL-MN02                                           02810099
028200       FROM                                                       02820099
028300          TDTATTR                                                 02830099
028400       WHERE                                                      02840099
028500          KY_DTE  = :PV-FSCL-MN01                                 02850099
028600       END-EXEC                                                   02860099
028700       DISPLAY 'END FSCL MN02: ' PV-FSCL-MN02                     02870099
028800     ELSE                                                         02880099
028900       GO TO A1100-EXIT                                           02890099
029000     END-IF.                                                      02900099
029100                                                                  02910099
029200     IF PV-FSCL-MN02 <= PV-DATE-TODAY                             02920099
029300      EXEC SQL                                                    02930099
029400       SELECT                                                     02940099
029500          NFM_END_DTE                                             02950099
029600       INTO                                                       02960099
029700          :PV-FSCL-MN03                                           02970099
029800       FROM                                                       02980099
029900          TDTATTR                                                 02990099
030000       WHERE                                                      03000099
030100          KY_DTE = :PV-FSCL-MN02                                  03010099
030200      END-EXEC                                                    03020099
030300      DISPLAY 'END FSCL MN03: ' PV-FSCL-MN03                      03030099
030400     ELSE                                                         03040099
030500       GO TO A1100-EXIT                                           03050099
030600     END-IF.                                                      03060099
030700                                                                  03070099
030800     IF PV-FSCL-MN03 <= PV-DATE-TODAY                             03080099
030900      EXEC SQL                                                    03090099
031000       SELECT                                                     03100099
031100          NFM_END_DTE                                             03110099
031200       INTO                                                       03120099
031300          :PV-FSCL-MN04                                           03130099
031400       FROM                                                       03140099
031500          TDTATTR                                                 03150099
031600       WHERE                                                      03160099
031700          KY_DTE = :PV-FSCL-MN03                                  03170099
031800       END-EXEC                                                   03180099
031900       DISPLAY 'END FSCL MN04: ' PV-FSCL-MN04                     03190099
032000     ELSE                                                         03200099
032100       GO TO A1100-EXIT                                           03210099
032200     END-IF.                                                      03220099
032300                                                                  03230099
032400     IF PV-FSCL-MN04 <= PV-DATE-TODAY                             03240099
032500      EXEC SQL                                                    03250099
032510       SELECT                                                     03251099
032520          NFM_END_DTE                                             03252099
032530       INTO                                                       03253099
032540          :PV-FSCL-MN05                                           03254099
032550       FROM                                                       03255099
032560          TDTATTR                                                 03256099
032570       WHERE                                                      03257099
032571          KY_DTE = :PV-FSCL-MN04                                  03257199
032572      END-EXEC                                                    03257299
032573      DISPLAY 'END FSCL MN05: ' PV-FSCL-MN05                      03257399
032574     ELSE                                                         03257499
032575       GO TO A1100-EXIT                                           03257599
032576     END-IF.                                                      03257699
032577                                                                  03257799
032578     IF PV-FSCL-MN05 <= PV-DATE-TODAY                             03257899
032579      EXEC SQL                                                    03257999
032580       SELECT                                                     03258099
032581          NFM_END_DTE                                             03258199
032582       INTO                                                       03258299
032583          :PV-FSCL-MN06                                           03258399
032584       FROM                                                       03258499
032585          TDTATTR                                                 03258599
032586       WHERE                                                      03258699
032587          KY_DTE = :PV-FSCL-MN05                                  03258799
032588      END-EXEC                                                    03258899
032589      DISPLAY 'END FSCL MN06: ' PV-FSCL-MN06                      03258999
032590     ELSE                                                         03259099
032591       GO TO A1100-EXIT                                           03259199
032592     END-IF.                                                      03259299
032593                                                                  03259399
032594     IF PV-FSCL-MN06 <= PV-DATE-TODAY                             03259499
032595      EXEC SQL                                                    03259599
032596       SELECT                                                     03259699
032597          NFM_END_DTE                                             03259799
032598       INTO                                                       03259899
032599          :PV-FSCL-MN07                                           03259999
032600       FROM                                                       03260099
032601          TDTATTR                                                 03260199
032602       WHERE                                                      03260299
032603          KY_DTE = :PV-FSCL-MN06                                  03260399
032604      END-EXEC                                                    03260499
032605      DISPLAY 'END FSCL MN07: ' PV-FSCL-MN07                      03260599
032606     ELSE                                                         03260699
032607       GO TO A1100-EXIT                                           03260799
032608     END-IF.                                                      03260899
032609                                                                  03260999
032610     IF PV-FSCL-MN07 <= PV-DATE-TODAY                             03261099
032611      EXEC SQL                                                    03261199
032612       SELECT                                                     03261299
032613          NFM_END_DTE                                             03261399
032614       INTO                                                       03261499
032615          :PV-FSCL-MN08                                           03261599
032616       FROM                                                       03261699
032617          TDTATTR                                                 03261799
032618       WHERE                                                      03261899
032619          KY_DTE = :PV-FSCL-MN07                                  03261999
032620      END-EXEC                                                    03262099
032621      DISPLAY 'END FSCL MN08: ' PV-FSCL-MN08                      03262199
032622     ELSE                                                         03262299
032623       GO TO A1100-EXIT                                           03262399
032624     END-IF.                                                      03262499
032625                                                                  03262599
032626     IF PV-FSCL-MN08 <= PV-DATE-TODAY                             03262699
032627      EXEC SQL                                                    03262799
032628       SELECT                                                     03262899
032629          NFM_END_DTE                                             03262999
032630       INTO                                                       03263099
032631          :PV-FSCL-MN09                                           03263199
032632       FROM                                                       03263299
032633          TDTATTR                                                 03263399
032634       WHERE                                                      03263499
032635          KY_DTE = :PV-FSCL-MN08                                  03263599
032636      END-EXEC                                                    03263699
032637      DISPLAY 'END FSCL MN09: ' PV-FSCL-MN09                      03263799
032638     ELSE                                                         03263899
032639       GO TO A1100-EXIT                                           03263999
032640     END-IF.                                                      03264099
032641                                                                  03264199
032642     IF PV-FSCL-MN09 <= PV-DATE-TODAY                             03264299
032643      EXEC SQL                                                    03264399
032644       SELECT                                                     03264499
032645          NFM_END_DTE                                             03264599
032646       INTO                                                       03264699
032647          :PV-FSCL-MN10                                           03264799
032648       FROM                                                       03264899
032649          TDTATTR                                                 03264999
032650       WHERE                                                      03265099
032651          KY_DTE = :PV-FSCL-MN09                                  03265199
032652      END-EXEC                                                    03265299
032653      DISPLAY 'END FSCL MN10: ' PV-FSCL-MN10                      03265399
032654     ELSE                                                         03265499
032655      GO TO A1100-EXIT                                            03265599
032656     END-IF.                                                      03265699
032657                                                                  03265799
032658     IF PV-FSCL-MN10 <= PV-DATE-TODAY                             03265899
032659      EXEC SQL                                                    03265999
032660       SELECT                                                     03266099
032661          NFM_END_DTE                                             03266199
032662       INTO                                                       03266299
032663         :PV-FSCL-MN11                                            03266399
032664       FROM                                                       03266499
032665         TDTATTR                                                  03266599
032666       WHERE                                                      03266699
032667         KY_DTE = :PV-FSCL-MN10                                   03266799
032668      END-EXEC                                                    03266899
032669      DISPLAY 'END FSCL MN11: ' PV-FSCL-MN11                      03266999
032670     ELSE                                                         03267099
032671       GO TO A1100-EXIT                                           03267199
032672     END-IF.                                                      03267299
032673                                                                  03267399
032674     IF PV-FSCL-MN11 <= PV-DATE-TODAY                             03267499
032675      EXEC SQL                                                    03267599
032676       SELECT                                                     03267699
032677          NFM_END_DTE                                             03267799
032678       INTO                                                       03267899
032679         :PV-FSCL-MN12                                            03267999
032680       FROM                                                       03268099
032681          TDTATTR                                                 03268199
032682       WHERE                                                      03268299
032683          KY_DTE = :PV-FSCL-MN11                                  03268399
032684      END-EXEC                                                    03268499
032685      DISPLAY 'END FSCL MN12: ' PV-FSCL-MN12                      03268599
032686     ELSE                                                         03268699
032687       GO TO A1100-EXIT                                           03268799
032688     END-IF.                                                      03268899
032689                                                                  03268999
032690 A1100-EXIT.                                                      03269099
032700     EXIT.                                                        03270099
032710                                                                  03271099
032720***************************************************************** 03272099
032730 B1000-BUILD-MNTLY-SALES.                                         03273099
032740                                                                  03274099
032750     PERFORM B1100-FETCH-STORE-SALES                              03275099
032760        THRU B1100-EXIT.                                          03276099
032770                                                                  03277099
032780     IF EOF-DFT-ML-FINCL-SUM                                      03278099
032790         PERFORM B1300-SELECT-XST00001                            03279099
032800            THRU B1300-EXIT                                       03280099
032900         PERFORM B1400-WRITE-SALES-RCD                            03290099
033000            THRU B1400-EXIT                                       03300099
033100         GO TO B1000-EXIT                                         03310099
033200     END-IF.                                                      03320099
033300                                                                  03330099
033400     IF FIRST-FETCH                                               03340099
033500       OR DFT00002-STR-NBR = PV-SAVE-STORE-NUM                    03350099
033600         PERFORM B1200-ADD-SALES                                  03360099
033700            THRU B1200-EXIT                                       03370099
033800     ELSE                                                         03380099
033900         PERFORM B1300-SELECT-XST00001                            03390099
034000            THRU B1300-EXIT                                       03400099
034100         PERFORM B1400-WRITE-SALES-RCD                            03410099
034200            THRU B1400-EXIT                                       03420099
034300         PERFORM B1200-ADD-SALES                                  03430099
034400            THRU B1200-EXIT                                       03440099
034500     END-IF.                                                      03450099
034600                                                                  03460099
034700 B1000-EXIT.                                                      03470099
034800     EXIT.                                                        03480099
034900                                                                  03490099
035000***************************************************************** 03500099
035100 B1100-FETCH-STORE-SALES.                                         03510099
035200                                                                  03520099
035300     EXEC SQL                                                     03530099
035400         FETCH STORE_SALES                                        03540099
035500             INTO :DFT00002-SLS-DTE                               03550099
035600                 ,:DFT00002-STR-NBR                               03560099
035700                 ,:DFT00002-DLY-DOL-AMT                           03570099
035900     END-EXEC.                                                    03590099
036000                                                                  03600099
036100     IF SQLCODE < 0                                               03610099
036200         DISPLAY 'FETCH UNSUCCESSFUL FOR DFT_ML_FINCL_SUM'        03620099
036300         PERFORM U9980-SQL-ERROR                                  03630099
036400            THRU U9980-EXIT                                       03640099
036500     END-IF.                                                      03650099
036600                                                                  03660099
036700     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               03670099
036800           SQLWARN0 = 'W'                                         03680099
036900         DISPLAY 'FETCH WARNING FOR DFT_ML_FINCL_SUM'             03690099
037000         PERFORM U9990-SQL-WARNING                                03700099
037100            THRU U9990-EXIT                                       03710099
037200     END-IF.                                                      03720099
037300                                                                  03730099
037400     IF SQLCODE = +100                                            03740099
037500         SET EOF-DFT-ML-FINCL-SUM TO TRUE                         03750099
037600         GO TO B1100-EXIT                                         03760099
037700     END-IF.                                                      03770099
037800                                                                  03780099
037900     ADD 1 TO PV-RCDS-READ.                                       03791099
038000                                                                  03800099
038100 B1100-EXIT.                                                      03810099
038200     EXIT.                                                        03820099
038300                                                                  03830099
038400***************************************************************** 03840099
038500 B1200-ADD-SALES.                                                 03850099
038600                                                                  03860099
038700     IF FIRST-FETCH                                               03870099
038800         MOVE DFT00002-STR-NBR    TO PV-SAVE-STORE-NUM            03880099
038900         SET NOT-FIRST-FETCH      TO TRUE                         03890099
039000     END-IF.                                                      03900099
039100                                                                  03910099
039200     IF DFT00002-SLS-DTE <= PV-FSCL-MN01                          03920099
039300         ADD DFT00002-DLY-DOL-AMT TO PV-SALES-MN01                03930099
039500     ELSE                                                         03950099
039600         IF DFT00002-SLS-DTE <= PV-FSCL-MN02                      03960099
039700             ADD DFT00002-DLY-DOL-AMT                             03970099
039800                                  TO PV-SALES-MN02                03980099
039900     ELSE                                                         03990099
040000         IF DFT00002-SLS-DTE <= PV-FSCL-MN03                      04000099
040100             ADD DFT00002-DLY-DOL-AMT                             04010099
040200                                  TO PV-SALES-MN03                04020099
040300     ELSE                                                         04030099
040400         IF DFT00002-SLS-DTE <= PV-FSCL-MN04                      04040099
040500             ADD DFT00002-DLY-DOL-AMT                             04050099
040600                                  TO PV-SALES-MN04                04060099
040700     ELSE                                                         04070099
040800         IF DFT00002-SLS-DTE <= PV-FSCL-MN05                      04080099
040900             ADD DFT00002-DLY-DOL-AMT                             04090099
041000                                  TO PV-SALES-MN05                04100099
041100     ELSE                                                         04110099
041200         IF DFT00002-SLS-DTE <= PV-FSCL-MN06                      04120099
041300             ADD DFT00002-DLY-DOL-AMT                             04130099
041400                                  TO PV-SALES-MN06                04140099
041500     ELSE                                                         04150099
041600         IF DFT00002-SLS-DTE <= PV-FSCL-MN07                      04160099
041700             ADD DFT00002-DLY-DOL-AMT                             04170099
041800                                  TO PV-SALES-MN07                04180099
041900     ELSE                                                         04190099
042000         IF DFT00002-SLS-DTE <= PV-FSCL-MN08                      04200099
042100             ADD DFT00002-DLY-DOL-AMT                             04210099
042200                                  TO PV-SALES-MN08                04220099
042300     ELSE                                                         04230099
042400         IF DFT00002-SLS-DTE <= PV-FSCL-MN09                      04240099
042500             ADD DFT00002-DLY-DOL-AMT                             04250099
042600                                  TO PV-SALES-MN09                04260099
042700     ELSE                                                         04270099
042800         IF DFT00002-SLS-DTE <= PV-FSCL-MN10                      04280099
042900             ADD DFT00002-DLY-DOL-AMT                             04290099
043000                                  TO PV-SALES-MN10                04300099
043100     ELSE                                                         04310099
043200         IF DFT00002-SLS-DTE <= PV-FSCL-MN11                      04320099
043300             ADD DFT00002-DLY-DOL-AMT                             04330099
043400                                  TO PV-SALES-MN11                04340099
043500     ELSE                                                         04350099
043600         IF DFT00002-SLS-DTE <= PV-FSCL-MN12                      04360099
043700             ADD DFT00002-DLY-DOL-AMT                             04370099
043800                                  TO PV-SALES-MN12                04380099
043900     END-IF                                                       04390099
044000     END-IF                                                       04400099
044100     END-IF                                                       04410099
044110     END-IF                                                       04411099
044120     END-IF                                                       04412099
044130     END-IF                                                       04413099
044140     END-IF                                                       04414099
044150     END-IF                                                       04415099
044160     END-IF                                                       04416099
044170     END-IF                                                       04417099
044180     END-IF                                                       04418099
044190     END-IF.                                                      04419099
044200                                                                  04420099
044300 B1200-EXIT.                                                      04430099
044400     EXIT.                                                        04440099
044500                                                                  04450099
044600***************************************************************** 04460099
044700 B1300-SELECT-XST00001.                                           04470099
044800                                                                  04480099
044900     MOVE PV-SAVE-STORE-NUM TO XST00001-LOC-NBR.                  04490099
045000                                                                  04500099
045100     EXEC SQL                                                     04510099
045200         SELECT LOC_10_ABBR_NM                                    04520099
045300         INTO :XST00001-LOC-10-ABBR-NM                            04530099
045310         FROM XST_LOC                                             04531099
045320         WHERE LOC_NBR     = :XST00001-LOC-NBR                    04532099
045321           AND LOC_TYP_CDE = 'DS'                                 04532199
045322     END-EXEC.                                                    04532299
045323                                                                  04532399
045324     IF SQLCODE < 0                                               04532499
045325         DISPLAY 'FETCH UNSUCCESSFUL FOR DB2 TABLE XST00001'      04532599
045326         PERFORM U9980-SQL-ERROR                                  04532699
045327            THRU U9980-EXIT                                       04532799
045328     END-IF.                                                      04532899
045329                                                                  04532999
045330     IF (SQLCODE > 0 AND SQLCODE NOT EQUAL +100) OR               04533099
045331           SQLWARN0 = 'W'                                         04533199
045332         DISPLAY 'FETCH WARNING FOR DB2 TABLE XST00001'           04533299
045333         PERFORM U9990-SQL-WARNING                                04533399
045334            THRU U9990-EXIT                                       04533499
045335     END-IF.                                                      04533599
045336                                                                  04533699
045337     IF SQLCODE = +100                                            04533799
045338         GO TO B1300-EXIT                                         04533899
045339     ELSE                                                         04533999
045340         MOVE XST00001-LOC-10-ABBR-NM TO DF030-STORE-NAME         04534099
045341     END-IF.                                                      04534199
045342                                                                  04534299
045343 B1300-EXIT.                                                      04534399
045344     EXIT.                                                        04534499
045345                                                                  04534599
045346***************************************************************** 04534699
045347 B1400-WRITE-SALES-RCD.                                           04534799
045348                                                                  04534899
045349     IF FIRST-PRINT                                               04534999
045350         WRITE MNTLY-STORE-SALES-RCD FROM OUTPUT-FILE-HEADER-LINE 04535099
045360         SET NOT-FIRST-PRINT TO TRUE                              04536099
045370     END-IF.                                                      04537099
045380                                                                  04538099
045390     MOVE PV-SAVE-STORE-NUM TO DF030-STORE-NBR.                   04539099
045400                                                                  04540099
045500     IF PV-SALES-MN01 >= 0                                        04550099
045600         MOVE PV-SALES-MN01 TO DF030-STORE-SALES-MN01             04560099
045700     ELSE                                                         04570099
045800         DISPLAY 'NEGATIVE SALES VALUE MN01'                      04580099
045900         INITIALIZE DF030-ST-SALES-MN01                           04590099
046000     END-IF.                                                      04600099
046100     IF PV-SALES-MN02 >= 0                                        04610099
046200         MOVE PV-SALES-MN02 TO DF030-STORE-SALES-MN02             04620099
046300     ELSE                                                         04630099
046400         DISPLAY 'NEGATIVE SALES VALUE MN02'                      04640099
046500         INITIALIZE DF030-ST-SALES-MN02                           04650099
046600     END-IF.                                                      04660099
046700     IF PV-SALES-MN03 >= 0                                        04670099
046800         MOVE PV-SALES-MN03 TO DF030-STORE-SALES-MN03             04680099
046900     ELSE                                                         04690099
047000         DISPLAY 'NEGATIVE SALES VALUE MN03'                      04700099
047100         INITIALIZE DF030-ST-SALES-MN03                           04710099
047200     END-IF.                                                      04720099
047300     IF PV-SALES-MN04 >= 0                                        04730099
047400         MOVE PV-SALES-MN04 TO DF030-STORE-SALES-MN04             04740099
047410     ELSE                                                         04741099
047420         DISPLAY 'NEGATIVE SALES VALUE MN04'                      04742099
047430         INITIALIZE DF030-ST-SALES-MN04                           04743099
047440     END-IF.                                                      04744099
047450     IF PV-SALES-MN05 >= 0                                        04745099
047460         MOVE PV-SALES-MN05 TO DF030-STORE-SALES-MN05             04746099
047470     ELSE                                                         04747099
047480         DISPLAY 'NEGATIVE SALES VALUE MN05'                      04748099
047490         INITIALIZE DF030-ST-SALES-MN05                           04749099
047491     END-IF.                                                      04749199
047492     IF PV-SALES-MN06 >= 0                                        04749299
047493         MOVE PV-SALES-MN06 TO DF030-STORE-SALES-MN06             04749399
047494     ELSE                                                         04749499
047495         DISPLAY 'NEGATIVE SALES VALUE MN06'                      04749599
047496         INITIALIZE DF030-ST-SALES-MN06                           04749699
047497     END-IF.                                                      04749799
047498     IF PV-SALES-MN07 >= 0                                        04749899
047499         MOVE PV-SALES-MN07 TO DF030-STORE-SALES-MN07             04749999
047500     ELSE                                                         04750099
047501         DISPLAY 'NEGATIVE SALES VALUE MN07'                      04750199
047502         INITIALIZE DF030-ST-SALES-MN07                           04750299
047503     END-IF.                                                      04750399
047504     IF PV-SALES-MN08 >= 0                                        04750499
047505         MOVE PV-SALES-MN08 TO DF030-STORE-SALES-MN08             04750599
047506     ELSE                                                         04750699
047507         DISPLAY 'NEGATIVE SALES VALUE MN08'                      04750799
047508         INITIALIZE DF030-ST-SALES-MN08                           04750899
047509     END-IF.                                                      04750999
047510     IF PV-SALES-MN09 >= 0                                        04751099
047520         MOVE PV-SALES-MN09 TO DF030-STORE-SALES-MN09             04752099
047530     ELSE                                                         04753099
047540         DISPLAY 'NEGATIVE SALES VALUE MN09'                      04754099
047550         INITIALIZE DF030-ST-SALES-MN09                           04755099
047560     END-IF.                                                      04756099
047570     IF PV-SALES-MN10 >= 0                                        04757099
047580         MOVE PV-SALES-MN10 TO DF030-STORE-SALES-MN10             04758099
047590     ELSE                                                         04759099
047591         DISPLAY 'NEGATIVE SALES VALUE MN10'                      04759199
047592         INITIALIZE DF030-ST-SALES-MN10                           04759299
047593     END-IF.                                                      04759399
047594     IF PV-SALES-MN11 >= 0                                        04759499
047595         MOVE PV-SALES-MN11 TO DF030-STORE-SALES-MN11             04759599
047596     ELSE                                                         04759699
047597         DISPLAY 'NEGATIVE SALES VALUE MN11'                      04759799
047598         INITIALIZE DF030-ST-SALES-MN11                           04759899
047599     END-IF.                                                      04759999
047600     IF PV-SALES-MN12 >= 0                                        04760099
047601         MOVE PV-SALES-MN12 TO DF030-STORE-SALES-MN12             04760199
047602     ELSE                                                         04760299
047603         DISPLAY 'NEGATIVE SALES VALUE MN12'                      04760399
047604         INITIALIZE DF030-ST-SALES-MN12                           04760499
047605     END-IF.                                                      04760599
047606                                                                  04760699
047607     WRITE MNTLY-STORE-SALES-RCD FROM DF030-RECORD.               04760799
047608                                                                  04760899
047609     ADD 1 TO PV-RCDS-WRITTEN.                                    04761099
047610                                                                  04761199
047611     MOVE DFT00002-STR-NBR  TO PV-SAVE-STORE-NUM.                 04761299
047612                                                                  04761399
047613     INITIALIZE DF030-STORE-NBR                                   04761499
047614                DF030-STORE-NAME                                  04761599
047615                DF030-STORE-SALES-MN01                            04761699
047616                DF030-STORE-SALES-MN02                            04761799
047617                DF030-STORE-SALES-MN03                            04761899
047618                DF030-STORE-SALES-MN04                            04761999
047619                DF030-STORE-SALES-MN05                            04762099
047620                DF030-STORE-SALES-MN06                            04762199
047630                DF030-STORE-SALES-MN07                            04763099
047640                DF030-STORE-SALES-MN08                            04764099
047650                DF030-STORE-SALES-MN09                            04765099
047651                DF030-STORE-SALES-MN10                            04765199
047652                DF030-STORE-SALES-MN11                            04765299
047653                DF030-STORE-SALES-MN12                            04765399
047654                PV-SALES-MN01                                     04765499
047655                PV-SALES-MN02                                     04765599
047656                PV-SALES-MN03                                     04765699
047657                PV-SALES-MN04                                     04765799
047658                PV-SALES-MN05                                     04765899
047659                PV-SALES-MN06                                     04765999
047660                PV-SALES-MN07                                     04766099
047661                PV-SALES-MN08                                     04766199
047662                PV-SALES-MN09                                     04766299
047663                PV-SALES-MN10                                     04766399
047664                PV-SALES-MN11                                     04766499
047665                PV-SALES-MN12.                                    04766599
047666                                                                  04766699
047667 B1400-EXIT.                                                      04766799
047668     EXIT.                                                        04766899
047669                                                                  04766999
047670***************************************************************** 04767099
047680 C1000-CLOSE-FILES.                                               04768099
047690                                                                  04769099
047700     MOVE PV-RCDS-READ    TO PV-DISPLAY-READ.                     04770099
047800     MOVE PV-RCDS-WRITTEN TO PV-DISPLAY-WRITTEN.                  04780099
047900                                                                  04790099
048000     DISPLAY '******************************************'         04800099
048100     DISPLAY '**  PROGRAM:  DFKUT080'                             04810099
048200     DISPLAY '**'                                                 04820099
048300     DISPLAY '**  RECORDS READ:     ' PV-DISPLAY-READ             04830099
048400     DISPLAY '**  RECORDS WRITTEN:  ' PV-DISPLAY-WRITTEN          04840099
048500     DISPLAY '******************************************'         04850099
048600                                                                  04860099
048700     CLOSE MNTLY-STORE-SALES-FILE.                                04870099
048800                                                                  04880099
048900     EXEC SQL                                                     04890099
049000         CLOSE STORE_SALES                                        04900099
049100     END-EXEC.                                                    04910099
049200                                                                  04920099
049300     IF SQLCODE < 0                                               04930099
049400         DISPLAY 'CLOSE UNSUCCESSFUL FOR DFT-ML-FINCL-SUM'        04940099
049500         PERFORM U9980-SQL-ERROR                                  04950099
049600            THRU U9980-EXIT                                       04960099
049700     END-IF.                                                      04970099
049800                                                                  04980099
049900     IF SQLCODE > 0 OR SQLWARN0 = 'W'                             04990099
050000         DISPLAY 'CLOSE WARNING FOR DFT-ML-FINCL-SUM'             05000099
050100         PERFORM U9990-SQL-WARNING                                05010099
050200            THRU U9990-EXIT                                       05020099
050300     END-IF.                                                      05030099
050400                                                                  05040099
050500 C1000-EXIT.                                                      05050099
050600     EXIT.                                                        05060099
050700                                                                  05070099
050800***************************************************************** 05080099
050900 U9980-SQL-ERROR.                                                 05090099
051000                                                                  05100099
051100     MOVE SQLCODE    TO SQLCODE2.                                 05110099
051200     MOVE SQLERRD(3) TO SQLERRD3.                                 05120099
051300     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05130099
051400     DISPLAY '** PROGRAM        ** = DFKUT080'.                   05140099
051500     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05150099
051600     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05160099
051700     DISPLAY '** SQLERRM        ** = ' SQLERRM.                   05170099
051800     DISPLAY '** SQLERRMC       ** = ' SQLERRMC.                  05180099
051900                                                                  05190099
052000     MOVE 4013 TO ABEND-CODE.                                     05200099
052100     CALL 'ILBOABN0' USING ABEND-CODE.                            05210099
052200                                                                  05220099
052300 U9980-EXIT.                                                      05230099
052400     EXIT.                                                        05240099
052500                                                                  05250099
052600***************************************************************** 05260099
052700 U9990-SQL-WARNING.                                               05270099
052800                                                                  05280099
052900     MOVE SQLCODE    TO SQLCODE2.                                 05290099
053000     MOVE SQLERRD(3) TO SQLERRD3.                                 05300099
053100     DISPLAY '** ABEND **       ** = SQLWARNING'.                 05310099
053200     DISPLAY '** PROGRAM        ** = DFKUT080'.                   05320099
053300     DISPLAY '** SQLCODE        ** = ' SQLCODE2.                  05330099
053400     DISPLAY '** ROWS PROCESSED ** = ' SQLERRD3.                  05340099
053500     DISPLAY '** SQLWARN0       ** = ' SQLWARN0.                  05350099
053600     DISPLAY '** SQLWARN1       ** = ' SQLWARN1.                  05360099
053700     DISPLAY '** SQLWARN2       ** = ' SQLWARN2.                  05370099
053800     DISPLAY '** SQLWARN3       ** = ' SQLWARN3.                  05380099
053900     DISPLAY '** SQLWARN4       ** = ' SQLWARN4.                  05390099
054000     DISPLAY '** SQLWARN5       ** = ' SQLWARN5.                  05400099
054100     DISPLAY '** SQLWARN6       ** = ' SQLWARN6.                  05410099
054200     DISPLAY '** SQLWARN7       ** = ' SQLWARN7.                  05420099
054300                                                                  05430099
054400     MOVE 4013 TO ABEND-CODE.                                     05440099
054500     CALL 'ILBOABN0' USING ABEND-CODE.                            05450099
054600                                                                  05460099
054700 U9990-EXIT.                                                      05470099
054800     EXIT.                                                        05480099
