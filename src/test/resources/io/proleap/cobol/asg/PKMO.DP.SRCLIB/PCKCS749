000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    PCKCS749.                                         00040002
000500 AUTHOR.        DEANNA BRANTNER.                                  00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  NOVEMBER, 2001.                                   00070002
000800 DATE-COMPILED.                                                   00080002
000900*---------------------------------------------------------------* 00090099
001000*  S749 - UNITS WORKED PROJECT - UNITS BY OPER FOR SHIFT SCREEN   00100099
001100*---------------------------------------------------------------* 00110099
001110* DATE  11/04/2021                                                00111099
001120*            - CHANGE CALL OF 'DPKUT100' TO                     * 00112099
001130*              CALL DP010I-NUMERIC-EDIT-ROUTINE                 * 00113099
001140*              MAKING THE CALL DYNAMIC VS STATIC                * 00114099
001150*     MADE BY: GERMAN BANDA            WR/IR #: CHG0264232        00115099
001160*-----------------------------------------------------------------00116099
1122RM* DATE  11/07/2022                                              * 00117099
1122RM*            - ADD COPYBOOK DPWS930                             * 00118099
1122RM*              CHANGE CALL TO DPWS030 FROM STATIC TO            * 00119099
1122RM*              DYNAMIC.                                         * 00119199
1122RM*     MADE BY: BOB MCASEY              WR/IR #: CHG0277910      * 00119299
1122RM*-----------------------------------------------------------------00119399
001200 ENVIRONMENT DIVISION.                                            00120099
001300 DATA DIVISION.                                                   00130099
001400                                                                  00140099
001500 WORKING-STORAGE SECTION.                                         00150099
001600 01  DK-DB2-KEYS.                                                 00160099
001700     05  DK-OPER-UNT-ID                 PIC S9(04)  VALUE ZERO    00170099
001800                                                    COMP.         00180099
001900     05  DK-FROM-DATE                   PIC X(10).                00190099
002000     05  DK-FROM-DATE-X.                                          00200099
002100         10  DK-FROM-YY                 PIC X(04) VALUE SPACES.   00210099
002200         10  FILLER                     PIC X(01) VALUE '-'.      00220099
002300         10  DK-FROM-MM                 PIC X(02) VALUE SPACES.   00230099
002400         10  FILLER                     PIC X(01) VALUE '-'.      00240099
002500         10  DK-FROM-DD                 PIC X(02) VALUE SPACES.   00250099
002600     05  DK-TO-DATE                     PIC X(10).                00260099
002700     05  DK-TO-DATE-X.                                            00270099
002800         10  DK-TO-YY                   PIC X(04) VALUE SPACES.   00280099
002900         10  FILLER                     PIC X(01) VALUE '-'.      00290099
003000         10  DK-TO-MM                   PIC X(02) VALUE SPACES.   00300099
003100         10  FILLER                     PIC X(01) VALUE '-'.      00310099
003200         10  DK-TO-DD                   PIC X(02) VALUE SPACES.   00320099
003300     05  DK-FISCAL-WEEK.                                          00330099
003400         10  DK-FISCAL-YEAR             PIC X(04) VALUE SPACES.   00340099
003500         10  DK-FISCAL-WK               PIC X(02) VALUE SPACES.   00350099
003600     05  DK-FISCAL-MONTH.                                         00360099
003700         10  DK-FISCAL-YR               PIC X(04) VALUE SPACES.   00370099
003800         10  DK-FISCAL-MN               PIC X(02) VALUE SPACES.   00380099
003900     05  DK-NUMBER-FORMAT               PIC ZZZZZZ,ZZZ,ZZ9-.      00390099
004000     05  DK-PERCENT-FORMAT.                                       00400099
004100         10  DK-NUMBER                  PIC ZZ9.9 VALUE ZEROES.   00410099
004200         10  DK-PERCENT                 PIC X(01) VALUE '%'.      00420099
004300                                                                  00430002
004400 01  PC-PROGRAM-CONSTANTS.                                        00440002
004500     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'PC749A  '.  00450002
004600     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'PCKM749'.   00460002
004700     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'PCKCS749'.  00470002
004800     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00480002
004900     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00490002
005000     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00500002
005100     05  PC-PROCESS-AREA-FORMAT    PIC  X(01)  VALUE '3'.         00510002
005200     05  PC-PROCSS-GROUP-FORMAT    PIC  X(01)  VALUE '4'.         00520002
005300     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +11          00530003
005400                                               COMP SYNC.         00540002
005500     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00550002
005600                                               COMP SYNC.         00560002
005700     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00570002
005800                                               COMP-3.            00580002
005900     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00590002
006000                                               COMP SYNC.         00600002
006100     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00610002
006200                                               COMP-3.            00620002
006300     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00630002
006400     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00640002
006500     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00650002
006600     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00660002
006700     05  PC-SLASH                  PIC  X(01)  VALUE '/'.         00670002
006800     05  PC-ZERO                   PIC S9(04)  VALUE ZEROES       00680002
006900                                               COMP.              00690002
007000     05  PC-01                     PIC  X(02)  VALUE '01'.        00700002
007100     05  PC-1                      PIC  S9(4) COMP VALUE 1.       00710013
007200     05  PC-2                      PIC  S9(4) COMP VALUE 2.       00720013
007300     05  PC-3                      PIC  S9(4) COMP VALUE 3.       00730013
007400     05  PC-A                      PIC  X(01)  VALUE 'A'.         00740002
007500*                                                                 00750002
007600*----------------------------------------------------------------*00760002
007700*  SYSTEM MESSAGES                                               *00770002
007800*----------------------------------------------------------------*00780002
007900*   00005 = INVALID VALUE                                        *00790002
008000*   00007 = REQUIRED ENTRY                                        00800002
008100*   00008 = MUST BE NUMERIC                                      *00810002
008200*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00820002
008300*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00830002
008400*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00840002
008500*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00850002
008600*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00860002
008700*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00870002
008800*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00880002
008900*   00069 - TOP OF LIST                                          *00890002
009000*   00070 - BOTTOM OF LIST                                       *00900002
009100*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00910002
009200*   00551 - WAIT 15 SECONDS;RETRY FUNCTION AGAIN; IF UNSUCCESSFUL*00920002
009300*   00279 - MORE ITEMS TO DISPLAY                                *00930002
009400*   00840 - YOU ARE NOT AUTHORIZED TO VIEW THIS INFORMATION      *00940002
009500*   00984 - DATABASE IS BUSY, TRY AGAIN IN A FEW MINUTES         *00950002
009600*   02227 = APPLICATION UNAVAILABLE AT THIS TIME                 *00960002
009601*   02378 = YOU CANNOT USE A DATE RANGE FOR THIS SEARCH          *00960192
009610*   02416 = INVALID DATE OR DATE RANGE                           *00961058
009620*   02873 = F-KEY NOT FUNCTIONAL-CAN ONLY VIEW PO LVL FOR SPFC DC*00962092
009630*   02874 = PO LEVEL DATA NOT AVAILABLE - DATA RETAINED ONLY THRO*00963099
009700*   99901 = INVALID COMMAND WAS ENTERED                          *00970002
009800*----------------------------------------------------------------*00980002
009900     05  PC-TSYMSG-NUMBERS.                                       00990002
010000         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  01000002
010100         10  PC-TSYMSG-00007            PIC  9(05)  VALUE 00007.  01010002
010200         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  01020002
010300         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  01030002
010400         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  01040002
010500         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  01050002
010600         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  01060002
010700         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  01070002
010800         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  01080002
010900         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  01090002
011000         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  01100002
011100         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  01110002
011200         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  01120002
011300         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  01130002
011400         10  PC-TSYMSG-00551            PIC  9(05)  VALUE 00551.  01140002
011500         10  PC-TSYMSG-00749            PIC  9(05)  VALUE 00749.  01150002
011600         10  PC-TSYMSG-00840            PIC  9(05)  VALUE 00840.  01160002
011700         10  PC-TSYMSG-01563            PIC  9(05)  VALUE 01563.  01170002
011800         10  PC-TSYMSG-00984            PIC  9(05)  VALUE 00984.  01180002
011900         10  PC-TSYMSG-02227            PIC  9(05)  VALUE 02227.  01190002
011901         10  PC-TSYMSG-02378            PIC  9(05)  VALUE 02378.  01190192
011910         10  PC-TSYMSG-02416            PIC  9(05)  VALUE 02416.  01191058
011920         10  PC-TSYMSG-02873            PIC  9(05)  VALUE 02873.  01192092
011930         10  PC-TSYMSG-02874            PIC  9(05)  VALUE 02874.  01193099
012000         10  PC-TSYMSG-99901            PIC  9(05)  VALUE 99901.  01200002
012100*                                                                 01210002
012200 01  PS-PROGRAM-SWITCHES.                                         01220002
012300     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    01230002
012400         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    01240002
012500         88  PS-BLOCK-ERROR                         VALUE 'N'.    01250002
012600     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    01260002
012700         88  PS-NO-ERROR                            VALUE 'Y'.    01270002
012800         88  PS-ERROR                               VALUE 'N'.    01280002
012900     05  PS-SOFT-ABORT-ERROR-SW         PIC  X(01)  VALUE  'N'.   01290002
013000         88  PS-SOFT-ABORT-ERROR                    VALUE  'Y'.   01300002
013100         88  PS-NO-SOFT-ABORT-ERROR                 VALUE  'N'.   01310002
013200     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    01320002
013300         88  PS-COMMAREA-VALID                      VALUE 'Y'.    01330002
013400         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    01340002
013500     05  PS-DONE-SW                     PIC  X(01)  VALUE 'N'.    01350002
013600         88  PS-DONE                                VALUE 'Y'.    01360002
013700         88  PS-NOT-DONE                            VALUE 'N'.    01370002
013800     05  PS-LIST-END-SW                 PIC  X(01)  VALUE  'N'.   01380002
013900         88  PS-LIST-END                            VALUE  'Y'.   01390002
014000         88  PS-NO-LIST-END                         VALUE  'N'.   01400002
014100     05  PS-ACCESS-SW                   PIC  X(01)  VALUE  'N'.   01410002
014200         88  PS-ACCESS-ALLOWED                      VALUE  'Y'.   01420002
014300         88  PS-ACCESS-NOT-ALLOWED                  VALUE  'N'.   01430002
014400     05  PS-CURSOR-SW                   PIC  X(01)  VALUE  ' '.   01440002
014500         88  PS-OPER-NAME-CSR                       VALUE  'A'.   01450010
014600         88  PS-UK-OPER-NAME-CSR                    VALUE  'B'.   01460010
014700         88  PS-UNITS-BY-OPER-CSR                   VALUE  'C'.   01470010
014710     05  PS-VALID-POHIST-DATE-SW        PIC  X(01)  VALUE  ' '.   01471099
014720         88  PS-VALID-POHIST-DATE                   VALUE  'Y'.   01472099
014730         88  PS-INVALID-POHIST-DATE                 VALUE  'N'.   01473099
014800*                                                                 01480002
014900 01  PV-PROGRAM-VARIABLES.                                        01490002
015000     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01500002
015100                                                     COMP SYNC.   01510002
015200     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01520002
015300     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01530002
015400     05  PV-RACF-ERROR-CODE             PIC  9(04)  VALUE ZEROES. 01540002
015500     05  PV-CICS-RESPONSE               PIC S9(08)  VALUE ZEROES  01550002
015600                                        COMP SYNC.                01560002
015700     05  PV-SUB                         PIC S9(04)  VALUE +0      01570002
015800                                                    COMP SYNC.    01580002
015900     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      01590002
016000                                                    COMP SYNC.    01600002
016100     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      01610002
016200                                                    COMP-3.       01620002
016300     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01630002
016400                                                    COMP-3.       01640002
016500     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01650002
016600                                                    COMP-3.       01660002
016700     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01670002
016800                                                    COMP-3.       01680002
016900     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01690002
017000                                                    COMP-3.       01700002
017100     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01710002
017200                                                    COMP-3.       01720002
017300     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01730002
017400                                                    COMP-3.       01740002
017500     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01750002
017600                                                    COMP SYNC.    01760002
017700     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01770002
017800                                                    COMP SYNC.    01780002
017900     05  PV-ITEM                        PIC S9(04)  VALUE +0      01790002
018000                                                    COMP SYNC.    01800002
018100     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01810002
018200                                                    COMP SYNC.    01820002
018300     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01830002
018400                                                    COMP SYNC.    01840002
018500     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01850002
018600                                                    COMP SYNC.    01860002
018700     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01870002
018800                                                    COMP SYNC.    01880002
018900     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01890002
019000                                                    COMP SYNC.    01900002
019100     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01910002
019200                                                    COMP SYNC.    01920002
019300     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01930002
019400                                                    COMP SYNC.    01940002
019500     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01950002
019600                                                    COMP SYNC.    01960002
019700     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01970002
019800                                                    COMP SYNC.    01980002
019900     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01990002
020000                                                    COMP SYNC.    02000002
020100     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      02010002
020200                                                    COMP SYNC.    02020002
020300     05  PV-SQL-SUB                     PIC S9(04)  VALUE +0      02030002
020400                                                    COMP SYNC.    02040002
020500     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      02050002
020600                                                    COMP SYNC.    02060002
020700     05  PV-NULL-IND-1                  PIC S9(04)  VALUE +0      02070002
020800                                                    COMP.         02080002
020900     05  PV-NULL-IND-2                  PIC S9(04)  VALUE +0      02090002
021000                                                    COMP.         02100002
021100     05  PV-NULL-IND-3                  PIC S9(04)  VALUE +0      02110002
021200                                                    COMP.         02120002
021300     05  PV-SOFT-ABORT-MSG.                                       02130002
021400         10  FILLER            PIC X(12) VALUE ' PCKCS749 - '.    02140002
021500         10  FILLER            PIC X(09) VALUE 'SQLCODE: '.       02150002
021600         10  PV-SOFT-SQLCODE   PIC ZZZZZZZZ9-.                    02160002
021700         10  FILLER            PIC X(12) VALUE ' PARAGRAPH: '.    02170002
021800         10  PV-SOFT-PARAGRAPH PIC X(30).                         02180002
021900     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +0     02190002
022000                                                     COMP SYNC.   02200002
022100     05  PV-CICS-MSG-AREA                PIC  X(80)  VALUE SPACE. 02210002
022200     05  PV-CICS-MSG-AREA2               PIC  X(100) VALUE SPACE. 02220002
022300     05  PV-CICS-MSG-HOLD.                                        02230002
022400         10  FILLER                      PIC  X(01)  VALUE SPACE. 02240002
022500         10  PV-CICS-MSG-DATA            PIC  X(79)  VALUE SPACE. 02250002
022600     05  PV-CICS-MSG-HOLD2.                                       02260002
022700         10  FILLER                      PIC  X(01)  VALUE SPACE. 02270002
022800         10  PV-CICS-MSG-DATA2           PIC  X(99)  VALUE SPACE. 02280002
022900                                                                  02290002
023000     05  PV-POHIST-DATE          PIC X(10)   VALUE SPACES.        02300099
023001     05  PV-COMPARE-DATE.                                         02300199
023002         10   PV-CMPR-YY                PIC  X(04).               02300299
023003         10   FILLER                    PIC  X(01) VALUE '-'.     02300399
023004         10   PV-CMPR-MM                PIC  X(02).               02300499
023005         10   FILLER                    PIC  X(01) VALUE '-'.     02300599
023006         10   PV-CMPR-DD                PIC  X(02).               02300699
023010     05  PV-TMST                 PIC X(26)   VALUE SPACES.        02301099
023100     05  PV-TMST-R REDEFINES  PV-TMST.                            02310002
023200         10   PV-TMST-YY                PIC  X(04).               02320007
023300         10   FILLER                    PIC  X(01).               02330007
023400         10   PV-TMST-MM                PIC  X(02).               02340007
023500         10   FILLER                    PIC  X(01).               02350007
023600         10   PV-TMST-DD                PIC  X(02).               02360007
023700         10   FILLER                    PIC  X(01).               02370007
023800         10   PV-TMST-HRS               PIC  X(02).               02380007
023900         10   FILLER                    PIC  X(01).               02390007
024000         10   PV-TMST-MIN               PIC  X(02).               02400007
024100         10   FILLER                    PIC  X(01).               02410007
024200         10   PV-TMST-SEC               PIC  X(02).               02420007
024300         10   FILLER                    PIC  X(07).               02430007
024400     05  PV-DISPLAY-DATE                PIC  X(45) VALUE SPACES.  02440017
024500     05  PV-SELECT-LIST-SEQ             PIC  X(01) VALUE SPACES.  02450007
024600     05  PV-NBR-ITEMS                   PIC  9(05) VALUE ZEROES.  02460007
024700     05  PV-SEL-TERM-ID                 PIC  X(04).               02470007
024800     05  PV-SEL-TASK-NUMBER             PIC  9(05).               02480007
024900     05  PV-SEL-SEQ                     PIC  9(01).               02490007
025000     05  PV-TOT-UNITS               PIC S9(15) COMP-3 VALUE ZEROS.02500099
025100     05  PV-3RD-UNITS               PIC S9(15) COMP-3 VALUE ZEROS.02510099
025200     05  PV-1ST-UNITS               PIC S9(15) COMP-3 VALUE ZEROS.02520099
025300     05  PV-2ND-UNITS               PIC S9(15) COMP-3 VALUE ZEROS.02530099
025400     05  PV-3RD-PCT                     PIC S9(05)V9 VALUE ZEROS. 02540099
025500     05  PV-1ST-PCT                     PIC S9(05)V9 VALUE ZEROS. 02550099
025600     05  PV-2ND-PCT                     PIC S9(05)V9 VALUE ZEROS. 02560099
025700     05  PV-TOT-PCT                     PIC S9(05)V9 VALUE ZEROS. 02570099
025800     05  PV-DIVIDEND                    PIC S9(03)V9999.          02580099
025900                                                                  02590002
026000******************************************************************02600002
026100**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **02610002
026200**  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **02620002
026300**  APPLICATION-SPECIFIC COMMAREA.                              **02630002
026400******************************************************************02640002
026500 01  LQW-LIST-QUEUE-WORK-AREA.                                    02650002
026600     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  02660002
026700     05  LQW-ITEM-ENTRIES               OCCURS 11 TIMES           02670003
026800                                        INDEXED BY LQW-IDX.       02680002
026900         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       02690002
027000         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               02700002
027100         10  LQW-SELECTED-SW            PIC  X(01).               02710002
027200             88  LQW-SELECT                         VALUE 'S'.    02720099
027300             88  LQW-DESELECT                       VALUE ' '.    02730002
027400         10  LQW-ACTION                 PIC  X(03).               02740099
027500             88  LQW-DEL                            VALUE 'DEL'.  02750099
027600             88  LQW-INQ                            VALUE 'INQ'.  02760099
027700             88  LQW-UPD                            VALUE 'UPD'.  02770099
027800             88  LQW-ERR                            VALUE 'ERR'.  02780099
027900         10  LQW-OPER-DESC              PIC  X(05)  VALUE SPACES. 02790099
028000         10  LQW-3RD-UNITS              PIC S9(10)  VALUE ZEROS.  02800099
028100         10  LQW-3RD-PCT                PIC S9(5)V9 VALUE ZEROS.  02810099
028200         10  LQW-1ST-UNITS              PIC S9(10)  VALUE ZEROS.  02820099
028300         10  LQW-1ST-PCT                PIC S9(5)V9 VALUE ZEROS.  02830099
028400         10  LQW-2ND-UNITS              PIC S9(10)  VALUE ZEROS.  02840099
028500         10  LQW-2ND-PCT                PIC S9(5)V9 VALUE ZEROS.  02850099
028600         10  LQW-TOT-UNITS              PIC S9(11)  VALUE ZEROS.  02860099
028700         10  LQW-TOT-PCT                PIC S9(5)V9 VALUE ZEROS.  02870099
028800                                                                  02880002
028900*---------------------------------------------------------------* 02890002
029000* SELECTION QUEUE LAYOUT                                        * 02900014
029100*---------------------------------------------------------------* 02910002
029200     COPY PCWS215.                                                02920014
029300                                                                  02930002
029400*---------------------------------------------------------------* 02940002
029500*    MAP LAYOUT                                                 * 02950002
029600*---------------------------------------------------------------* 02960002
029700     COPY PCKM749.                                                02970002
029800*                                                                 02980002
029900 01  MR-OCCURS-LAYOUT                   REDEFINES  PC749AO.       02990099
030000     05  FILLER                         PIC X(205).               03000099
030100     05  MR-SCROLL-AREA                 OCCURS 11 TIMES.          03010003
030200         10  MR-SELECTL                 PIC S9(04) COMP.          03020002
030300         10  MR-SELECTA                 PIC  X(01).               03030002
030400         10  MR-SELECTC                 PIC  X(01).               03040002
030500         10  MR-SELECTH                 PIC  X(01).               03050002
030600         10  MR-SELECTI                 PIC  X(01).               03060002
030700                                                                  03070002
030800*        10  MR-ACTIONL                 PIC S9(04) COMP.          03080054
030900*        10  MR-ACTIONA                 PIC  X(01).               03090054
031000*        10  MR-ACTIONC                 PIC  X(01).               03100054
031100*        10  MR-ACTIONH                 PIC  X(01).               03110054
031200*        10  MR-ACTION                  PIC  X(03).               03120054
031300                                                                  03130002
031400         10  MR-OPER-DESCL              PIC S9(04) COMP.          03140003
031500         10  MR-OPER-DESCA              PIC  X(01).               03150003
031600         10  MR-OPER-DESCC              PIC  X(01).               03160003
031700         10  MR-OPER-DESCH              PIC  X(01).               03170003
031800         10  MR-OPER-DESC               PIC  X(05).               03180003
031900                                                                  03190003
032000         10  MR-3RD-UNITSL              PIC S9(04) COMP.          03200003
032100         10  MR-3RD-UNITSA              PIC  X(01).               03210003
032200         10  MR-3RD-UNITSC              PIC  X(01).               03220003
032300         10  MR-3RD-UNITSH              PIC  X(01).               03230003
032400         10  MR-3RD-UNITS               PIC  X(11).               03240055
032500         10  MR-3RD-UNIT-X REDEFINES MR-3RD-UNITS.                03250003
032600             15  MR-3RD-UNITS-N            PIC ZZZ,ZZZ,ZZ9.       03260057
032610         10  MR-3RD-UNIT-Y REDEFINES MR-3RD-UNITS.                03261099
032620             15  MR-3RD-UNITS-O            PIC ZZZZZZZ,ZZ9.       03262099
032630         10  MR-3RD-UNIT-Z REDEFINES MR-3RD-UNITS.                03263099
032640             15  MR-3RD-UNITS-P            PIC ZZZZZZZZZ9-.       03264099
032700                                                                  03270003
032800         10  MR-3RD-PCTL                PIC S9(04) COMP.          03280003
032900         10  MR-3RD-PCTA                PIC  X(01).               03290003
033000         10  MR-3RD-PCTC                PIC  X(01).               03300003
033100         10  MR-3RD-PCTH                PIC  X(01).               03310003
033200         10  MR-3RD-PCT                 PIC  X(05).               03320018
033300         10  MR-3RD-PCT-X REDEFINES MR-3RD-PCT.                   03330003
033400             15  MR-3RD-PCT-N              PIC  ZZ9.9.            03340099
033500                                                                  03350003
033600         10  MR-1ST-UNITSL              PIC S9(04) COMP.          03360004
033700         10  MR-1ST-UNITSA              PIC  X(01).               03370004
033800         10  MR-1ST-UNITSC              PIC  X(01).               03380004
033900         10  MR-1ST-UNITSH              PIC  X(01).               03390004
034000         10  MR-1ST-UNITS               PIC  X(11).               03400055
034100         10  MR-1ST-UNIT-X REDEFINES MR-1ST-UNITS.                03410055
034200             15  MR-1ST-UNITS-N            PIC ZZZ,ZZZ,ZZ9.       03420057
034210         10  MR-1ST-UNIT-Y REDEFINES MR-1ST-UNITS.                03421099
034220             15  MR-1ST-UNITS-O            PIC ZZZZZZZ,ZZ9.       03422099
034230         10  MR-1ST-UNIT-Z REDEFINES MR-1ST-UNITS.                03423099
034240             15  MR-1ST-UNITS-P            PIC ZZZZZZZZZ9-.       03424099
034300                                                                  03430004
034400         10  MR-1ST-PCTL                PIC S9(04) COMP.          03440004
034500         10  MR-1ST-PCTA                PIC  X(01).               03450004
034600         10  MR-1ST-PCTC                PIC  X(01).               03460004
034700         10  MR-1ST-PCTH                PIC  X(01).               03470004
034800         10  MR-1ST-PCT                 PIC  X(05).               03480018
034900         10  MR-1ST-PCT-X REDEFINES MR-1ST-PCT.                   03490004
035000             15  MR-1ST-PCT-N              PIC  ZZ9.9.            03500099
035100                                                                  03510004
035200         10  MR-2ND-UNITSL              PIC S9(04) COMP.          03520004
035300         10  MR-2ND-UNITSA              PIC  X(01).               03530004
035400         10  MR-2ND-UNITSC              PIC  X(01).               03540004
035500         10  MR-2ND-UNITSH              PIC  X(01).               03550004
035600         10  MR-2ND-UNITS               PIC  X(11).               03560055
035700         10  MR-2ND-UNIT-X REDEFINES MR-2ND-UNITS.                03570056
035800             15  MR-2ND-UNITS-N            PIC ZZZ,ZZZ,ZZ9.       03580057
035810         10  MR-2ND-UNIT-Y REDEFINES MR-2ND-UNITS.                03581099
035820             15  MR-2ND-UNITS-O            PIC ZZZZZZZ,ZZ9.       03582099
035830         10  MR-2ND-UNIT-Z REDEFINES MR-2ND-UNITS.                03583099
035840             15  MR-2ND-UNITS-P            PIC ZZZZZZZZZ9-.       03584099
035900                                                                  03590004
036000         10  MR-2ND-PCTL                PIC S9(04) COMP.          03600004
036100         10  MR-2ND-PCTA                PIC  X(01).               03610004
036200         10  MR-2ND-PCTC                PIC  X(01).               03620004
036300         10  MR-2ND-PCTH                PIC  X(01).               03630004
036400         10  MR-2ND-PCT                 PIC  X(05).               03640018
036500         10  MR-2ND-PCT-X REDEFINES MR-2ND-PCT.                   03650004
036600             15  MR-2ND-PCT-N              PIC  ZZ9.9.            03660099
036700                                                                  03670018
036800         10  MR-TOT-UNITSL              PIC S9(04) COMP.          03680004
036900         10  MR-TOT-UNITSA              PIC  X(01).               03690004
037000         10  MR-TOT-UNITSC              PIC  X(01).               03700004
037100         10  MR-TOT-UNITSH              PIC  X(01).               03710004
037200         10  MR-TOT-UNITS               PIC  X(11).               03720055
037300         10  MR-TOT-UNIT-X REDEFINES MR-TOT-UNITS.                03730056
037400             15  MR-TOT-UNITS-N            PIC ZZZ,ZZZ,ZZ9.       03740057
037410         10  MR-TOT-UNIT-Y REDEFINES MR-TOT-UNITS.                03741099
037420             15  MR-TOT-UNITS-O            PIC ZZZZZZZ,ZZ9.       03742099
037430         10  MR-TOT-UNIT-Z REDEFINES MR-TOT-UNITS.                03743099
037440             15  MR-TOT-UNITS-P            PIC ZZZZZZZZZ9-.       03744099
037500                                                                  03750004
037600         10  MR-TOT-PCTL                PIC S9(04) COMP.          03760004
037700         10  MR-TOT-PCTA                PIC  X(01).               03770004
037800         10  MR-TOT-PCTC                PIC  X(01).               03780004
037900         10  MR-TOT-PCTH                PIC  X(01).               03790004
038000         10  MR-TOT-PCT                 PIC  X(05).               03800018
038100         10  MR-TOT-PCT-X REDEFINES MR-TOT-PCT.                   03810004
038200             15  MR-TOT-PCT-N              PIC  ZZ9.9.            03820099
038300                                                                  03830004
038400*---------------------------------------------------------------* 03840002
038500*    ATTRIBUTE SETTINGS COPYBOOK.                               * 03850002
038600*---------------------------------------------------------------* 03860002
038700     COPY DPWS015.                                                03870002
038800                                                                  03880002
038900*---------------------------------------------------------------* 03890002
039000*    FUNCTION KEYS COPYBOOK.                                    * 03900002
039100*---------------------------------------------------------------* 03910002
039200     COPY DPWS016.                                                03920002
039300                                                                  03930002
039400*---------------------------------------------------------------* 03940002
039500*    NUMERIC EDIT LAYOUT.                                       * 03950002
039600*---------------------------------------------------------------* 03960002
039700     COPY DPWS010I.                                               03970002
039800                                                                  03980002
039900*---------------------------------------------------------------* 03990002
040000*    PARAMETERS FOR CALLING CICS ARCHITECTURE API (DPKCS030).   * 04000002
040100*---------------------------------------------------------------* 04010002
040200     COPY DPWS030.                                                04020002
1122RM     COPY DPWS930.                                                04021099
040300                                                                  04030002
040400*---------------------------------------------------------------* 04040002
040500*    STANDARD COMMAREA.                                         * 04050002
040600*---------------------------------------------------------------* 04060002
040700     COPY DPWS020.                                                04070002
040800     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                04080002
040900                                                                  04090002
041000*---------------------------------------------------------------* 04100002
041100* INTER-APPLICATION COMMAREA.                                   * 04110002
041200*   PCWS213 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 04120004
041300*             SPEC SCREEN.                                      * 04130002
041400*   PCWS214 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 04140004
041500*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 04150002
041600*---------------------------------------------------------------* 04160002
041700         10  INTER-APPL-COMM-AREA       PIC X(200).               04170002
041800     COPY PCWS213.                                                04180004
041900     COPY PCWS214.                                                04190004
042000                                                                  04200004
042100*---------------------------------------------------------------* 04210002
042200*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 04220002
042300*---------------------------------------------------------------* 04230002
042400         10  ASC-SPECIFIC-COMMAREA.                               04240002
042500             15  ASC-OPER-NBR-X              PIC  X(04).          04250004
042600             15  ASC-OPER-NBR-N REDEFINES ASC-OPER-NBR-X.         04260004
042700                 20  ASC-OPER-NBR            PIC  9(04).          04270004
042800             15  ASC-OPER-DESC               PIC  X(05).          04280004
042810             15  ASC-DISPLAY-DATE            PIC  X(45).          04281087
042900             15  ASC-BUSN-DATE.                                   04290022
043000                 20  ASC-BUSN-YY             PIC  X(04).          04300022
043100                 20  ASC-BUSN-MM             PIC  X(02).          04310022
043200                 20  ASC-BUSN-DD             PIC  X(02).          04320022
043300             15  ASC-FROM-DATE.                                   04330022
043400                 20  ASC-FROM-MN             PIC  X(02).          04340022
043500                 20  ASC-FROM-DY             PIC  X(02).          04350022
043600                 20  ASC-FROM-YR             PIC  X(04).          04360049
043700             15  ASC-TO-DATE.                                     04370022
043800                 20  ASC-TO-MN               PIC  X(02).          04380022
043900                 20  ASC-TO-DY               PIC  X(02).          04390022
044000                 20  ASC-TO-YR               PIC  X(04).          04400049
044100             15  ASC-FISCAL-WEEK             PIC  X(06).          04410004
044200             15  ASC-FISCAL-MONTH            PIC  X(06).          04420004
044300             15  ASC-PRINTER-ID              PIC  X(08).          04430004
044400             15  ASC-PROCESS-GROUP           PIC  X(06).          04440005
044500             15  ASC-PROCESS-AREA            PIC  X(06).          04450005
044600             15  ASC-TOT-UNITS               PIC S9(15).          04460099
044700             15  ASC-3RD-UNITS               PIC S9(15).          04470099
044800             15  ASC-1ST-UNITS               PIC S9(15).          04480099
044900             15  ASC-2ND-UNITS               PIC S9(15).          04490099
045000             15  ASC-3RD-PCT                 PIC S9(05)V9.        04500099
045100             15  ASC-1ST-PCT                 PIC S9(05)V9.        04510099
045200             15  ASC-2ND-PCT                 PIC S9(05)V9.        04520099
045300             15  ASC-TOT-PCT                 PIC S9(05)V9.        04530099
045400             15  FILLER                      PIC  X(025).         04540079
045500*-----------------------------------------------------------------04550002
045600             15  ASC-BLK-SUB                  PIC S9(04) COMP     04560002
045700                                                         SYNC.    04570002
045800             15  ASC-ITEM-SUB                 PIC S9(04) COMP     04580002
045900                                                         SYNC.    04590002
046000             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  04600002
046100             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  04610002
046200             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  04620002
046300             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  04630002
046400             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  04640002
046500             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     04650002
046600                                                         SYNC.    04660002
046700             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  04670002
046800             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  04680002
046900             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         04690002
047000                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     04700002
047100                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     04710002
047200             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         04720002
047300                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     04730002
047400                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     04740002
047500             15  ASC-LIST-QUEUE-NAME.                             04750002
047600                 20  ASC-LIST-TERM-ID         PIC  X(04).         04760002
047700                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  04770002
047800                 20  ASC-LIST-SEQ             PIC  9(01).         04780002
047900                                                                  04790002
048000             15  ASC-START-ITEM-REQUEST.                          04800002
048100                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         04810002
048200                                                                  04820002
048300             15  ASC-SEL-SUB                  PIC S9(4) COMP.     04830002
048400             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     04840002
048500             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          04850002
048600                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 04860002
048700             15  ASC-SEL-QUEUE-NAME.                              04870002
048800                 20  ASC-SEL-TERM-ID          PIC  X(04).         04880002
048900                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  04890002
049000                 20  ASC-SEL-SEQ              PIC  9(01).         04900002
049100             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  04910002
049200                                                                  04920002
049300*-----------------------------------------------------------------04930002
049400             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                04940002
049500                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  04950002
049600                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   04960002
049700                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   04970002
049800                                                                  04980002
049900                 20  ASC-ITEM-ARRAY.                              04990002
050000                     25  ASC-ITEM-ENTRIES OCCURS 11 TIMES.        05000004
050100                         30  ASC-LIST-ITEM-NUMBER                 05010002
050200                                                     PIC S9(09)   05020002
050300                                                     COMP-3.      05030002
050400                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  05040002
050500                             88  ASC-VALID-SELECT    VALUE ' '    05050002
050600                                                           'S'    05060002
050700                                                           'B'    05070002
050800                                                           'E'.   05080002
050900                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   05090002
051000                             88  ASC-TEMP-SELECT     VALUE 'S'.   05100002
051100                             88  ASC-TEMP-BEGIN      VALUE 'B'.   05110002
051200                             88  ASC-TEMP-END        VALUE 'E'.   05120002
051300                         30  ASC-SELECTED-SW         PIC  X(01).  05130002
051400                             88  ASC-NO-SELECT       VALUE ' '.   05140002
051500                             88  ASC-SELECT          VALUE 'S'.   05150002
051600                             88  ASC-BEGIN           VALUE 'B'.   05160002
051700                             88  ASC-END             VALUE 'E'.   05170002
051800                         30  ASC-ACTION            PIC  X(03).    05180078
051900                         30  ASC-OPERDESC          PIC  X(05).    05190078
052000                         30  ASC-3RDUNITS          PIC S9(10).    05200099
052100                         30  ASC-3RDPCT            PIC S9(5)V9.   05210099
052200                         30  ASC-1STUNITS          PIC S9(10).    05220099
052300                         30  ASC-1STPCT            PIC S9(5)V9.   05230099
052400                         30  ASC-2NDUNITS          PIC S9(10).    05240099
052500                         30  ASC-2NDPCT            PIC S9(5)V9.   05250099
052600                         30  ASC-TOTUNITS          PIC S9(11).    05260099
052700                         30  ASC-TOTPCT            PIC S9(5)V9.   05270099
052800                                                                  05280002
052900*---------------------------------------------------------------* 05290002
053000*    ABEND PROCESSING COPYBOOK.                                 * 05300002
053100*---------------------------------------------------------------* 05310002
053200     COPY DPWS013.                                                05320002
053300                                                                  05330002
053400*---------------------------------------------------------------* 05340002
053500*    PCT_SHFT - SHIFT TRACKING TABLE                              05350004
053600*---------------------------------------------------------------* 05360002
053700     EXEC SQL                                                     05370002
053800          INCLUDE PCT00004                                        05380004
053900     END-EXEC.                                                    05390002
054000                                                                  05400002
054100*---------------------------------------------------------------* 05410002
054200*    PCT_SUM_WRKD - SUMMARY OF UNITS WORKED INFORMATION           05420004
054300*---------------------------------------------------------------* 05430002
054400     EXEC SQL                                                     05440002
054500          INCLUDE PCT00005                                        05450004
054600     END-EXEC.                                                    05460002
054700                                                                  05470002
054800*---------------------------------------------------------------* 05480002
054900*    LOCATION TABLE - XLT_LOC                                     05490099
055000*---------------------------------------------------------------* 05500002
055100     EXEC SQL                                                     05510002
055200          INCLUDE XLT00010                                        05520099
055300     END-EXEC.                                                    05530002
055400                                                                  05540002
055410*-----------------------------------------------------------------05541099
055420*  PARM TABLE                                                     05542099
055430*-----------------------------------------------------------------05543099
055440     EXEC SQL                                                     05544099
055450          INCLUDE TKRPRPM                                         05545099
055460     END-EXEC.                                                    05546099
055470                                                                  05547099
055500*---------------------------------------------------------------* 05550007
055600*    TDTATTR - DATE TABLE                                         05560007
055700*---------------------------------------------------------------* 05570007
055800     EXEC SQL                                                     05580007
055900          INCLUDE TDTATTR                                         05590007
056000     END-EXEC.                                                    05600007
056100                                                                  05610007
056200*---------------------------------------------------------------* 05620002
056300*    DB2 AREA FOR COMMUNICATIONS                                * 05630002
056400*---------------------------------------------------------------* 05640002
056500     EXEC SQL                                                     05650002
056600          INCLUDE SQLCA                                           05660002
056700     END-EXEC.                                                    05670002
056800                                                                  05680002
056900*---------------------------------------------------------------* 05690002
057000*    OPER NAME CURSOR                                             05700008
057100*---------------------------------------------------------------* 05710002
057200     EXEC SQL                                                     05720002
057300          DECLARE OPER-NAME-CSR CURSOR FOR                        05730008
057400              SELECT  DISTINCT(A.OPER_UNT_ID)                     05740010
057500                     ,B.LOC_5_ABBR_NM                             05750099
057600                FROM  PCT_SHFT A                                  05760010
057700                     ,XLT_LOC  B                                  05770099
057800               WHERE  A.OPER_UNT_ID   =  :DK-OPER-UNT-ID          05780010
057900                 AND  A.OPER_UNT_ID   =  B.LOC_NBR                05790099
058000     END-EXEC.                                                    05800002
058100                                                                  05810002
058200*---------------------------------------------------------------* 05820010
058300*    UNKNOWN OPER NAME CURSOR                                     05830010
058400*---------------------------------------------------------------* 05840010
058500     EXEC SQL                                                     05850010
058600          DECLARE UK-OPER-NAME-CSR CURSOR FOR                     05860010
058700              SELECT  DISTINCT(A.OPER_UNT_ID)                     05870010
058800                     ,B.LOC_5_ABBR_NM                             05880099
058900                FROM  PCT_SHFT A                                  05890010
059000                     ,XLT_LOC  B                                  05900099
059100               WHERE  A.OPER_UNT_ID   =  B.LOC_NBR                05910099
059200     END-EXEC.                                                    05920010
059300                                                                  05930010
059400*---------------------------------------------------------------* 05940010
059500*    UNITS BY OPER CURSOR                                         05950008
059600*---------------------------------------------------------------* 05960008
059700     EXEC SQL                                                     05970008
059800          DECLARE UNITS-BY-OPER-CSR CURSOR FOR                    05980008
059900              SELECT  SUM(UNT_WRKD_QTY)                           05990008
060000                     ,SHFT_NBR                                    06000008
060100                FROM  PCT_SUM_WRKD                                06010008
060200               WHERE  BUS_DTE        >=  :DK-FROM-DATE            06020008
060300                 AND  BUS_DTE        <=  :DK-TO-DATE              06030008
060400                 AND  OPER_UNT_ID     =  :DK-OPER-UNT-ID          06040008
060500                 GROUP BY SHFT_NBR                                06050008
060600     END-EXEC.                                                    06060008
060700                                                                  06070008
060800*-----------------------------------------------------------------06080002
060900 LINKAGE SECTION.                                                 06090002
061000                                                                  06100002
061100 01  DFHCOMMAREA.                                                 06110002
061200     05  FILLER                         OCCURS  1 TO 4072 TIMES   06120002
061300                                        DEPENDING ON EIBCALEN.    06130002
061400         10  FILLER                     PIC X.                    06140002
061500                                                                  06150002
061600                                                                  06160002
061700 PROCEDURE DIVISION.                                              06170002
061800******************************************************************06180002
061900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **06190002
062000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **06200002
062100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **06210002
062200******************************************************************06220002
062300 0000-MAIN-MODULE.                                                06230002
062400     INITIALIZE DP030-CICS-API-FIELDS.                            06240002
062500     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       06250002
062600     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          06260002
062700     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         06270002
062800     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       06280002
062900     MOVE LENGTH OF PC749AI        TO DP030-MAP-LENGTH (1).       06290002
063000     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     06300002
063100     PERFORM 0001-CALL-CICS-ARCH-API.                             06310002
063200*                                                                 06320002
063300     PERFORM 1000-CONTROL-PROCESSING                              06330002
063400*                                                                 06340002
063500     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     06350002
063600     PERFORM 0001-CALL-CICS-ARCH-API.                             06360002
063700                                                                  06370002
063800******************************************************************06380002
063900**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **06390002
064000**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **06400002
064100******************************************************************06410002
064200 0001-CALL-CICS-ARCH-API.                                         06420002
1122RM*    CALL 'DPKCS030' USING DFHEIBLK                               06430099
1122RM     CALL DP930-CICS-ARCH-API                                     06431099
1122RM                     USING DFHEIBLK                               06432099
064400                           DFHCOMMAREA                            06440002
064500                           DP030-CICS-API-FIELDS                  06450002
064600                           DP020-STANDARD-COMMAREA                06460002
064700                           PC749AI.                               06470002
064800*                                                                 06480002
064900     IF  DP030-RC-CALL-SUCCESSFUL                                 06490002
065000         CONTINUE                                                 06500002
065100     ELSE                                                         06510002
065200         SET DP013-NO-ROLLBACK                                    06520002
065300             DP013-XCTL-DISPLAY-RESTART                           06530002
065400             DP013-CICS-ABEND      TO TRUE                        06540002
065500         MOVE '0001-CALL-CICS-ARCH-API' TO DP013-PARAGRAPH        06550002
1122RM*        MOVE 'CALL TO DPKCS030 NOT SUCCESSFUL, RETURN-CODE ON NEX06560099
1122RM*             'T LINE'             TO DP013-MESSAGE-TEXT (2)      06570099
1122rm         MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O06571099
1122RM-             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      06572099
065800         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      06580002
065900         PERFORM DP013-0000-PROCESS-ABEND                         06590002
066000     END-IF.                                                      06600002
066100                                                                  06610002
066200*----------------------------------------------------------------*06620002
066300* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *06630002
066400* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *06640002
066500*                                                                *06650002
066600* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *06660002
066700*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *06670002
066800*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06680002
066900*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06690002
067000*----------------------------------------------------------------*06700002
067100 1000-CONTROL-PROCESSING.                                         06710002
067200                                                                  06720002
067300     EVALUATE TRUE                                                06730002
067400         WHEN DP020-NEXT-ACT-INITIAL                              06740002
067500             INITIALIZE ASC-SPECIFIC-COMMAREA                     06750002
067600             MOVE EIBTRMID         TO ASC-LIST-TERM-ID            06760002
067700                                      ASC-SEL-TERM-ID             06770002
067800             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06780002
067900                                           ASC-SEL-TASK-NUMBER    06790002
068000             MOVE PC-LIST-QUEUE-SEQ  TO ASC-LIST-SEQ              06800002
068100             MOVE PC-SEL-QUEUE-SEQ TO ASC-SEL-SEQ                 06810002
068200             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06820002
068300***-----$TEMPLATE NOTE$-------------------------------------------06830002
068400*** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,06840002
068500*** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  06850002
068600*** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.06860002
068700***---------------------------------------------------------------06870002
068800             IF  PS-COMMAREA-NOT-VALID                            06880002
068900                 SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            06890002
069000             ELSE                                                 06900002
069100                 PERFORM 4000-BUILD-INITIAL-PANEL                 06910002
069200             END-IF                                               06920002
069300                                                                  06930002
069400         WHEN DP020-NEXT-ACT-READ-MAP                             06940002
069500             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06950002
069600             PERFORM 2000-PROCESS-PANEL                           06960002
069700                                                                  06970002
069800         WHEN DP020-NEXT-ACT-RETURN                               06980002
069900             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06990002
070000             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               07000005
070010             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07001099
070100*            PERFORM 6000-REFRESH-PANEL-FROM-TEMP                 07010099
070200             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07020002
070300                                                                  07030002
070400         WHEN OTHER                                               07040002
070500             SET DP013-LOGIC-ABEND TO TRUE                        07050002
070600             SET DP013-NO-ROLLBACK TO TRUE                        07060002
070700             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    07070002
070800             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    07080002
070900                                   TO DP013-MESSAGE-TEXT(1)       07090002
071000             PERFORM DP013-0000-PROCESS-ABEND                     07100002
071100     END-EVALUATE.                                                07110002
071200                                                                  07120002
071300*----------------------------------------------------------------*07130002
071400* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *07140002
071500* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *07150002
071600*----------------------------------------------------------------*07160002
071700 1100-PROCESS-INTER-APPL-COMM.                                    07170002
071800                                                                  07180002
071900     SET PS-COMMAREA-VALID         TO TRUE.                       07190002
072000     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     07200002
072100                                                                  07210002
072200     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          07220002
072300         MOVE PC213-OPER-UNT-ID       TO ASC-OPER-NBR             07230005
072400                                         DK-OPER-UNT-ID           07240005
072500         MOVE PC213-CRNT-BUS-DTE      TO ASC-BUSN-DATE            07250005
072600         MOVE PC213-FROM-DATE         TO ASC-FROM-DATE            07260005
072700         MOVE PC213-TO-DATE           TO ASC-TO-DATE              07270015
072800         MOVE PC213-FISCAL-WEEK       TO ASC-FISCAL-WEEK          07280005
072900         MOVE PC213-FISCAL-MONTH      TO ASC-FISCAL-MONTH         07290005
073000         MOVE PC213-PRINTER-ID        TO ASC-PRINTER-ID           07300005
073100     ELSE                                                         07310005
073110         SET ASC-USE-SELECTION-QUEUE TO TRUE                      07311099
073120         MOVE PC214-NUMBER-OF-SELECTED-ITEMS TO                   07312099
073130                                      ASC-NUMBER-OF-SELECTED-ITEMS07313099
073140         MOVE PC214-NUMBER-OF-TS-ITEMS TO ASC-NUMBER-OF-TS-ITEMS  07314099
073150         MOVE PC214-SEL-QUEUE-NAME     TO ASC-SEL-QUEUE-NAME      07315099
073200         MOVE PC214-OPER-UNT-ID       TO ASC-OPER-NBR             07320005
073300                                         DK-OPER-UNT-ID           07330005
073400         MOVE PC214-FROM-DATE         TO ASC-FROM-DATE            07340020
073500         MOVE PC214-TO-DATE           TO ASC-TO-DATE              07350020
073600         MOVE PC214-PROCESS-GROUP     TO ASC-PROCESS-GROUP        07360020
073700         MOVE PC214-PROCESS-AREA      TO ASC-PROCESS-AREA         07370020
073710         PERFORM 1120-PREPARE-LIST-ENTRY                          07371099
073800     END-IF.                                                      07380020
073900                                                                  07390020
074000*-----------------------------------------------------------------07400002
074100 1120-PREPARE-LIST-ENTRY.                                         07410002
074200                                                                  07420002
074300     MOVE PC215-MAX-ITEMS          TO ASC-SEL-SUB.                07430002
074400     MOVE ZERO                     TO ASC-SEL-ITEM.               07440002
074500     PERFORM 1130-GET-NEXT-RECORD.                                07450002
074600                                                                  07460002
074700*-----------------------------------------------------------------07470002
074800*    GET THE NEXT RECORD IF A LIST OF RECORDS ARE BEING PROCESSED*07480002
074900*-----------------------------------------------------------------07490002
075000 1130-GET-NEXT-RECORD.                                            07500002
075100                                                                  07510002
075200     ADD +1                       TO ASC-SEL-SUB.                 07520002
075300                                                                  07530002
075400     IF  ASC-SEL-SUB > PC215-MAX-ITEMS                            07540002
075500         ADD +1                   TO ASC-SEL-ITEM                 07550002
075600         MOVE +1                  TO ASC-SEL-SUB                  07560002
075700     END-IF.                                                      07570002
075800                                                                  07580002
075900     IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                07590002
076000         PERFORM 9100-READ-SEL-QUEUE                              07600002
076100         IF  PC215-ITEM (ASC-SEL-SUB) > ZERO                      07610002
076200             MOVE PC215-OPER-DESC (ASC-SEL-SUB) TO ASC-OPER-DESC  07620005
076210             MOVE PC215-AREA  (ASC-SEL-SUB) TO ASC-PROCESS-AREA   07621089
076220             MOVE PC215-GROUP (ASC-SEL-SUB) TO ASC-PROCESS-GROUP  07622089
076300             MOVE PC215-3RD-UNITS (ASC-SEL-SUB) TO ASC-3RD-UNITS  07630005
076400             MOVE PC215-3RD-PCT (ASC-SEL-SUB)   TO ASC-3RD-PCT    07640005
076500             MOVE PC215-1ST-UNITS (ASC-SEL-SUB) TO ASC-1ST-UNITS  07650005
076600             MOVE PC215-1ST-PCT (ASC-SEL-SUB)   TO ASC-1ST-PCT    07660005
076700             MOVE PC215-2ND-UNITS (ASC-SEL-SUB) TO ASC-2ND-UNITS  07670005
076800             MOVE PC215-2ND-PCT (ASC-SEL-SUB)   TO ASC-2ND-PCT    07680005
076900             MOVE PC215-TOT-UNITS (ASC-SEL-SUB) TO ASC-TOT-UNITS  07690005
077000             MOVE PC215-TOT-PCT (ASC-SEL-SUB)   TO ASC-TOT-PCT    07700005
077100             SET PC215-INQ (ASC-SEL-SUB) TO TRUE                  07710002
077200             PERFORM 9200-REWRITE-SEL-QUEUE                       07720002
077300         ELSE                                                     07730002
077400             SUBTRACT +1 FROM ASC-SEL-SUB                         07740002
077500             MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER             07750002
077600             SET DP020-MSG-INFORMATIONAL                          07760002
077700                 PS-LIST-END             TO TRUE                  07770002
077800         END-IF                                                   07780002
077900     ELSE                                                         07790002
078000         SUBTRACT +1 FROM ASC-SEL-ITEM                            07800002
078100         MOVE PC215-MAX-ITEMS     TO ASC-SEL-SUB                  07810002
078200         MOVE PC-TSYMSG-00070     TO DP020-MSG-NUMBER             07820002
078300         SET DP020-MSG-INFORMATIONAL                              07830002
078400             PS-LIST-END             TO TRUE                      07840002
078500     END-IF.                                                      07850002
078600                                                                  07860002
078700*-----------------------------------------------------------------07870005
078800*    GET THE PREVIOUS RECORD IF A LIST OF RECORDS ARE BEING      *07880002
078900*    PROCESSED.                                                  *07890002
079000*-----------------------------------------------------------------07900002
079100 1140-GET-PREV-RECORD.                                            07910002
079200                                                                  07920002
079300     SUBTRACT +1 FROM ASC-SEL-SUB.                                07930002
079400                                                                  07940002
079500     IF  ASC-SEL-SUB < +1                                         07950002
079600         SUBTRACT +1 FROM ASC-SEL-ITEM                            07960002
079700         MOVE PC215-MAX-ITEMS     TO ASC-SEL-SUB                  07970002
079800     END-IF.                                                      07980002
079900                                                                  07990002
080000     IF  ASC-SEL-ITEM > ZERO                                      08000002
080100         PERFORM 9100-READ-SEL-QUEUE                              08010002
080200         MOVE PC215-OPER-DESC (ASC-SEL-SUB) TO ASC-OPER-DESC      08020005
080210         MOVE PC215-AREA  (ASC-SEL-SUB) TO ASC-PROCESS-AREA       08021089
080220         MOVE PC215-GROUP (ASC-SEL-SUB) TO ASC-PROCESS-GROUP      08022089
080300         MOVE PC215-3RD-UNITS (ASC-SEL-SUB) TO ASC-3RD-UNITS      08030005
080400         MOVE PC215-3RD-PCT (ASC-SEL-SUB)   TO ASC-3RD-PCT        08040005
080500         MOVE PC215-1ST-UNITS (ASC-SEL-SUB) TO ASC-1ST-UNITS      08050005
080600         MOVE PC215-1ST-PCT (ASC-SEL-SUB)   TO ASC-1ST-PCT        08060005
080700         MOVE PC215-2ND-UNITS (ASC-SEL-SUB) TO ASC-2ND-UNITS      08070005
080800         MOVE PC215-2ND-PCT (ASC-SEL-SUB)   TO ASC-2ND-PCT        08080005
080900         MOVE PC215-TOT-UNITS (ASC-SEL-SUB) TO ASC-TOT-UNITS      08090005
081000         MOVE PC215-TOT-PCT (ASC-SEL-SUB)   TO ASC-TOT-PCT        08100005
081100         SET PC215-INQ (ASC-SEL-SUB) TO TRUE                      08110002
081200         PERFORM 9200-REWRITE-SEL-QUEUE                           08120002
081300     ELSE                                                         08130002
081400         MOVE +1                  TO ASC-SEL-ITEM                 08140002
081500                                     ASC-SEL-SUB                  08150002
081600         MOVE PC-TSYMSG-00069     TO DP020-MSG-NUMBER             08160002
081700         SET DP020-MSG-INFORMATIONAL                              08170002
081800             PS-LIST-END             TO TRUE                      08180002
081900     END-IF.                                                      08190002
082000                                                                  08200002
082100*----------------------------------------------------------------*08210002
082200* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *08220002
082300* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *08230002
082400* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *08240002
082500* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *08250002
082600* FUNCTION KEYS CAN GET THIS FAR.                                *08260002
082700*----------------------------------------------------------------*08270002
082800 2000-PROCESS-PANEL.                                              08280002
082900     EVALUATE TRUE                                                08290002
083000         WHEN DP020-SRC-AID = DP016-CLEAR                         08300002
083100             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                08310005
083200             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08320002
083300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08330002
083400                                                                  08340002
083500         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    08350002
083600             PERFORM 2050-DELETE-LIST-QUEUE                       08360002
083700             PERFORM 4000-BUILD-INITIAL-PANEL                     08370002
083800                                                                  08380002
083900         WHEN DP020-FK-DESELECT(DP020-SRC-AID)                    08390002
084000             PERFORM 2140-DESELECT-ALL-ITEMS                      08400002
084100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08410002
084200                                                                  08420002
084300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  08430002
084400             PERFORM 2150-SELECT-ALL-ITEMS                        08440002
084500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 08450002
084600                                                                  08460002
084700         WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)             08470002
084800             IF  ASC-USE-SELECTION-QUEUE                          08480002
084900                 PERFORM 1130-GET-NEXT-RECORD                     08490002
085000                 IF PS-LIST-END                                   08500002
085100                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08510002
085200                     SET PS-NO-LIST-END TO TRUE                   08520002
085300                 ELSE                                             08530002
085400                     PERFORM 2050-DELETE-LIST-QUEUE               08540002
085500                     PERFORM 3200-RESET-ATTRIBUTES                08550002
085600                     PERFORM 4000-BUILD-INITIAL-PANEL             08560002
085700                 END-IF                                           08570002
085800              ELSE                                                08580002
085900                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08590002
086000*                --- BOTTOM OF LIST ---                           08600002
086100                 MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER         08610002
086200                 SET DP020-MSG-INFORMATIONAL TO TRUE              08620002
086300             END-IF                                               08630002
086400                                                                  08640002
086500         WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)             08650002
086600             IF  ASC-USE-SELECTION-QUEUE                          08660002
086700                 PERFORM 1140-GET-PREV-RECORD                     08670002
086800                 IF PS-LIST-END                                   08680002
086900                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         08690002
087000                     SET PS-NO-LIST-END TO TRUE                   08700002
087100                 ELSE                                             08710002
087200                     PERFORM 2050-DELETE-LIST-QUEUE               08720002
087300                     PERFORM 3200-RESET-ATTRIBUTES                08730002
087400                     PERFORM 4000-BUILD-INITIAL-PANEL             08740002
087500                 END-IF                                           08750002
087600             ELSE                                                 08760002
087700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08770002
087800                 MOVE PC-TSYMSG-00069 TO DP020-MSG-NUMBER         08780002
087900                 SET DP020-MSG-INFORMATIONAL TO TRUE              08790002
088000             END-IF                                               08800002
088100                                                                  08810002
088200         WHEN OTHER                                               08820002
088300             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 08830002
088400             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   08840002
088500                                                                  08850002
088600             IF  PS-NO-ERROR                                      08860002
088700                 SET DP030-CONTINUE-GO TO TRUE                    08870002
088800                 PERFORM 2100-CHECK-FUNCTION-KEY                  08880002
088900             ELSE                                                 08890002
089000                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08900002
089100                 SET DP030-OVERRIDE-GO TO TRUE                    08910002
089200             END-IF                                               08920002
089300     END-EVALUATE.                                                08930002
089400                                                                  08940002
089500*----------------------------------------------------------------*08950002
089600*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *08960002
089700*----------------------------------------------------------------*08970002
089800 2050-DELETE-LIST-QUEUE.                                          08980002
089900                                                                  08990002
090000     EXEC CICS                                                    09000002
090100         DELETEQ TS                                               09010002
090200             QUEUE (ASC-LIST-QUEUE-NAME)                          09020002
090300             RESP  (PV-CICS-RESP)                                 09030002
090400     END-EXEC.                                                    09040002
090500                                                                  09050002
090600     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       09060002
090700        (PV-CICS-RESP = DFHRESP(QIDERR))                          09070002
090800         CONTINUE                                                 09080002
090900     ELSE                                                         09090002
091000         SET DP013-CICS-ABEND      TO TRUE                        09100002
091100         SET DP013-NO-ROLLBACK     TO TRUE                        09110002
091200                                                                  09120002
091300         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         09130002
091400         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    09140002
091500                                   TO DP013-MESSAGE-TEXT (1)      09150002
091600         PERFORM DP013-0000-PROCESS-ABEND                         09160002
091700     END-IF.                                                      09170002
091800                                                                  09180002
091900     MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  09190002
092000                                                                  09200002
092100*----------------------------------------------------------------*09210002
092200* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*09220002
092300* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *09230002
092400* CICS ARCHITECTURE API.                                         *09240002
092500*----------------------------------------------------------------*09250002
092600 2100-CHECK-FUNCTION-KEY.                                         09260002
092700                                                                  09270002
092800     EVALUATE TRUE                                                09280002
092900*                                                                 09290002
093000* F17 - UNITS WORKED BY PO                                        09300005
093100         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              09310002
093110             IF ASC-OPER-NBR-X  = SPACES OR ZEROES                09311093
093111             AND ASC-OPERDESC (1, 1) = SPACES                     09311199
093120                 SET PS-ERROR                                     09312090
093130                     DP020-MSG-FATAL         TO TRUE              09313090
093140                 MOVE PC-TSYMSG-02873    TO DP020-MSG-NUMBER      09314090
093180                 MOVE -1                 TO MR-SELECTL (1)        09318091
093190                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09319090
093191                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             09319193
093192                 SET DP030-OVERRIDE-GO TO TRUE                    09319293
093193             END-IF                                               09319390
093194             IF PS-NO-ERROR                                       09319494
093202                 IF ASC-BUSN-DATE = SPACES                        09320294
093204                     SET PS-ERROR                                 09320494
093205                         DP020-MSG-FATAL         TO TRUE          09320594
093206                     MOVE PC-TSYMSG-02378    TO DP020-MSG-NUMBER  09320694
093207                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09320794
093208                     MOVE -1                 TO MR-SELECTL (1)    09320894
093209                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09320994
093210                     SET DP030-OVERRIDE-GO TO TRUE                09321094
093228                 END-IF                                           09322894
093229             END-IF                                               09322994
093230             IF PS-NO-ERROR                                       09323002
093231                 PERFORM 2300-CHECK-PO-HISTORY-DATE               09323199
093240                 IF PS-VALID-POHIST-DATE                          09324099
093300                     IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO      09330099
093400                         SET ASC-USE-SELECTION-QUEUE TO TRUE      09340099
093500                         INITIALIZE PC214-INTER-APPL-COMMAREA     09350099
093600                         MOVE ASC-NUMBER-OF-SELECTED-ITEMS        09360099
093700                                TO PC214-NUMBER-OF-SELECTED-ITEMS 09370099
093800                         MOVE ASC-NUMBER-OF-TS-ITEMS              09380099
093900                                      TO PC214-NUMBER-OF-TS-ITEMS 09390002
094000                         MOVE ASC-SEL-QUEUE-NAME                  09400099
094100                                           TO PC214-SEL-QUEUE-NAME09410002
094200                         MOVE ASC-OPER-NBR   TO PC214-OPER-UNT-ID 09420099
094210                         MOVE ASC-BUSN-DATE    TO PC214-BUSN-DATE 09421099
094430                         MOVE ASC-PRINTER-ID  TO PC214-PRINTER-ID 09443099
094500                         PERFORM 5000-PREPARE-SEL-QUEUE           09450099
094600                     ELSE                                         09460099
094700                         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN     09470099
094800                         SET DP030-OVERRIDE-GO TO TRUE            09480099
094900                         MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER 09490099
095000                         SET DP020-MSG-WARNING TO TRUE            09500099
095100                     END-IF                                       09510099
095110                 ELSE                                             09511099
095120                     SET PS-ERROR                                 09512099
095130                         DP020-MSG-FATAL         TO TRUE          09513099
095140                     MOVE PV-POHIST-DATE     TO DP020-MSG-TEXT    09514099
095141                     MOVE PC-TSYMSG-02874    TO DP020-MSG-NUMBER  09514199
095150                     MOVE -1                 TO MR-SELECTL (1)    09515099
095160                     SET DP030-SET-CURSOR-APPL-1 TO TRUE          09516099
095170                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09517099
095180                     SET DP030-OVERRIDE-GO TO TRUE                09518099
095200                 END-IF                                           09520099
095210             END-IF                                               09521099
095300                                                                  09530002
095400*                                                                 09540005
095500* F18 - UNITS WORKED BY PROCESS AREA                              09550005
095600         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              09560005
095700             IF PS-NO-ERROR                                       09570005
095800                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09580005
095900                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09590005
096000                     INITIALIZE PC214-INTER-APPL-COMMAREA         09600005
096100                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09610005
096200                                TO PC214-NUMBER-OF-SELECTED-ITEMS 09620005
096300                     MOVE ASC-NUMBER-OF-TS-ITEMS                  09630005
096400                                      TO PC214-NUMBER-OF-TS-ITEMS 09640005
096500                     MOVE ASC-SEL-QUEUE-NAME                      09650005
096600                                           TO PC214-SEL-QUEUE-NAME09660005
096700                     MOVE ASC-OPER-NBR   TO PC214-OPER-UNT-ID     09670099
096810                     MOVE ASC-BUSN-DATE    TO PC214-BUSN-DATE     09681085
096820                     MOVE ASC-FROM-DATE    TO PC214-FROM-DATE     09682084
096900                     MOVE ASC-TO-DATE      TO PC214-TO-DATE       09690084
096910                     MOVE ASC-FISCAL-WEEK  TO PC214-FISCAL-WEEK   09691084
096920                     MOVE ASC-FISCAL-MONTH TO PC214-FISCAL-MONTH  09692084
096930                     MOVE ASC-PRINTER-ID   TO PC214-PRINTER-ID    09693084
097000                     PERFORM 5000-PREPARE-SEL-QUEUE               09700005
097100                 ELSE                                             09710005
097200                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09720005
097300                     SET DP030-OVERRIDE-GO TO TRUE                09730005
097400                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     09740005
097500                     SET DP020-MSG-WARNING TO TRUE                09750005
097600                 END-IF                                           09760005
097700             END-IF                                               09770005
097800                                                                  09780005
097900* F22 - COMPARE PREVIOUS YEAR TO CURRENT YEAR                     09790005
098000         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              09800005
098100             IF PS-NO-ERROR                                       09810005
098200                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          09820005
098300                     SET ASC-USE-SELECTION-QUEUE TO TRUE          09830005
098400                     INITIALIZE PC214-INTER-APPL-COMMAREA         09840005
098500                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            09850005
098600                                TO PC214-NUMBER-OF-SELECTED-ITEMS 09860005
098700                     MOVE ASC-NUMBER-OF-TS-ITEMS                  09870005
098800                                      TO PC214-NUMBER-OF-TS-ITEMS 09880005
098900                     MOVE ASC-SEL-QUEUE-NAME                      09890005
099000                                           TO PC214-SEL-QUEUE-NAME09900005
099010                     MOVE ASC-OPER-NBR   TO PC214-OPER-UNT-ID     09901099
099020                     MOVE ASC-BUSN-DATE    TO PC214-BUSN-DATE     09902085
099030                     MOVE ASC-FROM-DATE    TO PC214-FROM-DATE     09903084
099040                     MOVE ASC-TO-DATE      TO PC214-TO-DATE       09904084
099050                     MOVE ASC-FISCAL-WEEK  TO PC214-FISCAL-WEEK   09905084
099060                     MOVE ASC-FISCAL-MONTH TO PC214-FISCAL-MONTH  09906084
099070                     MOVE ASC-PRINTER-ID   TO PC214-PRINTER-ID    09907084
099400                     PERFORM 5000-PREPARE-SEL-QUEUE               09940005
099500                 ELSE                                             09950005
099600                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         09960005
099700                     SET DP030-OVERRIDE-GO TO TRUE                09970005
099800                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     09980005
099900                     SET DP020-MSG-WARNING TO TRUE                09990005
100000                 END-IF                                           10000005
100100             END-IF                                               10010005
100200                                                                  10020005
100300* F23 - UNITS WORKED BY PROCESS GROUP                             10030005
100400         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              10040005
100500             IF PS-NO-ERROR                                       10050005
100600                 IF  ASC-NUMBER-OF-SELECTED-ITEMS > ZERO          10060005
100700                     SET ASC-USE-SELECTION-QUEUE TO TRUE          10070005
100800                     INITIALIZE PC214-INTER-APPL-COMMAREA         10080005
100900                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            10090005
101000                                TO PC214-NUMBER-OF-SELECTED-ITEMS 10100005
101100                     MOVE ASC-NUMBER-OF-TS-ITEMS                  10110005
101200                                      TO PC214-NUMBER-OF-TS-ITEMS 10120005
101300                     MOVE ASC-SEL-QUEUE-NAME                      10130005
101400                                           TO PC214-SEL-QUEUE-NAME10140005
101420                     MOVE ASC-BUSN-DATE    TO PC214-BUSN-DATE     10142085
101430                     MOVE ASC-FROM-DATE    TO PC214-FROM-DATE     10143084
101440                     MOVE ASC-TO-DATE      TO PC214-TO-DATE       10144084
101450                     MOVE ASC-FISCAL-WEEK  TO PC214-FISCAL-WEEK   10145084
101460                     MOVE ASC-FISCAL-MONTH TO PC214-FISCAL-MONTH  10146084
101470                     MOVE ASC-PRINTER-ID   TO PC214-PRINTER-ID    10147084
101800                     PERFORM 5000-PREPARE-SEL-QUEUE               10180005
101900                 ELSE                                             10190005
102000                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         10200005
102100                     SET DP030-OVERRIDE-GO TO TRUE                10210005
102200                     MOVE PC-TSYMSG-00057 TO DP020-MSG-NUMBER     10220005
102300                     SET DP020-MSG-WARNING TO TRUE                10230005
102400                 END-IF                                           10240005
102500             END-IF                                               10250005
102600                                                                  10260005
102700* F24 - PRINT A REPORT                                            10270005
102800         WHEN DP020-FK-LOCAL-FUNC-05 (DP020-SRC-AID)              10280005
102900             IF PS-NO-ERROR                                       10290005
103100                 SET ASC-USE-SELECTION-QUEUE TO TRUE              10310099
103200                 INITIALIZE PC214-INTER-APPL-COMMAREA             10320099
103300                 MOVE ASC-NUMBER-OF-SELECTED-ITEMS                10330099
103400                                TO PC214-NUMBER-OF-SELECTED-ITEMS 10340005
103500                 MOVE ASC-NUMBER-OF-TS-ITEMS                      10350099
103600                                      TO PC214-NUMBER-OF-TS-ITEMS 10360005
103700                 MOVE ASC-SEL-QUEUE-NAME   TO PC214-SEL-QUEUE-NAME10370099
103810                 MOVE ASC-OPER-NBR   TO PC214-OPER-UNT-ID         10381099
103820                 MOVE ASC-BUSN-DATE    TO PC214-BUSN-DATE         10382099
103830                 MOVE ASC-FROM-DATE    TO PC214-FROM-DATE         10383099
103840                 MOVE ASC-TO-DATE      TO PC214-TO-DATE           10384099
103850                 MOVE ASC-FISCAL-WEEK  TO PC214-FISCAL-WEEK       10385099
103860                 MOVE ASC-FISCAL-MONTH TO PC214-FISCAL-MONTH      10386099
103870                 MOVE ASC-PRINTER-ID   TO PC214-PRINTER-ID        10387099
104200                 PERFORM 5000-PREPARE-SEL-QUEUE                   10420099
104800             END-IF                                               10480099
105000                                                                  10500005
105100*                                                                 10510005
105200* F6 - FIRST PAGE                                                 10520002
105300         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  10530002
105400             MOVE +1               TO PV-TOP-ITEM                 10540002
105500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10550002
105600*                                                                 10560002
105700* F7 - PREVIOUS PAGE                                              10570002
105800         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   10580002
105900             PERFORM 2110-BROWSE-BACKWARD                         10590002
106000             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10600002
106100*                                                                 10610002
106200* F8 - NEXT PAGE                                                  10620002
106300         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   10630002
106400             PERFORM 2120-BROWSE-FORWARD                          10640002
106500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10650002
106600*                                                                 10660002
106700* ENTER KEY                                                       10670002
106800         WHEN DP020-SRC-AID = DP016-ENTER                         10680002
106900             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   10690002
107000             IF  PS-ERROR                                         10700002
107100                 CONTINUE                                         10710002
107200             ELSE                                                 10720002
107300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10730002
107400             END-IF                                               10740002
107500                                                                  10750002
107600         WHEN OTHER                                               10760002
107700             SET DP013-NO-ROLLBACK                                10770002
107800                 DP013-XCTL-DISPLAY-RESTART                       10780002
107900                 DP013-CICS-ABEND  TO TRUE                        10790002
108000             MOVE '2100-CHECK-FUNCTION-KEY'                       10800002
108100                                   TO DP013-PARAGRAPH             10810002
108200             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      10820002
108300                                   TO DP013-MESSAGE-TEXT (1)      10830002
108400             PERFORM DP013-0000-PROCESS-ABEND                     10840002
108500     END-EVALUATE.                                                10850002
108600*                                                                 10860002
108700*----------------------------------------------------------------*10870002
108800*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *10880002
108900*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *10890002
109000*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *10900002
109100*    MESSAGE.                                                    *10910002
109200*----------------------------------------------------------------*10920002
109300 2110-BROWSE-BACKWARD.                                            10930002
109400     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    10940002
109500         GIVING PV-TOP-ITEM.                                      10950002
109600*                                                                 10960002
109700     IF  ((PV-TOP-ITEM < +1)                                      10970002
109800       OR (PV-TOP-ITEM = +1))                                     10980002
109900         MOVE +1                   TO PV-TOP-ITEM                 10990002
110000*        -- TOP OF LIST --                                        11000002
110100         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            11010002
110200         SET DP020-MSG-INFORMATIONAL TO TRUE                      11020002
110300     END-IF.                                                      11030002
110400                                                                  11040002
110500*----------------------------------------------------------------*11050002
110600*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *11060002
110700*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *11070002
110800*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *11080002
110900*----------------------------------------------------------------*11090002
111000 2120-BROWSE-FORWARD.                                             11100002
111100                                                                  11110002
111200     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              11120002
111300         GIVING PV-TOP-ITEM.                                      11130002
111400     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   11140002
111500         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11150002
111600*        -- BOTTOM OF LIST --                                     11160002
111700         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            11170002
111800         SET DP020-MSG-INFORMATIONAL  TO TRUE                     11180002
111900     ELSE                                                         11190002
112000         COMPUTE PV-BOTTOM-ITEM =                                 11200002
112100             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 11210002
112200         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            11220002
112300*            -- BOTTOM OF LIST --                                 11230002
112400             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            11240002
112500             SET DP020-MSG-INFORMATIONAL TO TRUE                  11250002
112600         END-IF                                                   11260002
112700     END-IF.                                                      11270002
112800                                                                  11280002
112900*----------------------------------------------------------------*11290002
113000*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *11300002
113100*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *11310002
113200*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *11320002
113300*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *11330002
113400*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *11340002
113500*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *11350002
113600*----------------------------------------------------------------*11360002
113700 2130-CHECK-FOR-JUMP-BROWSE.                                      11370002
113800     SET PS-NO-ERROR               TO TRUE.                       11380002
113900     IF (ASC-START-ITEM-REQUEST = SPACE)                          11390002
114000         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             11400002
114100     ELSE                                                         11410002
114200         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     11420002
114300         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       11430002
114400         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     11440002
114500         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  11450002
114610         CALL DP010I-NUMERIC-EDIT-ROUTINE                         11461099
114620                         USING DP010I-NUMERIC-EDIT-AREA           11462099
114700                                                                  11470002
114800         IF  NOT DP010I-ERROR-DETECTED                            11480002
114900             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N11490002
115000             IF  ASC-START-ITEM-REQUEST-N > ZERO                  11500002
115100                 IF  ASC-START-ITEM-REQUEST-N >                   11510002
115200                                          ASC-NUMBER-OF-ITEMS-READ11520002
115300                     MOVE SPACE TO ASC-START-ITEM-REQUEST         11530002
115400                     COMPUTE PV-TOP-ITEM =                        11540002
115500                             ASC-NUMBER-OF-ITEMS-READ             11550002
115600                             - PC-ITEMS-PER-PANEL + 1             11560002
115700                     IF  PV-TOP-ITEM < +1                         11570002
115800                         MOVE +1   TO PV-TOP-ITEM                 11580002
115900                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11590002
116000                         SET DP020-MSG-INFORMATIONAL TO TRUE      11600002
116100                     END-IF                                       11610002
116200                 ELSE                                             11620002
116300                     MOVE ASC-START-ITEM-REQUEST-N TO PV-TOP-ITEM 11630002
116400                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      11640002
116500                     COMPUTE PV-BOTTOM-ITEM =                     11650002
116600                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     11660002
116700                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ11670002
116800*                        -- BOTTOM OF LIST --                     11680002
116900                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 11690002
117000                         SET DP020-MSG-INFORMATIONAL TO TRUE      11700002
117100                     END-IF                                       11710002
117200                 END-IF                                           11720002
117300             ELSE                                                 11730002
117400*                --- VALUE OUT OF RANGE ----                      11740002
117500                 MOVE PC-TSYMSG-00101  TO DP020-MSG-NUMBER        11750002
117600                 MOVE -1           TO ASTRTITL                    11760007
117700                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              11770002
117800                 MOVE DP015-REVERSE TO ASTRTITH                   11780007
117900                 MOVE DP015-RED    TO ASTRTITC                    11790007
118000                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           11800007
118100                 SET DP020-MSG-FATAL                              11810002
118200                     PS-ERROR        TO TRUE                      11820002
118300             END-IF                                               11830002
118400                                                                  11840002
118500         ELSE                                                     11850002
118600             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            11860002
118700             MOVE -1               TO ASTRTITL                    11870007
118800             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  11880002
118900             MOVE DP015-REVERSE    TO ASTRTITH                    11890007
119000             MOVE DP015-RED        TO ASTRTITC                    11900007
119100             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               11910007
119200             SET DP020-MSG-FATAL   TO TRUE                        11920002
119300             SET PS-ERROR          TO TRUE                        11930002
119400         END-IF                                                   11940002
119500     END-IF.                                                      11950002
119600                                                                  11960002
119700*----------------------------------------------------------------*11970002
119800*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *11980002
119900*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *11990002
120000*----------------------------------------------------------------*12000002
120100 2140-DESELECT-ALL-ITEMS.                                         12010002
120200     MOVE +1                       TO ASC-BLK-SUB.                12020002
120300                                                                  12030002
120400     PERFORM 2141-CLEAR-SELECTED-INDS                             12040002
120500         VARYING ASC-ITEM-SUB                                     12050002
120600         FROM 1 BY 1                                              12060002
120700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12070002
120800                                                                  12080002
120900     ADD +1                        TO ASC-BLK-SUB.                12090002
121000                                                                  12100002
121100     PERFORM 2141-CLEAR-SELECTED-INDS                             12110002
121200         VARYING ASC-ITEM-SUB                                     12120002
121300         FROM 1 BY 1                                              12130002
121400         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 12140002
121500                                                                  12150002
121600     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               12160002
121700                                   TO PV-LIST-ITEM-NUMBER.        12170002
121800                                                                  12180002
121900     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            12190002
122000         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    12200002
122100                                                                  12210002
122200     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     12220002
122300        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      12230002
122400         MOVE +1                   TO ASC-BLK-SUB                 12240002
122500                                                                  12250002
122600         PERFORM 5100-WRITE-TEMP-STORAGE                          12260002
122700         MOVE +2                   TO ASC-BLK-SUB                 12270002
122800         PERFORM 5100-WRITE-TEMP-STORAGE                          12280002
122900         MOVE +1                   TO ASC-BLK-SUB                 12290002
123000                                                                  12300002
123100         MOVE +1                   TO PV-BLOCK-NUMBER             12310002
123200                                                                  12320002
123300         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         12330002
123400             PV-FIRST-BLOCK-IN-ARRAY - 1                          12340002
123500                                                                  12350002
123600         PERFORM                                                  12360002
123700             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       12370002
123800                                                                  12380002
123900             PERFORM 4410-READ-TEMP-STORAGE                       12390002
124000                                                                  12400002
124100             PERFORM 2141-CLEAR-SELECTED-INDS                     12410002
124200                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 12420002
124300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12430002
124400                                                                  12440002
124500             PERFORM 5100-WRITE-TEMP-STORAGE                      12450002
124600                                                                  12460002
124700             ADD +1                TO PV-BLOCK-NUMBER             12470002
124800                                                                  12480002
124900         END-PERFORM                                              12490002
125000                                                                  12500002
125100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         12510002
125200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     12520002
125300                                                                  12530002
125400         PERFORM                                                  12540002
125500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       12550002
125600                   ASC-HIGHEST-BLOCK-WRITTEN                      12560002
125700                                                                  12570002
125800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          12580002
125900                                   TO PV-BLOCK-NUMBER             12590002
126000                                                                  12600002
126100             PERFORM 4410-READ-TEMP-STORAGE                       12610002
126200                                                                  12620002
126300             PERFORM 2141-CLEAR-SELECTED-INDS                     12630002
126400                 VARYING ASC-ITEM-SUB                             12640002
126500                 FROM 1 BY 1                                      12650002
126600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          12660002
126700                                                                  12670002
126800             PERFORM 5100-WRITE-TEMP-STORAGE                      12680002
126900                                                                  12690002
127000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      12700002
127100         END-PERFORM                                              12710002
127200                                                                  12720002
127300         MOVE PV-FIRST-BLOCK-IN-ARRAY TO PV-BLOCK-NUMBER          12730002
127400         PERFORM 4410-READ-TEMP-STORAGE                           12740002
127500     END-IF.                                                      12750002
127600                                                                  12760002
127700                                                                  12770002
127800     MOVE +0                      TO ASC-NUMBER-OF-SELECTED-ITEMS.12780002
127900     MOVE +0                      TO ASC-START-OF-SELECTED-RANGE. 12790002
128000     MOVE +0                      TO ASC-END-OF-SELECTED-RANGE.   12800002
128100                                                                  12810002
128200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        12820002
128300                                                                  12830002
128400*----------------------------------------------------------------*12840002
128500*    MARK EACH ITEM AS BEING NOT SELECTED.                       *12850002
128600*----------------------------------------------------------------*12860002
128700 2141-CLEAR-SELECTED-INDS.                                        12870002
128800                                                                  12880002
128900     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           12890002
129000             NOT EQUAL ZERO                                       12900002
129100         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12910002
129200             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          12920002
129300                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    12930002
129400                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  12940002
129500                                   TO TRUE                        12950002
129600         END-IF                                                   12960002
129700     END-IF.                                                      12970002
129800                                                                  12980002
129900*----------------------------------------------------------------*12990002
130000*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTIO SWITCH  *13000002
130100*  FOR ALL ITEMS.                                                *13010002
130200*----------------------------------------------------------------*13020002
130300 2150-SELECT-ALL-ITEMS.                                           13030002
130400                                                                  13040002
130500     MOVE +1                       TO ASC-BLK-SUB.                13050002
130600                                                                  13060002
130700     PERFORM 2151-SET-SELECTED-INDS                               13070002
130800         VARYING ASC-ITEM-SUB                                     13080002
130900         FROM 1 BY 1                                              13090002
131000         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13100002
131100                                                                  13110002
131200     ADD +1                        TO ASC-BLK-SUB.                13120002
131300                                                                  13130002
131400     PERFORM 2151-SET-SELECTED-INDS                               13140002
131500         VARYING ASC-ITEM-SUB                                     13150002
131600         FROM 1 BY 1                                              13160002
131700         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 13170002
131800                                                                  13180002
131900     MOVE ASC-LIST-ITEM-NUMBER(1 1) TO PV-LIST-ITEM-NUMBER.       13190002
132000                                                                  13200002
132100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            13210002
132200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    13220002
132300                                                                  13230002
132400     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            13240002
132500         MOVE +1                   TO ASC-BLK-SUB                 13250002
132600                                                                  13260002
132700         PERFORM 5100-WRITE-TEMP-STORAGE                          13270002
132800         MOVE +2                   TO ASC-BLK-SUB                 13280002
132900         PERFORM 5100-WRITE-TEMP-STORAGE                          13290002
133000         MOVE +1                   TO ASC-BLK-SUB                 13300002
133100         MOVE +1                   TO PV-BLOCK-NUMBER             13310002
133200     END-IF.                                                      13320002
133300*                                                                 13330002
133400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     13340002
133500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    13350002
133600         MOVE +1                   TO ASC-BLK-SUB                 13360002
133700                                                                  13370002
133800         PERFORM 5100-WRITE-TEMP-STORAGE                          13380002
133900         MOVE +2                   TO ASC-BLK-SUB                 13390002
134000         PERFORM 5100-WRITE-TEMP-STORAGE                          13400002
134100         MOVE +1                   TO ASC-BLK-SUB                 13410002
134200         MOVE +1                   TO PV-BLOCK-NUMBER             13420002
134300                                                                  13430002
134400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         13440002
134500             PV-FIRST-BLOCK-IN-ARRAY - 1                          13450002
134600                                                                  13460002
134700         PERFORM                                                  13470002
134800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       13480002
134900                                                                  13490002
135000             PERFORM 4410-READ-TEMP-STORAGE                       13500002
135100                                                                  13510002
135200             PERFORM 2151-SET-SELECTED-INDS                       13520002
135300                 VARYING ASC-ITEM-SUB                             13530002
135400                 FROM 1 BY 1                                      13540002
135500                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13550002
135600                                                                  13560002
135700             PERFORM 5100-WRITE-TEMP-STORAGE                      13570002
135800                                                                  13580002
135900             ADD +1                TO PV-BLOCK-NUMBER             13590002
136000                                                                  13600002
136100         END-PERFORM                                              13610002
136200                                                                  13620002
136300         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         13630002
136400             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     13640002
136500                                                                  13650002
136600         PERFORM                                                  13660002
136700             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       13670002
136800                   ASC-HIGHEST-BLOCK-WRITTEN                      13680002
136900                                                                  13690002
137000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          13700002
137100                                   TO PV-BLOCK-NUMBER             13710002
137200                                                                  13720002
137300             PERFORM 4410-READ-TEMP-STORAGE                       13730002
137400                                                                  13740002
137500             PERFORM 2151-SET-SELECTED-INDS                       13750002
137600                 VARYING ASC-ITEM-SUB                             13760002
137700                 FROM 1 BY 1                                      13770002
137800                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          13780002
137900                                                                  13790002
138000             PERFORM 5100-WRITE-TEMP-STORAGE                      13800002
138100                                                                  13810002
138200             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      13820002
138300                                                                  13830002
138400         END-PERFORM                                              13840002
138500                                                                  13850002
138600         MOVE PV-FIRST-BLOCK-IN-ARRAY                             13860002
138700                                   TO PV-BLOCK-NUMBER             13870002
138800                                                                  13880002
138900         PERFORM 4410-READ-TEMP-STORAGE                           13890002
139000     END-IF.                                                      13900002
139100                                                                  13910002
139200                                                                  13920002
139300     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             13930002
139400                       ASC-NUMBER-OF-SELECTED-ITEMS.              13940002
139500                                                                  13950002
139600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        13960002
139700                                                                  13970002
139800*----------------------------------------------------------------*13980002
139900*    MARK EACH ITEM AS BEING SELECTED.                           *13990002
140000*----------------------------------------------------------------*14000002
140100 2151-SET-SELECTED-INDS.                                          14010002
140200                                                                  14020002
140300     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           14030002
140400             NOT EQUAL ZERO                                       14040002
140500         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14050002
140600             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             14060002
140700                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        14070002
140800                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  14080002
140900                               TO  TRUE                           14090002
141000         END-IF                                                   14100002
141100     END-IF.                                                      14110002
141200                                                                  14120002
141300******************************************************************14130002
141400** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **14140002
141500** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **14150002
141600******************************************************************14160002
141700 2200-MOVE-SCREEN-TO-COMMAREA.                                    14170002
141800                                                                  14180002
141900     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             14190002
142000     MOVE +1                       TO PV-SUB.                     14200002
142100*                                                                 14210002
142200     PERFORM 3100-SET-SUBSCRIPTS.                                 14220002
142300     IF  ASTRTITL > ZERO                                          14230007
142400         MOVE ASTRTITI        TO ASC-START-ITEM-REQUEST           14240007
142500     ELSE                                                         14250002
142600         IF  ASTRTITF = DP015-ERASE-EOF                           14260007
142700             INITIALIZE ASC-START-ITEM-REQUEST                    14270002
142800         END-IF                                                   14280002
142900     END-IF.                                                      14290002
143000                                                                  14300002
143100     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          14310002
143200         VARYING PV-SUB                                           14320002
143300         FROM 1 BY 1                                              14330002
143400         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      14340002
143500******************************************************************14350002
143600** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**14360002
143700******************************************************************14370002
143800 2210-MOVE-LINES-TO-COMMAREA.                                     14380002
143900     IF  MR-SELECTL (PV-SUB) > ZERO                               14390002
144000         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14400002
144100         MOVE MR-SELECTI (PV-SUB)                                 14410002
144200                                   TO ASC-TEMP-SELECTED-SW        14420002
144300                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14430002
144400     ELSE                                                         14440002
144500         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                14450002
144600                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14460002
144700                 MOVE SPACE        TO ASC-TEMP-SELECTED-SW        14470002
144800                                 (ASC-BLK-SUB, ASC-ITEM-SUB)      14480002
144900         END-IF                                                   14490002
145000     END-IF.                                                      14500002
145100     ADD +1                        TO ASC-ITEM-SUB.               14510002
145200     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14520002
145300         ADD +1                    TO ASC-BLK-SUB                 14530002
145400         MOVE +1                   TO ASC-ITEM-SUB                14540002
145500     END-IF.                                                      14550002
145501                                                                  14550199
145502******************************************************************14550299
145503** MAKE SURE THERE IS PO DATA FOR THE DATE REQUESTED              14550399
145504******************************************************************14550499
145505 2300-CHECK-PO-HISTORY-DATE.                                      14550599
145506     MOVE ASC-BUSN-YY  TO  PV-CMPR-YY.                            14550699
145507     MOVE ASC-BUSN-MM  TO  PV-CMPR-MM.                            14550799
145508     MOVE ASC-BUSN-DD  TO  PV-CMPR-DD.                            14550899
145510     EXEC SQL                                                     14551099
145520         SELECT CURRENT DATE - FUNC_QTY DAYS                      14552099
145530           INTO   :PV-POHIST-DATE                                 14553099
145540           FROM  TKRPRPM                                          14554099
145550          WHERE SYS_PRC_FUNC_CDE = 'POHIST'                       14555099
145560      END-EXEC.                                                   14556099
145570                                                                  14557099
145580       EVALUATE TRUE                                              14558099
145590          WHEN SQLCODE = +0                                       14559099
145591              IF PV-COMPARE-DATE >= PV-POHIST-DATE                14559199
145592                 SET PS-VALID-POHIST-DATE TO TRUE                 14559299
145593             ELSE                                                 14559399
145594                 SET PS-INVALID-POHIST-DATE TO TRUE               14559499
145595             END-IF                                               14559599
145596          WHEN OTHER                                              14559699
145597              MOVE '2300-CHECK-PO-HISTORY-DAT' TO DP013-PARAGRAPH 14559799
145599              MOVE 'CHECKING PARM TABLE' TO DP013-MESSAGE-TEXT (1)14559999
145600              MOVE SQLCA   TO DP013-SQLCA                         14560099
145601              MOVE 'TKRPRPM ' TO DP013-DB2-TABLE-NAME (1)         14560199
145602              SET DP013-DB2-ABEND                                 14560299
145603                  DP013-XCTL-DISPLAY-RESTART TO TRUE              14560399
145604              PERFORM DP013-0000-PROCESS-ABEND                    14560499
145605      END-EVALUATE.                                               14560599
145606                                                                  14560699
145610******************************************************************14561002
145700** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **14570002
145800** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **14580002
145900******************************************************************14590002
146000 3000-EDIT-DATA-IN-COMMAREA.                                      14600002
146100     SET PS-NO-ERROR               TO TRUE.                       14610002
146200     PERFORM 3200-RESET-ATTRIBUTES.                               14620002
146300     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     14630002
146400                                                                  14640002
146500**                                                                14650002
146600* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              14660002
146700* EDITTING IS DONE FROM THE BOTTOM UP.                            14670002
146800**                                                                14680002
146900     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       14690002
147000         ASC-ITEMS-DISPLAYED - 1.                                 14700002
147100     PERFORM 3100-SET-SUBSCRIPTS.                                 14710002
147200                                                                  14720002
147300     IF  PS-NO-ERROR                                              14730002
147400         PERFORM 3005-EDIT-COMMAREA-BLOCKS                        14740002
147500     END-IF.                                                      14750002
147600*                                                                 14760002
147700     IF  PS-NO-ERROR                                              14770002
147800         PERFORM 3400-CHECK-RANGE-SEQUENCE                        14780002
147900     END-IF.                                                      14790002
148000*                                                                 14800002
148100     IF  ((PS-NO-ERROR)                                           14810002
148200       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   14820002
148300       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    14830002
148400             PERFORM 3500-MARK-RANGE-AS-SELECTED                  14840002
148500     END-IF.                                                      14850002
148600                                                                  14860002
148700*----------------------------------------------------------------*14870002
148800*   3005-EDIT-COMMAREA-BLOCKS                                    *14880002
148900*----------------------------------------------------------------*14890002
149000 3005-EDIT-COMMAREA-BLOCKS.                                       14900002
149100     MOVE +1                       TO PV-BLOCK-NUMBER.            14910002
149200     MOVE +1                       TO ASC-BLK-SUB.                14920002
149300     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               14930002
149400                                                                  14940002
149500     COMPUTE PV-BLOCK-NUMBER  =                                   14950002
149600        1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /                 14960002
149700            PC-ITEMS-PER-PANEL.                                   14970002
149800                                                                  14980002
149900     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          14990002
150000                                                                  15000002
150100     PERFORM                                                      15010002
150200       UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN          15020002
150300          OR PS-ERROR                                             15030002
150400          OR PS-BLOCK-ERROR                                       15040002
150500                                                                  15050002
150600             COMPUTE PV-ITEMS-HOLD  =                             15060002
150700                     ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +        15070002
150800                     PC-ITEMS-PER-PANEL - 1                       15080002
150900                                                                  15090002
151000             IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ       15100002
151100                 SUBTRACT  ASC-NUMBER-OF-ITEMS-READ               15110002
151200                     FROM  PV-ITEMS-HOLD                          15120002
151300                   GIVING  PV-ITEMS-DIFF                          15130002
151400                 SUBTRACT  PV-ITEMS-DIFF                          15140002
151500                     FROM  PC-ITEMS-PER-PANEL                     15150002
151600                   GIVING  PV-ITEMS-HOLD                          15160002
151700                     MOVE  PV-ITEMS-HOLD  TO  PV-SUB              15170002
151800                                              ASC-ITEM-SUB        15180002
151900                                              ASC-ITEMS-DISPLAYED 15190002
152000             ELSE                                                 15200002
152100                 MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB              15210002
152200                 MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB        15220002
152300             END-IF                                               15230002
152400                                                                  15240002
152500             PERFORM 3300-EDIT-SELECTIONS                         15250002
152600                     VARYING PV-SUB                               15260002
152700                        FROM PV-SUB BY -1                         15270002
152800                       UNTIL PV-SUB < +1                          15280002
152900                                                                  15290002
153000             MOVE +1               TO ASC-BLK-SUB                 15300002
153100                                                                  15310002
153200             PERFORM 5105-REWRITE-ASC-LISTQ                       15320002
153300                                                                  15330002
153400             MOVE +1                TO ASC-BLK-SUB                15340002
153500                                                                  15350002
153600             IF  PS-BLOCK-ERROR                                   15360002
153700                 SET  PS-ERROR     TO TRUE                        15370002
153800                 MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)        15380002
153900                                   TO PV-TOP-ITEM                 15390002
154000             ELSE                                                 15400002
154100                 ADD  +1           TO PV-BLOCK-NUMBER             15410002
154200                 IF  PV-BLOCK-NUMBER >                            15420002
154300                     ASC-HIGHEST-BLOCK-WRITTEN                    15430002
154400                     MOVE +2       TO ASC-BLK-SUB                 15440002
154500                     PERFORM 4410-READ-TEMP-STORAGE               15450002
154600                     MOVE +1       TO ASC-BLK-SUB                 15460002
154700                 ELSE                                             15470002
154800                     PERFORM 4410-READ-TEMP-STORAGE               15480002
154900                     ADD  +1        TO PV-BLOCK-NUMBER            15490002
155000                     MOVE +2        TO ASC-BLK-SUB                15500002
155100                     PERFORM 4410-READ-TEMP-STORAGE               15510002
155200                     SUBTRACT +1  FROM PV-BLOCK-NUMBER            15520002
155300                     MOVE +1        TO ASC-BLK-SUB                15530002
155400                 END-IF                                           15540002
155500             END-IF                                               15550002
155600     END-PERFORM.                                                 15560002
155700                                                                  15570002
155800     IF  PV-ORIGINAL-BLOCK  = +1    OR                            15580002
155900         PS-ERROR                   OR                            15590002
156000         PS-BLOCK-ERROR                                           15600002
156100         CONTINUE                                                 15610002
156200     ELSE                                                         15620002
156300         MOVE +1                 TO PV-BLOCK-NUMBER               15630002
156400         MOVE +1                 TO ASC-BLK-SUB                   15640002
156500         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  15650002
156600         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           15660002
156700         PERFORM 4410-READ-TEMP-STORAGE                           15670002
156800                                                                  15680002
156900         PERFORM                                                  15690002
157000           UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK              15700002
157100              OR PS-ERROR                                         15710002
157200              OR PS-BLOCK-ERROR                                   15720002
157300                                                                  15730002
157400                 COMPUTE PV-ITEMS-HOLD  =                         15740002
157500                         ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +    15750002
157600                         PC-ITEMS-PER-PANEL - 1                   15760002
157700                                                                  15770002
157800                 IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ     15780002
157900                     SUBTRACT  ASC-NUMBER-OF-ITEMS-READ           15790002
158000                         FROM  PV-ITEMS-HOLD                      15800002
158100                       GIVING  PV-ITEMS-DIFF                      15810002
158200                     SUBTRACT  PV-ITEMS-DIFF                      15820002
158300                         FROM  PC-ITEMS-PER-PANEL                 15830002
158400                       GIVING  PV-ITEMS-HOLD                      15840002
158500                         MOVE  PV-ITEMS-HOLD TO PV-SUB            15850002
158600                                                ASC-ITEM-SUB      15860002
158700                                               ASC-ITEMS-DISPLAYED15870002
158800                 ELSE                                             15880002
158900                     MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB          15890002
159000                     MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB    15900002
159100                 END-IF                                           15910002
159200                                                                  15920002
159300                 PERFORM 3300-EDIT-SELECTIONS                     15930002
159400                         VARYING PV-SUB                           15940002
159500                            FROM PV-SUB BY -1                     15950002
159600                           UNTIL PV-SUB < +1                      15960002
159700                                                                  15970002
159800                 MOVE +1               TO ASC-BLK-SUB             15980002
159900                                                                  15990002
160000                 PERFORM 5105-REWRITE-ASC-LISTQ                   16000002
160100                                                                  16010002
160200                 MOVE +1                TO ASC-BLK-SUB            16020002
160300                                                                  16030002
160400                 IF  PS-BLOCK-ERROR                               16040002
160500                     SET  PS-ERROR     TO TRUE                    16050002
160600                     MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)    16060002
160700                                       TO PV-TOP-ITEM             16070002
160800                 ELSE                                             16080002
160900                     ADD  +1            TO PV-BLOCK-NUMBER        16090002
161000                     IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK      16100002
161100                         MOVE +2        TO ASC-BLK-SUB            16110002
161200                         PERFORM 4410-READ-TEMP-STORAGE           16120002
161300                         MOVE +1        TO ASC-BLK-SUB            16130002
161400                     ELSE                                         16140002
161500                         PERFORM 4410-READ-TEMP-STORAGE           16150002
161600                         ADD  +1        TO PV-BLOCK-NUMBER        16160002
161700                         MOVE +2        TO ASC-BLK-SUB            16170002
161800                         PERFORM 4410-READ-TEMP-STORAGE           16180002
161900                         SUBTRACT +1  FROM PV-BLOCK-NUMBER        16190002
162000                         MOVE +1        TO ASC-BLK-SUB            16200002
162100                     END-IF                                       16210002
162200                 END-IF                                           16220002
162300     END-PERFORM.                                                 16230002
162400                                                                  16240002
162500*----------------------------------------------------------------*16250002
162600*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *16260002
162700*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*16270002
162800*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *16280002
162900*                                                                *16290002
163000*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *16300002
163100*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *16310002
163200*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *16320002
163300*    US IN THE 2ND BLOCK OF THE ARRAY.                           *16330002
163400*----------------------------------------------------------------*16340002
163500 3100-SET-SUBSCRIPTS.                                             16350002
163600                                                                  16360002
163700     COMPUTE ASC-ITEM-SUB =                                       16370002
163800         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        16380002
163900                                                                  16390002
164000     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         16400002
164100         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            16410002
164200         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               16420002
164300     ELSE                                                         16430002
164400         MOVE +1                     TO ASC-BLK-SUB               16440002
164500     END-IF.                                                      16450002
164600******************************************************************16460002
164700** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **16470002
164800******************************************************************16480002
164900 3200-RESET-ATTRIBUTES.                                           16490002
165000     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   16500007
165100     MOVE DP015-GREEN              TO ASTRTITC.                   16510007
165200     MOVE DP015-UNDERLINE          TO ASTRTITH.                   16520007
165300                                                                  16530002
165400     PERFORM                                                      16540002
165500         VARYING PV-SUB                                           16550002
165600         FROM 1 BY 1                                              16560002
165700         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        16570002
165800             MOVE DP015-UNP-ALP-NOR-OFF TO MR-SELECTA (PV-SUB)    16580002
165900             MOVE DP015-GREEN         TO MR-SELECTC (PV-SUB)      16590002
166000             MOVE DP015-UNDERLINE     TO MR-SELECTH (PV-SUB)      16600002
166100     END-PERFORM.                                                 16610002
166200                                                                  16620002
166300******************************************************************16630002
166400** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **16640002
166500** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **16650002
166600** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **16660002
166700** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **16670002
166800******************************************************************16680002
166900 3300-EDIT-SELECTIONS.                                            16690002
167000     EVALUATE TRUE                                                16700002
167100         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16710002
167200             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         16720002
167300                 CONTINUE                                         16730002
167400         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         16740002
167500             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        16750002
167600                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   16760002
167700                 MOVE ASC-TEMP-SELECTED-SW                        16770002
167800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16780002
167900                                TO ASC-SELECTED-SW                16790002
168000                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16800002
168100             END-IF                                               16810002
168200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     16820002
168300                 = SPACE                                          16830002
168400             EVALUATE TRUE                                        16840002
168500                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       16850002
168600                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS16860002
168700                     MOVE SPACE TO ASC-SELECTED-SW                16870002
168800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16880002
168900                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        16890002
169000                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    16900002
169100                     MOVE SPACE TO ASC-SELECTED-SW                16910002
169200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16920002
169300                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          16930002
169400                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      16940002
169500                     MOVE SPACE TO ASC-SELECTED-SW                16950002
169600                                      (ASC-BLK-SUB ASC-ITEM-SUB)  16960002
169700             END-EVALUATE                                         16970002
169800         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           16980002
169900             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            16990002
170000                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17000002
170100             END-IF                                               17010002
170200             PERFORM 3310-EDIT-RANGE                              17020002
170300         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             17030002
170400             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17040002
170500                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    17050002
170600             END-IF                                               17060002
170700             PERFORM 3310-EDIT-RANGE                              17070002
170800         WHEN OTHER                                               17080002
170900             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           17090002
171000             SET DP020-MSG-FATAL    TO TRUE                       17100002
171100             MOVE -1                TO MR-SELECTL (PV-SUB)        17110002
171200             SET DP030-SET-CURSOR-APPL-1                          17120002
171300                                    TO TRUE                       17130002
171400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        17140002
171500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        17150002
171600             SET PS-ERROR TO TRUE                                 17160002
171700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            17170002
171800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     17180002
171900                 MOVE SPACE         TO ASC-SELECTED-SW            17190002
172000                                        (ASC-BLK-SUB ASC-ITEM-SUB)17200002
172100             END-IF                                               17210002
172200     END-EVALUATE.                                                17220002
172300                                                                  17230002
172400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 17240002
172500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               17250002
172600     IF  ASC-ITEM-SUB < 1                                         17260002
172700         SUBTRACT +1 FROM ASC-BLK-SUB                             17270002
172800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                17280002
172900     END-IF.                                                      17290002
173000                                                                  17300002
173100******************************************************************17310002
173200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **17320002
173300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **17330002
173400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**17340002
173500** THE ENDING.                                                  **17350002
173600******************************************************************17360002
173700 3310-EDIT-RANGE.                                                 17370002
173800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                17380002
173900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   17390002
174000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)17400002
174100                                   TO ASC-SELECTED-SW             17410002
174200                                        (ASC-BLK-SUB ASC-ITEM-SUB)17420002
174300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 17430002
174400         ELSE                                                     17440002
174500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     17450002
174600                 CONTINUE                                         17460002
174700             ELSE                                                 17470002
174800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        17480002
174900                 MOVE PC-TSYMSG-00054                             17490002
175000                                       TO DP020-MSG-NUMBER        17500002
175100                 MOVE -1               TO MR-SELECTL (PV-SUB)     17510002
175200                 MOVE DP015-RED        TO MR-SELECTC (PV-SUB)     17520002
175300                 MOVE DP015-UNDERLINE  TO MR-SELECTH (PV-SUB)     17530002
175400                 SET DP020-MSG-FATAL                              17540002
175500                     DP030-SET-CURSOR-APPL-1                      17550002
175600                     PS-ERROR          TO TRUE                    17560002
175700             END-IF                                               17570002
175800         END-IF                                                   17580002
175900     ELSE                                                         17590002
176000         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     17600002
176100             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 17610002
176200                                   TO ASC-SELECTED-SW             17620002
176300                                     (ASC-BLK-SUB ASC-ITEM-SUB)   17630002
176400             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   17640002
176500         ELSE                                                     17650002
176600             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       17660002
176700                 CONTINUE                                         17670002
176800             ELSE                                                 17680002
176900*                -- ONLY ONE END-OF-RANGE ALLOWED --              17690002
177000                 MOVE PC-TSYMSG-00055                             17700002
177100                                        TO DP020-MSG-NUMBER       17710002
177200                 MOVE -1                TO MR-SELECTL (PV-SUB)    17720002
177300                 SET DP020-MSG-FATAL                              17730002
177400                     DP030-SET-CURSOR-APPL-1                      17740002
177500                     PS-ERROR           TO TRUE                   17750002
177600             END-IF                                               17760002
177700         END-IF                                                   17770002
177800     END-IF.                                                      17780002
177900*                                                                 17790002
178000******************************************************************17800002
178100** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **17810002
178200** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **17820002
178300******************************************************************17830002
178400 3400-CHECK-RANGE-SEQUENCE.                                       17840002
178500     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       17850002
178600       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      17860002
178700       AND  ASC-START-OF-SELECTED-RANGE >                         17870002
178800                                         ASC-END-OF-SELECTED-RANGE17880002
178900*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                17890002
179000         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 17900002
179100         SET DP020-MSG-FATAL TO TRUE                              17910002
179200         SET PS-ERROR TO TRUE                                     17920002
179300         PERFORM 3410-POSITION-AT-ERROR                           17930002
179400     END-IF.                                                      17940002
179500******************************************************************17950002
179600** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **17960002
179700** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **17970002
179800** SHOULD BE POSITIONED ON A RANGE ERROR.                       **17980002
179900******************************************************************17990002
180000 3410-POSITION-AT-ERROR.                                          18000002
180100     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       18010002
180200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 18020002
180300                    - PV-TOP-ITEM + 1.                            18030002
180400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18040002
180500         CONTINUE                                                 18050002
180600     ELSE                                                         18060002
180700         MOVE -1                   TO MR-SELECTL (PV-SUB)         18070002
180800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18080002
180900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18090002
181000     END-IF.                                                      18100002
181100*                                                                 18110002
181200     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   18120002
181300                    - PV-TOP-ITEM + 1.                            18130002
181400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      18140002
181500         CONTINUE                                                 18150002
181600     ELSE                                                         18160002
181700         MOVE -1                   TO MR-SELECTL (PV-SUB)         18170002
181800         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         18180002
181900         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         18190002
182000     END-IF.                                                      18200002
182100                                                                  18210002
182200*----------------------------------------------------------------*18220002
182300*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *18230002
182400*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *18240002
182500*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *18250002
182600*----------------------------------------------------------------*18260002
182700 3500-MARK-RANGE-AS-SELECTED.                                     18270002
182800     MOVE +1                       TO  ASC-BLK-SUB.               18280002
182900     PERFORM 3510-MARK-SELECTED-INDS                              18290002
183000         VARYING ASC-ITEM-SUB                                     18300002
183100         FROM 1 BY 1                                              18310002
183200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18320002
183300                                                                  18330002
183400     ADD +1                        TO ASC-BLK-SUB.                18340002
183500     PERFORM 3510-MARK-SELECTED-INDS                              18350002
183600         VARYING ASC-ITEM-SUB                                     18360002
183700         FROM 1 BY 1                                              18370002
183800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 18380002
183900                                                                  18390002
184000     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               18400002
184100                                   TO  PV-LIST-ITEM-NUMBER.       18410002
184200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            18420002
184300         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         18430002
184400               PC-ITEMS-PER-PANEL).                               18440002
184500                                                                  18450002
184600     MOVE ASC-START-OF-SELECTED-RANGE                             18460002
184700                                   TO PV-START-OF-SELECTED-RANGE. 18470002
184800     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            18480002
184900         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  18490002
185000               PC-ITEMS-PER-PANEL).                               18500002
185100                                                                  18510002
185200     MOVE ASC-END-OF-SELECTED-RANGE                               18520002
185300                                   TO  PV-END-OF-SELECTED-RANGE.  18530002
185400     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             18540002
185500         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    18550002
185600               PC-ITEMS-PER-PANEL).                               18560002
185700     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             18570002
185800         PV-FIRST-BLOCK-IN-ARRAY + 1.                             18580002
185900                                                                  18590002
186000     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    18600002
186100        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        18610002
186200         MOVE +1                   TO ASC-BLK-SUB                 18620002
186300         PERFORM 5100-WRITE-TEMP-STORAGE                          18630002
186400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         18640002
186500             PV-FIRST-BLOCK-IN-ARRAY - 1                          18650002
186600                                                                  18660002
186700         PERFORM                                                  18670002
186800             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      18680002
186900                   PV-PREV-BLOCK-IN-ARRAY                         18690002
187000             MOVE PV-FIRST-BLOCK-IN-RANGE                         18700002
187100                                   TO PV-BLOCK-NUMBER             18710002
187200             PERFORM 4410-READ-TEMP-STORAGE                       18720002
187300             PERFORM 3510-MARK-SELECTED-INDS                      18730002
187400                 VARYING ASC-ITEM-SUB                             18740002
187500                 FROM 1 BY 1                                      18750002
187600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18760002
187700             PERFORM 5100-WRITE-TEMP-STORAGE                      18770002
187800             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     18780002
187900         END-PERFORM                                              18790002
188000                                                                  18800002
188100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         18810002
188200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     18820002
188300         PERFORM                                                  18830002
188400             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       18840002
188500                   PV-LAST-BLOCK-IN-RANGE                         18850002
188600             MOVE PV-NEXT-BLOCK-IN-ARRAY                          18860002
188700                                   TO PV-BLOCK-NUMBER             18870002
188800             PERFORM 4410-READ-TEMP-STORAGE                       18880002
188900             PERFORM 3510-MARK-SELECTED-INDS                      18890002
189000                 VARYING ASC-ITEM-SUB                             18900002
189100                 FROM 1 BY 1                                      18910002
189200                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          18920002
189300             PERFORM 5100-WRITE-TEMP-STORAGE                      18930002
189400             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      18940002
189500         END-PERFORM                                              18950002
189600                                                                  18960002
189700         MOVE PV-FIRST-BLOCK-IN-ARRAY                             18970002
189800                                   TO PV-BLOCK-NUMBER             18980002
189900         PERFORM 4410-READ-TEMP-STORAGE                           18990002
190000     END-IF.                                                      19000002
190100                                                                  19010002
190200     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 19020002
190300                                      ASC-END-OF-SELECTED-RANGE.  19030002
190400                                                                  19040002
190500*----------------------------------------------------------------*19050002
190600* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *19060002
190700*----------------------------------------------------------------*19070002
190800 3510-MARK-SELECTED-INDS.                                         19080002
190900                                                                  19090002
191000     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19100002
191100                                ASC-ITEM-SUB) >                   19110002
191200         ASC-START-OF-SELECTED-RANGE)                             19120002
191300     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         19130002
191400                                ASC-ITEM-SUB) =                   19140002
191500         ASC-START-OF-SELECTED-RANGE)                             19150002
191600                                                                  19160002
191700         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19170002
191800                                    ASC-ITEM-SUB) <               19180002
191900             ASC-END-OF-SELECTED-RANGE)                           19190002
192000         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     19200002
192100                                    ASC-ITEM-SUB) =               19210002
192200             ASC-END-OF-SELECTED-RANGE)                           19220002
192300                                                                  19230002
192400             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          19240002
192500                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   19250002
192600                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   19260002
192700                               TO TRUE                            19270002
192800                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              19280002
192900                               TO TRUE                            19290002
193000                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    19300002
193100             END-IF                                               19310002
193200         END-IF                                                   19320002
193300     END-IF.                                                      19330002
193400                                                                  19340002
193500*----------------------------------------------------------------*19350002
193600*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *19360002
193700*    INITIALIZE ALL COUNTERS AND FLAGS.                          *19370002
193800*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *19380002
193900*    DISPLAY THE PANEL TO USER.                                  *19390002
194000*----------------------------------------------------------------*19400002
194100 4000-BUILD-INITIAL-PANEL.                                        19410002
194200                                                                  19420002
194300     INITIALIZE        ASC-BLOCK-ENTRIES (1)                      19430006
194400                       ASC-BLOCK-ENTRIES (2).                     19440006
194500     MOVE +1                   TO ASC-BLK-SUB.                    19450006
194600     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           19460006
194700                                                                  19470002
194800     MOVE +0           TO ASC-ITEM-SUB                            19480006
194900                          ASC-NUMBER-OF-ITEMS-READ                19490006
195000                          ASC-NUMBER-OF-SELECTED-ITEMS            19500006
195100                          ASC-HIGHEST-BLOCK-WRITTEN               19510006
195200                          ASC-START-OF-SELECTED-RANGE             19520006
195300                          ASC-END-OF-SELECTED-RANGE               19530006
195400                          ASC-ITEM-AT-TOP-OF-PANEL.               19540006
195500                                                                  19550006
195600     PERFORM 4005-CALC-TOTAL-AMOUNTS.                             19560006
195700     PERFORM 4100-PREPARE-CURSOR.                                 19570002
195800     PERFORM 4010-OPEN-CURSOR.                                    19580002
195900     PERFORM 4300-READ-ITEMS-FROM-DB.                             19590002
196000     PERFORM 4020-CLOSE-CURSOR.                                   19600002
196100                                                                  19610002
196200     MOVE +1                   TO  PV-TOP-ITEM.                   19620002
196300*    IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          19630099
196400*        SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    19640099
196500*        SET DP020-MSG-FATAL   TO  TRUE                           19650099
196600*        MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               19660099
196700*    ELSE                                                         19670099
196800         MOVE -1               TO MR-SELECTL (1)                  19680002
196900         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      19690002
197000         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                    19700099
197100*    END-IF.                                                      19710099
197200                                                                  19720002
197300*----------------------------------------------------------------*19730006
197400*    CALCULATE COMPANY TOTALS FOR SCREEN HEADER FIELDS.           19740006
197500*----------------------------------------------------------------*19750006
197600 4005-CALC-TOTAL-AMOUNTS.                                         19760006
197700                                                                  19770006
197800     IF ASC-FISCAL-WEEK > SPACES                                  19780007
197900         MOVE ASC-FISCAL-WEEK    TO DK-FISCAL-WEEK                19790007
198000         PERFORM 4007-GET-WEEK-INFO                               19800007
198010         MOVE DK-FROM-YY  TO  ASC-FROM-YR                         19801099
198020         MOVE DK-FROM-MM  TO  ASC-FROM-MN                         19802099
198030         MOVE DK-FROM-DD  TO  ASC-FROM-DY                         19803099
198100         STRING 'WTD INCL ' DELIMITED BY SIZE                     19810007
198200                DK-TO-DATE  DELIMITED BY SIZE                     19820007
198300                    INTO PV-DISPLAY-DATE                          19830007
198400     ELSE                                                         19840006
198500         IF ASC-FISCAL-MONTH > SPACES                             19850007
198600             MOVE ASC-FISCAL-MONTH   TO DK-FISCAL-MONTH           19860007
198700             PERFORM 4008-GET-MONTH-INFO                          19870007
198710             MOVE DK-FROM-YY  TO  ASC-FROM-YR                     19871099
198720             MOVE DK-FROM-MM  TO  ASC-FROM-MN                     19872099
198730             MOVE DK-FROM-DD  TO  ASC-FROM-DY                     19873099
198800             STRING 'MTD INCL ' DELIMITED BY SIZE                 19880007
198900                    DK-TO-DATE  DELIMITED BY SIZE                 19890007
199000                        INTO PV-DISPLAY-DATE                      19900007
199100         ELSE                                                     19910007
199200             IF ASC-FROM-DATE > SPACES                            19920007
199300                 MOVE ASC-FROM-YR        TO DK-FROM-YY            19930022
199400                 MOVE ASC-FROM-MN        TO DK-FROM-MM            19940022
199500                 MOVE ASC-FROM-DY        TO DK-FROM-DD            19950022
199600                 MOVE DK-FROM-DATE-X     TO DK-FROM-DATE          19960024
199700                 MOVE ASC-TO-YR          TO DK-TO-YY              19970022
199800                 MOVE ASC-TO-MN          TO DK-TO-MM              19980022
199900                 MOVE ASC-TO-DY          TO DK-TO-DD              19990022
200000                 MOVE DK-TO-DATE-X       TO DK-TO-DATE            20000024
200100                 STRING 'BUSINESS DATE RANGE: ' DELIMITED BY SIZE 20010007
200200                        DK-FROM-DATE  DELIMITED BY SIZE           20020007
200300                        ' '           DELIMITED BY SIZE           20030007
200400                        'TO '         DELIMITED BY SIZE           20040007
200500                        DK-TO-DATE    DELIMITED BY SIZE           20050007
200600                            INTO PV-DISPLAY-DATE                  20060007
200700             ELSE                                                 20070007
200800                 MOVE ASC-BUSN-YY        TO DK-FROM-YY            20080022
200900                 MOVE ASC-BUSN-MM        TO DK-FROM-MM            20090022
201000                 MOVE ASC-BUSN-DD        TO DK-FROM-DD            20100022
201100                 MOVE DK-FROM-DATE-X     TO DK-FROM-DATE          20110024
201200                 MOVE DK-FROM-DATE       TO DK-TO-DATE            20120024
201300                     STRING 'BUSINESS DATE: ' DELIMITED BY SIZE   20130007
201400                             DK-TO-DATE       DELIMITED BY SIZE   20140007
201500                                INTO PV-DISPLAY-DATE              20150007
201600             END-IF                                               20160007
201700         END-IF                                                   20170007
201800     END-IF.                                                      20180007
201810     MOVE PV-DISPLAY-DATE TO ASC-DISPLAY-DATE.                    20181087
201900     EXEC SQL                                                     20190007
202000          SELECT  DECIMAL(SUM(UNT_WRKD_QTY),11,0)                 20200074
202100            INTO  :PV-TOT-UNITS                                   20210065
202200            FROM  PCT_SUM_WRKD                                    20220006
202300           WHERE  BUS_DTE        >=  :DK-FROM-DATE                20230006
202400             AND  BUS_DTE        <=  :DK-TO-DATE                  20240006
202500     END-EXEC.                                                    20250006
202600                                                                  20260006
202700     EVALUATE TRUE                                                20270006
202800         WHEN SQLCODE = +0                                        20280006
202900             MOVE PV-TOT-UNITS  TO  ASC-TOT-UNITS                 20290065
203000         WHEN OTHER                                               20300006
203100             MOVE ZEROES        TO  ASC-TOT-UNITS                 20310065
203200     END-EVALUATE.                                                20320006
203300                                                                  20330006
203400     EXEC SQL                                                     20340006
203500          SELECT  FLOAT (SUM(UNT_WRKD_QTY))                       20350070
203600            INTO  :PV-1ST-UNITS                                   20360065
203700            FROM  PCT_SUM_WRKD                                    20370006
203800           WHERE  BUS_DTE        >=  :DK-FROM-DATE                20380006
203900             AND  BUS_DTE        <=  :DK-TO-DATE                  20390006
204000             AND  SHFT_NBR        =  :PC-1                        20400006
204100     END-EXEC.                                                    20410006
204200                                                                  20420006
204300     EVALUATE TRUE                                                20430006
204400         WHEN SQLCODE = +0                                        20440006
204500             MOVE PV-1ST-UNITS  TO  ASC-1ST-UNITS                 20450065
204600         WHEN OTHER                                               20460006
204700             MOVE ZEROES        TO  ASC-1ST-UNITS                 20470065
204800     END-EVALUATE.                                                20480006
204900                                                                  20490006
205000     EXEC SQL                                                     20500006
205100          SELECT  FLOAT (SUM(UNT_WRKD_QTY))                       20510070
205200            INTO  :PV-2ND-UNITS                                   20520065
205300            FROM  PCT_SUM_WRKD                                    20530006
205400           WHERE  BUS_DTE        >=  :DK-FROM-DATE                20540006
205500             AND  BUS_DTE        <=  :DK-TO-DATE                  20550006
205600             AND  SHFT_NBR        =  :PC-2                        20560006
205700     END-EXEC.                                                    20570006
205800                                                                  20580006
205900     EVALUATE TRUE                                                20590006
206000         WHEN SQLCODE = +0                                        20600006
206100             MOVE PV-2ND-UNITS  TO  ASC-2ND-UNITS                 20610065
206200         WHEN OTHER                                               20620006
206300             MOVE ZEROES        TO  ASC-2ND-UNITS                 20630065
206400     END-EVALUATE.                                                20640006
206500                                                                  20650006
206600     EXEC SQL                                                     20660006
206700          SELECT  FLOAT (SUM(UNT_WRKD_QTY))                       20670070
206800            INTO  :PV-3RD-UNITS                                   20680065
206900            FROM  PCT_SUM_WRKD                                    20690006
207000           WHERE  BUS_DTE        >=  :DK-FROM-DATE                20700006
207100             AND  BUS_DTE        <=  :DK-TO-DATE                  20710006
207200             AND  SHFT_NBR        =  :PC-3                        20720006
207300     END-EXEC.                                                    20730006
207400                                                                  20740006
207500     EVALUATE TRUE                                                20750006
207600         WHEN SQLCODE = +0                                        20760006
207700             MOVE PV-3RD-UNITS  TO  ASC-3RD-UNITS                 20770065
207800         WHEN OTHER                                               20780006
207900             MOVE ZEROES        TO  ASC-3RD-UNITS                 20790065
208000     END-EVALUATE.                                                20800006
208100                                                                  20810006
208110     INITIALIZE  PV-TOT-UNITS                                     20811065
208111                 PV-1ST-UNITS                                     20811165
208112                 PV-2ND-UNITS                                     20811265
208113                 PV-3RD-UNITS.                                    20811365
208120                                                                  20812065
208200     IF ASC-1ST-UNITS > ZERO AND ASC-TOT-UNITS > ZERO             20820099
208300         DIVIDE ASC-1ST-UNITS BY ASC-TOT-UNITS                    20830046
208400             GIVING PV-DIVIDEND ROUNDED                           20840099
208500         MULTIPLY PV-DIVIDEND BY 100                              20850046
208600             GIVING ASC-1ST-PCT                                   20860046
208610         IF ASC-1ST-PCT = ZERO                                    20861099
208611             MOVE .1    TO  ASC-1ST-PCT                           20861176
208620         END-IF                                                   20862076
208700     ELSE                                                         20870022
208800         MOVE ZEROS TO  ASC-1ST-PCT                               20880076
208900     END-IF.                                                      20890022
209000     IF ASC-2ND-UNITS > ZERO AND ASC-TOT-UNITS > ZERO             20900099
209100         DIVIDE ASC-2ND-UNITS BY ASC-TOT-UNITS                    20910046
209200             GIVING PV-DIVIDEND ROUNDED                           20920099
209300         MULTIPLY PV-DIVIDEND BY 100                              20930046
209400             GIVING ASC-2ND-PCT                                   20940046
209410         IF ASC-2ND-PCT  = ZERO                                   20941099
209411             MOVE .1    TO  ASC-2ND-PCT                           20941176
209420         END-IF                                                   20942076
209500     ELSE                                                         20950040
209600         MOVE ZEROS TO  ASC-2ND-PCT                               20960076
209700     END-IF.                                                      20970022
209800     IF ASC-3RD-UNITS > ZERO AND ASC-TOT-UNITS > ZERO             20980099
209900         DIVIDE ASC-3RD-UNITS BY ASC-TOT-UNITS                    20990046
210000             GIVING PV-DIVIDEND ROUNDED                           21000099
210100         MULTIPLY PV-DIVIDEND BY 100                              21010046
210200             GIVING ASC-3RD-PCT                                   21020046
210210         IF ASC-3RD-PCT  = ZERO                                   21021099
210211             MOVE .1 TO  ASC-3RD-PCT                              21021176
210220         END-IF                                                   21022076
210300     ELSE                                                         21030040
210400         MOVE ZEROS TO  ASC-3RD-PCT                               21040076
210500     END-IF.                                                      21050022
210600                                                                  21060006
210700*----------------------------------------------------------------*21070007
210800*   GET WEEK INFORMATION FROM TDTATTR                             21080007
210900*----------------------------------------------------------------*21090007
211000 4007-GET-WEEK-INFO.                                              21100007
211100     EXEC SQL                                                     21110007
211200          SELECT DISTINCT (FSCL_WK_BEG_DTE)                       21120007
211300                 ,FSCL_WK_END_DTE                                 21130007
211400            INTO  :DTATTR-FSCL-WK-BEG-DTE                         21140007
211500                 ,:DTATTR-FSCL-WK-END-DTE                         21150007
211600            FROM  TDTATTR                                         21160007
211700           WHERE  FSCL_YR_NBR   =  :DK-FISCAL-YEAR                21170007
211800             AND  FSCL_WK_NBR   =  :DK-FISCAL-WK                  21180016
211900     END-EXEC.                                                    21190007
212000                                                                  21200007
212100     EVALUATE TRUE                                                21210007
212200         WHEN SQLCODE = +0                                        21220007
212300             MOVE DTATTR-FSCL-WK-BEG-DTE TO  DK-FROM-DATE         21230099
212500             MOVE DTATTR-FSCL-WK-END-DTE TO  DK-TO-DATE           21250099
212700         WHEN OTHER                                               21270044
212800             MOVE SPACES                 TO  ASC-FROM-DATE        21280044
212900                                             ASC-TO-DATE          21290044
213000                                             DK-FROM-DATE         21300044
213100                                             DK-TO-DATE           21310044
213200     END-EVALUATE.                                                21320044
213300                                                                  21330044
213400*----------------------------------------------------------------*21340044
213500*   GET MONTH INFORMATION FROM TDTATTR                            21350044
213600*----------------------------------------------------------------*21360044
213700 4008-GET-MONTH-INFO.                                             21370044
213800     EXEC SQL                                                     21380044
213900          SELECT DISTINCT (FSCL_MN_BEG_DTE)                       21390044
214000                 ,FSCL_MN_END_DTE                                 21400044
214100            INTO  :DTATTR-FSCL-MN-BEG-DTE                         21410044
214200                 ,:DTATTR-FSCL-MN-END-DTE                         21420044
214300            FROM  TDTATTR                                         21430044
214400           WHERE  FSCL_YR_NBR   =  :DK-FISCAL-YR                  21440044
214500             AND  FSCL_MN_NBR   =  :DK-FISCAL-MN                  21450048
214600     END-EXEC.                                                    21460044
214700                                                                  21470044
214800     EVALUATE TRUE                                                21480044
214900         WHEN SQLCODE = +0                                        21490044
215000             MOVE DTATTR-FSCL-MN-BEG-DTE TO  DK-FROM-DATE         21500099
215200             MOVE DTATTR-FSCL-MN-END-DTE TO  DK-TO-DATE           21520099
215400         WHEN OTHER                                               21540044
215500             MOVE SPACES                 TO  ASC-FROM-DATE        21550044
215600                                             ASC-TO-DATE          21560044
215700                                             DK-FROM-DATE         21570044
215800                                             DK-TO-DATE           21580044
215900     END-EVALUATE.                                                21590044
216000                                                                  21600044
216100*----------------------------------------------------------------*21610044
216200* OPEN THE CURSOR                                                 21620002
216300*   IN THIS PARTICULAR APPLICATION TWO CURSORS WILL BE            21630010
216400*   OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE             21640002
216500*   USER.                                                        *21650002
216600*----------------------------------------------------------------*21660002
216700 4010-OPEN-CURSOR.                                                21670002
216800     PERFORM                                                      21680002
216900         WITH TEST AFTER                                          21690002
217000         VARYING PV-RETRY-COUNTER                                 21700002
217100         FROM 1 BY 1                                              21710002
217200         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               21720002
217300                   OR (SQLCODE = ZERO))                           21730002
217400                                                                  21740002
217500         EVALUATE TRUE                                            21750010
217600             WHEN PS-OPER-NAME-CSR                                21760010
217700                 EXEC SQL                                         21770010
217800                      OPEN OPER-NAME-CSR                          21780010
217900                 END-EXEC                                         21790010
218000             WHEN PS-UK-OPER-NAME-CSR                             21800010
218100                 EXEC SQL                                         21810010
218200                      OPEN UK-OPER-NAME-CSR                       21820010
218300                 END-EXEC                                         21830010
218400         END-EVALUATE                                             21840010
218500                                                                  21850002
218600         EVALUATE TRUE                                            21860002
218700             WHEN SQLCODE = ZERO                                  21870002
218800             WHEN SQLCODE = -904                                  21880002
218900             WHEN SQLCODE = -913                                  21890002
219000                 CONTINUE                                         21900009
219100             WHEN SQLWARN0 NOT = SPACES                           21910002
219200             WHEN SQLCODE < ZERO                                  21920002
219300             WHEN SQLCODE > ZERO                                  21930002
219400                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       21940002
219500                 MOVE 'OPEN CURSOR PROBLEM    - '                 21950002
219600                                   TO DP013-MESSAGE-TEXT (1)      21960002
219700                 MOVE SQLCA        TO DP013-SQLCA                 21970002
219800                 MOVE 'PCT_SHFT ' TO DP013-DB2-TABLE-NAME (1)     21980009
219900                 SET DP013-DB2-ABEND                              21990002
220000                     DP013-XCTL-DISPLAY-RESTART TO TRUE           22000002
220100                 PERFORM DP013-0000-PROCESS-ABEND                 22010002
220200         END-EVALUATE                                             22020002
220300     END-PERFORM.                                                 22030002
220400*                                                                 22040002
220500     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        22050002
220600         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             22060009
220700         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   22070002
220800                                   TO DP013-MESSAGE-TEXT (1)      22080002
220900         MOVE SQLCA                TO DP013-SQLCA                 22090002
221000         MOVE 'PCT_SHFT '      TO DP013-DB2-TABLE-NAME (1)        22100009
221100         SET DP013-DB2-ABEND                                      22110009
221200             DP013-XCTL-DISPLAY-RESTART TO TRUE                   22120002
221300         PERFORM DP013-0000-PROCESS-ABEND                         22130002
221400     END-IF.                                                      22140002
221500                                                                  22150002
221600*----------------------------------------------------------------*22160002
221700* CLOSE THE CURSOR.                                               22170002
221800*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *22180007
221900*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *22190002
222000*   USER.                                                        *22200002
222100*----------------------------------------------------------------*22210002
222200 4020-CLOSE-CURSOR.                                               22220002
222300                                                                  22230009
222400     EVALUATE TRUE                                                22240010
222500         WHEN PS-OPER-NAME-CSR                                    22250010
222600             EXEC SQL                                             22260010
222700                 CLOSE OPER-NAME-CSR                              22270010
222800             END-EXEC                                             22280010
222900         WHEN PS-UK-OPER-NAME-CSR                                 22290010
223000             EXEC SQL                                             22300010
223100                 CLOSE UK-OPER-NAME-CSR                           22310010
223200             END-EXEC                                             22320010
223300     END-EVALUATE.                                                22330010
223400                                                                  22340009
223500     EVALUATE TRUE                                                22350002
223600         WHEN SQLCODE = ZERO                                      22360002
223700         WHEN SQLCODE = +100                                      22370002
223800             CONTINUE                                             22380002
223900         WHEN SQLWARN0 NOT = SPACES                               22390002
224000         WHEN SQLCODE < ZERO                                      22400002
224100         WHEN SQLCODE > ZERO                                      22410002
224200             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          22420002
224300             MOVE 'CLOSE CURSOR PROBLEM   '                       22430002
224400                               TO DP013-MESSAGE-TEXT (1)          22440002
224500             MOVE SQLCA        TO DP013-SQLCA                     22450002
224600             MOVE 'PCT_SHFT ' TO DP013-DB2-TABLE-NAME (1)         22460009
224700             SET DP013-DB2-ABEND                                  22470002
224800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               22480002
224900             PERFORM DP013-0000-PROCESS-ABEND                     22490002
225000     END-EVALUATE.                                                22500002
225100                                                                  22510002
225200*----------------------------------------------------------------*22520002
225300*    SET UP THE HOST VARIABLES.                                  *22530002
225400*----------------------------------------------------------------*22540002
225500 4100-PREPARE-CURSOR.                                             22550002
225600     MOVE SPACE TO PS-CURSOR-SW.                                  22560002
225700     IF ASC-OPER-NBR > ZERO                                       22570005
225800         MOVE ASC-OPER-NBR    TO DK-OPER-UNT-ID                   22580099
225810         SET PS-OPER-NAME-CSR TO TRUE                             22581099
225900     ELSE                                                         22590007
226000         SET PS-UK-OPER-NAME-CSR TO TRUE                          22600010
226100     END-IF.                                                      22610002
226200                                                                  22620002
226300*----------------------------------------------------------------*22630009
226400* RETRIEVE REMAINING INFORMATION FROM PCT_SUM_WRKD                22640009
226500*----------------------------------------------------------------*22650009
226600 4200-GET-NEXT-CSR.                                               22660017
226700     INITIALIZE PV-1ST-UNITS                                      22670029
226800                PV-2ND-UNITS                                      22680029
226900                PV-3RD-UNITS                                      22690029
227000                PV-TOT-UNITS.                                     22700029
227100     PERFORM 4210-OPEN-CURSOR.                                    22710029
227200     PERFORM 4220-READ-ITEMS-FROM-DB.                             22720009
227300     SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            22730027
227400     PERFORM 4230-CLOSE-CURSOR.                                   22740009
227500                                                                  22750009
227600*----------------------------------------------------------------*22760009
227700* OPEN THE CURSOR                                                 22770009
227800*   IN THIS PARTICULAR PARAGRAPH ONE CURSOR WILL BE               22780077
227900*   OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE             22790009
228000*   USER.                                                        *22800009
228100*----------------------------------------------------------------*22810009
228200 4210-OPEN-CURSOR.                                                22820009
229000     EXEC SQL                                                     22900059
229100          OPEN UNITS-BY-OPER-CSR                                  22910059
229200     END-EXEC.                                                    22920059
229300                                                                  22930009
229400     EVALUATE TRUE                                                22940059
229500         WHEN SQLCODE = ZERO                                      22950059
229600         WHEN SQLCODE = -904                                      22960059
229700         WHEN SQLCODE = -913                                      22970059
229800             CONTINUE                                             22980059
230900         WHEN SQLWARN0 NOT = SPACES                               23090059
231000         WHEN SQLCODE < ZERO                                      23100059
231100         WHEN SQLCODE > ZERO                                      23110059
231200             MOVE '4210-OPEN-CURSOR' TO DP013-PARAGRAPH           23120059
231300             MOVE 'OPEN CURSOR PROBLEM - '                        23130059
231400                               TO DP013-MESSAGE-TEXT (1)          23140059
231500             MOVE SQLCA        TO DP013-SQLCA                     23150059
231600             MOVE 'PCT_SUM_WRKD' TO DP013-DB2-TABLE-NAME (1)      23160059
231700             SET DP013-DB2-ABEND                                  23170059
231800                 DP013-XCTL-DISPLAY-RESTART TO TRUE               23180059
231900             PERFORM DP013-0000-PROCESS-ABEND                     23190059
232000     END-EVALUATE.                                                23200059
232200*                                                                 23220058
233400*----------------------------------------------------------------*23340058
233500*    READ ITEMS FROM THE PCT_SUM_WRKD TABLE                       23350058
233600*----------------------------------------------------------------*23360058
233700 4220-READ-ITEMS-FROM-DB.                                         23370058
233800                                                                  23380058
233900     PERFORM                                                      23390058
234000         VARYING PV-READ-COUNT                                    23400058
234100         FROM 1 BY 1                                              23410058
234200         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    23420058
234300            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         23430058
234400                                                                  23440058
234500         PERFORM 4225-FETCH                                       23450058
234600                                                                  23460058
234700         IF  ASC-ITEMS-LEFT-ON-DB                                 23470058
234800             EVALUATE PCT00005-SHFT-NBR                           23480058
234900                 WHEN 1                                           23490058
235000                    MOVE PCT00005-UNT-WRKD-QTY TO PV-1ST-UNITS    23500010
235100                 WHEN 2                                           23510010
235200                    MOVE PCT00005-UNT-WRKD-QTY TO PV-2ND-UNITS    23520010
235300                 WHEN 3                                           23530010
235400                    MOVE PCT00005-UNT-WRKD-QTY TO PV-3RD-UNITS    23540010
235500             END-EVALUATE                                         23550010
235600             ADD  PCT00005-UNT-WRKD-QTY  TO  PV-TOT-UNITS         23560010
235700         END-IF                                                   23570010
235800     END-PERFORM.                                                 23580010
235900                                                                  23590010
236000*----------------------------------------------------------------*23600010
236100*    FETCH THE CURSOR                                             23610010
236200*----------------------------------------------------------------*23620010
236300 4225-FETCH.                                                      23630010
236400     EXEC SQL                                                     23640010
236500         FETCH UNITS-BY-OPER-CSR                                  23650010
236600         INTO  :PCT00005-UNT-WRKD-QTY                             23660010
236700              ,:PCT00005-SHFT-NBR                                 23670010
236800     END-EXEC.                                                    23680010
236900                                                                  23690010
237000     EVALUATE TRUE                                                23700010
237100         WHEN SQLCODE = ZERO                                      23710010
237200         WHEN SQLCODE = +100                                      23720010
237300             CONTINUE                                             23730027
237400         WHEN SQLWARN0 NOT = SPACE                                23740010
237500         WHEN SQLCODE NOT = ZERO                                  23750010
237600              MOVE '4225-FETCH-CURSOR' TO DP013-PARAGRAPH         23760010
237700              MOVE 'FETCH CURSOR PROBLEM '                        23770010
237800                               TO DP013-MESSAGE-TEXT (1)          23780010
237900              MOVE SQLCA       TO DP013-SQLCA                     23790010
238000              MOVE 'PCT_SUM_WRKD' TO DP013-DB2-TABLE-NAME (1)     23800010
238100              SET DP013-DB2-ABEND TO TRUE                         23810010
238200              PERFORM DP013-0000-PROCESS-ABEND                    23820010
238300     END-EVALUATE.                                                23830010
238400                                                                  23840010
238500     IF  SQLCODE EQUAL +100                                       23850025
238600         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      23860025
238700     END-IF.                                                      23870025
238800                                                                  23880025
238900*----------------------------------------------------------------*23890010
239000* CLOSE THE CURSOR.                                               23900010
239100*   IN THIS PARTICULAR APPLICATION ONE OF 2 DIFFERENT CURSORS    *23910010
239200*   WILL BE CLOSED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *23920010
239300*   USER.                                                        *23930010
239400*----------------------------------------------------------------*23940010
239500 4230-CLOSE-CURSOR.                                               23950010
239600     EXEC SQL                                                     23960010
239700         CLOSE UNITS-BY-OPER-CSR                                  23970010
239800     END-EXEC.                                                    23980010
239900                                                                  23990010
240000     EVALUATE TRUE                                                24000010
240100         WHEN SQLCODE = ZERO                                      24010010
240200         WHEN SQLCODE = +100                                      24020010
240300             CONTINUE                                             24030010
240400         WHEN SQLWARN0 NOT = SPACES                               24040010
240500         WHEN SQLCODE < ZERO                                      24050010
240600         WHEN SQLCODE > ZERO                                      24060010
240700             MOVE '4230-CLOSE-CURSOR' TO DP013-PARAGRAPH          24070010
240800             MOVE 'CLOSE CURSOR PROBLEM   '                       24080010
240900                               TO DP013-MESSAGE-TEXT (1)          24090010
241000             MOVE SQLCA        TO DP013-SQLCA                     24100010
241100             MOVE 'PCT_SUM_WRKD' TO DP013-DB2-TABLE-NAME (1)      24110010
241200             SET DP013-DB2-ABEND                                  24120010
241300                 DP013-XCTL-DISPLAY-RESTART TO TRUE               24130010
241400             PERFORM DP013-0000-PROCESS-ABEND                     24140010
241500     END-EVALUATE.                                                24150010
241600                                                                  24160010
241700*----------------------------------------------------------------*24170010
241800*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *24180010
241900*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *24190010
242000*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *24200002
242100*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *24210002
242200*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *24220002
242300*                                                                *24230002
242400*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *24240002
242500*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *24250002
242600*    UPON INITIALIZATION.                                        *24260002
242700*----------------------------------------------------------------*24270002
242800 4300-READ-ITEMS-FROM-DB.                                         24280002
242900                                                                  24290002
243000     PERFORM                                                      24300002
243100         VARYING PV-READ-COUNT                                    24310002
243200         FROM 1 BY 1                                              24320002
243300         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    24330002
243400            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         24340002
243500                                                                  24350002
243600         PERFORM 4310-FETCH                                       24360002
243700                                                                  24370002
243800         IF  ASC-ITEMS-LEFT-ON-DB                                 24380002
243900             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                24390002
244000                 ADD +1            TO ASC-ITEM-SUB                24400002
244100             ELSE                                                 24410002
244200                 ADD +1            TO ASC-BLK-SUB                 24420002
244300                 MOVE +1           TO ASC-ITEM-SUB                24430002
244400                                                                  24440002
244500                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         24450002
244600                     MOVE +1       TO ASC-BLK-SUB                 24460002
244700                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           24470002
244800                     PERFORM 5100-WRITE-TEMP-STORAGE              24480002
244900                     MOVE ASC-BLOCK-ENTRIES                       24490002
245000                                   (PC-MAX-BLOCKS-IN-ARRAY)       24500002
245100                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 24510002
245200                     ADD +1        TO ASC-BLK-SUB                 24520002
245300                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   24530002
245400                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      24540002
245500                                                          TO TRUE 24550002
245600                 END-IF                                           24560002
245700             END-IF                                               24570002
245800             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    24580002
245900             SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          24590002
246000             MOVE ASC-NUMBER-OF-ITEMS-READ                        24600002
246100                                   TO ASC-LIST-ITEM-NUMBER        24610002
246200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  24620002
246300             MOVE ASC-OPER-DESC                                   24630010
246400                       TO ASC-OPERDESC (ASC-BLK-SUB ASC-ITEM-SUB) 24640010
246500             MOVE PV-1ST-UNITS                                    24650010
246600                        TO ASC-1STUNITS (ASC-BLK-SUB ASC-ITEM-SUB)24660011
246700             MOVE PV-2ND-UNITS                                    24670010
246800                        TO ASC-2NDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)24680011
246900             MOVE PV-3RD-UNITS                                    24690010
247000                        TO ASC-3RDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)24700011
247100             MOVE PV-TOT-UNITS                                    24710010
247200                        TO ASC-TOTUNITS (ASC-BLK-SUB ASC-ITEM-SUB)24720011
247300             IF PV-1ST-UNITS > ZERO AND PV-TOT-UNITS > ZERO       24730099
247400                 DIVIDE PV-1ST-UNITS BY PV-TOT-UNITS              24740073
247500                     GIVING PV-DIVIDEND ROUNDED                   24750099
247600                 MULTIPLY PV-DIVIDEND BY 100                      24760046
247700                     GIVING PV-1ST-PCT                            24770046
247710                 IF PV-1ST-PCT  = ZERO                            24771099
247711                     MOVE .1     TO PV-1ST-PCT                    24771176
247720                 END-IF                                           24772076
247800             ELSE                                                 24780046
247900                 MOVE ZEROES TO PV-1ST-UNITS                      24790075
248010                                PV-1ST-PCT                        24801076
248100             END-IF                                               24810046
248200             IF PV-2ND-UNITS > ZERO AND PV-TOT-UNITS > ZERO       24820099
248300                 DIVIDE PV-2ND-UNITS BY PV-TOT-UNITS              24830073
248400                     GIVING PV-DIVIDEND ROUNDED                   24840099
248500                 MULTIPLY PV-DIVIDEND BY 100                      24850046
248600                     GIVING PV-2ND-PCT                            24860046
248610                 IF PV-2ND-PCT  = ZERO                            24861099
248620                     MOVE .1     TO PV-2ND-PCT                    24862076
248630                 END-IF                                           24863076
248700             ELSE                                                 24870046
248800                 MOVE ZEROES TO PV-2ND-UNITS                      24880075
248910                                PV-2ND-PCT                        24891076
249000             END-IF                                               24900046
249100             IF PV-3RD-UNITS > ZERO AND PV-TOT-UNITS > ZERO       24910099
249200                 DIVIDE PV-3RD-UNITS BY PV-TOT-UNITS              24920073
249300                     GIVING PV-DIVIDEND ROUNDED                   24930099
249400                 MULTIPLY PV-DIVIDEND BY 100                      24940046
249500                     GIVING PV-3RD-PCT                            24950046
249510                 IF PV-3RD-PCT  = ZERO                            24951099
249520                     MOVE .1     TO PV-3RD-PCT                    24952076
249530                 END-IF                                           24953076
249600             ELSE                                                 24960028
249700                 MOVE ZEROES TO PV-3RD-UNITS                      24970075
249810                                PV-3RD-PCT                        24981076
249900             END-IF                                               24990028
250000             IF PV-TOT-UNITS > ZERO AND ASC-TOT-UNITS > ZERO      25000099
250100                 DIVIDE PV-TOT-UNITS BY ASC-TOT-UNITS             25010073
250200                     GIVING PV-DIVIDEND  ROUNDED                  25020099
250300                 MULTIPLY PV-DIVIDEND BY 100                      25030046
250400                     GIVING PV-TOT-PCT                            25040046
250410                 IF PV-TOT-PCT  = ZERO                            25041099
250420                     MOVE .1     TO PV-TOT-PCT                    25042099
250430                 END-IF                                           25043099
250500             ELSE                                                 25050041
250600                 MOVE ZEROES TO PV-TOT-PCT                        25060041
250700                                PV-TOT-UNITS                      25070041
250800             END-IF                                               25080041
250900             MOVE PV-1ST-PCT                                      25090041
251000                          TO ASC-1STPCT (ASC-BLK-SUB ASC-ITEM-SUB)25100041
251100             MOVE PV-2ND-PCT                                      25110041
251200                          TO ASC-2NDPCT (ASC-BLK-SUB ASC-ITEM-SUB)25120041
251300             MOVE PV-3RD-PCT                                      25130041
251400                          TO ASC-3RDPCT (ASC-BLK-SUB ASC-ITEM-SUB)25140041
251500             MOVE PV-TOT-PCT                                      25150041
251600                          TO ASC-TOTPCT (ASC-BLK-SUB ASC-ITEM-SUB)25160041
251700         END-IF                                                   25170041
251800     END-PERFORM.                                                 25180002
251900                                                                  25190002
252000     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          25200002
252100         MOVE +1               TO ASC-BLK-SUB                     25210002
252200         PERFORM 5100-WRITE-TEMP-STORAGE                          25220002
252300         ADD +1                TO ASC-BLK-SUB                     25230002
252400         PERFORM 5100-WRITE-TEMP-STORAGE                          25240002
252500                                                                  25250002
252600         MOVE 1                TO ASC-BLK-SUB                     25260002
252700                                  PV-BLOCK-NUMBER                 25270002
252800         PERFORM 4410-READ-TEMP-STORAGE                           25280002
252900         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             25290002
253000             MOVE 2            TO ASC-BLK-SUB                     25300002
253100                                  PV-BLOCK-NUMBER                 25310002
253200             PERFORM 4410-READ-TEMP-STORAGE                       25320002
253300         END-IF                                                   25330002
253400     END-IF.                                                      25340002
253500                                                                  25350002
253600*----------------------------------------------------------------*25360002
253700*    FETCH THE CURSOR                                             25370002
253800*----------------------------------------------------------------*25380002
253900 4310-FETCH.                                                      25390002
254000     EVALUATE TRUE                                                25400010
254100         WHEN PS-OPER-NAME-CSR                                    25410010
254200             EXEC SQL                                             25420010
254300                  FETCH OPER-NAME-CSR                             25430010
254400                 INTO  :PCT00004-OPER-UNT-ID                      25440010
254500                      ,:XLT00010-LOC-5-ABBR-NM                    25450099
254600             END-EXEC                                             25460010
254700         WHEN PS-UK-OPER-NAME-CSR                                 25470010
254800             EXEC SQL                                             25480010
254900                  FETCH UK-OPER-NAME-CSR                          25490010
255000                 INTO  :PCT00004-OPER-UNT-ID                      25500010
255100                      ,:XLT00010-LOC-5-ABBR-NM                    25510099
255200             END-EXEC                                             25520010
255300     END-EVALUATE.                                                25530010
255400                                                                  25540010
255500     EVALUATE TRUE                                                25550002
255600         WHEN SQLCODE = ZERO                                      25560002
255700              MOVE PCT00004-OPER-UNT-ID     TO DK-OPER-UNT-ID     25570086
255900              MOVE XLT00010-LOC-5-ABBR-NM   TO ASC-OPER-DESC      25590099
256000              PERFORM 4200-GET-NEXT-CSR                           25600009
256100         WHEN SQLCODE = +100                                      25610002
256200              CONTINUE                                            25620027
256300         WHEN SQLWARN0 NOT = SPACE                                25630002
256400         WHEN SQLCODE NOT = ZERO                                  25640002
256500              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         25650002
256600              MOVE 'FETCH CURSOR PROBLEM '                        25660002
256700                               TO DP013-MESSAGE-TEXT (1)          25670002
256800              MOVE SQLCA       TO DP013-SQLCA                     25680002
256900              MOVE 'PCT_SHFT'   TO DP013-DB2-TABLE-NAME (1)       25690009
256910              MOVE 'XLT_LOC'    TO DP013-DB2-TABLE-NAME (2)       25691099
257000              SET DP013-DB2-ABEND TO TRUE                         25700002
257100              PERFORM DP013-0000-PROCESS-ABEND                    25710002
257200     END-EVALUATE.                                                25720002
257300                                                                  25730002
257400     IF  SQLCODE EQUAL +100                                       25740002
257500         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      25750002
257600     END-IF.                                                      25760002
257700                                                                  25770002
257800*----------------------------------------------------------------*25780009
257900* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *25790009
258000*----------------------------------------------------------------*25800009
258100 4400-MOVE-COMMAREA-TO-SCREEN.                                    25810009
258200     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             25820002
258300         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          25830002
258400         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          25840002
258500             MOVE +1    TO ASC-BLK-SUB                            25850002
258600             PERFORM 5100-WRITE-TEMP-STORAGE                      25860002
258700             ADD +1     TO ASC-BLK-SUB                            25870002
258800             PERFORM 5100-WRITE-TEMP-STORAGE                      25880002
258900             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             25890002
259000                 GIVING PV-BLOCK-NUMBER                           25900002
259100                 REMAINDER PV-REMAINDER                           25910002
259200             IF  PV-REMAINDER > ZERO                              25920002
259300                 ADD +1 TO PV-BLOCK-NUMBER                        25930002
259400             END-IF                                               25940002
259500             MOVE +1    TO ASC-BLK-SUB                            25950002
259600             PERFORM 4410-READ-TEMP-STORAGE                       25960002
259700             ADD +1     TO ASC-BLK-SUB                            25970002
259800                           PV-BLOCK-NUMBER                        25980002
259900             PERFORM 4410-READ-TEMP-STORAGE                       25990002
260000     END-IF.                                                      26000002
260100     MOVE +1            TO ASC-BLK-SUB.                           26010002
260200     COMPUTE ASC-ITEM-SUB =                                       26020002
260300         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              26030002
260400         + PC-ITEMS-PER-PANEL).                                   26040002
260500*                                                                 26050002
260600     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        26060002
260700         ADD +1         TO ASC-BLK-SUB                            26070002
260800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            26080002
260900     END-IF.                                                      26090002
261000*                                                                 26100002
261100     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           26110002
261200         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                26120002
261300     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        26130002
261400     PERFORM 4420-FORMAT-LIST-LINES                               26140002
261500         VARYING PV-SUB                                           26150002
261600         FROM PC-ITEMS-PER-PANEL BY -1                            26160002
261700         UNTIL PV-SUB < +1.                                       26170002
261800*                                                                 26180002
261900     COMPUTE ASC-ITEMS-DISPLAYED =                                26190002
262000         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          26200002
262100     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    26210002
262200                                      ASTRTITO.                   26220007
262300     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    26230002
262400     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    26240002
262500     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            26250002
262600                                   TO ASELITO.                    26260002
262700                                                                  26270002
262800     MOVE ASC-3RD-UNITS              TO DK-NUMBER-FORMAT.         26280099
262810     MOVE DK-NUMBER-FORMAT           TO A3TOTLO.                  26281099
262900     MOVE ASC-3RD-PCT                TO DK-NUMBER.                26290018
263000     MOVE DK-PERCENT-FORMAT          TO A3PRCTO.                  26300018
263010     MOVE ASC-1ST-UNITS              TO DK-NUMBER-FORMAT.         26301099
263020     MOVE DK-NUMBER-FORMAT           TO A1TOTLO.                  26302099
263200     MOVE ASC-1ST-PCT                TO DK-NUMBER.                26320018
263300     MOVE DK-PERCENT-FORMAT          TO A1PRCTO.                  26330018
263310     MOVE ASC-2ND-UNITS              TO DK-NUMBER-FORMAT.         26331099
263320     MOVE DK-NUMBER-FORMAT           TO A2TOTLO.                  26332099
263500     MOVE ASC-2ND-PCT                TO DK-NUMBER.                26350018
263600     MOVE DK-PERCENT-FORMAT          TO A2PRCTO.                  26360018
263610     MOVE ASC-TOT-UNITS              TO DK-NUMBER-FORMAT.         26361099
263620     MOVE DK-NUMBER-FORMAT           TO ATTOTLO.                  26362099
263800     MOVE ASC-DISPLAY-DATE           TO ADATEO.                   26380087
263900                                                                  26390002
264000     IF  DP020-MSG-NUMBER-X = SPACE                               26400002
264100         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  26410002
264200*            --- MORE ITEMS TO DISPLAY ----                       26420002
264300             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            26430002
264400             SET DP020-MSG-INFORMATIONAL TO TRUE                  26440002
264500         END-IF                                                   26450002
264600     END-IF.                                                      26460002
264700                                                                  26470002
264800*----------------------------------------------------------------*26480002
264900*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *26490002
265000*----------------------------------------------------------------*26500002
265100 4410-READ-TEMP-STORAGE.                                          26510002
265200                                                                  26520002
265300     EXEC CICS                                                    26530002
265400         READQ TS                                                 26540002
265500             QUEUE (ASC-LIST-QUEUE-NAME)                          26550002
265600             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               26560002
265700             ITEM  (PV-BLOCK-NUMBER)                              26570002
265800             RESP  (PV-CICS-RESP)                                 26580002
265900     END-EXEC.                                                    26590002
266000                                                                  26600002
266100     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       26610002
266200       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     26620002
266300         CONTINUE                                                 26630002
266400     ELSE                                                         26640002
266500         SET DP013-CICS-ABEND     TO TRUE                         26650002
266600         SET DP013-NO-ROLLBACK    TO TRUE                         26660002
266700         MOVE '4410-READ-TEMP-STORAGE'                            26670002
266800                                  TO DP013-PARAGRAPH              26680002
266900         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      26690002
267000                                  TO DP013-MESSAGE-TEXT(1)        26700002
267100         PERFORM DP013-0000-PROCESS-ABEND                         26710002
267200     END-IF.                                                      26720002
267300                                                                  26730002
267400     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             26740002
267500*                                                                 26750002
267600     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         26760002
267700         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               26770002
267800     END-IF.                                                      26780002
267900                                                                  26790002
268000*----------------------------------------------------------------*26800002
268100*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *26810002
268200*----------------------------------------------------------------*26820002
268300 4420-FORMAT-LIST-LINES.                                          26830002
268400     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      26840002
268500         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                26850002
268600         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           26860002
268700         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           26870002
268800         MOVE SPACE              TO MR-SELECTI (PV-SUB)           26880002
268900*                                   MR-ACTION (PV-SUB)            26890054
269000                                    MR-OPER-DESC  (PV-SUB)        26900012
269100                                    MR-3RD-UNITS  (PV-SUB)        26910012
269200                                    MR-3RD-PCT    (PV-SUB)        26920012
269300                                    MR-1ST-UNITS  (PV-SUB)        26930012
269400                                    MR-1ST-PCT    (PV-SUB)        26940012
269500                                    MR-2ND-UNITS  (PV-SUB)        26950012
269600                                    MR-2ND-PCT    (PV-SUB)        26960012
269700                                    MR-TOT-UNITS  (PV-SUB)        26970012
269800                                    MR-TOT-PCT    (PV-SUB)        26980012
269900     ELSE                                                         26990002
270000         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      27000002
270100                                                   > SPACE        27010002
270200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 27020002
270300                                 TO MR-SELECTI (PV-SUB)           27030002
270400         ELSE                                                     27040002
270500             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      27050002
270600                                 TO MR-SELECTI (PV-SUB)           27060002
270700         END-IF                                                   27070002
270800         IF  DP030-SET-CURSOR-TRAILER                             27080002
270900             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)27090002
271000                 > SPACE)                                         27100002
271100               OR (PV-SUB = 1))                                   27110002
271200                SET DP030-SET-CURSOR-APPL-1 TO TRUE               27120002
271300                MOVE -1               TO MR-SELECTL (PV-SUB)      27130002
271400             END-IF                                               27140002
271500         END-IF                                                   27150002
271600*                                                                 27160002
271700*        MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               27170054
271800*                                          TO MR-ACTION (PV-SUB)  27180054
271900         MOVE ASC-OPERDESC (ASC-BLK-SUB ASC-ITEM-SUB)             27190012
272000                                       TO  MR-OPER-DESC  (PV-SUB) 27200012
272100         IF ASC-3RDUNITS (ASC-BLK-SUB ASC-ITEM-SUB) < 0           27210099
272101             MOVE ASC-3RDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)         27210199
272102                                        TO MR-3RD-UNITS-P(PV-SUB) 27210299
272105         ELSE                                                     27210599
272106             IF ASC-3RDUNITS (ASC-BLK-SUB ASC-ITEM-SUB) > 9999999927210699
272210                 MOVE ASC-3RDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27221099
272220                                        TO MR-3RD-UNITS-O(PV-SUB) 27222099
272221             ELSE                                                 27222199
272222                 MOVE ASC-3RDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27222299
272223                                        TO MR-3RD-UNITS-N(PV-SUB) 27222399
272230             END-IF                                               27223099
272240         END-IF                                                   27224099
272241         MOVE ASC-3RDPCT (ASC-BLK-SUB ASC-ITEM-SUB)               27224199
272242                                         TO MR-3RD-PCT-N(PV-SUB)  27224299
272250         IF ASC-1STUNITS (ASC-BLK-SUB ASC-ITEM-SUB) < 0           27225099
272260             MOVE ASC-1STUNITS (ASC-BLK-SUB ASC-ITEM-SUB)         27226099
272270                                        TO MR-1ST-UNITS-P(PV-SUB) 27227099
272300         ELSE                                                     27230099
272400             IF ASC-1STUNITS (ASC-BLK-SUB ASC-ITEM-SUB) > 9999999927240099
272410                 MOVE ASC-1STUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27241099
272420                                        TO MR-1ST-UNITS-O(PV-SUB) 27242099
272430             ELSE                                                 27243099
272440                 MOVE ASC-1STUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27244099
272450                                        TO MR-1ST-UNITS-N(PV-SUB) 27245099
272460             END-IF                                               27246099
272490         END-IF                                                   27249099
272491         MOVE ASC-1STPCT (ASC-BLK-SUB ASC-ITEM-SUB)               27249199
272492                                         TO MR-1ST-PCT-N(PV-SUB)  27249299
272500         IF ASC-2NDUNITS (ASC-BLK-SUB ASC-ITEM-SUB) < 0           27250099
272600             MOVE ASC-2NDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)         27260099
272700                                        TO MR-2ND-UNITS-P(PV-SUB) 27270099
273000         ELSE                                                     27300099
273100             IF ASC-2NDUNITS (ASC-BLK-SUB ASC-ITEM-SUB) > 9999999927310099
273200                 MOVE ASC-2NDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27320099
273300                                        TO MR-2ND-UNITS-O(PV-SUB) 27330099
273400             ELSE                                                 27340099
273500                 MOVE ASC-2NDUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27350099
273600                                        TO MR-2ND-UNITS-N(PV-SUB) 27360099
273610             END-IF                                               27361099
273640         END-IF                                                   27364099
273641         MOVE ASC-2NDPCT (ASC-BLK-SUB ASC-ITEM-SUB)               27364199
273642                                         TO MR-2ND-PCT-N(PV-SUB)  27364299
273650         IF ASC-TOTUNITS (ASC-BLK-SUB ASC-ITEM-SUB) < 0           27365099
273660             MOVE ASC-TOTUNITS (ASC-BLK-SUB ASC-ITEM-SUB)         27366099
273670                                        TO MR-TOT-UNITS-P(PV-SUB) 27367099
273691         ELSE                                                     27369199
273692             IF ASC-TOTUNITS (ASC-BLK-SUB ASC-ITEM-SUB) > 9999999927369299
273693                 MOVE ASC-TOTUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27369399
273694                                        TO MR-TOT-UNITS-O(PV-SUB) 27369499
273695             ELSE                                                 27369599
273696                 MOVE ASC-TOTUNITS (ASC-BLK-SUB ASC-ITEM-SUB)     27369699
273697                                        TO MR-TOT-UNITS-N(PV-SUB) 27369799
273698             END-IF                                               27369899
273701         END-IF                                                   27370199
273702         MOVE ASC-TOTPCT (ASC-BLK-SUB ASC-ITEM-SUB)               27370299
273703                                         TO MR-TOT-PCT-N(PV-SUB)  27370399
273710     END-IF.                                                      27371099
273800     SUBTRACT +1 FROM ASC-ITEM-SUB                                27380002
273900     IF  ASC-ITEM-SUB < + 1                                       27390002
274000         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  27400002
274100         MOVE +1                 TO ASC-BLK-SUB                   27410002
274200     END-IF.                                                      27420002
274300                                                                  27430002
274400******************************************************************27440002
274500** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **27450002
274600** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **27460002
274700** ISSUE A WARNING.                                             **27470002
274800******************************************************************27480002
274900 4430-CHECK-FOR-BEGIN-AND-END.                                    27490002
275000     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       27500002
275100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     27510002
275200*            -- NO END-OF-RANGE SPECFIED ---                      27520002
275300             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            27530002
275400             SET DP020-MSG-WARNING TO TRUE                        27540002
275500             PERFORM 4431-POSITION-AT-WARNING                     27550002
275600         END-IF                                                   27560002
275700     ELSE                                                         27570002
275800         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     27580002
275900*            -- NO BEGINNING-OF-RANGE SPECFIED ---                27590002
276000             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            27600002
276100             SET DP020-MSG-WARNING TO TRUE                        27610002
276200             PERFORM 4431-POSITION-AT-WARNING                     27620002
276300         END-IF                                                   27630002
276400     END-IF.                                                      27640002
276500******************************************************************27650002
276600** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **27660002
276700** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **27670002
276800** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **27680002
276900** POSITION THE CURSOR THERE.                                   **27690002
277000******************************************************************27700002
277100 4431-POSITION-AT-WARNING.                                        27710002
277200     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 27720002
277300                    - PV-TOP-ITEM + 1.                            27730002
277400     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27740002
277500         CONTINUE                                                 27750002
277600     ELSE                                                         27760002
277700         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      27770002
277800         MOVE -1                   TO MR-SELECTL (PV-SUB)         27780002
277900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27790002
278000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27800002
278100     END-IF.                                                      27810002
278200*                                                                 27820002
278300     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   27830002
278400                    - PV-TOP-ITEM + 1.                            27840002
278500     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      27850002
278600         CONTINUE                                                 27860002
278700     ELSE                                                         27870002
278800         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      27880002
278900         MOVE -1                   TO MR-SELECTL (PV-SUB)         27890002
279000         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         27900002
279100         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         27910002
279200     END-IF.                                                      27920002
279300                                                                  27930002
279400*----------------------------------------------------------------*27940002
279500* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *27950002
279600* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *27960002
279700* FOR THE SELECTED ITEMS QUEUE.                                  *27970002
279800*                                                                *27980002
279900* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *27990002
280000* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *28000002
280100* THE ARRAY IS FULL.                                             *28010002
280200*----------------------------------------------------------------*28020002
280300 5000-PREPARE-SEL-QUEUE.                                          28030002
280400                                                                  28040002
280500     MOVE +1                   TO  ASC-BLK-SUB.                   28050002
280600     PERFORM 5100-WRITE-TEMP-STORAGE.                             28060002
280700     ADD +1                    TO  ASC-BLK-SUB.                   28070002
280800     PERFORM 5100-WRITE-TEMP-STORAGE.                             28080002
280900                                                                  28090002
281000     MOVE ASC-SEL-QUEUE-NAME   TO  PC214-SEL-QUEUE-NAME.          28100002
281100     PERFORM 6010-DELETE-SEL-QUEUE.                               28110002
281200                                                                  28120002
281300     SET ASC-UPDATE-TSQ        TO  TRUE.                          28130002
281400                                                                  28140002
281500     SET PC215-IDX             TO  1.                             28150002
281600     MOVE ZERO                 TO PC214-NUMBER-OF-TS-ITEMS.       28160002
281700     INITIALIZE PC215-SELECTED-ITEM-ARRAY.                        28170002
281800                                                                  28180002
281900     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           28190002
282000             VARYING PV-ITEM                                      28200002
282100             FROM 1 BY 1                                          28210002
282200             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     28220002
282300                                                                  28230002
282400     IF  PC215-IDX > 1                                            28240002
282500         PERFORM 5205-WRITE-SEL-QUEUE                             28250002
282600         ADD +1                TO PC214-NUMBER-OF-TS-ITEMS        28260002
282700     END-IF.                                                      28270002
282800*----------------------------------------------------------------*28280002
282900*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *28290002
283000*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *28300002
283100*----------------------------------------------------------------*28310002
283200 5100-WRITE-TEMP-STORAGE.                                         28320002
283300     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     28330002
283400                                   TO PV-LIST-ITEM-NUMBER.        28340002
283500     COMPUTE PV-BLOCK-NUMBER =                                    28350002
283600         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    28360002
283700                                                                  28370002
283800     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             28380002
283900     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             28390002
284000         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      28400002
284100             PERFORM 5105-REWRITE-ASC-LISTQ                       28410002
284200         END-IF                                                   28420002
284300     ELSE                                                         28430002
284400         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       28440002
284500         ASC-HIGHEST-BLOCK-WRITTEN + 1                            28450002
284600         PERFORM 5110-WRITE-ASC-LISTQ                             28460002
284700         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   28470002
284800     END-IF.                                                      28480002
284900                                                                  28490002
285000     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             28500002
285100                                                                  28510002
285200******************************************************************28520002
285300** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **28530002
285400** SPECIFIC COMMAREA.                                           **28540002
285500******************************************************************28550002
285600 5105-REWRITE-ASC-LISTQ.                                          28560002
285700     EXEC CICS                                                    28570002
285800         WRITEQ TS                                                28580002
285900             QUEUE (ASC-LIST-QUEUE-NAME)                          28590002
286000             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28600002
286100             ITEM  (PV-BLOCK-NUMBER)                              28610002
286200             REWRITE                                              28620002
286300             RESP  (PV-CICS-RESP)                                 28630002
286400     END-EXEC.                                                    28640002
286500                                                                  28650002
286600     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           28660002
286700         CONTINUE                                                 28670002
286800     ELSE                                                         28680002
286900         SET DP013-CICS-ABEND            TO TRUE                  28690002
287000         SET DP013-NO-ROLLBACK           TO TRUE                  28700002
287100         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       28710002
287200         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     28720002
287300                                         TO DP013-MESSAGE-TEXT(1) 28730002
287400         PERFORM DP013-0000-PROCESS-ABEND                         28740002
287500     END-IF.                                                      28750002
287600                                                                  28760002
287700******************************************************************28770002
287800** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **28780002
287900** SPECIFIC COMMAREA.                                           **28790002
288000******************************************************************28800002
288100 5110-WRITE-ASC-LISTQ.                                            28810002
288200     EXEC CICS                                                    28820002
288300         WRITEQ TS                                                28830002
288400             QUEUE (ASC-LIST-QUEUE-NAME)                          28840002
288500             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               28850002
288600             ITEM  (PV-BLOCK-NUMBER)                              28860002
288700             RESP  (PV-CICS-RESP)                                 28870002
288800     END-EXEC.                                                    28880002
288900     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      28890002
289000         SET DP013-CICS-ABEND      TO TRUE                        28900002
289100         SET DP013-NO-ROLLBACK     TO TRUE                        28910002
289200         MOVE '5110-WRITE-ASC-LISTQ'                              28920002
289300                                   TO DP013-PARAGRAPH             28930002
289400         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           28940002
289500                                   TO DP013-MESSAGE-TEXT(1)       28950002
289600         PERFORM DP013-0000-PROCESS-ABEND                         28960002
289700     END-IF.                                                      28970002
289800                                                                  28980002
289900*----------------------------------------------------------------*28990002
290000* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *29000002
290100* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *29010002
290200*----------------------------------------------------------------*29020002
290300 5200-FILL-SEL-QUEUE-RECORD.                                      29030002
290400                                                                  29040002
290500     PERFORM 6112-READ-LIST-QUEUE.                                29050002
290600                                                                  29060002
290700     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       29070002
290800         PERFORM                                                  29080002
290900         VARYING LQW-IDX                                          29090002
291000         FROM 1 BY 1                                              29100002
291100         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            29110002
291200           OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO          29120002
291300                                                                  29130002
291400             IF  LQW-SELECT (LQW-IDX)                             29140002
291500                 MOVE LQW-LIST-ITEM-NUMBER (LQW-IDX)              29150002
291600                                   TO PC215-ITEM (PC215-IDX)      29160002
291700                 MOVE SPACE        TO PC215-ACTION-SW (PC215-IDX) 29170002
291800                                                                  29180002
291900                 MOVE LQW-OPER-DESC  (LQW-IDX)                    29190012
292000                                   TO PC215-OPER-DESC (PC215-IDX) 29200012
292100                 MOVE LQW-3RD-UNITS (LQW-IDX)                     29210012
292200                                   TO PC215-3RD-UNITS (PC215-IDX) 29220012
292300                 MOVE LQW-3RD-PCT  (LQW-IDX)                      29230012
292400                                     TO PC215-3RD-PCT (PC215-IDX) 29240012
292500                 MOVE LQW-1ST-UNITS (LQW-IDX)                     29250012
292600                                   TO PC215-1ST-UNITS (PC215-IDX) 29260012
292700                 MOVE LQW-1ST-PCT  (LQW-IDX)                      29270012
292800                                     TO PC215-1ST-PCT (PC215-IDX) 29280012
292900                 MOVE LQW-2ND-UNITS (LQW-IDX)                     29290012
293000                                   TO PC215-2ND-UNITS (PC215-IDX) 29300012
293100                 MOVE LQW-2ND-PCT  (LQW-IDX)                      29310012
293200                                     TO PC215-2ND-PCT (PC215-IDX) 29320012
293300                 MOVE LQW-TOT-UNITS (LQW-IDX)                     29330012
293400                                   TO PC215-TOT-UNITS (PC215-IDX) 29340012
293500                 MOVE LQW-TOT-PCT  (LQW-IDX)                      29350012
293600                                     TO PC215-TOT-PCT (PC215-IDX) 29360012
293700                                                                  29370002
293800                 SET PC215-IDX UP BY 1                            29380002
293900                 IF  PC215-IDX > PC215-MAX-ITEMS                  29390002
294000                     PERFORM 5205-WRITE-SEL-QUEUE                 29400002
294100                     ADD +1        TO PC214-NUMBER-OF-TS-ITEMS    29410002
294200                     INITIALIZE PC215-SELECTED-ITEM-ARRAY         29420002
294300                     SET PC215-IDX TO  1                          29430002
294400                 END-IF                                           29440002
294500             END-IF                                               29450002
294600         END-PERFORM                                              29460002
294700     END-IF.                                                      29470002
294800                                                                  29480002
294900*----------------------------------------------------------------*29490002
295000*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *29500002
295100*----------------------------------------------------------------*29510002
295200 5205-WRITE-SEL-QUEUE.                                            29520002
295300                                                                  29530002
295400     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            29540002
295500                                   TO PC215-SELECTED-ITEMS.       29550002
295600                                                                  29560002
295700     EXEC CICS                                                    29570002
295800          WRITEQ TS                                               29580002
295900              QUEUE (ASC-SEL-QUEUE-NAME)                          29590002
296000              FROM  (PC215-SELECT-RECORD)                         29600002
296100              ITEM  (PV-SEL-QUEUE-ITEM)                           29610002
296200              RESP  (PV-CICS-RESP)                                29620002
296300     END-EXEC.                                                    29630002
296400                                                                  29640002
296500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          29650002
296600         CONTINUE                                                 29660002
296700     ELSE                                                         29670002
296800         SET DP013-CICS-ABEND      TO TRUE                        29680002
296900         SET DP013-NO-ROLLBACK     TO TRUE                        29690002
297000         MOVE '5205-WRITE-SEL-QUEUE'                              29700002
297100                                   TO DP013-PARAGRAPH             29710002
297200         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          29720002
297300                                   TO DP013-MESSAGE-TEXT(1)       29730002
297400         PERFORM DP013-0000-PROCESS-ABEND                         29740002
297500     END-IF.                                                      29750002
297600******************************************************************29760002
297700** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **29770002
297800** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **29780002
297900** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **29790002
298000** THE USER.                                                    **29800002
298100******************************************************************29810002
298200 6000-REFRESH-PANEL-FROM-TEMP.                                    29820002
298300     IF  ASC-UPDATE-TSQ                                           29830002
298400         SET ASC-NO-TSQ-UPDATE TO TRUE                            29840002
298500         MOVE ZERO                 TO PV-SAVE-ITEM                29850002
298600                                      PV-SEL-QUEUE-ITEM           29860002
298700         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        29870002
298800                                   TO PV-HOLD-SELECTED-ITEMS      29880002
298900         MOVE +1                   TO PV-ITEMS-PROCESSED          29890002
299000         PERFORM 6100-UPDATE-TSQ                                  29900002
299100             UNTIL PV-ITEMS-PROCESSED >                           29910002
299200                                     PV-HOLD-SELECTED-ITEMS       29920002
299300         INITIALIZE ASC-BLOCK-ENTRIES (1)                         29930002
299400                    ASC-BLOCK-ENTRIES (2)                         29940002
299500     END-IF.                                                      29950002
299600                                                                  29960002
299700*----------------------------------------------------------------*29970002
299800*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *29980002
299900*----------------------------------------------------------------*29990002
300000 6010-DELETE-SEL-QUEUE.                                           30000002
300100                                                                  30010002
300200     EXEC CICS                                                    30020002
300300         DELETEQ TS                                               30030002
300400             QUEUE (ASC-SEL-QUEUE-NAME)                           30040002
300500             RESP  (PV-CICS-RESP)                                 30050002
300600     END-EXEC.                                                    30060002
300700*                                                                 30070002
300800     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      30080002
300900        (PV-CICS-RESP = DFHRESP(QIDERR)))                         30090002
301000         CONTINUE                                                 30100002
301100     ELSE                                                         30110002
301200         SET DP013-CICS-ABEND TO TRUE                             30120002
301300         SET DP013-NO-ROLLBACK TO TRUE                            30130002
301400         MOVE '6010-DELETE-SEL-QUEUE'                             30140002
301500                        TO DP013-PARAGRAPH                        30150002
301600         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         30160002
301700                        TO DP013-MESSAGE-TEXT (1)                 30170002
301800         PERFORM DP013-0000-PROCESS-ABEND                         30180002
301900     END-IF.                                                      30190002
302000                                                                  30200002
302100*----------------------------------------------------------------*30210002
302200*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *30220002
302300*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *30230002
302400*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *30240002
302500*    THE TEMP QUEUE.                                             *30250002
302600*----------------------------------------------------------------*30260002
302700 6100-UPDATE-TSQ.                                                 30270002
302800                                                                  30280002
302900     ADD 1                     TO  PV-SEL-QUEUE-ITEM.             30290002
303000     PERFORM 6150-READ-SEL-QUEUE.                                 30300002
303100     PERFORM                                                      30310002
303200         VARYING PC215-IDX                                        30320002
303300         FROM 1 BY 1                                              30330002
303400         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     30340002
303500         OR (PC215-IDX GREATER THAN PC215-MAX-ITEMS))             30350002
303600         IF  PC215-ACTION-SW (PC215-IDX) > SPACE                  30360002
303700             PERFORM 6110-PROCESS-ITEMS                           30370002
303800         END-IF                                                   30380002
303900         ADD +1                TO PV-ITEMS-PROCESSED              30390002
304000     END-PERFORM.                                                 30400002
304100     PERFORM 6111-WRITE-LIST-QUEUE.                               30410002
304200                                                                  30420002
304300*----------------------------------------------------------------*30430002
304400*    READ THE LIST QUEUE RECORD.                                 *30440002
304500*----------------------------------------------------------------*30450002
304600 6150-READ-SEL-QUEUE.                                             30460002
304700                                                                  30470002
304800     EXEC CICS                                                    30480002
304900          READQ TS                                                30490002
305000              QUEUE (ASC-SEL-QUEUE-NAME)                          30500002
305100              INTO  (PC215-SELECT-RECORD)                         30510002
305200              ITEM  (PV-SEL-QUEUE-ITEM)                           30520002
305300              RESP  (PV-CICS-RESP)                                30530002
305400     END-EXEC.                                                    30540002
305500*                                                                 30550002
305600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          30560002
305700         CONTINUE                                                 30570002
305800     ELSE                                                         30580002
305900         SET DP013-CICS-ABEND      TO  TRUE                       30590002
306000         SET DP013-NO-ROLLBACK     TO  TRUE                       30600002
306100         MOVE '6150-READ-SEL-QUEUE' TO  DP013-PARAGRAPH           30610002
306200         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           30620002
306300                                   TO  DP013-MESSAGE-TEXT(1)      30630002
306400         PERFORM DP013-0000-PROCESS-ABEND                         30640002
306500     END-IF.                                                      30650002
306600                                                                  30660002
306700*----------------------------------------------------------------*30670002
306800*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*30680002
306900*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*30690002
307000*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *30700002
307100*----------------------------------------------------------------*30710002
307200 6110-PROCESS-ITEMS.                                              30720002
307300                                                                  30730002
307400     COMPUTE PV-ITEM = 1 + ((PC215-ITEM (PC215-IDX) - 1)          30740002
307500                     / PC-ITEMS-PER-PANEL).                       30750002
307600                                                                  30760002
307700     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           30770002
307800         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          30780002
307900             PERFORM 6111-WRITE-LIST-QUEUE                        30790002
308000         END-IF                                                   30800002
308100         MOVE PV-ITEM          TO PV-SAVE-ITEM                    30810002
308200                                                                  30820002
308300         PERFORM 6112-READ-LIST-QUEUE                             30830002
308400         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               30840002
308500             CONTINUE                                             30850002
308600         END-IF                                                   30860002
308700     END-IF.                                                      30870002
308800                                                                  30880002
308900     COMPUTE PV-SUB = (PC215-ITEM (PC215-IDX)                     30890002
309000                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              30900002
309100     SET LQW-DESELECT (PV-SUB) TO    TRUE                         30910002
309200     MOVE LQW-SELECTED-SW (PV-SUB)                                30920002
309300                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  30930002
309400                                                                  30940002
309500     EVALUATE TRUE                                                30950099
309600         WHEN PC215-INQ (PC215-IDX)                               30960099
309700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             30970099
309800                                                                  30980099
309900         WHEN PC215-UPD (PC215-IDX)                               30990099
310000              MOVE PC-UPD      TO LQW-ACTION (PV-SUB)             31000099
310100                                                                  31010099
310200         WHEN PC215-DEL (PC215-IDX)                               31020099
310300              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             31030099
310400                                                                  31040099
310500         WHEN PC215-ERR (PC215-IDX)                               31050099
310600              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             31060099
310700     END-EVALUATE.                                                31070099
310800                                                                  31080002
310900     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                31090002
311000                                                                  31100002
311100*----------------------------------------------------------------*31110002
311200*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *31120002
311300*----------------------------------------------------------------*31130002
311400 6111-WRITE-LIST-QUEUE.                                           31140002
311500                                                                  31150002
311600     EXEC CICS                                                    31160002
311700         WRITEQ TS                                                31170002
311800             QUEUE (ASC-LIST-QUEUE-NAME)                          31180002
311900             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     31190002
312000             ITEM  (PV-SAVE-ITEM)                                 31200002
312100             REWRITE                                              31210002
312200             RESP  (PV-CICS-RESP)                                 31220002
312300     END-EXEC.                                                    31230002
312400*                                                                 31240002
312500     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31250002
312600         CONTINUE                                                 31260002
312700     ELSE                                                         31270002
312800         SET DP013-CICS-ABEND  TO  TRUE                           31280002
312900         SET DP013-NO-ROLLBACK TO  TRUE                           31290002
313000         MOVE '6111-WRITE-LIST-QUEUE'                             31300002
313100                               TO  DP013-PARAGRAPH                31310002
313200         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  31320002
313300                               TO  DP013-MESSAGE-TEXT(1)          31330002
313400         PERFORM DP013-0000-PROCESS-ABEND                         31340002
313500     END-IF.                                                      31350002
313600                                                                  31360002
313700*----------------------------------------------------------------*31370002
313800*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*31380002
313900*----------------------------------------------------------------*31390002
314000 6112-READ-LIST-QUEUE.                                            31400002
314100                                                                  31410002
314200     EXEC CICS                                                    31420002
314300         READQ TS                                                 31430002
314400             QUEUE (ASC-LIST-QUEUE-NAME)                          31440002
314500             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     31450002
314600             ITEM  (PV-ITEM)                                      31460002
314700             RESP  (PV-CICS-RESP)                                 31470002
314800     END-EXEC.                                                    31480002
314900*                                                                 31490002
315000     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          31500002
315100         CONTINUE                                                 31510002
315200     ELSE                                                         31520002
315300         SET DP013-CICS-ABEND        TO TRUE                      31530002
315400         SET DP013-NO-ROLLBACK       TO TRUE                      31540002
315500         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           31550002
315600         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    31560002
315700                                     TO DP013-MESSAGE-TEXT(1)     31570002
315800         PERFORM DP013-0000-PROCESS-ABEND                         31580002
315900     END-IF.                                                      31590002
316000                                                                  31600002
316100*-----------------------------------------------------------------31610002
316200*  READ THE LIST QUEUE RECORD                                     31620002
316300*-----------------------------------------------------------------31630002
316400 9100-READ-SEL-QUEUE.                                             31640002
316500                                                                  31650002
316600     EXEC CICS                                                    31660002
316700         READQ TS                                                 31670002
316800             QUEUE (ASC-SEL-QUEUE-NAME)                           31680002
316900             INTO  (PC215-SELECT-RECORD)                          31690002
317000             ITEM  (ASC-SEL-ITEM)                                 31700002
317100             RESP  (PV-CICS-RESP)                                 31710002
317200     END-EXEC.                                                    31720002
317300     IF PV-CICS-RESP EQUAL DFHRESP(NORMAL)                        31730002
317400         CONTINUE                                                 31740002
317500     ELSE                                                         31750002
317600         SET DP013-LOGIC-ABEND                                    31760002
317700             DP013-NO-ROLLBACK   TO   TRUE                        31770002
317800         MOVE '9100-READ-SEL-QUEUE' TO   DP013-PARAGRAPH          31780002
317900         MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'   31790002
318000                                 TO   DP013-MESSAGE-TEXT (1)      31800002
318100         PERFORM DP013-0000-PROCESS-ABEND                         31810002
318200     END-IF.                                                      31820002
318300                                                                  31830002
318400*-----------------------------------------------------------------31840002
318500* UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *31850002
318600*-----------------------------------------------------------------31860002
318700 9200-REWRITE-SEL-QUEUE.                                          31870002
318800                                                                  31880002
318900     EXEC CICS                                                    31890002
319000          WRITEQ TS                                               31900002
319100              QUEUE  (ASC-SEL-QUEUE-NAME)                         31910002
319200              FROM   (PC215-SELECT-RECORD)                        31920002
319300              ITEM   (ASC-SEL-ITEM)                               31930002
319400              RESP   (PV-CICS-RESP)                               31940002
319500              REWRITE                                             31950002
319600     END-EXEC.                                                    31960002
319700                                                                  31970002
319800     IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)                   31980002
319900         SET DP013-CICS-ABEND                                     31990002
320000             DP013-NO-ROLLBACK     TO TRUE                        32000002
320100         MOVE '9200-REWRITE-SEL-QUEUE'                            32010002
320200                                   TO DP013-PARAGRAPH             32020002
320300         MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'   32030002
320400                                   TO DP013-MESSAGE-TEXT (1)      32040002
320500         PERFORM DP013-0000-PROCESS-ABEND                         32050002
320600     END-IF.                                                      32060002
320700                                                                  32070002
320800*----------------------------------------------------------------*32080002
320900*    THE DB2 RESOURCE IS NOT AVAILABLE, DISPLAY A MESSAGE ON     *32090002
321000*    THE TERMINAL INDICATING THAT THE RESOURCE IS UNAVAILABLE.   *32100002
321100*----------------------------------------------------------------*32110002
321200 9900-SOFT-ABORT.                                                 32120002
321300                                                                  32130002
321400     EXEC CICS SYNCPOINT                                          32140002
321500          ROLLBACK                                                32150002
321600     END-EXEC.                                                    32160002
321700                                                                  32170002
321800     SET  PS-ERROR                                                32180002
321900          PS-SOFT-ABORT-ERROR                                     32190002
322000          DP020-MSG-FATAL       TO  TRUE.                         32200002
322100                                                                  32210002
322200*----------------------------------------------------------------*32220002
322300*    ABEND PROCESSOR MODULE                                      *32230002
322400*----------------------------------------------------------------*32240002
322500                                                                  32250002
322600     COPY DPPD013.                                                32260002
