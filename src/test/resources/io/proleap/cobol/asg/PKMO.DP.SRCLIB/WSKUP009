000100******************************************************************00010026
000200*  I M P O R T A N T --- WHEN COMPILING THIS PROGRAM THE MQ SERIES00020026
000300*  SWITCH ON THE 2ND COMPILE SCREEN NEEDS TO BE SET TO 'Y'.       00030026
000400*  THIS PROGRAM USES MQSERIES.                                    00040026
000500*                                                                 00050026
000600*  THIS PROGRAM COMPILES WITH A RET CODE OF 4. THE LOOP WARNING   00060026
000700*  IS RELATED TO THE CODE FOR THE STARTED TASK PROCESSING.        00070026
000800*                                                                 00080026
001100******************************************************************00110007
001200                                                                  00120007
001300 IDENTIFICATION DIVISION.                                         00130007
001400 PROGRAM-ID.             WSKUP009.                                00140007
001500 AUTHOR.                 JEAN KURKOWSKI.                          00150007
001600 INSTALLATION.           KOHLS DEPARTMENT STORES.                 00160007
001700 DATE-WRITTEN.           FEBRUARY 2007.                           00170007
001800 DATE-COMPILED.                                                   00180007
001900                                                                  00190007
002000******************************************************************00200007
002100*      I T E M   M E S S A G E   Q U E U E   D O W N L O AD       00210007
002200*                                                                 00220007
002300* THIS PROGRAM WILL READ THE PIX RECORDS FROM WMS AND UPDATE      00230007
002400* THE OUTBOUND TRAILER TRIP STATUS TABLE.                         00240007
002600*                                                                 00260007
005400* GENERAL PROCESSING:                                             00540007
005500* -------------------                                             00550007
005600* 1) INITIALIZE VARIABLES, SET SWITCHES, OPEN ITEM QUEUE.         00560007
005700*                                                                 00570007
005800* 2) WHEN A MESSAGE APPEARS, IF AN ERROR IS FOUND, THE            00580007
005900*    ENTIRE MESSAGE WILL BE PUT TO THE ERROR QUEUE.               00590007
006000*                                                                 00600007
006100* 3) WHEN A MESSAGE HAS BEEN PROCESSED, THE ITEM WILL BE          00610007
006200*    INSERTED TO THE TRAILER TRIP STATUS TABLE TSUOBTS.           00620021
006300*                                                                 00630007
007100* 4) EVERYTHING WILL GET INITIALIZED AND RESET - READY FOR THE    00710007
007200*    NEXT MESSAGE WHEN IT IS ENCOUNTERED.                         00720007
007300*                                                                 00730007
010200* UNITS OF WORK AND COMMITS:                                      01020007
010300* --------------------------                                      01030007
010400* A UNIT OF WORK FOR A DB2 COMMIT WILL BE COMPLETE WHEN A         01040007
010500* MESSAGE FOR A ITEM HAS BEEN READ FROM THE QUEUE,                01050007
010600* AND INSERTED TO THE TSOUBTS TABLE.                              01060022
010700* THE DB2 COMMIT IS PERFORMED.                                    01070007
010800* THEN AN MQ COMMIT WILL BE PERFORMED TO PERMANENTLY 'REMOVE' THE 01080007
010900* MESSAGES FROM THE ITEM QUEUE.                                   01090007
011000* MQ COMMITS ARE ALSO PERFORMED AFTER AN ERROR MESSAGE HAS BEEN   01100007
011100* WRITTEN TO THE ERROR QUEUE.                                     01110007
011200*                                                                 01120007
011300*                                                                 01130007
011400******************************************************************01140007
011500 ENVIRONMENT DIVISION.                                            01150007
011600******************************************************************01160007
011700                                                                  01170007
011800 CONFIGURATION SECTION.                                           01180007
011900                                                                  01190007
012000 SOURCE-COMPUTER.        IBM-3090.                                01200007
012100 OBJECT-COMPUTER.        IBM-3090.                                01210007
012200                                                                  01220007
012300 INPUT-OUTPUT SECTION.                                            01230007
012400                                                                  01240007
012500 FILE-CONTROL.                                                    01250007
015800                                                                  01580007
015900******************************************************************01590007
016000 DATA DIVISION.                                                   01600007
016100******************************************************************01610007
016200                                                                  01620007
016300 FILE SECTION.                                                    01630007
016400                                                                  01640007
018900******************************************************************01890007
019000 WORKING-STORAGE SECTION.                                         01900007
019100******************************************************************01910007
019200                                                                  01920007
020100******************************************************************02010007
020200*  COMMUNICATIONS AREA FOR DB2                                    02020007
020300******************************************************************02030007
020400     EXEC SQL                                                     02040007
020500          INCLUDE SQLCA                                           02050007
020600     END-EXEC.                                                    02060007
020700                                                                  02070007
020800******************************************************************02080007
020900*  DB2 TABLE DECLARATION - LOGISTICS DOMAIN ITEM DATA             02090007
021000*      (WST_SHPMT_XREF_HDR)   FOR SHIPMENT XREF HEADER            02100007
021100******************************************************************02110007
021200     EXEC SQL                                                     02120007
021300          INCLUDE WST00001                                        02130007
021400     END-EXEC.                                                    02140007
021500                                                                  02150007
021600******************************************************************02160007
021700*  DB2 TABLE DECLARATION -  LOGISTICS DOMAIN ITEM DATA            02170007
021800*      (TSUOBTS)               FOR OUTBOUND TRAILER TRIP STATUS   02180007
021900******************************************************************02190007
022000     EXEC SQL                                                     02200007
022100          INCLUDE TSUOBTS                                         02210007
022200     END-EXEC.                                                    02220007
022300                                                                  02230007
022400******************************************************************02240009
022500*  DB2 VIEW DECLARATION                                           02250009
022600*      (WSV_CNSMR_QUE)         CONSUMER QUEUE INFO (GET/READ)     02260009
022700******************************************************************02270009
022800     EXEC SQL                                                     02280009
022900          INCLUDE WSV00006                                        02290009
023000     END-EXEC.                                                    02300009
023100                                                                  02310009
023200******************************************************************02320009
023300*  DB2 VIEW DECLARATION                                           02330009
023400*      (WSV_PRVDR_QUE)         PROVIDER QUEUE INFO (PUT/WRITE)    02340009
023500******************************************************************02350009
023600     EXEC SQL                                                     02360009
023700          INCLUDE WSV00005                                        02370009
023800     END-EXEC.                                                    02380009
023900                                                                  02390009
024800******************************************************************02480007
024900* INPUT LAYOUT - RECEIPT PIX TRANSACTIONS FROM WMOS               02490007
025000******************************************************************02500007
025100     COPY WSRD014.                                                02510007
025200                                                                  02520007
025300******************************************************************02530007
025400* OUTPUT LAYOUT - ERROR RECORD FOR RECEIPT PIX TRAN WMS PROCESS   02540007
025500******************************************************************02550007
025600     COPY WSRD020.                                                02560007
025700                                                                  02570007
026300******************************************************************02630007
026400*  WORK AREA FOR SQL ERROR ROUTINE 'DSNTIAR'.                     02640007
026500******************************************************************02650007
026600     COPY DPWS004.                                                02660007
026700                                                                  02670007
027000 01  PA-PROGRAM-ACCUMULATORS.                                     02700007
027100     05  PA-TOTALS.                                               02710007
027400         10 PA-TOTAL-STATUS-INSERTS   PIC S9(09) VALUE +0 COMP-3. 02740021
028700         10 PA-TOTAL-GETS             PIC S9(09) VALUE +0 COMP-3. 02870007
028900         10 PA-TOTAL-ERRORQ-RECS      PIC S9(09) VALUE +0 COMP-3. 02890007
029000         10 PA-TOTAL-DB2-COMMITS      PIC S9(09) VALUE +0 COMP-3. 02900007
029100                                                                  02910042
029200         10 PA-TOTAL-DUPLICATE-STATUS PIC S9(09) VALUE +0 COMP-3. 02920042
029210         10 PA-TOTAL-ALREADY-SU       PIC S9(09) VALUE +0 COMP-3. 02921042
029300                                                                  02930042
029500                                                                  02950007
029600 01  PS-PROGRAM-SWITCHES.                                         02960007
029700     05  PS-GOOD-MSG-SW                PIC  X(01)    VALUE 'N'.   02970007
029800         88  PS-GOOD-MSG-YES                         VALUE 'Y'.   02980007
029900         88  PS-GOOD-MSG-NO                          VALUE 'N'.   02990007
030900     05  PS-TIME-TO-END-PROGRAM-SW     PIC  X(01)    VALUE 'N'.   03090007
031000         88  PS-TIME-TO-END-PROGRAM-YES              VALUE 'Y'.   03100007
031100         88  PS-TIME-TO-END-PROGRAM-NO               VALUE 'N'.   03110007
031200     05  PS-END-OF-MSG-SW              PIC  X(01)    VALUE 'N'.   03120007
031300         88  PS-END-OF-MSG-YES                       VALUE 'Y'.   03130007
031400         88  PS-END-OF-MSG-NO                        VALUE 'N'.   03140007
031800     05  PS-ERROR-SW                   PIC  X(01)    VALUE 'N'.   03180007
031900         88  PS-ERROR-YES                            VALUE 'Y'.   03190007
032000         88  PS-ERROR-NO                             VALUE 'N'.   03200007
032100     05  PS-ERROR-QUEUE-IS-OPEN-SW     PIC  X(01)    VALUE 'N'.   03210007
032200         88  PS-ERROR-QUEUE-IS-OPEN-YES              VALUE 'Y'.   03220007
032300         88  PS-ERROR-QUEUE-IS-OPEN-NO               VALUE 'N'.   03230007
035200                                                                  03520007
035300 01  PC-PROGRAM-CONSTANTS.                                        03530007
036600     05  PC-MAX-RETRIES             PIC S9(03) VALUE +5 COMP-3.   03660007
036700     05  PC-CURRENT-PROGRAM-NAME    PIC X(08)  VALUE 'WSKUP009'.  03670007
037600     05  PC-MQPUT-RETRY-COUNTER     PIC 9(3)   VALUE ZERO.        03760007
038000     05  PC-DEFAULT-TMST            PIC X(26)  VALUE              03800007
038100                                    '0001-01-01-00.00.00.000000'. 03810007
038110     05  PC-DEFAULT-NINES           PIC X(26)  VALUE              03811007
038120                                    '9999-09-09-09.09.09.999999'. 03812007
038200     05  PC-END-RUN-MSG             PIC X(18)  VALUE              03820007
038300                                            'END RUN OF PROGRAM'. 03830007
038400                                                                  03840007
039100 01  DK-DB2-KEYS.                                                 03910007
039200     05  DK-INTRGTN-TYP-CDE         PIC X(10)  VALUE SPACES.      03920007
039300     05  DK-RCVD-SHPMT-NBR          PIC X(20)  VALUE SPACES.      03930007
039400     05  DK-ORIG-SHPMT-NBR          PIC X(20)  VALUE SPACES.      03940026
040200                                                                  04020007
040300 01  PV-PROGRAM-VARIABLES.                                        04030007
040500     05  PV-RETRY-COUNTER           PIC S9(04) VALUE +0 COMP SYNC.04050007
040600     05  PV-ITEM-COUNTER            PIC S9(04) VALUE +0 COMP SYNC.04060007
040700     05  PV-PARAGRAPH               PIC X(48)  VALUE SPACES.      04070007
041000     05  PV-MSG-LENGTH              PIC S9(9)  BINARY.            04100007
041100     05  PV-DATA-LENGTH             PIC S9(9) BINARY.             04110007
041200     05  PV-HOLD-COMPLETION-CODE    PIC S9(9)  BINARY.            04120007
041300     05  PV-HOLD-REASON             PIC S9(9)  BINARY.            04130007
041500     05  PV-REC-TYP-LENGTH          PIC 9(09)  VALUE 3.           04150007
041700     05  PV-MSG-SIZE                PIC 9(09)  VALUE ZEROES.      04170007
041800     05  PV-INTR-TRIP-ID            PIC S9(09) VALUE +0 COMP.     04180007
041900     05  PV-TRIP-STAT-CDE           PIC X(02)  VALUE SPACES.      04190007
042000                                                                  04200042
042100     05  PV-COUNT                     PIC S9(4) COMP              04210042
042200                                                VALUE ZERO.       04220042
042210     05  PV-COUNT-SU                  PIC S9(4) COMP              04221042
042220                                                VALUE ZERO.       04222042
042300     05  PS-TSUOBTS-TRIP-SW           PIC X(01) VALUE 'Y'.        04230042
042400         88  PS-TSUOBTS-TRIP-INSERT-YES         VALUE 'Y'.        04240042
042500         88  PS-TSUOBTS-TRIP-INSERT-NO          VALUE 'N'.        04250042
045500                                                                  04550042
045600 01  PV-MSG.                                                      04560007
045700     05  PV-MSG-END                 PIC X(18).                    04570007
045800         88 PV-END-RUN-MSG          VALUE 'END RUN OF PROGRAM'.   04580007
045900     05  FILLER                     PIC X(432).                   04590007
046000                                                                  04600007
046100 01  PV-CURRENT-TMST                PIC X(26)  VALUE SPACES.      04610013
046200                                                                  04620013
047100 01  PV-ABEND-VARIABLES.                                          04710007
047200     05  PV-ABEND-CODE              PIC S9(04) VALUE +0 COMP SYNC.04720007
047300     88  ABEND-4001-WRITE-ERROR                      VALUE +4001. 04730007
047400     88  ABEND-4002-READ-ERROR                       VALUE +4002. 04740007
047500     88  ABEND-4003-CTRL-CARD-ERROR                  VALUE +4003. 04750007
047600     88  ABEND-4004-TABLE-ERROR                      VALUE +4004. 04760007
047700     88  ABEND-4005-OPEN-ERROR                       VALUE +4005. 04770007
047800     88  ABEND-4006-CLOSE-ERROR                      VALUE +4006. 04780007
047900     88  ABEND-4007-SEQUENCE-ERROR                   VALUE +4007. 04790007
048000     88  ABEND-4008-DATA-ERROR                       VALUE +4008. 04800007
048100     88  ABEND-4009-KEY-DATA-ERROR                   VALUE +4009. 04810007
048200     88  ABEND-4013-DB2-ERROR                        VALUE +4013. 04820007
048300     88  ABEND-4019-CAL-SUB-ERROR                    VALUE +4019. 04830007
048400     88  ABEND-4020-MQ-ERROR                         VALUE +4020. 04840007
048500     88  ABEND-4444-FORCED-ABEND                     VALUE +4444. 04850007
048600                                                                  04860007
048700 01  PE-MQ-ABEND-VARIABLES.                                       04870007
048800     10  PE-MQ-QMANAGER             PIC X(05) VALUE SPACES.       04880007
048900     10  PE-MQ-QNAME                PIC X(30) VALUE SPACES.       04890007
049000     10  PE-MQ-COMPLETION-CODE      PIC 9(04) VALUE ZEROS.        04900007
049100     10  PE-MQ-REASON-CODE          PIC 9(04) VALUE ZEROS.        04910007
049200                                                                  04920007
049300****************************************************************  04930007
049400**     M Q   S E R I E S    W O R K I N G   S T O R A G E     *   04940007
049600**                  M  Q    C O P Y B O O K S                     04960007
050000****************************************************************  05000007
050100 01  MQM-OBJECT-DESCRIPTOR.                                       05010007
050200     COPY CMQODV.                                                 05020007
050300                                                                  05030007
050400 01  MQM-MESSAGE-DESCRIPTOR.                                      05040007
050500     COPY CMQMDV.                                                 05050007
050600                                                                  05060007
050700 01  MQM-GET-MESSAGE-OPTIONS.                                     05070007
050800     COPY CMQGMOV.                                                05080007
050900                                                                  05090007
051000 01  MQM-PUT-MESSAGE-OPTIONS.                                     05100007
051100     COPY CMQPMOV.                                                05110007
051200                                                                  05120007
051300 01  MQM-CONSTANTS.                                               05130007
051400     COPY CMQV.                                                   05140007
051500                                                                  05150007
054700** MQ SERIES CONSTANTS FOR CALLING MODULES SUCH AS PUT AND    **  05470007
054800*  OPEN, CONNECT, DISCONNECT.                                     05480007
055100****************************************************************  05510007
055200 01  MQ-WORKING-STORAGE.                                          05520007
055300     05  PC-MQCONN                PIC X(08)   VALUE 'CSQBCONN'.   05530007
055400     05  PC-MQOPEN                PIC X(08)   VALUE 'CSQBOPEN'.   05540007
055500     05  PC-MQINQ                 PIC X(08)   VALUE 'CSQBINQ'.    05550007
055600     05  PC-MQPUT                 PIC X(8)    VALUE 'CSQBPUT'.    05560007
055700     05  PC-MQGET                 PIC X(08)   VALUE 'CSQBGET'.    05570007
055800     05  PC-MQCMIT                PIC X(8)    VALUE 'CSQBCOMM'.   05580007
055900     05  PC-MQBACK                PIC X(8)    VALUE 'CSQBBACK'.   05590007
056000     05  PC-MQCLOSE               PIC X(08)   VALUE 'CSQBCLOS'.   05600007
056100     05  PC-MQDISC                PIC X(08)   VALUE 'CSQBDISC'.   05610007
056200     05  PC-QMGR-NAME                 PIC X(4)  VALUE SPACES.     05620007
056300         88  PC-PROD-QMGR-NAME                  VALUE 'QKSP'.     05630007
056400         88  PC-ACCEPT-QMGR-NAME                VALUE 'QKSQ'.     05640007
056500         88  PC-TEST-QMGR-NAME                  VALUE 'QKST'.     05650007
056600     05  PC-RESPONSE-QNAME            PIC X(30) VALUE SPACES.     05660007
056700     05  PC-WAIT-15-SECS              PIC S9(9) VALUE 15000.      05670007
056800     05  PC-WAIT-6-SECS               PIC S9(9) VALUE 6000.       05680007
056900     05  PC-DELAY-INTERVAL.                                       05690007
057000         10  FILLER                   PIC X(2)  VALUE SPACES.     05700007
057100         10  PC-DELAY-TIME            PIC 9(8)  VALUE 1500.       05710007
057200                                                                  05720007
057300****************************************************************  05730007
057400** QUEUE MANAGER HANDLE                                           05740007
057500*  QUEUE HANDLES                                                  05750007
057800****************************************************************  05780007
057900 01 PV-MQ-PROGRAM-HANDLES.                                        05790007
058000     05  PV-QMGR-NAME                 PIC X(48).                  05800007
058100     05  PV-HCONN                     PIC S9(9) BINARY VALUE 0.   05810007
058200     05  PV-GQ-HANDLE                 PIC S9(9) BINARY VALUE 0.   05820007
058300     05  PV-PQ-HANDLE                 PIC S9(9) BINARY VALUE 0.   05830007
058410     05  PV-QUE-NM-INPUT            PIC X(50)  VALUE SPACES.      05841007
058420     05  PV-QUE-NM-OUTPUT           PIC X(50)  VALUE SPACES.      05842007
058500****************************************************************  05850007
058700*                                                                 05870007
058800* ERROR PROCESSING VARIABLES                                      05880007
058900* CODES FROM CALLS ARE STORED HERE                                05890007
059000****************************************************************  05900007
059100 01 PV-MQ-PROGRAM-VARIABLES.                                      05910007
059200     05  PV-COMPLETION-CODE           PIC S9(9) BINARY.           05920007
059300     05  PV-REASON                    PIC S9(9) BINARY.           05930007
059400     05  PV-CON-REASON                PIC S9(9) BINARY.           05940007
059500     05  PV-ERROR-MESSAGE             PIC X(48) VALUE SPACES.     05950007
059600     05  PV-OPEN-OPTIONS              PIC S9(9) BINARY.           05960007
059700     05  PV-MSGBUFFER                 PIC X(203) VALUE SPACES.    05970007
059800     05  PV-ERRMSGBUF                 PIC X(226) VALUE SPACES.    05980016
059900     05  PV-MQCHECK                   PIC X(8)  VALUE 'MQR2C'.    05990007
060000     05  PV-MQ-REASON-TEXT            PIC X(30) VALUE SPACES.     06000007
060100                                                                  06010007
060200****************************************************************  06020007
060300**                     E N D   O F   M Q                          06030007
060600****************************************************************  06060007
060700****************************************************************  06070007
060800 PROCEDURE DIVISION.                                              06080007
060900******************************************************************06090007
061000 0000-PROGRAM-MAINLINE.                                           06100007
061100     DISPLAY '************ START OF WSKUP009 ***************'     06110007
061200                                                                  06120007
061300*INIT VARIBLES, SET SWITHCES.                                     06130007
061400     PERFORM 1000-INITIALIZE.                                     06140007
061510     PERFORM 1200-GET-INPUT-QUEUE-INFO.                           06151007
061520     PERFORM 1250-GET-OUTPUT-QUEUE-INFO.                          06152007
061600                                                                  06160007
062400*CONNECT TO QUEUE MANAGER.                                        06240007
062500     PERFORM 3100-MQ-CONNECT-TO-QMGR.                             06250007
062600                                                                  06260007
062700*OPEN THE QUEUE FOR GETS.                                         06270007
062800     PERFORM 3200-MQ-QUEUE-OPEN.                                  06280007
062900                                                                  06290007
063000*GET FIRST MSG FROM QUEUE.                                        06300007
063100     PERFORM 3300-MQ-GET-MSG.                                     06310007
063200                                                                  06320007
063300*PROCESS THE ITEM MESSAGES.                                       06330007
063400     PERFORM 2000-PROCESS-MSGS                                    06340007
063500         UNTIL PS-TIME-TO-END-PROGRAM-YES.                        06350007
063600                                                                  06360007
063610     PERFORM 5000-END-RUN-ROUTINE.                                06361030
063620                                                                  06362027
063700******************************************************************06370007
063800* INITIALIZE VARIABLES.                                           06380007
063900* SET SWITCHES.                                                   06390007
064000******************************************************************06400007
064100 1000-INITIALIZE.                                                 06410007
064200                                                                  06420007
064300     INITIALIZE   PA-TOTAL-STATUS-INSERTS                         06430007
065600                  PA-TOTAL-GETS                                   06560007
065700                  PA-TOTAL-DB2-COMMITS                            06570007
065710                                                                  06571042
065720                  PA-TOTAL-ERRORQ-RECS                            06572042
065730                  PA-TOTAL-DUPLICATE-STATUS                       06573042
065731                  PA-TOTAL-ALREADY-SU                             06573142
065740                                                                  06574042
066100                  PV-MSG-LENGTH                                   06610007
066200                  PV-DATA-LENGTH                                  06620007
066300                  DCLWST00001                                     06630007
066400                  DCLTSUOBTS.                                     06640009
066600                                                                  06660007
066700*INIT SWITCHES USED FOR EDITING EACH MSG, CONTINUING RUN OF       06670007
066800*PROGRAM AND OPENING OF THE ERROR QUEUE. ERROR QUEUE IS           06680007
066900*ONLY OPENED IF ERROR IS ENCOUNTERED, AND THEN REMAINS OPEN.      06690007
067000     SET PS-TIME-TO-END-PROGRAM-NO                                06700007
067100         PS-ERROR-QUEUE-IS-OPEN-NO  TO TRUE.                      06710007
067200                                                                  06720007
067400******************************************************************06740007
069900 1200-GET-INPUT-QUEUE-INFO.                                       06990007
070000******************************************************************07000007
070100                                                                  07010007
070200*SELECT  QUEUE MANAGER AND INPUT QUEUE NAME                       07020007
070300                                                                  07030007
070310       MOVE 'PIXSU'            TO DK-INTRGTN-TYP-CDE.             07031007
070320                                                                  07032007
070400       EXEC SQL                                                   07040007
070500           SELECT                                                 07050007
070600                 QUE_MGR,                                         07060007
070700                 QUE_NM                                           07070007
070900           INTO                                                   07090007
071000                :WSV00006-QUE-MGR,                                07100011
071010                :WSV00006-QUE-NM                                  07101011
071300           FROM WSV_CNSMR_QUE                                     07130007
071400           WHERE INTGRTN_TYP_CDE = :DK-INTRGTN-TYP-CDE            07140012
071500       END-EXEC                                                   07150007
071600                                                                  07160007
071700       EVALUATE TRUE                                              07170007
071800           WHEN SQLCODE = +0                                      07180007
071900               MOVE WSV00006-QUE-MGR-TEXT TO PV-QMGR-NAME         07190007
071910               MOVE WSV00006-QUE-NM-TEXT  TO PV-QUE-NM-INPUT      07191009
072000                                                                  07200007
072100           WHEN SQLCODE = +100                                    07210007
072600           WHEN SQLWARN0 NOT = SPACES                             07260007
072700           WHEN SQLCODE  NOT = ZERO                               07270007
072800             DISPLAY '******************************************' 07280007
072900             DISPLAY '*ABEND                                   *' 07290007
073000             DISPLAY '*PROGRAM   = WSKUP009                    *' 07300007
073100             DISPLAY '*DB2 OPER  = SELECT ON WSV_CNSMR_QUE     *' 07310007
073200             DISPLAY '*PARAGRAPH = 1200-GET-INPUT-QUEUE-INFO   *' 07320007
073300             DISPLAY '*SQLCODE = ' SQLCODE                        07330007
073400             DISPLAY '******************************************' 07340007
073500             PERFORM 9100-SQL-ABEND                               07350007
073600       END-EVALUATE.                                              07360007
073700                                                                  07370007
073800******************************************************************07380007
079300                                                                  07930007
079310******************************************************************07931007
079320 1250-GET-OUTPUT-QUEUE-INFO.                                      07932007
079330******************************************************************07933007
079340                                                                  07934007
079350*SELECT OUTPUT QUEUE NAME                                         07935032
079360                                                                  07936007
079370       MOVE 'PIXLGCYERR'       TO DK-INTRGTN-TYP-CDE.             07937007
079380                                                                  07938007
079390       EXEC SQL                                                   07939007
079391           SELECT                                                 07939107
079393                 QUE_NM                                           07939307
079394           INTO                                                   07939407
079396                :WSV00005-QUE-NM                                  07939611
079397           FROM WSV_PRVDR_QUE                                     07939709
079398           WHERE INTGRTN_TYP_CDE = :DK-INTRGTN-TYP-CDE            07939812
079399       END-EXEC                                                   07939907
079400                                                                  07940007
079401       EVALUATE TRUE                                              07940107
079402           WHEN SQLCODE = +0                                      07940207
079404               MOVE WSV00005-QUE-NM-TEXT  TO PV-QUE-NM-OUTPUT     07940409
079405                                                                  07940507
079406           WHEN SQLCODE = +100                                    07940607
079407           WHEN SQLWARN0 NOT = SPACES                             07940707
079408           WHEN SQLCODE  NOT = ZERO                               07940807
079409             DISPLAY '******************************************' 07940907
079410             DISPLAY '*ABEND                                   *' 07941007
079411             DISPLAY '*PROGRAM   = WSKUP009                    *' 07941107
079412             DISPLAY '*DB2 OPER  = SELECT ON WSV_PRVDR_QUE     *' 07941209
079413             DISPLAY '*PARAGRAPH = 1250-GET-OUTPUT-QUEUE-INFO  *' 07941307
079414             DISPLAY '*SQLCODE = ' SQLCODE                        07941407
079415             DISPLAY '******************************************' 07941507
079416             PERFORM 9100-SQL-ABEND                               07941607
079417       END-EVALUATE.                                              07941707
079418                                                                  07941807
079419******************************************************************07941907
079420                                                                  07942007
079430****************************************************************  07943007
079500* INIT SOME FIELDS BEFORE THE NEXT ITEM IS PROCESSED.             07950007
079600* RESET SOME SWITCHES.                                            07960007
079700****************************************************************  07970007
079800 1300-REINITIALIZE.                                               07980007
079900                                                                  07990007
080000     INITIALIZE DCLWST00001                                       08000007
080300                DCLTSUOBTS                                        08030007
080400                PV-MSG                                            08040007
080500                PV-MSGBUFFER                                      08050007
080600                PV-ERRMSGBUF.                                     08060007
080800                                                                  08080007
080900******************************************************************08090007
081000* BREAKDOWN AND EDIT A MSG.                                       08100007
081100* UPDATE DB2 TABLES -OR- PUT A MSG IN ERROR TO ERROR QUEUE.       08110007
081200* GET THE NEXT MSG.                                               08120007
081300******************************************************************08130007
081400 2000-PROCESS-MSGS.                                               08140007
081500                                                                  08150007
081501      IF WS014-SHUT-DOWN                                          08150115
081502          SET PS-TIME-TO-END-PROGRAM-YES TO TRUE                  08150215
081505          PERFORM 5000-END-RUN-ROUTINE                            08150515
081506      END-IF.                                                     08150615
081507                                                                  08150715
081510     PERFORM 2100-GET-SHIPMENT-HDR.                               08151007
081520                                                                  08152007
081530     IF PS-ERROR-NO                                               08153030
081600         EVALUATE TRUE                                            08160030
081700             WHEN WS014-TRLR-CHECK-IN                             08170030
081710                 MOVE 'SO'             TO PV-TRIP-STAT-CDE        08171030
081720                 PERFORM 2200-INSERT-TRIP-STATUS                  08172030
081730             WHEN WS014-VERIFY-SHIPMT                             08173030
081741                 MOVE 'SU'             TO PV-TRIP-STAT-CDE        08174130
081750                 PERFORM 2200-INSERT-TRIP-STATUS                  08175030
081763             WHEN OTHER                                           08176330
081764                 SET PS-ERROR-YES      TO TRUE                    08176430
081765                 SET WS020-INVALID-REC TO TRUE                    08176530
081766                 MOVE '2000-'          TO WS020-ERROR-PARA-NBR    08176630
081767                 MOVE 0                TO WS020-SQLCODE           08176730
089200         END-EVALUATE                                             08920030
089210     END-IF.                                                      08921030
089300                                                                  08930007
089400*IF NO ERRORS, JUST CONTINUE,                                     08940007
089500*ELSE REINIT AND RESET SWITCHES AND GO AFTER THE NEXT MSG         08950007
089600*(NEW ITEM) ON THE QUEUE.                                         08960007
089610                                                                  08961042
089700     IF PS-ERROR-YES                                              08970007
089800        PERFORM 7100-ERROR-ROUTINE                                08980007
089900        PERFORM 3800-PUT-MSG-TO-ERROR-Q                           08990007
090000        PERFORM 3600-MQ-COMMIT                                    09000007
090100     END-IF.                                                      09010007
090200                                                                  09020007
090500     PERFORM 1300-REINITIALIZE.                                   09050007
090600                                                                  09060007
090700*GET NEXT MESSAGE FROM QUEUE.                                     09070007
090800     SET PS-ERROR-NO TO TRUE.                                     09080007
090900     PERFORM 3300-MQ-GET-MSG.                                     09090007
091000                                                                  09100007
091001                                                                  09100107
091010******************************************************************09101007
091020 2100-GET-SHIPMENT-HDR.                                           09102007
091030******************************************************************09103007
091060                                                                  09106007
091108*READ SHIPMENT XREF HEADER TABLE                                  09110807
091109                                                                  09110907
091110       MOVE WS014-ORIG-SHIPMT-NBR    TO DK-ORIG-SHPMT-NBR.        09111026
091111                                                                  09111107
091112       EXEC SQL                                                   09111207
091113           SELECT INTR_TRIP_ID                                    09111307
091130           INTO   :WST00001-INTR-TRIP-ID                          09113007
091140           FROM   WST_SHPMT_XREF_HDR                              09114012
091146           WHERE  EXT_SHP_ID = :DK-ORIG-SHPMT-NBR                 09114626
091149       END-EXEC                                                   09114907
091150                                                                  09115007
091151       EVALUATE TRUE                                              09115107
091152           WHEN SQLCODE = +0                                      09115207
091153               MOVE WST00001-INTR-TRIP-ID  TO PV-INTR-TRIP-ID     09115307
091158                                                                  09115807
091164           WHEN SQLCODE = -904                                    09116407
091165           WHEN SQLCODE = -911                                    09116507
091166           WHEN SQLCODE = -913                                    09116607
091167               CONTINUE                                           09116707
091168                                                                  09116807
091169           WHEN OTHER                                             09116907
091170             DISPLAY '******************************************' 09117007
091171             DISPLAY '*ABEND                                   *' 09117107
091172             DISPLAY '*PROGRAM   = WSKUP009                    *' 09117207
091173             DISPLAY '*DB2 OPER  = READ WST_SHPMT_XREF_HDR     *' 09117307
091174             DISPLAY '*PARAGRAPH = 2100-GET-SHIPMENT-HDR       *' 09117407
091175             DISPLAY '*EXT SHIP ID = ' DK-RCVD-SHPMT-NBR          09117517
091176             DISPLAY '*SQLCODE = ' SQLCODE                        09117617
091177             DISPLAY '******************************************' 09117717
091178             SET PS-ERROR-YES    TO TRUE                          09117830
091179       END-EVALUATE.                                              09117917
091180                                                                  09118017
091190******************************************************************09119017
091200* INSERT TABLE.                                                   09120007
091300* DB2 COMMIT.                                                     09130007
091400* MQ COMMIT.                                                      09140007
091500******************************************************************09150007
091600 2200-INSERT-TRIP-STATUS.                                         09160007
091700******************************************************************09170007
091800                                                                  09180007
091900*INIT/LOAD OUTBOUND TRAILER TRIP STATUS RECORD.                   09190007
092000                                                                  09200007
092100     INITIALIZE DCLTSUOBTS.                                       09210007
092200     MOVE PV-INTR-TRIP-ID            TO SUOBTS-OTBND-TRIP-ID.     09220007
092300     MOVE WS014-CRE-TMST             TO SUOBTS-OTBND-STAT-TMST.   09230022
092400     MOVE PV-TRIP-STAT-CDE           TO SUOBTS-TRIP-STAT-CDE.     09240007
092500     MOVE WS014-DC-LOCATION          TO SUOBTS-STAT-OPER-UNT-ID.  09250027
092600     MOVE WS014-CRE-USER-ID          TO SUOBTS-OTBND-STAT-USR-ID. 09260007
092700     MOVE WS014-DOOR-ID              TO SUOBTS-DOOR-ID.           09270007
092800     MOVE WS014-SEAL                 TO SUOBTS-TRLR-SEAL-ID.      09280031
092900     MOVE WS014-SCAC                 TO SUOBTS-SHIP-SCAC-CDE.     09290007
093000     MOVE SPACES                     TO SUOBTS-SHIP-DRV-LAST-NM.  09300007
093100     MOVE SPACES                     TO SUOBTS-SHIP-DRV-FRST-NM.  09310007
093200     MOVE SPACES                     TO SUOBTS-SHIP-DRV-ID.       09320007
093300     MOVE SPACES                     TO SUOBTS-TRLR-PRKG-LOC-DESC.09330009
093400     MOVE SPACES                     TO SUOBTS-TRLR-PRKG-SLOT-NBR.09340007
093410     MOVE PC-DEFAULT-NINES           TO SUOBTS-FINCL-POST-TMST.   09341007
093420     MOVE 0                          TO SUOBTS-CPCTY-PCT.         09342007
093430     MOVE 0                          TO SUOBTS-UNUSD-PLLT-QTY.    09343007
093440     MOVE 0                          TO SUOBTS-LOD-BR-QTY.        09344007
093450     MOVE 'N'                        TO SUOBTS-RPT-GEND-IND.      09345007
093451                                                                  09345142
093452*                                                                 09345242
093453*** CHECK IF THIS IS A DUPLICATE STATYS - TRIP  HAS ALREADY       09345342
093454*** BEEN SET TO THIS STATUS.                                      09345442
093455*                                                                 09345542
093457     PERFORM 2210-CHECK-TRIP-STATUS.                              09345742
093458                                                                  09345842
093459*                                                                 09345942
093460*** IF STATUS IS TO BE 'SO' MAKE SURE THAT THE TRIP IS NOT        09346042
093461*** ALREADY IN 'SU' STATUS                                        09346142
093462*                                                                 09346242
093463     IF  PS-ERROR-NO  AND                                         09346343
093464         PS-TSUOBTS-TRIP-INSERT-YES   AND                         09346443
093465         SUOBTS-TRIP-STAT-CDE =  'SO'                             09346542
093466         PERFORM 2220-CHECK-TRIP-SU                               09346642
093467     END-IF.                                                      09346742
093468                                                                  09346842
093469     IF PS-ERROR-NO                                               09346942
093470       IF PS-TSUOBTS-TRIP-INSERT-YES                              09347042
093480                                                                  09348042
093600*INSERT TRAILER STATUS RECORD.                                    09360007
093700                                                                  09370007
093800       EXEC SQL                                                   09380007
093900           INSERT INTO TSUOBTS                                    09390007
094000               (OTBND_TRIP_ID,                                    09400007
094100                OTBND_STAT_TMST,                                  09410007
094200                TRIP_STAT_CDE,                                    09420007
094300                STAT_OPER_UNT_ID,                                 09430007
094400                OTBND_STAT_USR_ID,                                09440007
094500                DOOR_ID,                                          09450007
094600                TRLR_SEAL_ID,                                     09460007
094700                SHIP_SCAC_CDE,                                    09470007
094800                SHIP_DRV_LAST_NM,                                 09480007
094810                SHIP_DRV_FRST_NM,                                 09481007
094820                SHIP_DRV_ID,                                      09482007
094900                TRLR_PRKG_LOC_DESC,                               09490007
095000                TRLR_PRKG_SLOT_NBR,                               09500007
095010                FINCL_POST_TMST,                                  09501007
095020                CPCTY_PCT,                                        09502007
095030                UNUSD_PLLT_QTY,                                   09503007
095040                LOD_BR_QTY,                                       09504007
095100                RPT_GEND_IND)                                     09510007
095200           VALUES                                                 09520007
095300               (:SUOBTS-OTBND-TRIP-ID,                            09530007
095400                :SUOBTS-OTBND-STAT-TMST,                          09540007
095500                :SUOBTS-TRIP-STAT-CDE,                            09550007
095600                :SUOBTS-STAT-OPER-UNT-ID,                         09560007
095700                :SUOBTS-OTBND-STAT-USR-ID,                        09570007
095800                :SUOBTS-DOOR-ID,                                  09580007
095900                :SUOBTS-TRLR-SEAL-ID,                             09590007
096000                :SUOBTS-SHIP-SCAC-CDE,                            09600007
096100                :SUOBTS-SHIP-DRV-LAST-NM,                         09610007
096110                :SUOBTS-SHIP-DRV-FRST-NM,                         09611007
096120                :SUOBTS-SHIP-DRV-ID,                              09612007
096200                :SUOBTS-TRLR-PRKG-LOC-DESC,                       09620007
096300                :SUOBTS-TRLR-PRKG-SLOT-NBR,                       09630007
096310                :SUOBTS-FINCL-POST-TMST,                          09631007
096320                :SUOBTS-CPCTY-PCT,                                09632007
096330                :SUOBTS-UNUSD-PLLT-QTY,                           09633007
096340                :SUOBTS-LOD-BR-QTY,                               09634007
096400                :SUOBTS-RPT-GEND-IND)                             09640007
096500       END-EXEC                                                   09650007
096600                                                                  09660007
096700       EVALUATE TRUE                                              09670007
096800           WHEN SQLCODE = +0                                      09680007
096900               ADD +1 TO PA-TOTAL-STATUS-INSERTS                  09690007
097000*COMMIT DB2 DATA TO TABLES.                                       09700007
097100               PERFORM 6000-DB2-COMMIT                            09710007
097200*COMMIT MQ - WHICH WILL REMOVE MESSAGE FROM THE QUEUE.            09720007
097300               PERFORM 3600-MQ-COMMIT                             09730007
097400                                                                  09740007
097410*IF THE RECORD ALREADY EXISTS, THAT IS OKAY                       09741007
097500           WHEN SQLCODE = -803                                    09750007
097510               CONTINUE                                           09751007
097900                                                                  09790007
098000           WHEN SQLCODE = -904                                    09800007
098100           WHEN SQLCODE = -911                                    09810007
098200           WHEN SQLCODE = -913                                    09820007
098300               CONTINUE                                           09830007
098400                                                                  09840007
098500           WHEN OTHER                                             09850007
098600             DISPLAY '******************************************' 09860007
098700             DISPLAY '*ABEND                                   *' 09870007
098800             DISPLAY '*PROGRAM   = WSKUP009                    *' 09880007
099000             DISPLAY '*DB2 OPER  = INSERT TO TSUOBTS           *' 09900007
099100             DISPLAY '*PARAGRAPH = 2200-INSERT-TRIP-STATUS     *' 09910007
099250             DISPLAY '*SQLCODE = ' SQLCODE                        09925007
099260             DISPLAY '******************************************' 09926007
099300             SET PS-ERROR-YES    TO TRUE                          09930030
099400       END-EVALUATE                                               09940033
099410                                                                  09941042
099425       END-IF                                                     09942542
099426      END-IF.                                                     09942642
099427                                                                  09942742
099428                                                                  09942842
099429 2210-CHECK-TRIP-STATUS.                                          09942942
099430                                                                  09943042
099431     SET PS-TSUOBTS-TRIP-INSERT-YES   TO TRUE.                    09943142
099432     PERFORM                                                      09943242
099440         WITH TEST AFTER                                          09944042
099450         VARYING PV-RETRY-COUNTER                                 09945042
099460         FROM 1 BY 1                                              09946042
099470         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09947042
099480            OR  (SQLCODE = +100)                                  09948042
099490            OR  (SQLCODE = +0)                                    09949042
099491            OR  (SQLCODE = -811))                                 09949142
099492     EXEC SQL                                                     09949242
099493         SELECT                                                   09949342
099494             1                                                    09949442
099495         INTO                                                     09949542
099496             :PV-COUNT                                            09949642
099497         FROM                                                     09949742
099498            TSUOBTS OBTS                                          09949842
099499         WHERE OBTS.OTBND_TRIP_ID    = :SUOBTS-OTBND-TRIP-ID      09949942
099500           AND OBTS.TRIP_STAT_CDE    = :SUOBTS-TRIP-STAT-CDE      09950042
099501     END-EXEC                                                     09950142
099502                                                                  09950242
099503     EVALUATE TRUE                                                09950342
099504         WHEN SQLCODE = ZERO                                      09950442
099505         WHEN SQLCODE = -811                                      09950542
099506             SET PS-TSUOBTS-TRIP-INSERT-NO  TO TRUE               09950642
099507                                                                  09950742
099508             ADD +1 TO PA-TOTAL-DUPLICATE-STATUS                  09950842
099509             DISPLAY 'DUPLICATE TRIP STATUS'                      09950942
099510             DISPLAY '             TRIP ID : ' PV-INTR-TRIP-ID    09951042
099511             DISPLAY '         TRIP STATUS : ' PV-TRIP-STAT-CDE   09951142
099512                                                                  09951242
099513         WHEN SQLCODE = +100                                      09951342
099514             SET  PS-TSUOBTS-TRIP-INSERT-YES TO TRUE              09951442
099515         WHEN SQLCODE = -904                                      09951542
099516         WHEN SQLCODE = -911                                      09951642
099517         WHEN SQLCODE = -913                                      09951742
099518             DISPLAY '2210-CHECK-TRIP-STATUS'                     09951842
099519             DISPLAY 'DEADLOCK IN TSUOBTS =' SQLCODE              09951942
099520             CONTINUE                                             09952042
099521         WHEN OTHER                                               09952142
099522           DISPLAY '******************************************'   09952242
099523           DISPLAY '*ABEND                                   *'   09952342
099524           DISPLAY '*PROGRAM   = WSKUP009                    *'   09952442
099525           DISPLAY '*DB2 OPER  = SELECT FROM TSUOBTS         *'   09952542
099526           DISPLAY '*PARAGRAPH = 2210-CHECK-TRIP-STATUS      *'   09952642
099527           DISPLAY '*SQLCODE = ' SQLCODE                          09952742
099528           DISPLAY '******************************************'   09952842
099529           SET PS-ERROR-YES    TO TRUE                            09952942
099530     END-EVALUATE                                                 09953042
099531     END-PERFORM.                                                 09953142
099532                                                                  09953242
099540                                                                  09954007
099550 2220-CHECK-TRIP-SU.                                              09955042
099560                                                                  09956042
099580     PERFORM                                                      09958042
099590         WITH TEST AFTER                                          09959042
099591         VARYING PV-RETRY-COUNTER                                 09959142
099592         FROM 1 BY 1                                              09959242
099593         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               09959342
099594            OR  (SQLCODE = +100)                                  09959442
099595            OR  (SQLCODE = +0)                                    09959542
099596            OR  (SQLCODE = -811))                                 09959642
099597     EXEC SQL                                                     09959742
099598         SELECT                                                   09959842
099599             1                                                    09959942
099600         INTO                                                     09960042
099610             :PV-COUNT-SU                                         09961042
099620         FROM                                                     09962042
099630            TSUOBTS                                               09963042
099640         WHERE OTBND_TRIP_ID    = :SUOBTS-OTBND-TRIP-ID           09964042
099650           AND TRIP_STAT_CDE    = 'SU'                            09965042
099660     END-EXEC                                                     09966042
099670                                                                  09967042
099680     EVALUATE TRUE                                                09968042
099690         WHEN SQLCODE = ZERO                                      09969042
099691         WHEN SQLCODE = -811                                      09969142
099692             SET PS-TSUOBTS-TRIP-INSERT-NO  TO TRUE               09969242
099693                                                                  09969342
099694             ADD +1 TO PA-TOTAL-ALREADY-SU                        09969442
099695             DISPLAY 'TRIP ALREADY SU STATUS'                     09969542
099696             DISPLAY '             TRIP ID : ' PV-INTR-TRIP-ID    09969642
099697             DISPLAY '         TRIP STATUS : ' PV-TRIP-STAT-CDE   09969742
099698                                                                  09969842
099699         WHEN SQLCODE = +100                                      09969942
099700             SET  PS-TSUOBTS-TRIP-INSERT-YES TO TRUE              09970042
099701         WHEN SQLCODE = -904                                      09970142
099702         WHEN SQLCODE = -911                                      09970242
099703         WHEN SQLCODE = -913                                      09970342
099704             DISPLAY '2220-CHECK-TRIP-SU    '                     09970442
099705             DISPLAY 'DEADLOCK IN TSUOBTS =' SQLCODE              09970542
099706             CONTINUE                                             09970642
099710         WHEN OTHER                                               09971042
099720           DISPLAY '******************************************'   09972042
099730           DISPLAY '*ABEND                                   *'   09973042
099740           DISPLAY '*PROGRAM   = WSKUP009                    *'   09974042
099750           DISPLAY '*DB2 OPER  = SELECT FROM TSUOBTS         *'   09975042
099760           DISPLAY '*PARAGRAPH = 2220-CHECK-TRIP-SU          *'   09976042
099770           DISPLAY '*SQLCODE = ' SQLCODE                          09977042
099780           DISPLAY '******************************************'   09978042
099790           SET PS-ERROR-YES    TO TRUE                            09979042
099791     END-EVALUATE                                                 09979142
099792     END-PERFORM.                                                 09979242
099793                                                                  09979342
099794                                                                  09979442
099800******************************************************************09980007
227900****************************************************************  22790007
228200**   B E G I N     M Q    S E R I E S     P A R A G R A P H S **  22820007
228500****************************************************************  22850007
228600                                                                  22860007
228700****************************************************************  22870007
228800** CONNECT TO THE QUEUE MANAGER                                   22880007
229000** GET THE HANDLE TO THE QUEUE MANAGER - PV-HCONN                 22900007
229100****************************************************************  22910007
229200 3100-MQ-CONNECT-TO-QMGR.                                         22920007
229300                                                                  22930007
229400     MOVE '3100-MQ-CONNECT-TO-QMGR' TO PV-PARAGRAPH.              22940007
229500*                                                                 22950007
229600* CONNECT TO THE QUEUE                                            22960007
229900                                                                  22990007
230200     CALL PC-MQCONN USING PV-QMGR-NAME                            23020007
230300                          PV-HCONN                                23030007
230400                          PV-COMPLETION-CODE                      23040007
230500                          PV-REASON.                              23050007
230600                                                                  23060007
230700*IF CONNECTION FAILED THEN DISPLAY ERROR MESSAGE AND EXIT         23070007
230800     MOVE PV-REASON TO PV-CON-REASON.                             23080007
230900     IF PV-COMPLETION-CODE = MQCC-OK THEN                         23090007
231000         CONTINUE                                                 23100007
231100     ELSE                                                         23110007
231200         CALL PV-MQCHECK USING PV-REASON                          23120007
231300                               PV-MQ-REASON-TEXT                  23130007
231400         MOVE PV-QMGR-NAME         TO PE-MQ-QMANAGER              23140007
231500         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       23150007
231600         MOVE PV-REASON            TO PE-MQ-REASON-CODE           23160007
231700         MOVE 'CONNECT TO QMGR'    TO PV-ERROR-MESSAGE            23170007
231800         PERFORM 9200-MQ-ABEND                                    23180007
231900     END-IF.                                                      23190007
232000                                                                  23200007
232100****************************************************************  23210007
232200** OPEN THE ITEM QUEUE FOR GETS.                                  23220007
232300****************************************************************  23230007
232400 3200-MQ-QUEUE-OPEN.                                              23240007
232500                                                                  23250007
232600     MOVE '3200-MQ-QUEUE-OPEN'     TO PV-PARAGRAPH.               23260007
232700*                                                                 23270007
233000     MOVE PV-QUE-NM-INPUT          TO MQOD-OBJECTNAME             23300007
233100     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        23310007
233200                                                                  23320007
233300     COMPUTE PV-OPEN-OPTIONS       = MQOO-INPUT-SHARED            23330007
233400                                   + MQOO-OUTPUT                  23340007
233500                                   + MQOO-SET-IDENTITY-CONTEXT    23350007
233600                                   + MQOO-FAIL-IF-QUIESCING.      23360007
233700                                                                  23370007
233800     CALL PC-MQOPEN USING PV-HCONN                                23380007
233900                          MQM-OBJECT-DESCRIPTOR                   23390007
234000                          PV-OPEN-OPTIONS                         23400007
234100                          PV-GQ-HANDLE                            23410007
234200                          PV-COMPLETION-CODE                      23420007
234300                          PV-REASON.                              23430007
234400                                                                  23440007
234500     IF PV-COMPLETION-CODE = MQCC-OK THEN                         23450007
234600         CONTINUE                                                 23460007
234700     ELSE                                                         23470007
234800         CALL PV-MQCHECK USING PV-REASON                          23480007
234900                               PV-MQ-REASON-TEXT                  23490007
235000         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           23500007
235100         MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME              23510010
235200         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    23520007
235300         MOVE PV-REASON               TO PE-MQ-REASON-CODE        23530007
235400         MOVE 'OPEN ITEM QUEUE'       TO PV-ERROR-MESSAGE         23540007
235500         PERFORM 9200-MQ-ABEND                                    23550007
235600     END-IF.                                                      23560007
235700                                                                  23570007
235800****************************************************************  23580007
235900** OPEN THE ITEM QUEUE FOR PUTS.                                  23590007
236000****************************************************************  23600007
236100 3205-MQ-ERROR-QUEUE-OPEN.                                        23610007
236200                                                                  23620007
236300     MOVE '3205-MQ-ERROR-QUEUE-OPEN' TO PV-PARAGRAPH.             23630007
236400*                                                                 23640007
236700                                                                  23670007
236800     MOVE PV-QUE-NM-OUTPUT         TO MQOD-OBJECTNAME.            23680007
236900     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        23690007
237000                                                                  23700007
237100     COMPUTE PV-OPEN-OPTIONS       = MQOO-OUTPUT                  23710007
237200                                   + MQOO-SET-IDENTITY-CONTEXT    23720007
237300                                   + MQOO-FAIL-IF-QUIESCING.      23730007
237400                                                                  23740007
237500     CALL PC-MQOPEN USING PV-HCONN                                23750007
237600                          MQM-OBJECT-DESCRIPTOR                   23760007
237700                          PV-OPEN-OPTIONS                         23770007
237800                          PV-PQ-HANDLE                            23780007
237900                          PV-COMPLETION-CODE                      23790007
238000                          PV-REASON.                              23800007
238100                                                                  23810007
238200     IF PV-COMPLETION-CODE = MQCC-OK THEN                         23820007
238300         SET PS-ERROR-QUEUE-IS-OPEN-YES TO TRUE                   23830007
238400     ELSE                                                         23840007
238500         CALL PV-MQCHECK USING PV-REASON                          23850007
238600                               PV-MQ-REASON-TEXT                  23860007
238700         MOVE PV-QMGR-NAME         TO PE-MQ-QMANAGER              23870007
238800         MOVE PV-QUE-NM-OUTPUT     TO PE-MQ-QNAME                 23880009
238900         MOVE PV-COMPLETION-CODE   TO PE-MQ-COMPLETION-CODE       23890007
239000         MOVE PV-REASON            TO PE-MQ-REASON-CODE           23900007
239100         MOVE 'OPEN ERROR QUEUE'   TO PV-ERROR-MESSAGE            23910007
239200         PERFORM 9200-MQ-ABEND                                    23920007
239300     END-IF.                                                      23930007
239400                                                                  23940007
239440                                                                  23944013
239450                                                                  23945013
239500****************************************************************  23950007
239600** GET THE FIRST MESSAGE (ITEM) FROM THE QUEUE.                   23960007
239700** THE QUEUE IS SET UP SO MSGS ARE RETRIEVED IN FIFO ORDER.       23970007
239800****************************************************************  23980007
239900 3300-MQ-GET-MSG.                                                 23990007
240000                                                                  24000007
240100     INITIALIZE PV-MSGBUFFER                                      24010007
240200                PV-ERRMSGBUF                                      24020007
240300                WS014-RECEIPT-PIX-RECORD                          24030007
240400                PV-MSG.                                           24040007
240500                                                                  24050007
240600*MSG ID IS NOT POPULATED IN THIS PGM.                             24060007
240700     MOVE MQMI-NONE TO MQMD-MSGID.                                24070007
240800                                                                  24080007
240900*MSGS ARE UNQUALIFIED IN THIS PGM.                                24090007
241000     MOVE MQCI-NONE         TO MQMD-CORRELID.                     24100007
241100                                                                  24110007
241200*FORMAT TRANSLATES THE DATA ACROSS PLATFORMS, 4K IS THE           24120007
241300*MAX LENGTH FOR MSGS IN THE PGM.                                  24130007
241400     MOVE MQFMT-STRING         TO MQMD-FORMAT.                    24140007
241500     MOVE +203                 TO PV-MSG-LENGTH.                  24150007
241600                                                                  24160007
241700*THE UNLIMITED WAIT INTERVAL MEANS THAT PROCESSING WILL JUST      24170007
241800* 'WAIT' UNTIL A MESSAGE APPEARS ON THE Q.                        24180007
241900*    MOVE MQWI-UNLIMITED       TO MQGMO-WAITINTERVAL.             24190027
241901* 'WAIT' 6 SECONDS FOR NEXT MESSAGE.                              24190129
241910     MOVE PC-WAIT-6-SECS       TO MQGMO-WAITINTERVAL.             24191029
242000                                                                  24200007
242100     COMPUTE MQGMO-OPTIONS  =  MQGMO-SYNCPOINT +                  24210007
242200                               MQGMO-CONVERT   +                  24220007
242300                               MQGMO-ACCEPT-TRUNCATED-MSG +       24230007
242400                               MQGMO-WAIT.                        24240007
242500                                                                  24250007
242600     CALL PC-MQGET USING PV-HCONN                                 24260007
242700                         PV-GQ-HANDLE                             24270007
242800                         MQM-MESSAGE-DESCRIPTOR                   24280007
242900                         MQM-GET-MESSAGE-OPTIONS                  24290007
243000                         PV-MSG-LENGTH                            24300007
243100                         PV-MSGBUFFER                             24310007
243200                         PV-DATA-LENGTH                           24320007
243300                         PV-COMPLETION-CODE                       24330007
243400                         PV-REASON.                               24340007
243500                                                                  24350007
243600*IF GET FAILED THEN DISPLAY ERROR MESSAGE                         24360007
243700*AND BREAK OUT OF LOOP                                            24370007
243800     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        24380007
243900         IF ((PV-REASON NOT = MQRC-NO-MSG-AVAILABLE)              24390007
244000          AND (PV-REASON NOT = MQRC-TRUNCATED-MSG-ACCEPTED))      24400007
244100             CALL PV-MQCHECK USING PV-REASON                      24410007
244200                                   PV-MQ-REASON-TEXT              24420007
244300           MOVE 'MQGET ERROR'          TO PV-ERROR-MESSAGE        24430007
244400           MOVE '3300-MQ-GET-UNQUALIFIED' TO PV-PARAGRAPH         24440007
244500           MOVE PV-COMPLETION-CODE     TO PV-HOLD-COMPLETION-CODE 24450007
244600           MOVE PV-REASON              TO PV-HOLD-REASON          24460007
244700           PERFORM 3700-BACK-OUT-MQ                               24470007
244800           MOVE PV-HOLD-COMPLETION-CODE  TO PV-COMPLETION-CODE    24480007
244900                                            PE-MQ-COMPLETION-CODE 24490007
245000           MOVE PV-HOLD-REASON           TO PV-REASON             24500007
245100                                            PE-MQ-REASON-CODE     24510007
245200           PERFORM 9200-MQ-ABEND                                  24520007
245300         END-IF                                                   24530007
245400*THIS MEANS A MSG WAS TRUNCATED                                   24540007
245500         IF PV-COMPLETION-CODE = +1                               24550007
245600          AND PV-REASON = +2079                                   24560007
245700            PERFORM 4750-MSG-TOO-BIG-ERROR                        24570007
245800            ADD +1                       TO PA-TOTAL-GETS         24580007
245900         END-IF                                                   24590007
245901*THIS MEANS THAT THE QUEUE IS EMPTY                               24590127
245910         IF PV-REASON = MQRC-NO-MSG-AVAILABLE                     24591027
245920             SET PS-TIME-TO-END-PROGRAM-YES TO TRUE               24592027
245930         END-IF                                                   24593027
246000     ELSE                                                         24600007
246100        SET PS-GOOD-MSG-YES              TO TRUE                  24610007
246200        ADD +1                           TO PA-TOTAL-GETS         24620007
246300*PV-MSG IS USED TO PARSE THE DATA, ITS AN ELEMENT THAT JUST       24630007
246400*HOLDS THE ENTIRE ITEM UNTIL                                      24640007
246500*IT IS EITHER LOADED TO THE DB2 TABLE OR PUT TO THE ERROR QUEUE.  24650007
246600        MOVE PV-MSGBUFFER            TO PV-MSG                    24660007
246700        MOVE PV-MSGBUFFER            TO WS014-RECEIPT-PIX-RECORD. 24670007
246800                                                                  24680007
248800                                                                  24880007
249800****************************************************************  24980007
249900** CLOSES THE TRANS QUEUE.                                        24990007
250000****************************************************************  25000007
250100 3400-MQ-QUEUE-CLOSE.                                             25010007
250200                                                                  25020007
250300     MOVE '3400-MQ-QUEUE-CLOSE'    TO PV-PARAGRAPH.               25030007
250400                                                                  25040007
250500     MOVE PV-QUE-NM-INPUT          TO MQOD-OBJECTNAME.            25050009
250600     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        25060009
250700     CALL PC-MQCLOSE USING PV-HCONN                               25070007
250800                           PV-GQ-HANDLE                           25080007
250900                           MQCO-NONE                              25090007
251000                           PV-COMPLETION-CODE                     25100007
251100                           PV-REASON.                             25110007
251200                                                                  25120007
251300     IF PV-COMPLETION-CODE = MQCC-OK THEN                         25130007
251400         CONTINUE                                                 25140007
251500     ELSE                                                         25150007
251600         CALL PV-MQCHECK USING PV-REASON                          25160007
251700                               PV-MQ-REASON-TEXT                  25170007
251800         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           25180007
251900         MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME              25190009
252000         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    25200007
252100         MOVE PV-REASON               TO PE-MQ-REASON-CODE        25210007
252200         MOVE 'PE-MQ-CLOSE'           TO PV-ERROR-MESSAGE         25220007
252300         PERFORM 9200-MQ-ABEND                                    25230007
252400     END-IF.                                                      25240007
252500                                                                  25250007
252600****************************************************************  25260007
252700** CLOSES THE ERROR QUEUE.                                        25270007
252800****************************************************************  25280007
252900 3405-MQ-ERROR-QUEUE-CLOSE.                                       25290007
253000                                                                  25300007
253100     MOVE '3405-MQ-ERROR-QUEUE-CLOSE'  TO PV-PARAGRAPH.           25310007
253200                                                                  25320007
253300     MOVE PV-QUE-NM-OUTPUT         TO MQOD-OBJECTNAME.            25330009
253400     MOVE PV-QMGR-NAME             TO MQOD-OBJECTQMGRNAME.        25340009
253500                                                                  25350007
253600     CALL PC-MQCLOSE USING PV-HCONN                               25360007
253700                           PV-PQ-HANDLE                           25370007
253800                           MQCO-NONE                              25380007
253900                           PV-COMPLETION-CODE                     25390007
254000                           PV-REASON.                             25400007
254100                                                                  25410007
254200     IF PV-COMPLETION-CODE = MQCC-OK THEN                         25420007
254300         SET PS-ERROR-QUEUE-IS-OPEN-NO TO TRUE                    25430007
254400     ELSE                                                         25440007
254500         CALL PV-MQCHECK USING PV-REASON                          25450007
254600                               PV-MQ-REASON-TEXT                  25460007
254700         MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER           25470007
254800         MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME              25480009
254900         MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE    25490007
255000         MOVE PV-REASON               TO PE-MQ-REASON-CODE        25500007
255100         MOVE 'PE-ERROR-Q-CLOSE'      TO PV-ERROR-MESSAGE         25510007
255200         PERFORM 9200-MQ-ABEND                                    25520007
255300     END-IF.                                                      25530007
255400                                                                  25540007
255500****************************************************************  25550007
255600** DISCONNECT FROM THE QUEUE MANAGER                              25560007
255700****************************************************************  25570007
255800 3500-DISCONNECT-QMGR.                                            25580007
255900                                                                  25590007
256000     MOVE '3500-DISCONNECT-QMGR'    TO PV-PARAGRAPH.              25600007
256100     CALL PC-MQDISC USING PV-HCONN                                25610007
256200                          PV-COMPLETION-CODE                      25620007
256300                          PV-REASON                               25630007
256400                                                                  25640007
256500     IF PV-COMPLETION-CODE = MQCC-OK THEN                         25650007
256600        CONTINUE                                                  25660007
256700     ELSE                                                         25670007
256800         CALL PV-MQCHECK USING PV-REASON                          25680007
256900                               PV-MQ-REASON-TEXT                  25690007
257000        MOVE PV-QMGR-NAME            TO PE-MQ-QMANAGER            25700007
257100        MOVE PV-QUE-NM-INPUT         TO PE-MQ-QNAME               25710009
257200        MOVE PV-COMPLETION-CODE      TO PE-MQ-COMPLETION-CODE     25720007
257300        MOVE PV-REASON               TO PE-MQ-REASON-CODE         25730007
257400        MOVE '3500-DISCONNECT-QMGR'  TO PV-ERROR-MESSAGE          25740007
257500        PERFORM 9200-MQ-ABEND                                     25750007
257600     END-IF.                                                      25760007
257700                                                                  25770007
257800******************************************************************25780007
257900*  COMMIT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT        25790007
258000******************************************************************25800007
258100 3600-MQ-COMMIT.                                                  25810007
258200                                                                  25820007
258300     CALL PC-MQCMIT USING PV-HCONN                                25830007
258400                          PV-COMPLETION-CODE                      25840007
258500                          PV-REASON.                              25850007
258600                                                                  25860007
258700     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        25870007
258800         CALL PV-MQCHECK USING PV-REASON                          25880007
258900                               PV-MQ-REASON-TEXT                  25890007
259000        MOVE '3600-COMMIT-MQ'   TO PV-PARAGRAPH                   25900007
259100        MOVE 'MQCMIT ERROR'     TO PV-ERROR-MESSAGE               25910007
259200        MOVE PV-COMPLETION-CODE TO PV-HOLD-COMPLETION-CODE        25920007
259300        MOVE PV-REASON          TO PV-HOLD-REASON                 25930007
259400        PERFORM 3700-BACK-OUT-MQ                                  25940007
259500        MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE        25950007
259600                                        PE-MQ-COMPLETION-CODE     25960007
259700        MOVE PV-HOLD-REASON          TO PV-REASON                 25970007
259800                                        PE-MQ-REASON-CODE         25980007
259900        PERFORM 9200-MQ-ABEND                                     25990007
260200     END-IF.                                                      26020007
260300                                                                  26030007
260400******************************************************************26040007
260500* BACK OUT MQ PROCESSING SINCE THE POINT OF THE LAST COMMIT       26050007
260600******************************************************************26060007
260700 3700-BACK-OUT-MQ.                                                26070007
260800                                                                  26080007
260900     CALL PC-MQBACK USING PV-HCONN                                26090007
261000                          PV-COMPLETION-CODE                      26100007
261100                          PV-REASON.                              26110007
261200                                                                  26120007
261300     IF (PV-COMPLETION-CODE NOT = MQCC-OK) THEN                   26130007
261400         CALL PV-MQCHECK USING PV-REASON                          26140007
261500                               PV-MQ-REASON-TEXT                  26150007
261600        MOVE '3700-BACK-OUT-MQ'  TO PV-PARAGRAPH                  26160007
261700        MOVE 'MQBACK ERROR'      TO PV-ERROR-MESSAGE              26170007
261800        PERFORM 9200-MQ-ABEND                                     26180007
261900     END-IF.                                                      26190007
262000                                                                  26200007
262100****************************************************************  26210007
262200* PUT MESSAGE IN ERROR TO THE ITEM ERROR QUEUE                    26220007
262300****************************************************************  26230007
262400 3800-PUT-MSG-TO-ERROR-Q.                                         26240007
262500                                                                  26250007
262510     MOVE PC-CURRENT-PROGRAM-NAME  TO WS020-ERROR-PGM-NAME.       26251007
262520     MOVE WS014-RECEIPT-PIX-RECORD TO WS020-WSRD014-RECORD.       26252007
262550                                                                  26255007
262600*UPDATE THE ERROR MESSAGE COUNTER.                                26260007
262700     ADD +1 TO PA-TOTAL-ERRORQ-RECS.                              26270007
262800                                                                  26280007
262900*MSGID IS NOT POPULATED AT ALL IN THIS PGM.                       26290007
263000     MOVE MQMI-NONE        TO MQMD-MSGID.                         26300007
263100                                                                  26310007
263310*MSGS ARE UNQUALIFIED IN THIS PGM.                                26331007
263320     MOVE MQCI-NONE            TO MQMD-CORRELID.                  26332007
263400                                                                  26340007
263600     MOVE WS020-RECEIPT-PIX-ERROR-REC TO PV-ERRMSGBUF.            26360009
263700                                                                  26370007
263800*THE ENTIRE MSG LENGTH IS +226.                                   26380016
263900     MOVE +226 TO PV-MSG-LENGTH.                                  26390016
264000                                                                  26400007
264100*SET OPTIONS.                                                     26410007
264200     MOVE MQFMT-STRING     TO MQMD-FORMAT.                        26420007
264300     MOVE MQPER-PERSISTENT TO MQMD-PERSISTENCE.                   26430007
264400     COMPUTE MQPMO-OPTIONS  =  MQPMO-SYNCPOINT +                  26440007
264500                               MQPMO-SET-IDENTITY-CONTEXT.        26450007
264600                                                                  26460007
264700*PUT MSG.                                                         26470007
264800     CALL PC-MQPUT USING PV-HCONN                                 26480007
264900                         PV-PQ-HANDLE                             26490007
265000                         MQM-MESSAGE-DESCRIPTOR                   26500007
265100                         MQM-PUT-MESSAGE-OPTIONS                  26510007
265200                         PV-MSG-LENGTH                            26520007
265300                         PV-ERRMSGBUF                             26530007
265400                         PV-COMPLETION-CODE                       26540007
265500                         PV-REASON.                               26550007
265600                                                                  26560007
265700*IF PUT FAILED THEN DISPLAY ERROR MESSAGE                         26570007
265800*AND BREAK OUT OF LOOP                                            26580007
265900     IF (PV-COMPLETION-CODE NOT = MQCC-OK)                        26590007
266000         CALL PV-MQCHECK USING PV-REASON                          26600007
266100                               PV-MQ-REASON-TEXT                  26610007
266200         DISPLAY 'MQ MESSAGE = ', PV-ERRMSGBUF                    26620007
266300         MOVE '3800-PUT-MSG-TO-ERROR-Q' TO PV-PARAGRAPH           26630007
266400         MOVE 'MQPUT FAILED'          TO PV-ERROR-MESSAGE         26640007
266500         MOVE PV-COMPLETION-CODE      TO PV-HOLD-COMPLETION-CODE  26650007
266600         MOVE PV-REASON               TO PV-HOLD-REASON           26660007
266700         PERFORM 3700-BACK-OUT-MQ                                 26670007
266800         MOVE PV-HOLD-COMPLETION-CODE TO PV-COMPLETION-CODE       26680007
266900                                         PE-MQ-COMPLETION-CODE    26690007
267000         MOVE PV-HOLD-REASON          TO PV-REASON                26700007
267100                                         PE-MQ-REASON-CODE        26710007
267200         PERFORM 9200-MQ-ABEND                                    26720007
267300     END-IF.                                                      26730007
267400                                                                  26740007
269900******************************************************************26990007
270000* THERE IS A MSG IN THE QUEUE LARGER THAN THE CURRENT PV-MSGBUFFER27000007
270100******************************************************************27010007
270200 4750-MSG-TOO-BIG-ERROR.                                          27020007
270300                                                                  27030007
270400     SET PS-ERROR-YES                                             27040007
270500         PS-END-OF-MSG-YES TO TRUE.                               27050007
270700                                                                  27070007
270800******************************************************************27080007
270900****************************************************************  27090007
271000* !!! I M P O R T A N T !!!                                       27100007
271100*                                                                 27110007
271200* THE 'STOP RUN' NEEDS TO BE HERE INSTEAD OF IN THE MAIN LINE OF  27120007
271300* THE PROGRAM BECAUSE THIS IS CODED AS A STARTED TASK, AND THIS   27130007
271400* PROGRAM WILL RUN CONTINUOUSLY UNTIL IT RECEIVES THE 'END RUN    27140007
271500* OF PROGRAM' MESSAGE. IF THE STOP RUN IS MOVED TO THE MAIN LINE  27150007
271600* THE RESULT WILL BE AN MQ HCONN_ERROR !!!!!                      27160007
271700*                                                                 27170007
271800* END RUN OF PROGRAM ROUTINE:                                     27180007
271900* CLOSE QUEUE(S)                                                  27190007
272000* DISCONNECT FROM QMGR                                            27200007
272100* DISPLAY SUMMARY STATISTICS                                      27210007
272200****************************************************************  27220007
272300 5000-END-RUN-ROUTINE.                                            27230007
272400                                                                  27240007
272500*CLOSE THE TRANS QUEUE.                                           27250007
272600     PERFORM 3400-MQ-QUEUE-CLOSE.                                 27260007
272700                                                                  27270007
272800*CLOSE THE ERROR QUEUE IF OPEN.                                   27280007
272900     IF PS-ERROR-QUEUE-IS-OPEN-YES                                27290007
273000        PERFORM 3405-MQ-ERROR-QUEUE-CLOSE                         27300007
273100     END-IF.                                                      27310007
273200                                                                  27320007
273300*DISCONNECT FROM THE QMGR.                                        27330007
273400     PERFORM 3500-DISCONNECT-QMGR.                                27340007
273500                                                                  27350007
273600*END OF JOB ROUTINE.                                              27360007
273700     PERFORM 8000-EOJ-ROUTINE.                                    27370007
273800                                                                  27380007
273900*END PROGRAM.                                                     27390007
274000     DISPLAY '************  END OF WSKUP009  ***************'     27400007
274100     STOP RUN.                                                    27410007
274200                                                                  27420007
274300******************************************************************27430007
274400* COMMITTED RECORDS WILL REMAIN IN DB2 TABLES AFTER AN ABEND.     27440007
274500******************************************************************27450007
274600 6000-DB2-COMMIT.                                                 27460007
274700                                                                  27470007
274800     EXEC SQL                                                     27480007
274900         COMMIT                                                   27490007
275000     END-EXEC.                                                    27500007
275100                                                                  27510007
275200     EVALUATE TRUE                                                27520007
275300         WHEN SQLCODE = +0                                        27530007
275400              ADD +1  TO PA-TOTAL-DB2-COMMITS                     27540007
275500         WHEN SQLWARN0 NOT = SPACES                               27550007
275600         WHEN SQLCODE  NOT = ZERO                                 27560007
275700         DISPLAY '****************************'                   27570007
275800         DISPLAY '** ABEND                  **'                   27580007
275900         DISPLAY '** PROGRAM = WSKUP009     **'                   27590007
276000         DISPLAY '** PARAGRAPH = 6000-COMMIT**'                   27600007
276100         DISPLAY '** UNSUCCESSFUL COMMIT    **'                   27610007
276200         DISPLAY '****************************'                   27620007
276300         PERFORM 9100-SQL-ABEND                                   27630007
276400     END-EVALUATE.                                                27640007
276500                                                                  27650007
276600****************************************************************  27660007
276700* OPEN THE ERROR QUEUE IF IT HAS NOT BEEN ALREADY.                27670020
277000****************************************************************  27700007
277100 7100-ERROR-ROUTINE.                                              27710007
277200                                                                  27720007
277300*OPEN ERROR QUEUE                                                 27730007
277400     IF PS-ERROR-QUEUE-IS-OPEN-NO                                 27740007
277500        PERFORM 3205-MQ-ERROR-QUEUE-OPEN                          27750007
277600     END-IF.                                                      27760007
277700                                                                  27770007
278200****************************************************************  27820007
278800****************************************************************  27880007
279100** E N D    O F    M Q    S E R I E S     P A R A G R A P H S **  27910007
279400****************************************************************  27940007
279500                                                                  27950007
279600******************************************************************27960007
279700* UPDATE CHECKPOINT STATUS CODE WITH 0 FOR COMPLETION.            27970007
279800* DISPLAY STATISTICS FOR THE PROGRAM                              27980007
279900******************************************************************27990007
280000 8000-EOJ-ROUTINE.                                                28000007
280100                                                                  28010007
280400         DISPLAY ' ********************************************'  28040007
280500         DISPLAY '     * WSKUP009 SUMMARY STATISTICS *         '  28050007
280600         DISPLAY ' '                                              28060007
281100         DISPLAY ' TOTAL TRAILER STATUS INSERTS      :'           28110007
281200                                        PA-TOTAL-STATUS-INSERTS   28120007
283500         DISPLAY ' TOTAL MESSAGES READ               :'           28350007
283600                                        PA-TOTAL-GETS             28360007
283900         DISPLAY ' TOTAL MESSAGES IN ERROR           :'           28390007
284000                                        PA-TOTAL-ERRORQ-RECS      28400007
284010                                                                  28401042
284020         DISPLAY ' TOTAL DUPLICATE SO\SU MESSAGES    :'           28402039
284030                                        PA-TOTAL-DUPLICATE-STATUS 28403035
284040                                                                  28404042
284050         DISPLAY ' TOTAL TRIP IN SU STATUS-BYPASS SO :'           28405042
284060                                        PA-TOTAL-ALREADY-SU       28406042
284070                                                                  28407042
284100         DISPLAY ' TOTAL DB2 COMMITS                 :'           28410007
284200                                        PA-TOTAL-DB2-COMMITS      28420007
284500         DISPLAY '********************************************'.  28450007
284600                                                                  28460007
284700******************************************************************28470007
284800* 9100-SQL-ABEND - PERFORMS THE ABEND FOR THE PROGRAM IN THE      28480007
284900* EVENT THAT AN SQL ERROR OR WARNING CODE OCCURS.                 28490007
284910*                                                                 28491030
284920* THIS ROUTINE SHOULD ONLY BE CALLED IF THERE IS A SQL ERROR      28492030
284930* FOR GETTING QUEUE NAMES OR OTHER PROGRAM LEVEL PROCESSING.      28493030
284940*                                                                 28494030
284950* IF A SQL ERROR OCCURS WHILE PROCESSING A MESSAGE, THEN SET      28495030
284960* THE PS-ERROR SWITCH, WRITE THE RECORD TO THE ERROR QUEUE        28496030
284970* AND CONTINUE PROCESSING                                         28497030
285000******************************************************************28500007
285100 9100-SQL-ABEND.                                                  28510007
285200                                                                  28520007
285202* WRITE THE MESSAGE TO THE ERROR QUEUE                            28520225
285203                                                                  28520325
285210     PERFORM 7100-ERROR-ROUTINE.                                  28521025
285220     PERFORM 3800-PUT-MSG-TO-ERROR-Q.                             28522025
285230     PERFORM 3600-MQ-COMMIT.                                      28523025
285250                                                                  28525030
285300* THIS COPY BOOK MEMBER CONTAINS THE PROCEDURE DIVISION STATE-    28530007
285400* MENTS THAT ARE REQUIRED TO UTILIZE THE DB2 ABEND MODULE         28540007
285500* 'DSNTIAR' AND CONVERT THE SQLCA INFORMATION INTO A READABLE     28550007
285600* FORMAT                                                          28560007
285700     COPY DPPD004.                                                28570030
285800                                                                  28580007
285900     DISPLAY '***********************************'.               28590030
286000     DISPLAY '     ITEM DOMAIN DOWNLOAD ABEND   *'.               28600030
286100     DISPLAY '***********************************'.               28610030
286200     DISPLAY '* CURRENT STATS AT TIME OF ABEND  *'.               28620030
286300     DISPLAY '***********************************'.               28630030
286400     DISPLAY 'TSUOBTS ROWS CREATED :' PA-TOTAL-STATUS-INSERTS     28640030
286600     DISPLAY 'NBR OF GETS          :' PA-TOTAL-GETS.              28660030
286700     DISPLAY '***********************************'.               28670030
286800     DISPLAY '*         COMMIT STATS            *'.               28680030
286900     DISPLAY '***********************************'.               28690030
287000     DISPLAY 'DB2 COMMITS          :' PA-TOTAL-DB2-COMMITS.       28700030
287100     DISPLAY '***********************************'.               28710030
287200     DISPLAY ' '.                                                 28720030
287300     MOVE +4013 TO PV-ABEND-CODE.                                 28730030
287400     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         28740030
287500                                                                  28750007
287600****************************************************************  28760007
287700** PERFORM MQ-SERIES ABEND PROCESSING                             28770007
287800****************************************************************  28780007
287900 9200-MQ-ABEND.                                                   28790007
288000                                                                  28800007
288100     DISPLAY '**** ABEND *************************************'.  28810007
288200     DISPLAY '** MQSERIES ERROR **'.                              28820007
288300     DISPLAY '** PROGRAM:    ', PC-CURRENT-PROGRAM-NAME.          28830007
288400     DISPLAY '** ABEND CODE: ', PV-ABEND-CODE.                    28840007
288500     DISPLAY '** PARAGRAPH:  ', PV-PARAGRAPH.                     28850007
288600     DISPLAY '** MESSAGE:    ', PV-ERROR-MESSAGE.                 28860007
288700     DISPLAY '** COMP CODE:  ', PE-MQ-COMPLETION-CODE.            28870007
288800     DISPLAY '** RSN CODE:   ', PE-MQ-REASON-CODE.                28880007
288900     DISPLAY '** RSN TEXT:   ', PV-MQ-REASON-TEXT.                28890007
289000     DISPLAY '************************************************'.  28900007
289100     MOVE +4013 TO PV-ABEND-CODE.                                 28910007
289200     CALL 'ILBOABN0' USING PV-ABEND-CODE.                         28920007
289300                                                                  28930007
289400******************************************************************28940007
289500**                      END OF PROGRAM                            28950007
289700******************************************************************28970007
