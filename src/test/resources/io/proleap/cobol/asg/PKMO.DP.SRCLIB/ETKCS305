00001 *-----------------------*                                         08/03/94
00002  IDENTIFICATION DIVISION.                                         ETKCS305
00003 *-----------------------*                                            LV015
00004  PROGRAM-ID.    ETKCS305.                                            CL**5
00005  AUTHOR.        J. SCHMIDT                                           CL**5
00006  INSTALLATION.  KOHLS DEPARTMENT STORES.                             CL**5
00007  DATE-WRITTEN.  01-05-94.                                            CL**5
00008  DATE-COMPILED.                                                      CL**5
00009                                                                      CL**5
00010 *----------------------------------------------------------------*   CL**5
00011 *    E305 - EDI TRADING PARTNER CRITERIA SPEC SCREEN             *   CL**5
00012 *                                                                *   CL**5
00013 *    THIS PROGRAM IS THE ENTRY POINT TO THE EDI TRADING PARTNER- *   CL**5
00014 *    SHIP LEVEL INFORMATION (LIST, INQUIRY, MAINTENANCE).        *   CL**5
00015 *                                                                *   CL**5
00016 *    IT CAN BE ACCESSED FROM EITHER THE ETMENU UNDER THE         *   CL**5
00017 *    CICS ARCHITECTURE, OR BY A USER HITTING A LOCAL-GO-TO       *   CL**5
00018 *    PF-KEY FROM THE VENDOR LIST SCREEN (ETLVNDRS).              *   CL**5
00019 *                                                                *   CL**5
00020 *    EITHER THE USER WILL HAVE ALREADY SELECTED ONE OR MORE      *   CL**5
00021 *    VENDORS FROM THE (ETLVNDRS) EDI VENDOR LIST SCREEN AND      *   CL**5
00022 *    CAME TO THIS MODULE VIA A LOCAL-GO-TO PF-KEY, AND WITH      *   CL**5
00023 *    THE TEMPORARY STORAGE QUE THAT WAS BUILT BY THE LIST;       *   CL**5
00024 *    OR THE USER HAS COME DIRECTLY TO THIS MODULE FROM THE       *   CL**5
00025 *    ETMENU AND MUST ENTER EITHER A VENDOR NAME, TP ID QUALIFIER,*   CL**5
00026 *    TRADING PARTNER ID, OR NETWORK NUMBER.                      *   CL**5
00027 *                                                                *   CL**5
00028 *    AFTER INITIAL VALIDATION, AND IF NO ERRORS ARE DETECTED     *   CL**5
00029 *    CONTROL IS PASSED TO ETKCS306; THE LIST PROGRAM.            *   CL**5
00030 *                                                                *   CL**5
00031 *----------------------------------------------------------------*   CL**5
CICS  *  CHANGED 10/25/2022    BY BARB SCHULTZ    WR: CHG0277210           CL**5
CICS  *                                                                    CL**5
CICS  *  ADDED COPYBOOK DPWS930 AND MADE THE CICS ARCHITECTURE CALL        CL**5
CICS  *  DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.         CL**5
CICS  *---------------------------------------------------------------*    CL**5
00032                                                                      CL**5
00033                                                                      CL**5
00034  ENVIRONMENT DIVISION.                                               CL**5
00035                                                                      CL**5
00036                                                                      CL**5
00037                                                                      CL**5
00038  DATA DIVISION.                                                      CL**5
00039                                                                      CL**5
00040                                                                      CL**5
00041  EJECT                                                               CL**5
00042  WORKING-STORAGE SECTION.                                            CL**5
00043                                                                      CL**5
00044  01  DK-DB2-KEYS.                                                    CL**5
00045      05  DK-NETWK-ID              PIC  X(01).                        CL**5
00046      05  DK-TRAN-SET              PIC  X(03).                        CL**6
00047                                                                      CL**5
00048  01  PC-PROGRAM-CONSTANTS.                                           CL**5
00049      05  PC-CURRENT-PROGRAM-NAME  PIC  X(08)  VALUE  'ETKCS305'.     CL**5
00050      05  PC-CURRENT-MAP-NAME      PIC  X(08)  VALUE  'ET305A  '.     CL**5
00051      05  PC-CURRENT-MAPSET-NAME   PIC  X(08)  VALUE  'ETKM305 '.     CL**5
00052                                                                      CL**5
00053      05  PC-APPL-MAP              PIC S9(04)  VALUE  +1              CL**5
00054                                               COMP.                  CL**5
00055      05  PC-MAX-RETRIES           PIC S9(04)  VALUE  +3              CL**5
00056                                               COMP.                  CL**5
00057      05  PC-MAX-MSG-VAR           PIC S9(04)  VALUE  +1              CL**5
00058                                               COMP.                  CL**5
00059                                                                      CL**5
00060      05  PC-INTER-APPL-CODES.                                        CL**5
00061          10  PC-INTER-APPL-CRIT-SPEC                                 CL**5
00062                                   PIC  X(01)  VALUE '1'.             CL**5
00063          10  PC-INTER-APPL-LIST   PIC  X(01)  VALUE '2'.             CL**5
00064                                                                      CL**5
00065      05  PC-MSG-VAR-SYMBOLIC      PIC  X(04)  VALUE '&VAR'.          CL**5
00066      05  PC-ASTERISK              PIC  X(01)  VALUE '*'.             CL**5
00067                                                                      CL**5
00068      05  PC-TSYMSG-NUMBERS.                                          CL**5
00069          10  PC-TSYMSG-00005      PIC  9(05)  VALUE  00005.          CL**5
00070          10  PC-TSYMSG-00007      PIC  9(05)  VALUE  00007.          CL**5
00071          10  PC-TSYMSG-00008      PIC  9(05)  VALUE  00008.          CL**5
00072          10  PC-TSYMSG-00017      PIC  9(05)  VALUE  00017.          CL**5
00073          10  PC-TSYMSG-00034      PIC  9(05)  VALUE  00034.          CL**5
00074 *            ** 0034 - ADD SUCCESSFUL **                             CL**5
00075          10  PC-TSYMSG-00059      PIC  9(05)  VALUE  00059.          CL**5
00076          10  PC-TSYMSG-00069      PIC  9(05)  VALUE  00069.          CL**5
00077          10  PC-TSYMSG-00070      PIC  9(05)  VALUE  00070.          CL**5
00078          10  PC-TSYMSG-00095      PIC  9(05)  VALUE  00095.          CL**5
00079          10  PC-TSYMSG-00137      PIC  9(05)  VALUE  00137.          CL**5
00080          10  PC-TSYMSG-00148      PIC  9(05)  VALUE  00148.          CL**5
00081          10  PC-TSYMSG-00302      PIC  9(05)  VALUE  00302.          CL**5
00082          10  PC-TSYMSG-00388      PIC  9(05)  VALUE  00388.          CL**5
00083          10  PC-TSYMSG-00543      PIC  9(05)  VALUE  00543.          CL**5
00084          10  PC-TSYMSG-00551      PIC  9(05)  VALUE  00551.          CL**5
00085          10  PC-TSYMSG-00697      PIC  9(05)  VALUE  00697.          CL**5
00086          10  PC-TSYMSG-00758      PIC  9(05)  VALUE  00758.          CL**5
00087          10  PC-TSYMSG-99901      PIC  9(05)  VALUE  99901.          CL**5
00088          10  PC-TSYMSG-99903      PIC  9(05)  VALUE  99903.          CL**5
00089                                                                      CL**5
00090  01  PS-PROGRAM-SWITCHES.                                            CL**5
00091      05  PS-ERROR-SW              PIC  X(01)  VALUE  'N'.            CL**5
00092          88  PS-ERROR                         VALUE  'Y'.            CL**5
00093          88  PS-NO-ERROR                      VALUE  'N'.            CL**5
00094      05  PS-COMMAREA-SW           PIC  X(01)  VALUE  'Y'.            CL**5
00095          88  PS-COMMAREA-VALID                VALUE  'Y'.            CL**5
00096          88  PS-COMMAREA-NOT-VALID            VALUE  'N'.            CL**5
00097      05  PS-RETURN-PROCESSING-SW  PIC  X(01)  VALUE  'N'.            CL**5
00098          88  PS-RETURN-PROCESSING             VALUE  'Y'.            CL**5
00099          88  PS-REGULAR-PROCESSING            VALUE  'N'.            CL**5
00100      05  PS-INTRCHG-QUAL-SW       PIC  X(01)  VALUE  'N'.            CL**5
00101          88  PS-INTRCHG-QUAL-FOUND            VALUE  'Y'.            CL**5
00102          88  PS-INTRCHG-QUAL-NOT-FND          VALUE  'N'.            CL**5
00103                                                                      CL**5
00104  01  PV-PROGRAM-VARIABLES.                                           CL**5
00105      05  PV-CICS-RESPONSE         PIC S9(04)  VALUE +0               CL**5
00106                                               COMP SYNC.             CL**5
00107      05  PV-RETRY-COUNTER         PIC S9(04)  VALUE +0               CL**5
00108                                               COMP SYNC.             CL**5
00109      05  PV-ASTERISK-CNT          PIC S9(04)  VALUE +0               CL**5
00110                                               COMP SYNC.             CL**5
00111      05  PV-NULL                  PIC S9(04)  VALUE +0               CL**5
00112                                               COMP SYNC.             CL**5
00113      05  PV-COUNTER               PIC  9(05)  VALUE 0.               CL**5
00114                                                                      CL**5
00115      05  PV-ENT-ACTION            PIC  X(03)  VALUE SPACES.          CL**5
00116                                                                      CL**5
00117 *----------------------------------------------------------------*   CL**5
00118 *    EDI ELEMENT 66 - INTERCHANGE QUALIFIER VALIDATION           *   CL**5
00119 *----------------------------------------------------------------*   CL**5
00120                                                                      CL**5
00121      COPY ETWS305.                                                   CL**5
00122                                                                      CL**5
00123  EJECT                                                               CL**5
00124 *----------------------------------------------------------------*   CL**5
00125 *    SELECTED VENDOR LIST ITEMS TEMP STORAGE QUEUE               *   CL**5
00126 *----------------------------------------------------------------*   CL**5
00127                                                                      CL**5
00128      COPY ETWS301.                                                   CL**5
00129                                                                      CL**5
00130  EJECT                                                               CL**5
00131 *----------------------------------------------------------------*   CL**5
00132 *    MAP LAYOUT                                                  *   CL**5
00133 *----------------------------------------------------------------*   CL**5
00134                                                                      CL**5
00135      COPY ETKM305.                                                   CL**5
00136                                                                      CL**5
00137  EJECT                                                               CL**5
00138 *----------------------------------------------------------------*   CL**5
00139 *    ATTRIBUTE SETTINGS COPYBOOK.                                *   CL**5
00140 *----------------------------------------------------------------*   CL**5
00141                                                                      CL**5
00142      COPY DPWS015.                                                   CL**5
00143                                                                      CL**5
00144  EJECT                                                               CL**5
00145 *----------------------------------------------------------------*   CL**5
00146 *    FUNCTION KEYS COPYBOOK                                      *   CL**5
00147 *----------------------------------------------------------------*   CL**5
00148                                                                      CL**5
00149      COPY DPWS016.                                                   CL**5
00150                                                                      CL**5
00151  EJECT                                                               CL**5
00152 *----------------------------------------------------------------*   CL**5
00153 *  THE CALLING PARAMETER LIST (DPWS010) FOR THE NUMERIC EDIT     *   CL**5
00154 *  SUB-ROUTINE (DPKUT100).                                       *   CL**5
00155 *----------------------------------------------------------------*   CL**5
00156      COPY DPWS010I.                                                  CL**5
00157                                                                      CL**5
00158  EJECT                                                               CL**5
00159 *----------------------------------------------------------------*   CL**5
CICS  *  PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.             *   CL**5
00162 *----------------------------------------------------------------*   CL**5
00163      COPY DPWS030.                                                   CL**5
CICS       COPY DPWS930.                                                   CL**5
00164                                                                      CL**5
00165  EJECT                                                               CL**5
00166 **--------------------------------------------------------------**   CL**5
00167 *    STANDARD COMMAREA.                                              CL**5
00168 **--------------------------------------------------------------**   CL**5
00169                                                                      CL**5
00170      COPY DPWS020.                                                   CL**5
00171                                                                      CL**5
00172  EJECT                                                               CL**5
00173                                                                      CL**5
00174      05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                   CL**5
00175                                                                      CL**5
00176 *****************************************************************    CL**5
00177 *    INTER-APPLICATION COMMAREA.                                     CL**5
00178 *****************************************************************    CL**5
00179                                                                      CL**5
00180          10  INTER-APPL-COMM-AREA           PIC X(200).              CL**5
00181                                                                      CL**5
00182  EJECT                                                               CL**5
00183                                                                      CL**5
00184      COPY ETWS300.                                                   CL*15
00185                                                                      CL**5
00186  EJECT                                                               CL**5
00187 *****************************************************************    CL**5
00188 *    SPECIFIC COMMMAREA FOR ETKCS305.                                CL**5
00189 *****************************************************************    CL**5
00190          10  ASC-APPL-SPECIFIC-COMMAREA.                             CL**5
00191                                                                      CL**5
00192              15  ASC-INT-APPL-FORMAT-IND       PIC  X(01).           CL**5
00193                  88  ASC-ET-MENU                      VALUE ' '.     CL**5
00194                  88  ASC-VNDR-LIST                    VALUE '2'.     CL**5
00195                                                                      CL**5
00196              15  ASC-TEMP-STORAGE-CNTL.                              CL**5
00197                  20  ASC-USE-SELECTION-SW      PIC  X(01).           CL**5
00198                      88  ASC-USE-SELECTION-QUEUE      VALUE 'S'.     CL**5
00199                      88  ASC-NO-SELECTION-QUEUE       VALUE 'N'.     CL**5
00200                                                                      CL**5
00201                  20  ASC-SEL-QUEUE-NAME        PIC  X(08).           CL**5
00202                  20  ASC-NUMBER-OF-TS-ITEMS    PIC S9(05) COMP-3.    CL**5
00203                  20  ASC-NUMBER-OF-SELECTED-ITEMS                    CL**5
00204                                                PIC S9(09) COMP-3.    CL**5
00205                  20  ASC-SEL-SUB               PIC S9(04) COMP.      CL**5
00206                  20  ASC-SEL-ITEM              PIC S9(04) COMP.      CL**5
00207                                                                      CL**5
00208              15  ASC-KEY-DATA.                                       CL**5
00209 *                (FROM KEY-DATA AREA IN TS QUEUE 'ETWS301')          CL**5
00210                  20  ASC-ENT-ID-KEY            PIC S9(09) COMP.      CL**5
00211                  20  ASC-VENDOR-NAME-KEY       PIC  X(30).           CL**5
00212                                                                      CL**5
00213              15  ASC-SCREEN-FIELDS.                                  CL**5
00214                  20  ASC-VENDOR-NAME           PIC  X(30).           CL**5
00215                  20  ASC-TP-QUALIFIER          PIC  X(02).           CL**5
00216                  20  ASC-TP-ID                 PIC  X(15).           CL**5
00217                  20  ASC-NETWORK               PIC  X(01).           CL**5
00218                  20  ASC-TRAN-SET              PIC  X(03).           CL**6
00219                                                                      CL**5
00220              15  ASC-HOLD-INTER-APPL           PIC  X(200).          CL**5
00221                                                                      CL**5
00222              15  FILLER                        PIC  X(197).          CL**8
00223                                                                      CL**5
00224  EJECT                                                               CL**5
00225 *----------------------------------------------------------------*   CL**5
00226 *    ABEND PROCESSING COPYBOOK.                                  *   CL**5
00227 *----------------------------------------------------------------*   CL**5
00228                                                                      CL**5
00229      COPY DPWS013.                                                   CL**5
00230                                                                      CL**5
00231  EJECT                                                               CL**5
00232 *----------------------------------------------------------------*   CL**5
00233 *    CURRENT DATE COPYBOOK.                                      *   CL**5
00234 *----------------------------------------------------------------*   CL**5
00235                                                                      CL**5
00236      COPY DPWS017.                                                   CL**5
00237                                                                      CL**5
00238 *---------------------------------------------------------------*    CL**5
00239 *    DB2 AREA FOR THE NETWORK DB                                *    CL**5
00240 *---------------------------------------------------------------*    CL**5
00241      EXEC SQL                                                        CL**5
00242           INCLUDE TNETWRK                                            CL**5
00243      END-EXEC.                                                       CL**5
00244                                                                      CL**6
00245 *---------------------------------------------------------------*    CL**6
00246 *    DB2 AREA FOR THE TRANSACTION SET DB                        *    CL**6
00247 *---------------------------------------------------------------*    CL**6
00248      EXEC SQL                                                        CL**6
00249           INCLUDE TTRNSET                                            CL**6
00250      END-EXEC.                                                       CL**6
00251 /                                                                    CL**5
00252 *---------------------------------------------------------------*    CL**5
00253 *    DB2 AREA FOR COMMUNICATIONS                                *    CL**5
00254 *---------------------------------------------------------------*    CL**5
00255      EXEC SQL                                                        CL**5
00256           INCLUDE SQLCA                                              CL**5
00257      END-EXEC.                                                       CL**5
00258  EJECT                                                               CL**5
00259                                                                      CL**5
00260                                                                      CL**5
00261  LINKAGE SECTION.                                                    CL**5
00262                                                                      CL**5
00263  01  DFHCOMMAREA.                                                    CL**5
00264      05  FILLER                         OCCURS  1 TO 4072 TIMES      CL**5
00265                                         DEPENDING ON EIBCALEN.       CL**5
00266          10  FILLER                     PIC X.                       CL**5
00267                                                                      CL**5
00268  EJECT                                                               CL**5
00269                                                                      CL**5
00270                                                                      CL**5
00271  PROCEDURE DIVISION.                                                 CL**5
00272 **-------------------------------------------------------------**    CL**5
00273 ** THIS MODULE CONTROLS THE OVERALL PROCESSING IN THE PROGRAM. **    CL**5
00274 ** THE SETUP AND PERFORM OF PARAGRAPH 0001-CALL-CICS-ARCH-API  **    CL**5
00275 ** MUST BE THE FIRST CODE EXECUTED IN THIS PROGRAM.            **    CL**5
00276 **                                                             **    CL**5
00277 ** THE SECOND OR 'EXIT' PERFORM OF THIS PARAGRAPH MUST BE THE  **    CL**5
00278 ** LAST CODE EXECUTED ON EACH ITERATION OF THIS PROGRAM.       **    CL**5
00279 **-------------------------------------------------------------**    CL**5
00280                                                                      CL**5
00281  0000-MAIN-MODULE.                                                   CL**5
00282                                                                      CL**5
00283      INITIALIZE DP030-CICS-API-FIELDS.                               CL**5
00284      MOVE +1                       TO DP030-NUMBER-OF-MAPS.          CL**5
00285      MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.             CL**5
00286      MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).            CL**5
00287                                                                      CL**5
00288      SET DP030-RECEIVE-APPL-MAP    TO TRUE.                          CL**5
00289      MOVE LENGTH OF ET305AI        TO DP030-MAP-LENGTH (1).          CL**5
00290      MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).        CL**5
00291      PERFORM 0001-CALL-CICS-ARCH-API.                                CL**5
00292                                                                      CL**5
00293      PERFORM 1000-CONTROL-PROCESSING                                 CL**5
00294                                                                      CL**5
00295      MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).        CL**5
00296      PERFORM 0001-CALL-CICS-ARCH-API.                                CL**5
00297                                                                      CL**5
00298  0001-CALL-CICS-ARCH-API.                                            CL**5
00299                                                                      CL**5
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                         CL**5
00301                                     DFHCOMMAREA                      CL**5
00302                                     DP030-CICS-API-FIELDS            CL**5
00303                                     DP020-STANDARD-COMMAREA          CL**5
00304                                     ET305AI.                         CL**5
00305                                                                      CL**5
00306      IF  DP030-RC-CALL-SUCCESSFUL                                    CL**5
00307          CONTINUE                                                    CL**5
00308      ELSE                                                            CL**5
00309          SET DP013-NO-ROLLBACK                                       CL**5
00310              DP013-XCTL-DISPLAY-RESTART                              CL**5
00311              DP013-CICS-ABEND      TO TRUE                           CL**5
00312          MOVE 'BEFORE 0000-MAIN-MODULE'                              CL**5
00313                                    TO DP013-PARAGRAPH                CL**5
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O   CL**5
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)         CL**5
00316          MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)         CL**5
00317          PERFORM DP013-0000-PROCESS-ABEND                            CL**5
00318      END-IF.                                                         CL**5
00319                                                                      CL**5
00320  EJECT                                                               CL**5
00321 *----------------------------------------------------------------*   CL**5
00322 *    PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT   *   CL**5
00323 *    COURSE OF ACTION IS FOR THIS TRANSACTION.                   *   CL**5
00324 *----------------------------------------------------------------*   CL**5
00325                                                                      CL**5
00326  1000-CONTROL-PROCESSING.                                            CL**5
00327                                                                      CL**5
00328      SET PS-REGULAR-PROCESSING TO TRUE.                              CL**5
00329                                                                      CL**5
00330      EVALUATE TRUE                                                   CL**5
00331                                                                      CL**5
00332          WHEN DP020-NEXT-ACT-INITIAL                                 CL**5
00333 **            ** THIS SIGNALS INITIAL ENTRY TO THE PROGRAM **        CL**5
00334                                                                      CL**5
00335               PERFORM 1100-PROC-INTER-APPL-COMMAREA                  CL**5
00336               IF PS-COMMAREA-NOT-VALID                               CL**5
00337                   CONTINUE                                           CL**5
00338               ELSE                                                   CL**5
00339                   PERFORM 4000-BUILD-INITIAL-PANEL                   CL**5
00340               END-IF                                                 CL**5
00341                                                                      CL**5
00342          WHEN DP020-NEXT-ACT-READ-MAP                                CL**5
00343               PERFORM 2000-FKEY-PROCESSING                           CL**5
00344                                                                      CL**5
00345          WHEN DP020-NEXT-ACT-RETURN                                  CL**5
00346 *            ** SAVE THE 'ADD' INDICATOR FROM  ETKCS308              CL**5
00347               IF ET300-ENT-ACTION NOT = SPACES                       CL**5
00348                    MOVE ET300-ENT-ACTION TO PV-ENT-ACTION            CL**5
00349               END-IF                                                 CL**5
00350 *            ** MUST HAVE UPDATED ASC-HOLD PRIOR TO THIS POINT       CL**5
00351               MOVE ASC-HOLD-INTER-APPL                               CL**5
00352                 TO ET300-INTER-APPL-COMMAREA                         CL**5
00353               IF PV-ENT-ACTION = 'ADD'                               CL**5
00354 *                  ** SET MESSAGE FOR "SUCCESSFUL ADD"               CL**5
00355                    MOVE PC-TSYMSG-00034                              CL**5
00356                                          TO DP020-MSG-NUMBER         CL**5
00357                    SET DP020-MSG-INFORMATIONAL                       CL**5
00358                                          TO TRUE                     CL**5
00359                    MOVE SPACES           TO ET300-ENT-ACTION         CL**5
00360                                             PV-ENT-ACTION            CL**5
00361                    PERFORM 1500-UPDATE-CURRENT-TSQ-ITEM              CL**5
00362               END-IF                                                 CL**5
00363                                                                      CL**5
00364 *            ** SET COMMAREA READY TO BE DISPLAYED ON SCREEN **      CL**5
00365               MOVE ET300-VENDOR-NAME     TO ASC-VENDOR-NAME-KEY      CL**5
00366                                             ASC-VENDOR-NAME          CL**5
00367               MOVE ET300-ENT-ID          TO ASC-ENT-ID-KEY           CL**5
00368               MOVE ET300-VEND-INCHG-QUAL TO ASC-TP-QUALIFIER         CL**5
00369               MOVE ET300-VEND-INCHG-ID   TO ASC-TP-ID                CL**5
00370               MOVE ET300-NETWK-ID        TO ASC-NETWORK              CL**5
00371               MOVE ET300-TRAN-SET        TO ASC-TRAN-SET             CL**6
00372                                                                      CL**5
00373               PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**5
00374               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**5
00375                                                                      CL**5
00376          WHEN OTHER                                                  CL**5
00377               SET DP013-LOGIC-ABEND TO TRUE                          CL**5
00378               SET DP013-NO-ROLLBACK TO TRUE                          CL**5
00379               MOVE '1000-CONTROL-PROCESSING'                         CL**5
00380                                     TO DP013-PARAGRAPH               CL**5
00381               MOVE 'INVALID NEXT ACTIVITY RETURNED TO APPL PGM:'     CL**5
00382                                     TO DP013-MESSAGE-TEXT(1)         CL**5
00383               MOVE DP020-NEXT-APPL-ACTIVITY                          CL**5
00384                                     TO DP013-MESSAGE-TEXT(2)         CL**5
00385               PERFORM DP013-0000-PROCESS-ABEND                       CL**5
00386      END-EVALUATE.                                                   CL**5
00387                                                                      CL**5
00388  EJECT                                                               CL**5
00389 *----------------------------------------------------------------*   CL**5
00390 *                                                                *   CL**5
00391 *----------------------------------------------------------------*   CL**5
00392                                                                      CL**5
00393  1100-PROC-INTER-APPL-COMMAREA.                                      CL**5
00394                                                                      CL**5
00395      SET PS-COMMAREA-VALID TO TRUE.                                  CL**5
00396      INITIALIZE ASC-APPL-SPECIFIC-COMMAREA.                          CL**5
00397                                                                      CL**5
00398      MOVE DP020-INT-APPL-FORMAT-IND                                  CL**5
00399        TO ASC-INT-APPL-FORMAT-IND.                                   CL**5
00400                                                                      CL**5
00401      IF  ASC-ET-MENU                                                 CL**5
00402 *        ** PRESENT AN EMPTY SELECTION CRITERION SCREEN **           CL**5
00403                                                                      CL**5
00404          MOVE SPACE             TO ET300-VENDOR-NAME                 CL**7
00405                                    ASC-VENDOR-NAME                   CL**5
00406                                                                      CL**5
00407          MOVE ZEROES            TO ET300-ENT-ID                      CL**5
00408                                    ASC-ENT-ID-KEY                    CL**5
00409                                                                      CL**5
00410          MOVE SPACES     TO ET300-VEND-INCHG-QUAL                    CL**5
00411                             ASC-TP-QUALIFIER                         CL**5
00412                             ET300-VEND-INCHG-ID                      CL**5
00413                             ASC-TP-ID                                CL**5
00414                             ET300-NETWK-ID                           CL**5
00415                             ASC-NETWORK                              CL**5
00416                             ET300-TRAN-SET                           CL**6
00417                             ASC-TRAN-SET                             CL**6
00418                                                                      CL**5
00419          MOVE SPACES     TO ET300-INT-APPL-FORMAT-IND                CL**5
00420                             ET300-SEL-QUEUE-NAME                     CL**5
00421                                                                      CL**5
00422          MOVE +0         TO ET300-NBR-SELECTED-ITEMS                 CL**5
00423                             ET300-NUMBER-OF-TS-ITEMS                 CL**5
00424                             ET300-ENT-ID                             CL**5
00425                             ET300-TP-DKEY                            CL**5
00426                                                                      CL**5
00427          MOVE ET300-INTER-APPL-COMMAREA                              CL**5
00428            TO ASC-HOLD-INTER-APPL                                    CL**5
00429                                                                      CL**5
00430      END-IF.                                                         CL**5
00431                                                                      CL**5
00432      IF  ASC-VNDR-LIST                                               CL**5
00433 *        ** SAVE THE INITIAL COMMAREA FROM: ETKCS301 'ETLVNDRS'      CL**5
00434          MOVE ET300-INTER-APPL-COMMAREA                              CL**5
00435            TO ASC-HOLD-INTER-APPL                                    CL**5
00436                                                                      CL**5
00437 *        ** RETRIEVE THE FIRST SELECTED VENDOR FROM THE              CL**5
00438 *        ** VENDOR LIST SCREEN AND LOAD TO INITIAL SCREEN            CL**5
00439                                                                      CL**5
00440          SET ASC-USE-SELECTION-QUEUE                                 CL**5
00441                                  TO TRUE                             CL**5
00442          MOVE ET300-SEL-QUEUE-NAME                                   CL**5
00443                                  TO ASC-SEL-QUEUE-NAME               CL**5
00444          MOVE ET300-NUMBER-OF-TS-ITEMS                               CL**5
00445                                  TO ASC-NUMBER-OF-TS-ITEMS           CL**5
00446          MOVE ET300-NBR-SELECTED-ITEMS                               CL**5
00447                                  TO ASC-NUMBER-OF-SELECTED-ITEMS     CL**5
00448          MOVE ET301-MAX-ITEMS                                        CL**5
00449                                  TO ASC-SEL-SUB                      CL**5
00450          MOVE ZERO                                                   CL**5
00451                                  TO ASC-SEL-ITEM                     CL**5
00452                                                                      CL**5
00453 *        ** RETRIEVE ASC VENDOR DETAILS FOR VENDOR TO PROCESS        CL**5
00454          PERFORM 2110-RETRIEVE-NEXT-ITEM                             CL**5
00455                                                                      CL**5
00456 *        ** INTIALIZE THE COMMAREA WITH THE RETRIEVED DATA **        CL**5
00457                                                                      CL**5
00458 ** N/A   MOVE ASC-VENDOR-NAME-KEY TO ET300-VENDOR-NAME               CL**5
00459 ** N/A   MOVE ASC-ENT-ID-KEY      TO ET300-ENT-ID                    CL**5
00460          MOVE ASC-TP-QUALIFIER    TO ET300-VEND-INCHG-QUAL           CL**5
00461          MOVE ASC-TP-ID           TO ET300-VEND-INCHG-ID             CL**5
00462          MOVE ASC-NETWORK         TO ET300-NETWK-ID                  CL**5
00463          MOVE ASC-TRAN-SET        TO ET300-TRAN-SET                  CL**6
00464          MOVE SPACES              TO ET300-NETWORK-NAME              CL**5
00465          MOVE +0                  TO ET300-TP-DKEY                   CL**5
00466                                                                      CL**5
00467      END-IF.                                                         CL**5
00468                                                                      CL**5
00469  EJECT                                                               CL**5
00470 *----------------------------------------------------------------*   CL**5
00471 *                                                                *   CL**5
00472 *----------------------------------------------------------------*   CL**5
00473                                                                      CL**5
00474  1500-UPDATE-CURRENT-TSQ-ITEM.                                       CL**5
00475                                                                      CL**5
00476 *  **  'ASC-SEL-SUB'   S/B CURRENT ITEM                              CL**5
00477 *  **  'ASC-SEL-ITEM'  S/B CURRENT TSQ OCCURS                        CL**5
00478                                                                      CL**5
00479      PERFORM 9100-READ-SEL-QUEUE.                                    CL**5
00480                                                                      CL**5
00481 *    ** THE ASC AREA SHOULD CONTAIN THE CURRENT TS QUEUE DATA **     CL**5
00482 * N/A   MOVE ET301-KEY-DATA (ASC-SEL-SUB)                            CL**5
00483 * N/A                              TO  ASC-KEY-DATA.                 CL**5
00484                                                                      CL**5
00485 *    ** LOAD THE TS QUEUE RECORD WITH ADDED ITEM DETAILS **          CL**5
00486      MOVE ASC-TP-QUALIFIER                                           CL**5
00487        TO ET301-VEND-INCHG-QUAL     (ASC-SEL-SUB).                   CL**5
00488      MOVE ASC-TP-ID                                                  CL**5
00489        TO ET301-VEND-INCHG-ID       (ASC-SEL-SUB).                   CL**5
00490      MOVE ASC-NETWORK                                                CL**5
00491        TO ET301-NETWK-ID            (ASC-SEL-SUB).                   CL**5
00492                                                                      CL**5
00493      SET ET301-ADD (ASC-SEL-SUB)   TO  TRUE.                         CL**5
00494                                                                      CL**5
00495      PERFORM 9200-REWRITE-SEL-QUEUE.                                 CL**5
00496                                                                      CL**5
00497  EJECT                                                               CL**5
00498 *----------------------------------------------------------------*   CL**5
00499 * DETERMINE FUTHER THE PROCESSING PATH, BASED ON ANY FUNCTION    *   CL**5
00500 * KEY ACTIONS PERFORMED BY A USER. SPECIFIC FUNCTION KEYS LISTED *   CL**5
00501 * HERE, ARE ACTED UPON REGARDLESS OF ANY EDITS THAT ARE YET TO   *   CL**5
00502 * BE PERFORMED.                                                  *   CL**5
00503 *                                                                *   CL**5
00504 * IF NONE OF THE FUNCTION KEYS LISTED WERE PRESSED, EDIT THE     *   CL**5
00505 * DATA ON THE SCREEN. CONTINUE ON, CHECKING THE REST OF THE      *   CL**5
00506 * FUNCTION KEYS.                                                 *   CL**5
00507 *                                                                *   CL**5
00508 * NOTE THAT WITH API, NO INVALID FUNCTION KEYS CAN GET THIS FAR. *   CL**5
00509 *----------------------------------------------------------------*   CL**5
00510                                                                      CL**5
00511  2000-FKEY-PROCESSING.                                               CL**5
00512                                                                      CL**5
00513 **   (FOR THIS MODULE, CURSOR CONTROL IS HANDLED IN THE              CL**5
00514 **     3200 PARA BECAUSE CURSOR POSITION IS DIFFERENT                CL**5
00515 **     DEPENDING ON THE SOURCE CALLING THIS MODULE.)                 CL**5
00516                                                                      CL**5
00517 **   SET DP030-SET-CURSOR-APPL-1     TO  TRUE.                       CL**5
00518                                                                      CL**5
00519      IF  ET300-VENDOR-NAME = (SPACES OR LOW-VALUES)                  CL**5
00520           MOVE ASC-HOLD-INTER-APPL   TO INTER-APPL-COMM-AREA         CL**5
00521      END-IF.                                                         CL**5
00522                                                                      CL**5
00523      EVALUATE TRUE                                                   CL**5
00524                                                                      CL**5
00525          WHEN DP020-SRC-AID = DP016-CLEAR                            CL**5
00526               PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**5
00527               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**5
00528                                                                      CL**5
00529          WHEN DP020-FK-REFRESH(DP020-SRC-AID)                        CL**5
00530               INITIALIZE ASC-TP-QUALIFIER                            CL**5
00531                          ASC-TP-ID                                   CL**5
00532                          ASC-NETWORK                                 CL**5
00533                          ASC-TRAN-SET                                CL**6
00534               IF  ASC-ET-MENU                                        CL**5
00535                   MOVE SPACE             TO ASC-VENDOR-NAME          CL**7
00536               END-IF                                                 CL**5
00537               PERFORM 3200-RESET-ATTRIBUTES                          CL**5
00538               PERFORM 4000-BUILD-INITIAL-PANEL                       CL**5
00539                                                                      CL**5
00540          WHEN DP020-FK-NEXT-SELECTION (DP020-SRC-AID)                CL**5
00541               IF  ASC-USE-SELECTION-QUEUE                            CL**5
00542                   PERFORM 2110-RETRIEVE-NEXT-ITEM                    CL**5
00543                   PERFORM 4000-BUILD-INITIAL-PANEL                   CL**5
00544               ELSE                                                   CL**5
00545 *                 --- BOTTOM OF LIST ---                             CL**5
00546                   MOVE PC-TSYMSG-00070                               CL**5
00547                                    TO DP020-MSG-NUMBER               CL**5
00548                   SET DP020-MSG-INFORMATIONAL                        CL**5
00549                                    TO TRUE                           CL**5
00550               END-IF                                                 CL**5
00551                                                                      CL**5
00552          WHEN DP020-FK-PREV-SELECTION (DP020-SRC-AID)                CL**5
00553               IF  ASC-USE-SELECTION-QUEUE                            CL**5
00554                   PERFORM 2120-GET-PREV-ITEM                         CL**5
00555                   PERFORM 4000-BUILD-INITIAL-PANEL                   CL**5
00556               ELSE                                                   CL**5
00557 *                 --- TOP OF LIST ---                                CL**5
00558                   MOVE PC-TSYMSG-00069                               CL**5
00559                                    TO DP020-MSG-NUMBER               CL**5
00560                   SET DP020-MSG-INFORMATIONAL                        CL**5
00561                                    TO TRUE                           CL**5
00562               END-IF                                                 CL**5
00563                                                                      CL**5
00564          WHEN OTHER                                                  CL**5
00565               PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                   CL**5
00566               PERFORM 3000-EDIT-DATA-IN-COMMAREA                     CL**5
00567               IF  PS-NO-ERROR                                        CL**5
00568                   SET DP030-CONTINUE-GO  TO TRUE                     CL**5
00569                   PERFORM 2100-CHECK-FUNCTION-KEY                    CL**5
00570               ELSE                                                   CL**5
00571                   SET DP030-OVERRIDE-GO  TO TRUE                     CL**5
00572               END-IF                                                 CL**5
00573               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**5
00574      END-EVALUATE.                                                   CL**5
00575                                                                      CL**5
00576  EJECT                                                               CL**5
00577 *----------------------------------------------------------------*   CL**5
00578 * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED       *   CL**5
00579 * FIRST.  NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED   *   CL**5
00580 * FROM THE CICS ARCHITECTURE API.                                *   CL**5
00581 *----------------------------------------------------------------*   CL**5
00582                                                                      CL**5
00583  2100-CHECK-FUNCTION-KEY.                                            CL**5
00584                                                                      CL**5
00585      EVALUATE TRUE                                                   CL**5
00586          WHEN DP020-SRC-AID = DP016-ENTER                            CL**5
00587               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                   CL**5
00588                                                                      CL**5
00589          WHEN DP020-FK-LOCAL-GOTO (DP020-SRC-AID)                    CL**5
00590               MOVE INTER-APPL-COMM-AREA                              CL**5
00591                 TO ASC-HOLD-INTER-APPL                               CL**5
00592                                                                      CL**5
00593          WHEN OTHER                                                  CL**5
00594              SET DP013-NO-ROLLBACK                                   CL**5
00595                  DP013-XCTL-DISPLAY-RESTART                          CL**5
00596                  DP013-CICS-ABEND  TO TRUE                           CL**5
00597              MOVE '2100-CHECK-FUNCTION-KEY'                          CL**5
00598                                    TO DP013-PARAGRAPH                CL**5
00599              MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'         CL**5
00600                                    TO DP013-MESSAGE-TEXT (1)         CL**5
00601              PERFORM DP013-0000-PROCESS-ABEND                        CL**5
00602      END-EVALUATE.                                                   CL**5
00603                                                                      CL**5
00604  EJECT                                                               CL**5
00605 *----------------------------------------------------------------*   CL**5
00606 *                                                                *   CL**5
00607 *----------------------------------------------------------------*   CL**5
00608                                                                      CL**5
00609  2110-RETRIEVE-NEXT-ITEM.                                            CL**5
00610                                                                      CL**5
00611      IF PS-RETURN-PROCESSING                                         CL**5
00612          CONTINUE                                                    CL**5
00613      ELSE                                                            CL**5
00614          ADD +1                    TO  ASC-SEL-SUB                   CL**5
00615      END-IF.                                                         CL**5
00616                                                                      CL**5
00617      IF  ASC-SEL-SUB > ET301-MAX-ITEMS                               CL**5
00618          ADD +1                    TO  ASC-SEL-ITEM                  CL**5
00619          MOVE +1                   TO  ASC-SEL-SUB                   CL**5
00620      END-IF.                                                         CL**5
00621                                                                      CL**5
00622      IF  ASC-SEL-ITEM NOT > ASC-NUMBER-OF-TS-ITEMS                   CL**5
00623                                                                      CL**5
00624          PERFORM 9100-READ-SEL-QUEUE                                 CL**5
00625                                                                      CL**5
00626          IF  ET301-ITEM (ASC-SEL-SUB) > ZERO                         CL**5
00627                                                                      CL**5
00628 *            RETRIEVE THE TS QUEUE DATA, FOR THE ASC AREA            CL**5
00629 *            (RETRIEVES VENDOR NAME AND VENDOR ENTITY ID)            CL**5
00630                                                                      CL**5
00631              MOVE ET301-ENT-ID           (ASC-SEL-SUB)               CL**5
00632                                 TO  ASC-ENT-ID-KEY                   CL**5
00633                                     ET300-ENT-ID                     CL*14
00634              MOVE ET301-VENDOR-NAME      (ASC-SEL-SUB)               CL**5
00635                                 TO  ASC-VENDOR-NAME-KEY              CL**5
00636                                     ASC-VENDOR-NAME                  CL**5
00637                                     ET300-VENDOR-NAME                CL*14
00638              MOVE ET301-VEND-INCHG-QUAL  (ASC-SEL-SUB)               CL**5
00639                                 TO  ASC-TP-QUALIFIER                 CL**5
00640                                     ET300-VEND-INCHG-QUAL            CL*14
00641              MOVE ET301-VEND-INCHG-ID    (ASC-SEL-SUB)               CL**5
00642                                 TO  ASC-TP-ID                        CL**5
00643                                     ET300-VEND-INCHG-ID              CL*14
00644              MOVE ET301-NETWK-ID         (ASC-SEL-SUB)               CL**5
00645                                 TO  ASC-NETWORK                      CL**5
00646                                     ET300-NETWK-ID                   CL*14
00647              MOVE SPACE         TO  ASC-TRAN-SET                     CL*13
00648                                     ET300-TRAN-SET                   CL*14
00649                                                                      CL**5
00650              SET ET301-INQ (ASC-SEL-SUB)  TO  TRUE                   CL**5
00651              PERFORM 9200-REWRITE-SEL-QUEUE                          CL**5
00652                                                                      CL**5
00653          ELSE                                                        CL**5
00654              SUBTRACT +1 FROM ASC-SEL-SUB                            CL**5
00655 *            --- BOTTOM OF LIST ---                                  CL**5
00656              MOVE PC-TSYMSG-00070  TO  DP020-MSG-NUMBER              CL**5
00657              SET DP020-MSG-INFORMATIONAL                             CL**5
00658                                    TO  TRUE                          CL**5
00659          END-IF                                                      CL**5
00660                                                                      CL**5
00661      ELSE                                                            CL**5
00662          SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**5
00663          MOVE ET301-MAX-ITEMS      TO  ASC-SEL-SUB                   CL**5
00664          MOVE PC-TSYMSG-00070      TO  DP020-MSG-NUMBER              CL**5
00665          SET DP020-MSG-INFORMATIONAL                                 CL**5
00666                                    TO  TRUE                          CL**5
00667      END-IF.                                                         CL**5
00668                                                                      CL**5
00669  EJECT                                                               CL**5
00670 *----------------------------------------------------------------*   CL**5
00671 *                                                                *   CL**5
00672 *----------------------------------------------------------------*   CL**5
00673                                                                      CL**5
00674  2120-GET-PREV-ITEM.                                                 CL**5
00675                                                                      CL**5
00676      SUBTRACT +1 FROM ASC-SEL-SUB.                                   CL**5
00677      IF  ASC-SEL-SUB < +1                                            CL**5
00678          SUBTRACT +1 FROM ASC-SEL-ITEM                               CL**5
00679          MOVE ET301-MAX-ITEMS      TO ASC-SEL-SUB                    CL**5
00680      END-IF.                                                         CL**5
00681                                                                      CL**5
00682      IF  ASC-SEL-ITEM > ZERO                                         CL**5
00683                                                                      CL**5
00684          PERFORM 9100-READ-SEL-QUEUE                                 CL**5
00685                                                                      CL**5
00686 *        RETRIEVE THE TS QUEUE DATA, FOR THE ASC AREA                CL**5
00687                                                                      CL**5
00688          MOVE ET301-ENT-ID          (ASC-SEL-SUB)                    CL**5
00689                                 TO  ASC-ENT-ID-KEY                   CL**5
00690                                     ET300-ENT-ID                     CL*14
00691          MOVE ET301-VENDOR-NAME     (ASC-SEL-SUB)                    CL**5
00692                                 TO  ASC-VENDOR-NAME-KEY              CL**5
00693                                     ASC-VENDOR-NAME                  CL**5
00694                                     ET300-VENDOR-NAME                CL*14
00695          MOVE ET301-VEND-INCHG-QUAL (ASC-SEL-SUB)                    CL**5
00696                                 TO  ASC-TP-QUALIFIER                 CL**5
00697                                     ET300-VEND-INCHG-QUAL            CL*14
00698          MOVE ET301-VEND-INCHG-ID   (ASC-SEL-SUB)                    CL**5
00699                                 TO  ASC-TP-ID                        CL**5
00700                                     ET300-VEND-INCHG-ID              CL*14
00701          MOVE ET301-NETWK-ID        (ASC-SEL-SUB)                    CL**5
00702                                 TO  ASC-NETWORK                      CL**5
00703                                     ET300-NETWK-ID                   CL*14
00704          MOVE SPACE             TO ASC-TRAN-SET                      CL*13
00705                                     ET300-TRAN-SET                   CL*14
00706                                                                      CL*14
00707          SET ET301-INQ (ASC-SEL-SUB)                                 CL**5
00708                                    TO  TRUE                          CL**5
00709          PERFORM 9200-REWRITE-SEL-QUEUE                              CL**5
00710      ELSE                                                            CL**5
00711          MOVE +1                   TO ASC-SEL-ITEM                   CL**5
00712                                       ASC-SEL-SUB                    CL**5
00713 *        --- TOP OF LIST ---                                         CL**5
00714          MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER               CL**5
00715          SET DP020-MSG-INFORMATIONAL                                 CL**5
00716                                    TO TRUE                           CL**5
00717      END-IF.                                                         CL**5
00718                                                                      CL**5
00719  EJECT                                                               CL**5
00720 *----------------------------------------------------------------*   CL**5
00721 * MOVE DATA ENTERED ON THE SCREEN INTO THEIR RESPECTIVE FIELDS   *   CL**5
00722 * IN THE APPLICATION-SPECIFIC COMMAREA.  ALL EDITS ARE DONE IN   *   CL**5
00723 * THE APPLICATION-SPECIFIC COMMAERA, NOT ON THE SCREEN.          *   CL**5
00724 *----------------------------------------------------------------*   CL**5
00725                                                                      CL**5
00726  2200-MOVE-SCREEN-TO-COMMAREA.                                       CL**5
00727                                                                      CL**5
00728      IF  AVNDRNML > ZERO                                             CL**5
00729          MOVE AVNDRNMI             TO ASC-VENDOR-NAME                CL**5
00730      ELSE                                                            CL**5
00731          IF AVNDRNMF = DP015-ERASE-EOF                               CL**5
00732              MOVE SPACE            TO ASC-VENDOR-NAME                CL**7
00733              MOVE ZEROES           TO ASC-ENT-ID-KEY                 CL**5
00734          END-IF                                                      CL**5
00735      END-IF.                                                         CL**5
00736                                                                      CL**5
00737      IF ATPQLFRL > 0                                                 CL**5
00738          MOVE ATPQLFRI             TO ASC-TP-QUALIFIER               CL**5
00739      ELSE                                                            CL**5
00740          IF ATPQLFRF = DP015-ERASE-EOF                               CL**5
00741              MOVE SPACES           TO ASC-TP-QUALIFIER               CL**5
00742      END-IF.                                                         CL**5
00743                                                                      CL**5
00744      IF ATPIDL > 0                                                   CL**5
00745          MOVE ATPIDI               TO ASC-TP-ID                      CL**5
00746      ELSE                                                            CL**5
00747          IF ATPIDF = DP015-ERASE-EOF                                 CL**5
00748              MOVE SPACES           TO ASC-TP-ID                      CL**5
00749      END-IF.                                                         CL**5
00750                                                                      CL**5
00751      IF ANETWRKL > 0                                                 CL**5
00752          MOVE ANETWRKI             TO ASC-NETWORK                    CL**5
00753      ELSE                                                            CL**5
00754          IF ANETWRKF = DP015-ERASE-EOF                               CL**5
00755              MOVE SPACES           TO ASC-NETWORK                    CL**5
00756      END-IF.                                                         CL**5
00757                                                                      CL**5
00758      IF ATRNSETL > 0                                                 CL**6
00759          MOVE ATRNSETI             TO ASC-TRAN-SET                   CL**6
00760      ELSE                                                            CL**6
00761          IF ATRNSETF = DP015-ERASE-EOF                               CL**6
00762              MOVE SPACES           TO ASC-TRAN-SET                   CL**6
00763      END-IF.                                                         CL**6
00764                                                                      CL**6
00765      MOVE ASC-VENDOR-NAME          TO ET300-VENDOR-NAME.             CL**5
00766      MOVE ASC-ENT-ID-KEY           TO ET300-ENT-ID.                  CL**5
00767      MOVE ASC-TP-QUALIFIER         TO ET300-VEND-INCHG-QUAL.         CL**5
00768      MOVE ASC-TP-ID                TO ET300-VEND-INCHG-ID.           CL**5
00769      MOVE ASC-NETWORK              TO ET300-NETWK-ID.                CL**5
00770      MOVE ASC-TRAN-SET             TO ET300-TRAN-SET.                CL**6
00771                                                                      CL**5
00772  EJECT                                                               CL**5
00773 *----------------------------------------------------------------*   CL**5
00774 * ENSURE THE DATA IS CORRECT.  NOTE THAT IN A CRITERIA SPECIFI-  *   CL**5
00775 * CATION SCREEN ONLY MINIMAL EDITS ARE DONE.  EDITS RELATED TO   *   CL**5
00776 * A SPECIFIC SCREEN THAT THE USER IS GOING TO (LOCAL-GO) ARE     *   CL**5
00777 * DONE IN THE DESTINATION PROGRAM, NOT HERE.                     *   CL**5
00778 *                                                                *   CL**5
00779 * PERFORM EDITS ON EACH FIELD ENTERED BY THE USER, OR RECEIVED   *   CL**5
00780 * FROM THE VENDOR SUB-SYSTEM MODULE. IF AN ERROR IS FOUND,       *   CL**5
00781 * THE CURSOR IS POSITIONED AT THAT FIELD AND AN APPROPRIATE      *   CL**5
00782 * ERROR MESSAGE IS DISPLAYED.                                    *   CL**5
00783 *----------------------------------------------------------------*   CL**5
00784                                                                      CL**5
00785  3000-EDIT-DATA-IN-COMMAREA.                                         CL**5
00786                                                                      CL**5
00787 *   ** ON AN TP ADD FUNCTION, THE VENDOR LIST HAS TO HAVE            CL**5
00788 *   ** BEEN THE SOURCE OF THE CALL TO THIS MODULE BECAUSE            CL**5
00789 *   ** THE ENTITY-ID MUST BE KNOWN FOR THE VENDOR.                   CL**5
00790 *   ** THE PROTECTION FOR THIS FEATURE IS IN THE ARCHITECTURE        CL**5
00791 *   ** WHERE ONLY THE ETSTPSHP MNEMONIC CONTAINS THE F13 KEY.        CL**5
00792 *   ** THE ETSTPMNU MNEMONIC DOES NOT.                               CL**5
00793                                                                      CL**5
00794 *   ** THE ADD MODULE WILL EDIT TO ENSURE THAT IF ANY OF THE         CL**5
00795 *   ** THE FOLLOWING :  ET300-VEND-INCHG-QUAL OR                     CL**6
00796 *   **      ET300-VEND-INCHG-ID                                      CL**6
00797 *   ** WERE ENTERED, THAT THEY MUST ALL CONTAIN VALID ENTRIES.       CL**5
00798                                                                      CL**5
00799                                                                      CL**5
00800      PERFORM 3200-RESET-ATTRIBUTES.                                  CL**5
00801                                                                      CL**5
00802                                                                      CL**5
00803 *    ** PERFORM EDITS AGAINST THE VENDOR NAME FIELD **               CL**5
00804                                                                      CL**5
00805      IF ET300-VENDOR-NAME = (SPACES OR LOW-VALUES)                   CL**5
00806          MOVE SPACE                TO  ET300-VENDOR-NAME             CL**7
00807                                        ASC-VENDOR-NAME               CL**5
00808          MOVE ZEROES               TO  ET300-ENT-ID                  CL**5
00809                                        ASC-ENT-ID-KEY                CL**5
00810      END-IF.                                                         CL**5
00811                                                                      CL**5
00812 *    ** PERFORM EDITS AGAINST THE TP INTERCHG ID QUALIFIER **        CL**5
00813                                                                      CL**5
00814      MOVE 0 TO PV-COUNTER.                                           CL**5
00815      INSPECT  ET300-VEND-INCHG-QUAL                                  CL**5
00816      TALLYING PV-COUNTER                                             CL**5
00817       FOR ALL '*'.                                                   CL**5
00818                                                                      CL**5
00819      IF PV-COUNTER > 0                                               CL**5
00820          SET PS-INTRCHG-QUAL-NOT-FND TO TRUE                         CL**5
00821 *        ---- ASTERISK NOT PERMITTED ----                            CL**5
00822          MOVE PC-TSYMSG-00137         TO DP020-MSG-NUMBER            CL**5
00823      ELSE                                                            CL**5
00824          IF ET300-VEND-INCHG-QUAL = SPACES                           CL**5
00825 *            --- A VALUE OF SPACES IS VALID AT THIS POINT ---        CL**5
00826              SET PS-INTRCHG-QUAL-FOUND TO TRUE                       CL**5
00827          ELSE                                                        CL**5
00828              SET ET305-IDX TO +1                                     CL**5
00829              SEARCH ET305-TP-ID-ENTRY                                CL**5
00830                  AT END                                              CL**5
00831                      SET PS-INTRCHG-QUAL-NOT-FND TO TRUE             CL**5
00832 *                    ---- INVALID VALUE ENTERED ----                 CL**5
00833                      MOVE PC-TSYMSG-00005 TO DP020-MSG-NUMBER        CL**5
00834                                                                      CL**5
00835                  WHEN (  ET305-TP-ID (ET305-IDX) =                   CL**5
00836                           ET300-VEND-INCHG-QUAL  )                   CL**5
00837                                                                      CL**5
00838                      SET PS-INTRCHG-QUAL-FOUND   TO TRUE             CL**5
00839              END-SEARCH                                              CL**5
00840          END-IF                                                      CL**5
00841      END-IF.                                                         CL**5
00842                                                                      CL**5
00843      IF PS-INTRCHG-QUAL-NOT-FND                                      CL**5
00844          SET  PS-ERROR               TO TRUE                         CL**5
00845 *       ** AN ERROR IS DETECTED **                                   CL**5
00846          MOVE DP015-UNP-ALP-BRT-OFF  TO ATPQLFRA                     CL**5
00847          MOVE DP015-RED              TO ATPQLFRC                     CL**5
00848          MOVE DP015-REVERSE          TO ATPQLFRH                     CL**5
00849          MOVE -1                     TO ATPQLFRL                     CL**5
00850      END-IF.                                                         CL**5
00851                                                                      CL**5
00852 *    ** PERFORM EDITS AGAINST THE TP INTERCHG ID **                  CL**5
00853                                                                      CL**5
00854      MOVE 0 TO PV-COUNTER.                                           CL**5
00855      INSPECT  ET300-VEND-INCHG-ID                                    CL**5
00856      TALLYING PV-COUNTER                                             CL**5
00857       FOR ALL '*'.                                                   CL**5
00858                                                                      CL**5
00859      IF PV-COUNTER > 0                                               CL**5
00860 *       ** AN ERROR IS DETECTED **                                   CL**5
00861          MOVE DP015-UNP-ALP-BRT-OFF  TO ATPIDA                       CL**5
00862          MOVE DP015-RED              TO ATPIDC                       CL**5
00863          MOVE DP015-REVERSE          TO ATPIDH                       CL**5
00864          IF PS-NO-ERROR                                              CL**6
00865              SET  PS-ERROR           TO TRUE                         CL**6
00866              MOVE -1                 TO ATPIDL                       CL**6
00867 *            ---- ASTERISK NOT PERMITTED ----                        CL**6
00868              MOVE PC-TSYMSG-00137    TO DP020-MSG-NUMBER             CL**6
00869          END-IF                                                      CL**6
00870      END-IF.                                                         CL**6
00871                                                                      CL**5
00872 *    ** PERFORM EDITS AGAINST THE NETWORK ID **                      CL**5
00873                                                                      CL**5
00874      MOVE 0 TO PV-COUNTER.                                           CL**5
00875      INSPECT  ET300-NETWK-ID                                         CL**5
00876      TALLYING PV-COUNTER                                             CL**5
00877       FOR ALL '*'.                                                   CL**5
00878                                                                      CL**5
00879      IF PV-COUNTER > 0                                               CL**5
00880 *       ** AN ERROR IS DETECTED **                                   CL**5
00881          MOVE DP015-UNP-ALP-BRT-OFF  TO ANETWRKA                     CL**5
00882          MOVE DP015-RED              TO ANETWRKC                     CL**5
00883          MOVE DP015-REVERSE          TO ANETWRKH                     CL**5
00884          IF PS-NO-ERROR                                              CL**6
00885              SET  PS-ERROR           TO TRUE                         CL**6
00886              MOVE -1                 TO ANETWRKL                     CL**6
00887 *            ---- ASTERISK NOT PERMITTED ----                        CL**6
00888              MOVE PC-TSYMSG-00137    TO DP020-MSG-NUMBER             CL**6
00889          END-IF                                                      CL**6
00890      ELSE                                                            CL**5
00891          IF ET300-NETWK-ID > SPACES                                  CL**5
00892              MOVE ET300-NETWK-ID TO DK-NETWK-ID                      CL**5
00893              PERFORM 4350-SELECT-TNETWRK                             CL**5
00894              IF SQLCODE = +100                                       CL**5
TNJ   *  ADDED TEMPORARY LOGIC TO NOT ALLOW A PRIMARY NETWORK OF IBM            
TNJ                   OR SQLCODE = +0 AND DK-NETWK-ID = '4'                     
00895                  MOVE DP015-UNP-ALP-BRT-MDT                          CL**5
00896                                            TO ANETWRKA               CL**5
00897                  MOVE DP015-RED            TO ANETWRKC               CL**5
00898                  MOVE DP015-REVERSE        TO ANETWRKH               CL**5
00899                  IF PS-NO-ERROR                                      CL**5
00900                      MOVE -1               TO ANETWRKL               CL**5
00901                      MOVE PC-TSYMSG-00758  TO DP020-MSG-NUMBER       CL**5
00902                      SET PS-ERROR          TO TRUE                   CL**5
00903                  END-IF                                              CL**6
00904              END-IF                                                  CL**5
00905          END-IF                                                      CL**5
00906      END-IF.                                                         CL**5
00907                                                                      CL**5
00908 *    *------------------------------------------------------------   CL**6
00909 *    * EDIT THE TRAN SET. IF IT IS ENTERED, IT MUST BE AN EXISTING   CL**6
00910 *    * TRAN SET CODE OR TRAN SET NAME ID.                            CL**6
00911 *    *------------------------------------------------------------   CL**6
00912                                                                      CL**6
00913      MOVE 0 TO PV-COUNTER.                                           CL**6
00914      INSPECT  ET300-TRAN-SET                                         CL**6
00915      TALLYING PV-COUNTER                                             CL**6
00916       FOR ALL '*'.                                                   CL**6
00917                                                                      CL**6
00918      IF PV-COUNTER > 0                                               CL**6
00919          MOVE DP015-UNP-ALP-BRT-OFF  TO ATRNSETA                     CL**6
00920          MOVE DP015-RED              TO ATRNSETC                     CL**6
00921          MOVE DP015-REVERSE          TO ATRNSETH                     CL**6
00922          IF PS-NO-ERROR                                              CL**6
00923              SET  PS-ERROR           TO TRUE                         CL**6
00924              MOVE -1                 TO ATRNSETL                     CL**6
00925 *            ---- ASTERISK NOT PERMITTED ----                        CL**6
00926              MOVE PC-TSYMSG-00137    TO DP020-MSG-NUMBER             CL**6
00927          END-IF                                                      CL**6
00928      ELSE                                                            CL**6
00929          IF ET300-TRAN-SET > SPACES                                  CL**6
00930              MOVE ET300-TRAN-SET TO DK-TRAN-SET                      CL**6
00931              PERFORM 4375-SELECT-TTRNSET-BY-CDE                      CL**6
00932              IF SQLCODE = +100                                       CL**6
00933                  PERFORM 4380-SELECT-TTRNSET-BY-NME-ID               CL**6
00934                  IF SQLCODE = +100                                   CL**6
00935                      MOVE DP015-UNP-ALP-BRT-MDT                      CL**6
00936                                                TO ATRNSETA           CL**6
00937                      MOVE DP015-RED            TO ATRNSETC           CL**6
00938                      MOVE DP015-REVERSE        TO ATRNSETH           CL**6
00939                      IF PS-NO-ERROR                                  CL**6
00940                          MOVE -1               TO ATRNSETL           CL**6
00941                          MOVE PC-TSYMSG-00005  TO DP020-MSG-NUMBER   CL**6
00942                          SET PS-ERROR          TO TRUE               CL**6
00943                      END-IF                                          CL**6
00944                  ELSE                                                CL**7
00945                      MOVE TRNSET-TRAN-SET-CDE  TO ET300-TRAN-SET     CL**7
00946                  END-IF                                              CL**6
00947              END-IF                                                  CL**6
00948          END-IF                                                      CL**6
00949      END-IF.                                                         CL**6
00950                                                                      CL**6
00951 *    ** DETERMINE IF ALL SELECTION FIELDS WERE COMPLETED,            CL**5
00952 *    ** OF IF ONLY 1 OR 2 CONTAINED DATA. THE "ADD"                  CL**5
00953 *    ** FUNCTION KEY REQUIRES "ALL OR NOTHING" TO BE ENTERED.        CL**5
00954                                                                      CL**5
00955 ***  DETERMINE IF 'ADD' RETURNED ERROR TO THIS MODULE                CL**5
00956      IF (ASC-VNDR-LIST     AND                                       CL**5
00957          DP030-APPL-ERR-OVERRIDE-SW = 'Y' )                          CL**5
00958                                                                      CL**5
00959          IF ( ET300-VEND-INCHG-QUAL = SPACES  AND                    CL**5
00960               ET300-VEND-INCHG-ID   = SPACES  AND                    CL**5
00961               ET300-NETWK-ID        = SPACES       )                 CL**5
00962 *               ** ALL OTHER SELECT FIELDS MAY BE SPACES **          CL**5
00963                 CONTINUE                                             CL**5
00964          ELSE                                                        CL**5
00965 *            ** AN ERROR IS DETECTED IF ANY ONE FIELD IS BLANK **    CL**5
00966              IF ET300-VEND-INCHG-QUAL = SPACES                       CL**5
00967                   SET  PS-ERROR               TO TRUE                CL**5
00968                   MOVE DP015-UNP-ALP-BRT-OFF  TO ATPQLFRA            CL**5
00969                   MOVE DP015-RED              TO ATPQLFRC            CL**5
00970                   MOVE DP015-REVERSE          TO ATPQLFRH            CL**5
00971                   MOVE -1                     TO ATPQLFRL            CL**5
00972              END-IF                                                  CL**5
00973              IF ET300-VEND-INCHG-ID   = SPACES                       CL**5
00974                   SET  PS-ERROR               TO TRUE                CL**5
00975                   MOVE DP015-UNP-ALP-BRT-OFF  TO ATPIDA              CL**5
00976                   MOVE DP015-RED              TO ATPIDC              CL**5
00977                   MOVE DP015-REVERSE          TO ATPIDH              CL**5
00978                   MOVE -1                     TO ATPIDL              CL**5
00979              END-IF                                                  CL**5
00980              IF ET300-NETWK-ID        = SPACES                       CL**5
00981                   SET  PS-ERROR               TO TRUE                CL**5
00982                   MOVE DP015-UNP-ALP-BRT-OFF  TO ANETWRKA            CL**5
00983                   MOVE DP015-RED              TO ANETWRKC            CL**5
00984                   MOVE DP015-REVERSE          TO ANETWRKH            CL**5
00985                   MOVE -1                     TO ANETWRKL            CL**5
00986              END-IF                                                  CL**5
00987          END-IF                                                      CL**5
00988      END-IF.                                                         CL**5
00989                                                                      CL**5
00990                                                                      CL**5
00991      IF PS-ERROR                                                     CL**5
00992          SET DP030-SET-CURSOR-APPL-1 TO TRUE                         CL**5
00993          SET DP020-MSG-FATAL         TO TRUE                         CL**9
00994                                                                      CL**5
00995          IF ASC-ET-MENU                                              CL**5
00996 *            ** TURN OFF CURSOR ON VENDOR NAME **                    CL**5
00997              MOVE +0                     TO AVNDRNML                 CL**5
00998          END-IF                                                      CL**5
00999                                                                      CL**5
01000          IF ASC-VNDR-LIST                                            CL**5
01001              IF PS-INTRCHG-QUAL-NOT-FND                              CL**5
01002                 CONTINUE                                             CL**5
01003              ELSE                                                    CL**5
01004 *               ** TURN OFF CURSOR ON INTRCHG QUAL **                CL**5
01005                 MOVE +0                  TO ATPQLFRL                 CL**5
01006              END-IF                                                  CL**5
01007          END-IF                                                      CL**5
01008                                                                      CL**5
01009      ELSE                                                            CL**5
01010 *        ** UPDATE HELD AREA HERE ? **                               CL**5
01011          MOVE ET300-INTER-APPL-COMMAREA                              CL**5
01012            TO ASC-HOLD-INTER-APPL                                    CL**5
01013      END-IF.                                                         CL**5
01014                                                                      CL**5
01015 *----------------------------------------------------------------*   CL**5
01016 * MOVE THE DEFAULT ATTRIBUTE VALUES TO THE ENTERABLE FIELDS ON   *   CL**5
01017 * MAP.                                                           *   CL**5
01018 *----------------------------------------------------------------*   CL**5
01019                                                                      CL**5
01020  3200-RESET-ATTRIBUTES.                                              CL**5
01021                                                                      CL**5
01022      IF  ASC-ET-MENU                                                 CL**5
01023           MOVE DP015-UNP-ALP-NOR-OFF  TO AVNDRNMA                    CL**5
01024           MOVE DP015-GREEN            TO AVNDRNMC                    CL**5
01025           MOVE DP015-UNDERLINE        TO AVNDRNMH                    CL**5
01026           IF  PS-ERROR                                               CL**5
01027                CONTINUE                                              CL**5
01028           ELSE                                                       CL**5
01029                SET DP030-SET-CURSOR-APPL-1 TO TRUE                   CL**5
01030                MOVE -1                     TO AVNDRNML               CL**5
01031           END-IF                                                     CL**5
01032      END-IF.                                                         CL**5
01033                                                                      CL**5
01034      IF  ASC-VNDR-LIST                                               CL**5
01035           MOVE DP015-PRO-BRT-OFF      TO AVNDRNMA                    CL**5
01036           MOVE DP015-BLUE             TO AVNDRNMC                    CL**5
01037           MOVE DP015-HL-OFF           TO AVNDRNMH                    CL**5
01038           IF  PS-ERROR                                               CL**5
01039                CONTINUE                                              CL**5
01040           ELSE                                                       CL**5
01041                SET DP030-SET-CURSOR-APPL-1 TO TRUE                   CL**5
01042                MOVE -1                     TO ATPQLFRL               CL**5
01043           END-IF                                                     CL**5
01044      END-IF.                                                         CL**5
01045                                                                      CL**5
01046 *    ** DEFAULT REMAINING FIELDS TO UNPROTECTED AND UNDERLINED       CL**5
01047           MOVE DP015-UNP-ALP-NOR-OFF  TO ATPQLFRA.                   CL**5
01048           MOVE DP015-GREEN            TO ATPQLFRC.                   CL**5
01049           MOVE DP015-UNDERLINE        TO ATPQLFRH.                   CL**5
01050           MOVE DP015-UNP-ALP-NOR-OFF  TO ATPIDA.                     CL**5
01051           MOVE DP015-GREEN            TO ATPIDC.                     CL**5
01052           MOVE DP015-UNDERLINE        TO ATPIDH.                     CL**5
JF0901          MOVE DP015-UNP-ALP-NOR-OFF  TO ANETWRKA.                   CL**5
01054           MOVE DP015-GREEN            TO ANETWRKC.                   CL**5
01055           MOVE DP015-UNDERLINE        TO ANETWRKH.                   CL**5
01056           MOVE DP015-UNP-NUM-NOR-OFF  TO ATRNSETA.                   CL**6
01057           MOVE DP015-GREEN            TO ATRNSETC.                   CL**6
01058           MOVE DP015-UNDERLINE        TO ATRNSETH.                   CL**6
01059                                                                      CL**5
01060  EJECT                                                               CL**5
01061 *----------------------------------------------------------------*   CL**5
01062 *  IF THERE IS ANY DATA TO MOVE TO THE SCREEN ON INITIAL, MOVE   *   CL**5
01063 *  IT HERE.                                                      *   CL**5
01064 *----------------------------------------------------------------*   CL**5
01065                                                                      CL**5
01066  4000-BUILD-INITIAL-PANEL.                                           CL**5
01067                                                                      CL**5
01068      PERFORM 3200-RESET-ATTRIBUTES.                                  CL*11
01069      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                           CL**5
01070                                                                      CL**5
01071  4350-SELECT-TNETWRK.                                                CL**5
01072                                                                      CL**5
01073      PERFORM                                                         CL**5
01074          WITH TEST AFTER                                             CL**5
01075          VARYING PV-RETRY-COUNTER                                    CL**5
01076          FROM 1 BY 1                                                 CL**5
01077          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                  CL**5
01078             OR  (SQLCODE = +100)                                     CL**5
01079             OR  (SQLCODE = +0))                                      CL**5
01080                                                                      CL**5
01081          EXEC SQL                                                    CL**5
01082              SELECT    NETWK_ID                                      CL**5
01083                INTO    :NETWRK-NETWK-ID                              CL**5
01084               FROM  TNETWRK                                          CL**5
01085              WHERE  NETWK_ID    = :DK-NETWK-ID                       CL**5
01086          END-EXEC                                                    CL**5
01087                                                                      CL**5
01088          EVALUATE TRUE                                               CL**5
01089              WHEN SQLCODE = +0                                       CL**5
01090              WHEN SQLCODE = +100                                     CL**5
01091              WHEN SQLCODE = -904                                     CL**5
01092              WHEN SQLCODE = -913                                     CL**5
01093                   CONTINUE                                           CL**5
01094                                                                      CL**5
01095              WHEN SQLWARN0 NOT = SPACE                               CL**5
01096              WHEN SQLCODE < +0                                       CL**5
01097              WHEN SQLCODE > +0                                       CL**5
01098                   MOVE '4350-SELECT-TNETWRK'                         CL**5
01099                                    TO DP013-PARAGRAPH                CL**5
01100                   MOVE 'SELECT ON TNETWRK'                           CL**5
01101                                    TO DP013-MESSAGE-TEXT (1)         CL**5
01102                   MOVE SQLCA       TO DP013-SQLCA                    CL**5
01103                   MOVE 'TNETWRK'   TO DP013-DB2-TABLE-NAME (1)       CL**5
01104                   SET DP013-DB2-ABEND                                CL**5
01105                       DP013-XCTL-DISPLAY-RESTART                     CL**5
01106                                    TO TRUE                           CL**5
01107                   PERFORM DP013-0000-PROCESS-ABEND                   CL**5
01108          END-EVALUATE                                                CL**5
01109      END-PERFORM.                                                    CL**5
01110                                                                      CL**5
01111      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                           CL**5
01112          MOVE '4350-SELECT-TNETWRK'                                  CL**5
01113                                    TO DP013-PARAGRAPH                CL**5
01114          MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                      CL**5
01115                                    TO DP013-MESSAGE-TEXT (1)         CL**5
01116          MOVE 'ON TABLE TNETWRK '  TO DP013-MESSAGE-TEXT (2)         CL**5
01117          MOVE SQLCA                TO DP013-SQLCA                    CL**5
01118          SET DP013-DB2-ABEND                                         CL**5
01119              DP013-XCTL-DISPLAY-RESTART                              CL**5
01120                                    TO TRUE                           CL**5
01121          PERFORM DP013-0000-PROCESS-ABEND                            CL**5
01122      END-IF.                                                         CL**5
01123                                                                      CL**5
01124  4375-SELECT-TTRNSET-BY-CDE.                                         CL**6
01125                                                                      CL**6
01126      PERFORM                                                         CL**6
01127          WITH TEST AFTER                                             CL**6
01128          VARYING PV-RETRY-COUNTER                                    CL**6
01129          FROM 1 BY 1                                                 CL**6
01130          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                  CL**6
01131             OR  (SQLCODE = +100)                                     CL**6
01132             OR  (SQLCODE = +0))                                      CL**6
01133                                                                      CL**6
01134          EXEC SQL                                                    CL**6
01135              SELECT    TRAN_SET_CDE                                  CL**6
01136                INTO   :TRNSET-TRAN-SET-CDE                           CL**6
01137               FROM  TTRNSET                                          CL**6
01138              WHERE  TRAN_SET_CDE = :DK-TRAN-SET                      CL**6
01139          END-EXEC                                                    CL**6
01140                                                                      CL**6
01141          EVALUATE TRUE                                               CL**6
01142              WHEN SQLCODE = +0                                       CL**6
01143              WHEN SQLCODE = +100                                     CL**6
01144              WHEN SQLCODE = -904                                     CL**6
01145              WHEN SQLCODE = -913                                     CL**6
01146                   CONTINUE                                           CL**6
01147                                                                      CL**6
01148              WHEN SQLWARN0 NOT = SPACE                               CL**6
01149              WHEN SQLCODE < +0                                       CL**6
01150              WHEN SQLCODE > +0                                       CL**6
01151                   MOVE '4375-SELECT-TTRNSET-BY-CDE'                  CL**6
01152                                    TO DP013-PARAGRAPH                CL**6
01153                   MOVE 'SELECT ON TTRNSET'                           CL**6
01154                                    TO DP013-MESSAGE-TEXT (1)         CL**6
01155                   MOVE SQLCA       TO DP013-SQLCA                    CL**6
01156                   MOVE 'TTRNSET'   TO DP013-DB2-TABLE-NAME (1)       CL**6
01157                   SET DP013-DB2-ABEND                                CL**6
01158                       DP013-XCTL-DISPLAY-RESTART                     CL**6
01159                                    TO TRUE                           CL**6
01160                   PERFORM DP013-0000-PROCESS-ABEND                   CL**6
01161          END-EVALUATE                                                CL**6
01162      END-PERFORM.                                                    CL**6
01163                                                                      CL**6
01164      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                           CL**6
01165          MOVE '4375-SELECT-TTRNSET-BY-CDE'                           CL**6
01166                                    TO DP013-PARAGRAPH                CL**6
01167          MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                      CL**6
01168                                    TO DP013-MESSAGE-TEXT (1)         CL**6
01169          MOVE 'ON TABLE TTRNSET '  TO DP013-MESSAGE-TEXT (2)         CL**6
01170          MOVE SQLCA                TO DP013-SQLCA                    CL**6
01171          SET DP013-DB2-ABEND                                         CL**6
01172              DP013-XCTL-DISPLAY-RESTART                              CL**6
01173                                    TO TRUE                           CL**6
01174          PERFORM DP013-0000-PROCESS-ABEND                            CL**6
01175      END-IF.                                                         CL**6
01176                                                                      CL**6
01177                                                                      CL**6
01178  4380-SELECT-TTRNSET-BY-NME-ID.                                      CL**6
01179                                                                      CL**6
01180      PERFORM                                                         CL**6
01181          WITH TEST AFTER                                             CL**6
01182          VARYING PV-RETRY-COUNTER                                    CL**6
01183          FROM 1 BY 1                                                 CL**6
01184          UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)                  CL**6
01185             OR  (SQLCODE = +100)                                     CL**6
01186             OR  (SQLCODE = +0))                                      CL**6
01187                                                                      CL**6
01188          EXEC SQL                                                    CL**6
01189              SELECT    TRAN_SET_CDE                                  CL**6
01190                INTO   :TRNSET-TRAN-SET-CDE                           CL**6
01191               FROM  TTRNSET                                          CL**6
01192              WHERE  TRAN_SET_NME_ID = :DK-TRAN-SET                   CL**6
01193          END-EXEC                                                    CL**6
01194                                                                      CL**6
01195          EVALUATE TRUE                                               CL**6
01196              WHEN SQLCODE = +0                                       CL**6
01197              WHEN SQLCODE = +100                                     CL**6
01198              WHEN SQLCODE = -904                                     CL**6
01199              WHEN SQLCODE = -913                                     CL**6
01200                   CONTINUE                                           CL**6
01201                                                                      CL**6
01202              WHEN SQLWARN0 NOT = SPACE                               CL**6
01203              WHEN SQLCODE < +0                                       CL**6
01204              WHEN SQLCODE > +0                                       CL**6
01205                   MOVE '4380-SELECT-TTRNSET-BY-NME-ID'               CL**6
01206                                    TO DP013-PARAGRAPH                CL**6
01207                   MOVE 'SELECT ON TTRNSET'                           CL**6
01208                                    TO DP013-MESSAGE-TEXT (1)         CL**6
01209                   MOVE SQLCA       TO DP013-SQLCA                    CL**6
01210                   MOVE 'TTRNSET'   TO DP013-DB2-TABLE-NAME (1)       CL**6
01211                   SET DP013-DB2-ABEND                                CL**6
01212                       DP013-XCTL-DISPLAY-RESTART                     CL**6
01213                                    TO TRUE                           CL**6
01214                   PERFORM DP013-0000-PROCESS-ABEND                   CL**6
01215          END-EVALUATE                                                CL**6
01216      END-PERFORM.                                                    CL**6
01217                                                                      CL**6
01218      IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                           CL**6
01219          MOVE '4380-SELECT-TTRNSET-BY-NME-ID'                        CL**6
01220                                    TO DP013-PARAGRAPH                CL**6
01221          MOVE 'MAX RETRIES EXCEEDED FOR SELECT'                      CL**6
01222                                    TO DP013-MESSAGE-TEXT (1)         CL**6
01223          MOVE 'ON TABLE TTRNSET '  TO DP013-MESSAGE-TEXT (2)         CL**6
01224          MOVE SQLCA                TO DP013-SQLCA                    CL**6
01225          SET DP013-DB2-ABEND                                         CL**6
01226              DP013-XCTL-DISPLAY-RESTART                              CL**6
01227                                    TO TRUE                           CL**6
01228          PERFORM DP013-0000-PROCESS-ABEND                            CL**6
01229      END-IF.                                                         CL**6
01230                                                                      CL**6
01231 *----------------------------------------------------------------*   CL**5
01232 *    RESTORE THE DATA ON THE SCREEN FROM THE COMM AREA.          *   CL**5
01233 *----------------------------------------------------------------*   CL**5
01234                                                                      CL**5
01235  4400-MOVE-COMMAREA-TO-SCREEN.                                       CL**5
01236                                                                      CL**5
01237      MOVE ASC-VENDOR-NAME          TO  AVNDRNMO.                     CL**5
01238      MOVE ASC-TP-QUALIFIER         TO  ATPQLFRO.                     CL**5
01239      MOVE ASC-TP-ID                TO  ATPIDO.                       CL**5
01240      MOVE ASC-NETWORK              TO  ANETWRKO.                     CL**5
01241      MOVE ASC-TRAN-SET             TO  ATRNSETO.                     CL**6
01242                                                                      CL**5
01243  EJECT                                                               CL**5
01244 *----------------------------------------------------------------*   CL**5
01245 * READ AN ITEM FROM THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL**5
01246 *----------------------------------------------------------------*   CL**5
01247                                                                      CL**5
01248  9100-READ-SEL-QUEUE.                                                CL**5
01249                                                                      CL**5
01250      EXEC CICS                                                       CL**5
01251          READQ TS                                                    CL**5
01252              QUEUE (ASC-SEL-QUEUE-NAME)                              CL**5
01253              INTO  (ET301-SELECTED-VNDRS)                            CL**5
01254              ITEM  (ASC-SEL-ITEM)                                    CL**5
01255              RESP  (PV-CICS-RESPONSE)                                CL**5
01256      END-EXEC.                                                       CL**5
01257                                                                      CL**5
01258      IF  PV-CICS-RESPONSE EQUAL DFHRESP(NORMAL)                      CL**5
01259          CONTINUE                                                    CL**5
01260      ELSE                                                            CL**5
01261          SET DP013-LOGIC-ABEND                                       CL**5
01262              DP013-NO-ROLLBACK     TO TRUE                           CL**5
01263          MOVE '9100-READ-SEL-QUEUE'                                  CL**5
01264                                    TO DP013-PARAGRAPH                CL**5
01265          MOVE 'ATTEMPTING TO READ THE LIST SELECTIONS TS QUEUE'      CL**5
01266                                    TO DP013-MESSAGE-TEXT (1)         CL**5
01267          PERFORM DP013-0000-PROCESS-ABEND                            CL**5
01268      END-IF.                                                         CL**5
01269                                                                      CL**5
01270  EJECT                                                               CL**5
01271 *----------------------------------------------------------------*   CL**5
01272 * UPDATE AN ITEM IN THE SELECTED ITEMS TEMP STORAGE QUEUE.       *   CL**5
01273 *----------------------------------------------------------------*   CL**5
01274                                                                      CL**5
01275  9200-REWRITE-SEL-QUEUE.                                             CL**5
01276                                                                      CL**5
01277      EXEC CICS                                                       CL**5
01278           WRITEQ TS                                                  CL**5
01279               QUEUE  (ASC-SEL-QUEUE-NAME)                            CL**5
01280               FROM   (ET301-SELECTED-VNDRS)                          CL**5
01281               ITEM   (ASC-SEL-ITEM)                                  CL**5
01282               RESP   (PV-CICS-RESPONSE)                              CL**5
01283               REWRITE                                                CL**5
01284      END-EXEC.                                                       CL**5
01285                                                                      CL**5
01286      IF  PV-CICS-RESPONSE NOT EQUAL DFHRESP(NORMAL)                  CL**5
01287          SET DP013-CICS-ABEND                                        CL**5
01288              DP013-NO-ROLLBACK     TO TRUE                           CL**5
01289          MOVE '9200-REWRITE-SEL-QUEUE'                               CL**5
01290                                    TO DP013-PARAGRAPH                CL**5
01291          MOVE 'ATTEMPTING TO REWRITE THE LIST SELECTIONS QUEUE'      CL**5
01292                                    TO DP013-MESSAGE-TEXT (1)         CL**5
01293          PERFORM DP013-0000-PROCESS-ABEND                            CL**5
01294      END-IF.                                                         CL**5
01295                                                                      CL**5
01296  EJECT                                                               CL**5
01297 *----------------------------------------------------------------*   CL**5
01298 *    ABEND PROCESSOR MODULE                                      *   CL**5
01299 *----------------------------------------------------------------*   CL**5
01300                                                                      CL**5
01301      COPY DPPD013.                                                   CL**5
01302                                                                      CL**5
01303  EJECT                                                               CL**5
01304 *----------------------------------------------------------------*   CL**5
01305 *    CURRENT DATE MODULE                                         *   CL**5
01306 *----------------------------------------------------------------*   CL**5
01307                                                                      CL**5
01308      COPY DPPD017.                                                   CL**5
01309                                                                      CL**5
01310  EJECT                                                               CL**5
