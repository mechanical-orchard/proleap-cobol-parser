000100 IDENTIFICATION DIVISION.                                         00010000
000200 TITLE 'MANIFESTING - AUDIT FUNCTION SUB MENU'.                   00020000
000300                                                                  00030000
000400 PROGRAM-ID.             PCKRF891.                                00040000
000500 AUTHOR.                 DENISE HAHN.                             00050000
000600 INSTALLATION.           KOHLS.                                   00060000
000700 DATE-WRITTEN            MAY, 2001.                               00070000
000800 DATE-COMPILED.                                                   00080000
000900                                                                  00090000
001000******************************************************************00100000
001100 ENVIRONMENT DIVISION.                                            00110000
001200******************************************************************00120000
001300                                                                  00130000
001400******************************************************************00140000
001500 DATA DIVISION.                                                   00150000
001600******************************************************************00160000
001700                                                                  00170000
001800******************************************************************00180000
001900 WORKING-STORAGE SECTION.                                         00190000
002000******************************************************************00200000
002100 01  CA-COMMAREA.                                                 00210000
002200     COPY PCWS233.                                                00220000
002300/                                                                 00230001
002400     05  CA-COMMON-DATA.                                          00240000
002500         10  CA-TRANSACTION-STATUS                                00250000
002600                                         PIC  X(01)  VALUE SPACE. 00260000
002700             88  CA-INITIALIZE-SCREEN                VALUE 'S'.   00270000
002800             88  CA-PROCESS-SCREEN                   VALUE 'R'.   00280000
002900         10  CA-LAST-PROGRAM             PIC  X(08)  VALUE SPACE. 00290000
003000     05  CA-PROGRAM-DATA.                                         00300000
003100         10  CA-SELECTION-X              PIC  X(01)  VALUE SPACE. 00310000
003200         10  CA-SELECTION  REDEFINES  CA-SELECTION-X              00320000
003300                                         PIC  9(01).              00330000
003400             88  CA-VALID-SELECTION                  VALUE        00340000
003500                 1 2.                                             00350000
003600             88  CA-SELECTION-ONE                    VALUE 1.     00360000
003700             88  CA-SELECTION-TWO                    VALUE 2.     00370000
003800                                                                  00380000
003900 01  PC-PROGRAM-CONSTANTS.                                        00390000
004000     05  PC-CURRENT-PROGRAM-NAME         PIC  X(08)  VALUE        00400000
004100         'PCKRF891'.                                              00410000
004200     05  PC-PREV-MENU-TRAN-ID            PIC  X(04)  VALUE 'E868'.00420000
004300     05  PC-PREV-MENU-PROGRAM            PIC  X(08)               00430000
004400                                              VALUE  'PCKRF868'.  00440000
004500     05  PC-MENU-TRANID                  PIC  X(04)  VALUE 'E891'.00450000
004600     05  PC-CARTON-AUDIT-TRAN-S508       PIC  X(04)  VALUE 'S508'.00460000
004700     05  PC-TRAILER-AUDIT-TRAN-E891      PIC  X(04)  VALUE 'E891'.00470000
004800     05  PC-END-OF-SESSION-MSG           PIC  X(19)  VALUE        00480000
004900         'END OF SESSION     '.                                   00490000
005000     05  PC-INVALID-SELECTION-MSG        PIC  X(19)  VALUE        00500000
005100         'INVALID SELECTION  '.                                   00510000
005200     05  PC-UNRECOGNIZED-PF-KEY-MSG      PIC  X(19)  VALUE        00520000
005300         'UNRECOGNIZED PF KEY'.                                   00530000
005400     05  PC-ACCESS-NOT-ALLOWED-MSG       PIC  X(19)  VALUE        00540000
005500         'USER NOT AUTHORIZED'.                                   00550000
005600     05  PC-NON-NUMERIC-SELECTION-MSG    PIC  X(19)  VALUE        00560000
005700         'NUMERIC VALUE REQ. '.                                   00570000
005800     05  PC-PROGRAM-FUNCTION-KEYS        PIC  X(19)  VALUE        00580000
005900         'F3 =END            '.                                   00590001
006000     05  PC-TRANS-UNAVAILABLE-MSG        PIC  X(19)  VALUE        00600000
006100         'TRANS NOT AVAILABLE'.                                   00610000
006200     05  PC-CICS-ABEND-MSG               PIC  X(19)  VALUE        00620000
006300         'CICS ABEND -CALL DP'.                                   00630000
006400     05  PC-CICSAUTH-MSG                 PIC  X(19)  VALUE        00640000
006500         'CICSAUTH BAD RETURN'.                                   00650000
006600     05  PC-UNAVAIL-SELECTION-MSG        PIC X(19)   VALUE        00660000
006700         'SELECTION NOT AVAIL'.                                   00670000
006800                                                                  00680000
006900                                                                  00690000
007000 01  PN-PGM-NAME-DATA.                                            00700000
007100     05  PN-SELECTION-01-PROGRAM         PIC  X(08)  VALUE        00710000
007200         'SUKRF508'.                                              00720000
007300     05  PN-SELECTION-02-PROGRAM         PIC  X(08)  VALUE        00730000
007400         'PCKRF892'.                                              00740000
007500                                                                  00750000
007600 01  PN-PGM-NAME-TABLE  REDEFINES  PN-PGM-NAME-DATA.              00760000
007700     05  PN-PGM-NAME  OCCURS 2 TIMES                              00770000
007800                      INDEXED BY PN-INDX                          00780000
007900                                         PIC  X(08).              00790000
008000                                                                  00800000
008100 01  PS-PROGRAM-SWITCHES.                                         00810000
008200     05  PS-ACCESS-ALLOWED-IND           PIC  X(01)  VALUE 'N'.   00820000
008300         88  PS-NO-ACCESS-ALLOWED                    VALUE 'N'.   00830000
008400         88  PS-ACCESS-ALLOWED                       VALUE 'Y'.   00840000
008500                                                                  00850000
008600                                                                  00860000
008700 01  PV-PROGRAM-VARIABLES.                                        00870000
008800     05  PV-MESSAGE-AREA                 PIC  X(19)  VALUE SPACE. 00880000
008900     05  PV-CICS-RESPONSE                PIC S9(08)  VALUE ZEROS  00890000
009000                                                     COMP SYNC.   00900000
009100     05  PV-TRANSFER-PROGRAM             PIC  X(08)  VALUE SPACE. 00910000
009200     05  PV-COMMAREA-LENGTH              PIC S9(04)  VALUE +10    00920001
009300                                                     COMP.        00930000
009400                                                                  00940000
009500     COPY PCWS188.                                                00950000
009600     COPY PCWS192.                                                00960000
009700/                                                                 00970000
009800******************************************************************00980000
009900*  LAYOUT FOR THE ABEND MODULE COMMUNICATIONS AREA.               00990000
010000******************************************************************01000000
010100     COPY DPWS013.                                                01010000
010200                                                                  01020000
010300******************************************************************01030000
010400*    COPY BOOK FOR THE CICSAUTH SUBROUTINE                        01040000
010500******************************************************************01050000
010600     COPY DPWS008.                                                01060000
010700                                                                  01070000
010800******************************************************************01080000
010900*  SENDING/RECEIVING AREA FOR THE NUMERIC EDIT ROUTINE (DPKUT100) 01090000
011000******************************************************************01100000
011100     COPY DPWS010I.                                               01110000
011200                                                                  01120000
011300******************************************************************01130000
011400*  GENERATED DSECT FOR THE PCKM891 MAPSET                         01140000
011500******************************************************************01150000
011600     COPY PCKM891.                                                01160000
011700                                                                  01170000
011800******************************************************************01180000
011900*  KOHL'S STANDARD ATTRIBUTE AND PRINTER CONTROL CHARACTER LIST   01190000
012000******************************************************************01200000
012100     COPY DPWS015.                                                01210000
012200                                                                  01220000
012300******************************************************************01230000
012400*  KOHL'S STANDARD ATTENTION IDENTIFIER LIST                      01240000
012500******************************************************************01250000
012600     COPY DFHAID.                                                 01260000
012700                                                                  01270000
012800 LINKAGE SECTION.                                                 01280000
012900 01  DFHCOMMAREA.                                                 01290000
013000     05  FILLER                         OCCURS  1 TO 4072 TIMES   01300000
013100                                        DEPENDING ON EIBCALEN.    01310000
013200         10  FILLER                     PIC X.                    01320000
013300                                                                  01330000
013400                                                                  01340000
013500******************************************************************01350000
013600 PROCEDURE DIVISION.                                              01360000
013700******************************************************************01370000
013800 0000-PROGRAM-MAINLINE.                                           01380000
013900     MOVE DFHCOMMAREA                TO CA-COMMAREA.              01390000
014000     MOVE LOW-VALUES                 TO PC891AI.                  01400000
014100                                                                  01410000
014200     EVALUATE TRUE                                                01420000
014300         WHEN EIBCALEN = ZERO                                     01430000
014400         WHEN EIBAID = DFHCLEAR                                   01440000
014500         WHEN PC233-INITIALIZE-SCREEN                             01450000
014600              INITIALIZE CA-COMMAREA                              01460000
014700              MOVE PC-PROGRAM-FUNCTION-KEYS                       01470000
014800                                     TO AMSGLNO                   01480000
014900              PERFORM 8000-SEND-MAP                               01490000
015000              PERFORM 8200-RETURN-TRANID                          01500000
015100                                                                  01510000
015200         WHEN EIBTRNID = 'Z278'                                   01520000
015300             MOVE DFHCOMMAREA         TO PC192-COMMAREA           01530000
015400             MOVE PC192-HOST-SAVE-AREA                            01540000
015500                                      TO CA-COMMAREA              01550000
015600             SET PC233-PROCESS-SCREEN TO TRUE                     01560000
015700             MOVE PC192-HOST-SAVE-MAP TO PC891AO                  01570000
015800             PERFORM 8000-SEND-MAP                                01580000
015900             PERFORM 8200-RETURN-TRANID                           01590000
016000                                                                  01600000
016100         WHEN EIBAID = DFHENTER                                   01610000
016200              PERFORM 1000-RECEIVE-MAP                            01620000
016300              PERFORM 1100-EDIT-SELECTION                         01630000
016400                                                                  01640000
016500         WHEN EIBAID = DFHPF3                                     01650000
016600              MOVE PC-PREV-MENU-PROGRAM                           01660000
016700                                     TO PV-TRANSFER-PROGRAM       01670000
016800              PERFORM 2100-XCTL-TO-SELECTED-PROGRAM               01680000
016900                                                                  01690000
017000         WHEN EIBAID = DFHPF1                                     01700000
017100             PERFORM 1000-RECEIVE-MAP                             01710000
017200             MOVE PC891AO             TO PC192-HOST-SAVE-MAP      01720000
017300             PERFORM 1200-HELP-SCREEN                             01730000
017400                                                                  01740000
017500         WHEN OTHER                                               01750000
017600              MOVE PC-UNRECOGNIZED-PF-KEY-MSG                     01760000
017700                                     TO AMSGLNO                   01770000
017800              PERFORM 8100-SEND-DATA-ONLY                         01780000
017900              PERFORM 8200-RETURN-TRANID                          01790000
018000     END-EVALUATE.                                                01800000
018100                                                                  01810000
018200     GOBACK.                                                      01820000
018300*                                                                 01830000
018400*                                                                 01840000
018500 1000-RECEIVE-MAP.                                                01850000
018600     EXEC CICS                                                    01860000
018700         RECEIVE MAP    ('PC891A')                                01870000
018800                 MAPSET ('PCKM891')                               01880000
018900                 RESP   (PV-CICS-RESPONSE)                        01890000
019000     END-EXEC.                                                    01900000
019100                                                                  01910000
019200     EVALUATE TRUE                                                01920000
019300         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 01930000
019400              PERFORM 1010-RECEIVE-SCREEN-FIELDS                  01940000
019500         WHEN PV-CICS-RESPONSE = DFHRESP (MAPFAIL)                01950000
019600              CONTINUE                                            01960000
019700         WHEN OTHER                                               01970000
019800              MOVE '1000-RECEIVE-MAP'                             01980000
019900                                     TO DP013-PARAGRAPH           01990000
020000              MOVE 'UNABLE TO RECEIVE MAP'                        02000000
020100                                     TO DP013-MESSAGE-TEXT (1)    02010000
020200              SET DP013-LOGIC-ABEND  TO TRUE                      02020000
020300              SET DP013-NO-ROLLBACK  TO TRUE                      02030000
020400              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              02040000
020500     END-EVALUATE.                                                02050000
020600*                                                                 02060000
020700*                                                                 02070000
020800 1010-RECEIVE-SCREEN-FIELDS.                                      02080000
020900     IF  ASELECTL > ZERO                                          02090000
021000         MOVE ASELECTI               TO CA-SELECTION-X            02100000
021100     END-IF.                                                      02110000
021200*                                                                 02120000
021300*                                                                 02130000
021400 1100-EDIT-SELECTION.                                             02140000
021500     MOVE CA-SELECTION-X             TO DP010I-UNEDITED-FIELD.    02150000
021600     MOVE 1                          TO DP010I-MAXIMUM-DIGITS.    02160000
021700     MOVE 0                          TO DP010I-MAXIMUM-DECIMALS.  02170000
021800     SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE.                     02180000
021900                                                                  02190000
022010     CALL DP010I-NUMERIC-EDIT-ROUTINE                             02201002
022020                         USING DP010I-NUMERIC-EDIT-AREA           02202002
022100                                                                  02210000
022200     IF  DP010I-ERROR-DETECTED                                    02220000
022300         MOVE PC-NON-NUMERIC-SELECTION-MSG                        02230000
022400                                     TO AMSGLNO                   02240000
022500         PERFORM 8100-SEND-DATA-ONLY                              02250000
022600         PERFORM 8200-RETURN-TRANID                               02260000
022700     ELSE                                                         02270000
022800         MOVE DP010I-NUMERIC-FIELD   TO CA-SELECTION              02280000
022900     END-IF.                                                      02290000
023000     EVALUATE TRUE                                                02300000
023100     WHEN CA-VALID-SELECTION                                      02310000
023200         PERFORM 2000-PROCESS-SELECTION                           02320000
023300     WHEN OTHER                                                   02330000
023400         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  02340000
023500         MOVE PC-INVALID-SELECTION-MSG                            02350000
023600                                     TO AMSGLNO                   02360000
023700         PERFORM 8100-SEND-DATA-ONLY                              02370000
023800         PERFORM 8200-RETURN-TRANID                               02380000
023900     END-EVALUATE.                                                02390000
024000*                                                                 02400000
024100                                                                  02410000
024200 1200-HELP-SCREEN.                                                02420000
024300     MOVE 'DPKRF278'                  TO PV-TRANSFER-PROGRAM      02430000
024400     MOVE 'PCKRF891'                  TO PC192-PROGRAM-NAME       02440000
024500     COPY PCPD188.                                                02450000
024600     MOVE PC188-DISPLAY-DATE          TO PC192-DISPLAY-DATE.      02460000
024700     MOVE CA-COMMAREA                 TO PC192-HOST-SAVE-AREA     02470000
024800     PERFORM 8220-XCTL-TO-HELP.                                   02480000
024900                                                                  02490000
025000*                                                                 02500000
025100 2000-PROCESS-SELECTION.                                          02510000
025200     SET PN-INDX                     TO CA-SELECTION.             02520000
025300     IF CA-SELECTION < 7                                          02530000
025400         PERFORM 9000-CHECK-RACF                                  02540000
025500     ELSE                                                         02550000
025600         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02560000
025700         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02570000
025800     END-IF.                                                      02580000
025900                                                                  02590000
026000     IF  PS-ACCESS-ALLOWED                                        02600000
026100         MOVE PN-PGM-NAME (PN-INDX)  TO PV-TRANSFER-PROGRAM       02610000
026200         PERFORM 2100-XCTL-TO-SELECTED-PROGRAM                    02620000
026300     ELSE                                                         02630000
026400         MOVE DP015-UNP-NUM-BRT-MDT  TO ASELECTA                  02640000
026500         PERFORM 8100-SEND-DATA-ONLY                              02650000
026600         PERFORM 8200-RETURN-TRANID                               02660000
026700     END-IF.                                                      02670000
026800*                                                                 02680000
026900*                                                                 02690000
027000 2100-XCTL-TO-SELECTED-PROGRAM.                                   02700000
027100     IF PV-TRANSFER-PROGRAM = 'SUKRF508'                          02710000
027200         SET CA-INITIALIZE-SCREEN        TO TRUE                  02720000
027300         MOVE PC-CURRENT-PROGRAM-NAME    TO CA-LAST-PROGRAM       02730000
027400         MOVE LENGTH OF CA-COMMON-DATA TO PV-COMMAREA-LENGTH      02740000
027500                                                                  02750000
027600         EXEC CICS                                                02760000
027700             XCTL                                                 02770000
027800                 PROGRAM   (PV-TRANSFER-PROGRAM)                  02780000
027900                 COMMAREA  (CA-COMMON-DATA)                       02790000
028000                 LENGTH    (PV-COMMAREA-LENGTH)                   02800000
028100                 RESP      (PV-CICS-RESPONSE)                     02810000
028200         END-EXEC                                                 02820000
028300                                                                  02830000
028400     ELSE                                                         02840000
028500         SET PC233-INITIALIZE-SCREEN  TO TRUE                     02850000
028600         MOVE PC-CURRENT-PROGRAM-NAME TO PC233-LAST-PROGRAM       02860000
028700                                         PC233-MENU-PROGRAM       02870000
028800         MOVE LENGTH OF CA-COMMAREA   TO PV-COMMAREA-LENGTH       02880000
028900                                                                  02890000
029000         EXEC CICS                                                02900000
029100             XCTL                                                 02910000
029200                 PROGRAM   (PV-TRANSFER-PROGRAM)                  02920000
029300                 COMMAREA  (CA-COMMAREA)                          02930000
029400                 LENGTH    (PV-COMMAREA-LENGTH)                   02940000
029500                 RESP      (PV-CICS-RESPONSE)                     02950000
029600         END-EXEC                                                 02960000
029700                                                                  02970000
029800     END-IF                                                       02980000
029900                                                                  02990000
030000     EVALUATE TRUE                                                03000000
030100         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03010000
030200              CONTINUE                                            03020000
030300         WHEN OTHER                                               03030000
030400              MOVE '2100-XCTL-TO-SELECTED-PROGRAM'                03040000
030500                                     TO DP013-PARAGRAPH           03050000
030600              MOVE 'UNABLE TO XCTL THE FOLLOWING PROGRAM: '       03060000
030700                                     TO DP013-MESSAGE-TEXT (1)    03070000
030800              MOVE PV-TRANSFER-PROGRAM                            03080000
030900                                     TO DP013-MESSAGE-TEXT (2)    03090000
031000              SET DP013-CICS-ABEND   TO TRUE                      03100000
031100              SET DP013-NO-ROLLBACK  TO TRUE                      03110000
031200              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03120000
031300              MOVE PC-TRANS-UNAVAILABLE-MSG                       03130000
031400                                     TO AMSGLNO                   03140000
031500              SET CA-PROCESS-SCREEN  TO TRUE                      03150000
031600              PERFORM 8100-SEND-DATA-ONLY                         03160000
031700              PERFORM 8200-RETURN-TRANID                          03170000
031800     END-EVALUATE.                                                03180000
031900*                                                                 03190000
032000*                                                                 03200000
032100 8000-SEND-MAP.                                                   03210000
032200     EXEC CICS                                                    03220000
032300         SEND MAP       ('PC891A')                                03230000
032400              MAPSET    ('PCKM891')                               03240000
032500              ERASE                                               03250000
032600              RESP      (PV-CICS-RESPONSE)                        03260000
032700     END-EXEC.                                                    03270000
032800                                                                  03280000
032900     EVALUATE TRUE                                                03290000
033000         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03300000
033100              CONTINUE                                            03310000
033200         WHEN OTHER                                               03320000
033300              MOVE '8000-SEND-MAP'   TO DP013-PARAGRAPH           03330000
033400              MOVE 'UNABLE TO SEND MAP'                           03340000
033500                                     TO DP013-MESSAGE-TEXT (1)    03350000
033600              SET DP013-CICS-ABEND   TO TRUE                      03360000
033700              SET DP013-NO-ROLLBACK  TO TRUE                      03370000
033800              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03380000
033900     END-EVALUATE.                                                03390000
034000*                                                                 03400000
034100*                                                                 03410000
034200 8100-SEND-DATA-ONLY.                                             03420000
034300     MOVE -1 TO ASELECTL.                                         03430000
034400                                                                  03440000
034500     EXEC CICS                                                    03450000
034600         SEND MAP       ('PC891A')                                03460000
034700              MAPSET    ('PCKM891')                               03470000
034800              CURSOR                                              03480000
034900              DATAONLY                                            03490000
035000              RESP      (PV-CICS-RESPONSE)                        03500000
035100     END-EXEC.                                                    03510000
035200                                                                  03520000
035300     EVALUATE TRUE                                                03530000
035400         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03540000
035500              CONTINUE                                            03550000
035600         WHEN OTHER                                               03560000
035700              MOVE '8100-SEND-DATA-ONLY'                          03570000
035800                                     TO DP013-PARAGRAPH           03580000
035900              MOVE 'UNABLE TO SEND DATA'                          03590000
036000                                     TO DP013-MESSAGE-TEXT (1)    03600000
036100              SET DP013-CICS-ABEND   TO TRUE                      03610000
036200              SET DP013-NO-ROLLBACK  TO TRUE                      03620000
036300              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03630000
036400     END-EVALUATE.                                                03640000
036500*                                                                 03650000
036600*                                                                 03660000
036700 8200-RETURN-TRANID.                                              03670000
036800     MOVE LENGTH OF CA-COMMAREA TO PV-COMMAREA-LENGTH             03680000
036900     EXEC CICS                                                    03690000
037000         RETURN TRANSID   (PC-MENU-TRANID)                        03700000
037100                COMMAREA  (CA-COMMAREA)                           03710000
037200                LENGTH    (PV-COMMAREA-LENGTH)                    03720000
037300                RESP      (PV-CICS-RESPONSE)                      03730000
037400     END-EXEC.                                                    03740000
037500                                                                  03750000
037600     EVALUATE TRUE                                                03760000
037700         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 03770000
037800              CONTINUE                                            03780000
037900         WHEN OTHER                                               03790000
038000              MOVE '8200-RETURN-TRANID'                           03800000
038100                                     TO DP013-PARAGRAPH           03810000
038200              MOVE 'UNABLE TO RETURN TO TRANID'                   03820000
038300                                     TO DP013-MESSAGE-TEXT (1)    03830000
038400              SET DP013-CICS-ABEND   TO TRUE                      03840000
038500              SET DP013-NO-ROLLBACK  TO TRUE                      03850000
038600              PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG              03860000
038700     END-EVALUATE.                                                03870000
038800*                                                                 03880000
038900 8220-XCTL-TO-HELP.                                               03890000
039000                                                                  03900000
039100     MOVE LENGTH OF PC192-COMMAREA    TO PV-COMMAREA-LENGTH       03910000
039200                                                                  03920000
039300     EXEC CICS                                                    03930000
039400         XCTL                                                     03940000
039500             PROGRAM   (PV-TRANSFER-PROGRAM)                      03950000
039600             COMMAREA  (PC192-COMMAREA)                           03960000
039700             LENGTH    (PV-COMMAREA-LENGTH)                       03970000
039800             RESP      (PV-CICS-RESPONSE)                         03980000
039900     END-EXEC.                                                    03990000
040000                                                                  04000000
040100     EVALUATE TRUE                                                04010000
040200         WHEN PV-CICS-RESPONSE = DFHRESP (NORMAL)                 04020000
040300              CONTINUE                                            04030000
040400         WHEN OTHER                                               04040000
040500             MOVE '8220-XCTL-TO-HELP' TO DP013-PARAGRAPH          04050000
040600             MOVE 'PCKRF891 - UNABLE TO XCTL TO PROGRAM: '        04060000
040700                                      TO DP013-MESSAGE-TEXT (1)   04070000
040800             MOVE PV-TRANSFER-PROGRAM TO DP013-MESSAGE-TEXT (2)   04080000
040900             SET DP013-CICS-ABEND                                 04090000
041000                 DP013-ROLLBACK       TO TRUE                     04100000
041100             PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG               04110000
041200             MOVE PC-TRANS-UNAVAILABLE-MSG                        04120000
041300                                      TO AMSGLNO                  04130000
041400             SET PC233-PROCESS-SCREEN TO TRUE                     04140000
041500             PERFORM 8000-SEND-MAP                                04150000
041600             PERFORM 8200-RETURN-TRANID                           04160000
041700     END-EVALUATE.                                                04170000
041800/                                                                 04180000
041900*                                                                 04190000
042000 9000-CHECK-RACF.                                                 04200000
042100******************************************************************04210000
042200*  CHECK ACCESSS AUTHORITY OF USER                                04220000
042300******************************************************************04230000
042400     SET DP008-RSRC-TYPE-TRAN        TO TRUE.                     04240000
042500     SET DP008-ACCESS-TYPE-USE       TO TRUE.                     04250000
042600                                                                  04260000
042700     EVALUATE TRUE                                                04270000
042800         WHEN CA-SELECTION-ONE                                    04280000
042900              MOVE PC-CARTON-AUDIT-TRAN-S508                      04290000
043000                                     TO DP008-RESOURCE-NAME       04300000
043100         WHEN CA-SELECTION-TWO                                    04310000
043200              MOVE PC-TRAILER-AUDIT-TRAN-E891                     04320000
043300                                     TO DP008-RESOURCE-NAME       04330000
043400     END-EVALUATE.                                                04340000
043500                                                                  04350000
043600     EXEC CICS                                                    04360000
043700          LINK PROGRAM  (DP008-SECURITY-SUBROUTINE)               04370000
043800               COMMAREA (DP008-SECURITY-COMMAREA)                 04380000
043900               LENGTH   (DP008-SECURITY-COMMAREA-LENGTH)          04390000
044000               RESP     (PV-CICS-RESPONSE)                        04400000
044100     END-EXEC.                                                    04410000
044200                                                                  04420000
044300     IF  PV-CICS-RESPONSE = DFHRESP(NORMAL)                       04430000
044400         IF  DP008-CALL-SUCCESSFUL                                04440000
044500             IF  DP008-ACCESS-ALLOWED                             04450000
044600                 SET PS-ACCESS-ALLOWED                            04460000
044700                                     TO TRUE                      04470000
044800             ELSE                                                 04480000
044900                 MOVE PC-ACCESS-NOT-ALLOWED-MSG                   04490000
045000                                     TO AMSGLNO                   04500000
045100             END-IF                                               04510000
045200         ELSE                                                     04520000
045300             MOVE PC-CICSAUTH-MSG    TO AMSGLNO                   04530000
045400         END-IF                                                   04540000
045500     ELSE                                                         04550000
045600         MOVE '9000-CHECK-RACF'      TO DP013-PARAGRAPH           04560000
045700         MOVE 'BAD LINK TO RACF PROGRAM'                          04570000
045800                                     TO DP013-MESSAGE-TEXT (1)    04580000
045900         SET DP013-CICS-ABEND        TO TRUE                      04590000
046000         SET DP013-NO-ROLLBACK       TO TRUE                      04600000
046100         PERFORM 9999-WRITE-MESSAGE-TO-CICS-LOG                   04610000
046200     END-IF.                                                      04620000
046300*                                                                 04630000
046400*                                                                 04640000
046500 9999-WRITE-MESSAGE-TO-CICS-LOG.                                  04650000
046600     MOVE PC-CURRENT-PROGRAM-NAME    TO DP013-PROGRAM.            04660000
046700     MOVE DFHEIBLK                   TO DP013-DFHEIBLK.           04670000
046800     INITIALIZE DP013-SRC-TASK-NUMBER                             04680000
046900                DP013-STACK.                                      04690000
047000     SET DP013-LINK-RETURN           TO TRUE.                     04700000
047100                                                                  04710000
047200     EXEC CICS                                                    04720000
047300         LINK                                                     04730000
047400             PROGRAM   (DP013-NAME)                               04740000
047500             COMMAREA  (DP013-PARAMETERS)                         04750000
047600             LENGTH    (DP013-LENGTH)                             04760000
047700     END-EXEC.                                                    04770000
