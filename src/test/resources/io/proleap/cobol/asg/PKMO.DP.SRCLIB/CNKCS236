000100*-----------------------*                                         00010002
000200 IDENTIFICATION DIVISION.                                         00020002
000300*-----------------------*                                         00030002
000400 PROGRAM-ID.    CNKCS236.                                         00040002
000500 AUTHOR.        DENISE HAHN.                                      00050002
000600 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00060002
000700 DATE-WRITTEN.  AUGUST, 2012.                                     00070015
000800 DATE-COMPILED.                                                   00080002
000900                                                                  00090002
001000*---------------------------------------------------------------* 00100002
001100*    Y236 - TKRPRCD - CODE LIST                                 * 00110002
001200*---------------------------------------------------------------* 00120002
263455* CHANGED 11/03/2021    BY JIM HUNTER      WR: CHG0263455         00121027
263455* CHANGE CALL OF DPKUT100 TO CALL DP010I-NUMERIC-EDIT-ROUTINE     00122027
263455* MAKING THE CALL DYNAMIC VS STATIC.                              00123027
263455*----------------------------------------------------------------*00124027
CICS  * CHANGED 10/25/2022    BY JIM HUNTER      WR: CHG0276961         00125028
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00126028
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00127028
CICS  *-----------------------------------------------------------------00128028
001300 ENVIRONMENT DIVISION.                                            00130002
001400 DATA DIVISION.                                                   00140002
001500                                                                  00150002
001600 WORKING-STORAGE SECTION.                                         00160002
001700*                                                                 00170002
001800 01  DK-DB2-KEYS.                                                 00180002
001900     05  DK-CODE-PARM              PIC X(06)      VALUE SPACES.   00190005
002200                                                                  00220002
002300 01  PC-PROGRAM-CONSTANTS.                                        00230002
002400     05  PC-CURRENT-MAP-NAME       PIC  X(08)  VALUE 'CNK236  '.  00240002
002500     05  PC-CURRENT-MAPSET-NAME    PIC  X(08)  VALUE 'CNKM236 '.  00250002
002600     05  PC-CURRENT-PROGRAM-NAME   PIC  X(08)  VALUE 'CNKCS236'.  00260002
002700     05  PC-LIST-QUEUE-SEQ         PIC  9(01)  VALUE 1.           00270002
002800     05  PC-SEL-QUEUE-SEQ          PIC  9(01)  VALUE 2.           00280002
002900     05  PC-CRIT-SPEC-FORMAT       PIC  X(01)  VALUE '1'.         00290002
003000     05  PC-ITEMS-PER-PANEL        PIC S9(04)  VALUE +13          00300002
003100                                               COMP SYNC.         00310002
003200     05  PC-MAX-BLOCKS-IN-ARRAY    PIC S9(04)  VALUE +2           00320002
003300                                               COMP SYNC.         00330002
003400     05  PC-MAX-ITEMS              PIC S9(09)  VALUE +1000000     00340002
003500                                               COMP-3.            00350002
003600     05  PC-MSG-NUMBER-LENGTH      PIC S9(04)  VALUE +5           00360002
003700                                               COMP SYNC.         00370002
003800     05  PC-MAX-RETRIES            PIC S9(03)  VALUE 3            00380002
003900                                               COMP-3.            00390002
004000     05  PC-INQ                    PIC  X(03)  VALUE 'INQ'.       00400002
004100     05  PC-ADD                    PIC  X(03)  VALUE 'ADD'.       00410002
004200     05  PC-UPD                    PIC  X(03)  VALUE 'UPD'.       00420002
004300     05  PC-DEL                    PIC  X(03)  VALUE 'DEL'.       00430002
004400     05  PC-ERR                    PIC  X(03)  VALUE 'ERR'.       00440002
004500     05  PC-A                      PIC  X(01)  VALUE 'A'.         00450002
004600                                                                  00460002
004700*----------------------------------------------------------------*00470002
004800*  SYSTEM MESSAGES                                               *00480002
004900*----------------------------------------------------------------*00490002
005000*   00005 = INVALID VALUE                                        *00500002
005100*   00008 = MUST BE NUMERIC                                      *00510002
005200*   00050 - NO LIST ITEMS WERE FOUND FOR THE CRITERIA SPECIFIED  *00520002
005300*   00051 - NO END OF RANGE HAS BEEN SPECIFIED                   *00530002
005400*   00052 - END OF RANGE PRECEDES START OF RANGE                 *00540002
005500*   00053 - NO START OF RANGE HAS BEEN SPECIFIED                 *00550002
005600*   00054 - ONLY ONE START OF RANGE INDICATOR MAY BE SPECIFIED   *00560002
005700*   00055 - ONLY ONE END OF RANGE INDICATOR MAY BE SPECIFIED     *00570002
005800*   00057 - A LIST ITEM MUST BE SELECTED FOR THIS FUNCTION       *00580002
005900*   00069 - TOP OF LIST                                          *00590002
006000*   00070 - BOTTOM OF LIST                                       *00600002
006100*   00101 - VALUE MUST BE > ZERO AND  < 1,000,000                *00610002
006200*   00279 - MORE ITEMS TO DISPLAY                                *00620002
006300*----------------------------------------------------------------*00630002
006400     05  PC-TSYMSG-NUMBERS.                                       00640002
006500         10  PC-TSYMSG-00005            PIC  9(05)  VALUE 00005.  00650002
006600         10  PC-TSYMSG-00008            PIC  9(05)  VALUE 00008.  00660002
006700         10  PC-TSYMSG-00050            PIC  9(05)  VALUE 00050.  00670002
006800         10  PC-TSYMSG-00051            PIC  9(05)  VALUE 00051.  00680002
006900         10  PC-TSYMSG-00052            PIC  9(05)  VALUE 00052.  00690002
007000         10  PC-TSYMSG-00053            PIC  9(05)  VALUE 00053.  00700002
007100         10  PC-TSYMSG-00054            PIC  9(05)  VALUE 00054.  00710002
007200         10  PC-TSYMSG-00055            PIC  9(05)  VALUE 00055.  00720002
007300         10  PC-TSYMSG-00057            PIC  9(05)  VALUE 00057.  00730002
007400         10  PC-TSYMSG-00069            PIC  9(05)  VALUE 00069.  00740002
007500         10  PC-TSYMSG-00070            PIC  9(05)  VALUE 00070.  00750002
007600         10  PC-TSYMSG-00101            PIC  9(05)  VALUE 00101.  00760002
007700         10  PC-TSYMSG-00279            PIC  9(05)  VALUE 00279.  00770002
007800                                                                  00780002
007900 01  PS-PROGRAM-SWITCHES.                                         00790002
008000     05  PS-ERROR-SW                    PIC  X(01)  VALUE 'Y'.    00800002
008100         88  PS-NO-ERROR                            VALUE 'Y'.    00810002
008200         88  PS-ERROR                               VALUE 'N'.    00820002
008300     05  PS-BLOCK-ERROR-SW              PIC  X(01)  VALUE 'Y'.    00830002
008400         88  PS-NO-BLOCK-ERROR                      VALUE 'Y'.    00840002
008500         88  PS-BLOCK-ERROR                         VALUE 'N'.    00850002
008600     05  PS-COMMAREA-SW                 PIC  X(01)  VALUE 'N'.    00860002
008700         88  PS-COMMAREA-VALID                      VALUE 'Y'.    00870002
008800         88  PS-COMMAREA-NOT-VALID                  VALUE 'N'.    00880002
008900                                                                  00890002
009000 01  PV-PROGRAM-VARIABLES.                                        00900002
009100     15  PV-TKRPRPM-COUNT               PIC S9(09) COMP.          00910011
009101     15  PV-DISP-COUNT                  PIC  ZZZ9.                00910113
009110                                                                  00911011
009200     15  PV-WORK-YEAR-CHAR              PIC  X(04).               00920002
009300     15  PV-RECORD-TYPE                 PIC  X(01).               00930002
009400                                                                  00940002
009500     05  PV-SUB                         PIC S9(04)  VALUE +0      00950002
009600                                                    COMP SYNC.    00960002
009700     05  PV-REMAINDER                   PIC S9(04)  VALUE +0      00970002
009800                                                    COMP SYNC.    00980002
009900     05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      00990002
010000                                                    COMP-3.       01000002
010100     05  PV-ITEMS-PROCESSED             PIC S9(09)  VALUE +0      01010002
010200                                                    COMP-3.       01020002
010300     05  PV-HOLD-SELECTED-ITEMS         PIC S9(09)  VALUE +0      01030002
010400                                                    COMP-3.       01040002
010500     05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      01050002
010600                                                    COMP-3.       01060002
010700     05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      01070002
010800                                                    COMP-3.       01080002
010900     05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      01090002
011000                                                    COMP-3.       01100002
011100     05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      01110002
011200                                                    COMP-3.       01120002
011300     05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      01130002
011400                                                    COMP SYNC.    01140002
011500     05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      01150002
011600                                                    COMP SYNC.    01160002
011700     05  PV-ITEM                        PIC S9(04)  VALUE +0      01170002
011800                                                    COMP SYNC.    01180002
011900     05  PV-SEL-QUEUE-ITEM              PIC S9(04)  VALUE +0      01190002
012000                                                    COMP SYNC.    01200002
012100     05  PV-SAVE-ITEM                   PIC S9(04)  VALUE +0      01210002
012200                                                    COMP SYNC.    01220002
012300     05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      01230002
012400                                                    COMP SYNC.    01240002
012500     05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      01250002
012600                                                    COMP SYNC.    01260002
012700     05  PV-FIRST-BLOCK-IN-ARRAY        PIC S9(04)  VALUE +0      01270002
012800                                                    COMP SYNC.    01280002
012900     05  PV-NEXT-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01290002
013000                                                    COMP SYNC.    01300002
013100     05  PV-PREV-BLOCK-IN-ARRAY         PIC S9(04)  VALUE +0      01310002
013200                                                    COMP SYNC.    01320002
013300     05  PV-FIRST-BLOCK-IN-RANGE        PIC S9(04)  VALUE +0      01330002
013400                                                    COMP SYNC.    01340002
013500     05  PV-LAST-BLOCK-IN-RANGE         PIC S9(04)  VALUE +0      01350002
013600                                                    COMP SYNC.    01360002
013700     05  PV-START-OF-SELECTED-RANGE     PIC S9(04)  VALUE +0      01370002
013800                                                    COMP SYNC.    01380002
013900     05  PV-END-OF-SELECTED-RANGE       PIC S9(04)  VALUE +0      01390002
014000                                                    COMP SYNC.    01400002
014100     05  PV-RETRY-COUNTER               PIC S9(04)  VALUE +0      01410002
014200                                                    COMP SYNC.    01420002
014300                                                                  01430002
014400     05  PV-ORIGINAL-BLOCK               PIC S9(04)  VALUE +0     01440002
014500                                                     COMP SYNC.   01450002
014600     05  PV-ITEMS-HOLD                   PIC S9(03)  COMP-3.      01460002
014700     05  PV-ITEMS-DIFF                   PIC S9(03)  COMP-3.      01470002
014800                                                                  01480002
014900******************************************************************01490002
015000**  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **01500002
015100**  THIS MUST BE THE EXACT SAME FORMAT AS BLOCK IN THE          **01510002
015200**  APPLICATION-SPECIFIC COMMAREA.                              **01520002
015300******************************************************************01530002
015400 01  LQW-LIST-QUEUE-WORK-AREA.                                    01540002
015500     05  LQW-BLOCK-MODIFIED             PIC  X(01)  VALUE SPACE.  01550002
015600     05  LQW-ITEM-ENTRIES               OCCURS 13 TIMES           01560002
015700                                        INDEXED BY LQW-IDX.       01570002
015800         10  LQW-LIST-ITEM-NUMBER       PIC S9(09)  COMP-3.       01580002
015900         10  LQW-TEMP-SELECTED-SW       PIC  X(01).               01590002
016000         10  LQW-SELECTED-SW            PIC  X(01).               01600002
016100             88  LQW-SELECT                         VALUE 'S'.    01610002
016200             88  LQW-DESELECT                       VALUE ' '.    01620002
016300         10  LQW-ACTION                 PIC  X(03).               01630002
016400             88  LQW-ADD                            VALUE 'ADD'.  01640002
016500             88  LQW-INQ                            VALUE 'INQ'.  01650002
016600             88  LQW-UPD                            VALUE 'UPD'.  01660002
016700             88  LQW-ERR                            VALUE 'ERR'.  01670002
016800         10  LQW-FUNC-CODE              PIC  X(06).               01680005
017200         10  LQW-FUNC-DESC              PIC  X(40).               01720005
017300         10  LQW-TYPE                   PIC  X(02).               01730005
017400         10  LQW-COUNT                  PIC  X(04).               01740005
017800         10  FILLER                     PIC  X(10).               01780002
017900                                                                  01790002
018000*---------------------------------------------------------------* 01800002
018100* SELECTION QUEUE LAYOUT                                        * 01810002
018200*---------------------------------------------------------------* 01820002
018300     COPY CNWS019.                                                01830002
018400                                                                  01840002
018500*---------------------------------------------------------------* 01850002
018600*    MAP LAYOUT                                                 * 01860002
018700*---------------------------------------------------------------* 01870002
018800     COPY CNKM236.                                                01880002
018900*                                                                 01890002
019000 01  MR-OCCURS-LAYOUT                   REDEFINES  CNK236O.       01900002
019100     05  FILLER                         PIC X(42).                01910002
019200     05  MR-SCROLL-AREA                 OCCURS 13 TIMES.          01920002
019300         10  MR-SELECTL                 PIC S9(04) COMP.          01930002
019400         10  MR-SELECTA                 PIC  X(01).               01940002
019500         10  MR-SELECTC                 PIC  X(01).               01950002
019600         10  MR-SELECTH                 PIC  X(01).               01960002
019700         10  MR-SELECTI                 PIC  X(01).               01970002
019800                                                                  01980002
019900         10  MR-ACTIONL                 PIC S9(04) COMP.          01990002
020000         10  MR-ACTIONA                 PIC  X(01).               02000002
020100         10  MR-ACTIONC                 PIC  X(01).               02010002
020200         10  MR-ACTIONH                 PIC  X(01).               02020002
020300         10  MR-ACTION                  PIC  X(03).               02030002
020400                                                                  02040002
020500         10  MR-FUNCTL                 PIC S9(04) COMP.           02050004
020600         10  MR-FUNCTA                 PIC  X(01).                02060004
020700         10  MR-FUNCTC                 PIC  X(01).                02070004
020800         10  MR-FUNCTH                 PIC  X(01).                02080004
020900         10  MR-FUNCT                  PIC  X(06).                02090004
021000                                                                  02100002
021100         10  MR-DESCRL                 PIC S9(04) COMP.           02110004
021200         10  MR-DESCRA                 PIC  X(01).                02120004
021300         10  MR-DESCRC                 PIC  X(01).                02130004
021400         10  MR-DESCRH                 PIC  X(01).                02140004
021500         10  MR-DESCR                  PIC  X(40).                02150004
021600                                                                  02160002
021700         10  MR-TYPEL                  PIC S9(04) COMP.           02170004
021800         10  MR-TYPEA                  PIC  X(01).                02180004
021900         10  MR-TYPEC                  PIC  X(01).                02190004
022000         10  MR-TYPEH                  PIC  X(01).                02200004
022100         10  MR-TYPE                   PIC  X(02).                02210010
022200                                                                  02220002
022300         10  MR-COUNTL                 PIC S9(04) COMP.           02230004
022400         10  MR-COUNTA                 PIC  X(01).                02240004
022500         10  MR-COUNTC                 PIC  X(01).                02250004
022600         10  MR-COUNTH                 PIC  X(01).                02260004
022700         10  MR-COUNT                  PIC  X(04).                02270004
022800                                                                  02280002
024700     05  FILLER                         PIC  X(12).               02470002
024800                                                                  02480002
024900*----------------------------------------------------------------*02490002
025000*    ATTRIBUTE SETTINGS COPYBOOK.                               * 02500002
025100*---------------------------------------------------------------* 02510002
025200     COPY DPWS015.                                                02520002
025300                                                                  02530002
025400*---------------------------------------------------------------* 02540002
025500*    FUNCTION KEYS COPYBOOK.                                    * 02550002
025600*---------------------------------------------------------------* 02560002
025700     COPY DPWS016.                                                02570002
025800                                                                  02580002
025900*---------------------------------------------------------------* 02590002
026000*    NUMERIC EDIT LAYOUT.                                       * 02600002
026100*---------------------------------------------------------------* 02610002
026200     COPY DPWS010I.                                               02620002
026300                                                                  02630002
026400*---------------------------------------------------------------* 02640002
CICS  *    PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.          * 02650028
026600*---------------------------------------------------------------* 02660002
026700     COPY DPWS030.                                                02670002
CICS       COPY DPWS930.                                                02671028
026800                                                                  02680002
026900*---------------------------------------------------------------* 02690002
027000*    STANDARD COMMAREA.                                         * 02700002
027100*---------------------------------------------------------------* 02710002
027200     COPY DPWS020.                                                02720002
027300     05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                02730002
027400                                                                  02740002
027500*---------------------------------------------------------------* 02750002
027600* INTER-APPLICATION COMMAREA.                                   * 02760002
027700*   CNWS014 - IS THE INPUT LAYOUT WHEN COMING FROM THE CRIT.    * 02770002
027800*             SPEC SCREEN.                                      * 02780002
027900*   CNWS018 - IS THE OUTPUT LAYOUT THAT WILL BE PASSED FROM     * 02790002
028000*             THIS LIST PROGRAMMING FOR A LOCAL-GO FUNCTION.    * 02800002
028100*---------------------------------------------------------------* 02810002
028200         10  INTER-APPL-COMM-AREA       PIC X(200).               02820002
028300     COPY CNWS014.                                                02830002
028400     COPY CNWS018.                                                02840002
028500                                                                  02850002
028600*---------------------------------------------------------------* 02860002
028700*  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 02870002
028800*---------------------------------------------------------------* 02880002
028900                                                                  02890002
029000         10  ASC-SPECIFIC-COMMAREA.                               02900002
029200             15  ASC-FUNCTION                 PIC  X(02).         02920008
029201                 88  ASC-FUNCTION-NONE             VALUE ' '.     02920104
029202                 88  ASC-ADD-CODE                  VALUE 'AC'.    02920204
029203                 88  ASC-UPD-CODE                  VALUE 'UC'.    02920304
029204                 88  ASC-ADD-PARM                  VALUE 'AP'.    02920404
029205                 88  ASC-UPD-PARM                  VALUE 'UP'.    02920504
029210             15  ASC-OPER-UNT-ID              PIC  9(04).         02921004
029220             15  ASC-OPER-UNT-NAME            PIC  X(26).         02922004
029230             15  ASC-PARM-NAME                PIC  X(06).         02923004
029240             15  ASC-PARM-DESC                PIC  X(40).         02924004
029250             15  ASC-PARM-TYPE                PIC  X(02).         02925004
029260                 88  ASC-VALID-TYPE                VALUE 'DT',    02926008
029261                                                         'PC',    02926108
029262                                                         'QT',    02926208
029263                                                         'TX'.    02926308
029270                 88  ASC-TYPE-DATE                 VALUE 'DT'.    02927008
029280                 88  ASC-TYPE-PCNT                 VALUE 'PC'.    02928008
029290                 88  ASC-TYPE-QTY                  VALUE 'QT'.    02929008
029300                 88  ASC-TYPE-TEXT                 VALUE 'TX'.    02930008
029310                                                                  02931004
029400             15  ASC-BLK-SUB                  PIC S9(04) COMP     02940002
029500                                                         SYNC.    02950002
029600             15  ASC-ITEM-SUB                 PIC S9(04) COMP     02960002
029700                                                         SYNC.    02970002
029800             15  ASC-NUMBER-OF-ITEMS-READ     PIC S9(09) COMP-3.  02980002
029900             15  ASC-NUMBER-OF-SELECTED-ITEMS PIC S9(09) COMP-3.  02990002
030000             15  ASC-ITEMS-DISPLAYED          PIC S9(03) COMP-3.  03000002
030100             15  ASC-ITEM-AT-TOP-OF-PANEL     PIC S9(09) COMP-3.  03010002
030200             15  ASC-ITEM-AT-BOT-OF-PANEL     PIC S9(09) COMP-3.  03020002
030300             15  ASC-HIGHEST-BLOCK-WRITTEN    PIC S9(04) COMP     03030002
030400                                                         SYNC.    03040002
030500             15  ASC-START-OF-SELECTED-RANGE  PIC S9(09) COMP-3.  03050002
030600             15  ASC-END-OF-SELECTED-RANGE    PIC S9(09) COMP-3.  03060002
030700             15  ASC-ITEMS-LEFT-INDICATOR     PIC  X(01).         03070002
030800                 88  ASC-ITEMS-LEFT-ON-DB          VALUE 'Y'.     03080002
030900                 88  ASC-NO-ITEMS-LEFT-ON-DB       VALUE 'N'.     03090002
031000             15  ASC-TEMP-QUEUE-UPDATE-SW     PIC  X(01).         03100002
031100                 88  ASC-UPDATE-TSQ                VALUE 'Y'.     03110002
031200                 88  ASC-NO-TSQ-UPDATE             VALUE ' '.     03120002
031300             15  ASC-LIST-QUEUE-NAME.                             03130002
031400                 20  ASC-LIST-TERM-ID         PIC  X(04).         03140002
031500                 20  ASC-LIST-TASK-NUMBER     PIC S9(05) COMP-3.  03150002
031600                 20  ASC-LIST-SEQ             PIC  9(01).         03160002
031700                                                                  03170002
031800             15  ASC-START-ITEM-REQUEST.                          03180002
031900                 20  ASC-START-ITEM-REQUEST-N PIC  9(05).         03190002
032000                                                                  03200002
032100             15  ASC-SEL-SUB                  PIC S9(4) COMP.     03210002
032200             15  ASC-SEL-ITEM                 PIC S9(4) COMP.     03220002
032300             15  ASC-CURSOR-SW                PIC  X(02).         03230002
032400                 88  ASC-NO-CURSOR                   VALUE 'Z '.  03240002
032500                 88  ASC-CODE-PARM-NAME-CSR          VALUE 'A '.  03250005
032600                 88  ASC-CODE-PARM-ALL-CSR           VALUE 'B '.  03260005
032700                                                                  03270002
032800             15  ASC-USE-SELECTION-QUEUE-IND  PIC  X(1).          03280002
032900                 88  ASC-USE-SELECTION-QUEUE           VALUE 'Y'. 03290002
033000             15  ASC-SEL-QUEUE-NAME.                              03300002
033100                 20  ASC-SEL-TERM-ID          PIC  X(04).         03310002
033200                 20  ASC-SEL-TASK-NUMBER      PIC S9(05) COMP-3.  03320002
033300                 20  ASC-SEL-SEQ              PIC  9(01).         03330002
033400                                                                  03340002
033410             15  ASC-SEL-QUEUE-NAME-2.                            03341026
033420                 20  ASC-SEL-TERM-ID-2        PIC  X(04).         03342026
033430                 20  ASC-SEL-TASK-NUMBER-2    PIC S9(05) COMP-3.  03343026
033440                 20  ASC-SEL-SEQ-2            PIC  9(01).         03344026
033450                                                                  03345026
033500             15  ASC-NUMBER-OF-TS-ITEMS       PIC S9(09) COMP-3.  03350002
033600                                                                  03360002
034800             15  FILLER                              PIC X(100).  03480002
034900                                                                  03490002
035000*-----------------------------------------------------------------03500002
035100             15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                03510002
035200                 20  ASC-BLOCK-MODIFIED-SW           PIC  X(01).  03520002
035300                     88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   03530002
035400                     88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   03540002
035500                                                                  03550002
035600                 20  ASC-ITEM-ARRAY.                              03560002
035700                     25  ASC-ITEM-ENTRIES OCCURS 13 TIMES.        03570002
035800                         30  ASC-LIST-ITEM-NUMBER                 03580002
035900                                                     PIC S9(09)   03590002
036000                                                     COMP-3.      03600002
036100                         30  ASC-TEMP-SELECTED-SW    PIC  X(01).  03610002
036200                             88  ASC-VALID-SELECT    VALUE ' '    03620002
036300                                                           'S'    03630002
036400                                                           'B'    03640002
036500                                                           'E'.   03650002
036600                             88  ASC-TEMP-NO-SELECT  VALUE ' '.   03660002
036700                             88  ASC-TEMP-SELECT     VALUE 'S'.   03670002
036800                             88  ASC-TEMP-BEGIN      VALUE 'B'.   03680002
036900                             88  ASC-TEMP-END        VALUE 'E'.   03690002
037000                         30  ASC-SELECTED-SW         PIC  X(01).  03700002
037100                             88  ASC-NO-SELECT       VALUE ' '.   03710002
037200                             88  ASC-SELECT          VALUE 'S'.   03720002
037300                             88  ASC-BEGIN           VALUE 'B'.   03730002
037400                             88  ASC-END             VALUE 'E'.   03740002
037500                         30  ASC-ACTION              PIC  X(03).  03750002
037600                         30  ASC-FUNC-CODE           PIC  X(06).  03760008
038000                         30  ASC-FUNC-DESC           PIC  X(40).  03800008
038100                         30  ASC-TYPE                PIC  X(02).  03810004
038200                         30  ASC-COUNT               PIC  9(04).  03820004
038600                         30  FILLER                  PIC  X(10).  03860002
038700                                                                  03870002
038800                                                                  03880002
038900                                                                  03890002
039000*---------------------------------------------------------------* 03900002
039100*    ABEND PROCESSING COPYBOOK.                                 * 03910002
039200*---------------------------------------------------------------* 03920002
039300     COPY DPWS013.                                                03930002
039400                                                                  03940002
039500*----------------------------------------------------------------*03950002
039600*    DB2 TABLE FOR TKRPRCD   APPLICATION CODE TABLE               03960004
039700*----------------------------------------------------------------*03970002
039800     EXEC SQL                                                     03980002
039900          INCLUDE TKRPRCD                                         03990006
040000     END-EXEC.                                                    04000002
040100                                                                  04010002
040200                                                                  04020002
040210*----------------------------------------------------------------*04021011
040220*    DB2 TABLE FOR TKRPRPM   APPLICATION PARM TABLE               04022011
040230*----------------------------------------------------------------*04023011
040240     EXEC SQL                                                     04024011
040250          INCLUDE TKRPRPM                                         04025011
040260     END-EXEC.                                                    04026011
040270                                                                  04027011
040280                                                                  04028011
040300*---------------------------------------------------------------* 04030002
040400* TKRPRCD CURSOR WHEN THE CODE WAS ENTERED                      * 04040004
041000*---------------------------------------------------------------* 04100002
041100     EXEC SQL                                                     04110002
041200        DECLARE CODE-PARM-NAME-CSR CURSOR FOR                     04120004
041300         SELECT                                                   04130004
041400                SYS_PRC_FUNC_CDE                                  04140004
041500              , SYS_PRC_FUNC_DESC                                 04150004
041600              , PRC_FUNC_TYP_CDE                                  04160004
042100          FROM TKRPRCD A                                          04210004
042200         WHERE SYS_PRC_FUNC_CDE = :DK-CODE-PARM                   04220004
042300         ORDER BY SYS_PRC_FUNC_CDE                                04230004
042400     END-EXEC.                                                    04240004
047500                                                                  04750002
047600*---------------------------------------------------------------* 04760002
047700*  TKRPRCD CURSOR WHEN THE CODE IS NOT ENTERED                    04770004
048200*---------------------------------------------------------------* 04820002
048300     EXEC SQL                                                     04830002
048400        DECLARE CODE-PARM-ALL-CSR CURSOR FOR                      04840004
048410         SELECT                                                   04841004
048420                SYS_PRC_FUNC_CDE                                  04842004
048430              , SYS_PRC_FUNC_DESC                                 04843004
048440              , PRC_FUNC_TYP_CDE                                  04844004
048450          FROM TKRPRCD A                                          04845004
048470         ORDER BY SYS_PRC_FUNC_CDE                                04847004
052800     END-EXEC.                                                    05280002
052900                                                                  05290002
053000                                                                  05300002
053100*---------------------------------------------------------------* 05310002
053200*    DB2 AREA FOR COMMUNICATIONS                                * 05320002
053300*---------------------------------------------------------------* 05330002
053400     EXEC SQL                                                     05340002
053500          INCLUDE SQLCA                                           05350002
053600     END-EXEC.                                                    05360002
053700                                                                  05370002
053800***************************************************************** 05380002
053900 LINKAGE SECTION.                                                 05390002
054000                                                                  05400002
054100 01  DFHCOMMAREA.                                                 05410002
054200     05  FILLER                         OCCURS  1 TO 4072 TIMES   05420002
054300                                        DEPENDING ON EIBCALEN.    05430002
054400         10  FILLER                     PIC X.                    05440002
054500                                                                  05450002
054600                                                                  05460002
054700 PROCEDURE DIVISION.                                              05470002
054800******************************************************************05480002
054900**  THIS MODULE IS THE HIGHEST PROCESSING LEVEL IN THE PROGRAM. **05490002
055000**  FIRST, CALL THE CICS ARCHITECTURE API, PERFORM THE PROGRAM  **05500002
055100**  PROCESSING AND THEN CALL THE CICS ARCHITECTURE API TO EXIT. **05510002
055200******************************************************************05520002
055300                                                                  05530002
055400 0000-MAIN-MODULE.                                                05540002
055500     INITIALIZE DP030-CICS-API-FIELDS.                            05550002
055600     MOVE +1                       TO DP030-NUMBER-OF-MAPS.       05560002
055700     MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          05570002
055800     MOVE PC-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         05580002
055900     SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       05590002
056000     MOVE LENGTH OF CNK236I        TO DP030-MAP-LENGTH (1).       05600002
056100     MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     05610002
056200     PERFORM 0001-CALL-CICS-ARCH-API.                             05620002
056300                                                                  05630002
056400     PERFORM 1000-CONTROL-PROCESSING                              05640002
056500                                                                  05650002
056600     MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     05660002
056700     PERFORM 0001-CALL-CICS-ARCH-API.                             05670002
056800                                                                  05680002
056900******************************************************************05690002
057000**  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **05700002
057100**  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **05710002
057200******************************************************************05720002
057300 0001-CALL-CICS-ARCH-API.                                         05730002
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      05740028
057500                                    DFHCOMMAREA                   05750028
057600                                    DP030-CICS-API-FIELDS         05760028
057700                                    DP020-STANDARD-COMMAREA       05770028
057800                                    CNK236I.                      05780028
057900                                                                  05790002
058000     IF  DP030-RC-CALL-SUCCESSFUL                                 05800002
058100         CONTINUE                                                 05810002
058200     ELSE                                                         05820002
058300         SET DP013-NO-ROLLBACK                                    05830002
058400             DP013-XCTL-DISPLAY-RESTART                           05840002
058500             DP013-CICS-ABEND      TO TRUE                        05850002
058600         MOVE '0001-CALL-CICS-ARCH-API'                           05860002
058700                                   TO DP013-PARAGRAPH             05870002
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O05871028
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      05872028
059000         MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      05900002
059100         PERFORM DP013-0000-PROCESS-ABEND                         05910002
059200     END-IF.                                                      05920002
059300                                                                  05930002
059400*----------------------------------------------------------------*05940002
059500* PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *05950002
059600* COURSE OF ACTION IS FOR THIS TRANSACTION.                      *05960002
059700*                                                                *05970002
059800* NOTE:  PV-TOP-ITEM IS THE ITEM THAT IS REQUESTED TO BE AT THE  *05980002
059900*  TOP OF THE PANEL.  MOVING ASC-ITEM-AT-TOP-OF-PANEL TO THIS    *05990002
060000*  MEANS THAT POSITION WITHIN THE LIST WILL NOT CHANGE -- THIS   *06000002
060100*  IS THE DEFAULT WHICH WILL BE OVERRIDDEN BY SCROLLING ACTIONS. *06010002
060200*----------------------------------------------------------------*06020002
060300 1000-CONTROL-PROCESSING.                                         06030002
060400     EVALUATE TRUE                                                06040002
060500         WHEN DP020-NEXT-ACT-INITIAL                              06050002
060600             INITIALIZE ASC-SPECIFIC-COMMAREA                     06060002
060700             MOVE EIBTRMID    TO ASC-LIST-TERM-ID                 06070002
060800                                 ASC-SEL-TERM-ID                  06080002
060810                                 ASC-SEL-TERM-ID-2                06081026
060900             MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   06090002
061000                                           ASC-SEL-TASK-NUMBER    06100002
061010                                           ASC-SEL-TASK-NUMBER-2  06101026
061100             MOVE PC-LIST-QUEUE-SEQ TO ASC-LIST-SEQ               06110002
061200             MOVE PC-SEL-QUEUE-SEQ  TO ASC-SEL-SEQ                06120002
061210                                       ASC-SEL-SEQ-2              06121026
061300             PERFORM 1100-PROCESS-INTER-APPL-COMM                 06130002
061400             PERFORM 4000-BUILD-INITIAL-PANEL                     06140002
061500                                                                  06150002
061600         WHEN DP020-NEXT-ACT-READ-MAP                             06160002
061700             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06170002
061800             PERFORM 2000-PROCESS-PANEL                           06180002
061900                                                                  06190002
062000         WHEN DP020-NEXT-ACT-RETURN                               06200002
062100             MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         06210002
062200             MOVE ZERO  TO ASC-ITEM-AT-TOP-OF-PANEL               06220002
062210             EVALUATE TRUE                                        06221021
062220                 WHEN CN014-ADD-CODE                              06222021
062400                      EVALUATE TRUE                               06240021
062500                          WHEN ASC-CODE-PARM-ALL-CSR              06250021
062600                               MOVE SPACES        TO DK-CODE-PARM 06260021
062800                          WHEN ASC-CODE-PARM-NAME-CSR             06280021
062900                               MOVE CN014-PARM-NAME               06290021
063000                                                  TO DK-CODE-PARM 06300021
063100                      END-EVALUATE                                06310021
063200                      PERFORM 2050-DELETE-LIST-QUEUE              06320021
063210                      PERFORM 3200-RESET-ATTRIBUTES               06321025
063300                      PERFORM 4000-BUILD-INITIAL-PANEL            06330021
063401                                                                  06340121
063410                 WHEN CN018-ADD-TKRPRPM                           06341021
063420                 WHEN CN018-ADD-TKRPRCD                           06342024
063490                      PERFORM 2050-DELETE-LIST-QUEUE              06349021
063491                      PERFORM 3200-RESET-ATTRIBUTES               06349125
063492                      PERFORM 4000-BUILD-INITIAL-PANEL            06349221
063494                                                                  06349421
063500                 WHEN OTHER                                       06350021
063600                      PERFORM 6000-REFRESH-PANEL-FROM-TEMP        06360021
063700                      PERFORM 4400-MOVE-COMMAREA-TO-SCREEN        06370021
063800             END-EVALUATE                                         06380023
063900                                                                  06390002
064000         WHEN OTHER                                               06400002
064100             SET DP013-LOGIC-ABEND TO TRUE                        06410002
064200             SET DP013-NO-ROLLBACK TO TRUE                        06420002
064300             MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH    06430002
064400             MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    06440002
064500                                   TO DP013-MESSAGE-TEXT(1)       06450002
064600             PERFORM DP013-0000-PROCESS-ABEND                     06460002
064700     END-EVALUATE.                                                06470002
064800                                                                  06480002
064900*----------------------------------------------------------------*06490002
065000* DETERMINE IF DATA WAS PASSED THROUGH INTER-APPL COMMAREA OR    *06500002
065100* IF THERE IS DATA TO BE USED IN THE NAV-KEY FIELD.              *06510002
065200*----------------------------------------------------------------*06520002
065300 1100-PROCESS-INTER-APPL-COMM.                                    06530002
065400                                                                  06540002
065500     SET PS-COMMAREA-VALID         TO TRUE.                       06550002
065600     MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     06560002
065700                                                                  06570002
065800     IF  DP020-INT-APPL-FORMAT-IND = PC-CRIT-SPEC-FORMAT          06580002
066500         MOVE CN014-FUNCTION           TO ASC-FUNCTION            06650002
066600         MOVE CN014-OPER-UNT-ID        TO ASC-OPER-UNT-ID         06660004
066700         MOVE CN014-OPER-UNT-NAME      TO ASC-OPER-UNT-NAME       06670004
066800         MOVE CN014-PARM-NAME          TO ASC-PARM-NAME           06680004
066900         MOVE CN014-PARM-DESC          TO ASC-PARM-DESC           06690004
066910         MOVE CN014-PARM-TYPE          TO ASC-PARM-TYPE           06691004
067000     ELSE                                                         06700002
067610         MOVE CN014-FUNCTION           TO ASC-FUNCTION            06761004
067620         MOVE CN014-OPER-UNT-ID        TO ASC-OPER-UNT-ID         06762004
067630         MOVE CN014-OPER-UNT-NAME      TO ASC-OPER-UNT-NAME       06763004
067640         MOVE CN014-PARM-NAME          TO ASC-PARM-NAME           06764004
067650         MOVE CN014-PARM-DESC          TO ASC-PARM-DESC           06765004
067660         MOVE CN014-PARM-TYPE          TO ASC-PARM-TYPE           06766004
068000     END-IF.                                                      06800002
068100                                                                  06810002
068200*----------------------------------------------------------------*06820002
068300* DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *06830002
068400* ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *06840002
068500* USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *06850002
068600* OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *06860002
068700* FUNCTION KEYS CAN GET THIS FAR.                                *06870002
068800*----------------------------------------------------------------*06880002
068900 2000-PROCESS-PANEL.                                              06890002
069000     EVALUATE TRUE                                                06900002
069100         WHEN DP020-SRC-AID = DP016-CLEAR                         06910002
069200             MOVE ZERO TO ASC-ITEM-AT-TOP-OF-PANEL                06920002
069300             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   06930002
069400             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 06940002
069500                                                                  06950002
069600         WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    06960002
069700             PERFORM 2050-DELETE-LIST-QUEUE                       06970002
069800             SET CN014-FUNCTION-NONE  TO TRUE                     06980002
069900             EVALUATE TRUE                                        06990002
070000                WHEN ASC-CODE-PARM-ALL-CSR                        07000005
070100                     MOVE SPACES              TO  DK-CODE-PARM    07010005
070300                WHEN ASC-CODE-PARM-NAME-CSR                       07030005
070400                     MOVE ASC-PARM-NAME       TO  DK-CODE-PARM    07040007
070600             END-EVALUATE                                         07060002
070700             PERFORM 4000-BUILD-INITIAL-PANEL                     07070002
070800                                                                  07080002
070900         WHEN DP020-FK-DESELECT (DP020-SRC-AID)                   07090002
071000             PERFORM 2140-DESELECT-ALL-ITEMS                      07100002
071100             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07110002
071200                                                                  07120002
071300         WHEN DP020-FK-SELECT-ALL(DP020-SRC-AID)                  07130002
071400             PERFORM 2150-SELECT-ALL-ITEMS                        07140002
071500             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07150002
071600         WHEN OTHER                                               07160002
071700             PERFORM 2200-MOVE-SCREEN-TO-COMMAREA                 07170002
071800             PERFORM 3000-EDIT-DATA-IN-COMMAREA                   07180002
071900             IF  PS-NO-ERROR                                      07190002
072000                 SET DP030-CONTINUE-GO TO TRUE                    07200002
072100                 PERFORM 2100-CHECK-FUNCTION-KEY                  07210002
072200             ELSE                                                 07220002
072300                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07230002
072400                 SET DP030-OVERRIDE-GO TO TRUE                    07240002
072500             END-IF                                               07250002
072600     END-EVALUATE.                                                07260002
072700                                                                  07270002
072800*----------------------------------------------------------------*07280002
072900*  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *07290002
073000*----------------------------------------------------------------*07300002
073100 2050-DELETE-LIST-QUEUE.                                          07310002
073200                                                                  07320002
073300     EXEC CICS                                                    07330002
073400         DELETEQ TS                                               07340002
073500             QUEUE (ASC-LIST-QUEUE-NAME)                          07350002
073600             RESP  (PV-CICS-RESP)                                 07360002
073700     END-EXEC.                                                    07370002
073800                                                                  07380002
073900     IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       07390002
074000        (PV-CICS-RESP = DFHRESP(QIDERR))                          07400002
074100         CONTINUE                                                 07410002
074200     ELSE                                                         07420002
074300         SET DP013-CICS-ABEND      TO TRUE                        07430002
074400         SET DP013-NO-ROLLBACK     TO TRUE                        07440002
074500                                                                  07450002
074600         MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH         07460002
074700         MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    07470002
074800                                   TO DP013-MESSAGE-TEXT (1)      07480002
074900         PERFORM DP013-0000-PROCESS-ABEND                         07490002
075000     END-IF.                                                      07500002
075100                                                                  07510002
075200     MOVE +0  TO ASC-HIGHEST-BLOCK-WRITTEN.                       07520002
075300                                                                  07530002
075400*----------------------------------------------------------------*07540002
075500* ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*07550002
075600* NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *07560002
075700* CICS ARCHITECTURE API.                                         *07570002
075800*----------------------------------------------------------------*07580002
075900 2100-CHECK-FUNCTION-KEY.                                         07590002
076000                                                                  07600002
076100     EVALUATE TRUE                                                07610002
076200                                                                  07620002
076300* F13 - ADD CODE (TKRPRCD)  (LOCAL-FUNC-01)                       07630014
076400         WHEN DP020-FK-LOCAL-FUNC-01 (DP020-SRC-AID)              07640002
076401                 SET  ASC-ADD-CODE   TO  TRUE                     07640116
076410                 PERFORM 2110-PREPARE-INTER-APPL-COMM             07641016
076420                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             07642016
078100                                                                  07810002
078110* F15 - UPD PARM (TKRPRPM)  (LOCAL-FUNC-02)                       07811014
078120         WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              07812014
078130                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              07813014
078140                     SET ASC-USE-SELECTION-QUEUE TO TRUE          07814014
078150                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            07815014
078160                                TO CN018-NUMBER-OF-SELECTED-ITEMS 07816014
078170                     MOVE ASC-NUMBER-OF-TS-ITEMS                  07817014
078180                                      TO CN018-NUMBER-OF-TS-ITEMS 07818014
078190                     MOVE ASC-SEL-QUEUE-NAME                      07819014
078191                                         TO  CN018-SEL-QUEUE-NAME 07819114
078192                     SET CN018-UPD-TKRPRPM TO TRUE                07819214
078193                     MOVE ASC-OPER-UNT-ID   TO CN018-OPER-UNT-ID  07819319
078194                     MOVE ASC-OPER-UNT-NAME TO CN018-OPER-UNT-NAME07819419
078197                     PERFORM 5000-PREPARE-SEL-QUEUE               07819714
078198                 ELSE                                             07819814
078199                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07819914
078200                     SET DP030-OVERRIDE-GO TO TRUE                07820014
078201                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    07820114
078202                     SET DP020-MSG-FATAL   TO TRUE                07820214
078203                 END-IF                                           07820314
078204                                                                  07820414
078205* F17 - ADD PARM (TKRPRPM)  (LOCAL-FUNC-03)                       07820520
078206         WHEN DP020-FK-LOCAL-FUNC-03 (DP020-SRC-AID)              07820620
078207                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              07820714
078208                     SET ASC-USE-SELECTION-QUEUE TO TRUE          07820814
078209                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            07820914
078210                                TO CN018-NUMBER-OF-SELECTED-ITEMS 07821014
078211                     MOVE ASC-NUMBER-OF-TS-ITEMS                  07821114
078212                                      TO CN018-NUMBER-OF-TS-ITEMS 07821214
078213                     MOVE ASC-SEL-QUEUE-NAME                      07821314
078214                                         TO  CN018-SEL-QUEUE-NAME 07821414
078215                     SET CN018-ADD-TKRPRCD TO TRUE                07821514
078216                     MOVE ASC-OPER-UNT-ID   TO CN018-OPER-UNT-ID  07821619
078217                     MOVE ASC-OPER-UNT-NAME TO CN018-OPER-UNT-NAME07821719
078218                     PERFORM 5000-PREPARE-SEL-QUEUE               07821814
078219                 ELSE                                             07821914
078220                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07822014
078221                     SET DP030-OVERRIDE-GO TO TRUE                07822114
078222                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    07822214
078223                     SET DP020-MSG-FATAL   TO TRUE                07822314
078224                 END-IF                                           07822414
078225                                                                  07822514
078226* F24 - UPD PARM (TKRPRPM)  (LOCAL-FUNC-04)                       07822620
078227         WHEN DP020-FK-LOCAL-FUNC-04 (DP020-SRC-AID)              07822720
078228                 IF ASC-NUMBER-OF-SELECTED-ITEMS > 0              07822814
078229                     SET ASC-USE-SELECTION-QUEUE TO TRUE          07822914
078230                     MOVE ASC-NUMBER-OF-SELECTED-ITEMS            07823014
078231                                TO CN018-NUMBER-OF-SELECTED-ITEMS 07823114
078232                     MOVE ASC-NUMBER-OF-TS-ITEMS                  07823214
078233                                      TO CN018-NUMBER-OF-TS-ITEMS 07823314
078234                     MOVE ASC-SEL-QUEUE-NAME                      07823414
078235                                         TO  CN018-SEL-QUEUE-NAME 07823514
078236                     SET CN018-UPD-TKRPRPM TO TRUE                07823614
078237                     MOVE ASC-OPER-UNT-ID   TO CN018-OPER-UNT-ID  07823719
078238                     MOVE ASC-OPER-UNT-NAME TO CN018-OPER-UNT-NAME07823819
078239                     PERFORM 5000-PREPARE-SEL-QUEUE               07823914
078240                 ELSE                                             07824014
078241                     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN         07824114
078242                     SET DP030-OVERRIDE-GO TO TRUE                07824214
078243                     MOVE PC-TSYMSG-00057  TO DP020-MSG-NUMBER    07824314
078244                     SET DP020-MSG-FATAL   TO TRUE                07824414
078245                 END-IF                                           07824514
078246                                                                  07824614
078250                                                                  07825002
078300* F6 - FIRST PAGE                                                 07830002
078400         WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  07840002
078500             PERFORM 3200-RESET-ATTRIBUTES                        07850002
078600             MOVE +1               TO PV-TOP-ITEM                 07860002
078700             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07870002
078800                                                                  07880002
078900* F7 - PREVIOUS PAGE                                              07890002
079000         WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   07900002
079100             PERFORM 3200-RESET-ATTRIBUTES                        07910002
079200             PERFORM 2110-BROWSE-BACKWARD                         07920002
079300             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07930002
079400                                                                  07940002
079500* F8 - NEXT PAGE                                                  07950002
079600         WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   07960002
079700             PERFORM 3200-RESET-ATTRIBUTES                        07970002
079800             PERFORM 2120-BROWSE-FORWARD                          07980002
079900             PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 07990002
080000                                                                  08000002
080100* ENTER KEY                                                       08010002
080200         WHEN DP020-SRC-AID = DP016-ENTER                         08020002
080300             PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   08030002
080400             IF  PS-ERROR                                         08040002
080500                 CONTINUE                                         08050002
080600             ELSE                                                 08060002
080700                 PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             08070002
080800             END-IF                                               08080002
080900                                                                  08090002
081000         WHEN OTHER                                               08100002
081100             SET DP013-NO-ROLLBACK                                08110002
081200                 DP013-XCTL-DISPLAY-RESTART                       08120002
081300                 DP013-CICS-ABEND  TO TRUE                        08130002
081400             MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH    08140002
081500             MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      08150002
081600                                   TO DP013-MESSAGE-TEXT (1)      08160002
081700             PERFORM DP013-0000-PROCESS-ABEND                     08170002
081800     END-EVALUATE.                                                08180002
081900                                                                  08190002
082000******************************************************************08200002
082100** MOVE DATA NECESSARY TO THE DESTINATION PROGRAM(S) INTO THE   **08210002
082200** INTER-APPLICATION COMMAREA.                                  **08220002
082300******************************************************************08230002
082400 2110-PREPARE-INTER-APPL-COMM.                                    08240002
082500                                                                  08250002
082600     INITIALIZE CN014-INTER-APPL-COMMAREA.                        08260002
082700                                                                  08270002
082800     MOVE ASC-FUNCTION             TO CN014-FUNCTION.             08280002
082900                                                                  08290002
083000*----------------------------------------------------------------*08300002
083100*    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *08310002
083200*    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *08320002
083300*    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *08330002
083400*    MESSAGE.                                                    *08340002
083500*----------------------------------------------------------------*08350002
083600 2110-BROWSE-BACKWARD.                                            08360002
083700     SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    08370002
083800         GIVING PV-TOP-ITEM.                                      08380002
083900                                                                  08390002
084000     IF  ((PV-TOP-ITEM < +1)                                      08400002
084100       OR (PV-TOP-ITEM = +1))                                     08410002
084200         MOVE +1                   TO PV-TOP-ITEM                 08420002
084300*        -- TOP OF LIST --                                        08430002
084400         MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            08440002
084500         SET DP020-MSG-INFORMATIONAL TO TRUE                      08450002
084600     END-IF.                                                      08460002
084700                                                                  08470002
084800*----------------------------------------------------------------*08480002
084900*    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *08490002
085000*    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *08500002
085100*    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *08510002
085200*----------------------------------------------------------------*08520002
085300 2120-BROWSE-FORWARD.                                             08530002
085400     ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              08540002
085500         GIVING PV-TOP-ITEM.                                      08550002
085600     IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ                   08560002
085700         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             08570002
085800*        -- BOTTOM OF LIST --                                     08580002
085900         MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            08590002
086000         SET DP020-MSG-INFORMATIONAL TO TRUE                      08600002
086100     ELSE                                                         08610002
086200         COMPUTE PV-BOTTOM-ITEM =                                 08620002
086300             PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1                 08630002
086400         IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ            08640002
086500*            -- BOTTOM OF LIST --                                 08650002
086600             MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER            08660002
086700             SET DP020-MSG-INFORMATIONAL TO TRUE                  08670002
086800         END-IF                                                   08680002
086900     END-IF.                                                      08690002
087000                                                                  08700002
087100*----------------------------------------------------------------*08710002
087200*    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *08720002
087300*    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *08730002
087400*    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *08740002
087500*    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *08750002
087600*    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *08760002
087700*    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *08770002
087800*----------------------------------------------------------------*08780002
087900 2130-CHECK-FOR-JUMP-BROWSE.                                      08790002
088000     SET PS-NO-ERROR               TO TRUE.                       08800002
088100     IF (ASC-START-ITEM-REQUEST = SPACE)                          08810002
088200         MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM             08820002
088300     ELSE                                                         08830002
088400         MOVE ASC-START-ITEM-REQUEST TO DP010I-UNEDITED-FIELD     08840002
088500         MOVE PC-MSG-NUMBER-LENGTH TO DP010I-MAXIMUM-DIGITS       08850002
088600         MOVE +0                   TO DP010I-MAXIMUM-DECIMALS     08860002
088700         SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  08870002
263455         CALL DP010I-NUMERIC-EDIT-ROUTINE                         08881027
263455              USING DP010I-NUMERIC-EDIT-AREA                      08882027
088900                                                                  08890002
089000         IF  NOT DP010I-ERROR-DETECTED                            08900002
089100             MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N08910002
089200             IF  ASC-START-ITEM-REQUEST-N > ZERO                  08920002
089300                 IF  ASC-START-ITEM-REQUEST-N >                   08930002
089400                                          ASC-NUMBER-OF-ITEMS-READ08940002
089500                     MOVE SPACE TO ASC-START-ITEM-REQUEST         08950002
089600                     COMPUTE PV-TOP-ITEM =                        08960002
089700                             ASC-NUMBER-OF-ITEMS-READ             08970002
089800                             - PC-ITEMS-PER-PANEL + 1             08980002
089900                     IF  PV-TOP-ITEM < +1                         08990002
090000                         MOVE +1   TO PV-TOP-ITEM                 09000002
090100                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 09010002
090200                         SET DP020-MSG-INFORMATIONAL TO TRUE      09020002
090300                     END-IF                                       09030002
090400                 ELSE                                             09040002
090500                     MOVE ASC-START-ITEM-REQUEST-N                09050002
090600                                   TO PV-TOP-ITEM                 09060002
090700                     MOVE SPACE    TO ASC-START-ITEM-REQUEST      09070002
090800                     COMPUTE PV-BOTTOM-ITEM =                     09080002
090900                         PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     09090002
091000                     IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ09100002
091100*                        -- BOTTOM OF LIST --                     09110002
091200                         MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 09120002
091300                         SET DP020-MSG-INFORMATIONAL TO TRUE      09130002
091400                     END-IF                                       09140002
091500                 END-IF                                           09150002
091600             ELSE                                                 09160002
091700*                --- VALUE OUT OF RANGE ----                      09170002
091800                 MOVE PC-TSYMSG-00101 TO DP020-MSG-NUMBER         09180002
091900                 MOVE -1              TO ASTRTITL                 09190002
092000                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              09200002
092100                 MOVE DP015-REVERSE   TO ASTRTITH                 09210002
092200                 MOVE DP015-RED       TO ASTRTITC                 09220002
092300                 MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA           09230002
092400                 SET DP020-MSG-FATAL  TO TRUE                     09240002
092500                 SET PS-ERROR         TO TRUE                     09250002
092600             END-IF                                               09260002
092700         ELSE                                                     09270002
092800             MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            09280002
092900             MOVE -1               TO ASTRTITL                    09290002
093000             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  09300002
093100             MOVE DP015-REVERSE    TO ASTRTITH                    09310002
093200             MOVE DP015-RED        TO ASTRTITC                    09320002
093300             MOVE DP015-UNP-NUM-BRT-MDT TO ASTRTITA               09330002
093400             SET DP020-MSG-FATAL   TO TRUE                        09340002
093500             SET PS-ERROR          TO TRUE                        09350002
093600         END-IF                                                   09360002
093700     END-IF.                                                      09370002
093800                                                                  09380002
093900*----------------------------------------------------------------*09390002
094000*    IF THE USER HITS THE DESELECT KEY, CLEAR THE SELECTION      *09400002
094100*    SWITCH FOR ALL ITEMS THAT WERE PREVIOUSLY SELECTED.         *09410002
094200*----------------------------------------------------------------*09420002
094300 2140-DESELECT-ALL-ITEMS.                                         09430002
094400     MOVE +1                       TO ASC-BLK-SUB.                09440002
094500                                                                  09450002
094600     PERFORM 2141-CLEAR-SELECTED-INDS                             09460002
094700         VARYING ASC-ITEM-SUB                                     09470002
094800         FROM 1 BY 1                                              09480002
094900         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09490002
095000                                                                  09500002
095100     ADD +1                        TO ASC-BLK-SUB.                09510002
095200                                                                  09520002
095300     PERFORM 2141-CLEAR-SELECTED-INDS                             09530002
095400         VARYING ASC-ITEM-SUB                                     09540002
095500         FROM 1 BY 1                                              09550002
095600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 09560002
095700                                                                  09570002
095800     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               09580002
095900                                   TO PV-LIST-ITEM-NUMBER.        09590002
096000                                                                  09600002
096100     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            09610002
096200         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    09620002
096300                                                                  09630002
096400     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            09640002
096500         MOVE +1                   TO ASC-BLK-SUB                 09650002
096600                                                                  09660002
096700         PERFORM 5100-WRITE-TEMP-STORAGE                          09670002
096800         MOVE +2                   TO ASC-BLK-SUB                 09680002
096900         PERFORM 5100-WRITE-TEMP-STORAGE                          09690002
097000         MOVE +1                   TO ASC-BLK-SUB                 09700002
097100         MOVE +1                   TO PV-BLOCK-NUMBER             09710002
097200     END-IF.                                                      09720002
097300                                                                  09730002
097400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     09740002
097500        (ASC-HIGHEST-BLOCK-WRITTEN > PC-MAX-BLOCKS-IN-ARRAY)      09750002
097600         MOVE +1                   TO ASC-BLK-SUB                 09760002
097700                                                                  09770002
097800         PERFORM 5100-WRITE-TEMP-STORAGE                          09780002
097900         MOVE +2  TO ASC-BLK-SUB                                  09790002
098000         PERFORM 5100-WRITE-TEMP-STORAGE                          09800002
098100         MOVE +1  TO ASC-BLK-SUB                                  09810002
098200         MOVE +1  TO PV-BLOCK-NUMBER                              09820002
098300                                                                  09830002
098400         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         09840002
098500             PV-FIRST-BLOCK-IN-ARRAY - 1                          09850002
098600                                                                  09860002
098700         PERFORM                                                  09870002
098800             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       09880002
098900                                                                  09890002
099000             PERFORM 4410-READ-TEMP-STORAGE                       09900002
099100                                                                  09910002
099200             PERFORM 2141-CLEAR-SELECTED-INDS                     09920002
099300                 VARYING ASC-ITEM-SUB FROM 1 BY 1                 09930002
099400                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          09940002
099500                                                                  09950002
099600             PERFORM 5100-WRITE-TEMP-STORAGE                      09960002
099700                                                                  09970002
099800             ADD +1                TO PV-BLOCK-NUMBER             09980002
099900                                                                  09990002
100000         END-PERFORM                                              10000002
100100                                                                  10010002
100200         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         10020002
100300             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     10030002
100400                                                                  10040002
100500         PERFORM                                                  10050002
100600             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       10060002
100700                   ASC-HIGHEST-BLOCK-WRITTEN                      10070002
100800                                                                  10080002
100900             MOVE PV-NEXT-BLOCK-IN-ARRAY                          10090002
101000                                   TO PV-BLOCK-NUMBER             10100002
101100                                                                  10110002
101200             PERFORM 4410-READ-TEMP-STORAGE                       10120002
101300                                                                  10130002
101400             PERFORM 2141-CLEAR-SELECTED-INDS                     10140002
101500                 VARYING ASC-ITEM-SUB                             10150002
101600                 FROM 1 BY 1                                      10160002
101700                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          10170002
101800                                                                  10180002
101900             PERFORM 5100-WRITE-TEMP-STORAGE                      10190002
102000                                                                  10200002
102100             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      10210002
102200                                                                  10220002
102300         END-PERFORM                                              10230002
102400                                                                  10240002
102500         MOVE PV-FIRST-BLOCK-IN-ARRAY                             10250002
102600                                   TO PV-BLOCK-NUMBER             10260002
102700                                                                  10270002
102800         PERFORM 4410-READ-TEMP-STORAGE                           10280002
102900     END-IF.                                                      10290002
103000                                                                  10300002
103100                                                                  10310002
103200     MOVE +0                     TO ASC-NUMBER-OF-SELECTED-ITEMS. 10320002
103300     MOVE +0                     TO ASC-START-OF-SELECTED-RANGE.  10330002
103400     MOVE +0                     TO ASC-END-OF-SELECTED-RANGE.    10340002
103500                                                                  10350002
103600     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        10360002
103700                                                                  10370002
103800*----------------------------------------------------------------*10380002
103900*    MARK EACH ITEM AS BEING NOT SELECTED.                       *10390002
104000*----------------------------------------------------------------*10400002
104100 2141-CLEAR-SELECTED-INDS.                                        10410002
104200     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           10420002
104300             NOT EQUAL ZERO                                       10430002
104400         IF  NOT ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10440002
104500             SET ASC-NO-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          10450002
104600                 ASC-TEMP-NO-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)    10460002
104700                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB) TO TRUE          10470002
104800         END-IF                                                   10480002
104900     END-IF.                                                      10490002
105000                                                                  10500002
105100*----------------------------------------------------------------*10510002
105200*  IF THE USER HITS THE SELECT-ALL KEY, SET THE SELECTION SWITCH *10520002
105300*  FOR ALL ITEMS.                                                *10530002
105400*----------------------------------------------------------------*10540002
105500 2150-SELECT-ALL-ITEMS.                                           10550002
105600     MOVE +1                       TO ASC-BLK-SUB.                10560002
105700                                                                  10570002
105800     PERFORM 2151-SET-SELECTED-INDS                               10580002
105900         VARYING ASC-ITEM-SUB                                     10590002
106000         FROM 1 BY 1                                              10600002
106100         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10610002
106200                                                                  10620002
106300     ADD +1                        TO ASC-BLK-SUB.                10630002
106400                                                                  10640002
106500     PERFORM 2151-SET-SELECTED-INDS                               10650002
106600         VARYING ASC-ITEM-SUB                                     10660002
106700         FROM 1 BY 1                                              10670002
106800         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 10680002
106900                                                                  10690002
107000     MOVE ASC-LIST-ITEM-NUMBER(1 1)  TO PV-LIST-ITEM-NUMBER.      10700002
107100                                                                  10710002
107200     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            10720002
107300         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    10730002
107400                                                                  10740002
107500     IF  PV-FIRST-BLOCK-IN-ARRAY  = +1                            10750002
107600         MOVE +1                   TO ASC-BLK-SUB                 10760002
107700                                                                  10770002
107800         PERFORM 5100-WRITE-TEMP-STORAGE                          10780002
107900         MOVE +2                   TO ASC-BLK-SUB                 10790002
108000         PERFORM 5100-WRITE-TEMP-STORAGE                          10800002
108100         MOVE +1                   TO ASC-BLK-SUB                 10810002
108200         MOVE +1                   TO PV-BLOCK-NUMBER             10820002
108300     END-IF.                                                      10830002
108400     IF (PV-FIRST-BLOCK-IN-ARRAY NOT = +1) OR                     10840002
108500        (ASC-HIGHEST-BLOCK-WRITTEN >   PC-MAX-BLOCKS-IN-ARRAY)    10850002
108600         MOVE +1                   TO ASC-BLK-SUB                 10860002
108700                                                                  10870002
108800         PERFORM 5100-WRITE-TEMP-STORAGE                          10880002
108900                                                                  10890002
109000         MOVE +1                   TO PV-BLOCK-NUMBER             10900002
109100                                                                  10910002
109200         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         10920002
109300             PV-FIRST-BLOCK-IN-ARRAY - 1                          10930002
109400                                                                  10940002
109500         PERFORM                                                  10950002
109600             UNTIL PV-BLOCK-NUMBER > PV-PREV-BLOCK-IN-ARRAY       10960002
109700                                                                  10970002
109800             PERFORM 4410-READ-TEMP-STORAGE                       10980002
109900                                                                  10990002
110000             PERFORM 2151-SET-SELECTED-INDS                       11000002
110100                 VARYING ASC-ITEM-SUB                             11010002
110200                 FROM 1 BY 1                                      11020002
110300                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11030002
110400                                                                  11040002
110500             PERFORM 5100-WRITE-TEMP-STORAGE                      11050002
110600                                                                  11060002
110700             ADD +1                TO PV-BLOCK-NUMBER             11070002
110800                                                                  11080002
110900         END-PERFORM                                              11090002
111000                                                                  11100002
111100         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         11110002
111200             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     11120002
111300                                                                  11130002
111400         PERFORM                                                  11140002
111500             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       11150002
111600                   ASC-HIGHEST-BLOCK-WRITTEN                      11160002
111700                                                                  11170002
111800             MOVE PV-NEXT-BLOCK-IN-ARRAY                          11180002
111900                                   TO PV-BLOCK-NUMBER             11190002
112000                                                                  11200002
112100             PERFORM 4410-READ-TEMP-STORAGE                       11210002
112200                                                                  11220002
112300             PERFORM 2151-SET-SELECTED-INDS                       11230002
112400                 VARYING ASC-ITEM-SUB                             11240002
112500                 FROM 1 BY 1                                      11250002
112600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          11260002
112700                                                                  11270002
112800             PERFORM 5100-WRITE-TEMP-STORAGE                      11280002
112900                                                                  11290002
113000             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      11300002
113100                                                                  11310002
113200         END-PERFORM                                              11320002
113300                                                                  11330002
113400         MOVE PV-FIRST-BLOCK-IN-ARRAY  TO PV-BLOCK-NUMBER         11340002
113500                                                                  11350002
113600         PERFORM 4410-READ-TEMP-STORAGE                           11360002
113700     END-IF.                                                      11370002
113800                                                                  11380002
113900     MOVE ASC-NUMBER-OF-ITEMS-READ TO                             11390002
114000                       ASC-NUMBER-OF-SELECTED-ITEMS.              11400002
114100                                                                  11410002
114200     PERFORM 4400-MOVE-COMMAREA-TO-SCREEN.                        11420002
114300                                                                  11430002
114400*----------------------------------------------------------------*11440002
114500*    MARK EACH ITEM AS BEING SELECTED.                           *11450002
114600*----------------------------------------------------------------*11460002
114700 2151-SET-SELECTED-INDS.                                          11470002
114800     IF  ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB ASC-ITEM-SUB)           11480002
114900             NOT EQUAL ZERO                                       11490002
115000         IF  NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11500002
115100             SET ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)             11510002
115200                 ASC-TEMP-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)        11520002
115300                 ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                  11530002
115400                               TO  TRUE                           11540002
115500         END-IF                                                   11550002
115600     END-IF.                                                      11560002
115700                                                                  11570002
115800******************************************************************11580002
115900** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **11590002
116000** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **11600002
116100******************************************************************11610002
116200 2200-MOVE-SCREEN-TO-COMMAREA.                                    11620002
116300                                                                  11630002
116400     MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             11640002
116500     MOVE +1                       TO PV-SUB.                     11650002
116600                                                                  11660002
116700     PERFORM 3100-SET-SUBSCRIPTS.                                 11670002
116800                                                                  11680002
116900     IF  ASTRTITL > ZERO                                          11690002
117000         MOVE ASTRTITI         TO ASC-START-ITEM-REQUEST          11700002
117100     ELSE                                                         11710002
117200         IF  ASTRTITF = DP015-ERASE-EOF                           11720002
117300             INITIALIZE ASC-START-ITEM-REQUEST                    11730002
117400         END-IF                                                   11740002
117500     END-IF.                                                      11750002
117600                                                                  11760002
117700     PERFORM 2210-MOVE-LINES-TO-COMMAREA                          11770002
117800         VARYING PV-SUB FROM 1 BY 1                               11780002
117900         UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                      11790002
118000                                                                  11800002
118100******************************************************************11810002
118200** MOVE THE ENTERABLE FIELDS OF EACH LIST LINE INTO THE COMMAREA**11820002
118300******************************************************************11830002
118400 2210-MOVE-LINES-TO-COMMAREA.                                     11840002
118500     IF  MR-SELECTL (PV-SUB) > ZERO                               11850002
118600         SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             11860002
118700         MOVE MR-SELECTI (PV-SUB)  TO ASC-TEMP-SELECTED-SW        11870002
118800                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 11880002
118900     ELSE                                                         11890002
119000         IF  MR-SELECTA (PV-SUB) = DP015-ERASE-EOF                11900002
119100                 SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     11910002
119200                 MOVE SPACE  TO ASC-TEMP-SELECTED-SW              11920002
119300                                      (ASC-BLK-SUB, ASC-ITEM-SUB) 11930002
119400         END-IF                                                   11940002
119500     END-IF.                                                      11950002
119600                                                                  11960002
119700     ADD +1                        TO ASC-ITEM-SUB.               11970002
119800     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        11980002
119900         ADD +1                    TO ASC-BLK-SUB                 11990002
120000         MOVE +1                   TO ASC-ITEM-SUB                12000002
120100     END-IF.                                                      12010002
120200                                                                  12020002
120300******************************************************************12030002
120400** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **12040002
120500** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **12050002
120600******************************************************************12060002
120700 3000-EDIT-DATA-IN-COMMAREA.                                      12070002
120800     PERFORM 3200-RESET-ATTRIBUTES.                               12080002
120900     SET PS-NO-ERROR               TO TRUE.                       12090002
121000     MOVE ASC-ITEMS-DISPLAYED      TO PV-SUB.                     12100002
121100                                                                  12110002
121200* CALCULATE THE POSITION OF THE LAST ITEM DISPLAYED.              12120002
121300* EDITTING IS DONE FROM THE BOTTOM UP.                            12130002
121400                                                                  12140002
121500     COMPUTE PV-ITEM-IN-USE = PV-TOP-ITEM +                       12150002
121600         ASC-ITEMS-DISPLAYED - 1.                                 12160002
121700     PERFORM 3100-SET-SUBSCRIPTS.                                 12170002
121800                                                                  12180002
121900      IF  PS-NO-ERROR                                             12190002
122000          PERFORM 3005-EDIT-COMMAREA-BLOCKS                       12200002
122100      END-IF.                                                     12210002
122200                                                                  12220002
122300     IF  PS-NO-ERROR                                              12230002
122400         PERFORM 3400-CHECK-RANGE-SEQUENCE                        12240002
122500     END-IF.                                                      12250002
122600                                                                  12260002
122700     IF  ((PS-NO-ERROR)                                           12270002
122800       AND (ASC-START-OF-SELECTED-RANGE > ZERO)                   12280002
122900       AND (ASC-END-OF-SELECTED-RANGE > ZERO))                    12290002
123000             PERFORM 3500-MARK-RANGE-AS-SELECTED                  12300002
123100     END-IF.                                                      12310002
123200                                                                  12320002
123300*----------------------------------------------------------------*12330002
123400* 3005-EDIT-COMMAREA-BLOCKS                                      *12340002
123500*----------------------------------------------------------------*12350002
123600 3005-EDIT-COMMAREA-BLOCKS.                                       12360002
123700     MOVE +1                       TO PV-BLOCK-NUMBER.            12370002
123800     MOVE +1                       TO ASC-BLK-SUB.                12380002
123900     MOVE PC-ITEMS-PER-PANEL       TO ASC-ITEM-SUB.               12390002
124000                                                                  12400002
124100     COMPUTE PV-BLOCK-NUMBER  =                                   12410002
124200             1 + ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) /            12420002
124300             PC-ITEMS-PER-PANEL.                                  12430002
124400                                                                  12440002
124500     MOVE  PV-BLOCK-NUMBER         TO PV-ORIGINAL-BLOCK.          12450002
124600                                                                  12460002
124700     PERFORM                                                      12470002
124800        UNTIL PV-BLOCK-NUMBER > ASC-HIGHEST-BLOCK-WRITTEN         12480002
124900           OR PS-ERROR                                            12490002
125000           OR PS-BLOCK-ERROR                                      12500002
125100                                                                  12510002
125200              COMPUTE PV-ITEMS-HOLD  =                            12520002
125300                      ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +       12530002
125400                      PC-ITEMS-PER-PANEL - 1                      12540002
125500                                                                  12550002
125600               IF  PV-ITEMS-HOLD  >  ASC-NUMBER-OF-ITEMS-READ     12560002
125700                   SUBTRACT  ASC-NUMBER-OF-ITEMS-READ             12570002
125800                       FROM  PV-ITEMS-HOLD                        12580002
125900                     GIVING  PV-ITEMS-DIFF                        12590002
126000                   SUBTRACT  PV-ITEMS-DIFF                        12600002
126100                       FROM  PC-ITEMS-PER-PANEL                   12610002
126200                     GIVING  PV-ITEMS-HOLD                        12620002
126300                       MOVE  PV-ITEMS-HOLD TO PV-SUB              12630002
126400                                              ASC-ITEM-SUB        12640002
126500                                              ASC-ITEMS-DISPLAYED 12650002
126600               ELSE                                               12660002
126700                   MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB            12670002
126800                   MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB      12680002
126900               END-IF                                             12690002
127000                                                                  12700002
127100               PERFORM 3300-EDIT-SELECTIONS                       12710002
127200                       VARYING PV-SUB                             12720002
127300                          FROM PV-SUB BY -1                       12730002
127400                          UNTIL PV-SUB < +1                       12740002
127500                                                                  12750002
127600               MOVE +1               TO ASC-BLK-SUB               12760002
127700                                                                  12770002
127800               PERFORM 5105-REWRITE-ASC-LISTQ                     12780002
127900                                                                  12790002
128000               MOVE +1                TO ASC-BLK-SUB              12800002
128100                                                                  12810002
128200               IF  PS-BLOCK-ERROR                                 12820002
128300                   SET  PS-ERROR     TO TRUE                      12830002
128400                   MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)      12840002
128500                                     TO PV-TOP-ITEM               12850002
128600               ELSE                                               12860002
128700                   ADD  +1           TO PV-BLOCK-NUMBER           12870002
128800                   IF  PV-BLOCK-NUMBER >                          12880002
128900                       ASC-HIGHEST-BLOCK-WRITTEN                  12890002
129000                       MOVE +2       TO ASC-BLK-SUB               12900002
129100                       PERFORM 4410-READ-TEMP-STORAGE             12910002
129200                       MOVE +1       TO ASC-BLK-SUB               12920002
129300                   ELSE                                           12930002
129400                       PERFORM 4410-READ-TEMP-STORAGE             12940002
129500                       ADD  +1        TO PV-BLOCK-NUMBER          12950002
129600                       MOVE +2        TO ASC-BLK-SUB              12960002
129700                       PERFORM 4410-READ-TEMP-STORAGE             12970002
129800                       SUBTRACT +1  FROM PV-BLOCK-NUMBER          12980002
129900                       MOVE +1        TO ASC-BLK-SUB              12990002
130000               END-IF                                             13000002
130100           END-IF                                                 13010002
130200     END-PERFORM.                                                 13020002
130300                                                                  13030002
130400     IF  (PV-ORIGINAL-BLOCK  = +1   AND                           13040002
130500          ASC-LIST-ITEM-NUMBER (1 1) = 1)  OR                     13050002
130600         PS-ERROR                   OR                            13060002
130700         PS-BLOCK-ERROR                                           13070002
130800             CONTINUE                                             13080002
130900     ELSE                                                         13090002
131000         MOVE +1                 TO PV-BLOCK-NUMBER               13100002
131100         MOVE +1                 TO ASC-BLK-SUB                   13110002
131200         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  13120002
131300         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEMS-DISPLAYED           13130002
131400         PERFORM 4410-READ-TEMP-STORAGE                           13140002
131500                                                                  13150002
131600         PERFORM                                                  13160002
131700            UNTIL PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK             13170002
131800               OR PS-ERROR                                        13180002
131900               OR PS-BLOCK-ERROR                                  13190002
132000                                                                  13200002
132100                  COMPUTE PV-ITEMS-HOLD  =                        13210002
132200                          ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1) +   13220002
132300                          PC-ITEMS-PER-PANEL - 1                  13230002
132400                                                                  13240002
132500                  IF  PV-ITEMS-HOLD > ASC-NUMBER-OF-ITEMS-READ    13250002
132600                      SUBTRACT  ASC-NUMBER-OF-ITEMS-READ          13260002
132700                          FROM  PV-ITEMS-HOLD                     13270002
132800                        GIVING  PV-ITEMS-DIFF                     13280002
132900                      SUBTRACT  PV-ITEMS-DIFF                     13290002
133000                          FROM  PC-ITEMS-PER-PANEL                13300002
133100                        GIVING  PV-ITEMS-HOLD                     13310002
133200                          MOVE  PV-ITEMS-HOLD TO PV-SUB           13320002
133300                                                 ASC-ITEM-SUB     13330002
133400                                              ASC-ITEMS-DISPLAYED 13340002
133500                  ELSE                                            13350002
133600                      MOVE ASC-ITEMS-DISPLAYED  TO PV-SUB         13360002
133700                      MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB   13370002
133800                  END-IF                                          13380002
133900                                                                  13390002
134000                  PERFORM 3300-EDIT-SELECTIONS                    13400002
134100                          VARYING PV-SUB                          13410002
134200                             FROM PV-SUB BY -1                    13420002
134300                            UNTIL PV-SUB < +1                     13430002
134400                                                                  13440002
134500                  MOVE +1               TO ASC-BLK-SUB            13450002
134600                                                                  13460002
134700                  PERFORM 5105-REWRITE-ASC-LISTQ                  13470002
134800                                                                  13480002
134900                  MOVE +1                TO ASC-BLK-SUB           13490002
135000                                                                  13500002
135100                  IF  PS-BLOCK-ERROR                              13510002
135200                      SET  PS-ERROR     TO TRUE                   13520002
135300                      MOVE ASC-LIST-ITEM-NUMBER (ASC-BLK-SUB 1)   13530002
135400                                        TO PV-TOP-ITEM            13540002
135500                  ELSE                                            13550002
135600                      ADD  +1            TO PV-BLOCK-NUMBER       13560002
135700                      IF  PV-BLOCK-NUMBER = PV-ORIGINAL-BLOCK     13570002
135800                          MOVE +2        TO ASC-BLK-SUB           13580002
135900                          PERFORM 4410-READ-TEMP-STORAGE          13590002
136000                          MOVE +1        TO ASC-BLK-SUB           13600002
136100                      ELSE                                        13610002
136200                          PERFORM 4410-READ-TEMP-STORAGE          13620002
136300                          ADD  +1        TO PV-BLOCK-NUMBER       13630002
136400                          MOVE +2        TO ASC-BLK-SUB           13640002
136500                          PERFORM 4410-READ-TEMP-STORAGE          13650002
136600                          SUBTRACT +1  FROM PV-BLOCK-NUMBER       13660002
136700                          MOVE +1        TO ASC-BLK-SUB           13670002
136800                      END-IF                                      13680002
136900                  END-IF                                          13690002
137000     END-PERFORM.                                                 13700002
137100     MOVE +0 TO PV-ITEMS-HOLD.                                    13710002
137200                                                                  13720002
137300*----------------------------------------------------------------*13730002
137400*    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *13740002
137500*    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*13750002
137600*    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *13760002
137700*                                                                *13770002
137800*    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *13780002
137900*    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *13790002
138000*    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *13800002
138100*    US IN THE 2ND BLOCK OF THE ARRAY.                           *13810002
138200*----------------------------------------------------------------*13820002
138300 3100-SET-SUBSCRIPTS.                                             13830002
138400     COMPUTE ASC-ITEM-SUB =                                       13840002
138500         (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        13850002
138600                                                                  13860002
138700     IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         13870002
138800         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            13880002
138900         MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               13890002
139000     ELSE                                                         13900002
139100         MOVE +1                     TO ASC-BLK-SUB               13910002
139200     END-IF.                                                      13920002
139300                                                                  13930002
139400******************************************************************13940002
139500** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **13950002
139600******************************************************************13960002
139700 3200-RESET-ATTRIBUTES.                                           13970002
139800     MOVE DP015-UNP-ALP-NOR-OFF    TO ASTRTITA.                   13980002
139900     MOVE DP015-GREEN              TO ASTRTITC.                   13990002
140000     MOVE DP015-UNDERLINE          TO ASTRTITH.                   14000002
140100                                                                  14010002
140200     PERFORM                                                      14020002
140300         VARYING PV-SUB                                           14030002
140400         FROM 1 BY 1                                              14040002
140500         UNTIL PV-SUB > PC-ITEMS-PER-PANEL                        14050002
140600         MOVE DP015-UNP-ALP-NOR-OFF                               14060002
140700                                   TO MR-SELECTA   (PV-SUB)       14070002
140800         MOVE DP015-GREEN          TO MR-SELECTC   (PV-SUB)       14080002
140900         MOVE DP015-UNDERLINE      TO MR-SELECTH   (PV-SUB)       14090002
141200     END-PERFORM.                                                 14120002
141300                                                                  14130002
141400******************************************************************14140002
141500** EDIT THE SELECTIONS MADE.  NOTE THAT THE 'SELECTED-SW' IS    **14150002
141600** WHAT WAS PREVIOUSLY CHECKED AND CORRECT 'TEMP-SELECTED-SW'   **14160002
141700** IS WHAT HAS JUST BEEN ENTERED AND HAS NOT BEEN EDITTED OR    **14170002
141800** WAS ENTERED EARLIER, BUT DID NOT PASS THE EDITS.             **14180002
141900******************************************************************14190002
142000 3300-EDIT-SELECTIONS.                                            14200002
142100     EVALUATE TRUE                                                14210002
142200         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14220002
142300             = ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)         14230002
142400                 CONTINUE                                         14240002
142500         WHEN ASC-TEMP-SELECT  (ASC-BLK-SUB ASC-ITEM-SUB)         14250002
142600             IF  NOT ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)        14260002
142700                 ADD +1         TO ASC-NUMBER-OF-SELECTED-ITEMS   14270002
142800                 MOVE ASC-TEMP-SELECTED-SW                        14280002
142900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14290002
143000                                TO ASC-SELECTED-SW                14300002
143100                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14310002
143200             END-IF                                               14320002
143300         WHEN ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)     14330002
143400                 = SPACE                                          14340002
143500             EVALUATE TRUE                                        14350002
143600                 WHEN ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)       14360002
143700                     SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS14370002
143800                     MOVE SPACE TO ASC-SELECTED-SW                14380002
143900                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14390002
144000                 WHEN ASC-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)        14400002
144100                     MOVE ZERO  TO ASC-START-OF-SELECTED-RANGE    14410002
144200                     MOVE SPACE TO ASC-SELECTED-SW                14420002
144300                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14430002
144400                 WHEN ASC-END (ASC-BLK-SUB ASC-ITEM-SUB)          14440002
144500                     MOVE ZERO  TO ASC-END-OF-SELECTED-RANGE      14450002
144600                     MOVE SPACE TO ASC-SELECTED-SW                14460002
144700                                      (ASC-BLK-SUB ASC-ITEM-SUB)  14470002
144800             END-EVALUATE                                         14480002
144900         WHEN ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)           14490002
145000             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14500002
145100                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14510002
145200             END-IF                                               14520002
145300             PERFORM 3310-EDIT-RANGE                              14530002
145400         WHEN ASC-TEMP-END (ASC-BLK-SUB ASC-ITEM-SUB)             14540002
145500             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14550002
145600                 SUBTRACT +1 FROM ASC-NUMBER-OF-SELECTED-ITEMS    14560002
145700             END-IF                                               14570002
145800             PERFORM 3310-EDIT-RANGE                              14580002
145900         WHEN OTHER                                               14590002
146000             MOVE PC-TSYMSG-00005   TO DP020-MSG-NUMBER           14600002
146100             SET DP020-MSG-FATAL    TO TRUE                       14610002
146200             MOVE -1                TO ASTRTITL                   14620002
146300             SET DP030-SET-CURSOR-APPL-1 TO TRUE                  14630002
146400             MOVE DP015-RED         TO MR-SELECTC (PV-SUB)        14640002
146500             MOVE DP015-REVERSE     TO MR-SELECTH (PV-SUB)        14650002
146600             SET PS-ERROR TO TRUE                                 14660002
146700             IF  ASC-SELECT (ASC-BLK-SUB ASC-ITEM-SUB)            14670002
146800                 SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS     14680002
146900                 MOVE SPACE         TO ASC-SELECTED-SW            14690002
147000                                        (ASC-BLK-SUB ASC-ITEM-SUB)14700002
147100             END-IF                                               14710002
147200     END-EVALUATE.                                                14720002
147300                                                                  14730002
147400     SUBTRACT +1             FROM PV-ITEM-IN-USE.                 14740002
147500     SUBTRACT +1 FROM ASC-ITEM-SUB.                               14750002
147600     IF  ASC-ITEM-SUB < 1                                         14760002
147700         SUBTRACT +1 FROM ASC-BLK-SUB                             14770002
147800         MOVE PC-ITEMS-PER-PANEL   TO ASC-ITEM-SUB                14780002
147900     END-IF.                                                      14790002
148000                                                                  14800002
148100******************************************************************14810002
148200** IF A BEGINNING AND END OF RANGE WAS ENTERED TO SELECT A      **14820002
148300** RANGE OF LINES, MAKE SURE THERE IS ONLY 1 BEGINNING AND 1    **14830002
148400** ENDING AND MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN)**14840002
148500** THE ENDING.                                                  **14850002
148600******************************************************************14860002
148700 3310-EDIT-RANGE.                                                 14870002
148800     IF  ASC-TEMP-BEGIN (ASC-BLK-SUB ASC-ITEM-SUB)                14880002
148900         IF  ASC-START-OF-SELECTED-RANGE = ZERO                   14890002
149000             MOVE ASC-TEMP-SELECTED-SW  (ASC-BLK-SUB ASC-ITEM-SUB)14900002
149100                                   TO ASC-SELECTED-SW             14910002
149200                                        (ASC-BLK-SUB ASC-ITEM-SUB)14920002
149300             MOVE PV-ITEM-IN-USE   TO ASC-START-OF-SELECTED-RANGE 14930002
149400         ELSE                                                     14940002
149500             IF  ASC-START-OF-SELECTED-RANGE = PV-ITEM-IN-USE     14950002
149600                 CONTINUE                                         14960002
149700             ELSE                                                 14970002
149800*                -- ONLY ONE BEGINNING-OF-RANGE-ALLOWED --        14980002
149900                 MOVE PC-TSYMSG-00054                             14990002
150000                                   TO DP020-MSG-NUMBER            15000002
150100                 SET DP020-MSG-FATAL                              15010002
150200                                   TO TRUE                        15020002
150300                 MOVE -1           TO ASTRTITL                    15030002
150400                 SET DP030-SET-CURSOR-APPL-1 TO TRUE              15040002
150500                 MOVE DP015-RED    TO MR-SELECTC (PV-SUB)         15050002
150600                 MOVE DP015-UNDERLINE TO MR-SELECTH (PV-SUB)      15060002
150700                 SET PS-ERROR      TO TRUE                        15070002
150800             END-IF                                               15080002
150900         END-IF                                                   15090002
151000     ELSE                                                         15100002
151100         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     15110002
151200             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 15120002
151300                                   TO ASC-SELECTED-SW             15130002
151400                                     (ASC-BLK-SUB ASC-ITEM-SUB)   15140002
151500             MOVE PV-ITEM-IN-USE   TO ASC-END-OF-SELECTED-RANGE   15150002
151600         ELSE                                                     15160002
151700             IF  ASC-END-OF-SELECTED-RANGE = PV-ITEM-IN-USE       15170002
151800                 CONTINUE                                         15180002
151900             ELSE                                                 15190002
152000*                -- ONLY ONE END-OF-RANGE ALLOWED --              15200002
152100                 MOVE PC-TSYMSG-00055                             15210002
152200                                   TO DP020-MSG-NUMBER            15220002
152300                 SET DP020-MSG-FATAL                              15230002
152400                                   TO TRUE                        15240002
152500                 MOVE -1           TO ASTRTITL                    15250002
152600                 SET DP030-SET-CURSOR-APPL-1                      15260002
152700                                   TO TRUE                        15270002
152800                 SET PS-ERROR      TO TRUE                        15280002
152900             END-IF                                               15290002
153000         END-IF                                                   15300002
153100     END-IF.                                                      15310002
153200                                                                  15320002
153300******************************************************************15330002
153400** IF BOTH A BEGINNING AND END OF RANGE HAVE BEEN SPECIFIED,    **15340002
153500** MAKE SURE THAT THE BEGINNING IS BEFORE (LESS THAN) THE END.  **15350002
153600******************************************************************15360002
153700 3400-CHECK-RANGE-SEQUENCE.                                       15370002
153800     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       15380002
153900       AND  ASC-END-OF-SELECTED-RANGE > ZERO                      15390002
154000       AND  ASC-START-OF-SELECTED-RANGE >                         15400002
154100                                         ASC-END-OF-SELECTED-RANGE15410002
154200*        -- END-OF-RANGE BEFORE BEGINNING-OF-RANGE                15420002
154300         MOVE PC-TSYMSG-00052 TO DP020-MSG-NUMBER                 15430002
154400         SET DP020-MSG-FATAL TO TRUE                              15440002
154500         SET PS-ERROR TO TRUE                                     15450002
154600         PERFORM 3410-POSITION-AT-ERROR                           15460002
154700     END-IF.                                                      15470002
154800                                                                  15480002
154900******************************************************************15490002
155000** BECAUSE RANGES CAN SPAN ACROSS MULTIPLE PAGES, A SEPARATE    **15500002
155100** PARAGRAPH (THIS ONE) IS NEEDED TO DETERMINE WHERE THE CURSOR **15510002
155200** SHOULD BE POSITIONED ON A RANGE ERROR.                       **15520002
155300******************************************************************15530002
155400 3410-POSITION-AT-ERROR.                                          15540002
155500     SET DP030-SET-CURSOR-APPL-1   TO TRUE.                       15550002
155600     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 15560002
155700                    - PV-TOP-ITEM + 1.                            15570002
155800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15580002
155900         CONTINUE                                                 15590002
156000     ELSE                                                         15600002
156100         MOVE -1                   TO MR-SELECTL (PV-SUB)         15610002
156200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15620002
156300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15630002
156400     END-IF.                                                      15640002
156500                                                                  15650002
156600     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   15660002
156700                    - PV-TOP-ITEM + 1.                            15670002
156800     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      15680002
156900         CONTINUE                                                 15690002
157000     ELSE                                                         15700002
157100         MOVE -1                   TO MR-SELECTL (PV-SUB)         15710002
157200         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         15720002
157300         MOVE DP015-RED            TO MR-SELECTC (PV-SUB)         15730002
157400     END-IF.                                                      15740002
157500                                                                  15750002
157600*----------------------------------------------------------------*15760002
157700*    WHENEVER THE USER SELECTS AN ITEM AS THE BEGINNING RANGE    *15770002
157800*    AND ONE AS THE ENDING RANGE, MARK THESE ITEMS AS WELL AS    *15780002
157900*    THOSE THAT FALL IN THE RANGE AS BEING SELECTED.             *15790002
158000*----------------------------------------------------------------*15800002
158100 3500-MARK-RANGE-AS-SELECTED.                                     15810002
158200     MOVE +1                       TO  ASC-BLK-SUB.               15820002
158300     PERFORM 3510-MARK-SELECTED-INDS                              15830002
158400         VARYING ASC-ITEM-SUB                                     15840002
158500         FROM 1 BY 1                                              15850002
158600         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15860002
158700                                                                  15870002
158800     ADD +1                        TO ASC-BLK-SUB.                15880002
158900     PERFORM 3510-MARK-SELECTED-INDS                              15890002
159000         VARYING ASC-ITEM-SUB                                     15900002
159100         FROM 1 BY 1                                              15910002
159200         UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL.                 15920002
159300                                                                  15930002
159400     MOVE ASC-LIST-ITEM-NUMBER(1 1)                               15940002
159500                                   TO  PV-LIST-ITEM-NUMBER.       15950002
159600     COMPUTE PV-FIRST-BLOCK-IN-ARRAY =                            15960002
159700         1 + ((PV-LIST-ITEM-NUMBER - 1) /                         15970002
159800               PC-ITEMS-PER-PANEL).                               15980002
159900                                                                  15990002
160000     MOVE ASC-START-OF-SELECTED-RANGE                             16000002
160100                                   TO PV-START-OF-SELECTED-RANGE. 16010002
160200     COMPUTE PV-FIRST-BLOCK-IN-RANGE =                            16020002
160300         1 + ((PV-START-OF-SELECTED-RANGE - 1) /                  16030002
160400               PC-ITEMS-PER-PANEL).                               16040002
160500                                                                  16050002
160600     MOVE ASC-END-OF-SELECTED-RANGE                               16060002
160700                                   TO  PV-END-OF-SELECTED-RANGE.  16070002
160800     COMPUTE PV-LAST-BLOCK-IN-RANGE =                             16080002
160900         1 + ((PV-END-OF-SELECTED-RANGE - 1) /                    16090002
161000               PC-ITEMS-PER-PANEL).                               16100002
161100     COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                             16110002
161200         PV-FIRST-BLOCK-IN-ARRAY + 1.                             16120002
161300                                                                  16130002
161400     IF (PV-FIRST-BLOCK-IN-RANGE < PV-FIRST-BLOCK-IN-ARRAY) OR    16140002
161500        (PV-LAST-BLOCK-IN-RANGE  > PV-NEXT-BLOCK-IN-ARRAY)        16150002
161600         MOVE +1                   TO ASC-BLK-SUB                 16160002
161700         PERFORM 5100-WRITE-TEMP-STORAGE                          16170002
161800         COMPUTE PV-PREV-BLOCK-IN-ARRAY =                         16180002
161900             PV-FIRST-BLOCK-IN-ARRAY - 1                          16190002
162000                                                                  16200002
162100         PERFORM                                                  16210002
162200             UNTIL PV-FIRST-BLOCK-IN-RANGE >                      16220002
162300                   PV-PREV-BLOCK-IN-ARRAY                         16230002
162400             MOVE PV-FIRST-BLOCK-IN-RANGE                         16240002
162500                                   TO PV-BLOCK-NUMBER             16250002
162600             PERFORM 4410-READ-TEMP-STORAGE                       16260002
162700             PERFORM 3510-MARK-SELECTED-INDS                      16270002
162800                 VARYING ASC-ITEM-SUB                             16280002
162900                 FROM 1 BY 1                                      16290002
163000                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16300002
163100             PERFORM 5100-WRITE-TEMP-STORAGE                      16310002
163200             ADD +1                TO PV-FIRST-BLOCK-IN-RANGE     16320002
163300         END-PERFORM                                              16330002
163400                                                                  16340002
163500         COMPUTE PV-NEXT-BLOCK-IN-ARRAY =                         16350002
163600             PV-FIRST-BLOCK-IN-ARRAY + PC-MAX-BLOCKS-IN-ARRAY     16360002
163700         PERFORM                                                  16370002
163800             UNTIL PV-NEXT-BLOCK-IN-ARRAY >                       16380002
163900                   PV-LAST-BLOCK-IN-RANGE                         16390002
164000             MOVE PV-NEXT-BLOCK-IN-ARRAY                          16400002
164100                                   TO PV-BLOCK-NUMBER             16410002
164200             PERFORM 4410-READ-TEMP-STORAGE                       16420002
164300             PERFORM 3510-MARK-SELECTED-INDS                      16430002
164400                 VARYING ASC-ITEM-SUB                             16440002
164500                 FROM 1 BY 1                                      16450002
164600                 UNTIL ASC-ITEM-SUB > PC-ITEMS-PER-PANEL          16460002
164700             PERFORM 5100-WRITE-TEMP-STORAGE                      16470002
164800             ADD +1                TO PV-NEXT-BLOCK-IN-ARRAY      16480002
164900         END-PERFORM                                              16490002
165000                                                                  16500002
165100         MOVE PV-FIRST-BLOCK-IN-ARRAY                             16510002
165200                                   TO PV-BLOCK-NUMBER             16520002
165300         PERFORM 4410-READ-TEMP-STORAGE                           16530002
165400     END-IF.                                                      16540002
165500                                                                  16550002
165600     MOVE +0                       TO ASC-START-OF-SELECTED-RANGE 16560002
165700                                      ASC-END-OF-SELECTED-RANGE.  16570002
165800                                                                  16580002
165900*----------------------------------------------------------------*16590002
166000* SET THE SELECTION INDICATOR TO 'S' WITHIN THE RANGE.           *16600002
166100*----------------------------------------------------------------*16610002
166200 3510-MARK-SELECTED-INDS.                                         16620002
166300     IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16630002
166400                                ASC-ITEM-SUB) >                   16640002
166500         ASC-START-OF-SELECTED-RANGE)                             16650002
166600     OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                         16660002
166700                                ASC-ITEM-SUB) =                   16670002
166800         ASC-START-OF-SELECTED-RANGE)                             16680002
166900                                                                  16690002
167000         IF (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16700002
167100                                    ASC-ITEM-SUB) <               16710002
167200             ASC-END-OF-SELECTED-RANGE)                           16720002
167300         OR (ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB                     16730002
167400                                    ASC-ITEM-SUB) =               16740002
167500             ASC-END-OF-SELECTED-RANGE)                           16750002
167600                                                                  16760002
167700             IF NOT ASC-SELECT(ASC-BLK-SUB ASC-ITEM-SUB)          16770002
167800                 SET ASC-SELECT     (ASC-BLK-SUB  ASC-ITEM-SUB)   16780002
167900                     ASC-TEMP-SELECT(ASC-BLK-SUB  ASC-ITEM-SUB)   16790002
168000                               TO TRUE                            16800002
168100                 SET ASC-BLOCK-MODIFIED(ASC-BLK-SUB)              16810002
168200                               TO TRUE                            16820002
168300                 ADD +1        TO ASC-NUMBER-OF-SELECTED-ITEMS    16830002
168400             END-IF                                               16840002
168500         END-IF                                                   16850002
168600     END-IF.                                                      16860002
168700                                                                  16870002
168800*----------------------------------------------------------------*16880002
168900*    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *16890002
169000*    INITIALIZE ALL COUNTERS AND FLAGS.                          *16900002
169100*    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *16910002
169200*    DISPLAY THE PANEL TO USER.                                  *16920002
169300*----------------------------------------------------------------*16930002
169400 4000-BUILD-INITIAL-PANEL.                                        16940002
169500     INITIALIZE                  ASC-BLOCK-ENTRIES (1)            16950002
169600                                 ASC-BLOCK-ENTRIES (2).           16960002
169700     MOVE +1                   TO ASC-BLK-SUB.                    16970002
169800     SET ASC-ITEMS-LEFT-ON-DB  TO TRUE.                           16980002
169900                                                                  16990002
170000     MOVE +0                 TO ASC-ITEM-SUB                      17000002
170100                                ASC-NUMBER-OF-ITEMS-READ          17010002
170200                                ASC-NUMBER-OF-SELECTED-ITEMS      17020002
170300                                ASC-HIGHEST-BLOCK-WRITTEN         17030002
170400                                ASC-START-OF-SELECTED-RANGE       17040002
170500                                ASC-END-OF-SELECTED-RANGE         17050002
170600                                ASC-ITEM-AT-TOP-OF-PANEL.         17060002
170700                                                                  17070002
171000     PERFORM 4100-PREPARE-CURSOR.                                 17100002
171100     PERFORM 4010-OPEN-CURSOR.                                    17110002
171200     PERFORM 4300-READ-ITEMS-FROM-DB.                             17120002
171300     PERFORM 4020-CLOSE-CURSOR.                                   17130002
171400                                                                  17140002
171500     MOVE +1                   TO  PV-TOP-ITEM.                   17150002
171600     IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          17160002
171700         SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    17170002
171800         SET DP020-MSG-FATAL   TO  TRUE                           17180002
171900         MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               17190002
172000     ELSE                                                         17200002
172100         MOVE -1               TO MR-SELECTL (1)                  17210002
172200         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      17220002
172300         PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     17230002
172400     END-IF.                                                      17240002
172500                                                                  17250002
172600                                                                  17260002
174500*----------------------------------------------------------------*17450002
174600* OPEN THE CURSOR.                                               *17460002
174700*   IN THIS PARTICULAR APPLICATION ONE OF 3 DIFFERENT CURSORS    *17470002
174800*   WILL BE OPENED DEPENDING ON THE CRITERIA SPECIFIED BY THE    *17480002
174900*   ASSOCIATE.                                                   *17490002
175000*----------------------------------------------------------------*17500002
175100 4010-OPEN-CURSOR.                                                17510002
175200     PERFORM                                                      17520002
175300         WITH TEST AFTER                                          17530002
175400         VARYING PV-RETRY-COUNTER                                 17540002
175500         FROM 1 BY 1                                              17550002
175600         UNTIL ((PV-RETRY-COUNTER > PC-MAX-RETRIES)               17560002
175700                   OR (SQLCODE = ZERO))                           17570002
175800                                                                  17580002
175900         EVALUATE TRUE                                            17590002
176000             WHEN ASC-CODE-PARM-ALL-CSR                           17600005
176100                  MOVE 'CURSOR: CODE-PARM-ALL-CSR'                17610005
176200                                        TO DP013-MESSAGE-TEXT (2) 17620002
176300                  EXEC SQL                                        17630002
176400                      OPEN CODE-PARM-ALL-CSR                      17640005
176500                  END-EXEC                                        17650002
176600                                                                  17660002
176700             WHEN ASC-CODE-PARM-NAME-CSR                          17670005
176800                 MOVE 'CURSOR: CODE-PARM-NAME-CSR'                17680005
176900                                        TO DP013-MESSAGE-TEXT (2) 17690002
177000                   EXEC SQL                                       17700002
177100                      OPEN CODE-PARM-NAME-CSR                     17710005
177200                   END-EXEC                                       17720002
177300                                                                  17730002
177400                                                                  17740002
177500         END-EVALUATE                                             17750002
177600                                                                  17760002
177700         EVALUATE TRUE                                            17770002
177800             WHEN SQLCODE = ZERO                                  17780002
177900             WHEN SQLCODE = -904                                  17790002
178000             WHEN SQLCODE = -913                                  17800002
178100                 CONTINUE                                         17810002
178200             WHEN SQLWARN0 NOT = SPACES                           17820002
178300             WHEN SQLCODE < ZERO                                  17830002
178400             WHEN SQLCODE > ZERO                                  17840002
178500                 MOVE '4010-OPEN-CURSOR' TO DP013-PARAGRAPH       17850002
178600                 MOVE 'UNABLE TO OPEN A CURSOR -'                 17860002
178700                                   TO DP013-MESSAGE-TEXT (1)      17870002
178800                 MOVE SQLCA        TO DP013-SQLCA                 17880002
178900                 MOVE 'TKRPRCD '   TO DP013-DB2-TABLE-NAME (1)    17890005
179000                 SET DP013-DB2-ABEND                              17900002
179100                     DP013-XCTL-DISPLAY-RESTART TO TRUE           17910002
179200                 PERFORM DP013-0000-PROCESS-ABEND                 17920002
179300         END-EVALUATE                                             17930002
179400     END-PERFORM.                                                 17940002
179500                                                                  17950002
179600     IF  PV-RETRY-COUNTER > PC-MAX-RETRIES                        17960002
179700         MOVE '4010-OPEN-CURSOR'   TO DP013-PARAGRAPH             17970002
179800         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   17980002
179900                                   TO DP013-MESSAGE-TEXT (1)      17990002
180000         MOVE SQLCA                TO DP013-SQLCA                 18000002
180100         MOVE 'TKRPRCD '           TO DP013-DB2-TABLE-NAME (1)    18010005
180200         SET DP013-DB2-ABEND                                      18020002
180300             DP013-XCTL-DISPLAY-RESTART TO TRUE                   18030002
180400         PERFORM DP013-0000-PROCESS-ABEND                         18040002
180500     END-IF.                                                      18050002
180600                                                                  18060002
180700*----------------------------------------------------------------*18070002
180800* CLOSE THE CURSOR                                               *18080002
180900*----------------------------------------------------------------*18090002
181000 4020-CLOSE-CURSOR.                                               18100002
181100     EVALUATE TRUE                                                18110002
181200         WHEN ASC-CODE-PARM-ALL-CSR                               18120005
181300              EXEC SQL                                            18130002
181400                   CLOSE CODE-PARM-ALL-CSR                        18140005
181500              END-EXEC                                            18150002
181600                                                                  18160002
181700         WHEN ASC-CODE-PARM-NAME-CSR                              18170005
181800              EXEC SQL                                            18180002
181900                   CLOSE CODE-PARM-NAME-CSR                       18190005
182000              END-EXEC                                            18200002
182100                                                                  18210002
182200     END-EVALUATE.                                                18220002
182300                                                                  18230002
182400     EVALUATE TRUE                                                18240002
182500         WHEN SQLCODE = ZERO                                      18250002
182600             CONTINUE                                             18260002
182700         WHEN SQLWARN0 NOT = SPACES                               18270002
182800         WHEN SQLCODE < ZERO                                      18280002
182900         WHEN SQLCODE > ZERO                                      18290002
183000             MOVE '4020-CLOSE-CURSOR' TO DP013-PARAGRAPH          18300002
183100             MOVE 'UNABLE TO CLOSE CURSOR '                       18310002
183200                               TO DP013-MESSAGE-TEXT (1)          18320002
183300             MOVE SQLCA        TO DP013-SQLCA                     18330002
183400             MOVE 'TKRPRCD '   TO DP013-DB2-TABLE-NAME (1)        18340005
183500             SET DP013-DB2-ABEND                                  18350002
183600                 DP013-XCTL-DISPLAY-RESTART TO TRUE               18360002
183700             PERFORM DP013-0000-PROCESS-ABEND                     18370002
183800     END-EVALUATE.                                                18380002
183900                                                                  18390002
184000*----------------------------------------------------------------*18400002
184100*    SET UP THE HOST VARIABLES.                                  *18410002
184200*----------------------------------------------------------------*18420002
184300 4100-PREPARE-CURSOR.                                             18430002
184400                                                                  18440002
184500     MOVE ASC-PARM-NAME        TO  DK-CODE-PARM.                  18450007
184700                                                                  18470002
184800     IF  DK-CODE-PARM   > SPACES                                  18480005
185000             SET ASC-CODE-PARM-NAME-CSR TO TRUE                   18500005
185100         ELSE                                                     18510002
185200             SET ASC-CODE-PARM-ALL-CSR  TO TRUE                   18520005
185300     END-IF.                                                      18530002
185400                                                                  18540002
185500*----------------------------------------------------------------*18550002
185600*    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *18560002
185700*    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *18570002
185800*    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *18580002
185900*    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *18590002
186000*    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *18600002
186100*                                                                *18610002
186200*    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *18620002
186300*    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *18630002
186400*    UPON INITIALIZATION.                                        *18640002
186500*----------------------------------------------------------------*18650002
186600 4300-READ-ITEMS-FROM-DB.                                         18660002
186700     PERFORM                                                      18670002
186800         VARYING PV-READ-COUNT                                    18680002
186900         FROM 1 BY 1                                              18690002
187000         UNTIL ((PV-READ-COUNT > PC-MAX-ITEMS)                    18700002
187100            OR (ASC-NO-ITEMS-LEFT-ON-DB))                         18710002
187200                                                                  18720002
187300        PERFORM 4310-FETCH                                        18730002
187400                                                                  18740002
187500         IF  ASC-ITEMS-LEFT-ON-DB                                 18750002
187600             IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                18760002
187700                 ADD +1            TO ASC-ITEM-SUB                18770002
187800             ELSE                                                 18780002
187900                 ADD +1            TO ASC-BLK-SUB                 18790002
188000                 MOVE +1           TO ASC-ITEM-SUB                18800002
188100                                                                  18810002
188200                 IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         18820002
188300                     MOVE +1       TO ASC-BLK-SUB                 18830002
188400                     SET ASC-BLOCK-MODIFIED (1) TO TRUE           18840002
188500                     PERFORM 5100-WRITE-TEMP-STORAGE              18850002
188600                     MOVE ASC-BLOCK-ENTRIES                       18860002
188700                               (PC-MAX-BLOCKS-IN-ARRAY)           18870002
188800                                TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 18880002
188900                     ADD +1        TO ASC-BLK-SUB                 18890002
189000                     INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   18900002
189100                     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      18910002
189200                                   TO TRUE                        18920002
189300                 END-IF                                           18930002
189400             END-IF                                               18940002
189500             ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    18950002
189600             MOVE ASC-NUMBER-OF-ITEMS-READ                        18960002
189700                                   TO ASC-LIST-ITEM-NUMBER        18970002
189800                                       (ASC-BLK-SUB ASC-ITEM-SUB) 18980002
189900             EVALUATE TRUE                                        18990002
190000                 WHEN CN014-FUNCTION-NONE                         19000002
190100                     MOVE SPACES TO ASC-ACTION                    19010002
190200                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19020002
190300                 WHEN CN014-UPD-CODE                              19030005
190400                     MOVE PC-UPD TO ASC-ACTION                    19040002
190500                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19050002
190600                 WHEN CN018-UPD-TKRPRCD                           19060005
190700                     MOVE PC-UPD TO ASC-ACTION                    19070002
190800                                      (ASC-BLK-SUB ASC-ITEM-SUB)  19080002
190900             END-EVALUATE                                         19090002
191000             MOVE KRPRCD-SYS-PRC-FUNC-CDE  TO ASC-FUNC-CODE       19100009
191100                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19110005
191200             MOVE KRPRCD-SYS-PRC-FUNC-DESC TO ASC-FUNC-DESC       19120009
191300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19130002
191400             MOVE KRPRCD-PRC-FUNC-TYP-CDE  TO ASC-TYPE            19140005
191500                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19150002
191600             MOVE PV-TKRPRPM-COUNT         TO ASC-COUNT           19160011
192300                                       (ASC-BLK-SUB ASC-ITEM-SUB) 19230002
192400         END-IF                                                   19240002
192500     END-PERFORM.                                                 19250002
192600                                                                  19260002
192700     IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          19270002
192800         MOVE +1               TO ASC-BLK-SUB                     19280002
192900         PERFORM 5100-WRITE-TEMP-STORAGE                          19290002
193000         ADD +1                TO ASC-BLK-SUB                     19300002
193100         PERFORM 5100-WRITE-TEMP-STORAGE                          19310002
193200                                                                  19320002
193300         MOVE 1                TO ASC-BLK-SUB                     19330002
193400                                  PV-BLOCK-NUMBER                 19340002
193500         PERFORM 4410-READ-TEMP-STORAGE                           19350002
193600         IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             19360002
193700             MOVE 2            TO ASC-BLK-SUB                     19370002
193800                                  PV-BLOCK-NUMBER                 19380002
193900             PERFORM 4410-READ-TEMP-STORAGE                       19390002
194000         END-IF                                                   19400002
194100     END-IF.                                                      19410002
194200                                                                  19420002
194300*----------------------------------------------------------------*19430002
194400*    FETCH THE CURSOR                                             19440002
194500*----------------------------------------------------------------*19450002
194600 4310-FETCH.                                                      19460002
194700       EVALUATE TRUE                                              19470002
194800           WHEN ASC-CODE-PARM-ALL-CSR                             19480005
194900               EXEC SQL                                           19490002
195000                    FETCH CODE-PARM-ALL-CSR                       19500005
195100                    INTO                                          19510005
195200                          :KRPRCD-SYS-PRC-FUNC-CDE                19520005
195300                        , :KRPRCD-SYS-PRC-FUNC-DESC               19530005
195400                        , :KRPRCD-PRC-FUNC-TYP-CDE                19540005
195900               END-EXEC                                           19590002
196000                                                                  19600002
196100           WHEN ASC-CODE-PARM-NAME-CSR                            19610005
196200               EXEC SQL                                           19620002
196300                    FETCH CODE-PARM-NAME-CSR                      19630005
196400                    INTO                                          19640005
196500                          :KRPRCD-SYS-PRC-FUNC-CDE                19650005
196600                        , :KRPRCD-SYS-PRC-FUNC-DESC               19660005
196700                        , :KRPRCD-PRC-FUNC-TYP-CDE                19670005
197200               END-EXEC                                           19720002
197300                                                                  19730002
197400     END-EVALUATE.                                                19740002
197500                                                                  19750002
197600     EVALUATE TRUE                                                19760002
197700         WHEN SQLCODE = ZERO                                      19770002
197710              PERFORM 4315-COUNT-TKRPRPM                          19771011
197800                                                                  19780011
197900         WHEN SQLCODE = +100                                      19790002
198000              CONTINUE                                            19800002
198100         WHEN SQLWARN0 NOT = SPACE                                19810002
198200         WHEN SQLCODE NOT = ZERO                                  19820002
198300              MOVE '4310-FETCH-CURSOR' TO DP013-PARAGRAPH         19830002
198400              MOVE 'COULD NOT FETCH CURSOR'                       19840002
198500                               TO DP013-MESSAGE-TEXT (1)          19850002
198600              MOVE SQLCA       TO DP013-SQLCA                     19860002
198700              SET DP013-DB2-ABEND TO TRUE                         19870002
198800              PERFORM DP013-0000-PROCESS-ABEND                    19880002
198900     END-EVALUATE.                                                19890002
199000                                                                  19900002
199100     IF  SQLCODE EQUAL +100                                       19910002
199200         SET ASC-NO-ITEMS-LEFT-ON-DB TO TRUE                      19920002
199300     END-IF.                                                      19930002
199400                                                                  19940002
199401*----------------------------------------------------------------*19940111
199402* COUNT THE NUMBER OF ROWS ON TKRPRPM FOR THIS CODE              *19940211
199403*----------------------------------------------------------------*19940311
199410 4315-COUNT-TKRPRPM.                                              19941011
199411                                                                  19941111
199420     EXEC SQL                                                     19942011
199430          SELECT COUNT(*)                                         19943012
199440            INTO :PV-TKRPRPM-COUNT                                19944012
199450            FROM TKRPRPM                                          19945012
199460           WHERE SYS_PRC_FUNC_CDE   =  :KRPRCD-SYS-PRC-FUNC-CDE   19946012
199480     END-EXEC.                                                    19948011
199501                                                                  19950111
199502     EVALUATE TRUE                                                19950211
199503         WHEN SQLCODE = ZERO                                      19950311
199504              CONTINUE                                            19950411
199505                                                                  19950511
199506         WHEN SQLCODE = +100                                      19950611
199507              CONTINUE                                            19950711
199508         WHEN SQLWARN0 NOT = SPACE                                19950811
199509         WHEN SQLCODE NOT = ZERO                                  19950911
199510              MOVE '4315-COUNT-TKRPRPM' TO DP013-PARAGRAPH        19951011
199511              MOVE 'COULD NOT COUNT TKRPRPM'                      19951111
199512                               TO DP013-MESSAGE-TEXT (1)          19951211
199513              MOVE SQLCA       TO DP013-SQLCA                     19951311
199514              SET DP013-DB2-ABEND TO TRUE                         19951411
199515              PERFORM DP013-0000-PROCESS-ABEND                    19951511
199516     END-EVALUATE.                                                19951611
199517                                                                  19951711
199521                                                                  19952111
199530*----------------------------------------------------------------*19953002
199600* MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *19960002
199700*----------------------------------------------------------------*19970002
199800 4400-MOVE-COMMAREA-TO-SCREEN.                                    19980002
199900     IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             19990002
200000         AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          20000002
200100         OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          20010002
200200             MOVE +1    TO ASC-BLK-SUB                            20020002
200300             PERFORM 5100-WRITE-TEMP-STORAGE                      20030002
200400             ADD +1     TO ASC-BLK-SUB                            20040002
200500             PERFORM 5100-WRITE-TEMP-STORAGE                      20050002
200600             DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             20060002
200700                 GIVING PV-BLOCK-NUMBER                           20070002
200800                 REMAINDER PV-REMAINDER                           20080002
200900             IF  PV-REMAINDER > ZERO                              20090002
201000                 ADD +1 TO PV-BLOCK-NUMBER                        20100002
201100             END-IF                                               20110002
201200             MOVE +1    TO ASC-BLK-SUB                            20120002
201300             PERFORM 4410-READ-TEMP-STORAGE                       20130002
201400             ADD +1     TO ASC-BLK-SUB                            20140002
201500                           PV-BLOCK-NUMBER                        20150002
201600             PERFORM 4410-READ-TEMP-STORAGE                       20160002
201700     END-IF.                                                      20170002
201800     MOVE +1            TO ASC-BLK-SUB.                           20180002
201900     COMPUTE ASC-ITEM-SUB =                                       20190002
202000         ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              20200002
202100         + PC-ITEMS-PER-PANEL).                                   20210002
202200                                                                  20220002
202300     IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        20230002
202400         ADD +1         TO ASC-BLK-SUB                            20240002
202500         SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            20250002
202600     END-IF.                                                      20260002
202700                                                                  20270002
202800     COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           20280002
202900         ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                20290002
203000     PERFORM 4430-CHECK-FOR-BEGIN-AND-END.                        20300002
203100     PERFORM 4420-FORMAT-LIST-LINES                               20310002
203200         VARYING PV-SUB                                           20320002
203300         FROM PC-ITEMS-PER-PANEL BY -1                            20330002
203400         UNTIL PV-SUB < +1.                                       20340002
203500                                                                  20350002
203600     COMPUTE ASC-ITEMS-DISPLAYED =                                20360002
203700         ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          20370002
203800     MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    20380002
203900                                      ASTRTITO.                   20390002
204000     MOVE ASC-ITEM-AT-BOT-OF-PANEL TO AENDITO.                    20400002
204100     MOVE ASC-NUMBER-OF-ITEMS-READ TO ATOTITO.                    20410002
204200     MOVE ASC-NUMBER-OF-SELECTED-ITEMS                            20420002
204300                                   TO ASELITO.                    20430002
204400                                                                  20440002
204500     IF  DP020-MSG-NUMBER-X = SPACE                               20450002
204600         IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  20460002
204700*            --- MORE ITEMS TO DISPLAY ----                       20470002
204800             MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            20480002
204900             SET DP020-MSG-INFORMATIONAL TO TRUE                  20490002
205000         END-IF                                                   20500002
205100     END-IF.                                                      20510002
205200                                                                  20520002
205300*----------------------------------------------------------------*20530002
205400*    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *20540002
205500*----------------------------------------------------------------*20550002
205600 4410-READ-TEMP-STORAGE.                                          20560002
205700     EXEC CICS                                                    20570002
205800         READQ TS                                                 20580002
205900             QUEUE (ASC-LIST-QUEUE-NAME)                          20590002
206000             INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               20600002
206100             ITEM  (PV-BLOCK-NUMBER)                              20610002
206200             RESP  (PV-CICS-RESP)                                 20620002
206300     END-EXEC.                                                    20630002
206400                                                                  20640002
206500     IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       20650002
206600       OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     20660002
206700         CONTINUE                                                 20670002
206800     ELSE                                                         20680002
206900         SET DP013-CICS-ABEND     TO TRUE                         20690002
207000         SET DP013-NO-ROLLBACK    TO TRUE                         20700002
207100         MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH         20710002
207200         MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      20720002
207300                                  TO DP013-MESSAGE-TEXT(1)        20730002
207400         PERFORM DP013-0000-PROCESS-ABEND                         20740002
207500     END-IF.                                                      20750002
207600                                                                  20760002
207700     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             20770002
207800                                                                  20780002
207900     IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         20790002
208000         INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               20800002
208100     END-IF.                                                      20810002
208200                                                                  20820002
208300*----------------------------------------------------------------*20830002
208400*    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *20840002
208500*----------------------------------------------------------------*20850002
208600 4420-FORMAT-LIST-LINES.                                          20860002
208700     IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      20870002
208800         SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                20880002
208900         MOVE DP015-ASK-DRK-OFF  TO MR-SELECTA (PV-SUB)           20890002
209000         MOVE DP015-HL-OFF       TO MR-SELECTH (PV-SUB)           20900002
209100         MOVE SPACES             TO MR-SELECTI      (PV-SUB)      20910002
209200                                    MR-ACTION       (PV-SUB)      20920002
209300                                    MR-FUNCT        (PV-SUB)      20930010
209400                                    MR-DESCR        (PV-SUB)      20940010
209500                                    MR-TYPE         (PV-SUB)      20950010
209600                                    MR-COUNT        (PV-SUB)      20960010
210000     ELSE                                                         21000002
210100         IF  ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21010002
210200                                                   > SPACE        21020002
210300             MOVE ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB) 21030002
210400                                          TO MR-SELECTI (PV-SUB)  21040002
210500         ELSE                                                     21050002
210600             MOVE ASC-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)      21060002
210700                                           TO MR-SELECTI (PV-SUB) 21070002
210800         END-IF                                                   21080002
210900                                                                  21090002
211000         IF  DP030-SET-CURSOR-TRAILER                             21100002
211100             IF  ((ASC-TEMP-SELECTED-SW (ASC-BLK-SUB ASC-ITEM-SUB)21110002
211200                 > SPACE)                                         21120002
211300               OR (PV-SUB = 1))                                   21130002
211400                SET DP030-SET-CURSOR-APPL-1 TO TRUE               21140002
211500                MOVE -1          TO MR-SELECTL (PV-SUB)           21150002
211600             END-IF                                               21160002
211700         END-IF                                                   21170002
211800*>>>>>>>>                                                         21180002
211900         MOVE ASC-ACTION (ASC-BLK-SUB ASC-ITEM-SUB)               21190002
212000                                          TO MR-ACTION   (PV-SUB) 21200002
212100         MOVE ASC-FUNC-CODE (ASC-BLK-SUB ASC-ITEM-SUB)            21210007
212200                                          TO MR-FUNCT    (PV-SUB) 21220007
212300         MOVE ASC-FUNC-DESC (ASC-BLK-SUB ASC-ITEM-SUB)            21230007
212400                                          TO MR-DESCR    (PV-SUB) 21240007
212500         MOVE ASC-TYPE      (ASC-BLK-SUB ASC-ITEM-SUB)            21250007
212600                                          TO MR-TYPE     (PV-SUB) 21260007
212700         MOVE ASC-COUNT     (ASC-BLK-SUB ASC-ITEM-SUB)            21270007
212701                                          TO PV-DISP-COUNT        21270113
212800         MOVE PV-DISP-COUNT               TO MR-COUNT    (PV-SUB) 21280013
213500                                                                  21350002
214400     END-IF.                                                      21440002
214500     SUBTRACT +1 FROM ASC-ITEM-SUB                                21450002
214600     IF  ASC-ITEM-SUB < + 1                                       21460002
214700         MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  21470002
214800         MOVE +1                 TO ASC-BLK-SUB                   21480002
214900     END-IF.                                                      21490002
215000                                                                  21500002
215100******************************************************************21510002
215200** IF A BEGINNING OF RANGE WAS SPECIFIED, MAKE SURE AN END OF   **21520002
215300** RANGE WAS SPECIFIED AND VICE-VERSA.  IF ONE IS MISSING,      **21530002
215400** ISSUE A WARNING.                                             **21540002
215500******************************************************************21550002
215600 4430-CHECK-FOR-BEGIN-AND-END.                                    21560002
215700     IF  ASC-START-OF-SELECTED-RANGE > ZERO                       21570002
215800         IF  ASC-END-OF-SELECTED-RANGE = ZERO                     21580002
215900*            -- NO END-OF-RANGE SPECFIED ---                      21590002
216000             MOVE PC-TSYMSG-00051  TO DP020-MSG-NUMBER            21600002
216100             SET DP020-MSG-WARNING TO TRUE                        21610002
216200             PERFORM 4431-POSITION-AT-WARNING                     21620002
216300         END-IF                                                   21630002
216400     ELSE                                                         21640002
216500         IF  ASC-END-OF-SELECTED-RANGE > ZERO                     21650002
216600*            -- NO BEGINNING-OF-RANGE SPECFIED ---                21660002
216700             MOVE PC-TSYMSG-00053  TO DP020-MSG-NUMBER            21670002
216800             SET DP020-MSG-WARNING TO TRUE                        21680002
216900             PERFORM 4431-POSITION-AT-WARNING                     21690002
217000         END-IF                                                   21700002
217100     END-IF.                                                      21710002
217200*                                                                 21720002
217300******************************************************************21730002
217400** ONCE IT HAS BEEN DETERMINED THAT A WARNING IS TO BE ISSUED,  **21740002
217500** DETERMINE IF EITHER THE BEGINNING OF RANGE OR END OF RANGE   **21750002
217600** IS ON THE CURRENT SCREEN.  IF IT IS, HIGHLIGHT IT AND        **21760002
217700** POSITION THE CURSOR THERE.                                   **21770002
217800******************************************************************21780002
217900 4431-POSITION-AT-WARNING.                                        21790002
218000     COMPUTE PV-SUB = ASC-START-OF-SELECTED-RANGE                 21800002
218100                    - PV-TOP-ITEM + 1.                            21810002
218200     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21820002
218300         CONTINUE                                                 21830002
218400     ELSE                                                         21840002
218500         SET DP030-SET-CURSOR-APPL-1 TO TRUE                      21850002
218600         MOVE -1                     TO MR-SELECTL (PV-SUB)       21860002
218700         MOVE DP015-REVERSE          TO MR-SELECTH (PV-SUB)       21870002
218800         MOVE DP015-YELLOW           TO MR-SELECTC (PV-SUB)       21880002
218900     END-IF.                                                      21890002
219000                                                                  21900002
219100     COMPUTE PV-SUB = ASC-END-OF-SELECTED-RANGE                   21910002
219200                    - PV-TOP-ITEM + 1.                            21920002
219300     IF  PV-SUB < +1 OR > PC-ITEMS-PER-PANEL                      21930002
219400         CONTINUE                                                 21940002
219500     ELSE                                                         21950002
219600         SET DP030-SET-CURSOR-APPL-1                              21960002
219700                                   TO TRUE                        21970002
219800         MOVE -1                   TO MR-SELECTL (PV-SUB)         21980002
219900         MOVE DP015-REVERSE        TO MR-SELECTH (PV-SUB)         21990002
220000         MOVE DP015-YELLOW         TO MR-SELECTC (PV-SUB)         22000002
220100     END-IF.                                                      22010002
220200                                                                  22020002
220300*----------------------------------------------------------------*22030002
220400* PREPARE THE SELECTED ITEMS TEMP STORAGE QUEUE.  MOVE ALL SEL-  *22040002
220500* ECTED ITEMS FROM THE LIST TEMP STORAGE QUEUE TO THE LAYOUT     *22050002
220600* FOR THE SELECTED ITEMS QUEUE.                                  *22060002
220700*                                                                *22070002
220800* FIRST, DELETE THE SELECTION QUEUE, NEXT LOAD THE SELECTION     *22080002
220900* QUEUE RECORD.  FINALLY, WRITE THE SELECTION QUEUE ITEM WHEN    *22090002
221000* THE ARRAY IS FULL.                                             *22100002
221100*----------------------------------------------------------------*22110002
221200 5000-PREPARE-SEL-QUEUE.                                          22120002
221300     MOVE +1                   TO  ASC-BLK-SUB.                   22130002
221400     PERFORM 5100-WRITE-TEMP-STORAGE.                             22140002
221500     ADD +1                    TO  ASC-BLK-SUB.                   22150002
221600     PERFORM 5100-WRITE-TEMP-STORAGE.                             22160002
221700                                                                  22170002
221800     MOVE ASC-SEL-QUEUE-NAME-2 TO  ASC-SEL-QUEUE-NAME.            22180026
221810     MOVE ASC-SEL-QUEUE-NAME   TO  CN018-SEL-QUEUE-NAME.          22181026
221900     PERFORM 6010-DELETE-SEL-QUEUE.                               22190002
222000                                                                  22200002
222100     SET ASC-UPDATE-TSQ        TO  TRUE.                          22210002
222200                                                                  22220002
222300     SET CN019-IDX             TO  1.                             22230002
222400     MOVE ZERO                 TO CN018-NUMBER-OF-TS-ITEMS.       22240002
222500     INITIALIZE CN019-SELECTED-ITEM-ARRAY.                        22250002
222600                                                                  22260002
222700     PERFORM 5200-FILL-SEL-QUEUE-RECORD                           22270002
222800             VARYING PV-ITEM                                      22280002
222900             FROM 1 BY 1                                          22290002
223000             UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     22300002
223100                                                                  22310002
223200     IF  CN019-IDX > 1                                            22320002
223300         PERFORM 5205-WRITE-SEL-QUEUE                             22330002
223400         ADD +1                TO CN018-NUMBER-OF-TS-ITEMS        22340002
223500     END-IF.                                                      22350002
223600                                                                  22360002
223700*----------------------------------------------------------------*22370002
223800*    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *22380002
223900*    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *22390002
224000*----------------------------------------------------------------*22400002
224100 5100-WRITE-TEMP-STORAGE.                                         22410002
224200     MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     22420002
224300                                   TO PV-LIST-ITEM-NUMBER.        22430002
224400     COMPUTE PV-BLOCK-NUMBER =                                    22440002
224500         1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    22450002
224600                                                                  22460002
224700     IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             22470002
224800     OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             22480002
224900         IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      22490002
225000             PERFORM 5105-REWRITE-ASC-LISTQ                       22500002
225100         END-IF                                                   22510002
225200     ELSE                                                         22520002
225300         COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       22530002
225400         ASC-HIGHEST-BLOCK-WRITTEN + 1                            22540002
225500         PERFORM 5110-WRITE-ASC-LISTQ                             22550002
225600         ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   22560002
225700     END-IF.                                                      22570002
225800                                                                  22580002
225900     SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             22590002
226000                                                                  22600002
226100******************************************************************22610002
226200** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **22620002
226300** SPECIFIC COMMAREA.                                           **22630002
226400******************************************************************22640002
226500 5105-REWRITE-ASC-LISTQ.                                          22650002
226600     EXEC CICS                                                    22660002
226700         WRITEQ TS                                                22670002
226800             QUEUE (ASC-LIST-QUEUE-NAME)                          22680002
226900             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22690002
227000             ITEM  (PV-BLOCK-NUMBER)                              22700002
227100             REWRITE                                              22710002
227200             RESP  (PV-CICS-RESP)                                 22720002
227300     END-EXEC.                                                    22730002
227400                                                                  22740002
227500     IF  PV-CICS-RESP = DFHRESP(NORMAL)                           22750002
227600         CONTINUE                                                 22760002
227700     ELSE                                                         22770002
227800         SET DP013-CICS-ABEND            TO TRUE                  22780002
227900         SET DP013-NO-ROLLBACK           TO TRUE                  22790002
228000         MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH       22800002
228100         MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     22810002
228200                                         TO DP013-MESSAGE-TEXT(1) 22820002
228300         PERFORM DP013-0000-PROCESS-ABEND                         22830002
228400     END-IF.                                                      22840002
228500                                                                  22850002
228600******************************************************************22860002
228700** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **22870002
228800** SPECIFIC COMMAREA.                                           **22880002
228900******************************************************************22890002
229000 5110-WRITE-ASC-LISTQ.                                            22900002
229100     EXEC CICS                                                    22910002
229200         WRITEQ TS                                                22920002
229300             QUEUE (ASC-LIST-QUEUE-NAME)                          22930002
229400             FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               22940002
229500             ITEM  (PV-BLOCK-NUMBER)                              22950002
229600             RESP  (PV-CICS-RESP)                                 22960002
229700     END-EXEC.                                                    22970002
229800     IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      22980002
229900         SET DP013-CICS-ABEND      TO TRUE                        22990002
230000         SET DP013-NO-ROLLBACK     TO TRUE                        23000002
230100         MOVE '5110-WRITE-ASC-LISTQ'                              23010002
230200                                   TO DP013-PARAGRAPH             23020002
230300         MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           23030002
230400                                   TO DP013-MESSAGE-TEXT(1)       23040002
230500         PERFORM DP013-0000-PROCESS-ABEND                         23050002
230600     END-IF.                                                      23060002
230700                                                                  23070002
230800*----------------------------------------------------------------*23080002
230900* READ A LIST QUEUE RECORD AND MOVE THE KEYS OF SELECTED OBJECTS *23090002
231000* TO THE SELECTED ITEMS TEMP STORAGE QUEUE RECORD.               *23100002
231100*----------------------------------------------------------------*23110002
231200 5200-FILL-SEL-QUEUE-RECORD.                                      23120002
231300     PERFORM 6112-READ-LIST-QUEUE.                                23130002
231400                                                                  23140002
231500     IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       23150002
231600         PERFORM VARYING LQW-IDX                                  23160002
231700         FROM 1 BY 1                                              23170002
231800         UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL            23180002
231900           OR  LQW-LIST-ITEM-NUMBER(LQW-IDX) = ZERO               23190002
232000                                                                  23200002
232100           IF LQW-SELECT (LQW-IDX)                                23210002
232200                 MOVE LQW-LIST-ITEM-NUMBER(LQW-IDX)               23220002
232300                            TO CN019-ITEM          (CN019-IDX)    23230002
232400                 MOVE LQW-ACTION (LQW-IDX)                        23240002
232500                            TO CN019-ACTION-SW     (CN019-IDX)    23250002
232800                 MOVE LQW-FUNC-CODE (LQW-IDX)                     23280005
232900                            TO CN019-FUNC-CODE     (CN019-IDX)    23290005
233000                 MOVE LQW-FUNC-DESC (LQW-IDX)                     23300005
233100                            TO CN019-FUNC-DESC     (CN019-IDX)    23310005
233200                 MOVE LQW-TYPE (LQW-IDX)                          23320002
233300                            TO CN019-FUNC-TYPE     (CN019-IDX)    23330017
233400                 MOVE LQW-COUNT (LQW-IDX)                         23340005
233500                            TO CN019-PARM-COUNT    (CN019-IDX)    23350005
234000                                                                  23400002
234100                 SET CN019-IDX UP BY 1                            23410002
234200                 IF  CN019-IDX > CN019-MAX-ITEMS                  23420002
234300                     PERFORM 5205-WRITE-SEL-QUEUE                 23430002
234400                     ADD +1        TO CN018-NUMBER-OF-TS-ITEMS    23440002
234500                     INITIALIZE CN019-SELECTED-ITEM-ARRAY         23450002
234600                     SET CN019-IDX TO  1                          23460002
234700                 END-IF                                           23470002
234800           END-IF                                                 23480002
234900         END-PERFORM                                              23490002
235000     END-IF.                                                      23500002
235100                                                                  23510002
235200*----------------------------------------------------------------*23520002
235300*    WRITE THE SELECTED ITEMS TEMP STORAGE QUEUE.                *23530002
235400*----------------------------------------------------------------*23540002
235500 5205-WRITE-SEL-QUEUE.                                            23550002
235600     MOVE ASC-NUMBER-OF-SELECTED-ITEMS TO CN019-SELECTED-ITEMS.   23560002
235700                                                                  23570002
235800     EXEC CICS                                                    23580002
235900          WRITEQ TS                                               23590002
236000              QUEUE (ASC-SEL-QUEUE-NAME)                          23600002
236100              FROM  (CN019-SELECT-RECORD)                         23610002
236200              ITEM  (PV-SEL-QUEUE-ITEM)                           23620002
236300              RESP  (PV-CICS-RESP)                                23630002
236400     END-EXEC.                                                    23640002
236500                                                                  23650002
236600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          23660002
236700         CONTINUE                                                 23670002
236800     ELSE                                                         23680002
236900         SET DP013-CICS-ABEND      TO TRUE                        23690002
237000         SET DP013-NO-ROLLBACK     TO TRUE                        23700002
237100         MOVE '5205-WRITE-SEL-QUEUE'                              23710002
237200                                   TO DP013-PARAGRAPH             23720002
237300         MOVE 'ATTEMPTING TO WRITE SELECTED ITEMS QUEUE'          23730002
237400                                   TO DP013-MESSAGE-TEXT(1)       23740002
237500         PERFORM DP013-0000-PROCESS-ABEND                         23750002
237600     END-IF.                                                      23760002
237700                                                                  23770002
237800******************************************************************23780002
237900** WHEN RETURNING TO THIS TRANSACTION FROM ANOTHER TRANSACTION, **23790002
238000** SETUP THE ARRAY AS IT WAS WHEN WE HAD LEFT PREVIOUSLY.  EDIT **23800002
238100** THE SELECTIONS MADE AT THAT TIME AND DISPLAY THE PANEL TO    **23810002
238200** THE USER.                                                    **23820002
238300******************************************************************23830002
238400 6000-REFRESH-PANEL-FROM-TEMP.                                    23840002
238500     IF  ASC-UPDATE-TSQ                                           23850002
238600         SET ASC-NO-TSQ-UPDATE TO TRUE                            23860002
238700         MOVE ZERO                 TO PV-SAVE-ITEM                23870002
238800                                      PV-SEL-QUEUE-ITEM           23880002
238900         MOVE ASC-NUMBER-OF-SELECTED-ITEMS                        23890002
239000                                   TO PV-HOLD-SELECTED-ITEMS      23900002
239100         MOVE +1                   TO PV-ITEMS-PROCESSED          23910002
239200         PERFORM 6100-UPDATE-TSQ                                  23920002
239300             UNTIL PV-ITEMS-PROCESSED >                           23930002
239400                                     PV-HOLD-SELECTED-ITEMS       23940002
239500         INITIALIZE ASC-BLOCK-ENTRIES (1)                         23950002
239600                    ASC-BLOCK-ENTRIES (2)                         23960002
239700     END-IF.                                                      23970002
239800                                                                  23980002
239900*----------------------------------------------------------------*23990002
240000*    DELETE THE SELECTED ITEMS TEMP STORAGE QUEUE.               *24000002
240100*----------------------------------------------------------------*24010002
240200 6010-DELETE-SEL-QUEUE.                                           24020002
240300                                                                  24030002
240400     EXEC CICS                                                    24040002
240500         DELETEQ TS                                               24050002
240600             QUEUE (ASC-SEL-QUEUE-NAME)                           24060002
240700             RESP  (PV-CICS-RESP)                                 24070002
240800     END-EXEC.                                                    24080002
240900                                                                  24090002
241000     IF ((PV-CICS-RESP = DFHRESP(NORMAL)) OR                      24100002
241100        (PV-CICS-RESP = DFHRESP(QIDERR)))                         24110002
241200         CONTINUE                                                 24120002
241300     ELSE                                                         24130002
241400         SET DP013-CICS-ABEND TO TRUE                             24140002
241500         SET DP013-NO-ROLLBACK TO TRUE                            24150002
241600         MOVE '6010-DELETE-SEL-QUEUE' TO DP013-PARAGRAPH          24160002
241700         MOVE 'ERROR TRYING TO DELETE SELECTION TS QUEUE'         24170002
241800                                        TO DP013-MESSAGE-TEXT (1) 24180002
241900         PERFORM DP013-0000-PROCESS-ABEND                         24190002
242000     END-IF.                                                      24200002
242100                                                                  24210002
242200*----------------------------------------------------------------*24220002
242300*    INCREMENT THE TSQ ITEM NUMBER AND READ THE LIST QUEUE.      *24230002
242400*    LOOP THROUGH THE LIST QUEUE TO OBTAIN THE LINE ITEM NUMBER  *24240002
242500*    TO BE USED TO UPDATE (DESELECT) THE CORRECT LINE ITEM IN    *24250002
242600*    THE TEMP QUEUE.                                             *24260002
242700*----------------------------------------------------------------*24270002
242800 6100-UPDATE-TSQ.                                                 24280002
242900                                                                  24290002
243000     ADD 1    TO  PV-SEL-QUEUE-ITEM.                              24300002
243100     PERFORM 6105-READ-SEL-QUEUE.                                 24310002
243200     PERFORM                                                      24320002
243300         VARYING CN019-IDX FROM 1 BY 1                            24330002
243400         UNTIL ((PV-ITEMS-PROCESSED > PV-HOLD-SELECTED-ITEMS)     24340002
243500         OR (CN019-IDX GREATER THAN CN019-MAX-ITEMS))             24350002
243600         IF  CN019-ACTION-SW (CN019-IDX) > SPACE                  24360002
243700             PERFORM 6110-PROCESS-ITEMS                           24370002
243800         END-IF                                                   24380002
243900         ADD +1                TO PV-ITEMS-PROCESSED              24390002
244000     END-PERFORM.                                                 24400002
244100     PERFORM 6111-WRITE-LIST-QUEUE.                               24410002
244200                                                                  24420002
244300*----------------------------------------------------------------*24430002
244400*    READ THE LIST QUEUE RECORD.                                 *24440002
244500*----------------------------------------------------------------*24450002
244600 6105-READ-SEL-QUEUE.                                             24460002
244700                                                                  24470002
244800     EXEC CICS                                                    24480002
244900          READQ TS                                                24490002
245000              QUEUE (ASC-SEL-QUEUE-NAME)                          24500002
245100              INTO  (CN019-SELECT-RECORD)                         24510002
245200              ITEM  (PV-SEL-QUEUE-ITEM)                           24520002
245300              RESP  (PV-CICS-RESP)                                24530002
245400     END-EXEC.                                                    24540002
245500                                                                  24550002
245600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          24560002
245700         CONTINUE                                                 24570002
245800     ELSE                                                         24580002
245900         SET DP013-CICS-ABEND      TO  TRUE                       24590002
246000         SET DP013-NO-ROLLBACK     TO  TRUE                       24600002
246100         MOVE '6105-READ-SEL-QUEUE'                               24610002
246200                                   TO  DP013-PARAGRAPH            24620002
246300         MOVE 'ATTEMPTING TO READ SELECTED ITEMS QUEUE'           24630002
246400                                   TO  DP013-MESSAGE-TEXT(1)      24640002
246500         PERFORM DP013-0000-PROCESS-ABEND                         24650002
246600     END-IF.                                                      24660002
246700                                                                  24670002
246800*----------------------------------------------------------------*24680002
246900*    CALCULATE THE TEMP QUEUE ITEM THAT MUST BE READ AND READ IT.*24690002
247000*    REWRITE THE CURRENT TEMP QUEUE ITEM IF NECESSARY.  CALCULATE*24700002
247100*    THE LINE ITEM OCCURENCE AND UPDATE (DESELECT) IT.           *24710002
247200*----------------------------------------------------------------*24720002
247300 6110-PROCESS-ITEMS.                                              24730002
247400                                                                  24740002
247500     COMPUTE PV-ITEM = 1 + ((CN019-ITEM (CN019-IDX) - 1)          24750002
247600                     / PC-ITEMS-PER-PANEL).                       24760002
247700                                                                  24770002
247800     IF  PV-ITEM NOT EQUAL PV-SAVE-ITEM                           24780002
247900         IF  PV-SAVE-ITEM NOT EQUAL ZERO                          24790002
248000             PERFORM 6111-WRITE-LIST-QUEUE                        24800002
248100         END-IF                                                   24810002
248200         MOVE PV-ITEM          TO PV-SAVE-ITEM                    24820002
248300                                                                  24830002
248400         PERFORM 6112-READ-LIST-QUEUE                             24840002
248500         IF  PV-CICS-RESP NOT EQUAL DFHRESP(NORMAL)               24850002
248600             CONTINUE                                             24860002
248700         END-IF                                                   24870002
248800     END-IF.                                                      24880002
248900                                                                  24890002
249000     COMPUTE PV-SUB = (CN019-ITEM (CN019-IDX)                     24900002
249100                    - LQW-LIST-ITEM-NUMBER (1)) + 1.              24910002
249200     SET LQW-DESELECT (PV-SUB) TO    TRUE                         24920002
249300     MOVE LQW-SELECTED-SW (PV-SUB)                                24930002
249400                               TO LQW-TEMP-SELECTED-SW (PV-SUB).  24940002
249500     EVALUATE TRUE                                                24950002
249600         WHEN CN019-INQ (CN019-IDX)                               24960002
249700              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             24970002
249800                                                                  24980002
249900         WHEN CN019-UPD (CN019-IDX)                               24990002
250000              MOVE PC-UPD      TO LQW-ACTION  (PV-SUB)            25000002
250100              MOVE CN019-FUNC-CODE         (CN019-IDX)            25010005
250200                               TO LQW-FUNC-CODE (PV-SUB)          25020005
250300              MOVE CN019-FUNC-DESC         (CN019-IDX)            25030005
250400                               TO LQW-FUNC-DESC (PV-SUB)          25040005
250500              MOVE CN019-FUNC-TYPE         (CN019-IDX)            25050018
250600                               TO LQW-TYPE    (PV-SUB)            25060005
250700              MOVE CN019-PARM-COUNT        (CN019-IDX)            25070005
250800                               TO LQW-COUNT   (PV-SUB)            25080005
251500                                                                  25150002
251600         WHEN CN019-DEL (CN019-IDX)                               25160002
251700              MOVE PC-DEL      TO LQW-ACTION (PV-SUB)             25170002
251800                                                                  25180002
251900         WHEN CN019-ERR (CN019-IDX)                               25190002
252000              MOVE PC-ERR      TO LQW-ACTION (PV-SUB)             25200002
252100                                                                  25210002
252200         WHEN OTHER                                               25220002
252300              MOVE PC-INQ      TO LQW-ACTION (PV-SUB)             25230002
252400                                                                  25240002
252500     END-EVALUATE.                                                25250002
252600                                                                  25260002
252700     SUBTRACT 1 FROM ASC-NUMBER-OF-SELECTED-ITEMS.                25270002
252800                                                                  25280002
252900*----------------------------------------------------------------*25290002
253000*    WRITE THE TS QUEUE RECORD JUST UPDATED IN C600.             *25300002
253100*----------------------------------------------------------------*25310002
253200 6111-WRITE-LIST-QUEUE.                                           25320002
253300                                                                  25330002
253400     EXEC CICS                                                    25340002
253500         WRITEQ TS                                                25350002
253600             QUEUE (ASC-LIST-QUEUE-NAME)                          25360002
253700             FROM  (LQW-LIST-QUEUE-WORK-AREA)                     25370002
253800             ITEM  (PV-SAVE-ITEM)                                 25380002
253900             REWRITE                                              25390002
254000             RESP  (PV-CICS-RESP)                                 25400002
254100     END-EXEC.                                                    25410002
254200                                                                  25420002
254300     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25430002
254400         CONTINUE                                                 25440002
254500     ELSE                                                         25450002
254600         SET DP013-CICS-ABEND  TO  TRUE                           25460002
254700         SET DP013-NO-ROLLBACK TO  TRUE                           25470002
254800         MOVE '6111-WRITE-LIST-QUEUE' TO  DP013-PARAGRAPH         25480002
254900         MOVE 'ATTEMPTING TO REWRITE LIST QUEUE'                  25490002
255000                               TO  DP013-MESSAGE-TEXT(1)          25500002
255100         PERFORM DP013-0000-PROCESS-ABEND                         25510002
255200     END-IF.                                                      25520002
255300                                                                  25530002
255400*----------------------------------------------------------------*25540002
255500*    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*25550002
255600*----------------------------------------------------------------*25560002
255700 6112-READ-LIST-QUEUE.                                            25570002
255800     EXEC CICS                                                    25580002
255900         READQ TS                                                 25590002
256000             QUEUE (ASC-LIST-QUEUE-NAME)                          25600002
256100             INTO  (LQW-LIST-QUEUE-WORK-AREA)                     25610002
256200             ITEM  (PV-ITEM)                                      25620002
256300             RESP  (PV-CICS-RESP)                                 25630002
256400     END-EXEC.                                                    25640002
256500                                                                  25650002
256600     IF  PV-CICS-RESP = DFHRESP (NORMAL)                          25660002
256700         CONTINUE                                                 25670002
256800     ELSE                                                         25680002
256900         SET DP013-CICS-ABEND        TO TRUE                      25690002
257000         SET DP013-NO-ROLLBACK       TO TRUE                      25700002
257100         MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH           25710002
257200         MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    25720002
257300                                     TO DP013-MESSAGE-TEXT(1)     25730002
257400         PERFORM DP013-0000-PROCESS-ABEND                         25740002
257500     END-IF.                                                      25750002
257600                                                                  25760002
257700*----------------------------------------------------------------*25770002
257800*    ABEND PROCESSOR MODULE                                      *25780002
257900*----------------------------------------------------------------*25790002
258000     COPY DPPD013.                                                25800002
