       IDENTIFICATION DIVISION.                                         00010000
       PROGRAM-ID.    TFKCS452.                                         00020000
       AUTHOR.        JACK KRAMER.                                      00030000
       INSTALLATION.  KOHLS DEPARTMENT STORES.                          00040000
       DATE-WRITTEN.  JANUARY 1997.                                     00050000
       DATE-COMPILED.                                                   00060000
      *---------------------------------------------------------------* 00070000
      *    P452 - RECEIVE TRANSFER ITEM.                              * 00080000
      *                                                               * 00090000
      *    THIS PROGRAM ALLOWS DETAIL TRANSFER RECEIPT.               * 00100000
      *---------------------------------------------------------------* 00110000
      *  1/20/2003 - RAY GRAF                                           00120000
      *   PROCESS NONINTELLIGENT SKU.                                   00130000
      ******************************************************************00140000
051203**DATE:05/12/2003 CHANGED BY: JULIE TEWES DUMMY UPC/SKU CHANGES   00150000
      ******************************************************************00160000
111703* 11/17/2003 - RAY GRAF                                           00162000
111703*   SORT1/SORT2 TRANSFER TYPES.                                   00163000
      ******************************************************************00164000
080204**DATE:08/02/2004 CHANGED BY: RAY GRAF                            00165000
080204**     CHANGE PRINTER DESTINATION TO NEW 8 CHARACTER FORMAT       00166000
      ***************************************************************** 00167000
100404**DATE:10/04/2004 CHANGED BY: RAY GRAF                            00168000
100404**     EXPAND STORE NUMBER. MAKE DOMAIN COMPLIANT.                00169000
      ***************************************************************** 00169100
SR3403* DATE: 03/09/2012 CHANGED BY: TUSHAR PANDIT                      00169200
SR3403*       SR 3403 LARGE RETAIL UNIT PRICE FIELD EXPANSION.          00169300
SR3403***************************************************************** 00169400
      * DATE:        09/24/2021                                         00169599
      * WR/IR#:      CHG0261678                                         00169699
      * PROGRAMMER:  GERMAN BANDA                                       00169799
      * DESCRIPTION: CHANGE CALL OF DPKUT100 TO                         00169899
      *              CALL DP010I-NUMERIC-EDIT-ROUTINE                   00169999
      *              MAKING THE CALL DYNAMIC VS STATIC                  00170099
      *----------------------------------------------------------------*00170199
CICS  * CHANGED 11/16/2022    BY JIM HUNTER      WR: CHG0278345         00170299
CICS  * ADD COPYBOOK DPWS930 AND MAKE THE CICS ARCHITECTURE CALL        00170399
CICS  * DYNAMIC INSTEAD OF STATIC BY CALLING DP930-CICS-ARCH-API.       00170499
CICS  *-----------------------------------------------------------------00170599
      * CHANGED 02/14/2023    BY JEAN KURK       WR: CHG0281369         00170699
      *    CHANGE CALL OF UPC CHECK DIGIT ROUTINE TO BE DYNAMIC         00170799
      *-----------------------------------------------------------------00170999
       ENVIRONMENT DIVISION.                                            00171000
       DATA DIVISION.                                                   00180000
       WORKING-STORAGE SECTION.                                         00190000
                                                                        00200000
       01  DK-DB2-KEYS.                                                 00210000
           05  DK-XFER-DKEY-ID                PIC S9(9)  VALUE ZERO     00220000
                                                          COMP.         00230000
           05  DK-STORE-NBR                   PIC S9(4)  VALUE ZERO     00240000
                                                          COMP.         00250000
           05  DK-UPC-NBR                     PIC S9(15)  VALUE ZEROS   00260000
                                                           COMP-3.      00270000
           05  DK-ITEM-NBR                    PIC S9(15)  VALUE ZEROS   00280000
                                                           COMP-3.      00290000
SR3403     05  DK-XFER-PRIC-AMT               PIC S9(05)V9(02)          00320100
SR3403                                                     VALUE ZEROS  00320200
SR3403                                                     COMP-3.      00320300
           05  DK-SKU-STATUS-CODE             PIC S9(03)  VALUE ZEROS   00321000
                                                           COMP-3.      00322000
      ******************************************************************00330000
      **PROGRAM CONSTANTS                                               00340000
      ******************************************************************00350000
       01  PC-PROGRAM-CONSTANTS.                                        00360000
           05  PC-CURRENT-MAP-NAME            PIC X(08)  VALUE          00370000
                                                          'TF452A  '.   00380000
           05  PC-CURRENT-MAPSET-NAME         PIC X(08)  VALUE          00390000
                                                          'TFKM452 '.   00400000
           05  PC-CURRENT-PROGRAM-NAME        PIC X(08)  VALUE          00410000
                                                          'TFKCS452'.   00420000
           05  PC-RETAIL-ITEM-MAP-NAME        PIC X(08)  VALUE          00430000
                                                          'TF452A'.     00440000
           05  PC-NON-RETAIL-ITEM-MAP-NAME    PIC X(08)  VALUE          00450000
                                                          'TF452B'.     00460000
           05  PC-CLEARANCE-STATUS            PIC 9(02)  VALUE 30.      00470000
111703*    05  PC-DEFECTIVE-DAMAGE            PIC X(02)  VALUE '01'.    00480000
111703     05  PC-DEFECTIVE-DAMAGE-SORT1      PIC X(02)  VALUE '00'.    00481000
111703     05  PC-DEFECTIVE-DAMAGE-SORT2      PIC X(02)  VALUE '01'.    00482000
           05  PC-CALLBACK                    PIC X(02)  VALUE '02'.    00490000
           05  PC-STOCK-BALANCE-CORPORATE     PIC X(02)  VALUE '03'.    00500000
           05  PC-STOCK-BALANCE-STORE         PIC X(02)  VALUE '04'.    00510000
           05  PC-CUSTOMER                    PIC X(02)  VALUE '05'.    00520000
           05  PC-NON-RETAIL                  PIC X(02)  VALUE '06'.    00530000
           05  PC-SECURE-TOTE                 PIC X(02)  VALUE '02'.    00540000
           05  PC-TRAILER                     PIC X(02)  VALUE '04'.    00550000
           05  PC-SETUP-FORMAT                PIC X(01)  VALUE '1'.     00560000
           05  PC-ZERO                        PIC S9(04)  VALUE ZERO    00570000
                                                          COMP.         00580000
           05  PC-MAX-TIMESTAMP               PIC X(26)  VALUE          00590000
                            '9999-12-31-24.00.00.000000'.               00600000
           05  PC-MAX-RETRIES                 PIC S9(03)  VALUE 3       00610000
                                                          COMP-3.       00620000
           05  PC-ONE                         PIC S9(04)  VALUE +1      00630000
                                                          COMP SYNC.    00640000
           05  PC-ROW-NOT-FOUND               PIC S9(04)  VALUE +100    00650000
                                                           COMP SYNC.   00660000
           05  PC-MULTIPLE-ROWS-FOUND         PIC S9(04)  VALUE -811    00670000
                                                           COMP SYNC.   00680000
           05  PC-FASHION-SALES               PIC X(02)  VALUE 'FS'.    00690000
           05  PC-MERCHANDISE-LEDGER          PIC X(02)  VALUE 'ML'.    00700000
           05  PC-COMPLETE-RSN-CDE            PIC X(02)  VALUE 'CM'.    00710000
           05  PC-ADJUSTMENT-RSN-CDE          PIC X(02)  VALUE 'AD'.    00720000
           05  PC-MISDIRECT-RSN-CDE           PIC X(02)  VALUE 'MD'.    00730000
           05  PC-COMPLETED                   PIC X(02)  VALUE 'CM'.    00740000
           05  PC-ASSUMPTIVELY-RECEIVED       PIC X(02)  VALUE 'AR'.    00750000
           05  PC-POSITIVE-RECEIPT            PIC X(02)  VALUE 'PR'.    00760000
           05  PC-INTERMEDIATELY-RECEIVED     PIC X(02)  VALUE 'IR'.    00770000
           05  PC-NO                          PIC X(01)  VALUE 'N'.     00780000
           05  PC-YES                         PIC X(01)  VALUE 'Y'.     00790000
           05  PC-LIST-QUEUE-SEQ              PIC 9(01)  VALUE 1.       00800000
           05  PC-ITEMS-PER-PANEL             PIC S9(04)  VALUE +15     00810000
                                                          COMP SYNC.    00820000
           05  PC-MAX-BLOCKS-IN-ARRAY         PIC S9(04)  VALUE +2      00830000
                                                          COMP SYNC.    00840000
           05  PC-MAX-ITEMS                   PIC S9(09)  VALUE +100000000850000
                                                          COMP-3.       00860000
           05  PC-MSG-NUMBER-LENGTH           PIC S9(04)  VALUE +5      00870000
                                                          COMP SYNC.    00880000
      ******************************************************************00890000
      **CICS SCREEN MESSAGES                                            00900000
      ******************************************************************00910000
           05  PC-TSYMSG-NUMBERS.                                       00920000
               10  PC-TSYMSG-00007            PIC 9(05)  VALUE 00007.   00930000
               10  PC-TSYMSG-00008            PIC 9(05)  VALUE 00008.   00940000
               10  PC-TSYMSG-00050            PIC 9(05)  VALUE 00050.   00950000
               10  PC-TSYMSG-00069            PIC 9(05)  VALUE 00069.   00960000
               10  PC-TSYMSG-00070            PIC 9(05)  VALUE 00070.   00970000
               10  PC-TSYMSG-00100            PIC 9(05)  VALUE 00100.   00980000
               10  PC-TSYMSG-00101            PIC 9(05)  VALUE 00101.   00990000
051203         10  PC-TSYMSG-00110            PIC 9(05)  VALUE 00110.   01000000
               10  PC-TSYMSG-00279            PIC 9(05)  VALUE 00279.   01010000
               10  PC-TSYMSG-00342            PIC 9(05)  VALUE 00342.   01020000
               10  PC-TSYMSG-00412            PIC 9(05)  VALUE 00412.   01030000
               10  PC-TSYMSG-00413            PIC 9(05)  VALUE 00413.   01040000
               10  PC-TSYMSG-01403            PIC 9(05)  VALUE 01403.   01050000
               10  PC-TSYMSG-01507            PIC 9(05)  VALUE 01507.   01060000
               10  PC-TSYMSG-01508            PIC 9(05)  VALUE 01508.   01070000
               10  PC-TSYMSG-01514            PIC 9(05)  VALUE 01514.   01080000
               10  PC-TSYMSG-01520            PIC 9(05)  VALUE 01520.   01090000
               10  PC-TSYMSG-01642            PIC 9(05)  VALUE 01642.   01100000
               10  PC-TSYMSG-01677            PIC 9(05)  VALUE 01677.   01110000
               10  PC-TSYMSG-01678            PIC 9(05)  VALUE 01678.   01120000
      ******************************************************************01130000
      **PROGRAM SWITCHES                                                01140000
      ******************************************************************01150000
       01  PS-PROGRAM-SWITCHES.                                         01160000
           05  PS-ERROR-SW                    PIC X(01) VALUE  'N'.     01170000
               88  PS-ERROR                             VALUE  'Y'.     01180000
               88  PS-NO-ERROR                          VALUE  'N'.     01190000
           05  PS-UPC-ENTERED-SW              PIC X(01) VALUE  'N'.     01200000
               88  PS-UPC-ENTERED                       VALUE  'Y'.     01210000
               88  PS-UPC-NOT-ENTERED                   VALUE  'N'.     01220000
100404     05  PS-UPC-FOUND-ON-XST-UPC-IND    PIC X(01) VALUE 'N'.      01230000
100404         88  PS-UPC-NOT-FOUND-ON-XST-UPC          VALUE 'N'.      01240000
100404         88  PS-UPC-FOUND-ON-XST-UPC              VALUE 'Y'.      01250000
           05  PS-VALID-XFERED-ITEM-IND       PIC X(01) VALUE 'N'.      01260000
               88  PS-INVALID-XFERED-ITEM               VALUE 'N'.      01270000
               88  PS-VALID-XFERED-ITEM                 VALUE 'Y'.      01280000
           05  PS-VALID-ADDED-UPC-IND         PIC X(01) VALUE 'N'.      01290000
               88  PS-INVALID-ADDED-UPC                 VALUE 'N'.      01300000
               88  PS-VALID-ADDED-UPC                   VALUE 'Y'.      01310000
           05  PS-VALID-ADDED-ITEM-IND        PIC X(01) VALUE 'N'.      01320000
               88  PS-INVALID-ADDED-ITEM                VALUE 'N'.      01330000
               88  PS-VALID-ADDED-ITEM                  VALUE 'Y'.      01340000
           05  PS-SKU-ITEM-FOUND-IND          PIC X(01) VALUE 'N'.      01350000
               88  PS-SKU-ITEM-NOT-FOUND                VALUE 'N'.      01360000
               88  PS-SKU-ITEM-FOUND                    VALUE 'Y'.      01370000
           05  PS-DISCREPANCY-SW              PIC X(01) VALUE 'Y'.      01380000
               88  PS-DISCREPANCY-EXISTS                VALUE 'Y'.      01390000
               88  PS-NO-DISCREPANCY-EXISTS             VALUE 'N'.      01400000
           05  PS-STORE-DISCREPANCY-IND       PIC X(01) VALUE 'N'.      01410000
               88  PS-NO-STORE-DISCREPANCY-EXISTS       VALUE 'N'.      01420000
               88  PS-STORE-DISCREPANCY-EXISTS          VALUE 'Y'.      01430000
           05  PS-ITEM-DISCREPANCY-IND        PIC X(01) VALUE 'N'.      01440000
               88  PS-NO-ITEM-DISCREPANCY-EXISTS        VALUE 'N'.      01450000
               88  PS-ITEM-DISCREPANCY-EXISTS           VALUE 'Y'.      01460000
           05  PS-SEAL-DISCREPANCY-IND        PIC X(01) VALUE 'N'.      01470000
               88  PS-NO-SEAL-DISCREPANCY-EXISTS        VALUE 'N'.      01480000
               88  PS-SEAL-DISCREPANCY-EXISTS           VALUE 'Y'.      01490000
           05  PS-TRANSFER-FOUND-SW           PIC X(01) VALUE 'N'.      01500000
               88  PS-TRANSFER-FOUND                    VALUE 'Y'.      01510000
               88  PS-TRANSFER-NOT-FOUND                VALUE 'N'.      01520000
           05  PS-PRICE-FOUND-SW              PIC X(01) VALUE 'N'.      01530000
               88  PS-PRICE-FOUND                       VALUE 'Y'.      01540000
               88  PS-PRICE-NOT-FOUND                   VALUE 'N'.      01550000
           05  PS-COMMAREA-SW                 PIC X(01) VALUE 'N'.      01560000
               88  PS-COMMAREA-VALID                    VALUE 'Y'.      01570000
               88  PS-COMMAREA-NOT-VALID                VALUE 'N'.      01580000
           05  PS-XFER-ITMS-IND               PIC X(01) VALUE 'N'.      01590000
               88  PS-MORE-XFER-ITMS                    VALUE 'N'.      01600000
               88  PS-END-OF-XFER-ITMS                  VALUE 'Y'.      01610000
           05  PS-RCPT-ITMS-IND               PIC X(01) VALUE 'N'.      01620000
               88  PS-MORE-RCPT-ITMS                    VALUE 'N'.      01630000
               88  PS-END-OF-RCPT-ITMS                  VALUE 'Y'.      01640000
           05  PS-UPDATE-IND                  PIC X(01) VALUE 'N'.      01650000
               88  PS-UPDATE-STATUS                     VALUE 'U'.      01660000
               88  PS-INSERT-STATUS                     VALUE 'I'.      01670000
051203     05  PS-VALID-DEPT-CL-SW            PIC  X(01)  VALUE 'N'.    01680000
051203         88  PS-VALID-DEPT-CL                       VALUE 'Y'.    01690000
051203         88  PS-INVALID-DEPT-CL                     VALUE 'N'.    01700000
051203     05  PS-FOUND-DUMMY-UPC             PIC  X(01)  VALUE 'N'.    01710000
051203         88  PS-FOUND-DUMMY-UPC-Y                   VALUE 'Y'.    01720000
051203         88  PS-FOUND-DUMMY-UPC-N                   VALUE 'N'.    01730000
      ***************************************************************** 01740000
      **PROGRAM VARIABLES                                               01750000
      ***************************************************************** 01760000
       01  PV-PROGRAM-VARIABLES.                                        01770000
           05  PV-LOC-SKU-STAT-CDE-9          PIC  9(02) VALUE ZEROS.   01770100
100404     05  PV-GP-RTL-QTY-NULL-IND         PIC S9(04) VALUE +0       01771000
100404                                                   COMP SYNC.     01772000
100404     05  PV-GP-RTL-AMT-NULL-IND         PIC S9(04) VALUE +0       01773000
100404                                                   COMP SYNC.     01774000
           05  PV-CURRENT-MAP-NAME            PIC X(08)  VALUE 'TF452A'.01780000
           05  PV-NULL-IND                    PIC S9(04) VALUE +0       01790000
                                                         COMP SYNC.     01800000
           05  PV-RETRY-COUNT                 PIC S9(04) VALUE +0       01810000
                                                         COMP SYNC.     01820000
           05  PV-DPT-CL-SUBCL.                                         01830000
               10  PV-DEPT                    PIC 999.                  01840000
               10  FILLER                     PIC X(01)  VALUE SPACE.   01850000
               10  PV-GROUP-1.                                          01860000
                   15 PV-CLASS-1              PIC 99     VALUE ZEROS.   01870000
                   15 FILLER                  PIC X(01)  VALUE SPACE.   01880000
                   15 PV-SUBCLASS-1           PIC 9(02)  VALUE ZEROS.   01890000
                   15 FILLER                  PIC X(02)  VALUE SPACE.   01900000
               10  PV-GROUP-2 REDEFINES PV-GROUP-1.                     01910000
                   15 PV-CLASS-2              PIC 9(02).                01920000
                   15 PV-FILLER-2A            PIC X(01).                01930000
                   15 PV-SUBCLASS-2           PIC 9(03).                01940000
                   15 PV-FILLER-2B            PIC X(01).                01950000
               10  PV-GROUP-3 REDEFINES PV-GROUP-1.                     01960000
                   15 PV-CLASS-3              PIC 9(03).                01970000
                   15 PV-FILLER-3A            PIC X(01).                01980000
                   15 PV-SUBCLASS-3           PIC 9(02).                01990000
                   15 PV-FILLER-3B            PIC X(01).                02000000
               10  PV-GROUP-4 REDEFINES PV-GROUP-1.                     02010000
                   15 PV-CLASS-4              PIC 9(03).                02020000
                   15 PV-FILLER-4A            PIC X(01).                02030000
                   15 PV-SUBCLASS-4           PIC 9(03).                02040000
           05  PV-XFER-NBR.                                             02050000
100404*        10  PV-XFER-FR-STR             PIC 9(03).                02060000
100404         10  PV-XFER-FR-STR             PIC 9(04).                02061000
               10  PV-XFER-SEQ-NBR            PIC 9(06).                02070000
           05  PV-CURRENT-TIMESTAMP           PIC X(26).                02080000
           05  PV-DISPLAY-AREA.                                         02090000
               10  PV-DISPLAY-ITM-NBR         PIC 9(15) VALUE ZEROS.    02100000
               10  PV-DISPLAY-XFER-DKEY-ID    PIC 9(09) VALUE ZEROS.    02110000
               10  PV-DISPLAY-XFER-LNE-NBR    PIC 9(04) VALUE ZEROS.    02120000
               10  PV-DISPLAY-XFER-LNE-SEQ-NBR PIC 9(04)  VALUE ZEROS.  02130000
               10  PV-DISPLAY-PSTG-SEQ-NBR    PIC 9(04) VALUE ZEROS.    02140000
               10  PV-DISPLAY-UPC-NBR         PIC 9(13) VALUE ZEROS.    02150000
               10  PV-DISPLAY-INTR-UPC-ID     PIC 9(10) VALUE ZEROS.    02160000
               10  PV-DISPLAY-UPC-VS-ID       PIC 9(09) VALUE ZEROS.    02170000
SR3403         10  PV-DISPLAY-XFER-PRIC-AMT   PIC 9(05).9(02)           02191000
SR3403                                                  VALUE ZEROS.    02192000
           05  PV-KOHLS-INTERNAL-UPC-NBR      PIC 9(13).                02200000
051203     05  PV-CHECK-DUMMY-SKU-DEPT-CL.                              02210000
051203         10  PV-DUMMY-SKU-DEPT          PIC 9(03) VALUE ZEROS.    02220000
051203         10  PV-DUMMY-SKU-CL.                                     02230000
051203             15  PV-DUMMY-SKU-CL-1      PIC 9(01) VALUE ZEROS.    02240000
051203             15  PV-DUMMY-SKU-CL-2      PIC 9(01) VALUE ZEROS.    02250000
051203         10  PV-DUMMY-SKU-CL-9 REDEFINES PV-DUMMY-SKU-CL          02260000
051203                                        PIC 9(02).                02270000
051203         10  PV-DUMMY-SKU-000           PIC 9(03) VALUE ZEROS.    02280000
           05  PV-HOLD-UPC-NBR.                                         02290000
               10  PV-KOHLS-UPC-DIGITS        PIC X(04).                02300000
               10  PV-KOHLS-DEPT              PIC X(03).                02310000
               10  PV-KOHLS-CL.                                         02320000
                   15  PV-KOHLS-CL-1          PIC X(01).                02330000
                   15  PV-KOHLS-CL-2          PIC X(01).                02340000
               10  PV-KOHLS-CL-9 REDEFINES PV-KOHLS-CL                  02350000
                                              PIC 9(02).                02360000
               10  PV-KOHLS-DUMMY-SKU         PIC X(03).                02370000
               10  PV-KOHLS-CHECKDIGIT        PIC X(01).                02380000
           05  PV-HOLD-UPC-NBR-9 REDEFINES PV-HOLD-UPC-NBR              02390000
                                              PIC 9(13).                02400000
           05  PV-ITEM-NBR                    PIC S9(04)  VALUE ZEROS   02410000
                                                           COMP SYNC.   02420000
SR3403     05  PV-RTL-PRICE-X.                                          02471000
SR3403         10  PV-RTL-PRICE-MASK         PIC ZZ,ZZZ.99  VALUE ZEROS.02472000
SR3403     05  PV-EDIT-PRICE                  PIC S9(07)V9(2)           02501000
SR3403                                              VALUE ZEROS         02502000
SR3403                                              COMP-3.             02503000
SR3403     05  PV-EDIT-PRICE-4-DEC REDEFINES PV-EDIT-PRICE              02531000
SR3403                                        PIC S9(05)V9(4)           02532000
SR3403                                              COMP-3.             02533000
           05  PV-FIELD-2                     PIC 9(02).                02540000
           05  PV-FIELD-3                     PIC 9(03).                02550000
           05  PV-FIELD-5                     PIC 9(05).                02560000
           05  PV-QUANTITY                    PIC ZZ9.                  02580000
           05  PV-RECEIVED-QTY                PIC S9(03)  VALUE ZEROS.  02590000
           05  PV-NEW-XFER-LNE-NBR            PIC 9(03)   VALUE ZEROS.  02600000
           05  PV-NEW-XFER-LNE-SEQ-NBR        PIC 9(03)   VALUE ZEROS.  02610000
           05  PV-XFER-LNE-NBR                PIC S9(04)  VALUE ZEROS   02620000
                                                          COMP SYNC.    02630000
           05  PV-XFER-LNE-SEQ-NBR            PIC S9(04)  VALUE ZEROS   02640000
                                                          COMP SYNC.    02650000
           05  PV-ITEM-NBR                    PIC S9(04)  VALUE ZEROS   02660000
                                                          COMP SYNC.    02670000
           05  PV-PSTG-SEQ-NBR                PIC S9(04)  VALUE ZEROS   02680000
                                                          COMP SYNC.    02690000
           05  PV-DB2-NULL-IND                PIC S9(04)  VALUE ZEROS   02700000
                                                          COMP SYNC.    02710000
           05  PV-READ-COUNT                  PIC S9(09)  VALUE +0      02720000
                                                          COMP-3.       02730000
           05  PV-TOP-ITEM                    PIC S9(09)  VALUE +0      02740000
                                                          COMP-3.       02750000
           05  PV-BOTTOM-ITEM                 PIC S9(09)  VALUE +0      02760000
                                                          COMP-3.       02770000
           05  PV-TEMP-BLOCK-NUMBER           PIC S9(09)  VALUE +0      02780000
                                                          COMP-3.       02790000
           05  PV-REMAINDER                   PIC S9(04)  VALUE +0      02800000
                                                          COMP SYNC.    02810000
           05  PV-BLOCK-NUMBER                PIC S9(04)  VALUE +0      02820000
                                                          COMP SYNC.    02830000
           05  PV-HIGHEST-BLOCK-WRITTEN       PIC S9(04)  VALUE +0      02840000
                                                          COMP SYNC.    02850000
           05  PV-LIST-ITEM-NUMBER            PIC S9(04)  VALUE +0      02860000
                                                          COMP SYNC.    02870000
           05  PV-CICS-RESP                   PIC S9(04)  VALUE +0      02880000
                                                          COMP SYNC.    02890000
           05  PV-ITEM                        PIC S9(04)  VALUE +0      02900000
                                                          COMP SYNC.    02910000
           05  PV-SUB                         PIC S9(04)  VALUE +0      02920000
                                                          COMP SYNC.    02930000
           05  PV-ITEM-IN-USE                 PIC S9(09)  VALUE +0      02940000
                                                          COMP-3.       02950000
           05  PV-CUR-RTL-AMT                 PIC S9(7)V9(2) COMP-3.    02960000
           05  PV-GP-RTL-AMT                  PIC S9(7)V9(2) COMP-3.    02970000
           05  PV-GP-QTY                      PIC S9(3)V COMP-3.        02980000
SR3403     05  PV-CICS-APPL-ID.                                         02981000
SR3403         10  FILLER                     PIC X(4).                 02982000
SR3403         10  PV-CICS-REGION-ENVIRONMENT PIC X.                    02983000
SR3403             88  PV-CR-PRODUCTION            VALUE 'P'.           02984000
SR3403         10  PV-FILLER                  PIC X(3).                 02985000
      ******************************************************************02990000
      **  THIS IS THE LAYOUT FOR THE LIST ITEMS TEMP STORAGE QUEUE.   **03000000
      **  THIS MUST BE THE EXACT SAME FORMAT A BLOCK IN THE           **03010000
      **  APPLICATION-SPECIFIC COMMAREA.                              **03020000
      ******************************************************************03030000
       01  LQW-LIST-QUEUE-WORK-AREA.                                    03040000
               10  LQW-BLOCK-MODIFIED-SW          PIC X(01).            03050000
                   88  LQW-BLOCK-NOT-MODIFIED                VALUE 'N'. 03060000
                   88  LQW-BLOCK-MODIFIED                    VALUE 'Y'. 03070000
               10  LQW-ITEM-ARRAY.                                      03080000
                   15  LQW-ITEM-ENTRIES OCCURS 15 TIMES                 03090000
                                        INDEXED BY LQW-IDX.             03100000
                       20  LQW-LIST-ITEM-NUMBER   PIC S9(09)  COMP-3.   03110000
                       20  LQW-XFERED-ITEM-SW     PIC X(01).            03120000
                           88  LQW-XFERED-ITEM               VALUE 'Y'. 03130000
                           88  LQW-NOT-XFERED-ITEM           VALUE 'N'. 03140000
                       20  LQW-LINE               PIC 9(03).            03150000
                       20  LQW-TQTY               PIC 9(03)   COMP-3.   03160000
                       20  LQW-RQTY               PIC X(03).            03170000
                       20  LQW-RQTY-N REDEFINES LQW-RQTY PIC 9(03).     03180000
                       20  LQW-NRTL-DATA.                               03190000
                           25  LQW-NRTL-DEPT      PIC X(03).            03200000
                           25  LQW-NRTL-DESC.                           03210000
                               30  LQW-NRTL-DESC1 PIC X(20).            03220000
                               30  LQW-NRTL-DESC2 PIC X(20).            03230000
                           25  LQW-FIXTURE        PIC X(20).            03240000
                       20  LQW-RTL-DATA REDEFINES LQW-NRTL-DATA.        03250000
                           25  LQW-DPT-CL-SUBCL.                        03260000
                               30  LQW-DEPT       PIC 9(03).            03270000
                               30  LQW-CLASS      PIC 9(03).            03280000
                               30  LQW-SUBCLASS   PIC 9(03).            03290000
051203                     25  LQW-UPC            PIC X(13).            03300000
                           25  LQW-UPC-N REDEFINES LQW-UPC PIC 9(13).   03310000
                           25  LQW-KOHLS-UPC      PIC S9(15)   COMP-3.  03320000
                           25  LQW-TPRICE         PIC 9(05)V99 COMP-3.  03330000
                           25  LQW-FPRICE         PIC 9(05)V99 COMP-3.  03340000
SR3403                     25  LQW-RPRICE         PIC 9(06)V99.         03351099
                           25  LQW-ITEM-NBR       PIC S9(15)   COMP-3.  03360000
                           25  LQW-CUR-RTL-AMT    PIC S9(05)V99 COMP-3. 03370000
                           25  LQW-RNBR-SKU-IND   PIC X(01).            03380000
                           25  LQW-STATUS-CODE    PIC 9(02).            03390000
                           25  LQW-PRICE-ERROR-SW PIC X(01).            03400000
                           25  LQW-GROUP-PRICED-SW PIC X(01).           03410000
                               88  LQW-GROUP-PRICED-ITEM      VALUE 'Y'.03420000
                               88  LQW-NOT-GROUP-PRICED-ITEM  VALUE 'N'.03430000
      *---------------------------------------------------------------* 03440000
      *    MAP LAYOUT                                                 * 03450000
      *---------------------------------------------------------------* 03460000
       01  MD-MAP-DATA-AREA                   PIC X(2000).              03470000
       01  MR-MAP-REDEFINITION REDEFINES MD-MAP-DATA-AREA.              03480000
           05  MR-A-RETAIL.                                             03490000
               10 FILLER                      PIC X(12).                03500000
                                                                        03510000
               10 MR-A-RECV-STRL              PIC S9(04) COMP.          03520000
               10 MR-A-RECV-STRA              PIC X(01).                03530000
               10 MR-A-RECV-STRC              PIC X(01).                03540000
               10 MR-A-RECV-STRH              PIC X(01).                03550000
100404*        10 MR-A-RECV-STR               PIC X(03).                03560000
100404         10 MR-A-RECV-STR               PIC X(04).                03561000
                                                                        03570000
               10 MR-A-STARTL                 PIC S9(04) COMP.          03580000
               10 MR-A-STARTA                 PIC X(01).                03590000
               10 MR-A-STARTC                 PIC X(01).                03600000
               10 MR-A-STARTH                 PIC X(01).                03610000
               10 MR-A-START                  PIC 9(05).                03620000
                                                                        03630000
               10 MR-A-ENDL                   PIC S9(04) COMP.          03640000
               10 MR-A-ENDA                   PIC X(01).                03650000
               10 MR-A-ENDC                   PIC X(01).                03660000
               10 MR-A-ENDH                   PIC X(01).                03670000
               10 MR-A-END                    PIC 9(05).                03680000
                                                                        03690000
               10 MR-A-TOTALL                 PIC S9(04) COMP.          03700000
               10 MR-A-TOTALA                 PIC X(01).                03710000
               10 MR-A-TOTALC                 PIC X(01).                03720000
               10 MR-A-TOTALH                 PIC X(01).                03730000
               10 MR-A-TOTAL                  PIC 9(05).                03740000
                                                                        03750000
               10 MR-A-XFER-NBRL              PIC S9(04) COMP.          03760000
               10 MR-A-XFER-NBRA              PIC X(01).                03770000
               10 MR-A-XFER-NBRC              PIC X(01).                03780000
               10 MR-A-XFER-NBRH              PIC X(01).                03790000
100404*        10 MR-A-XFER-NBR               PIC X(12).                03800000
100404         10 MR-A-XFER-NBR               PIC X(13).                03801000
                                                                        03810000
               10 MR-A-SCROLL-AREA OCCURS 15 TIMES.                     03820000
                   15 MR-A-LINE-NBRL          PIC S9(04) COMP.          03830000
                   15 MR-A-LINE-NBRA          PIC X(01).                03840000
                   15 MR-A-LINE-NBRC          PIC X(01).                03850000
                   15 MR-A-LINE-NBRH          PIC X(01).                03860000
                   15 MR-A-LINE-NBR-X.                                  03870000
                       20  MR-A-LINE-NBR PIC ZZZ.                       03880000
                                                                        03890000
                   15 MR-A-DEPTL              PIC S9(04) COMP.          03900000
                   15 MR-A-DEPTA              PIC X(01).                03910000
                   15 MR-A-DEPTC              PIC X(01).                03920000
                   15 MR-A-DEPTH              PIC X(01).                03930000
                   15 MR-A-DEPT               PIC X(03).                03940000
                                                                        03950000
                   15 MR-A-CLASSL             PIC S9(04) COMP.          03960000
                   15 MR-A-CLASSA             PIC X(01).                03970000
                   15 MR-A-CLASSC             PIC X(01).                03980000
                   15 MR-A-CLASSH             PIC X(01).                03990000
                   15 MR-A-CLASS              PIC X(03).                04000000
                                                                        04010000
                   15 MR-A-SUBCLL             PIC S9(04) COMP.          04020000
                   15 MR-A-SUBCLA             PIC X(01).                04030000
                   15 MR-A-SUBCLC             PIC X(01).                04040000
                   15 MR-A-SUBCLH             PIC X(01).                04050000
                   15 MR-A-SUBCL              PIC X(03).                04060000
                                                                        04070000
                   15 MR-A-UPCL               PIC S9(04) COMP.          04080000
                   15 MR-A-UPCA               PIC X(01).                04090000
                   15 MR-A-UPCC               PIC X(01).                04100000
                   15 MR-A-UPCH               PIC X(01).                04110000
                   15 MR-A-UPC                PIC X(13).                04120000
                                                                        04130000
                   15 MR-A-TQTYL              PIC S9(04) COMP.          04140000
                   15 MR-A-TQTYA              PIC X(01).                04150000
                   15 MR-A-TQTYC              PIC X(01).                04160000
                   15 MR-A-TQTYH              PIC X(01).                04170000
                   15 MR-A-TQTY-X.                                      04180000
                       20 MR-A-TQTY           PIC  ZZZ.                 04190000
                                                                        04200000
                   15 MR-A-RQTYL              PIC S9(04) COMP.          04210000
                   15 MR-A-RQTYA              PIC X(01).                04220000
                   15 MR-A-RQTYC              PIC X(01).                04230000
                   15 MR-A-RQTYH              PIC X(01).                04240000
                   15 MR-A-RQTY.                                        04250000
                       20 MR-A-RQTY-N         PIC ZZ9.                  04260000
                                                                        04270000
                   15 MR-A-TPRICEL            PIC S9(04) COMP.          04280000
                   15 MR-A-TPRICEA            PIC X(01).                04290000
                   15 MR-A-TPRICEC            PIC X(01).                04300000
                   15 MR-A-TPRICEH            PIC X(01).                04310000
SR3403             15 MR-A-TPRICE-X.                                    04331000
SR3403                 20 MR-A-TPRICE         PIC ZZZZZ.ZZ.             04332000
                                                                        04340000
                   15 MR-A-RPRICEL            PIC S9(04) COMP.          04350000
                   15 MR-A-RPRICEA            PIC X(01).                04360000
                   15 MR-A-RPRICEC            PIC X(01).                04370000
                   15 MR-A-RPRICEH            PIC X(01).                04380000
SR3403             15 MR-A-RPRICE.                                      04401000
SR3403                 20 MR-A-RPRICE-N       PIC ZZZZZ.99.             04402000
               10 FILLER                      PIC X(500).               04410000
           05  MR-B-NON-RETAIL REDEFINES MR-A-RETAIL.                   04420000
               10 FILLER                      PIC X(12).                04430000
                                                                        04440000
               10 MR-B-RECV-STRL              PIC S9(04) COMP.          04450000
               10 MR-B-RECV-STRA              PIC X(01).                04460000
               10 MR-B-RECV-STRC              PIC X(01).                04470000
               10 MR-B-RECV-STRH              PIC X(01).                04480000
100404*        10 MR-B-RECV-STR               PIC X(03).                04490000
100404         10 MR-B-RECV-STR               PIC X(04).                04491000
                                                                        04500000
               10 MR-B-STARTL                 PIC S9(04) COMP.          04510000
               10 MR-B-STARTA                 PIC X(01).                04520000
               10 MR-B-STARTC                 PIC X(01).                04530000
               10 MR-B-STARTH                 PIC X(01).                04540000
               10 MR-B-START                  PIC 9(05).                04550000
                                                                        04560000
               10 MR-B-ENDL                   PIC S9(04) COMP.          04570000
               10 MR-B-ENDA                   PIC X(01).                04580000
               10 MR-B-ENDC                   PIC X(01).                04590000
               10 MR-B-ENDH                   PIC X(01).                04600000
               10 MR-B-END                    PIC 9(05).                04610000
                                                                        04620000
               10 MR-B-TOTALL                 PIC S9(04) COMP.          04630000
               10 MR-B-TOTALA                 PIC X(01).                04640000
               10 MR-B-TOTALC                 PIC X(01).                04650000
               10 MR-B-TOTALH                 PIC X(01).                04660000
               10 MR-B-TOTAL                  PIC 9(05).                04670000
                                                                        04680000
               10 MR-B-XFER-NBRL              PIC S9(04) COMP.          04690000
               10 MR-B-XFER-NBRA              PIC X(01).                04700000
               10 MR-B-XFER-NBRC              PIC X(01).                04710000
               10 MR-B-XFER-NBRH              PIC X(01).                04720000
100404*        10 MR-B-XFER-NBR               PIC X(12).                04730000
100404         10 MR-B-XFER-NBR               PIC X(13).                04731000
                                                                        04740000
               10 MR-B-SCROLL-AREA            OCCURS 15 TIMES.          04750000
                   15 MR-B-LINE-NBRL          PIC S9(04) COMP.          04760000
                   15 MR-B-LINE-NBRA          PIC X(01).                04770000
                   15 MR-B-LINE-NBRC          PIC X(01).                04780000
                   15 MR-B-LINE-NBRH          PIC X(01).                04790000
                   15 MR-B-LINE-NBR-X.                                  04800000
                       20  MR-B-LINE-NBR PIC ZZZ.                       04810000
                                                                        04820000
                   15 MR-B-DESCL              PIC S9(04) COMP.          04830000
                   15 MR-B-DESCA              PIC X(01).                04840000
                   15 MR-B-DESCC              PIC X(01).                04850000
                   15 MR-B-DESCH              PIC X(01).                04860000
                   15 MR-B-DESC.                                        04870000
                       20 MR-B-DESC1          PIC X(20).                04880000
                       20 MR-B-DESC2          PIC X(20).                04890000
                                                                        04900000
                   15 MR-B-FIXTUREL           PIC S9(04) COMP.          04910000
                   15 MR-B-FIXTUREA           PIC X(01).                04920000
                   15 MR-B-FIXTUREC           PIC X(01).                04930000
                   15 MR-B-FIXTUREH           PIC X(01).                04940000
                   15 MR-B-FIXTURE            PIC X(20).                04950000
                                                                        04960000
                   15 MR-B-DEPTL              PIC S9(04) COMP.          04970000
                   15 MR-B-DEPTA              PIC X(01).                04980000
                   15 MR-B-DEPTC              PIC X(01).                04990000
                   15 MR-B-DEPTH              PIC X(01).                05000000
                   15 MR-B-DEPT               PIC X(03).                05010000
                                                                        05020000
                   15 MR-B-TQTYL              PIC S9(04) COMP.          05030000
                   15 MR-B-TQTYA              PIC X(01).                05040000
                   15 MR-B-TQTYC              PIC X(01).                05050000
                   15 MR-B-TQTYH              PIC X(01).                05060000
                   15 MR-B-TQTY-X.                                      05070000
                       20 MR-B-TQTY           PIC ZZZ.                  05080000
                                                                        05090000
                   15 MR-B-RQTYL              PIC S9(04) COMP.          05100000
                   15 MR-B-RQTYA              PIC X(01).                05110000
                   15 MR-B-RQTYC              PIC X(01).                05120000
                   15 MR-B-RQTYH              PIC X(01).                05130000
                   15 MR-B-RQTY.                                        05140000
                       20 MR-B-RQTY-N         PIC ZZ9.                  05150000
      ***************************************************************** 05160000
      **COPYBOOKS                                                       05170000
      ***************************************************************** 05180000
                                                                        05181000
      **COMMAREA FOR DISCREPANCY PRINT PROGRAM                          05190000
           COPY TFWS005.                                                05200000
      ** RF COPYBOOK TO FORMAT PRINTER DESTINATION                      05201000
080204     COPY RFWS009.                                                05202000
      **ATTRIBUTE SETTINGS COPYBOOK                                     05210000
           COPY DPWS015.                                                05220000
      **FUNCTION KEYS COPYBOOK                                          05230000
           COPY DPWS016.                                                05240000
      **NUMERIC EDIT LAYOUT                                             05250000
           COPY DPWS010I.                                               05260000
      **PARAMETERS FOR CALLING THE CICS ARCHITECTURE API.               05270099
           COPY DPWS030.                                                05280000
CICS       COPY DPWS930.                                                05281099
      **STANDARD COMMAREA                                               05290000
           COPY DPWS020.                                                05300000
           05  FILLER REDEFINES DP020-VARIABLE-COMMAREA.                05310000
      *---------------------------------------------------------------* 05320000
      * INTER-APPLICATION COMMAREA.                                   * 05330000
      *   TFWS006 - IS THE INPUT LAYOUT WHEN COMING FROM THE          * 05340000
      *             RECEIVE TRANSFER SCREEN.                          * 05350000
      *---------------------------------------------------------------* 05360000
               10  INTER-APPL-COMM-AREA          PIC X(200).            05370000
           COPY TFWS006.                                                05380000
      *---------------------------------------------------------------* 05390000
      *  THIS IS THE APPLICATION-SPECIFIC COMMAREA.                   * 05400000
      *---------------------------------------------------------------* 05410000
               10  ASC-SPECIFIC-COMMAREA.                               05420000
                   15  ASC-XFER-NBR.                                    05430000
100404*                20  ASC-XFER-FR-STR       PIC 9(03).             05440000
100404                 20  ASC-XFER-FR-STR       PIC 9(04).             05441000
                       20  ASC-XFER-DASH-1       PIC X(01).             05450000
                       20  ASC-XFER-SEQ-NBR      PIC 9(06).             05460000
                       20  ASC-XFER-DASH-2       PIC X(01).             05470000
                       20  ASC-XFER-CHECK-DIGIT  PIC 9(01).             05480000
                   15  ASC-XFER-DKEY-ID          PIC S9(09)  COMP.      05490000
                   15  ASC-XFER-TYPE             PIC X(02).             05500000
                       88  ASC-NON-RETAIL-XFER    VALUE '06'.           05510000
111703*                88  ASC-RETAIL-XFER        VALUE  '01' THRU '05'.05520000
111703                 88  ASC-RETAIL-XFER        VALUE  '00' THRU '05'.05521000
                   15  ASC-CONTNR-TYPE           PIC X(02).             05530000
100404*            15  ASC-RCV-STORE-NBR         PIC 9(03).             05540000
100404             15  ASC-RCV-STORE-NBR         PIC 9(04).             05541000
100404*            15  ASC-TO-STORE-NBR          PIC 9(03).             05550000
100404             15  ASC-TO-STORE-NBR          PIC 9(04).             05551000
100404*            15  ASC-FR-STORE-NBR          PIC 9(03).             05560000
100404             15  ASC-FR-STORE-NBR          PIC 9(04).             05561000
                   15  ASC-CURRENT-TIMESTAMP     PIC X(26).             05570000
                   15  ASC-RECV-BY-INT           PIC X(01).             05580000
                   15  ASC-RECV-BY-NAM           PIC X(20).             05590000
                   15  ASC-CALLBACK-NBR          PIC X(04).             05600000
                   15  ASC-CALLBACK-NBR-N REDEFINES ASC-CALLBACK-NBR    05610000
                                                 PIC 9(04).             05620000
                   15  ASC-APPROVAL-NBR          PIC X(09).             05630000
                   15  ASC-APPROVAL-NBR-N REDEFINES ASC-APPROVAL-NBR    05640000
                                                 PIC 9(09).             05650000
                   15  ASC-CMP-LG-TOTE-SEAL1     PIC X(07).             05660000
                   15  ASC-CMP-LG-TOTE-SEAL2     PIC X(07).             05670000
                   15  ASC-CMP-SM-TOTE-SEAL      PIC X(07).             05680000
                   15  ASC-CMP-TRAILER-SEAL      PIC X(07).             05690000
                   15  ASC-CMP-TRAILER-NBR       PIC X(08).             05700000
                   15  ASC-LG-TOTE-SEAL1         PIC X(07).             05710000
                   15  ASC-LG-TOTE-SEAL2         PIC X(07).             05720000
                   15  ASC-SM-TOTE-SEAL          PIC X(07).             05730000
                   15  ASC-TRAILER-SEAL          PIC X(07).             05740000
                   15  ASC-TRAILER-NBR           PIC X(08).             05750000
                   15  ASC-ERROR-SW              PIC X(01).             05760000
                       88  ASC-NO-ERROR                    VALUE 'N'.   05770000
                       88  ASC-ERROR                       VALUE 'Y'.   05780000
                   15  ASC-WARNING-SW            PIC X(01).             05790000
                       88  ASC-NO-WARNING                  VALUE 'N'.   05800000
                       88  ASC-WARNING                     VALUE 'Y'.   05810000
                   15  ASC-RECEIVE-REQUEST-SW    PIC X(01).             05820000
                       88  ASC-RECEIVE-REQUEST             VALUE 'Y'.   05830000
                       88  ASC-NO-RECEIVE-REQUEST          VALUE 'N'.   05840000
                   15  ASC-FIRST-LINE-SW         PIC  X(01).            05850000
                       88  ASC-FIRST-LINE-XFERED           VALUE 'X'.   05860000
                       88  ASC-FIRST-LINE-ADDED            VALUE 'A'.   05870000
                   15  ASC-XFER-RECEIVE-SW       PIC  X(01).            05880000
                       88  ASC-XFER-IS-RECEIVED            VALUE 'Y'.   05890000
                       88  ASC-XFER-IS-NOT-RECEIVED        VALUE ' '.   05900000
                   15  ASC-ITEMS-LEFT-INDICATOR  PIC  X(01).            05910000
                       88  ASC-ITEMS-LEFT-ON-DB            VALUE 'Y'.   05920000
                       88  ASC-NO-ITEMS-LEFT-ON-DB         VALUE 'N'.   05930000
                   15  ASC-ITEMS-ADDED-SW        PIC X(01).             05940000
                       88  ASC-ITEMS-ADDED                 VALUE 'Y'.   05950000
                       88  ASC-NO-ITEMS-ADDED              VALUE 'N'.   05960000
                   15  ASC-ITEMS-RECEIVED-SW     PIC X(01).             05970000
                       88  ASC-ITEMS-RECEIVED              VALUE 'Y'.   05980000
                       88  ASC-NO-ITEMS-RECEIVED           VALUE 'N'.   05990000
                   15  ASC-BLOCK-ENTRIES OCCURS 2 TIMES.                06000000
                       20  ASC-BLOCK-MODIFIED-SW PIC X(01).             06010000
                           88  ASC-BLOCK-NOT-MODIFIED      VALUE 'N'.   06020000
                           88  ASC-BLOCK-MODIFIED          VALUE 'Y'.   06030000
                       20  ASC-ITEM-ARRAY.                              06040000
                           25  ASC-ITEM-ENTRIES OCCURS 15 TIMES.        06050000
                               30  ASC-LIST-ITEM-NUMBER    PIC S9(09)   06060000
                                                           COMP-3.      06070000
                               30  ASC-XFERED-ITEM-SW     PIC X(01).    06080000
                                   88  ASC-XFERED-ITEM      VALUE 'Y'.  06090000
                                   88  ASC-NOT-XFERED-ITEM  VALUE 'N'.  06100000
                               30  ASC-LINE      PIC 9(03).             06110000
                               30  ASC-TQTY      PIC S9(03) COMP-3.     06120000
                               30  ASC-RQTY      PIC X(03).             06130000
                               30  ASC-RQTY-N REDEFINES ASC-RQTY        06140000
                                                 PIC 9(03).             06150000
                               30  ASC-NRTL-DATA.                       06160000
                                   35  ASC-NRTL-DEPT       PIC X(03).   06170000
                                   35  ASC-NRTL-DESC.                   06180000
                                       40  ASC-NRTL-DESC1  PIC X(20).   06190000
                                       40  ASC-NRTL-DESC2  PIC X(20).   06200000
                                   35  ASC-FIXTURE         PIC X(20).   06210000
                               30  ASC-RTL-DATA REDEFINES ASC-NRTL-DATA.06220000
                                   35  ASC-DPT-CL-SUBCL.                06230000
                                       40  ASC-DEPT        PIC 9(03).   06240000
                                       40  ASC-CLASS       PIC 9(03).   06250000
                                       40  ASC-SUBCLASS    PIC 9(03).   06260000
051203                             35  ASC-UPC             PIC X(13).   06270000
051203                             35  ASC-UPC-X REDEFINES ASC-UPC.     06280000
051203                                 40 ASC-UPC-DIGITS-1-8  PIC X(08).06290000
051203                                 40 ASC-UPC-DIGITS-9-13 PIC X(05).06300000
051203                             35  ASC-UPC-XX REDEFINES ASC-UPC.    06310000
051203                                 40 ASC-UPC-DIGITS-1-5  PIC X(05).06320000
051203                                 40 ASC-UPC-DIGITS-6-13 PIC X(08).06330000
                                   35  ASC-UPC-N REDEFINES ASC-UPC      06340000
                                                           PIC 9(13).   06350000
                                   35  ASC-KOHLS-UPC       PIC S9(15)   06360000
                                                           COMP-3.      06370000
                                   35  ASC-TPRICE       PIC S9(05)V99   06380000
                                                           COMP-3.      06390000
                                   35  ASC-FPRICE       PIC S9(05)V99   06400000
                                                           COMP-3.      06410000
SR3403                             35  ASC-RPRICE          PIC X(08).   06421000
SR3403                             35  ASC-RPRICE-N REDEFINES ASC-RPRICE06441000
SR3403                                                     PIC 9(06)V99.06442000
                                   35  ASC-ITEM-NBR        PIC S9(15)   06450000
                                                              COMP-3.   06460000
                                   35  ASC-CUR-RTL-AMT PIC S9(05)V99    06470000
                                                              COMP-3.   06480000
                                   35  ASC-RNBR-SKU-IND    PIC X(01).   06490000
                                   35  ASC-STATUS-CODE     PIC 9(02).   06500000
                                   35  ASC-PRICE-ERROR-SW  PIC X(01).   06510000
                                       88  ASC-PRICE-ERROR  VALUE 'Y'.  06520000
                                       88  ASC-NO-PRICE-ERROR           06530000
                                                            VALUE 'N'.  06540000
                                   35  ASC-GROUP-PRICED-SW PIC X(01).   06550000
                                       88  ASC-GROUP-PRICED-ITEM        06560000
                                                            VALUE 'Y'.  06570000
                                       88  ASC-NOT-GROUP-PRICED-ITEM    06580000
                                                            VALUE 'N'.  06590000
                   15  ASC-BLK-SUB                         PIC S9(04)   06600000
                                                           COMP SYNC.   06610000
                   15  ASC-ITEM-SUB                        PIC S9(04)   06620000
                                                           COMP SYNC.   06630000
                   15  ASC-NUMBER-OF-ITEMS-READ            PIC S9(09)   06640000
                                                                COMP-3. 06650000
                   15  ASC-ITEMS-DISPLAYED                 PIC S9(03)   06660000
                                                                COMP-3. 06670000
                   15  ASC-ITEM-AT-TOP-OF-PANEL            PIC S9(09)   06680000
                                                                COMP-3. 06690000
                   15  ASC-ITEM-AT-BOT-OF-PANEL            PIC S9(09)   06700000
                                                                COMP-3. 06710000
                   15  ASC-HIGHEST-BLOCK-WRITTEN           PIC S9(04)   06720000
                                                           COMP SYNC.   06730000
                   15  ASC-TEMP-QUEUE-UPDATE-SW            PIC  X(01).  06740000
                       88  ASC-UPDATE-TSQ                  VALUE 'Y'.   06750000
                       88  ASC-NO-TSQ-UPDATE               VALUE ' '.   06760000
                   15  ASC-LIST-QUEUE-NAME.                             06770000
                       20  ASC-LIST-TERM-ID                PIC  X(04).  06780000
                       20  ASC-LIST-TASK-NUMBER            PIC S9(05)   06790000
                                                                COMP-3. 06800000
                       20  ASC-LIST-SEQ                    PIC  9(01).  06810000
                   15  ASC-SEL-QUEUE-NAME.                              06820000
                       20  ASC-SEL-TERM-ID                 PIC  X(04).  06830000
                       20  ASC-SEL-TASK-NUMBER             PIC S9(05)   06840000
                                                                COMP-3. 06850000
                       20  ASC-SEL-SEQ                     PIC  9(01).  06860000
                   15  ASC-START-ITEM-REQUEST.                          06870000
                       20  ASC-START-ITEM-REQUEST-N        PIC  9(05).  06880000
                   15  ASC-RCV-STR-OVRRID-IND      PIC  X(01).          06890000
                       88  ASC-RCV-STR-OVERRIDE      VALUE 'Y'.         06900000
                       88  ASC-NO-RCV-STR-OVERRIDE   VALUE 'N'.         06910000
                   15  ASC-CALLBACK-OVRRID-IND     PIC  X(01).          06920000
                       88  ASC-CALLBACK-OVERRIDE     VALUE 'Y'.         06930000
                       88  ASC-NO-CALLBACK-OVERRIDE  VALUE 'N'.         06940000
                   15  ASC-CALL-IC-IND             PIC  X(01).          06950000
                       88  ASC-CALL-INV-CONTROL      VALUE 'Y'.         06960000
                                                                        06970000
      **ABEND PROCESSING COPYBOOK                                       06980000
           COPY DPWS013.                                                06990000
      **UPC PARAMETER LIST FOR CALLING THE UPC CHECK DIGIT ROUTINE      07000000
           COPY DPWS040I.                                               07010000
      ***************************************************************** 07020000
      **TABLE INCLUSIONS                                                07030000
      ***************************************************************** 07040000
      **DB2 AREA FOR TRANSFER TABLE                                     07050000
           EXEC SQL                                                     07060000
                INCLUDE TTFMSTR                                         07070000
           END-EXEC.                                                    07080000
      **DB2 AREA FOR TRANSFER ITEM TABLE                                07090000
           EXEC SQL                                                     07100000
                INCLUDE TTFITEM                                         07110000
           END-EXEC.                                                    07120000
      **DB2 AREA FOR TRANSFER ITEM RECEIPT TABLE                        07130000
           EXEC SQL                                                     07140000
                INCLUDE TTFITRC                                         07150000
           END-EXEC.                                                    07160000
      **DB2 AREA FOR TRANSFER ITEM POSTING TABLE                        07170000
           EXEC SQL                                                     07180000
                INCLUDE TTFITPS                                         07190000
           END-EXEC.                                                    07200000
      **DB2 AREA FOR TRANSFER CUSTOMER TABLE                            07210000
           EXEC SQL                                                     07220000
                INCLUDE TTFCUST                                         07230000
           END-EXEC.                                                    07240000
      **DB2 AREA FOR TRANSFER STATUS TABLE                              07250000
           EXEC SQL                                                     07260000
                INCLUDE TTFSTAT                                         07270000
           END-EXEC.                                                    07280000
      **DB2 AREA FOR TRANSFER TYPE TABLE                                07290000
           EXEC SQL                                                     07300000
                INCLUDE TTFTYCD                                         07310000
           END-EXEC.                                                    07320000
      **DB2 AREA FOR TRANSFER RECEIPT TABLE                             07330000
           EXEC SQL                                                     07340000
                INCLUDE TTFRCPT                                         07350000
           END-EXEC.                                                    07360000
      **DB2 AREA FOR TRANSFER CONTAINER TYPE TABLE                      07370000
           EXEC SQL                                                     07380000
                INCLUDE TTFSHCT                                         07390000
           END-EXEC.                                                    07400000
      **DB2 AREA FOR TRANSFER DISCREPANCY TABLE                         07410000
           EXEC SQL                                                     07420000
                INCLUDE TTFDSCP                                         07430000
           END-EXEC.                                                    07440000
      **DB2 AREA FOR XST_SKU_LOC TABLE                                  07530000
           EXEC SQL                                                     07540000
                INCLUDE XST00008                                        07550000
           END-EXEC.                                                    07560000
      **DB2 AREA FOR XST_SKU TABLE                                      07560100
           EXEC SQL                                                     07560200
                INCLUDE XST00010                                        07560300
           END-EXEC.                                                    07560400
      **DB2 AREA FOR XST_UPC TABLE                                      07561000
           EXEC SQL                                                     07562000
                INCLUDE XST00012                                        07563000
           END-EXEC.                                                    07564000
      **DB2 AREA FOR PERMANENT PRICE CHANGE HISTORY TABLE               07690000
           EXEC SQL                                                     07700000
               INCLUDE TPPCPRC                                          07710000
           END-EXEC.                                                    07720000
      **DB2 AREA FOR SKU CROSS REFERENCE TABLE                          07730000
           EXEC SQL                                                     07740000
               INCLUDE TSKXREF                                          07750000
           END-EXEC.                                                    07760000
      **DB2 AREA FOR COMMUNICATIONS                                     07770000
           EXEC SQL                                                     07780000
                INCLUDE SQLCA                                           07790000
           END-EXEC.                                                    07800000
      *---------------------------------------------------------------* 07810000
      *CURSOR FOR TRANSFER ITEMS                                        07820000
      *---------------------------------------------------------------* 07830000
           EXEC SQL                                                     07840000
               DECLARE XFER_ITM_CSR CURSOR FOR                          07850000
                   SELECT  A.XFER_LNE_NBR                               07860000
                        ,  A.ITM_NBR                                    07870000
                        ,  A.XFER_PRIC_AMT                              07880000
                        ,  A.XFER_QTY                                   07890000
                   FROM    TTFITEM A                                    07900000
                   WHERE   A.XFER_DKEY_ID  =  :DK-XFER-DKEY-ID          07910000
                   ORDER BY XFER_LNE_NBR                                07920000
100404             WITH UR                                              07921000
           END-EXEC.                                                    07930000
      *---------------------------------------------------------------* 07940000
      *CURSOR TO RETRIEVE RETAIL TRANSFER ITEMS                         07950000
      *---------------------------------------------------------------* 07960000
           EXEC SQL                                                     07970000
                DECLARE RTL-ITEM-CSR CURSOR FOR                         07980000
                    SELECT A.XFER_LNE_NBR                               07990000
                         , A.CPLD_RTL_PRIC_AMT                          08000000
                         , A.KOHLS_UPC_NBR                              08010000
051203                   , A.SCN_UPC_NBR                                08020000
                         , A.ITM_NBR                                    08030000
                         , A.XFER_PRIC_AMT                              08040000
                         , A.XFER_QTY                                   08050000
                         , A.ITM_PRIC_MLT_IND                           08060000
                         , A.RNBR_SKU_IND                               08070000
                     FROM  TTFITEM  A                                   08080000
                     WHERE A.XFER_DKEY_ID     = :DK-XFER-DKEY-ID        08090000
                     ORDER BY XFER_LNE_NBR                              08100000
100404               WITH UR                                            08101000
                END-EXEC.                                               08110000
      *---------------------------------------------------------------* 08120000
      *    CURSOR TO RETRIEVE NON-RETAIL TRANSFER ITEMS               * 08130000
      *---------------------------------------------------------------* 08140000
           EXEC SQL                                                     08150000
                DECLARE NON-RTL-ITEM-CSR CURSOR FOR                     08160000
                    SELECT XFER_LNE_NBR                                 08170000
                         , NRTL_1ST_LNE_DESC                            08180000
                         , NRTL_2ND_LNE_DESC                            08190000
                         , NRTL_FIXT_ID                                 08200000
                         , NRTL_DEPT_NBR                                08210000
                         , XFER_QTY                                     08220000
                     FROM  TTFITEM                                      08230000
                     WHERE XFER_DKEY_ID     = :DK-XFER-DKEY-ID          08240000
                     ORDER BY XFER_LNE_NBR                              08250000
100404               WITH UR                                            08251000
           END-EXEC.                                                    08260000
      *---------------------------------------------------------------* 08270000
      * CURSOR TO RETRIEVE ALL RECEIPTS FOR AN ITEM                     08280000
      *---------------------------------------------------------------* 08290000
           EXEC SQL                                                     08300000
              DECLARE  RCPT_ITM_CSR CURSOR FOR                          08310000
                    SELECT  XFER_LNE_SEQ_NBR                            08320000
                          , RCVD_XFER_QTY                               08330000
                          , RCVD_XFER_PRIC_AMT                          08340000
                    FROM    TTFITRC                                     08350000
                    WHERE   XFER_DKEY_ID    =  :DK-XFER-DKEY-ID         08360000
                        AND XFER_LNE_NBR   =  :TFITEM-XFER-LNE-NBR      08370000
                        AND XFER_RCPT_TMST =  :PV-CURRENT-TIMESTAMP     08380000
                    ORDER BY XFER_LNE_SEQ_NBR                           08390000
100404               WITH UR                                            08391000
           END-EXEC.                                                    08400000
                                                                        08410000
       LINKAGE SECTION.                                                 08420000
      ******************************************************************08430000
       01  DFHCOMMAREA.                                                 08440000
           05  FILLER OCCURS  1 TO 4072 TIMES DEPENDING ON EIBCALEN.    08450000
               10  FILLER                     PIC X.                    08460000
                                                                        08470000
       PROCEDURE DIVISION.                                              08480000
       0000-MAIN-MODULE.                                                08490000
      ******************************************************************08500000
      *  THE FOLLOWING STATEMENT IS NECESSARY TO RESTORE THE COMMAREA   08510000
      *  BEFORE CALLING THE ARCHITECTURE PROGRAM TO DETERMINE WHICH MAP 08520000
      *  HAS TO BE DISPLAYED. THE MAPSET HAS MULTIPLE MAPS BUT DISPLAYS 08530000
      *  ONLY 1 AT A TIME AND THE ARCHITECTURE HAS NO FACILITY TO       08540000
      *  HANDLE THIS CONDITION.                                         08550000
      ******************************************************************08560000
                                                                        08570000
           IF EIBCALEN > ZERO                                           08580000
               MOVE DFHCOMMAREA          TO DP020-STANDARD-COMMAREA     08590000
           END-IF.                                                      08600000
                                                                        08610000
           INITIALIZE DP030-CICS-API-FIELDS.                            08620000
           MOVE +1                       TO DP030-NUMBER-OF-MAPS.       08630000
           MOVE PC-CURRENT-MAPSET-NAME   TO DP030-MAPSET-NAME.          08640000
           MOVE PV-CURRENT-MAP-NAME      TO DP030-MAP-NAME (1).         08650000
           SET DP030-RECEIVE-APPL-MAP    TO TRUE.                       08660000
                                                                        08670000
           IF ASC-NON-RETAIL-XFER                                       08680000
               MOVE PC-NON-RETAIL-ITEM-MAP-NAME TO DP030-MAP-NAME (1)   08690000
               MOVE LENGTH OF MR-B-NON-RETAIL TO DP030-MAP-LENGTH (1)   08700000
           ELSE                                                         08710000
               MOVE PC-RETAIL-ITEM-MAP-NAME   TO DP030-MAP-NAME (1)     08720000
               MOVE LENGTH OF MR-A-RETAIL     TO DP030-MAP-LENGTH (1)   08730000
           END-IF.                                                      08740000
                                                                        08750000
           MOVE 'PROGRAM ENTRY CALL'     TO DP013-MESSAGE-TEXT (1).     08760000
           PERFORM 0001-CALL-CICS-ARCH-API.                             08770000
                                                                        08780000
           PERFORM 1000-CONTROL-PROCESSING                              08790000
                                                                        08800000
           MOVE 'PROGRAM EXIT CALL'      TO DP013-MESSAGE-TEXT (1).     08810000
           PERFORM 0001-CALL-CICS-ARCH-API.                             08820000
                                                                        08830000
       EJECT.                                                           08840000
      ******************************************************************08850000
      **  THIS PARAGRAPH CALLS THE CICS ARCHITECTURE API SUBROUTINE   **08860000
      **  AND WILL ABEND IF ANY ERRORS OCCURRED IN THAT CALL.         **08870000
      ******************************************************************08880000
       0001-CALL-CICS-ARCH-API.                                         08890000
                                                                        08900000
           MOVE '0001-CALL-CICS-ARCH-API'  TO DP013-PARAGRAPH.          08910000
                                                                        08920000
CICS       CALL DP930-CICS-ARCH-API USING DFHEIBLK                      08930099
                                          DFHCOMMAREA                   08940099
                                          DP030-CICS-API-FIELDS         08950099
                                          DP020-STANDARD-COMMAREA       08960099
                                          MD-MAP-DATA-AREA.             08970099
                                                                        08980000
           IF  DP030-RC-CALL-SUCCESSFUL                                 08990000
               CONTINUE                                                 09000000
           ELSE                                                         09010000
               SET DP013-NO-ROLLBACK                                    09020000
                   DP013-XCTL-DISPLAY-RESTART                           09030000
                   DP013-CICS-ABEND      TO TRUE                        09040000
CICS           MOVE 'CALL TO CICS ARCH API NOT SUCCESSFUL, RETURN-CODE O09041099
CICS  -             'N NEXT LINE'        TO DP013-MESSAGE-TEXT (2)      09042099
               MOVE DP030-RETURN-CODE    TO DP013-MESSAGE-TEXT (3)      09070000
               PERFORM DP013-0000-PROCESS-ABEND                         09080000
           END-IF.                                                      09090000
                                                                        09100000
       EJECT.                                                           09110000
      *----------------------------------------------------------------*09120000
      * PROCESS THE APPROPRIATE PARAGRAPHS BASED ON WHAT THE NEXT      *09130000
      * COURSE OF ACTION IS FOR THIS TRANSACTION.                      *09140000
      *----------------------------------------------------------------*09150000
       1000-CONTROL-PROCESSING.                                         09160000
                                                                        09170000
           MOVE '1000-CONTROL-PROCESSING' TO DP013-PARAGRAPH.           09180000
                                                                        09190000
           EVALUATE TRUE                                                09200000
               WHEN DP020-NEXT-ACT-INITIAL                              09210000
                   INITIALIZE ASC-SPECIFIC-COMMAREA                     09220000
                   MOVE EIBTRMID         TO ASC-LIST-TERM-ID            09230000
                   MOVE DP020-SRC-TASK-NUMBER TO ASC-LIST-TASK-NUMBER   09240000
                   MOVE PC-LIST-QUEUE-SEQ     TO ASC-LIST-SEQ           09250000
                   PERFORM 1100-PROCESS-INTER-APPL-COMM                 09260000
      ***-----$TEMPLATE NOTE$-------------------------------------------09270000
      *** IF THE DATA EXPECTED IS NOT RECEIVED FROM CALLING APPLICATION,09280000
      *** SETUP APPROPRIATE MESSAGE AND SEVERITY AND SET APPL-ERROR TO  09290000
      *** TRUE, THIS WILL RETURN TO CALLING APPLICATION WHEN API CALLED.09300000
      ***---------------------------------------------------------------09310000
                   IF  PS-COMMAREA-NOT-VALID                            09320000
                       SET DP020-NEXT-ACT-APPL-ERROR TO TRUE            09330000
                   ELSE                                                 09340000
                       PERFORM 4000-BUILD-INITIAL-PANEL                 09350000
                   END-IF                                               09360000
               WHEN DP020-NEXT-ACT-READ-MAP                             09370000
                   MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         09380000
                   PERFORM 2000-PROCESS-PANEL                           09390000
               WHEN DP020-NEXT-ACT-RETURN                               09400000
                   SET ASC-NO-RECEIVE-REQUEST TO TRUE                   09410000
                   MOVE ASC-ITEM-AT-TOP-OF-PANEL TO PV-TOP-ITEM         09420000
                   MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    09430000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   09440000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 09450000
               WHEN OTHER                                               09460000
                   SET DP013-LOGIC-ABEND TO TRUE                        09470000
                   SET DP013-NO-ROLLBACK TO TRUE                        09480000
                   MOVE 'INVALID NEXT APPLICATION ACTIVITY RECEIVED'    09490000
                                         TO DP013-MESSAGE-TEXT(1)       09500000
                   PERFORM DP013-0000-PROCESS-ABEND                     09510000
           END-EVALUATE.                                                09520000
                                                                        09530000
       EJECT.                                                           09540000
      *----------------------------------------------------------------*09550000
      * MOVE DATA FROM THE INTER-APPLICATION COMMAREA TO SPECIFIC      *09560000
      * COMMAREA. READ THE TRANSFER MASTER.                            *09570000
      *----------------------------------------------------------------*09580000
       1100-PROCESS-INTER-APPL-COMM.                                    09590000
                                                                        09600000
           SET PS-COMMAREA-VALID         TO TRUE.                       09610000
           MOVE SPACE                    TO ASC-START-ITEM-REQUEST.     09620000
           MOVE TF006-XFER-NBR           TO PV-XFER-NBR.                09630000
           MOVE TF006-XFER-TYPE          TO ASC-XFER-TYPE.              09640000
           MOVE TF006-CONTNR-TYPE        TO ASC-CONTNR-TYPE.            09650000
           MOVE PV-XFER-FR-STR           TO ASC-XFER-FR-STR.            09660000
           MOVE PV-XFER-SEQ-NBR          TO ASC-XFER-SEQ-NBR.           09670000
           MOVE TF006-CHECK-DIGIT        TO ASC-XFER-CHECK-DIGIT        09680000
           MOVE '-'                      TO ASC-XFER-DASH-1             09690000
                                            ASC-XFER-DASH-2.            09700000
           MOVE TF006-DKEY-ID            TO DK-XFER-DKEY-ID             09710000
                                            ASC-XFER-DKEY-ID.           09720000
           MOVE TF006-LG-TTE-1ST-SEAL-ID TO ASC-LG-TOTE-SEAL1.          09730000
           MOVE TF006-LG-TTE-2ND-SEAL-ID TO ASC-LG-TOTE-SEAL2.          09740000
           MOVE TF006-SM-TTE-BAG-SEAL-ID TO ASC-SM-TOTE-SEAL.           09750000
           MOVE TF006-TRLR-SEAL-ID       TO ASC-TRAILER-SEAL.           09760000
           MOVE TF006-TRLR-NBR           TO ASC-TRAILER-NBR.            09770000
           MOVE TF006-XFER-RECV-BY-FIRST-INIT                           09780000
                                         TO ASC-RECV-BY-INT.            09790000
           MOVE TF006-XFER-RECV-BY-LAST-NAME                            09800000
                                         TO ASC-RECV-BY-NAM.            09810000
           MOVE TF006-RCV-XFER-BEG-TMST  TO ASC-CURRENT-TIMESTAMP.      09820000
                                                                        09830000
           IF TF006-RCV-STR-OVERRIDE                                    09840000
               SET ASC-RCV-STR-OVERRIDE  TO TRUE                        09850000
           ELSE                                                         09860000
               SET ASC-NO-RCV-STR-OVERRIDE  TO TRUE                     09870000
           END-IF.                                                      09880000
                                                                        09890000
           MOVE TF006-RCV-STR-NBR        TO ASC-RCV-STORE-NBR.          09900000
           MOVE TF006-CALL-IC-IND        TO ASC-CALL-IC-IND.            09910000
                                                                        09920000
           IF TF006-CALLBACK-OVERRIDE                                   09930000
               SET ASC-CALLBACK-OVERRIDE  TO TRUE                       09940000
               MOVE TF006-CALLBACK-NBR       TO ASC-CALLBACK-NBR-N      09950000
           ELSE                                                         09960000
               SET ASC-NO-CALLBACK-OVERRIDE  TO TRUE                    09970000
           END-IF.                                                      09980000
                                                                        09990000
       EJECT.                                                           10000000
      *----------------------------------------------------------------*10010000
      * DO ANY PROCESSING FOR KEYS FOR WHICH NO EDITTING OF THE DATA   *10020000
      * ON THE SCREEN NEEDS TO BE DONE.  IF ONE OF THOSE KEYS IS NOT   *10030000
      * USED, EDIT THE DATA ON THE SCREEN AND GO ON TO CHECK THE REST  *10040000
      * OF THE FUNCTION KEYS.  NOTE THAT WITH THE API, NO INVALID      *10050000
      * FUNCTION KEYS CAN GET THIS FAR.                                *10060000
      *----------------------------------------------------------------*10070000
       2000-PROCESS-PANEL.                                              10080000
                                                                        10090000
             EVALUATE TRUE                                              10100000
               WHEN DP020-FK-REFRESH (DP020-SRC-AID)                    10110000
                   SET ASC-NO-RECEIVE-REQUEST TO TRUE                   10120000
                   MOVE ASC-XFER-DKEY-ID TO DK-XFER-DKEY-ID             10130000
                   PERFORM 2050-DELETE-LIST-QUEUE                       10140000
                   PERFORM 4000-BUILD-INITIAL-PANEL                     10150000
               WHEN DP020-SRC-AID = DP016-CLEAR                         10160000
                   SET ASC-NO-RECEIVE-REQUEST TO TRUE                   10170000
                   MOVE ZERO             TO ASC-ITEM-AT-TOP-OF-PANEL    10180000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10190000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 10200000
               WHEN OTHER                                               10210000
                   IF ASC-RETAIL-XFER                                   10220000
                       PERFORM 2200-MOVE-RETAIL-SCREEN                  10230000
                   ELSE                                                 10240000
                       PERFORM 2250-MOVE-NON-RETAIL-SCREEN              10250000
                   END-IF                                               10260000
                   PERFORM 3000-EDIT-DATA-IN-COMMAREA                   10270000
                   IF  ASC-NO-ERROR                                     10280000
                       SET DP030-CONTINUE-GO TO TRUE                    10290000
                       PERFORM 2100-CHECK-FUNCTION-KEY                  10300000
                   ELSE                                                 10310000
                       SET DP030-OVERRIDE-GO TO TRUE                    10320000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             10330000
                   END-IF                                               10340000
             END-EVALUATE.                                              10350000
                                                                        10360000
       EJECT.                                                           10370000
      *----------------------------------------------------------------*10380000
      *  DELETE THE LIST ITEMS TEMP STORAGE QUEUE.                     *10390000
      *----------------------------------------------------------------*10400000
       2050-DELETE-LIST-QUEUE.                                          10410000
                                                                        10420000
           MOVE '2050-DELETE-LIST-QUEUE' TO DP013-PARAGRAPH.            10430000
                                                                        10440000
           EXEC CICS                                                    10450000
               DELETEQ TS                                               10460000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          10470000
                   RESP  (PV-CICS-RESP)                                 10480000
           END-EXEC.                                                    10490000
                                                                        10500000
           IF (PV-CICS-RESP = DFHRESP(NORMAL)) OR                       10510000
              (PV-CICS-RESP = DFHRESP(QIDERR))                          10520000
               CONTINUE                                                 10530000
           ELSE                                                         10540000
               SET DP013-CICS-ABEND      TO TRUE                        10550000
               SET DP013-NO-ROLLBACK     TO TRUE                        10560000
               MOVE 'ERROR TRYING TO DELETE LIST TEMP STORAGE QUEUE'    10570000
                                         TO DP013-MESSAGE-TEXT (1)      10580000
               PERFORM DP013-0000-PROCESS-ABEND                         10590000
           END-IF.                                                      10600000
                                                                        10610000
           MOVE +0                       TO ASC-HIGHEST-BLOCK-WRITTEN.  10620000
                                                                        10630000
       EJECT.                                                           10640000
      *----------------------------------------------------------------*10650000
      * ACT ON ANY FUNCTION KEYS THAT REQUIRE EDITS TO BE PASSED FIRST.*10660000
      * NOTE THAT INVALID FUNCTION KEYS WILL NOT BE RETURNED FROM THE  *10670000
      * CICS ARCHITECTURE API.                                         *10680000
      *----------------------------------------------------------------*10690000
       2100-CHECK-FUNCTION-KEY.                                         10700000
                                                                        10710000
           MOVE '2100-CHECK-FUNCTION-KEY' TO DP013-PARAGRAPH.           10720000
                                                                        10730000
           EVALUATE TRUE                                                10740000
      *---  RECEIVE  -----------------------------------------------*   10750000
               WHEN DP020-FK-LOCAL-FUNC-02 (DP020-SRC-AID)              10760000
                   IF ASC-RECEIVE-REQUEST                               10770000
                       MOVE ASC-XFER-DKEY-ID  TO DK-XFER-DKEY-ID        10780000
                       PERFORM 7000-SELECT-MAX-RCPT-TMST                10790000
                       IF PV-NULL-IND IS NOT NEGATIVE                   10800000
                           IF TFRCPT-RCV-XFER-BEG-TMST NOT =            10810000
                                                 ASC-CURRENT-TIMESTAMP  10820000
      * -- SOMEONE ELSE HAS TRIED TO RECEIVE THE TRANSFER SINCE THE     10830000
      * -- INTERMEDIATE RECEIPT ROW WAS INSERTED; DELETE THE 'IR'       10840000
      * -- STATUS AND THE CURRENT RECEIPT ROW, AND INSERT NEW ONES WITH 10850000
      * -- THE CURRENT TIMESTAMP                                        10860000
                               PERFORM 7800-DELETE-IR-STATUS            10870000
                               PERFORM 7810-DELETE-CURRENT-RECEIPT      10880000
                               SET PS-INSERT-STATUS  TO TRUE            10890000
                               PERFORM 7010-SELECT-CURRENT-TIMESTAMP    10900000
                           ELSE                                         10910000
      * -- THE INSERTED 'IR' IS THE MOST CURRENT, USE THE BEGINNING     10920000
      * -- TIMESTAMP FROM THAT ROW AS THE TIMESTAMP FOR THE RECEIPT     10930000
                               SET PS-UPDATE-STATUS  TO TRUE            10940000
                               MOVE ASC-CURRENT-TIMESTAMP TO            10950000
                                                PV-CURRENT-TIMESTAMP    10960000
                           END-IF                                       10970000
                       ELSE                                             10980000
      * -- IF FOR SOME REASON, THE CURRENT RECEIPT ROW WAS NOT FOUND,   10990000
      * -- DELETE THE 'IR' STATUS AND INSERT NEW STATUS & RECEIPT ROWS  11000000
                           PERFORM 7800-DELETE-IR-STATUS                11010000
                           SET PS-INSERT-STATUS    TO TRUE              11020000
                           PERFORM 7010-SELECT-CURRENT-TIMESTAMP        11030000
                       END-IF                                           11040000
                       SET PS-NO-DISCREPANCY-EXISTS                     11050000
                           PS-NO-SEAL-DISCREPANCY-EXISTS                11060000
                           PS-NO-STORE-DISCREPANCY-EXISTS  TO TRUE      11070000
                       PERFORM 5000-CHECK-SEAL-DISCREPANCY              11080000
                       IF PS-SEAL-DISCREPANCY-EXISTS    OR              11090000
                          ASC-RCV-STORE-NBR NOT = ASC-TO-STORE-NBR      11100000
                           PERFORM 7200-INSERT-DISCREPANCY-ROW          11110000
                           SET PS-DISCREPANCY-EXISTS    TO TRUE         11120000
                           MOVE PC-YES   TO TFRCPT-XFER-DSCRP-IND       11130000
                       ELSE                                             11140000
                           SET PS-NO-DISCREPANCY-EXISTS  TO TRUE        11150000
                           MOVE PC-NO    TO TFRCPT-XFER-DSCRP-IND       11160000
                       END-IF                                           11170000
                       IF ASC-RETAIL-XFER                               11180000
                           PERFORM 6500-CHK-ASSUMPTIVE-RECEIPT          11190000
                       END-IF                                           11200000
                       PERFORM 6000-RECEIVE-XFER                        11210000
                       IF   ASC-RETAIL-XFER                             11220000
                        AND (PS-ITEM-DISCREPANCY-EXISTS                 11230000
                          OR PS-STORE-DISCREPANCY-EXISTS                11240000
                          OR PS-SEAL-DISCREPANCY-EXISTS)                11250000
                           IF ASC-CALL-INV-CONTROL                      11260000
                               MOVE PC-TSYMSG-01678 TO DP020-MSG-NUMBER 11270000
                           ELSE                                         11280000
                               MOVE PC-TSYMSG-01508 TO DP020-MSG-NUMBER 11290000
                           END-IF                                       11300000
                           SET DP020-MSG-WARNING  TO TRUE               11310000
                           INITIALIZE TF005-COMMAREA                    11320000
080204                     MOVE ASC-RCV-STORE-NBR TO RFWS009-STORE-NBR  11330000
SR3403                     PERFORM 2105-FILL-PRINTER-DEST               11330100
SR3403*                    MOVE RFWS009-STORE-PRINTER-DEST              11331000
SR3403*                                           TO TF005-PRINTER-DEST 11332000
                           MOVE ASC-XFER-FR-STR                         11360000
                                          TO TF005-XFER-FROM-STORE-NBR  11370000
                           MOVE ASC-XFER-SEQ-NBR  TO TF005-XFER-SEQ-NBR 11380000
                           MOVE DP020-USERID      TO TF005-USER-ID      11390000
                           EXEC CICS                                    11400000
                              START TRANSID ('P455')                    11410000
                              FROM    (TF005-COMMAREA)                  11420000
                           END-EXEC                                     11430000
                       ELSE                                             11440000
                           IF ASC-CALL-INV-CONTROL                      11450000
                               MOVE PC-TSYMSG-01677 TO DP020-MSG-NUMBER 11460000
                               SET DP020-MSG-WARNING       TO TRUE      11470000
                           ELSE                                         11480000
                               MOVE PC-TSYMSG-01507 TO DP020-MSG-NUMBER 11490000
                               SET DP020-MSG-INFORMATIONAL TO TRUE      11500000
                           END-IF                                       11510000
                       END-IF                                           11520000
                   ELSE                                                 11530000
                       SET ASC-RECEIVE-REQUEST TO TRUE                  11540000
                       SET DP030-SET-CURSOR-TRAILER  TO TRUE            11550000
                       SET DP030-OVERRIDE-GO      TO TRUE               11560000
                       MOVE 'F23-RECEIVE'         TO DP020-MSG-TEXT     11570000
                       IF ASC-NO-ITEMS-RECEIVED                         11580000
                           MOVE PC-TSYMSG-01642   TO DP020-MSG-NUMBER   11590000
                           SET DP020-MSG-WARNING  TO TRUE               11600000
                       ELSE                                             11610000
                           MOVE PC-TSYMSG-01403  TO DP020-MSG-NUMBER    11620000
                           SET DP020-MSG-INFORMATIONAL TO TRUE          11630000
                       END-IF                                           11640000
                       PERFORM 4400-MOVE-COMMAREA-TO-SCREEN             11650000
                   END-IF                                               11660000
               WHEN DP020-FK-FIRST-PAGE(DP020-SRC-AID)                  11670000
                   SET ASC-NO-RECEIVE-REQUEST TO TRUE                   11680000
                   MOVE +1               TO PV-TOP-ITEM                 11690000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11700000
               WHEN DP020-FK-PREV-PAGE(DP020-SRC-AID)                   11710000
                   SET ASC-NO-RECEIVE-REQUEST TO TRUE                   11720000
                   PERFORM 2110-BROWSE-BACKWARD                         11730000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11740000
               WHEN DP020-FK-NEXT-PAGE(DP020-SRC-AID)                   11750000
                   SET ASC-NO-RECEIVE-REQUEST TO TRUE                   11760000
                   PERFORM 2120-BROWSE-FORWARD                          11770000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11780000
               WHEN DP020-SRC-AID = DP016-ENTER                         11790000
                   SET ASC-NO-RECEIVE-REQUEST TO TRUE                   11800000
                   PERFORM 2130-CHECK-FOR-JUMP-BROWSE                   11810000
                   PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                 11820000
               WHEN OTHER                                               11830000
                   SET DP013-NO-ROLLBACK                                11840000
                       DP013-XCTL-DISPLAY-RESTART                       11850000
                       DP013-CICS-ABEND  TO TRUE                        11860000
                   MOVE 'INVALID FUNCTION KEY NOT CAPTURED BY API'      11870000
                                         TO DP013-MESSAGE-TEXT (1)      11880000
                   PERFORM DP013-0000-PROCESS-ABEND                     11890000
           END-EVALUATE.                                                11900000
                                                                        11910000
       EJECT.                                                           11920000
SR3403******************************************************************11921000
SR3403*    DETERMINE WHAT REGION IF TEST USE TEST PRINTER               11922000
SR3403******************************************************************11923000
SR3403 2105-FILL-PRINTER-DEST.                                          11924000
SR3403                                                                  11925000
SR3403     EXEC CICS                                                    11926000
SR3403       ASSIGN                                                     11927000
SR3403       APPLID (PV-CICS-APPL-ID)                                   11928000
SR3403     END-EXEC.                                                    11929000
SR3403                                                                  11929100
SR3403     EVALUATE TRUE                                                11929200
SR3403       WHEN PV-CR-PRODUCTION                                      11929300
SR3403           MOVE RFWS009-STORE-PRINTER-DEST                        11929400
SR3403                TO TF005-PRINTER-DEST                             11929500
SR3403       WHEN OTHER                                                 11929600
SR3403           MOVE 'U4106' TO  TF005-PRINTER-DEST                    11929700
SR3403     END-EVALUATE.                                                11929800
                                                                        11929900
      *----------------------------------------------------------------*11930000
      *    IF THE USER HITS THE PAGE BACKWARD KEY, COMPUTE THE TOP     *11940000
      *    ITEM NUMBER FOR THE NEW PAGE.  IF IT IS ABOVE THE TOP,      *11950000
      *    SET THE TOP ITEM NUMBER TO +1 AND DISPLAY THE TOP OF LIST   *11960000
      *    MESSAGE.                                                    *11970000
      *----------------------------------------------------------------*11980000
       2110-BROWSE-BACKWARD.                                            11990000
                                                                        12000000
           SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-AT-TOP-OF-PANEL    12010000
               GIVING PV-TOP-ITEM.                                      12020000
                                                                        12030000
           IF  ((PV-TOP-ITEM < +1)                                      12040000
             OR (PV-TOP-ITEM = +1))                                     12050000
               MOVE +1                   TO PV-TOP-ITEM                 12060000
      *        -- TOP OF LIST --                                        12070000
               MOVE PC-TSYMSG-00069      TO DP020-MSG-NUMBER            12080000
               SET DP020-MSG-INFORMATIONAL TO TRUE                      12090000
           END-IF.                                                      12100000
                                                                        12110000
       EJECT.                                                           12120000
      *----------------------------------------------------------------*12130000
      *    IF THE USER HITS THE PAGE FORWARD KEY, COMPUTE THE TOP      *12140000
      *    ITEM NUMBER FOR THE NEW PAGE.  IF THE USER ATTEMPTS TO GO   *12150000
      *    PAST THE END, ISSUE THE BOTTOM OF LIST MESSAGE.             *12160000
      *----------------------------------------------------------------*12170000
       2120-BROWSE-FORWARD.                                             12180000
                                                                        12190000
           ADD PC-ITEMS-PER-PANEL ASC-ITEM-AT-TOP-OF-PANEL              12200000
               GIVING PV-TOP-ITEM.                                      12210000
                                                                        12220000
           IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ + 1               12230000
               MOVE ASC-ITEM-AT-TOP-OF-PANEL                            12240000
                                         TO PV-TOP-ITEM                 12250000
      *        -- BOTTOM OF LIST --                                     12260000
               MOVE PC-TSYMSG-00070      TO DP020-MSG-NUMBER            12270000
               SET DP020-MSG-INFORMATIONAL                              12280000
                                         TO TRUE                        12290000
           ELSE                                                         12300000
               IF  PV-TOP-ITEM > ASC-NUMBER-OF-ITEMS-READ               12310000
                   MOVE ASC-ITEM-AT-BOT-OF-PANEL                        12320000
                                         TO PV-TOP-ITEM                 12330000
               ELSE                                                     12340000
                   COMPUTE PV-BOTTOM-ITEM =                             12350000
                       PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1             12360000
                   IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ        12370000
      *            -- BOTTOM OF LIST --                                 12380000
                       MOVE PC-TSYMSG-00070  TO DP020-MSG-NUMBER        12390000
                       SET DP020-MSG-INFORMATIONAL                      12400000
                                         TO TRUE                        12410000
                   END-IF                                               12420000
               END-IF                                                   12430000
           END-IF.                                                      12440000
                                                                        12450000
       EJECT.                                                           12460000
      *----------------------------------------------------------------*12470000
      *    THE USER CAN CHANGE THE CURRENT BEGINNING LIST NUMBER SO    *12480000
      *    THAT THE TRANSACTION WILL JUMP TO THAT POINT IN THE LIST.   *12490000
      *    THIS IS A FASTER WAY TO GET TO A CERTAIN POINT IN THE LIST  *12500000
      *    RATHER THAN HITTING NEXT-PAGE TO GET TO THAT POINT.         *12510000
      *    THE NEW LIST NUMBER ENTERED IS EDITED TO MAKE SURE THAT     *12520000
      *    IT IS NUMERIC AND FALLS BETWEEN A SPECIFIED RANGE.          *12530000
      *----------------------------------------------------------------*12540000
       2130-CHECK-FOR-JUMP-BROWSE.                                      12550000
                                                                        12560000
           SET ASC-NO-ERROR              TO TRUE.                       12570000
           IF (ASC-START-ITEM-REQUEST = SPACE)                          12580000
               MOVE ASC-ITEM-AT-TOP-OF-PANEL  TO PV-TOP-ITEM            12590000
           ELSE                                                         12600000
               MOVE ASC-START-ITEM-REQUEST    TO DP010I-UNEDITED-FIELD  12610000
               MOVE PC-MSG-NUMBER-LENGTH      TO DP010I-MAXIMUM-DIGITS  12620000
               MOVE +0                        TO DP010I-MAXIMUM-DECIMALS12630000
               SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE                  12640000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         12651099
                         USING DP010I-NUMERIC-EDIT-AREA                 12652099
                                                                        12660000
               IF  NOT DP010I-ERROR-DETECTED                            12670000
                   MOVE DP010I-NUMERIC-FIELD TO ASC-START-ITEM-REQUEST-N12680000
                   IF  ASC-START-ITEM-REQUEST-N > ZERO                  12690000
                       IF  ASC-START-ITEM-REQUEST-N >                   12700000
                                                ASC-NUMBER-OF-ITEMS-READ12710000
                           MOVE SPACE TO ASC-START-ITEM-REQUEST         12720000
                           COMPUTE PV-TOP-ITEM =                        12730000
                                   ASC-NUMBER-OF-ITEMS-READ             12740000
                                   - PC-ITEMS-PER-PANEL + 1             12750000
                           IF  PV-TOP-ITEM < +1                         12760000
                               MOVE +1   TO PV-TOP-ITEM                 12770000
                               MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 12780000
                               SET DP020-MSG-INFORMATIONAL TO TRUE      12790000
                           END-IF                                       12800000
                       ELSE                                             12810000
                           MOVE ASC-START-ITEM-REQUEST-N                12820000
                                         TO PV-TOP-ITEM                 12830000
                           MOVE SPACE    TO ASC-START-ITEM-REQUEST      12840000
                           COMPUTE PV-BOTTOM-ITEM =                     12850000
                               PV-TOP-ITEM + PC-ITEMS-PER-PANEL - 1     12860000
                           IF  PV-BOTTOM-ITEM > ASC-NUMBER-OF-ITEMS-READ12870000
      *                        -- BOTTOM OF LIST --                     12880000
                               MOVE PC-TSYMSG-00070 TO DP020-MSG-NUMBER 12890000
                               SET DP020-MSG-INFORMATIONAL TO TRUE      12900000
                           END-IF                                       12910000
                       END-IF                                           12920000
                   ELSE                                                 12930000
      *                --- VALUE OUT OF RANGE ----                      12940000
                       MOVE PC-TSYMSG-00101        TO DP020-MSG-NUMBER  12950000
                       MOVE -1                     TO MR-B-STARTL       12960000
                       SET DP030-SET-CURSOR-APPL-1 TO TRUE              12970000
                       MOVE DP015-REVERSE          TO MR-B-STARTH       12980000
                       MOVE DP015-RED              TO MR-B-STARTC       12990000
                       MOVE DP015-UNP-NUM-BRT-MDT  TO MR-B-STARTA       13000000
                       SET DP020-MSG-FATAL         TO TRUE              13010000
                       SET ASC-ERROR               TO TRUE              13020000
                   END-IF                                               13030000
               ELSE                                                     13040000
                   MOVE PC-TSYMSG-00008  TO DP020-MSG-NUMBER            13050000
                   MOVE -1               TO MR-B-STARTL                 13060000
                   SET DP030-SET-CURSOR-APPL-1 TO TRUE                  13070000
                   MOVE DP015-REVERSE    TO MR-B-STARTH                 13080000
                   MOVE DP015-RED        TO MR-B-STARTC                 13090000
                   MOVE DP015-UNP-NUM-BRT-MDT                           13100000
                                         TO MR-B-STARTA                 13110000
                   SET DP020-MSG-FATAL   TO TRUE                        13120000
                   SET ASC-ERROR         TO TRUE                        13130000
               END-IF                                                   13140000
           END-IF.                                                      13150000
                                                                        13160000
       EJECT.                                                           13170000
      *----------------------------------------------------------------*13180000
      * CHECK THE STATUS OF THE TRANSFER. IF SOMEONE ELSE STARTS TO     13190000
      * RECEIVE THIS SAME TRANSFER ON A PTC, WE WANT TO PREVENT THE     13200000
      * RECEIPT ON THE 3270 SCREEN.                                     13210000
      *----------------------------------------------------------------*13220000
       2140-CHK-XFER-STATUS.                                            13230000
                                                                        13240000
           PERFORM 7110-SELECT-MAX-STAT-TMST.                           13250000
           PERFORM 7100-SELECT-CURRENT-STATUS.                          13260000
                                                                        13270000
           EVALUATE TFSTAT-XFER-STAT-CDE                                13280000
               WHEN PC-COMPLETED                                        13290000
               WHEN PC-INTERMEDIATELY-RECEIVED                          13300000
               WHEN PC-ASSUMPTIVELY-RECEIVED                            13310000
                   CONTINUE                                             13320000
               WHEN OTHER                                               13330000
                   SET  DP020-MSG-FATAL                                 13340000
                        DP030-OVERRIDE-GO                               13350000
                        ASC-ERROR              TO  TRUE                 13360000
                   MOVE PC-TSYMSG-01520        TO  DP020-MSG-NUMBER     13370000
           END-EVALUATE.                                                13380000
                                                                        13390000
       EJECT.                                                           13400000
      ***************************************************************** 13410000
       2150-CHK-XFER-IN-USE.                                            13420000
                                                                        13430000
           PERFORM 7000-SELECT-MAX-RCPT-TMST.                           13440000
                                                                        13450000
           IF PV-NULL-IND IS NOT NEGATIVE                               13460000
               PERFORM 7020-SELECT-CURRENT-RCPT                         13470000
               IF TFRCPT-RCV-XFER-BEG-TMST  =  TFRCPT-RCV-XFER-END-TMST 13480000
                   SET  DP020-MSG-FATAL                                 13490000
                        DP030-OVERRIDE-GO                               13500000
                        ASC-ERROR              TO  TRUE                 13510000
                   MOVE PC-TSYMSG-01520  TO  DP020-MSG-NUMBER           13520000
               END-IF                                                   13530000
           END-IF.                                                      13540000
                                                                        13550000
       EJECT.                                                           13560000
      ******************************************************************13570000
      ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **13580000
      ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **13590000
      **           NON-RETAIL TRANSFERS                               **13600000
      ******************************************************************13610000
       2200-MOVE-RETAIL-SCREEN.                                         13620000
                                                                        13630000
           MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             13640000
           MOVE +1                       TO PV-SUB.                     13650000
                                                                        13660000
           PERFORM 3100-SET-SUBSCRIPTS.                                 13670000
           IF  MR-A-STARTL > ZERO                                       13680000
               MOVE MR-A-START       TO ASC-START-ITEM-REQUEST          13690000
           ELSE                                                         13700000
               IF  MR-A-STARTA = DP015-ERASE-EOF                        13710000
                   INITIALIZE ASC-START-ITEM-REQUEST                    13720000
               END-IF                                                   13730000
           END-IF.                                                      13740000
                                                                        13750000
           PERFORM 2210-MOVE-LINES-TO-COMMAREA                          13760000
                   VARYING PV-SUB                                       13770000
                   FROM 1 BY 1                                          13780000
                   UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                  13790000
           PERFORM 2220-MOVE-LINES-TO-COMMAREA                          13800000
                   VARYING PV-SUB                                       13810000
                   FROM PV-SUB BY 1                                     13820000
                   UNTIL PV-SUB > PC-ITEMS-PER-PANEL.                   13830000
                                                                        13840000
       EJECT.                                                           13850000
      ******************************************************************13860000
      * MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA  *13870000
      * FOR ITEMS THAT WERE ON THE COMPLETED TRANSFER. (RETAIL TRANSFER 13880000
      ******************************************************************13890000
       2210-MOVE-LINES-TO-COMMAREA.                                     13900000
                                                                        13910000
051203     IF  MR-A-UPCL (PV-SUB) > ZERO                                13920000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             13930000
051203         MOVE MR-A-UPC (PV-SUB)                                   13940000
051203                           TO ASC-UPC (ASC-BLK-SUB, ASC-ITEM-SUB) 13950000
           ELSE                                                         13960000
051203         IF  MR-A-UPCA (PV-SUB) = DP015-ERASE-EOF                 13970000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         13980000
051203             MOVE SPACE    TO ASC-UPC (ASC-BLK-SUB, ASC-ITEM-SUB) 13990000
               END-IF                                                   14000000
           END-IF.                                                      14010000
                                                                        14020000
           IF  MR-A-RQTYL (PV-SUB) > ZERO                               14030000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14040000
               MOVE MR-A-RQTY (PV-SUB)                                  14050000
                    TO ASC-RQTY    (ASC-BLK-SUB, ASC-ITEM-SUB)          14060000
           ELSE                                                         14070000
               IF  MR-A-RQTYA (PV-SUB) = DP015-ERASE-EOF                14080000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         14090000
                   MOVE SPACE        TO ASC-RQTY                        14100000
                                   (ASC-BLK-SUB, ASC-ITEM-SUB)          14110000
               END-IF                                                   14120000
           END-IF.                                                      14130000
                                                                        14140000
           IF  MR-A-RPRICEL (PV-SUB) > ZERO                             14150000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             14160000
               MOVE MR-A-RPRICE   (PV-SUB)                              14170000
                    TO ASC-RPRICE  (ASC-BLK-SUB, ASC-ITEM-SUB)          14180000
           ELSE                                                         14190000
               IF  MR-A-RPRICEA (PV-SUB) = DP015-ERASE-EOF              14200000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         14210000
                   MOVE SPACE        TO ASC-RPRICE                      14220000
                                   (ASC-BLK-SUB, ASC-ITEM-SUB)          14230000
               END-IF                                                   14240000
           END-IF.                                                      14250000
                                                                        14260000
           ADD +1                        TO ASC-ITEM-SUB.               14270000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        14280000
               ADD +1                    TO ASC-BLK-SUB                 14290000
               MOVE +1                   TO ASC-ITEM-SUB                14300000
           END-IF.                                                      14310000
                                                                        14320000
       EJECT.                                                           14330000
      ******************************************************************14340000
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**14350000
      ** FOR ITEMS THAT WERE NOT ON THE COMPLETED TRANSFER. RETAIL XFER 14360000
      ******************************************************************14370000
       2220-MOVE-LINES-TO-COMMAREA.                                     14380000
                                                                        14390000
051203     IF  MR-A-UPCL (PV-SUB) > ZERO                                14400000
            OR MR-A-RQTYL      (PV-SUB) > ZERO                          14410000
            OR MR-A-RPRICEL    (PV-SUB) > ZERO                          14420000
               ADD +1            TO ASC-NUMBER-OF-ITEMS-READ            14430000
                                    ASC-ITEMS-DISPLAYED                 14440000
               MOVE ASC-NUMBER-OF-ITEMS-READ TO ASC-LIST-ITEM-NUMBER    14450000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 14460000
               MOVE ZEROES TO ASC-LINE   (ASC-BLK-SUB ASC-ITEM-SUB)     14470000
                              ASC-TQTY   (ASC-BLK-SUB ASC-ITEM-SUB)     14480000
                              ASC-TPRICE (ASC-BLK-SUB ASC-ITEM-SUB)     14490000
                              ASC-FPRICE (ASC-BLK-SUB ASC-ITEM-SUB)     14500000
               SET ASC-NOT-XFERED-ITEM       (ASC-BLK-SUB ASC-ITEM-SUB) 14510000
                   ASC-NOT-GROUP-PRICED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB) 14520000
                   ASC-ITEMS-ADDED                     TO TRUE          14530000
051203         IF  MR-A-UPCL (PV-SUB) > ZERO                            14540000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         14550000
051203             MOVE MR-A-UPC (PV-SUB)                               14560000
051203                  TO ASC-UPC (ASC-BLK-SUB, ASC-ITEM-SUB)          14570000
               ELSE                                                     14580000
051203             IF  MR-A-UPCA (PV-SUB) = DP015-ERASE-EOF             14590000
                       SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14600000
051203                 MOVE SPACE TO ASC-UPC (ASC-BLK-SUB, ASC-ITEM-SUB)14610000
                   END-IF                                               14620000
               END-IF                                                   14630000
               IF  MR-A-RQTYL (PV-SUB) > ZERO                           14640000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         14650000
                   MOVE MR-A-RQTY (PV-SUB)                              14660000
                        TO ASC-RQTY    (ASC-BLK-SUB, ASC-ITEM-SUB)      14670000
               ELSE                                                     14680000
                   IF  MR-A-RQTYA (PV-SUB) = DP015-ERASE-EOF            14690000
                       SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14700000
                       MOVE SPACE        TO ASC-RQTY                    14710000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      14720000
                   END-IF                                               14730000
               END-IF                                                   14740000
               IF  MR-A-RPRICEL (PV-SUB) > ZERO                         14750000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         14760000
                   MOVE MR-A-RPRICE   (PV-SUB)                          14770000
                        TO ASC-RPRICE  (ASC-BLK-SUB, ASC-ITEM-SUB)      14780000
               ELSE                                                     14790000
                   IF  MR-A-RPRICEA (PV-SUB) = DP015-ERASE-EOF          14800000
                       SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE     14810000
                       MOVE SPACE        TO ASC-RPRICE                  14820000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      14830000
                   END-IF                                               14840000
               END-IF                                                   14850000
               IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                    14860000
                   ADD +1            TO ASC-ITEM-SUB                    14870000
               ELSE                                                     14880000
                   ADD +1            TO ASC-BLK-SUB                     14890000
                   MOVE +1           TO ASC-ITEM-SUB                    14900000
                   IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY             14910000
                       MOVE +1       TO ASC-BLK-SUB                     14920000
                       SET ASC-BLOCK-MODIFIED (1)  TO TRUE              14930000
                       PERFORM 5100-WRITE-TEMP-STORAGE                  14940000
                       MOVE ASC-BLOCK-ENTRIES                           14950000
                                     (PC-MAX-BLOCKS-IN-ARRAY)           14960000
                                      TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 14970000
                       ADD +1        TO ASC-BLK-SUB                     14980000
                       INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)       14990000
                       SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          15000000
                                         TO TRUE                        15010000
                   END-IF                                               15020000
               END-IF                                                   15030000
           END-IF.                                                      15040000
                                                                        15050000
       EJECT.                                                           15060000
      ******************************************************************15070000
      ** MOVE ALL OF THE FIELDS THAT WERE ENTERED / CHANGED ON THE    **15080000
      ** SCREEN INTO THE COMMAREA.  ALL EDITTING IS DONE IN THE COMM. **15090000
      **           NON-RETAIL TRANSFERS                               **15100000
      ******************************************************************15110000
       2250-MOVE-NON-RETAIL-SCREEN.                                     15120000
                                                                        15130000
           MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             15140000
           MOVE +1                       TO PV-SUB.                     15150000
                                                                        15160000
           PERFORM 3100-SET-SUBSCRIPTS.                                 15170000
           IF  MR-B-STARTL > ZERO                                       15180000
               MOVE MR-B-START       TO ASC-START-ITEM-REQUEST          15190000
           ELSE                                                         15200000
               IF  MR-B-STARTA = DP015-ERASE-EOF                        15210000
                   INITIALIZE ASC-START-ITEM-REQUEST                    15220000
               END-IF                                                   15230000
           END-IF.                                                      15240000
                                                                        15250000
           PERFORM 2260-MOVE-LINES-TO-COMMAREA                          15260000
                   VARYING PV-SUB                                       15270000
                   FROM 1 BY 1                                          15280000
                   UNTIL PV-SUB > ASC-ITEMS-DISPLAYED.                  15290000
           PERFORM 2270-MOVE-LINES-TO-COMMAREA                          15300000
                   VARYING PV-SUB                                       15310000
                   FROM PV-SUB BY 1                                     15320000
                   UNTIL PV-SUB > PC-ITEMS-PER-PANEL.                   15330000
                                                                        15340000
       EJECT.                                                           15350000
      ******************************************************************15360000
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**15370000
      ** FOR ITEMS THAT WERE ON THE COMPLETED TRANSFER.               **15380000
      **           NON-RETAIL TRANSFERS                               **15390000
      ******************************************************************15400000
       2260-MOVE-LINES-TO-COMMAREA.                                     15410000
                                                                        15420000
           IF  MR-B-DESCL (PV-SUB) > ZERO                               15430000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             15440000
               MOVE MR-B-DESC (PV-SUB)   TO ASC-NRTL-DESC               15450000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15460000
           ELSE                                                         15470000
               IF  MR-B-DESCA (PV-SUB) = DP015-ERASE-EOF                15480000
                    SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE        15490000
                   MOVE SPACE        TO ASC-NRTL-DESC                   15500000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15510000
               END-IF                                                   15520000
           END-IF.                                                      15530000
                                                                        15540000
           IF  MR-B-FIXTUREL (PV-SUB) > ZERO                            15550000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             15560000
               MOVE MR-B-FIXTURE (PV-SUB)TO ASC-FIXTURE                 15570000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15580000
           ELSE                                                         15590000
               IF  MR-B-FIXTUREA (PV-SUB) = DP015-ERASE-EOF             15600000
                    SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE        15610000
                   MOVE SPACE        TO ASC-FIXTURE                     15620000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15630000
               END-IF                                                   15640000
           END-IF.                                                      15650000
                                                                        15660000
           IF  MR-B-DEPTL (PV-SUB) > ZERO                               15670000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             15680000
               MOVE MR-B-DEPT (PV-SUB)   TO ASC-NRTL-DEPT               15690000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15700000
           ELSE                                                         15710000
               IF  MR-B-DEPTA (PV-SUB) = DP015-ERASE-EOF                15720000
                    SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE        15730000
                   MOVE SPACE        TO ASC-NRTL-DEPT                   15740000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15750000
               END-IF                                                   15760000
           END-IF.                                                      15770000
                                                                        15780000
           IF  MR-B-RQTYL (PV-SUB) > ZERO                               15790000
               SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE             15800000
               MOVE MR-B-RQTY (PV-SUB)   TO ASC-RQTY                    15810000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15820000
           ELSE                                                         15830000
               IF  MR-B-RQTYA (PV-SUB) = DP015-ERASE-EOF                15840000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         15850000
                   MOVE SPACE        TO ASC-RQTY                        15860000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      15870000
               END-IF                                                   15880000
           END-IF.                                                      15890000
                                                                        15900000
           ADD +1                        TO ASC-ITEM-SUB.               15910000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        15920000
               ADD +1                    TO ASC-BLK-SUB                 15930000
               MOVE +1                   TO ASC-ITEM-SUB                15940000
           END-IF.                                                      15950000
                                                                        15960000
       EJECT.                                                           15970000
      ******************************************************************15980000
      ** MOVE THE ENTERABLE FIELDS ON EACH LIST LINE INTO THE COMMAREA**15990000
      ** FOR ITEMS THAT WERE NOT ON THE COMPLETED TRANSFER.           **16000000
      **           NON-RETAIL TRANSFERS                               **16010000
      ******************************************************************16020000
       2270-MOVE-LINES-TO-COMMAREA.                                     16030000
                                                                        16040000
           IF  MR-B-DESCL      (PV-SUB) > ZERO                          16050000
            OR MR-B-FIXTUREL   (PV-SUB) > ZERO                          16060000
            OR MR-B-DEPTL      (PV-SUB) > ZERO                          16070000
            OR MR-B-RQTYL      (PV-SUB) > ZERO                          16080000
               ADD +1            TO ASC-NUMBER-OF-ITEMS-READ            16090000
                                    ASC-ITEMS-DISPLAYED                 16100000
               MOVE ASC-NUMBER-OF-ITEMS-READ                            16110000
                    TO ASC-LIST-ITEM-NUMBER  (ASC-BLK-SUB ASC-ITEM-SUB) 16120000
               MOVE ZEROES  TO ASC-LINE (ASC-BLK-SUB ASC-ITEM-SUB)      16130000
                               ASC-TQTY (ASC-BLK-SUB ASC-ITEM-SUB)      16140000
               SET ASC-NOT-XFERED-ITEM       (ASC-BLK-SUB ASC-ITEM-SUB) 16150000
                   ASC-ITEMS-ADDED                     TO TRUE          16160000
               IF  MR-B-DESCL (PV-SUB) > ZERO                           16170000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         16180000
                   MOVE MR-B-DESC (PV-SUB) TO ASC-NRTL-DESC             16190000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      16200000
               ELSE                                                     16210000
                   IF  MR-B-DESCA (PV-SUB) = DP015-ERASE-EOF            16220000
                        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE    16230000
                       MOVE SPACE        TO ASC-NRTL-DESC               16240000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      16250000
                   END-IF                                               16260000
               END-IF                                                   16270000
               IF  MR-B-FIXTUREL (PV-SUB) > ZERO                        16280000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         16290000
                   MOVE MR-B-FIXTURE (PV-SUB)                           16300000
                        TO ASC-FIXTURE (ASC-BLK-SUB, ASC-ITEM-SUB)      16310000
               ELSE                                                     16320000
                   IF  MR-B-FIXTUREA (PV-SUB) = DP015-ERASE-EOF         16330000
                        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE    16340000
                       MOVE SPACE        TO ASC-FIXTURE                 16350000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      16360000
                   END-IF                                               16370000
               END-IF                                                   16380000
               IF  MR-B-DEPTL (PV-SUB) > ZERO                           16390000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         16400000
                   MOVE MR-B-DEPT (PV-SUB)                              16410000
                        TO ASC-NRTL-DEPT (ASC-BLK-SUB, ASC-ITEM-SUB)    16420000
               ELSE                                                     16430000
                   IF  MR-B-DEPTA (PV-SUB) = DP015-ERASE-EOF            16440000
                        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE    16450000
                       MOVE SPACE        TO ASC-NRTL-DEPT               16460000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      16470000
                   END-IF                                               16480000
               END-IF                                                   16490000
               IF  MR-B-RQTYL (PV-SUB) > ZERO                           16500000
                   SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE         16510000
                   MOVE MR-B-RQTY (PV-SUB)                              16520000
                        TO ASC-RQTY   (ASC-BLK-SUB, ASC-ITEM-SUB)       16530000
               ELSE                                                     16540000
                   IF  MR-B-RQTYA (PV-SUB) = DP015-ERASE-EOF            16550000
                        SET ASC-BLOCK-MODIFIED (ASC-BLK-SUB) TO TRUE    16560000
                       MOVE SPACE        TO ASC-RQTY                    16570000
                                       (ASC-BLK-SUB, ASC-ITEM-SUB)      16580000
                   END-IF                                               16590000
               END-IF                                                   16600000
               IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                    16610000
                   ADD +1            TO ASC-ITEM-SUB                    16620000
               ELSE                                                     16630000
                   ADD +1            TO ASC-BLK-SUB                     16640000
                   MOVE +1           TO ASC-ITEM-SUB                    16650000
                                                                        16660000
                   IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY             16670000
                       MOVE +1       TO ASC-BLK-SUB                     16680000
                       SET ASC-BLOCK-MODIFIED (1) TO TRUE               16690000
                       PERFORM 5100-WRITE-TEMP-STORAGE                  16700000
                       MOVE ASC-BLOCK-ENTRIES                           16710000
                                     (PC-MAX-BLOCKS-IN-ARRAY)           16720000
                                      TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 16730000
                       ADD +1        TO ASC-BLK-SUB                     16740000
                       INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)       16750000
                       SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)          16760000
                                         TO TRUE                        16770000
                   END-IF                                               16780000
               END-IF                                                   16790000
           END-IF.                                                      16800000
                                                                        16810000
       EJECT.                                                           16820000
      ******************************************************************16830000
      ** EDIT ALL OF THE DATA ON THE SCREEN AS IT RESIDES IN THE      **16840000
      ** COMMAREA (EDITTING IS NOT DONE AGAINST THE SCREEN DIRECTLY). **16850000
      ******************************************************************16860000
       3000-EDIT-DATA-IN-COMMAREA.                                      16870000
                                                                        16880000
           SET ASC-NO-ERROR                                             16890000
               ASC-NO-WARNING            TO TRUE.                       16900000
           PERFORM 3200-RESET-ATTRIBUTES.                               16910000
           MOVE PV-TOP-ITEM              TO PV-ITEM-IN-USE.             16920000
           PERFORM 3100-SET-SUBSCRIPTS.                                 16930000
           SET ASC-NO-ITEMS-RECEIVED     TO TRUE.                       16940000
                                                                        16950000
           IF ASC-RETAIL-XFER                                           16960000
               PERFORM 3300-EDIT-SELECTIONS                             16970000
                       VARYING PV-SUB                                   16980000
                       FROM 1 BY 1                                      16990000
                       UNTIL PV-SUB > ASC-ITEMS-DISPLAYED               17000000
           ELSE                                                         17010000
               PERFORM 3400-EDIT-SELECTIONS                             17020000
                       VARYING PV-SUB                                   17030000
                       FROM 1 BY 1                                      17040000
                       UNTIL PV-SUB > ASC-ITEMS-DISPLAYED               17050000
           END-IF.                                                      17060000
                                                                        17070000
           IF ASC-NO-ERROR                                              17080000
               PERFORM 2140-CHK-XFER-STATUS                             17090000
               IF ASC-NO-ERROR                                          17100000
                   PERFORM 2150-CHK-XFER-IN-USE                         17110000
               END-IF                                                   17120000
           END-IF.                                                      17130000
                                                                        17140000
       EJECT.                                                           17150000
      *----------------------------------------------------------------*17160000
      *    DETERMINE THE VALUE OF THE ITEM SUBSCRIPT BASED ON THE ITEM *17170000
      *    CURRENTLY IN USE AND THE FIRST ITEM IN THE ARRAY.  THIS WILL*17180000
      *    POSITION US IN THE 1ST BLOCK OF THE ARRAY.                  *17190000
      *                                                                *17200000
      *    IF THE ITEM SUBSCRIPT EXCEEDS THE MAXIMUM NUMBER OF ITEMS   *17210000
      *    IN A BLOCK, RECALCULATE THE SUBSCRIPT BY SUBTRACTING OUT    *17220000
      *    THE MAXIMUM NUMBER OF ITEMS.  THIS WILL CORRECTLY POSITION  *17230000
      *    US IN THE 2ND BLOCK OF THE ARRAY.                           *17240000
      *----------------------------------------------------------------*17250000
       3100-SET-SUBSCRIPTS.                                             17260000
                                                                        17270000
           COMPUTE ASC-ITEM-SUB =                                       17280000
               (PV-ITEM-IN-USE - ASC-LIST-ITEM-NUMBER(1 1)) + 1.        17290000
                                                                        17300000
           IF ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                         17310000
               SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            17320000
                                                                        17330000
               MOVE PC-MAX-BLOCKS-IN-ARRAY TO ASC-BLK-SUB               17340000
           ELSE                                                         17350000
               MOVE +1                     TO ASC-BLK-SUB               17360000
           END-IF.                                                      17370000
                                                                        17380000
       EJECT.                                                           17390000
      ******************************************************************17400000
      ** RESET THE ATTRIBUTES OF ALL ENTERABLE FIELDS ON THE MAP.     **17410000
      ** DEALS WITH MULTIPLE MAPS - RETAIL OR NON-RETAIL.             **17420000
      ******************************************************************17430000
       3200-RESET-ATTRIBUTES.                                           17440000
                                                                        17450000
           MOVE DP015-UNP-ALP-NOR-OFF    TO MR-B-STARTA.                17460000
           MOVE DP015-GREEN              TO MR-B-STARTC.                17470000
           MOVE DP015-UNDERLINE          TO MR-B-STARTH.                17480000
                                                                        17490000
           PERFORM VARYING PV-SUB                                       17500000
                   FROM 1 BY 1                                          17510000
                   UNTIL PV-SUB > PC-ITEMS-PER-PANEL                    17520000
               IF ASC-RETAIL-XFER                                       17530000
                   MOVE DP015-UNP-NUM-NOR-OFF TO MR-A-RQTYA   (PV-SUB)  17540000
                                                 MR-A-RPRICEA (PV-SUB)  17550000
                   MOVE DP015-GREEN           TO MR-A-RQTYC   (PV-SUB)  17560000
                                                 MR-A-RPRICEC (PV-SUB)  17570000
                   MOVE DP015-UNDERLINE       TO MR-A-RQTYH (PV-SUB)    17580000
                                                 MR-A-RPRICEH (PV-SUB)  17590000
051203             MOVE DP015-UNP-NUM-NOR-OFF TO MR-A-UPCA      (PV-SUB)17600000
               ELSE                                                     17610000
                   MOVE DP015-UNP-NUM-NOR-OFF                           17620000
                                         TO MR-B-RQTYA   (PV-SUB)       17630000
                   MOVE DP015-GREEN      TO MR-B-RQTYC   (PV-SUB)       17640000
                   MOVE DP015-UNDERLINE  TO MR-B-RQTYH   (PV-SUB)       17650000
                   MOVE DP015-UNP-ALP-NOR-OFF TO MR-B-DESCA   (PV-SUB)  17660000
                                                 MR-B-FIXTUREA (PV-SUB) 17670000
                                                 MR-B-DEPTA    (PV-SUB) 17680000
                   MOVE DP015-GREEN           TO MR-B-DESCC (PV-SUB)    17690000
                                                 MR-B-FIXTUREC (PV-SUB) 17700000
                                                 MR-B-DEPTC    (PV-SUB) 17710000
                   MOVE DP015-UNDERLINE       TO MR-B-DESCH (PV-SUB)    17720000
                                                 MR-B-FIXTUREH (PV-SUB) 17730000
                                                 MR-B-DEPTH    (PV-SUB) 17740000
               END-IF                                                   17750000
           END-PERFORM.                                                 17760000
                                                                        17770000
       EJECT.                                                           17780000
      *----------------------------------------------------------------*17790000
      * CONTROLS THE EDITTING OF ITEMS ON RETAIL TRANSFERS.             17800000
      *----------------------------------------------------------------*17810000
       3300-EDIT-SELECTIONS.                                            17820000
                                                                        17830000
           SET ASC-NO-PRICE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)  TO TRUE.  17840000
                                                                        17850000
           IF ASC-NOT-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB)            17860000
               PERFORM 3310-EDIT-NOT-XFERED                             17870000
           ELSE                                                         17880000
               PERFORM 3350-EDIT-XFERED                                 17890000
           END-IF.                                                      17900000
                                                                        17910000
           IF  ((PS-VALID-ADDED-ITEM                                    17920000
             AND ASC-NOT-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB))        17930000
             OR (PS-VALID-XFERED-ITEM                                   17940000
             AND ASC-XFERED-ITEM     (ASC-BLK-SUB ASC-ITEM-SUB)))       17950000
             AND ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES         17960000
             AND ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) NUMERIC          17970000
               IF ASC-ITEM-NBR (ASC-BLK-SUB ASC-ITEM-SUB) NOT = ZEROS   17980000
                   PERFORM 3500-CHK-FOR-PRICE-CHANGE                    17990000
               END-IF                                                   18000000
           END-IF.                                                      18010000
                                                                        18020000
           ADD +1                        TO ASC-ITEM-SUB.               18030000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        18040000
               ADD +1                    TO ASC-BLK-SUB                 18050000
               MOVE +1                   TO ASC-ITEM-SUB                18060000
           END-IF.                                                      18070000
                                                                        18080000
       EJECT.                                                           18090000
      *----------------------------------------------------------------*18100000
      * EDIT ITEMS THAT WERE NOT ON THE COMPLETED RETAIL TRANSFER.      18110000
      *----------------------------------------------------------------*18120000
       3310-EDIT-NOT-XFERED.                                            18130000
                                                                        18140000
           IF ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES               18150000
               PERFORM 3330-EDIT-UPC                                    18160000
               SET PS-UPC-ENTERED         TO TRUE                       18170000
           ELSE                                                         18180000
               SET PS-UPC-NOT-ENTERED     TO TRUE                       18190000
           END-IF.                                                      18200000
                                                                        18210000
           EVALUATE TRUE                                                18220000
               WHEN (PS-UPC-ENTERED      AND  PS-VALID-ADDED-UPC)       18230000
                   PERFORM 3800-SELECT-KOHLS-INTERNAL-UPC               18240000
                   MOVE PV-KOHLS-INTERNAL-UPC-NBR TO ASC-KOHLS-UPC      18250000
                                    (ASC-BLK-SUB ASC-ITEM-SUB)          18260000
           END-EVALUATE.                                                18270000
                                                                        18280000
           IF (ASC-RQTY   (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES  OR       18290000
               ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES)          18300000
               IF (PS-UPC-NOT-ENTERED)                                  18310000
051203             MOVE DP015-RED     TO MR-A-UPCC (PV-SUB)             18320000
051203             MOVE DP015-REVERSE TO MR-A-UPCH (PV-SUB)             18330000
      *            -- MUST ENTER UPC --                                 18340000
                   IF ASC-NO-ERROR                                      18350000
                       MOVE PC-TSYMSG-00413   TO DP020-MSG-NUMBER       18360000
                       SET DP020-MSG-FATAL    TO TRUE                   18370000
051203                 MOVE -1            TO MR-A-UPCL        (PV-SUB)  18380000
                       SET DP030-SET-CURSOR-APPL-1                      18390000
                           ASC-ERROR          TO TRUE                   18400000
                   END-IF                                               18410000
              END-IF                                                    18420000
           END-IF.                                                      18430000
                                                                        18440000
           IF ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES              18450000
               MOVE ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)                 18460000
                                          TO DP010I-UNEDITED-FIELD      18470000
               MOVE +3                    TO DP010I-MAXIMUM-DIGITS      18480000
               MOVE +0                    TO DP010I-MAXIMUM-DECIMALS    18490000
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         18500000
                                          TO TRUE                       18510000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         18521099
                         USING DP010I-NUMERIC-EDIT-AREA                 18522099
               IF DP010I-ERROR-DETECTED OR DP010I-DECIMAL-POINT-FOUND   18530000
      *        -- MUST BE NUMERIC --                                    18540000
                   SET DP020-MSG-FATAL    TO TRUE                       18550000
                   MOVE DP015-RED             TO MR-A-RQTYC (PV-SUB)    18560000
                   MOVE DP015-REVERSE         TO MR-A-RQTYH (PV-SUB)    18570000
                   IF ASC-NO-ERROR                                      18580000
                       MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       18590000
                       SET DP020-MSG-FATAL    TO TRUE                   18600000
                       MOVE -1                TO MR-A-RQTYL (PV-SUB)    18610000
                       SET DP030-SET-CURSOR-APPL-1                      18620000
                           ASC-ERROR          TO TRUE                   18630000
                   END-IF                                               18640000
               ELSE                                                     18650000
                   MOVE DP010I-NUMERIC-FIELD  TO PV-QUANTITY            18660000
                   MOVE PV-QUANTITY           TO                        18670000
                              ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)       18680000
                   IF DP010I-NUMERIC-FIELD = 0                          18690000
                       SET DP020-MSG-FATAL    TO TRUE                   18700000
      *            -- MUST BE GREATER THAN ZERO --                      18710000
                       MOVE DP015-RED         TO MR-A-RQTYC (PV-SUB)    18720000
                       MOVE DP015-REVERSE     TO MR-A-RQTYH (PV-SUB)    18730000
                       IF ASC-NO-ERROR                                  18740000
                           MOVE PC-TSYMSG-00342 TO DP020-MSG-NUMBER     18750000
                           SET DP020-MSG-FATAL TO TRUE                  18760000
                           MOVE -1            TO MR-A-RQTYL (PV-SUB)    18770000
                           SET DP030-SET-CURSOR-APPL-1                  18780000
                               ASC-ERROR          TO TRUE               18790000
                       END-IF                                           18800000
      *  USE THE ENTERED QTY AS AN INDICATION OF A RECEIPT              18810000
                   ELSE                                                 18820000
                       SET ASC-ITEMS-RECEIVED     TO TRUE               18830000
                   END-IF                                               18840000
                END-IF                                                  18850000
      *- IF UPC OR PRICE WAS ENTERED, QTY IS REQUIRED                   18860000
           ELSE                                                         18870000
              IF (PS-UPC-ENTERED       OR                               18880000
                  ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES)       18890000
                  SET DP020-MSG-FATAL    TO TRUE                        18900000
                  MOVE DP015-RED             TO MR-A-RQTYC (PV-SUB)     18910000
                  MOVE DP015-REVERSE         TO MR-A-RQTYH (PV-SUB)     18920000
      *            -- REQUIRED FIELD --                                 18930000
                  IF ASC-NO-ERROR                                       18940000
                      MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER        18950000
                      SET DP020-MSG-FATAL    TO TRUE                    18960000
                      MOVE -1                TO MR-A-RQTYL (PV-SUB)     18970000
                      SET DP030-SET-CURSOR-APPL-1                       18980000
                          ASC-ERROR          TO TRUE                    18990000
                  END-IF                                                19000000
              END-IF                                                    19010000
           END-IF.                                                      19020000
                                                                        19030000
           IF ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES            19040000
               MOVE ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB)               19050000
                                          TO DP010I-UNEDITED-FIELD      19060000
SR3403         MOVE +8                    TO DP010I-MAXIMUM-DIGITS      19071000
               MOVE +2                    TO DP010I-MAXIMUM-DECIMALS    19080000
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         19090000
                                          TO TRUE                       19100000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         19111099
                         USING DP010I-NUMERIC-EDIT-AREA                 19112099
               IF DP010I-ERROR-DETECTED                                 19120000
                   MOVE DP015-RED             TO MR-A-RPRICEC (PV-SUB)  19130000
                   MOVE DP015-REVERSE         TO MR-A-RPRICEH (PV-SUB)  19140000
                   IF ASC-NO-ERROR                                      19150000
                       MOVE PC-TSYMSG-00342   TO DP020-MSG-NUMBER       19160000
                       SET DP020-MSG-FATAL    TO TRUE                   19170000
                       MOVE -1                TO MR-A-RPRICEL (PV-SUB)  19180000
                       SET DP030-SET-CURSOR-APPL-1                      19190000
                           ASC-ERROR          TO TRUE                   19200000
                   END-IF                                               19210000
               ELSE                                                     19220000
      *- USER MAY ENTER THE PRICE WITH OR WITHOUT A DECIMAL POINT       19230000
      *- IF ENTERED WITHOUT A DECIMAL POINT, 2 DECIMAL POSITIONS ARE    19240000
      *- ASSUMED.                                                       19250000
                   MOVE DP010I-NUMERIC-FIELD      TO PV-EDIT-PRICE      19260000
                   IF DP010I-DECIMAL-POINT-FOUND                        19270000
                       MOVE PV-EDIT-PRICE         TO ASC-RPRICE-N       19280000
                                         (ASC-BLK-SUB ASC-ITEM-SUB)     19290000
                   ELSE                                                 19300000
                       MOVE PV-EDIT-PRICE-4-DEC   TO ASC-RPRICE-N       19310000
                                         (ASC-BLK-SUB ASC-ITEM-SUB)     19320000
                   END-IF                                               19330000
               END-IF                                                   19340000
           ELSE                                                         19350000
      *- IF UPC OR QTY WAS ENTERED, PRICE IS REQUIRED                   19360000
               IF (PS-UPC-ENTERED       OR                              19370000
                   ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES)        19380000
                   SET DP020-MSG-FATAL    TO TRUE                       19390000
                   MOVE DP015-RED          TO MR-A-RPRICEC (PV-SUB)     19400000
                   MOVE DP015-REVERSE      TO MR-A-RPRICEH (PV-SUB)     19410000
      *            -- REQUIRED FIELD --                                 19420000
                   IF ASC-NO-ERROR                                      19430000
                       MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       19440000
                       SET DP020-MSG-FATAL    TO TRUE                   19450000
                       MOVE -1              TO MR-A-RPRICEL (PV-SUB)    19460000
                       SET DP030-SET-CURSOR-APPL-1                      19470000
                           ASC-ERROR          TO TRUE                   19480000
                   END-IF                                               19490000
                END-IF                                                  19500000
           END-IF.                                                      19510000
                                                                        19520000
           IF ASC-NO-ERROR                                              19530000
               MOVE ASC-XFER-DKEY-ID     TO DK-XFER-DKEY-ID             19540000
               PERFORM 7410-SELECT-ITM-BY-ITMNBR                        19550000
               IF SQLCODE = ZERO                                        19560000
                   IF TFITEM-ITM-PRIC-MLT-IND = 'Y'                     19570000
                       MOVE TFITEM-CPLD-RTL-PRIC-AMT    TO              19580000
                                 ASC-FPRICE (ASC-BLK-SUB ASC-ITEM-SUB)  19590000
                       MOVE TFITEM-XFER-PRIC-AMT    TO                  19600000
                                 ASC-TPRICE (ASC-BLK-SUB ASC-ITEM-SUB)  19610000
                       SET ASC-GROUP-PRICED-ITEM                        19620000
                                 (ASC-BLK-SUB ASC-ITEM-SUB) TO TRUE     19630000
                   END-IF                                               19640000
               END-IF                                                   19650000
           END-IF.                                                      19660000
                                                                        19670000
       EJECT.                                                           19680000
      *----------------------------------------------------------------*19690000
      * EDIT THE UPC NUMBERS THAT WERE ENTERED.                         19700000
      *----------------------------------------------------------------*19710000
       3330-EDIT-UPC.                                                   19720000
                                                                        19730000
051203     IF ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES               19740000
              EVALUATE TRUE                                             19750000
051203           WHEN ASC-UPC-DIGITS-9-13                               19760000
051203                          (ASC-BLK-SUB ASC-ITEM-SUB) = SPACES     19770000
051203                MOVE ASC-UPC-DIGITS-1-8 (ASC-BLK-SUB ASC-ITEM-SUB)19780000
051203                      TO PV-CHECK-DUMMY-SKU-DEPT-CL               19790000
051203                         DP040I-SKU-NUMBER                        19800000
051203                PERFORM 3410-PROCESS-DUMMY-SKU                    19810000
051203           WHEN ASC-UPC-DIGITS-1-5                                19820000
051203                          (ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS      19830000
051203                MOVE ASC-UPC-DIGITS-6-13                          19840000
051203                                        (ASC-BLK-SUB ASC-ITEM-SUB)19850000
051203                                     TO PV-CHECK-DUMMY-SKU-DEPT-CL19860000
051203                                        DP040I-SKU-NUMBER         19870000
051203                PERFORM 3410-PROCESS-DUMMY-SKU                    19880000
051203           WHEN OTHER                                             19890000
051203             MOVE ASC-UPC-N (ASC-BLK-SUB ASC-ITEM-SUB)            19900000
051203                                           TO PV-HOLD-UPC-NBR     19910000
051203                IF   PV-KOHLS-UPC-DIGITS = '0400'                 19920000
051203                 AND PV-KOHLS-DUMMY-SKU = '000'                   19930000
051203                     PERFORM 3905-VALIDATE-UPC-DEPT-CLASS         19940000
051203                     IF PS-INVALID-DEPT-CL                        19950000
051203                        MOVE DP015-RED  TO MR-A-UPCC (PV-SUB)     19960000
051203                        MOVE DP015-REVERSE TO MR-A-UPCH (PV-SUB)  19970000
051203                        IF ASC-NO-ERROR                           19980000
051203                           MOVE PC-TSYMSG-00110                   19990000
051203                                               TO DP020-MSG-NUMBER20000000
051203                           SET DP020-MSG-FATAL  TO TRUE           20010000
051203                           MOVE -1 TO      MR-A-UPCL (PV-SUB)     20020000
051203                           SET DP030-SET-CURSOR-APPL-4            20030000
051203                               ASC-ERROR        TO TRUE           20040000
051203                        END-IF                                    20050000
051203                     END-IF                                       20060000
051203                ELSE                                              20070000
051203                     MOVE ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)      20080000
                                          TO DP010I-UNEDITED-FIELD      20090000
                           MOVE +13       TO DP010I-MAXIMUM-DIGITS      20100000
                           MOVE +0        TO DP010I-MAXIMUM-DECIMALS    20110000
                           SET DP010I-NEGATIVE-NOT-ALLOWED TO TRUE      20120000
                           CALL DP010I-NUMERIC-EDIT-ROUTINE             20131099
                                        USING DP010I-NUMERIC-EDIT-AREA  20140000
                           IF DP010I-ERROR-DETECTED                     20150000
                                        OR DP010I-DECIMAL-POINT-FOUND   20160000
                              SET DP020-MSG-FATAL  TO TRUE              20170000
051203                        MOVE DP015-RED       TO MR-A-UPCC (PV-SUB)20180000
051203                        MOVE DP015-REVERSE   TO MR-A-UPCH (PV-SUB)20190000
                              IF ASC-NO-ERROR                           20200000
                                 MOVE PC-TSYMSG-00008                   20210000
                                                     TO DP020-MSG-NUMBER20220000
                                 SET DP020-MSG-FATAL TO TRUE            20230000
051203                           MOVE -1           TO MR-A-UPCL (PV-SUB)20240000
                                 SET DP030-SET-CURSOR-APPL-1            20250000
                                     ASC-ERROR     TO TRUE              20260000
                              END-IF                                    20270000
051203                     ELSE                                         20280000
051203                        MOVE DP010I-NUM-FIELD-13-DIG-4-DEC        20290000
051203                           TO ASC-UPC-N (ASC-BLK-SUB ASC-ITEM-SUB)20300000
                           END-IF                                       20310000
051203                END-IF                                            20320000
051203        END-EVALUATE                                              20330000
           ELSE                                                         20340000
      *        -- REQUIRED ENTRY --                                     20350000
               SET DP020-MSG-FATAL        TO TRUE                       20360000
051203         MOVE DP015-RED             TO MR-A-UPCC (PV-SUB)         20370000
051203         MOVE DP015-REVERSE         TO MR-A-UPCH (PV-SUB)         20380000
               IF ASC-NO-ERROR                                          20390000
                   MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER           20400000
                   SET DP020-MSG-FATAL    TO TRUE                       20410000
051203             MOVE -1                TO MR-A-UPCL (PV-SUB)         20420000
                   SET DP030-SET-CURSOR-APPL-1                          20430000
                       ASC-ERROR          TO TRUE                       20440000
               END-IF                                                   20450000
           END-IF.                                                      20460000
                                                                        20470000
051203     IF  PS-FOUND-DUMMY-UPC-Y                                     20480000
051203         MOVE SKXREF-DEPT              TO DP040I-DEPARTMENT-NUMBER20490000
051203         MOVE SKXREF-SUBCLASS          TO DP040I-CLASS-NUMBER     20500000
051203         MOVE ZEROS                    TO DP040I-SEQUENCE-NUMBER  20510000
051203         SET DP040I-GEN-INTERNAL-UPC-OPTION TO TRUE               20520000
051203         MOVE ASC-UPC-N                 (ASC-BLK-SUB ASC-ITEM-SUB)20530000
051203                 TO DP040I-UPC-CODE                               20540000
051203         CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                      20550099
051203                         USING DP040I-UPC-CHECK-DIGIT-PARMS       20551099
051203         IF DP040I-NO-ERROR-DETECTED                              20560000
051203            MOVE DP040I-UPC-CODE                                  20570000
051203                 TO ASC-UPC-N           (ASC-BLK-SUB ASC-ITEM-SUB)20580000
051203         END-IF                                                   20590000
051203         MOVE ZEROS TO ASC-ITEM-NBR     (ASC-BLK-SUB ASC-ITEM-SUB)20600000
051203         MOVE ASC-UPC-N                 (ASC-BLK-SUB ASC-ITEM-SUB)20610000
051203                    TO ASC-KOHLS-UPC    (ASC-BLK-SUB ASC-ITEM-SUB)20620000
051203         MOVE ZEROS TO ASC-FPRICE       (ASC-BLK-SUB ASC-ITEM-SUB)20630000
051203         MOVE ZEROS TO ASC-TQTY         (ASC-BLK-SUB ASC-ITEM-SUB)20640000
051203         MOVE ZEROS TO ASC-TPRICE       (ASC-BLK-SUB ASC-ITEM-SUB)20650000
051203         MOVE ZEROS TO ASC-CUR-RTL-AMT  (ASC-BLK-SUB ASC-ITEM-SUB)20660000
051203         MOVE 'N'   TO ASC-RNBR-SKU-IND (ASC-BLK-SUB ASC-ITEM-SUB)20670000
051203         MOVE 'N'   TO ASC-GROUP-PRICED-SW                        20680000
051203                                        (ASC-BLK-SUB ASC-ITEM-SUB)20690000
051203     END-IF.                                                      20700000
                                                                        20710000
      *----------------------------------------------------------------*20720000
100404* VALIDATE THE UPC NUMBER AGAINST XST_UPC.                        20730000
      *----------------------------------------------------------------*20740000
051203     IF ASC-NO-ERROR AND PS-FOUND-DUMMY-UPC-N                     20750000
             MOVE ASC-UPC-N (ASC-BLK-SUB ASC-ITEM-SUB) TO DK-UPC-NBR    20760000
             SET PS-VALID-ADDED-UPC                                     20770000
                 PS-VALID-ADDED-ITEM      TO TRUE                       20780000
100404       PERFORM 7500-SELECT-TSKXREF                                20790000
100404       IF PS-UPC-NOT-FOUND-ON-XST-UPC                             20800000
               SET PS-INVALID-ADDED-UPC                                 20810000
                   PS-INVALID-ADDED-ITEM      TO TRUE                   20820000
051203         MOVE DP015-RED         TO MR-A-UPCC (PV-SUB)             20830000
051203         MOVE DP015-REVERSE     TO MR-A-UPCH (PV-SUB)             20840000
               IF ASC-NO-ERROR                                          20850000
                   MOVE PC-TSYMSG-00100 TO DP020-MSG-NUMBER             20860000
                   SET DP020-MSG-FATAL TO TRUE                          20870000
051203             MOVE -1             TO MR-A-UPCL (PV-SUB)            20880000
                   SET DP030-SET-CURSOR-APPL-1                          20890000
                        ASC-ERROR          TO TRUE                      20900000
               END-IF                                                   20910000
             ELSE                                                       20920000
100404         MOVE SKXREF-ITM-NBR     TO ASC-ITEM-NBR                  20930000
                                    (ASC-BLK-SUB ASC-ITEM-SUB)          20940000
                                          DK-ITEM-NBR                   20950000
               PERFORM 7510-SELECT-SKU-BY-ITEM-NBR                      20960000
               IF PS-SKU-ITEM-NOT-FOUND                                 20970000
                   SET PS-INVALID-ADDED-UPC                             20980000
                       PS-INVALID-ADDED-ITEM      TO TRUE               20990000
051203             MOVE DP015-RED         TO MR-A-UPCC (PV-SUB)         21000000
051203             MOVE DP015-REVERSE     TO MR-A-UPCH (PV-SUB)         21010000
                   IF ASC-NO-ERROR                                      21020000
                       MOVE PC-TSYMSG-00412 TO DP020-MSG-NUMBER         21030000
                       SET DP020-MSG-FATAL TO TRUE                      21040000
                       MOVE -1             TO MR-A-UPCL (PV-SUB)        21050000
051203                 SET DP030-SET-CURSOR-APPL-1                      21060000
                            ASC-ERROR          TO TRUE                  21070000
                   END-IF                                               21080000
               END-IF                                                   21090000
             END-IF                                                     21100000
           END-IF.                                                      21110000
                                                                        21120000
       EJECT.                                                           21130000
      *----------------------------------------------------------------*21140000
      * EDIT THE LINES THAT WERE ON THE COMPLETED RETAIL TRANSFER.      21150000
      *----------------------------------------------------------------*21160000
       3350-EDIT-XFERED.                                                21170000
                                                                        21180000
           SET PS-VALID-XFERED-ITEM                TO TRUE.             21190000
                                                                        21200000
           IF ASC-ITEM-NBR (ASC-BLK-SUB ASC-ITEM-SUB) = ZEROS           21210000
               MOVE ZEROES                 TO ASC-CUR-RTL-AMT           21220000
                                   (ASC-BLK-SUB ASC-ITEM-SUB)           21230000
           ELSE                                                         21240000
               MOVE ASC-ITEM-NBR (ASC-BLK-SUB ASC-ITEM-SUB)             21250000
                                              TO DK-ITEM-NBR            21260000
               PERFORM 7510-SELECT-SKU-BY-ITEM-NBR                      21270000
               IF PS-SKU-ITEM-NOT-FOUND                                 21280000
                   SET PS-INVALID-XFERED-ITEM      TO TRUE              21290000
               END-IF                                                   21300000
           END-IF.                                                      21310000
                                                                        21320000
           IF  ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES             21330000
               MOVE ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)                 21340000
                                      TO DP010I-UNEDITED-FIELD          21350000
               MOVE +3                TO DP010I-MAXIMUM-DIGITS          21360000
               MOVE +0                TO DP010I-MAXIMUM-DECIMALS        21370000
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         21380000
                                      TO TRUE                           21390000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         21401099
                         USING DP010I-NUMERIC-EDIT-AREA                 21402099
               IF DP010I-ERROR-DETECTED OR                              21410000
                                         DP010I-DECIMAL-POINT-FOUND     21420000
      *    -- MUST BE NUMERIC --                                        21430000
                   SET DP020-MSG-FATAL    TO TRUE                       21440000
                   MOVE DP015-RED         TO MR-A-RQTYC (PV-SUB)        21450000
                   MOVE DP015-REVERSE     TO MR-A-RQTYH (PV-SUB)        21460000
                   IF ASC-NO-ERROR                                      21470000
                     MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER         21480000
                     SET DP020-MSG-FATAL    TO TRUE                     21490000
                     MOVE -1                TO MR-A-RQTYL (PV-SUB)      21500000
                     SET DP030-SET-CURSOR-APPL-1                        21510000
                         ASC-ERROR          TO TRUE                     21520000
                   END-IF                                               21530000
               ELSE                                                     21540000
                   MOVE DP010I-NUMERIC-FIELD  TO PV-QUANTITY            21550000
                   MOVE PV-QUANTITY           TO                        21560000
                          ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)           21570000
                   IF DP010I-NUMERIC-FIELD > 0                          21580000
      *  USE THE ENTERED QTY AS AN INDICATION OF A RECEIPT              21590000
                       SET ASC-ITEMS-RECEIVED     TO TRUE               21600000
                   ELSE                                                 21610000
      *  IF RECEIVE QTY IS ZERO, RECEIVE PRICE WILL BE TRANSFER PRICE   21620000
                        MOVE ASC-TPRICE (ASC-BLK-SUB ASC-ITEM-SUB)      21630000
                            TO ASC-RPRICE-N (ASC-BLK-SUB ASC-ITEM-SUB)  21640000
                   END-IF                                               21650000
               END-IF                                                   21660000
           ELSE                                                         21670000
      *  IF PRICE WAS ENTERED, QTY IS REQUIRED                          21680000
              IF ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES         21690000
                  SET DP020-MSG-FATAL    TO TRUE                        21700000
                  MOVE DP015-RED             TO MR-A-RQTYC (PV-SUB)     21710000
                  MOVE DP015-REVERSE         TO MR-A-RQTYH (PV-SUB)     21720000
      *            -- REQUIRED FIELD --                                 21730000
                  IF ASC-NO-ERROR                                       21740000
                      MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER        21750000
                      SET DP020-MSG-FATAL    TO TRUE                    21760000
                      MOVE -1                TO MR-A-RQTYL (PV-SUB)     21770000
                      SET DP030-SET-CURSOR-APPL-1                       21780000
                          ASC-ERROR          TO TRUE                    21790000
                  END-IF                                                21800000
              END-IF                                                    21810000
           END-IF.                                                      21820000
                                                                        21830000
           IF ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES            21840000
               MOVE ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB)               21850000
                                      TO DP010I-UNEDITED-FIELD          21860000
SR3403         MOVE +8                TO DP010I-MAXIMUM-DIGITS          21871000
               MOVE +2                TO DP010I-MAXIMUM-DECIMALS        21880000
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         21890000
                                      TO TRUE                           21900000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         21911099
                         USING DP010I-NUMERIC-EDIT-AREA                 21912099
               IF DP010I-ERROR-DETECTED                                 21920000
                   MOVE DP015-RED         TO MR-A-RPRICEC (PV-SUB)      21930000
                   MOVE DP015-REVERSE     TO MR-A-RPRICEH (PV-SUB)      21940000
                   IF ASC-NO-ERROR                                      21950000
                       MOVE PC-TSYMSG-00342  TO DP020-MSG-NUMBER        21960000
                       SET DP020-MSG-FATAL   TO TRUE                    21970000
                       MOVE -1             TO MR-A-RPRICEL (PV-SUB)     21980000
                       SET DP030-SET-CURSOR-APPL-1                      21990000
                           ASC-ERROR        TO TRUE                     22000000
                   END-IF                                               22010000
               ELSE                                                     22020000
      *- USER MAY ENTER THE PRICE WITH OR WITHOUT A DECIMAL POINT       22030000
      *- IF ENTERED WITHOUT A DECIMAL POINT, 2 DECIMAL POSITIONS ARE    22040000
      *- ASSUMED.                                                       22050000
                   MOVE DP010I-NUMERIC-FIELD      TO PV-EDIT-PRICE      22060000
                   IF DP010I-DECIMAL-POINT-FOUND                        22070000
                       MOVE PV-EDIT-PRICE         TO ASC-RPRICE-N       22080000
                                      (ASC-BLK-SUB ASC-ITEM-SUB)        22090000
                   ELSE                                                 22100000
                       MOVE PV-EDIT-PRICE-4-DEC   TO ASC-RPRICE-N       22110000
                                     (ASC-BLK-SUB ASC-ITEM-SUB)         22120000
                   END-IF                                               22130000
               END-IF                                                   22140000
           ELSE                                                         22150000
      *- IF QTY WAS ENTERED, PRICE IS REQUIRED                          22160000
               IF  ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES         22170000
                   SET DP020-MSG-FATAL    TO TRUE                       22180000
                   MOVE DP015-RED          TO MR-A-RPRICEC (PV-SUB)     22190000
                   MOVE DP015-REVERSE      TO MR-A-RPRICEH (PV-SUB)     22200000
      *            -- REQUIRED FIELD --                                 22210000
                   IF ASC-NO-ERROR                                      22220000
                       MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       22230000
                       SET DP020-MSG-FATAL    TO TRUE                   22240000
                       MOVE -1             TO MR-A-RPRICEL (PV-SUB)     22250000
                       SET DP030-SET-CURSOR-APPL-1                      22260000
                           ASC-ERROR          TO TRUE                   22270000
                   END-IF                                               22280000
               END-IF                                                   22290000
           END-IF.                                                      22300000
                                                                        22310000
       EJECT.                                                           22320000
      *----------------------------------------------------------------*22330000
      * EDIT ITEMS ON NON-RETAIL TRANSFERS.                             22340000
      *----------------------------------------------------------------*22350000
       3400-EDIT-SELECTIONS.                                            22360000
                                                                        22370000
           IF ASC-NOT-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB) AND        22380000
              (ASC-RQTY     (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES  OR     22390000
               ASC-NRTL-DEPT (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES OR     22400000
               ASC-FIXTURE   (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES)       22410000
               IF ASC-NRTL-DESC (ASC-BLK-SUB ASC-ITEM-SUB) NOT > SPACES 22420000
                   MOVE DP015-RED     TO MR-B-DESCC      (PV-SUB)       22430000
                   MOVE DP015-REVERSE TO MR-B-DESCH      (PV-SUB)       22440000
      *            -- REQUIRED ENTRY ---                                22450000
                   IF ASC-NO-ERROR                                      22460000
                       MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER       22470000
                       SET DP020-MSG-FATAL    TO TRUE                   22480000
                       MOVE -1                TO MR-B-DESCL  (PV-SUB)   22490000
                       SET DP030-SET-CURSOR-APPL-1                      22500000
                           ASC-ERROR          TO TRUE                   22510000
                   END-IF                                               22520000
              END-IF                                                    22530000
           END-IF.                                                      22540000
                                                                        22550000
           IF ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES              22560000
               MOVE ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)                 22570000
                                          TO DP010I-UNEDITED-FIELD      22580000
               MOVE +3                    TO DP010I-MAXIMUM-DIGITS      22590000
               MOVE +0                    TO DP010I-MAXIMUM-DECIMALS    22600000
               SET  DP010I-NEGATIVE-NOT-ALLOWED                         22610000
                                          TO TRUE                       22620000
               CALL DP010I-NUMERIC-EDIT-ROUTINE                         22631099
                         USING DP010I-NUMERIC-EDIT-AREA                 22632099
               IF DP010I-ERROR-DETECTED OR DP010I-DECIMAL-POINT-FOUND   22640000
      *        -- MUST BE NUMERIC --                                    22650000
                   SET DP020-MSG-FATAL    TO TRUE                       22660000
                   MOVE DP015-RED             TO MR-B-RQTYC (PV-SUB)    22670000
                   MOVE DP015-REVERSE         TO MR-B-RQTYH (PV-SUB)    22680000
                   IF ASC-NO-ERROR                                      22690000
                       MOVE PC-TSYMSG-00008   TO DP020-MSG-NUMBER       22700000
                       SET DP020-MSG-FATAL    TO TRUE                   22710000
                       MOVE -1                TO MR-B-RQTYL (PV-SUB)    22720000
                       SET DP030-SET-CURSOR-APPL-1                      22730000
                           ASC-ERROR          TO TRUE                   22740000
                   END-IF                                               22750000
               ELSE                                                     22760000
                   MOVE DP010I-NUMERIC-FIELD  TO PV-QUANTITY            22770000
                   MOVE PV-QUANTITY           TO                        22780000
                              ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)       22790000
                   IF DP010I-NUMERIC-FIELD > 0                          22800000
      *  USE THE ENTERED QTY AS AN INDICATION OF A RECEIPT              22810000
                       SET ASC-ITEMS-RECEIVED     TO TRUE               22820000
                   END-IF                                               22830000
                   IF DP010I-NUMERIC-FIELD = 0   AND                    22840000
                      ASC-NOT-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB)    22850000
                       SET DP020-MSG-FATAL    TO TRUE                   22860000
      *            -- MUST BE GREATER THAN ZERO --                      22870000
                       MOVE DP015-RED         TO MR-B-RQTYC (PV-SUB)    22880000
                       MOVE DP015-REVERSE     TO MR-B-RQTYH (PV-SUB)    22890000
                       IF ASC-NO-ERROR                                  22900000
                           MOVE PC-TSYMSG-00342 TO DP020-MSG-NUMBER     22910000
                           SET DP020-MSG-FATAL TO TRUE                  22920000
                           MOVE -1            TO MR-B-RQTYL (PV-SUB)    22930000
                           SET DP030-SET-CURSOR-APPL-1                  22940000
                               ASC-ERROR          TO TRUE               22950000
                       END-IF                                           22960000
                   END-IF                                               22970000
               END-IF                                                   22980000
      *- IF ANY OTHER FIELDS ARE ENTERED, QTY IS REQUIRED               22990000
           ELSE                                                         23000000
               IF ASC-NOT-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB)        23010000
                  IF ASC-NRTL-DESC (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES  23020000
                  OR ASC-FIXTURE   (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES  23030000
                  OR ASC-NRTL-DEPT (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES  23040000
                     SET DP020-MSG-FATAL    TO TRUE                     23050000
                     MOVE DP015-RED             TO MR-B-RQTYC (PV-SUB)  23060000
                     MOVE DP015-REVERSE         TO MR-B-RQTYH (PV-SUB)  23070000
      *            -- REQUIRED FIELD --                                 23080000
                     IF ASC-NO-ERROR                                    23090000
                         MOVE PC-TSYMSG-00007   TO DP020-MSG-NUMBER     23100000
                         SET DP020-MSG-FATAL    TO TRUE                 23110000
                         MOVE -1                TO MR-B-RQTYL (PV-SUB)  23120000
                         SET DP030-SET-CURSOR-APPL-1                    23130000
                             ASC-ERROR          TO TRUE                 23140000
                     END-IF                                             23150000
                  END-IF                                                23160000
               END-IF                                                   23170000
           END-IF.                                                      23180000
                                                                        23190000
           ADD +1                        TO ASC-ITEM-SUB.               23200000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        23210000
               ADD +1                    TO ASC-BLK-SUB                 23220000
               MOVE +1                   TO ASC-ITEM-SUB                23230000
           END-IF.                                                      23240000
                                                                        23250000
       EJECT.                                                           23260000
051203******************************************************************23270000
051203**VALIDATE THAT SKU IS A DUMMY                                    23280000
051203******************************************************************23290000
051203 3410-PROCESS-DUMMY-SKU.                                          23300000
                                                                        23310000
051203     PERFORM 3900-VALIDATE-SKU-DEPT-CLASS                         23320000
                                                                        23330000
051203     IF  PS-INVALID-DEPT-CL                                       23340000
051203         MOVE DP015-RED TO MR-A-UPCC (PV-SUB)                     23350000
051203         MOVE DP015-REVERSE       TO MR-A-UPCH (PV-SUB)           23360000
051203         IF ASC-NO-ERROR                                          23370000
051203             MOVE PC-TSYMSG-00110 TO DP020-MSG-NUMBER             23380000
051203             SET DP020-MSG-FATAL  TO TRUE                         23390000
051203             MOVE -1              TO MR-A-UPCL (ASC-ITEM-SUB)     23400000
051203             SET DP030-SET-CURSOR-APPL-4                          23410000
051203                 ASC-ERROR        TO TRUE                         23420000
051203         END-IF                                                   23430000
051203     ELSE                                                         23440000
051203          PERFORM 3910-SELECT-DUMMY-UPC                           23450000
051203          IF PS-FOUND-DUMMY-UPC-N                                 23460000
051203              MOVE DP015-RED     TO MR-A-UPCC (PV-SUB)            23470000
051203              MOVE DP015-REVERSE TO MR-A-UPCH (ASC-ITEM-SUB)      23480000
051203              IF ASC-NO-ERROR                                     23490000
051203                  MOVE PC-TSYMSG-00110  TO DP020-MSG-NUMBER       23500000
051203                  MOVE 'SKU 000 NOT FORMATTED CORRECTLY'          23510000
051203                                        TO DP020-MSG-TEXT         23520000
051203                  SET DP020-MSG-FATAL   TO TRUE                   23530000
051203                  MOVE -1            TO MR-A-UPCL (ASC-ITEM-SUB)  23540000
051203                  SET DP030-SET-CURSOR-APPL-4                     23550000
051203                      ASC-ERROR         TO TRUE                   23560000
051203              END-IF                                              23570000
051203          END-IF                                                  23580000
051203      END-IF.                                                     23590000
                                                                        23600000
051203 EJECT.                                                           23610000
      *----------------------------------------------------------------*23620000
      * CHECK THE ENTERED PRICE AGAINST GROUP PRICES, CURRENT RETAIL, OR23630000
      * CLEARANCE PRICE. IF NOT VALID, SET A WARNING SWITCH.            23640000
      *----------------------------------------------------------------*23650000
       3500-CHK-FOR-PRICE-CHANGE.                                       23660000
                                                                        23670000
           SET PS-PRICE-NOT-FOUND             TO TRUE.                  23680000
           IF ASC-GROUP-PRICED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB)          23690000
                OR PV-GP-QTY > +1                                       23700000
               PERFORM 3510-CHECK-GROUP-PRICING                         23710000
           END-IF.                                                      23720000
                                                                        23730000
           IF PS-PRICE-NOT-FOUND                                        23740000
               EVALUATE  ASC-XFER-TYPE                                  23750000
                   WHEN PC-STOCK-BALANCE-CORPORATE                      23760000
                   WHEN PC-STOCK-BALANCE-STORE                          23770000
                   WHEN PC-CUSTOMER                                     23780000
                       PERFORM 3520-CHECK-CURRENT-PRICE                 23790000
               END-EVALUATE                                             23800000
           END-IF.                                                      23810000
                                                                        23820000
       EJECT.                                                           23830000
      *----------------------------------------------------------------*23840000
      * CHECK GROUP PRICED ITEM PRICES. IF THE ITEM WAS GROUP PRICED AT 23850000
      * COMPLETE TIME AND THE ENTERED PRICE IS EQUAL TO THE FILE PRICE  23860000
      * AT COMPLETE TIME, FORCE THE ENTERED PRICE TO BE THE TRANSFERED  23870000
      * DIVIDED PRICE. IF THE ENTERED PRICE IS THE TRANSFERED DIVIDED   23880000
      * PRICE OR THE CURRENT RETAIL OR CURRENT DIVIDED PRICE, ACCEPT THE23890000
      * ENTERED PRICE WITH NO MESSAGE. ANY OTHER PRICE WILL BE FURTHER  23900000
      * CHECKED IN PARAGRAPH 3520-CHECK-CURRENT-PRICE.                  23910000
      *----------------------------------------------------------------*23920000
       3510-CHECK-GROUP-PRICING.                                        23930000
                                                                        23940000
           IF ASC-GROUP-PRICED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB)          23950000
               EVALUATE TRUE                                            23960000
                   WHEN  ASC-RPRICE-N     (ASC-BLK-SUB ASC-ITEM-SUB)    23970000
                             = ASC-TPRICE (ASC-BLK-SUB ASC-ITEM-SUB)    23980000
                       SET PS-PRICE-FOUND       TO TRUE                 23990000
                   WHEN  ASC-RPRICE-N     (ASC-BLK-SUB ASC-ITEM-SUB)    24000000
                             = ASC-FPRICE (ASC-BLK-SUB ASC-ITEM-SUB)    24010000
                       MOVE ASC-TPRICE (ASC-BLK-SUB ASC-ITEM-SUB)       24020000
                           TO ASC-RPRICE-N (ASC-BLK-SUB ASC-ITEM-SUB)   24030000
                       SET PS-PRICE-FOUND       TO TRUE                 24040000
                   WHEN PV-GP-QTY > +1                                  24050000
                       IF  ASC-RPRICE-N   (ASC-BLK-SUB ASC-ITEM-SUB)    24060000
                             = ASC-CUR-RTL-AMT                          24070000
                                          (ASC-BLK-SUB ASC-ITEM-SUB)    24080000
                        OR ASC-RPRICE-N   (ASC-BLK-SUB ASC-ITEM-SUB)    24090000
                             = PV-CUR-RTL-AMT                           24100000
                           SET PS-PRICE-FOUND       TO TRUE             24110000
                       END-IF                                           24120000
               END-EVALUATE                                             24130000
           ELSE                                                         24140000
               IF PV-GP-QTY > +1                                        24150000
                   IF  ASC-RPRICE-N   (ASC-BLK-SUB ASC-ITEM-SUB)        24160000
                         = ASC-CUR-RTL-AMT                              24170000
                                          (ASC-BLK-SUB ASC-ITEM-SUB)    24180000
                    OR ASC-RPRICE-N   (ASC-BLK-SUB ASC-ITEM-SUB)        24190000
                         = PV-CUR-RTL-AMT                               24200000
                       SET PS-PRICE-FOUND       TO TRUE                 24210000
                   END-IF                                               24220000
               END-IF                                                   24230000
           END-IF.                                                      24240000
                                                                        24250000
       EJECT.                                                           24260000
      *----------------------------------------------------------------*24270000
      * CHECK THE ENTERED PRICE AGAINST THE CURRENT RETAIL, OR          24280000
      * CLEARANCE PRICE. IF NOT VALID, SET A WARNING SWITCH.            24290000
      *----------------------------------------------------------------*24300000
       3520-CHECK-CURRENT-PRICE.                                        24310000
                                                                        24320000
100404     IF   XST00008-LOC-SKU-STAT-CDE  =  PC-CLEARANCE-STATUS       24330000
100404      AND XST00010-REGN-PRIC-IND NOT = PC-YES                     24340000
100404         IF XST00008-UPC-STAT-CHG-DTE                             24350000
100404                                    < XST00008-UNT-RTL-CHG-DTE    24350100
                   PERFORM 7750-GET-CLR-ITM-1ST-MKDN-PRIC               24360000
                   IF ASC-RPRICE-N (ASC-BLK-SUB ASC-ITEM-SUB)           24370000
                                        >  PPCPRC-RTL-AMT               24380000
                       SET ASC-PRICE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)   24390000
                           ASC-WARNING        TO TRUE                   24400000
                   END-IF                                               24410000
               ELSE                                                     24420000
100404             IF XST00008-UNT-RTL-AMT  NOT =                       24430000
                              ASC-RPRICE-N (ASC-BLK-SUB ASC-ITEM-SUB)   24440000
                       SET ASC-PRICE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)   24450000
                           ASC-WARNING        TO TRUE                   24460000
                   END-IF                                               24470000
               END-IF                                                   24480000
           ELSE                                                         24490000
               IF PV-CUR-RTL-AMT  NOT =                                 24500000
                              ASC-RPRICE-N (ASC-BLK-SUB ASC-ITEM-SUB)   24510000
                       SET ASC-PRICE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB)   24520000
                           ASC-WARNING        TO TRUE                   24530000
               END-IF                                                   24540000
           END-IF.                                                      24550000
                                                                        24560000
       EJECT.                                                           24570000
      ******************************************************************24580000
      *  GENERATE THE KOHL'S INTERNAL UPC NUMBER                        24590000
      ******************************************************************24600000
       3800-SELECT-KOHLS-INTERNAL-UPC.                                  24610000
                                                                        24620000
           MOVE '3800-SELECT-KOHLS-INTERNAL-UPC' TO DP013-PARAGRAPH.    24630000
                                                                        24640000
           EXEC SQL                                                     24650000
               SELECT UPC_NBR                                           24660000
100404         INTO  :XST00012-UPC-NBR                                  24670000
100404         FROM   XST_UPC                                           24680000
100404         WHERE  UPC_ID   =  :SKXREF-INTR-UPC-ID                   24690000
100404           AND  LAST_ACTN_CDE IN ('A', 'U')                       24700000
           END-EXEC.                                                    24710000
                                                                        24720000
           EVALUATE TRUE                                                24730000
               WHEN SQLCODE = ZERO                                      24740000
100404             MOVE XST00012-UPC-NBR TO DK-UPC-NBR                  24750000
                                            PV-KOHLS-INTERNAL-UPC-NBR   24760000
               WHEN OTHER                                               24770000
                   MOVE 'SELECT-KOHLS-INTERNAL-UPC'                     24780000
                                       TO DP013-MESSAGE-TEXT (1)        24790000
                   MOVE SQLCA              TO DP013-SQLCA               24800000
100404             MOVE 'XST_UPC'          TO DP013-DB2-TABLE-NAME (1)  24810000
                   SET DP013-DB2-ABEND TO TRUE                          24820000
                   PERFORM DP013-0000-PROCESS-ABEND                     24830000
           END-EVALUATE.                                                24840000
                                                                        24850000
       EJECT.                                                           24860000
051203******************************************************************24870000
051203** VALIDATE EMBEDDED DEPT AND CLASS IN DUMMY SKU                **24880000
051203******************************************************************24890000
051203 3900-VALIDATE-SKU-DEPT-CLASS.                                    24900000
                                                                        24910000
051203     MOVE '3900-VALIDATE-SKU-DEPT-CLASS' TO DP013-PARAGRAPH.      24920000
                                                                        24930000
051203     MOVE PV-DUMMY-SKU-DEPT TO SKXREF-DEPT.                       24940000
051203     MOVE PV-DUMMY-SKU-CL-9 TO SKXREF-SUBCLASS.                   24950000
051203     MOVE ZERO              TO PV-DUMMY-SKU-CL-2.                 24960000
051203     MOVE PV-DUMMY-SKU-CL-9 TO SKXREF-CLASS.                      24970000
                                                                        24980000
051203     PERFORM 3910-VALIDATE-DEPT-CLASS.                            24990000
                                                                        25000000
051203 EJECT.                                                           25010000
051203******************************************************************25020000
051203**VALIDATE EMBEDDED DEPT AND CLASS IN UPC                         25030000
051203******************************************************************25040000
051203 3905-VALIDATE-UPC-DEPT-CLASS.                                    25050000
                                                                        25060000
051203     MOVE PV-KOHLS-DEPT     TO SKXREF-DEPT.                       25070000
051203     MOVE PV-KOHLS-CL-9     TO SKXREF-SUBCLASS.                   25080000
051203     MOVE ZERO              TO PV-KOHLS-CL-2.                     25090000
051203     MOVE PV-KOHLS-CL-9     TO SKXREF-CLASS.                      25100000
                                                                        25110000
051203     PERFORM 3910-VALIDATE-DEPT-CLASS.                            25120000
                                                                        25130000
051203 EJECT.                                                           25140000
051203******************************************************************25150000
051203**VALIDATE DEPT AND CLASS                                         25160000
051203******************************************************************25170000
051203 3910-VALIDATE-DEPT-CLASS.                                        25180000
                                                                        25190000
051203     MOVE '3910-VALIDATE-DEPT-CLASS' TO DP013-PARAGRAPH.          25200000
                                                                        25210000
051203     PERFORM WITH TEST AFTER                                      25220000
051203             VARYING PV-RETRY-COUNT FROM 1 BY 1                   25230000
051203             UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                25240000
051203                OR SQLCODE = ZERO                                 25250000
051203                OR SQLCODE = +100                                 25260000
                                                                        25270000
051203         EXEC SQL                                                 25280000
051203              SELECT COUNT(*)                                     25290000
051203              INTO  :PV-READ-COUNT                                25300000
051203              FROM   TSKXREF                                      25310000
051203              WHERE  DEPT     = :SKXREF-DEPT                      25320000
051203                 AND CLASS    = :SKXREF-CLASS                     25330000
051203                 AND SUBCLASS = :SKXREF-SUBCLASS                  25340000
051203         END-EXEC                                                 25350000
                                                                        25360000
051203         EVALUATE TRUE                                            25370000
051203             WHEN SQLCODE = ZERO                                  25380000
051203                 IF PV-READ-COUNT > +0                            25390000
051203                     SET PS-FOUND-DUMMY-UPC-Y TO TRUE             25400000
051203                     SET PS-VALID-DEPT-CL     TO TRUE             25410000
051203                 ELSE                                             25420000
051203                     SET PS-FOUND-DUMMY-UPC-N TO TRUE             25430000
051203                     SET PS-INVALID-DEPT-CL   TO TRUE             25440000
051203                 END-IF                                           25450000
051203             WHEN SQLCODE = +100                                  25460000
051203                  SET PS-INVALID-DEPT-CL      TO TRUE             25470000
051203                  SET PS-FOUND-DUMMY-UPC-N    TO TRUE             25480000
051203             WHEN SQLCODE = -904                                  25490000
051203             WHEN SQLCODE = -913                                  25500000
051203                 CONTINUE                                         25510000
051203             WHEN OTHER                                           25520000
051203                 MOVE 'READ A ROW FROM TSKXREF'                   25530000
051203                                     TO DP013-MESSAGE-TEXT (1)    25540000
051203                 MOVE SQLCA          TO DP013-SQLCA               25550000
051203                 MOVE 'TSKXREF'      TO DP013-DB2-TABLE-NAME (1)  25560000
051203                 SET DP013-DB2-ABEND TO TRUE                      25570000
051203                 PERFORM DP013-0000-PROCESS-ABEND                 25580000
051203         END-EVALUATE                                             25590000
051203     END-PERFORM.                                                 25600000
                                                                        25610000
051203     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          25620000
051203         MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT '    25630000
051203                                     TO DP013-MESSAGE-TEXT (1)    25640000
051203         MOVE 'DATA FROM TSKXREF'    TO DP013-MESSAGE-TEXT (2)    25650000
051203         MOVE SQLCA                  TO DP013-SQLCA               25660000
051203         MOVE 'TSKXREF'              TO DP013-DB2-TABLE-NAME (1)  25670000
051203         SET DP013-DB2-ABEND         TO TRUE                      25680000
051203         PERFORM DP013-0000-PROCESS-ABEND                         25690000
051203     END-IF.                                                      25700000
                                                                        25710000
051203 EJECT.                                                           25720000
051203******************************************************************25730000
051203** CONVERT DUMMY SKU TO DUMMY UPC                               **25740000
051203******************************************************************25750000
051203 3910-SELECT-DUMMY-UPC.                                           25760000
                                                                        25770000
051203     SET DP040I-GEN-INTERNAL-UPC-OPTION TO TRUE.                  25780000
                                                                        25790000
051203     CALL DP040I-UPC-CHECK-DIGIT-WO-IUPC                          25800099
051203                     USING DP040I-UPC-CHECK-DIGIT-PARMS           25801099
                                                                        25810000
051203     IF DP040I-NO-ERROR-DETECTED                                  25820000
051203         SET PS-FOUND-DUMMY-UPC-Y TO TRUE                         25830000
051203         MOVE DP040I-UPC-CODE TO DK-UPC-NBR                       25840000
051203                         ASC-UPC-N (ASC-BLK-SUB ASC-ITEM-SUB)     25850000
051203                         ASC-KOHLS-UPC (ASC-BLK-SUB ASC-ITEM-SUB) 25860000
051203     ELSE                                                         25870000
051203         SET PS-FOUND-DUMMY-UPC-N TO TRUE                         25880000
051203     END-IF.                                                      25890000
                                                                        25900000
051203 EJECT.                                                           25910000
      *----------------------------------------------------------------*25920000
      *    INITIALIZE BOTH BLOCKS IN THE ARRAY.                        *25930000
      *    INITIALIZE ALL COUNTERS AND FLAGS.                          *25940000
      *    READ THE DATA BASE FOR THE 1ST TIME AND FILL UP THE ARRAY.  *25950000
      *    DISPLAY THE PANEL TO USER.                                  *25960000
      *----------------------------------------------------------------*25970000
       4000-BUILD-INITIAL-PANEL.                                        25980000
                                                                        25990000
           INITIALIZE                  ASC-BLOCK-ENTRIES (1)            26000000
                                       ASC-BLOCK-ENTRIES (2).           26010000
           MOVE +1                 TO ASC-BLK-SUB.                      26020000
           SET ASC-ITEMS-LEFT-ON-DB TO TRUE.                            26030000
                                                                        26040000
           MOVE +0                 TO ASC-ITEM-SUB                      26050000
                                      ASC-NUMBER-OF-ITEMS-READ          26060000
                                      ASC-HIGHEST-BLOCK-WRITTEN         26070000
                                      ASC-ITEM-AT-TOP-OF-PANEL          26080000
                                      ASC-ITEMS-DISPLAYED.              26090000
                                                                        26100000
           PERFORM 4100-GET-TRANSFER.                                   26110000
                                                                        26120000
           IF ASC-RETAIL-XFER                                           26130000
               PERFORM 4010-OPEN-RETAIL-CURSOR                          26140000
               PERFORM 4300-READ-ITEMS-FROM-DB                          26150000
               PERFORM 4020-CLOSE-RETAIL-CURSOR                         26160000
           ELSE                                                         26170000
               PERFORM 4050-OPEN-NON-RETAIL-CURSOR                      26180000
               PERFORM 4350-READ-ITEMS-FROM-DB                          26190000
               PERFORM 4060-CLOSE-NON-RETAIL-CURSOR                     26200000
           END-IF.                                                      26210000
                                                                        26220000
           MOVE +1                   TO  PV-TOP-ITEM                    26230000
           IF  ASC-NUMBER-OF-ITEMS-READ = ZERO                          26240000
               SET DP020-NEXT-ACT-APPL-ERROR TO TRUE                    26250000
               SET DP020-MSG-FATAL   TO  TRUE                           26260000
               MOVE PC-TSYMSG-00050  TO  DP020-MSG-NUMBER               26270000
           ELSE                                                         26280000
               IF ASC-RETAIL-XFER                                       26290000
                   MOVE -1               TO MR-A-RQTYL (1)              26300000
               ELSE                                                     26310000
                   MOVE -1               TO MR-B-RQTYL (1)              26320000
               END-IF                                                   26330000
               SET DP030-SET-CURSOR-APPL-1 TO TRUE                      26340000
               PERFORM 3000-EDIT-DATA-IN-COMMAREA                       26350000
               PERFORM 4400-MOVE-COMMAREA-TO-SCREEN                     26360000
           END-IF.                                                      26370000
                                                                        26380000
       EJECT.                                                           26390000
      *----------------------------------------------------------------*26400000
      * OPEN THE TRANSFER ITEM CURSOR - RETAIL.                        *26410000
      *----------------------------------------------------------------*26420000
       4010-OPEN-RETAIL-CURSOR.                                         26430000
                                                                        26440000
           MOVE '4010-OPEN-RETAIL-CURSOR' TO DP013-PARAGRAPH.           26450000
                                                                        26460000
           PERFORM WITH TEST AFTER                                      26470000
                   VARYING PV-RETRY-COUNT                               26480000
                   FROM 1 BY 1                                          26490000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                26500000
                      OR SQLCODE = ZERO                                 26510000
                                                                        26520000
                   EXEC SQL                                             26530000
                        OPEN RTL-ITEM-CSR                               26540000
                   END-EXEC                                             26550000
                                                                        26560000
               EVALUATE TRUE                                            26570000
                   WHEN SQLCODE = ZERO                                  26580000
                   WHEN SQLCODE = -904                                  26590000
                   WHEN SQLCODE = -913                                  26600000
                       CONTINUE                                         26610000
                   WHEN OTHER                                           26620000
                       MOVE 'OPEN TRANSFER ITEM CURSOR - '              26630000
                                         TO DP013-MESSAGE-TEXT (1)      26640000
                       MOVE SQLCA        TO DP013-SQLCA                 26650000
                       MOVE 'TTFITEM '   TO DP013-DB2-TABLE-NAME (1)    26660000
                       SET DP013-DB2-ABEND                              26670000
                           DP013-XCTL-DISPLAY-RESTART TO TRUE           26680000
                       PERFORM DP013-0000-PROCESS-ABEND                 26690000
               END-EVALUATE                                             26700000
           END-PERFORM.                                                 26710000
                                                                        26720000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          26730000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   26740000
                                         TO DP013-MESSAGE-TEXT (1)      26750000
               MOVE SQLCA                TO DP013-SQLCA                 26760000
               MOVE 'TTFITEM '           TO DP013-DB2-TABLE-NAME (1)    26770000
               SET DP013-DB2-ABEND                                      26780000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   26790000
               PERFORM DP013-0000-PROCESS-ABEND                         26800000
           END-IF.                                                      26810000
                                                                        26820000
       EJECT.                                                           26830000
      *----------------------------------------------------------------*26840000
      * CLOSE THE TRANSFER ITEM CURSOR.                                *26850000
      *----------------------------------------------------------------*26860000
       4020-CLOSE-RETAIL-CURSOR.                                        26870000
                                                                        26880000
           MOVE '4020-CLOSE-RETAIL-CURSOR' TO DP013-PARAGRAPH.          26890000
                                                                        26900000
           EXEC SQL                                                     26910000
               CLOSE RTL-ITEM-CSR                                       26920000
           END-EXEC                                                     26930000
                                                                        26940000
           EVALUATE TRUE                                                26950000
               WHEN SQLCODE = ZERO                                      26960000
                   CONTINUE                                             26970000
               WHEN OTHER                                               26980000
                   MOVE 'CLOSE TRANSFER ITEM CURSOR '                   26990000
                                     TO DP013-MESSAGE-TEXT (1)          27000000
                   MOVE SQLCA        TO DP013-SQLCA                     27010000
                   MOVE 'TTFITEM '   TO DP013-DB2-TABLE-NAME (1)        27020000
                   SET DP013-DB2-ABEND                                  27030000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               27040000
                   PERFORM DP013-0000-PROCESS-ABEND                     27050000
           END-EVALUATE.                                                27060000
                                                                        27070000
       EJECT.                                                           27080000
      *----------------------------------------------------------------*27090000
      * OPEN THE TRANSFER ITEM CURSOR - NON-RETAIL.                    *27100000
      *----------------------------------------------------------------*27110000
       4050-OPEN-NON-RETAIL-CURSOR.                                     27120000
                                                                        27130000
           MOVE '4050-OPEN-RETAIL-CURSOR' TO DP013-PARAGRAPH.           27140000
                                                                        27150000
           PERFORM WITH TEST AFTER                                      27160000
                   VARYING PV-RETRY-COUNT                               27170000
                   FROM 1 BY 1                                          27180000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                27190000
                         OR SQLCODE = ZERO                              27200000
                                                                        27210000
                   EXEC SQL                                             27220000
                        OPEN NON-RTL-ITEM-CSR                           27230000
                   END-EXEC                                             27240000
                                                                        27250000
               EVALUATE TRUE                                            27260000
                   WHEN SQLCODE = ZERO                                  27270000
                   WHEN SQLCODE = -904                                  27280000
                   WHEN SQLCODE = -913                                  27290000
                       CONTINUE                                         27300000
                   WHEN OTHER                                           27310000
                       MOVE 'OPEN TRANSFER ITEM CURSOR - '              27320000
                                         TO DP013-MESSAGE-TEXT (1)      27330000
                       MOVE SQLCA        TO DP013-SQLCA                 27340000
                       MOVE 'TTFITEM '   TO DP013-DB2-TABLE-NAME (1)    27350000
                       SET DP013-DB2-ABEND                              27360000
                           DP013-XCTL-DISPLAY-RESTART TO TRUE           27370000
                       PERFORM DP013-0000-PROCESS-ABEND                 27380000
               END-EVALUATE                                             27390000
           END-PERFORM.                                                 27400000
                                                                        27410000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          27420000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO OPEN CSR'   27430000
                                         TO DP013-MESSAGE-TEXT (1)      27440000
               MOVE SQLCA                TO DP013-SQLCA                 27450000
               MOVE 'TTFITEM '           TO DP013-DB2-TABLE-NAME (1)    27460000
               SET DP013-DB2-ABEND                                      27470000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   27480000
               PERFORM DP013-0000-PROCESS-ABEND                         27490000
           END-IF.                                                      27500000
                                                                        27510000
       EJECT.                                                           27520000
      *----------------------------------------------------------------*27530000
      * CLOSE THE TRANSFER ITEM CURSOR.                                *27540000
      *----------------------------------------------------------------*27550000
       4060-CLOSE-NON-RETAIL-CURSOR.                                    27560000
                                                                        27570000
           MOVE '4060-CLOSE-NON-RETAIL-CURSOR' TO DP013-PARAGRAPH.      27580000
                                                                        27590000
           EXEC SQL                                                     27600000
               CLOSE NON-RTL-ITEM-CSR                                   27610000
           END-EXEC                                                     27620000
                                                                        27630000
           EVALUATE TRUE                                                27640000
               WHEN SQLCODE = ZERO                                      27650000
                   CONTINUE                                             27660000
               WHEN OTHER                                               27670000
                   MOVE 'CLOSE TRANSFER ITEM CURSOR '                   27680000
                                     TO DP013-MESSAGE-TEXT (1)          27690000
                   MOVE SQLCA        TO DP013-SQLCA                     27700000
                   MOVE 'TTFITEM '   TO DP013-DB2-TABLE-NAME (1)        27710000
                   SET DP013-DB2-ABEND                                  27720000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               27730000
                   PERFORM DP013-0000-PROCESS-ABEND                     27740000
           END-EVALUATE.                                                27750000
                                                                        27760000
       EJECT.                                                           27770000
      *----------------------------------------------------------------*27780000
      *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *27790000
      *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *27800000
      *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *27810000
      *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *27820000
      *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *27830000
      *                                                                *27840000
      *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *27850000
      *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *27860000
      *    UPON INITIALIZATION.                                        *27870000
      *                   RETAIL TRANSFERS.                            *27880000
      *----------------------------------------------------------------*27890000
       4300-READ-ITEMS-FROM-DB.                                         27900000
                                                                        27910000
           PERFORM VARYING PV-READ-COUNT                                27920000
                   FROM 1 BY 1                                          27930000
                   UNTIL PV-READ-COUNT > PC-MAX-ITEMS                   27940000
                      OR ASC-NO-ITEMS-LEFT-ON-DB                        27950000
                                                                        27960000
               PERFORM 4310-FETCH-RETAIL                                27970000
                                                                        27980000
               IF  ASC-ITEMS-LEFT-ON-DB                                 27990000
                   IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                28000000
                       ADD +1            TO ASC-ITEM-SUB                28010000
                   ELSE                                                 28020000
                       ADD +1            TO ASC-BLK-SUB                 28030000
                       MOVE +1           TO ASC-ITEM-SUB                28040000
                       IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         28050000
                           MOVE +1       TO ASC-BLK-SUB                 28060000
                           SET ASC-BLOCK-MODIFIED (1)                   28070000
                                         TO TRUE                        28080000
                           PERFORM 5100-WRITE-TEMP-STORAGE              28090000
                           MOVE ASC-BLOCK-ENTRIES                       28100000
                                     (PC-MAX-BLOCKS-IN-ARRAY)           28110000
                                      TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 28120000
                           ADD +1        TO ASC-BLK-SUB                 28130000
                           INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   28140000
                           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      28150000
                                         TO TRUE                        28160000
                       END-IF                                           28170000
                   END-IF                                               28180000
                   ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    28190000
                   MOVE ASC-NUMBER-OF-ITEMS-READ                        28200000
                                         TO ASC-LIST-ITEM-NUMBER        28210000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 28220000
                   MOVE TFITEM-XFER-LNE-NBR              TO             28230000
                           ASC-LINE          (ASC-BLK-SUB ASC-ITEM-SUB) 28240000
                   MOVE SKXREF-DEPT                      TO             28250000
                           ASC-DEPT          (ASC-BLK-SUB ASC-ITEM-SUB) 28260000
                   MOVE SKXREF-CLASS                     TO             28270000
                           ASC-CLASS         (ASC-BLK-SUB ASC-ITEM-SUB) 28280000
                   MOVE SKXREF-SUBCLASS                  TO             28290000
                           ASC-SUBCLASS      (ASC-BLK-SUB ASC-ITEM-SUB) 28300000
051203             IF  TFITEM-ITM-NBR = ZEROS                           28310000
051203                 MOVE TFITEM-SCN-UPC-NBR TO                       28320000
051203                     ASC-UPC-N         (ASC-BLK-SUB ASC-ITEM-SUB) 28330000
051203                     ASC-KOHLS-UPC     (ASC-BLK-SUB ASC-ITEM-SUB) 28340000
051203             ELSE                                                 28350000
                   MOVE TFITEM-KOHLS-UPC-NBR             TO             28360000
                           ASC-UPC-N         (ASC-BLK-SUB ASC-ITEM-SUB) 28370000
                           ASC-KOHLS-UPC     (ASC-BLK-SUB ASC-ITEM-SUB) 28380000
051203             END-IF                                               28390000
                   MOVE TFITEM-ITM-NBR                   TO             28400000
                           ASC-ITEM-NBR      (ASC-BLK-SUB ASC-ITEM-SUB) 28410000
                           DK-ITEM-NBR                                  28420000
                   PERFORM 7510-SELECT-SKU-BY-ITEM-NBR                  28430000
                   MOVE TFITEM-XFER-QTY                  TO             28440000
                           ASC-TQTY          (ASC-BLK-SUB ASC-ITEM-SUB) 28450000
                           ASC-RQTY-N        (ASC-BLK-SUB ASC-ITEM-SUB) 28460000
                   MOVE TFITEM-XFER-PRIC-AMT             TO             28470000
                           ASC-TPRICE        (ASC-BLK-SUB ASC-ITEM-SUB) 28480000
                           ASC-RPRICE-N      (ASC-BLK-SUB ASC-ITEM-SUB) 28490000
                   MOVE TFITEM-CPLD-RTL-PRIC-AMT         TO             28500000
                           ASC-FPRICE        (ASC-BLK-SUB ASC-ITEM-SUB) 28510000
                   MOVE TFITEM-RNBR-SKU-IND              TO             28520000
                        ASC-RNBR-SKU-IND     (ASC-BLK-SUB ASC-ITEM-SUB) 28530000
                   MOVE TFITEM-ITM-PRIC-MLT-IND          TO             28540000
                        ASC-GROUP-PRICED-SW  (ASC-BLK-SUB ASC-ITEM-SUB) 28550000
                   SET ASC-XFERED-ITEM       (ASC-BLK-SUB ASC-ITEM-SUB) 28560000
                                                         TO TRUE        28570000
               END-IF                                                   28580000
           END-PERFORM.                                                 28590000
                                                                        28600000
           IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          28610000
               MOVE +1               TO ASC-BLK-SUB                     28620000
               PERFORM 5100-WRITE-TEMP-STORAGE                          28630000
               ADD +1                TO ASC-BLK-SUB                     28640000
               PERFORM 5100-WRITE-TEMP-STORAGE                          28650000
               MOVE 1                TO ASC-BLK-SUB                     28660000
                                        PV-BLOCK-NUMBER                 28670000
               PERFORM 4410-READ-TEMP-STORAGE                           28680000
               IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             28690000
                   MOVE 2            TO ASC-BLK-SUB                     28700000
                                        PV-BLOCK-NUMBER                 28710000
                   PERFORM 4410-READ-TEMP-STORAGE                       28720000
               END-IF                                                   28730000
           END-IF.                                                      28740000
                                                                        28750000
       EJECT.                                                           28760000
      *----------------------------------------------------------------*28770000
      *    FETCH THE TRANSFER ITEM CURSOR - RETAIL                     *28780000
      *----------------------------------------------------------------*28790000
       4310-FETCH-RETAIL.                                               28800000
                                                                        28810000
           MOVE '4310-FETCH-RETAIL-CURSOR' TO DP013-PARAGRAPH.          28820000
                                                                        28830000
           EXEC SQL                                                     28840000
               FETCH RTL-ITEM-CSR                                       28850000
               INTO   :TFITEM-XFER-LNE-NBR                              28860000
                    , :TFITEM-CPLD-RTL-PRIC-AMT                         28870000
                    , :TFITEM-KOHLS-UPC-NBR                             28880000
051203              , :TFITEM-SCN-UPC-NBR                               28890000
                    , :TFITEM-ITM-NBR                                   28900000
                    , :TFITEM-XFER-PRIC-AMT                             28910000
                    , :TFITEM-XFER-QTY                                  28920000
                    , :TFITEM-ITM-PRIC-MLT-IND                          28930000
                    , :TFITEM-RNBR-SKU-IND                              28940000
           END-EXEC                                                     28950000
                                                                        28960000
           EVALUATE TRUE                                                28970000
               WHEN SQLCODE = ZERO                                      28980000
051203              IF  TFITEM-ITM-NBR = 0                              28990000
051203                  MOVE TFITEM-SCN-UPC-NBR  TO PV-HOLD-UPC-NBR-9   29000000
051203                  MOVE PV-KOHLS-DEPT       TO SKXREF-DEPT         29010000
051203                  MOVE PV-KOHLS-CL-9       TO SKXREF-SUBCLASS     29020000
051203                  MOVE ZERO                TO PV-KOHLS-CL-2       29030000
051203                  MOVE PV-KOHLS-CL-9       TO SKXREF-CLASS        29040000
051203              ELSE                                                29050000
                        PERFORM 4320-SELECT-DEPT-CLASS                  29060000
051203              END-IF                                              29070000
               WHEN SQLCODE = +100                                      29080000
                    SET ASC-NO-ITEMS-LEFT-ON-DB                         29090000
                                         TO TRUE                        29100000
               WHEN OTHER                                               29110000
                    MOVE 'FETCH TRANSFER ITEM CURSOR'                   29120000
                                     TO DP013-MESSAGE-TEXT (1)          29130000
                    MOVE 'TTFITEM '  TO DP013-DB2-TABLE-NAME (1)        29140000
                    MOVE SQLCA       TO DP013-SQLCA                     29150000
                    SET DP013-DB2-ABEND                                 29160000
                                     TO TRUE                            29170000
                    PERFORM DP013-0000-PROCESS-ABEND                    29180000
           END-EVALUATE.                                                29190000
                                                                        29200000
       EJECT.                                                           29210000
      ******************************************************************29220000
       4320-SELECT-DEPT-CLASS.                                          29230000
                                                                        29240000
           MOVE '4320-SELECT-DEPT-CLASS' TO DP013-PARAGRAPH.            29250000
                                                                        29260000
           EXEC SQL                                                     29270000
               SELECT  DEPT,                                            29280000
                       CLASS,                                           29290000
                       SUBCLASS                                         29300000
                 INTO  :SKXREF-DEPT,                                    29310000
                       :SKXREF-CLASS,                                   29320000
                       :SKXREF-SUBCLASS                                 29330000
                 FROM  TSKXREF                                          29340000
                WHERE  ITM_NBR     =  :TFITEM-ITM-NBR                   29350000
           END-EXEC                                                     29360000
                                                                        29370000
           EVALUATE TRUE                                                29380000
               WHEN SQLCODE = ZERO                                      29390000
                   CONTINUE                                             29400000
               WHEN SQLCODE = +100                                      29410000
                   MOVE ZEROS TO SKXREF-DEPT                            29420000
                   MOVE ZEROS TO SKXREF-SUBCLASS                        29430000
                   MOVE ZEROS TO SKXREF-CLASS                           29440000
               WHEN OTHER                                               29450000
                   MOVE 'READ A ROW FROM TSKXREF'                       29460000
                                       TO DP013-MESSAGE-TEXT (1)        29470000
                   MOVE SQLCA              TO DP013-SQLCA               29480000
                   MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)  29490000
                   SET DP013-DB2-ABEND TO TRUE                          29500000
                   PERFORM DP013-0000-PROCESS-ABEND                     29510000
           END-EVALUATE.                                                29520000
                                                                        29530000
       EJECT.                                                           29540000
      *----------------------------------------------------------------*29550000
      *    READ THE ITEMS FROM THE DATA BASE AND MOVE THEM INTO THE    *29560000
      *    BLOCKS IN THE ARRAY.  WHENEVER BOTH BLOCKS BECOME FULL,     *29570000
      *    WRITE OUT THE 1ST BLOCK TO TEMPORARY STORAGE, MOVE THE 2ND  *29580000
      *    BLOCK IN THE ARRAY TO THE 1ST BLOCK, AND INITIALIZE THE     *29590000
      *    2ND BLOCK MAKING IT AVAILABLE TO BE USED.                   *29600000
      *                                                                *29610000
      *    DUE TO THE SIZE OF THE TABLE, AND THE ORDER IN WHICH THE    *29620000
      *    ROWS ARE SORTED, THE ENTIRE TABLE IS READ INTO THE PROGRAM  *29630000
      *    UPON INITIALIZATION.                                        *29640000
      *               NON-RETAIL TRANSFERS.                            *29650000
      *----------------------------------------------------------------*29660000
       4350-READ-ITEMS-FROM-DB.                                         29670000
                                                                        29680000
           PERFORM VARYING PV-READ-COUNT                                29690000
                   FROM 1 BY 1                                          29700000
                   UNTIL PV-READ-COUNT > PC-MAX-ITEMS                   29710000
                      OR ASC-NO-ITEMS-LEFT-ON-DB                        29720000
                                                                        29730000
               PERFORM 4360-FETCH-NON-RETAIL                            29740000
                                                                        29750000
               IF  ASC-ITEMS-LEFT-ON-DB                                 29760000
                   IF  ASC-ITEM-SUB < PC-ITEMS-PER-PANEL                29770000
                       ADD +1            TO ASC-ITEM-SUB                29780000
                   ELSE                                                 29790000
                       ADD +1            TO ASC-BLK-SUB                 29800000
                       MOVE +1           TO ASC-ITEM-SUB                29810000
                       IF  ASC-BLK-SUB > PC-MAX-BLOCKS-IN-ARRAY         29820000
                           MOVE +1       TO ASC-BLK-SUB                 29830000
                           SET ASC-BLOCK-MODIFIED (1)                   29840000
                                         TO TRUE                        29850000
                           PERFORM 5100-WRITE-TEMP-STORAGE              29860000
                           MOVE ASC-BLOCK-ENTRIES                       29870000
                                     (PC-MAX-BLOCKS-IN-ARRAY)           29880000
                                      TO ASC-BLOCK-ENTRIES(ASC-BLK-SUB) 29890000
                           ADD +1        TO ASC-BLK-SUB                 29900000
                           INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)   29910000
                           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB)      29920000
                                         TO TRUE                        29930000
                       END-IF                                           29940000
                   END-IF                                               29950000
                   ADD +1                TO ASC-NUMBER-OF-ITEMS-READ    29960000
                   MOVE ASC-NUMBER-OF-ITEMS-READ                        29970000
                                         TO ASC-LIST-ITEM-NUMBER        29980000
                                             (ASC-BLK-SUB ASC-ITEM-SUB) 29990000
                   MOVE TFITEM-XFER-LNE-NBR              TO             30000000
                           ASC-LINE          (ASC-BLK-SUB ASC-ITEM-SUB) 30010000
                   MOVE TFITEM-NRTL-DEPT-NBR             TO             30020000
                           ASC-DEPT          (ASC-BLK-SUB ASC-ITEM-SUB) 30030000
                   MOVE TFITEM-NRTL-1ST-LNE-DESC         TO             30040000
                           ASC-NRTL-DESC1    (ASC-BLK-SUB ASC-ITEM-SUB) 30050000
                   MOVE TFITEM-NRTL-2ND-LNE-DESC         TO             30060000
                           ASC-NRTL-DESC2    (ASC-BLK-SUB ASC-ITEM-SUB) 30070000
                   MOVE TFITEM-NRTL-FIXT-ID              TO             30080000
                           ASC-FIXTURE       (ASC-BLK-SUB ASC-ITEM-SUB) 30090000
                   MOVE TFITEM-XFER-QTY                  TO             30100000
                           ASC-TQTY          (ASC-BLK-SUB ASC-ITEM-SUB) 30110000
                           ASC-RQTY-N        (ASC-BLK-SUB ASC-ITEM-SUB) 30120000
                   SET ASC-XFERED-ITEM       (ASC-BLK-SUB ASC-ITEM-SUB) 30130000
                                                         TO TRUE        30140000
               END-IF                                                   30150000
           END-PERFORM.                                                 30160000
                                                                        30170000
           IF  ASC-NUMBER-OF-ITEMS-READ > ZERO                          30180000
               MOVE +1               TO ASC-BLK-SUB                     30190000
               PERFORM 5100-WRITE-TEMP-STORAGE                          30200000
               ADD +1                TO ASC-BLK-SUB                     30210000
               PERFORM 5100-WRITE-TEMP-STORAGE                          30220000
                                                                        30230000
               MOVE 1                TO ASC-BLK-SUB                     30240000
                                        PV-BLOCK-NUMBER                 30250000
               PERFORM 4410-READ-TEMP-STORAGE                           30260000
               IF  ASC-HIGHEST-BLOCK-WRITTEN GREATER THAN 1             30270000
                   MOVE 2            TO ASC-BLK-SUB                     30280000
                                        PV-BLOCK-NUMBER                 30290000
                   PERFORM 4410-READ-TEMP-STORAGE                       30300000
               END-IF                                                   30310000
           END-IF.                                                      30320000
                                                                        30330000
       EJECT.                                                           30340000
      *----------------------------------------------------------------*30350000
      *    FETCH THE TRANSFER ITEM CURSOR - NON-RETAIL                 *30360000
      *----------------------------------------------------------------*30370000
       4360-FETCH-NON-RETAIL.                                           30380000
                                                                        30390000
           MOVE '4360-FETCH-NON-RETAIL-CURSOR' TO DP013-PARAGRAPH.      30400000
                                                                        30410000
           EXEC SQL                                                     30420000
               FETCH NON-RTL-ITEM-CSR                                   30430000
               INTO   :TFITEM-XFER-LNE-NBR                              30440000
                    , :TFITEM-NRTL-1ST-LNE-DESC                         30450000
                    , :TFITEM-NRTL-2ND-LNE-DESC                         30460000
                    , :TFITEM-NRTL-FIXT-ID                              30470000
                    , :TFITEM-NRTL-DEPT-NBR                             30480000
                    , :TFITEM-XFER-QTY                                  30490000
           END-EXEC                                                     30500000
                                                                        30510000
           EVALUATE TRUE                                                30520000
               WHEN SQLCODE = ZERO                                      30530000
                    CONTINUE                                            30540000
               WHEN SQLCODE = +100                                      30550000
                    SET ASC-NO-ITEMS-LEFT-ON-DB                         30560000
                                         TO TRUE                        30570000
               WHEN OTHER                                               30580000
                    MOVE 'FETCH TRANSFER ITEM CURSOR'                   30590000
                                     TO DP013-MESSAGE-TEXT (1)          30600000
                    MOVE 'TTFITEM '  TO DP013-DB2-TABLE-NAME (1)        30610000
                    MOVE SQLCA       TO DP013-SQLCA                     30620000
                    SET DP013-DB2-ABEND                                 30630000
                                     TO TRUE                            30640000
                    PERFORM DP013-0000-PROCESS-ABEND                    30650000
           END-EVALUATE.                                                30660000
                                                                        30670000
       EJECT                                                            30680000
      *----------------------------------------------------------------*30690000
      * SELECT DATA FROM THE TRANSFER TABLES                            30700000
      *----------------------------------------------------------------*30710000
       4100-GET-TRANSFER.                                               30720000
                                                                        30730000
           MOVE '4100-GET-TRANSFER'  TO DP013-PARAGRAPH.                30740000
                                                                        30750000
           PERFORM WITH TEST AFTER                                      30760000
                   VARYING PV-RETRY-COUNT                               30770000
                   FROM 1 BY 1                                          30780000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                30790000
                         OR SQLCODE = ZERO                              30800000
                                                                        30810000
               EXEC SQL                                                 30820000
                   SELECT X.FR_STR_NBR                                  30830000
                         ,X.TO_STR_NBR                                  30840000
                         ,X.LG_TTE_1ST_SEAL_ID                          30850000
                         ,X.LG_TTE_2ND_SEAL_ID                          30860000
                         ,X.SM_TTE_BAG_SEAL_ID                          30870000
                         ,X.TRLR_NBR                                    30880000
                         ,X.TRLR_SEAL_ID                                30890000
                   INTO   :TFMSTR-FR-STR-NBR                            30900000
                         ,:TFMSTR-TO-STR-NBR                            30910000
                         ,:TFMSTR-LG-TTE-1ST-SEAL-ID                    30920000
                         ,:TFMSTR-LG-TTE-2ND-SEAL-ID                    30930000
                         ,:TFMSTR-SM-TTE-BAG-SEAL-ID                    30940000
                         ,:TFMSTR-TRLR-NBR                              30950000
                         ,:TFMSTR-TRLR-SEAL-ID                          30960000
                   FROM   TTFMSTR X                                     30970000
                   WHERE  X.XFER_DKEY_ID   = :DK-XFER-DKEY-ID           30980000
               END-EXEC                                                 30990000
                                                                        31000000
               EVALUATE TRUE                                            31010000
                   WHEN SQLCODE = ZERO                                  31020000
                      SET PS-TRANSFER-FOUND     TO TRUE                 31030000
                      MOVE TFMSTR-FR-STR-NBR    TO ASC-FR-STORE-NBR     31040000
                      MOVE TFMSTR-TO-STR-NBR    TO ASC-TO-STORE-NBR     31050000
                      MOVE TFMSTR-LG-TTE-1ST-SEAL-ID                    31060000
                                              TO ASC-CMP-LG-TOTE-SEAL1  31070000
                      MOVE TFMSTR-LG-TTE-2ND-SEAL-ID                    31080000
                                              TO ASC-CMP-LG-TOTE-SEAL2  31090000
                      MOVE TFMSTR-SM-TTE-BAG-SEAL-ID                    31100000
                                              TO ASC-CMP-SM-TOTE-SEAL   31110000
                      MOVE TFMSTR-TRLR-NBR      TO ASC-CMP-TRAILER-NBR  31120000
                      MOVE TFMSTR-TRLR-SEAL-ID  TO ASC-CMP-TRAILER-SEAL 31130000
                   WHEN SQLCODE = -904                                  31140000
                   WHEN SQLCODE = -913                                  31150000
                       CONTINUE                                         31160000
                   WHEN OTHER                                           31170000
                       MOVE 'SELECT TRANSFER DATA'                      31180000
                                         TO DP013-MESSAGE-TEXT (1)      31190000
                       MOVE SQLCA        TO DP013-SQLCA                 31200000
                       MOVE 'TTFMSTR'    TO DP013-DB2-TABLE-NAME (1)    31210000
                       SET DP013-DB2-ABEND                              31220000
                           DP013-XCTL-DISPLAY-RESTART                   31230000
                                         TO TRUE                        31240000
                       PERFORM DP013-0000-PROCESS-ABEND                 31250000
               END-EVALUATE                                             31260000
           END-PERFORM.                                                 31270000
                                                                        31280000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          31290000
               MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO SELECT'     31300000
                                         TO DP013-MESSAGE-TEXT (1)      31310000
               MOVE 'TRANSFER DATA'      TO DP013-MESSAGE-TEXT (2)      31320000
               MOVE SQLCA                TO DP013-SQLCA                 31330000
               MOVE 'TTFMSTR'            TO DP013-DB2-TABLE-NAME (1)    31340000
               MOVE 'TTFSHCT'            TO DP013-DB2-TABLE-NAME (2)    31350000
               MOVE 'TTFTYCD'            TO DP013-DB2-TABLE-NAME (3)    31360000
               SET DP013-DB2-ABEND                                      31370000
                   DP013-XCTL-DISPLAY-RESTART                           31380000
                                         TO TRUE                        31390000
               PERFORM DP013-0000-PROCESS-ABEND                         31400000
           END-IF.                                                      31410000
                                                                        31420000
       EJECT.                                                           31430000
      *----------------------------------------------------------------*31440000
      * MOVE THE DISPLAYED FIELDS FROM THE COMMAREA TO THE SCREEN.     *31450000
      *----------------------------------------------------------------*31460000
       4400-MOVE-COMMAREA-TO-SCREEN.                                    31470000
                                                                        31480000
           IF  (((PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (1 1))             31490000
               AND (PV-TOP-ITEM > ASC-LIST-ITEM-NUMBER (2 1)))          31500000
               OR  (PV-TOP-ITEM < ASC-LIST-ITEM-NUMBER (1 1)))          31510000
                   MOVE +1    TO ASC-BLK-SUB                            31520000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      31530000
                   ADD +1     TO ASC-BLK-SUB                            31540000
                   PERFORM 5100-WRITE-TEMP-STORAGE                      31550000
                   DIVIDE PV-TOP-ITEM BY PC-ITEMS-PER-PANEL             31560000
                       GIVING PV-BLOCK-NUMBER                           31570000
                       REMAINDER PV-REMAINDER                           31580000
                   IF  PV-REMAINDER > ZERO                              31590000
                       ADD +1 TO PV-BLOCK-NUMBER                        31600000
                   END-IF                                               31610000
                   MOVE +1    TO ASC-BLK-SUB                            31620000
                   PERFORM 4410-READ-TEMP-STORAGE                       31630000
                   ADD +1     TO ASC-BLK-SUB                            31640000
                                 PV-BLOCK-NUMBER                        31650000
                   PERFORM 4410-READ-TEMP-STORAGE                       31660000
           END-IF.                                                      31670000
           MOVE +1            TO ASC-BLK-SUB.                           31680000
           COMPUTE ASC-ITEM-SUB =                                       31690000
               ((PV-TOP-ITEM - ASC-LIST-ITEM-NUMBER (1 1))              31700000
               + PC-ITEMS-PER-PANEL).                                   31710000
                                                                        31720000
           IF  ASC-ITEM-SUB > PC-ITEMS-PER-PANEL                        31730000
               ADD +1         TO ASC-BLK-SUB                            31740000
               SUBTRACT PC-ITEMS-PER-PANEL FROM ASC-ITEM-SUB            31750000
           END-IF.                                                      31760000
                                                                        31770000
           COMPUTE ASC-ITEM-AT-BOT-OF-PANEL =                           31780000
               ((PV-TOP-ITEM + PC-ITEMS-PER-PANEL) - 1).                31790000
           IF ASC-RETAIL-XFER                                           31800000
               PERFORM 4420-FORMAT-LIST-LINES                           31810000
                   VARYING PV-SUB                                       31820000
                   FROM PC-ITEMS-PER-PANEL BY -1                        31830000
                   UNTIL PV-SUB < +1                                    31840000
           ELSE                                                         31850000
               PERFORM 4430-FORMAT-LIST-LINES                           31860000
                   VARYING PV-SUB                                       31870000
                   FROM PC-ITEMS-PER-PANEL BY -1                        31880000
                   UNTIL PV-SUB < +1                                    31890000
           END-IF.                                                      31900000
                                                                        31910000
           COMPUTE ASC-ITEMS-DISPLAYED =                                31920000
               ((ASC-ITEM-AT-BOT-OF-PANEL - PV-TOP-ITEM) + 1).          31930000
           MOVE PV-TOP-ITEM              TO ASC-ITEM-AT-TOP-OF-PANEL    31940000
                                            MR-B-START.                 31950000
           MOVE ASC-ITEM-AT-BOT-OF-PANEL TO MR-A-END.                   31960000
           MOVE ASC-NUMBER-OF-ITEMS-READ TO MR-A-TOTAL.                 31970000
           MOVE ASC-XFER-NBR                   TO MR-A-XFER-NBR.        31980000
           MOVE ASC-RCV-STORE-NBR              TO MR-A-RECV-STR.        31990000
                                                                        32000000
           IF  DP020-MSG-NUMBER-X = SPACE                               32010000
               IF  ASC-ITEM-AT-BOT-OF-PANEL < ASC-NUMBER-OF-ITEMS-READ  32020000
      *            --- MORE ITEMS TO DISPLAY ----                       32030000
                   MOVE PC-TSYMSG-00279  TO DP020-MSG-NUMBER            32040000
                   SET DP020-MSG-INFORMATIONAL TO TRUE                  32050000
               END-IF                                                   32060000
           END-IF.                                                      32070000
           IF ASC-NON-RETAIL-XFER                                       32080000
               MOVE PC-NON-RETAIL-ITEM-MAP-NAME                         32090000
                                       TO DP030-MAP-NAME (1)            32100000
               MOVE LENGTH OF MR-B-NON-RETAIL                           32110000
                                       TO DP030-MAP-LENGTH (1)          32120000
               IF ASC-NO-ERROR                                          32130000
                   SET DP030-SET-CURSOR-APPL-1   TO TRUE                32140000
                   IF ASC-FIRST-LINE-XFERED                             32150000
                       MOVE -1             TO MR-B-RQTYL (1)            32160000
                   ELSE                                                 32170000
                       MOVE -1             TO MR-B-DESCL (1)            32180000
                   END-IF                                               32190000
               END-IF                                                   32200000
           ELSE                                                         32210000
               MOVE PC-RETAIL-ITEM-MAP-NAME TO DP030-MAP-NAME (1)       32220000
               MOVE LENGTH OF MR-A-RETAIL   TO DP030-MAP-LENGTH (1)     32230000
               IF ASC-NO-ERROR                                          32240000
                   SET DP030-SET-CURSOR-APPL-1   TO TRUE                32250000
                   IF ASC-FIRST-LINE-XFERED                             32260000
                       MOVE -1             TO MR-A-RQTYL (1)            32270000
                   ELSE                                                 32280000
051203                 MOVE -1             TO MR-A-UPCL (1)             32290000
                   END-IF                                               32300000
               END-IF                                                   32310000
           END-IF.                                                      32320000
                                                                        32330000
       EJECT.                                                           32340000
      *----------------------------------------------------------------*32350000
      *    READ A BLOCK FROM TEMPORARY STORAGE INTO THE ARRAY.         *32360000
      *----------------------------------------------------------------*32370000
       4410-READ-TEMP-STORAGE.                                          32380000
                                                                        32390000
           MOVE '4410-READ-TEMP-STORAGE' TO DP013-PARAGRAPH.            32400000
                                                                        32410000
           EXEC CICS                                                    32420000
               READQ TS                                                 32430000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          32440000
                   INTO  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               32450000
                   ITEM  (PV-BLOCK-NUMBER)                              32460000
                   RESP  (PV-CICS-RESP)                                 32470000
           END-EXEC.                                                    32480000
                                                                        32490000
           IF  ((PV-CICS-RESP = DFHRESP (NORMAL))                       32500000
             OR (PV-CICS-RESP = DFHRESP (ITEMERR)))                     32510000
               CONTINUE                                                 32520000
           ELSE                                                         32530000
               SET DP013-CICS-ABEND     TO TRUE                         32540000
               SET DP013-NO-ROLLBACK    TO TRUE                         32550000
               MOVE 'ERROR TRYING TO READ FROM TEMP STORAGE QUEUE'      32560000
                                        TO DP013-MESSAGE-TEXT(1)        32570000
               PERFORM DP013-0000-PROCESS-ABEND                         32580000
           END-IF.                                                      32590000
                                                                        32600000
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             32610000
                                                                        32620000
           IF  PV-CICS-RESP = DFHRESP (ITEMERR)                         32630000
               INITIALIZE ASC-BLOCK-ENTRIES (ASC-BLK-SUB)               32640000
           END-IF.                                                      32650000
                                                                        32660000
       EJECT.                                                           32670000
      *----------------------------------------------------------------*32680000
      *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *32690000
      *            RETAIL TRANSFERS                                    *32700000
      *----------------------------------------------------------------*32710000
       4420-FORMAT-LIST-LINES.                                          32720000
                                                                        32730000
           IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      32740000
               SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                32750000
               MOVE SPACE              TO MR-A-LINE-NBR-X (PV-SUB)      32760000
                                          MR-A-DEPT         (PV-SUB)    32770000
                                          MR-A-CLASS        (PV-SUB)    32780000
                                          MR-A-SUBCL        (PV-SUB)    32790000
051203                                    MR-A-UPC        (PV-SUB)      32800000
                                          MR-A-TQTY-X     (PV-SUB)      32810000
                                          MR-A-RQTY       (PV-SUB)      32820000
                                          MR-A-TPRICE-X   (PV-SUB)      32830000
                                          MR-A-RPRICE     (PV-SUB)      32840000
           ELSE                                                         32850000
               MOVE ASC-LINE (ASC-BLK-SUB ASC-ITEM-SUB)                 32860000
                                   TO MR-A-LINE-NBR   (PV-SUB)          32870000
               MOVE ASC-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)                 32880000
                                   TO MR-A-DEPT (PV-SUB)                32890000
               MOVE ASC-CLASS (ASC-BLK-SUB ASC-ITEM-SUB)                32900000
                                   TO MR-A-CLASS (PV-SUB)               32910000
               MOVE ASC-SUBCLASS (ASC-BLK-SUB ASC-ITEM-SUB)             32920000
                                   TO MR-A-SUBCL (PV-SUB)               32930000
051203         MOVE ASC-UPC (ASC-BLK-SUB ASC-ITEM-SUB)                  32940000
051203                             TO MR-A-UPC        (PV-SUB)          32950000
               MOVE ASC-TQTY       (ASC-BLK-SUB ASC-ITEM-SUB)           32960000
                                   TO MR-A-TQTY       (PV-SUB)          32970000
               IF ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES          32980000
                   IF ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) NUMERIC       32990000
                       MOVE ASC-RQTY-N (ASC-BLK-SUB ASC-ITEM-SUB)       33000000
                                   TO MR-A-RQTY-N     (PV-SUB)          33010000
                   ELSE                                                 33020000
                       MOVE ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)         33030000
                                   TO MR-A-RQTY     (PV-SUB)            33040000
                   END-IF                                               33050000
               ELSE                                                     33060000
                   MOVE SPACES     TO MR-A-RQTY       (PV-SUB)          33070000
               END-IF                                                   33080000
               MOVE ASC-TPRICE (ASC-BLK-SUB ASC-ITEM-SUB)               33090000
                                   TO MR-A-TPRICE     (PV-SUB)          33100000
               IF ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES        33110000
                   IF ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB) NUMERIC     33120000
                      INSPECT ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB)     33130000
                         REPLACING LEADING ' ' BY '0'                   33140000
                       MOVE ASC-RPRICE-N (ASC-BLK-SUB ASC-ITEM-SUB)     33150000
                                   TO MR-A-RPRICE-N (PV-SUB)            33160000
                   ELSE                                                 33170000
                       MOVE ASC-RPRICE (ASC-BLK-SUB ASC-ITEM-SUB)       33180000
                                   TO MR-A-RPRICE (PV-SUB)              33190000
                   END-IF                                               33200000
               ELSE                                                     33210000
                   MOVE SPACES     TO MR-A-RPRICE   (PV-SUB)            33220000
               END-IF                                                   33230000
               IF ASC-PRICE-ERROR (ASC-BLK-SUB ASC-ITEM-SUB) AND        33240000
                     ASC-NO-ERROR                                       33250000
                   MOVE DP015-YELLOW      TO MR-A-RPRICEC (PV-SUB)      33260000
                   MOVE DP015-REVERSE     TO MR-A-RPRICEH (PV-SUB)      33270000
                   IF ASC-NO-RECEIVE-REQUEST                            33280000
                       MOVE PC-TSYMSG-01514   TO DP020-MSG-NUMBER       33290000
                       SET DP020-MSG-WARNING  TO TRUE                   33300000
                   END-IF                                               33310000
               END-IF                                                   33320000
           END-IF.                                                      33330000
                                                                        33340000
           IF ASC-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB)                33350000
              MOVE DP015-PRO-NOR-OFF TO     MR-A-DEPTA      (PV-SUB)    33360000
                                            MR-A-CLASSA     (PV-SUB)    33370000
                                            MR-A-SUBCLA     (PV-SUB)    33380000
051203                                      MR-A-UPCA (PV-SUB)          33390000
              MOVE DP015-BLUE        TO     MR-A-DEPTC      (PV-SUB)    33400000
                                            MR-A-CLASSC     (PV-SUB)    33410000
                                            MR-A-SUBCLC     (PV-SUB)    33420000
051203                                      MR-A-UPCC (PV-SUB)          33430000
              MOVE DP015-HL-OFF      TO     MR-A-DEPTH      (PV-SUB)    33440000
                                            MR-A-CLASSH     (PV-SUB)    33450000
                                            MR-A-SUBCLH     (PV-SUB)    33460000
051203                                      MR-A-UPCH (PV-SUB)          33470000
           END-IF.                                                      33480000
                                                                        33490000
           IF PV-SUB = 1 AND ASC-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB) 33500000
               SET ASC-FIRST-LINE-XFERED    TO TRUE                     33510000
           ELSE                                                         33520000
               SET ASC-FIRST-LINE-ADDED     TO TRUE                     33530000
           END-IF.                                                      33540000
                                                                        33550000
           SUBTRACT +1 FROM ASC-ITEM-SUB                                33560000
           IF  ASC-ITEM-SUB < + 1                                       33570000
               MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  33580000
               MOVE +1                 TO ASC-BLK-SUB                   33590000
           END-IF.                                                      33600000
                                                                        33610000
       EJECT.                                                           33620000
      *----------------------------------------------------------------*33630000
      *    PROCESS THE ITEMS IN THE ARRAY AND MOVE THEM TO THE MAP.    *33640000
      *        NON-RETAIL TRANSFERS                                    *33650000
      *----------------------------------------------------------------*33660000
       4430-FORMAT-LIST-LINES.                                          33670000
                                                                        33680000
           IF  ASC-ITEM-AT-BOT-OF-PANEL > ASC-NUMBER-OF-ITEMS-READ      33690000
               SUBTRACT +1 FROM ASC-ITEM-AT-BOT-OF-PANEL                33700000
               MOVE SPACE              TO MR-B-LINE-NBR-X (PV-SUB)      33710000
                                          MR-B-DESC       (PV-SUB)      33720000
                                          MR-B-FIXTURE    (PV-SUB)      33730000
                                          MR-B-DEPT       (PV-SUB)      33740000
                                          MR-B-TQTY-X     (PV-SUB)      33750000
                                          MR-B-RQTY       (PV-SUB)      33760000
           ELSE                                                         33770000
               MOVE ASC-LINE (ASC-BLK-SUB ASC-ITEM-SUB)                 33780000
                                   TO MR-B-LINE-NBR   (PV-SUB)          33790000
               MOVE ASC-NRTL-DESC (ASC-BLK-SUB ASC-ITEM-SUB)            33800000
                                   TO MR-B-DESC       (PV-SUB)          33810000
               MOVE ASC-FIXTURE (ASC-BLK-SUB ASC-ITEM-SUB)              33820000
                                   TO MR-B-FIXTURE    (PV-SUB)          33830000
               MOVE ASC-NRTL-DEPT (ASC-BLK-SUB ASC-ITEM-SUB)            33840000
                                   TO MR-B-DEPT       (PV-SUB)          33850000
               MOVE ASC-TQTY       (ASC-BLK-SUB ASC-ITEM-SUB)           33860000
                                   TO MR-B-TQTY       (PV-SUB)          33870000
               IF ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) > SPACES          33880000
                   IF ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB) NUMERIC       33890000
                       MOVE ASC-RQTY-N (ASC-BLK-SUB ASC-ITEM-SUB)       33900000
                                   TO MR-B-RQTY-N     (PV-SUB)          33910000
                   ELSE                                                 33920000
                       MOVE ASC-RQTY (ASC-BLK-SUB ASC-ITEM-SUB)         33930000
                                   TO MR-B-RQTY     (PV-SUB)            33940000
                   END-IF                                               33950000
               ELSE                                                     33960000
                   MOVE SPACES     TO MR-B-RQTY       (PV-SUB)          33970000
               END-IF                                                   33980000
           END-IF.                                                      33990000
                                                                        34000000
           IF ASC-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB)                34010000
              MOVE DP015-PRO-NOR-OFF     TO MR-B-DESCA      (PV-SUB)    34020000
                                            MR-B-FIXTUREA   (PV-SUB)    34030000
                                            MR-B-DEPTA      (PV-SUB)    34040000
              MOVE DP015-BLUE            TO MR-B-DESCC      (PV-SUB)    34050000
                                            MR-B-FIXTUREC   (PV-SUB)    34060000
                                            MR-B-DEPTC      (PV-SUB)    34070000
              MOVE DP015-HL-OFF          TO MR-B-DESCH      (PV-SUB)    34080000
                                            MR-B-FIXTUREH   (PV-SUB)    34090000
                                            MR-B-DEPTH      (PV-SUB)    34100000
           END-IF.                                                      34110000
                                                                        34120000
           IF PV-SUB = 1 AND ASC-XFERED-ITEM (ASC-BLK-SUB ASC-ITEM-SUB) 34130000
               SET ASC-FIRST-LINE-XFERED    TO TRUE                     34140000
           ELSE                                                         34150000
               SET ASC-FIRST-LINE-ADDED     TO TRUE                     34160000
           END-IF.                                                      34170000
                                                                        34180000
           SUBTRACT +1 FROM ASC-ITEM-SUB                                34190000
           IF  ASC-ITEM-SUB < + 1                                       34200000
               MOVE PC-ITEMS-PER-PANEL TO ASC-ITEM-SUB                  34210000
               MOVE +1                 TO ASC-BLK-SUB                   34220000
           END-IF.                                                      34230000
                                                                        34240000
       EJECT.                                                           34250000
      *----------------------------------------------------------------*34260000
      * CHECK FOR SEAL DISCREPANCY. LG TOTE SEAL 1 & 2 MAY BE REVERSED *34270000
      *----------------------------------------------------------------*34280000
       5000-CHECK-SEAL-DISCREPANCY.                                     34290000
                                                                        34300000
           EVALUATE TRUE                                                34310000
                ALSO TRUE                                               34320000
               WHEN (ASC-LG-TOTE-SEAL1 = ASC-CMP-LG-TOTE-SEAL1 AND      34330000
                     ASC-LG-TOTE-SEAL2 = ASC-CMP-LG-TOTE-SEAL2)         34340000
                ALSO ASC-SM-TOTE-SEAL = ASC-CMP-SM-TOTE-SEAL            34350000
               WHEN (ASC-LG-TOTE-SEAL1 = ASC-CMP-LG-TOTE-SEAL2 AND      34360000
                     ASC-LG-TOTE-SEAL2 = ASC-CMP-LG-TOTE-SEAL1)         34370000
                ALSO ASC-SM-TOTE-SEAL = ASC-CMP-SM-TOTE-SEAL            34380000
                   CONTINUE                                             34390000
               WHEN OTHER                                               34400000
                   SET PS-SEAL-DISCREPANCY-EXISTS TO TRUE               34410000
           END-EVALUATE.                                                34420000
                                                                        34430000
       EJECT.                                                           34440000
      *----------------------------------------------------------------*34450000
      *    WRITE A NEW BLOCK FROM THE ARRAY TO TEMPORARY STORAGE.      *34460000
      *    REWRITE AN EXISITING BLOCK ONLY IF IT HAS BEEN MODIFIED.    *34470000
      *----------------------------------------------------------------*34480000
       5100-WRITE-TEMP-STORAGE.                                         34490000
                                                                        34500000
           MOVE ASC-LIST-ITEM-NUMBER(ASC-BLK-SUB 1)                     34510000
                                         TO PV-LIST-ITEM-NUMBER.        34520000
           COMPUTE PV-BLOCK-NUMBER =                                    34530000
               1 + ((PV-LIST-ITEM-NUMBER - 1) / PC-ITEMS-PER-PANEL).    34540000
                                                                        34550000
           IF (PV-BLOCK-NUMBER < ASC-HIGHEST-BLOCK-WRITTEN)             34560000
           OR (PV-BLOCK-NUMBER = ASC-HIGHEST-BLOCK-WRITTEN)             34570000
               IF  ASC-BLOCK-MODIFIED(ASC-BLK-SUB)                      34580000
                   PERFORM 5105-REWRITE-ASC-LISTQ                       34590000
               END-IF                                                   34600000
           ELSE                                                         34610000
               COMPUTE PV-HIGHEST-BLOCK-WRITTEN =                       34620000
               ASC-HIGHEST-BLOCK-WRITTEN + 1                            34630000
               PERFORM 5110-WRITE-ASC-LISTQ                             34640000
               ADD +1                    TO ASC-HIGHEST-BLOCK-WRITTEN   34650000
           END-IF.                                                      34660000
                                                                        34670000
           SET ASC-BLOCK-NOT-MODIFIED(ASC-BLK-SUB) TO TRUE.             34680000
                                                                        34690000
       EJECT.                                                           34700000
      ******************************************************************34710000
      ** REWRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-    **34720000
      ** SPECIFIC COMMAREA.                                           **34730000
      ******************************************************************34740000
       5105-REWRITE-ASC-LISTQ.                                          34750000
                                                                        34760000
           MOVE '5105-REWRITE-ASC-LISTQ'   TO DP013-PARAGRAPH.          34770000
                                                                        34780000
           EXEC CICS                                                    34790000
               WRITEQ TS                                                34800000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          34810000
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               34820000
                   ITEM  (PV-BLOCK-NUMBER)                              34830000
                   REWRITE                                              34840000
                   RESP  (PV-CICS-RESP)                                 34850000
           END-EXEC.                                                    34860000
                                                                        34870000
           IF  PV-CICS-RESP = DFHRESP(NORMAL)                           34880000
               CONTINUE                                                 34890000
           ELSE                                                         34900000
               SET DP013-CICS-ABEND            TO TRUE                  34910000
               SET DP013-NO-ROLLBACK           TO TRUE                  34920000
               MOVE 'ATTEMPTING TO REWRITE LIST TEMP STORAGE QUEUE'     34930000
                                               TO DP013-MESSAGE-TEXT(1) 34940000
               PERFORM DP013-0000-PROCESS-ABEND                         34950000
           END-IF.                                                      34960000
                                                                        34970000
       EJECT.                                                           34980000
      ******************************************************************34990000
      ** WRITE THE LIST TEMP STORAGE QUEUE FROM THE APPLICATION-      **35000000
      ** SPECIFIC COMMAREA.                                           **35010000
      ******************************************************************35020000
       5110-WRITE-ASC-LISTQ.                                            35030000
                                                                        35040000
           MOVE '5110-WRITE-ASC-LISTQ'   TO DP013-PARAGRAPH.            35050000
                                                                        35060000
           EXEC CICS                                                    35070000
               WRITEQ TS                                                35080000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          35090000
                   FROM  (ASC-BLOCK-ENTRIES(ASC-BLK-SUB))               35100000
                   ITEM  (PV-BLOCK-NUMBER)                              35110000
                   RESP  (PV-CICS-RESP)                                 35120000
           END-EXEC.                                                    35130000
                                                                        35140000
           IF  PV-CICS-RESP NOT = DFHRESP (NORMAL)                      35150000
               SET DP013-CICS-ABEND      TO TRUE                        35160000
               SET DP013-NO-ROLLBACK     TO TRUE                        35170000
               MOVE 'ATTEMPTING TO DELETE TEMP STORAGE QUEUE'           35180000
                                         TO DP013-MESSAGE-TEXT(1)       35190000
               PERFORM DP013-0000-PROCESS-ABEND                         35200000
           END-IF.                                                      35210000
                                                                        35220000
       EJECT.                                                           35230000
      *----------------------------------------------------------------*35240000
      *  PERFORM THE TRANSFER RECEIPT.                                 *35250000
      *----------------------------------------------------------------*35260000
       6000-RECEIVE-XFER.                                               35270000
                                                                        35280000
           PERFORM 6010-OPEN-XFER-ITM-CSR.                              35290000
           PERFORM 6020-FETCH-XFER-ITM-CSR.                             35300000
                                                                        35310000
           PERFORM 6100-INSERT-XFER-ITM-RCPTS                           35320000
               UNTIL PS-END-OF-XFER-ITMS.                               35330000
                                                                        35340000
           PERFORM 6030-CLOSE-XFER-ITM-CSR.                             35350000
           PERFORM 6400-UPDATE-RECEIPTS.                                35360000
                                                                        35370000
           SET PS-MORE-XFER-ITMS            TO TRUE.                    35380000
           PERFORM 6010-OPEN-XFER-ITM-CSR.                              35390000
           PERFORM 6020-FETCH-XFER-ITM-CSR.                             35400000
                                                                        35410000
           PERFORM 8200-CHK-FOR-ITM-DISCREPANCYS                        35420000
               UNTIL PS-END-OF-XFER-ITMS.                               35430000
                                                                        35440000
           PERFORM 6030-CLOSE-XFER-ITM-CSR.                             35450000
                                                                        35460000
           IF PS-UPDATE-STATUS                                          35470000
               PERFORM 7610-UPDATE-XFER-RECEIPT-ROW                     35480000
               PERFORM 7660-UPDATE-STATUS-TO-PR                         35490000
           ELSE                                                         35500000
               PERFORM 7600-INSERT-XFER-RECEIPT-ROW                     35510000
               PERFORM 7650-INSERT-XFER-PR-STAT-ROW                     35520000
           END-IF.                                                      35530000
                                                                        35540000
           IF ASC-CALLBACK-OVERRIDE                                     35550000
               MOVE ASC-CALLBACK-NBR-N    TO TFMSTR-CLBK-NBR            35560000
               PERFORM 8600-UPDATE-TTFMSTR                              35570000
           END-IF.                                                      35580000
                                                                        35590000
       EJECT.                                                           35600000
      *----------------------------------------------------------------*35610000
      *  OPEN THE TRANSFER ITEM CURSOR.                                *35620000
      *----------------------------------------------------------------*35630000
       6010-OPEN-XFER-ITM-CSR.                                          35640000
                                                                        35650000
           MOVE '6010-OPEN-XFER-ITM-CSR'  TO DP013-PARAGRAPH.           35660000
                                                                        35670000
           EXEC SQL                                                     35680000
               OPEN XFER_ITM_CSR                                        35690000
           END-EXEC.                                                    35700000
                                                                        35710000
           EVALUATE TRUE                                                35720000
               WHEN SQLCODE = ZERO                                      35730000
                   CONTINUE                                             35740000
               WHEN OTHER                                               35750000
                   MOVE 'OPEN THE XFER_ITM_CSR CURSOR'                  35760000
                                             TO DP013-MESSAGE-TEXT (1)  35770000
                   MOVE SQLCA                TO DP013-SQLCA             35780000
                   MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)35790000
                   SET DP013-DB2-ABEND                                  35800000
                       DP013-XCTL-DISPLAY-RESTART                       35810000
                                             TO TRUE                    35820000
                   PERFORM DP013-0000-PROCESS-ABEND                     35830000
           END-EVALUATE.                                                35840000
                                                                        35850000
       EJECT.                                                           35860000
      *----------------------------------------------------------------*35870000
      *  READ A ROW FROM THE TRANSFER ITEM TABLE.                      *35880000
      *----------------------------------------------------------------*35890000
       6020-FETCH-XFER-ITM-CSR.                                         35900000
                                                                        35910000
           MOVE '6020-FETCH-XFER-ITM-CSR' TO DP013-PARAGRAPH.           35920000
                                                                        35930000
           INITIALIZE DCLTTFITEM.                                       35940000
                                                                        35950000
           PERFORM WITH TEST AFTER                                      35960000
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   35970000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                35980000
                      OR SQLCODE = ZERO                                 35990000
                      OR SQLCODE = +100                                 36000000
                                                                        36010000
               EXEC SQL                                                 36020000
                   FETCH  XFER_ITM_CSR                                  36030000
                    INTO  :TFITEM-XFER-LNE-NBR,                         36040000
                          :TFITEM-ITM-NBR,                              36050000
                          :TFITEM-XFER-PRIC-AMT,                        36060000
                          :TFITEM-XFER-QTY                              36070000
               END-EXEC                                                 36080000
                                                                        36090000
               EVALUATE TRUE                                            36100000
                   WHEN SQLCODE = ZERO                                  36110000
                       PERFORM 6025-SELECT-DEPT-CLASS                   36120000
                   WHEN SQLCODE = +100                                  36130000
                       SET PS-END-OF-XFER-ITMS   TO TRUE                36140000
                   WHEN SQLCODE = -904                                  36150000
                   WHEN SQLCODE = -913                                  36160000
                       CONTINUE                                         36170000
                   WHEN OTHER                                           36180000
                       MOVE 'FETCH XFER_ITM_CSR'                        36190000
                                             TO DP013-MESSAGE-TEXT (1)  36200000
                       MOVE 'FOR XFER_DKEY_ID: '                        36210000
                                             TO DP013-MESSAGE-TEXT (2)  36220000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 36230000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     36240000
                                             TO DP013-MESSAGE-TEXT (3)  36250000
                       MOVE SQLCA            TO DP013-SQLCA             36260000
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)36270000
                       SET DP013-DB2-ABEND                              36280000
                           DP013-XCTL-DISPLAY-RESTART                   36290000
                                         TO TRUE                        36300000
                       PERFORM DP013-0000-PROCESS-ABEND                 36310000
               END-EVALUATE                                             36320000
           END-PERFORM.                                                 36330000
                                                                        36340000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          36350000
               MOVE 'FETCH XFER_ITM_CSR' TO DP013-MESSAGE-TEXT (1)      36360000
               MOVE 'FOR XFER_DKEY_ID: ' TO DP013-MESSAGE-TEXT (2)      36370000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     36380000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             36390000
                                         TO DP013-MESSAGE-TEXT (3)      36400000
               MOVE SQLCA                TO DP013-SQLCA                 36410000
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    36420000
               SET DP013-DB2-ABEND                                      36430000
                   DP013-XCTL-DISPLAY-RESTART                           36440000
                                         TO TRUE                        36450000
               PERFORM DP013-0000-PROCESS-ABEND                         36460000
           END-IF.                                                      36470000
                                                                        36480000
       EJECT.                                                           36490000
      ***************************************************************** 36500000
       6025-SELECT-DEPT-CLASS.                                          36510000
                                                                        36520000
           MOVE '6025-SELECT-DEPT-CLASS' TO DP013-PARAGRAPH.            36530000
                                                                        36540000
           EXEC SQL                                                     36550000
               SELECT  DEPT,                                            36560000
                       CLASS,                                           36570000
                       SUBCLASS                                         36580000
                 INTO  :SKXREF-DEPT,                                    36590000
                       :SKXREF-CLASS,                                   36600000
                       :SKXREF-SUBCLASS                                 36610000
                 FROM  TSKXREF                                          36620000
                WHERE  ITM_NBR     =  :TFITEM-ITM-NBR                   36630000
           END-EXEC                                                     36640000
                                                                        36650000
           EVALUATE TRUE                                                36660000
               WHEN SQLCODE = ZERO                                      36670000
                   CONTINUE                                             36680000
               WHEN SQLCODE = +100                                      36690000
                   MOVE ZEROS TO SKXREF-DEPT                            36700000
                   MOVE ZEROS TO SKXREF-SUBCLASS                        36710000
                   MOVE ZEROS TO SKXREF-CLASS                           36720000
               WHEN OTHER                                               36730000
                   MOVE 'READ A ROW FROM TSKXREF'                       36740000
                                       TO DP013-MESSAGE-TEXT (1)        36750000
                   MOVE SQLCA              TO DP013-SQLCA               36760000
                   MOVE 'TSKXREF'          TO DP013-DB2-TABLE-NAME (1)  36770000
                   SET DP013-DB2-ABEND TO TRUE                          36780000
                   PERFORM DP013-0000-PROCESS-ABEND                     36790000
           END-EVALUATE.                                                36800000
                                                                        36810000
       EJECT.                                                           36820000
      *----------------------------------------------------------------*36830000
      * CLOSE THE TRANSFER ITEM CURSOR.                                *36840000
      *----------------------------------------------------------------*36850000
       6030-CLOSE-XFER-ITM-CSR.                                         36860000
                                                                        36870000
           MOVE '6030-CLOSE-XFER-ITM-CSR' TO DP013-PARAGRAPH.           36880000
                                                                        36890000
           EXEC SQL                                                     36900000
               CLOSE XFER_ITM_CSR                                       36910000
           END-EXEC.                                                    36920000
                                                                        36930000
           EVALUATE TRUE                                                36940000
               WHEN SQLCODE = ZERO                                      36950000
                   CONTINUE                                             36960000
               WHEN OTHER                                               36970000
                   MOVE 'CLOSE THE XFER_ITM_CSR CURSOR'                 36980000
                                             TO DP013-MESSAGE-TEXT (1)  36990000
                   MOVE SQLCA                TO DP013-SQLCA             37000000
                   MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)37010000
                   SET DP013-DB2-ABEND                                  37020000
                       DP013-XCTL-DISPLAY-RESTART                       37030000
                                             TO TRUE                    37040000
                   PERFORM DP013-0000-PROCESS-ABEND                     37050000
           END-EVALUATE.                                                37060000
                                                                        37070000
       EJECT.                                                           37080000
      *----------------------------------------------------------------*37090000
      *  SET UP DATA TO BE INSERTED INTO THE ITEM RECEIPT TABLE        *37100000
      *----------------------------------------------------------------*37110000
       6100-INSERT-XFER-ITM-RCPTS.                                      37120000
                                                                        37130000
           IF TFITEM-ITM-NBR  =  ZEROS                                  37140000
               MOVE ZEROS                 TO  TFITRC-RCVD-RTL-PRIC-AMT  37150000
           ELSE                                                         37160000
               PERFORM 8100-SELECT-CUR-UNT-RTL-AMT                      37170000
               MOVE PV-CUR-RTL-AMT        TO  TFITRC-RCVD-RTL-PRIC-AMT  37180000
           END-IF.                                                      37190000
                                                                        37200000
           PERFORM 7300-INSERT-ITM-RCPT.                                37210000
                                                                        37220000
           IF PS-STORE-DISCREPANCY-EXISTS AND ASC-RETAIL-XFER           37230000
               PERFORM 6110-CREATE-ADJUSTMENT                           37240000
           END-IF.                                                      37250000
                                                                        37260000
           PERFORM 6020-FETCH-XFER-ITM-CSR.                             37270000
                                                                        37280000
       EJECT.                                                           37290000
      *----------------------------------------------------------------*37300000
      *  THERE IS A DISCREPANCY BETWEEN 'TO' STORE AND 'RECV' STORE,   *37310000
      *  SO INSERT MISDIRECT POSTINGS IN THE ITEM POSTING TABLE.       *37320000
      *----------------------------------------------------------------*37330000
       6110-CREATE-ADJUSTMENT.                                          37340000
                                                                        37350000
           MOVE TFITEM-XFER-PRIC-AMT    TO  TFITPS-ITM-RTL-PRCE-AMT.    37360000
           MOVE TFITEM-XFER-QTY         TO  TFITPS-ITM-QTY.             37370000
           MOVE ASC-TO-STORE-NBR        TO  TFITPS-FRM-PSTG-STR-NBR.    37380000
           MOVE TFDSCP-RCVD-AT-STR-NBR  TO  TFITPS-TO-PSTG-STR-NBR.     37390000
           MOVE PC-MISDIRECT-RSN-CDE    TO  TFITPS-ADJ-RSN-CDE.         37400000
                                                                        37410000
111703*    IF (ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE                    37420000
111703     IF (ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT1              37421000
111703      OR ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT2              37422000
            OR ASC-XFER-TYPE  =  PC-CALLBACK)                           37430000
                 OR                                                     37440000
               (ASC-XFER-TYPE NOT = PC-NON-RETAIL                       37450000
                 AND                                                    37460000
                TFITEM-ITM-NBR = ZEROS)                                 37470000
              MOVE PC-MERCHANDISE-LEDGER TO TFITPS-EXTL-SYS-PRCG-CDE    37480000
           ELSE                                                         37490000
              MOVE PC-FASHION-SALES      TO TFITPS-EXTL-SYS-PRCG-CDE    37500000
           END-IF.                                                      37510000
                                                                        37520000
           PERFORM 6200-SELECT-MAX-PSTG-SEQ-NBR.                        37530000
           PERFORM 6300-INSERT-ADJUSTMENT-ROW.                          37540000
                                                                        37550000
       EJECT.                                                           37560000
      *----------------------------------------------------------------*37570000
      *    READ THE TEMPORARY STORAGE QUEUE INTO A TEMPORARY WORK AREA.*37580000
      *----------------------------------------------------------------*37590000
       6112-READ-LIST-QUEUE.                                            37600000
                                                                        37610000
           MOVE '6112-READ-LIST-QUEUE' TO DP013-PARAGRAPH.              37620000
                                                                        37630000
           EXEC CICS                                                    37640000
               READQ TS                                                 37650000
                   QUEUE (ASC-LIST-QUEUE-NAME)                          37660000
                   INTO  (LQW-LIST-QUEUE-WORK-AREA)                     37670000
                   ITEM  (PV-ITEM)                                      37680000
                   RESP  (PV-CICS-RESP)                                 37690000
           END-EXEC.                                                    37700000
                                                                        37710000
           IF  PV-CICS-RESP = DFHRESP (NORMAL)                          37720000
               CONTINUE                                                 37730000
           ELSE                                                         37740000
               SET DP013-CICS-ABEND        TO TRUE                      37750000
               SET DP013-NO-ROLLBACK       TO TRUE                      37760000
               MOVE 'ATTEMPTING TO READQ LIST QUEUE'                    37770000
                                           TO DP013-MESSAGE-TEXT(1)     37780000
               PERFORM DP013-0000-PROCESS-ABEND                         37790000
           END-IF.                                                      37800000
                                                                        37810000
       EJECT.                                                           37820000
      *----------------------------------------------------------------*37830000
      *  GET THE MAXIMUM POSTING SEQUENCE NUMBER FOR THIS LINE NUMBER. *37840000
      *----------------------------------------------------------------*37850000
       6200-SELECT-MAX-PSTG-SEQ-NBR.                                    37860000
                                                                        37870000
           MOVE '6200-SELECT-MAX-PSTG-SEQ-NBR' TO DP013-PARAGRAPH.      37880000
                                                                        37890000
           INITIALIZE PV-PSTG-SEQ-NBR.                                  37900000
                                                                        37910000
           PERFORM WITH TEST AFTER                                      37920000
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   37930000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                37940000
                      OR SQLCODE = ZERO                                 37950000
                                                                        37960000
               EXEC SQL                                                 37970000
                   SELECT  MAX(PSTG_SEQ_NBR)                            37980000
                     INTO  :PV-PSTG-SEQ-NBR                             37990000
                               :PV-DB2-NULL-IND                         38000000
                     FROM  TTFITPS                                      38010000
                     WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID          38020000
                      AND   XFER_LNE_NBR  =  :TFITEM-XFER-LNE-NBR)      38030000
               END-EXEC                                                 38040000
                                                                        38050000
               EVALUATE TRUE                                            38060000
                   WHEN SQLCODE = -904                                  38070000
                   WHEN SQLCODE = -913                                  38080000
                   WHEN SQLCODE = ZERO                                  38090000
                       CONTINUE                                         38100000
                   WHEN OTHER                                           38110000
                       MOVE 'SELECT MAX(PSTG_SEQ_NBR) FOR XFER_DKEY_ID:'38120000
                                             TO DP013-MESSAGE-TEXT (1)  38130000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 38140000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     38150000
                                             TO DP013-MESSAGE-TEXT (2)  38160000
                       MOVE SQLCA            TO DP013-SQLCA             38170000
                       MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)38180000
                       SET DP013-DB2-ABEND                              38190000
                           DP013-XCTL-DISPLAY-RESTART                   38200000
                                         TO TRUE                        38210000
                       PERFORM DP013-0000-PROCESS-ABEND                 38220000
               END-EVALUATE                                             38230000
           END-PERFORM.                                                 38240000
                                                                        38250000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          38260000
               MOVE 'SELECT MAX(PSTG_SEQ_NBR) FOR XFER_DKEY_ID: '       38270000
                                         TO DP013-MESSAGE-TEXT (1)      38280000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     38290000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             38300000
                                         TO DP013-MESSAGE-TEXT (2)      38310000
               MOVE SQLCA                TO DP013-SQLCA                 38320000
               MOVE 'TTFITPS'            TO DP013-DB2-TABLE-NAME (1)    38330000
               SET DP013-DB2-ABEND                                      38340000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   38350000
               PERFORM DP013-0000-PROCESS-ABEND                         38360000
           END-IF.                                                      38370000
                                                                        38380000
       EJECT.                                                           38390000
      *----------------------------------------------------------------*38400000
      *  INSERT A ROW IN THE ITEM POSTING TABLE.                       *38410000
      *----------------------------------------------------------------*38420000
       6300-INSERT-ADJUSTMENT-ROW.                                      38430000
                                                                        38440000
           MOVE '6300-INSERT-ADJUSTMENT-ROW' TO DP013-PARAGRAPH.        38450000
                                                                        38460000
           COMPUTE TFITPS-PSTG-SEQ-NBR  =                               38470000
               PV-PSTG-SEQ-NBR + 1.                                     38480000
                                                                        38490000
           PERFORM WITH TEST AFTER                                      38500000
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   38510000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                38520000
                      OR SQLCODE = ZERO                                 38530000
                                                                        38540000
               EXEC SQL                                                 38550000
                   INSERT INTO TTFITPS                                  38560000
                       (XFER_DKEY_ID,                                   38570000
                        XFER_LNE_NBR,                                   38580000
                        PSTG_SEQ_NBR,                                   38590000
                        XFER_RCPT_TMST,                                 38600000
                        ADJ_RSN_CDE,                                    38610000
                        FRM_PSTG_STR_NBR,                               38620000
                        TO_PSTG_STR_NBR,                                38630000
                        ITM_RTL_PRCE_AMT,                               38640000
                        ITM_QTY,                                        38650000
                        EXTL_SYS_PRCG_CDE)                              38660000
                   VALUES                                               38670000
                       (:DK-XFER-DKEY-ID,                               38680000
                        :TFITEM-XFER-LNE-NBR,                           38690000
                        :TFITPS-PSTG-SEQ-NBR,                           38700000
                        :PV-CURRENT-TIMESTAMP,                          38710000
                        :TFITPS-ADJ-RSN-CDE,                            38720000
                        :TFITPS-FRM-PSTG-STR-NBR,                       38730000
                        :TFITPS-TO-PSTG-STR-NBR,                        38740000
                        :TFITPS-ITM-RTL-PRCE-AMT,                       38750000
                        :TFITPS-ITM-QTY,                                38760000
                        :TFITPS-EXTL-SYS-PRCG-CDE)                      38770000
               END-EXEC                                                 38780000
                                                                        38790000
               EVALUATE TRUE                                            38800000
                   WHEN SQLCODE = -904                                  38810000
                   WHEN SQLCODE = -913                                  38820000
                   WHEN SQLCODE = ZERO                                  38830000
                       CONTINUE                                         38840000
                   WHEN OTHER                                           38850000
                       MOVE 'INSERT ADJUSTMENT FOR XFER_DKEY_ID/XFER_LN'38860000
                                             TO DP013-MESSAGE-TEXT (1)  38870000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 38880000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     38890000
                                             TO DP013-MESSAGE-TEXT (2)  38900000
                       MOVE TFITEM-XFER-LNE-NBR                         38910000
                                             TO PV-DISPLAY-XFER-LNE-NBR 38920000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     38930000
                                             TO DP013-MESSAGE-TEXT (3)  38940000
                       MOVE PV-PSTG-SEQ-NBR  TO PV-DISPLAY-PSTG-SEQ-NBR 38950000
                       MOVE PV-DISPLAY-PSTG-SEQ-NBR                     38960000
                                             TO DP013-MESSAGE-TEXT (4)  38970000
                       MOVE SQLCA            TO DP013-SQLCA             38980000
                       MOVE 'TTFITPS'        TO DP013-DB2-TABLE-NAME (1)38990000
                       SET DP013-DB2-ABEND                              39000000
                           DP013-XCTL-DISPLAY-RESTART                   39010000
                                         TO TRUE                        39020000
                       PERFORM DP013-0000-PROCESS-ABEND                 39030000
               END-EVALUATE                                             39040000
           END-PERFORM.                                                 39050000
                                                                        39060000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          39070000
               MOVE 'INSERT ADJUSTMENT FOR XFER_DKEY_ID/XFER_LNE_NBR/'  39080000
                                         TO DP013-MESSAGE-TEXT (1)      39090000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     39100000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             39110000
                                         TO DP013-MESSAGE-TEXT (2)      39120000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     39130000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             39140000
                                         TO DP013-MESSAGE-TEXT (3)      39150000
               MOVE PV-PSTG-SEQ-NBR      TO PV-DISPLAY-PSTG-SEQ-NBR     39160000
               MOVE PV-DISPLAY-PSTG-SEQ-NBR                             39170000
                                         TO DP013-MESSAGE-TEXT (4)      39180000
               MOVE SQLCA                TO DP013-SQLCA                 39190000
               MOVE 'TTFITPS'            TO DP013-DB2-TABLE-NAME (1)    39200000
               SET DP013-DB2-ABEND                                      39210000
                   DP013-XCTL-DISPLAY-RESTART                           39220000
                                         TO TRUE                        39230000
               PERFORM DP013-0000-PROCESS-ABEND                         39240000
           END-IF.                                                      39250000
                                                                        39260000
       EJECT.                                                           39270000
      *----------------------------------------------------------------*39280000
      *  PROCESS RECEIVED ITEMS.                                       *39290000
      *----------------------------------------------------------------*39300000
       6400-UPDATE-RECEIPTS.                                            39310000
                                                                        39320000
           MOVE +1                   TO  ASC-BLK-SUB.                   39330000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             39340000
           ADD +1                    TO  ASC-BLK-SUB.                   39350000
           PERFORM 5100-WRITE-TEMP-STORAGE.                             39360000
                                                                        39370000
           PERFORM 6410-PROCESS-LIST-QUEUE                              39380000
                   VARYING PV-ITEM                                      39390000
                   FROM 1 BY 1                                          39400000
                   UNTIL PV-ITEM GREATER ASC-HIGHEST-BLOCK-WRITTEN.     39410000
                                                                        39420000
       EJECT.                                                           39430000
      *----------------------------------------------------------------*39440000
      *  CONTROL THE PROCESSING OF THE RECEIPTS.                       *39450000
      *----------------------------------------------------------------*39460000
       6410-PROCESS-LIST-QUEUE.                                         39470000
                                                                        39480000
           PERFORM 6112-READ-LIST-QUEUE.                                39490000
                                                                        39500000
           IF  PV-CICS-RESP EQUAL DFHRESP(NORMAL)                       39510000
               PERFORM 6420-CHECK-FOR-UPDATE                            39520000
                 VARYING LQW-IDX                                        39530000
                   FROM 1 BY 1                                          39540000
                   UNTIL LQW-IDX GREATER THAN PC-ITEMS-PER-PANEL        39550000
                     OR  LQW-LIST-ITEM-NUMBER (LQW-IDX) EQUAL ZERO      39560000
           END-IF.                                                      39570000
                                                                        39580000
       EJECT                                                            39590000
      *----------------------------------------------------------------*39600000
      * CHECK TO SEE IF THIS ITEM IS RECEIVED.                         *39610000
      *----------------------------------------------------------------*39620000
       6420-CHECK-FOR-UPDATE.                                           39630000
                                                                        39640000
           IF LQW-RQTY (LQW-IDX) > SPACE                                39650000
               IF ASC-RETAIL-XFER                                       39660000
                   PERFORM 6600-UPDATE-RETAIL-ITEM                      39670000
               ELSE                                                     39680000
                   PERFORM 6900-UPDATE-NON-RETAIL-ITEM                  39690000
               END-IF                                                   39700000
           END-IF.                                                      39710000
                                                                        39720000
       EJECT.                                                           39730000
      *----------------------------------------------------------------*39740000
      *  CHECK FOR ASSUMPTIVE RECEIPT; IF NOT, CREATE ASSUMPTIVE       *39750000
      *  RECEIPT POSTINGS.                                             *39760000
      *----------------------------------------------------------------*39770000
       6500-CHK-ASSUMPTIVE-RECEIPT.                                     39780000
                                                                        39790000
           PERFORM 7700-SELECT-ASSUMPTIVE-RECEIPT.                      39800000
                                                                        39810000
           IF SQLCODE  =  PC-ROW-NOT-FOUND                              39820000
               PERFORM 6510-CREATE-ASMTV-RCPT-BOOKING                   39830000
               SET  PS-MORE-XFER-ITMS  TO  TRUE                         39840000
           END-IF.                                                      39850000
                                                                        39860000
       EJECT.                                                           39870000
      *----------------------------------------------------------------*39880000
      *  CREATE THE ASSUMPTIVE RECEIPT POSTINGS.                       *39890000
      *----------------------------------------------------------------*39900000
       6510-CREATE-ASMTV-RCPT-BOOKING.                                  39910000
                                                                        39920000
           PERFORM 6010-OPEN-XFER-ITM-CSR.                              39930000
           PERFORM 6020-FETCH-XFER-ITM-CSR.                             39940000
                                                                        39950000
           PERFORM 6520-CREATE-BOOKINGS                                 39960000
                   UNTIL PS-END-OF-XFER-ITMS.                           39970000
                                                                        39980000
           PERFORM 6030-CLOSE-XFER-ITM-CSR.                             39990000
                                                                        40000000
       EJECT.                                                           40010000
      *----------------------------------------------------------------*40020000
      *  SET UP THE DATA FOR ASSUMPTIVE RECEIPT POSTING.               *40030000
      *----------------------------------------------------------------*40040000
       6520-CREATE-BOOKINGS.                                            40050000
                                                                        40060000
           IF TFITEM-XFER-QTY  >  ZERO                                  40070000
               MOVE TFITEM-XFER-PRIC-AMT    TO  TFITPS-ITM-RTL-PRCE-AMT 40080000
               MOVE TFITEM-XFER-QTY         TO  TFITPS-ITM-QTY          40090000
               MOVE ASC-FR-STORE-NBR        TO  TFITPS-FRM-PSTG-STR-NBR 40100000
               MOVE ASC-TO-STORE-NBR        TO  TFITPS-TO-PSTG-STR-NBR  40110000
               MOVE PC-COMPLETE-RSN-CDE     TO  TFITPS-ADJ-RSN-CDE      40120000
111703*        IF (ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE                40130000
111703         IF (ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT1          40131000
111703           OR ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT2         40132000
                 OR ASC-XFER-TYPE  =  PC-CALLBACK)                      40140000
                 OR                                                     40150000
               (ASC-XFER-TYPE NOT = PC-NON-RETAIL                       40160000
                 AND                                                    40170000
                TFITEM-ITM-NBR = ZEROS)                                 40180000
                  MOVE PC-MERCHANDISE-LEDGER TO TFITPS-EXTL-SYS-PRCG-CDE40190000
               ELSE                                                     40200000
                  MOVE PC-FASHION-SALES      TO TFITPS-EXTL-SYS-PRCG-CDE40210000
               END-IF                                                   40220000
               PERFORM 6300-INSERT-ADJUSTMENT-ROW                       40230000
               MOVE ZEROS                   TO  PV-PSTG-SEQ-NBR         40240000
           END-IF.                                                      40250000
                                                                        40260000
           PERFORM 6020-FETCH-XFER-ITM-CSR.                             40270000
                                                                        40280000
       EJECT.                                                           40290000
      *----------------------------------------------------------------*40300000
      *  PROCESS RECEIVED ITEMS FOR RETAIL TRANSFERS.                  *40310000
      *----------------------------------------------------------------*40320000
       6600-UPDATE-RETAIL-ITEM.                                         40330000
                                                                        40340000
051203     EVALUATE TRUE                                                40350000
051203        WHEN LQW-ITEM-NBR (LQW-IDX) = ZEROS                       40360000
                   PERFORM 7450-SELECT-XFER-ITM-BY-UPC                  40370000
                   EVALUATE SQLCODE                                     40380000
                      WHEN PC-ROW-NOT-FOUND                             40390000
                           PERFORM 6700-XFER-ITM-NOT-FOUND              40400000
                      WHEN ZERO                                         40410000
                           PERFORM 6800-XFER-ITM-FOUND                  40420000
                   END-EVALUATE                                         40430000
051203        WHEN OTHER                                                40440000
                   EVALUATE ASC-XFER-TYPE                               40450000
111703*                WHEN PC-DEFECTIVE-DAMAGE                         40460000
111703                 WHEN PC-DEFECTIVE-DAMAGE-SORT1                   40461000
111703                 WHEN PC-DEFECTIVE-DAMAGE-SORT2                   40462000
                       WHEN PC-CALLBACK                                 40470000
                           PERFORM 7400-SELECT-ITM-BY-ITMNBR-PRI        40480000
                       WHEN PC-STOCK-BALANCE-CORPORATE                  40490000
                       WHEN PC-STOCK-BALANCE-STORE                      40500000
                       WHEN PC-CUSTOMER                                 40510000
                           MOVE LQW-ITEM-NBR (LQW-IDX) TO DK-ITEM-NBR   40520000
                           PERFORM 7410-SELECT-ITM-BY-ITMNBR            40530000
                   END-EVALUATE                                         40540000
                                                                        40550000
                   EVALUATE SQLCODE                                     40560000
                      WHEN ZERO                                         40570000
                      WHEN PC-MULTIPLE-ROWS-FOUND                       40580000
                         EVALUATE  ASC-XFER-TYPE                        40590000
111703*                     WHEN PC-DEFECTIVE-DAMAGE                    40600000
111703                      WHEN PC-DEFECTIVE-DAMAGE-SORT1              40601000
111703                      WHEN PC-DEFECTIVE-DAMAGE-SORT2              40602000
                            WHEN PC-CALLBACK                            40610000
                                PERFORM 6800-XFER-ITM-FOUND             40620000
                            WHEN PC-STOCK-BALANCE-CORPORATE             40630000
                            WHEN PC-STOCK-BALANCE-STORE                 40640000
                            WHEN PC-CUSTOMER                            40650000
                               IF LQW-STATUS-CODE (LQW-IDX) =           40660000
                                                    PC-CLEARANCE-STATUS 40670000
                                   PERFORM 7400-SELECT-ITM-BY-ITMNBR-PRI40680000
                                                                        40690000
                                   EVALUATE SQLCODE                     40700000
                                      WHEN ZERO                         40710000
                                         PERFORM 6800-XFER-ITM-FOUND    40720000
                                      WHEN PC-ROW-NOT-FOUND             40730000
                                         PERFORM 6700-XFER-ITM-NOT-FOUND40740000
                                   END-EVALUATE                         40750000
                               ELSE                                     40760000
                                   PERFORM 6800-XFER-ITM-FOUND          40770000
                               END-IF                                   40780000
                         END-EVALUATE                                   40790000
                      WHEN PC-ROW-NOT-FOUND                             40800000
                         PERFORM 6700-XFER-ITM-NOT-FOUND                40810000
                   END-EVALUATE                                         40820000
051203     END-EVALUATE.                                                40830000
                                                                        40840000
       EJECT.                                                           40850000
      *----------------------------------------------------------------*40860000
      *  THE RECEIVED ITEM (OR ITEM & PRICE) WAS NOT FOUND ON THE      *40870000
      *  TRANSFER, SO ADD THE ITEM AND THE RECEIPT.                    *40880000
      *----------------------------------------------------------------*40890000
       6700-XFER-ITM-NOT-FOUND.                                         40900000
                                                                        40910000
           PERFORM 7030-SELECT-MAX-XFER-LINE-NBR.                       40920000
           COMPUTE PV-NEW-XFER-LNE-NBR  =                               40930000
               PV-XFER-LNE-NBR + 1.                                     40940000
           PERFORM 7250-INSERT-XFER-ITM.                                40950000
           MOVE 1  TO  TFITRC-XFER-LNE-SEQ-NBR.                         40960000
           PERFORM 7350-INSERT-RTL-ITM-RCPT.                            40970000
                                                                        40980000
       EJECT.                                                           40990000
      *----------------------------------------------------------------*41000000
      *  THE RECEIVED ITEM (OR ITEM & PRICE) WAS FOUND ON THE TRANSFER *41010000
      *  SO INSERT (OR UPDATE) THE RECEIPT ROW.                        *41020000
      *----------------------------------------------------------------*41030000
       6800-XFER-ITM-FOUND.                                             41040000
                                                                        41050000
           PERFORM 7420-SELECT-XFER-ITM-RCPT.                           41060000
           IF SQLCODE = PC-ROW-NOT-FOUND                                41070000
               PERFORM 7040-SELECT-MAX-LINE-SEQ-NBR                     41080000
               MOVE PV-NEW-XFER-LNE-SEQ-NBR                             41090000
                   TO  TFITRC-XFER-LNE-SEQ-NBR                          41100000
               PERFORM 7350-INSERT-RTL-ITM-RCPT                         41110000
           ELSE                                                         41120000
               COMPUTE PV-RECEIVED-QTY =                                41130000
                   TFITRC-RCVD-XFER-QTY + LQW-RQTY-N (LQW-IDX)          41140000
               PERFORM 7380-UPDATE-RCVD-ITEM-QTY                        41150000
           END-IF.                                                      41160000
                                                                        41170000
       EJECT.                                                           41180000
      *----------------------------------------------------------------*41190000
      *  IF THE NON-RETAIL ITEM WAS NOT ON THE TRANSFER, ADD IT;       *41200000
      *  OTHERWISE, UPDATE THE RECEIPT ROW.                            *41210000
      *----------------------------------------------------------------*41220000
       6900-UPDATE-NON-RETAIL-ITEM.                                     41230000
                                                                        41240000
           IF LQW-NOT-XFERED-ITEM (LQW-IDX)                             41250000
               PERFORM 6910-ADD-NON-RETAIL                              41260000
           ELSE                                                         41270000
               PERFORM 7710-UPDATE-NON-RTL-ITM-RCPT                     41280000
           END-IF.                                                      41290000
                                                                        41300000
       EJECT.                                                           41310000
      *----------------------------------------------------------------*41320000
      *  THE RECEIVED NON-RETIL ITEM WAS NOT ON THE TRANSFER, SO       *41330000
      *  INSERT A NEW ROW ON THE ITEM TABLE.                           *41340000
      *----------------------------------------------------------------*41350000
       6910-ADD-NON-RETAIL.                                             41360000
                                                                        41370000
           PERFORM 7030-SELECT-MAX-XFER-LINE-NBR.                       41380000
           COMPUTE PV-NEW-XFER-LNE-NBR  =                               41390000
               PV-XFER-LNE-NBR + 1.                                     41400000
           PERFORM 7220-INSERT-NON-RTL-ITM.                             41410000
           MOVE 1  TO  TFITRC-XFER-LNE-SEQ-NBR.                         41420000
           PERFORM 7360-INSERT-NON-RTL-ITM-RCPT.                        41430000
                                                                        41440000
       EJECT.                                                           41450000
      *----------------------------------------------------------------*41460000
      *  GET THE TIMESTAMP FOR THE RECEIPT ROW.                        *41470000
      *----------------------------------------------------------------*41480000
       7000-SELECT-MAX-RCPT-TMST.                                       41490000
                                                                        41500000
           MOVE '7000-SELECT-MAX-RCPT-TMST' TO DP013-PARAGRAPH.         41510000
                                                                        41520000
           MOVE ASC-XFER-DKEY-ID       TO DK-XFER-DKEY-ID.              41530000
           PERFORM WITH TEST AFTER                                      41540000
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   41550000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                41560000
                      OR SQLCODE = ZERO                                 41570000
                                                                        41580000
               EXEC SQL                                                 41590000
                   SELECT  MAX(RCV_XFER_BEG_TMST)                       41600000
                     INTO  :TFRCPT-RCV-XFER-BEG-TMST                    41610000
                              :PV-NULL-IND                              41620000
                     FROM  TTFRCPT                                      41630000
                     WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)         41640000
               END-EXEC                                                 41650000
                                                                        41660000
               EVALUATE TRUE                                            41670000
                   WHEN SQLCODE = ZERO                                  41680000
                   WHEN SQLCODE = -904                                  41690000
                   WHEN SQLCODE = -913                                  41700000
                       CONTINUE                                         41710000
                   WHEN OTHER                                           41720000
                       MOVE 'SELECT MAX TIMESTAMP FOR XFER_DKEY_ID: '   41730000
                                             TO DP013-MESSAGE-TEXT (1)  41740000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 41750000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     41760000
                                             TO DP013-MESSAGE-TEXT (2)  41770000
                       MOVE SQLCA            TO DP013-SQLCA             41780000
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)41790000
                       SET DP013-DB2-ABEND                              41800000
                           DP013-XCTL-DISPLAY-RESTART                   41810000
                                         TO TRUE                        41820000
                       PERFORM DP013-0000-PROCESS-ABEND                 41830000
               END-EVALUATE                                             41840000
           END-PERFORM.                                                 41850000
                                                                        41860000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          41870000
               MOVE 'SELECT MAX TIMESTAMP FOR XFER_DKEY_ID: '           41880000
                                             TO DP013-MESSAGE-TEXT (1)  41890000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     41900000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             41910000
                                             TO DP013-MESSAGE-TEXT (2)  41920000
               MOVE SQLCA                TO DP013-SQLCA                 41930000
               MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)    41940000
               SET DP013-DB2-ABEND                                      41950000
                   DP013-XCTL-DISPLAY-RESTART                           41960000
                                         TO TRUE                        41970000
               PERFORM DP013-0000-PROCESS-ABEND                         41980000
           END-IF.                                                      41990000
                                                                        42000000
       EJECT.                                                           42010000
      *----------------------------------------------------------------*42020000
      *  GET THE CURRENT SYSTEM TIMESTAMP TO BE USED FOR THE RECEIPT.  *42030000
      *----------------------------------------------------------------*42040000
       7010-SELECT-CURRENT-TIMESTAMP.                                   42050000
                                                                        42060000
           MOVE '7010-SELECT-CURRENT-TIMESTAMP' TO DP013-PARAGRAPH.     42070000
                                                                        42080000
           EXEC SQL                                                     42090000
               SET  :PV-CURRENT-TIMESTAMP =   CURRENT TIMESTAMP         42100000
           END-EXEC.                                                    42110000
                                                                        42120000
           EVALUATE TRUE                                                42130000
               WHEN SQLCODE = ZERO                                      42140000
                   CONTINUE                                             42150000
               WHEN OTHER                                               42160000
                   MOVE 'SELECT THE CURRENT TIMESTAMP'                  42170000
                                             TO DP013-MESSAGE-TEXT (1)  42180000
                   MOVE SQLCA                TO DP013-SQLCA             42190000
                   SET DP013-DB2-ABEND                                  42200000
                   DP013-XCTL-DISPLAY-RESTART                           42210000
                                            TO TRUE                     42220000
                   PERFORM DP013-0000-PROCESS-ABEND                     42230000
           END-EVALUATE.                                                42240000
                                                                        42250000
       EJECT.                                                           42260000
      *----------------------------------------------------------------*42270000
      *  SELECT THE ENDING TIMESTAMP OF THE CURRENT RECEIPT ROW TO     *42280000
      *  DETERMINE IF SOMEONE ELSE IS RECEIVING THE TRANSFER ON A PTC. *42290000
      *----------------------------------------------------------------*42300000
       7020-SELECT-CURRENT-RCPT.                                        42310000
                                                                        42320000
           MOVE '7020-SELECT-CURRENT-RCPT' TO DP013-PARAGRAPH.          42330000
                                                                        42340000
           PERFORM WITH TEST AFTER                                      42350000
                   VARYING PV-RETRY-COUNT                               42360000
                   FROM 1 BY 1                                          42370000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                42380000
                      OR SQLCODE = +0                                   42390000
                      OR SQLCODE = +100                                 42400000
                                                                        42410000
               EXEC SQL                                                 42420000
                   SELECT  RCV_XFER_END_TMST                            42430000
                     INTO  :TFRCPT-RCV-XFER-END-TMST                    42440000
                     FROM  TTFRCPT                                      42450000
                    WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID  AND      42460000
                       RCV_XFER_BEG_TMST  =  :TFRCPT-RCV-XFER-BEG-TMST) 42470000
               END-EXEC                                                 42480000
                                                                        42490000
               EVALUATE TRUE                                            42500000
                   WHEN SQLCODE = ZERO                                  42510000
                   WHEN SQLCODE = +100                                  42520000
                   WHEN SQLCODE = -904                                  42530000
                   WHEN SQLCODE = -913                                  42540000
                       CONTINUE                                         42550000
                   WHEN OTHER                                           42560000
                       MOVE 'SELECT CURRENT RECEIPT FOR DLESS KEY/TIME' 42570000
                                            TO DP013-MESSAGE-TEXT (1)   42580000
                       MOVE TFMSTR-XFER-DKEY-ID                         42590000
                                             TO PV-DISPLAY-XFER-DKEY-ID 42600000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     42610000
                                             TO DP013-MESSAGE-TEXT (2)  42620000
                       MOVE TFRCPT-RCV-XFER-BEG-TMST                    42630000
                                             TO DP013-MESSAGE-TEXT (3)  42640000
                       MOVE SQLCA            TO DP013-SQLCA             42650000
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)42660000
                       SET DP013-DB2-ABEND                              42670000
                       DP013-XCTL-DISPLAY-RESTART                       42680000
                                            TO TRUE                     42690000
                       PERFORM DP013-0000-PROCESS-ABEND                 42700000
               END-EVALUATE                                             42710000
           END-PERFORM.                                                 42720000
                                                                        42730000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          42740000
                   MOVE 'SELECT CURRENT RECEIPT FOR DLESS KEY/TIME'     42750000
                                             TO DP013-MESSAGE-TEXT (1)  42760000
                   MOVE TFMSTR-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 42770000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         42780000
                                             TO DP013-MESSAGE-TEXT (2)  42790000
                   MOVE TFRCPT-RCV-XFER-BEG-TMST                        42800000
                                             TO DP013-MESSAGE-TEXT (3)  42810000
                   MOVE SQLCA                TO DP013-SQLCA             42820000
                   MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)42830000
                   SET DP013-DB2-ABEND                                  42840000
                       DP013-XCTL-DISPLAY-RESTART                       42850000
                                            TO TRUE                     42860000
                   PERFORM DP013-0000-PROCESS-ABEND                     42870000
           END-IF.                                                      42880000
                                                                        42890000
       EJECT.                                                           42900000
      *----------------------------------------------------------------*42910000
      *  GET THE MAX LINE NUMBER FOR THIS TRANSFER TO PREPARE FOR      *42920000
      *  ADDING A NEW LINE.                                            *42930000
      *----------------------------------------------------------------*42940000
       7030-SELECT-MAX-XFER-LINE-NBR.                                   42950000
                                                                        42960000
           MOVE '7030-SELECT-MAX-XFER-LINE-NBR' TO DP013-PARAGRAPH.     42970000
                                                                        42980000
           INITIALIZE DCLTTFITEM.                                       42990000
                                                                        43000000
           PERFORM WITH TEST AFTER                                      43010000
                   VARYING PV-RETRY-COUNT                               43020000
                   FROM 1 BY 1                                          43030000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                43040000
                      OR SQLCODE = +0                                   43050000
                                                                        43060000
               EXEC SQL                                                 43070000
                   SELECT  MAX(XFER_LNE_NBR)                            43080000
                     INTO  :PV-XFER-LNE-NBR                             43090000
                               :PV-DB2-NULL-IND                         43100000
                     FROM  TTFITEM                                      43110000
                    WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)          43120000
               END-EXEC                                                 43130000
                                                                        43140000
               EVALUATE TRUE                                            43150000
                   WHEN SQLCODE = ZERO                                  43160000
                   WHEN SQLCODE = -904                                  43170000
                   WHEN SQLCODE = -913                                  43180000
                       CONTINUE                                         43190000
                   WHEN OTHER                                           43200000
                       MOVE 'SELECT MAX(XFER_LNE_NBR) FOR XFER_DKEY_ID:'43210000
                                             TO DP013-MESSAGE-TEXT (1)  43220000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 43230000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     43240000
                                             TO DP013-MESSAGE-TEXT (2)  43250000
                       MOVE SQLCA            TO DP013-SQLCA             43260000
                       MOVE 'TTFITEM'       TO DP013-DB2-TABLE-NAME (1) 43270000
                       MOVE SQLCA            TO DP013-SQLCA             43280000
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)43290000
                       SET DP013-DB2-ABEND                              43300000
                       DP013-XCTL-DISPLAY-RESTART                       43310000
                                            TO TRUE                     43320000
                       PERFORM DP013-0000-PROCESS-ABEND                 43330000
               END-EVALUATE                                             43340000
           END-PERFORM.                                                 43350000
                                                                        43360000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          43370000
                   MOVE 'SELECT MAX(XFER_LNE_NBR) FOR XFER_DKEY_ID: '   43380000
                                             TO DP013-MESSAGE-TEXT (1)  43390000
                   MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID 43400000
                   MOVE PV-DISPLAY-XFER-DKEY-ID                         43410000
                                             TO DP013-MESSAGE-TEXT (2)  43420000
                   MOVE SQLCA                TO DP013-SQLCA             43430000
                   MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)43440000
                   SET DP013-DB2-ABEND                                  43450000
                       DP013-XCTL-DISPLAY-RESTART                       43460000
                                            TO TRUE                     43470000
                   PERFORM DP013-0000-PROCESS-ABEND                     43480000
           END-IF.                                                      43490000
                                                                        43500000
       EJECT.                                                           43510000
      *----------------------------------------------------------------*43520000
      *  GET THE MAX RECEIPT SEQUENCE NUMBER FOR THIS LINE TO PREPARE  *43530000
      *  FOR ADDING A NEW RECEIPT.                                     *43540000
      *----------------------------------------------------------------*43550000
       7040-SELECT-MAX-LINE-SEQ-NBR.                                    43560000
                                                                        43570000
           MOVE '7040-SELECT-MAX-LINE-SEQ-NBR' TO DP013-PARAGRAPH.      43580000
                                                                        43590000
           INITIALIZE DCLTTFITRC.                                       43600000
                                                                        43610000
           PERFORM WITH TEST AFTER                                      43620000
                   VARYING PV-RETRY-COUNT                               43630000
                   FROM 1 BY 1                                          43640000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                43650000
                      OR SQLCODE = +0                                   43660000
                                                                        43670000
               EXEC SQL                                                 43680000
                 SELECT  MAX(XFER_LNE_SEQ_NBR)                          43690000
                   INTO  :PV-XFER-LNE-SEQ-NBR                           43700000
                             :PV-DB2-NULL-IND                           43710000
                   FROM  TTFITRC                                        43720000
                  WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID           43730000
                    AND   XFER_LNE_NBR    =  :TFITEM-XFER-LNE-NBR       43740000
                    AND   XFER_RCPT_TMST  =  :PV-CURRENT-TIMESTAMP)     43750000
               END-EXEC                                                 43760000
                                                                        43770000
               EVALUATE TRUE                                            43780000
                   WHEN SQLCODE = ZERO                                  43790000
                       COMPUTE PV-NEW-XFER-LNE-SEQ-NBR  =               43800000
                          PV-XFER-LNE-SEQ-NBR + 1                       43810000
                   WHEN SQLCODE = +100                                  43820000
                   WHEN SQLCODE = -904                                  43830000
                   WHEN SQLCODE = -913                                  43840000
                       CONTINUE                                         43850000
                   WHEN OTHER                                           43860000
                       MOVE 'SELECT MAX(XFER_LNE_SEQ_NBR) FOR XFER_DKEY'43870000
                                             TO DP013-MESSAGE-TEXT (1)  43880000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 43890000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     43900000
                                             TO DP013-MESSAGE-TEXT (2)  43910000
                       MOVE TFITEM-XFER-LNE-NBR                         43920000
                                             TO PV-DISPLAY-XFER-LNE-NBR 43930000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     43940000
                                             TO DP013-MESSAGE-TEXT (3)  43950000
                       MOVE PV-CURRENT-TIMESTAMP                        43960000
                                             TO DP013-MESSAGE-TEXT (4)  43970000
                       MOVE SQLCA            TO DP013-SQLCA             43980000
                       MOVE 'TTFITRC'        TO DP013-DB2-TABLE-NAME (1)43990000
                       SET DP013-DB2-ABEND                              44000000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               44010000
                       PERFORM DP013-0000-PROCESS-ABEND                 44020000
               END-EVALUATE                                             44030000
           END-PERFORM.                                                 44040000
                                                                        44050000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          44060000
               MOVE 'SELECT MAX(XFER_LNE_SEQ_NBR) FOR XFER_DKEY_ID'     44070000
                                         TO DP013-MESSAGE-TEXT (1)      44080000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     44090000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             44100000
                                         TO DP013-MESSAGE-TEXT (2)      44110000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     44120000
               MOVE PV-DISPLAY-XFER-LNE-NBR TO DP013-MESSAGE-TEXT (3)   44130000
               MOVE PV-CURRENT-TIMESTAMP   TO DP013-MESSAGE-TEXT (4)    44140000
               MOVE SQLCA                TO DP013-SQLCA                 44150000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    44160000
               SET DP013-DB2-ABEND                                      44170000
                   DP013-XCTL-DISPLAY-RESTART                           44180000
                                        TO TRUE                         44190000
               PERFORM DP013-0000-PROCESS-ABEND                         44200000
           END-IF.                                                      44210000
                                                                        44220000
       EJECT.                                                           44230000
      *----------------------------------------------------------------*44240000
      *  SELECT THE CURRENT STATUS OF THIS TRANSFER.                   *44250000
      *----------------------------------------------------------------*44260000
       7100-SELECT-CURRENT-STATUS.                                      44270000
                                                                        44280000
           MOVE '7100-SELECT-CURRENT-STATUS' TO DP013-PARAGRAPH.        44290000
                                                                        44300000
           PERFORM WITH TEST AFTER                                      44310000
                   VARYING PV-RETRY-COUNT                               44320000
                   FROM 1 BY 1                                          44330000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                44340000
                      OR SQLCODE = +0                                   44350000
                      OR SQLCODE = +100                                 44360000
                                                                        44370000
               EXEC SQL                                                 44380000
                   SELECT  XFER_STAT_CDE                                44390000
                     INTO  :TFSTAT-XFER-STAT-CDE                        44400000
                     FROM  TTFSTAT                                      44410000
                    WHERE  (XFER_DKEY_ID     =  :DK-XFER-DKEY-ID        44420000
                      AND   XFER_STAT_TMST   =  :TFSTAT-XFER-STAT-TMST) 44430000
               END-EXEC                                                 44440000
                                                                        44450000
               EVALUATE TRUE                                            44460000
                   WHEN SQLCODE = ZERO                                  44470000
                   WHEN SQLCODE = +100                                  44480000
                   WHEN SQLCODE = -904                                  44490000
                   WHEN SQLCODE = -913                                  44500000
                       CONTINUE                                         44510000
                   WHEN OTHER                                           44520000
                       MOVE 'SELECT CURRENT STATUS FOR DLESS KEY/TIME'  44530000
                                             TO DP013-MESSAGE-TEXT (1)  44540000
                       MOVE TFMSTR-XFER-DKEY-ID                         44550000
                                             TO PV-DISPLAY-XFER-DKEY-ID 44560000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     44570000
                                             TO DP013-MESSAGE-TEXT (2)  44580000
                       MOVE TFSTAT-XFER-STAT-TMST                       44590000
                                             TO DP013-MESSAGE-TEXT (3)  44600000
                       MOVE SQLCA            TO DP013-SQLCA             44610000
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)44620000
                       MOVE 'TTFSTCD'        TO DP013-DB2-TABLE-NAME (2)44630000
                       SET DP013-DB2-ABEND                              44640000
                           DP013-XCTL-DISPLAY-RESTART                   44650000
                                             TO TRUE                    44660000
                       PERFORM DP013-0000-PROCESS-ABEND                 44670000
               END-EVALUATE                                             44680000
           END-PERFORM.                                                 44690000
                                                                        44700000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          44710000
               MOVE 'SELECT CURRENT STATUS FOR DATALESS KEY/TIMESTAMP'  44720000
                                             TO DP013-MESSAGE-TEXT (1)  44730000
               MOVE TFMSTR-XFER-DKEY-ID                                 44740000
                                             TO PV-DISPLAY-XFER-DKEY-ID 44750000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             44760000
                                             TO DP013-MESSAGE-TEXT (2)  44770000
               MOVE TFSTAT-XFER-STAT-TMST                               44780000
                                             TO DP013-MESSAGE-TEXT (3)  44790000
               MOVE SQLCA               TO DP013-SQLCA                  44800000
               MOVE 'TTFSTAT '          TO DP013-DB2-TABLE-NAME (1)     44810000
               MOVE 'TTFSTCD '          TO DP013-DB2-TABLE-NAME (2)     44820000
               SET DP013-DB2-ABEND                                      44830000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   44840000
               PERFORM DP013-0000-PROCESS-ABEND                         44850000
           END-IF.                                                      44860000
                                                                        44870000
       EJECT.                                                           44880000
      *----------------------------------------------------------------*44890000
      *  SELECT THE MAX STATUS TIMESTAMP FOR THIS TRANSFER.            *44900000
      *----------------------------------------------------------------*44910000
       7110-SELECT-MAX-STAT-TMST.                                       44920000
                                                                        44930000
           MOVE '7110-SELECT-MAX-STAT-TMST' TO DP013-PARAGRAPH.         44940000
                                                                        44950000
           INITIALIZE DCLTTFSTAT.                                       44960000
           MOVE ASC-XFER-DKEY-ID         TO DK-XFER-DKEY-ID.            44970000
                                                                        44980000
           PERFORM WITH TEST AFTER                                      44990000
                   VARYING PV-RETRY-COUNT                               45000000
                   FROM 1 BY 1                                          45010000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                45020000
                      OR SQLCODE = +0                                   45030000
                      OR SQLCODE = +100                                 45040000
                                                                        45050000
               EXEC SQL                                                 45060000
                   SELECT  MAX(XFER_STAT_TMST)                          45070000
                     INTO  :TFSTAT-XFER-STAT-TMST                       45080000
                              :PV-NULL-IND                              45090000
                     FROM  TTFSTAT                                      45100000
                    WHERE  (XFER_DKEY_ID  =  :DK-XFER-DKEY-ID)          45110000
               END-EXEC                                                 45120000
                                                                        45130000
               EVALUATE TRUE                                            45140000
                   WHEN SQLCODE = ZERO                                  45150000
                   WHEN SQLCODE = +100                                  45160000
                   WHEN SQLCODE = -904                                  45170000
                   WHEN SQLCODE = -913                                  45180000
                       CONTINUE                                         45190000
                   WHEN OTHER                                           45200000
                       MOVE 'SELECT MAX TIMESTAMP FOR DATALESS KEY: '   45210000
                                             TO DP013-MESSAGE-TEXT (1)  45220000
                       MOVE TFMSTR-XFER-DKEY-ID                         45230000
                                             TO PV-DISPLAY-XFER-DKEY-ID 45240000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     45250000
                                             TO DP013-MESSAGE-TEXT (2)  45260000
                       MOVE SQLCA            TO DP013-SQLCA             45270000
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)45280000
                       SET DP013-DB2-ABEND                              45290000
                           DP013-XCTL-DISPLAY-RESTART                   45300000
                                             TO TRUE                    45310000
                       PERFORM DP013-0000-PROCESS-ABEND                 45320000
               END-EVALUATE                                             45330000
           END-PERFORM.                                                 45340000
                                                                        45350000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          45360000
               MOVE 'MAX RETRIES EXCEEDED FOR'                          45370000
                                        TO DP013-MESSAGE-TEXT (1)       45380000
               MOVE 'SELECT MAX TIMESTAMP FOR DATALESS KEY: '           45390000
                                             TO DP013-MESSAGE-TEXT (2)  45400000
               MOVE TFMSTR-XFER-DKEY-ID                                 45410000
                                             TO PV-DISPLAY-XFER-DKEY-ID 45420000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             45430000
                                             TO DP013-MESSAGE-TEXT (3)  45440000
               MOVE SQLCA               TO DP013-SQLCA                  45450000
               MOVE 'TTFSTAT '          TO DP013-DB2-TABLE-NAME (1)     45460000
               SET DP013-DB2-ABEND                                      45470000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   45480000
               PERFORM DP013-0000-PROCESS-ABEND                         45490000
           END-IF.                                                      45500000
                                                                        45510000
       EJECT.                                                           45520000
      *----------------------------------------------------------------*45530000
      *  INSERT A ROW IN THE DISCREPANCY TABLE.                        *45540000
      *----------------------------------------------------------------*45550000
       7200-INSERT-DISCREPANCY-ROW.                                     45560000
                                                                        45570000
           MOVE '7200-INSERT-DISCREPANCY-ROW' TO DP013-PARAGRAPH.       45580000
                                                                        45590000
           INITIALIZE DCLTTFDSCP.                                       45600000
           IF ASC-RCV-STORE-NBR NOT = ASC-TO-STORE-NBR                  45610000
               SET PS-STORE-DISCREPANCY-EXISTS    TO TRUE               45620000
               MOVE ASC-RCV-STORE-NBR TO TFDSCP-RCVD-AT-STR-NBR         45630000
           ELSE                                                         45640000
               MOVE ZEROES            TO TFDSCP-RCVD-AT-STR-NBR         45650000
           END-IF.                                                      45660000
                                                                        45670000
           MOVE ASC-XFER-DKEY-ID      TO TFDSCP-XFER-DKEY-ID.           45680000
           MOVE ASC-LG-TOTE-SEAL1     TO TFDSCP-LG-TTE-1ST-SEAL-ID.     45690000
           MOVE ASC-LG-TOTE-SEAL2     TO TFDSCP-LG-TTE-2ND-SEAL-ID.     45700000
           MOVE ASC-SM-TOTE-SEAL      TO TFDSCP-SM-TTE-BG-SEAL-ID.      45710000
           MOVE ASC-TRAILER-NBR       TO TFDSCP-TRLR-NBR.               45720000
           MOVE ASC-TRAILER-SEAL      TO TFDSCP-TRLR-SEAL-ID.           45730000
                                                                        45740000
           PERFORM WITH TEST AFTER                                      45750000
                   VARYING PV-RETRY-COUNT                               45760000
                   FROM 1 BY 1                                          45770000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                45780000
                      OR SQLCODE = +0                                   45790000
                                                                        45800000
               EXEC SQL                                                 45810000
                   INSERT INTO TTFDSCP                                  45820000
                       (XFER_DKEY_ID,                                   45830000
                        RCV_XFER_BEG_TMST,                              45840000
                        RCVD_AT_STR_NBR,                                45850000
                        LG_TTE_1ST_SEAL_ID,                             45860000
                        LG_TTE_2ND_SEAL_ID,                             45870000
                        SM_TTE_BG_SEAL_ID,                              45880000
                        TRLR_NBR,                                       45890000
                        TRLR_SEAL_ID)                                   45900000
                   VALUES                                               45910000
                       (:TFDSCP-XFER-DKEY-ID,                           45920000
                        :PV-CURRENT-TIMESTAMP,                          45930000
                        :TFDSCP-RCVD-AT-STR-NBR,                        45940000
                        :TFDSCP-LG-TTE-1ST-SEAL-ID,                     45950000
                        :TFDSCP-LG-TTE-2ND-SEAL-ID,                     45960000
                        :TFDSCP-SM-TTE-BG-SEAL-ID,                      45970000
                        :TFDSCP-TRLR-NBR,                               45980000
                        :TFDSCP-TRLR-SEAL-ID)                           45990000
               END-EXEC                                                 46000000
                                                                        46010000
               EVALUATE TRUE                                            46020000
                   WHEN SQLCODE = ZERO                                  46030000
                   WHEN SQLCODE = -904                                  46040000
                   WHEN SQLCODE = -913                                  46050000
                       CONTINUE                                         46060000
                   WHEN OTHER                                           46070000
                       MOVE 'INSERT A DISCREPANCY ROW FOR DATALESS KEY' 46080000
                                             TO DP013-MESSAGE-TEXT (1)  46090000
                       MOVE TFRCPT-XFER-DKEY-ID                         46100000
                                             TO PV-DISPLAY-XFER-DKEY-ID 46110000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     46120000
                                             TO DP013-MESSAGE-TEXT (2)  46130000
                       MOVE SQLCA            TO DP013-SQLCA             46140000
                       MOVE 'TTFDSCP'        TO DP013-DB2-TABLE-NAME (1)46150000
                       SET DP013-DB2-ABEND                              46160000
                       DP013-XCTL-DISPLAY-RESTART                       46170000
                                            TO TRUE                     46180000
                       PERFORM DP013-0000-PROCESS-ABEND                 46190000
               END-EVALUATE                                             46200000
           END-PERFORM.                                                 46210000
                                                                        46220000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          46230000
               MOVE 'INSERT A DISCREPANCY ROW FOR DATALESS KEY VALUE:'  46240000
                                         TO DP013-MESSAGE-TEXT (1)      46250000
               MOVE TFRCPT-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID     46260000
               MOVE PV-DISPLAY-XFER-DKEY-ID TO DP013-MESSAGE-TEXT (2)   46270000
               MOVE SQLCA                TO DP013-SQLCA                 46280000
               MOVE 'TTFDSCP'            TO DP013-DB2-TABLE-NAME (1)    46290000
               SET DP013-DB2-ABEND                                      46300000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   46310000
               PERFORM DP013-0000-PROCESS-ABEND                         46320000
           END-IF.                                                      46330000
                                                                        46340000
       EJECT.                                                           46350000
      *----------------------------------------------------------------*46360000
      *  INSERT A ROW IN THE ITEM TABLE FOR A NON-RETAIL TRANSFER.     *46370000
      *----------------------------------------------------------------*46380000
       7220-INSERT-NON-RTL-ITM.                                         46390000
                                                                        46400000
           MOVE '7220-INSERT-NON-RTL-ITM'   TO DP013-PARAGRAPH.         46410000
                                                                        46420000
           INITIALIZE DCLTTFITEM.                                       46430000
                                                                        46440000
           MOVE DK-XFER-DKEY-ID      TO  TFITEM-XFER-DKEY-ID.           46450000
           MOVE PV-NEW-XFER-LNE-NBR  TO  TFITEM-XFER-LNE-NBR.           46460000
           MOVE LQW-NRTL-DESC1 (LQW-IDX)                                46470000
                                      TO  TFITEM-NRTL-1ST-LNE-DESC.     46480000
           MOVE LQW-NRTL-DESC2 (LQW-IDX)                                46490000
                                      TO  TFITEM-NRTL-2ND-LNE-DESC.     46500000
           MOVE LQW-FIXTURE (LQW-IDX) TO  TFITEM-NRTL-FIXT-ID.          46510000
           MOVE LQW-NRTL-DEPT (LQW-IDX) TO  TFITEM-NRTL-DEPT-NBR.       46520000
                                                                        46530000
           PERFORM WITH TEST AFTER                                      46540000
                   VARYING PV-RETRY-COUNT                               46550000
                   FROM 1 BY 1                                          46560000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                46570000
                      OR SQLCODE = +0                                   46580000
                                                                        46590000
               EXEC SQL                                                 46600000
                   INSERT INTO TTFITEM                                  46610000
                       (XFER_DKEY_ID,                                   46620000
                        XFER_LNE_NBR,                                   46630000
                        NRTL_1ST_LNE_DESC,                              46640000
                        NRTL_2ND_LNE_DESC,                              46650000
                        NRTL_FIXT_ID,                                   46660000
                        NRTL_DEPT_NBR)                                  46670000
                   VALUES                                               46680000
                       (:TFITEM-XFER-DKEY-ID,                           46690000
                        :TFITEM-XFER-LNE-NBR,                           46700000
                        :TFITEM-NRTL-1ST-LNE-DESC,                      46710000
                        :TFITEM-NRTL-2ND-LNE-DESC,                      46720000
                        :TFITEM-NRTL-FIXT-ID,                           46730000
                        :TFITEM-NRTL-DEPT-NBR)                          46740000
               END-EXEC                                                 46750000
                                                                        46760000
               EVALUATE TRUE                                            46770000
                   WHEN SQLCODE = ZERO                                  46780000
                   WHEN SQLCODE = -904                                  46790000
                   WHEN SQLCODE = -913                                  46800000
                       CONTINUE                                         46810000
                   WHEN OTHER                                           46820000
                    MOVE 'INSERT NON-RETAIL XFER ITEM FOR XFER_DKEY_ID:'46830000
                                             TO DP013-MESSAGE-TEXT (1)  46840000
                       MOVE DK-XFER-DKEY-ID TO PV-DISPLAY-XFER-DKEY-ID  46850000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     46860000
                                             TO DP013-MESSAGE-TEXT (2)  46870000
                       MOVE SQLCA            TO DP013-SQLCA             46880000
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)46890000
                       SET DP013-DB2-ABEND                              46900000
                       DP013-XCTL-DISPLAY-RESTART                       46910000
                                            TO TRUE                     46920000
                       PERFORM DP013-0000-PROCESS-ABEND                 46930000
               END-EVALUATE                                             46940000
           END-PERFORM.                                                 46950000
                                                                        46960000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          46970000
               MOVE 'INSERT NON-RETAIL XFER ITEM FOR XFER_DKEY_ID: '    46980000
                                         TO DP013-MESSAGE-TEXT (1)      46990000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     47000000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             47010000
                                         TO DP013-MESSAGE-TEXT (2)      47020000
               MOVE SQLCA                TO DP013-SQLCA                 47030000
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    47040000
               MOVE SQLCA                TO DP013-SQLCA                 47050000
               MOVE 'TTFDSCP'            TO DP013-DB2-TABLE-NAME (1)    47060000
               SET DP013-DB2-ABEND                                      47070000
                   DP013-XCTL-DISPLAY-RESTART                           47080000
                                        TO TRUE                         47090000
               PERFORM DP013-0000-PROCESS-ABEND                         47100000
           END-IF.                                                      47110000
                                                                        47120000
       EJECT.                                                           47130000
      *----------------------------------------------------------------*47140000
      *  INSERT A ROW IN THE ITEM TABLE FOR A RETAIL TRANSFER.         *47150000
      *----------------------------------------------------------------*47160000
       7250-INSERT-XFER-ITM.                                            47170000
                                                                        47180000
           MOVE '7250-INSERT-XFER-ITM'  TO DP013-PARAGRAPH.             47190000
                                                                        47200000
           INITIALIZE DCLTTFITEM.                                       47210000
                                                                        47220000
           MOVE DK-XFER-DKEY-ID            TO TFITEM-XFER-DKEY-ID.      47230000
           MOVE PV-NEW-XFER-LNE-NBR        TO TFITEM-XFER-LNE-NBR       47240000
           MOVE LQW-GROUP-PRICED-SW (LQW-IDX)                           47250000
                                           TO TFITEM-ITM-PRIC-MLT-IND.  47260000
           MOVE PC-NO                      TO TFITEM-RNBR-SKU-IND       47270000
           MOVE LQW-UPC       (LQW-IDX)    TO TFITEM-SCN-UPC-NBR        47280000
           MOVE LQW-KOHLS-UPC (LQW-IDX)    TO TFITEM-KOHLS-UPC-NBR      47290000
           MOVE LQW-ITEM-NBR (LQW-IDX)     TO TFITEM-ITM-NBR            47300000
                                                                        47310000
           MOVE LQW-RPRICE (LQW-IDX)      TO TFITEM-XFER-PRIC-AMT.      47320000
           MOVE LQW-CUR-RTL-AMT (LQW-IDX) TO TFITEM-CPLD-RTL-PRIC-AMT.  47330000
                                                                        47340000
           PERFORM WITH TEST AFTER                                      47350000
                   VARYING PV-RETRY-COUNT                               47360000
                   FROM 1 BY 1                                          47370000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                47380000
                      OR SQLCODE = +0                                   47390000
                                                                        47400000
               EXEC SQL                                                 47410000
                 INSERT INTO TTFITEM                                    47420000
                     (XFER_DKEY_ID,                                     47430000
                      XFER_LNE_NBR,                                     47440000
                      CPLD_RTL_PRIC_AMT,                                47450000
                      SCN_UPC_NBR,                                      47460000
                      KOHLS_UPC_NBR,                                    47470000
                      ITM_NBR,                                          47480000
                      XFER_PRIC_AMT,                                    47490000
                      RNBR_SKU_IND,                                     47500000
                      ITM_PRIC_MLT_IND)                                 47510000
                 VALUES                                                 47520000
                     (:TFITEM-XFER-DKEY-ID,                             47530000
                      :TFITEM-XFER-LNE-NBR,                             47540000
                      :TFITEM-CPLD-RTL-PRIC-AMT,                        47550000
                      :TFITEM-SCN-UPC-NBR,                              47560000
                      :TFITEM-KOHLS-UPC-NBR,                            47570000
                      :TFITEM-ITM-NBR,                                  47580000
                      :TFITEM-XFER-PRIC-AMT,                            47590000
                      :TFITEM-RNBR-SKU-IND,                             47600000
                      :TFITEM-ITM-PRIC-MLT-IND)                         47610000
               END-EXEC                                                 47620000
                                                                        47630000
               EVALUATE TRUE                                            47640000
                   WHEN SQLCODE = ZERO                                  47650000
                   WHEN SQLCODE = -904                                  47660000
                   WHEN SQLCODE = -913                                  47670000
                       CONTINUE                                         47680000
                   WHEN OTHER                                           47690000
                       MOVE 'INSERT RTL XFER ITM FOR XFER_DKEY_ID: '    47700000
                                             TO DP013-MESSAGE-TEXT (1)  47710000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 47720000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     47730000
                                             TO DP013-MESSAGE-TEXT (2)  47740000
                       MOVE PV-NEW-XFER-LNE-NBR                         47750000
                                            TO PV-DISPLAY-XFER-LNE-NBR  47760000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     47770000
                                             TO DP013-MESSAGE-TEXT (3)  47780000
                       MOVE SQLCA            TO DP013-SQLCA             47790000
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)47800000
                       SET DP013-DB2-ABEND                              47810000
                       DP013-XCTL-DISPLAY-RESTART                       47820000
                                            TO TRUE                     47830000
                       PERFORM DP013-0000-PROCESS-ABEND                 47840000
               END-EVALUATE                                             47850000
           END-PERFORM.                                                 47860000
                                                                        47870000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          47880000
               MOVE 'INSERT RTL XFER ITM FOR XFER_DKEY_ID: '            47890000
                                         TO DP013-MESSAGE-TEXT (1)      47900000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     47910000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             47920000
                                         TO DP013-MESSAGE-TEXT (2)      47930000
               MOVE PV-NEW-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     47940000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             47950000
                                         TO DP013-MESSAGE-TEXT (3)      47960000
               MOVE SQLCA                TO DP013-SQLCA                 47970000
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    47980000
               SET DP013-DB2-ABEND                                      47990000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   48000000
               PERFORM DP013-0000-PROCESS-ABEND                         48010000
           END-IF.                                                      48020000
                                                                        48030000
       EJECT.                                                           48040000
      *----------------------------------------------------------------*48050000
      *  INSERT THE DEFAULT RECEIPT ROW.                               *48060000
      *----------------------------------------------------------------*48070000
       7300-INSERT-ITM-RCPT.                                            48080000
                                                                        48090000
           MOVE '7300-INSERT-ITM-RCPT'  TO DP013-PARAGRAPH.             48100000
                                                                        48110000
           PERFORM WITH TEST AFTER                                      48120000
                   VARYING PV-RETRY-COUNT                               48130000
                   FROM 1 BY 1                                          48140000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                48150000
                      OR SQLCODE = +0                                   48160000
                                                                        48170000
               EXEC SQL                                                 48180000
                   INSERT INTO TTFITRC                                  48190000
                       (XFER_DKEY_ID,                                   48200000
                        XFER_LNE_NBR,                                   48210000
                        XFER_LNE_SEQ_NBR,                               48220000
                        XFER_RCPT_TMST,                                 48230000
                        RCVD_XFER_PRIC_AMT,                             48240000
                        RCVD_RTL_PRIC_AMT,                              48250000
                        XFER_ITM_DSCRP_IND)                             48260000
                   VALUES                                               48270000
                       (:DK-XFER-DKEY-ID,                               48280000
                        :TFITEM-XFER-LNE-NBR,                           48290000
                        1,                                              48300000
                        :PV-CURRENT-TIMESTAMP,                          48310000
                        :TFITEM-XFER-PRIC-AMT,                          48320000
                        :TFITRC-RCVD-RTL-PRIC-AMT,                      48330000
                        :PC-NO)                                         48340000
               END-EXEC                                                 48350000
                                                                        48360000
               EVALUATE TRUE                                            48370000
                   WHEN SQLCODE = ZERO                                  48380000
                   WHEN SQLCODE = -904                                  48390000
                   WHEN SQLCODE = -913                                  48400000
                       CONTINUE                                         48410000
                   WHEN OTHER                                           48420000
                       MOVE 'INSERT ITEM RCPT FOR DLESS KEY/LINE/TIME'  48430000
                                             TO DP013-MESSAGE-TEXT (1)  48440000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 48450000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     48460000
                                             TO DP013-MESSAGE-TEXT (2)  48470000
                       MOVE TFITEM-XFER-LNE-NBR                         48480000
                                             TO PV-DISPLAY-XFER-LNE-NBR 48490000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     48500000
                                             TO DP013-MESSAGE-TEXT (3)  48510000
                       MOVE PV-CURRENT-TIMESTAMP                        48520000
                                             TO DP013-MESSAGE-TEXT (4)  48530000
                       MOVE SQLCA            TO DP013-SQLCA             48540000
                       MOVE 'TTFITRC'        TO DP013-DB2-TABLE-NAME (1)48550000
                       SET DP013-DB2-ABEND                              48560000
                       DP013-XCTL-DISPLAY-RESTART                       48570000
                                            TO TRUE                     48580000
                       PERFORM DP013-0000-PROCESS-ABEND                 48590000
               END-EVALUATE                                             48600000
           END-PERFORM.                                                 48610000
                                                                        48620000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          48630000
               MOVE 'INSERT ITEM RECEIPT FOR DLESS KEY/LINE/TIME'       48640000
                                         TO DP013-MESSAGE-TEXT (1)      48650000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     48660000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             48670000
                                         TO DP013-MESSAGE-TEXT (2)      48680000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     48690000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             48700000
                                         TO DP013-MESSAGE-TEXT (3)      48710000
               MOVE PV-CURRENT-TIMESTAMP                                48720000
                                         TO DP013-MESSAGE-TEXT (4)      48730000
               MOVE SQLCA                TO DP013-SQLCA                 48740000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    48750000
               SET DP013-DB2-ABEND                                      48760000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   48770000
               PERFORM DP013-0000-PROCESS-ABEND                         48780000
           END-IF.                                                      48790000
                                                                        48800000
       EJECT.                                                           48810000
      *----------------------------------------------------------------*48820000
      *  INSERT A ROW IN THE ITEM RECEIPT TABLE FOR A RETAIL TRANSFER. *48830000
      *----------------------------------------------------------------*48840000
       7350-INSERT-RTL-ITM-RCPT.                                        48850000
                                                                        48860000
           MOVE '7350-INSERT-RTL-ITM-RCPT'   TO DP013-PARAGRAPH.        48870000
                                                                        48880000
           MOVE LQW-RQTY (LQW-IDX)         TO  TFITRC-RCVD-XFER-QTY.    48890000
           MOVE LQW-RPRICE (LQW-IDX)       TO TFITRC-RCVD-XFER-PRIC-AMT.48900000
           MOVE LQW-CUR-RTL-AMT (LQW-IDX)  TO TFITRC-RCVD-RTL-PRIC-AMT. 48910000
                                                                        48920000
           PERFORM WITH TEST AFTER                                      48930000
                   VARYING PV-RETRY-COUNT                               48940000
                   FROM 1 BY 1                                          48950000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                48960000
                      OR SQLCODE = +0                                   48970000
                                                                        48980000
               EXEC SQL                                                 48990000
                   INSERT INTO TTFITRC                                  49000000
                       (XFER_DKEY_ID,                                   49010000
                        XFER_LNE_NBR,                                   49020000
                        XFER_LNE_SEQ_NBR,                               49030000
                        XFER_RCPT_TMST,                                 49040000
                        RCVD_XFER_QTY,                                  49050000
                        RCVD_XFER_PRIC_AMT,                             49060000
                        RCVD_RTL_PRIC_AMT,                              49070000
                        XFER_ITM_DSCRP_IND)                             49080000
                   VALUES                                               49090000
                       (:DK-XFER-DKEY-ID,                               49100000
                        :TFITEM-XFER-LNE-NBR,                           49110000
                        :TFITRC-XFER-LNE-SEQ-NBR,                       49120000
                        :PV-CURRENT-TIMESTAMP,                          49130000
                        :TFITRC-RCVD-XFER-QTY,                          49140000
                        :TFITRC-RCVD-XFER-PRIC-AMT,                     49150000
                        :TFITRC-RCVD-RTL-PRIC-AMT,                      49160000
                        'N')                                            49170000
               END-EXEC                                                 49180000
                                                                        49190000
               EVALUATE TRUE                                            49200000
                   WHEN SQLCODE = ZERO                                  49210000
                   WHEN SQLCODE = -904                                  49220000
                   WHEN SQLCODE = -913                                  49230000
                       CONTINUE                                         49240000
                   WHEN OTHER                                           49250000
                       MOVE 'INSERT XFER ITM RCPT FOR DLESSKEY/LINE/TIM'49260000
                                             TO DP013-MESSAGE-TEXT (1)  49270000
                       MOVE DK-XFER-DKEY-ID TO PV-DISPLAY-XFER-DKEY-ID  49280000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     49290000
                                             TO DP013-MESSAGE-TEXT (2)  49300000
                       MOVE TFITEM-XFER-LNE-NBR                         49310000
                                             TO PV-DISPLAY-XFER-LNE-NBR 49320000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     49330000
                                             TO DP013-MESSAGE-TEXT (3)  49340000
                       MOVE PV-CURRENT-TIMESTAMP                        49350000
                                             TO DP013-MESSAGE-TEXT (4)  49360000
                       MOVE SQLCA            TO DP013-SQLCA             49370000
                       MOVE 'TTFITRC'       TO DP013-DB2-TABLE-NAME (1) 49380000
                       SET DP013-DB2-ABEND                              49390000
                       DP013-XCTL-DISPLAY-RESTART                       49400000
                                            TO TRUE                     49410000
                       PERFORM DP013-0000-PROCESS-ABEND                 49420000
               END-EVALUATE                                             49430000
           END-PERFORM.                                                 49440000
                                                                        49450000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          49460000
               MOVE 'INSERT XFER ITM RECEIPT FOR DLESS KEY/LINE/TIME'   49470000
                                         TO DP013-MESSAGE-TEXT (1)      49480000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     49490000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             49500000
                                         TO DP013-MESSAGE-TEXT (2)      49510000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     49520000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             49530000
                                         TO DP013-MESSAGE-TEXT (3)      49540000
               MOVE PV-CURRENT-TIMESTAMP                                49550000
                                         TO DP013-MESSAGE-TEXT (4)      49560000
               MOVE SQLCA                TO DP013-SQLCA                 49570000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    49580000
               SET DP013-DB2-ABEND                                      49590000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   49600000
               PERFORM DP013-0000-PROCESS-ABEND                         49610000
           END-IF.                                                      49620000
                                                                        49630000
       EJECT.                                                           49640000
      *----------------------------------------------------------------*49650000
      *  INSERT A ROW IN THE ITEM RECEIPT TABLE FOR A NON-RETAIL XFER. *49660000
      *----------------------------------------------------------------*49670000
       7360-INSERT-NON-RTL-ITM-RCPT.                                    49680000
                                                                        49690000
           MOVE '7360-INSERT-NON-RTL-ITM-RCPT' TO DP013-PARAGRAPH.      49700000
                                                                        49710000
           MOVE LQW-RQTY (LQW-IDX)         TO  TFITRC-RCVD-XFER-QTY.    49720000
                                                                        49730000
           PERFORM WITH TEST AFTER                                      49740000
                   VARYING PV-RETRY-COUNT                               49750000
                   FROM 1 BY 1                                          49760000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                49770000
                      OR SQLCODE = +0                                   49780000
                                                                        49790000
               EXEC SQL                                                 49800000
                   INSERT INTO TTFITRC                                  49810000
                       (XFER_DKEY_ID,                                   49820000
                        XFER_LNE_NBR,                                   49830000
                        XFER_LNE_SEQ_NBR,                               49840000
                        XFER_RCPT_TMST,                                 49850000
                        RCVD_XFER_QTY,                                  49860000
                        XFER_ITM_DSCRP_IND)                             49870000
                   VALUES                                               49880000
                       (:DK-XFER-DKEY-ID,                               49890000
                        :TFITEM-XFER-LNE-NBR,                           49900000
                        :TFITRC-XFER-LNE-SEQ-NBR,                       49910000
                        :PV-CURRENT-TIMESTAMP,                          49920000
                        :TFITRC-RCVD-XFER-QTY,                          49930000
                        'N')                                            49940000
               END-EXEC                                                 49950000
                                                                        49960000
               EVALUATE TRUE                                            49970000
                   WHEN SQLCODE = ZERO                                  49980000
                   WHEN SQLCODE = -904                                  49990000
                   WHEN SQLCODE = -913                                  50000000
                       CONTINUE                                         50010000
                   WHEN OTHER                                           50020000
                       MOVE 'INSERT XFER ITM RCPT FOR DLSS KEY/LINE/TIM'50030000
                                             TO DP013-MESSAGE-TEXT (1)  50040000
                       MOVE DK-XFER-DKEY-ID TO PV-DISPLAY-XFER-DKEY-ID  50050000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     50060000
                                             TO DP013-MESSAGE-TEXT (2)  50070000
                       MOVE TFITEM-XFER-LNE-NBR                         50080000
                                             TO PV-DISPLAY-XFER-LNE-NBR 50090000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     50100000
                                             TO DP013-MESSAGE-TEXT (3)  50110000
                       MOVE PV-CURRENT-TIMESTAMP                        50120000
                                             TO DP013-MESSAGE-TEXT (4)  50130000
                       MOVE SQLCA            TO DP013-SQLCA             50140000
                       MOVE 'TTFITRC'       TO DP013-DB2-TABLE-NAME (1) 50150000
                       SET DP013-DB2-ABEND                              50160000
                       DP013-XCTL-DISPLAY-RESTART                       50170000
                                            TO TRUE                     50180000
                       PERFORM DP013-0000-PROCESS-ABEND                 50190000
               END-EVALUATE                                             50200000
           END-PERFORM.                                                 50210000
                                                                        50220000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          50230000
               MOVE 'INSERT XFER ITM RECEIPT FOR DLESS KEY/LINE/TIME'   50240000
                                         TO DP013-MESSAGE-TEXT (1)      50250000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     50260000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             50270000
                                         TO DP013-MESSAGE-TEXT (2)      50280000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     50290000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             50300000
                                         TO DP013-MESSAGE-TEXT (3)      50310000
               MOVE PV-CURRENT-TIMESTAMP                                50320000
                                         TO DP013-MESSAGE-TEXT (4)      50330000
               MOVE SQLCA                TO DP013-SQLCA                 50340000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    50350000
               SET DP013-DB2-ABEND                                      50360000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   50370000
               PERFORM DP013-0000-PROCESS-ABEND                         50380000
           END-IF.                                                      50390000
                                                                        50400000
       EJECT.                                                           50410000
      *----------------------------------------------------------------*50420000
      *  UPDATE THE RECEIVED QTY FOR AN ITEM ALREADY ON THE TRANSFER.  *50430000
      *----------------------------------------------------------------*50440000
       7380-UPDATE-RCVD-ITEM-QTY.                                       50450000
                                                                        50460000
           MOVE '7380-UPDATE-RCVD-ITEM-QTY'  TO DP013-PARAGRAPH.        50470000
                                                                        50480000
           MOVE PV-RECEIVED-QTY          TO  TFITRC-RCVD-XFER-QTY.      50490000
                                                                        50500000
           PERFORM WITH TEST AFTER                                      50510000
                   VARYING PV-RETRY-COUNT                               50520000
                   FROM 1 BY 1                                          50530000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                50540000
                      OR SQLCODE = +0                                   50550000
                                                                        50560000
               EXEC SQL                                                 50570000
                 UPDATE  TTFITRC                                        50580000
                  SET  RCVD_XFER_QTY       = :TFITRC-RCVD-XFER-QTY      50590000
                 WHERE  XFER_DKEY_ID       = :DK-XFER-DKEY-ID           50600000
                   AND  XFER_LNE_NBR       = :TFITEM-XFER-LNE-NBR       50610000
                   AND  XFER_RCPT_TMST     = :PV-CURRENT-TIMESTAMP      50620000
                   AND  RCVD_XFER_PRIC_AMT = :DK-XFER-PRIC-AMT          50630000
               END-EXEC                                                 50640000
                                                                        50650000
               EVALUATE TRUE                                            50660000
                   WHEN SQLCODE = ZERO                                  50670000
                   WHEN SQLCODE = -904                                  50680000
                   WHEN SQLCODE = -913                                  50690000
                       CONTINUE                                         50700000
                   WHEN OTHER                                           50710000
                       MOVE 'UPDATE XFER ITEM RCD QTY FOR DLESS KEY/LIN'50720000
                                             TO DP013-MESSAGE-TEXT (1)  50730000
                       MOVE DK-XFER-DKEY-ID TO PV-DISPLAY-XFER-DKEY-ID  50740000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     50750000
                                             TO DP013-MESSAGE-TEXT (2)  50760000
                       MOVE TFITEM-XFER-LNE-NBR                         50770000
                                             TO PV-DISPLAY-XFER-LNE-NBR 50780000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     50790000
                                             TO DP013-MESSAGE-TEXT (3)  50800000
                       MOVE PV-CURRENT-TIMESTAMP                        50810000
                                             TO DP013-MESSAGE-TEXT (4)  50820000
                       MOVE SQLCA            TO DP013-SQLCA             50830000
                       MOVE 'TTFITRC'        TO DP013-DB2-TABLE-NAME (1)50840000
                       SET DP013-DB2-ABEND                              50850000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               50860000
                       PERFORM DP013-0000-PROCESS-ABEND                 50870000
               END-EVALUATE                                             50880000
           END-PERFORM.                                                 50890000
                                                                        50900000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          50910000
               MOVE 'UPDATE XFER ITEM RECEIVED QTY FOR DLESS KEY/LINE'  50920000
                                         TO DP013-MESSAGE-TEXT (1)      50930000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     50940000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             50950000
                                         TO DP013-MESSAGE-TEXT (2)      50960000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     50970000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             50980000
                                         TO DP013-MESSAGE-TEXT (3)      50990000
               MOVE PV-CURRENT-TIMESTAMP                                51000000
                                         TO DP013-MESSAGE-TEXT (4)      51010000
               MOVE SQLCA                TO DP013-SQLCA                 51020000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    51030000
               SET DP013-DB2-ABEND                                      51040000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   51050000
               PERFORM DP013-0000-PROCESS-ABEND                         51060000
           END-IF.                                                      51070000
                                                                        51080000
       EJECT.                                                           51090000
      *----------------------------------------------------------------*51100000
      *  SELECT A TRANSFER ITEM BY THE ITEM NUMBER AND PRICE.          *51110000
      *----------------------------------------------------------------*51120000
       7400-SELECT-ITM-BY-ITMNBR-PRI.                                   51130000
                                                                        51140000
           MOVE '7400-SELECT-ITM-BY-ITMNBR-PRI' TO DP013-PARAGRAPH.     51150000
                                                                        51160000
           INITIALIZE DCLTTFITEM.                                       51170000
           MOVE LQW-RPRICE (LQW-IDX) TO DK-XFER-PRIC-AMT.               51180000
           MOVE LQW-ITEM-NBR (LQW-IDX) TO DK-ITEM-NBR.                  51190000
                                                                        51200000
           PERFORM WITH TEST AFTER                                      51210000
                   VARYING PV-RETRY-COUNT                               51220000
                   FROM 1 BY 1                                          51230000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                51240000
                      OR SQLCODE = +0                                   51250000
                      OR SQLCODE = +100                                 51260000
                                                                        51270000
               EXEC SQL                                                 51280000
                   SELECT  XFER_LNE_NBR,                                51290000
                           XFER_PRIC_AMT,                               51300000
                           XFER_QTY,                                    51310000
                           RNBR_SKU_IND                                 51320000
                     INTO  :TFITEM-XFER-LNE-NBR,                        51330000
                           :TFITEM-XFER-PRIC-AMT,                       51340000
                           :TFITEM-XFER-QTY,                            51350000
                           :TFITEM-RNBR-SKU-IND                         51360000
                     FROM  TTFITEM                                      51370000
                    WHERE  XFER_DKEY_ID   =  :DK-XFER-DKEY-ID           51380000
                      AND  ITM_NBR        =  :DK-ITEM-NBR               51390000
                      AND  XFER_PRIC_AMT  =  :DK-XFER-PRIC-AMT          51400000
               END-EXEC                                                 51410000
                                                                        51420000
               EVALUATE TRUE                                            51430000
                   WHEN SQLCODE = ZERO                                  51440000
                   WHEN SQLCODE = +100                                  51450000
                   WHEN SQLCODE = -904                                  51460000
                   WHEN SQLCODE = -913                                  51470000
                       CONTINUE                                         51480000
                   WHEN OTHER                                           51490000
                       MOVE 'SELECT XFER ITEM FOR DLESS KEY/ITEM/PRICE' 51500000
                                             TO DP013-MESSAGE-TEXT (1)  51510000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 51520000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     51530000
                                             TO DP013-MESSAGE-TEXT (2)  51540000
                       MOVE DK-ITEM-NBR TO PV-DISPLAY-ITM-NBR           51550000
                       MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (3)51560000
                       MOVE DK-XFER-PRIC-AMT TO PV-DISPLAY-XFER-PRIC-AMT51570000
                       MOVE PV-DISPLAY-XFER-PRIC-AMT                    51580000
                                             TO DP013-MESSAGE-TEXT (4)  51590000
                       MOVE SQLCA            TO DP013-SQLCA             51600000
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)51610000
                       SET DP013-DB2-ABEND                              51620000
                       DP013-XCTL-DISPLAY-RESTART                       51630000
                                            TO TRUE                     51640000
                       PERFORM DP013-0000-PROCESS-ABEND                 51650000
               END-EVALUATE                                             51660000
           END-PERFORM.                                                 51670000
                                                                        51680000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          51690000
              MOVE 'SELECT XFER ITEM FOR DLESS KEY/ITEM/PRICE'          51700000
                                    TO DP013-MESSAGE-TEXT (1)           51710000
              MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID          51720000
              MOVE PV-DISPLAY-XFER-DKEY-ID                              51730000
                                    TO DP013-MESSAGE-TEXT (2)           51740000
              MOVE DK-ITEM-NBR TO PV-DISPLAY-ITM-NBR                    51750000
              MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (3)         51760000
              MOVE DK-XFER-PRIC-AMT TO PV-DISPLAY-XFER-PRIC-AMT         51770000
              MOVE PV-DISPLAY-XFER-PRIC-AMT                             51780000
                                    TO DP013-MESSAGE-TEXT (4)           51790000
              MOVE SQLCA            TO DP013-SQLCA                      51800000
              MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)         51810000
              SET DP013-DB2-ABEND                                       51820000
              DP013-XCTL-DISPLAY-RESTART TO TRUE                        51830000
              PERFORM DP013-0000-PROCESS-ABEND                          51840000
           END-IF.                                                      51850000
                                                                        51860000
       EJECT.                                                           51870000
      *----------------------------------------------------------------*51880000
      *  SELECT A TRANSFER ITEM BY THE ITEM NUMBER.                    *51890000
      *----------------------------------------------------------------*51900000
       7410-SELECT-ITM-BY-ITMNBR.                                       51910000
                                                                        51920000
           MOVE '7410-SELECT-ITM-BY-ITMNBR'  TO DP013-PARAGRAPH.        51930000
                                                                        51940000
           INITIALIZE DCLTTFITEM.                                       51950000
                                                                        51960000
           PERFORM WITH TEST AFTER                                      51970000
                   VARYING PV-RETRY-COUNT                               51980000
                   FROM 1 BY 1                                          51990000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                52000000
                      OR SQLCODE = +0                                   52010000
                      OR SQLCODE = +100                                 52020000
                      OR SQLCODE = -811                                 52030000
                                                                        52040000
               EXEC SQL                                                 52050000
                   SELECT  XFER_LNE_NBR,                                52060000
                           CPLD_RTL_PRIC_AMT,                           52070000
                           XFER_PRIC_AMT,                               52080000
                           XFER_QTY,                                    52090000
                           RNBR_SKU_IND,                                52100000
                           ITM_PRIC_MLT_IND                             52110000
                     INTO  :TFITEM-XFER-LNE-NBR,                        52120000
                           :TFITEM-CPLD-RTL-PRIC-AMT,                   52130000
                           :TFITEM-XFER-PRIC-AMT,                       52140000
                           :TFITEM-XFER-QTY,                            52150000
                           :TFITEM-RNBR-SKU-IND,                        52160000
                           :TFITEM-ITM-PRIC-MLT-IND                     52170000
                     FROM  TTFITEM                                      52180000
                    WHERE  XFER_DKEY_ID  =  :DK-XFER-DKEY-ID            52190000
                      AND  ITM_NBR       =  :DK-ITEM-NBR                52200000
               END-EXEC                                                 52210000
                                                                        52220000
               EVALUATE TRUE                                            52230000
                   WHEN SQLCODE = ZERO                                  52240000
                   WHEN SQLCODE = +100                                  52250000
                   WHEN SQLCODE = -811                                  52260000
                   WHEN SQLCODE = -904                                  52270000
                   WHEN SQLCODE = -913                                  52280000
                       CONTINUE                                         52290000
                   WHEN OTHER                                           52300000
                      MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR: '52310000
                                             TO DP013-MESSAGE-TEXT (1)  52320000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 52330000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     52340000
                                             TO DP013-MESSAGE-TEXT (2)  52350000
                       MOVE DK-ITEM-NBR TO PV-DISPLAY-ITM-NBR           52360000
                      MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (3) 52370000
                       MOVE SQLCA            TO DP013-SQLCA             52380000
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)52390000
                       SET DP013-DB2-ABEND                              52400000
                       DP013-XCTL-DISPLAY-RESTART                       52410000
                                            TO TRUE                     52420000
                       PERFORM DP013-0000-PROCESS-ABEND                 52430000
               END-EVALUATE                                             52440000
           END-PERFORM.                                                 52450000
                                                                        52460000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          52470000
               MOVE 'SELECT XFER ITEM FOR XFER_DKEY_ID/ITM_NBR: '       52480000
                                         TO DP013-MESSAGE-TEXT (1)      52490000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     52500000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             52510000
                                         TO DP013-MESSAGE-TEXT (2)      52520000
               MOVE DK-ITEM-NBR     TO PV-DISPLAY-ITM-NBR               52530000
               MOVE PV-DISPLAY-ITM-NBR   TO DP013-MESSAGE-TEXT (3)      52540000
               MOVE SQLCA                TO DP013-SQLCA                 52550000
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    52560000
                   SET DP013-DB2-ABEND                                  52570000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   52580000
                   PERFORM DP013-0000-PROCESS-ABEND                     52590000
           END-IF.                                                      52600000
                                                                        52610000
       EJECT.                                                           52620000
      *----------------------------------------------------------------*52630000
      *  SELECT A TRANSFER ITEM RECEIPT BY LINE NUMBER AND PRICE.      *52640000
      *----------------------------------------------------------------*52650000
       7420-SELECT-XFER-ITM-RCPT.                                       52660000
                                                                        52670000
           MOVE '7420-SELECT-XFER-ITM-RCPT'  TO DP013-PARAGRAPH.        52680000
                                                                        52690000
           MOVE LQW-RPRICE (LQW-IDX) TO DK-XFER-PRIC-AMT.               52700000
                                                                        52710000
           PERFORM WITH TEST AFTER                                      52720000
                   VARYING PV-RETRY-COUNT                               52730000
                   FROM 1 BY 1                                          52740000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                52750000
                      OR SQLCODE = +0                                   52760000
                      OR SQLCODE = +100                                 52770000
                                                                        52780000
               EXEC SQL                                                 52790000
                  SELECT  XFER_LNE_SEQ_NBR,                             52800000
                          RCVD_XFER_QTY                                 52810000
                    INTO  :TFITRC-XFER-LNE-SEQ-NBR,                     52820000
                          :TFITRC-RCVD-XFER-QTY                         52830000
                    FROM  TTFITRC                                       52840000
                  WHERE  XFER_DKEY_ID      =  :DK-XFER-DKEY-ID          52850000
                   AND   XFER_LNE_NBR       =  :TFITEM-XFER-LNE-NBR     52860000
                   AND   XFER_RCPT_TMST     =  :PV-CURRENT-TIMESTAMP    52870000
                   AND   RCVD_XFER_PRIC_AMT =  :DK-XFER-PRIC-AMT        52880000
               END-EXEC                                                 52890000
                                                                        52900000
               EVALUATE TRUE                                            52910000
                   WHEN SQLCODE = ZERO                                  52920000
                   WHEN SQLCODE = +100                                  52930000
                   WHEN SQLCODE = -904                                  52940000
                   WHEN SQLCODE = -913                                  52950000
                       CONTINUE                                         52960000
                   WHEN OTHER                                           52970000
                       MOVE 'SELECT XFER ITEM FOR DLESS KEY/LINE/AMT'   52980000
                                               TO DP013-MESSAGE-TEXT (1)52990000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 53000000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     53010000
                                             TO DP013-MESSAGE-TEXT (2)  53020000
                     MOVE TFITEM-XFER-LNE-NBR TO PV-DISPLAY-XFER-LNE-NBR53030000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     53040000
                                             TO DP013-MESSAGE-TEXT (3)  53050000
                       MOVE DK-XFER-PRIC-AMT                            53060000
                                             TO PV-DISPLAY-XFER-PRIC-AMT53070000
                       MOVE PV-DISPLAY-XFER-PRIC-AMT                    53080000
                                             TO DP013-MESSAGE-TEXT (4)  53090000
                       MOVE SQLCA            TO DP013-SQLCA             53100000
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)53110000
                       SET DP013-DB2-ABEND                              53120000
                       DP013-XCTL-DISPLAY-RESTART                       53130000
                                            TO TRUE                     53140000
                       PERFORM DP013-0000-PROCESS-ABEND                 53150000
               END-EVALUATE                                             53160000
           END-PERFORM.                                                 53170000
                                                                        53180000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          53190000
               MOVE 'SELECT XFER ITEM FOR DLESS KEY/LINE/PRICE'         53200000
                                         TO DP013-MESSAGE-TEXT (1)      53210000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     53220000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             53230000
                                         TO DP013-MESSAGE-TEXT (2)      53240000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     53250000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             53260000
                                         TO DP013-MESSAGE-TEXT (3)      53270000
               MOVE DK-XFER-PRIC-AMT                                    53280000
                                         TO PV-DISPLAY-XFER-PRIC-AMT    53290000
               MOVE PV-DISPLAY-XFER-PRIC-AMT                            53300000
                                         TO DP013-MESSAGE-TEXT (4)      53310000
               MOVE SQLCA                TO DP013-SQLCA                 53320000
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    53330000
               SET DP013-DB2-ABEND                                      53340000
               DP013-XCTL-DISPLAY-RESTART TO TRUE                       53350000
               PERFORM DP013-0000-PROCESS-ABEND                         53360000
           END-IF.                                                      53370000
                                                                        53380000
       EJECT.                                                           53390000
      *----------------------------------------------------------------*53400000
      *  SELECT A TRANSFER ITEM BY UPC AND PRICE                       *53410000
      *----------------------------------------------------------------*53420000
       7450-SELECT-XFER-ITM-BY-UPC.                                     53430000
                                                                        53440000
           MOVE '7450-SELECT-XFER-ITM-BY-UPC' TO DP013-PARAGRAPH.       53450000
                                                                        53460000
           INITIALIZE DCLTTFITEM.                                       53470000
           MOVE LQW-RPRICE (LQW-IDX)        TO DK-XFER-PRIC-AMT.        53480000
           MOVE LQW-KOHLS-UPC (LQW-IDX)     TO TFITEM-KOHLS-UPC-NBR.    53490000
                                                                        53500000
           PERFORM WITH TEST AFTER                                      53510000
                   VARYING PV-RETRY-COUNT                               53520000
                   FROM 1 BY 1                                          53530000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                53540000
                      OR SQLCODE = +0                                   53550000
                      OR SQLCODE = +100                                 53560000
                                                                        53570000
               EXEC SQL                                                 53580000
                   SELECT  XFER_LNE_NBR,                                53590000
                           XFER_PRIC_AMT,                               53600000
                           XFER_QTY,                                    53610000
                           RNBR_SKU_IND                                 53620000
                     INTO  :TFITEM-XFER-LNE-NBR,                        53630000
                           :TFITEM-XFER-PRIC-AMT,                       53640000
                           :TFITEM-XFER-QTY,                            53650000
                           :TFITEM-RNBR-SKU-IND                         53660000
                     FROM  TTFITEM                                      53670000
                    WHERE  XFER_DKEY_ID   =  :DK-XFER-DKEY-ID           53680000
                       AND KOHLS_UPC_NBR  =  :TFITEM-KOHLS-UPC-NBR      53690000
                       AND XFER_PRIC_AMT  =  :DK-XFER-PRIC-AMT          53700000
               END-EXEC                                                 53710000
                                                                        53720000
               EVALUATE TRUE                                            53730000
                   WHEN SQLCODE = ZERO                                  53740000
                   WHEN SQLCODE = +100                                  53750000
                   WHEN SQLCODE = -904                                  53760000
                   WHEN SQLCODE = -913                                  53770000
                       CONTINUE                                         53780000
                   WHEN OTHER                                           53790000
                       MOVE 'SELECT XFER ITEM FOR DLESS KEY/UPC/PRICE'  53800000
                                             TO DP013-MESSAGE-TEXT (1)  53810000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 53820000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     53830000
                                             TO DP013-MESSAGE-TEXT (2)  53840000
                       MOVE TFITEM-KOHLS-UPC-NBR                        53850000
                                          TO PV-DISPLAY-UPC-NBR         53860000
                       MOVE PV-DISPLAY-UPC-NBR TO DP013-MESSAGE-TEXT (3)53870000
                       MOVE DK-XFER-PRIC-AMT TO PV-DISPLAY-XFER-PRIC-AMT53880000
                       MOVE PV-DISPLAY-XFER-PRIC-AMT                    53890000
                                             TO DP013-MESSAGE-TEXT (4)  53900000
                       MOVE SQLCA            TO DP013-SQLCA             53910000
                       MOVE 'TTFITEM'        TO DP013-DB2-TABLE-NAME (1)53920000
                       SET DP013-DB2-ABEND                              53930000
                       DP013-XCTL-DISPLAY-RESTART                       53940000
                                            TO TRUE                     53950000
                       PERFORM DP013-0000-PROCESS-ABEND                 53960000
               END-EVALUATE                                             53970000
           END-PERFORM.                                                 53980000
                                                                        53990000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          54000000
               MOVE 'SELECT XFER ITEM FOR DLESS KEY/UPC/PRICE'          54010000
                                         TO DP013-MESSAGE-TEXT (1)      54020000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     54030000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             54040000
                                         TO DP013-MESSAGE-TEXT (2)      54050000
               MOVE TFITEM-KOHLS-UPC-NBR                                54060000
                                     TO PV-DISPLAY-UPC-NBR              54070000
               MOVE PV-DISPLAY-UPC-NBR   TO DP013-MESSAGE-TEXT (3)      54080000
               MOVE DK-XFER-PRIC-AMT     TO PV-DISPLAY-XFER-PRIC-AMT    54090000
               MOVE PV-DISPLAY-XFER-PRIC-AMT                            54100000
                                         TO DP013-MESSAGE-TEXT (4)      54110000
               MOVE SQLCA                TO DP013-SQLCA                 54120000
               MOVE 'TTFITEM'            TO DP013-DB2-TABLE-NAME (1)    54130000
               SET DP013-DB2-ABEND                                      54140000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   54150000
               PERFORM DP013-0000-PROCESS-ABEND                         54160000
           END-IF.                                                      54170000
                                                                        54180000
       EJECT.                                                           54190000
      *----------------------------------------------------------------*54200000
      *  SELECT ITEM NUMBER FROM TSKXREF USING THE UPC NUMBER.         *54210000
      *----------------------------------------------------------------*54220000
100404 7500-SELECT-TSKXREF.                                             54230000
                                                                        54240000
100404     MOVE '7500-SELECT-TSKXREF' TO DP013-PARAGRAPH.               54250000
                                                                        54260000
           PERFORM WITH TEST AFTER                                      54290000
                   VARYING PV-RETRY-COUNT                               54300000
                   FROM 1 BY 1                                          54310000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                54320000
                      OR SQLCODE = +0                                   54330000
                      OR SQLCODE = +100                                 54340000
                                                                        54350000
               EXEC SQL                                                 54360000
100404             SELECT  A.ITM_NBR                                    54370000
100404                    ,A.INTR_UPC_ID                                54380000
100404               INTO  :SKXREF-ITM-NBR                              54390000
100404                    ,:SKXREF-INTR-UPC-ID                          54400000
100404               FROM  TSKXREF  A                                   54410000
100404                    ,XST_UPC  B                                   54420000
100404              WHERE  B.UPC_NBR            = :DK-UPC-NBR           54430000
100404                AND  B.LAST_ACTN_CDE     IN ('A', 'U')            54431000
100404                AND  B.INTR_UPC_ID        = A.INTR_UPC_ID         54440000
100404                AND  A.SKU_STAT_CDE  NOT IN ('98')                54441000
               END-EXEC                                                 54450000
                                                                        54460000
               EVALUATE TRUE                                            54470000
                   WHEN SQLCODE = ZERO                                  54480000
100404                 SET PS-UPC-FOUND-ON-XST-UPC      TO  TRUE        54490000
                   WHEN SQLCODE = +100                                  54500000
100404                 SET PS-UPC-NOT-FOUND-ON-XST-UPC  TO  TRUE        54510000
                   WHEN SQLCODE = -904                                  54520000
                   WHEN SQLCODE = -913                                  54530000
                       CONTINUE                                         54540000
                   WHEN OTHER                                           54550000
                       MOVE 'SELECT AN ITEM NMBR FOR THE FOLLOWING UPC:'54560000
                                             TO DP013-MESSAGE-TEXT (1)  54570000
                       MOVE DK-UPC-NBR       TO PV-DISPLAY-UPC-NBR      54580000
                       MOVE PV-DISPLAY-UPC-NBR TO DP013-MESSAGE-TEXT (2)54590000
                       MOVE SQLCA            TO DP013-SQLCA             54600000
100404                 MOVE 'XST_UPC'        TO DP013-DB2-TABLE-NAME (1)54610000
                       SET DP013-DB2-ABEND                              54620000
                       DP013-XCTL-DISPLAY-RESTART                       54630000
                                            TO TRUE                     54640000
                       PERFORM DP013-0000-PROCESS-ABEND                 54650000
               END-EVALUATE                                             54660000
           END-PERFORM.                                                 54670000
                                                                        54680000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          54690000
               MOVE 'SELECT AN ITEM NMBR FOR THE FOLLOWING UPC: '       54700000
                                         TO DP013-MESSAGE-TEXT (1)      54710000
               MOVE DK-UPC-NBR           TO PV-DISPLAY-UPC-NBR          54720000
               MOVE PV-DISPLAY-UPC-NBR   TO DP013-MESSAGE-TEXT (2)      54730000
               MOVE SQLCA                TO DP013-SQLCA                 54740000
100404         MOVE 'XST_UPC'            TO DP013-DB2-TABLE-NAME (1)    54750000
               SET DP013-DB2-ABEND                                      54760000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   54770000
               PERFORM DP013-0000-PROCESS-ABEND                         54780000
           END-IF.                                                      54790000
                                                                        54800000
       EJECT.                                                           54810000
      *----------------------------------------------------------------*54820000
      *  SELECT SKU INFORMATION USING THE ITEM NUMBER.                 *54830000
      *----------------------------------------------------------------*54840000
       7510-SELECT-SKU-BY-ITEM-NBR.                                     54850000
                                                                        54860000
           MOVE '7510-SELECT-SKU-BY-ITEM-NBR' TO DP013-PARAGRAPH.       54870000
                                                                        54880000
100404     INITIALIZE DCLXST00008                                       54890000
100404                DCLXST00010.                                      54891000
                                                                        54900000
           PERFORM WITH TEST AFTER                                      54910000
                   VARYING PV-RETRY-COUNT                               54920000
                   FROM 1 BY 1                                          54930000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                54940000
                      OR SQLCODE = +0                                   54950000
                      OR SQLCODE = +100                                 54960000
                                                                        54970000
               EXEC SQL                                                 54980000
100404             SELECT  C.UNT_RTL_AMT,                               54990000
100404                     C.LOC_SKU_STAT_CDE,                          55000000
100404                     C.UPC_STAT_CHG_DTE,                          55010000
100404                     C.UNT_RTL_CHG_DTE,                           55020000
100404                     C.GP_RTL_AMT,                                55030000
100404                     C.GP_RTL_QTY,                                55040000
100404                     B.REGN_PRIC_IND                              55050000
100404               INTO  :XST00008-UNT-RTL-AMT,                       55060000
100404                     :XST00008-LOC-SKU-STAT-CDE,                  55070000
100404                     :XST00008-UPC-STAT-CHG-DTE,                  55080000
100404                     :XST00008-UNT-RTL-CHG-DTE,                   55090000
100404                     :XST00008-GP-RTL-AMT                         55100000
100404                     :PV-GP-RTL-AMT-NULL-IND,                     55101000
100404                     :XST00008-GP-RTL-QTY                         55110000
100404                     :PV-GP-RTL-QTY-NULL-IND,                     55111000
100404                     :XST00010-REGN-PRIC-IND                      55120000
100404               FROM  TSKXREF     A,                               55130000
100404                     XST_SKU     B,                               55131000
100404                     XST_SKU_LOC C                                55132000
100404              WHERE  A.ITM_NBR               = :DK-ITEM-NBR       55141000
100404                AND  A.INTR_UPC_ID           = B.INTR_UPC_ID      55142000
100404                AND  A.INTR_UPC_ID           = C.INTR_UPC_ID      55143000
100404                AND  C.LOC_NBR               = 0                  55144000
100404                AND  C.END_TMST             IS NULL               55145000
100404                AND  C.LOC_SKU_STAT_CDE NOT IN ('98')             55146000
               END-EXEC                                                 55150000
                                                                        55160000
               EVALUATE TRUE                                            55170000
                   WHEN SQLCODE = ZERO                                  55180000
                       SET PS-SKU-ITEM-FOUND            TO  TRUE        55190000
100404                 MOVE XST00008-UNT-RTL-AMT  TO PV-CUR-RTL-AMT     55200000
100404                 IF PV-GP-RTL-QTY-NULL-IND < 0                    55201000
100404                     MOVE ZEROS TO XST00008-GP-RTL-QTY            55202000
100404                 END-IF                                           55203000
100404                 IF PV-GP-RTL-AMT-NULL-IND < 0                    55204000
100404                     MOVE ZEROS TO XST00008-GP-RTL-AMT            55205000
100404                 END-IF                                           55206000
100404                 MOVE XST00008-GP-RTL-QTY   TO PV-GP-QTY          55210000
100404                 MOVE XST00008-GP-RTL-AMT   TO PV-GP-RTL-AMT      55220000
100404                 IF XST00010-REGN-PRIC-IND = PC-YES               55230000
                           EVALUATE ASC-XFER-TYPE                       55240000
111703*                        WHEN  PC-DEFECTIVE-DAMAGE                55250000
111703                         WHEN  PC-DEFECTIVE-DAMAGE-SORT1          55251000
111703                         WHEN  PC-DEFECTIVE-DAMAGE-SORT2          55252000
                               WHEN  PC-CALLBACK                        55260000
                                   MOVE ASC-FR-STORE-NBR TO DK-STORE-NBR55270000
                                   PERFORM 7850-CHECK-REGN-PRC          55280000
                               WHEN  PC-STOCK-BALANCE-CORPORATE         55290000
                               WHEN  PC-STOCK-BALANCE-STORE             55300000
                               WHEN  PC-CUSTOMER                        55310000
                                   MOVE ASC-RCV-STORE-NBR               55320000
                                                       TO DK-STORE-NBR  55330000
                                   PERFORM 7850-CHECK-REGN-PRC          55340000
                           END-EVALUATE                                 55350000
                       END-IF                                           55360000
                   WHEN SQLCODE = +100                                  55370000
                       SET PS-SKU-ITEM-NOT-FOUND        TO  TRUE        55380000
                   WHEN SQLCODE = -904                                  55390000
                   WHEN SQLCODE = -913                                  55400000
                       CONTINUE                                         55410000
                   WHEN OTHER                                           55420000
                       MOVE 'SELECT SKU DATA FOR ITEM_NMBR: '           55430000
                                          TO DP013-MESSAGE-TEXT (1)     55440000
                       MOVE DK-ITEM-NBR   TO PV-DISPLAY-ITM-NBR         55450000
                       MOVE PV-DISPLAY-ITM-NBR                          55460000
                                          TO DP013-MESSAGE-TEXT (2)     55470000
                       MOVE SQLCA         TO DP013-SQLCA                55480000
                       MOVE 'XST_SKU_LOC' TO DP013-DB2-TABLE-NAME (1)   55490000
                       SET DP013-DB2-ABEND                              55500000
                       DP013-XCTL-DISPLAY-RESTART                       55510000
                                          TO TRUE                       55520000
                       PERFORM DP013-0000-PROCESS-ABEND                 55530000
               END-EVALUATE                                             55540000
           END-PERFORM.                                                 55550000
                                                                        55560000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          55570000
               MOVE 'SELECT SKU DATA FOR ITEM_NMBR: '                   55580000
                                     TO DP013-MESSAGE-TEXT (1)          55590000
               MOVE DK-ITEM-NBR TO PV-DISPLAY-ITM-NBR                   55600000
               MOVE PV-DISPLAY-ITM-NBR                                  55610000
                                     TO DP013-MESSAGE-TEXT (2)          55620000
               MOVE SQLCA            TO DP013-SQLCA                     55630000
100404         MOVE 'XST_SKU_LOC'    TO DP013-DB2-TABLE-NAME (1)        55640000
               SET DP013-DB2-ABEND                                      55650000
                   DP013-XCTL-DISPLAY-RESTART                           55660000
                                        TO TRUE                         55670000
               PERFORM DP013-0000-PROCESS-ABEND                         55680000
           END-IF.                                                      55690000
                                                                        55700000
           IF PS-SKU-ITEM-FOUND                                         55710000
                MOVE PV-CUR-RTL-AMT         TO ASC-CUR-RTL-AMT          55720000
                                   (ASC-BLK-SUB ASC-ITEM-SUB)           55730000
                IF PV-GP-QTY > +1                                       55740000
                    COMPUTE PV-CUR-RTL-AMT =                            55750000
                                      PV-GP-RTL-AMT / PV-GP-QTY         55760000
                END-IF                                                  55770000
100404          MOVE XST00008-LOC-SKU-STAT-CDE TO ASC-STATUS-CODE       55780000
                                   (ASC-BLK-SUB ASC-ITEM-SUB)           55790000
           ELSE                                                         55800000
                MOVE ZEROES TO ASC-CUR-RTL-AMT                          55810000
                                              (ASC-BLK-SUB ASC-ITEM-SUB)55820000
                            ASC-STATUS-CODE (ASC-BLK-SUB ASC-ITEM-SUB)  55830000
           END-IF.                                                      55840000
                                                                        55850000
       EJECT.                                                           55860000
      *----------------------------------------------------------------*55870000
      *  INSERT THE TRANSFER RECEIPT ROW.                              *55880000
      *----------------------------------------------------------------*55890000
       7600-INSERT-XFER-RECEIPT-ROW.                                    55900000
                                                                        55910000
           MOVE '7600-INSERT-XFER-RECEIPT-ROW' TO DP013-PARAGRAPH.      55920000
                                                                        55930000
           MOVE ASC-RCV-STORE-NBR      TO TFRCPT-STR-NBR.               55940000
           MOVE ASC-RECV-BY-INT        TO TFRCPT-RCVR-INIT-1ST-NM.      55950000
           MOVE ASC-RECV-BY-NAM        TO TFRCPT-RCVR-LAST-NM.          55960000
           MOVE ASC-RCV-STR-OVRRID-IND TO TFRCPT-RCV-STR-OVRRID-IND.    55970000
           MOVE DP020-USERID           TO TFRCPT-RCV-BY-USR-ID.         55980000
                                                                        55990000
           IF ASC-CALL-INV-CONTROL                                      56000000
               MOVE PC-YES             TO TFRCPT-RCVG-PROB-IND          56010000
           ELSE                                                         56020000
               MOVE PC-NO              TO TFRCPT-RCVG-PROB-IND          56030000
           END-IF.                                                      56040000
                                                                        56050000
           PERFORM WITH TEST AFTER                                      56060000
                   VARYING PV-RETRY-COUNT                               56070000
                   FROM 1 BY 1                                          56080000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                56090000
                      OR SQLCODE = +0                                   56100000
                                                                        56110000
               EXEC SQL                                                 56120000
                   INSERT INTO TTFRCPT                                  56130000
                       (XFER_DKEY_ID,                                   56140000
                        RCV_XFER_BEG_TMST,                              56150000
                        RCPT_MTHD_CDE,                                  56160000
                        ENTR_MTHD_TYP_CDE,                              56170000
                        STR_NBR,                                        56180000
                        RCVR_INIT_1ST_NM,                               56190000
                        RCVR_LAST_NM,                                   56200000
                        RCV_XFER_END_TMST,                              56210000
                        BYP_DTL_CK_IND,                                 56220000
                        XFER_DSCRP_IND,                                 56230000
                        RCV_BY_USR_ID,                                  56240000
                        RCV_STR_OVRRID_IND,                             56250000
                        RCVG_PROB_IND)                                  56260000
                   VALUES                                               56270000
                       (:DK-XFER-DKEY-ID,                               56280000
                        :PV-CURRENT-TIMESTAMP,                          56290000
                        '02',                                           56300000
                        '02',                                           56310000
                        :TFRCPT-STR-NBR,                                56320000
                        :TFRCPT-RCVR-INIT-1ST-NM,                       56330000
                        :TFRCPT-RCVR-LAST-NM,                           56340000
                        CURRENT TIMESTAMP,                              56350000
                        :PC-NO,                                         56360000
                        :TFRCPT-XFER-DSCRP-IND,                         56370000
                        :TFRCPT-RCV-BY-USR-ID,                          56380000
                        :TFRCPT-RCV-STR-OVRRID-IND,                     56390000
                        :TFRCPT-RCVG-PROB-IND)                          56400000
               END-EXEC                                                 56410000
                                                                        56420000
               EVALUATE TRUE                                            56430000
                   WHEN SQLCODE = ZERO                                  56440000
                   WHEN SQLCODE = -904                                  56450000
                   WHEN SQLCODE = -913                                  56460000
                       CONTINUE                                         56470000
                   WHEN OTHER                                           56480000
                       MOVE 'INSERT A TRANSFER RCPT ROW FOR DLESS KEY'  56490000
                                             TO DP013-MESSAGE-TEXT (1)  56500000
                       MOVE DK-XFER-DKEY-ID                             56510000
                                             TO PV-DISPLAY-XFER-DKEY-ID 56520000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     56530000
                                             TO DP013-MESSAGE-TEXT (2)  56540000
                       MOVE SQLCA            TO DP013-SQLCA             56550000
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)56560000
                       SET DP013-DB2-ABEND                              56570000
                       DP013-XCTL-DISPLAY-RESTART                       56580000
                                            TO TRUE                     56590000
                       PERFORM DP013-0000-PROCESS-ABEND                 56600000
               END-EVALUATE                                             56610000
           END-PERFORM.                                                 56620000
                                                                        56630000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          56640000
               MOVE 'INSERT A TRANSFER RECEIPT ROW FOR DATALESS KEY     56650000
      -             'VALUE: '            TO DP013-MESSAGE-TEXT (1)      56660000
               MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID         56670000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             56680000
                                         TO DP013-MESSAGE-TEXT (2)      56690000
               MOVE SQLCA                TO DP013-SQLCA                 56700000
               MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)    56710000
               SET DP013-DB2-ABEND                                      56720000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   56730000
               PERFORM DP013-0000-PROCESS-ABEND                         56740000
           END-IF.                                                      56750000
                                                                        56760000
       EJECT.                                                           56770000
      *----------------------------------------------------------------*56780000
      *  UPDATE THE TRANSFER RECEIPT ROW.                              *56790000
      *----------------------------------------------------------------*56800000
       7610-UPDATE-XFER-RECEIPT-ROW.                                    56810000
                                                                        56820000
           MOVE '7610-UPDATE-XFER-RECEIPT-ROW' TO DP013-PARAGRAPH.      56830000
                                                                        56840000
           MOVE ASC-RCV-STORE-NBR      TO TFRCPT-STR-NBR.               56850000
           MOVE ASC-RECV-BY-INT        TO TFRCPT-RCVR-INIT-1ST-NM.      56860000
           MOVE ASC-RECV-BY-NAM        TO TFRCPT-RCVR-LAST-NM.          56870000
                                                                        56880000
           IF ASC-CALL-INV-CONTROL                                      56890000
               MOVE PC-YES             TO TFRCPT-RCVG-PROB-IND          56900000
           ELSE                                                         56910000
               MOVE PC-NO              TO TFRCPT-RCVG-PROB-IND          56920000
           END-IF.                                                      56930000
                                                                        56940000
           PERFORM WITH TEST AFTER                                      56950000
                   VARYING PV-RETRY-COUNT                               56960000
                   FROM 1 BY 1                                          56970000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                56980000
                      OR SQLCODE = +0                                   56990000
                                                                        57000000
               EXEC SQL                                                 57010000
                 UPDATE  TTFRCPT                                        57020000
                    SET  RCPT_MTHD_CDE     =  '02',                     57030000
                         RCVR_INIT_1ST_NM  =  :TFRCPT-RCVR-INIT-1ST-NM, 57040000
                         RCVR_LAST_NM      =  :TFRCPT-RCVR-LAST-NM,     57050000
                         RCV_XFER_END_TMST =  CURRENT TIMESTAMP,        57060000
                         BYP_DTL_CK_IND    =  :PC-NO,                   57070000
                         XFER_DSCRP_IND    =  :TFRCPT-XFER-DSCRP-IND,   57080000
                         RCVG_PROB_IND     =  :TFRCPT-RCVG-PROB-IND     57090000
                  WHERE (XFER_DKEY_ID      =  :DK-XFER-DKEY-ID          57100000
                    AND  RCV_XFER_BEG_TMST =  :PV-CURRENT-TIMESTAMP)    57110000
               END-EXEC                                                 57120000
                                                                        57130000
               EVALUATE TRUE                                            57140000
                   WHEN SQLCODE = ZERO                                  57150000
                   WHEN SQLCODE = -904                                  57160000
                   WHEN SQLCODE = -913                                  57170000
                       CONTINUE                                         57180000
                   WHEN OTHER                                           57190000
                       MOVE 'UPDATE A TRANSFER RCPT ROW FOR DLESS KEY'  57200000
                                             TO DP013-MESSAGE-TEXT (1)  57210000
                       MOVE DK-XFER-DKEY-ID                             57220000
                                             TO PV-DISPLAY-XFER-DKEY-ID 57230000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     57240000
                                             TO DP013-MESSAGE-TEXT (2)  57250000
                       MOVE SQLCA            TO DP013-SQLCA             57260000
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)57270000
                       SET DP013-DB2-ABEND                              57280000
                       DP013-XCTL-DISPLAY-RESTART                       57290000
                                            TO TRUE                     57300000
                       PERFORM DP013-0000-PROCESS-ABEND                 57310000
               END-EVALUATE                                             57320000
           END-PERFORM.                                                 57330000
                                                                        57340000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          57350000
               MOVE 'UPDATE A TRANSFER RECEIPT ROW FOR DATALESS KEY'    57360000
                                         TO DP013-MESSAGE-TEXT (1)      57370000
               MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID         57380000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             57390000
                                         TO DP013-MESSAGE-TEXT (2)      57400000
               MOVE SQLCA                TO DP013-SQLCA                 57410000
               MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)    57420000
               SET DP013-DB2-ABEND                                      57430000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   57440000
               PERFORM DP013-0000-PROCESS-ABEND                         57450000
           END-IF.                                                      57460000
                                                                        57470000
       EJECT.                                                           57480000
      *----------------------------------------------------------------*57490000
      *  INSERT THE POSITIVE RECEIPT ROW IN THE STATUS TABLE.          *57500000
      *----------------------------------------------------------------*57510000
       7650-INSERT-XFER-PR-STAT-ROW.                                    57520000
                                                                        57530000
           MOVE '7650-INSERT-XFER-PR-STAT-ROW' TO DP013-PARAGRAPH.      57540000
                                                                        57550000
           PERFORM WITH TEST AFTER                                      57560000
                   VARYING PV-RETRY-COUNT                               57570000
                   FROM 1 BY 1                                          57580000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                57590000
                      OR SQLCODE = +0                                   57600000
                                                                        57610000
               EXEC SQL                                                 57620000
                   INSERT INTO TTFSTAT                                  57630000
                       (XFER_DKEY_ID,                                   57640000
                        XFER_STAT_TMST,                                 57650000
                        XFER_STAT_CDE)                                  57660000
                   VALUES                                               57670000
                       (:DK-XFER-DKEY-ID,                               57680000
                        :PV-CURRENT-TIMESTAMP,                          57690000
                        'PR')                                           57700000
               END-EXEC                                                 57710000
                                                                        57720000
               EVALUATE TRUE                                            57730000
                   WHEN SQLCODE = ZERO                                  57740000
                   WHEN SQLCODE = -904                                  57750000
                   WHEN SQLCODE = -913                                  57760000
                       CONTINUE                                         57770000
                   WHEN OTHER                                           57780000
                      MOVE 'INSERT A TRANSFER STATUS ROW OF POSITIVELY' 57790000
                                             TO DP013-MESSAGE-TEXT (1)  57800000
                       MOVE 'RECEIVED FOR DATALESS KEY VALUE: '         57810000
                                             TO DP013-MESSAGE-TEXT (2)  57820000
                       MOVE DK-XFER-DKEY-ID                             57830000
                                             TO PV-DISPLAY-XFER-DKEY-ID 57840000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     57850000
                                             TO DP013-MESSAGE-TEXT (2)  57860000
                       MOVE SQLCA            TO DP013-SQLCA             57870000
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)57880000
                       SET DP013-DB2-ABEND                              57890000
                       DP013-XCTL-DISPLAY-RESTART                       57900000
                                            TO TRUE                     57910000
                       PERFORM DP013-0000-PROCESS-ABEND                 57920000
               END-EVALUATE                                             57930000
           END-PERFORM.                                                 57940000
                                                                        57950000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          57960000
               MOVE 'INSERT A TRANSFER STATUS ROW OF POSITIVELY'        57970000
                                         TO DP013-MESSAGE-TEXT (1)      57980000
               MOVE 'RECEIVED FOR DATALESS KEY VALUE: '                 57990000
                                         TO DP013-MESSAGE-TEXT (2)      58000000
               MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID         58010000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             58020000
                                         TO DP013-MESSAGE-TEXT (2)      58030000
               MOVE SQLCA                TO DP013-SQLCA                 58040000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (1)    58050000
               SET DP013-DB2-ABEND                                      58060000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   58070000
               PERFORM DP013-0000-PROCESS-ABEND                         58080000
           END-IF.                                                      58090000
                                                                        58100000
       EJECT.                                                           58110000
      *----------------------------------------------------------------*58120000
      *  UPDATE THE 'IR' STATUS ROW TO 'PR'.                            58130000
      *----------------------------------------------------------------*58140000
       7660-UPDATE-STATUS-TO-PR.                                        58150000
                                                                        58160000
           MOVE '7660-UPDATE-STATUS-TO-PR' TO DP013-PARAGRAPH.          58170000
                                                                        58180000
           PERFORM WITH TEST AFTER                                      58190000
                   VARYING PV-RETRY-COUNT                               58200000
                   FROM 1 BY 1                                          58210000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                58220000
                      OR SQLCODE = +0                                   58230000
                                                                        58240000
               EXEC SQL                                                 58250000
                 UPDATE  TTFSTAT                                        58260000
                    SET  XFER_STAT_CDE    =  'PR'                       58270000
                  WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID           58280000
                    AND   XFER_STAT_TMST  =  :PV-CURRENT-TIMESTAMP)     58290000
               END-EXEC                                                 58300000
                                                                        58310000
               EVALUATE TRUE                                            58320000
                   WHEN SQLCODE = ZERO                                  58330000
                   WHEN SQLCODE = -904                                  58340000
                   WHEN SQLCODE = -913                                  58350000
                       CONTINUE                                         58360000
                   WHEN OTHER                                           58370000
                      MOVE 'UPDATE A TRANSFER STATUS ROW TO POSITIVELY' 58380000
                                             TO DP013-MESSAGE-TEXT (1)  58390000
                       MOVE 'RECEIVED FOR DATALESS KEY VALUE: '         58400000
                                             TO DP013-MESSAGE-TEXT (2)  58410000
                       MOVE DK-XFER-DKEY-ID                             58420000
                                             TO PV-DISPLAY-XFER-DKEY-ID 58430000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     58440000
                                             TO DP013-MESSAGE-TEXT (2)  58450000
                       MOVE SQLCA            TO DP013-SQLCA             58460000
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)58470000
                       SET DP013-DB2-ABEND                              58480000
                       DP013-XCTL-DISPLAY-RESTART                       58490000
                                            TO TRUE                     58500000
                       PERFORM DP013-0000-PROCESS-ABEND                 58510000
               END-EVALUATE                                             58520000
           END-PERFORM.                                                 58530000
                                                                        58540000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          58550000
               MOVE 'UPDATE A TRANSFER STATUS ROW TO POSITIVELY'        58560000
                                         TO DP013-MESSAGE-TEXT (1)      58570000
               MOVE 'RECEIVED FOR DATALESS KEY VALUE: '                 58580000
                                         TO DP013-MESSAGE-TEXT (2)      58590000
               MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID         58600000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             58610000
                                         TO DP013-MESSAGE-TEXT (2)      58620000
               MOVE SQLCA                TO DP013-SQLCA                 58630000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (1)    58640000
               SET DP013-DB2-ABEND                                      58650000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   58660000
               PERFORM DP013-0000-PROCESS-ABEND                         58670000
           END-IF.                                                      58680000
                                                                        58690000
       EJECT.                                                           58700000
      *----------------------------------------------------------------*58710000
      *  CHECK TO SEE IF THIS TRANSFER HAS BEEN ASSUMPTIVELY RECEIVED. *58720000
      *----------------------------------------------------------------*58730000
       7700-SELECT-ASSUMPTIVE-RECEIPT.                                  58740000
                                                                        58750000
           MOVE '7700-SELECT-ASSUMPTIVE-RECEIPT' TO DP013-PARAGRAPH.    58760000
                                                                        58770000
           PERFORM WITH TEST AFTER                                      58780000
                   VARYING PV-RETRY-COUNT                               58790000
                   FROM 1 BY 1                                          58800000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                58810000
                      OR SQLCODE = +0                                   58820000
                      OR SQLCODE = +100                                 58830000
                                                                        58840000
               EXEC SQL                                                 58850000
                   SELECT  XFER_STAT_CDE                                58860000
                     INTO  :TFSTAT-XFER-STAT-CDE                        58870000
                     FROM  TTFSTAT                                      58880000
                    WHERE  (XFER_DKEY_ID   =  :DK-XFER-DKEY-ID          58890000
                     AND   XFER_STAT_CDE  =  :PC-ASSUMPTIVELY-RECEIVED) 58900000
               END-EXEC                                                 58910000
                                                                        58920000
               EVALUATE TRUE                                            58930000
                   WHEN SQLCODE = ZERO                                  58940000
                   WHEN SQLCODE = +100                                  58950000
                   WHEN SQLCODE = -904                                  58960000
                   WHEN SQLCODE = -913                                  58970000
                       CONTINUE                                         58980000
                   WHEN OTHER                                           58990000
                       MOVE 'CHECK FOR AN ASSUMPTIVE RECEIPT DLESS KEY' 59000000
                                             TO DP013-MESSAGE-TEXT (1)  59010000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 59020000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     59030000
                                             TO DP013-MESSAGE-TEXT (2)  59040000
                       MOVE SQLCA            TO DP013-SQLCA             59050000
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)59060000
                       SET DP013-DB2-ABEND                              59070000
                       DP013-XCTL-DISPLAY-RESTART                       59080000
                                            TO TRUE                     59090000
                       PERFORM DP013-0000-PROCESS-ABEND                 59100000
               END-EVALUATE                                             59110000
           END-PERFORM.                                                 59120000
                                                                        59130000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          59140000
               MOVE 'CHECK FOR AN ASSUMPTIVE RECEIPT FOR XFER_DKEY_ID'  59150000
                                         TO DP013-MESSAGE-TEXT (1)      59160000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     59170000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             59180000
                                         TO DP013-MESSAGE-TEXT (2)      59190000
               MOVE SQLCA                TO DP013-SQLCA                 59200000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (1)    59210000
               SET DP013-DB2-ABEND                                      59220000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   59230000
               PERFORM DP013-0000-PROCESS-ABEND                         59240000
           END-IF.                                                      59250000
                                                                        59260000
       EJECT.                                                           59270000
      *----------------------------------------------------------------*59280000
      *  UPDATE THE NON-RETAIL ITEM RECEIPT ROW.                       *59290000
      *----------------------------------------------------------------*59300000
       7710-UPDATE-NON-RTL-ITM-RCPT.                                    59310000
                                                                        59320000
           MOVE '7710-UPDATE-NON-RTL-ITM-RCPT' TO DP013-PARAGRAPH.      59330000
                                                                        59340000
           MOVE LQW-LINE (LQW-IDX)   TO TFITRC-XFER-LNE-NBR.            59350000
           MOVE LQW-RQTY-N (LQW-IDX) TO TFITRC-RCVD-XFER-QTY.           59360000
                                                                        59370000
           PERFORM WITH TEST AFTER                                      59380000
                   VARYING PV-RETRY-COUNT                               59390000
                   FROM 1 BY 1                                          59400000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                59410000
                      OR SQLCODE = +0                                   59420000
                                                                        59430000
               EXEC SQL                                                 59440000
                  UPDATE  TTFITRC                                       59450000
                    SET  RCVD_XFER_QTY    =  :TFITRC-RCVD-XFER-QTY      59460000
                  WHERE  (XFER_DKEY_ID    =  :DK-XFER-DKEY-ID           59470000
                    AND   XFER_LNE_NBR    =  :TFITRC-XFER-LNE-NBR       59480000
                    AND   XFER_RCPT_TMST  =  :PV-CURRENT-TIMESTAMP)     59490000
               END-EXEC                                                 59500000
                                                                        59510000
               EVALUATE TRUE                                            59520000
                   WHEN SQLCODE = ZERO                                  59530000
                   WHEN SQLCODE = -904                                  59540000
                   WHEN SQLCODE = -913                                  59550000
                       CONTINUE                                         59560000
                   WHEN OTHER                                           59570000
                       MOVE 'UPDATE NRTL ITEM RECEIPT FOR XFER_DKE/LINE'59580000
                                             TO DP013-MESSAGE-TEXT (1)  59590000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 59600000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     59610000
                                             TO DP013-MESSAGE-TEXT (2)  59620000
                       MOVE TFITRC-XFER-LNE-NBR                         59630000
                                             TO PV-DISPLAY-XFER-LNE-NBR 59640000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     59650000
                                             TO DP013-MESSAGE-TEXT (3)  59660000
                       MOVE TFRCPT-RCV-XFER-BEG-TMST                    59670000
                                             TO DP013-MESSAGE-TEXT (4)  59680000
                       MOVE SQLCA            TO DP013-SQLCA             59690000
                       MOVE 'TTFITRC'        TO DP013-DB2-TABLE-NAME (1)59700000
                       SET DP013-DB2-ABEND                              59710000
                       DP013-XCTL-DISPLAY-RESTART   TO TRUE             59720000
                       PERFORM DP013-0000-PROCESS-ABEND                 59730000
               END-EVALUATE                                             59740000
           END-PERFORM.                                                 59750000
                                                                        59760000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          59770000
               MOVE 'UPDATE NON-RETAIL ITEM RECEIPT FOR DLESS KEY/LINE' 59780000
                                         TO DP013-MESSAGE-TEXT (1)      59790000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     59800000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             59810000
                                         TO DP013-MESSAGE-TEXT (2)      59820000
               MOVE TFITRC-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     59830000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             59840000
                                         TO DP013-MESSAGE-TEXT (3)      59850000
               MOVE TFRCPT-RCV-XFER-BEG-TMST                            59860000
                                         TO DP013-MESSAGE-TEXT (4)      59870000
               MOVE SQLCA                TO DP013-SQLCA                 59880000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    59890000
               SET DP013-DB2-ABEND                                      59900000
                   DP013-XCTL-DISPLAY-RESTART  TO TRUE                  59910000
               PERFORM DP013-0000-PROCESS-ABEND                         59920000
           END-IF.                                                      59930000
                                                                        59940000
       EJECT.                                                           59950000
      *----------------------------------------------------------------*59960000
      *  SELECT THE CLEARANCE ITEM FIRST MARKDOWN PRICE.               *59970000
      *----------------------------------------------------------------*59980000
       7750-GET-CLR-ITM-1ST-MKDN-PRIC.                                  59990000
                                                                        60000000
           MOVE '7750-GET-CLR-ITM-1ST-MKDN-PRIC' TO DP013-PARAGRAPH.    60010000
                                                                        60020000
           INITIALIZE DCLTPPCPRC.                                       60030000
           MOVE ASC-ITEM-NBR (ASC-BLK-SUB ASC-ITEM-SUB) TO DK-ITEM-NBR. 60040000
100404     MOVE XST00008-LOC-SKU-STAT-CDE   TO PV-LOC-SKU-STAT-CDE-9    60041000
100404     MOVE PV-LOC-SKU-STAT-CDE-9       TO DK-SKU-STATUS-CODE.      60050000
                                                                        60051000
           PERFORM WITH TEST AFTER                                      60060000
                   VARYING PV-RETRY-COUNT                               60070000
                   FROM 1 BY 1                                          60080000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                60090000
                      OR SQLCODE = +0                                   60100000
                      OR SQLCODE = +100                                 60110000
                                                                        60120000
               EXEC SQL                                                 60130000
                   SELECT  MAX(RTL_AMT)                                 60140000
                     INTO  :PPCPRC-RTL-AMT                              60150000
                              :PV-NULL-IND                              60160000
                     FROM  TPPCPRC                                      60170000
                    WHERE  (TSK_ITM_NBR  =  :DK-ITEM-NBR                60180000
                      AND   STR_NBR      =  :PC-ZERO                    60190000
100404                AND   STATUS_CDE   =  :DK-SKU-STATUS-CODE)        60200000
               END-EXEC                                                 60210000
                                                                        60220000
               EVALUATE TRUE                                            60230000
                   WHEN SQLCODE = ZERO                                  60240000
                   WHEN SQLCODE = -904                                  60250000
                   WHEN SQLCODE = -913                                  60260000
                       CONTINUE                                         60270000
                   WHEN SQLCODE = +100                                  60280000
100404                 MOVE XST00008-UNT-RTL-AMT TO PPCPRC-RTL-AMT      60281000
                   WHEN OTHER                                           60300000
                       MOVE 'SELECT THE 1ST MRKDWN PRICE FOR CLEARNANCE'60310000
                                             TO DP013-MESSAGE-TEXT (1)  60320000
                       MOVE DK-ITEM-NBR  TO PV-DISPLAY-ITM-NBR          60330000
                       MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (2)60340000
                       MOVE SQLCA            TO DP013-SQLCA             60350000
                       MOVE 'TPPCPRC'        TO DP013-DB2-TABLE-NAME (1)60360000
                       SET DP013-DB2-ABEND                              60370000
                       DP013-XCTL-DISPLAY-RESTART                       60380000
                                            TO TRUE                     60390000
                       PERFORM DP013-0000-PROCESS-ABEND                 60400000
               END-EVALUATE                                             60410000
           END-PERFORM.                                                 60420000
                                                                        60430000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          60440000
               MOVE 'SELECT THE 1ST MRKDWN PRICE FOR A CLEARANCE ITEM'  60450000
                                         TO DP013-MESSAGE-TEXT (1)      60460000
               MOVE DK-ITEM-NBR     TO PV-DISPLAY-ITM-NBR               60470000
               MOVE PV-DISPLAY-ITM-NBR   TO DP013-MESSAGE-TEXT (2)      60480000
               MOVE SQLCA                TO DP013-SQLCA                 60490000
               MOVE 'TPPCPRC'            TO DP013-DB2-TABLE-NAME (1)    60500000
               SET DP013-DB2-ABEND                                      60510000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   60520000
               PERFORM DP013-0000-PROCESS-ABEND                         60530000
           END-IF.                                                      60540000
                                                                        60550000
           IF PV-NULL-IND IS NEGATIVE                                   60560000
100404         MOVE XST00008-UNT-RTL-AMT TO PPCPRC-RTL-AMT              60561000
           END-IF.                                                      60580000
                                                                        60590000
       EJECT.                                                           60600000
      *----------------------------------------------------------------*60610000
      *  DELETE THE IR STATUS ROW BECAUSE IT IS NO LONGER THE MAX TMST *60620000
      *----------------------------------------------------------------*60630000
       7800-DELETE-IR-STATUS.                                           60640000
                                                                        60650000
           MOVE '7800-DELETE-IR-STATUS'  TO DP013-PARAGRAPH.            60660000
                                                                        60670000
           PERFORM WITH TEST AFTER                                      60680000
                   VARYING PV-RETRY-COUNT                               60690000
                   FROM 1 BY 1                                          60700000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                60710000
                      OR SQLCODE = +0                                   60720000
                      OR SQLCODE = +100                                 60730000
                                                                        60740000
               EXEC SQL                                                 60750000
                 DELETE FROM TTFSTAT                                    60760000
                  WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID        60770000
                    AND   XFER_STAT_TMST     =  :ASC-CURRENT-TIMESTAMP) 60780000
               END-EXEC                                                 60790000
                                                                        60800000
               EVALUATE TRUE                                            60810000
                   WHEN SQLCODE = ZERO                                  60820000
                   WHEN SQLCODE = +100                                  60830000
                   WHEN SQLCODE = -904                                  60840000
                   WHEN SQLCODE = -913                                  60850000
                       CONTINUE                                         60860000
                   WHEN OTHER                                           60870000
                       MOVE 'DELETE A TRANSFER STATUS ROW FOR XFER_DKEY'60880000
                                             TO DP013-MESSAGE-TEXT (1)  60890000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 60900000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     60910000
                                             TO DP013-MESSAGE-TEXT (2)  60920000
                       MOVE ASC-CURRENT-TIMESTAMP                       60930000
                                             TO DP013-MESSAGE-TEXT (3)  60940000
                       MOVE SQLCA            TO DP013-SQLCA             60950000
                       MOVE 'TTFSTAT'        TO DP013-DB2-TABLE-NAME (1)60960000
                       SET DP013-DB2-ABEND                              60970000
                       DP013-XCTL-DISPLAY-RESTART                       60980000
                                            TO TRUE                     60990000
                       PERFORM DP013-0000-PROCESS-ABEND                 61000000
               END-EVALUATE                                             61010000
           END-PERFORM.                                                 61020000
                                                                        61030000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          61040000
               MOVE 'DELETE A TRANSFER STATUS ROW FOR XFER_DKEY'        61050000
                                         TO DP013-MESSAGE-TEXT (1)      61060000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     61070000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             61080000
                                         TO DP013-MESSAGE-TEXT (2)      61090000
               MOVE SQLCA                TO DP013-SQLCA                 61100000
               MOVE 'TTFSTAT'            TO DP013-DB2-TABLE-NAME (1)    61110000
               SET DP013-DB2-ABEND                                      61120000
                   DP013-XCTL-DISPLAY-RESTART                           61130000
                                        TO TRUE                         61140000
               PERFORM DP013-0000-PROCESS-ABEND                         61150000
           END-IF.                                                      61160000
                                                                        61170000
       EJECT.                                                           61180000
      *----------------------------------------------------------------*61190000
      *  DELETE THE RECEIPT ROW BECAUSE IT IS NO LONGER THE MAX TMST   *61200000
      *----------------------------------------------------------------*61210000
       7810-DELETE-CURRENT-RECEIPT.                                     61220000
                                                                        61230000
           MOVE '7810-DELETE-CURRENT-RECEIPT' TO DP013-PARAGRAPH.       61240000
                                                                        61250000
           PERFORM WITH TEST AFTER                                      61260000
                   VARYING PV-RETRY-COUNT                               61270000
                   FROM 1 BY 1                                          61280000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                61290000
                      OR SQLCODE = +0                                   61300000
                      OR SQLCODE = +100                                 61310000
                                                                        61320000
               EXEC SQL                                                 61330000
                 DELETE FROM TTFRCPT                                    61340000
                  WHERE  (XFER_DKEY_ID       =  :DK-XFER-DKEY-ID        61350000
                    AND   RCV_XFER_BEG_TMST  =  :ASC-CURRENT-TIMESTAMP) 61360000
               END-EXEC                                                 61370000
                                                                        61380000
               EVALUATE TRUE                                            61390000
                   WHEN SQLCODE = ZERO                                  61400000
                   WHEN SQLCODE = +100                                  61410000
                   WHEN SQLCODE = -904                                  61420000
                   WHEN SQLCODE = -913                                  61430000
                       CONTINUE                                         61440000
                   WHEN OTHER                                           61450000
                       MOVE 'DELETE A TRANSFER RECEIPT FOR XFER_DKEY:'  61460000
                                             TO DP013-MESSAGE-TEXT (1)  61470000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 61480000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     61490000
                                             TO DP013-MESSAGE-TEXT (2)  61500000
                       MOVE SQLCA            TO DP013-SQLCA             61510000
                       MOVE 'TTFRCPT'        TO DP013-DB2-TABLE-NAME (1)61520000
                       SET DP013-DB2-ABEND                              61530000
                       DP013-XCTL-DISPLAY-RESTART                       61540000
                                            TO TRUE                     61550000
                       PERFORM DP013-0000-PROCESS-ABEND                 61560000
               END-EVALUATE                                             61570000
           END-PERFORM.                                                 61580000
                                                                        61590000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          61600000
               MOVE 'DELETE A TRANSFER RECEIPT FOR XFER_DKEY:'          61610000
                                         TO DP013-MESSAGE-TEXT (1)      61620000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     61630000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             61640000
                                         TO DP013-MESSAGE-TEXT (2)      61650000
               MOVE SQLCA                TO DP013-SQLCA                 61660000
               MOVE 'TTFRCPT'            TO DP013-DB2-TABLE-NAME (1)    61670000
               SET DP013-DB2-ABEND                                      61680000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   61690000
               PERFORM DP013-0000-PROCESS-ABEND                         61700000
           END-IF.                                                      61710000
                                                                        61720000
       EJECT.                                                           61730000
      ***************************************************************** 61740000
       7850-CHECK-REGN-PRC.                                             61750000
                                                                        61760000
           MOVE '7850-CHECK-REGN-PRC'  TO DP013-PARAGRAPH.              61770000
                                                                        61780000
100404     INITIALIZE DCLXST00008.                                      61790000
                                                                        61800000
           PERFORM WITH TEST AFTER                                      61810000
                   VARYING PV-RETRY-COUNT                               61820000
                   FROM 1 BY 1                                          61830000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                61840000
                      OR SQLCODE = +0                                   61850000
                      OR SQLCODE = +100                                 61860000
                                                                        61870000
               EXEC SQL                                                 61880000
100404             SELECT  LOC_SKU_STAT_CDE,                            61890000
100404                     UNT_RTL_AMT                                  61900000
100404               INTO :XST00008-LOC-SKU-STAT-CDE,                   61910000
100404                    :XST00008-UNT-RTL-AMT                         61920000
100404               FROM  TSKXREF      A,                              61930000
100404                     XST_SKU_LOC  B                               61931000
100404              WHERE  A.ITM_NBR      = :DK-ITEM-NBR                61932000
100404                AND  A.INTR_UPC_ID  = B.INTR_UPC_ID               61933000
100404                AND  B.LOC_NBR      = :DK-STORE-NBR               61950000
100404                AND  B.BEG_TMST    <= CURRENT TIMESTAMP           61960000
100404                AND  (B.END_TMST    > CURRENT TIMESTAMP           61970000
100404                 OR  B.END_TMST    IS NULL)                       61980000
               END-EXEC                                                 61990000
                                                                        62000000
               EVALUATE TRUE                                            62010000
                   WHEN SQLCODE = ZERO                                  62020000
100404               IF XST00008-LOC-SKU-STAT-CDE = PC-CLEARANCE-STATUS 62030000
100404                   MOVE XST00008-UNT-RTL-AMT TO PV-CUR-RTL-AMT    62040000
                         MOVE +1                   TO PV-GP-QTY         62050000
                     END-IF                                             62060000
                   WHEN SQLCODE = +100                                  62070000
                   WHEN SQLCODE = -904                                  62080000
                   WHEN SQLCODE = -913                                  62090000
                       CONTINUE                                         62100000
                   WHEN OTHER                                           62110000
100404                 MOVE 'SELECT DATA FROM XST_SKU_LOC'              62120000
                                             TO DP013-MESSAGE-TEXT (1)  62130000
                       MOVE SQLCA            TO DP013-SQLCA             62140000
100404                 MOVE 'XST_SKU_LOC'    TO DP013-DB2-TABLE-NAME (1)62150000
                       MOVE SQLCA            TO DP013-SQLCA             62160000
                       SET DP013-DB2-ABEND                              62170000
                       DP013-XCTL-DISPLAY-RESTART                       62180000
                                            TO TRUE                     62190000
                       PERFORM DP013-0000-PROCESS-ABEND                 62200000
               END-EVALUATE                                             62210000
           END-PERFORM.                                                 62220000
                                                                        62230000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          62240000
100404         MOVE 'SELECT DATA FROM XST_SKU_LOC'                      62250000
                                     TO DP013-MESSAGE-TEXT (1)          62260000
               MOVE SQLCA            TO DP013-SQLCA                     62270000
100404         MOVE 'XST_SKU_LOC'    TO DP013-DB2-TABLE-NAME (1)        62280000
               MOVE SQLCA            TO DP013-SQLCA                     62290000
               SET DP013-DB2-ABEND                                      62300000
               DP013-XCTL-DISPLAY-RESTART                               62310000
                                    TO TRUE                             62320000
               PERFORM DP013-0000-PROCESS-ABEND                         62330000
           END-IF.                                                      62340000
                                                                        62350000
       EJECT.                                                           62360000
      *----------------------------------------------------------------*62370000
      *  SET THE DISCREPANCY SWITCH FOR ITEMS WITH RECEIPT DISCREPANCY *62380000
      *----------------------------------------------------------------*62390000
       7900-UPDATE-XFER-ITM-DSCRP-IND.                                  62400000
                                                                        62410000
           MOVE '7900-UPDATE-XFER-ITM-DSCRP-IND' TO DP013-PARAGRAPH.    62420000
                                                                        62430000
           PERFORM WITH TEST AFTER                                      62440000
                   VARYING PV-RETRY-COUNT                               62450000
                   FROM 1 BY 1                                          62460000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                62470000
                      OR SQLCODE = +0                                   62480000
                                                                        62490000
               EXEC SQL                                                 62500000
                 UPDATE  TTFITRC                                        62510000
                    SET  XFER_ITM_DSCRP_IND = :PC-YES                   62520000
                  WHERE  (XFER_DKEY_ID      = :DK-XFER-DKEY-ID          62530000
                    AND   XFER_LNE_NBR      = :TFITEM-XFER-LNE-NBR      62540000
                    AND   XFER_LNE_SEQ_NBR  = :TFITRC-XFER-LNE-SEQ-NBR  62550000
                    AND   XFER_RCPT_TMST    = :PV-CURRENT-TIMESTAMP)    62560000
               END-EXEC                                                 62570000
                                                                        62580000
               EVALUATE TRUE                                            62590000
                   WHEN SQLCODE = ZERO                                  62600000
                   WHEN SQLCODE = -904                                  62610000
                   WHEN SQLCODE = -913                                  62620000
                       CONTINUE                                         62630000
                   WHEN OTHER                                           62640000
                       MOVE 'UPDATE TRANSFER ITEM DISCREPANCY INDICATOR'62650000
                                             TO DP013-MESSAGE-TEXT (1)  62660000
                       MOVE 'XFER_DKEY_ID/XFER_LNE_NBR/XFER_LNE_SEQ_NBR'62670000
                                             TO DP013-MESSAGE-TEXT (2)  62680000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 62690000
                       MOVE TFITEM-XFER-LNE-NBR                         62700000
                                             TO PV-DISPLAY-XFER-LNE-NBR 62710000
                       MOVE TFITRC-XFER-LNE-SEQ-NBR                     62720000
                                    TO PV-DISPLAY-XFER-LNE-SEQ-NBR      62730000
                       MOVE PV-DISPLAY-AREA  TO DP013-MESSAGE-TEXT (3)  62740000
                       MOVE TFRCPT-RCV-XFER-BEG-TMST                    62750000
                                             TO DP013-MESSAGE-TEXT (4)  62760000
                       MOVE SQLCA            TO DP013-SQLCA             62770000
                       MOVE 'TTFITRC'        TO DP013-DB2-TABLE-NAME (1)62780000
                       SET DP013-DB2-ABEND                              62790000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               62800000
                       PERFORM DP013-0000-PROCESS-ABEND                 62810000
               END-EVALUATE                                             62820000
           END-PERFORM.                                                 62830000
                                                                        62840000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          62850000
               MOVE 'UPDATE TRANSFER ITEM DISCREPANCY INDICATOR FOR'    62860000
                                         TO DP013-MESSAGE-TEXT (1)      62870000
               MOVE 'XFER_DKEY_ID/XFER_LNE_NBR/XFER_LNE_SEQ_NBR/XFER'   62880000
                                         TO DP013-MESSAGE-TEXT (2)      62890000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     62900000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     62910000
               MOVE TFITRC-XFER-LNE-SEQ-NBR                             62920000
                   TO PV-DISPLAY-XFER-LNE-SEQ-NBR                       62930000
               MOVE PV-DISPLAY-AREA      TO DP013-MESSAGE-TEXT (3)      62940000
               MOVE TFRCPT-RCV-XFER-BEG-TMST                            62950000
                                         TO DP013-MESSAGE-TEXT (4)      62960000
               MOVE SQLCA                TO DP013-SQLCA                 62970000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    62980000
               SET DP013-DB2-ABEND                                      62990000
                   DP013-XCTL-DISPLAY-RESTART  TO TRUE                  63000000
               PERFORM DP013-0000-PROCESS-ABEND                         63010000
           END-IF.                                                      63020000
                                                                        63030000
       EJECT.                                                           63040000
      *----------------------------------------------------------------*63050000
      *  GET THE CURRENT RETAIL PRICE FOR THE ITEM.                    *63060000
      *----------------------------------------------------------------*63070000
       8100-SELECT-CUR-UNT-RTL-AMT.                                     63080000
                                                                        63090000
           MOVE '8100-SELECT-CUR-UNT-RTL-AMT' TO DP013-PARAGRAPH.       63100000
                                                                        63110000
100404     INITIALIZE DCLXST00008                                       63120000
100404                DCLXST00010.                                      63121000
                                                                        63130000
           PERFORM WITH TEST AFTER                                      63140000
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   63150000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                63160000
                      OR SQLCODE = ZERO                                 63170000
                      OR SQLCODE = +100                                 63180000
                                                                        63190000
               EXEC SQL                                                 63200000
100404             SELECT  C.UNT_RTL_AMT                                63210000
100404                    ,B.REGN_PRIC_IND                              63220000
100404               INTO  :XST00008-UNT-RTL-AMT                        63230000
100404                    ,:XST00010-REGN-PRIC-IND                      63240000
100404               FROM  TSKXREF     A                                63250000
100404                    ,XST_SKU     B                                63251000
100404                    ,XST_SKU_LOC C                                63252000
100404              WHERE  A.ITM_NBR               = :TFITEM-ITM-NBR    63260000
100404                AND  A.INTR_UPC_ID           = B.INTR_UPC_ID      63261000
100404                AND  A.INTR_UPC_ID           = C.INTR_UPC_ID      63261100
100404                AND  C.LOC_NBR               = 0                  63262000
100404                AND  C.END_TMST             IS NULL               63263000
100404                AND  C.LOC_SKU_STAT_CDE NOT IN ('98')             63264000
               END-EXEC                                                 63270000
                                                                        63280000
               EVALUATE TRUE                                            63290000
                   WHEN SQLCODE = -904                                  63300000
                   WHEN SQLCODE = -913                                  63310000
                   WHEN SQLCODE = ZERO                                  63320000
100404                 MOVE XST00008-UNT-RTL-AMT  TO PV-CUR-RTL-AMT     63330000
100404                 MOVE XST00008-GP-RTL-QTY   TO PV-GP-QTY          63340000
100404                 MOVE XST00008-GP-RTL-AMT   TO PV-GP-RTL-AMT      63350000
100404                 IF XST00010-REGN-PRIC-IND = PC-YES               63360000
                           MOVE TFITEM-ITM-NBR    TO DK-ITEM-NBR        63370000
                           EVALUATE ASC-XFER-TYPE                       63380000
111703*                        WHEN  PC-DEFECTIVE-DAMAGE                63390000
111703                         WHEN  PC-DEFECTIVE-DAMAGE-SORT1          63391000
111703                         WHEN  PC-DEFECTIVE-DAMAGE-SORT2          63392000
                               WHEN  PC-CALLBACK                        63400000
                                   MOVE ASC-FR-STORE-NBR TO DK-STORE-NBR63410000
                                   PERFORM 7850-CHECK-REGN-PRC          63420000
                               WHEN  PC-STOCK-BALANCE-CORPORATE         63430000
                               WHEN  PC-STOCK-BALANCE-STORE             63440000
                               WHEN  PC-CUSTOMER                        63450000
                                   MOVE ASC-RCV-STORE-NBR               63460000
                                                        TO DK-STORE-NBR 63470000
                                   PERFORM 7850-CHECK-REGN-PRC          63480000
                           END-EVALUATE                                 63490000
                       END-IF                                           63500000
                   WHEN SQLCODE = +100                                  63510000
100404                 MOVE ZEROES           TO XST00008-UNT-RTL-AMT    63520000
                                                PV-CUR-RTL-AMT          63530000
                   WHEN OTHER                                           63540000
                       MOVE 'SELECT CURRENT UNIT RETAIL AMT FOR ITEM_NB'63550000
                                             TO DP013-MESSAGE-TEXT (1)  63560000
                       MOVE TFITEM-ITM-NBR   TO PV-DISPLAY-ITM-NBR      63570000
                       MOVE PV-DISPLAY-ITM-NBR TO DP013-MESSAGE-TEXT (2)63580000
                       MOVE SQLCA            TO DP013-SQLCA             63590000
100404                 MOVE 'XST_SKU_LOC'    TO DP013-DB2-TABLE-NAME (1)63600000
                       SET DP013-DB2-ABEND                              63610000
                           DP013-XCTL-DISPLAY-RESTART                   63620000
                                         TO TRUE                        63630000
                       PERFORM DP013-0000-PROCESS-ABEND                 63640000
               END-EVALUATE                                             63650000
           END-PERFORM.                                                 63660000
                                                                        63670000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          63680000
               MOVE 'SELECT CURRENT UNIT RETAIL AMOUNT FOR ITEM_NMBR'   63690000
                                         TO DP013-MESSAGE-TEXT (1)      63700000
               MOVE TFITEM-ITM-NBR       TO PV-DISPLAY-ITM-NBR          63710000
               MOVE PV-DISPLAY-ITM-NBR   TO DP013-MESSAGE-TEXT (2)      63720000
               MOVE SQLCA                TO DP013-SQLCA                 63730000
100404         MOVE 'XST_SKU_LOC'        TO DP013-DB2-TABLE-NAME (1)    63740000
               SET DP013-DB2-ABEND                                      63750000
                   DP013-XCTL-DISPLAY-RESTART                           63760000
                                         TO TRUE                        63770000
               PERFORM DP013-0000-PROCESS-ABEND                         63780000
           END-IF.                                                      63790000
                                                                        63800000
       EJECT.                                                           63810000
      *----------------------------------------------------------------*63820000
      *  ONCE THE RECEIPTS ARE ALL UPDATED, CHECK FOR DISCREPANCIES.   *63830000
      *----------------------------------------------------------------*63840000
       8200-CHK-FOR-ITM-DISCREPANCYS.                                   63850000
                                                                        63860000
           PERFORM 8300-OPEN-RCPT-ITM-CSR.                              63870000
           PERFORM 8310-FETCH-RCPT-ITM-CSR.                             63880000
           PERFORM 8400-PROCESS-RCPT-ITMS                               63890000
                   UNTIL PS-END-OF-RCPT-ITMS.                           63900000
           PERFORM 8320-CLOSE-RCPT-ITM-CSR.                             63910000
                                                                        63920000
           SET  PS-MORE-RCPT-ITMS  TO  TRUE.                            63930000
                                                                        63940000
           PERFORM 6020-FETCH-XFER-ITM-CSR.                             63950000
                                                                        63960000
       EJECT.                                                           63970000
      *----------------------------------------------------------------*63980000
      *  OPEN THE RECEIPT ITEM CURSOR.                                 *63990000
      *----------------------------------------------------------------*64000000
       8300-OPEN-RCPT-ITM-CSR.                                          64010000
                                                                        64020000
           MOVE '8300-OPEN-RCPT-ITM-CSR' TO DP013-PARAGRAPH.            64030000
                                                                        64040000
           EXEC SQL                                                     64050000
               OPEN RCPT_ITM_CSR                                        64060000
           END-EXEC.                                                    64070000
                                                                        64080000
           EVALUATE TRUE                                                64090000
               WHEN SQLCODE = ZERO                                      64100000
                   CONTINUE                                             64110000
               WHEN OTHER                                               64120000
                   MOVE 'OPEN THE RCPT_ITM_CSR CURSOR'                  64130000
                                             TO DP013-MESSAGE-TEXT (1)  64140000
                   MOVE SQLCA                TO DP013-SQLCA             64150000
                   MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)64160000
                   SET DP013-DB2-ABEND                                  64170000
                       DP013-XCTL-DISPLAY-RESTART                       64180000
                                             TO TRUE                    64190000
                   PERFORM DP013-0000-PROCESS-ABEND                     64200000
           END-EVALUATE.                                                64210000
                                                                        64220000
       EJECT.                                                           64230000
      *----------------------------------------------------------------*64240000
      *  READ A RECEIPT ITEM ROW.                                      *64250000
      *----------------------------------------------------------------*64260000
       8310-FETCH-RCPT-ITM-CSR.                                         64270000
                                                                        64280000
           MOVE '8310-FETCH-RCPT-ITM-CSR'  TO DP013-PARAGRAPH.          64290000
                                                                        64300000
           INITIALIZE DCLTTFITRC.                                       64310000
                                                                        64320000
           PERFORM WITH TEST AFTER                                      64330000
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   64340000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                64350000
                      OR SQLCODE = ZERO                                 64360000
                      OR SQLCODE = +100                                 64370000
                                                                        64380000
               EXEC SQL                                                 64390000
                   FETCH  RCPT_ITM_CSR                                  64400000
                    INTO  :TFITRC-XFER-LNE-SEQ-NBR,                     64410000
                          :TFITRC-RCVD-XFER-QTY,                        64420000
                          :TFITRC-RCVD-XFER-PRIC-AMT                    64430000
               END-EXEC                                                 64440000
                                                                        64450000
               EVALUATE TRUE                                            64460000
                   WHEN SQLCODE = -904                                  64470000
                   WHEN SQLCODE = -913                                  64480000
                   WHEN SQLCODE = ZERO                                  64490000
                       CONTINUE                                         64500000
                   WHEN SQLCODE = +100                                  64510000
                       SET PS-END-OF-RCPT-ITMS   TO TRUE                64520000
                   WHEN OTHER                                           64530000
                       MOVE 'FETCH RCPT_ITM_CSR FOR DLESS KEY/LINE/TIME'64540000
                                               TO DP013-MESSAGE-TEXT (1)64550000
                       MOVE DK-XFER-DKEY-ID  TO PV-DISPLAY-XFER-DKEY-ID 64560000
                       MOVE PV-DISPLAY-XFER-DKEY-ID                     64570000
                                             TO DP013-MESSAGE-TEXT (2)  64580000
                       MOVE TFITEM-XFER-LNE-NBR                         64590000
                                             TO PV-DISPLAY-XFER-LNE-NBR 64600000
                       MOVE PV-DISPLAY-XFER-LNE-NBR                     64610000
                                             TO DP013-MESSAGE-TEXT (3)  64620000
                       MOVE TFRCPT-RCV-XFER-BEG-TMST                    64630000
                                             TO DP013-MESSAGE-TEXT (4)  64640000
                       MOVE SQLCA            TO DP013-SQLCA             64650000
                       MOVE 'TTFITRC'        TO DP013-DB2-TABLE-NAME (1)64660000
                       SET DP013-DB2-ABEND                              64670000
                           DP013-XCTL-DISPLAY-RESTART                   64680000
                                             TO TRUE                    64690000
                       PERFORM DP013-0000-PROCESS-ABEND                 64700000
               END-EVALUATE                                             64710000
           END-PERFORM.                                                 64720000
                                                                        64730000
           IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          64740000
               MOVE 'FETCH RCPT_ITM_CSR FOR DLESS KEY/LINE/TIME'        64750000
                                         TO DP013-MESSAGE-TEXT (1)      64760000
               MOVE DK-XFER-DKEY-ID      TO PV-DISPLAY-XFER-DKEY-ID     64770000
               MOVE PV-DISPLAY-XFER-DKEY-ID                             64780000
                                         TO DP013-MESSAGE-TEXT (2)      64790000
               MOVE TFITEM-XFER-LNE-NBR  TO PV-DISPLAY-XFER-LNE-NBR     64800000
               MOVE PV-DISPLAY-XFER-LNE-NBR                             64810000
                                         TO DP013-MESSAGE-TEXT (3)      64820000
               MOVE TFRCPT-RCV-XFER-BEG-TMST                            64830000
                                         TO DP013-MESSAGE-TEXT (4)      64840000
               MOVE SQLCA                TO DP013-SQLCA                 64850000
               MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)    64860000
               SET DP013-DB2-ABEND                                      64870000
                   DP013-XCTL-DISPLAY-RESTART TO TRUE                   64880000
               PERFORM DP013-0000-PROCESS-ABEND                         64890000
           END-IF.                                                      64900000
                                                                        64910000
       EJECT.                                                           64920000
      *----------------------------------------------------------------*64930000
      * CLOSE THE RECEIPT ITEM CURSOR.                                 *64940000
      *----------------------------------------------------------------*64950000
       8320-CLOSE-RCPT-ITM-CSR.                                         64960000
                                                                        64970000
           MOVE '8320-CLOSE-RCPT-ITM-CSR'  TO DP013-PARAGRAPH.          64980000
                                                                        64990000
           EXEC SQL                                                     65000000
               CLOSE RCPT_ITM_CSR                                       65010000
           END-EXEC.                                                    65020000
                                                                        65030000
           EVALUATE TRUE                                                65040000
               WHEN SQLCODE = ZERO                                      65050000
                   CONTINUE                                             65060000
               WHEN OTHER                                               65070000
                   MOVE 'CLOSE THE RCPT_ITM_CSR CURSOR'                 65080000
                                             TO DP013-MESSAGE-TEXT (1)  65090000
                   MOVE SQLCA                TO DP013-SQLCA             65100000
                   MOVE 'TTFITRC'            TO DP013-DB2-TABLE-NAME (1)65110000
                   SET DP013-DB2-ABEND                                  65120000
                       DP013-XCTL-DISPLAY-RESTART TO TRUE               65130000
                   PERFORM DP013-0000-PROCESS-ABEND                     65140000
           END-EVALUATE.                                                65150000
                                                                        65160000
       EJECT.                                                           65170000
      *----------------------------------------------------------------*65180000
      * CHECK FOR RECEIPT DISCREPANCIES                                *65190000
      *----------------------------------------------------------------*65200000
       8400-PROCESS-RCPT-ITMS.                                          65210000
                                                                        65220000
           IF TFITRC-XFER-LNE-SEQ-NBR  =  PC-ONE                        65230000
               IF TFITEM-XFER-QTY  =  TFITRC-RCVD-XFER-QTY              65240000
                   CONTINUE                                             65250000
               ELSE                                                     65260000
                   MOVE PC-YES  TO  TFRCPT-XFER-DSCRP-IND               65270000
                   SET PS-ITEM-DISCREPANCY-EXISTS    TO TRUE            65280000
                   COMPUTE TFITPS-ITM-QTY  =                            65290000
                       TFITRC-RCVD-XFER-QTY  -  TFITEM-XFER-QTY         65300000
                   IF ASC-RETAIL-XFER                                   65310000
                       IF TFITPS-ITM-QTY POSITIVE                       65320000
                           PERFORM 8500-SAME-FROM-TO-STR                65330000
                       ELSE                                             65340000
                           PERFORM 8510-SWITCH-FROM-TO-STR              65350000
                           COMPUTE TFITPS-ITM-QTY  =                    65360000
                               TFITPS-ITM-QTY  *  -1                    65370000
                       END-IF                                           65380000
                       MOVE TFITEM-XFER-PRIC-AMT                        65390000
                           TO TFITPS-ITM-RTL-PRCE-AMT                   65400000
                                                                        65410000
                       MOVE PC-ADJUSTMENT-RSN-CDE TO TFITPS-ADJ-RSN-CDE 65420000
                       PERFORM 8520-FILL-EXNL-SYS-PRCG-CDE              65430000
                       PERFORM 6200-SELECT-MAX-PSTG-SEQ-NBR             65440000
                       PERFORM 6300-INSERT-ADJUSTMENT-ROW               65450000
                       PERFORM 7900-UPDATE-XFER-ITM-DSCRP-IND           65460000
                   ELSE                                                 65470000
                       MOVE 1  TO  TFITRC-XFER-LNE-SEQ-NBR              65480000
                       PERFORM 7900-UPDATE-XFER-ITM-DSCRP-IND           65490000
                   END-IF                                               65500000
               END-IF                                                   65510000
           ELSE                                                         65520000
               MOVE PC-YES                    TO TFRCPT-XFER-DSCRP-IND  65530000
               SET PS-ITEM-DISCREPANCY-EXISTS    TO TRUE                65540000
               MOVE TFITRC-RCVD-XFER-QTY      TO TFITPS-ITM-QTY         65550000
               MOVE TFITRC-RCVD-XFER-PRIC-AMT TO TFITPS-ITM-RTL-PRCE-AMT65560000
               PERFORM 8500-SAME-FROM-TO-STR                            65570000
               MOVE PC-ADJUSTMENT-RSN-CDE     TO TFITPS-ADJ-RSN-CDE     65580000
               PERFORM 8520-FILL-EXNL-SYS-PRCG-CDE                      65590000
               PERFORM 6200-SELECT-MAX-PSTG-SEQ-NBR                     65600000
               PERFORM 6300-INSERT-ADJUSTMENT-ROW                       65610000
               PERFORM 7900-UPDATE-XFER-ITM-DSCRP-IND                   65620000
           END-IF.                                                      65630000
                                                                        65640000
           PERFORM 8310-FETCH-RCPT-ITM-CSR.                             65650000
                                                                        65660000
       EJECT.                                                           65670000
      *----------------------------------------------------------------*65680000
      * IF THE NET TRANSFER IS POSITIVE, POSTING IS TO THE RECEIVE     *65690000
      * STORE.                                                         *65700000
      *----------------------------------------------------------------*65710000
       8500-SAME-FROM-TO-STR.                                           65720000
                                                                        65730000
           MOVE ASC-FR-STORE-NBR            TO  TFITPS-FRM-PSTG-STR-NBR.65740000
           MOVE ASC-RCV-STORE-NBR           TO  TFITPS-TO-PSTG-STR-NBR. 65750000
                                                                        65760000
       EJECT.                                                           65770000
      *----------------------------------------------------------------*65780000
      * IF THE NET TRANSFER IS NEGATIVE, POSTING IS BACK TO THE        *65790000
      * COMPLETING STORE.                                              *65800000
      *----------------------------------------------------------------*65810000
       8510-SWITCH-FROM-TO-STR.                                         65820000
                                                                        65830000
           MOVE ASC-FR-STORE-NBR            TO  TFITPS-TO-PSTG-STR-NBR. 65840000
           MOVE ASC-RCV-STORE-NBR           TO  TFITPS-FRM-PSTG-STR-NBR.65850000
                                                                        65860000
       EJECT.                                                           65870000
      *----------------------------------------------------------------*65880000
      * SET THE EXTERNAL SYSTEM PROCESSING CODE FOR ITEM POSTINGS.     *65890000
      *----------------------------------------------------------------*65900000
       8520-FILL-EXNL-SYS-PRCG-CDE.                                     65910000
                                                                        65920000
111703*    IF  ASC-XFER-TYPE    =  PC-DEFECTIVE-DAMAGE                  65930000
111703     IF (ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT1              65931000
111703      OR ASC-XFER-TYPE  =  PC-DEFECTIVE-DAMAGE-SORT2              65932000
            OR ASC-XFER-TYPE    =  PC-CALLBACK)                         65940000
               MOVE PC-MERCHANDISE-LEDGER  TO  TFITPS-EXTL-SYS-PRCG-CDE 65950000
           ELSE                                                         65960000
               MOVE PC-FASHION-SALES       TO  TFITPS-EXTL-SYS-PRCG-CDE 65970000
           END-IF.                                                      65980000
                                                                        65990000
       EJECT.                                                           66000000
      *----------------------------------------------------------------*66010000
      *  UPDATE THE TRANSFER MASTER TABLE WITH CALLBACK NUMBER.        *66020000
      *----------------------------------------------------------------*66030000
       8600-UPDATE-TTFMSTR.                                             66040000
                                                                        66050000
           MOVE '8600-UPDATE-TTFMSTR'  TO DP013-PARAGRAPH.              66060000
                                                                        66070000
           PERFORM WITH TEST AFTER                                      66080000
                   VARYING PV-RETRY-COUNT FROM 1 BY 1                   66090000
                   UNTIL PV-RETRY-COUNT > PC-MAX-RETRIES                66100000
                      OR SQLCODE = ZERO                                 66110000
                                                                        66120000
               EXEC SQL                                                 66130000
                 UPDATE TTFMSTR                                         66140000
                   SET  CLBK_NBR           = :TFMSTR-CLBK-NBR           66150000
                   WHERE (XFER_DKEY_ID  = :DK-XFER-DKEY-ID)             66160000
               END-EXEC                                                 66170000
                                                                        66180000
               EVALUATE TRUE                                            66190000
                   WHEN SQLCODE = ZERO                                  66200000
                   WHEN SQLCODE = -904                                  66210000
                   WHEN SQLCODE = -913                                  66220000
                       CONTINUE                                         66230000
                   WHEN OTHER                                           66240000
                       MOVE 'UPDATE A ROW IN TTFMSTR'                   66250000
                                           TO DP013-MESSAGE-TEXT (1)    66260000
                       MOVE SQLCA          TO DP013-SQLCA               66270000
                       MOVE 'TTFMSTR'      TO DP013-DB2-TABLE-NAME (1)  66280000
                       SET DP013-DB2-ABEND TO TRUE                      66290000
                       PERFORM DP013-0000-PROCESS-ABEND                 66300000
               END-EVALUATE                                             66310000
           END-PERFORM.                                                 66320000
                                                                        66330000
           IF PV-RETRY-COUNT > PC-MAX-RETRIES                           66340000
              MOVE 'MAXIMUM RETRIES EXCEEDED ATTEMPTING TO UPDATE A ROW'66350000
                                           TO DP013-MESSAGE-TEXT (1)    66360000
              MOVE 'IN THE TRANSFER MASTER TABLE'                       66370000
                                           TO DP013-MESSAGE-TEXT (2)    66380000
              MOVE SQLCA                   TO DP013-SQLCA               66390000
              MOVE 'TTFMSTR'               TO DP013-DB2-TABLE-NAME (1)  66400000
              SET DP013-DB2-ABEND          TO TRUE                      66410000
              PERFORM DP013-0000-PROCESS-ABEND                          66420000
           END-IF.                                                      66430000
                                                                        66440000
       EJECT.                                                           66450000
      *----------------------------------------------------------------*66460000
      *    ABEND PROCESSOR MODULE                                      *66470000
      *----------------------------------------------------------------*66480000
           COPY DPPD013.                                                66490000
