000100 IDENTIFICATION DIVISION.                                         00010047
000200                                                                  00020047
000300 PROGRAM-ID.    MLKUT414.                                         00030047
000400 AUTHOR.        BARBARA HULL.                                     00040047
000500 INSTALLATION.  KOHLS DEPARTMENT STORES.                          00050047
000600 DATE-WRITTEN.  07-22-98.                                         00060047
000700 DATE-COMPILED.                                                   00070047
000800                                                                  00080047
000900******************************************************************00090047
001000* MLKUT414 - DESCRIPTION.............                             00100047
001100*                                                                 00110047
001200* CREATE DATA INTEGRITY CONTROL CARD FILE                         00120047
001300*                                                                 00130047
001400* THIS PROGRAM WILL DETERMINE THE RANGE OF DATES FOR WHICH DATA   00140047
001500* WILL BE CHECKED BY THE DATA INTEGRITY PROGRAMS.  IT WILL READ   00150047
001600* A CONTROL CARD AND THE MERCHANDISE LEDGER CONTROL TABLE, AND    00160047
001700* CREATE A FILE CONTAINING A CONTROL CARD WITH THE START AND END  00170047
001800* DATES TO BE USED WHEN EXTRACTING THE DATA TO BE CHECKED BY THE  00180047
001900* DATA INTEGRITY PROGRAMS.                                        00190047
002000*                                                                 00200047
002100* IF THE INPUT CONTROL CARD CONTAINS VALID DATES, THEY WILL BE    00210047
002200* USED AS THE START AND END DATES.  IF NOT, THE OPEN FISCAL       00220047
002300* MONTH-END DATE FROM TMLCNTL WILL BE USED AS THE START DATE, AND 00230047
002400* THE MAX POSTING MONTH-END DATE FROM TMLCNTL WILL BE USED AS THE 00240047
002500* END DATE.                                                       00250047
      *CHANGE HISTORY:                                                  00260047
      * WR/PROJ DATE       PGMR        DESCRIPTION OF CHANGES           00270047
      * ------- ---------- ----------- -------------------------------- 00280047
B28582* W28582  04-24-2007 B.GRAHAM PREVIOUS CHANGE HISTORY NOT         00290047
B28582*                    DOCUMENTED.                                  00300047
B28582* W28582  04-24-2007 B.GRAHAM STRATAGEM BRAND VENDOR PROJECT      00310047
B28582*                    CHANGE PARTITION SELECTION FOR WEEKLY TABLE  00320047
B28582*                    TO USE MAX POSTING WEEK END DATE INSTEAD     00330047
B28582*                    OF MONTH END DATE SO THAT ONLY THOSE         00340047
B28582*                    PARTITIONS ARE SELECTED NO ALL FOR THE       00350047
B28582*                    MONTH.                                       00360047
W35270* W35270  09-04-2008 P. KEBER - CHANGE PARTITION SELECTION        00361049
W35270*                    CONTROL CARDS TO USE FOR DB2 UNLOAD UTILITY. 00362050
002600******************************************************************00370047
002700                                                                  00380047
002800 ENVIRONMENT DIVISION.                                            00390047
002900                                                                  00400047
003000 CONFIGURATION SECTION.                                           00410047
003100 SOURCE-COMPUTER.        IBM-3090.                                00420047
003200 OBJECT-COMPUTER.        IBM-3090.                                00430047
003300                                                                  00440047
003400 INPUT-OUTPUT SECTION.                                            00450047
003500 FILE-CONTROL.                                                    00460047
003600                                                                  00470047
003700     SELECT I-CONTROL-CARD-FILE                                   00480047
003800         ASSIGN TO INP01.                                         00490047
003900                                                                  00500047
004000     SELECT O-CONTROL-CARD-FILE                                   00510047
004100         ASSIGN TO OUT01.                                         00520047
004200                                                                  00530047
004210     SELECT MN-PARTITION-FILE                                     00540047
004220         ASSIGN TO OUT02.                                         00550047
004230                                                                  00560047
004240     SELECT WK-PARTITION-FILE                                     00570047
004250         ASSIGN TO OUT03.                                         00580047
004260                                                                  00590047
004300******************************************************************00600047
004400 DATA DIVISION.                                                   00610047
004500******************************************************************00620047
004600 FILE SECTION.                                                    00630047
004700                                                                  00640047
004800 FD  I-CONTROL-CARD-FILE                                          00650047
004900     LABEL RECORDS ARE STANDARD                                   00660047
005000     RECORDING MODE  F                                            00670047
005100     BLOCK CONTAINS 0 RECORDS.                                    00680047
005200 01  I-CONTROL-CARD-RECORD       PIC X(80).                       00690047
005300                                                                  00700047
005400 FD  O-CONTROL-CARD-FILE                                          00710047
005500     LABEL RECORDS ARE STANDARD                                   00720047
005600     RECORDING MODE  F                                            00730047
005700     BLOCK CONTAINS 0 RECORDS.                                    00740047
005800 01  O-CONTROL-CARD-RECORD       PIC X(80).                       00750047
005900                                                                  00760047
005970 FD  MN-PARTITION-FILE                                            00770047
005980     LABEL RECORDS ARE STANDARD                                   00780047
005990     RECORDING MODE  F                                            00790047
005991     BLOCK CONTAINS 0 RECORDS.                                    00800047
005992 01  MN-PARTITION-RECORD         PIC X(80).                       00810047
005993                                                                  00820047
005994 FD  WK-PARTITION-FILE                                            00830047
005995     LABEL RECORDS ARE STANDARD                                   00840047
005996     RECORDING MODE  F                                            00850047
005997     BLOCK CONTAINS 0 RECORDS.                                    00860047
005998 01  WK-PARTITION-RECORD         PIC X(80).                       00870047
005999                                                                  00880047
006000 EJECT                                                            00890047
006100                                                                  00900047
006200 WORKING-STORAGE SECTION.                                         00910047
006300                                                                  00920047
006400 01  PS-PROGRAM-SWITCHES.                                         00930047
006500     05  PS-END-OF-INPUT         PIC X       VALUE 'N'.           00940047
006600         88  PS-NO-INPUT-FOUND               VALUE 'Y'.           00950047
006630                                                                  00960047
006640 01  PS-PROGRAM-SWITCHES.                                         00970047
006661     05  PS-PARTN-WKLY-DONE-SW     PIC X(01)   VALUE 'N'.         00980047
006662         88  PS-PARTN-WKLY-COMPLETE            VALUE 'Y'.         00990047
006663     05  PS-PARTN-MNLY-DONE-SW     PIC X(01)   VALUE 'N'.         01000047
006664         88  PS-PARTN-MNLY-COMPLETE            VALUE 'Y'.         01010047
006670     05  PS-FIRST-TIME-SW          PIC X(01)   VALUE 'N'.         01020047
006680         88  PS-FIRST-TIME-THRU                VALUE 'N'.         01030047
006690         88  PS-CONTINUED-PROCESSING           VALUE 'Y'.         01040047
006691                                                                  01050047
006692 01  PROGRAM-VARIABLES.                                           01060047
006693     05  PV-RETRY-COUNT          PIC S9(4)   VALUE +0 COMP.       01070047
006694     05  PV-PARTN-NBR-COUNT      PIC S9(5)   VALUE +0 COMP-3.     01080047
B28582     05  PV-MXPSTG-FSCL-WK-DTE  PIC X(10)   VALUE SPACES.         01090047
006695                                                                  01100047
006696 01  PC-PROGRAM-COUNTERS.                                         01110047
006697     05  PC-MAX-RETRIES          PIC S9(4)   VALUE +2 COMP.       01120047
006700                                                                  01130047
006800 01  PC-PROGRAM-CONSTANTS.                                        01140047
006900     05  PC-Y                    PIC X       VALUE 'Y'.           01150047
007000                                                                  01160047
007100 01  PV-PROGRAM-VARIABLES.                                        01170047
007200     05  PV-SQL-EDIT-DATE           PIC X(10).                    01180047
007201     05  PV-OPN-MONTH-FIRST-WEEK    PIC X(10).                    01190047
007201     05  PV-OPN-MONTH-END-DATE      PIC X(10).                    01200047
007210     05  PV-TBL-TM-LVL-CDE          PIC X(01).                    01210047
007300                                                                  01220047
007310 01  MLTMNLYSUM-PART-VERBIAGE-1.                                  01230047
007320     05  FILLER                  PIC X(22)   VALUE                01240047
W35270         '  WHERE PARTN_NBR IN ('.                                01250048
007340     05  FILLER                  PIC X(58)   VALUE SPACES.        01260047
007350                                                                  01270047
007360 01  MLTMNLYSUM-PART-VERBIAGE-2.                                  01280047
007370     05  FILLER                  PIC X(04)   VALUE SPACES.        01290047
007380     05  MLTMNLYSUMM-COMMA       PIC X(01)   VALUE SPACES.        01300047
007390     05  MLTMNLYSUM-PARTN-NBR    PIC Z99     VALUE ZEROES.        01310047
007391     05  FILLER                  PIC X(72)   VALUE SPACES.        01320047
007392                                                                  01330047
W35270 01  MLTMNLYSUM-PART-VERBIAGE-3.                                  01331048
W35270     05  FILLER                  PIC X(04)   VALUE                01332048
W35270         '  );'.                                                  01333048
W35270     05  FILLER                  PIC X(76)   VALUE SPACES.        01334048
007350                                                                  01335048
007400 EJECT                                                            01340047
007500                                                                  01350047
007600*-----------------------------------------------------------------01360047
007700*  ABEND AREA                                                     01370047
007800*-----------------------------------------------------------------01380047
007900 01 ABEND-AREAS.                                                  01390047
008000     05 ABEND-CODE               PIC S9(04)  VALUE ZERO           01400047
008100                                             COMP SYNC.           01410047
008200         88  AC-BAD-DATA                     VALUE +4003.         01420047
008300         88  AC-DB2-ERROR                    VALUE +4013.         01430047
008400     05  AA-ABEND-LIT            PIC X(40)   VALUE                01440047
008500             '***** ABEND'.                                       01450047
008600     05  AA-PROGRAM-LIT          PIC X(40)   VALUE                01460047
008700             '***** PROGRAM: MLKUT414'.                           01470047
008800     05  AA-PARAGRAPH-LIT.                                        01480047
008900         10  FILLER              PIC X(17)   VALUE                01490047
009000             '***** PARAGRAPH: '.                                 01500047
009100         10  AA-PARAGRAPH-NAME   PIC X(35)   VALUE SPACES.        01510047
009200     05  AA-MESSAGE-LINE.                                         01520047
009300         10  FILLER              PIC X(06)   VALUE '*****'.       01530047
009400         10  AA-MESSAGE          PIC X(127)  VALUE SPACES.        01540047
009500     05  AA-DB2-ERROR-LIT        PIC X(40)   VALUE                01550047
009600             '*****    DB2 ERROR'.                                01560047
009700     05  AA-DB2-OPERATION-LIT.                                    01570047
009800         10  FILLER              PIC X(17)   VALUE                01580047
009900             '***** OPERATION: '.                                 01590047
010000         10  AA-DB2-OPERATION.                                    01600047
010100             15  AA-DB2-OP-1     PIC X(25)   VALUE SPACES.        01610047
010200             15  AA-DB2-OP-2     PIC X(25)   VALUE SPACES.        01620047
010300     05  AA-DB2-TABLE-1          PIC X(08)   VALUE SPACES.        01630047
010400     05  AA-DB2-TABLE-2          PIC X(08)   VALUE SPACES.        01640047
010500     05  AA-DB2-TABLE-3          PIC X(08)   VALUE SPACES.        01650047
010600     05  AA-DB2-TABLE-4          PIC X(08)   VALUE SPACES.        01660047
010700                                                                  01670047
010800 EJECT                                                            01680047
010900                                                                  01690047
011000**** CONTROL CARD RECORD FORMAT                                   01700047
011100     COPY MLRD110.                                                01710047
011200                                                                  01720047
011300******************************************************************01730047
011400*  DB2 ERROR MESSAGES FORMAT AREA.                                01740047
011500******************************************************************01750047
011600     COPY DPWS004.                                                01760047
011700                                                                  01770047
011800******************************************************************01780047
011900*  USED FOR DB2 ERRORS                                            01790047
012000******************************************************************01800047
012100     EXEC SQL                                                     01810047
012200         INCLUDE SQLCA                                            01820047
012300     END-EXEC.                                                    01830047
012400                                                                  01840047
012500******************************************************************01850047
012600*  LAYOUT FOR CONTROL TABLE                                       01860047
012700******************************************************************01870047
012800     EXEC SQL                                                     01880047
012900         INCLUDE TMLCNTL                                          01890047
013000     END-EXEC.                                                    01900047
013100                                                                  01910047
013200******************************************************************01920047
013300*  LAYOUT FOR DATE TABLE                                          01930047
013400******************************************************************01940047
013500     EXEC SQL                                                     01950047
013600         INCLUDE TDTATTR                                          01960047
013700     END-EXEC.                                                    01970047
013800                                                                  01980047
013810******************************************************************01990047
013820*  DB2 - M/L DETAIL LEDGER PARTITION BALANCE TBL (MLT_PARTN_BAL)  02000047
013830******************************************************************02010047
013840     EXEC SQL                                                     02020047
013850         INCLUDE MLT00002                                         02030047
013860     END-EXEC.                                                    02040047
013870                                                                  02050047
013880******************************************************************02060047
013890*  DB2 - M/L DETAIL LEDGER PARTITION CONTROL TBL (MLT_PARTN_CNTL) 02070047
013891******************************************************************02080047
013892     EXEC SQL                                                     02090047
013893         INCLUDE MLT00003                                         02100047
013894     END-EXEC.                                                    02110047
013895                                                                  02120047
013896******************************************************************02130047
013897*  DB2 - M/L DETAIL LEDGER PARTITION CURSOR FOR WLKY EXTRACT.     02140047
013898******************************************************************02150047
013899     EXEC SQL                                                     02160047
013900       DECLARE PARTN-WKLY-CSR CURSOR FOR                          02170047
013910         SELECT DISTINCT PARTN_NBR                                02180047
013920         FROM MLT_PARTN_CNTL A,                                   02190047
013930              MLT_PARTN_BAL B                                     02200047
013940         WHERE A.TBL_TM_LVL_CDE   = B.TBL_TM_LVL_CDE              02210047
013950           AND :PV-OPN-MONTH-FIRST-WEEK >= B.EFF_BEG_DTE          02220047
B28582*          AND :ML110-END-DTE     <= B.EFF_END_DTE                02230047
B28582           AND :PV-MXPSTG-FSCL-WK-DTE                             02240047
B28582                                  <= B.EFF_END_DTE                02250047
013960           AND A.DEPT_GP_CDE       = B.DEPT_GP_CDE                02260047
013970           AND A.TBL_TM_LVL_CDE    = :PV-TBL-TM-LVL-CDE           02270047
013980           AND A.FSCL_DTE                                         02280047
B28582*          BETWEEN :PV-OPN-MONTH-FIRST-WEEK AND :ML110-END-DTE    02290047
B28582           BETWEEN :PV-OPN-MONTH-FIRST-WEEK                       02300047
B28582                                   AND :PV-MXPSTG-FSCL-WK-DTE     02310047
013991                                                                  02320047
013993         WITH UR                                                  02330047
013994     END-EXEC.                                                    02340047
013995******************************************************************02350047
013996*  DB2 - M/L DETAIL LEDGER PARTITION CURSOR FOR MNLY EXTRACT.     02360047
013997******************************************************************02370047
013998     EXEC SQL                                                     02380047
013999       DECLARE PARTN-MNLY-CSR CURSOR FOR                          02390047
014000         SELECT DISTINCT PARTN_NBR                                02400047
014001         FROM MLT_PARTN_CNTL A,                                   02410047
014002              MLT_PARTN_BAL B                                     02420047
014003         WHERE A.TBL_TM_LVL_CDE = :PV-TBL-TM-LVL-CDE              02430047
014004           AND A.FSCL_DTE       = :PV-OPN-MONTH-END-DATE          02440047
014005           AND B.TBL_TM_LVL_CDE = A.TBL_TM_LVL_CDE                02450047
014006           AND B.EFF_BEG_DTE   <= :ML110-STRT-DTE                 02460047
014007           AND B.EFF_END_DTE   >= :ML110-END-DTE                  02470047
014008           AND B.DEPT_GP_CDE    = A.DEPT_GP_CDE                   02480047
014009                                                                  02490047
014010         WITH UR                                                  02500047
014011     END-EXEC.                                                    02510047
014012                                                                  02520047
014020 EJECT                                                            02530047
014100******************************************************************02540047
014200 PROCEDURE DIVISION.                                              02550047
014300******************************************************************02560047
014400                                                                  02570047
014500 0000-MAINLINE-MLKUT414.                                          02580047
014600                                                                  02590047
014700     PERFORM 1000-INITIALIZATION.                                 02600047
014800                                                                  02610047
014900     PERFORM 2000-MAIN-PROCESS.                                   02620047
015000                                                                  02630047
015100     PERFORM 8000-EOJ.                                            02640047
015200                                                                  02650047
015300     STOP RUN.                                                    02660047
015400                                                                  02670047
015500     EJECT                                                        02680047
015600                                                                  02690047
015700******************************************************************02700047
015800 1000-INITIALIZATION.                                             02710047
015900******************************************************************02720047
016000                                                                  02730047
016100     INITIALIZE PV-PROGRAM-VARIABLES.                             02740047
016200                                                                  02750047
016300     OPEN INPUT I-CONTROL-CARD-FILE.                              02760047
016400     OPEN OUTPUT O-CONTROL-CARD-FILE                              02770047
016410                 WK-PARTITION-FILE                                02780047
016420                 MN-PARTITION-FILE.                               02790047
016500                                                                  02800047
016501                                                                  02810047
016502 EJECT                                                            02820047
016503******************************************************************02830047
016504 1100-WEEKLY-PROCESS.                                             02840047
016505******************************************************************02850047
016506                                                                  02860047
016507     MOVE ZEROS          TO PV-PARTN-NBR-COUNT.                   02870047
016508     MOVE 'W'            TO PV-TBL-TM-LVL-CDE.                    02880047
016510     MOVE 'N'            TO PS-PARTN-WKLY-DONE-SW.                02890047
016661     MOVE 'N'            TO PS-FIRST-TIME-SW.                     02900047
016511                                                                  02910047
016512     PERFORM 7050-DATE-RANGE-TO-PROCESS.                          02920047
016513                                                                  02930047
016514     PERFORM 7150-OPEN-PARTN-WKLY-CSR.                            02940047
016515     PERFORM 7200-FETCH-PARTN-WKLY-CSR.                           02950047
016516                                                                  02960047
W35270     DISPLAY 'WEEKLY PARTITIONS:'.                                02961048
016516                                                                  02962048
016517     PERFORM 2500-BUILD-WKLY-PARTN-NBR                            02970047
016518         UNTIL PS-PARTN-WKLY-COMPLETE.                            02980047
016519                                                                  02990047
016520     PERFORM 7300-CLOSE-PARTN-WKLY-CSR.                           03000047
016521                                                                  03010047
016522     IF PV-PARTN-NBR-COUNT IS EQUAL ZERO                          03020047
016523         DISPLAY 'INPUT START DATE: ', PV-SQL-EDIT-DATE           03030047
016524         MOVE '7200-FETCH-PARTN-WKLY-CSR' TO AA-PARAGRAPH-NAME    03040047
016525         MOVE 'WEEKLY PARTITION CURSOR' TO AA-MESSAGE             03050047
016526         MOVE +4007                     TO ABEND-CODE             03060047
016527         PERFORM 9900-COMMON-ABEND-ROUTINE                        03070047
W35270     ELSE                                                         03071048
W35270         WRITE WK-PARTITION-RECORD                                03072048
W35270               FROM MLTMNLYSUM-PART-VERBIAGE-3                    03073048
016528     END-IF.                                                      03080047
016529                                                                  03090047
016600 EJECT                                                            03100047
016610******************************************************************03110047
016620 1200-MONTHLY-PROCESS.                                            03120047
016630******************************************************************03130047
016640                                                                  03140047
016650     MOVE ZEROS          TO PV-PARTN-NBR-COUNT.                   03150047
016651     MOVE 'M'            TO PV-TBL-TM-LVL-CDE.                    03160047
016660     MOVE 'N'            TO PS-PARTN-MNLY-DONE-SW.                03170047
016661     MOVE 'N'            TO PS-FIRST-TIME-SW                      03180047
016670                                                                  03190047
016671     PERFORM 7060-DATE-RANGE-TO-PROCESS.                          03200047
016672                                                                  03210047
016680     PERFORM 7400-OPEN-PARTN-MNLY-CSR.                            03220047
016690     PERFORM 7500-FETCH-PARTN-MNLY-CSR.                           03230047
016691                                                                  03240047
W35270     DISPLAY 'MONTHLY PARTITIONS:'.                               03241048
016516                                                                  03242048
016692     PERFORM 2600-BUILD-MNLY-PARTN-NBR                            03250047
016693         UNTIL PS-PARTN-MNLY-COMPLETE.                            03260047
016694                                                                  03270047
016695     PERFORM 7600-CLOSE-PARTN-MNLY-CSR.                           03280047
016696                                                                  03290047
016697     IF PV-PARTN-NBR-COUNT IS EQUAL ZERO                          03300047
016698         DISPLAY 'INPUT START DATE: ', PV-SQL-EDIT-DATE           03310047
016699         MOVE '7500-FETCH-PARTN-MNLY-CSR ' TO AA-PARAGRAPH-NAME   03320047
016700         MOVE 'MONTHLY PARTITION CURSOR' TO AA-MESSAGE            03330047
016701         MOVE +4007                     TO ABEND-CODE             03340047
016702         PERFORM 9900-COMMON-ABEND-ROUTINE                        03350047
W35270     ELSE                                                         03351048
W35270         WRITE MN-PARTITION-RECORD                                03352048
W35270               FROM MLTMNLYSUM-PART-VERBIAGE-3                    03353048
016703     END-IF.                                                      03360047
016712                                                                  03370047
016713 EJECT                                                            03380047
016730******************************************************************03390047
016800 2000-MAIN-PROCESS.                                               03400047
016900******************************************************************03410047
017000                                                                  03420047
017100     PERFORM 4000-READ-INPUT.                                     03430047
017200                                                                  03440047
017300* ONLY USE ML110- DATES IF A VALID DATE RANGE IS SPECIFIED        03450047
017400     IF (ML110-STRT-DTE = SPACES OR                               03460047
017500         ML110-END-DTE  = SPACES)                                 03470047
017600         PERFORM 7000-SELECT-TMLCNTL                              03480047
017700         MOVE MLCNTL-OPN-FSCL-MN-DTE                              03490047
017800                                 TO ML110-STRT-DTE                03500047
017900         MOVE MLCNTL-MXPSTG-FSCL-MN-DTE                           03510047
018000                                 TO ML110-END-DTE                 03520047
B28582         MOVE MLCNTL-MXPSTG-FSCL-WK-DTE                           03530047
B28582                                 TO PV-MXPSTG-FSCL-WK-DTE         03540047
018100     ELSE                                                         03550047
018200         PERFORM 2100-EDIT-INPUT.                                 03560047
018300                                                                  03570047
018400     PERFORM 5000-WRITE-OUTPUT.                                   03580047
018401                                                                  03590047
018410     PERFORM 1100-WEEKLY-PROCESS.                                 03600047
018420     PERFORM 1200-MONTHLY-PROCESS.                                03610047
018500                                                                  03620047
018600     EJECT                                                        03630047
018700                                                                  03640047
018800******************************************************************03650047
018900 2100-EDIT-INPUT.                                                 03660047
019000*                                                                 03670047
019100     DISPLAY 'EXTRACT DATE RANGE MANUALLY SPECIFIED: ',           03680047
019200                               ML110-DATA-INTEGRITY-CC-REC.       03690047
019300** ENSURE START DATE IS VALID                                     03700047
019400     MOVE ML110-STRT-DTE         TO PV-SQL-EDIT-DATE.             03710047
019500     PERFORM 7100-SELECT-TDTATTR.                                 03720047
019600                                                                  03730047
019700     EVALUATE SQLCODE                                             03740047
019800     WHEN +0                                                      03750047
019900         CONTINUE                                                 03760047
020000     WHEN +100                                                    03770047
020100         DISPLAY 'INPUT START DATE: ', PV-SQL-EDIT-DATE           03780047
020200         MOVE '2100-EDIT-INPUT' TO AA-PARAGRAPH-NAME              03790047
020300         MOVE 'INPUT CONTROL CARD START DATE NOT ON TABLE TDTATTR'03800047
020400                                 TO AA-MESSAGE                    03810047
020500         MOVE +4002              TO ABEND-CODE                    03820047
020600         PERFORM 9900-COMMON-ABEND-ROUTINE.                       03830047
020700** ENSURE END-DATE IS VALID                                       03840047
020800     MOVE ML110-END-DTE          TO PV-SQL-EDIT-DATE.             03850047
020900     PERFORM 7100-SELECT-TDTATTR.                                 03860047
021000                                                                  03870047
021100     EVALUATE SQLCODE                                             03880047
021200     WHEN +0                                                      03890047
021300         CONTINUE                                                 03900047
021400     WHEN +100                                                    03910047
021500         MOVE '2100-EDIT-INPUT' TO AA-PARAGRAPH-NAME              03920047
021600         MOVE 'INPUT CONTROL CARD END DATE NOT ON TABLE TDTATTR'  03930047
021700                                 TO AA-MESSAGE                    03940047
021800         MOVE +4004              TO ABEND-CODE                    03950047
021900         PERFORM 9900-COMMON-ABEND-ROUTINE.                       03960047
022000** ENSURE END DATE IS AFTER START DATE                            03970047
022100     IF ML110-END-DTE < ML110-STRT-DTE                            03980047
022200         MOVE '2100-EDIT-INPUT' TO AA-PARAGRAPH-NAME              03990047
022300         MOVE 'INPUT CONTROL CARD END DATE OLDER THAN START DATE' 04000047
022400                                 TO AA-MESSAGE                    04010047
022500         MOVE +4005              TO ABEND-CODE                    04020047
022600         PERFORM 9900-COMMON-ABEND-ROUTINE.                       04030047
022700                                                                  04040047
022000** USE END DATE ENTERED FOR PARTNS FOR WEEKLY                     04040147
B28582     MOVE ML110-END-DTE          TO PV-MXPSTG-FSCL-WK-DTE.        04040247
022800     EJECT                                                        04040347
022900                                                                  04040447
022910/*****************************************************************04040547
022920* 2500-BUILD-WKLY-PARTN-NBR.                                      04040647
022930*     THE ROUTINE BUILDS THE SELECT STATMENT FOR MLT_MNLY_SUM. THE04040747
022940* TABLE IS SETUP TO USE PARTITION NUMBER. THE ROUTINE BUILDS THE  04040847
022950* PARTITION NUMBER SELECT STATMENTS FOR THE OPEN FISCAL MONTH...  04040947
022960******************************************************************04041047
022970 2500-BUILD-WKLY-PARTN-NBR.                                       04042047
022980                                                                  04043047
022990     IF PS-FIRST-TIME-THRU                                        04044047
022991         WRITE WK-PARTITION-RECORD                                04045047
022992                              FROM MLTMNLYSUM-PART-VERBIAGE-1     04046047
022993         MOVE 'Y'             TO PS-FIRST-TIME-SW                 04047047
022994     END-IF.                                                      04048047
022995                                                                  04049047
022996     IF PV-PARTN-NBR-COUNT IS GREATER THAN ZERO                   04050047
022997         MOVE ','             TO MLTMNLYSUMM-COMMA                04060047
022998     ELSE                                                         04070047
022999         MOVE SPACE           TO MLTMNLYSUMM-COMMA                04080047
023000     END-IF.                                                      04090047
023001                                                                  04100047
023002     MOVE MLT00003-PARTN-NBR  TO MLTMNLYSUM-PARTN-NBR             04110047
023003                                                                  04120047
023004     WRITE WK-PARTITION-RECORD                                    04130047
023005                              FROM MLTMNLYSUM-PART-VERBIAGE-2.    04140047
023006                                                                  04150047
023007     ADD 1                    TO PV-PARTN-NBR-COUNT.              04160047
023008                                                                  04170047
W35270     DISPLAY MLTMNLYSUM-PART-VERBIAGE-2.                          04171048
023008                                                                  04172048
023009     PERFORM 7200-FETCH-PARTN-WKLY-CSR.                           04180047
023010                                                                  04190047
023020******************************************************************04200047
023030* 2600-BUILD-MNLY-PARTN-NBR.                                      04210047
023040*     THE ROUTINE BUILDS THE SELECT STATMENT FOR MLT_MNLY_SUM. THE04220047
023050* TABLE IS SETUP TO USE PARTITION NUMBER. THE ROUTINE BUILDS THE  04230047
023060* PARTITION NUMBER SELECT STATMENTS FOR THE OPEN FISCAL MONTH...  04240047
023070******************************************************************04250047
023080 2600-BUILD-MNLY-PARTN-NBR.                                       04260047
023090                                                                  04270047
023100     IF PS-FIRST-TIME-THRU                                        04280047
023110         WRITE MN-PARTITION-RECORD                                04290047
023120                              FROM MLTMNLYSUM-PART-VERBIAGE-1     04300047
023130         MOVE 'Y'             TO PS-FIRST-TIME-SW                 04310047
023140     END-IF.                                                      04320047
023150                                                                  04330047
023160     IF PV-PARTN-NBR-COUNT IS GREATER THAN ZERO                   04340047
023170         MOVE ','             TO MLTMNLYSUMM-COMMA                04350047
023180     ELSE                                                         04360047
023181         MOVE SPACE           TO MLTMNLYSUMM-COMMA                04370047
023182     END-IF.                                                      04380047
023183                                                                  04390047
023184     MOVE MLT00003-PARTN-NBR  TO MLTMNLYSUM-PARTN-NBR             04400047
023185                                                                  04410047
023186     WRITE MN-PARTITION-RECORD                                    04420047
023187                              FROM MLTMNLYSUM-PART-VERBIAGE-2.    04430047
023188                                                                  04440047
023189     ADD 1                    TO PV-PARTN-NBR-COUNT.              04450047
023190                                                                  04460047
W35270     DISPLAY MLTMNLYSUM-PART-VERBIAGE-2.                          04460148
016516                                                                  04462048
023191     PERFORM 7500-FETCH-PARTN-MNLY-CSR.                           04470047
023192                                                                  04480047
023193******************************************************************04490047
023194 4000-READ-INPUT.                                                 04500047
023200******************************************************************04510047
023300                                                                  04520047
023400     READ I-CONTROL-CARD-FILE                                     04530047
023500       INTO ML110-DATA-INTEGRITY-CC-REC                           04540047
023600         AT END                                                   04550047
023700             MOVE PC-Y        TO PS-END-OF-INPUT.                 04560047
023800                                                                  04570047
023900     EJECT                                                        04580047
024000                                                                  04590047
024100******************************************************************04600047
024200 5000-WRITE-OUTPUT.                                               04610047
024300******************************************************************04620047
024400                                                                  04630047
024500     WRITE O-CONTROL-CARD-RECORD                                  04640047
024600         FROM ML110-DATA-INTEGRITY-CC-REC.                        04650047
024700                                                                  04660047
024800     DISPLAY ' '.                                                 04670047
024900     DISPLAY '*** MLKUT414 DATE RANGE ***'                        04680047
025000     DISPLAY '   ', ML110-DATA-INTEGRITY-CC-REC.                  04690047
025100     DISPLAY ' '.                                                 04700047
025200                                                                  04710047
025300     EJECT                                                        04720047
025400                                                                  04730047
025500******************************************************************04740047
025600 7000-SELECT-TMLCNTL.                                             04750047
025700******************************************************************04760047
025800                                                                  04770047
025900     DISPLAY 'TABLE TMLCNTL USED FOR EXTRACT DATES'               04780047
026000                                                                  04790047
026100     EXEC SQL                                                     04800047
026200         SELECT OPN_FSCL_MN_DTE,                                  04810047
B28582                MXPSTG_FSCL_MN_DTE,                               04820047
B28582                MXPSTG_FSCL_WK_DTE                                04830047
026400         INTO  :MLCNTL-OPN-FSCL-MN-DTE,                           04840047
B28582               :MLCNTL-MXPSTG-FSCL-MN-DTE,                        04850047
B28582               :MLCNTL-MXPSTG-FSCL-WK-DTE                         04860047
026600         FROM TMLCNTL                                             04870047
026700     END-EXEC.                                                    04880047
026800                                                                  04890047
026900     EVALUATE TRUE                                                04900047
027000         WHEN SQLCODE = 0                                         04910047
027100             CONTINUE                                             04920047
027200         WHEN OTHER                                               04930047
027300             MOVE '7000-SELECT-TMLCNTL'                           04940047
027400                                 TO AA-PARAGRAPH-NAME             04950047
027500             MOVE 'TMLCNTL ROW NOT FOUND'                         04960047
027600                                 TO AA-MESSAGE                    04970047
027700             MOVE 'SELECT'       TO AA-DB2-OPERATION              04980047
027800             PERFORM 9901-SQL-ERROR                               04990047
027900     END-EVALUATE.                                                05000047
028000                                                                  05010047
028100     EJECT                                                        05020047
028200                                                                  05030047
028300******************************************************************05040047
028400 7050-DATE-RANGE-TO-PROCESS.                                      05050047
028500******************************************************************05060047
028600                                                                  05070047
028700     EXEC SQL                                                     05080047
028800         SELECT FSCL_MN_BEG_DTE                                   05090047
028900         INTO  :PV-OPN-MONTH-FIRST-WEEK                           05100047
029000         FROM  TDTATTR                                            05110047
029100         WHERE  KY_DTE     = :ML110-STRT-DTE                      05120047
029300     END-EXEC.                                                    05130047
029400                                                                  05140047
029500     EVALUATE TRUE                                                05150047
029600         WHEN SQLCODE = 0                                         05160047
029700             CONTINUE                                             05170047
029800         WHEN SQLCODE = +100                                      05180047
029900             CONTINUE                                             05190047
030000         WHEN OTHER                                               05200047
030100             MOVE '7050-SELECT-TDTATTR'                           05210047
030200                                 TO AA-PARAGRAPH-NAME             05220047
030300             MOVE 'NO TDTATTR MATCH FOUND FOR KY_DTE'             05230047
030400                                 TO AA-MESSAGE                    05240047
030500             MOVE 'SELECT FROM'  TO AA-DB2-OPERATION              05250047
030600             PERFORM 9901-SQL-ERROR                               05260047
030700     END-EVALUATE.                                                05270047
030800                                                                  05280047
030900     EJECT                                                        05290047
031000                                                                  05300047
028300******************************************************************05310047
028400 7060-DATE-RANGE-TO-PROCESS.                                      05320047
028500******************************************************************05330047
028600                                                                  05340047
028700     EXEC SQL                                                     05350047
028800         SELECT FSCL_MN_END_DTE                                   05360047
028900         INTO  :PV-OPN-MONTH-END-DATE                             05370047
029000         FROM  TDTATTR                                            05380047
029100         WHERE  KY_DTE     = :ML110-STRT-DTE                      05390047
029300     END-EXEC.                                                    05400047
029400                                                                  05410047
029500     EVALUATE TRUE                                                05420047
029600         WHEN SQLCODE = 0                                         05430047
029700             CONTINUE                                             05440047
029800         WHEN SQLCODE = +100                                      05450047
029900             CONTINUE                                             05460047
030000         WHEN OTHER                                               05470047
030100             MOVE '7060-SELECT-TDTATTR'                           05480047
030200                                 TO AA-PARAGRAPH-NAME             05490047
030300             MOVE 'NO TDTATTR MATCH FOUND FOR KY_DTE'             05500047
030400                                 TO AA-MESSAGE                    05510047
030500             MOVE 'SELECT FROM'  TO AA-DB2-OPERATION              05520047
030600             PERFORM 9901-SQL-ERROR                               05530047
030700     END-EVALUATE.                                                05540047
030800                                                                  05550047
030900     EJECT                                                        05560047
031000                                                                  05570047
031001******************************************************************05580047
031002 7100-SELECT-TDTATTR.                                             05590047
031003******************************************************************05600047
031004                                                                  05610047
031005     EXEC SQL                                                     05620047
031006         SELECT KY_DTE                                            05630047
031007         INTO  :DTATTR-KY-DTE                                     05640047
031008         FROM  TDTATTR                                            05650047
031009         WHERE (KY_DTE     = :PV-SQL-EDIT-DATE)                   05660047
031010         AND    DAY_NM     = 'SATURDAY'                           05670047
031011     END-EXEC.                                                    05680047
031012                                                                  05690047
031013     EVALUATE TRUE                                                05700047
031014         WHEN SQLCODE = 0                                         05710047
031015             CONTINUE                                             05720047
031016         WHEN SQLCODE = +100                                      05730047
031017             CONTINUE                                             05740047
031018         WHEN OTHER                                               05750047
031019             MOVE '7100-SELECT-TDTATTR'                           05760047
031020                                 TO AA-PARAGRAPH-NAME             05770047
031021             MOVE 'CONTROL CARD WILL NOT RETURN A VALID DATE'     05780047
031022                                 TO AA-MESSAGE                    05790047
031023             MOVE 'SELECT'       TO AA-DB2-OPERATION              05800047
031024             PERFORM 9901-SQL-ERROR                               05810047
031025     END-EVALUATE.                                                05820047
031026                                                                  05830047
031027     EJECT                                                        05840047
031028                                                                  05850047
031029***************************************************************** 05860047
031030* 7150-OPEN-PARTN-WKLY-CSR.                                       05870047
031031***************************************************************** 05880047
031040 7150-OPEN-PARTN-WKLY-CSR.                                        05890047
031050                                                                  05900047
031060     PERFORM                                                      05910047
031070         WITH TEST AFTER                                          05920047
031080         VARYING PV-RETRY-COUNT FROM 1 BY 1                       05930047
031090           UNTIL SQLCODE = +000                                   05940047
031091              OR PV-RETRY-COUNT > PC-MAX-RETRIES                  05950047
031092                                                                  05960047
031093         EXEC SQL                                                 05970047
031094             OPEN PARTN-WKLY-CSR                                  05980047
031095         END-EXEC                                                 05990047
031096                                                                  06000047
031097         EVALUATE TRUE                                            06010047
031098             WHEN SQLCODE        = +000                           06020047
031099             WHEN SQLCODE        = -911                           06030047
031100             WHEN SQLCODE        = -913                           06040047
031101                 CONTINUE                                         06050047
031102             WHEN OTHER                                           06060047
031103                 MOVE '7150-OPEN-PARTN-WKLY-CSR'                  06070047
031104                                          TO AA-PARAGRAPH-NAME    06080047
031105                 MOVE 'PARTN-WKLY-CSR OPEN CURSOR ERROR OCCURRED' 06090047
031106                                          TO AA-MESSAGE           06100047
031107                 MOVE 'OPEN PARTITION WEEKLY CURSOR'              06110047
031108                                          TO AA-DB2-OPERATION     06120047
031109                 PERFORM 9901-SQL-ERROR                           06130047
031110         END-EVALUATE                                             06140047
031111                                                                  06150047
031112     END-PERFORM.                                                 06160047
031113                                                                  06170047
031114     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          06180047
031115         MOVE '7150-OPEN-PARTN-WKLY-CSR'   TO AA-PARAGRAPH-NAME   06190047
031116         MOVE 'PARTN-WKLY-CSR OPEN CURSOR RETRIES EXCEEDED'       06200047
031117                                          TO AA-MESSAGE           06210047
031118         MOVE 'OPEN PARTITION WEEKLY CURSOR'                      06220047
031119                                          TO AA-DB2-OPERATION     06230047
031120         PERFORM 9901-SQL-ERROR                                   06240047
031121     END-IF.                                                      06250047
031122                                                                  06260047
031123***************************************************************** 06270047
031124* 7200-FETCH-PARTN-WKLY-CSR.                                      06280047
031125***************************************************************** 06290047
031126  7200-FETCH-PARTN-WKLY-CSR.                                      06300047
031127                                                                  06310047
031128     PERFORM                                                      06320047
031129         WITH TEST AFTER                                          06330047
031130         VARYING PV-RETRY-COUNT FROM 1 BY 1                       06340047
031131           UNTIL SQLCODE = +000                                   06350047
031132              OR SQLCODE = +100                                   06360047
031133              OR PV-RETRY-COUNT > PC-MAX-RETRIES                  06370047
031134                                                                  06380047
031135         EXEC SQL                                                 06390047
031136             FETCH PARTN-WKLY-CSR                                 06400047
031137             INTO :MLT00003-PARTN-NBR                             06410047
031138         END-EXEC                                                 06420047
031139                                                                  06430047
031140         EVALUATE TRUE                                            06440047
031141             WHEN SQLCODE        = +000                           06450047
031142                 CONTINUE                                         06460047
031143             WHEN SQLCODE = +100                                  06470047
031144                 SET PS-PARTN-WKLY-COMPLETE TO TRUE               06480047
031145             WHEN SQLCODE        = -911                           06490047
031146             WHEN SQLCODE        = -913                           06500047
031147                 CONTINUE                                         06510047
031148             WHEN OTHER                                           06520047
031149                 MOVE '7200-FETCH-PARTN-WKLY-CSR'                 06530047
031150                                          TO AA-PARAGRAPH-NAME    06540047
031151                 MOVE 'PARTN-WKLY-CSR FETCH CURSOR ERROR OCCURRED'06550047
031152                                          TO AA-MESSAGE           06560047
031153                 MOVE 'FETCH PARTITION WEEKLY CURSOR'             06570047
031154                                          TO AA-DB2-OPERATION     06580047
031155                 PERFORM 9901-SQL-ERROR                           06590047
031156         END-EVALUATE                                             06600047
031157                                                                  06610047
031158     END-PERFORM.                                                 06620047
031159                                                                  06630047
031160     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          06640047
031161         MOVE '7200-FETCH-PARTN-WKLY-CSR'  TO AA-PARAGRAPH-NAME   06650047
031162         MOVE 'PARTN-WKLY-CSR FETCH CURSOR RETRIES EXCEEDED'      06660047
031163                                          TO AA-MESSAGE           06670047
031164         MOVE 'FETCH PARTITION WEEKLY CURSOR'                     06680047
031165                                          TO AA-DB2-OPERATION     06690047
031166         PERFORM 9901-SQL-ERROR                                   06700047
031167     END-IF.                                                      06710047
031168                                                                  06720047
031169***************************************************************** 06730047
031170* 7300-CLOSE-PARTN-WKLY-CSR.                                      06740047
031171***************************************************************** 06750047
031172  7300-CLOSE-PARTN-WKLY-CSR.                                      06760047
031173                                                                  06770047
031174     PERFORM                                                      06780047
031175         WITH TEST AFTER                                          06790047
031176         VARYING PV-RETRY-COUNT FROM 1 BY 1                       06800047
031177           UNTIL SQLCODE = +000                                   06810047
031178              OR PV-RETRY-COUNT > PC-MAX-RETRIES                  06820047
031179                                                                  06830047
031180         EXEC SQL                                                 06840047
031181             CLOSE PARTN-WKLY-CSR                                 06850047
031182         END-EXEC                                                 06860047
031183                                                                  06870047
031184         EVALUATE TRUE                                            06880047
031185             WHEN SQLCODE        = +000                           06890047
031186             WHEN SQLCODE        = -911                           06900047
031187             WHEN SQLCODE        = -913                           06910047
031188                 CONTINUE                                         06920047
031189             WHEN OTHER                                           06930047
031190                 MOVE '7300-CLOSE-PARTN-WKLY-CSR'                 06940047
031191                                          TO AA-PARAGRAPH-NAME    06950047
031192                 MOVE 'PARTN-WKLY-CSR CLOSE CURSOR ERROR OCCURRED'06960047
031193                                          TO AA-MESSAGE           06970047
031194                 MOVE 'CLOSE PARTITION WEEKLY CURSOR'             06980047
031195                                          TO AA-DB2-OPERATION     06990047
031196                 PERFORM 9901-SQL-ERROR                           07000047
031197         END-EVALUATE                                             07010047
031198                                                                  07020047
031199     END-PERFORM.                                                 07030047
031200                                                                  07040047
031201     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          07050047
031202         MOVE '7300-CLOSE-PARTN-WKLY-CSR'  TO AA-PARAGRAPH-NAME   07060047
031203         MOVE 'PARTN-WKLY-CSR CLOSE CURSOR RETRIES EXCEEDED'      07070047
031204                                          TO AA-MESSAGE           07080047
031205         MOVE 'CLOSE PARTITION WEEKLY CURSOR'                     07090047
031206                                          TO AA-DB2-OPERATION     07100047
031207         PERFORM 9901-SQL-ERROR                                   07110047
031208     END-IF.                                                      07120047
031209                                                                  07130047
031210***************************************************************** 07140047
031211* 7400-OPEN-PARTN-MNLY-CSR.                                       07150047
031212***************************************************************** 07160047
031213 7400-OPEN-PARTN-MNLY-CSR.                                        07170047
031214                                                                  07180047
031215     PERFORM                                                      07190047
031216         WITH TEST AFTER                                          07200047
031217         VARYING PV-RETRY-COUNT FROM 1 BY 1                       07210047
031218           UNTIL SQLCODE = +000                                   07220047
031219              OR PV-RETRY-COUNT > PC-MAX-RETRIES                  07230047
031220                                                                  07240047
031221         EXEC SQL                                                 07250047
031222             OPEN PARTN-MNLY-CSR                                  07260047
031223         END-EXEC                                                 07270047
031224                                                                  07280047
031225         EVALUATE TRUE                                            07290047
031226             WHEN SQLCODE        = +000                           07300047
031227             WHEN SQLCODE        = -911                           07310047
031228             WHEN SQLCODE        = -913                           07320047
031229                 CONTINUE                                         07330047
031230             WHEN OTHER                                           07340047
031231                 MOVE '7400-OPEN-PARTN-MNLY-CSR'                  07350047
031232                                          TO AA-PARAGRAPH-NAME    07360047
031233                 MOVE 'PARTN-MNLY-CSR OPEN CURSOR ERROR OCCURRED' 07370047
031234                                          TO AA-MESSAGE           07380047
031235                 MOVE 'OPEN PARTITION MONTHLY CURSOR'             07390047
031236                                          TO AA-DB2-OPERATION     07400047
031237                 PERFORM 9901-SQL-ERROR                           07410047
031238         END-EVALUATE                                             07420047
031239                                                                  07430047
031240     END-PERFORM.                                                 07440047
031241                                                                  07450047
031242     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          07460047
031243         MOVE '7400-OPEN-PARTN-WKLY-CSR'   TO AA-PARAGRAPH-NAME   07470047
031244         MOVE 'PARTN-MNLY-CSR OPEN CURSOR RETRIES EXCEEDED'       07480047
031245                                          TO AA-MESSAGE           07490047
031246         MOVE 'OPEN PARTITION MONTHLY CURSOR'                     07500047
031247                                          TO AA-DB2-OPERATION     07510047
031248         PERFORM 9901-SQL-ERROR                                   07520047
031249     END-IF.                                                      07530047
031250                                                                  07540047
031251***************************************************************** 07550047
031252* 7500-FETCH-PARTN-MNLY-CSR.                                      07560047
031253***************************************************************** 07570047
031254  7500-FETCH-PARTN-MNLY-CSR.                                      07580047
031255                                                                  07590047
031256     PERFORM                                                      07600047
031257         WITH TEST AFTER                                          07610047
031258         VARYING PV-RETRY-COUNT FROM 1 BY 1                       07620047
031259           UNTIL SQLCODE = +000                                   07630047
031260              OR SQLCODE = +100                                   07640047
031261              OR PV-RETRY-COUNT > PC-MAX-RETRIES                  07650047
031262                                                                  07660047
031263         EXEC SQL                                                 07670047
031264             FETCH PARTN-MNLY-CSR                                 07680047
031265             INTO :MLT00003-PARTN-NBR                             07690047
031266         END-EXEC                                                 07700047
031267                                                                  07710047
031268         EVALUATE TRUE                                            07720047
031269             WHEN SQLCODE        = +000                           07730047
031270                 CONTINUE                                         07740047
031271             WHEN SQLCODE = +100                                  07750047
031272                 SET PS-PARTN-MNLY-COMPLETE TO TRUE               07760047
031273             WHEN SQLCODE        = -911                           07770047
031274             WHEN SQLCODE        = -913                           07780047
031275                 CONTINUE                                         07790047
031276             WHEN OTHER                                           07800047
031277                 MOVE '7500-FETCH-PARTN-MNLY-CSR'                 07810047
031278                                          TO AA-PARAGRAPH-NAME    07820047
031279                 MOVE 'PARTN-MNLY-CSR FETCH CURSOR ERROR OCCURRED'07830047
031280                                          TO AA-MESSAGE           07840047
031281                 MOVE 'FETCH PARTITION MONTHLY CURSOR'            07850047
031282                                          TO AA-DB2-OPERATION     07860047
031283                 PERFORM 9901-SQL-ERROR                           07870047
031284         END-EVALUATE                                             07880047
031285                                                                  07890047
031286     END-PERFORM.                                                 07900047
031287                                                                  07910047
031288     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          07920047
031289         MOVE '7500-FETCH-PARTN-MNLY-CSR'  TO AA-PARAGRAPH-NAME   07930047
031290         MOVE 'PARTN-MNLY-CSR FETCH CURSOR RETRIES EXCEEDED'      07940047
031291                                          TO AA-MESSAGE           07950047
031292         MOVE 'FETCH PARTITION MONTHLY CURSOR'                    07960047
031293                                          TO AA-DB2-OPERATION     07970047
031294         PERFORM 9901-SQL-ERROR                                   07980047
031295     END-IF.                                                      07990047
031296                                                                  08000047
031297***************************************************************** 08010047
031298* 7600-CLOSE-PARTN-MNLY-CSR.                                      08020047
031299***************************************************************** 08030047
031300  7600-CLOSE-PARTN-MNLY-CSR.                                      08040047
031301                                                                  08050047
031302     PERFORM                                                      08060047
031303         WITH TEST AFTER                                          08070047
031304         VARYING PV-RETRY-COUNT FROM 1 BY 1                       08080047
031305           UNTIL SQLCODE = +000                                   08090047
031306              OR PV-RETRY-COUNT > PC-MAX-RETRIES                  08100047
031307                                                                  08110047
031308         EXEC SQL                                                 08120047
031309             CLOSE PARTN-MNLY-CSR                                 08130047
031310         END-EXEC                                                 08140047
031311                                                                  08150047
031312         EVALUATE TRUE                                            08160047
031313             WHEN SQLCODE        = +000                           08170047
031314             WHEN SQLCODE        = -911                           08180047
031315             WHEN SQLCODE        = -913                           08190047
031316                 CONTINUE                                         08200047
031317             WHEN OTHER                                           08210047
031318                 MOVE '7600-CLOSE-PARTN-MNLY-CSR'                 08220047
031319                                          TO AA-PARAGRAPH-NAME    08230047
031320                 MOVE 'PARTN-MNLY-CSR CLOSE CURSOR ERROR OCCURRED'08240047
031321                                          TO AA-MESSAGE           08250047
031322                 MOVE 'CLOSE PARTITION MONTHLY CURSOR'            08260047
031323                                          TO AA-DB2-OPERATION     08270047
031324                 PERFORM 9901-SQL-ERROR                           08280047
031325         END-EVALUATE                                             08290047
031326                                                                  08300047
031327     END-PERFORM.                                                 08310047
031328                                                                  08320047
031329     IF  PV-RETRY-COUNT > PC-MAX-RETRIES                          08330047
031330         MOVE '7600-CLOSE-PARTN-MNLY-CSR'  TO AA-PARAGRAPH-NAME   08340047
031331         MOVE 'PARTN-MNLY-CSR CLOSE CURSOR RETRIES EXCEEDED'      08350047
031332                                          TO AA-MESSAGE           08360047
031333         MOVE 'CLOSE PARTITION MONTHLY CURSOR'                    08370047
031334                                          TO AA-DB2-OPERATION     08380047
031335         PERFORM 9901-SQL-ERROR                                   08390047
031336     END-IF.                                                      08400047
031337                                                                  08410047
031338******************************************************************08420047
031339 8000-EOJ.                                                        08430047
031340******************************************************************08440047
031400                                                                  08450047
031500     CLOSE I-CONTROL-CARD-FILE.                                   08460047
031600     CLOSE O-CONTROL-CARD-FILE                                    08470047
031700           WK-PARTITION-FILE                                      08480047
031710           MN-PARTITION-FILE.                                     08490047
031800     EJECT                                                        08500047
031900                                                                  08510047
032000******************************************************************08520047
032100 9900-COMMON-ABEND-ROUTINE.                                       08530047
032200******************************************************************08540047
032300                                                                  08550047
032400     DISPLAY AA-ABEND-LIT.                                        08560047
032500     DISPLAY AA-PROGRAM-LIT.                                      08570047
032600     DISPLAY AA-PARAGRAPH-LIT.                                    08580047
032700     DISPLAY AA-MESSAGE-LINE.                                     08590047
032800     DISPLAY ABEND-CODE.                                          08600047
032900                                                                  08610047
033000     CALL 'ILBOABN0' USING ABEND-CODE.                            08620047
033100                                                                  08630047
033200     EJECT                                                        08640047
033300                                                                  08650047
033400******************************************************************08660047
033500 9901-SQL-ERROR.                                                  08670047
033600******************************************************************08680047
033700                                                                  08690047
033800     DISPLAY 'CONTROL CARD INPUT : ', ML110-DATA-INTEGRITY-CC-REC 08700047
033900     CLOSE I-CONTROL-CARD-FILE.                                   08710047
034000     CLOSE O-CONTROL-CARD-FILE.                                   08720047
034100                                                                  08730047
034200     DISPLAY AA-ABEND-LIT.                                        08740047
034300     DISPLAY AA-DB2-ERROR-LIT.                                    08750047
034400     DISPLAY AA-PROGRAM-LIT.                                      08760047
034500     DISPLAY AA-PARAGRAPH-LIT.                                    08770047
034600     DISPLAY AA-MESSAGE-LINE.                                     08780047
034700     DISPLAY AA-DB2-OPERATION-LIT.                                08790047
034800     SET AC-DB2-ERROR TO TRUE.                                    08800047
034900     MOVE +4013                  TO ABEND-CODE.                   08810047
035000                                                                  08820047
035100     COPY DPPD004.                                                08830047
035200     CALL 'ILBOABN0' USING ABEND-CODE.                            08840047
035300                                                                  08850047
