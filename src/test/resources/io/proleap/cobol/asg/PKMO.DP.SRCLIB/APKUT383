000100*------------------------*                                        00010048
000200 IDENTIFICATION DIVISION.                                         00020049
000300*------------------------*                                        00030049
000400 PROGRAM-ID.     APKUT383.                                        00040049
000500 AUTHOR.         JEAN KURK.                                       00050049
000600 DATE-WRITTEN.   MARCH 2021.                                      00060049
000700*---------------------------------------------------------------* 00070049
000800*     CREATE OTP TRANSACTIONS FOR SEPHORA FIRST COST INVOICES   * 00080049
000900*---------------------------------------------------------------* 00090049
001000*                      COBOL WITH DB2                           * 00100049
001100*---------------------------------------------------------------* 00110049
001200*  THIS IS A COPY OF APKUT064 (LI & FUNG)                       * 00120049
001310*                                                               * 00131001
001400*  THIS PROGRAM SELECTS NEWLY ENTERED FIRST COST INVOICES FOR   * 00140001
001500*  SEPHORA PURCHASE ORDERS AND FORMAT THEM TO BE INTERFACED     * 00150001
001600*  INTO ERP AS AN OPEN PAYABLE.  A SEPARATE INTERFACE RECORD    * 00160001
001700*  WILL BE WRITTEN FOR ANY INVOICE CHARGES FOUND ON THE         * 00170001
001800*  INVOICES.                                                    * 00180001
001900*  A SECOND FILE WILL BE CREATED TO UPDATE THE INVOICE STATUS.  * 00190001
002100*                                                               * 00210001
002200*---------------------------------------------------------------* 00220001
002300*                                                               * 00230001
002400*  DB2 TABLES:                                DCLGENS:          * 00240001
002500*   1. AP-PAYMENT CONTROL TABLE               (TAPCNTL)         * 00250001
002600*   2. AP-INVOICE TABLE                       (TINVOIC)         * 00260001
002700*   3. AP-ALLOWANCE/CHARGE TABLE              (TALCHRG)         * 00270001
003000*   4. AP-INVOICE PAYMENT TERMS TABLE         (TINVCTM)         * 00300021
003100*   5. AP-MERCHANDISE INVOICE TABLE           (TMDINVC)         * 00310021
003200*   6. AP-TRANSACTION CODE TABLE              (TTRNCDE)         * 00320021
003300*   7. PO-PURCHASE AGREEMENT TABLE            (TPOAGMT)         * 00330021
003400*   8. EX-EXTERNAL ENTERPRISE NAME TABLE      (TENTNME)         * 00340021
003500*   9. EX-EXTERNAL ENTERPRISE TABLE           (TEXTENT)         * 00350021
003600*  10. EX-PAYMENT TERM TYPE TABLE             (TPAYTRM)         * 00360021
003610*  11. VN-VENDOR CAPABILITY                   (VNT_VND_CPBL)    * 00361021
003620*  12. MB-MERCHANDISE AREA                    (TMDSEAR)         * 00362021
003630*  13. PO-PURCHASE ORDER                      (TPURCHS)         * 00363021
003700*                                                               * 00370001
003800*  OUTPUT:                                    COPYBOOK:         * 00380001
003900*   1. AP-TRANS-FILE.                         APRD040           * 00390001
004000*   2. INVC-STATUS-UPD-FILE.                  APRD252           * 00400001
004100*                                                               * 00410001
004200*---------------------------------------------------------------* 00420001
004300* CHANGE LOG:                                                   * 00430001
004400*   05/11/2021                                                  * 00440050
004500*      INITIAL VERSION.                                         * 00450001
004600*   MADE BY: JEAN KURK                      CHG0256545          * 00460050
004700*                                                               * 00470001
004400*   02/24/2022                                                  * 00480062
004500*      REMOVE CHARGE RECORDS.  CHARGE AMTS WILL BE POPULATED ON * 00490052
004500*      THE INVOICE RECORD.  IF THE CHARGE CODE IS 400, FFC, PAB,* 00491052
004500*      SAB, PST, OR UUC THEN SUM THE AMOUNTS AND POPULATE FIELD * 00492052
004500*      AP040-FRGT-AMT.  ALL OTHERS, SUM AND POPULATE FIELD      * 00493052
004500*      AP040-MISC-CHRG-AMT.  REMOVED REFERENCES TO COOP/ALW/    * 00494054
004500*      MSC DISCOUNTS.                                           * 00495054
004600*   MADE BY: JEAN KURK                      CHG0267023          * 00500051
004700*                                                               * 00501063
004400*   07/12/2022                                                  * 00502063
004500*      CHANGE THE STORE NUMBER ON THE OUTPUT RECORD TO BE THE   * 00503063
004500*      CORP LOCATION, 90.                                       * 00504063
004600*   MADE BY: JEAN KURK                      CHG0271754          * 00509063
004700*                                                               * 00510051
009300*---------------------------------------------------------------* 00930001
009400                                                                  00940001
009500*---------------------*                                           00950001
009600 ENVIRONMENT DIVISION.                                            00960001
009700*---------------------*                                           00970001
009800 CONFIGURATION SECTION.                                           00980001
009900 SOURCE-COMPUTER.    IBM-3090.                                    00990001
010000 OBJECT-COMPUTER.    IBM-3090.                                    01000001
010100                                                                  01010001
010200 INPUT-OUTPUT SECTION.                                            01020001
010300 FILE-CONTROL.                                                    01030001
010400                                                                  01040001
010500     SELECT AP-TRANS-FILE         ASSIGN TO OUT01.                01050001
010600     SELECT INVC-STATUS-UPD-FILE  ASSIGN TO OUT02.                01060001
010700                                                                  01070001
010800*--------------*                                                  01080001
010900 DATA DIVISION.                                                   01090001
011000*--------------*                                                  01100001
011100 FILE SECTION.                                                    01110001
011200                                                                  01120001
011300 FD  AP-TRANS-FILE                                                01130001
011400     RECORDING MODE IS F                                          01140001
011500     LABEL RECORDS ARE STANDARD                                   01150001
011600     BLOCK CONTAINS 0 RECORDS                                     01160001
011700     DATA RECORD IS AP-TRANS-REC.                                 01170001
011800 01  AP-TRANS-REC                PIC  X(500).                     01180001
011900                                                                  01190001
012000 FD  INVC-STATUS-UPD-FILE                                         01200001
012100     RECORDING MODE IS F                                          01210001
012200     LABEL RECORDS ARE STANDARD                                   01220001
012300     BLOCK CONTAINS 0 RECORDS                                     01230001
012400     DATA RECORD IS INVC-STATUS-UPD-REC.                          01240001
012500 01  INVC-STATUS-UPD-REC         PIC  X(80).                      01250001
012600                                                                  01260001
012700 EJECT                                                            01270001
012800                                                                  01280001
012900 WORKING-STORAGE SECTION.                                         01290001
013000                                                                  01300001
013100 01  FILLER                      PIC  X(27)     VALUE             01310001
013200     '** START OF APKUT383 W/S **'.                               01320001
013300                                                                  01330001
013400 01  PROGRAM-CONSTANTS.                                           01340001
013500     05  PC-PROGRAM-NAME         PIC  X(08)    VALUE 'APKUT383'.  01350001
013500     05  PC-STORE-90             PIC  9(05)    VALUE 90.          01360064
013700                                                                  01370001
013800 01  PV-PROCESS-COUNTERS.                                         01380001
013900     05  PV-INVC-CSR-COUNT       PIC  9(08)     VALUE ZEROS.      01390001
014000     05  PV-AP-TRANS-COUNT       PIC  9(08)     VALUE ZEROS.      01400001
014100     05  PV-INVC-UPD-COUNT       PIC  9(08)     VALUE ZEROS.      01410001
014110     05  PV-BYPASS-COUNT         PIC  9(08)     VALUE ZEROS.      01411014
014200                                                                  01420001
014300 01  PROGRAM-SWITCHES.                                            01430001
014400     05  PS-END-FILE-SW             PIC  X(01)   VALUE 'N'.       01440001
014500         88  NOT-END-OF-FILE                     VALUE 'N'.       01450001
014600         88  END-OF-FILE                         VALUE 'Y'.       01460001
014700     05  PS-END-INVC-CSR-SW         PIC  X(01)   VALUE 'N'.       01470001
014800         88  MORE-INVC-CSR                       VALUE 'N'.       01480001
014900         88  END-OF-INVC-CSR                     VALUE 'Y'.       01490001
015000     05  PS-INVC-CSR-OPEN-SW        PIC  X(01)   VALUE 'N'.       01500001
015100         88  INVC-CSR-CLOSED                     VALUE 'N'.       01510001
015200         88  INVC-CSR-OPEN                       VALUE 'Y'.       01520001
015300     05  PS-END-ALLOW-CSR-SW        PIC  X(01)   VALUE 'N'.       01530001
015400         88  MORE-ALLOW-CSR                      VALUE 'N'.       01540001
015500         88  END-OF-ALLOW-CSR                    VALUE 'Y'.       01550001
015600     05  PS-ALLOW-CSR-OPEN-SW       PIC  X(01)   VALUE 'N'.       01560001
015700         88  ALLOW-CSR-CLOSED                    VALUE 'N'.       01570001
015800         88  ALLOW-CSR-OPEN                      VALUE 'Y'.       01580001
015810     05  PS-ALLOW-ON-INVC-SW        PIC  X(01)   VALUE 'N'.       01581036
015820         88  NO-ALLOW-ON-INVC                    VALUE 'N'.       01582036
015830         88  ALLOW-ON-INVC                       VALUE 'Y'.       01583036
015900     05  PS-END-CHRG-CSR-SW         PIC  X(01)   VALUE 'N'.       01590001
016000         88  MORE-CHRG-CSR                       VALUE 'N'.       01600001
016100         88  END-OF-CHRG-CSR                     VALUE 'Y'.       01610001
016200     05  PS-CHRG-CSR-OPEN-SW        PIC  X(01)   VALUE 'N'.       01620001
016300         88  CHRG-CSR-CLOSED                     VALUE 'N'.       01630001
016400         88  CHRG-CSR-OPEN                       VALUE 'Y'.       01640001
017100     05  PS-END-OF-MONTH-SW         PIC  X(01)   VALUE 'N'.       01710001
017200         88  NOT-END-OF-MONTH                    VALUE 'N'.       01720001
017300         88  END-OF-MONTH                        VALUE 'Y'.       01730001
017400                                                                  01740001
017500 01  PROGRAM-VARIABLES.                                           01750001
017600     05  PV-HOLD-PO-NBR        PIC  S9(09)  COMP VALUE ZEROS.     01760010
017610     05  PV-HOLD-VND-NBR       PIC   X(09)  VALUE SPACES.         01761006
017800     05  PV-DISCOUNT-PCT       PIC  SV9(4)  COMP-3 VALUE ZEROS.   01780001
017900     05  PV-ALW-CHRG-CDE       PIC   X(3)   VALUE SPACES.         01790001
018000     05  PV-GL-ACCT-NBR        PIC   X(7)   VALUE '10378 '.       01800046
018200     05  PV-SUM-ALW-CHRG-AMT   PIC S9(9)V9(2) COMP-3 VALUE ZEROS. 01820001
018200     05  PV-FRGT-CHRGS         PIC S9(9)V9(2) COMP-3 VALUE ZEROS. 01821052
018200     05  PV-MISC-CHRGS         PIC S9(9)V9(2) COMP-3 VALUE ZEROS. 01822052
018300     05  PV-START              PIC S9(02)   COMP VALUE ZEROS.     01830001
004000     05  PV-CHARGE-CODE        PIC X(03)     VALUE SPACES.        01833053
004400         88  PV-FREIGHT        VALUES '400', 'FFC', 'PAB',        01833453
004500                                      'SAB', 'PST', 'UUC'.        01833553
018340                                                                  01834010
018800*----------------------------------------------------------------*01880001
018900*  RECORD LAYOUT FOR THE ACCOUNTS PAYABLE TRANSACTION FILE        01890001
019000*----------------------------------------------------------------*01900001
019100     COPY APRD040.                                                01910001
019200                                                                  01920001
019300*----------------------------------------------------------------*01930001
019400*  RECORD LAYOUT FOR THE OPEN TO PAY INVOICE UPDATE FILE          01940001
019500*----------------------------------------------------------------*01950001
019600     COPY APRD252.                                                01960001
019700                                                                  01970001
019800*----------------------------------------------------------------*01980001
019900*  WORKING STORAGE AREA FOR APPD051 DATE ROUTINE                  01990001
020000*----------------------------------------------------------------*02000001
020100     COPY APWS051.                                                02010001
020200                                                                  02020001
020300*----------------------------------------------------------------*02030001
020400*  WORKING STORAGE AREA FOR DPKUT500                              02040001
020500*----------------------------------------------------------------*02050001
020600     COPY DPWS500.                                                02060001
020700                                                                  02070001
020800*----------------------------------------------------------------*02080001
020900*  WORKING STORAGE AREA FOR APPD052                               02090001
021000*----------------------------------------------------------------*02100001
021100     COPY APWS052.                                                02110001
021200                                                                  02120001
021300*----------------------------------------------------------------*02130001
021400*    SQL COMMUNICATIONS AREA DCLGEN                               02140001
021500*----------------------------------------------------------------*02150001
021600     EXEC SQL                                                     02160001
021700         INCLUDE SQLCA                                            02170001
021800     END-EXEC.                                                    02180001
021900                                                                  02190001
022000*----------------------------------------------------------------*02200001
022100*    AP-PAYMENT CONTROL TABLE                                     02210001
022200*----------------------------------------------------------------*02220001
022300     EXEC SQL                                                     02230001
022400         INCLUDE TAPCNTL                                          02240001
022500     END-EXEC.                                                    02250001
022600                                                                  02260001
022700*----------------------------------------------------------------*02270001
022800*    AP-INVOICE TABLE                                             02280001
022900*----------------------------------------------------------------*02290001
023000     EXEC SQL                                                     02300001
023100         INCLUDE TINVOIC                                          02310001
023200     END-EXEC.                                                    02320001
023300                                                                  02330001
023400*----------------------------------------------------------------*02340001
023500*    AP-ALLOWANCE/CHARGE TABLE                                    02350001
023600*----------------------------------------------------------------*02360001
023700     EXEC SQL                                                     02370001
023800         INCLUDE TALCHRG                                          02380001
023900     END-EXEC.                                                    02390001
024000                                                                  02400001
025500*----------------------------------------------------------------*02550001
025600*    AP-INVOICE PAYMENT TERMS TABLE                               02560001
025700*----------------------------------------------------------------*02570001
025800     EXEC SQL                                                     02580001
025900         INCLUDE TINVCTM                                          02590001
026000     END-EXEC.                                                    02600001
026100                                                                  02610001
026200*----------------------------------------------------------------*02620001
026300*    AP-MERCHANDISE INVOICE TABLE                                 02630001
026400*----------------------------------------------------------------*02640001
026500     EXEC SQL                                                     02650001
026600         INCLUDE TMDINVC                                          02660001
026700     END-EXEC.                                                    02670001
026800                                                                  02680001
026900*----------------------------------------------------------------*02690001
027000*    AP-TRANSACTION CODE TABLE                                    02700001
027100*----------------------------------------------------------------*02710001
027200     EXEC SQL                                                     02720001
027300         INCLUDE TTRNCDE                                          02730001
027400     END-EXEC.                                                    02740001
027500                                                                  02750001
027600*----------------------------------------------------------------*02760001
027700*    PO-PURCHASE AGREEMENT TABLE                                  02770001
027800*----------------------------------------------------------------*02780001
027900     EXEC SQL                                                     02790001
028000         INCLUDE TPOAGMT                                          02800001
028100     END-EXEC.                                                    02810001
028200                                                                  02820001
028210*----------------------------------------------------------------*02821007
028220*    MB-MERCHANDISE AREA TABLE                                    02822008
028230*----------------------------------------------------------------*02823007
028240     EXEC SQL                                                     02824007
028250         INCLUDE TMDSEAR                                          02825007
028260     END-EXEC.                                                    02826007
028270                                                                  02827007
028300*----------------------------------------------------------------*02830001
028400*    EX-EXTERNAL ENTERPRISE NAME TABLE                            02840001
028500*----------------------------------------------------------------*02850001
028600     EXEC SQL                                                     02860001
028700         INCLUDE TENTNME                                          02870001
028800     END-EXEC.                                                    02880001
028900                                                                  02890001
029000*----------------------------------------------------------------*02900001
029100*    EX-EXTERNAL ENTERPRISE TABLE                                 02910001
029200*----------------------------------------------------------------*02920001
029300     EXEC SQL                                                     02930001
029400         INCLUDE TEXTENT                                          02940001
029500     END-EXEC.                                                    02950001
029600                                                                  02960001
029700*----------------------------------------------------------------*02970001
029800*    EX-PAYMENT TERM TYPE TABLE                                   02980001
029900*----------------------------------------------------------------*02990001
030000     EXEC SQL                                                     03000001
030100         INCLUDE TPAYTRM                                          03010001
030200     END-EXEC.                                                    03020001
030300                                                                  03030001
030310*----------------------------------------------------------------*03031003
030320*    VN-VENDOR CAPABILITY                                         03032003
030330*----------------------------------------------------------------*03033003
030340     EXEC SQL                                                     03034003
030350         INCLUDE VNT00001                                         03035003
030360     END-EXEC.                                                    03036003
030370                                                                  03037003
030380*----------------------------------------------------------------*03038010
030390*    PO-PURCHASE ORDER                                            03039010
030391*----------------------------------------------------------------*03039110
030392     EXEC SQL                                                     03039210
030393         INCLUDE TPURCHS                                          03039310
030394     END-EXEC.                                                    03039410
030395                                                                  03039510
030400*----------------------------------------------------------------*03040001
030500*    INVOICE CURSOR SELECTING SEPHORA INVOICES IN ENTERED STATUS  03050001
030600*----------------------------------------------------------------*03060001
030700     EXEC SQL                                                     03070001
030800         DECLARE INVOICE_CSR CURSOR FOR                           03080001
030900             SELECT  A.PO_NBR                                     03090001
031000                    ,A.INVC_ID                                    03100001
031100                    ,A.STR_NBR                                    03110001
031200                    ,A.INVC_DTE                                   03120001
031300                    ,A.GRO_COST_AMT                               03130001
031400                    ,A.CRE_DTE                                    03140001
031500                    ,A.CRE_BY_USR_ID                              03150001
031600                    ,A.HOLD_IND                                   03160001
031700                    ,A.BAR_CDE                                    03170001
031710                    ,A.RMIT_VND_ID                                03171001
031800                    ,B.IMPRT_CHRG_PRC_CDE                         03180001
031900                    ,B.TERM_SEL_CDE                               03190001
032000               FROM  TINVOIC  A                                   03200001
032100                    ,TMDINVC  B                                   03210001
032110                    ,TEXTENT  C                                   03211001
032120                    ,VNT_VND_CPBL D                               03212001
032200              WHERE  A.PO_NBR       =  B.PO_NBR                   03220001
032300                AND  A.INVC_ID      =  B.INVC_ID                  03230001
032310                AND  A.RMIT_VND_ID  =  C.DUN_NBR                  03231001
032320                AND  C.ENT_ID       =  D.ENT_ID                   03232001
032330                AND  D.VND_CPBL_CDE =  'SBS'                      03233001
032400                AND  A.STATUS_CDE   =  'EN'                       03240001
032500                AND  A.INVC_TYP_CDE =  'MI'                       03250001
032600                AND  D.EFF_BEG_DTE <= CURRENT DATE                03260012
032610                AND  D.EFF_END_DTE >= CURRENT DATE                03261012
032700           ORDER BY  A.RMIT_VND_ID                                03270001
032710                    ,A.PO_NBR                                     03271001
032800                    ,A.INVC_ID                                    03280001
032900     END-EXEC.                                                    03290001
033000                                                                  03300001
033100*----------------------------------------------------------------*03310001
033200*    ALLOWANCE CURSOR SELECTS ALLOWANCE INFO FOR PO/INVOICE NBR   03320001
033300*----------------------------------------------------------------*03330001
033400     EXEC SQL                                                     03340001
033500         DECLARE ALLOW_CSR CURSOR FOR                             03350001
033600             SELECT  ALW_CHRG_CDE                                 03360001
033700                    ,ALW_CHRG_AMT                                 03370001
033800                    ,ALW_CHRG_PCT                                 03380001
033900                    ,ALW_CHRG_TYP_CDE                             03390001
034000               FROM  TALCHRG                                      03400001
034100              WHERE  PO_NBR           =  :INVOIC-PO-NBR           03410001
034200                AND  INVC_ID          =  :INVOIC-INVC-ID          03420001
034300                AND  ALW_CHRG_TYP_CDE =  'A'                      03430001
034400     END-EXEC.                                                    03440001
034500                                                                  03450001
036710*----------------------------------------------------------------*03671003
036720*    CHARGE CURSOR SELECT CHARGE INFO FOR PO/INVOICE NBR          03672003
036730*----------------------------------------------------------------*03673003
036740     EXEC SQL                                                     03674003
036750         DECLARE CHARGE_CSR CURSOR FOR                            03675003
036760             SELECT  A.ALW_CHRG_CDE                               03676003
036790                    ,SUM(A.ALW_CHRG_AMT)                          03679003
036791               FROM  TALCHRG  A                                   03679103
036793              WHERE  A.PO_NBR           =  :INVOIC-PO-NBR         03679303
036794                AND  A.INVC_ID          =  :INVOIC-INVC-ID        03679403
036796                AND  A.ALW_CHRG_TYP_CDE =  'C'                    03679603
036797              GROUP BY  A.ALW_CHRG_CDE                            03679703
036802     END-EXEC.                                                    03680203
036803                                                                  03680303
036833*----------------------------------------------------------------*03683317
036834*  WORKING STORAGE AREA FOR SEPHORA CHECKS                        03683417
036835*----------------------------------------------------------------*03683517
036836     COPY APWS021.                                                03683617
036837                                                                  03683717
036840*----------------------------------------------------------------*03684001
036900*    ABEND DATA AREAS                                             03690001
037000*----------------------------------------------------------------*03700001
037100 01  ABEND-CODE                    PIC S9(4)    VALUE ZEROES      03710001
037200                                   COMP         SYNC.             03720001
037300                                                                  03730001
037610     88  AC-TABLE-OVERFLOW                      VALUE  +4004.     03761010
037900     88  AC-DB2-ERROR                           VALUE  +4013.     03790001
038200                                                                  03820001
038300 01  ABEND-AREAS.                                                 03830001
038400     05  AA-ABEND-LIT              PIC  X(40)   VALUE             03840001
038500             '*****       ABEND'.                                 03850001
038600     05  AA-PROGRAM-LIT            PIC  X(40)   VALUE             03860001
038700             '*****   PROGRAM: APKUT383'.                         03870001
038800     05  AA-PARAGRAPH-LIT.                                        03880001
038900         10  FILLER                PIC  X(17)   VALUE             03890001
039000             '***** PARAGRAPH: '.                                 03900001
039100         10  AA-PARAGRAPH-NAME     PIC  X(35)   VALUE SPACES.     03910001
039200     05  AA-MESSAGE-LINE-1.                                       03920001
039300         10  FILLER                PIC  X(06)   VALUE '*****'.    03930001
039400         10  AA-MESSAGE-1          PIC  X(80)   VALUE SPACES.     03940001
039500     05  AA-MESSAGE-LINE-2.                                       03950001
039600         10  FILLER                PIC  X(06)   VALUE '*****'.    03960001
039700         10  AA-MESSAGE-2          PIC  X(80)   VALUE SPACES.     03970001
039800     05  AA-DB2-ERROR-LIT          PIC  X(40)   VALUE             03980001
039900             '*****    DB2 ERROR'.                                03990001
040000     05  AA-DB2-OPERATION-LIT.                                    04000001
040100         10  FILLER                PIC  X(17)   VALUE             04010001
040200             '***** OPERATION: '.                                 04020001
040300         10  AA-DB2-OPERATION.                                    04030001
040400             15  AA-DB2-OP-1       PIC  X(25)   VALUE SPACES.     04040001
040500             15  AA-DB2-OP-2       PIC  X(25)   VALUE SPACES.     04050001
040600     05  AA-DB2-TABLE-1            PIC  X(08)   VALUE SPACES.     04060001
040700     05  AA-DB2-TABLE-2            PIC  X(08)   VALUE SPACES.     04070001
040800                                                                  04080001
040900*----------------------------------------------------------------*04090001
041000*    SQLCA FORMATTED MESSAGE AREA                                 04100001
041100*----------------------------------------------------------------*04110001
041200     COPY DPWS004.                                                04120001
041300                                                                  04130001
041400 01  FILLER                      PIC  X(25)     VALUE             04140001
041500     '** END OF APKUT383 W/S **'.                                 04150001
041600                                                                  04160001
041700*-------------------*                                             04170001
041800 PROCEDURE DIVISION.                                              04180001
041900*-------------------*                                             04190001
042000 A100-MAINLINE.                                                   04200001
042100                                                                  04210001
042200     PERFORM B100-INITIALIZE.                                     04220001
042300                                                                  04230001
042400     PERFORM B200-PROCESS-INVOICES                                04240001
042500       UNTIL END-OF-INVC-CSR.                                     04250001
042600                                                                  04260001
042700     PERFORM B300-END-OF-PROGRAM.                                 04270001
042800                                                                  04280001
042900     GOBACK.                                                      04290001
043000                                                                  04300001
043100                                                                  04310001
043200*----------------------------------------------------------------*04320001
043300*    INITIALIZATION PROCESSING                                    04330001
043400*    - OPEN FILES                                                 04340001
043500*    - INITIALIZE DCLGENS AND SWITCHES                            04350001
043600*    - PERFORM SELECTS                                            04360001
043700*    - OPEN INVOICE CURSOR AND PERFORM FIRST FETCH                04370001
043800*----------------------------------------------------------------*04380001
043900 B100-INITIALIZE.                                                 04390001
044000                                                                  04400001
044100     DISPLAY '**------  APKUT383  (PROCESSING MSGS)  ------**'.   04410001
044200                                                                  04420001
044300     OPEN  OUTPUT  AP-TRANS-FILE                                  04430001
044400                   INVC-STATUS-UPD-FILE.                          04440001
044500                                                                  04450001
044600     INITIALIZE  DCLTAPCNTL                                       04460001
044700                 DCLTINVOIC                                       04470001
044800                 DCLTALCHRG                                       04480001
045100                 DCLTINVCTM                                       04510001
045200                 DCLTMDINVC                                       04520001
045300                 DCLTTRNCDE                                       04530001
045400                 DCLTPOAGMT                                       04540001
045410                 DCLTMDSEAR                                       04541007
045500                 DCLTENTNME                                       04550001
045600                 DCLTEXTENT                                       04560001
045700                 DCLTPAYTRM                                       04570001
045710                 DCLTPURCHS                                       04571010
045800                 PROGRAM-SWITCHES.                                04580001
045900                                                                  04590001
046000     PERFORM S200-GET-CONTROL-INFO.                               04600001
046100     DISPLAY '** BATCH PROCESS DATE: ' APCNTL-BTCH-PRC-DTE.       04610001
046200                                                                  04620001
046300     PERFORM S300-GET-TRNCDE-INFO.                                04630001
046400                                                                  04640001
046401     MOVE PC-PROGRAM-NAME     TO     SA-PROGRAM-NAME.             04640117
046402     PERFORM S100-GET-SEPHORA-DEPT.                               04640217
046403                                                                  04640317
047500     PERFORM X100-OPEN-INVC-CSR.                                  04750001
047600                                                                  04760001
047700     PERFORM S050-FETCH-INVC-CSR.                                 04770001
047800                                                                  04780001
047900     IF END-OF-INVC-CSR                                           04790001
048000        DISPLAY '** NO SEPHORA INVOICES FOUND **'                 04800001
048100     END-IF.                                                      04810001
048200                                                                  04820001
048210*    MOVE INVOIC-RMIT-VND-ID TO PV-HOLD-VND-NBR.                  04821028
048300                                                                  04830001
048400*----------------------------------------------------------------*04840001
048500*    PROCESS INVOICES                                             04850001
048600*    - SELECT DATES AND ACCOUNT NUMBER                            04860001
048700*    - FETCH NEXT ROW                                             04870001
048800*----------------------------------------------------------------*04880001
048900 B200-PROCESS-INVOICES.                                           04890001
049000                                                                  04900001
049110     IF PV-HOLD-VND-NBR = INVOIC-RMIT-VND-ID                      04911002
049111*        **** IS THERE ANY END OF VENDOR PROCESSING?              04911105
049112         CONTINUE                                                 04911202
049113     ELSE                                                         04911302
049114         MOVE INVOIC-RMIT-VND-ID TO PV-HOLD-VND-NBR               04911402
049115         PERFORM S400-GET-ENTITY-INFO                             04911502
049116         MOVE EXTENT-ENT-ID     TO PV-ENT-ID                      04911625
049118     END-IF.                                                      04911828
049120                                                                  04912002
049210     IF PV-HOLD-PO-NBR = INVOIC-PO-NBR                            04921010
049220*        **** IS THERE ANY END OF PO PROCESSING?                  04922010
049230         CONTINUE                                                 04923010
049240     ELSE                                                         04924010
049250         MOVE INVOIC-PO-NBR     TO PV-HOLD-PO-NBR                 04925017
049260         PERFORM S340-GET-PO-INFO                                 04926017
049261         MOVE PURCHS-DEPT-NBR   TO PV-DEPT-NBR                    04926117
049263         PERFORM S500-CHECK-FOR-SEPHORA                           04926317
049296     END-IF.                                                      04929610
049297                                                                  04929710
049801     IF PS-SEPHORA-AT-KOHLS                                       04980117
049810        PERFORM C100-PROCESS-PO-INVC                              04981010
049910     ELSE                                                         04991014
049920*       *  THESE ARE SEPHORA, BUT NOT 'SEPHORA AT KOHLS'          04992015
049921        ADD 1 TO PV-BYPASS-COUNT                                  04992114
049930     END-IF.                                                      04993014
050000                                                                  05000001
050010     PERFORM S050-FETCH-INVC-CSR.                                 05001013
050100                                                                  05010001
050200*----------------------------------------------------------------*05020001
050300*    END OF PROGRAM                                               05030001
050400*    - CLOSE CURSOR, IF OPEN                                      05040001
050500*    - CLOSE FILES                                                05050001
050600*----------------------------------------------------------------*05060001
050700 B300-END-OF-PROGRAM.                                             05070001
050800                                                                  05080001
050900     DISPLAY ' '.                                                 05090001
051000     DISPLAY '*************************************************'. 05100001
051100     DISPLAY '** TOTAL INVOICES READ = ' PV-INVC-CSR-COUNT.       05110001
051200     DISPLAY '*************************************************'. 05120001
051210     DISPLAY '** INVOICES BYPASSED   = ' PV-BYPASS-COUNT.         05121014
051220     DISPLAY '*************************************************'. 05122014
051300     DISPLAY '** TOTAL AP TRANS RECS WRT  = ' PV-AP-TRANS-COUNT.  05130016
051400     DISPLAY '*************************************************'. 05140001
051500     DISPLAY '** TOTAL INVC UPDT RECS WRT = ' PV-INVC-UPD-COUNT.  05150001
051600     DISPLAY '*************************************************'. 05160001
051700     DISPLAY '**         END OF APKUT383 PROCESSING          **'. 05170001
051800     DISPLAY '*************************************************'. 05180001
051900     DISPLAY ' '.                                                 05190001
052000                                                                  05200001
052100     IF INVC-CSR-OPEN                                             05210001
052200        PERFORM Y100-CLOSE-INVC-CSR                               05220001
052300     END-IF                                                       05230001
052400                                                                  05240001
052500     CLOSE AP-TRANS-FILE                                          05250001
052600           INVC-STATUS-UPD-FILE.                                  05260001
052700                                                                  05270001
052800                                                                  05280001
052900*----------------------------------------------------------------*05290001
053000*    PROCESS INVOICE DETAIL                                       05300001
053100*    - GET PAY TERMS                                              05310001
053200*    - PROCESS ALLOWANCES FOR INVOICE                             05320001
053300*    - PROCESS CHARGES FOR INVOICE                                05330001
053400*    - CREATE AP TRANSACTION AND INVOICE STATUS UPDATE RECORDS    05340001
053500*----------------------------------------------------------------*05350001
053600 C100-PROCESS-PO-INVC.                                            05360001
053700                                                                  05370001
053800     PERFORM D100-GET-PAY-TERMS.                                  05380001
053900                                                                  05390001
054000     INITIALIZE APPD052-VARIABLES.                                05400001
054100                                                                  05410001
054200     PERFORM X200-OPEN-ALLOW-CSR.                                 05420001
054300     SET NO-ALLOW-ON-INVC TO TRUE.                                05430001
054400     PERFORM S100-FETCH-ALLOW-CSR.                                05440001
054500     PERFORM UNTIL END-OF-ALLOW-CSR                               05450001
054600         PERFORM E400-CALC-ALW-CHRG                               05460001
054700         PERFORM S100-FETCH-ALLOW-CSR                             05470001
054800     END-PERFORM                                                  05480001
054900     PERFORM Y200-CLOSE-ALLOW-CSR.                                05490001
055000                                                                  05500001
055500     PERFORM X300-OPEN-CHRG-CSR.                                  05501058
055600     PERFORM S150-FETCH-CHRG-CSR.                                 05502058
055710     PERFORM UNTIL END-OF-CHRG-CSR                                05503058
055720*        PERFORM D200-PROCESS-CHRG                                05504058
055730         PERFORM S150-FETCH-CHRG-CSR                              05505058
055800     END-PERFORM.                                                 05506058
055900     PERFORM Y300-CLOSE-CHRG-CSR.                                 05507058
056000                                                                  05508058
055100     PERFORM F100-CREATE-TRANS-REC.                               05510001
055200                                                                  05520001
055300     PERFORM F200-CREATE-INVC-UPD-REC.                            05530001
055400                                                                  05540001
056100                                                                  05610001
056200*----------------------------------------------------------------*05620001
056300*    PROCESS EITHER PO OR INVOICE PAY TERMS                       05630001
056400*    - PERFORM DATE ROUTINE                                       05640001
056500*----------------------------------------------------------------*05650001
056600 D100-GET-PAY-TERMS.                                              05660001
056700                                                                  05670001
056800     IF MDINVC-TERM-SEL-CDE = 'P'                                 05680001
056900        PERFORM E100-PROCESS-PO-TERMS                             05690001
057000     ELSE                                                         05700001
057100        IF MDINVC-TERM-SEL-CDE = 'I'                              05710001
057200           PERFORM E200-PROCESS-INVC-TERMS                        05720001
057300        END-IF                                                    05730001
057400     END-IF                                                       05740001
057500                                                                  05750001
057600     MOVE INVOIC-INVC-DTE          TO APPD051-INVOICE-DATE.       05760001
057700     MOVE PS-END-OF-MONTH-SW       TO APPD051-EOM-IND.            05770001
057800     MOVE ZERO                     TO APPD051-FLOAT-DAYS.         05780021
057900                                                                  05790001
058000     PERFORM E300-CALC-DUE-DATE.                                  05800001
058100                                                                  05810001
058200                                                                  05820001
058300*----------------------------------------------------------------*05830001
058400*    PROCESS ANY CHARGES FOR INVOICE AND WRITE OUT RECORD         05840001
058500*----------------------------------------------------------------*05850001
058600*D200-PROCESS-CHRG.                                               05860052
058700*                                                                 05870052
059621*    MOVE PV-GL-ACCT-NBR      TO AP040-GL-ACCT-NBR.               05962152
059630*    MOVE PV-SUM-ALW-CHRG-AMT TO AP040-GRO-COST-AMT               05963052
059640*                                AP040-NET-COST-AMT.              05964052
059650*    INITIALIZE  AP040-TERM-DISC-PCT                              05965052
059660*                AP040-TERM-DISC-AMT.                             05966052
059670*    IF ALLOW-ON-INVC                                             05967052
059680*       PERFORM E500-CONVERT-INVC-ID                              05968052
059690*    END-IF.                                                      05969052
059700*    PERFORM W100-WRITE-AP-TRANS.                                 05970052
059900*                                                                 05990052
060000*    PERFORM S150-FETCH-CHRG-CSR.                                 06000036
060100                                                                  06010001
060200                                                                  06020001
060300*----------------------------------------------------------------*06030001
060400*    PROCESS PO TERMS AND PREPARE FIELDS FOR DATE ROUTINE         06040001
060500*----------------------------------------------------------------*06050001
060600 E100-PROCESS-PO-TERMS.                                           06060001
060700                                                                  06070001
060800     PERFORM S700-GET-PO-PAY-TERMS.                               06080001
060900                                                                  06090001
061000     IF PAYTRM-DISCOUNT-PCT = ZERO                                06100001
061100         MOVE PAYTRM-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS         06110001
061200     ELSE                                                         06120001
061300         MOVE PAYTRM-DISCOUNT-DAYS-QTY TO APPD051-DISCOUNT-DAYS   06130001
061400     END-IF                                                       06140001
061500                                                                  06150001
061600     IF PAYTRM-DUE-DAY-FR-DTE-TXT = 'EOM'                         06160001
061700         SET END-OF-MONTH TO TRUE                                 06170001
061800     ELSE                                                         06180001
061900         SET NOT-END-OF-MONTH TO TRUE                             06190001
062000     END-IF                                                       06200001
062100                                                                  06210001
062200     MOVE POAGMT-DISC-PAY-DAY-QTY  TO  APPD051-EXTENDED-DAYS.     06220001
062300     MOVE PAYTRM-DISCOUNT-PCT      TO  PV-DISCOUNT-PCT.           06230001
062400                                                                  06240001
062500                                                                  06250001
062600*----------------------------------------------------------------*06260001
062700*    PROCESS INVOICE TERMS AND PREPARE FIELDS FOR DATE ROUTINE    06270001
062800*----------------------------------------------------------------*06280001
062900 E200-PROCESS-INVC-TERMS.                                         06290001
063000                                                                  06300001
063100     PERFORM S800-GET-INVC-PAY-TERMS.                             06310001
063200                                                                  06320001
063300     IF INVCTM-DISC-PCT = ZERO                                    06330001
063400         MOVE INVCTM-NET-DUE-DAY-QTY  TO APPD051-DISCOUNT-DAYS    06340001
063500     ELSE                                                         06350001
063600         MOVE INVCTM-DISC-DUE-DAY-QTY TO APPD051-DISCOUNT-DAYS    06360001
063700     END-IF                                                       06370001
063800                                                                  06380001
063900     IF INVCTM-TERM-TYP-CDE = '02'                                06390001
064000         SET END-OF-MONTH TO TRUE                                 06400001
064100     ELSE                                                         06410001
064200         SET NOT-END-OF-MONTH TO TRUE                             06420001
064300     END-IF                                                       06430001
064400                                                                  06440001
064500     MOVE INVCTM-EXTD-DAYS-QTY  TO  APPD051-EXTENDED-DAYS.        06450001
064600     MOVE INVCTM-DISC-PCT       TO  PV-DISCOUNT-PCT.              06460001
064700                                                                  06470001
064800                                                                  06480001
064900*----------------------------------------------------------------*06490001
065000*    PERFORMS THE COPYBOOK ROUTINE THAT CALCULATES THE PAYMENT    06500001
065100*    DUE DATE                                                     06510001
065200*----------------------------------------------------------------*06520001
065300 E300-CALC-DUE-DATE.                                              06530001
065400                                                                  06540001
065500     PERFORM CALC-PAYMENT-DUE-DATE.                               06550001
065600                                                                  06560001
065700     COPY APPD051.                                                06570001
065800                                                                  06580001
065900                                                                  06590001
066000*----------------------------------------------------------------*06600001
066100*    PERFORMS THE COPYBOOK SUBROUTINE THAT CALCULATES VARIOUS     06610001
066200*    DISCOUNT PERCENTS, DISCOUNT AMOUNTS, AND CHARGES             06620001
066300*----------------------------------------------------------------*06630001
066400 E400-CALC-ALW-CHRG.                                              06640001
066500                                                                  06650001
066600     PERFORM CALC-ALW-CHRG.                                       06660001
066700                                                                  06670001
066800     COPY APPD052.                                                06680001
066900                                                                  06690001
067000                                                                  06700001
067100*---------------------------------------------------------------- 06710001
067200*    CONVERTS THE INVOICE ID FOR THE USE AS THE DOC NUMBER FOR    06720001
067300*    ADJUSTMENTS.  IT LEFT-JUSTIFIES THE NUMBER AND USES THE FIRST06730001
067400*    16 CHARACTERS OF THE INVOICE ID.  THIS IS BECAUSE THE DOC    06740001
067500*    NUMBER IS ONLY 16 CHARACTERS LONG.                           06750001
067600*---------------------------------------------------------------- 06760001
067700*E500-CONVERT-INVC-ID.                                            06770052
067800*                                                                 06780052
067900*    MOVE LENGTH OF INVOIC-INVC-ID  TO  PV-START.                 06790052
068000*                                                                 06800052
068100*    PERFORM                                                      06810052
068200*      UNTIL INVOIC-INVC-ID (PV-START:1) > SPACES OR              06820052
068300*            PV-START = +0                                        06830052
068400*        COMPUTE PV-START = PV-START - 1                          06840052
068500*    END-PERFORM                                                  06850052
068600*                                                                 06860052
068700*    IF PV-START < 14                                             06870051
068800*        STRING INVOIC-INVC-ID DELIMITED BY ' '                   06880051
068900*               PV-ALW-CHRG-CDE DELIMITED BY SIZE                 06890051
069000*          INTO AP040-DOC-NBR                                     06900051
069100*    ELSE                                                         06910051
069200*        SUBTRACT +12 FROM PV-START                               06920051
069300*        STRING INVOIC-INVC-ID (PV-START:13) DELIMITED BY SIZE    06930051
069400*               PV-ALW-CHRG-CDE DELIMITED BY SIZE                 06940051
069500*          INTO AP040-DOC-NBR                                     06950051
069600*    END-IF.                                                      06960051
069700                                                                  06970001
069800                                                                  06980001
069900*----------------------------------------------------------------*06990001
070000*    CREATE AP TRANSACTION RECORD                                 07000001
070100*    - FORMAT RECORD                                              07010001
070200*    - WRITE RECORD                                               07020001
070300*----------------------------------------------------------------*07030001
070400 F100-CREATE-TRANS-REC.                                           07040001
070500                                                                  07050001
070600     INITIALIZE AP040-TRANSACTION-FILE.                           07060001
070700                                                                  07070001
070810     MOVE INVOIC-RMIT-VND-ID       TO AP040-VND-NBR.              07081003
070900     MOVE INVOIC-INVC-ID           TO AP040-DOC-NBR.              07090001
071000     MOVE INVOIC-INVC-DTE          TO AP040-DOC-DTE.              07100001
071100     MOVE '01'                     TO AP040-AP-TRN-CDE.           07110001
071200     MOVE INVOIC-PO-NBR            TO AP040-PO-NBR.               07120001
071300     MOVE PURCHS-DEPT-NBR          TO AP040-DEPT-NBR.             07130049
071320     MOVE PV-GL-ACCT-NBR           TO AP040-GL-ACCT-NBR.          07132029
071400     MOVE TRNCDE-PSTG-TYP-CDE      TO AP040-PSTG-TYP-CDE.         07140001
071500     MOVE 'EXP'                    TO AP040-TRN-TYP-CDE.          07150001
071600     MOVE APCNTL-BTCH-PRC-DTE      TO AP040-ENTR-DTE.             07160001
071700     MOVE '.18-00-00-000000'       TO AP040-ENTR-TME.             07170001
071800     MOVE INVOIC-CRE-BY-USR-ID     TO AP040-ENTR-ID.              07180001
071910     MOVE 'P'                      TO AP040-ORGN-CDE.             07191003
072000     MOVE APCNTL-BTCH-PRC-DTE      TO AP040-INV-CUTOFF-DTE.       07200001
072100     MOVE INVOIC-BAR-CDE           TO AP040-BAR-CDE.              07210001
072200     MOVE APCNTL-BTCH-PRC-DTE      TO AP040-PS-BTCH-DTE.          07220001
072300     MOVE 'PPD'                    TO AP040-PS-BTCH-SRC-CDE.      07230048
072400     MOVE '00'                     TO AP040-PS-BTCH-SEQ-NBR.      07240001
072500     MOVE EXTENT-ENT-ID            TO AP040-ENT-ID.               07250001
072600     MOVE ENTNME-ENT-NAME-DESC     TO AP040-ENT-NME-DESC.         07260001
072700     MOVE PC-STORE-90              TO AP040-STR-NBR.              07270063
072700*    MOVE INVOIC-STR-NBR           TO AP040-STR-NBR.              07271063
072800     MOVE INVOIC-GRO-COST-AMT      TO AP040-GRO-COST-AMT.         07280001
072900     MOVE APPD051-RETURN-DATE-CCYY-MM-DD                          07290001
073000                                   TO AP040-PYMT-DUE-DTE.         07300001
073110     MOVE 'Y'                      TO AP040-AUTO-OTP-PSTG-IND.    07311003
073200     MOVE TRNCDE-AP-PSTG-IND       TO AP040-AP-PSTG-IND.          07320001
073300                                                                  07330013
073400     MOVE PV-DISCOUNT-PCT          TO AP040-TERM-DISC-PCT.        07340001
073500                                                                  07350001
073600     COMPUTE AP040-TERM-DISC-AMT = (AP040-GRO-COST-AMT *          07360001
073700                                    AP040-TERM-DISC-PCT) + .005.  07370001
073800     COMPUTE AP040-NW-STR-DISC-PCT =                              07380001
073900                          APPD052-NEW-STORE-DISC-PCT / 100.       07390001
074000     COMPUTE AP040-TRD-DISC-PCT =                                 07400001
074100                          APPD052-TRADE-DISC-PCT / 100.           07410001
074200     COMPUTE AP040-MOS-DISC-PCT =                                 07420001
074300                          APPD052-MOS-DISC-PCT / 100.             07430001
074400     COMPUTE AP040-ADV-DISC-PCT =                                 07440001
074500                          APPD052-ADV-DISC-PCT / 100.             07450001
074600                                                                  07460001
074700*    REMOVING COOP/ALW/MSC DISCOUNTS                              07470054
074700*    COMPUTE AP040-COOP-DISC-PCT =                                07471054
074800*                         APPD052-COOP-DISC-PCT / 100.            07480054
074900*    COMPUTE AP040-ALW-DISC-PCT =                                 07490054
075000*                         APPD052-ALW-DISC-PCT  / 100.            07500054
075100*    COMPUTE AP040-MSC-DISC-PCT =                                 07510054
075200*                         APPD052-MSC-DISC-PCT  / 100.            07520054
075300     MOVE APPD052-NEW-STORE-AMT  TO AP040-NW-STR-DISC-AMT.        07530001
075400     MOVE APPD052-TRADE-AMT      TO AP040-TRD-DISC-AMT.           07540001
075500     MOVE APPD052-MOS-DISC-AMT   TO AP040-MOS-DISC-AMT.           07550001
075600     MOVE APPD052-ADV-DISC-AMT   TO AP040-ADV-DISC-AMT.           07560001
075600     MOVE PV-FRGT-CHRGS          TO AP040-FRGT-AMT.               07561053
075600     MOVE PV-MISC-CHRGS          TO AP040-MISC-CHRG-AMT.          07562053
075700                                                                  07570001
076100     COMPUTE AP040-NET-COST-AMT = (AP040-GRO-COST-AMT             07610001
076200                           - AP040-TERM-DISC-AMT                  07620001
076300                           - AP040-NW-STR-DISC-AMT                07630001
076400                           - AP040-TRD-DISC-AMT                   07640001
076500                           - AP040-MOS-DISC-AMT                   07650001
076600                           - AP040-ADV-DISC-AMT ).                07660054
074700*    REMOVING COOP/ALW/MSC DISCOUNTS                              07661054
076700*                          - AP040-COOP-DISC-AMT                  07670054
076800*                          - AP040-ALW-DISC-AMT                   07680054
076900*                          - AP040-MSC-DISC-AMT ).                07690054
077000                                                                  07700013
077100     EVALUATE INVOIC-HOLD-IND                                     07710001
077200         WHEN 'Y'                                                 07720001
077300              MOVE 'D' TO AP040-DOC-HLD-CDE                       07730001
077400         WHEN 'N'                                                 07740001
077500              MOVE 'N' TO AP040-DOC-HLD-CDE                       07750001
077600     END-EVALUATE                                                 07760001
077700                                                                  07770001
077800     PERFORM W100-WRITE-AP-TRANS.                                 07780001
077900                                                                  07790001
078000                                                                  07800001
078100*----------------------------------------------------------------*07810001
078200*    CREATE INVOICE STATUS UPDATE RECORD                          07820001
078300*    - FORMAT RECORD                                              07830001
078400*    - WRITE RECORD                                               07840001
078500*----------------------------------------------------------------*07850001
078600 F200-CREATE-INVC-UPD-REC.                                        07860001
078700                                                                  07870001
078800     INITIALIZE AP252-RECORD.                                     07880001
078900                                                                  07890001
079000     MOVE INVOIC-PO-NBR      TO  AP252-PO-NBR.                    07900001
079100     MOVE INVOIC-INVC-ID     TO  AP252-INVOICE-ID.                07910001
079200     MOVE 'PJ'               TO  AP252-NEW-STATUS-CDE.            07920001
079300     MOVE '9999-09-09'       TO  AP252-PAYT-DTE.                  07930001
079400                                                                  07940001
079500     PERFORM W200-WRITE-INVC-UPD.                                 07950001
079600                                                                  07960001
079700                                                                  07970001
079800*----------------------------------------------------------------*07980001
079900*    FETCH THE INVOICE_CSR CURSOR                                 07990001
080000*----------------------------------------------------------------*08000001
080100 S050-FETCH-INVC-CSR.                                             08010001
080200                                                                  08020001
080300     EXEC SQL                                                     08030001
080400          FETCH  INVOICE_CSR                                      08040001
080500           INTO :INVOIC-PO-NBR                                    08050001
080600               ,:INVOIC-INVC-ID                                   08060001
080700               ,:INVOIC-STR-NBR                                   08070001
080800               ,:INVOIC-INVC-DTE                                  08080001
080900               ,:INVOIC-GRO-COST-AMT                              08090001
081000               ,:INVOIC-CRE-DTE                                   08100001
081100               ,:INVOIC-CRE-BY-USR-ID                             08110001
081200               ,:INVOIC-HOLD-IND                                  08120001
081300               ,:INVOIC-BAR-CDE                                   08130001
081310               ,:INVOIC-RMIT-VND-ID                               08131002
081400               ,:MDINVC-IMPRT-CHRG-PRC-CDE                        08140001
081500               ,:MDINVC-TERM-SEL-CDE                              08150001
081600     END-EXEC.                                                    08160001
081700                                                                  08170001
081800     EVALUATE TRUE                                                08180001
081900         WHEN SQLCODE = ZERO                                      08190001
082000             ADD +1 TO PV-INVC-CSR-COUNT                          08200001
082100             SET MORE-INVC-CSR TO TRUE                            08210001
082200                                                                  08220001
082300         WHEN SQLCODE = +100                                      08230001
082400             SET END-OF-INVC-CSR TO TRUE                          08240001
082500                                                                  08250001
082600         WHEN SQLWARN0 NOT = SPACES                               08260001
082700         WHEN SQLCODE  NOT = ZERO                                 08270001
082800             MOVE 'S050-FETCH-INVC-CSR'                           08280001
082900                                 TO AA-PARAGRAPH-NAME             08290001
083000             MOVE 'UNSUCCESSFUL FETCH FROM INVOICE_CSR'           08300001
083100                                 TO AA-DB2-OPERATION              08310001
083200             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                08320001
083300             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                08330001
083400             PERFORM Z999-DB2-ABEND                               08340001
083500                                                                  08350001
083600     END-EVALUATE.                                                08360001
083700                                                                  08370001
083800                                                                  08380001
083900*----------------------------------------------------------------*08390001
084000*    FETCH THE ALLOW_CSR CURSOR                                   08400001
084100*----------------------------------------------------------------*08410001
084200 S100-FETCH-ALLOW-CSR.                                            08420001
084300                                                                  08430001
084400     EXEC SQL                                                     08440001
084500          FETCH  ALLOW_CSR                                        08450001
084600           INTO :ALCHRG-ALW-CHRG-CDE                              08460001
084700               ,:ALCHRG-ALW-CHRG-AMT                              08470001
084800               ,:ALCHRG-ALW-CHRG-PCT                              08480001
084900               ,:ALCHRG-ALW-CHRG-TYP-CDE                          08490001
085000     END-EXEC.                                                    08500001
085100                                                                  08510001
085200     EVALUATE TRUE                                                08520001
085300         WHEN SQLCODE = ZERO                                      08530001
085400             SET ALLOW-ON-INVC  TO TRUE                           08540001
085500             SET MORE-ALLOW-CSR TO TRUE                           08550001
085600                                                                  08560001
085700         WHEN SQLCODE = +100                                      08570001
085800             SET END-OF-ALLOW-CSR TO TRUE                         08580001
085900                                                                  08590001
086000         WHEN SQLWARN0 NOT = SPACES                               08600001
086100         WHEN SQLCODE  NOT = ZERO                                 08610001
086200             MOVE 'S100-FETCH-ALLOW-CSR'                          08620001
086300                                 TO AA-PARAGRAPH-NAME             08630001
086400             MOVE 'UNSUCCESSFUL FETCH FROM ALLOW_CSR'             08640001
086500                                 TO AA-DB2-OPERATION              08650001
086600             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                08660001
086700             MOVE SPACES         TO AA-DB2-TABLE-2                08670001
086800             PERFORM Z999-DB2-ABEND                               08680001
086900                                                                  08690001
087000     END-EVALUATE.                                                08700001
087100                                                                  08710001
087200                                                                  08720001
087300*----------------------------------------------------------------*08730001
087400*    FETCH THE CHARGE_CSR CURSOR                                  08740001
087500*----------------------------------------------------------------*08750001
087600 S150-FETCH-CHRG-CSR.                                             08760001
087700                                                                  08770001
087800     EXEC SQL                                                     08780001
087900          FETCH  CHARGE_CSR                                       08790001
088000           INTO :PV-ALW-CHRG-CDE                                  08800001
088300               ,:PV-SUM-ALW-CHRG-AMT                              08830001
088400     END-EXEC.                                                    08840001
088500                                                                  08850001
088600     EVALUATE TRUE                                                08860001
088700         WHEN SQLCODE = ZERO                                      08870001
088800             SET MORE-CHRG-CSR TO TRUE                            08880001
088800             MOVE PV-ALW-CHRG-CDE    TO PV-CHARGE-CODE            08881052
088800             IF PV-FREIGHT                                        08882052
088800                 ADD PV-SUM-ALW-CHRG-AMT TO PV-FRGT-CHRGS         08883052
088800             ELSE                                                 08884052
088800                 ADD PV-SUM-ALW-CHRG-AMT TO PV-MISC-CHRGS         08884152
088800             END-IF                                               08885052
088900                                                                  08890001
089000         WHEN SQLCODE = +100                                      08900001
089100             SET END-OF-CHRG-CSR TO TRUE                          08910001
089200                                                                  08920001
089300         WHEN SQLWARN0 NOT = SPACES                               08930001
089400         WHEN SQLCODE  NOT = ZERO                                 08940001
089500             MOVE 'S150-FETCH-CHRG-CSR'                           08950001
089600                                 TO AA-PARAGRAPH-NAME             08960001
089700             MOVE 'UNSUCCESSFUL FETCH'                            08970001
089800                                 TO AA-DB2-OPERATION              08980001
089900             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                08990001
090000*            MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                09000002
090100             PERFORM Z999-DB2-ABEND                               09010001
090200                                                                  09020001
090300     END-EVALUATE.                                                09030001
090400                                                                  09040001
090500                                                                  09050001
090600*----------------------------------------------------------------*09060001
090700*    GET BATCH PROCESS DATE                                       09070021
090800*----------------------------------------------------------------*09080001
090900 S200-GET-CONTROL-INFO.                                           09090001
091000                                                                  09100001
091100     EXEC SQL                                                     09110001
091200         SELECT  BTCH_PRC_DTE                                     09120001
091400           INTO  :APCNTL-BTCH-PRC-DTE                             09140001
091600           FROM  TAPCNTL                                          09160001
091700     END-EXEC.                                                    09170001
091800                                                                  09180001
091900     EVALUATE TRUE                                                09190001
092000         WHEN SQLCODE = ZERO                                      09200001
092100             CONTINUE                                             09210001
092200                                                                  09220001
092300         WHEN SQLWARN0 NOT = SPACES                               09230001
092400         WHEN SQLCODE NOT  = ZERO                                 09240001
092500             MOVE 'S200-GET-CONTROL-INFO'                         09250001
092600                                 TO AA-PARAGRAPH-NAME             09260001
092700             MOVE 'UNSUCCESSFUL SELECT'                           09270001
092800                                 TO AA-DB2-OPERATION              09280001
092900             MOVE 'TAPCNTL'      TO AA-DB2-TABLE-1                09290001
093000             MOVE SPACES         TO AA-DB2-TABLE-2                09300001
093100             PERFORM Z999-DB2-ABEND                               09310001
093200                                                                  09320001
093300     END-EVALUATE.                                                09330001
093400                                                                  09340001
093500                                                                  09350001
093600*----------------------------------------------------------------*09360001
093700*    GET TRANCODE INFORMATION                                     09370001
093710*    AP_TRN_CDE '01' = MERCHANDISE PAYMENT - ALL STORES           09371003
093800*----------------------------------------------------------------*09380001
093900 S300-GET-TRNCDE-INFO.                                            09390001
094000                                                                  09400001
094100     EXEC SQL                                                     09410001
094200         SELECT  PSTG_TYP_CDE                                     09420001
094300                ,AP_PSTG_IND                                      09430001
094400           INTO  :TRNCDE-PSTG-TYP-CDE                             09440001
094500                ,:TRNCDE-AP-PSTG-IND                              09450001
094600           FROM  TTRNCDE                                          09460001
094700          WHERE  AP_TRN_CDE = '01'                                09470001
094800          AND CURRENT DATE  BETWEEN EFF_STRT_DTE AND              09480001
094900                                    EFF_END_DTE                   09490001
095000     END-EXEC.                                                    09500001
095100                                                                  09510001
095200     EVALUATE TRUE                                                09520001
095300         WHEN SQLCODE = ZERO                                      09530001
095400             CONTINUE                                             09540001
095500                                                                  09550001
095600         WHEN SQLWARN0 NOT = SPACES                               09560001
095700         WHEN SQLCODE NOT  = ZERO                                 09570001
095800             MOVE 'S300-GET-TRNCDE-INFO'                          09580001
095900                                 TO AA-PARAGRAPH-NAME             09590001
096000             MOVE 'UNSUCCESSFUL SELECT'                           09600001
096100                                 TO AA-DB2-OPERATION              09610001
096200             MOVE 'TTRNCDE'      TO AA-DB2-TABLE-1                09620001
096300             MOVE SPACES         TO AA-DB2-TABLE-2                09630001
096400             PERFORM Z999-DB2-ABEND                               09640001
096500                                                                  09650001
096600     END-EVALUATE.                                                09660001
096610                                                                  09661010
096620                                                                  09662010
096630*----------------------------------------------------------------*09663010
096640*    GET THE DEPT ASSOCIATED WITH THE PO                          09664010
096660*----------------------------------------------------------------*09666010
096670 S340-GET-PO-INFO.                                                09667017
096680                                                                  09668010
096690     EXEC SQL                                                     09669010
096691         SELECT  DEPT_NBR                                         09669110
096693           INTO  :PURCHS-DEPT-NBR                                 09669310
096695           FROM  TPURCHS                                          09669510
096696          WHERE  PO_NBR = :PV-HOLD-PO-NBR                         09669610
096697          AND    VER_STATUS_CDE = 'A'                             09669710
096699     END-EXEC.                                                    09669910
096700                                                                  09670010
096701     EVALUATE TRUE                                                09670110
096702         WHEN SQLCODE = ZERO                                      09670210
096703             CONTINUE                                             09670310
096704                                                                  09670410
096705         WHEN SQLWARN0 NOT = SPACES                               09670510
096706         WHEN SQLCODE NOT  = ZERO                                 09670610
096707             MOVE 'S340-GET-PO-INFO'                              09670717
096708                                 TO AA-PARAGRAPH-NAME             09670810
096709             MOVE 'UNSUCCESSFUL SELECT'                           09670910
096710                                 TO AA-DB2-OPERATION              09671010
096711             MOVE 'TPURCHS'      TO AA-DB2-TABLE-1                09671110
096712             MOVE SPACES         TO AA-DB2-TABLE-2                09671210
096713             PERFORM Z999-DB2-ABEND                               09671310
096714                                                                  09671410
096715     END-EVALUATE.                                                09671510
096720                                                                  09672001
096920*----------------------------------------------------------------*09692001
097000*    GET ENTITY ID AND NAME DESCRIPTION FOR SEPHORA VENDOR        09700001
097100*----------------------------------------------------------------*09710001
097200 S400-GET-ENTITY-INFO.                                            09720001
097300                                                                  09730001
097400     EXEC SQL                                                     09740001
097500         SELECT  A.ENT_ID                                         09750001
097600                ,B.ENT_NAME_DESC                                  09760001
097700           INTO  :EXTENT-ENT-ID                                   09770001
097800                ,:ENTNME-ENT-NAME-DESC                            09780001
097900           FROM  TEXTENT  A                                       09790001
098000                ,TENTNME  B                                       09800001
098100          WHERE  A.ENT_ID    =  B.ENT_ID                          09810001
098200            AND  A.DUN_NBR   =  :PV-HOLD-VND-NBR                  09820004
098300            AND  B.TYPE_CDE  =  '01'                              09830001
098400     END-EXEC.                                                    09840001
098500                                                                  09850001
098600     EVALUATE TRUE                                                09860001
098700         WHEN SQLCODE = ZERO                                      09870001
098800             CONTINUE                                             09880001
098900                                                                  09890001
099000         WHEN SQLWARN0 NOT = SPACES                               09900001
099100         WHEN SQLCODE NOT  = ZERO                                 09910001
099200             MOVE 'S400-GET-ENTITY-INFO'                          09920001
099300                                 TO AA-PARAGRAPH-NAME             09930001
099400             MOVE 'UNSUCCESSFUL SELECT'                           09940001
099500                                 TO AA-DB2-OPERATION              09950001
099600             MOVE 'TEXTENT'      TO AA-DB2-TABLE-1                09960001
099700             MOVE 'TENTNME'      TO AA-DB2-TABLE-2                09970001
099800             PERFORM Z999-DB2-ABEND                               09980001
099900                                                                  09990001
100000     END-EVALUATE.                                                10000001
103600                                                                  10360001
103700                                                                  10370001
107300*----------------------------------------------------------------*10730001
107400*    GET PAYMENT TERMS FOR PO BEING PROCESSED                     10740001
107500*----------------------------------------------------------------*10750001
107600 S700-GET-PO-PAY-TERMS.                                           10760001
107700                                                                  10770001
107800     MOVE INVOIC-PO-NBR  TO  POAGMT-PO-NBR.                       10780001
107900                                                                  10790001
108000     EXEC SQL                                                     10800001
108100         SELECT  PA.DISC_PAY_DAY_QTY                              10810001
108200                ,PT.DISCOUNT_PCT                                  10820001
108300                ,PT.DUE_DAY_QTY                                   10830001
108400                ,PT.DISCOUNT_DAYS_QTY                             10840001
108500                ,PT.DUE_DAY_FR_DTE_TXT                            10850001
108600           INTO  :POAGMT-DISC-PAY-DAY-QTY                         10860001
108700                ,:PAYTRM-DISCOUNT-PCT                             10870001
108800                ,:PAYTRM-DUE-DAY-QTY                              10880001
108900                ,:PAYTRM-DISCOUNT-DAYS-QTY                        10890001
109000                ,:PAYTRM-DUE-DAY-FR-DTE-TXT                       10900001
109100           FROM  TPOAGMT PA                                       10910001
109200                ,TPAYTRM PT                                       10920001
109300          WHERE  PA.PO_NBR         = :POAGMT-PO-NBR               10930001
109400            AND  PA.PAYT_TERM_ID   = PT.PAY_TERM_ID               10940001
109500            AND  PA.AGRMT_TYP_ID   = '2'                          10950001
109600            AND  PA.VER_STATUS_CDE = 'A'                          10960001
109700     END-EXEC.                                                    10970001
109800                                                                  10980001
109900     EVALUATE TRUE                                                10990001
110000         WHEN SQLCODE = ZERO                                      11000001
110100             CONTINUE                                             11010001
110200                                                                  11020001
110300         WHEN SQLWARN0 NOT = SPACES                               11030001
110400         WHEN SQLCODE NOT  = ZERO                                 11040001
110500             MOVE 'S700-GET-PO-PAY-TERMS'                         11050001
110600                                 TO AA-PARAGRAPH-NAME             11060001
110700             MOVE 'UNSUCCESSFUL SELECT'                           11070001
110800                                 TO AA-DB2-OPERATION              11080001
110900             MOVE 'TPOAGMT'      TO AA-DB2-TABLE-1                11090001
111000             MOVE 'TPAYTRM'      TO AA-DB2-TABLE-2                11100001
111100             DISPLAY 'PO NUMBER: ' POAGMT-PO-NBR                  11110001
111200             PERFORM Z999-DB2-ABEND                               11120001
111300                                                                  11130001
111400     END-EVALUATE.                                                11140001
111500                                                                  11150001
111600                                                                  11160001
111700*----------------------------------------------------------------*11170001
111800*    GET INVOICE PAYMENT TERMS, IF THEY EXIST                     11180001
111900*----------------------------------------------------------------*11190001
112000 S800-GET-INVC-PAY-TERMS.                                         11200001
112100                                                                  11210001
112200     MOVE INVOIC-PO-NBR   TO  INVCTM-PO-NBR.                      11220001
112300     MOVE INVOIC-INVC-ID  TO  INVCTM-INVC-ID.                     11230001
112400                                                                  11240001
112500     EXEC SQL                                                     11250001
112600         SELECT  DISC_PCT                                         11260001
112700                ,DISC_DUE_DAY_QTY                                 11270001
112800                ,EXTD_DAYS_QTY                                    11280001
112900                ,TERM_TYP_CDE                                     11290001
113000                ,NET_DUE_DAY_QTY                                  11300001
113100           INTO  :INVCTM-DISC-PCT                                 11310001
113200                ,:INVCTM-DISC-DUE-DAY-QTY                         11320001
113300                ,:INVCTM-EXTD-DAYS-QTY                            11330001
113400                ,:INVCTM-TERM-TYP-CDE                             11340001
113500                ,:INVCTM-NET-DUE-DAY-QTY                          11350001
113600           FROM  TINVCTM                                          11360001
113700          WHERE  PO_NBR        = :INVCTM-PO-NBR                   11370001
113800            AND  INVC_ID       = :INVCTM-INVC-ID                  11380001
113900            AND  TERM_SEQ_NBR  = 1                                11390001
114000     END-EXEC.                                                    11400001
114100                                                                  11410001
114200     EVALUATE TRUE                                                11420001
114300         WHEN SQLCODE = ZERO                                      11430001
114400             CONTINUE                                             11440001
114500                                                                  11450001
114600         WHEN SQLWARN0 NOT = SPACES                               11460001
114700         WHEN SQLCODE NOT  = ZERO                                 11470001
114800             MOVE 'S800-GET-INVC-PAY-TERMS'                       11480001
114900                                 TO AA-PARAGRAPH-NAME             11490001
115000             MOVE 'UNSUCCESSFUL SELECT'                           11500001
115100                                 TO AA-DB2-OPERATION              11510001
115200             MOVE 'TINVCTM'      TO AA-DB2-TABLE-1                11520001
115300             MOVE SPACES         TO AA-DB2-TABLE-2                11530001
115400             DISPLAY 'PO NUMBER: '  INVCTM-PO-NBR                 11540001
115500             DISPLAY 'INVOICE ID: ' INVCTM-INVC-ID                11550001
115600             PERFORM Z999-DB2-ABEND                               11560001
115700                                                                  11570001
115800     END-EVALUATE.                                                11580001
115900                                                                  11590001
116000                                                                  11600001
116100*----------------------------------------------------------------*11610001
116200*    WRITE RECORD TO AP TRANSACTION OUT FILE                      11620001
116300*----------------------------------------------------------------*11630001
116400 W100-WRITE-AP-TRANS.                                             11640001
116500                                                                  11650001
116600     WRITE AP-TRANS-REC  FROM  AP040-TRANSACTION-FILE.            11660001
116700                                                                  11670001
116800     ADD +1 TO PV-AP-TRANS-COUNT.                                 11680001
116900                                                                  11690001
117000                                                                  11700001
117100*----------------------------------------------------------------*11710001
117200*    WRITE RECORD TO INVOICE STATUS UPDATE FILE                   11720001
117300*----------------------------------------------------------------*11730001
117400 W200-WRITE-INVC-UPD.                                             11740001
117500                                                                  11750001
117600     WRITE INVC-STATUS-UPD-REC  FROM  AP252-RECORD.               11760001
117700                                                                  11770001
117800     ADD +1 TO PV-INVC-UPD-COUNT.                                 11780001
117900                                                                  11790001
118000                                                                  11800001
118100*----------------------------------------------------------------*11810001
118200*    OPEN INVOICE_CSR CURSOR                                      11820001
118300*----------------------------------------------------------------*11830001
118400 X100-OPEN-INVC-CSR.                                              11840001
118500                                                                  11850001
118600     EXEC SQL                                                     11860001
118700         OPEN INVOICE_CSR                                         11870001
118800     END-EXEC.                                                    11880001
118900                                                                  11890001
119000     EVALUATE TRUE                                                11900001
119100         WHEN SQLCODE = ZERO                                      11910001
119200             SET INVC-CSR-OPEN TO TRUE                            11920001
119300                                                                  11930001
119400         WHEN SQLWARN0 NOT = SPACES                               11940001
119500         WHEN SQLCODE  NOT = ZERO                                 11950001
119600             MOVE 'X100-OPEN-INVC-CSR'                            11960001
119700                                 TO AA-PARAGRAPH-NAME             11970001
119800             MOVE 'UNSUCCESSFUL OPEN ON INVOICE_CSR'              11980001
119900                                 TO AA-DB2-OPERATION              11990001
120000             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                12000001
120100             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                12010001
120200             PERFORM Z999-DB2-ABEND                               12020001
120300                                                                  12030001
120400     END-EVALUATE.                                                12040001
120500                                                                  12050001
120600                                                                  12060001
120700*----------------------------------------------------------------*12070001
120800*    OPEN ALLOW_CSR CURSOR                                        12080001
120900*----------------------------------------------------------------*12090001
121000 X200-OPEN-ALLOW-CSR.                                             12100001
121100                                                                  12110001
121200     EXEC SQL                                                     12120001
121300         OPEN ALLOW_CSR                                           12130001
121400     END-EXEC.                                                    12140001
121500                                                                  12150001
121600     EVALUATE TRUE                                                12160001
121700         WHEN SQLCODE = ZERO                                      12170001
121800             SET ALLOW-CSR-OPEN TO TRUE                           12180001
121900                                                                  12190001
122000         WHEN SQLWARN0 NOT = SPACES                               12200001
122100         WHEN SQLCODE  NOT = ZERO                                 12210001
122200             MOVE 'X200-OPEN-ALLOW-CSR'                           12220001
122300                                 TO AA-PARAGRAPH-NAME             12230001
122400             MOVE 'UNSUCCESSFUL OPEN ON ALLOW_CSR'                12240001
122500                                 TO AA-DB2-OPERATION              12250001
122600             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                12260001
122700             MOVE SPACES         TO AA-DB2-TABLE-2                12270001
122800             PERFORM Z999-DB2-ABEND                               12280001
122900                                                                  12290001
123000     END-EVALUATE.                                                12300001
123100                                                                  12310001
123200                                                                  12320001
123300*----------------------------------------------------------------*12330001
123400*    OPEN CHARGE_CSR CURSOR                                       12340001
123500*----------------------------------------------------------------*12350001
123600 X300-OPEN-CHRG-CSR.                                              12360001
123700                                                                  12370001
123800     EXEC SQL                                                     12380001
123900         OPEN CHARGE_CSR                                          12390001
124000     END-EXEC.                                                    12400001
124100                                                                  12410001
124200     EVALUATE TRUE                                                12420001
124300         WHEN SQLCODE = ZERO                                      12430001
124400             SET CHRG-CSR-OPEN TO TRUE                            12440001
124400             MOVE 0            TO PV-FRGT-CHRGS                   12441052
124400             MOVE 0            TO PV-MISC-CHRGS                   12442052
124500                                                                  12450001
124600         WHEN SQLWARN0 NOT = SPACES                               12460001
124700         WHEN SQLCODE  NOT = ZERO                                 12470001
124800             MOVE 'X300-OPEN-CHRG-CSR'                            12480001
124900                                 TO AA-PARAGRAPH-NAME             12490001
125000             MOVE 'UNSUCCESSFUL OPEN ON CHARGE_CSR'               12500001
125100                                 TO AA-DB2-OPERATION              12510001
125200             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                12520001
125300*            MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                12530002
125400             PERFORM Z999-DB2-ABEND                               12540001
125500                                                                  12550001
125600     END-EVALUATE.                                                12560001
125700                                                                  12570001
125800                                                                  12580001
125900*----------------------------------------------------------------*12590001
126000*    CLOSE THE INVOICE_CSR CURSOR                                 12600001
126100*----------------------------------------------------------------*12610001
126200 Y100-CLOSE-INVC-CSR.                                             12620001
126300                                                                  12630001
126400     EXEC SQL                                                     12640001
126500         CLOSE INVOICE_CSR                                        12650001
126600     END-EXEC.                                                    12660001
126700                                                                  12670001
126800     EVALUATE TRUE                                                12680001
126900         WHEN SQLCODE = ZERO                                      12690001
127000             SET INVC-CSR-CLOSED TO TRUE                          12700001
127100                                                                  12710001
127200         WHEN SQLWARN0 NOT = SPACES                               12720001
127300         WHEN SQLCODE  NOT = ZERO                                 12730001
127400             MOVE 'Y100-CLOSE-INVC-CSR'                           12740001
127500                                 TO AA-PARAGRAPH-NAME             12750001
127600             MOVE 'UNSUCCESSFUL CLOSE ON INVOICE_CSR'             12760001
127700                                 TO AA-DB2-OPERATION              12770001
127800             MOVE 'TINVOIC'      TO AA-DB2-TABLE-1                12780001
127900             MOVE 'TMDINVC'      TO AA-DB2-TABLE-2                12790001
128000             PERFORM Z999-DB2-ABEND                               12800001
128100                                                                  12810001
128200       END-EVALUATE.                                              12820001
128300                                                                  12830001
128400                                                                  12840001
128500*----------------------------------------------------------------*12850001
128600*    CLOSE THE ALLOW_CSR CURSOR                                   12860001
128700*----------------------------------------------------------------*12870001
128800 Y200-CLOSE-ALLOW-CSR.                                            12880001
128900                                                                  12890001
129000     EXEC SQL                                                     12900001
129100         CLOSE ALLOW_CSR                                          12910001
129200     END-EXEC.                                                    12920001
129300                                                                  12930001
129400     EVALUATE TRUE                                                12940001
129500         WHEN SQLCODE = ZERO                                      12950001
129600             SET ALLOW-CSR-CLOSED TO TRUE                         12960001
129700                                                                  12970001
129800         WHEN SQLWARN0 NOT = SPACES                               12980001
129900         WHEN SQLCODE  NOT = ZERO                                 12990001
130000             MOVE 'Y200-CLOSE-ALLOW-CSR'                          13000001
130100                                 TO AA-PARAGRAPH-NAME             13010001
130200             MOVE 'UNSUCCESSFUL CLOSE ON ALLOW_CSR'               13020001
130300                                 TO AA-DB2-OPERATION              13030001
130400             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                13040001
130500             MOVE SPACES         TO AA-DB2-TABLE-2                13050001
130600             PERFORM Z999-DB2-ABEND                               13060001
130700                                                                  13070001
130800       END-EVALUATE.                                              13080001
130900                                                                  13090001
131000                                                                  13100001
131100*----------------------------------------------------------------*13110001
131200*    CLOSE THE CHARGE_CSR CURSOR                                  13120001
131300*----------------------------------------------------------------*13130001
131400 Y300-CLOSE-CHRG-CSR.                                             13140001
131500                                                                  13150001
131600     EXEC SQL                                                     13160001
131700         CLOSE CHARGE_CSR                                         13170001
131800     END-EXEC.                                                    13180001
131900                                                                  13190001
132000     EVALUATE TRUE                                                13200001
132100         WHEN SQLCODE = ZERO                                      13210001
132200             SET CHRG-CSR-CLOSED TO TRUE                          13220001
132300                                                                  13230001
132400         WHEN SQLWARN0 NOT = SPACES                               13240001
132500         WHEN SQLCODE  NOT = ZERO                                 13250001
132600             MOVE 'Y300-CLOSE-CHRG-CSR'                           13260001
132700                                 TO AA-PARAGRAPH-NAME             13270001
132800             MOVE 'UNSUCCESSFUL CLOSE ON CHARGE_CSR'              13280001
132900                                 TO AA-DB2-OPERATION              13290001
133000             MOVE 'TALCHRG'      TO AA-DB2-TABLE-1                13300001
133100*            MOVE 'TACCTYP'      TO AA-DB2-TABLE-2                13310002
133200             PERFORM Z999-DB2-ABEND                               13320001
133300                                                                  13330001
133400       END-EVALUATE.                                              13340001
133500                                                                  13350001
133600                                                                  13360001
133842*----------------------------------------------------------------*13384210
133850*    DB2 ABEND ROUTINE                                            13385001
133900*----------------------------------------------------------------*13390001
134000 Z999-DB2-ABEND.                                                  13400001
134100                                                                  13410001
134200     CLOSE AP-TRANS-FILE                                          13420001
134300           INVC-STATUS-UPD-FILE.                                  13430001
134400                                                                  13440001
134500     DISPLAY AA-ABEND-LIT.                                        13450001
134600     DISPLAY AA-MESSAGE-LINE-1.                                   13460001
134700     DISPLAY AA-MESSAGE-LINE-2.                                   13470001
134800     DISPLAY AA-DB2-ERROR-LIT.                                    13480001
134900     DISPLAY AA-PROGRAM-LIT.                                      13490001
135000     DISPLAY AA-PARAGRAPH-LIT.                                    13500001
135100     DISPLAY AA-DB2-OPERATION-LIT.                                13510001
135200     DISPLAY AA-DB2-TABLE-1.                                      13520001
135300     DISPLAY AA-DB2-TABLE-2.                                      13530001
135400     SET AC-DB2-ERROR TO TRUE.                                    13540001
135500                                                                  13550001
135600     COPY DPPD004.                                                13560001
135700                                                                  13570001
135800     CALL 'ILBOABN0' USING ABEND-CODE.                            13580001
135900                                                                  13590001
135910*----------------------------------------------------------------*13591017
135920*    PROCEDURE DIVISION COPYBOOK FOR SEPHORA CHECKS               13592017
135930*----------------------------------------------------------------*13593017
136000     COPY APPD021.                                                13600018
