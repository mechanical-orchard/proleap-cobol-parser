000100 IDENTIFICATION DIVISION.                                         00010014
000200 PROGRAM-ID.     VNKUT100.                                        00020015
000300 AUTHOR.         BRIAN HASSLINGER.                                00030014
000400 DATE-WRITTEN.   JULY 2002.                                       00040014
000500*************************************************************     00050014
000600*    COBOL 2                                                *     00060014
000700*                                                           *     00070014
000800*  THE PURPOSE OF THIS PROGRAM IS TO PRODUCE AN EXTRACT FILE*     00080027
000900*  CONTAINING INFORMATION FROM THE EXTERNAL ENTITY TABLE    *     00090029
001000*  AND THE ENTITY NAME TABLE. IT WILL BE USED BY ANYONE THAT*     00100021
001100*  IS OUTSIDE THE FINANCIAL DOMAIN AND WANTS TO REPRODUCE   *     00110027
001200*  THE EXTERNAL ENTITY AND ENTITY NAME TABLE DATA.          *     00120027
001300*                                                           *     00130014
001400*************************************************************     00140014
001500*                                                           *     00150014
001600* DB2 TABLES:                                               *     00160014
001700*  1. EXTERNAL ENTITY TABLE            (TEXTENT)            *     00170014
001800*  2. ENTITY NAME TABLE                (TENTNME)            *     00180014
001900*                                                           *     00190014
002000* OUTPUT:                                                   *     00200014
002100*  1. VENDOR EXTRACT FILE              (VNRD100)            *     00210023
002200*************************************************************     00220014
002300* CHANGE LOG:                                               *     00230014
002400*                                                           *     00240014
002500* 07/24/02    CHANGE: INTIAL VERSION                        *     00250028
002600*             BY: BRIAN HASSLINGER          WR/IR#: WR23862 *     00260024
002610*                                                           *     00261033
002620* 05/24/04    CHANGE: ADD FOUR COLUMNS TO EXTRACT OUTPUT    *     00262034
002630*             FILE.                                         *     00263034
002640*             BY: PAUL OMAN                 WR/IR#: WR26951 *     00264038
002641*                                                           *     00264140
002680* 06/13/05                                                  *     00268044
002681*     CHANGE MADE: ADDED THE FIELDS VN100-PRTNR-TYP-CDE,    *     00268144
002690*     VN100-SCAC-CDE, VN100-CFY-SLSRNK-NBR,                 *     00269044
002691*     VN100-PFY-SLSRNK-NBR, VN100-P12MN-SLSRNK-NBR,         *     00269144
002692*     VN100-EDI-PO-PREPK-CDE, AND VN100-SHRT-VND-NM TO THE  *     00269244
002693*     COPYBOOK VNRD100. ALSO ADDED THE 88 LEVEL FIELDS      *     00269344
002694*     VN100-PARTNER AND VN100-KOHLS-EMPLOYEE UNDER          *     00269444
002695*     VN100-PRIM-TYP-CDE.  INCLUDED THE COLUMNS             *     00269544
002697*     PRTNR_TYP_CDE, SCAC_CDE, CFY_SLSRNK_NBR,              *     00269744
002698*     PFY_SLSRNK_NBR, P12MN_SLSRNK_NBR, EDI_PO_PREPK_CDE,   *     00269854
002699*     PRTNR_IND, AND VND_CLSN_CDE IN THE SELECT OF THE      *     00269954
002700*     VENDOR_CSR CURSOR AND ADDED LOGIC TO PARAGRAPH B200-  *     00270054
002701*     TO MOVE THESE FIELDS TO THE CORRESPONDING VN100-      *     00270154
002702*     COPYBOOK FIELDS.  CREATED PARAGRAPH S100- TO SELECT   *     00270254
002703*     THE VENDOR NAME FROM THE TENTNME TABLE.               *     00270354
002705*     MADE BY: KRYSTEN LEARY              WR/IR#: WR28905   *     00270545
002710*************************************************************     00271014
002800                                                                  00280014
002900 ENVIRONMENT DIVISION.                                            00290014
003000                                                                  00300014
003100 INPUT-OUTPUT SECTION.                                            00310014
003200                                                                  00320014
003300 FILE-CONTROL.                                                    00330014
003400     SELECT VENDOR-EXTRACT-FILE           ASSIGN TO OUT01.        00340018
003500                                                                  00350014
003600 DATA DIVISION.                                                   00360014
003700                                                                  00370014
003800 FILE SECTION.                                                    00380014
003900 FD  VENDOR-EXTRACT-FILE                                          00390018
004000     RECORDING MODE IS F                                          00400014
004100     LABEL RECORDS ARE STANDARD                                   00410014
004200     DATA RECORD IS VENDOR-EXTRACT-REC.                           00420018
004300 01  VENDOR-EXTRACT-REC           PIC  X(150).                    00430018
004400                                                                  00440014
004500 WORKING-STORAGE SECTION.                                         00450014
004600                                                                  00460014
004700 01  FILLER                        PIC X(25)  VALUE               00470014
004800                             'WS FOR VNKUT100 BEGINS==>'.         00480015
004900                                                                  00490014
005000 01  WS-RETRY-COUNTER              PIC S9(4)  COMP VALUE ZERO.    00500014
005100 01  WS-RETRY-MAX                  PIC S9(4)  COMP VALUE 3.       00510014
005200                                                                  00520014
005300 01  PS-SWITCH-AREA.                                              00530014
005400     05  WS-END-OF-CURSOR-SW           PIC X(1)   VALUE 'N'.      00540023
005500         88  WS-END-OF-VENDOR-CSR                 VALUE 'Y'.      00550021
005600                                                                  00560014
005700 01  WS-PROGRAM-COUNTERS.                                         00570014
005800     05  WS-VENDOR-ROWS-FETCHED    PIC  9(09) VALUE ZEROS.        00580023
005900     05  WS-EXTRACT-WRITTEN        PIC  9(09) VALUE ZEROS.        00590023
006000                                                                  00600014
006100                                                                  00610015
006200*---------------------------------------------------------------* 00620015
006300* SQLA MESSAGE MODULE                                             00630015
006400*---------------------------------------------------------------* 00640015
006500     COPY DPWS004.                                                00650029
006600                                                                  00660014
006700*---------------------------------------------------------------* 00670015
006800*  OUTPUT FILE COPY BOOK                                          00680015
006900*---------------------------------------------------------------* 00690015
007000     COPY VNRD100.                                                00700029
007100                                                                  00710015
007200 01  WS-ABEND-FIELDS.                                             00720014
007300     05  WS-ABEND-PROGRAM          PIC X(8)   VALUE 'VNKUT100'.   00730015
007400     05  WS-ABEND-PARAGRAPH        PIC X(50)  VALUE SPACES.       00740014
007500     05  WS-ABEND-OPERATION        PIC X(50)  VALUE SPACES.       00750014
007600     05  WS-ABEND-STRUCTURE-1      PIC X(8)   VALUE SPACES.       00760014
007700     05  WS-ABEND-STRUCTURE-2      PIC X(8)   VALUE SPACES.       00770014
007800     05  WS-ABEND-STATUS           PIC XX     VALUE SPACES.       00780014
007900                                                                  00790014
008000 01  ABEND-CODE                    PIC S9(4)  COMP SYNC           00800014
008100                                              VALUE ZEROS.        00810014
008200     88 AP-TABLE-FULL              VALUE +4004.                   00820014
008300     88 AP-EMPTY-FILE              VALUE +4005.                   00830014
008400     88 AP-DB2-ERROR               VALUE +4013.                   00840014
008500                                                                  00850014
008600*---------------------------------------------------------------* 00860023
008700*  COMMUNICATIONS AREA2 FOR DB2                                   00870014
008800*---------------------------------------------------------------* 00880023
008900     COPY SQLCA2.                                                 00890029
009000                                                                  00900014
009100*---------------------------------------------------------------* 00910014
009200* SQL COMMUNICATIONS AREA DCLGEN                                  00920014
009300*---------------------------------------------------------------* 00930014
009400     EXEC SQL                                                     00940014
009500          INCLUDE SQLCA                                           00950014
009600     END-EXEC.                                                    00960014
009700                                                                  00970014
009800*---------------------------------------------------------------* 00980014
009900* ENTITY NAME TABLE                                               00990014
010000*---------------------------------------------------------------* 01000014
010100     EXEC SQL                                                     01010014
010200          INCLUDE TENTNME                                         01020014
010300     END-EXEC.                                                    01030014
010400                                                                  01040014
010500*---------------------------------------------------------------* 01050014
010600* EXTERNAL ENTITY TABLE                                           01060014
010700*---------------------------------------------------------------* 01070014
010800     EXEC SQL                                                     01080014
010900          INCLUDE TEXTENT                                         01090014
011000     END-EXEC.                                                    01100014
011100                                                                  01110014
011200                                                                  01120014
011300*--------------------------------------------------------------*  01130023
011400*   THIS IS THE CURSOR THAT RETREIVES THE VENDOR INFORMATION   *  01140023
011500*   NEEDED FOR THE EXTRACT FILE.                               *  01150023
011600*--------------------------------------------------------------*  01160023
011700     EXEC SQL                                                     01170014
011800        DECLARE VENDOR_CSR CURSOR FOR                             01180018
011900          SELECT A.ENT_ID                                         01190014
012000                ,A.DUN_NBR                                        01200014
012100                ,A.PRIM_TYP_CDE                                   01210015
012200                ,B.ENT_NAME_DESC                                  01220016
012300                ,A.STATUS_CDE                                     01230015
012400                ,A.CRE_TMST                                       01240015
012500                ,A.LAST_UPD_TMST                                  01250015
012510                ,A.NDA_IND                                        01251035
012520                ,A.PRNT_CO_ENT_ID                                 01252035
012530                ,A.PRNT_CO_IND                                    01253035
012540                ,A.PRTNR_TYP_CDE                                  01254041
012550                ,A.SCAC_CDE                                       01255045
012560                ,A.CFY_SLSRNK_NBR                                 01256042
012570                ,A.PFY_SLSRNK_NBR                                 01257042
012580                ,A.P12MN_SLSRNK_NBR                               01258042
012590                ,A.EDI_PO_PREPK_CDE                               01259042
012591                ,A.PRTNR_IND                                      01259143
012592                ,A.VND_CLSN_CDE                                   01259243
012600          FROM TEXTENT   A                                        01260014
012700              ,TENTNME   B                                        01270015
012800          WHERE A.ENT_ID   = B.ENT_ID                             01280015
012900            AND B.TYPE_CDE = '01'                                 01290015
013000          ORDER BY A.ENT_ID                                       01300014
013100     END-EXEC.                                                    01310014
013200                                                                  01320014
013300 01  FILLER                        PIC X(25) VALUE                01330014
013400          '<====WS FOR VNKUT100 ENDS'.                            01340015
013500                                                                  01350014
013600 PROCEDURE DIVISION.                                              01360014
013700                                                                  01370023
013800 A100-MAINLINE.                                                   01380014
013900                                                                  01390014
014000     PERFORM B100-INITIALIZATION.                                 01400023
014100                                                                  01410014
014200     PERFORM B200-CREATE-VENDOR-EXTRACT                           01420023
014300       UNTIL WS-END-OF-VENDOR-CSR.                                01430023
014400                                                                  01440014
014500     PERFORM B300-END-OF-JOB.                                     01450014
014600                                                                  01460014
014700     GOBACK.                                                      01470023
014800        EJECT                                                     01480014
014900                                                                  01490014
015000*---------------------------------------------------------------* 01500023
015100*  INITIALIZATION AND FETCH THE FIRST RECORD FROM THE             01510014
015200*  VENDOR CURSOR.                                                 01520020
015300*---------------------------------------------------------------* 01530023
015400 B100-INITIALIZATION.                                             01540023
015500                                                                  01550014
015600     DISPLAY '**********************************'                 01560014
015700     DISPLAY '*   STARTING PROGRAM VNKUT100    *'                 01570015
015800     DISPLAY '**********************************'                 01580014
015900                                                                  01590014
016000     OPEN OUTPUT VENDOR-EXTRACT-FILE.                             01600018
016100                                                                  01610014
016200     INITIALIZE DCLTEXTENT                                        01620014
016300                DCLTENTNME.                                       01630014
016400                                                                  01640014
016500     PERFORM Y100-OPEN-VENDOR-CSR.                                01650020
016600                                                                  01660014
016700     PERFORM R100-FETCH-VENDOR-CSR.                               01670022
016800                                                                  01680014
016900     IF WS-END-OF-VENDOR-CSR                                      01690021
017000        DISPLAY '**********************************'              01700014
017100        DISPLAY '*   PROGRAM ** = VNKUT100        *'              01710015
017200        DISPLAY '**********************************'              01720014
017300        DISPLAY '* NO ROWS WERE SELECTED FROM     *'              01730014
017400        DISPLAY '* THE VENDOR CURSOR.             *'              01740025
017500        DISPLAY '**********************************'              01750014
017600     END-IF.                                                      01760014
017700                                                                  01770014
017800*----------------------------------------------------------------*01780023
017900*  CREATE A VENDOR EXTRACT RECORD FOR EACH ROW RETRIEVED FROM    *01790023
018000*  THE VENDOR CURSOR.                                            *01800023
018100*----------------------------------------------------------------*01810023
018200 B200-CREATE-VENDOR-EXTRACT.                                      01820023
018300                                                                  01830014
018310     INITIALIZE VN100-VENDOR-EXTRACT-RECD.                        01831053
018400     MOVE EXTENT-ENT-ID            TO VN100-ENT-ID                01840031
018410                                      VN100-ENT-ID-CHAR.          01841037
018500     MOVE EXTENT-DUN-NBR           TO VN100-VND-NBR.              01850018
018510     IF EXTENT-PRIM-TYP-CDE = 'E'                                 01851047
018512        IF EXTENT-PRTNR-IND = 'Y'                                 01851247
018514           SET VN100-PARTNER           TO TRUE                    01851449
018515        ELSE                                                      01851550
018516           MOVE EXTENT-PRIM-TYP-CDE    TO VN100-PRIM-TYP-CDE      01851650
018518        END-IF                                                    01851848
018519        IF EXTENT-VND-CLSN-CDE = 'E'                              01851948
018520           SET VN100-KOHLS-EMPLOYEE    TO TRUE                    01852049
018523        END-IF                                                    01852348
018529     ELSE                                                         01852947
018530        MOVE EXTENT-PRIM-TYP-CDE       TO VN100-PRIM-TYP-CDE      01853049
018540     END-IF.                                                      01854047
018700     MOVE ENTNME-ENT-NAME-DESC     TO VN100-PRIMARY-NAME.         01870018
018800     MOVE EXTENT-STATUS-CDE        TO VN100-STATUS-CDE.           01880018
018900     MOVE EXTENT-CRE-TMST          TO VN100-CRE-TMST.             01890018
019000     MOVE EXTENT-LAST-UPD-TMST     TO VN100-LAST-UPD-TMST.        01900018
019010     MOVE EXTENT-ENT-ID            TO VN100-ENT-ID-CHAR.          01901035
019011     MOVE EXTENT-NDA-IND           TO VN100-NDA-IND.              01901135
019020     MOVE EXTENT-PRNT-CO-ENT-ID    TO VN100-PRNT-CO-ENT-ID-CHAR.  01902035
019030     MOVE EXTENT-PRNT-CO-IND       TO VN100-PRNT-CO-IND.          01903035
019040     MOVE EXTENT-PRTNR-TYP-CDE     TO VN100-PRTNR-TYP-CDE.        01904041
019050     MOVE EXTENT-SCAC-CDE          TO VN100-SCAC-CDE.             01905042
019060     MOVE EXTENT-CFY-SLSRNK-NBR    TO VN100-CFY-SLSRNK-NBR.       01906042
019070     MOVE EXTENT-PFY-SLSRNK-NBR    TO VN100-PFY-SLSRNK-NBR.       01907042
019100     MOVE EXTENT-P12MN-SLSRNK-NBR  TO VN100-P12MN-SLSRNK-NBR.     01910042
019110     MOVE EXTENT-EDI-PO-PREPK-CDE  TO VN100-EDI-PO-PREPK-CDE.     01911042
019120                                                                  01912043
019122     PERFORM S100-SELECT-VEND-NME.                                01912243
019130                                                                  01913042
019200     PERFORM W100-WRITE-VENDOR-REC.                               01920020
019300                                                                  01930014
019400     PERFORM R100-FETCH-VENDOR-CSR.                               01940022
019500                                                                  01950014
019700*----------------------------------------------------------------*01970023
019800*  END OF PROGRAM PROCESSING.                                     01980014
019900*----------------------------------------------------------------*01990023
020000 B300-END-OF-JOB.                                                 02000014
020100                                                                  02010014
020200     PERFORM Y200-CLOSE-VENDOR-CSR.                               02020020
020300                                                                  02030014
020400     CLOSE VENDOR-EXTRACT-FILE.                                   02040018
020500                                                                  02050014
020600     DISPLAY 'VENDOR ROWS FETCHED = ' WS-VENDOR-ROWS-FETCHED.     02060023
020700     DISPLAY 'EXTRACT RECORDS WRITTEN = ' WS-EXTRACT-WRITTEN.     02070023
020800                                                                  02080014
020900     DISPLAY ' PROGRAM VNKUT100 ENDS NORMALLY '.                  02090015
021000                                                                  02100014
021100*----------------------------------------------------------------*02110023
021200*  FETCH THE NEXT ROW FROM THE VENDOR CURSOR.                     02120023
021300*----------------------------------------------------------------*02130023
021400 R100-FETCH-VENDOR-CSR.                                           02140022
021500                                                                  02150014
021600        EXEC SQL                                                  02160014
021700            FETCH VENDOR_CSR                                      02170018
021800             INTO :EXTENT-ENT-ID                                  02180018
021900                 ,:EXTENT-DUN-NBR                                 02190018
022000                 ,:EXTENT-PRIM-TYP-CDE                            02200018
022100                 ,:ENTNME-ENT-NAME-DESC                           02210018
022200                 ,:EXTENT-STATUS-CDE                              02220018
022300                 ,:EXTENT-CRE-TMST                                02230018
022400                 ,:EXTENT-LAST-UPD-TMST                           02240018
022410                 ,:EXTENT-NDA-IND                                 02241035
022420                 ,:EXTENT-PRNT-CO-ENT-ID                          02242035
022430                 ,:EXTENT-PRNT-CO-IND                             02243035
022440                 ,:EXTENT-PRTNR-TYP-CDE                           02244041
022450                 ,:EXTENT-SCAC-CDE                                02245045
022460                 ,:EXTENT-CFY-SLSRNK-NBR                          02246045
022470                 ,:EXTENT-PFY-SLSRNK-NBR                          02247045
022480                 ,:EXTENT-P12MN-SLSRNK-NBR                        02248045
022490                 ,:EXTENT-EDI-PO-PREPK-CDE                        02249045
022491                 ,:EXTENT-PRTNR-IND                               02249145
022492                 ,:EXTENT-VND-CLSN-CDE                            02249245
022500        END-EXEC.                                                 02250014
022600                                                                  02260014
022700        EVALUATE TRUE                                             02270014
022800            WHEN SQLCODE = ZERO                                   02280014
022900                 ADD 1                 TO WS-VENDOR-ROWS-FETCHED  02290042
023000            WHEN SQLCODE = +100                                   02300014
023100                 SET WS-END-OF-VENDOR-CSR TO TRUE                 02310021
023200            WHEN SQLWARN0 NOT = SPACES                            02320014
023300            WHEN SQLCODE  NOT = ZERO                              02330014
023400              MOVE 'R100-FETCH-VENDOR-CSR        '                02340022
023500                              TO WS-ABEND-PARAGRAPH               02350014
023600              MOVE 'UNSUCCESSFUL FETCH '                          02360014
023700                              TO WS-ABEND-OPERATION               02370014
023800              MOVE 'TEXTENT'  TO WS-ABEND-STRUCTURE-1             02380014
023900              MOVE 'TENTNME ' TO WS-ABEND-STRUCTURE-2             02390014
024000              PERFORM Z999-SQL-ERROR                              02400014
024100        END-EVALUATE.                                             02410014
024200                                                                  02420014
024310*----------------------------------------------------------------*02431042
024320*  SELECT VENDOR SHORT NAME                                       02432042
024330*----------------------------------------------------------------*02433042
024331 S100-SELECT-VEND-NME.                                            02433142
024332                                                                  02433242
024333     EXEC SQL                                                     02433342
024334       SELECT ENT_NAME_DESC                                       02433442
024335         INTO :ENTNME-ENT-NAME-DESC                               02433543
024336         FROM TENTNME                                             02433642
024337        WHERE ENT_ID = :EXTENT-ENT-ID                             02433742
024338          AND TYPE_CDE = '04'                                     02433842
024339     END-EXEC.                                                    02433942
024340                                                                  02434042
024341     EVALUATE TRUE                                                02434142
024342       WHEN SQLCODE = ZERO                                        02434243
024343          MOVE ENTNME-ENT-NAME-DESC(1:10) TO VN100-SHRT-VND-NM    02434346
024344       WHEN SQLCODE = +100                                        02434443
024345          CONTINUE                                                02434543
024346       WHEN SQLWARN0 NOT = SPACE                                  02434643
024347       WHEN SQLCODE NOT = ZERO                                    02434745
024348          MOVE 'S100-SELECT-VEND-NME'   TO WS-ABEND-PARAGRAPH     02434843
024349          MOVE 'UNSUCCESSFUL SELECT'    TO WS-ABEND-OPERATION     02434943
024351          MOVE 'TENTNME'                TO WS-ABEND-STRUCTURE-1   02435143
024352          MOVE SPACES                   TO WS-ABEND-STRUCTURE-2   02435243
024353          PERFORM Z999-SQL-ERROR                                  02435343
024354     END-EVALUATE.                                                02435442
024360                                                                  02436042
024400*----------------------------------------------------------------*02440023
024500*  WRITE THE VENDOR RECORD TO THE OUTPUT FILE.                    02450020
024600*----------------------------------------------------------------*02460023
024700 W100-WRITE-VENDOR-REC.                                           02470020
024800                                                                  02480014
024900     WRITE VENDOR-EXTRACT-REC FROM VN100-VENDOR-EXTRACT-RECD.     02490018
025000                                                                  02500014
025100     ADD 1 TO WS-EXTRACT-WRITTEN.                                 02510023
025200 EJECT                                                            02520023
025300*----------------------------------------------------------------*02530023
025400*  OPEN VENDOR CURSOR                                             02540020
025500*----------------------------------------------------------------*02550023
025600 Y100-OPEN-VENDOR-CSR.                                            02560020
025700                                                                  02570014
025800     PERFORM WITH TEST AFTER                                      02580014
025900        VARYING WS-RETRY-COUNTER FROM 1 BY 1                      02590023
026000          UNTIL WS-RETRY-COUNTER > WS-RETRY-MAX                   02600023
026100             OR SQLCODE = ZERO                                    02610023
026200                                                                  02620014
026300         EXEC SQL                                                 02630023
026400            OPEN VENDOR_CSR                                       02640023
026500         END-EXEC                                                 02650023
026600                                                                  02660023
026700         EVALUATE TRUE                                            02670023
026800             WHEN SQLCODE = ZERO                                  02680023
026900                  CONTINUE                                        02690023
027000             WHEN SQLCODE = -904                                  02700023
027100             WHEN SQLCODE = -913                                  02710023
027200                  CONTINUE                                        02720023
027300             WHEN SQLWARN0 NOT = SPACES                           02730023
027400             WHEN SQLCODE  NOT = ZERO                             02740023
027500                  MOVE 'Y100-OPEN-VENDOR-CSR         '            02750023
027600                                           TO WS-ABEND-PARAGRAPH  02760023
027700                  MOVE 'UNSUCCESSFUL OPEN' TO WS-ABEND-OPERATION  02770023
027800                  MOVE 'TEXTENT' TO WS-ABEND-STRUCTURE-1          02780023
027900                  MOVE 'TENTNME' TO WS-ABEND-STRUCTURE-2          02790023
028000                  PERFORM Z999-SQL-ERROR                          02800023
028100         END-EVALUATE                                             02810023
028200     END-PERFORM.                                                 02820014
028300                                                                  02830014
028400     IF WS-RETRY-COUNTER > WS-RETRY-MAX                           02840014
028500        MOVE 'Y100-OPEN-VENDOR-CSR' TO WS-ABEND-PARAGRAPH         02850023
028600        MOVE 'MAX RETRIES EXCEEDED ON OPEN' TO WS-ABEND-OPERATION 02860023
028700        PERFORM Z999-SQL-ERROR                                    02870023
028800     END-IF.                                                      02880023
028900                                                                  02890014
029000*----------------------------------------------------------------*02900023
029100*  CLOSE VENDOR ENTITY AND VENDOR NAME CURSOR                     02910014
029200*----------------------------------------------------------------*02920023
029300 Y200-CLOSE-VENDOR-CSR.                                           02930020
029400                                                                  02940014
029500         EXEC SQL                                                 02950023
029600            CLOSE VENDOR_CSR                                      02960023
029700         END-EXEC.                                                02970023
029800                                                                  02980023
029900         EVALUATE TRUE                                            02990023
030000             WHEN SQLCODE = ZERO                                  03000023
030100                  CONTINUE                                        03010023
030200             WHEN SQLWARN0 NOT = SPACES                           03020023
030300             WHEN SQLCODE  NOT = ZERO                             03030023
030400                  MOVE 'Y200-CLOSE-VENDOR-CSR'                    03040023
030500                                  TO WS-ABEND-PARAGRAPH           03050023
030600                  MOVE 'UNSUCCESSFUL CLOSE' TO WS-ABEND-OPERATION 03060023
030700                  MOVE 'TENTNME'  TO WS-ABEND-STRUCTURE-1         03070023
030800                  MOVE 'TEXTENT ' TO WS-ABEND-STRUCTURE-2         03080023
030900                  PERFORM Z999-SQL-ERROR                          03090023
031000         END-EVALUATE.                                            03100023
031100                                                                  03110014
031300*----------------------------------------------------------------*03130023
031400*  PROCESS DB2 ABENDS.                                            03140014
031500*----------------------------------------------------------------*03150023
031600 Z999-SQL-ERROR.                                                  03160014
031700                                                                  03170014
031800     DISPLAY '*** DB2 ERROR '.                                    03180014
031900     DISPLAY '*** PROGRAM   = ' WS-ABEND-PROGRAM.                 03190014
032000     DISPLAY '*** PARAGRAPH = ' WS-ABEND-PARAGRAPH.               03200014
032100     DISPLAY '*** OPERATION = ' WS-ABEND-OPERATION.               03210014
032200     DISPLAY '*** TABLE 1   = ' WS-ABEND-STRUCTURE-1.             03220014
032300     IF WS-ABEND-STRUCTURE-2 > SPACES                             03230014
032400         DISPLAY '*** TABLE 2   = ' WS-ABEND-STRUCTURE-2.         03240014
032500                                                                  03250014
032600     SET AP-DB2-ERROR              TO TRUE.                       03260014
032700                                                                  03270014
032800     COPY DPPD004.                                                03280029
032900     CALL 'ILBOABN0' USING ABEND-CODE.                            03290014
