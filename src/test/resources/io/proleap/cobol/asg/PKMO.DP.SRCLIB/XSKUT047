      *----------------------------------------------------------       00010000
       IDENTIFICATION DIVISION.                                         00020000
      *----------------------------------------------------------       00030000
       PROGRAM-ID.    XSKUT047.                                         00040000
       AUTHOR.        ALEXIS KEIKER.                                    00050000
       DATE-WRITTEN.  JANUARY 27, 2002.                                 00060000
                                                                        00070000
      *----------------------------------------------------------       00080000
      *            PRICE DETERMINATION BATCH PROGRAM                    00090000
      *----------------------------------------------------------       00100000
      * THIS PROGRAM WILL ACCEPT IN AN INPUT FILE WITH DIFFERENT        00110000
      * ITEMS AND THEIR PROMOTIONS THAT NEED A PRICE DETERMINED         00120000
      * PRICE.  THIS INPUT FILE WILL HAVE A HEADER RECORD FOR THE       00130000
      * ITEM AND THEN DETAIL RECORDS UNDERNEATH FOR THE DIFFERENT       00140000
      * PROMOTIONS.                                                     00150000
      *                                                                 00160000
      * THIS PROGRAM WILL FOLLOW THE PRICE DETERMINATION RULES          00170000
      * TO PICK THE CORRECT SIMPLE NON-GROUP PROMOTION, THE             00180000
      * GROUP PROMOTION, AND THE TIERED PROMOTION.  ONCE THE            00190000
      * PROGRAM HAS FOUND THIS INFORMATION IT WILL WRITE OUT            00200000
      * THE DATA TO AN OUTPUT FILE.                                     00210000
      *----------------------------------------------------------       00220000
      * HISTORY LOG:                                                    00230000
      *                                                                 00240000
      *----------------------------------------------------------       00250000
      * DATE:         05/30/2003                                        00260000
      * WR/IR#:       WR21428                                           00270000
      * PROGRAMMER:   KARI HAAK                                         00280000
      * DESCRIPTION:  INCREASED THE LENGTH OF THE INPUT DETAIL RECORD.  00290000
      *               STORE WAS ADDED TO THE DETAIL.                    00300000
      *----------------------------------------------------------       00310000
      * DATE:         06/11/2003                                        00320000
      * WR/IR#:       WR21428                                           00330000
      * PROGRAMMER:   KARI HAAK                                         00340000
      * DESCRIPTION:  INITIALIZE PC-CNT-SMPL AFTER PROCESSING PREVIOUS  00350000
      * HEADER RECORD IN 2000-PROCESS-PRICING.  CURRENT DETAIL RECORDS  00360000
      * WERE GETTING COMPARED TO DETAILS FROM A DIFFERENT HEADER.       00370000
      *----------------------------------------------------------       00380000
      * DATE:         06/13/2003                                        00390000
      * WR/IR#:       WR21428                                           00400000
      * PROGRAMMER:   KARI HAAK                                         00410000
      * DESCRIPTION:  INITIALIZE PC-CNT-GP AND PV-TIERED-DATA AFTER     00420000
      * PROCESSING PREVIOUS HEADER RECORD IN 2000-PROCESS-PRICING.      00430000
      *----------------------------------------------------------       00440000
      * DATE:         07/15/2003                                        00450000
      * WR/IR#:       WR21428                                           00460000
      * PROGRAMMER:   JODY TAINTER                                      00470000
      * DESCRIPTION:  MODIFIED PROGRAM TO RETURN TIMESTAMPS FOR         00480000
      * PD, GP, ADDL, BWP, AND TIERED.  ALSO CHANGED PROGRAM SO         00490000
      * GROUP PROMO IDS AND TYPE CODES ARE NOT PUT IN THE PD            00500000
      * OUTPUT FIELDS.                                                  00510000
      *----------------------------------------------------------       00520000
      * DATE:         08/22/2003                                        00530000
      * WR/IR#:       WR21428                                           00540000
      * PROGRAMMER:   JODY TAINTER                                      00550000
      * DESCRIPTION:  ADD THE FOLLOWING FIELDS TO OUTPUT FILE FOR       00560000
      * BATCH PDE.                                                      00570000
      *     PROMO INTERFACE ID                                          00580000
      *     PROMO MDSE LINE ID                                          00590000
      *     PROMO INTERFACE SUB ID                                      00600000
      *----------------------------------------------------------       00610000
      * DATE:         09/02/2003                                        00620000
      * WR/IR#:       WR21428                                           00630000
      * PROGRAMMER:   JODY TAINTER                                      00640000
      * DESCRIPTION:  ADD EBOGO CODE 'GBL'                              00650000
      *----------------------------------------------------------       00660000
      * DATE:         10/29/2003                                        00670000
      * WR/IR#:       P000603068                                        00680000
      * PROGRAMMER:   JODY TAINTER                                      00690000
      * DESCRIPTION:  FIX TO XSPD001 GROUP PRICING                      00700000
      *----------------------------------------------------------       00710000
      * DATE:         01/05/2004                                        00720000
      * WR/IR#:       WR26114                                           00730000
      * PROGRAMMER:   NANCY MARTIN                                      00740000
      * DESCRIPTION:  ADD EBOGO CODES FOR 'GBP' AND 'GBP'               00750000
      *----------------------------------------------------------       00760000
      * DATE:         01/21/2004                                        00770000
      * WR/IR#:       P000619089                                        00780000
      * PROGRAMMER:   JODY TAINTER                                      00790000
      * DESCRIPTION:  FIX TO ROUNDING ERROR IN FIELD PV-PERCENT-VAL     00800000
      *               FIELD NEEDS TO BE S9(7)V9(5) LENGTH INORDER       00810000
      *               TO CALCULATE GOLDSTAR CORRECTLY.                  00820000
      *                                                                 00830000
      *----------------------------------------------------------       00840000
      * DATE:                                                           00850000
      * WR/IR#:                                                         00860000
      * PROGRAMMER:                                                     00870000
      * DESCRIPTION:                                                    00880000
      *                                                                 00890000
      *----------------------------------------------------------       00900000
       ENVIRONMENT DIVISION.                                            00910000
      *----------------------------------------------------------       00920000
       CONFIGURATION SECTION.                                           00930000
       SOURCE-COMPUTER. IBM-3090.                                       00940000
       OBJECT-COMPUTER. IBM-3090.                                       00950000
                                                                        00960000
       INPUT-OUTPUT SECTION.                                            00970000
                                                                        00980000
       FILE-CONTROL.                                                    00990000
                                                                        01000000
           SELECT PD-INPUT-FILE                                         01010000
             ASSIGN TO INP01.                                           01020000
                                                                        01030000
           SELECT PD-OUTPUT-FILE                                        01040000
             ASSIGN TO OUT01.                                           01050000
                                                                        01060000
      *----------------------------------------------------------       01070000
       DATA DIVISION.                                                   01080000
      *----------------------------------------------------------       01090000
       FILE SECTION.                                                    01100000
                                                                        01110000
       FD  PD-INPUT-FILE                                                01120000
           RECORDING MODE IS V                                          01130000
           LABEL RECORDS ARE STANDARD                                   01140000
           BLOCK CONTAINS 0  RECORDS                                    01150000
           RECORD CONTAINS 66 TO 361 CHARACTERS                         01160000
           DATA RECORDS ARE PD-HEADER-INPUT-RECORD                      01170000
                            PD-DETAIL-INPUT-RECORD.                     01180000
                                                                        01190000
       01  PD-HEADER-INPUT-RECORD      PIC X(066).                      01200000
       01  PD-DETAIL-INPUT-RECORD      PIC X(361).                      01210000
                                                                        01220000
       FD  PD-OUTPUT-FILE                                               01230000
           RECORDING MODE IS F                                          01240000
           BLOCK CONTAINS 0 CHARACTERS                                  01250000
           LABEL RECORDS ARE OMITTED                                    01260000
           DATA RECORD IS PD-OUTPUT-RECORD.                             01270000
                                                                        01280000
       01  PD-OUTPUT-RECORD              PIC X(778).                    01290000
                                                                        01300000
      *---------------------------------------------------------        01310000
                                                                        01320000
       WORKING-STORAGE SECTION.                                         01330000
      *---------------------------------------------------------        01340000
      * PC- PROGRAM CONSTANTS                                           01350000
      *----------------------------------------------------------       01360000
       01  PC-PROGRAM-CONSTANTS.                                        01370000
           05  PC-PROGRAM-NAME              PIC X(08) VALUE 'XSKUT047'. 01380000
           05  PC-MAX-RETRIES               PIC S9(04) VALUE +5 COMP.   01390000
           05  PC-SUB-ONE                   PIC S9(02) VALUE +01.       01400000
                                                                        01410000
      *----------------------------------------------------------       01420000
      * PS- PROGRAM SWITCHES                                            01430000
      *----------------------------------------------------------       01440000
       01  PS-PROGRAM-SWITCHES.                                         01450000
           05  PS-PROMO-ID-FOUND-SW         PIC X(01)  VALUE 'Y'.       01460000
               88  PS-PROMO-ID-FOUND                   VALUE 'N'.       01470000
               88  PS-PROMO-ID-NOT-FOUND               VALUE 'Y'.       01480000
           05  PS-REC-TYPE-SW               PIC X(01)  VALUE 'Y'.       01490000
               88  PS-HEAD-REC                         VALUE 'Y'.       01500000
               88  PS-DTL-REC                          VALUE 'N'.       01510000
           05  PS-END-OF-INPUT-FILE-SW      PIC X(01)  VALUE 'Y'.       01520000
               88  PS-END-OF-INPUT-FILE                VALUE 'N'.       01530000
               88  PS-NOT-END-OF-INPUT-FILE            VALUE 'Y'.       01540000
           05  PS-GP-PRC-CHECK-SW           PIC X(01)  VALUE 'Y'.       01550000
               88  PS-GP-PRC-WINS                      VALUE 'N'.       01560000
               88  PS-SMPL-PRC-WINS                    VALUE 'Y'.       01570000
                                                                        01580000
      *----------------------------------------------------------       01590000
      * PV- PROGRAM VARIABLES                                           01600000
      *----------------------------------------------------------       01610000
       01 PV-PROGRAM-VARIABLES.                                         01620000
          05  PV-SQL-SUB                   PIC S9(04) VALUE +0 COMP.    01630000
          05  PV-TABLE-SIZE                PIC 9(05) VALUE 0.           01640000
          05  PV-PERCENT-VAL               PIC S9(07)V9(05)             01650000
                                                     VALUE +0 COMP-3.   01660000
          05  PV-INPUT-REC-LAYOUT.                                      01670000
              10 PV-RECORD-TYPE            PIC X(01) VALUE SPACES.      01680000
              10 FILLER                    PIC X(350) VALUE SPACES.     01690000
          05  PV-PROMO-ID                  PIC S9(10)V VALUE +0 COMP-3. 01700000
          05  PV-PROMO-INTFC-ID            PIC S9(10)V VALUE +0 COMP-3. 01710000
          05  PV-PROMO-MDSE-LNE-ID         PIC S9(10)V VALUE +0 COMP-3. 01720000
          05  PV-AD-VERSION                PIC S9(4) VALUE +0 COMP.     01730000
          05  PV-PRICE-DET-PRC             PIC S9(07)V9(02)             01740000
                                                       VALUE +0 COMP-3. 01750000
          05  PV-GP-INDV-GP-PRC            PIC S9(07)V9(02)             01760000
                                                       VALUE +0 COMP-3. 01770000
          05  PV-BOGO-INDV-PRC             PIC S9(07)V9(02)             01780000
                                                       VALUE +0 COMP-3. 01790000
          05  PV-RGLR-PRICE                PIC S9(07)V9(02)             01800000
                                                       VALUE +0 COMP-3. 01810000
          05  PV-PRICG-TYP-CDE             PIC X(03) VALUE SPACES.      01820000
              88  PV-TIERED                          VALUES 'TAP',      01830000
                                                            'TQP'.      01840000
              88  PV-SIMPLE                          VALUES 'SPO',      01850000
                                'SRP', 'SPP', 'CPO', 'CPP', 'MPP'.      01860000
              88  PV-GROUP-PRICG                     VALUES 'GAO'.      01870000
              88  PV-BOGO                            VALUES 'GBL',      01880000
W26114                                               'GBD', 'GBP'.      01890000
          05  PV-TIERED-DATA.                                           01900000
              10 PV-TIERED-PROMO-ID        PIC S9(10)V VALUE +0 COMP-3. 01910000
              10 PV-TIERED-PROMO-INTFC-ID  PIC S9(10)V VALUE +0 COMP-3. 01920000
              10 PV-TIERED-MDSE-LNE-ID     PIC S9(10)V VALUE +0 COMP-3. 01930000
              10 PV-TIERED-STRT-DTE        PIC X(26) VALUE SPACES.      01940000
              10 PV-TIERED-END-DTE         PIC X(26) VALUE SPACES.      01950000
              10 PV-TIERED-PRICG-TYP-CDE   PIC X(03) VALUE SPACES.      01960000
              10 PV-TIERED-MRCH-HEIR-CDE   PIC X(03) VALUE SPACES.      01970000
          05  PV-FINAL-SMPL-PRICG.                                      01980000
              10  PV-SMPL-PRC-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 01990000
              10  PV-SMPL-INTFC-ID         PIC S9(10)V VALUE +0 COMP-3. 02000000
              10  PV-SMPL-MDSE-LNE-ID      PIC S9(10)V VALUE +0 COMP-3. 02010000
              10  PV-SMPL-STRT-DTE         PIC X(26) VALUE SPACES.      02020000
              10  PV-SMPL-END-DTE          PIC X(26) VALUE SPACES.      02030000
              10  PV-SMPL-PRC-TYP-CDE      PIC X(03) VALUE SPACES.      02040000
              10  PV-SMPL-HEIR-CDE         PIC X(03) VALUE SPACES.      02050000
              10  PV-SMPL-PRC-DET-PRICE    PIC S9(07)V9(02)             02060000
                                                     VALUE +0 COMP-3.   02070000
                                                                        02080000
          05  PV-FINAL-GP-PRICG.                                        02090000
              10  PV-GP-PRC-PROMO-ID       PIC S9(10)V VALUE +0 COMP-3. 02100000
              10  PV-GP-PRC-INTFC-ID       PIC S9(10)V VALUE +0 COMP-3. 02110000
              10  PV-GP-PRC-MDSE-LNE-ID    PIC S9(10)V VALUE +0 COMP-3. 02120000
              10  PV-GP-PRC-STRT-DTE       PIC X(26) VALUE SPACES.      02130000
              10  PV-GP-PRC-END-DTE        PIC X(26) VALUE SPACES.      02140000
              10  PV-GP-PRC-TYP-CDE        PIC X(03) VALUE SPACES.      02150000
              10  PV-GP-PRC-HEIR-CDE       PIC X(03) VALUE SPACES.      02160000
              10  PV-GP-PRC-QTY            PIC S9(04) VALUE +0 COMP.    02170000
              10  PV-GP-PRC-DLR            PIC S9(07)V9(02)             02180000
                                                     VALUE +0 COMP-3.   02190000
              10  PV-GP-PRC-IDV-PRICE      PIC S9(07)V9(02)             02200000
                                                     VALUE +0 COMP-3.   02210000
                                                                        02220000
          05  PV-FINAL-BOGO-PRICG.                                      02230000
              10  PV-BOGO-PRC-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 02240000
              10  PV-BOGO-PRC-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 02250000
              10  PV-BOGO-PRC-MDSE-LNE-ID  PIC S9(10)V VALUE +0 COMP-3. 02260000
              10  PV-BOGO-PRC-STRT-DTE     PIC X(26) VALUE SPACES.      02270000
              10  PV-BOGO-PRC-END-DTE      PIC X(26) VALUE SPACES.      02280000
              10  PV-BOGO-PRC-TYP-CDE      PIC X(03) VALUE SPACES.      02290000
W26114        10  PV-BOGO-DISC-QTY         PIC S9(04) COMP VALUE +0.    02300000
W26114        10  PV-BOGO-DISC-AMT         PIC S9(07)V9(03)             02310000
W26114                                           VALUE +0 COMP-3.       02320000
                                                                        02330000
          05  PV-FINAL-PRICING.                                         02340000
              10  PV-FINAL-PRC-DET-PRC     PIC S9(07)V9(02)             02350000
                                                     VALUE +0 COMP-3.   02360000
              10  PV-FINAL-PRC-TYP-CDE     PIC X(03) VALUE SPACES.      02370000
              10  PV-FINAL-DET-PROMO-ID    PIC S9(10)V VALUE +0 COMP-3. 02380000
              10  PV-FINAL-DET-INTFC-ID    PIC S9(10)V VALUE +0 COMP-3. 02390000
              10  PV-FINAL-DET-MDSE-LNE-ID PIC S9(10)V VALUE +0 COMP-3. 02400000
              10  PV-FINAL-PD-STRT-DTE     PIC X(26) VALUE SPACES.      02410000
              10  PV-FINAL-PD-END-DTE      PIC X(26) VALUE SPACES.      02420000
              10  PV-FINAL-GP-QTY          PIC S9(04) VALUE +0 COMP.    02430000
              10  PV-FINAL-GP-DLR          PIC S9(07)V9(02)             02440000
                                                     VALUE +0 COMP-3.   02450000
              10  PV-FINAL-GP-IDV-PRC      PIC S9(07)V9(02)             02460000
                                                     VALUE +0 COMP-3.   02470000
              10  PV-FINAL-GP-PROMO-ID     PIC S9(10)V VALUE +0 COMP-3. 02480000
              10  PV-FINAL-GP-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 02490000
              10  PV-FINAL-GP-MDSE-LNE-ID  PIC S9(10)V VALUE +0 COMP-3. 02500000
              10  PV-FINAL-GP-STRT-DTE     PIC X(26) VALUE SPACES.      02510000
              10  PV-FINAL-GP-END-DTE      PIC X(26) VALUE SPACES.      02520000
              10  PV-FINAL-GP-TYP-CDE      PIC X(03) VALUE SPACES.      02530000
              10  PV-FINAL-LWST-SIX-PRC    PIC S9(07)V9(02)             02540000
                                                     VALUE +0 COMP-3.   02550000
                                                                        02560000
      *-----------------------------------------------------------      02570000
      * PC- PROGRAM COUNTERS                                            02580000
      *-----------------------------------------------------------      02590000
       01  PC-PROGRAM-COUNTERS.                                         02600000
           05  PC-CNT-GP                   PIC S9(04) VALUE +0.         02610000
           05  PC-CNT-BOGO                 PIC S9(04) VALUE +0.         02620000
           05  PC-CNT-SMPL                 PIC S9(04) VALUE +0.         02630000
           05  PC-HOLD-INDEX               PIC S9(04) VALUE +0.         02640000
           05  PC-TBL-SUB                  PIC S9(04) VALUE +0.         02650000
           05  PC-CNT-INDX                 PIC S9(04) VALUE +0.         02660000
           05  PC-CNT-NEW-INDX             PIC S9(04) VALUE +0.         02670000
           05  PC-ALL-INPUT-RECS           PIC 9(09) VALUE 0.           02680000
           05  PC-HEAD-INPUT-RECS          PIC 9(09) VALUE 0.           02690000
           05  PC-DTL-INPUT-RECS           PIC 9(09) VALUE 0.           02700000
           05  PC-OUTPUT-RECS              PIC 9(09) VALUE 0.           02710000
                                                                        02720000
      *----------------------------------------------------------       02730000
      * TBL- TABLE VARIABLES                                            02740000
      *----------------------------------------------------------       02750000
       01 TBL-TIERED-TABLES.                                            02760000
          05  TBL-TIERED-TABLE.                                         02770000
              10 FILLER                     OCCURS 10 TIMES             02780000
                                            INDEXED BY TBL-TIER-INDEX.  02790000
                 15 TBL-BUY-QTY            PIC S9(04) VALUE +0 COMP.    02800000
                 15 TBL-BUY-DLR            PIC S9(07)V9(02)             02810000
                                                      VALUE +0 COMP-3.  02820000
                 15 TBL-GET-PCT            PIC S9(03)V9(03)             02830000
                                                      VALUE +0 COMP-3.  02840000
                 15 TBL-GET-DLR            PIC S9(07)V9(02)             02850000
                                                      VALUE +0 COMP-3.  02860000
                 15 TBL-INTFC-SUB-ID       PIC S9(10)V VALUE +0 COMP-3. 02870000
                                                                        02880000
       01 TBL-SMPL-TABLES.                                              02890000
          05  TBL-SMPL-PRICG-TABLE.                                     02900000
              10 FILLER                     OCCURS 1 TO 2000 TIMES      02910000
                                            DEPENDING ON PC-CNT-SMPL    02920000
                                            INDEXED BY TBL-SMPL-INDEX.  02930000
                 15 TBL-PROMO-ID           PIC S9(10)V VALUE +0 COMP-3. 02940000
                 15 TBL-PROMO-INTFC-ID     PIC S9(10)V VALUE +0 COMP-3. 02950000
                 15 TBL-MDSE-LNE-ID        PIC S9(10)V VALUE +0 COMP-3. 02960000
                 15 TBL-PROMO-STRT-DTE     PIC X(26) VALUE SPACES.      02970000
                 15 TBL-PROMO-END-DTE      PIC X(26) VALUE SPACES.      02980000
                 15 TBL-PRICG-TYP-CDE      PIC X(03) VALUE SPACES.      02990000
                 15 TBL-MERCH-HEIR-CDE     PIC X(03) VALUE SPACES.      03000000
                 15 TBL-PRICE-DET-PRC      PIC S9(07)V9(02)             03010000
                                                      VALUE +0 COMP-3.  03020000
                                                                        03030000
       01 TBL-GP-TABLES.                                                03040000
          05  TBL-GP-PRICG-TABLE.                                       03050000
              10 FILLER                     OCCURS 1 TO 2000 TIMES      03060000
                                            DEPENDING ON PC-CNT-GP      03070000
                                            INDEXED BY TBL-GP-INDEX.    03080000
                 15 TBL-GP-PROMO-ID        PIC S9(10)V VALUE +0 COMP-3. 03090000
                 15 TBL-GP-PROMO-INTFC-ID  PIC S9(10)V VALUE +0 COMP-3. 03100000
                 15 TBL-GP-MDSE-LNE-ID     PIC S9(10)V VALUE +0 COMP-3. 03110000
                 15 TBL-GP-PROMO-STRT-DTE  PIC X(26) VALUE SPACES.      03120000
                 15 TBL-GP-PROMO-END-DTE   PIC X(26) VALUE SPACES.      03130000
                 15 TBL-GP-PRICG-TYP-CDE   PIC X(03) VALUE SPACES.      03140000
                 15 TBL-GP-MERCH-HEIR-CDE  PIC X(03) VALUE SPACES.      03150000
                 15 TBL-GP-GROUP-QTY       PIC S9(04) VALUE +0 COMP.    03160000
                 15 TBL-GP-GROUP-PRC       PIC S9(07)V9(03) VALUE +0    03170000
                                                      COMP-3.           03180000
                 15 TBL-GP-INDV-GP-PRC     PIC S9(07)V9(02) VALUE +0    03190000
                                                      COMP-3.           03200000
                                                                        03210000
       01 TBL-BOGO-TABLES.                                              03220000
          05 TBL-BOGO-PRICG-TABLE.                                      03230000
             10 FILLER                     OCCURS 1 TO 200 TIMES        03240000
                                           DEPENDING ON PC-CNT-BOGO     03250000
                                           INDEXED BY TBL-BOGO-INDEX.   03260000
                15 TBL-BOGO-PROMO-ID       PIC S9(10)V VALUE +0 COMP-3. 03270000
                15 TBL-BOGO-PROMO-INTFC-ID PIC S9(10)V VALUE +0 COMP-3. 03280000
                15 TBL-BOGO-MDSE-LNE-ID    PIC S9(10)V VALUE +0 COMP-3. 03290000
                15 TBL-BOGO-PROMO-STRT-DTE PIC X(26) VALUE SPACES.      03300000
                15 TBL-BOGO-PROMO-END-DTE  PIC X(26) VALUE SPACES.      03310000
                15 TBL-BOGO-PRICG-TYP-CDE  PIC X(03) VALUE SPACES.      03320000
W26114          15 TBL-BOGO-DISC-QTY       PIC S9(04) COMP VALUE +0.    03330000
W26114          15 TBL-BOGO-DISC-AMT       PIC S9(07)V9(03)             03340000
W26114                                          VALUE +0 COMP-3.        03350000
                                                                        03360000
      *-----------------------------------------------------------      03370000
      * ERROR HANDLING                                                  03380000
      *-----------------------------------------------------------      03390000
       01  PV-MISC-ABEND-FIELDS.                                        03400000
           05  PV-PARAGRAPH-NAME            PIC X(30) VALUE SPACE.      03410000
           05  PV-OPERATION-MSG-1           PIC X(40) VALUE SPACE.      03420000
           05  PV-OPERATION-MSG-2           PIC X(40) VALUE SPACE.      03430000
           05  PV-DB2-OPERATION             PIC X(30) VALUE SPACE.      03440000
       01  ABEND-CODE                  PIC S9(4) VALUE ZEROS COMP.      03450000
           88  ABEND-4003-CTRL-CARD-ERROR        VALUE +4003.           03460000
           88  ABEND-4013-DB2-ERROR              VALUE +4013.           03470000
           88  ABEND-4019-CAL-SUB-ERROR          VALUE +4019.           03480000
           88  ABEND-4020-MQ-ERROR               VALUE +4020.           03490000
           88  ABEND-4444-FORCED-ABEND           VALUE +4444.           03500000
                                                                        03510000
      *----------------------------------------------------------       03520000
      * COPYBOOK USED FOR INPUT - DETAIL INFORMATION                    03530000
      *----------------------------------------------------------       03540000
           COPY XSRD042.                                                03550000
                                                                        03560000
      *----------------------------------------------------------       03570000
      * COPYBOOK USED FOR INPUT - HEADER INFORMATION                    03580000
      *----------------------------------------------------------       03590000
           COPY XSRD043.                                                03600000
                                                                        03610000
      *----------------------------------------------------------       03620000
      * COPYBOOK USED FOR OUTPUT.                                       03630000
      *----------------------------------------------------------       03640000
           COPY XSRD044.                                                03650000
                                                                        03660000
      *----------------------------------------------------------       03670000
      * VARIABLES REQUIRED FOR THE FORMAT SQLCA ROUTINE DPPD004         03680000
      *----------------------------------------------------------       03690000
           COPY DPWS004.                                                03700000
                                                                        03710000
      *---------------------------------------------                    03720000
      *  DB2 COMMUNICATION AREA.                                        03730000
      *---------------------------------------------                    03740000
           EXEC SQL                                                     03750000
                INCLUDE SQLCA                                           03760000
           END-EXEC.                                                    03770000
                                                                        03780000
      *---------------------------------------------                    03790000
      *  DB2 TABLE XST00023(XST_STR_GP_MBSHP) - STORE GROUP MEMBERSHIP  03800000
      *                                                TABLE            03810000
      *---------------------------------------------                    03820000
           EXEC SQL                                                     03830000
                INCLUDE XST00023                                        03840000
           END-EXEC.                                                    03850000
                                                                        03860000
      *---------------------------------------------                    03870000
      *  DB2 TABLE EPT00011(EPT_LO_RTL) - LOWEST SIX WEEK PRICE TABLE   03880000
      *---------------------------------------------                    03890000
           EXEC SQL                                                     03900000
                INCLUDE EPT00011                                        03910000
           END-EXEC.                                                    03920000
                                                                        03930000
                                                                        03940000
      *----------------------------------------------------------       03950000
       PROCEDURE DIVISION.                                              03960000
      *----------------------------------------------------------       03970000
       0000-MAINLINE.                                                   03980000
                                                                        03990000
           PERFORM 1000-INITIALIZATION.                                 04000000
                                                                        04010000
W26114     IF PS-NOT-END-OF-INPUT-FILE                                  04020001
              PERFORM 2000-PROCESS-PRICING                              04030001
                UNTIL PS-END-OF-INPUT-FILE                              04040001
W26114     ELSE                                                         04050001
W26114        DISPLAY ' ** XSKUT047 - NO RECORDS FOUND TO PROCESS'      04060001
W26614        DISPLAY ' ***********   INPUT FILE WAS EMPTY'             04070001
W26114     END-IF.                                                      04080001
                                                                        04090000
           IF PC-OUTPUT-RECS > 0                                        04100000
W26114      OR (PC-HEAD-INPUT-RECS = 1                                  04110000
W26114         AND PC-DTL-INPUT-RECS >= 1)                              04120000
              PERFORM 3000-PROCESS-PRC-DET                              04130000
              PERFORM 4000-CHECK-LWST-SIX-WK-PRC                        04140000
              PERFORM 8000-POPULATE-OUTPUT-REC                          04150000
              PERFORM 9100-WRITE-PD-OUTPUT-RECORD                       04160000
           END-IF.                                                      04170000
                                                                        04180000
           PERFORM 9999-WRAPUP.                                         04190000
                                                                        04200000
           GOBACK.                                                      04210000
                                                                        04220000
      *0000-EXIT.                                                       04230000
       EJECT.                                                           04240000
                                                                        04250000
      *----------------------------------------------------------       04260000
      * 1000-INITIALIZATION.                                            04270000
      *     INTIALIZES OR MOVES ANY VARIABLES.  CHECKS THE TABLE        04280000
      *     IN THE LINKAGE SECTION TO SEE IF IT IS LEGIT.               04290000
      *----------------------------------------------------------       04300000
       1000-INITIALIZATION.                                             04310000
                                                                        04320000
           OPEN INPUT  PD-INPUT-FILE                                    04330000
                OUTPUT PD-OUTPUT-FILE.                                  04340000
                                                                        04350000
           INITIALIZE PC-PROGRAM-COUNTERS                               04360000
                      PV-FINAL-PRICING.                                 04370000
                                                                        04380000
           SET PS-SMPL-PRC-WINS TO TRUE.                                04390000
                                                                        04400000
           INITIALIZE TBL-TIERED-TABLE                                  04410000
               REPLACING ALPHANUMERIC DATA BY SPACES                    04420000
                         NUMERIC DATA BY ZEROS.                         04430000
                                                                        04440000
           PERFORM 9000-READ-PD-INPUT-FILE.                             04450000
                                                                        04460000
W26614*******   MOVED THIS CHECK TO DRIVER TO HANDLE NO RECORDS         04470002
W26114**   IF PS-END-OF-INPUT-FILE                                      04480002
W26114**      DISPLAY 'NO RECORDS TO PROCESS'                           04490002
W26114**      DISPLAY 'INPUT FILE IS EMPTY'                             04500002
W26114**   END-IF.                                                      04510002
                                                                        04520000
      *1000-EXIT.                                                       04530000
       EJECT.                                                           04540000
                                                                        04550000
      *----------------------------------------------------------       04560000
      * 2000-PROCESS-PRICING.                                           04570000
      *     THIS PROCESS ALL THE RECORDS THAT WERE SENT THROUGH         04580000
      *     THE LINKAGE SECTION.  IT WILL SIFT THROUGH EACH RECORD      04590000
      *     TO FIND OUT THE PRICE DETERMINED PRICE.                     04600000
      *----------------------------------------------------------       04610000
       2000-PROCESS-PRICING.                                            04620000
                                                                        04630000
           IF PS-HEAD-REC                                               04640000
              IF PC-HEAD-INPUT-RECS > 1                                 04650000
                 PERFORM 3000-PROCESS-PRC-DET                           04660000
                 PERFORM 4000-CHECK-LWST-SIX-WK-PRC                     04670000
                 PERFORM 8000-POPULATE-OUTPUT-REC                       04680000
                 PERFORM 9100-WRITE-PD-OUTPUT-RECORD                    04690000
              END-IF                                                    04700000
              MOVE ZEROES              TO PC-CNT-SMPL                   04710000
                                          PC-CNT-GP                     04720000
                                          PC-CNT-BOGO                   04730000
              INITIALIZE PV-TIERED-DATA                                 04740000
                         PV-FINAL-SMPL-PRICG                            04750000
                         PV-FINAL-GP-PRICG                              04760000
                         PV-FINAL-PRICING                               04770000
                         PV-FINAL-BOGO-PRICG                            04780000
              MOVE PV-INPUT-REC-LAYOUT TO XS043-PD-HEADER-RECORD        04790000
              MOVE XS043-RGLR-PRICE    TO PV-RGLR-PRICE                 04800000
           ELSE                                                         04810000
              MOVE XS042-PRICG-TYP-CDE TO PV-PRICG-TYP-CDE              04820000
              MOVE XS042-ELIG-PROMO-ID TO PV-PROMO-ID                   04830000
              MOVE XS042-ELIG-PROMO-INTFC-ID TO PV-PROMO-INTFC-ID       04840000
              MOVE XS042-ELIG-MDSE-LNE-ID TO PV-PROMO-MDSE-LNE-ID       04850000
              EVALUATE TRUE                                             04860000
                WHEN PV-TIERED                                          04870000
                     PERFORM 2100-CHECK-TIERED                          04880000
                WHEN PV-SIMPLE                                          04890000
                     PERFORM 2200-CHECK-SMPL-PRICG                      04900000
                WHEN PV-GROUP-PRICG                                     04910000
                     PERFORM 2300-CHECK-GP-PRICG                        04920000
                WHEN PV-BOGO                                            04930000
                     PERFORM 2400-CHECK-BOGO                            04940000
              END-EVALUATE                                              04950000
           END-IF.                                                      04960000
                                                                        04970000
           PERFORM 9000-READ-PD-INPUT-FILE.                             04980000
                                                                        04990000
      *2000-EXIT.                                                       05000000
       EJECT.                                                           05010000
                                                                        05020000
      *** THIS MEMBER HOLDS THE REST OF THE CODE FOR THIS PROGRAM       05030000
           COPY XSPD001.                                                05040000
                                                                        05050000
      *----------------------------------------------------------       05060000
      * 4000-CHECK-LWST-SIX-WK-PRC.                                     05070000
      *     CHECKS TO SEE IF THE LOWEST SIX WEEK PRICE IS NEEDED.       05080000
      *     IF IT IS NEEDED IT WILL SELECT IT FROM THE LOWEST           05090000
      *     RETAIL AMOUNT TABLE.                                        05100000
      *----------------------------------------------------------       05110000
       4000-CHECK-LWST-SIX-WK-PRC.                                      05120000
                                                                        05130000
           IF XS043-INCL-LWST-SIX-WK-SW = 'Y'                           05140000
              PERFORM 4100-SELECT-AD-VERSION                            05150000
              PERFORM 4200-SELECT-LWST-6-WK-PRC                         05160000
           END-IF.                                                      05170000
                                                                        05180000
      *4000-EXIT.                                                       05190000
       EJECT.                                                           05200000
                                                                        05210000
      *----------------------------------------------------------       05220000
      * 4100-SELECT-AD-VERSION.                                         05230000
      *     SELECTS WHAT AD VERSION BELONGS TO A SPECIFIC STORE.        05240000
      *----------------------------------------------------------       05250000
       4100-SELECT-AD-VERSION.                                          05260000
                                                                        05270000
           PERFORM                                                      05280000
               WITH TEST AFTER                                          05290000
               VARYING PV-SQL-SUB                                       05300000
               FROM 1 BY 1                                              05310000
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05320000
                         OR  SQLCODE = 0)                               05330000
                                                                        05340000
                EXEC SQL                                                05350000
                     SELECT  STR_GP_ID                                  05360000
                       INTO :PV-AD-VERSION                              05370000
                       FROM XST_STR_GP_MBSHP                            05380000
                      WHERE STR_NBR        = :XS043-STORE               05390000
                        AND STR_GP_TYP_CDE = 4000                       05400000
                        AND EFF_BEG_DTE   <= :XS043-DATE                05410000
                        AND (EFF_END_DTE   > :XS043-DATE                05420000
                         OR  EFF_END_DTE  IS NULL)                      05430000
                      WITH UR                                           05440000
                END-EXEC                                                05450000
                                                                        05460000
                EVALUATE TRUE                                           05470000
                    WHEN SQLCODE = -904                                 05480000
                    WHEN SQLCODE = -911                                 05490000
                    WHEN SQLCODE = -913                                 05500000
                         CONTINUE                                       05510000
                    WHEN SQLCODE = ZERO                                 05520000
                         CONTINUE                                       05530000
                    WHEN SQLCODE NOT EQUAL ZERO                         05540000
                         MOVE '4100-SELECT-AD-VERSION'                  05550000
                                             TO PV-PARAGRAPH-NAME       05560000
                         MOVE 'SELECT AD VERSION'                       05570000
                                             TO PV-DB2-OPERATION        05580000
                         PERFORM 9900-SQL-ABEND-ROUTINE                 05590000
                END-EVALUATE                                            05600000
           END-PERFORM.                                                 05610000
                                                                        05620000
           IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         05630000
              MOVE '4100-SELECT-AD-VERSION'                             05640000
                                  TO PV-PARAGRAPH-NAME                  05650000
              MOVE 'SELECT RETRIES EXCEEDED'                            05660000
                                  TO PV-DB2-OPERATION                   05670000
              PERFORM 9900-SQL-ABEND-ROUTINE                            05680000
           END-IF.                                                      05690000
                                                                        05700000
      *4100-EXIT.                                                       05710000
       EJECT.                                                           05720000
                                                                        05730000
      *----------------------------------------------------------       05740000
      * 4200-SELECT-LWST-6-WK-PRC.                                      05750000
      *     SELECTS THE LOWEST 6-WEEK PRICE DETERMINED FOR THE          05760000
      *     SKU/AD VERSION LEVEL.                                       05770000
      *----------------------------------------------------------       05780000
       4200-SELECT-LWST-6-WK-PRC.                                       05790000
                                                                        05800000
           PERFORM                                                      05810000
               WITH TEST AFTER                                          05820000
               VARYING PV-SQL-SUB                                       05830000
               FROM 1 BY 1                                              05840000
               UNTIL (PV-SQL-SUB GREATER PC-MAX-RETRIES                 05850000
                         OR  SQLCODE = 0                                05860000
                         OR  SQLCODE = +100                             05870000
                         OR  SQLCODE = -305)                            05880000
                                                                        05890000
                EXEC SQL                                                05900000
                     SELECT  MIN(UNT_RTL_AMT)                           05910000
                       INTO :PV-FINAL-LWST-SIX-PRC                      05920000
                       FROM EPT_LO_RTL                                  05930000
                      WHERE INTR_UPC_ID    = :XS043-INTR-UPC-ID         05940000
                        AND STR_GP_TYP_CDE = 4000                       05950000
                        AND STR_GP_ID      = :PV-AD-VERSION             05960000
                      WITH UR                                           05970000
                END-EXEC                                                05980000
                                                                        05990000
                EVALUATE TRUE                                           06000000
                    WHEN SQLCODE = -904                                 06010000
                    WHEN SQLCODE = -911                                 06020000
                    WHEN SQLCODE = -913                                 06030000
                         CONTINUE                                       06040000
                    WHEN SQLCODE = ZERO                                 06050000
                         CONTINUE                                       06060000
                    WHEN SQLCODE = +100 OR -305                         06070000
                         MOVE 0 TO PV-FINAL-LWST-SIX-PRC                06080000
                    WHEN SQLCODE NOT EQUAL ZERO                         06090000
                         MOVE '4200-SELECT-LWST-6-WK-PRC'               06100000
                                             TO PV-PARAGRAPH-NAME       06110000
                         MOVE 'SELECT AD VERSION'                       06120000
                                             TO PV-DB2-OPERATION        06130000
                         PERFORM 9900-SQL-ABEND-ROUTINE                 06140000
                END-EVALUATE                                            06150000
           END-PERFORM.                                                 06160000
                                                                        06170000
           IF PV-SQL-SUB GREATER PC-MAX-RETRIES                         06180000
              MOVE '4200-SELECT-LWST-6-WK-PRC'                          06190000
                                  TO PV-PARAGRAPH-NAME                  06200000
              MOVE 'SELECT RETRIES EXCEEDED'                            06210000
                                  TO PV-DB2-OPERATION                   06220000
              PERFORM 9900-SQL-ABEND-ROUTINE                            06230000
           END-IF.                                                      06240000
                                                                        06250000
      *4200-EXIT.                                                       06260000
       EJECT.                                                           06270000
                                                                        06280000
      *----------------------------------------------------------       06290000
      * 8000-POPULATE-OUTPUT-REC.                                       06300000
      *     POPULATES THE OUTPUT RECORD SO IT CAN BE WRITTEN OUT        06310000
      *     TO THE OUTPUT FILE.                                         06320000
      *----------------------------------------------------------       06330000
       8000-POPULATE-OUTPUT-REC.                                        06340000
                                                                        06350000
           INITIALIZE XS044-PD-OUTPUT-RECORD.                           06360000
                                                                        06370000
           MOVE XS043-STORE                TO XS044-STORE.              06380000
           MOVE XS043-DATE                 TO XS044-DATE.               06390000
           MOVE XS043-TIME                 TO XS044-TIME.               06400000
           MOVE XS043-PROMO-ID             TO XS044-PROMO-ID.           06410000
           MOVE XS043-INTR-UPC-ID          TO XS044-INTR-UPC-ID.        06420000
           MOVE XS043-SKU                  TO XS044-SKU.                06430000
           MOVE XS043-UPC-CDE              TO XS044-UPC-CDE.            06440000
           MOVE XS043-INCL-UNAD-SW         TO XS044-INCL-UNAD-SW.       06450000
           MOVE XS043-INCL-PART-DAY-SW     TO XS044-INCL-PART-DAY-SW.   06460000
           MOVE XS043-INCL-GOLD-STR-SW     TO XS044-INCL-GOLD-STR-SW.   06470000
           MOVE XS043-INCL-LWST-SIX-WK-SW  TO XS044-INCL-LWST-SIX-WK-SW.06480000
           MOVE XS043-INCL-GP-PRC-SW       TO XS044-INCL-GP-PRC-SW.     06490000
           MOVE XS043-INCL-BWP-PROMO-SW    TO XS044-INCL-BWP-PROMO-SW.  06500000
           MOVE XS043-INCL-TIERED-PROMO-SW TO XS044-INCL-TIER-PROMO-SW. 06510000
           MOVE XS043-INCL-ADDL-PCT-AMT-SW TO XS044-INCL-ADL-PCT-AMT-SW.06520000
           MOVE XS043-CALLING-APPL-IDENT   TO XS044-CALLING-APPL-IDENT. 06530000
           MOVE XS043-RGLR-PRICE           TO XS044-RGLR-PRICE.         06540000
           MOVE XS043-REG-GP-QTY           TO XS044-REG-GP-QTY.         06550000
           MOVE XS043-REG-GP-DLR           TO XS044-REG-GP-DLR.         06560000
           MOVE PV-FINAL-PRC-DET-PRC       TO XS044-PD-PRICE.           06570000
           MOVE PV-FINAL-PRC-TYP-CDE       TO XS044-PD-PRICG-TYP-CDE.   06580000
           MOVE PV-FINAL-DET-PROMO-ID      TO XS044-PD-PROMO-ID.        06590000
           MOVE PV-FINAL-DET-INTFC-ID      TO XS044-PD-INTFC-ID.        06600000
           MOVE PV-FINAL-DET-MDSE-LNE-ID   TO XS044-PD-MDSE-LNE-ID.     06610000
           MOVE PV-FINAL-PD-STRT-DTE       TO XS044-PD-STRT-TMST.       06620000
           MOVE PV-FINAL-PD-END-DTE        TO XS044-PD-END-TMST.        06630000
           MOVE PV-FINAL-GP-QTY            TO XS044-PROMO-GP-PRICG-QTY. 06640000
           MOVE PV-FINAL-GP-DLR            TO XS044-PROMO-GP-PRICG-DLR. 06650000
           MOVE PV-FINAL-GP-PROMO-ID       TO XS044-GP-PROMO-ID.        06660000
           MOVE PV-FINAL-GP-INTFC-ID       TO XS044-GP-INTFC-ID.        06670000
           MOVE PV-FINAL-GP-MDSE-LNE-ID    TO XS044-GP-MDSE-LNE-ID.     06680000
           MOVE PV-FINAL-GP-TYP-CDE        TO XS044-GP-PRICG-TYP-CDE.   06690000
           MOVE PV-FINAL-LWST-SIX-PRC      TO XS044-LWST-SIX-WEEK-PRC.  06700000
           MOVE PV-FINAL-GP-STRT-DTE       TO XS044-GP-STRT-TMST.       06710000
           MOVE PV-FINAL-GP-END-DTE        TO XS044-GP-END-TMST.        06720000
                                                                        06730000
      *                                                                 06740000
      * EBOGO                                                           06750000
      *                                                                 06760000
040400     MOVE PV-BOGO-PRC-PROMO-ID TO XS044-EBOGO-PROMO-ID.           06770000
040600     MOVE PV-BOGO-PRC-INTFC-ID TO XS044-EBOGO-INTFC-ID.           06780000
040600     MOVE PV-BOGO-PRC-MDSE-LNE-ID TO XS044-EBOGO-MDSE-LNE-ID.     06790000
040800     MOVE PV-BOGO-PRC-STRT-DTE TO XS044-EBOGO-STRT-TMST.          06800000
041000     MOVE PV-BOGO-PRC-END-DTE TO XS044-EBOGO-END-TMST.            06810000
041200     MOVE PV-BOGO-PRC-TYP-CDE TO XS044-EBOGO-PRICG-TYP-CDE.       06820000
W26114     MOVE PV-BOGO-DISC-QTY    TO XS044-EBOGO-DISC-QTY.            06830000
W26114     MOVE PV-BOGO-DISC-AMT    TO XS044-EBOGO-DISC-AMT.            06840000
NEMTST**   DISPLAY '**8000- OUT REC XS044 **',                          06850000
NEMTST**           '>> INTR UPC=', XS044-INTR-UPC-ID,                   06860000
NEMTST**           '>> REG PRICE=', XS044-RGLR-PRICE,                   06870000
NEMTST**           '>> FINAL-DET-PRC=', XS044-PD-PRICE,                 06880000
NEMTST**           '>> PROMO ID=', XS044-EBOGO-PROMO-ID,                06890000
NEMTST**           '>> PRICG TYP=', XS044-EBOGO-PRICG-TYP-CDE,          06900000
NEMTST**           '>> DISC QTY=', XS044-EBOGO-DISC-QTY,                06910000
NEMTST**           '>> DISC AMT=', XS044-EBOGO-DISC-AMT, '**'.          06920000
041700                                                                  06930000
           IF PV-TIERED-PROMO-INTFC-ID NOT = ZEROES                     06940000
              MOVE PV-TIERED-PROMO-ID       TO XS044-TIERED-PROMO-ID    06950000
              MOVE PV-TIERED-PROMO-INTFC-ID TO                          06960000
                                            XS044-TIERED-PROMO-INTFC-ID 06970000
              MOVE PV-TIERED-MDSE-LNE-ID    TO                          06980000
                                            XS044-TIERED-MDSE-LNE-ID    06990000
              MOVE PV-TIERED-PRICG-TYP-CDE  TO XS044-TIER-PRICG-TYP-CDE 07000000
              MOVE PV-TIERED-STRT-DTE       TO XS044-TIERED-STRT-TMST   07010000
              MOVE PV-TIERED-END-DTE        TO XS044-TIERED-END-TMST    07020000
              PERFORM VARYING TBL-TIER-INDEX FROM 1 BY 1                07030000
                 UNTIL TBL-TIER-INDEX > 10                              07040000
                    OR TBL-INTFC-SUB-ID(TBL-TIER-INDEX) = 0             07050000
                       SET XS044-TIER-INDX TO TBL-TIER-INDEX            07060000
                       MOVE TBL-BUY-QTY(TBL-TIER-INDEX) TO              07070000
                                   XS044-BUY-QTY(XS044-TIER-INDX)       07080000
                       MOVE TBL-BUY-DLR(TBL-TIER-INDEX) TO              07090000
                                   XS044-BUY-DLR(XS044-TIER-INDX)       07100000
                       MOVE TBL-GET-PCT(TBL-TIER-INDEX) TO              07110000
                                   XS044-GET-PCT(XS044-TIER-INDX)       07120000
                       MOVE TBL-GET-DLR(TBL-TIER-INDEX) TO              07130000
                                   XS044-GET-DLR(XS044-TIER-INDX)       07140000
                       MOVE TBL-INTFC-SUB-ID(TBL-TIER-INDEX) TO         07150000
                                   XS044-INTFC-SUB-ID(XS044-TIER-INDX)  07160000
              END-PERFORM                                               07170000
           END-IF.                                                      07180000
                                                                        07190000
      *8000-EXIT.                                                       07200000
       EJECT.                                                           07210000
                                                                        07220000
      *----------------------------------------------------------       07230000
      * 9000-READ-PD-INPUT-FILE.                                        07240000
      *     READ THE PRICE DETERMINATION INPUT FILE.                    07250000
      *----------------------------------------------------------       07260000
       9000-READ-PD-INPUT-FILE.                                         07270000
                                                                        07280000
           READ PD-INPUT-FILE INTO PV-INPUT-REC-LAYOUT                  07290000
                AT END                                                  07300000
                   SET PS-END-OF-INPUT-FILE TO TRUE                     07310000
           END-READ.                                                    07320000
                                                                        07330000
           IF PS-NOT-END-OF-INPUT-FILE                                  07340000
              ADD 1 TO PC-ALL-INPUT-RECS                                07350000
              IF PV-RECORD-TYPE = '0'                                   07360000
                 SET PS-HEAD-REC TO TRUE                                07370000
                 ADD 1 TO PC-HEAD-INPUT-RECS                            07380000
              ELSE                                                      07390000
                 IF PV-RECORD-TYPE = '1'                                07400000
                    MOVE PV-INPUT-REC-LAYOUT TO XS042-PD-DETAIL-RECORD  07410000
                    SET PS-DTL-REC TO TRUE                              07420000
                    ADD 1 TO PC-DTL-INPUT-RECS                          07430000
NEMTST**      DISPLAY '**9000- INPUT RECORD XS042 **',                  07440000
NEMTST**              '>> INTR UPC=', XS042-INTR-UPC-ID,                07450000
NEMTST**              '>> PROMO ID=', XS042-PROMO-ID,                   07460000
NEMTST**              '>> PRICG TYP=', XS042-PRICG-TYP-CDE,             07470000
NEMTST**              '>> HIER CDE=', XS042-MRCH-HEIR-CDE,              07480000
NEMTST**              '>> DISC QTY=', XS042-DISC-GP-QTY,                07490000
NEMTST**              '>> DISC AMT=', XS042-DISC-GP-AMT,                07500000
                 ELSE                                                   07510000
                    SET ABEND-4444-FORCED-ABEND TO TRUE                 07520000
                    MOVE '9000-READ-PD-INPUT-FILE' TO PV-PARAGRAPH-NAME 07530000
                    MOVE 'READING INPUT RECORDS' TO PV-OPERATION-MSG-1  07540000
                    MOVE 'NOT A VALID RECORD TYPE' TO PV-OPERATION-MSG-207550000
                    DISPLAY 'RECORD TYPE IS: ' PV-RECORD-TYPE           07560000
                    PERFORM 9800-ABEND                                  07570000
                 END-IF                                                 07580000
              END-IF                                                    07590000
           END-IF.                                                      07600000
                                                                        07610000
      *9000-EXIT.                                                       07620000
       EJECT.                                                           07630000
                                                                        07640000
      *----------------------------------------------------------       07650000
      * 9100-WRITE-PD-OUTPUT-RECORD.                                    07660000
      *     WRITES THE XREF DRIVER RECORD OUT TO THE FULL XREF          07670000
      *     DRIVER FILE.                                                07680000
      *----------------------------------------------------------       07690000
       9100-WRITE-PD-OUTPUT-RECORD.                                     07700000
                                                                        07710000
           WRITE PD-OUTPUT-RECORD                                       07720000
               FROM XS044-PD-OUTPUT-RECORD.                             07730000
                                                                        07740000
           ADD 1 TO PC-OUTPUT-RECS.                                     07750000
                                                                        07760000
      *9100-EXIT.                                                       07770000
       EJECT.                                                           07780000
                                                                        07790000
      *----------------------------------------------------------       07800000
      * 9800-ABEND.                                                     07810000
      *     ABEND PROGRAM WHEN A NON-DB2 ERROR OCCURS.                  07820000
      *----------------------------------------------------------       07830000
       9800-ABEND.                                                      07840000
                                                                        07850000
           DISPLAY '** ABEND       **'.                                 07860000
           DISPLAY '** PROGRAM     ** = ' PC-PROGRAM-NAME.              07870000
           DISPLAY '** PARAGRAPH   ** = ' PV-PARAGRAPH-NAME.            07880000
           DISPLAY '** OPERATION   ** = ' PV-OPERATION-MSG-1.           07890000
           DISPLAY '**             ** = ' PV-OPERATION-MSG-2.           07900000
           CALL 'ILBOABN0' USING ABEND-CODE.                            07910000
                                                                        07920000
      *9800-EXIT.                                                       07930000
       EJECT.                                                           07940000
                                                                        07950000
      *----------------------------------------------------------       07960000
      * 9900-SQL-ABEND-ROUTINE.                                         07970000
      *     SQL ABEND ROUTINE.                                          07980000
      *----------------------------------------------------------       07990000
       9900-SQL-ABEND-ROUTINE.                                          08000000
                                                                        08010000
           SET ABEND-4013-DB2-ERROR TO TRUE.                            08020000
           DISPLAY '** ABEND     **'.                                   08030000
           DISPLAY '** PROGRAM   ** = ' PC-PROGRAM-NAME.                08040000
           DISPLAY '** PARAGRAPH ** = ' PV-PARAGRAPH-NAME.              08050000
           DISPLAY '** OPERATION ** = ' PV-DB2-OPERATION.               08060000
                                                                        08070000
           COPY DPPD004.                                                08080000
           CALL 'ILBOABN0' USING ABEND-CODE.                            08090000
                                                                        08100000
      *9900-EXIT.                                                       08110000
       EJECT.                                                           08120000
                                                                        08130000
      *----------------------------------------------------------       08140000
      * 9999-WRAPUP.                                                    08150000
      *     MOVES ALL VARIABLES TO THE LINKAGE SECTION SO THEY          08160000
      *     CAN BE PASSED BACK TO THE CALLING PROGRAM.                  08170000
      *----------------------------------------------------------       08180000
       9999-WRAPUP.                                                     08190000
                                                                        08200000
           CLOSE PD-INPUT-FILE                                          08210000
                 PD-OUTPUT-FILE.                                        08220000
                                                                        08230000
           DISPLAY ' '.                                                 08240000
           DISPLAY '*********************************************'      08250000
           DISPLAY 'PROGRAM NAME: ' PC-PROGRAM-NAME.                    08260000
           DISPLAY '*********************************************'      08270000
           DISPLAY '# OF INPUT RECS READ: ' PC-ALL-INPUT-RECS.          08280000
           DISPLAY '# OF HEADER INPUT RECS READ: ' PC-HEAD-INPUT-RECS.  08290000
           DISPLAY '# OF DETAIL INPUT RECS READ: ' PC-DTL-INPUT-RECS.   08300000
           DISPLAY '# OF OUTPUT RECS WRITTEN: ' PC-OUTPUT-RECS.         08310000
           DISPLAY '*********************************************'.     08320000
                                                                        08330000
      *9999-EXIT.                                                       08340000
       EJECT.                                                           08350000
                                                                        08360000
